---
title: Установка сертификатов на устройстве — Azure IoT Edge | Документация Майкрософт
description: Создайте тестовые сертификаты и Узнайте, как их установить на устройство Azure IoT Edge, чтобы подготовиться к развертыванию в рабочей среде.
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 02/11/2020
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: d9f715a6ab43206d02107f6335e9b4c0bb4266e0
ms.sourcegitcommit: 64def2a06d4004343ec3396e7c600af6af5b12bb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2020
ms.locfileid: "77471012"
---
# <a name="install-production-certificates-on-an-iot-edge-device"></a>Установка рабочих сертификатов на устройство IoT Edge

Все устройства IoT Edge используют сертификаты для создания безопасных соединений между средой выполнения и любыми модулями, работающими на устройстве.
IoT Edge устройства работают, как шлюзы, используют те же сертификаты для подключения к их нижестоящим устройствам.

При первой установке IoT Edge и подготовке устройства устройство настраивается с помощью временных сертификатов, что позволяет протестировать службу.
Срок действия этих временных сертификатов истекает через 90 дней, или их можно сбросить, перезапустив компьютер.
Когда вы будете готовы переместить устройства в рабочий сценарий или хотите создать сценарий шлюза, необходимо предоставить собственные сертификаты.
В этой статье описываются действия по установке сертификатов на устройства IoT Edge.

Дополнительные сведения о различных типах сертификатов и их ролях в IoT Edge сценарии см. в разделе [понимание того, как Azure IOT Edge использует сертификаты](iot-edge-certs.md).

>[!NOTE]
>Термин "корневой ЦС", используемый в этой статье, относится к общедоступному центру сертификации цепочки сертификатов для вашего решения IoT. Не нужно использовать корневой каталог сертификатов в центре сертификации, или корневой центр сертификации вашей организации. Во многих случаях это фактический открытый сертификат промежуточного ЦС.

## <a name="prerequisites"></a>Предварительные требования

* Устройство IoT Edge, работающее как в [Windows](how-to-install-iot-edge-windows.md) , так и в [Linux](how-to-install-iot-edge-linux.md).
* Наличие сертификата корневого центра сертификации (CA), самозаверяющего или приобретенного в доверенном коммерческом центре сертификации, например Baltimore, VeriSign, DigiCert или Глобалсигн.

Если у вас еще нет корневого центра сертификации, но вы хотите испытать IoT Edge функции, для которых требуются производственные сертификаты (например, сценарии шлюза), можно [создать демонстрационные сертификаты для тестирования IOT Edgeных функций устройства](how-to-create-test-certificates.md).

## <a name="create-production-certificates"></a>Создание рабочих сертификатов

Для создания следующих файлов следует использовать собственный центр сертификации:

* Корневой ЦС
* Сертификат ЦС устройства
* Закрытый ключ ЦС устройства

В этой статье мы будем называть *корневой центр сертификации* , который не является самым верхним центром сертификации для Организации. Это самый верхний центр сертификации для сценария IoT Edge, который модуль центра IoT Edge, пользовательские модули и все подчиненные устройства используют для установления отношения доверия между собой.

Чтобы просмотреть пример этих сертификатов, просмотрите сценарии, создающие демонстрационные сертификаты в разделе [Управление сертификатами ЦС для примеров и учебников](https://github.com/Azure/iotedge/tree/master/tools/CACertificates).

## <a name="install-certificates-on-the-device"></a>Установка сертификатов на устройстве

Установите цепочку сертификатов на устройстве IoT Edge и настройте среду выполнения IoT Edge для ссылки на новые сертификаты.

Например, если вы использовали примеры сценариев для [создания демонстрационных сертификатов](how-to-create-test-certificates.md), то три файла, которые необходимо скопировать на устройство IOT EDGE, будут следующими:

* Сертификат ЦС устройства: `<WRKDIR>\certs\iot-edge-device-MyEdgeDeviceCA-full-chain.cert.pem`
* Закрытый ключ ЦС устройства: `<WRKDIR>\private\iot-edge-device-MyEdgeDeviceCA.key.pem`
* Корневой ЦС: `<WRKDIR>\certs\azure-iot-test-only.root.ca.cert.pem`

1. Скопируйте три файла сертификата и ключей на устройство IoT Edge.

   Для перемещения файлов сертификатов можно использовать службу, такую как [Azure Key Vault](https://docs.microsoft.com/azure/key-vault) , или функцию, например [протокол безопасного копирования](https://www.ssh.com/ssh/scp/) .  Если сертификаты созданы на самом устройстве IoT Edge, этот шаг можно пропустить и использовать путь к рабочему каталогу.

2. Откройте файл конфигурации управляющей программы безопасности IoT Edge.

   * Windows: `C:\ProgramData\iotedge\config.yaml`
   * Linux: `/etc/iotedge/config.yaml`

3. Задайте для свойств **сертификата** в файле config. YAML полный путь к сертификату и файлам ключей на устройстве IOT Edge. Удалите символ `#` перед свойствами сертификата, чтобы раскомментировать четыре строки. Убедитесь, что **сертификаты:** строка не имеет предшествующих пробелов, а вложенные элементы имеют отступ в два пробела. Например:

   * Windows:

      ```yaml
      certificates:
        device_ca_cert: "c:\\<path>\\device-ca.cert.pem"
        device_ca_pk: "c:\\<path>\\device-ca.key.pem"
        trusted_ca_certs: "c:\\<path>\\root-ca.root.ca.cert.pem"
      ```

   * Linux:

      ```yaml
      certificates:
        device_ca_cert: "<path>/device-ca.cert.pem"
        device_ca_pk: "<path>/device-ca.key.pem"
        trusted_ca_certs: "<path>/root-ca.root.ca.cert.pem"
      ```

4. На устройствах Linux убедитесь, что у пользователя **iotedge** есть разрешения на чтение каталога, в котором хранятся сертификаты.

5. Если вы использовали другие сертификаты для IoT Edge на устройстве, перед запуском или перезапуском IoT Edge удалите эти файлы в следующих двух каталогах:

   * Windows: `C:\ProgramData\iotedge\hsm\certs` и `C:\ProgramData\iotedge\hsm\cert_keys`

   * Linux: `/var/lib/iotedge/hsm/certs` и `/var/lib/iotedge/hsm/cert_keys`

## <a name="next-steps"></a>Следующие шаги

Установка сертификатов на устройстве IoT Edge является необходимым этапом перед развертыванием решения в рабочей среде. Узнайте больше о том, как [подготовиться к развертыванию решения IOT EDGE в рабочей среде](production-checklist.md).
