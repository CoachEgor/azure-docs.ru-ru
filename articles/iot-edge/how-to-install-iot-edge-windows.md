---
title: Установка Azure IoT Edge в Windows | Документация Майкрософт
description: Инструкции по установке Azure IoT Edge в Windows 10, Windows Server и Windows IoT Базовая
author: kgremban
manager: philmea
ms.reviewer: veyalla
ms.service: iot-edge
services: iot-edge
ms.topic: conceptual
ms.date: 10/04/2019
ms.author: kgremban
ms.openlocfilehash: e3f55f9be28a8b53f012e111e43ba1f495b1d585
ms.sourcegitcommit: 7b25c9981b52c385af77feb022825c1be6ff55bf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/13/2020
ms.locfileid: "79285062"
---
# <a name="install-the-azure-iot-edge-runtime-on-windows"></a>Установка среды выполнения Azure IoT Edge в Windows

Среда выполнения Azure IoT Edge превращает устройство в устройство IoT Edge. Среду выполнения можно развернуть на всех устройствах — от небольшого Raspberry Pi до технического сервера. Как только на устройстве будет настроена среда выполнения IoT Edge, вы можете начать развертывать в нее бизнес-логику из облака.

Дополнительные сведения о среде выполнения IoT Edge см. в статье [Общие сведения о среде выполнения Azure IoT Edge и ее архитектуре](iot-edge-runtime.md).

В этой статье перечислены действия по установке среды выполнения Azure IoT Edge в системе Windows x64 (AMD и Intel) с помощью контейнеров Windows.

> [!NOTE]
> Известная ошибка операционной системы Windows не позволяет переходить в спящий режим и режим гибернации при IoT Edgeных модулях (контейнеры Windows Nano Server с изолированной обработкой). Эта проблема влияет на время работы батареи устройства.
>
> В качестве обходного решения используйте команду `Stop-Service iotedge` для завершения работы модулей IoT Edge перед использованием этих режимов питания.

Использование контейнеров Linux в системах Windows не является рекомендуемым или поддерживаемым производственной конфигурацией для Azure IoT Edge. Однако его можно использовать для целей разработки и тестирования. Дополнительные сведения см. в статье [использование IOT EDGE в Windows для запуска контейнеров Linux](how-to-install-iot-edge-windows-with-linux.md).

Сведения о том, что входит в последнюю версию IoT Edge, см. в разделе [Azure IOT Edge выпуски](https://github.com/Azure/azure-iotedge/releases).

## <a name="prerequisites"></a>предварительные требования

В этом разделе можно посмотреть, поддерживает ли устройство Windows IoT Edge, а также подготовить его для подсистемы контейнеров перед установкой.

### <a name="supported-windows-versions"></a>Поддерживаемые версии Windows

Для сценариев разработки и тестирования Azure IoT Edge с контейнерами Windows можно установить в любой версии Windows 10 или Windows Server 2019 (сборка 17763), поддерживающей функцию контейнеров. Сведения о том, какие операционные системы в настоящее время поддерживаются в рабочих сценариях, см. в разделе [Azure IOT Edge Поддерживаемые системы](support.md#operating-systems).

Устройства центра Интернета вещей должны включать в себя дополнительный компонент "контейнеры Интернета вещей Core — Windows" для поддержки IoT Edge среды выполнения. Используйте следующую команду в [удаленном сеансе PowerShell](https://docs.microsoft.com/windows/iot-core/connect-your-device/powershell) , чтобы проверить, поддерживаются ли на устройстве контейнеры Windows:

```powershell
Get-Service vmcompute
```

Если служба присутствует, вы должны получить успешный ответ со статусом службы в списке **выполняется**. Если служба вмкомпуте не найдена, устройство не соответствует требованиям для IoT Edge. Обратитесь к поставщику оборудования, чтобы узнать о поддержке этой функции.

### <a name="prepare-for-a-container-engine"></a>Подготовка для подсистемы контейнеров

Служба Azure IoT Edge использует подсистему контейнеров, [совместимую с OCI](https://www.opencontainers.org/). В рабочей среде используйте подсистему Moby, включенную в скрипт установки, для запуска контейнеров Windows на устройстве Windows.

## <a name="install-iot-edge-on-a-new-device"></a>Установка IoT Edge на новое устройство

>[!NOTE]
>Использование программных пакетов Azure IoT Edge регулируется условиями лицензии, содержащейся в самих пакетах (в каталоге LICENSE). Прежде чем использовать пакет, ознакомьтесь с условиями лицензии. Установка и использование пакета означают, что вы принимаете эти условия. Если вы не согласны с условиями лицензии, не используйте пакет.

Сценарий PowerShell загружает и устанавливает управляющую программу безопасности Azure IoT Edge. Управляющая программа безопасности запускает первый из двух модулей среды выполнения, агент IoT Edge, который обеспечивает удаленные развертывания других модулей.

>[!TIP]
>Для устройств IoT Core рекомендуется выполнять команды установки с помощью сеанса Ремотеповершелл. Дополнительные сведения см. [в статье Использование PowerShell для Windows IOT](https://docs.microsoft.com/windows/iot-core/connect-your-device/powershell).

При установке среды выполнения IoT Edge в первый раз на устройстве нужно подготовить устройство с помощью удостоверения из центра Интернета вещей. Отдельное IoT Edge устройство можно подготовить вручную, используя строку подключения устройства, предоставленную Центром Интернета вещей. Вы также можете использовать службу подготовки устройств (DPS) для автоматической подготовки устройств, что полезно при наличии множества устройств для настройки. В зависимости от выбранного способа подготовки выберите соответствующий скрипт установки.

Следующие разделы описывают распространенные варианты использования и параметров для скрипта установки IoT Edge на новое устройство.

### <a name="option-1-install-and-manually-provision"></a>Вариант 1. Установка и подготовка вручную

В этом первом варианте вы задаете **строку подключения устройства** , созданную центром Интернета вещей для инициализации устройства.

В этом примере демонстрируется установка вручную с контейнерами Windows.

1. Если вы еще этого не сделали, зарегистрируйте новое устройство IoT Edge и получите **строку подключения устройства**. Скопируйте строку подключения для использования далее в этом разделе. Этот шаг можно выполнить с помощью следующих средств:

   * [Портал Azure](how-to-register-device.md#register-in-the-azure-portal)
   * [Azure CLI](how-to-register-device.md#register-with-the-azure-cli)
   * [Visual Studio Code](how-to-register-device.md#register-with-visual-studio-code)

2. Откройте сеанс PowerShell от имени администратора.

   >[!NOTE]
   >Для установки IoT Edge используйте сеанс AMD64 PowerShell, а не PowerShell (x86). Чтобы узнать, какой тип сеанса используется, выполните следующую команду:
   >
   >```powershell
   >(Get-Process -Id $PID).StartInfo.EnvironmentVariables["PROCESSOR_ARCHITECTURE"]
   >```

3. Команда **deploy-IoTEdge** проверяет, что компьютер Windows находится в поддерживаемой версии, включает функцию контейнеров, а затем загружает среду выполнения значок Кита и среду выполнения IOT Edge. Команда по умолчанию использует контейнеры Windows.

   ```powershell
   . {Invoke-WebRequest -useb https://aka.ms/iotedge-win} | Invoke-Expression; `
   Deploy-IoTEdge
   ```

4. На этом этапе устройства IoT Core могут перезапускаться автоматически. Другие устройства Windows 10 или Windows Server могут предложить перезагрузку. Если да, перезагрузите устройство прямо сейчас. Когда устройство будет готово, снова запустите PowerShell от имени администратора.

5. Команда **Initialize-IoTEdge** настраивает среду выполнения IoT Edge на вашем компьютере. По умолчанию при выполнении команды применяется подготовка вручную с помощью контейнеров Windows.

   ```powershell
   . {Invoke-WebRequest -useb https://aka.ms/iotedge-win} | Invoke-Expression; `
   Initialize-IoTEdge
   ```

6. При появлении запроса введите строку подключения устройства, полученную на шаге 1. Строка подключения устройства связывает физическое устройство с ИДЕНТИФИКАТОРом устройства в центре Интернета вещей.

   Строка подключения устройства имеет следующий формат и не должна содержать кавычки: `HostName={IoT hub name}.azure-devices.net;DeviceId={device name};SharedAccessKey={key}`

7. Выполните действия, описанные в разделе [Проверка успешной установки](#verify-successful-installation) , чтобы проверить состояние IOT EDGE на устройстве.

Когда вы устанавливаете и подготавливаете устройство вручную, можно использовать дополнительные параметры для изменения установки, том числе сделать следующее.

* Направить трафик через прокси-сервер.
* Указать установщику автономный каталог.
* Объявить определенный образ контейнера агента и указать учетные данные, если он находится в частном реестре.

Дополнительные сведения об этих параметрах установки см. в статье о [всех параметрах установки](#all-installation-parameters).

### <a name="option-2-install-and-automatically-provision"></a>Вариант 2. Установка и автоматическая подготовка

Во втором варианте подготовка устройства выполняется с помощью службы подготовки устройств к добавлению в Центр Интернета вещей. Укажите **идентификатор области** из экземпляра службы подготовки устройств, а также другие сведения, относящиеся к предпочтительному [механизму аттестации](../iot-dps/concepts-security.md#attestation-mechanism):

* [Создание и инициализация имитации устройства IoT Edge с помощью виртуального доверенного платформенного модуля в Windows](how-to-auto-provision-simulated-device-windows.md)
* [Создание и инициализация устройства IoT Edge с помощью аттестации симметричных ключей](how-to-auto-provision-symmetric-keys.md)

При автоматической установке и подготовке устройства можно использовать дополнительные параметры для изменения установки, в том числе:

* Направить трафик через прокси-сервер.
* Указать установщику автономный каталог.
* Объявить определенный образ контейнера агента и указать учетные данные, если он находится в частном реестре.

Дополнительные сведения об этих параметрах установки вы найдете далее в этой статье. Вы можете пропустить этот раздел и ознакомиться со [всеми параметрами установки](#all-installation-parameters).

## <a name="offline-or-specific-version-installation"></a>Установка в автономном режиме или с определенной версией

Во время установки скачивается два файла:

* Microsoft Azure IoT Edge CAB-файл, содержащий управляющую программу IoT Edge (иотеджед), контейнер значок Кита и интерфейс командной строки значок Кита.
* MSI C++ -файл распространяемого пакета Visual (среда выполнения VC)

Если устройство будет отключено во время установки или вы хотите установить определенную версию IoT Edge, можно загрузить один или оба этих файла на устройство заранее. Когда пора установить, наведите сценарий установки в каталог, содержащий Скачанные файлы. Установщик сначала проверяет каталог, а затем загружает только те компоненты, которые не найдены. Если все файлы доступны в автономном режиме, можно установить без подключения к Интернету.

Последние файлы установки IoT Edge вместе с предыдущими версиями см. в разделе [Azure IOT Edge выпуски](https://github.com/Azure/azure-iotedge/releases).

Чтобы установить с автономными компонентами, используйте параметр `-OfflineInstallationPath` в составе команды deploy-IoTEdge и укажите абсолютный путь к каталогу файлов. Например,

```powershell
. {Invoke-WebRequest -useb https://aka.ms/iotedge-win} | Invoke-Expression; `
Deploy-IoTEdge -OfflineInstallationPath C:\Downloads\iotedgeoffline
```

>[!NOTE]
>Параметр `-OfflineInstallationPath` ищет файл с именем **Микрософт-Азуре-иотедже. cab** в указанном каталоге. Начиная с версии IoT Edge-RC4, можно использовать два CAB-файла: один для устройств AMD64 и один для ARM32. Скачайте правильный файл для устройства, а затем переименуйте файл, чтобы удалить суффикс архитектуры.

Команда `Deploy-IoTEdge` устанавливает компоненты IoT Edge, а затем необходимо перейти к команде `Initialize-IoTEdge`, чтобы настроить устройство с помощью идентификатора и подключения устройства центра Интернета вещей. Либо выполните команду напрямую, а затем укажите строку подключения из центра Интернета вещей, или воспользуйтесь одной из ссылок в предыдущем разделе, чтобы узнать, как автоматически подготавливать устройства с помощью службы подготовки устройств.

```powershell
. {Invoke-WebRequest -useb https://aka.ms/iotedge-win} | Invoke-Expression; `
Initialize-IoTEdge
```

Можно также использовать параметр пути автономной установки с помощью команды Update-IoTEdge.

## <a name="verify-successful-installation"></a>Проверка установки

Проверьте состояние службы IoT Edge. Оно должно быть указано как работает.  

```powershell
Get-Service iotedge
```

Просмотрите журналы службы за последние пять минут. Если вы только что установили среду выполнения IoT Edge, может отобразиться список ошибок с момента запуска **deploy-IoTEdge** и **Initialize-IoTEdge**. Эти ошибки являются ожидаемыми, так как служба пытается запуститься перед настройкой.

```powershell
. {Invoke-WebRequest -useb https://aka.ms/iotedge-win} | Invoke-Expression; Get-IoTEdgeLog
```

Выполните автоматическую проверку наиболее распространенных ошибок конфигурации и сети.

```powershell
iotedge check
```

Просмотрите список запущенных модулей. После новой установки единственным модулем, который вы должны увидеть, является **edgeAgent**. После первого [развертывания модулей IOT Edge](how-to-deploy-modules-portal.md) на устройстве будет запущен другой системный модуль **edgeHub**.

```powershell
iotedge list
```

## <a name="manage-module-containers"></a>Управление контейнерами модулей

Для работы службы IoT Edge требуется, чтобы на устройстве выполнялся модуль контейнера. При развертывании модуля на устройстве среда выполнения IoT Edge использует подсистему контейнеров для извлечения образа контейнера из реестра в облаке. Служба IoT Edge позволяет взаимодействовать с модулями и получать журналы, но иногда может потребоваться использовать модуль контейнеров для взаимодействия с самим контейнером.

Дополнительные сведения об основных понятиях модуля см. в разделе [Знакомство с Azure IOT Edge модулями](iot-edge-modules.md).

Если вы используете контейнеры Windows на устройстве Windows IoT Edge, то IoT Edgeная установка включала подсистему контейнеров значок Кита. Подсистема значок Кита была основана на тех же стандартах, что и DOCKER, и была разработана для параллельного выполнения на том же компьютере, что и DOCKER Desktop. По этой причине, если вы хотите нацелить контейнеры, управляемые подсистемой значок Кита, необходимо специально указать эту подсистему вместо DOCKER.

Например, чтобы получить список всех образов DOCKER, используйте следующую команду:

```powershell
docker images
```

Чтобы получить список всех образов значок Кита, измените ту же команду, указав указатель на подсистему значок Кита:

```powershell
docker -H npipe:////./pipe/iotedge_moby_engine images
```

Универсальный код ресурса (URI) обработчика указан в выходных данных скрипта установки, или его можно найти в разделе Параметры среды выполнения контейнера для файла config. YAML.

![moby_runtime URI в файле config. YAML](./media/how-to-install-iot-edge-windows/moby-runtime-uri.png)

Дополнительные сведения о командах, которые можно использовать для взаимодействия с контейнерами и изображениями, работающими на устройстве, см. в разделе [интерфейсы командной строки DOCKER](https://docs.docker.com/engine/reference/commandline/docker/).

## <a name="uninstall-iot-edge"></a>Удаление IoT Edge

Если вы хотите удалить установку IoT Edge с устройства Windows, используйте следующую команду в окне администратора PowerShell. Эта команда удаляет среду выполнения IoT Edge вместе с существующей конфигурацией и данными подсистемы Moby.

```powershell
. {Invoke-WebRequest -useb aka.ms/iotedge-win} | Invoke-Expression; `
Uninstall-IoTEdge
```

Команда uninstall-IoTEdge не работает в Windows IoT базовая. Чтобы удалить IoT Edge с устройств Windows IoT Core, необходимо повторно развернуть образ Windows IoT Core.

Для получения дополнительных сведений о параметрах удаления используйте команду `Get-Help Uninstall-IoTEdge -full`.

## <a name="all-installation-parameters"></a>Все параметры установки

В предыдущих разделах представлены общие сценарии установки с примерами того, как использовать параметры для изменения скрипта установки. В этом разделе содержатся справочные таблицы по общим параметрам, используемым для установки, обновления или удаления IoT Edge.

### <a name="deploy-iotedge"></a>Deploy-IoTEdge

Команда deploy-IoTEdge скачивает и развертывает управляющую программу безопасности IoT Edge и ее зависимости. Команда развертывания принимает эти общие параметры, а также другие. Для полного списка используйте команду `Get-Help Deploy-IoTEdge -full`.  

| Параметр | Допустимые значения | Комментарии |
| --------- | --------------- | -------- |
| **ContainerOs** | **Windows** или **Linux**. | Если не указана операционная система контейнера, значение по умолчанию — Windows.<br><br>Для контейнеров Windows IoT Edge использует подсистему контейнеров значок Кита, входящую в установку. Для контейнеров Linux необходимо установить подсистему контейнеров перед началом установки. |
| **Proxy** | URL-адрес прокси-сервера. | Включите этот параметр, если ваше устройство подключается к Интернету через прокси-сервер. Дополнительные сведения см. в статье [Настройка устройства IoT Edge для обмена данными через прокси-сервер](how-to-configure-proxy-support.md). |
| **OfflineInstallationPath** | Путь к каталогу. | Если этот параметр включен, установщик будет проверять указанный каталог на наличие файлов MSI для IoT Edge CAB и среды выполнения VC, необходимых для установки. Скачаны все файлы, не найденные в каталоге. Если оба файла находятся в каталоге, можно установить IoT Edge без подключения к Интернету. Этот параметр также можно использовать для использования определенной версии. |
| **InvokeWebRequestParameters** | Хэш-таблица параметров и значений. | Во время установки выполняется несколько веб-запросов. Используйте это поле, чтобы задать параметры для этих веб-запросов. Этот параметр нужен, чтобы настроить учетные данные для прокси-серверов. Дополнительные сведения см. в статье [Настройка устройства IoT Edge для обмена данными через прокси-сервер](how-to-configure-proxy-support.md). |
| **рестартифнидед** | none | Этот флаг позволяет скрипту развертывания перезапускать компьютер без запроса при необходимости. |

### <a name="initialize-iotedge"></a>Initialize-IoTEdge

Команда Initialize-IoTEdge настраивает IoT Edge с помощью строки подключения устройства и сведений о работе. Большая часть информации, создаваемой этой командой, сохраняется в файле иотедже\конфиг.ямл. Команда инициализации принимает и другие общие параметры. Для полного списка используйте команду `Get-Help Initialize-IoTEdge -full`.

| Параметр | Допустимые значения | Комментарии |
| --------- | --------------- | -------- |
| **Вручную** | None | **Параметр-переключатель**. Если тип подготовки не указан, по умолчанию используется значение вручную.<br><br>Объявляет, что вы предоставите строку подключения устройства для подготовки устройства вручную. |
| **Dps** | None | **Параметр-переключатель**. Если тип подготовки не указан, по умолчанию используется значение вручную.<br><br>Объявляет, что вы предоставите идентификатор области службы подготовки устройств (DPS) и идентификатор регистрации устройства для подготовки через DPS.  |
| **DeviceConnectionString** | Строка подключения из устройства IoT Edge, зарегистрированного в Центре Интернета вещей, в одинарных кавычках. | **Необходима** для установки вручную. Если не указать строку подключения в параметрах скрипта, она будет запрошена во время установки. |
| **ScopeId** | Идентификатор области из экземпляра службы подготовки устройств, связанного с Центром Интернета вещей. | **Необходим** для установки через службу подготовки устройств. Если не указать идентификатор области в параметрах скрипта, он будет запрошен во время установки. |
| **RegistrationId** | Идентификатор регистрации, созданный вашим устройством. | **Требуется** для установки DPS при использовании TPM или аттестации симметричного ключа. |
| **SymmetricKey** | Симметричный ключ, используемый для подготовки удостоверения устройства IoT Edge при использовании DPS | **Требуется** для установки DPS при использовании аттестации симметричных ключей. |
| **ContainerOs** | **Windows** или **Linux**. | Если не указана операционная система контейнера, значение по умолчанию — Windows.<br><br>Для контейнеров Windows IoT Edge использует подсистему контейнеров значок Кита, входящую в установку. Для контейнеров Linux необходимо установить подсистему контейнеров перед началом установки. |
| **InvokeWebRequestParameters** | Хэш-таблица параметров и значений. | Во время установки выполняется несколько веб-запросов. Используйте это поле, чтобы задать параметры для этих веб-запросов. Этот параметр нужен, чтобы настроить учетные данные для прокси-серверов. Дополнительные сведения см. в статье [Настройка устройства IoT Edge для обмена данными через прокси-сервер](how-to-configure-proxy-support.md). |
| **AgentImage** | URI образа агента IoT Edge. | По умолчанию новая установка IoT Edge использует последний тег для образа агента IoT Edge. Используйте этот параметр, чтобы задать определенный тег для версии образа, или предоставьте свой образ агента. Дополнительные сведения см. в статье [Основные сведения о тегах IoT Edge](how-to-update-iot-edge.md#understand-iot-edge-tags). |
| **Имя пользователя** | Имя пользователя реестра контейнеров | Используйте этот параметр только в том случае, если вы задаете значение параметра -AgentImage для контейнера в частном реестре. Укажите имя пользователя с доступом к реестру. |
| **Пароль** | Строка надежного пароля. | Используйте этот параметр только в том случае, если вы задаете значение параметра -AgentImage для контейнера в частном реестре. Укажите пароль для доступа к реестру. |

### <a name="update-iotedge"></a>Update-IoTEdge

| Параметр | Допустимые значения | Комментарии |
| --------- | --------------- | -------- |
| **ContainerOs** | **Windows** или **Linux**. | Если ОС контейнера не указана, по умолчанию используется значение Windows. Для контейнеров Windows подсистема контейнеров будет включена в установку. Для контейнеров Linux необходимо установить подсистему контейнеров перед началом установки. |
| **Proxy** | URL-адрес прокси-сервера. | Включите этот параметр, если ваше устройство подключается к Интернету через прокси-сервер. Дополнительные сведения см. в статье [Настройка устройства IoT Edge для обмена данными через прокси-сервер](how-to-configure-proxy-support.md). |
| **InvokeWebRequestParameters** | Хэш-таблица параметров и значений. | Во время установки выполняется несколько веб-запросов. Используйте это поле, чтобы задать параметры для этих веб-запросов. Этот параметр нужен, чтобы настроить учетные данные для прокси-серверов. Дополнительные сведения см. в статье [Настройка устройства IoT Edge для обмена данными через прокси-сервер](how-to-configure-proxy-support.md). |
| **OfflineInstallationPath** | Путь к каталогу. | Если этот параметр включен, установщик будет проверять указанный каталог на наличие файлов MSI для IoT Edge CAB и среды выполнения VC, необходимых для установки. Скачаны все файлы, не найденные в каталоге. Если оба файла находятся в каталоге, можно установить IoT Edge без подключения к Интернету. Этот параметр также можно использовать для использования определенной версии. |
| **рестартифнидед** | none | Этот флаг позволяет скрипту развертывания перезапускать компьютер без запроса при необходимости. |

### <a name="uninstall-iotedge"></a>Uninstall-IoTEdge

| Параметр | Допустимые значения | Комментарии |
| --------- | --------------- | -------- |
| **Перевести** | none | Этот флаг принудительно выполняет удаление, если предыдущая попытка удаления завершилась неудачно.
| **рестартифнидед** | none | Этот флаг позволяет сценарию удаления перезапускать компьютер без запроса при необходимости. |

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда подготовлено устройство IoT Edge и установлена среда выполнения, вы можете [развернуть модули IoT Edge](how-to-deploy-modules-portal.md).

Если вам не удается установить IoT Edge, перейдите на страницу со сведениями об [устранении неполадок](troubleshoot.md).

Чтобы обновить существующую установку до последней версии IoT Edge, см. раздел [Обновление управляющей программы безопасности и среды выполнения IoT Edge](how-to-update-iot-edge.md).
