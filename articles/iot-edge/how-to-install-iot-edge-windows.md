---
title: Установка Azure IoT Edge в Windows | Документация Майкрософт
description: Инструкции по установке Azure IoT Edge в Windows 10, Windows Server и Windows IoT Базовая
author: kgremban
manager: philmea
ms.reviewer: veyalla
ms.service: iot-edge
services: iot-edge
ms.topic: conceptual
ms.date: 03/14/2019
ms.author: kgremban
ms.custom: seodec18
ms.openlocfilehash: 95e984f6f08af01a2ffd7b9b4e0ec598d73f4d05
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60595093"
---
# <a name="install-the-azure-iot-edge-runtime-on-windows"></a>Установка среды выполнения Azure IoT Edge в Windows

Среда выполнения Azure IoT Edge превращает устройство в устройство IoT Edge. Среду выполнения можно развернуть на всех устройствах — от небольшого Raspberry Pi до технического сервера. Как только на устройстве будет настроена среда выполнения IoT Edge, вы можете начать развертывать в нее бизнес-логику из облака. 

Дополнительные сведения о среде выполнения IoT Edge см. в статье [Общие сведения о среде выполнения Azure IoT Edge и ее архитектуре](iot-edge-runtime.md).

В этой статье описаны этапы установки среды выполнения Azure IoT Edge на компьютере под управлением 64-разрядной ОС Windows (на базе процессора AMD или Intel). Сейчас поддержка Windows доступна в предварительной версии.

> [!NOTE]
> Известная проблема операционной системы Windows препятствует переход в спящий режим и режим гибернации энергопотребления при выполнении модулей IoT Edge (изолированный процесс контейнеров Windows Nano Server). Эта проблема влияет на аккумулятора на устройстве.
>
> Чтобы избежать этого, используйте команду `Stop-Service iotedge` для остановки запущенного модулей IoT Edge перед использованием этих энергопотребления. 

<!--
> [!NOTE]
> Using Linux containers on Windows systems is not a recommended or supported production configuration for Azure IoT Edge. However, it can be used for development and testing purposes.
-->

С помощью Linux контейнер в системах Windows не рекомендуемых или поддерживаемых рабочей конфигурации для Azure IoT Edge. Однако его можно использовать для целей разработки и тестирования. 

## <a name="prerequisites"></a>Технические условия

В этом разделе можно посмотреть, поддерживает ли устройство Windows IoT Edge, а также подготовить его для подсистемы контейнеров перед установкой. 

### <a name="supported-windows-versions"></a>Поддерживаемые версии Windows

Azure IoT Edge поддерживает разные версии Windows в зависимости от того, используете вы контейнеры Windows или Linux. 

Последняя версия Azure IoT Edge с контейнерами Windows подходит для следующих версий Windows:
* Windows 10 или IoT Базовая с обновлением за октябрь 2018 года (сборка 17763);
* Windows Server 2019 (сборка 17763).

Последняя версия Azure IoT Edge с контейнерами Linux подходит для следующих версий Windows: 
* юбилейное обновление Windows 10 (сборка 14393) или более поздняя версия;
* Windows Server 2016 или поздней версии.

Дополнительные сведения о том, какие операционные системы в настоящее время поддерживаются, см. на странице [поддержки Azure IoT Edge](support.md#operating-systems). 

Дополнительные сведения о том, что входит в последнюю версию IoT Edge, см. в разделе [Выпуски Azure IoT Edge](https://github.com/Azure/azure-iotedge/releases).

### <a name="prepare-for-a-container-engine"></a>Подготовка для подсистемы контейнеров 

Служба Azure IoT Edge использует подсистему контейнеров, [совместимую с OCI](https://www.opencontainers.org/). В рабочей среде используйте подсистему Moby, включенную в скрипт установки, для запуска контейнеров Windows на устройстве Windows. Для разработки и тестирования можно запускать контейнеры Linux на устройстве Windows, но вам нужно установить и настроить подсистему контейнеров перед установкой IoT Edge. Для обоих сценариев см. следующие разделы с описанием предварительных требований для подготовки устройства. 

Если вы хотите установить Edge Интернета вещей на виртуальной машине, включение вложенной виртуализации и выделите по крайней мере 2 ГБ памяти. Как включить вложенную виртуализацию, отличается в зависимости от низкоуровневой оболочки к использованию. Для Hyper-V виртуальные машины поколения 2 имеются вложенные виртуализация включена по умолчанию. Для VMWare есть переключатель, чтобы включить эту функцию на виртуальной машине. 

#### <a name="moby-engine-for-windows-containers"></a>Подсистема Moby для контейнеров Windows

Для устройств Windows с IoT Edge в рабочих сценариях Moby является единственной официально поддерживаемой подсистемой контейнеров. Скрипт установки автоматически устанавливает подсистему Moby на устройстве перед установкой IoT Edge. Подготовьте устройство, включив функцию контейнеров. 

1. На панели запуска найдите **Включение и отключение компонентов Windows** и откройте программу панели управления.
2. Найдите и выберите **Контейнеры**.
3. Нажмите кнопку **ОК**. 

#### <a name="docker-for-linux-containers"></a>Docker для контейнеров Linux

Если вы используете Windows для разработки и тестирования контейнеров для устройств Linux, можно использовать [Docker для Windows](https://www.docker.com/docker-windows) в качестве подсистемы контейнеров. Docker можно настроить для [использования контейнеров Linux](https://docs.docker.com/docker-for-windows/#switch-between-windows-and-linux-containers). Необходимо установить Docker и настроить его перед установкой IoT Edge. Контейнеры Linux не поддерживаются на устройствах Windows в рабочей среде. 

Если устройство IoT Edge является компьютером под управлением Windows, убедитесь, что оно соответствует [системным требованиям](https://docs.microsoft.com/virtualization/hyper-v-on-windows/reference/hyper-v-requirements) для использования Hyper-V.

## <a name="install-iot-edge-on-a-new-device"></a>Установка IoT Edge на новое устройство

>[!NOTE]
>Использование программных пакетов Azure IoT Edge регулируется условиями лицензии, содержащейся в самих пакетах (в каталоге LICENSE). Прежде чем использовать пакет, ознакомьтесь с условиями лицензии. Установка и использование пакета означают, что вы принимаете эти условия. Если вы не согласны с условиями лицензии, не используйте пакет.

Сценарий PowerShell загружает и устанавливает управляющую программу безопасности Azure IoT Edge. Управляющая программа безопасности запускает первый из двух модулей среды выполнения, агент IoT Edge, который обеспечивает удаленные развертывания других модулей. 

При установке среды выполнения IoT Edge в первый раз на устройстве нужно подготовить устройство с помощью удостоверения из центра Интернета вещей. Одно устройство IoT Edge можно подготовить к работе вручную, используя строку подключения устройства, предоставленную Центром Интернета вещей. Вы также можете использовать службу подготовки устройств, что удобно, если нужно автоматически подготовить несколько устройств. В зависимости от выбранного способа подготовки выберите соответствующий скрипт установки. 

Следующие разделы описывают распространенные варианты использования и параметров для скрипта установки IoT Edge на новое устройство. 

### <a name="option-1-install-and-manually-provision"></a>Вариант 1. Установка и подготовка вручную

В первом варианте необходимо предоставить строку подключения устройства, созданную Центром Интернета вещей, чтобы подготовить устройство. 

Выполните действия, описанные в статье [Регистрация нового устройства Azure IoT Edge на портале Azure](how-to-register-device-portal.md), чтобы зарегистрировать устройство и получить для него строку подключения. 

Этот пример показывает установку вручную с контейнерами Windows.

```powershell
. {Invoke-WebRequest -useb aka.ms/iotedge-win} | Invoke-Expression; `
Install-SecurityDaemon -Manual -ContainerOs Windows -DeviceConnectionString '<connection-string>'
```

Когда вы устанавливаете и подготавливаете устройство вручную, можно использовать дополнительные параметры для изменения установки, том числе сделать следующее.
* Направить трафик через прокси-сервер.
* Указать установщику автономный каталог.
* Объявить определенный образ контейнера агента и указать учетные данные, если он находится в частном реестре.
* Пропустить установку Moby CLI.

Дополнительные сведения об этих параметрах установки вы найдете далее в этой статье. Вы можете пропустить этот раздел и ознакомиться со [всеми параметрами установки](#all-installation-parameters).

### <a name="option-2-install-and-automatically-provision"></a>Вариант 2. Установка и автоматическая подготовка

Во втором варианте подготовка устройства выполняется с помощью службы подготовки устройств к добавлению в Центр Интернета вещей. Укажите **идентификатор области** из экземпляра службы подготовки устройств и **идентификатор регистрации** с вашего устройства.

Выполните действия, описанные в статье [Создание и подготовка имитированного устройства IoT Edge TPM в Windows](how-to-auto-provision-simulated-device-windows.md), чтобы установить Службу подготовки устройств и получить для нее **идентификатор области**. После этого сымитируйте устройство доверенного платформенного модуля (TPM) и получите для него **идентификатор регистрации**, а затем создайте отдельную регистрацию. Зарегистрировав устройство в Центре Интернета вещей, продолжите установку.  

   >[!TIP]
   >Не закрывайте окно с запущенным симулятором TPM во время установки и тестирования. 

В следующем примере показана автоматическая установка с контейнерами Windows.

```powershell
. {Invoke-WebRequest -useb aka.ms/iotedge-win} | Invoke-Expression; `
Install-SecurityDaemon -Dps -ContainerOs Windows -ScopeId <DPS scope ID> -RegistrationId <device registration ID>
```

Когда вы устанавливаете и подготавливаете устройство вручную, можно использовать дополнительные параметры для изменения установки, том числе сделать следующее.
* Направить трафик через прокси-сервер.
* Указать установщику автономный каталог.
* Объявить определенный образ контейнера агента и указать учетные данные, если он находится в частном реестре.
* Пропустить установку Moby CLI.

Дополнительные сведения об этих параметрах установки вы найдете далее в этой статье. Вы можете пропустить этот раздел и ознакомиться со [всеми параметрами установки](#all-installation-parameters).

## <a name="update-an-existing-installation"></a>Обновление существующей установки

Если вы уже установили среду выполнения IoT Edge на устройство перед его подготовкой с помощью удостоверения из Центра Интернета вещей, можно использовать упрощенный скрипт установки. Флаг `-ExistingConfig` объявляет, что файл конфигурации IoT Edge уже существует на устройстве. Файл конфигурации содержит сведения об удостоверении устройства, а также о сертификатах и параметрах сети. Этот параметр установки можно использовать при исходной подготовке устройства вручную или автоматически. 

Дополнительные сведения см. в разделе [Обновление управляющей программы безопасности и среды выполнения IoT Edge](how-to-update-iot-edge.md).

В этом примере показана установка, которая указывает на существующий файл конфигурации и использует контейнеры Windows. 

```powershell
. {Invoke-WebRequest -useb aka.ms/iotedge-win} | Invoke-Expression; `
Install-SecurityDaemon -ExistingConfig -ContainerOs Windows
```

Когда вы устанавливаете IoT Edge из существующего файла конфигурации, можно использовать дополнительные параметры для изменения установки, том числе сделать следующее.
* Направить трафик через прокси-сервер.
* Указать установщику автономный каталог. 
* Пропустить установку Moby CLI. 

Нельзя объявлять образ контейнера агента Azure IoT Edge с параметрами скрипта, так как эта информация уже задана в файле конфигурации из предыдущей установки. Если вы хотите изменить образ контейнера агента, сделайте это в файле config.yaml. 

Дополнительные сведения об этих параметрах установки вы найдете далее в этой статье. Вы можете пропустить этот раздел и ознакомиться со [всеми параметрами установки](#all-installation-parameters).

## <a name="offline-installation"></a>Автономная установка

Во время установки загружаются четыре файла: 
* ZIP-файл управляющей программы безопасности IoT Edge (iotedgd); 
* ZIP-файл подсистемы Moby;
* ZIP-файл Moby CLI;
* MSI-файл распространяемого пакета Visual C++ (среда выполнения VC).

Можно загрузить один из них или все эти файлы на устройство заранее, а затем указать для скрипта установки каталог, содержащий эти файлы. Установщик сначала проверяет каталог и затем загружает только компоненты, которые не были найдены. Если все четыре файла доступны автономно, можно выполнить установку без подключения к Интернету. Эта функция может использоваться для переопределения онлайн-версий одного компонента или нескольких.  

Сведения о последних и предыдущих версиях файлов установки см. в разделе [Выпуски Azure IoT Edge](https://github.com/Azure/azure-iotedge/releases)

Чтобы выполнить установку с компонентами в автономном режиме, используйте параметр `-OfflineInstallationPath` и укажите абсолютный путь к каталогу файлов. Например,

```powershell
. {Invoke-WebRequest -useb aka.ms/iotedge-win} | Invoke-Expression; `
Install-SecurityDaemon -Manual -DeviceConnectionString '<connection-string>' -OfflineInstallationPath C:\Downloads\iotedgeoffline
```

## <a name="all-installation-parameters"></a>Все параметры установки

В предыдущих разделах представлены общие сценарии установки с примерами того, как использовать параметры для изменения скрипта установки. В этом разделе приведена ссылочная таблица с правильными параметрами, которые можно использовать для установки IoT Edge. Чтобы узнать больше, выполните `get-help Install-SecurityDaemon -full` в окне PowerShell. 

Чтобы установить IoT Edge с существующей конфигурацией, команда установки может использовать следующие общие параметры. 

| Параметр | Допустимые значения | Комментарии |
| --------- | --------------- | -------- |
| **Вручную** | Нет | **Параметр-переключатель**. Каждая установка должна объявляться вручную с помощью службы подготовки устройств или с существующей конфигурацией.<br><br>Объявляет, что вы предоставите строку подключения устройства для подготовки устройства вручную. |
| **Dps** | Нет | **Параметр-переключатель**. Каждая установка должна объявляться вручную с помощью службы подготовки устройств или с существующей конфигурацией.<br><br>Объявляет, что вы предоставите идентификатор области службы подготовки устройств (DPS) и идентификатор регистрации устройства для подготовки через DPS.  |
| **ExistingConfig** | Нет | **Параметр-переключатель**. Каждая установка должна объявляться вручную с помощью службы подготовки устройств или с существующей конфигурацией.<br><br>Объявляет, что файл config.yaml уже существует на устройстве со сведениями о подготовке. |
| **DeviceConnectionString** | Строка подключения из устройства IoT Edge, зарегистрированного в Центре Интернета вещей, в одинарных кавычках. | **Необходима** для установки вручную. Если не указать строку подключения в параметрах скрипта, она будет запрошена во время установки. |
| **ScopeId** | Идентификатор области из экземпляра службы подготовки устройств, связанного с Центром Интернета вещей. | **Необходим** для установки через службу подготовки устройств. Если не указать идентификатор области в параметрах скрипта, он будет запрошен во время установки. |
| **RegistrationId** | Идентификатор регистрации, созданный вашим устройством. | **Необходим** для установки через службу подготовки устройств. Если не указать идентификатор регистрации в параметрах скрипта, он будет запрошен во время установки. |
| **ContainerOs** | **Windows** или **Linux**. | Если ОС контейнера не указана, значением по умолчанию будет Linux. Для контейнеров Windows подсистема контейнеров будет включена в установку. Для контейнеров Linux необходимо установить подсистему контейнеров перед началом установки. Запуск контейнеров Linux на Windows является полезным сценарием разработки, но не поддерживается в рабочей среде. |
| **Proxy** | URL-адрес прокси-сервера. | Включите этот параметр, если ваше устройство подключается к Интернету через прокси-сервер. Дополнительные сведения см. в статье [Настройка устройства IoT Edge для обмена данными через прокси-сервер](how-to-configure-proxy-support.md). |
| **InvokeWebRequestParameters** | Хэш-таблица параметров и значений. | Во время установки выполняется несколько веб-запросов. Используйте это поле, чтобы задать параметры для этих веб-запросов. Этот параметр нужен, чтобы настроить учетные данные для прокси-серверов. Дополнительные сведения см. в статье [Настройка устройства IoT Edge для обмена данными через прокси-сервер](how-to-configure-proxy-support.md). |
| **OfflineInstallationPath** | Путь к каталогу. | Если этот параметр включен, установщик будет искать в каталоге ZIP-файлы iotedged, подсистемы Moby, Moby CLI и MSI-файл среды выполнения VC, необходимые для установки. Если все четыре файла есть в каталоге, можно установить IoT Edge в автономном режиме. Этот параметр также может использоваться для переопределения онлайн-версии определенного компонента. |
| **AgentImage** | URI образа агента IoT Edge. | По умолчанию новая установка IoT Edge использует последний тег для образа агента IoT Edge. Используйте этот параметр, чтобы задать определенный тег для версии образа, или предоставьте свой образ агента. Дополнительные сведения см. в статье [Основные сведения о тегах IoT Edge](how-to-update-iot-edge.md#understand-iot-edge-tags). |
| **Имя пользователя** | Имя пользователя реестра контейнеров | Используйте этот параметр только в том случае, если вы задаете значение параметра -AgentImage для контейнера в частном реестре. Укажите имя пользователя с доступом к реестру. |
| **Пароль** | Строка надежного пароля. | Используйте этот параметр только в том случае, если вы задаете значение параметра -AgentImage для контейнера в частном реестре. Укажите пароль для доступа к реестру. | 
| **SkipMobyCli** | Нет | Применимо только в случае, если в качестве -ContainerOS указано Windows. Не устанавливайте Moby CLI (docker.exe) в $MobyInstallDirectory. |

## <a name="verify-successful-installation"></a>Проверка установки

Чтобы проверить состояние службы IoT Edge, используйте следующий код. 

```powershell
Get-Service iotedge
```

Чтобы просмотреть журналы службы за последние пять минут, используйте следующий код.

```powershell

# Displays logs from last 5 min, newest at the bottom.

Get-WinEvent -ea SilentlyContinue `
  -FilterHashtable @{ProviderName= "iotedged";
    LogName = "application"; StartTime = [datetime]::Now.AddMinutes(-5)} |
  select TimeCreated, Message |
  sort-object @{Expression="TimeCreated";Descending=$false} |
  format-table -autosize -wrap
```

Чтобы получить список запущенных модулей, используйте следующий код.

```powershell
iotedge list
```

После установки, единственный модуль, вы увидите выполнение **edgeAgent**. После того как вы [развертывания модулей IoT Edge](how-to-deploy-modules-portal.md), вы увидите другим пользователям. 

## <a name="manage-module-containers"></a>Управление контейнерами модуля

Для службы IoT Edge требуется механизм контейнера, запущенного на устройстве. При развертывании модуля на устройстве, среда выполнения IoT Edge использует обработчик контейнера для получите образ контейнера из реестра в облаке. Служба IoT Edge позволяет взаимодействовать с модули и получении журналов, но иногда может потребоваться использовать обработчик контейнеров для взаимодействия с самого контейнера. 

Дополнительные сведения об основных понятиях модуля см. в разделе [модулей Azure IoT Edge, понять](iot-edge-modules.md). 

Если вы используете контейнеры Windows на вашем устройстве IoT Edge для Windows, обработчик контейнеров Кита включались установки Edge Интернета вещей. Если вы разрабатываете контейнеры Linux на компьютере разработки Windows, возможно, использовании Docker Desktop. Модуль Кита был основан на те же стандарты Docker и должен выполняться параллельно на одном компьютере с рабочего стола Docker. Если вы хотите целевого контейнеров, управляемых подсистемой Кита, по этой причине необходимо предназначены специально этому модулю вместо Docker. 

Например чтобы получить список всех образов Docker, используйте следующую команду:

```powershell
docker images
```

Чтобы получить список всех образов Кита, измените ту же команду с использованием указателя на обработчик Кита: 

```powershell
docker -H npipe:////./pipe/iotedge_moby_engine images
```

Ядро URI указан в выходных данных сценария установки, или для config.yaml файла его можно найти в разделе "Параметры среды выполнения контейнера". 

![moby_runtime uri in config.yaml](./media/how-to-install-iot-edge-windows/moby-runtime-uri.png)

Дополнительные сведения о командах, можно использовать для взаимодействия с контейнеры и образы, установленной на устройстве, см. в разделе [интерфейсы командной строки Docker](https://docs.docker.com/engine/reference/commandline/docker/).

## <a name="uninstall-iot-edge"></a>Удаление IoT Edge

Если вы хотите удалить установку IoT Edge с устройства Windows, используйте следующую команду в окне администратора PowerShell. Эта команда удаляет среду выполнения IoT Edge вместе с существующей конфигурацией и данными подсистемы Moby. 

```powershell
. {Invoke-WebRequest -useb aka.ms/iotedge-win} | Invoke-Expression; `
Uninstall-SecurityDaemon -DeleteConfig -DeleteMobyDataRoot
```

Если вы планируете переустановить IoT Edge на устройстве, пропустите параметры `-DeleteConfig` и `-DeleteMobyDataRoot`, чтобы можно было повторно установить управляющую программу безопасности позже с существующей конфигурацией. 

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда подготовлено устройство IoT Edge и установлена среда выполнения, вы можете [развернуть модули IoT Edge](how-to-deploy-modules-portal.md).

Если вам не удается установить IoT Edge, перейдите на страницу со сведениями об [устранении неполадок](troubleshoot.md).

Чтобы обновить существующую установку до последней версии IoT Edge, см. раздел [Обновление управляющей программы безопасности и среды выполнения IoT Edge](how-to-update-iot-edge.md).
