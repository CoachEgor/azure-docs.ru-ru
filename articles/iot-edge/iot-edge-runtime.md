---
title: Сведения об управлении устройствами в среде выполнения — Azure IoT Edge | Документация Майкрософт
description: Сведения об управлении модулями, безопасностью, обменом данных и отчетностью на устройствах в среде выполнения Azure IoT Edge
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 06/06/2019
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.custom: seodec18
ms.openlocfilehash: 423825540c02d2788de7a6148ddcec3c654fd450
ms.sourcegitcommit: 45e4466eac6cfd6a30da9facd8fe6afba64f6f50
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/07/2019
ms.locfileid: "66754788"
---
# <a name="understand-the-azure-iot-edge-runtime-and-its-architecture"></a>Общие сведения о среде выполнения Azure IoT Edge и ее архитектуре

Среда выполнения IoT Edge — это совокупность программ, превратить устройства в устройстве IoT Edge. В совокупности компоненты среды выполнения IoT Edge позволяют устройствам IoT Edge получать код для запуска на границе и пересылки результатов. 

Среда выполнения IoT Edge выполняет следующие функции на пограничных устройствах IoT Edge:

* Установка и обновление рабочих нагрузок на устройстве.
* Техническое обслуживание стандартов безопасности Azure IoT Edge на устройстве.
* Убедитесь, что [модули Edge Интернета вещей](iot-edge-modules.md) всегда выполняются.
* Передача данных о состоянии работоспособности модуля в облако для удаленного мониторинга.
* Упрощения взаимодействия между подчиненными конечными устройствами и устройствами IoT Edge.
* Упрощают взаимодействие между модулями на устройстве IoT Edge.
* Упрощают взаимодействие между устройством IoT Edge и облаком.

![Среда выполнения передает аналитические сведения и информацию о работоспособности модуля в Центр Интернета вещей](./media/iot-edge-runtime/Pipeline.png)

Обязанности среды выполнения IoT Edge делятся на две категории: обмен данными и управление модулями. Эти две роли выполняются двумя компонентами, которые являются частью среды выполнения IoT Edge. *Концентратор IoT Edge* отвечает за обмен данными, пока *агент IoT Edge* развертывает и контролирует модули. 

Агент IoT Edge и центр IoT Edge — это модули, и они, как и любые другие модули, выполняются на устройстве IoT Edge. 

## <a name="iot-edge-hub"></a>Концентратор IoT Edge

Центр IoT Edge — это один из двух модулей, составляющих среду выполнения Azure IoT Edge. Он действует в качестве локального прокси-сервера для Центра Интернета вещей, предоставляя те же конечные точки протокола, что и Центр Интернета вещей. Эта согласованность означает, что клиенты (устройства или модули) могут подключаться к среде выполнения IoT Edge так же, как к Центру Интернета вещей. 

>[!NOTE]
> Концентратор IoT Edge поддерживает клиенты, которые подключаются по протоколу MQTT или AMQP. Он не поддерживает клиенты, использующие HTTP. 

Центр IoT Edge не является полной версией выполняемого локально Центра Интернета вещей. Есть некоторые вещи, которые центр IoT Edge автоматически делегирует Центру Интернета вещей. Например, центр IoT Edge переадресовывает запросы на проверку подлинности в Центр Интернета вещей при первом подключении устройства. После установки первого подключения сведения о безопасности будут кэшированы локально центром IoT Edge. Последующие подключения от этого устройства не проходят проверку подлинности в облаке. 

Чтобы сократить пропускную способность, используемую решением IoT Edge, центр IoT Edge оптимизирует количество фактических подключений к облаку. Центр IoT Edge принимает логические подключения от клиентов, например модулей или конечных устройств, и объединяет их для одного физического подключения к облаку. Сведения об этом процессе прозрачны для остальной части решения. Клиенты думают, что имеют собственное подключение к облаку, несмотря на то что передача данных выполняется через одно подключение. 

![Центр IoT Edge — это шлюз между физическими устройствами и Центром Интернета вещей](./media/iot-edge-runtime/Gateway.png)

Центр IoT Edge может определить, подключен ли он к Центру Интернета вещей. Если подключение потеряно, центр IoT Edge сохранит сообщения или операции обновления двойников локально. Когда подключение будет снова установлено, он выполнит синхронизацию всех данных. Расположение, используемое для этого временного кэша, определяется свойством двойника модуля в центре IoT Edge. Размер кэша не ограничен и будет увеличиваться, пока у устройства есть емкость хранилища. Дополнительные сведения см. в разделе [возможностей автономной работы](offline-capabilities.md).

### <a name="module-communication"></a>Обмен данными между модулями

Центр IoT Edge облегчает обмен данными между модулями. Благодаря использованию центра IoT Edge в качестве брокера сообщений модули независимы друг от друга. Модулям необходимо указывать только те входы, на которые они принимают сообщения, и выходы, на которые они записывают сообщения. Разработчик решений скомпоновать эти входные и выходные данные, чтобы модули обрабатывали данные в порядке, определенном для этого решения. 

![Центр IoT Edge облегчает обмен данными между модулями](./media/iot-edge-runtime/module-endpoints.png)

Для отправки данных в центр IoT Edge модуль вызывает метод SendEventAsync. Первый аргумент указывает, в какой выход нужно отправить сообщение. Следующий псевдокод отправляет сообщение **output1**:

   ```csharp
   ModuleClient client = new ModuleClient.CreateFromEnvironmentAsync(transportSettings); 
   await client.OpenAsync(); 
   await client.SendEventAsync(“output1”, message); 
   ```

Для получения сообщений зарегистрируйте обратный вызов, который обрабатывает сообщения, приходящие в определенный вход. Следующий псевдокод регистрирует функцию messageProcessor для обработки всех сообщений, полученных на **input1**:

   ```csharp
   await client.SetInputMessageHandlerAsync(“input1”, messageProcessor, userContext);
   ```

Дополнительные сведения о классе ModuleClient и его методах обмена данными см. в справочнике по API для предпочитаемого языка пакета SDK: [C#](https://docs.microsoft.com/dotnet/api/microsoft.azure.devices.client.moduleclient?view=azure-dotnet), [C и Python](https://docs.microsoft.com/azure/iot-hub/iot-c-sdk-ref/iothub-module-client-h), [Java](https://docs.microsoft.com/java/api/com.microsoft.azure.sdk.iot.device.moduleclient?view=azure-java-stable) или [Node.js](https://docs.microsoft.com/javascript/api/azure-iot-device/moduleclient?view=azure-node-latest).

Разработчик решений отвечает за указание правил, определяющих, как центр IoT Edge передает сообщения между модулями. Правила маршрутизации определяются в облаке и помещаются в центр IoT Edge в его двойник устройства. Тот же синтаксис для маршрутов Центра Интернета вещей используется при определении маршрутов между модулями в Azure IoT Edge. Дополнительные сведения см. в разделе [сведения о развертывании модулей и устанавливать маршруты в IoT Edge](module-composition.md).   

![Маршруты между модулями проходят через центр IoT Edge](./media/iot-edge-runtime/module-endpoints-with-routes.png)

## <a name="iot-edge-agent"></a>Агент IoT Edge

Агент IoT Edge — это другой модуль, который составляет среду выполнения Azure IoT Edge. Он отвечает за создание экземпляров модулей, обеспечивая их работу и сообщение о состоянии модулей обратно в Центр Интернета вещей. Так же как и любой другой модуль, агент IoT Edge использует его двойник модуля для хранения данных конфигурации. 

[Управляющая программа безопасности IoT Edge](iot-edge-security-manager.md) запускает агент IoT Edge при запуске устройства. Агент получает свой двойник модуля из Центра Интернета вещей и проверяет манифест развертывания. Манифест развертывания — это файл JSON, который объявляет необходимые для запуска модули. 

Каждый элемент манифеста развертывания содержит определенные сведения о модуле и используется агентом IoT Edge для управления жизненным циклом модуля. Ниже приведены некоторые из наиболее интересных свойств: 

* **settings.image**. Образ контейнера, который агент IoT Edge использует для запуска модуля. Агент IoT Edge должен быть настроен с учетными данными для реестра контейнеров, если образ защищен паролем. Учетные данные для реестра контейнеров можно настроить удаленно с помощью манифеста развертывания или на самом устройстве IoT Edge, обновив файл `config.yaml` в папке программы IoT Edge.
* **settings.createOptions** – строку, которая передается непосредственно в управляющую программу Кита контейнера, при запуске контейнера модуля. Добавление параметров в это свойство позволяет для расширенных конфигураций, таких как перенаправление портов или подключение томов в контейнере модуля.  
* **status**. Состояние, в котором агент IoT Edge помещает модуль. Как правило, это значение присваивается *под управлением* как большинство пользователей стремится использовать агент IoT Edge для немедленного запуска всех модулей на устройстве. Однако можно указать начальное состояние модуля, который должен быть остановлен, и дождаться нужного времени, чтобы сообщить агенту IoT Edge о запуске модуля. Агент IoT Edge сообщает состояние каждого модуля обратно в облако в сообщаемых свойствах. Различие между требуемым свойством и сообщаемым свойством является индикатором некорректно работающего устройства. Ниже перечислены поддерживаемые состояния:
   * Downloading;
   * Выполнение
   * Unhealthy;
   * Сбой
   * Остановлено
* **restartPolicy**. То, как агент IoT Edge перезапускает модуль. Ниже перечислены возможные значения.
   * `never` Агент IoT Edge никогда не перезапускает модуль.
   * `on-failure` -В случае сбоя модуля, агент IoT Edge перезапускает его. Если модуль завершается без сбоев, агент IoT Edge не перезапускает его.
   * `on-unhealthy` — Если модуль аварийно завершает работу или имеет состояние считается неработоспособным, агент IoT Edge перезапускает его.
   * `always` — Если модуль аварийно завершает работу, будет считаться неработоспособной или завершает работу каким-либо образом, агент IoT Edge перезапускает его. 

Агент IoT Edge отправляет ответ среды выполнения в центр Интернета вещей. Ниже перечислены возможные ответы:
  * 200 – OK
  * 400 — конфигурация развертывания имеет неправильный формат или недопустима.
  * 417 — у устройства нет заданной конфигурации развертывания.
  * 412 — версия схемы в конфигурации развертывания недопустима.
  * 406 — устройство IoT Edge работает в автономном режиме или не отправляет отчеты о состоянии.
  * 500 — в среде выполнения IoT Edge произошла ошибка.

Дополнительные сведения см. в разделе [сведения о развертывании модулей и устанавливать маршруты в IoT Edge](module-composition.md).   

### <a name="security"></a>Безопасность

Агент IoT Edge играет важную роль в обеспечении безопасности устройства IoT Edge. Например, он выполняет такие действия, как проверка образа модуля перед запуском. 

Дополнительные сведения о платформа безопасности Azure IoT Edge, узнайте о [диспетчер безопасности IoT Edge](iot-edge-security-manager.md).

## <a name="next-steps"></a>Дальнейшие действия

[Общие сведения о модулях IoT Edge Azure](iot-edge-modules.md)
