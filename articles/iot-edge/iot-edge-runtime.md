---
title: Сведения об управлении устройствами в среде выполнения — Azure IoT Edge | Документация Майкрософт
description: Узнайте, как время выполнения IoT Edge управляет модулями, безопасностью, связью и отчетностью на устройствах
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 11/01/2019
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: c184972789c412406f264f725f8b94e1f7f162ce
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79284906"
---
# <a name="understand-the-azure-iot-edge-runtime-and-its-architecture"></a>Общие сведения о среде выполнения Azure IoT Edge и ее архитектуре

Среда выполнения IoT Edge — это набор программ, превращающих устройство в устройство IoT Edge. В совокупности компоненты времени выполнения IoT Edge позволяют устройствам IoT Edge получать код для работы на краю и сообщать результаты.

Время выполнения IoT Edge отвечает за следующие функции на устройствах IoT Edge:

* Установка и обновление рабочих нагрузок на устройстве.
* Техническое обслуживание стандартов безопасности Azure IoT Edge на устройстве.
* Убедитесь, что [модули IoT Edge](iot-edge-modules.md) работают всегда.
* Передача данных о состоянии работоспособности модуля в облако для удаленного мониторинга.
* Управление связью между устройствами ниже по течению и устройствами IoT Edge.
* Управление связью между модулями на устройстве IoT Edge.
* Управление связью между устройством IoT Edge и облаком.

![Среда выполнения передает аналитические сведения и информацию о работоспособности модуля в Центр Интернета вещей](./media/iot-edge-runtime/Pipeline.png)

Обязанности среды выполнения IoT Edge делятся на две категории: обмен данными и управление модулями. Эти две роли выполняются двумя компонентами, которые являются частью времени выполнения IoT Edge.*Концентратор IoT Edge* отвечает за связь, в то время как *агент IoT Edge* развертывает и контролирует модули.

Агент IoT Edge и центр IoT Edge — это модули, и они, как и любые другие модули, выполняются на устройстве IoT Edge. Иногда их называют *модулями времени выполнения.*

## <a name="iot-edge-hub"></a>Концентратор IoT Edge

Центр IoT Edge — это один из двух модулей, составляющих среду выполнения Azure IoT Edge. Он действует в качестве локального прокси-сервера для Центра Интернета вещей, предоставляя те же конечные точки протокола, что и Центр Интернета вещей. Эта согласованность означает, что клиенты (устройства или модули) могут подключаться к среде выполнения IoT Edge так же, как к Центру Интернета вещей.

>[!NOTE]
> Концентратор IoT Edge поддерживает клиентов, которые подключаются с помощью МЗТТ или АМЗП. Он не поддерживает клиенты, использующие HTTP.

Концентратор IoT Edge не является полной версией концентратора IoT, работая локально. Концентратор IoT Edge молча делегирует некоторые задачи Концентратору IoT. Например, центр IoT Edge переадресовывает запросы на проверку подлинности в Центр Интернета вещей при первом подключении устройства. После установки первого подключения сведения о безопасности будут кэшированы локально центром IoT Edge. Будущие соединения с этого устройства разрешены без необходимости снова аутентифицировать сявок в облако.

Чтобы уменьшить пропускную способность, которую использует решение IoT Edge, концентратор IoT Edge оптимизирует количество фактических подключений к облаку. Концентратор IoT Edge принимает логические соединения из модулей или устройств вниз по течению и объединяет их для одного физического подключения к облаку. Сведения об этом процессе прозрачны для остальной части решения. Клиенты думают, что имеют собственное подключение к облаку, несмотря на то что передача данных выполняется через одно подключение.

![Центр IoT Edge — это шлюз между физическими устройствами и Центром Интернета вещей](./media/iot-edge-runtime/Gateway.png)

Центр IoT Edge может определить, подключен ли он к Центру Интернета вещей. Если подключение потеряно, центр IoT Edge сохранит сообщения или операции обновления двойников локально. Когда подключение будет снова установлено, он выполнит синхронизацию всех данных. Расположение, используемое для этого временного кэша, определяется свойством двойника модуля в центре IoT Edge. Размер кэша не ограничен и будет увеличиваться, пока у устройства есть емкость хранилища.Для получения дополнительной [Offline capabilities](offline-capabilities.md)информации см.

### <a name="module-communication"></a>Обмен данными между модулями

Центр IoT Edge облегчает обмен данными между модулями. Благодаря использованию центра IoT Edge в качестве брокера сообщений модули независимы друг от друга. Модулям необходимо указывать только те входы, на которые они принимают сообщения, и выходы, на которые они записывают сообщения. Разработчик решения может сшить эти входные данные и выходы вместе, чтобы модули обрабатывали данные в специальном порядке для этого решения.

![Центр IoT Edge облегчает обмен данными между модулями](./media/iot-edge-runtime/module-endpoints.png)

Для отправки данных в центр IoT Edge модуль вызывает метод SendEventAsync. Первый аргумент указывает, в какой выход нужно отправить сообщение. Следующий псевдокод отправляет сообщение на **output1**:

   ```csharp
   ModuleClient client = await ModuleClient.CreateFromEnvironmentAsync(transportSettings);
   await client.OpenAsync();
   await client.SendEventAsync("output1", message);
   ```

Для получения сообщений зарегистрируйте обратный вызов, который обрабатывает сообщения, приходящие в определенный вход. Следующий псевдокод регистрирует функцию messageProcessor, который будет использоваться для обработки всех сообщений, полученных при **входе1:**

   ```csharp
   await client.SetInputMessageHandlerAsync("input1", messageProcessor, userContext);
   ```

Для получения более подробной информации о классе ModuleClient и его методах коммуникации см. [Python](https://docs.microsoft.com/python/api/azure-iot-device/azure.iot.device.iothubmoduleclient?view=azure-python) [C#](https://docs.microsoft.com/dotnet/api/microsoft.azure.devices.client.moduleclient?view=azure-dotnet) [C](https://docs.microsoft.com/azure/iot-hub/iot-c-sdk-ref/iothub-module-client-h) [Java](https://docs.microsoft.com/java/api/com.microsoft.azure.sdk.iot.device.moduleclient?view=azure-java-stable) [Node.js](https://docs.microsoft.com/javascript/api/azure-iot-device/moduleclient?view=azure-node-latest)

Разработчик решений отвечает за указание правил, определяющих, как центр IoT Edge передает сообщения между модулями. Правила реутрибуции определяются в облаке и сдвинуты к концентратору IoT Edge в его двойнике модуля. Тот же синтаксис для маршрутов Центра Интернета вещей используется при определении маршрутов между модулями в Azure IoT Edge. Для получения дополнительной информации [см.](module-composition.md)

![Маршруты между модулями проходят через центр IoT Edge](./media/iot-edge-runtime/module-endpoints-with-routes.png)

## <a name="iot-edge-agent"></a>Агент IoT Edge

Агент IoT Edge — это другой модуль, который составляет среду выполнения Azure IoT Edge. Он отвечает за создание экземпляров модулей, обеспечивая их работу и сообщение о состоянии модулей обратно в Центр Интернета вещей. Данные о конфигурации написаны как свойство двойника агента агента IoT Edge.

[Управляющая программа безопасности IoT Edge](iot-edge-security-manager.md) запускает агент IoT Edge при запуске устройства. Агент получает свой двойник модуля из Центра Интернета вещей и проверяет манифест развертывания. Манифест развертывания — это файл JSON, который объявляет необходимые для запуска модули.

Каждый элемент манифеста развертывания содержит определенные сведения о модуле и используется агентом IoT Edge для управления жизненным циклом модуля. Ниже приведены некоторые из наиболее интересных свойств:

* **settings.image**. Образ контейнера, который агент IoT Edge использует для запуска модуля. Агент IoT Edge должен быть настроен с учетными данными для реестра контейнеров, если образ защищен паролем. Учетные данные для реестра контейнеров можно настроить удаленно с помощью манифеста развертывания или на самом устройстве IoT Edge, обновив файл `config.yaml` в папке программы IoT Edge.
* **settings.createOptions** - строка, которая передается непосредственно в контейнер Moby daemon при запуске контейнера модуля. Добавление опций в этом свойстве позволяет для продвинутых конфигураций, таких как переадресация порта или монтаж объемов в контейнер модуля.  
* **status**. Состояние, в котором агент IoT Edge помещает модуль. Обычно это значение устанавливается для *запуска,* так как большинство людей хотят, чтобы агент IoT Edge немедленно запускал все модули на устройстве. Однако можно указать начальное состояние модуля, который должен быть остановлен, и дождаться нужного времени, чтобы сообщить агенту IoT Edge о запуске модуля.Агент IoT Edge сообщает состояние каждого модуля обратно в облако в сообщаемых свойствах. Различие между требуемым свойством и сообщаемым свойством является индикатором некорректно работающего устройства. Ниже перечислены поддерживаемые состояния:

  * Downloading;
  * Запущен
  * Unhealthy;
  * Ошибка
  * Остановлена

* **restartPolicy**. То, как агент IoT Edge перезапускает модуль. Ниже перечислены возможные значения.
  
  * `never`— Агент IoT Edge никогда не перезапускает модуль.
  * `on-failure`- Если модуль выходит из строя, агент IoT Edge перезапускает его. Если модуль выключается чисто, агент IoT Edge не перезагорит.
  * `on-unhealthy`- Если модуль выходит из строя или считается нездоровым, агент IoT Edge перезапускает его.
  * `always`- Если модуль выходит из строя, считается нездоровым или каким-либо образом выключается, агент IoT Edge перезапускает его.

* **imagePullPolicy** - Пытается ли агент IoT Edge автоматически или нет вытащить последнее изображение для модуля. Если вы не укажете значение, значение по умолчанию находится *на..* Ниже перечислены возможные значения.

  * `on-create`- При запуске модуля или обновлении модуля на основе нового манифеста развертывания агент IoT Edge попытается вытащить изображение модуля из реестра контейнеров.
  * `never`- Агент IoT Edge никогда не попытается вытащить изображение модуля из реестра контейнеров. С этой конфигурацией вы несете ответственность за получение изображения модуля на устройство и управление любыми обновлениями изображений.

Агент IoT Edge отправляет ответ среды выполнения в центр Интернета вещей. Ниже перечислены возможные ответы:
  
* 200 – OK
* 400 — конфигурация развертывания имеет неправильный формат или недопустима.
* 417 - Устройство не имеет набора конфигурации развертывания.
* 412 — версия схемы в конфигурации развертывания недопустима.
* 406 — устройство IoT Edge работает в автономном режиме или не отправляет отчеты о состоянии.
* 500 — в среде выполнения IoT Edge произошла ошибка.

Для получения дополнительной информации [см.](module-composition.md)

### <a name="security"></a>Безопасность

Агент IoT Edge играет важную роль в обеспечении безопасности устройства IoT Edge. Например, он выполняет такие действия, как проверка образа модуля перед запуском.

Подробнее о системе безопасности Azure IoT Edge читайте в материале «Менеджер безопасности IoT Edge — это [средство безопасности IoT Edge».](iot-edge-security-manager.md)

## <a name="next-steps"></a>Дальнейшие действия

[Общие сведения о модулях IoT Edge Azure](iot-edge-modules.md)
