---
title: Руководство по обучению и развертыванию моделей Машинного обучения в Azure IoT Edge
description: Работая с этим учебником, вы обучите модель машинного обучения с помощью Службы машинного обучения Azure, а затем упакуете модель в виде образа контейнера, который можно развернуть как модуль Azure IoT Edge.
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 3/24/2020
ms.topic: tutorial
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: cfb778a1a632dc17a9f50c7ea05debed0edb4fb6
ms.sourcegitcommit: d18a59b2efff67934650f6ad3a2e1fe9f8269f21
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "88660253"
---
# <a name="tutorial-train-and-deploy-an-azure-machine-learning-model"></a>Руководство по Обучение и развертывание модели машинного обучения Azure

> [!NOTE]
> Эта статья входит в серию учебников по использованию Машинного обучения Azure в IoT Edge. Если вы перешли к этой статье по прямой ссылке, для оптимальных результатов рекомендуем начать с изучения [первой статьи](tutorial-machine-learning-edge-01-intro.md) этой серии.

В этой статье описаны следующие задачи:

* использование Записных книжек Azure для обучения модели машинного обучения;
* упаковка обученной модели в образ контейнера;
* развертывание образа контейнера в качестве модуля Azure IoT Edge.

В Записных книжках Azure используется рабочая область машинного обучения Azure, которая является основой для выполнения экспериментов, обучения и развертывания моделей машинного обучения.

Описанные в этой статье действия обычно выполняются специалистами по обработке и анализу данных.

## <a name="set-up-azure-notebooks"></a>Настройка Записных книжек Azure

Мы используем службу "Записные книжки Azure" для размещения двух записных книжек Jupyter и вспомогательных файлов. В этой статье мы создаем и настраиваем проект Записных книжек Azure. Если вы впервые используете записные книжки Jupyter и (или) Azure, ознакомьтесь с приведенными ниже документами:

* **Краткое руководство.** [Создание и совместное использование записной книжки](../notebooks/quickstart-create-share-jupyter-notebook.md)
* **Руководство.** [Создание и запуск записной книжки Jupyter с помощью Python](../notebooks/tutorial-create-run-jupyter-notebook.md)

Использование записных книжек Azure обеспечивает согласованную среду для выполнения упражнения.

> [!NOTE]
> После настройки вы сможете получить доступ к службе "Записные книжки Microsoft Azure" с любого компьютера. Во время установки используйте виртуальную машину разработки, которая содержит все необходимые файлы.

### <a name="create-an-azure-notebooks-account"></a>Создание учетной записи службы "Записные книжки Azure"

Чтобы использовать Записные книжки Azure, необходимо создать учетную запись. Учетные записи службы "Записные книжки Azure" не зависят от подписок Azure.

1. Перейдите к службе [Записные книжки Azure](https://notebooks.azure.com).

1. Щелкните **Войти** в правом верхнем углу страницы.

1. Войдите в систему, используя свою рабочую или учебную учетную запись (Azure Active Directory) или личную учетную запись (учетную запись Майкрософт).

1. Если вы ранее не использовали службу "Записные книжки Azure", отобразится запрос на предоставление доступа к приложению службы "Записные книжки Azure".

1. Создайте идентификатор пользователя для приложения Записных книжек Azure.

### <a name="upload-jupyter-notebook-files"></a>Отправка файлов записных книжек Jupyter

Сейчас мы отправим примеры файлов записных книжек в новый проект Записных книжек Azure.

1. На странице пользователя новой учетной записи в строке меню вверху выберите **Мои проекты**.

1. Добавьте новый проект, нажав кнопку **+** .

1. В диалоговом окне **Создание нового проекта** укажите **имя проекта**. 

1. Не устанавливайте флажки **Public** (Общедоступный) и **Файл сведений**, так как нет необходимости делать этот проект общедоступным и загружать в него файл сведений.

1. Нажмите кнопку **создания**.

1. Щелкните **Upload** (Отправить) (стрелка вверх) и выберите **С компьютера**.

1. Щелкните **Выбрать файлы**.

1. Перейдите в папку **C:\source\IoTEdgeAndMlSample\AzureNotebooks**. Выберите все файлы в списке и щелкните **Открыть**.

1. Установите флажок **I trust the content of these files** (Я доверяю содержимому этих файлов).

1. Выберите **Отправить**, чтобы начать передачу, а затем щелкните **Готово** после завершения процесса.

### <a name="azure-notebook-files"></a>Файлы Записных книжек Azure

Давайте проверим файлы, отправленные в проект Записных книжек Azure. Действия в этой части руководства касаются двух файлов записных книжек, с которыми используется несколько вспомогательных файлов.

* **01-turbofan\_regression.ipynb.** В этой записной книжке для создания и запуска эксперимента машинного обучения используется рабочая область машинного обучения. В целом записная книжка выполняет такие действия:

  1. Скачивает данные из учетной записи хранения Azure, созданной с помощью окружения устройства.
  1. Анализирует и подготавливает данные, а затем обучает на их основе модель классификатора.
  1. Оценивает модель из эксперимента с помощью тестового набора данных (Test\_FD003.txt).
  1. Публикует лучшую модель классификатора в рабочей области машинного обучения.

* **02-turbofan\_deploy\_model.ipynb.** Эта записная книжка принимает модель, созданную в предыдущей книжке, и использует ее для создания образа контейнера, готового для развертывания на устройстве Azure IoT Edge. Записная книжка выполняет следующие действия:

  1. Создает скрипт для оценки модели.
  1. Создает образ контейнера, используя модель классификатора, сохраненную в рабочей области машинного обучения.
  1. Развертывает образ в качестве веб-службы в экземпляре контейнера Azure.
  1. С помощью веб-службы проверяет, правильно ли работают модель и образ. Проверенный образ будет развернут на устройстве IoT Edge, как описано в статье [Tutorial: Create and deploy custom IoT Edge modules](tutorial-machine-learning-edge-06-custom-modules.md) (Руководство. Создание и развертывание настраиваемых модулей IoT Edge).

* **Test\_FD003.txt.** Файл, содержащий данные, которые мы будем использовать в качестве тестового набора при проверке обученного классификатора. Для простоты мы решили использовать в качестве тестового набора тестовые данные, предоставленные для исходной проверки.

* **RUL\_FD003.txt.** Файл, содержащий оставшийся срок полезного использования (RUL) для последнего цикла каждого устройства в файле Test\_FD003.txt. Подробное описание данных см. в файлах readme.txt и Damage Propagation Modeling.pdf в папке C:\\source\\IoTEdgeAndMlSample\\data\\Turbofan.

* **Utils.py.** Файл, содержащий набор функций Python для работы с данными. Первая записная книжка содержит подробное описание функций.

* **README.md.** Файл сведений, содержащий описание использования записных книжек.  

## <a name="run-azure-notebooks"></a>Запуск Записных книжек Azure

Теперь, когда проект создан, можно запустить записные книжки. 

1. На странице проекта выберите **01-turbofan\_regression.ipynb**.

    ![Выбор первой записной книжки для запуска](media/tutorial-machine-learning-edge-04-train-model/select-turbofan-regression-notebook.png)

1. Если для записной книжки указано значение **Not Trusted** (Нет доверия), щелкните виджет **Not Trusted** (Нет доверия) в правом верхнем углу записной книжки. Когда появится диалоговое окно, выберите **Доверие**.

1. Для получения лучших результатов прочитайте документацию по каждой ячейке и запустите каждую отдельно. Выберите **Запустить** на панели инструментов. Позже вы сочтете целесообразным запустить несколько ячеек. Предупреждения об обновлении и устаревании можно игнорировать.

    Для выполняющейся ячейки отображается звездочка в квадратных скобках ([\*]). По завершении выполнения ячейки звездочка заменяется на число и могут отобразиться соответствующие выходные данные. Ячейки в записной книжке создаются последовательно и могут выполняться только по очереди.

    Можно также использовать команды выполнения из меню **Ячейка**, клавиши `Ctrl` + `Enter` для выполнения ячейки и `Shift` + `Enter` для выполнения ячейки и перехода к следующей ячейке.

    > [!TIP]
    > Для согласованного выполнения операций с ячейками не следует запускать одну и ту же записную книжку из нескольких вкладок в браузере.

1. В ячейке, которая следует инструкциям **Set global properties** (Настройка глобальных свойств), запишите значения для вашей подписки, настроек и ресурсов Azure. Затем запустите ячейку.

    ![Раздел Set global properties (Настройка глобальных свойств) в записной книжке](media/tutorial-machine-learning-edge-04-train-model/set-global-properties.png)

1. В ячейке, предшествующей **сведениям о рабочей области** после того, как она запущена, найдите ссылку, которая инструктирует вас войти в систему для аутентификации:

    ![Запрос на вход для проверки подлинности устройства](media/tutorial-machine-learning-edge-04-train-model/sign-in-prompt.png)

    Откройте ссылку и введите указанный код. Эта процедура входа проверяет подлинность записной книжки Jupyter для доступа к ресурсам Azure с помощью кроссплатформенного интерфейса командной строки Microsoft Azure.  

    ![Подтверждение проверки подлинности приложения на устройстве](media/tutorial-machine-learning-edge-04-train-model/cross-platform-cli.png)

1. В ячейке, предшествующей **Explore the results** (Изучить результаты), скопируйте значение из идентификатора выполнения и вставьте его для идентификатора выполнения в ячейку, следующую после **Reconstitute a run** (Воссоздать выполнение).

   ![Копирование идентификатора запуска между ячейками](media/tutorial-machine-learning-edge-04-train-model/automl-id.png)

1. Выполните оставшиеся ячейки в записной книжке.

1. Сохраните записную книжку и вернитесь на страницу проекта.

1. Откройте **02-turbofan\_deploy\_model.ipynb** и запустите каждую ячейку. Для проверки подлинности в ячейке, следующей после **Настроить рабочую область** необходимо выполнить вход.

1. Сохраните записную книжку и вернитесь на страницу проекта.

### <a name="verify-success"></a>Проверка успешного выполнения

Чтобы убедиться, что выполнение записных книжек успешно завершено, проверьте, созданы ли определенные элементы.

1. На странице проекта записных книжек Azure выберите **Показать скрытые элементы**, чтобы отобразить имена элементов, начинающиеся с точки.

1. Проверьте, созданы ли такие файлы:

    | Файл | Описание |
    | --- | --- |
    | ./aml_config/.azureml/config.json | Файл конфигурации, с помощью которого создается рабочая область машинного обучения Azure. |
    | ./aml_config/model_config.json | Файл конфигурации, который потребуется для развертывания модели в рабочей области машинного обучения **turbofanDemo** в Azure. |
    | myenv.yml| Содержит сведения о зависимостях развернутой модели машинного обучения.|

1. Убедитесь, что созданы следующие ресурсы Azure. К некоторым именам ресурсов добавляются случайные символы.

    | Ресурс Azure | Имя |
    | --- | --- |
    | Рабочая область машинного обучения | turborfanDemo |
    | Реестр контейнеров | turbofandemoxxxxxxxx |
    | Applications Insights | turbofaninsightxxxxxxxx |
    | Key Vault | turbofankeyvaultbxxxxxxxx |
    | Память | turbofanstoragexxxxxxxxx |

### <a name="debugging"></a>Отладка

В записную книжку для отладки можно вставить инструкции Python, например команду `print()` для отображения значений. Если отображаются переменные или объекты, которые не определены, выполните ячейки, в которых они были впервые объявлены или созданы.

Если вам нужно будет перезапустить записные книжки, вам может понадобится удалить ранее созданные файлы и ресурсы Azure.

## <a name="next-steps"></a>Дальнейшие действия

В рамках этой статьи мы использовали две записные книжки Jupyter, работающие в службе "Записные книжки Azure", для обучения классификатора оставшегося срока полезного использования (RUL) с помощью данных с турбореактивных устройств, чтобы сохранить классификатор в качестве модели, создать образ контейнера, а также развернуть и протестировать образ в качестве веб-службы.

Переходите к следующей статье, где вы создадите устройство IoT Edge.

> [!div class="nextstepaction"]
> [Tutorial: Configure an IoT Edge device](tutorial-machine-learning-edge-05-configure-edge-device.md) (Руководство. Настройка устройства IoT Edge)
