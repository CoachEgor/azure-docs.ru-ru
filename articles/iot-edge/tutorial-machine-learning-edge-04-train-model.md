---
title: Руководство. обучению и развертыванию моделей Машинного обучения в Azure IoT Edge
description: Работая с этим учебником, вы обучите модель машинного обучения с помощью Службы машинного обучения Azure, а затем упакуете модель в виде образа контейнера, который можно развернуть как модуль Azure IoT Edge.
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 2/10/2020
ms.topic: tutorial
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: 5f576d28d30907f3834600d0a6a5c152025cf912
ms.sourcegitcommit: f718b98dfe37fc6599d3a2de3d70c168e29d5156
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/11/2020
ms.locfileid: "77133522"
---
# <a name="tutorial-train-and-deploy-an-azure-machine-learning-model"></a>Руководство. Обучение и развертывание модели машинного обучения Azure

> [!NOTE]
> Эта статья входит в серию учебников по использованию Машинного обучения Azure в IoT Edge. Если вы перешли к этой статье по прямой ссылке, для оптимальных результатов рекомендуем начать с изучения [первой статьи](tutorial-machine-learning-edge-01-intro.md) этой серии.

В этой статье описаны следующие задачи:

* использование Записных книжек Azure для обучения модели машинного обучения;
* упаковка обученной модели в образ контейнера;
* развертывание образа контейнера в качестве модуля Azure IoT Edge.

В Записных книжках Azure используется рабочая область машинного обучения Azure, которая является основой для выполнения экспериментов, обучения и развертывания моделей машинного обучения.

Описанные в этой статье действия обычно выполняются специалистами по обработке и анализу данных.

## <a name="set-up-azure-notebooks"></a>Настройка Записных книжек Azure

Мы используем службу "Записные книжки Azure" для размещения двух записных книжек Jupyter и вспомогательных файлов. В этой статье мы создаем и настраиваем проект Записных книжек Azure. Если вы впервые используете записные книжки Jupyter и (или) Azure, ознакомьтесь с приведенными ниже документами:

* **Краткое руководство.** [Создание и совместное использование записной книжки](../notebooks/quickstart-create-share-jupyter-notebook.md)
* **Руководство.** [Создание и запуск записной книжки Jupyter с помощью Python](../notebooks/tutorial-create-run-jupyter-notebook.md)

Использование записных книжек Azure обеспечивает согласованную среду для выполнения упражнения.

> [!NOTE]
> После настройки вы сможете получить доступ к службе "Записные книжки Microsoft Azure" с любого компьютера. Во время установки используйте виртуальную машину разработки, которая содержит все необходимые файлы.

### <a name="create-an-azure-notebooks-account"></a>Создание учетной записи службы "Записные книжки Azure"

Чтобы использовать Записные книжки Azure, необходимо создать учетную запись. Учетные записи службы "Записные книжки Azure" не зависят от подписок Azure.

1. Перейдите к службе [Записные книжки Azure](https://notebooks.azure.com).

1. Щелкните **Войти** в правом верхнем углу страницы.

1. Войдите в систему, используя свою рабочую или учебную учетную запись (Azure Active Directory) или личную учетную запись (учетную запись Майкрософт).

1. Если вы ранее не использовали службу "Записные книжки Azure", отобразится запрос на предоставление доступа к приложению службы "Записные книжки Azure".

1. Создайте идентификатор пользователя для приложения Записных книжек Azure.

### <a name="upload-jupyter-notebook-files"></a>Отправка файлов записных книжек Jupyter

Сейчас мы отправим примеры файлов записных книжек в новый проект Записных книжек Azure.

1. На странице пользователя новой учетной записи в строке меню вверху выберите **Мои проекты**.

1. В диалоговом окне **Создание проекта** укажите **имя проекта**. При этом также автоматически сформируется **идентификатор проекта**.

1. Не устанавливайте флажки **Public** (Общедоступный) и **Файл сведений**, так как нет необходимости делать этот проект общедоступным и загружать в него файл сведений.

1. Нажмите кнопку **создания**.

1. Щелкните **Upload** (Отправить) (стрелка вверх) и выберите **С компьютера**.

1. Щелкните **Выбрать файлы**.

1. Перейдите в папку **C:\source\IoTEdgeAndMlSample\AzureNotebooks**. Выберите все файлы в списке и щелкните **Открыть**.

1. Выберите **Отправить**, чтобы начать передачу, а затем щелкните **Готово** после завершения процесса.

### <a name="azure-notebook-files"></a>Файлы записных книжек Azure

Давайте проверим файлы, отправленные в проект Записных книжек Azure. Действия в этой части руководства касаются двух файлов записных книжек, с которыми используется несколько вспомогательных файлов.

* **01-turbofan\_regression.ipynb.** В этой записной книжке для создания и запуска эксперимента машинного обучения используется рабочая область машинного обучения. В целом записная книжка выполняет такие действия:

  1. Скачивает данные из учетной записи хранения Azure, созданной с помощью окружения устройства.
  1. Анализирует и подготавливает данные для обучения и для модели классификатора.
  1. Оценивает модель из эксперимента с помощью тестового набора данных (Test\_FD003.txt).
  1. Публикует лучшую модель классификатора в рабочей области машинного обучения.

* **02-turbofan\_deploy\_model.ipynb.** Эта записная книжка принимает модель, созданную в предыдущей книжке, и использует ее для создания образа контейнера, готового для развертывания на устройстве Azure IoT Edge. Записная книжка выполняет следующие действия:

  1. Создает скрипт для оценки модели.
  1. Создает образ контейнера, используя модель классификатора, сохраненную в рабочей области машинного обучения.
  1. Развертывает образ в качестве веб-службы в экземпляре контейнера Azure.
  1. С помощью веб-службы проверяет, правильно ли работают модель и образ. Проверенный образ будет развернут на устройстве IoT Edge, как описано в статье [Tutorial: Create and deploy custom IoT Edge modules](tutorial-machine-learning-edge-06-custom-modules.md) (Руководство. Создание и развертывание настраиваемых модулей IoT Edge).

* **Test\_FD003.txt.** Файл, содержащий данные, которые мы будем использовать в качестве тестового набора при проверке обученного классификатора. Для простоты мы решили использовать в качестве тестового набора тестовые данные, предоставленные для исходной проверки.

* **RUL\_FD003.txt.** Файл, содержащий RUL для последнего цикла каждого устройства в файле Test\_FD003.txt. Подробное описание данных см. в файлах readme.txt и Damage Propagation Modeling.pdf в папке C:\\source\\IoTEdgeAndMlSample\\data\\Turbofan.

* **Utils.py.** Файл, содержащий набор функций Python для работы с данными. Первая записная книжка содержит подробное описание функций.

* **README.md.** Файл сведений, содержащий описание использования записных книжек.  

## <a name="run-azure-notebooks"></a>Запуск Записных книжек Azure

Теперь, когда проект создан, можно запустить записные книжки. 

1. На странице проекта выберите **01-turbofan\_regression.ipynb**.

    ![Выбор первой записной книжки для запуска](media/tutorial-machine-learning-edge-04-train-model/select-turbofan-regression-notebook.png)

1. При появлении запроса выберите из диалогового окна ядро ​​Python 3.6 и щелкните **Set Kernel​** (Настроить ядро).

1. Если для записной книжки указано значение **Not Trusted** (Нет доверия), щелкните виджет **Not Trusted** (Нет доверия) в правом верхнем углу записной книжки. Когда появится диалоговое окно, выберите **Доверие**.

1. В записной книжке прокрутите вниз до ячейки, которая следует за инструкциями **Set global properties** (Настройка глобальных свойств) и начинается с кода `AZURE_SUBSCRIPTION_ID =`, и укажите значения для подписки, параметров и ресурсов Azure.

    ![Раздел Set global properties (Настройка глобальных свойств) в записной книжке](media/tutorial-machine-learning-edge-04-train-model/set-global-properties.png)

1. Выполните эту ячейку, щелкнув **Run** (Выполнить) на панели инструментов.

    Для выполняющейся ячейки отображается звездочка в квадратных скобках ([\*]). По завершении выполнения ячейки звездочка заменяется на число и могут отобразиться соответствующие выходные данные. Ячейки в записной книжке создаются последовательно и могут выполняться только по очереди.

    Следуйте указаниям в записной книжке. Можно также использовать команды выполнения из меню **Ячейка**, клавиши `Ctrl` + `Enter` для выполнения ячейки и `Shift` + `Enter` для выполнения ячейки и перехода к следующей ячейке.

    > [!TIP]
    > Для согласованного выполнения операций с ячейками не следует запускать одну и ту же записную книжку из нескольких вкладок в браузере.

1. Прокрутите вниз до ячейки сразу за обзорным текстом **Create a workspace** (Создание рабочей области) и выполните эту ячейку. В выходных данных ячейки найдите ссылку для входа с проверкой подлинности. 

    ![Запрос на вход для проверки подлинности устройства](media/tutorial-machine-learning-edge-04-train-model/sign-in-prompt.png)

    Откройте ссылку и введите указанный код. Эта процедура входа проверяет подлинность записной книжки Jupyter для доступа к ресурсам Azure с помощью кроссплатформенного интерфейса командной строки Microsoft Azure.  

    ![Подтверждение проверки подлинности приложения на устройстве](media/tutorial-machine-learning-edge-04-train-model/cross-platform-cli.png)

1. Теперь можно выполнить остальные ячейки. Лучше всего запустить выполнение всех ячеек, чтобы код в них выполнялся по очереди. Выберите **Запустить все** в меню **Ячейка**. Снова прокрутите до верха записной книжки вверх и просмотрите сведения о завершении операций с ячейками.

    В подразделе **Sensor readings and RUL** (Показания датчиков и оставшийся срок полезного использования) раздела **Просмотр данных** можно просмотреть ячейки, в которых показания датчиков отображаются на точечных диаграммах.

    ![Точечные диаграммы с показаниями датчиков](media/tutorial-machine-learning-edge-04-train-model/sensor-readings.png)

1. Сохраните записную книжку и вернитесь на страницу проекта: щелкните имя проекта в правом верхнем углу записной книжки или вернитесь в браузер.

1. Откройте файл **02-turbofan\_deploy\_model.ipynb** и повторите шаги из этой процедуры, чтобы запустить вторую записную книжку.

1. Сохраните записную книжку и вернитесь на страницу проекта: щелкните имя проекта в правом верхнем углу записной книжки или вернитесь в браузер.

### <a name="verify-success"></a>Проверка успешного выполнения

Чтобы убедиться, что выполнение записных книжек успешно завершено, проверьте, созданы ли определенные элементы.

1. На странице проекта записных книжек Azure выберите **Показать скрытые элементы**, чтобы отобразить имена элементов, начинающиеся с точки.

1. Проверьте, созданы ли такие файлы:

    | Файл | Описание |
    | --- | --- |
    | ./aml_config/.azureml/config.json | Файл конфигурации, с помощью которого создается рабочая область машинного обучения Azure. |
    | ./aml_config/model_config.json | Файл конфигурации, который потребуется для развертывания модели в рабочей области машинного обучения **turbofanDemo** в Azure. |
    | myenv.yml| Содержит сведения о зависимостях развернутой модели машинного обучения.|

1. С помощью портала Azure убедитесь в наличии рабочей области машинного обучения **turboFanDemo** в вашей группе ресурсов.

### <a name="debugging"></a>Отладка

В записную книжку можно вставить инструкции Python для отладки (в первую очередь это касается команды `print()`). Если отображаются переменные или объекты, которые не определены, выполните ячейки, в которых они были впервые объявлены или созданы.

## <a name="next-steps"></a>Дальнейшие действия

В рамках этой статьи мы использовали две записные книжки Jupyter, работающие в службе "Записные книжки Azure", для обучения классификатора оставшегося срока полезного использования (RUL) с помощью данных с турбореактивных устройств, чтобы сохранить классификатор в качестве модели, создать образ контейнера, а также развернуть и протестировать образ в качестве веб-службы.

Переходите к следующей статье, где вы создадите устройство IoT Edge.

> [!div class="nextstepaction"]
> [Tutorial: Configure an IoT Edge device](tutorial-machine-learning-edge-05-configure-edge-device.md) (Руководство. Настройка устройства IoT Edge)
