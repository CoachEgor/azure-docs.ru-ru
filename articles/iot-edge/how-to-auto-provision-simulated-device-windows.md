---
title: Автоматическая подготовка устройств Windows с помощью DPS — Azure IoT Edge | Документация Майкрософт
description: Использование имитированного устройства на компьютере Windows для тестирования автоматической подготовки устройств для Azure IoT Edge с помощью Службы подготовки устройств к добавлению в Центр Интернета вещей
author: kgremban
manager: philmea
ms.author: v-yiso
origin.date: 01/09/2019
ms.date: 03/25/2019
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.custom: seodec18
ms.openlocfilehash: aa5e5fba3758fa3983924660b9b5f714d02613c6
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61247561"
---
# <a name="create-and-provision-a-simulated-tpm-edge-device-on-windows"></a>Создание и подготовка имитированного устройства IoT Edge TPM в Windows

Устройства Azure IoT Edge можно подготовить автоматически с помощью [Службы подготовки устройств к добавлению в Центр Интернета вещей](../iot-dps/index.yml) точно так же, как и другие устройства. При необходимости ознакомьтесь с [процессом автоматической подготовки](../iot-dps/concepts-auto-provisioning.md), прежде чем продолжить.

В этой статье показано, как протестировать функцию автоматической подготовки на имитированном устройстве IoT Edge, с помощью следующих действий:

* Создание экземпляра Службы подготовки устройств к добавлению в Центр Интернета вещей.
* Создание имитированного устройства на компьютере Windows с имитированным доверенным платформенным модулем (TPM) для обеспечения безопасности оборудования.
* Создание отдельной регистрации устройства.
* Установка среды выполнения IoT Edge и подключение устройства к Центру Интернета вещей.

## <a name="prerequisites"></a>Технические условия

* Компьютер для разработки Windows. В этой статье используется Windows 10.
* Действующий Центр Интернета вещей.

## <a name="set-up-the-iot-hub-device-provisioning-service"></a>Настройка Службы подготовки устройств к добавлению в Центр Интернета вещей

Создайте экземпляр Службы подготовки устройств к добавлению в Центр Интернета вещей в Azure и свяжите его со своим Центром Интернета вещей. Следуйте инструкциям по [настройке Службы подготовки устройств к добавлению в Центр Интернета вещей на портале Azure](../iot-dps/quick-setup-auto-provision.md).

После запуска Службы подготовки устройств к добавлению в Центр Интернета вещей скопируйте значение **Область идентификатора** на странице обзора. Это значение используется при настройке среды выполнения IoT Edge.

## <a name="simulate-a-tpm-device"></a>Имитация устройства TPM

Создайте имитированное устройства доверенного платформенного модуля на компьютере Windows для разработки. Получите **идентификатор регистрации** и **ключ подтверждения** для устройства и используйте их для создания записи индивидуальной регистрации в Службе подготовки устройств к добавлению в Центр Интернета вещей.

При регистрации в Службе подготовки устройств к добавлению в Центр Интернета вещей есть возможность объявить **Первоначальное состояние двойника устройства**. В двойнике устройства можно задать теги для группировки устройств по любой требуемой для решения метрике, например по региону, среде, расположению или типу устройства. Эти теги используются для создания [автоматических развертываний](how-to-deploy-monitor.md).

Выберите язык пакета SDK для создания имитации устройства, а затем создайте отдельную регистрацию.

При создании индивидуальной регистрации выберите **Включить**, чтобы объявить, что имитированное устройство доверенного платформенного модуля на компьютере разработки Windows является **устройством IoT Edge**.

Руководства по использованию виртуальных устройств и отдельной регистрации:

* [C](../iot-dps/quick-create-simulated-device.md)
* [Java](../iot-dps/quick-create-simulated-device-tpm-java.md)
* [C#](../iot-dps/quick-create-simulated-device-tpm-csharp.md)
* [Node.js](../iot-dps/quick-create-simulated-device-tpm-node.md)
* [Python](../iot-dps/quick-create-simulated-device-tpm-python.md)

Создав отдельную регистрацию, сохраните значение **идентификатора регистрации**. Это значение используется при настройке среды выполнения IoT Edge.

## <a name="install-the-iot-edge-runtime"></a>Установка среды выполнения IoT Edge

Когда вы выполните инструкции из предыдущего раздела, ваше новое устройство появится в списке устройств IoT Edge в Центре Интернета вещей. На этом этапе нужно установить среду выполнения IoT Edge на устройстве.

Среда выполнения IoT Edge развертывается на всех устройствах IoT Edge. Ее компоненты выполняются в контейнерах и позволяют развертывать дополнительные контейнеры на устройстве, чтобы обеспечить возможность выполнения кода в граничной системе.  

Следуйте инструкциям по установке среды выполнения IoT Edge на устройстве, на котором выполняется имитированный доверенный платформенный модуль, из предыдущего раздела. Среда выполнения IoT Edge должна быть настроена на автоматическую подготовку, а не подготовку вручную.

Узнайте **область идентификатора** службы подготовки устройств и **идентификатор регистрации** устройства, прежде чем установить IoT Edge на устройстве.

[Установка и автоматическая подготовка IoT Edge](how-to-install-iot-edge-windows.md#option-2-install-and-automatically-provision)

## <a name="verify-successful-installation"></a>Проверка установки

Если среда выполнения запущена успешно, можете перейти в Центр Интернета вещей и начать развертывание модулей IoT Edge на устройстве. Чтобы убедиться, что среда выполнения установлена и запущена успешно, используйте следующие команды на устройстве:  

Проверьте состояние службы IoT Edge.

```powershell
Get-Service iotedge
```

Просмотрите журналы службы за последние пять минут.

```powershell
# Displays logs from last 5 min, newest at the bottom.

Get-WinEvent -ea SilentlyContinue `
  -FilterHashtable @{ProviderName= "iotedged";
    LogName = "application"; StartTime = [datetime]::Now.AddMinutes(-5)} |
  select TimeCreated, Message |
  sort-object @{Expression="TimeCreated";Descending=$false} |
  format-table -autosize -wrap
```

Просмотрите список запущенных модулей.

```powershell
iotedge list
```

## <a name="next-steps"></a>Дальнейшие действия

Процесс регистрации Службы подготовки устройств к добавлению в Центр Интернета вещей позволяет задать идентификатор устройства и теги двойников устройств параллельно с подготовкой нового устройства. Эти значения можно использовать для указания отдельных устройств или групп устройств с помощью автоматического управления устройствами. См. дополнительные сведения о развертывании и мониторинге модулей IoT Edge с поддержкой масштабирования с помощью [портала Azure](how-to-deploy-monitor.md) или [Azure CLI](how-to-deploy-monitor-cli.md).
