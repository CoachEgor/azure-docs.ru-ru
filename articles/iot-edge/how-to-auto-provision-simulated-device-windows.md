---
title: Автоматическое предоставление устройств Windows с DPS - Azure IoT Edge Документы Майкрософт
description: Использование имитированного устройства на компьютере Windows для тестирования автоматической подготовки устройств для Azure IoT Edge с помощью Службы подготовки устройств к добавлению в Центр Интернета вещей
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 4/3/2020
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: fc051e2a0ebbdae7c62ff8a249747d118d3c2ce4
ms.sourcegitcommit: 67addb783644bafce5713e3ed10b7599a1d5c151
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/05/2020
ms.locfileid: "80668690"
---
# <a name="create-and-provision-a-simulated-iot-edge-device-with-a-virtual-tpm-on-windows"></a>Создание и предоставление смоделированного устройства IoT Edge с виртуальным TPM на Windows

Устройства Azure IoT Edge можно подготовить автоматически с помощью [Службы подготовки устройств к добавлению в Центр Интернета вещей](../iot-dps/index.yml) точно так же, как и другие устройства. При необходимости ознакомьтесь с [процессом автоматической подготовки](../iot-dps/concepts-auto-provisioning.md), прежде чем продолжить.

DPS поддерживает симметричное подтверждение ключей для устройств IoT Edge как в индивидуальной регистрации, так и в групповой регистрации. Для регистрации группы, если вы проверяете опцию «ioT Edge» на верное значение в симметричном удостоверении ключа, все устройства, зарегистрированные в этой группе регистрации, будут помечены как устройства IoT Edge.

В этой статье показано, как тестировать автоматическое обеспечение на смоделированном устройстве IoT Edge со следующими шагами:

* Создание экземпляра Службы подготовки устройств к добавлению в Центр Интернета вещей.
* Создание имитированного устройства на компьютере Windows с имитированным доверенным платформенным модулем (TPM) для обеспечения безопасности оборудования.
* Создание отдельной регистрации устройства.
* Установка среды выполнения IoT Edge и подключение устройства к Центру Интернета вещей.

> [!TIP]
> В этой статье описывается тестирование автоматического обеспечения с помощью TPM-аттестации на виртуальных устройствах, но большая его часть применяется при использовании физического оборудования TPM.

## <a name="prerequisites"></a>Предварительные требования

* Компьютер для разработки Windows. В этой статье используется Windows 10.
* Действующий Центр Интернета вещей.

> [!NOTE]
> TPM 2.0 требуется при использовании TPM-аттестации с Помощью DPS и может использоваться только для создания индивидуальных, а не групповых регистраций.

## <a name="set-up-the-iot-hub-device-provisioning-service"></a>Настройка Службы подготовки устройств к добавлению в Центр Интернета вещей

Создайте экземпляр Службы подготовки устройств к добавлению в Центр Интернета вещей в Azure и свяжите его со своим Центром Интернета вещей. Следуйте инструкциям по [настройке Службы подготовки устройств к добавлению в Центр Интернета вещей на портале Azure](../iot-dps/quick-setup-auto-provision.md).

После запуска Службы подготовки устройств к добавлению в Центр Интернета вещей скопируйте значение **Область идентификатора** на странице обзора. Это значение используется при настройке среды выполнения IoT Edge.

> [!TIP]
> Если вы используете физическое устройство TPM, вам необходимо определить **ключ одобрения,** который является уникальным для каждого чипа TPM и получен от производителя чипов TPM, связанного с ним. Вы можете получить уникальный **идентификатор регистрации** для вашего устройства TPM, например, создав хэш SHA-256 ключа одобрения.
>
> Следуйте инструкциям в статье [Как управлять регистрацией устройств с azure Portal,](../iot-dps/how-to-manage-enrollments.md) чтобы создать регистрацию в DPS, а затем продолжить установку раздела [времени выполнения IoT Edge](#install-the-iot-edge-runtime) в этой статье.

## <a name="simulate-a-tpm-device"></a>Имитация устройства TPM

Создайте имитированное устройства доверенного платформенного модуля на компьютере Windows для разработки. Извиспользуйте **идентификатор регистрации** и **ключ одобрения** для вашего устройства и используйте их для создания индивидуальной записи в DPS.

При регистрации в Службе подготовки устройств к добавлению в Центр Интернета вещей есть возможность объявить **Первоначальное состояние двойника устройства**. В двойнике устройства можно задать теги для группировки устройств по любой требуемой для решения метрике, например по региону, среде, расположению или типу устройства. Эти теги используются для создания [автоматических развертываний](how-to-deploy-monitor.md).

Выберите язык пакета SDK для создания имитации устройства, а затем создайте отдельную регистрацию.

При создании индивидуальной регистрации выберите **True,** чтобы объявить, что смоделированное устройство TPM на вашем компьютере разработки Windows является **устройством IoT Edge.**

> [!TIP]
> В Azure CLI можно создать [группу регистрации](https://docs.microsoft.com/cli/azure/ext/azure-iot/iot/dps/enrollment) или [регистрации](https://docs.microsoft.com/cli/azure/ext/azure-iot/iot/dps/enrollment-group) и использовать флаг **с поддержкой края,** чтобы указать, что устройство или группа устройств — это устройство IoT Edge.

Руководства по использованию виртуальных устройств и отдельной регистрации:

* [C](../iot-dps/quick-create-simulated-device.md)
* [Java](../iot-dps/quick-create-simulated-device-tpm-java.md)
* [C#](../iot-dps/quick-create-simulated-device-tpm-csharp.md)
* [Node.js](../iot-dps/quick-create-simulated-device-tpm-node.md)
* [Python](../iot-dps/quick-create-simulated-device-tpm-python.md)

Создав отдельную регистрацию, сохраните значение **идентификатора регистрации**. Это значение используется при настройке среды выполнения IoT Edge.

## <a name="install-the-iot-edge-runtime"></a>Установка среды выполнения IoT Edge

Среда выполнения IoT Edge развертывается на всех устройствах IoT Edge. Ее компоненты выполняются в контейнерах и позволяют развертывать дополнительные контейнеры на устройстве, чтобы обеспечить возможность выполнения кода в граничной системе.

При подготовке устройства вам понадобится следующая информация:

* Значение **dPS ID Scope**
* **Идентификатор регистрации** устройства, созданный

Установите время выполнения IoT Edge на устройстве, которое работает с имитацией TPM. Вы наверстируете время выполнения IoT Edge для автоматической, а не ручной подготовки.

> [!TIP]
> Не закрывайте окно с запущенным симулятором TPM во время установки и тестирования.

Для получения более подробной информации об установке IoT Edge на Windows, включая предпосылки и инструкции для таких задач, как управление контейнерами и обновление IoT Edge, [см.](how-to-install-iot-edge-windows.md)

1. Откройте окно PowerShell с правами администратора. Не забудьте использовать amD64 сессии PowerShell при установке IoT Edge, а не PowerShell (x86).

1. Команда **Deploy-IoTEdge** проверяет, что ваша машина Windows находится на поддерживаемой версии, включает функцию контейнеров, а затем загружает время выполнения moby и время выполнения IoT Edge. Команда по умолчанию использует контейнеры Windows.

   ```powershell
   . {Invoke-WebRequest -useb https://aka.ms/iotedge-win} | Invoke-Expression; `
   Deploy-IoTEdge
   ```

1. На этом этапе устройства IoT Core могут перезапускаться автоматически. Другие устройства Windows 10 или Windows Server могут побудить вас к перезагрузке. Если да, то перезапустите устройство сейчас. Как только устройство будет готово, снова запустите PowerShell в качестве администратора.

1. Команда **Initialize-IoTEdge** настраивает среду выполнения IoT Edge на вашем компьютере. По умолчанию при выполнении команды применяется подготовка вручную с помощью контейнеров Windows. Используйте `-Dps` флаг, чтобы использовать службу обеспечения устройств вместо ручного обеспечения.

   Замените значения заполнителя и `{scope_id}` `{registration_id}` данные, собранные ранее.

   ```powershell
   . {Invoke-WebRequest -useb https://aka.ms/iotedge-win} | Invoke-Expression; `
   Initialize-IoTEdge -Dps -ScopeId {scope ID} -RegistrationId {registration ID}
   ```

## <a name="verify-successful-installation"></a>Проверка установки

Если среда выполнения запущена успешно, можете перейти в Центр Интернета вещей и начать развертывание модулей IoT Edge на устройстве. Чтобы убедиться, что среда выполнения установлена и запущена успешно, используйте следующие команды на устройстве:  

Проверьте состояние службы IoT Edge.

```powershell
Get-Service iotedge
```

Просмотрите журналы службы за последние пять минут.

```powershell
. {Invoke-WebRequest -useb aka.ms/iotedge-win} | Invoke-Expression; Get-IoTEdgeLog
```

Просмотрите список запущенных модулей.

```powershell
iotedge list
```

## <a name="next-steps"></a>Следующие шаги

Процесс регистрации Службы подготовки устройств к добавлению в Центр Интернета вещей позволяет задать идентификатор устройства и теги двойников устройств параллельно с подготовкой нового устройства. Эти значения можно использовать для указания отдельных устройств или групп устройств с помощью автоматического управления устройствами. См. дополнительные сведения о развертывании и мониторинге модулей IoT Edge с поддержкой масштабирования с помощью [портала Azure](how-to-deploy-monitor.md) или [Azure CLI](how-to-deploy-monitor-cli.md).
