---
title: Краткое руководство по созданию устройства Azure IoT Edge на платформе Linux | Документация Майкрософт
description: Из этого краткого руководства вы узнаете, как создать устройство IoT Edge и удаленно развернуть готовый код с помощью портала Azure.
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 07/09/2019
ms.topic: quickstart
ms.service: iot-edge
services: iot-edge
ms.custom: mvc, seodec18
ms.openlocfilehash: 70d0f5b28f769617b16b2ae8c71bc5b3e90d5dfe
ms.sourcegitcommit: b3bad696c2b776d018d9f06b6e27bffaa3c0d9c3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2019
ms.locfileid: "69877257"
---
# <a name="quickstart-deploy-your-first-iot-edge-module-to-a-virtual-linux-device"></a>Краткое руководство. Развертывание модуля IoT Edge на виртуальном устройстве Linux

Проверьте работу Azure IoT Edge, как описано в этом кратком руководстве, развернув контейнерный код на виртуальном устройстве IoT Edge. IoT Edge позволяет удаленно управлять кодом на устройствах, чтобы вы могли передавать больше рабочих нагрузок на пограничные устройства. При работе с этим кратким руководством мы рекомендуем использовать виртуальную машину Azure для устройства IoT Edge. Так вы сможете быстро создать виртуальную машину для тестирования со всеми установленными компонентами, а затем удалить ее по завершении работы. 

Из этого краткого руководства вы узнаете, как выполнять следующие задачи:

1. Создайте Центр Интернета вещей.
2. Регистрация устройства IoT Edge в Центре Интернета вещей.
3. установка и запуск среды выполнения IoT Edge на виртуальном устройстве;
4. Удаленное развертывание модуля на устройстве IoT Edge.

![Схема рассматриваемой в этом кратком руководстве архитектуры для устройства и облака](./media/quickstart-linux/install-edge-full.png)

В этом кратком руководстве описано, как создать виртуальную машину Azure, выступающую в роли устройства IoT Edge. Вы можете развернуть модуль на портале Azure для устройства. Модуль, который вы развернете в рамках этого краткого руководства, представляет собой имитированный датчик, генерирующий данные температуры, влажности и давления. В других руководствах по Azure IoT Edge используются наработки из этой статьи: развернутые модули, которые анализируют смоделированные данные для бизнес-аналитики.

Если у вас нет активной подписки Azure, перед началом работы создайте [бесплатную учетную запись](https://azure.microsoft.com/free).

[!INCLUDE [cloud-shell-try-it.md](../../includes/cloud-shell-try-it.md)]

Для выполнения многих действий, описанных в этом кратком руководстве, используется Azure CLI, а также расширение Интернета вещей Azure для предоставления дополнительных функций.

Добавьте расширение Интернета вещей Azure в экземпляр Cloud Shell.

   ```azurecli-interactive
   az extension add --name azure-cli-iot-ext
   ```

## <a name="prerequisites"></a>Предварительные требования

Облачные ресурсы.

* Группа ресурсов для управления всеми ресурсами, которые вы используете в этом кратком руководстве.

   ```azurecli-interactive
   az group create --name IoTEdgeResources --location westus2
   ```

Устройства IoT Edge:

* Устройство или виртуальная машина Linux для работы в качестве устройства IoT Edge. Вы должны использовать виртуальную машину [Azure IoT Edge on Ubuntu](https://azuremarketplace.microsoft.com/marketplace/apps/microsoft_iot_edge.iot_edge_vm_ubuntu), предоставляемую корпорацией Майкрософт, которая предварительно установит все, что нужно для запуска IoT Edge на устройстве. Примите условия использования и создайте эту виртуальную машину с помощью следующих команд:

   ```azurecli-interactive
   az vm image accept-terms --urn microsoft_iot_edge:iot_edge_vm_ubuntu:ubuntu_1604_edgeruntimeonly:latest
   az vm create --resource-group IoTEdgeResources --name EdgeVM --image microsoft_iot_edge:iot_edge_vm_ubuntu:ubuntu_1604_edgeruntimeonly:latest --admin-username azureuser --generate-ssh-keys
   ```

   Создание и запуск виртуальной машины может занять несколько минут.

   При создании новой виртуальной машины запишите для нее значение **publicIpAddress** (общедоступный IP-адрес), которое содержится в выходных данных команды create. Используйте этот общедоступный IP-адрес для подключения к виртуальной машине далее в этом кратком руководстве.

* Если вы хотите запустить среду выполнения Azure IoT Edge на своем устройстве, выполните инструкции, приведенные в статье [Install the Azure IoT Edge runtime on Debian-based Linux systems](how-to-install-iot-edge-linux.md) (Установка среды выполнения Azure IoT Edge в системах Linux на основе Debian).

## <a name="create-an-iot-hub"></a>Создание Центра Интернета вещей

Начните с создания Центра Интернета вещей с помощью Azure CLI.

![Схема создания Центра Интернета вещей в облаке](./media/quickstart-linux/create-iot-hub.png)

Для целей этого руководства можно использовать бесплатный уровень. Если вы уже использовали бесплатный Центр Интернета вещей и он у вас сохранился, можете использовать его. В подписке может быть только один бесплатный Центр Интернета вещей.

При помощи следующего кода создается бесплатный центр **F1** в группе ресурсов **IoTEdgeResources**. Замените *{hub_name}* уникальным именем для вашего Центра Интернета вещей.

   ```azurecli-interactive
   az iot hub create --resource-group IoTEdgeResources --name {hub_name} --sku F1
   ```

   Если отобразится сообщение об ошибке с уведомлением о том, что в вашей подписке уже имеется один бесплатный центр, измените номер SKU на **S1**. Если отобразится сообщение об ошибке с уведомлением о том, что имя недоступно, значит кто-то уже создал Центр Интернета вещей с таким именем. Выберите другое имя.

## <a name="register-an-iot-edge-device"></a>Регистрация устройства IoT Edge

Зарегистрируйте устройство IoT Edge в только что созданном Центре Интернета вещей.

![Схема регистрации устройства с помощью удостоверения Центра Интернета вещей](./media/quickstart-linux/register-device.png)

Создайте удостоверение для своего имитированного устройства IoT Edge, чтобы оно могло обмениваться данными с Центром Интернета вещей. Удостоверение устройства находится в облаке. Чтобы связать физическое устройство с удостоверением, нужно использовать уникальную строку подключения к устройству.

Так как поведение и управление устройств IoT Edge и обычных устройств Интернета вещей отличаются, укажите в удостоверении, что это устройство IoT Edge, с помощью флага `--edge-enabled`.

1. Чтобы создать устройство с именем **myEdgeDevice** в Центре Интернета вещей, введите следующую команду в Azure Cloud Shell.

   ```azurecli-interactive
   az iot hub device-identity create --hub-name {hub_name} --device-id myEdgeDevice --edge-enabled
   ```

   Если отобразится сообщение об ошибке при использовании ключей политики iothubowner, убедитесь, что в Cloud Shell установлена последняя версия расширения azure-cli-iot-ext.

2. Получите строку подключения для устройства, которая связывает физическое устройство с его идентификатором в Центре Интернета вещей.

   ```azurecli-interactive
   az iot hub device-identity show-connection-string --device-id myEdgeDevice --hub-name {hub_name}
   ```

3. Скопируйте значение ключа `connectionString` из выходных данных JSON и сохраните его. Это значение — строка подключения устройства. Эта строка потребуется для настройки среды выполнения IoT Edge в следующем разделе.

   ![Получение строки подключения из выходных данных интерфейса командной строки](./media/quickstart/retrieve-connection-string.png)

## <a name="configure-your-iot-edge-device"></a>Настройка устройства IoT Edge

Запустите среду выполнения Azure IoT Edge на устройстве IoT Edge.

![Схема запуска среды выполнения на устройстве](./media/quickstart-linux/start-runtime.png)

Среда выполнения IoT Edge развертывается на всех устройствах IoT Edge. Она состоит из трех компонентов. **Управляющая программа безопасности IoT Edge** запускается при каждой загрузке устройства Edge, перезагружая его путем запуска агента IoT Edge. **Агент IoT Edge** упрощает развертывание и мониторинг модулей на устройстве IoT Edge, включая центр IoT Edge. **Центр IoT Edge** управляет взаимодействием между модулями на устройстве IoT Edge, а также между устройством и Центром Интернета вещей.

Укажите строку подключения к устройству во время конфигурации среды выполнения. Используйте строку, полученную с помощью Azure CLI. Эта строка свяжет ваше физическое устройство с удостоверением устройства IoT Edge в Azure.

### <a name="set-the-connection-string-on-the-iot-edge-device"></a>Настройте строку подключения на устройстве IoT Edge

Если вы используете Azure IoT Edge на виртуальной машине Ubuntu, как предусмотрено предварительными требованиями, то на устройстве уже установлена среда выполнения IoT Edge. Вам нужно просто настроить устройство с помощью строки подключения, полученной в предыдущем разделе. Это можно сделать удаленно, без подключения к виртуальной машине. Выполните следующую команду, заменив значение **{device_connection_string}** собственной строкой подключения.

   ```azurecli-interactive
   az vm run-command invoke -g IoTEdgeResources -n EdgeVM --command-id RunShellScript --script "/etc/iotedge/configedge.sh '{device_connection_string}'"
   ```

Если вы используете IoT Edge на локальном компьютере или устройстве ARM32/ARM64, вам нужно установить среду выполнения IoT Edge и необходимые компоненты на устройство. Выполните инструкции из статьи [Install the Azure IoT Edge runtime on Linux](how-to-install-iot-edge-linux.md) (Установка среды выполнения Azure IoT Edge в системах Linux на основе Debian) и вернитесь к этому краткому руководству.

### <a name="view-the-iot-edge-runtime-status"></a>Просмотр состояния среды выполнения IoT Edge

Остальная часть команд из этого краткого руководства выполняется на вашем устройстве IoT Edge, таким образом, вы можете увидеть происходящее на устройстве. Если вы используете виртуальную машину, подключитесь к ней сейчас с помощью общедоступного IP-адреса, который был выведен командой создания. Общедоступный IP-адрес можно также узнать на странице общих сведений о виртуальной машине на портале Azure. Подключитесь к виртуальной машине, используя приведенную ниже команду. Замените значение **{azureuser}** , если вы использовали имя пользователя, отличное от предложенного в предварительных требованиях. Замените **{publicIpAddress}** адресом своей виртуальной машины.

   ```azurecli-interactive
   ssh azureuser@{publicIpAddress}
   ```

Убедитесь, что среда выполнения успешно установлена и настроена на устройстве IoT Edge.

>[!TIP]
>Для запуска команд `iotedge` требуется более высокий уровень привилегий. После установки среды выполнения IoT Edge, выхода из компьютера и обратного входа ваши разрешения обновляются автоматически. До этого момента используйте перед командой префикс **sudo**.

1. Убедитесь, что управляющая программа безопасности IoT Edge выполняется как системная служба.

   ```bash
   sudo systemctl status iotedge
   ```

   ![Проверка того, выполняется ли управляющая программа IoT Edge как системная служба](./media/quickstart-linux/iotedged-running.png)

2. Если нужно устранить неполадки со службой, извлеките журналы службы.

   ```bash
   journalctl -u iotedge
   ```

3. Просмотрите модули, запущенные на устройстве.

   ```bash
   sudo iotedge list
   ```

   ![Просмотр данных об одном модуле на устройстве](./media/quickstart-linux/iotedge-list-1.png)

Теперь устройство IoT Edge настроено. Оно готово для запуска модулей, развернутых в облаке.

## <a name="deploy-a-module"></a>Развертывание модуля

Управляя устройством Azure IoT Edge из облака, разверните модуль, который будет передавать данные телеметрии в Центр Интернета вещей.
![Схема развертывания модуля из облака на устройство](./media/quickstart-linux/deploy-module.png)

[!INCLUDE [iot-edge-deploy-module](../../includes/iot-edge-deploy-module.md)]

## <a name="view-generated-data"></a>Просмотр сформированных данных

В этом руководстве мы создали новое устройство IoT Edge и установили на нем среду выполнения IoT Edge. Затем с помощью портала Azure мы развернули модуль IoT Edge на устройстве, обеспечив возможность запуска без необходимости менять настройки на устройстве.

В этом примере отправленный модуль создает пример данных, которые можно использовать для тестирования. Имитированный модуль датчика температуры создает данные среды, которые вы сможете позже использовать для тестирования. Имитируемый датчик выполняет мониторинг оборудования и окружающей среды. Например, этот датчик может быть в серверной комнате, производственном цехе или ветроэлектрической установке. В сообщении отображаются данные о температуре и влажности окружающей среды, температуре и давлении оборудования, а также метка времени. При работе с руководствами по IoT Edge используйте данные, созданные этим модулем, как тестовые данные для аналитики.

Откройте повторно командную строку на устройстве IoT Edge или используйте соединение SSH из Azure CLI. Убедитесь, что развернутый из облака модуль работает на вашем устройстве IoT Edge.

   ```bash
   sudo iotedge list
   ```

   ![Просмотр трех модулей на устройстве](./media/quickstart-linux/iotedge-list-2.png)

Убедитесь, что сообщения отправляются из модуля датчика температуры.

   ```bash
   sudo iotedge logs SimulatedTemperatureSensor -f
   ```

   >[!TIP]
   >В командах IoT Edge при использовании имен модулей учитывается регистр.

   ![Просмотр получаемых с модуля данных](./media/quickstart-linux/iotedge-logs.png)

Вы также можете просматривать сообщения, которые поступают в Центр Интернета вещей, с помощью [расширения набора средств Центра Интернета вещей для Visual Studio Code](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-toolkit) (прежнее название — расширение набора средств Azure IoT).

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы хотите продолжить ознакомление с руководствами по IoT Edge, используйте устройство, зарегистрированное и настроенное в рамках этого краткого руководства. Если нет, вы можете удалить созданные ресурсы Azure, чтобы избежать расходов.

Если вы создали виртуальную машину и Центр Интернета вещей в новой группе ресурсов, можно удалить эту группу и все связанные с ней ресурсы. Внимательно проверьте содержимое группы ресурсов. В ней не должно быть важных ресурсов. Если вы не хотите удалять всю группу, можно удалить отдельные ресурсы.

Удалите группу **IoTEdgeResources**.

```azurecli-interactive
az group delete --name IoTEdgeResources
```

## <a name="next-steps"></a>Дополнительная информация


При работе с этим кратким руководством вы создали устройство IoT Edge и с помощью облачного интерфейса Azure IoT Edge развернули код на устройстве. В итоге вы получили устройство для тестирования, генерирующее необработанные данные о своей среде.

Далее вы можете настроить локальную среду разработки, чтобы приступить к созданию модулей IoT Edge, которые выполняют бизнес-логику. 

> [!div class="nextstepaction"]
> [Разработка модулей IoT Edge для устройств Linux](tutorial-develop-for-linux.md)
