---
title: Развертывание службы "Машинное обучение Azure" на устройстве — Azure IoT Edge | Документация Майкрософт
description: В этом учебнике вы создадите модель службы "Машинное обучение Azure", а затем развернете ее как модуль на пограничном устройстве
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 03/07/2019
ms.topic: tutorial
ms.service: iot-edge
services: iot-edge
ms.custom: mvc, seodec18
ms.openlocfilehash: 6c48aaf404803c45122ed3fad0d6af1345406f7b
ms.sourcegitcommit: 509e1583c3a3dde34c8090d2149d255cb92fe991
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/27/2019
ms.locfileid: "66239667"
---
# <a name="tutorial-deploy-azure-machine-learning-as-an-iot-edge-module-preview"></a>Руководство по Развертывание службы "Машинное обучение Azure" в качестве модуля IoT Edge (предварительная версия)

С помощью службы "Записные книжки Azure" вы можете разработать модуль машинного обучения и развернуть его на устройстве Linux под управлением Azure IoT Edge. 

Вы можете использовать модули IoT Edge для развертывания кода, который реализует вашу бизнес-логику непосредственно на устройствах IoT Edge. В этом руководстве рассматривается развертывание модуля машинного обучения Azure, который прогнозирует, когда устройство выходит из строя на основе данных моделируемой машинной температуры. Дополнительные сведения о Службе машинного обучения Azure в IoT Edge см. в [Документация по Службе машинного обучения Azure](../machine-learning/service/how-to-deploy-to-iot.md).

Модуль машинного обучения Azure, который вы создадите в этом руководстве, считывает сформированные устройством данные об окружающей среде и отмечает сообщения как аномальные или нет.

Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Создание модуля машинного обучения Azure
> * Отправка контейнера модуля в реестр контейнеров Azure
> * Развертывание модуля машинного обучения Azure на устройстве IoT Edge
> * Просмотр сформированных данных

>[!NOTE]
>Модули машинного обучения Azure в Azure IoT Edge находятся в общедоступной предварительной версии.

[!INCLUDE [quickstarts-free-trial-note](../../includes/quickstarts-free-trial-note.md)]


## <a name="prerequisites"></a>Предварительные требования

Устройство Azure IoT Edge.

* В качестве устройства IoT Edge можно использовать виртуальную машину Azure. Для этого выполните действия, описанные в кратком руководстве для устройства [Linux](quickstart-linux.md).
* Модуль Машинного обучения Azure не поддерживает контейнеры Windows.
* Модуль Машинного обучения Azure также не поддерживает процессоры ARM.

Облачные ресурсы.

* [Центр Интернета вещей](../iot-hub/iot-hub-create-through-portal.md) ценовой категории "Бесплатный" или "Стандартный" в Azure.
* Рабочая область машинного обучения Azure. Следуйте инструкциям, описанным в статье [Краткое руководство. Начало работы со Службой машинного обучения Azure с помощью портала Azure](../machine-learning/service/quickstart-get-started.md), чтобы создать область и узнать, как ее использовать.
   * Запишите имя рабочей области, группу ресурсов и идентификатор подписки. Все эти значения доступны в колонке обзора рабочей области на портале Azure. Эти значения понадобятся вам при дальнейшей работе с учебником для подключения записной книжки Azure к ресурсам рабочей области. 


## <a name="create-and-deploy-azure-machine-learning-module"></a>Создание и развертывание модуля Машинного обучения Azure

В этом разделе описывается, как преобразовать файлы обученной модели машинного обучения в контейнер Службы машинного обучения Azure. Все компоненты, необходимые для образа Docker, содержатся в [наборе средств для работы с искусственным интеллектом для репозитория Git службы Azure IoT Edge](https://github.com/Azure/ai-toolkit-iot-edge/tree/master/IoT%20Edge%20anomaly%20detection%20tutorial). Выполните следующие действия, чтобы передать хранилище в Записные книжки Microsoft Azure, создать контейнер и переместить его в Реестр контейнеров Azure.


1. Перейдите к проектам Записных книжек Azure. Их можно просмотреть в рабочей области Службы машинного обучения Azure на портале [Azure](https://portal.azure.com) или в службе [Записные книжки Microsoft Azure](https://notebooks.azure.com/home/projects), войдя в нее с помощью учетной записи Azure.

2. Щелкните **Upload GitHub Repo** (Отправить репозиторий GitHub).

3. Предоставьте для репозитория GitHub следующее имя: `Azure/ai-toolkit-iot-edge`. Снимите флажок **Общедоступный**, если вы хотите, чтобы проект был частным. Выберите **Импортировать**. 

4. После завершения импорта перейдите в новый проект **ai-toolkit-iot-edge** и откройте папку **IoT Edge anomaly detection tutorial**. 

5. Убедитесь, что проект работает. Если нет, щелкните **Run on Free Compute** (Запустить на бесплатном вычислительном ресурсе).

   ![Кнопка запуска на бесплатном вычислительном ресурсе](./media/tutorial-deploy-machine-learning/run-on-free-compute.png)

6. Откройте файл **aml_config/config_json**.

7. Измените файл конфигурации, добавив в него значения идентификатора подписки Azure и группы ресурсов в подписке, а также имя рабочей области Службы машинного обучения Azure. Вы можете получить все эти значения в разделе **Обзор** для вашей рабочей области в Azure. 

8. Сохраните файл конфигурации.

9. Откройте файл **00-anomaly-detection-tutorial.ipynb**.

10. При появлении запроса выберите ядро ​​**Python 3.6**, а затем щелкните **Set Kernel** (Настроить ядро).

11. Измените первую ячейку в блокноте в соответствии с инструкциями в комментариях. Используйте ту же группу ресурсов, идентификатор подписки и имя рабочей области, которые вы добавили в файл конфигурации.

12. Запустите ячейки в записной книжке, выбрав их и щелкнув **Запустить** или нажав `Shift + Enter`.

    >[!TIP]
    >Некоторые ячейки в записной книжке по обнаружению аномалий являются необязательными, так как они создают ресурсы, которых еще может не быть у некоторых пользователей, например Центр Интернета вещей. Если вы поместите существующие сведения о ресурсах в первую ячейку, при запуске ячеек, создающих ресурсы, будут возникать ошибки, так как Azure не будет создавать дубликаты ресурсов. Это нормально. Вы можете игнорировать ошибки или полностью пропустить эти необязательные разделы. 

Выполнив все шаги из записной книжки, вы подготовили модель обнаружения аномалий, создали ее в виде образа контейнера Docker и переместили этот образ в Реестр контейнеров Azure. Затем вы протестировали модель и, наконец, развернули ее на устройстве IoT Edge. 

## <a name="view-container-repository"></a>Просмотр репозитория контейнеров

Убедитесь, что образ контейнера создан и сохранен в реестр контейнеров Azure, который связан со средой машинного обучения. Записная книжка, которую вы использовали в предыдущем разделе, автоматически предоставляла образ контейнера и учетные данные реестра для вашего устройства IoT Edge, но вы должны знать, где они хранятся, чтобы найти сведения позже. 

1. Войдите на [портал Azure](https://portal.azure.com) и перейдите к рабочему пространству Службы машинного обучения. 

2. В разделе **Обзор** перечислены подробные сведения о рабочей области, а также связанные с ней ресурсы. Выберите значение **реестра**, которое должно быть именем вашей рабочей области, за которым следуют случайные числа. 

3. В реестре контейнеров щелкните **Репозитории**. Вы должны увидеть репозиторий **tempanomalydetection**, созданный в записной книжке, которую вы запускали в предыдущем разделе. 

4. Выберите **tempanomalydetection**. Вы увидите, что репозиторий содержит один тег: **1**. 

   Теперь, когда вы знаете имя реестра, имя репозитория и тег, вы можете составить полный путь к образу контейнера. Путь должен выглядеть как **\<имя_реестра\>.azurecr.io/tempanomalydetection:1**. Вы можете использовать путь к образу для развертывания этого контейнера на устройствах IoT Edge. 

5. В реестре контейнеров щелкните **Ключи доступа**. Вы должны увидеть несколько учетных данных для доступа, включая **сервер входа**, а также **имя пользователя** и **пароль** администратора.

   Эти учетные данные можно добавить в манифест развертывания, чтобы предоставить устройству IoT Edge доступ для извлечения образов контейнеров из реестра. 

Теперь вы знаете, где хранится образ контейнера Машинного обучения. В следующем разделе описано, как просмотреть контейнер, запущенный в качестве модуля на устройстве IoT Edge. 

## <a name="view-generated-data"></a>Просмотр сформированных данных

Можно просматривать сообщения, формируемые каждым модулем IoT Edge, а также просматривать сообщения, доставленные в центр IoT.

### <a name="view-data-on-your-iot-edge-device"></a>Представление данных на устройстве IoT Edge

На устройстве IoT Edge можно просмотреть сообщения, отправляемые из каждого отдельного модуля.

Для выполнения команд `iotedge` может потребоваться использовать `sudo` с повышенными разрешениями. При выходе из системы устройства и повторном входе в нее ваши разрешения обновляются автоматически.

1. Просмотрите все модули на устройстве IoT Edge.

   ```cmd/sh
   iotedge list
   ```

2. Убедитесь, что сообщения отправляются из конкретного устройства. Используйте имя модуля из вывода предыдущей команды.

   ```cmd/sh
   iotedge logs <module_name> -f
   ```

### <a name="view-data-arriving-at-your-iot-hub"></a>Представление данных, поступающих в центр IoT

Можно просматривать сообщения, которые получает Центр Интернета вещей с устройства в облако, используя [расширение "Набор средств для Центра Интернета вещей Azure" для Visual Studio Code](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-toolkit) (прежнее название — "Набор средств для Интернета вещей Azure").

Следующие шаги показывают, как настроить Visual Studio Code для контроля за сообщениями с устройства в облако, поступающие в центр IoT.

1. В Visual Studio Code выберите **IoT Hub Devices** (Устройства Центра Интернета вещей).

2. Выберите меню **...** , затем — **Set IoT Hub Connection String** (Задать строку подключения Центра Интернета вещей).

   ![Установка строки подключения Центра Интернета вещей](./media/tutorial-deploy-machine-learning/set-connection.png)

3. В текстовое поле, которое откроется в верхней части страницы, введите строку подключения для вашего Центра Интернета вещей — iothubowner. Устройство IoT Edge должно появиться в списке устройств Центра Интернета вещей.

4. Щелкните **...** еще раз и выберите **Start Monitoring Built-in Event Endpoint** (Начать мониторинг встроенной конечной точки событий).

5. Просмотрите сообщения, поступающие от tempSensor каждые пять секунд. Текст сообщения содержит свойство с именем **anomaly**, которое модуль machinelearningmodule отображает со значением true или false. Свойство **AzureMLResponse** свойство содержит значение "OK", если модель выполнен успешно.

   ![Ответ Службы машинного обучения Azure в тексте сообщения](./media/tutorial-deploy-machine-learning/ml-output.png)

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы планируете перейти к следующей рекомендуемой статье, можно сохранить созданные и повторно используемые ресурсы и конфигурации. Это же устройство IoT Edge также можно использовать в качестве тестового устройства.

В противном случае чтобы избежать расходов, можно удалить локальные конфигурации и ресурсы Azure, созданные в рамках этой статьи.

[!INCLUDE [iot-edge-clean-up-cloud-resources](../../includes/iot-edge-clean-up-cloud-resources.md)]

## <a name="next-steps"></a>Дополнительная информация

В этом руководстве вы развернули модуль IoT Edge на базе службы "Машинное обучение Azure". Вы можете перейти к любому из оставшихся руководств, чтобы узнать о других способах, с помощью которых Azure IoT Edge может помочь вам превратить данные в бизнес-аналитику на пограничном устройстве.

> [!div class="nextstepaction"]
> [Классификация изображений с помощью Пользовательской службы визуального распознавания](tutorial-deploy-custom-vision.md)

