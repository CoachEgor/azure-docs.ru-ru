---
title: Обновления версии Azure IoT Edge на устройствах | Документация Майкрософт
description: Сведения об обновлении устройства IoT Edge для запуска последних версий управляющей программы безопасности и среды выполнения IoT Edge
keywords: ''
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 04/08/2020
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: ce69593c1df0039d64f89e79124af1150409eff7
ms.sourcegitcommit: fb23286d4769442631079c7ed5da1ed14afdd5fc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/10/2020
ms.locfileid: "81113302"
---
# <a name="update-the-iot-edge-security-daemon-and-runtime"></a>Обновление управляющей программы безопасности и среды выполнения IoT Edge

По мере того, как служба IoT Edge выпускает новые версии, необходимо обновить устройства IoT Edge для последних функций и улучшений безопасности. В этой статье представлены сведения об обновлении устройств IoT Edge при наличии новой версии.

Если вы хотите перейти на новую версию, вам необходимо обновить два компонента устройства IoT Edge. Первый компонент — управляющая программа безопасности, которая выполняется на устройстве и запускает модули среды выполнения при запуске устройства. В настоящее время обновить управляющую программу безопасности можно только на самом устройстве. Второй компонент — это среда выполнения, состоящая из модулей центра и агента IoT Edge. В зависимости от структуры развертывания среду выполнения можно обновить как на устройстве, так и удаленно.

Последнюю версию Azure IoT Edge можно найти [на сайте GitHub](https://github.com/Azure/azure-iotedge/releases).

## <a name="update-the-security-daemon"></a>Обновление управляющей программы безопасности

Управляющая программа безопасности IoT Edge — это собственный компонент, который необходимо обновить с помощью диспетчера пакетов на устройстве IoT Edge.

Проверьте версию управляющей программы безопасности, запущенной на вашем устройстве, с помощью команды `iotedge version`.

### <a name="linux-devices"></a>Устройства Linux

На устройствах Linux x64 используйте apt-get или подходящий менеджер пакетов для обновления дежавю безопасности до последней версии.

```bash
apt-get update
apt-get install libiothsm iotedge
```

Если вы хотите обновить до определенной версии daemon безопасности, найдите версию, на которая вы хотите настроить таргетинг из [релизов IoT Edge.](https://github.com/Azure/azure-iotedge/releases) В этой версии найдите соответствующие **файлы libiothsm-std** и **iotedge** для вашего устройства. Для каждого файла, право нажмите на ссылку файла и скопировать ссылку адрес. Используйте ссылку адрес для установки конкретных версий этих компонентов:

```bash
curl -L <libiothsm-std link> -o libiothsm-std.deb && sudo dpkg -i ./libiothsm-std.deb
curl -L <iotedge link> -o iotedge.deb && sudo dpkg -i ./iotedge.deb
```

### <a name="windows-devices"></a>Устройства Windows

На устройствах Windows используйте скрипт PowerShell для обновления daemon безопасности. Скрипт автоматически вытягивает последнюю версию daemon безопасности.

```powershell
. {Invoke-WebRequest -useb aka.ms/iotedge-win} | Invoke-Expression; Update-IoTEdge -ContainerOs <Windows or Linux>
```

Запуск команды Update-IoTEdge удаляет и обновляет дежмон безопасности с вашего устройства, а также два изображения контейнеров во времени выполнения. Файл config.yaml хранится на устройстве, а также данные из контейнерного движка Moby (если вы используете контейнеры Windows). Хранение информации о конфигурации означает, что во время процесса обновления не нужно предоставлять информацию о строке подключения или службе обеспечения устройств для вашего устройства.

Если вы хотите обновить до определенной версии daemon безопасности, найдите версию, на которая вы хотите настроить таргетинг из [релизов IoT Edge.](https://github.com/Azure/azure-iotedge/releases) В этой версии загрузите файл **Microsoft-Azure-IoTEdge.cab.** Затем используйте `-OfflineInstallationPath` параметр, чтобы указать на локальное местоположение файла. Пример:

```powershell
. {Invoke-WebRequest -useb aka.ms/iotedge-win} | Invoke-Expression; Update-IoTEdge -ContainerOs <Windows or Linux> -OfflineInstallationPath <absolute path to directory>
```

>[!NOTE]
>Параметр `-OfflineInstallationPath` ищет файл под названием **Microsoft-Azure-IoTEdge.cab** в предоставленном каталоге. Начиная с версии IoT Edge 1.0.9-rc4, есть два файла .cab, доступных для использования, один для устройств AMD64 и один для ARM32. Скачать правильный файл для вашего устройства, а затем переименовать файл, чтобы удалить архитектуру суффикса.

Для получения дополнительной информации о `Get-Help Update-IoTEdge -full` вариантах обновления используйте команду или обратитесь ко [всем параметрам установки.](how-to-install-iot-edge-windows.md#all-installation-parameters)

## <a name="update-the-runtime-containers"></a>Обновление контейнеров среды выполнения

Способ обновления агента IoT Edge и контейнеров концентратора IoT Edge зависит от того, используете ли вы в развертывании теги (например 1.0) или конкретные теги (например, 1.0.7).

Проверьте версию модулей агента и центра IoT Edge, используемую в настоящее время на вашем устройстве, с помощью команды `iotedge logs edgeAgent` или `iotedge logs edgeHub`.

  ![Поиск версии контейнера в журналах](./media/how-to-update-iot-edge/container-version.png)

### <a name="understand-iot-edge-tags"></a>Сведения о тегах IoT Edge

Образы агента и центра IoT Edge отмечены тегами версии IoT Edge, с которой они связаны. Существует два способа использования тегов с образами среды выполнения:

* **Последовательные теги**: используются только первые два значения номера версии для получения последнего образа, соответствующего этим цифрам. Например, 1.0 обновляется всякий раз, когда появляется новый выпуск, указывающий на последнюю версию 1.0.x. Если среда выполнения контейнера на устройстве IoT Edge снова извлекает образ, модули среды выполнения обновляются до последней версии. Такой подход рекомендуется использовать для разработки. Для развертываний с портала Azure по умолчанию установлены последовательные теги.

* **Конкретные теги**: используются все три значения номера версии для явной установки версии образа. Например, 1.0.7 не изменится после его первоначального выпуска. Вы можете объявить новый номер версии в манифесте развертывания, когда будете готовы к обновлению. Такой подход рекомендуется использовать для производственных целей.

### <a name="update-a-rolling-tag-image"></a>Обновление образа последовательного тега

Если вы используете последовательные теги в своем развертывании (например, mcr.microsoft.com/azureiotedge-hub:**1.0**), вам необходимо принудительно запустить среду выполнения контейнера на устройстве, чтобы извлечь последнюю версию образа.

Удалите локальную версию образа с устройства IoT Edge. На компьютерах Windows удаление управляющей программы безопасности приводит к удалению образов среды выполнения, поэтому не нужно снова выполнять этот шаг.

```bash
docker rmi mcr.microsoft.com/azureiotedge-hub:1.0
docker rmi mcr.microsoft.com/azureiotedge-agent:1.0
```

Для удаления образов может потребоваться использовать флаг force `-f`.

Служба IoT Edge извлечет последние версии образов среды выполнения и автоматически запустит их на вашем устройстве.

### <a name="update-a-specific-tag-image"></a>Обновление образа конкретного тега

Если вы используете определенные теги в развертывании (например, mcr.microsoft.com/azureiotedge-hub:**1.0.8),** то все, что вам нужно сделать, это обновить тег в манифесте развертывания и применить изменения к устройству.

1. На концентраторе IoT на портале Azure выберите устройство IoT Edge и выберите **модуль Set Modules.**

1. В разделе **Модули IoT Edge** выберите **параметры runtime.**

   ![Настройка параметров времени выполнения](./media/how-to-update-iot-edge/configure-runtime.png)

1. В **настройках Runtime**обновите значение **изображения** для **Edge Hub** с желаемой версией. Не выбирайте **Сохранить** только пока.

   ![Обновление версии изображения краевого концентратора](./media/how-to-update-iot-edge/runtime-settings-edgehub.png)

1. Свернуть настройки **краевого концентратора** или прокрутить вниз и обновить значение **изображения** для **Edge Agent** с той же желаемой версией.

   ![Обновление версии агента концентратора Edge](./media/how-to-update-iot-edge/runtime-settings-edgeagent.png)

1. Щелкните **Сохранить**.

1. Выберите **Обзор и создайте,** просмотрите развертывание и выберите **Создать**.

## <a name="update-offline-or-to-a-specific-version"></a>Обновление в автономном режиме или в определенной версии

Если вы хотите обновить устройство в автономном режиме или обновить конкретную версию IoT Edge, `-OfflineInstallationPath` а не самую самую самую версию, вы можете сделать это с параметром.

Для обновления устройства IoT Edge используются два компонента:

* Скрипт PowerShell, содержащий инструкции по установке
* Кабина Microsoft Azure IoT Edge, которая содержит daemon безопасности IoT Edge (iotedged), контейнерный движок Moby и Moby CLI

1. Для последних файлов установки IoT Edge [Azure IoT Edge releases](https://github.com/Azure/azure-iotedge/releases)вместе с предыдущими версиями см.

2. Найдите версию, которую вы хотите установить, и загрузите следующие файлы из раздела **«Активы»** примечаний к выпуску на устройство IoT:

   * IoTEdgeSecurityDaemon.ps1
   * Microsoft-Azure-IoTEdge-amd64.cab из релизов 1.0.9 или более новых, или Microsoft-Azure-IoTEdge.cab от выпусков 1.0.8 и старше.

   Microsoft-Azure-IotEdge-arm32.cab также доступен начиная с 1.0.9 только для целей тестирования. IoT Edge в настоящее время не поддерживается на устройствах Windows ARM32.

   Важно использовать скрипт PowerShell из того же выпуска, что и файл .cab, который используется, потому что функциональность изменяется для поддержки функций в каждом выпуске.

3. Если в загружаемом вами файле .cab есть суффикс архитектуры, переименуйте файл только в **Microsoft-Azure-IoTEdge.cab**.

4. Чтобы обновить с автономными компонентами, [точка источник](https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_scripts?view=powershell-7#script-scope-and-dot-sourcing) локальной копии сценария PowerShell. Затем используйте `-OfflineInstallationPath` параметр как `Update-IoTEdge` часть команды и предоставьте абсолютный путь к каталогу файлов. Например,

   ```powershell
   . <path>\IoTEdgeSecurityDaemon.ps1
   Update-IoTEdge -OfflineInstallationPath <path>
   ```

## <a name="update-to-a-release-candidate-version"></a>Обновление до версии кандидата на выпуск

Azure IoT Edge регулярно выпускает новые версии сервиса IoT Edge. Перед каждым стабильным выпуском существует одна или несколько версий кандидата на выпуск (RC). RC версии включают в себя все запланированные функции для выпуска, но все еще проходят тестирование и проверку. Если вы хотите протестировать новую функцию заранее, вы можете установить версию RC и обеспечить обратную связь через GitHub.

Версии кандидатов выпуска следуют той же конвенции нумерации релизов, но имеют **-rc** плюс дополнительное число, приложено к концу. Вы можете видеть кандидатов в релизы в том же списке [релизов Azure IoT Edge](https://github.com/Azure/azure-iotedge/releases) как стабильные версии. Например, найти **1.0.7-rc1** и **1.0.7-rc2**, два релиза кандидатов, которые пришли до **1.0.7**. Вы также можете видеть, что версии RC отмечены **предвыпускными** метками.

Агент IoT Edge и концентрированные модули имеют версии RC, отмеченные той же конвенцией. Например, **mcr.microsoft.com/azureiotedge-hub:1.0.7-rc2**.

В качестве предварительных просмотров версии кандидатов на выпуск не включены в качестве последней версии, на которую нацелены обычные установщики. Вместо этого необходимо вручную настроить таргетинг на ресурсы для версии RC, которую вы хотите протестировать. По большей части, установка или обновление версии RC является такой же, как таргетинг на любую другую конкретную версию IoT Edge.

Используйте разделы в этой статье, чтобы узнать, как обновить устройство IoT Edge до конкретной версии модулей безопасности или времени выполнения.

Если вы устанавливаете IoT Edge на новую машину, используйте следующие ссылки, чтобы узнать, как установить конкретную версию в зависимости от операционной системы устройства:

* [Linux](how-to-install-iot-edge-linux.md#install-a-specific-runtime-version)
* [Windows](how-to-install-iot-edge-windows.md#offline-or-specific-version-installation)

## <a name="next-steps"></a>Дальнейшие действия

Ознакомьтесь с последними выпусками Azure IoT Edge [на сайте GitHub](https://github.com/Azure/azure-iotedge/releases).

Будьте в курсе последних обновлений и объявлений, просматривая блог, посвященный [Интернету вещей](https://azure.microsoft.com/blog/topics/internet-of-things/).
