---
title: Шлюзы для подчиненных устройств — Azure IoT Edge | Документация Майкрософт
description: Используйте Azure IoT Edge для создания прозрачного и непрозрачного устройства-шлюза или устройства-шлюза прокси-сервера, который отправляет данные из нескольких подчиненных устройств в облако или обрабатывает их локально.
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 08/21/2020
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.custom:
- amqp
- mqtt
ms.openlocfilehash: 0589779de2ddb0bc75dde3b57d6444634b879f86
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "89017028"
---
# <a name="how-an-iot-edge-device-can-be-used-as-a-gateway"></a>Использование устройства IoT Edge в качестве шлюза

Шлюзы в решениях IoT Edge обеспечивают подключение устройств и аналитику ребра к устройствам IoT, которые в противном случае не имеют этих возможностей. Azure IoT Edge можно использовать для удовлетворения любых потребностей шлюза IoT, связанных с подключением, удостоверениями или аналитикой ребра. Шаблоны шлюза в этой статье относятся только к характеристикам подключения к нисходящему устройству и идентификации устройства, а не как данные устройства обрабатываются на шлюзе.

## <a name="patterns"></a>Шаблоны

Существует три шаблона использования устройства IoT Edge в качестве шлюза: прозрачность, преобразование протокола и преобразование удостоверения.

Основное различие между шаблонами состоит в том, что прозрачный шлюз передает сообщения между подчиненными устройствами и центром Интернета вещей, не требуя дополнительной обработки. Однако преобразование протокола и преобразование удостоверения требует обработки на шлюзе для обеспечения взаимодействия.

Любой шлюз может использовать IoT Edgeные модули для выполнения анализа или предварительной обработки на границе перед передачей сообщений от подчиненных устройств в центр Интернета вещей.

![Схема — шаблоны прозрачного шлюза, непрозрачного шлюза и шлюза преобразования удостоверений](./media/iot-edge-as-gateway/edge-as-gateway.png)

### <a name="transparent-pattern"></a>Прозрачный шаблон

В шаблоне *прозрачного* шлюза устройства, которые теоретически могут подключаться к центру Интернета вещей, могут подключаться к устройству шлюза. Подчиненные устройства имеют собственные удостоверения Центра Интернета вещей и используют любой из протоколов MQTT, AMQP или HTTP. Шлюз просто обеспечивает взаимодействие между устройствами и Центром Интернета вещей. Устройства и пользователи, взаимодействующие с ними через центр Интернета вещей, не знают, что шлюз обрабатывают их связь. Отсутствие осведомленности означает, что шлюз считается *прозрачным*.

Среда выполнения IoT Edge содержит прозрачные возможности шлюза. Дополнительные сведения см. в разделе [Настройка устройства IoT Edge для использования в качестве прозрачного шлюза](how-to-create-transparent-gateway.md).

### <a name="protocol-translation-pattern"></a>Шаблон преобразования протокола

Шлюз *преобразования протоколов* также называется *непрозрачным* шлюзом в отличие от шаблона прозрачного шлюза. В этом шаблоне устройства, которые не поддерживают MQTT, AMQP или HTTP, могут использовать устройство шлюза для отправки данных в центр Интернета вещей от их имени. Шлюз понимает протокол, используемый подчиненными устройствами, и является единственным устройством с удостоверением в Центре Интернета вещей. Вся информация выглядит так, будто она поступает с одного устройства, шлюза. Подчиненные устройства должны встраивать в сообщения дополнительную идентификационную информацию, если облачным приложениям требуется анализировать данные для каждого устройства отдельно. Кроме того, примитивы Центра Интернета вещей, такие как двойники и методы, доступны только для устройств шлюза (для подчиненных устройств они недоступны).

Среда выполнения IoT Edge не включает возможности преобразования протокола. Для этого шаблона требуются пользовательские или сторонние модули, которые часто относятся к используемому оборудованию и протоколу. [Azure Marketplace](https://azuremarketplace.microsoft.com/marketplace/apps/category/internet-of-things?page=1&subcategories=iot-edge-modules) содержит несколько модулей для выбора протокола преобразования.

### <a name="identity-translation-pattern"></a>Шаблон трансляции удостоверений

В шаблоне шлюза *преобразования удостоверений* устройства, которые не могут подключиться к центру Интернета вещей, могут подключаться к устройству шлюза. Шлюз предоставляет удостоверение Центра Интернета вещей и обеспечивает преобразование протокола от имени подчиненных устройств. Шлюз распознает протокол, используемый подчиненными устройствами, предоставляет удостоверение и преобразует примитивы центра Интернета вещей. Подчиненные устройства отображаются в центре Интернета вещей как устройства первого класса с двойниками и методами. Пользователь может взаимодействовать с устройствами в Центре Интернета вещей и не знает о промежуточном устройстве шлюза.

Среда выполнения IoT Edge не включает возможности преобразования идентификаторов. Для этого шаблона требуются пользовательские или сторонние модули, которые часто относятся к используемому оборудованию и протоколу. Пример, в котором используется шаблон преобразования удостоверений, см. в разделе [Azure IOT Edge Лораван Starter Kit](https://github.com/Azure/iotedge-lorawan-starterkit).

## <a name="use-cases"></a>Варианты использования

Все шаблоны шлюза предоставляют следующие преимущества:

* **Аналитика на пограничном уровне** . Используйте службы искусственного интеллекта локально для обработки данных, поступающих от нижестоящих устройств, не отправляя данные телеметрии полной точности в облако. Находите данные и реагируйте на запросы локально, а также отправляйте подмножество данных в Центр Интернета вещей.
* **Изоляция подчиненного устройства.** Устройство шлюза может обеспечить всем подчиненным устройствам безопасность в Интернете. Оно может находиться между сетью OT без возможности подключения и IT-сетью, которая обеспечивает доступ к сети.
* **Мультиплексирование подключения**. Все устройства, подключающиеся к Центру Интернета вещей через шлюз IoT Edge, будут использовать одно и то же базовое подключение.
* **Сглаживание трафика** — Устройство IoT Edge автоматически будет выполнять экспоненциальную задержку, если Центр Интернета вещей регулирует трафик, при этом сообщения сохраняются локально. Это преимущество сделает ваше решение устойчивым к пикам трафика.
* **Автономная поддержка** . устройство шлюза хранит сообщения и обновления двойника, которые не могут быть доставлены в центр Интернета вещей.

Шлюз, который выполняет преобразование протокола, может поддерживать существующие устройства и новые устройства, ограниченные ресурсами. Многие имеющиеся устройства производят данные, которые могут предоставить бизнес-аналитику, однако они не были разработаны с учетом возможности подключения к облаку. Непрозрачные шлюзы позволяют разблокировать эти данные и использовать их в решении IoT.

Шлюз, который преобразует удостоверение, предоставляет преимущества преобразования протокола и дополнительно позволяет полностью управлять подчиненными устройствами из облака. Все устройства решения Интернета вещей отображаются в Центре Интернета вещей независимо от используемого протокола.

## <a name="cheat-sheet"></a>Краткий справочник

Ниже приведена краткая памятка, в которой сравниваются примитивы Центра Интернета вещей при использовании прозрачного и непрозрачного шлюза (протокола) и шлюза прокси-сервера.

| Примитивные | Прозрачный шлюз | Преобразование протоколов | Преобразование удостоверения |
|--------|-------------|--------|--------|
| Удостоверения, хранящиеся в реестре удостоверений Центра Интернета вещей | Удостоверения всех подключенных устройств | Только удостоверение устройства шлюза | Удостоверения всех подключенных устройств |
| "Двойник" устройства | У каждого подключенного устройства есть свой собственный двойник устройства | Только у шлюза есть двойники устройства и модуля | У каждого подключенного устройства есть свой собственный двойник устройства |
| Прямые методы и сообщения, передающиеся из облака на устройства | Данные могут передаваться из облака на каждое подключенное устройство по отдельности | Данные могут передаваться из облака только в шлюз | Данные могут передаваться из облака на каждое подключенное устройство по отдельности |
| [Квоты и регулирование в Центре Интернета вещей](../iot-hub/iot-hub-devguide-quotas-throttling.md) | Применяется к каждому устройству | Применяется к устройству шлюза | Применяется к каждому устройству |

При использовании модели непрозрачного шлюза (преобразование протоколов) все устройства, подключающиеся через шлюз, совместно используют одну очередь из облака на устройство, которая может содержать не более 50 сообщений. Из этого следует, что шаблон непрозрачного шлюза должен использоваться только в том случае, если через шлюз каждого поля подключается небольшое число устройств и их трафик из облака на устройство низкий.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о настройке прозрачного шлюза см. в следующих трех шагах.

* [Настройка устройства IoT Edge для использования в качестве прозрачного шлюза](how-to-create-transparent-gateway.md)
* [Аутентификация подчиненного устройства в Центре Интернета вещей](how-to-authenticate-downstream-device.md)
* [Connect a downstream device to an Azure IoT Edge gateway](how-to-connect-downstream-device.md) (Подключение подчиненного устройства к шлюзу Azure IoT Edge)
