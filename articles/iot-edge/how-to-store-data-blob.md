---
title: Хранение блочных BLOB-объектов на устройствах — Azure IoT Edge | Документация Майкрософт
description: Понять возможности по уровням и их время жизни, см. в разделе операций поддерживаемых BLOB-объектов в хранилище и подключиться к вашей учетной записи хранения BLOB-объектов.
author: kgremban
manager: philmea
ms.author: kgremban
ms.reviewer: arduppal
ms.date: 05/21/2019
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.custom: seodec18
ms.openlocfilehash: 396af2dfd9fc53c080163a27e376328c1369d5e1
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "65991469"
---
# <a name="store-data-at-the-edge-with-azure-blob-storage-on-iot-edge-preview"></a>Хранение данных на границе с помощью хранилища BLOB-объектов Azure в IoT Edge (предварительная версия)

Хранилище BLOB-объектов Azure в IoT Edge предоставляет решение по хранению [блочных BLOB-объектов](https://docs.microsoft.com/rest/api/storageservices/understanding-block-blobs--append-blobs--and-page-blobs#about-block-blobs) на пограничных устройствах. Модуль хранилища BLOB-объектов на устройстве IoT Edge ведет себя как служба BLOB-объектов Azure, но блочные BLOB-объекты хранятся локально на вашем устройстве IoT Edge. Вы можете получить доступ к BLOB-объектам с помощью тех же методов SDK службы хранилища Azure или вызовов API к блочным BLOB-объектам, к которым вы уже привыкли.

> [!NOTE]
> Хранилище BLOB-объектов в IoT Edge находится в [общедоступной предварительной версии](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

Этот модуль поставляется с **распределение по уровням** и **time-to-live** функции.

> [!NOTE]
> Распределение по уровням в настоящее время и время жизни функциональные возможности доступны только в Linux AMD64 и Linux ARM32.

**Распределение по уровням** можно настроить функциональные возможности, которая позволяет автоматически загружать данные из вашего локального хранилища в Azure с поддержкой подключения периодически internet. Также вы можете:

- Включить ON/OFF функция распределения по уровням
- Выберите порядок, в котором данные копируются в Azure, например NewestFirst или OldestFirst
- Укажите учетную запись хранения Azure, к которому требуется, чтобы загружены данные.
- Укажите контейнеров, которые вы хотите отправить в Azure. Этот модуль позволяет указать исходные и целевые имена контейнеров.
- Полное распределение по уровням для BLOB-объектов (с помощью `Put Blob` операции) и блокировки уровня распределение по уровням (с помощью `Put Block` и `Put Block List` операций).

Этот модуль использует блок уровня распределение по уровням, если большой двоичный объект состоит из блоков. Ниже приведены некоторые из распространенных сценариев.

- Приложение обновляет некоторые блоки, ранее загруженного BLOB-объекта, этот модуль отправляет только обновленные блоков и не весь большой двоичный объект.
- Модуль является отправка больших двоичных объектов и подключение к Интернету исчезает, когда подключение к обратно попытку отправки только оставшихся блоков и не весь большой двоичный объект.

Если непредвиденное завершение процесса (например, сбой электропитания) происходит во время передачи большого двоичного объекта, все блоки, которые выполнялись для передачи, будет отправлен еще раз, после возвращения модуля.

**Время жизни** (TTL) является настраиваемые функции, где модуль автоматически удаляет большие двоичные объекты из локального хранилища по истечении указанного времени (измеряется в минутах). Срок ЖИЗНИ позволяет:

- Включить ON/OFF функция распределения по уровням
- Укажите значение срока ЖИЗНИ в минутах

Сценарии, где данные, такие как видео, изображения, процент данных, данных больницы или любые данные, которые необходимо сохранить локально, более поздней версии, может быть обработан локально или передаваться в облако — это хорошие примеры использования модуля.

В этой статье приведены инструкции по развертыванию хранилища BLOB-объектов Azure в контейнере IoT Edge, в котором работает служба BLOB-объектов на вашем устройстве IoT Edge.

> [!NOTE]
> Термины «auto-распределение по уровням» и «auto-истечение срока действия» используемую в этом видео были заменены «по уровням компонента» и «time-to-live».

Посмотреть видео по Краткое введение
> [!VIDEO https://www.youtube.com/embed/wkprcfVidyM]

## <a name="prerequisites"></a>Технические условия

Устройство Azure IoT Edge.

- Компьютере или виртуальной машине можно использовать как устройства IoT Edge, выполнив действия, описанные в кратком руководстве для [Linux](quickstart-linux.md) или [устройств Windows](quickstart.md).

- Хранилище BLOB-объектов в модуле IoT Edge поддерживает следующие конфигурации устройств:

  | Операционная система | Архитектура |
  | ---------------- | ----- | ----- |
  | Ubuntu Server 16.04 | AMD64 |
  | Ubuntu Server 18.04 | AMD64 |
  | Windows 10 IoT Core (обновление за октябрь) | AMD64 |
  | Windows 10 IoT Enterprise (обновление за октябрь) | AMD64 |
  | Windows Server 2019 | AMD64 |
  | Raspbian-stretch | ARM32 |

Облачные ресурсы.

[Центр Интернета вещей](../iot-hub/iot-hub-create-through-portal.md) цен. категории "Стандартный" в Azure.

## <a name="tiering-and-time-to-live-properties"></a>Свойства распределения по уровням и time-to-live

Используйте требуемые свойства, чтобы задать распределение по уровням и time-to-live свойства. Их можно задать во время развертывания или изменить позднее, изменив двойник модуля без необходимости повторного развертывания. Мы рекомендуем использовать проверки «Двойник модуля» `reported configuration` и `configurationValidation` чтобы убедиться в том, правильно передаются значения.

### <a name="tiering-properties"></a>Свойства распределения по уровням

Этот параметр называется `tieringSettings`

| Поле | Возможные значения | Объяснение |
| ----- | ----- | ---- |
| tieringOn | true, false | По умолчанию ему присваивается `false`, если вы хотите включить его на задайте для него значение `true`|
| backlogPolicy | NewestFirst, OldestFirst | Позволяет выбрать порядок, в котором данные копируются в Azure. По умолчанию ему присваивается `OldestFirst`. Порядок определяется время последнего изменения большого двоичного объекта |
| remoteStorageConnectionString |  | `"DefaultEndpointsProtocol=https;AccountName=<your Azure Storage Account Name>;AccountKey=<your Azure Storage Account Key>;EndpointSuffix=<your end point suffix>"` строки подключения, которая позволяет указать учетную запись хранения Azure, к которому требуется, чтобы данные отправки. Укажите `Azure Storage Account Name`, `Azure Storage Account Key`, `End point suffix`. Добавьте соответствующие EndpointSuffix Azure где данные будут загружены, она меняется для глобальной платформы Azure, Azure для государственных организаций и Microsoft Azure Stack. |
| tieredContainers | `"<source container name1>": {"target": "<target container name>"}`,<br><br> `"<source container name1>": {"target": "%h-%d-%m-%c"}`, <br><br> `"<source container name1>": {"target": "%d-%c"}` | Позволяет указать имена контейнеров, который вы хотите отправить в Azure. Этот модуль позволяет указать исходные и целевые имена контейнеров. Если не указать имя целевого контейнера, он будет автоматически назначить имя контейнера как `<IoTHubName>-<IotEdgeDeviceName>-<ModuleName>-<ContainerName>`. Можно создавать строки шаблона для имени целевой контейнер, ознакомьтесь с возможными значениями столбца. <br>* %h "->" имя центра Интернета вещей (3 – 50 символов). <br>* %d "->" идентификатор устройства Интернета вещей (от 1 до 129 символов). <br>* %m "->" имя модуля (от 1 до 64 символов). <br>* %c "->" имя исходного контейнера (от 3 до 63 символов). <br><br>Максимальный размер имени контейнера — 63 символа, при автоматически назначении имя целевого контейнера, если размер контейнера больше, чем 63 символов, которые он удалит каждый раздел (IoTHubName, IotEdgeDeviceName, имя модуля, ContainerName) до 15 символов. |

### <a name="time-to-live-properties"></a>Свойства Time-to-live

Этот параметр называется `ttlSettings`

| Поле | Возможные значения | Объяснение |
| ----- | ----- | ---- |
| ttlOn | true, false | По умолчанию ему присваивается `false`, если вы хотите включить его на задайте для него значение `true`|
| timeToLiveInMinutes | `<minutes>` | Укажите значение срока ЖИЗНИ в минутах. Модуль будет автоматически удалять больших двоичных объектов из локального хранилища после истечения срока действия |

## <a name="configure-log-files"></a>Настройка файлов журнала

Сведения о настройке файлы журналов для вашего модуля, см. в статье эти [рекомендации для рабочей среды](https://docs.microsoft.com/azure/iot-edge/production-checklist#set-up-logs-and-diagnostics).

## <a name="connect-to-your-blob-storage-module"></a>Подключение к модулю хранилища BLOB-объектов

Вы можете использовать имя учетной записи и ключ учетной записи, настроенные для вашего модуля, для доступа к хранилищу BLOB-объектов на устройстве IoT Edge.

Укажите устройство IoT Edge в качестве конечной точки большого двоичного объекта для любых запросов к хранилищу. Вы можете [создать строку подключения для явной конечной точки хранилища](../storage/common/storage-configure-connection-string.md#create-a-connection-string-for-an-explicit-storage-endpoint) с помощью сведений об устройстве IoT Edge и имени учетной записи.

- Для модулей, которые развертываются на одном устройстве как запущенным хранилище BLOB-объектов в модуле IoT Edge, является конечная точка BLOB-объектов: `http://<module name>:11002/<account name>`.
- Для модулей, которые развернуты на устройстве, отличном от где хранилище BLOB-объектов в модуле IoT Edge под управлением, то в зависимости от настроек большого двоичного объекта конечной точки является одним из:
  - `http://<device IP >:11002/<account name>`
  - `http://<IoT Edge device hostname>:11002/<account name>`
  - `http://<fully qualified domain name>:11002/<account name>`

## <a name="azure-blob-storage-quickstart-samples"></a>Примеры для быстрого запуска Azure хранилище BLOB-объектов

Документация по хранилищу BLOB-объектов Azure содержит краткие руководства с примерами кода на нескольких языках. Можно запустить эти примеры, чтобы проверить хранилище BLOB-объектов Azure в IoT Edge путем изменения конечной точки большого двоичного объекта для подключения к вашему модулю хранилища BLOB-объектов.

В следующих кратких руководствах используются языки, которые также поддерживаются в IoT Edge, поэтому их можно развернуть как модули IoT Edge наряду с модулями хранилища BLOB-объектов:

- [.NET](../storage/blobs/storage-quickstart-blobs-dotnet.md)
- [Java](../storage/blobs/storage-quickstart-blobs-java.md)
- [Python](../storage/blobs/storage-quickstart-blobs-python.md)
- [Node.js](../storage/blobs/storage-quickstart-blobs-nodejs.md)

## <a name="connect-to-your-local-storage-with-azure-storage-explorer"></a>Подключение в локальное хранилище с помощью обозревателя хранилищ Azure

Можно использовать **обозреватель службы хранилища Azure** для подключения к учетной записи локального хранилища. Эта функция доступна только [обозреватель службы хранилища Azure версии 1.5.0](https://github.com/Microsoft/AzureStorageExplorer/releases/tag/v1.5.0).

> [!NOTE]
> Выполняя следующие действия, например добавления подключения к учетной записи локального хранилища или создание контейнеров в учетной записи локального хранилища, могут возникнуть ошибки. Пропустите это сообщение и обновления.

1. Скачайте и установите обозреватель службы хранилища Azure

1. Подключение к службе хранилища Azure с помощью строки подключения

1. Укажите строку подключения: `DefaultEndpointsProtocol=http;BlobEndpoint=http://<host device name>:11002/<your local account name>;AccountName=<your local account name>;AccountKey=<your local account key>;`

1. Выполните действия по подключению.

1. Создание контейнера в учетной записи локального хранилища

1. Начните отправлять файлы как блочные BLOB-объекты.
   > [!NOTE]
   > Этот модуль не поддерживает страничных BLOB-объектов.

1. Вы можете подключиться учетных записей хранения Azure, где вы отправляете данные. Он предоставляет единое представление для учетной записи хранения Azure и локальной учетной записи хранения

## <a name="supported-storage-operations"></a>Поддерживаемые операции в хранилище

Модули службы хранилища больших двоичных объектов в IoT Edge используйте те же пакеты SDK хранилища Azure и согласованы с версии 2017-04-17 API службы хранилища Azure для конечных точек большой двоичный объект блока. Более поздние версии зависят от потребностей клиентов.

Так как хранилище BLOB-объектов Azure в IoT Edge поддерживает не все операции в хранилище BLOB-объектов, в этом разделе перечислены состояния каждого из них.

### <a name="account"></a>Учетная запись.

Поддерживается:

- Перечисление контейнеров

Не поддерживается:

- Получение и задание свойств службы BLOB-объектов
- Предварительный запрос к BLOB-объектам
- Получение статистики службы BLOB-объектов
- Получение данных об учетной записи

### <a name="containers"></a>Контейнеры

Поддерживается:

- Создание и удаление контейнера
- Получение свойств и метаданных контейнера
- Отображение списка больших двоичных объектов
- Получение и задание списка управления доступом для контейнера
- Определение метаданных контейнера

Не поддерживается:

- Аренда контейнера

### <a name="blobs"></a>BLOB-объекты

Поддерживается:

- Помещение, получение и удаление BLOB-объекта
- Получение и задание свойств BLOB-объекта
- Получение и задание метаданных BLOB-объекта

Не поддерживается:

- Аренда BLOB-объекта
- Создание моментального снимка BLOB-объекта
- Копирование и прерывание копирования BLOB-объекта
- Отмена удаления BLOB-объекта
- Установка уровня BLOB-объекта

### <a name="block-blobs"></a>Блочные BLOB-объекты

Поддерживается:

- Вставка блока
- Вставка и получение списка блоков

Не поддерживается:

- Вставка блока по URL-адресу

## <a name="feedback"></a>Отзыв

Ваш отзыв важен для нас, чтобы сделать этот модуль и его компонентах, полезными и простой в использовании. Отправьте свой отзыв и дайте нам знать, как мы можем улучшить.

Вы можете связаться с нами по адресу absiotfeedback@microsoft.com

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о [развернуть хранилище BLOB-объектов Azure в IoT Edge](how-to-deploy-blob.md)
