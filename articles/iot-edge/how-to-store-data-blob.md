---
title: Хранение блочных BLOB-объектов на устройствах — Azure IoT Edge | Документация Майкрософт
description: Понять возможности по уровням и их время жизни, см. в разделе операций поддерживаемых BLOB-объектов в хранилище и подключиться к вашей учетной записи хранения BLOB-объектов.
author: arduppal
manager: mchad
ms.author: arduppal
ms.reviewer: arduppal
ms.date: 06/19/2019
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.custom: seodec18
ms.openlocfilehash: f70ca550f1688551abb94bb30ba4f76eb3c36404
ms.sourcegitcommit: 82efacfaffbb051ab6dc73d9fe78c74f96f549c2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/20/2019
ms.locfileid: "67303964"
---
# <a name="store-data-at-the-edge-with-azure-blob-storage-on-iot-edge-preview"></a>Хранение данных на границе с помощью хранилища BLOB-объектов Azure в IoT Edge (предварительная версия)

Хранилище BLOB-объектов Azure в IoT Edge предоставляет решение по хранению [блочных BLOB-объектов](https://docs.microsoft.com/rest/api/storageservices/understanding-block-blobs--append-blobs--and-page-blobs#about-block-blobs) на пограничных устройствах. Модуль хранилища BLOB-объектов на устройстве IoT Edge ведет себя как служба BLOB-объектов Azure, но блочные BLOB-объекты хранятся локально на вашем устройстве IoT Edge. Вы можете получить доступ к BLOB-объектам с помощью тех же методов SDK службы хранилища Azure или вызовов API к блочным BLOB-объектам, к которым вы уже привыкли.

Этот модуль поставляется с **deviceToCloudUpload** и **deviceAutoDelete** функции.
> [!NOTE]
> Хранилище BLOB-объектов в IoT Edge находится в [общедоступной предварительной версии](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

Посмотреть видео по Краткое введение
> [!VIDEO https://www.youtube.com/embed/QhCYCvu3tiM]

**deviceToCloudUpload** можно настроить функциональные возможности, которая позволяет автоматически загружать данные из вашего локального хранилища в Azure с поддержкой подключения периодически internet. Также вы можете:

- Включить ON/OFF функцию deviceToCloudUpload.
- Выберите порядок, в котором данные копируются в Azure, например NewestFirst или OldestFirst.
- Укажите учетную запись хранения Azure, к которому требуется, чтобы загружены данные.
- Укажите контейнеров, которые вы хотите отправить в Azure. Этот модуль позволяет указать исходные и целевые имена контейнеров.
- Выбрать возможность немедленно, удаление больших двоичных объектов после завершения отправки в Облачное хранилище
- Полная передаче большого двоичного объекта (с помощью `Put Blob` операции) и передачу уровня блокировки (с помощью `Put Block` и `Put Block List` операций).

Этот модуль использует передачу уровня блокировки, если большой двоичный объект состоит из блоков. Ниже приведены некоторые из распространенных сценариев.

- Приложение обновляет некоторые блоки, ранее загруженного BLOB-объекта, этот модуль отправляет только обновленные блоков и не весь большой двоичный объект.
- Модуль является отправка больших двоичных объектов и подключение к Интернету исчезает, когда подключение к обратно попытку отправки только оставшихся блоков и не весь большой двоичный объект.

Если непредвиденное завершение процесса (например, сбой электропитания) происходит во время передачи большого двоичного объекта, все блоки, которые выполнялись для передачи, будет отправлен еще раз, после возвращения модуля.

**deviceAutoDelete** — это настраиваемые функции, где модуль автоматически удаляет большие двоичные объекты из локального хранилища по истечении указанного времени (измеряется в минутах). Также вы можете:

- Включить ON/OFF функцию deviceAutoDelete.
- Укажите время в минутах (deleteAfterMinutes), после которой большие двоичные объекты будут автоматически удалены.
- Выберите возможность сохранения большого двоичного объекта в ходе загрузки по истечении deleteAfterMinutes значение.

Сценарии, где данные, такие как видео, изображения, процент данных, данных больницы или любые данные, которые необходимо сохранить локально, более поздней версии, может быть обработан локально или передаваться в облако — это хорошие примеры использования модуля.

В этой статье описываются основные понятия, связанные с хранилище BLOB-объектов в контейнере IoT Edge, который запускает службу BLOB-объектов на вашем устройстве IoT Edge.

## <a name="prerequisites"></a>Технические условия

Устройство Azure IoT Edge.

- Компьютере или виртуальной машине можно использовать как устройства IoT Edge, выполнив действия, описанные в кратком руководстве для [Linux](quickstart-linux.md) или [устройств Windows](quickstart.md).

- Хранилище BLOB-объектов в модуле IoT Edge поддерживает следующие конфигурации устройств:

  | Операционная система | Архитектура |
  | ---------------- | ----- | ----- |
  | Ubuntu Server 16.04 | AMD64 |
  | Ubuntu Server 18.04 | AMD64 |
  | Windows 10 IoT Enterprise | AMD64 |
  | Windows Server 2019 | AMD64 |
  | Raspbian-stretch | ARM32 |

Облачные ресурсы.

[Центр Интернета вещей](../iot-hub/iot-hub-create-through-portal.md) цен. категории "Стандартный" в Azure.

## <a name="devicetocloudupload-and-deviceautodelete-properties"></a>свойства deviceToCloudUpload и deviceAutoDelete

Чтобы задать deviceToCloudUploadProperties и deviceAutoDeleteProperties с помощью требуемых свойств. Их можно задать во время развертывания или изменить позднее, изменив двойник модуля без необходимости повторного развертывания. Мы рекомендуем использовать проверки «Двойник модуля» `reported configuration` и `configurationValidation` чтобы убедиться в том, правильно передаются значения.

### <a name="devicetoclouduploadproperties"></a>deviceToCloudUploadProperties

Этот параметр называется `deviceToCloudUploadProperties`

| Поле | Возможные значения | Объяснение |
| ----- | ----- | ---- |
| uploadOn | true, false | По умолчанию ему присваивается `false`, если вы хотите включить его на задайте для него значение `true`|
| uploadOrder | NewestFirst, OldestFirst | Позволяет выбрать порядок, в котором данные копируются в Azure. По умолчанию ему присваивается `OldestFirst`. Порядок определяется время последнего изменения большого двоичного объекта |
| cloudStorageConnectionString |  | `"DefaultEndpointsProtocol=https;AccountName=<your Azure Storage Account Name>;AccountKey=<your Azure Storage Account Key>;EndpointSuffix=<your end point suffix>"` строки подключения, которая позволяет указать учетную запись хранения Azure, к которому требуется, чтобы данные отправки. Укажите `Azure Storage Account Name`, `Azure Storage Account Key`, `End point suffix`. Добавьте соответствующие EndpointSuffix Azure где данные будут загружены, она меняется для глобальной платформы Azure, Azure для государственных организаций и Microsoft Azure Stack. |
| storageContainersForUpload | `"<source container name1>": {"target": "<target container name>"}`,<br><br> `"<source container name1>": {"target": "%h-%d-%m-%c"}`, <br><br> `"<source container name1>": {"target": "%d-%c"}` | Позволяет указать имена контейнеров, который вы хотите отправить в Azure. Этот модуль позволяет указать исходные и целевые имена контейнеров. Если не указать имя целевого контейнера, он будет автоматически назначить имя контейнера как `<IoTHubName>-<IotEdgeDeviceID>-<ModuleName>-<SourceContainerName>`. Можно создавать строки шаблона для имени целевой контейнер, ознакомьтесь с возможными значениями столбца. <br>* %h "->" имя центра Интернета вещей (3 – 50 символов). <br>* %d "->" идентификатор устройства IoT Edge (от 1 до 129 символов). <br>* %m "->" имя модуля (от 1 до 64 символов). <br>* %c "->" имя исходного контейнера (от 3 до 63 символов). <br><br>Максимальный размер имени контейнера — 63 символа, при автоматически присвоении имя целевого контейнера, если размер контейнера больше, чем 63 символов, которые он удалит каждый раздел (IoTHubName, IotEdgeDeviceID, имя модуля, SourceContainerName) 15 символы. |
| deleteAfterUpload | true, false | По умолчанию ему присваивается `false`. Когда он становится равным `true`, оно автоматически удалит данные после завершения отправки в Облачное хранилище |

### <a name="deviceautodeleteproperties"></a>deviceAutoDeleteProperties

Этот параметр называется `deviceAutoDeleteProperties`

| Поле | Возможные значения | Объяснение |
| ----- | ----- | ---- |
| deleteOn | true, false | По умолчанию ему присваивается `false`, если вы хотите включить его на задайте для него значение `true`|
| deleteAfterMinutes | `<minutes>` | Укажите время в минутах. Модуль автоматически удалять большие двоичные объекты из локального хранилища, по истечении срока действия этого значения |
| retainWhileUploading | true, false | По умолчанию ему присваивается `true`, и большого двоичного объекта во время его отправки в Облачное хранилище Если deleteAfterMinutes истечения срока действия. Можно задать значение `false` и сразу же после истечения срока действия deleteAfterMinutes удалит данные. Примечание. Для этого свойства для работы uploadOn следует установить значение true|

## <a name="configure-log-files"></a>Настройка файлов журнала

Сведения о настройке файлы журналов для вашего модуля, см. в статье эти [рекомендации для рабочей среды](https://docs.microsoft.com/azure/iot-edge/production-checklist#set-up-logs-and-diagnostics).

## <a name="connect-to-your-blob-storage-module"></a>Подключение к модулю хранилища BLOB-объектов

Вы можете использовать имя учетной записи и ключ учетной записи, настроенные для вашего модуля, для доступа к хранилищу BLOB-объектов на устройстве IoT Edge.

Укажите устройство IoT Edge в качестве конечной точки большого двоичного объекта для любых запросов к хранилищу. Вы можете [создать строку подключения для явной конечной точки хранилища](../storage/common/storage-configure-connection-string.md#create-a-connection-string-for-an-explicit-storage-endpoint) с помощью сведений об устройстве IoT Edge и имени учетной записи.

- Для модулей, которые развертываются на одном устройстве как запущенным хранилище BLOB-объектов в модуле IoT Edge, является конечная точка BLOB-объектов: `http://<module name>:11002/<account name>`.
- Для внешних модулях или приложений, запущенных на устройстве, отличном от где хранилище BLOB-объектов в модуле IoT Edge под управлением, то в зависимости от настроек сети таким образом, чтобы трафик данных из внешнего модуля или приложения могут подключиться к устройству Хранилище BLOB-объектов Azure под управлением модуля IoT Edge, конечная точка BLOB-объектов является одним из:
  - `http://<device IP >:11002/<account name>`
  - `http://<IoT Edge device hostname>:11002/<account name>`
  - `http://<fully qualified domain name>:11002/<account name>`

## <a name="azure-blob-storage-quickstart-samples"></a>Примеры для быстрого запуска Azure хранилище BLOB-объектов

В документации хранилища больших двоичных объектов включает кратком руководстве пример кода на нескольких языках. Можно запустить эти примеры, чтобы проверить хранилище BLOB-объектов Azure в IoT Edge путем изменения конечной точки большого двоичного объекта для подключения к вашему модулю локального BLOB-объектов хранилища.

Следующие примеры для быстрого запуска используйте языки, которые также поддерживаются в IoT Edge, поэтому их можно развернуть как модули Edge Интернета вещей вместе с модуль службы хранилища больших двоичных объектов:

- [.NET](../storage/blobs/storage-quickstart-blobs-dotnet.md)
- [Java](../storage/blobs/storage-quickstart-blobs-java.md)
- [Python](../storage/blobs/storage-quickstart-blobs-python.md)
- [Node.js](../storage/blobs/storage-quickstart-blobs-nodejs.md)

## <a name="connect-to-your-local-storage-with-azure-storage-explorer"></a>Подключение в локальное хранилище с помощью обозревателя хранилищ Azure

Можно использовать [обозреватель службы хранилища Azure](https://azure.microsoft.com/features/storage-explorer/) для подключения к учетной записи локального хранилища.

1. Скачайте и установите обозреватель службы хранилища Azure

1. Подключение к службе хранилища Azure с помощью строки подключения

1. Укажите строку подключения: `DefaultEndpointsProtocol=http;BlobEndpoint=http://<host device name>:11002/<your local account name>;AccountName=<your local account name>;AccountKey=<your local account key>;`

1. Выполните действия по подключению.

1. Создание контейнера в учетной записи локального хранилища

1. Начните отправлять файлы как блочные BLOB-объекты.
   > [!NOTE]
   > Этот модуль не поддерживает страничных BLOB-объектов.

1. Вы можете подключиться учетных записей хранения Azure, где вы отправляете данные. Он предоставляет единое представление для учетной записи хранения Azure и локальной учетной записи хранения

## <a name="supported-storage-operations"></a>Поддерживаемые операции в хранилище

Модули службы хранилища больших двоичных объектов в IoT Edge используйте те же пакеты SDK хранилища Azure и согласованы с версии 2017-04-17 API службы хранилища Azure для конечных точек большой двоичный объект блока. Более поздние версии зависят от потребностей клиентов.

Так как хранилище BLOB-объектов Azure в IoT Edge поддерживает не все операции в хранилище BLOB-объектов, в этом разделе перечислены состояния каждого из них.

### <a name="account"></a>Учетная запись.

Поддерживается:

- Перечисление контейнеров

Не поддерживается:

- Получение и задание свойств службы BLOB-объектов
- Предварительный запрос к BLOB-объектам
- Получение статистики службы BLOB-объектов
- Получение данных об учетной записи

### <a name="containers"></a>Контейнеры

Поддерживается:

- Создание и удаление контейнера
- Получение свойств и метаданных контейнера
- Отображение списка больших двоичных объектов
- Получение и задание списка управления доступом для контейнера
- Определение метаданных контейнера

Не поддерживается:

- Аренда контейнера

### <a name="blobs"></a>BLOB-объекты

Поддерживается:

- Помещение, получение и удаление BLOB-объекта
- Получение и задание свойств BLOB-объекта
- Получение и задание метаданных BLOB-объекта

Не поддерживается:

- Аренда BLOB-объекта
- Создание моментального снимка BLOB-объекта
- Копирование и прерывание копирования BLOB-объекта
- Отмена удаления BLOB-объекта
- Установка уровня BLOB-объекта

### <a name="block-blobs"></a>Блочные BLOB-объекты

Поддерживается:

- Вставка блока
- Вставка и получение списка блоков

Не поддерживается:

- Вставка блока по URL-адресу

## <a name="release-notes"></a>Заметки о выпуске

Ниже приведены [комментариях на docker hub](https://hub.docker.com/_/microsoft-azure-blob-storage) для этого модуля

## <a name="feedback"></a>Отзыв

Ваш отзыв важен для нас, чтобы сделать этот модуль и его компонентах, полезными и простой в использовании. Отправьте свой отзыв и дайте нам знать, как мы можем улучшить.

Вы можете связаться с нами по адресу absiotfeedback@microsoft.com

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о [развернуть хранилище BLOB-объектов Azure в IoT Edge](how-to-deploy-blob.md)
