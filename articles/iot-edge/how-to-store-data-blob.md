---
title: Хранение блочных BLOB-объектов на устройствах — Azure IoT Edge | Документация Майкрософт
description: Общие сведения о распределении по уровням и срокам жизни см. в статье поддерживаемые операции с хранилищем BLOB-объектов и подключение к учетной записи хранилища BLOB-объектов.
author: arduppal
manager: mchad
ms.author: arduppal
ms.reviewer: arduppal
ms.date: 06/19/2019
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.custom: seodec18
ms.openlocfilehash: c90a0351c8c71f4fcafa58a422cc3566a0b29b03
ms.sourcegitcommit: fa45c2bcd1b32bc8dd54a5dc8bc206d2fe23d5fb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/12/2019
ms.locfileid: "67850098"
---
# <a name="store-data-at-the-edge-with-azure-blob-storage-on-iot-edge-preview"></a>Хранение данных на границе с помощью хранилища BLOB-объектов Azure в IoT Edge (предварительная версия)

Хранилище BLOB-объектов Azure в IoT Edge предоставляет решение по хранению [блочных BLOB-объектов](https://docs.microsoft.com/rest/api/storageservices/understanding-block-blobs--append-blobs--and-page-blobs#about-block-blobs) на пограничных устройствах. Модуль хранилища BLOB-объектов на устройстве IoT Edge ведет себя как служба BLOB-объектов Azure, но блочные BLOB-объекты хранятся локально на вашем устройстве IoT Edge. Вы можете получить доступ к BLOB-объектам с помощью тех же методов SDK службы хранилища Azure или вызовов API к блочным BLOB-объектам, к которым вы уже привыкли.

Этот модуль поставляется с функциями **девицетоклаудуплоад** и **девицеаутоделете** .
> [!NOTE]
> Хранилище BLOB-объектов в IoT Edge находится в [общедоступной предварительной версии](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

Просмотрите видео, чтобы ознакомиться с краткими сведениями
> [!VIDEO https://www.youtube.com/embed/QhCYCvu3tiM]

**девицетоклаудуплоад** — это настраиваемая функциональность, которая позволяет автоматически отправлять данные из локального хранилища BLOB-объектов в Azure с периодическим подключением к Интернету. Она позволяет:

- Включите или ВЫКЛЮЧИТе функцию Девицетоклаудуплоад.
- Выберите порядок, в котором данные копируются в Azure, например Невестфирст или OldestFirst.
- Укажите учетную запись хранения Azure, в которую будут передаваться ваши данные.
- Укажите контейнеры, которые необходимо передать в Azure. Этот модуль позволяет указать имена исходного и целевого контейнеров.
- Выберите возможность немедленного удаления больших двоичных объектов после отправки в облачное хранилище
- Выполнение полной передачи большого двоичного `Put Blob` объекта (с помощью операции) и передачи `Put Block` на `Put Block List` уровне блока (с помощью операций и).

Этот модуль использует передачу на уровне блоков, если большой двоичный объект состоит из блоков. Ниже приведены некоторые распространенные сценарии.

- Приложение обновляет некоторые блоки ранее отправленного большого двоичного объекта. Этот модуль отправляет только обновленные блоки, а не весь большой двоичный объект.
- Модуль отправляет большой двоичный объект и подключение к Интернету исчезает. при повторном подключении происходит загрузка только оставшихся блоков, а не всего большого двоичного объекта.

Если при передаче большого двоичного объекта происходит непредвиденное завершение процесса (например, сбой питания), все блоки, которые были выполнены при передаче, передаются повторно, когда модуль возвращается в режим «в сети».

**девицеаутоделете** — это настраиваемая функция, при которой модуль автоматически удаляет большие двоичные объекты из локального хранилища по истечении указанного времени (измеряется в минутах). Она позволяет:

- Включите или ВЫКЛЮЧИТе функцию Девицеаутоделете.
- Укажите время в минутах (Делетеафтерминутес), по истечении которого большие двоичные объекты будут автоматически удалены.
- Выберите возможность хранения большого двоичного объекта при отправке, если Делетеафтерминутес значение истекает.

Ниже приведены примеры использования этого модуля для данных, таких как видео, изображения, финансовые данные, сведения о больницы или любые данные, которые необходимо сохранить локально.

В этой статье объясняются основные понятия, связанные с хранилищем BLOB-объектов Azure, в контейнере IoT Edge, где выполняется служба больших двоичных объектов на устройстве IoT Edge.

## <a name="prerequisites"></a>предварительные требования

Устройство Azure IoT Edge.

- Вы можете использовать компьютер разработки или виртуальную машину в качестве IoT Edge устройства, выполнив действия, описанные в кратком руководстве для устройств [Linux](quickstart-linux.md) или [Windows](quickstart.md).

- Хранилище BLOB-объектов в модуле IoT Edge поддерживает следующие конфигурации устройств:

  | Операционная система | AMD64 | ARM32v7 | ARM64 |
  | ---------------- | ----- | ----- | ---- |
  | Raspbian-stretch | Нет | Да | Нет |  
  | Ubuntu Server 16.04 | Да | Нет | Да (доступно для [установки](how-to-install-iot-edge-linux-arm.md#install-a-specific-version) с [Azure IOT EDGE 1.0.8-RC1 и более поздних версий](https://github.com/Azure/azure-iotedge/releases)) |
  | Ubuntu Server 18.04 | Да | Нет | Да (доступно для [установки](how-to-install-iot-edge-linux-arm.md#install-a-specific-version) с [Azure IOT EDGE 1.0.8-RC1 и более поздних версий](https://github.com/Azure/azure-iotedge/releases)) |
  | Windows 10 IoT Корпоративная, сборка 17763 | Да | Нет | Нет |
  | Windows Server 2019, сборка 17763 | Да | Нет | Нет |
  

Облачные ресурсы.

[Центр Интернета вещей](../iot-hub/iot-hub-create-through-portal.md) цен. категории "Стандартный" в Azure.

## <a name="devicetocloudupload-and-deviceautodelete-properties"></a>свойства Девицетоклаудуплоад и Девицеаутоделете

Используйте нужные свойства для установки Девицетоклаудуплоадпропертиес и Девицеаутоделетепропертиес. Их можно задать во время развертывания или изменить позже, изменив модуль двойника без необходимости повторного развертывания. Рекомендуется проверить "двойника модуля" для `reported configuration` и `configurationValidation` убедиться, что значения правильно распространены.

### <a name="devicetoclouduploadproperties"></a>девицетоклаудуплоадпропертиес

Имя этого параметра —`deviceToCloudUploadProperties`

| Поле | Возможные значения | Объяснение | Переменная среды |
| ----- | ----- | ---- | ---- |
| уплоадон | true, false | По умолчанию он имеет значение `false`, если вы хотите включить его, задав для него значение.`true`| `deviceToCloudUploadProperties__uploadOn={false,true}` |
| уплоадордер | Невестфирст, OldestFirst | Позволяет выбрать порядок, в котором данные копируются в Azure. По умолчанию он имеет значение `OldestFirst`. Порядок определяется временем последнего изменения BLOB-объекта. | `deviceToCloudUploadProperties__uploadOrder={NewestFirst,OldestFirst}` |
| клаудсторажеконнектионстринг |  | `"DefaultEndpointsProtocol=https;AccountName=<your Azure Storage Account Name>;AccountKey=<your Azure Storage Account Key>;EndpointSuffix=<your end point suffix>"`— Это строка подключения, которая позволяет указать учетную запись хранения Azure, в которую будут передаваться ваши данные. Укажите `Azure Storage Account Name`, `Azure Storage Account Key`, .`End point suffix` Добавьте соответствующие EndpointSuffix в Azure, куда будут отправляться данные. это зависит от глобальных Azure, государственных учреждений Azure и Microsoft Azure Stack. | `deviceToCloudUploadProperties__cloudStorageConnectionString=<connection string>` |
| сторажеконтаинерсфоруплоад | `"<source container name1>": {"target": "<target container name>"}`,<br><br> `"<source container name1>": {"target": "%h-%d-%m-%c"}`, <br><br> `"<source container name1>": {"target": "%d-%c"}` | Позволяет указать имена контейнеров, которые нужно передать в Azure. Этот модуль позволяет указать имена исходного и целевого контейнеров. Если не указать имя целевого контейнера, оно будет автоматически назначено имени `<IoTHubName>-<IotEdgeDeviceID>-<ModuleName>-<SourceContainerName>`контейнера. Вы можете создать строки шаблона для имени целевого контейнера, извлеките столбец возможные значения. <br>*% h — > имя центра Интернета вещей (3-50 символов). <br>*% d — > IoT Edge идентификатор устройства (от 1 до 129 символов). <br>*% m — > имя модуля (от 1 до 64 символов). <br>*% c-> имя исходного контейнера (от 3 до 63 символов). <br><br>Максимальный размер имени контейнера составляет 63 символов, при этом автоматически назначается имя целевого контейнера, если размер контейнера превышает 63 символов. Каждый раздел будет обрезан (IoTHubName, Иотеджедевицеид, ModuleName, Саурцеконтаинернаме) до 15. буквы. | `deviceToCloudUploadProperties__storageContainersForUpload__<sourceName>__target: <targetName>` |
| делетеафтеруплоад | true, false | По умолчанию он имеет значение `false`. Если задано значение `true`, то при завершении отправки в облачное хранилище данные будут автоматически удалены. | `deviceToCloudUploadProperties__deleteAfterUpload={false,true}` |


### <a name="deviceautodeleteproperties"></a>девицеаутоделетепропертиес

Имя этого параметра —`deviceAutoDeleteProperties`

| Поле | Возможные значения | Объяснение | Переменная среды |
| ----- | ----- | ---- | ---- |
| делетеон | true, false | По умолчанию он имеет значение `false`, если вы хотите включить его, задав для него значение.`true`| `deviceAutoDeleteProperties__deleteOn={false,true}` |
| делетеафтерминутес | `<minutes>` | Укажите время в минутах. Модуль автоматически удалит BLOB-объекты из локального хранилища, когда это значение истечет | `deviceAutoDeleteProperties__ deleteAfterMinutes=<minutes>` |
| ретаинвхилеуплоадинг | true, false | По умолчанию он имеет значение `true`, и он будет хранить большой двоичный объект при отправке в облачное хранилище, если делетеафтерминутес истекает. Вы можете задать для `false` него значение, и данные будут удалены сразу после истечения срока действия делетеафтерминутес. Примечание. Чтобы это свойство работало Уплоадон, должно быть установлено значение true.| `deviceAutoDeleteProperties__retainWhileUploading={false,true}` |

## <a name="configure-log-files"></a>Настройка файлов журналов

Дополнительные сведения о настройке файлов журналов для модуля [см. в](https://docs.microsoft.com/azure/iot-edge/production-checklist#set-up-logs-and-diagnostics)этих рекомендациях.

## <a name="connect-to-your-blob-storage-module"></a>Подключение к модулю хранилища BLOB-объектов

Вы можете использовать имя учетной записи и ключ учетной записи, настроенные для вашего модуля, для доступа к хранилищу BLOB-объектов на устройстве IoT Edge.

Укажите устройство IoT Edge в качестве конечной точки большого двоичного объекта для любых запросов к хранилищу. Вы можете [создать строку подключения для явной конечной точки хранилища](../storage/common/storage-configure-connection-string.md#create-a-connection-string-for-an-explicit-storage-endpoint) с помощью сведений об устройстве IoT Edge и имени учетной записи.

- Для модулей, развернутых на том же устройстве, что и хранилище BLOB-объектов Azure в модуле IoT Edge, конечная точка большого `http://<module name>:11002/<account name>`двоичного объекта имеет следующее значение:.
- Для внешних модулей или приложений, выполняющихся на другом устройстве, отличном от того, где выполняется модуль хранилища BLOB-объектов Azure в IoT Edge, в зависимости от настройки сети, чтобы трафик данных из внешнего модуля или приложения можно было получить на устройстве. При запуске хранилища BLOB-объектов Azure в модуле IoT Edge конечная точка большого двоичного объекта является одной из следующих:
  - `http://<device IP >:11002/<account name>`
  - `http://<IoT Edge device hostname>:11002/<account name>`
  - `http://<fully qualified domain name>:11002/<account name>`

## <a name="azure-blob-storage-quickstart-samples"></a>Примеры использования хранилища BLOB-объектов Azure

Документация по хранилищу BLOB-объектов Azure содержит примеры кода на нескольких языках. Эти примеры можно выполнить для проверки хранилища BLOB-объектов Azure на IoT Edge, изменив конечную точку большого двоичного объекта, чтобы подключиться к локальному модулю хранилища BLOB-объектов.

В следующих примерах краткого руководства используются языки, которые также поддерживаются IoT Edge, поэтому их можно развернуть как IoT Edge модулей вместе с модулем хранилища BLOB-объектов:

- [.NET](../storage/blobs/storage-quickstart-blobs-dotnet.md)
- [Java](../storage/blobs/storage-quickstart-blobs-java.md)
- [Python](../storage/blobs/storage-quickstart-blobs-python.md)
- [Node.js](../storage/blobs/storage-quickstart-blobs-nodejs.md)

## <a name="connect-to-your-local-storage-with-azure-storage-explorer"></a>Подключение к локальному хранилищу с помощью Обозреватель службы хранилища Azure

Для подключения к локальной учетной записи хранения можно использовать [Обозреватель службы хранилища Azure](https://azure.microsoft.com/features/storage-explorer/) .

1. Скачать и установить Обозреватель службы хранилища Azure

1. Подключение к службе хранилища Azure с помощью строки подключения

1. Укажите строку подключения:`DefaultEndpointsProtocol=http;BlobEndpoint=http://<host device name>:11002/<your local account name>;AccountName=<your local account name>;AccountKey=<your local account key>;`

1. Выполните действия по подключению.

1. Создание контейнера в локальной учетной записи хранения

1. Начать отправку файлов в виде блочных BLOB-объектов.
   > [!NOTE]
   > Этот модуль не поддерживает страничные BLOB-объекты.

1. Вы можете подключить учетные записи хранения Azure, куда вы отправляете данные. Она предоставляет единое представление для локальной учетной записи хранения и учетной записи хранения Azure.

## <a name="supported-storage-operations"></a>Поддерживаемые операции в хранилище

Модули хранилища BLOB-объектов на IoT Edge используют одни и те же пакеты SDK службы хранилища Azure и соответствуют версии 2017-04-17 API службы хранилища Azure для конечных точек блочных BLOB-объектов. Более поздние версии зависят от потребностей клиентов.

Так как хранилище BLOB-объектов Azure поддерживает не все операции хранилища BLOB-объектов Azure на IoT Edge, в этом разделе перечислены состояния каждого из них.

### <a name="account"></a>Учетная запись.

Поддерживается:

- Перечисление контейнеров

Не поддерживается:

- Получение и задание свойств службы BLOB-объектов
- Предварительный запрос к BLOB-объектам
- Получение статистики службы BLOB-объектов
- Получение данных об учетной записи

### <a name="containers"></a>Контейнеры

Поддерживается:

- Создание и удаление контейнера
- Получение свойств и метаданных контейнера
- Отображение списка больших двоичных объектов
- Получение и задание списка управления доступом для контейнера
- Определение метаданных контейнера

Не поддерживается:

- Аренда контейнера

### <a name="blobs"></a>BLOB-объекты

Поддерживается:

- Помещение, получение и удаление BLOB-объекта
- Получение и задание свойств BLOB-объекта
- Получение и задание метаданных BLOB-объекта

Не поддерживается:

- Аренда BLOB-объекта
- Создание моментального снимка BLOB-объекта
- Копирование и прерывание копирования BLOB-объекта
- Отмена удаления BLOB-объекта
- Установка уровня BLOB-объекта

### <a name="block-blobs"></a>Blob-блоки

Поддерживается:

- Вставка блока
- Вставка и получение списка блоков

Не поддерживается:

- Вставка блока по URL-адресу

## <a name="release-notes"></a>Заметки о выпуске

[Заметки о выпуске в центре DOCKER](https://hub.docker.com/_/microsoft-azure-blob-storage) для этого модуля

## <a name="feedback"></a>Отзывы

Ваши отзывы важны для нас, чтобы сделать этот модуль и его компоненты полезными и простыми в использовании. Поделитесь своим мнением и сообщите нам, как можно улучшить.

Вы можете связаться с нами по адресуabsiotfeedback@microsoft.com

## <a name="next-steps"></a>Следующие шаги

Дополнительные сведения о [развертывании хранилища BLOB-объектов Azure на IOT Edge](how-to-deploy-blob.md)
