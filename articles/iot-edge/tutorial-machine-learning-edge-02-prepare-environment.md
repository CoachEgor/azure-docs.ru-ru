---
title: Руководство по настройке среды в службе "Машинное обучение Azure" для Azure IoT Edge
description: Руководство по Подготовка среды для разработки и развертывания модулей для машинного обучения на пограничных устройствах.
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 11/11/2019
ms.topic: tutorial
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: 2ea4248ebaedd318e4112e41169f72bc80b1120f
ms.sourcegitcommit: 598c5a280a002036b1a76aa6712f79d30110b98d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/15/2019
ms.locfileid: "74114077"
---
# <a name="tutorial-set-up-an-environment-for-machine-learning-on-iot-edge"></a>Руководство по настройке среды для машинного обучения в IoT Edge

> [!NOTE]
> Эта статья входит в серию учебников по использованию Машинного обучения Azure в IoT Edge. Если вы перешли к этой статье по прямой ссылке, для оптимальных результатов рекомендуем начать с изучения [первой статьи](tutorial-machine-learning-edge-01-intro.md) этой серии.

Эта статья из полного руководства по Машинному обучению Azure для IoT Edge поможет вам подготовить вашу среду к разработке и развертыванию. Сначала настройте все необходимые инструменты на компьютере для разработки. Затем создайте необходимые облачные ресурсы в Azure.

## <a name="set-up-a-development-machine"></a>Настройка компьютера для разработки

Этот шаг обычно выполняет разработчик облачных решений. Некоторое программное обеспечение, возможно, будет полезным также для специалиста по обработке и анализу данных.

В рамках этой статьи мы выполним различные задачи для разработчиков, включая написание кода, компиляцию, настройку и развертывание модулей IoT Edge, а также устройств Интернета вещей. Для удобства мы разработали скрипт PowerShell, который позволяет создать виртуальную машину Azure с несколькими уже настроенными предварительными инструментами. Виртуальная машина, которую мы создаем, должна иметь возможность обрабатывать [вложенную виртуализацию](https://docs.microsoft.com/azure/virtual-machines/windows/nested-virtualization). Поэтому мы выбрали виртуальную машину [Standard_D8s_v3](../virtual-machines/windows/sizes-general.md#dsv3-series-1).

На виртуальной машине для разработки будут настроены следующие инструменты:

* Windows 10
* [Chocolatey](https://chocolatey.org/);
* [Docker Desktop для Windows](https://www.docker.com/products/docker-desktop);
* [Git для Windows](https://gitforwindows.org/)
* [диспетчер учетных данных Git для Windows](https://github.com/Microsoft/Git-Credential-Manager-for-Windows);
* [пакет SDK для .NET Core](https://dotnet.microsoft.com/).
* [Python 3](https://www.python.org/);
* [Visual Studio Code](https://code.visualstudio.com/)
* [Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview?view=azps-1.1.0)
* [расширения VS Code](https://marketplace.visualstudio.com/search?target=VSCode):
  * [Средства Интернета вещей Azure](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-tools)
  * [Python](https://marketplace.visualstudio.com/items?itemName=ms-python.python)
  * [C#](https://marketplace.visualstudio.com/items?itemName=ms-vscode.csharp)
  * [Docker](https://marketplace.visualstudio.com/items?itemName=PeterJausovec.vscode-docker)
  * [PowerShell](https://marketplace.visualstudio.com/items?itemName=ms-vscode.PowerShell)

Не всегда нужно создавать отдельную виртуальную машину для разработки. Все необходимые инструменты можно запускать на локальном компьютере. Но мы настоятельно рекомендуем работать на виртуальной машине, чтобы обеспечить одинаковые условия.

Создание и настройка виртуальных машин занимает около 30 минут.

### <a name="get-the-script"></a>Получение скрипта

Клонируйте или загрузите скрипт PowerShell из примера репозитория [машинного обучения и IoT Edge](https://github.com/Azure-Samples/IoTEdgeAndMlSample).

### <a name="create-an-azure-virtual-machine"></a>Создание виртуальной машины Azure

Каталог DevVM содержит файлы, необходимые для создания виртуальной машины Azure в целях изучения этого руководства.

1. Откройте PowerShell от имени администратора и перейдите в каталог, в который загрузили код. Корневой каталог источника данных будет называться `<srcdir>`.

    ```powershell
    cd <srcdir>\IoTEdgeAndMlSample\DevVM
    ```

2. Выполните приведенную ниже команду, чтобы разрешить выполнение скриптов. Выберите **Да для всех** при появлении запроса.

    ```powershell
    Set-ExecutionPolicy Bypass -Scope Process
    ```

3. Запустите Create-AzureDevVM.ps1 из этого каталога.

    ```powershell
    .\Create-AzureDevVm.ps1
    ```

    * При появлении запроса введите следующие сведения:
      * **Идентификатор подписки Azure** — ваш идентификатор подписки, который можно найти на портале Azure.
      * **Имя группы ресурсов** — имя новой или имеющейся группы ресурсов в Azure.
      * **Расположение.** выберите расположение Azure, где будет создана виртуальная машина. Например, westus2 или northeurope. Дополнительные сведения см. в разделе о [расположениях Azure](https://azure.microsoft.com/global-infrastructure/locations/).
      * **AdminUsername** — введите запоминающееся имя для учетной записи администратора, которую вы создадите и будете использовать на виртуальной машине.
      * **AdminPassword** — задайте пароль для учетной записи администратора на виртуальной машине.

    * Если у вас не установлен Azure PowerShell, с помощью скрипта будет установлен [модуль Az для Azure PowerShell](https://docs.microsoft.com/powershell/azure/new-azureps-module-az?view=azps-1.1.0).

    * Вам будет предложено войти в Azure.

    * Скрипт подтвердит сведения для создания виртуальной машины. Нажмите клавишу `y` или `Enter`, чтобы продолжить.

Скрипт будет выполнять следующие действия в течение нескольких минут:

* создание группы ресурсов, если ее нет;
* Развертывание виртуальной машины
* включение Hyper-V на виртуальной машине;
* установка программного обеспечения для разработки и клонирование примера репозитория;
* Перезапустите виртуальную машину.
* создание RDP-файла на рабочем столе для подключения к виртуальной машине.

### <a name="set-auto-shutdown-schedule"></a>Настройка расписания автоматического завершения работы

Чтобы сократить затраты, автоматическое завершение работы виртуальной машины установлено на 19:00 по тихоокеанскому времени. Возможно, потребуется изменить это время в зависимости от расположения и расписания работы. Чтобы изменить расписание завершения работы, сделайте следующее:

1. Войдите на [портале Azure](https://portal.azure.com).

2. Перейдите к виртуальной машине в группе ресурсов, которая использовалась в предыдущем разделе.

3. Выберите **Автозавершение работы** в навигаторе.

4. Введите новое значение времени завершения работы в поле **Запланированное завершение работы** или измените значение **Часовой пояс**, затем щелкните **Сохранить**.

### <a name="connect-and-configure-development-machine"></a>Подключение и настройка компьютера для разработки

Теперь, когда мы создали виртуальную машину, нужно завершить установку программного обеспечения, необходимого для работы с этим руководством.

#### <a name="start-a-remote-desktop-session"></a>Запуск сеанса удаленного рабочего стола

1. С помощью скрипта создания виртуальной машины на вашем рабочем столе был создан RDP-файл.

2. Дважды щелкните файл с именем **\<имя виртуальной машины Azure\>.rdp**.

3. Откроется диалоговое окно, информирующее о том, что издатель удаленного подключения неизвестен. Поставьте флажок **Don’t ask me again for connections to this computer** (Больше не спрашивать для подключения к этому компьютеру) и выберите **Подключиться**.

4. При появлении запроса укажите AdminPassword, который использовался при запуске скрипта для настройки виртуальной машины, и нажмите кнопку **ОК**.

5. Вам будет предложено принять сертификат для виртуальной машины. Выберите **Don’t ask me again for connections to this computer** (Больше не спрашивать для подключения к этому компьютеру) и нажмите **Да**.

#### <a name="install-visual-studio-code-extensions"></a>Установка расширений Visual Studio Code

Теперь, когда вы подключились к компьютеру для разработки, добавьте несколько полезных расширений в Visual Studio Code, чтобы упростить разработку.

1. В окне PowerShell перейдите к **C:\\source\\IoTEdgeAndMlSample\\DevVM**.

2. Разрешите скриптам выполняться на виртуальной машине. ДЛя этого введите следующее:

    ```powershell
    Set-ExecutionPolicy Bypass -Scope CurrentUser -Force
    ```

3. Выполните скрипт.

    ```powershell
    .\Enable-CodeExtensions.ps1
    ```

4. D течение нескольких минут с помощью скрипта будут установлены следующие расширения VS Code:

    * Средства Azure IoT
    * Python
    * C#
    * Docker
    * PowerShell

## <a name="set-up-iot-hub-and-storage"></a>Настройка Центра Интернета вещей и службы хранилища

Эти действия обычно выполняет разработчик облака.

Центр Интернета вещей Azure является основой любого приложения Интернета вещей. Он обеспечивает безопасный обмен данными между устройствами Интернета вещей и облаком. Это основной координационный пункт для работы решения IoT Edge для машинного обучения.

* Центр Интернета вещей использует маршруты для направления входящих данных с устройств Интернета вещей в другие подчиненные службы. Мы используем маршруты Центра Интернета вещей для отправки данных устройства в службу хранилища Azure, где их может использовать Машинное обучение Azure для обучения нашего классификатора оставшегося срока полезного использования (RUL).

* Далее в рамках этого руководстве мы будем использовать Центр Интернета вещей для настройки нашего устройства Azure IoT Edge и управления им.

В рамках этого раздела используется скрипт для создания Центра Интернета вещей Azure и учетной записи службы хранилища Azure. Затем настраивается маршрут, который перенаправляет данные, полученные центром, в контейнер BLOB-объектов службы хранилища Azure с помощью портала Azure. Эти действия занимают около 10 минут.

### <a name="create-cloud-resources"></a>Создание облачных ресурсов

1. На компьютере разработки откройте окно PowerShell.

1. Перейдите к каталогу Центра Интернета вещей.

    ```powershell
    cd C:\source\IoTEdgeAndMlSample\IoTHub
    ```

1. Запустите скрипт создания. Используйте те же значения идентификатора подписки, расположения и группы ресурсов, что и при создании виртуальной машины для разработки.

    ```powershell
    .\New-HubAndStorage.ps1 -SubscriptionId <subscription id> -Location
    <location> -ResourceGroupName <resource group>
    ```

    * Вам будет предложено войти в Azure.
    * Скрипт подтверждает сведения для создания Центра и учетной записи хранения. Нажмите клавишу `y` или `Enter`, чтобы продолжить.

Выполнение скрипта занимает около двух минут. По завершении скрипт выводит имя центра и учетной записи хранения.

### <a name="review-route-to-storage-in-iot-hub"></a>Просмотр маршрута для хранения в Центре Интернета вещей

В ходе создания Центра Интернета вещей с помощью скрипта, который мы запускали в предыдущем разделе, также были созданы пользовательская конечная точка и маршрут. Маршруты Центра Интернета вещей состоят из выражения запроса и конечной точки. Если сообщение соответствует выражению, данные отправляются по маршруту в соответствующую конечную точку. Конечными точками могут быть Центры событий, очереди Служебной шины и разделы. В этом случае конечной точкой является контейнер BLOB-объектов в учетной записи хранения. На портале Azure можно просмотреть маршрут, созданный нашим скриптом.

1. Откройте [портал Azure](https://portal.azure.com).

1. Выберите все службы в навигаторе слева, введите "Интернет вещей" в поле поиска и выберите **Центр Интернета вещей**.

1. Выберите Центр Интернета вещей, созданный на предыдущем шаге.

1. В навигаторе Центра Интернета вещей выберите **Маршрутизация сообщений**.

1. Страница маршрутизации сообщений содержит две вкладки: **Маршруты** и **Пользовательские конечные точки**. Выберите вкладку **Пользовательские конечные точки**.

1. В разделе **Хранилище BLOB-объектов** выберите **turbofanDeviceStorage**.

1. Обратите внимание, что эта конечная точка указывает на контейнер BLOB-объектов с именем **devicedata** в учетной записи хранения, созданной на последнем шаге, с именем **iotedgeandml\<уникальный суффикс\>** .

1. Также обратите внимание, что **формат имени BLOB-файла** по умолчанию был изменен, чтобы вместо него поместить раздел в качестве последнего элемента в имени. Мы считаем этот формат более удобным для файловых операций, которые мы будем выполнять с Записными книжками Azure позже в рамках этого руководства.

1. Закройте колонку сведений о конечной точке, чтобы вернуться на страницу **Маршрутизация сообщений**.

1. Выберите вкладку **Маршруты**.

1. Выберите маршрут с именем **turbofanDeviceDataToStorage**.

1. Обратите внимание, что конечной точкой маршрута является пользовательская конечная точка **turbofanDeviceStorage**.

1. Просмотрите запрос маршрутизации, в котором задано значение **true**. Это означает, что все сообщения телеметрии устройства будут соответствовать этому маршруту, и, следовательно, все сообщения будут отправлены в конечную точку **turbofanDeviceStorage**.

1. Закройте окно со сведениями о маршруте.

## <a name="next-steps"></a>Дополнительная информация

В рамках этой статьи мы создали Центр Интернета вещей и настроили маршрут к учетной записи хранения Azure. В рамках следующей статьи мы отправим данные из набора имитированных устройств через Центр Интернета вещей в учетную запись хранения. Далее в рамках этого руководства мы вернемся к маршрутам и познакомимся подробнее с запросами маршрутизации после того, как настроим устройство и модули IoT Edge.

Дополнительные сведения о шагах, описанных в этой части руководства "Машинное обучение на IoT Edge", см. в следующих статьях:

* [Принципы работы Azure IoT](https://docs.microsoft.com/azure/iot-fundamentals/)
* [Настройка маршрутизации сообщений с использованием Центра Интернета вещей](../iot-hub/tutorial-routing.md)
* [Create an IoT hub using the Azure portal](../iot-hub/iot-hub-create-through-portal.md) (Создание Центра Интернета вещей с помощью портала Azure)

Чтобы создать имитированное устройство для мониторинга, перейдите к следующей статье.

> [!div class="nextstepaction"]
> [Создание данных об устройстве](tutorial-machine-learning-edge-03-generate-data.md)
