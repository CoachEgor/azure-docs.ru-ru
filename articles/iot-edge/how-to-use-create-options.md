---
title: Напишите createOptions для модулей - Azure IoT Edge Документы Майкрософт
description: Как использовать createOptions в манифесте развертывания для настройки модулей во время выполнения
keywords: ''
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 04/01/2020
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: c07e161042a497a232cbd5e3f11128893a095381
ms.sourcegitcommit: 980c3d827cc0f25b94b1eb93fd3d9041f3593036
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/02/2020
ms.locfileid: "80550348"
---
# <a name="how-to-configure-container-create-options-for-iot-edge-modules"></a>Как настроить параметры создания контейнера для модулей IoT Edge

Параметр **createOptions** в манифесте развертывания позволяет настроить контейнеры модуля во время выполнения. Этот параметр расширяет контроль над модулями и позволяет выполнять такие задачи, как разрешение или ограничение доступа модуля к ресурсам устройства-хозяина или настройка сетей.

Модули IoT Edge реализованы в качестве контейнеров, совместимых с Docker, на устройстве IoT Edge. Docker предлагает множество вариантов создания контейнеров, и эти параметры применимы и к модулям IoT Edge. Для получения дополнительной [Docker container create options](https://docs.docker.com/engine/api/v1.32/#operation/ContainerCreate)информации см.

## <a name="format-create-options"></a>Параметры создания формата

Манифест развертывания IoT Edge принимает параметры создания, отформатированные как JSON. Например, возьмем параметры создания, которые автоматически включаются для каждого модуля edgeHub:

```json
"createOptions": {
  "HostConfig": {
    "PortBindings": {
      "5671/tcp": [
        {
          "HostPort": "5671"
        }
      ],
      "8883/tcp": [
        {
          "HostPort": "8883"
        }
      ],
      "443/tcp": [
        {
          "HostPort": "443"
        }
      ]
    }
  }
}
```

В этом примере edgeHub используется параметр **HostConfig.PortBindings** для картирования открытых портов в контейнере к порту на устройстве-хозяине.

Если вы используете расширения Azure IoT Tools для Visual Studio или Visual Studio Code, можно написать параметры создания в формате JSON в **файле deployment.template.json.** Затем, когда вы используете расширение для создания решения IoT Edge или генерации манифеста развертывания, оно будет притягивать jSON к вам в формате, который ожидает время выполнения IoT Edge. Пример:

```json
"createOptions": "{\"HostConfig\":{\"PortBindings\":{\"5671/tcp\":[{\"HostPort\":\"5671\"}],\"8883/tcp\":[{\"HostPort\":\"8883\"}],\"443/tcp\":[{\"HostPort\":\"443\"}]}}}"
```

Один совет для написания вариантов создания заключается в использовании `docker inspect` команды. В рамках процесса разработки запустите модуль `docker run <container name>`локально, используя. Если у вас есть модуль работает так, как вы хотите, запустите `docker inspect <container name>`. Эта команда выводит детали модуля в формате JSON. Найдите параметры, которые вы настроили, и скопируйте JSON. Пример:

[![Результаты проверки докеров edgeHub](./media/how-to-use-create-options/docker-inspect-edgehub-inline-and-expanded.png)](./media/how-to-use-create-options/docker-inspect-edgehub-inline-and-expanded.png#lightbox)

## <a name="common-scenarios"></a>Распространенные сценарии

Параметры создания контейнеров позволяют создавать множество сценариев, но вот некоторые из них чаще всего возникают при создании решений IoT Edge:

* [Предоставь модулям доступ к хранилищу хоста](how-to-access-host-storage-from-module.md)
* [Порт хостов карты к порту модуля](#map-host-port-to-module-port)
* [Ограничьте память модуля и использование процессора](#restrict-module-memory-and-cpu-usage)

### <a name="map-host-port-to-module-port"></a>Порт хостов карты к порту модуля

Если вашему модулю необходимо общаться с службой за пределами решения IoT Edge и для этого не используется routing сообщений, то необходимо сопоставить порт-хост с портом модуля.

>[!TIP]
>Это отображение порта не требуется для модульной связи с модулем на одном устройстве. Если модулю А необходимо задать запрос API, размещенного на модуле B, он может сделать это без картирования портов. Модуль B должен выставить порт в своем докерфиле, например: `EXPOSE 8080`. Затем модуль А может запросить API, используя имя `http://ModuleB:8080/api`модуля B, например: .

Во-первых, убедитесь, что порт внутри модуля подвергается прослушиванию соединений. Вы можете сделать это с помощью инструкции [EXPOSE](https://docs.docker.com/engine/reference/builder/#expose) в dockerfile. Например, `EXPOSE 8080`. Экспонировать инструкцию по умолчанию протокола TCP, если не указано, или вы можете указать UDP.

Затем используйте настройки **PortBindings** в группе **HostConfig** [контейнера Docker, создавая варианты](https://docs.docker.com/engine/api/v1.32/#operation/ContainerCreate) для отображения уязвимого порта в модуле в порт на устройстве-хозяине. Например, если вы обнажили порт 8080 внутри модуля и хотите сопоставить его с портом 80 устройства-хозяина, параметры создания в файле template.json будут выглядеть следующим примером:

```json
"createOptions": {
  "HostConfig": {
    "PortBindings": {
      "8080/tcp": [
        {
          "HostPort": "80"
        }
      ]
    }
  }
}
```

После строки для манифеста развертывания та же конфигурация будет выглядеть следующим примером:

```json
"createOptions": "{\"HostConfig\":{\"PortBindings\":{\"8080/tcp\":[{\"HostPort\":\"80\"}]}}}"
```

### <a name="restrict-module-memory-and-cpu-usage"></a>Ограничьте память модуля и использование процессора

Вы можете объявить, сколько ресурсов узла может использовать модуль. Этот элемент управления полезен для обеспечения того, чтобы один модуль не мог потреблять слишком много памяти или использования процессора и предотвратить запуск других процессов на устройстве. Вы можете управлять этими настройками с [помощью контейнера Docker создавать параметры](https://docs.docker.com/engine/api/v1.32/#operation/ContainerCreate) в группе **HostConfig,** в том числе:

* **Память**: Предел памяти в байтах. Например, 268435456 байтов и 256 МБ.
* **MemorySwap**: Общий лимит памяти (память и своп). Например, 536870912 байтов 512 МБ
* **CpuPeriod**: Длина периода процессора в микросекундах. Значение по умолчанию составляет 100000, поэтому, например, значение 25000 ограничивает контейнер до 25% ресурсов процессора.

В формате template.json эти значения будут выглядеть следующим примером:

```json
"createOptions": {
  "HostConfig": {
    "Memory": 268435456,
    "MemorySwap": 536870912,
    "CpuPeriod": 25000
  }
}
```

После строки для окончательного манифеста развертывания эти значения будут выглядеть следующим примером:

```json
"createOptions":"{\"HostConfig\":{\"Memory\":268435456,\"MemorySwap\":536870912,\"CpuPeriod\":25000}}"
```

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные примеры создания опций в действии см.

* [Пользовательское видение и Azure IoT Edge на малине Pi 3](https://github.com/Azure-Samples/Custom-vision-service-iot-edge-raspberry-pi)
* [Образец хранения каплей Azure IoT Edge](https://github.com/Azure-Samples/azure-iotedge-blobstorage-sample)
