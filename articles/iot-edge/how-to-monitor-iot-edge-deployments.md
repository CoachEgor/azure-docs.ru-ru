---
title: Мониторинг IoT Edge развертываний — Azure IoT Edge
description: Высокий уровень мониторинга, включая сообщаемые свойства edgeHub и edgeAgent и метрики автоматического развертывания.
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 04/21/2020
ms.topic: conceptual
ms.reviewer: veyalla
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: cc7c1fd1dff85908c96e2fd7b2276df3d833e37f
ms.sourcegitcommit: edccc241bc40b8b08f009baf29a5580bf53e220c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/24/2020
ms.locfileid: "82134316"
---
# <a name="monitor-iot-edge-deployments"></a>Мониторинг IoT Edge развертываний

Azure IoT Edge предоставляет отчеты, позволяющие отслеживать сведения о модулях, развернутых на IoT Edge устройствах, в режиме реального времени. Служба центра Интернета вещей получает состояние с устройств и делает их доступными для оператора. Мониторинг также важен для [развертываний, выполняемых в масштабе](module-deployment-monitoring.md) , включая автоматические развертывания и многоуровневые развертывания.

Как устройства, так и модули имеют похожие данные, такие как подключение, поэтому значения получаются в соответствии с ИДЕНТИФИКАТОРом устройства или кодом модуля.

Служба центра Интернета вещей собирает данные, сообщаемые устройством и модулем двойников, и предоставляет счетчики различных состояний, которые могут быть у устройств. Служба центра Интернета вещей организует эти данные в четыре группы метрик:

| Type | Описание |
| --- | ---|
| Целевая | Показывает IoT Edge устройства, соответствующие условию нацеливания развертывания. |
| Применен | Показывает целевые IoT Edge устройства, которые не предназначены для другого развертывания с более высоким приоритетом. |
| Отчет успешно выполнен | Показывает IoT Edge устройства, которые сообщили об успешном развертывании модулей. |
| Ошибка при создании отчета | Показывает IoT Edge устройства, которые сообщили, что один или несколько модулей не были успешно развернуты. Для дальнейшего изучения ошибки удаленно подключитесь к этим устройствам и просмотрите файлы журнала. |

Служба центра Интернета вещей делает эти данные доступными для мониторинга в портал Azure и в Azure CLI.

## <a name="monitor-a-deployment-in-the-azure-portal"></a>Мониторинг развертывания в портал Azure

Чтобы просмотреть сведения о развертывании и узнать, какое устройство его выполняет, сделайте следующее:

1. Войдите на [портал Azure](https://portal.azure.com) и перейдите к своему Центру Интернета вещей.
1. Выберите **IOT Edge** в меню слева.
1. Перейдите на вкладку **развертывания IOT Edge** .
1. Изучите список развертывания.Для каждого развертывания можно просмотреть следующие сведения:

    | Столбец | Описание |
    | --- | --- |
    | ID | Имя развертывания. |
    | Type | Тип развертывания: **развертывание** или **Многоуровневый развертывание**. |
    | Target Condition (Условие назначения); | Тег, используемый для определения целевых устройств. |
    | Priority | Номер приоритета, назначенный развертыванию. |
    | Системные метрики | Число двойниковов устройств в центре Интернета вещей, которые соответствуют условию нацеливания. **Применено** указывает число устройств, к которым было применено содержимое развертывания для модуля двойников в центре Интернета вещей. |
    | Метрики устройств | Число IoT Edge устройств, сообщающих об успешном выполнении или ошибках из среды выполнения клиента IoT Edge. |
    | Пользовательские метрики | Число IoT Edge устройств, передающих данные для всех метрик, определенных для развертывания. |
    | Время создания | Метка времени, начиная с момента создания развертывания. Метка времени используется, чтобы разорвать связи, если два развертывания имеют одинаковый приоритет. |

1. Выберите развертывание, которое вы хотите отслеживать.  
1. На странице **сведения о развертывании** прокрутите вниз до нижнего раздела и выберите вкладку **условие целевого объекта** . Выберите **представление** , чтобы вывести список устройств, соответствующих целевому условию. Можно изменить условие, а также **приоритет**. При внесении изменений выберите **сохранить** .

   ![Просмотр целевых устройств для развертывания](./media/how-to-monitor-iot-edge-deployments/target-devices.png)

1. Перейдите на вкладку **метрики** . Если выбрать метрику из раскрывающегося списка **Выбор метрики** , отобразится кнопка **просмотра** , в которой будут отображаться результаты. Можно также выбрать **Изменить метрики** , чтобы настроить критерии для всех определенных пользовательских метрик. При внесении изменений выберите **сохранить** .

   ![Просмотр метрик для развертывания](./media/how-to-monitor-iot-edge-deployments/deployment-metrics-tab.png)


Сведения о внесении изменений в развертывание см. в разделе [изменение развертывания](how-to-deploy-at-scale.md#modify-a-deployment).

## <a name="monitor-a-deployment-with-azure-cli"></a>Мониторинг развертывания с помощью Azure CLI

Используйте команду [az IOT Edge Deployment Показать](https://docs.microsoft.com/cli/azure/ext/azure-cli-iot-ext/iot/edge/deployment?view=azure-cli-latest#ext-azure-cli-iot-ext-az-iot-edge-deployment-show) , чтобы отобразить сведения об одном развертывании:

```cli
az iot edge deployment show --deployment-id [deployment id] --hub-name [hub name]
```

Команда развернуть показ принимает следующие параметры:

* **--deployment-id** — имя существующего развертывания в центре IoT. Обязательный параметр.
* **--Hub-Name** — имя центра Интернета вещей, в котором существует развертывание. Центр должен быть в текущей подписке. Переключитесь на нужную подписку с помощью команды `az account set -s [subscription name]`

Проверьте развертывание в командном окне.Свойство **metrics** перечисляет количество каждой метрики, которое оценивается каждым центром.

* **targetedCount** — это система метрики, которая определяет количество двойников устройств в Центре Интернета вещей, которые соответствуют условию назначения.
* **appliedCount** — это система метрики, которая определяет количество устройств, в которых применено содержимое развертывания к двойникам модулей в Центре Интернета вещей.
* **репортедсукцессфулкаунт** — метрика устройства, указывающая количество IOT Edge устройств в развертывании, сообщающих об успешном выполнении из среды выполнения клиента IOT Edge.
* **репортедфаиледкаунт** — метрика устройства, указывающая количество IOT Edge устройств в случае сбоя отчетов о развертывании из среды выполнения клиента IOT Edge.

Вы можете отобразить список идентификаторов устройств или объектов для каждой из метрик с помощью команды [az IOT Edge Deployment показывать-Metric](https://docs.microsoft.com/cli/azure/ext/azure-cli-iot-ext/iot/edge/deployment?view=azure-cli-latest#ext-azure-cli-iot-ext-az-iot-edge-deployment-show-metric) :

```cli
az iot edge deployment show-metric --deployment-id [deployment id] --metric-id [metric id] --hub-name [hub name]
```

Команда Deployment демонстрация — метрика принимает следующие параметры:

* **--deployment-id** — имя существующего развертывания в центре IoT.
* **--Metric-ID** — имя метрики, для которой необходимо просмотреть список идентификаторов устройств, например `reportedFailedCount`.
* **--Hub-Name** — имя центра Интернета вещей, в котором существует развертывание. Центр должен быть в текущей подписке. Переключитесь на нужную подписку с помощью команды `az account set -s [subscription name]`.

Сведения о внесении изменений в развертывание см. в разделе [изменение развертывания](how-to-deploy-cli-at-scale.md#modify-a-deployment).

## <a name="next-steps"></a>Следующие шаги

Узнайте, как [взаимодействовать с EdgeAgent с помощью встроенных прямых методов](how-to-edgeagent-direct-method.md).
