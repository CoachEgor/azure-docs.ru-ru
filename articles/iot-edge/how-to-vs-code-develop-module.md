---
title: Разработка и отладка модулей для Azure IoT Edge | Документация Майкрософт
description: Использование Visual Studio Code для разработки, сборки и отладки модуля для Azure IoT Edge с помощью C#, Python, Node.js, Java или C
services: iot-edge
keywords: ''
author: shizn
ms.author: xshi
ms.date: 08/07/2019
ms.topic: article
ms.service: iot-edge
ms.openlocfilehash: b451e501b216b02ecb052ee159d0e26343af7901
ms.sourcegitcommit: d70c74e11fa95f70077620b4613bb35d9bf78484
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/11/2019
ms.locfileid: "70910228"
---
# <a name="use-visual-studio-code-to-develop-and-debug-modules-for-azure-iot-edge"></a>Использование Visual Studio Code для разработки и отладки модулей для Azure IoT Edge

Вы можете превратить бизнес-логику в модули для Azure IoT Edge. В этой статье описано использование Visual Studio Code в качестве основного средства разработки и отладки модулей.

Существует два способа отладки модулей, написанных на C#, Node. js или Java, в Visual Studio Code: Вы можете подключить процесс в контейнере модуля или запустить код модуля в режиме отладки. Для отладки модулей, написанных на Python или C, можно присоединяться только к процессу в контейнерах Linux AMD64.

С возможностями отладки Visual Studio Code можно ознакомиться в [этой статье](https://code.visualstudio.com/Docs/editor/debugging).

В этой статье приводятся инструкции по разработке и отладке модулей на нескольких языках для нескольких архитектур. В настоящее время Visual Studio Code обеспечивает поддержку модулей, написанных на C#языках, C, Python, Node. js и Java. Поддерживаемые архитектуры устройств: x64 и ARM32. Дополнительные сведения о поддерживаемых операционных системах, языках и архитектурах см. в разделе [Поддержка языков и архитектур](module-development.md#language-and-architecture-support).

>[!NOTE]
>Поддержка разработки и отладки для устройств Linux ARM64 доступна в [общедоступной предварительной версии](https://azure.microsoft.com/support/legal/preview-supplemental-terms/). Подробные сведения см. в статье [Develop and debug ARM64 IoT Edge modules in Visual Studio Code (preview)](https://devblogs.microsoft.com/iotdev/develop-and-debug-arm64-iot-edge-modules-in-visual-studio-code-preview) (Разработка и отладка модулей IoT Edge для устройств ARM64 в Visual Studio Code (предварительная версия)).

## <a name="prerequisites"></a>Предварительные требования

Для разработки вы должны использовать компьютер или виртуальную машину под управлением Windows, macOS или Linux. На компьютерах Windows можно разрабатывать модули Windows или Linux. Для разработки модулей Windows используйте компьютер под управлением Windows версии 1809/Build 17763 или более поздней. Для разработки модулей Linux используйте компьютер Windows, соответствующий [требованиям для работы DOCKER Desktop](https://docs.docker.com/docker-for-windows/install/#what-to-know-before-you-install). 

Сначала установите [Visual Studio Code](https://code.visualstudio.com/), а затем добавьте следующие расширения:

- [Средства Интернета вещей Azure](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-tools)
- [расширение Docker](https://marketplace.visualstudio.com/items?itemName=PeterJausovec.vscode-docker).
- расширения Visual Studio, в зависимости от выбранного для разработки языка:
  - C#, включая Функции Azure: [расширение C#](https://marketplace.visualstudio.com/items?itemName=ms-vscode.csharp);
  - Python: [расширение Python](https://marketplace.visualstudio.com/items?itemName=ms-python.python);
  - Java: [Пакет расширения Java для Visual Studio Code](https://marketplace.visualstudio.com/items?itemName=vscjava.vscode-java-pack)
  - C: [расширение C или C++](https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools).

Вам также потребуется установить некоторые дополнительные языковые средства для разработки модуля:

- C#, включая Функции Azure: [пакет SDK для.NET Core 2.1](https://www.microsoft.com/net/download).

- Python: [Python](https://www.python.org/downloads/) и [Pip](https://pip.pypa.io/en/stable/installing/#installation) для установки пакетов Python (обычно входит в состав установки Python).

- Node.js: [Node.js](https://nodejs.org). Вам также нужно установить [Yeoman](https://www.npmjs.com/package/yo) и [генератор модулей Azure IoT Edge Node.js](https://www.npmjs.com/package/generator-azure-iot-edge-module).

- Java: [пакет SDK для Java SE 10](https://aka.ms/azure-jdks) и [Maven](https://maven.apache.org/). Вам нужно будет [установить переменную среды `JAVA_HOME`](https://docs.oracle.com/cd/E19182-01/820-7851/inst_cli_jdk_javahome_t/), которая указывает на эту установку JDK.

Чтобы создать и развернуть образ модуля, вам потребуется DOCKER для создания образа модуля и реестра контейнеров для хранения образа модуля:

- [Docker Community Edition](https://docs.docker.com/install/) на компьютере, на котором ведется разработка.

- [Реестр контейнеров Azure](https://docs.microsoft.com/azure/container-registry/) или [Docker Hub](https://docs.docker.com/docker-hub/repos/#viewing-repository-tags).

    > [!TIP]
    > Вместо облачного реестра можно использовать локальный реестр Docker для создания прототипов и тестирования.

Если вы не разрабатываете свой модуль на языке C, вам также потребуется [средство разработки Azure IoT EdgeHub](https://pypi.org/project/iotedgehubdev/) на основе Python, чтобы настроить локальную среду разработки для отладки, запуска и тестирования решения IoT Edge. Если вы этого еще не сделали, установите [Python (2.7 или 3.6) и Pip](https://www.python.org/), а затем установите **iotedgehubdev**, выполнив эту команду в своем терминале.

   ```cmd
   pip install --upgrade iotedgehubdev
   ```
> [!NOTE]
> Если у вас есть несколько Python, включая предварительно установленный Python 2,7 (например, в Ubuntu или macOS), убедитесь, что используется правильный `pip` параметр `pip3` или для установки **иотеджехубдев** .

Для тестирования модуля на устройстве потребуется действующий центр Интернета вещей по крайней мере с одним устройством IoT Edge. Чтобы использовать компьютер в качестве устройства IoT Edge, выполните инструкции в кратком руководстве для [Linux](quickstart-linux.md) или [Windows](quickstart.md). Если вы запустили управляющую программу IoT Edge на компьютере разработки, может потребоваться остановить EdgeHub и EdgeAgent, прежде чем перейти к следующему шагу.

## <a name="create-a-new-solution-template"></a>Создайте новый шаблон решения

В следующих шагах показано, как создать модуль IoT Edge с помощью предпочитаемого языка разработки (включая Функции Azure, написанные на языке C#) с использованием Visual Studio Code и средств Azure IoT. Сначала нужно создать решение, а затем сформировать первый модуль в этом решении. Каждое решение может содержать несколько модулей.

1. Выберите **Представление** > **Палитра команд**.

1. В палитре команд введите и выполните команду **Azure IoT Edge: New IoT Edge Solution** (Azure IoT Edge: создать решение IoT Edge).

   ![Запуск команды создания решения IoT Edge](./media/how-to-develop-csharp-module/new-solution.png)

1. Перейдите к папке, где требуется создать решение, и щелкните **Выбрать папку**.

1. Введите имя для решения.

1. Выберите шаблон модуля для предпочитаемого языка разработки. Он станет первым модулем в решении.

1. Введите имя модуля. Оно должно быть уникальным в пределах реестра контейнеров.

1. Укажите имя репозитория образов для модуля. Visual Studio Code автоматически заполняет имя модуля значением **localhost:5000/<имя вашего модуля\>** . Замените его собственными данными реестра. Если для тестирования вы используете локальный реестр Docker, вполне подойдет значение **localhost**. Если используется Реестр контейнеров Azure, укажите сервер входа, заданный в параметрах реестра. Сервер входа выглядит как   **_\<имя\>реестра_. azurecr.IO**. Замените только часть **localhost: 5000** строки, чтобы окончательный результат  **\<был похож на *имя*\>реестра. azurecr.IO/ _\<имя\>модуля_** .

   ![Выбор репозитория образа Docker](./media/how-to-develop-csharp-module/repository.png)

Visual Studio Code принимает предоставленные сведения, создает решение IoT Edge, а затем загружает его в новом окне.

В решении существует четыре элемента:

- Папка **.vscode** содержит конфигурации отладки.

- Папка **modules** содержит вложенные папки для каждого модуля.  В папке для каждого модуля имеется файл **Module. JSON**, который управляет процессом сборки и развертывания модулей.  Этот файл необходимо изменить, чтобы изменить реестр контейнеров развертывания модуля с localhost на удаленный реестр. На этом этапе у вас есть только один модуль.  Но вы можете добавить модули в палитре команд с помощью команды **Azure IoT Edge: Add IoT Edge Module** (Azure IoT Edge: добавить модуль IoT Edge).

- В файле **ENV** перечислены переменные среды. Если реестр контейнеров Azure является вашим реестром, вы получите в нем имя пользователя и пароль для реестра контейнеров Azure.

  > [!NOTE]
  > Файл среды создается только в том случае, если вы указали репозиторий образов для модуля. Если вы не изменяли значения по умолчанию localhost для тестирования и отладки локально, объявлять переменные среды не требуется.

- Файл **Deployment. Template. JSON** содержит новый модуль, а также пример модуля **симулатедтемпературесенсор** , который имитирует данные, которые можно использовать для тестирования. Дополнительные сведения о том, как работают манифесты развертывания, см. в разделе [Сведения об использовании манифестов развертывания для развертывания модулей и установки маршрутов](module-composition.md).

## <a name="add-additional-modules"></a>Добавление дополнительных модулей

Чтобы добавить дополнительные модули в решение, выполните команду **Azure IoT Edge: Add IoT Edge Module** (Azure IoT Edge: добавить модуль IoT Edge) из палитры команд. Кроме того, вы можете щелкнуть правой кнопкой мыши папку **modules** или файл `deployment.template.json` в представлении обозревателя Visual Studio Code и выбрать **Add IoT Edge Module** (Добавить модуль IoT Edge).

## <a name="develop-your-module"></a>Разработка модуля

Код модуля по умолчанию, который поставляется вместе с решением, находится в следующем расположении:

- Функция Azure (C#): **modules > *&lt;имя вашего модуля &gt;*  >  *&lt;имя вашего модуля&gt;* .cs**.
- C#: **modules > *&lt;имя вашего модуля&gt;*  > Program.cs**.
- Python: **modules > *&lt;имя вашего модуля&gt;*  > main.py**.
- Node.js: **modules > *&lt;имя вашего модуля&gt;*  > app.js**.
- Java: **modules > *&lt;имя вашего модуля&gt;*  > src > main > java > com > edgemodulemodules > App.java**.
- C: **modules > *&lt;имя вашего модуля&gt;*  > main.c**.

Модуль и файл deployment.template.json настраиваются так, чтобы можно было собрать решение, передать его в реестр контейнеров и развернуть на устройстве, чтобы начать тестирование, не меняя код. Модуль создается для простого получения входных данных из источника (в данном случае — модуля Симулатедтемпературесенсор, моделирующего данные) и передачи его в центр Интернета вещей.

Когда вы будете готовы настроить шаблон с добавлением собственного кода, используйте [пакеты SDK для Центра Интернета вещей Azure](../iot-hub/iot-hub-devguide-sdks.md), чтобы создать модули, которые удовлетворяют ключевые потребности решений Интернета вещей, такие как безопасность, управление устройствами и надежность.

## <a name="debug-a-module-without-a-container-c-nodejs-java"></a>Отладка модуля без контейнера (C#, Node.js, Java)

Если вы выполняете разработку на языке C#, Node.js или Java, в коде модуля по умолчанию необходимо использовать объект **ModuleClient** для запуска, выполнения и маршрутизации сообщений. Кроме того, нужно будет использовать входной канал по умолчанию **input1** для выполнения действий, когда модуль получает сообщения.

### <a name="set-up-iot-edge-simulator-for-iot-edge-solution"></a>Настройка симулятора IoT Edge для решения IoT Edge

Вместо установки управляющей программы безопасности IoT Edge на компьютере разработки можно запустить симулятор IoT Edge для выполнения решения IoT Edge.

1. В обозревателе устройств с левой стороны щелкните идентификатор устройства IoT Edge правой кнопкой мыши, а затем выберите **Setup IoT Edge Simulator** (Настроить симулятор IoT Edge), чтобы запустить симулятор со строкой подключения устройства.
1. Прочитав сведения о ходе выполнения в интегрированном терминале, вы можете увидеть, что симулятор IoT Edge успешно настроен.

### <a name="set-up-iot-edge-simulator-for-single-module-app"></a>Настройка симулятора IoT Edge для приложения одного модуля

Чтобы настроить и запустить симулятор, выполните команду **Azure IoT Edge: Start IoT Edge Hub Simulator for Single Module** (Azure IoT Edge: запустить симулятор центра IoT Edge для одного модуля) из палитры команд Visual Studio Code. При появлении запроса в качестве входного имени для вашего приложения используйте значение **input1** из кода модуля по умолчанию (или эквивалентное значение из вашего кода). Команда активирует CLI **iotedgehubdev**, а затем запускает симулятор IoT Edge и тестирование контейнера модуля служебной программы. Вы можете увидеть приведенные ниже выходные данные во встроенном терминале, если симулятор был успешно запущен в режиме одного модуля. Также вы увидите команду `curl`, помогающую при пересылке сообщений. Оно понадобится вам позже.

   ![Настройка симулятора IoT Edge для приложения одного модуля](media/how-to-develop-csharp-module/start-simulator-for-single-module.png)

   Состояние выполнения модуля можно просмотреть в представлении обозревателя Docker в Visual Studio Code.

   ![Состояние модуля симулятора](media/how-to-develop-csharp-module/simulator-status.png)

   Контейнер **edgeHubDev** — это ядро локального симулятора IoT Edge. Вы можете запустить его на компьютере разработки без управляющей программы безопасности IoT Edge. Он предоставит параметры среды для собственного приложения модуля или контейнеров модуля. Контейнер **input** предоставляет REST API, помогающие отправлять сообщения в целевой входной канал в вашем модуле.

### <a name="debug-module-in-launch-mode"></a>Отладка модуля в режиме запуска

1. Подготовьте свою среду к отладке в соответствии с требованиями языка разработки, установите точку останова в модуле и выберите необходимую конфигурацию отладки:
   - **C#**
     - В интегрированном терминале Visual Studio Code измените каталог на  ***&lt;папку с&gt; именем модуля*** , а затем выполните следующую команду, чтобы создать приложение .NET Core.

       ```cmd
       dotnet build
       ```

     - Откройте файл `Program.cs` и добавьте точку останова.

     - Перейдите в представление отладки Visual Studio Code, выбрав **Вид > Отладка**. Выберите конфигурацию отладки ***&lt;имя вашего модуля&gt;* Local Debug (.NET Core)** (Локальная отладка (.NET Core)) из раскрывающегося списка.

        > [!NOTE]
        > Если .NET Core `TargetFramework` не согласуется с путем вашей программы в `launch.json`, необходимо вручную обновить путь к программе в `launch.json` , чтобы он `TargetFramework` соответствовал в файле. csproj, чтобы Visual Studio Code мог успешно запустить этот программу.

   - **Node.js**
     - В интегрированном терминале Visual Studio Code измените каталог на папку ***&lt;имя вашего модуля&gt;***, а затем выполните следующую команду для установки пакетов Node.

       ```cmd
       npm install
       ```

     - Откройте файл `app.js` и добавьте точку останова.

     - Перейдите в представление отладки Visual Studio Code, выбрав **Вид > Отладка**. Выберите конфигурацию отладки ***&lt;имя вашего модуля&gt;* Local Debug (Node.js)** (Локальная отладка (Node.js)) из раскрывающегося списка.
   - **Java**
     - Откройте файл `App.java` и добавьте точку останова.

     - Перейдите в представление отладки Visual Studio Code, выбрав **Вид > Отладка**. Выберите конфигурацию отладки ***&lt;имя вашего модуля&gt;* Local Debug (Java)** (Локальная отладка (Java)) из раскрывающегося списка.

1. Щелкните **Начать отладку** или нажмите клавишу **F5**, чтобы запустить сеанс отладки.

1. В интегрированном терминале Visual Studio Code выполните следующую команду, чтобы отправить сообщение **Hello World** в модуль. Это команда, показанная на предыдущих шагах при настройке симулятора IoT Edge.

    ```bash
    curl --header "Content-Type: application/json" --request POST --data '{"inputName": "input1","data":"hello world"}' http://localhost:53000/api/v1/messages
    ```

   > [!NOTE]
   > Если вы используете Windows, убедитесь, что используется оболочка интегрированного терминала Visual Studio Code **Git Bash** или **WSL Bash**. Команду `curl` нельзя запустить в PowerShell или командной строке.
   > [!TIP]
   > Вместо `curl` для отправки сообщений можно использовать [PostMan](https://www.getpostman.com/) или другие средства API.

1. В представлении отладки Visual Studio Code можно просмотреть переменные на панели слева.

1. Чтобы остановить сеанс отладки, нажмите кнопку "Остановить" или клавиши **SHIFT+F5**, а затем запустите команду **Azure IoT Edge: Stop IoT Edge Simulator** (Azure IoT Edge: остановить симулятор IoT Edge) в палитре команд, чтобы остановить работу симулятора и выполнить очистку.

## <a name="debug-in-attach-mode-with-iot-edge-simulator-c-nodejs-java-azure-functions"></a>Отладка в режиме подключения с помощью симулятора IoT Edge (C#, Node.js, Java, Функции Azure)

Решение по умолчанию содержит два модуля: имитированный модуль датчика температуры и модуль канала. Имитируемый модуль датчика температуры отправляет сообщения в модуль канала, а затем сообщения отправляются по каналу в Центр Интернета вещей. В созданной папке модуля находится несколько файлов Docker для разных типов контейнеров. Вы можете использовать любой **DEBUG**-файл, чтобы создать модуль для тестирования.

В настоящее время отладка в режиме подключения поддерживается только следующим образом:

- Модули C#, в том числе для Функций Azure, поддерживают отладку в контейнерах amd64 Linux.
- Модули Node.js поддерживают отладку в контейнерах amd64 и arm32v7 Linux, а также в контейнерах amd64 Windows.
- Модули Java поддерживают отладку в контейнерах amd64 и arm32v7 Linux.

> [!TIP]
> Вы можете переключаться между вариантами для платформы по умолчанию для своего решения IoT Edge, щелкнув элемент в строке состояния Visual Studio Code.

### <a name="set-up-iot-edge-simulator-for-iot-edge-solution"></a>Настройка симулятора IoT Edge для решения IoT Edge

Вместо установки управляющей программы безопасности IoT Edge на компьютере разработки можно запустить симулятор IoT Edge для выполнения решения IoT Edge.

1. В обозревателе устройств с левой стороны щелкните идентификатор устройства IoT Edge правой кнопкой мыши, а затем выберите **Setup IoT Edge Simulator** (Настроить симулятор IoT Edge), чтобы запустить симулятор со строкой подключения устройства.

1. Прочитав сведения о ходе выполнения в интегрированном терминале, вы можете увидеть, что симулятор IoT Edge успешно настроен.

### <a name="build-and-run-container-for-debugging-and-debug-in-attach-mode"></a>Создание и выполнение контейнера для отладки и отладка в режиме подключения

1. Откройте файл модуля (`Program.cs`, `app.js`, `App.java` или `<your module name>.cs`) и добавьте точку останова.

1. В представлении обозревателя Visual Studio Code щелкните правой кнопкой мыши файл `deployment.debug.template.json` для своего решения и выберите **Build and Run IoT Edge solution in Simulator** (Выполнить сборку и запуск решения IoT Edge в симуляторе). Все журналы контейнеров модуля можно просмотреть в одном окне. Кроме того, можно перейти к представлению Docker, чтобы просмотреть состояние контейнера.

   ![Просмотр переменных](media/how-to-vs-code-develop-module/view-log.png)

1. Перейдите к представлению отладки Visual Studio Code и выберите файл конфигурации отладки для модуля. У действия отладки должно быть такое имя: ***&lt;имя вашего модуля&gt;* Remote Debug**.

1. Нажмите кнопку **Начать отладку** или клавишу **F5**. Выберите процесс для присоединения.

1. В представлении отладки Visual Studio Code можно просмотреть переменные на панели слева.

1. Чтобы остановить сеанс отладки, сначала нажмите кнопку "Остановить" или клавиши **SHIFT+F5**, а затем запустите команду **Azure IoT Edge: Stop IoT Edge Simulator** (Azure IoT Edge: остановить симулятор IoT Edge) из палитры команд.

> [!NOTE]
> В предыдущем примере показаны способы отладки модулей IoT Edge в контейнерах. В параметры `createOptions` контейнера вашего модуля были добавлены открытые порты. После завершения отладки модулей рекомендуется удалить эти открытые порты для модулей IoT Edge, готовых для рабочей среды.
>
> Для модулей, написанных на языке C#, включая Функции Azure, этот пример основан на отладочной версии файла `Dockerfile.amd64.debug`, который при сборке образа контейнера включает в него отладчик командной строки .NET Core (VSDBG). После отладки модулей C# рекомендуется непосредственно использовать файл Dockerfile без VSDBG для готовых модулей IoT Edge.

## <a name="debug-a-module-with-the-iot-edge-runtime"></a>Отладка модуля с использованием среды выполнения IoT Edge

В папке каждого модуля находится несколько файлов Docker для разных типов контейнеров. Вы можете использовать любой **DEBUG**-файл, чтобы создать модуль для тестирования.

При отладке модулей с помощью этого метода модули работают поверх среды выполнения IoT Edge. Устройство IoT Edge и ваш Visual Studio Code могут находиться на одном и том же компьютере или, как правило, на разных компьютерах (Visual Studio Code находится на компьютере разработчика, а среда выполнения IoT Edge и модули работают на другом физическом компьютере). Чтобы выполнять отладку из Visual Studio Code, необходимо сделать следующее:

- Настройте устройство IoT Edge, соберите модули IoT Edge с помощью Dockerfile **.debug**, а затем разверните их на устройство IoT Edge.
- Предоставьте протокол IP и порт модуля, чтобы можно было присоединить отладчик.
- Обновите файл `launch.json`, чтобы Visual Studio Code мог присоединиться к процессу в контейнере на удаленном компьютере. Этот файл находится в папке `.vscode` в вашей рабочей области и обновляется каждый раз при добавлении нового модуля, который поддерживает отладку.

### <a name="build-and-deploy-your-module-to-the-iot-edge-device"></a>Создание и развертывание модуля на устройство IoT Edge

1. В Visual Studio Code откройте файл `deployment.debug.template.json`, который содержит отладочную версию образов вашего модуля с соответствующими значениями `createOptions`.

1. Если вы разрабатываете свой модуль на языке Python, сначала выполните следующие шаги:
   - Откройте файл `main.py` и добавьте этот код после раздела импорта:

      ```python
      import ptvsd
      ptvsd.enable_attach(('0.0.0.0',  5678))
      ```

   - Добавьте следующую строку кода в обратный вызов, который необходимо отладить:

      ```python
      ptvsd.break_into_debugger()
      ```

     Например, если вы хотите отладить метод `receive_message_callback`, вставьте эту строку кода следующим образом:

      ```python
      def receive_message_callback(message, hubManager):
          ptvsd.break_into_debugger()
          global RECEIVE_CALLBACKS
          message_buffer = message.get_bytearray()
          size = len(message_buffer)
          print ( "    Data: <<<%s>>> & Size=%d" % (message_buffer[:size].decode ('utf-8'), size) )
          map_properties = message.properties()
          key_value_pair = map_properties.get_internals()
          print ( "    Properties: %s" % key_value_pair )
          RECEIVE_CALLBACKS += 1
          print ( "    Total calls received: %d" % RECEIVE_CALLBACKS )
          hubManager.forward_event_to_output("output1", message, 0)
          return IoTHubMessageDispositionResult.ACCEPTED
      ```

1. В строке командной палитры Visual Studio Code выполните следующие действия:
   1. Выполните команду **Azure IoT Edge: Build and Push IoT Edge solution** (Создать и отправить решение IoT Edge).

   1. Выберите файл `deployment.debug.template.json` для вашего решения.

1. В представлении обозревателя Visual Studio Code в разделе **Azure IoT Hub Devices** (Устройства Центра Интернета вещей Azure) выполните следующие действия:
   1. Щелкните код устройства IoT Edge правой кнопкой мыши, а затем выберите **Create Deployment for Single Device** (Создание развертывания для одного устройства).

      > [!TIP]
      > Чтобы подтвердить, что выбранное устройство является устройством IoT Edge, выберите его, после чего развернется список модулей, где можно проверить наличие **$edgeHub** и **$edgeAgent**. Каждое устройство IoT Edge содержит эти два модуля.

   1. Перейдите к папке **config** решения, выберите файл `deployment.debug.amd64.json`, а затем щелкните **Select Edge Deployment Manifest** (Выбрать манифест развертывания Edge).

Ход развертывания можно отслеживать по идентификатору развертывания в интегрированном терминале.

Чтобы проверить состояние контейнера, выполните команду `docker ps` в окне терминала. Если ваш Visual Studio Code и среда выполнения IoT Edge работают на одном компьютере, вы также можете проверить состояние в представлении Docker Visual Studio Code.

### <a name="expose-the-ip-and-port-of-the-module-for-the-debugger"></a>Предоставление IP-адреса и порта модуля для отладчика

Вы можете пропустить этот раздел, если модули работают на том же компьютере, что и Visual Studio Code, так как вы используете localhost для присоединения к контейнеру и уже предоставили правильные параметры порта в файле Dockerfile с расширением **.debug**, параметрах `createOptions` контейнера модуля и файле `launch.json`. Если модули и Visual Studio Code работают на разных компьютерах, следуйте указаниям для выбранного языка разработки.

- **C#, включая Функции Azure**

  [Настройте канал SSH на компьютере разработки и устройство IoT Edge](https://github.com/OmniSharp/omnisharp-vscode/wiki/Attaching-to-remote-processes), а затем измените файл `launch.json` для присоединения.

- **Node.js**

  - Убедитесь, что модуль на компьютере для отладки запущен и готов для присоединения отладчиков и что порт 9229 доступен извне. Это можно проверить, открыв страницу `http://<target-machine-IP>:9229/json` на компьютере отладчика. Этот URL-адрес должен показать сведения о модуле Node.js для отладки.
  
  - На компьютере отладчика откройте Visual Studio Code, отредактируйте файл `launch.json` так, чтобы значение адреса профиля ***&lt;your module name&gt;* Remote Debug (Node.js)** (Удаленная отладка имя_модуля (Node.js)) или профиля ***&lt;your module name&gt;* Remote Debug (Node.js in Windows Container)** (Удаленная отладка имя_модуля (Node.js в контейнере Windows)), если модуль работает как контейнер Windows, было IP-адресом компьютера отладки.

- **Java**

  - Выполните сборку туннеля SSH на компьютере для отладки, запустив код `ssh -f <username>@<target-machine> -L 5005:127.0.0.1:5005 -N`.
  
  - На компьютере разработки откройте Visual Studio Code и измените профиль ***&lt;module name&gt;* Remote Debug (Java)** (Удаленная отладка имя_модуля (Java)) в файле `launch.json`, чтобы вы могли присоединиться к целевому компьютеру. Дополнительные сведения о редактировании файла `launch.json` и отладке Java с помощью Visual Studio Code см. в разделе [о настройке отладчика](https://code.visualstudio.com/docs/java/java-debugging#_configuration).

- **Python**

  - Убедитесь, что порт 5678 на компьютере, для которого требуется отладка, открыт и доступен.

  - В коде `ptvsd.enable_attach(('0.0.0.0', 5678))`, ранее вставленном в файл `main.py`, измените **0.0.0.0** на IP-адрес компьютера для отладки. Снова выполните сборку, отправку и развертывание своего модуля IoT Edge.

  - На компьютере разработки откройте Visual Studio Code и измените файл `launch.json` таким образом, чтобы значение `host` профиля ***&lt;your module name&gt;* Remote Debug (Python)** (Удаленная отладка имя_модуля (Python)) использовало IP-адрес целевого компьютера вместо `localhost`.

### <a name="debug-your-module"></a>Отладка модуля

1. В представлении отладки Visual Studio Code выберите файл конфигурации отладки для модуля. У действия отладки должно быть такое имя: ***&lt;имя вашего модуля&gt;* Remote Debug**.

1. Откройте файл модуля для используемого языка разработки и добавьте точку останова:

   - **Функция Azure (C#)** : Добавьте точку останова в файл `<your module name>.cs`.
   - **C#** : Добавьте точку останова в файл `Program.cs`.
   - **Node.js**. Добавьте точку останова в файл `app.js`.
   - **Java**. Добавьте точку останова в файл `App.java`.
   - **Python**. Добавьте точку останова в файл `main.py` в метод обратного вызова, в который вы добавили строку `ptvsd.break_into_debugger()`.
   - **C**. Добавьте точку останова в файл `main.c`.

1. Выберите **Начать отладку** или нажмите клавишу **F5**. Выберите процесс для присоединения.

1. В представлении отладки Visual Studio Code можно просмотреть переменные на панели слева.

> [!NOTE]
> В предыдущем примере показаны способы отладки модулей IoT Edge в контейнерах. В параметры `createOptions` контейнера вашего модуля были добавлены открытые порты. После завершения отладки модулей рекомендуется удалить эти открытые порты для модулей IoT Edge, готовых для рабочей среды.

## <a name="build-and-debug-a-module-remotely"></a>Удаленная сборка и отладка модуля

С последними изменениями в модулях Docker и Moby для поддержки соединений SSH, и новыми настройками в Инструментах Интернета вещей Azure, которые позволяют приспособление параметров среды в палитру команд Visual Studio Code и в терминалы Azure IoT Edge, вы можете создавать и делать отладку модулей на удаленных устройствах.

Дополнительные сведения и пошаговые инструкции см. в [Запись в блоге разработчиков Интернета вещей](https://devblogs.microsoft.com/iotdev/easily-build-and-debug-iot-edge-modules-on-your-remote-device-with-azure-iot-edge-for-vs-code-1-9-0/).

## <a name="next-steps"></a>Следующие шаги

После создания модуля узнайте, как [развернуть модули Azure IoT Edge в Visual Studio Code](how-to-deploy-modules-vscode.md).

Чтобы разрабатывать модули для устройств IoT Edge, см. раздел [Понимание и использование пакетов SDK для Центра Интернета вещей Azure](../iot-hub/iot-hub-devguide-sdks.md).
