---
title: Разработка и отладка модулей для Azure IoT Edge | Документация Майкрософт
description: Использование Visual Studio Code для разработки, сборки и отладки модуля для Azure IoT Edge с помощью C#, Python, Node.js, Java или C
services: iot-edge
keywords: ''
author: shizn
ms.author: xshi
ms.date: 08/07/2019
ms.topic: conceptual
ms.service: iot-edge
ms.openlocfilehash: 10c8008d73390174c44ec503f708c1e2c0011e09
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "78944303"
---
# <a name="use-visual-studio-code-to-develop-and-debug-modules-for-azure-iot-edge"></a>Использование Visual Studio Code для разработки и отладки модулей для Azure IoT Edge

Вы можете превратить бизнес-логику в модули для Azure IoT Edge. В этой статье описано использование Visual Studio Code в качестве основного средства разработки и отладки модулей.

Существует два способа отладки модулей, написанных в Коде Визуальной студии, или Java: вы можете либо прикрепить процесс в контейнере модуля, либо запустить код модуля в режиме отладки. Для отладки модулей, написанных в Python или C, можно прикрепить процесс только в контейнерах Linux amd64.

С возможностями отладки Visual Studio Code можно ознакомиться в [этой статье](https://code.visualstudio.com/Docs/editor/debugging).

В этой статье содержатся инструкции по разработке и отладке модулей на нескольких языках для нескольких архитектур. В настоящее время Visual Studio Code обеспечивает поддержку модулей, написанных на C,, C, Python, Node.js и Java. Поддерживаемые архитектуры устройств: X64 и ARM32. Для получения дополнительной информации об поддерживаемых операционных системах, языках и архитектурах можно [ознакомиться на поддержке Language and architecture.](module-development.md#language-and-architecture-support)

>[!NOTE]
>Разработка и отладка поддержки устройств Linux ARM64 находится в [открытом доступе.](https://azure.microsoft.com/support/legal/preview-supplemental-terms/) Подробные сведения см. в статье [Develop and debug ARM64 IoT Edge modules in Visual Studio Code (preview)](https://devblogs.microsoft.com/iotdev/develop-and-debug-arm64-iot-edge-modules-in-visual-studio-code-preview) (Разработка и отладка модулей IoT Edge для устройств ARM64 в Visual Studio Code (предварительная версия)).

## <a name="prerequisites"></a>Предварительные требования

Для разработки вы должны использовать компьютер или виртуальную машину под управлением Windows, macOS или Linux. На компьютерах Windows можно разрабатывать модули Windows или Linux. Для разработки модулей Windows используйте Windows-компьютер под управлением версии 1809/build 17763 или новее. Для разработки модулей Linux используйте компьютер Windows, отвечающий [требованиям Docker Desktop.](https://docs.docker.com/docker-for-windows/install/#what-to-know-before-you-install)

Сначала установите [Visual Studio Code](https://code.visualstudio.com/), а затем добавьте следующие расширения:

- [Средства Azure IoT](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-tools)
- [Расширение докера](https://marketplace.visualstudio.com/items?itemName=PeterJausovec.vscode-docker)
- расширения Visual Studio, в зависимости от выбранного для разработки языка:
  - С, в том числе функции Azure: [расширение C](https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.csharp)
  - Python: [Расширение Python](https://marketplace.visualstudio.com/items?itemName=ms-python.python)
  - Java: [пакет расширения Java для визуального кода студии](https://marketplace.visualstudio.com/items?itemName=vscjava.vscode-java-pack)
  - C: [Расширение C/C](https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools)

Вам также необходимо установить некоторые дополнительные, языковые инструменты для разработки модуля:

- C#, включая Функции Azure: [пакет SDK для.NET Core 2.1](https://www.microsoft.com/net/download).

- Python: [Python](https://www.python.org/downloads/) и [Pip](https://pip.pypa.io/en/stable/installing/#installation) для установки пакетов Python (обычно включаемые в установку Python).

- Node.js: [Node.js](https://nodejs.org). Вам также нужно установить [Yeoman](https://www.npmjs.com/package/yo) и [генератор модулей Azure IoT Edge Node.js](https://www.npmjs.com/package/generator-azure-iot-edge-module).

- Java: [Java SE Development Kit 10](https://aka.ms/azure-jdks) и [Maven](https://maven.apache.org/). Вам нужно будет [установить переменную среды `JAVA_HOME`](https://docs.oracle.com/cd/E19182-01/820-7851/inst_cli_jdk_javahome_t/), которая указывает на эту установку JDK.

Для создания и развертывания изображения модуля докеру необходимо создать изображение модуля и реестр контейнеров для хранения изображения модуля:

- [Docker Community Edition](https://docs.docker.com/install/) на компьютере, на котором ведется разработка.

- [Реестр контейнеров Azure](https://docs.microsoft.com/azure/container-registry/) или [концентратор докеров](https://docs.docker.com/docker-hub/repos/#viewing-repository-tags)

    > [!TIP]
    > Вместо облачного реестра можно использовать локальный реестр Docker для создания прототипов и тестирования.

Если вы не разрабатываете свой модуль на языке C, вам также потребуется [средство разработки Azure IoT EdgeHub](https://pypi.org/project/iotedgehubdev/) на основе Python, чтобы настроить локальную среду разработки для отладки, запуска и тестирования решения IoT Edge. Если вы еще не сделали этого, установите [Python (2.7/3.6/3.7) и Pip,](https://www.python.org/) а затем установите **iotedgehubdev,** запустив эту команду в терминале.

   ```cmd
   pip install --upgrade iotedgehubdev
   ```
   
> [!NOTE]
> В настоящее время iotedgehubdev использует докер-пи библиотеки, которая не совместима с Python 3.8.
>
> Если у вас есть несколько Python, включая предустановленный питон 2.7 (например, `pip` `pip3` на Ubuntu или macOS), убедитесь, что вы используете правильный или установить **iotedgehubdev**

Для тестирования модуля на устройстве потребуется действующий центр Интернета вещей по крайней мере с одним устройством IoT Edge. Чтобы использовать компьютер в качестве устройства IoT Edge, выполните инструкции в кратком руководстве для [Linux](quickstart-linux.md) или [Windows](quickstart.md). Если вы запустили управляющую программу IoT Edge на компьютере разработки, может потребоваться остановить EdgeHub и EdgeAgent, прежде чем перейти к следующему шагу.

## <a name="create-a-new-solution-template"></a>Создайте новый шаблон решения

В следующих шагах показано, как создать модуль IoT Edge с помощью предпочитаемого языка разработки (включая Функции Azure, написанные на языке C#) с использованием Visual Studio Code и средств Azure IoT. Сначала нужно создать решение, а затем сформировать первый модуль в этом решении. Каждое решение может содержать несколько модулей.

1. Выберите**палитру команды** **просмотра.** > 

1. В палитре команд введите и выполните команду **Azure IoT Edge: New IoT Edge Solution**.

   ![Запуск команды создания решения IoT Edge](./media/how-to-develop-csharp-module/new-solution.png)

1. Перейдите к папке, где требуется создать решение, и щелкните **Выбрать папку**.

1. Введите имя для решения.

1. Выберите шаблон модуля для предпочитаемого языка разработки. Он станет первым модулем в решении.

1. Введите имя модуля. Оно должно быть уникальным в пределах реестра контейнеров.

1. Укажите имя репозитория образов для модуля. Visual Studio Code автоматически заполняет имя модуля значением **localhost:5000/<имя вашего модуля\>**. Замените его собственными данными реестра. Если вы используете местный реестр Docker для тестирования, то **localhost** в порядке. Если используется Реестр контейнеров Azure, укажите сервер входа, заданный в параметрах реестра. Сервер входа выглядит как ** _ \<\>имя реестра_.azurecr.io**. Только заменить **localhost:5000** часть строки так, что конечный результат выглядит как ** \< *имя*\>реестра .azurecr.io/_\<имя\>модуля_**.

   ![Выбор репозитория образа Docker](./media/how-to-develop-csharp-module/repository.png)

Visual Studio Code принимает предоставленные сведения, создает решение IoT Edge, а затем загружает его в новом окне.

В решении существует четыре элемента:

- Папка **.vscode** содержит конфигурации отладки.

- Папка **modules** содержит вложенные папки для каждого модуля.  В папке для каждого модуля есть файл, **module.json**, который контролирует, как модули строятся и развертываются.  Этот файл необходимо будет изменить, чтобы изменить реестр контейнеров развертывания модуля с локального регистратора в удаленный реестр. На данный момент у вас есть только один модуль.  Но вы можете добавить модули в палитре команд с помощью команды **Azure IoT Edge: Add IoT Edge Module**.

- В файле **ENV** перечислены переменные среды. Если реестр контейнеров Azure является вашим реестром, вы получите в нем имя пользователя и пароль для реестра контейнеров Azure.

  > [!NOTE]
  > Файл среды создается только в том случае, если вы указали репозиторий образов для модуля. Если вы не изменяли значения по умолчанию localhost для тестирования и отладки локально, объявлять переменные среды не требуется.

- Файл **deployment.template.json** перечисляет ваш новый модуль вместе с образцом **модуля SimulatedTemperatureSensor,** который имитирует данные, которые можно использовать для тестирования. Дополнительные сведения о том, как работают манифесты развертывания, см. в разделе [Сведения об использовании манифестов развертывания для развертывания модулей и установки маршрутов](module-composition.md).

Чтобы увидеть, как работает смоделированный температурный модуль, просмотрите [исходный код SimulatedTemperatureSensor.csproj.](https://github.com/Azure/iotedge/tree/master/edge-modules/SimulatedTemperatureSensor)

## <a name="add-additional-modules"></a>Добавление дополнительных модулей

Чтобы добавить дополнительные модули в решение, запустите команду **Azure IoT Edge: Добавьте модуль IoT Edge** из командной палитры. Кроме того, вы можете щелкнуть правой кнопкой мыши папку **modules** или файл `deployment.template.json` в представлении обозревателя Visual Studio Code и выбрать **Add IoT Edge Module** (Добавить модуль IoT Edge).

## <a name="develop-your-module"></a>Разработка модуля

Код модуля по умолчанию, который поставляется вместе с решением, находится в следующем расположении:

- Функция Azure (С): **модули > >  * &lt;имя&gt;модуля**&lt;вашего модуля&gt;*.cs**
- C#: **modules > *&lt;имя вашего модуля&gt;*  > Program.cs**.
- Python: **modules > *&lt;имя вашего модуля&gt;*  > main.py**.
- Node.js: **modules > *&lt;имя вашего модуля&gt;*  > app.js**.
- Java: **modules > *&lt;имя вашего модуля&gt;*  > src > main > java > com > edgemodulemodules > App.java**.
- C: **modules > *&lt;имя вашего модуля&gt;*  > main.c**.

Модуль и файл deployment.template.json настраиваются так, чтобы можно было собрать решение, передать его в реестр контейнеров и развернуть на устройстве, чтобы начать тестирование, не меняя код. Модуль построен, чтобы просто принимать входные данные из источника (в данном случае, модуля SimulatedTemperatureSensor, который имитирует данные) и труба его в IoT концентратор.

Когда вы будете готовы настроить шаблон с добавлением собственного кода, используйте [пакеты SDK для Центра Интернета вещей Azure](../iot-hub/iot-hub-devguide-sdks.md), чтобы создать модули, которые удовлетворяют ключевые потребности решений Интернета вещей, такие как безопасность, управление устройствами и надежность.

## <a name="debug-a-module-without-a-container-c-nodejs-java"></a>Отладка модуля без контейнера (C#, Node.js, Java)

Если вы выполняете разработку на языке C#, Node.js или Java, в коде модуля по умолчанию необходимо использовать объект **ModuleClient** для запуска, выполнения и маршрутизации сообщений. Кроме того, нужно будет использовать входной канал по умолчанию **input1** для выполнения действий, когда модуль получает сообщения.

### <a name="set-up-iot-edge-simulator-for-iot-edge-solution"></a>Настройка симулятора IoT Edge для решения IoT Edge

Вместо установки управляющей программы безопасности IoT Edge на компьютере разработки можно запустить симулятор IoT Edge для выполнения решения IoT Edge.

1. В обозревателе устройств с левой стороны щелкните идентификатор устройства IoT Edge правой кнопкой мыши, а затем выберите **Setup IoT Edge Simulator** (Настроить симулятор IoT Edge), чтобы запустить симулятор со строкой подключения устройства.
1. Прочитав сведения о ходе выполнения в интегрированном терминале, вы можете увидеть, что симулятор IoT Edge успешно настроен.

### <a name="set-up-iot-edge-simulator-for-single-module-app"></a>Настройка симулятора IoT Edge для приложения одного модуля

Чтобы настроить и запустить симулятор, запустите команду **Azure IoT Edge: Запустите IoT Edge Hub Simulator для одного модуля** из палитры командного кода Visual Studio. При появлении запроса в качестве входного имени для вашего приложения используйте значение **input1** из кода модуля по умолчанию (или эквивалентное значение из вашего кода). Команда активирует CLI **iotedgehubdev**, а затем запускает симулятор IoT Edge и тестирование контейнера модуля служебной программы. Вы можете увидеть приведенные ниже выходные данные во встроенном терминале, если симулятор был успешно запущен в режиме одного модуля. Также вы увидите команду `curl`, помогающую при пересылке сообщений. Оно понадобится вам позже.

   ![Настройка симулятора IoT Edge для приложения одного модуля](media/how-to-develop-csharp-module/start-simulator-for-single-module.png)

   Состояние выполнения модуля можно просмотреть в представлении обозревателя Docker в Visual Studio Code.

   ![Состояние модуля симулятора](media/how-to-develop-csharp-module/simulator-status.png)

   Контейнер **edgeHubDev** — это ядро локального симулятора IoT Edge. Вы можете запустить его на компьютере разработки без управляющей программы безопасности IoT Edge. Он предоставит параметры среды для собственного приложения модуля или контейнеров модуля. Контейнер **input** предоставляет REST API, помогающие отправлять сообщения в целевой входной канал в вашем модуле.

### <a name="debug-module-in-launch-mode"></a>Отладка модуля в режиме запуска

1. Подготовьте свою среду к отладке в соответствии с требованиями языка разработки, установите точку останова в модуле и выберите необходимую конфигурацию отладки:
   - **C #**
     - В интегрированном терминале Visual Studio Code измените каталог в *** &lt;папку с именем&gt; модуля,*** а затем запустите следующую команду для создания приложения .NET Core.

       ```cmd
       dotnet build
       ```

     - Откройте файл `Program.cs` и добавьте точку останова.

     - Перейдите в представление отладки Visual Studio Code, выбрав **Вид > Отладка**. Выберите конфигурацию отжута ** * &lt;вашего модуля&gt; имя* Локальное отображение (.NET Core)** из выпадения.

        > [!NOTE]
        > Если ваше ядро `TargetFramework` .NET не соответствует `launch.json`траектории программы, вам необходимо вручную `launch.json` обновить траекторию программы, чтобы соответствовать `TargetFramework` файлу .csproj, чтобы Visual Studio Code мог успешно запустить эту программу.

   - **Node.js**
     - В интегрированном терминале Visual Studio Code измените каталог в *** &lt;папку с именем&gt; модуля,*** а затем запустите следующую команду для установки пакетов узлов

       ```cmd
       npm install
       ```

     - Откройте файл `app.js` и добавьте точку останова.

     - Перейдите в представление отладки Visual Studio Code, выбрав **Вид > Отладка**. Выберите конфигурацию отжутов, ** * &lt;&gt; имя модуля* Local Debug (Node.js)** из выпадения.
   - **Java**
     - Откройте файл `App.java` и добавьте точку останова.

     - Перейдите в представление отладки Visual Studio Code, выбрав **Вид > Отладка**. Выберите конфигурацию отжутов ** * &lt;в модуле имя&gt; * Локальное отображение (Java)** из выпадения.

1. Щелкните **Начать отладку** или нажмите клавишу **F5**, чтобы запустить сеанс отладки.

1. В интегрированном терминале Visual Studio Code выполните следующую команду, чтобы отправить сообщение **Hello World** в модуль. Это команда, показанная на предыдущих шагах при настройке симулятора IoT Edge.

    ```bash
    curl --header "Content-Type: application/json" --request POST --data '{"inputName": "input1","data":"hello world"}' http://localhost:53000/api/v1/messages
    ```

   > [!NOTE]
   > Если вы используете Windows, убедитесь, что используется оболочка интегрированного терминала Visual Studio Code **Git Bash** или **WSL Bash**. Команду `curl` нельзя запустить в PowerShell или командной строке.
   > [!TIP]
   > Вместо `curl` для отправки сообщений можно использовать [PostMan](https://www.getpostman.com/) или другие средства API.

1. В представлении отладки Visual Studio Code можно просмотреть переменные на панели слева.

1. Чтобы остановить сеанс отладки, выберите кнопку Stop или нажмите **Shift и F5,** а затем запустите **Azure IoT Edge: Остановите IoT Edge Simulator** в командной палитре, чтобы остановить симулятор и очистить его.

## <a name="debug-in-attach-mode-with-iot-edge-simulator-c-nodejs-java-azure-functions"></a>Отладка в режиме подключения с помощью симулятора IoT Edge (C#, Node.js, Java, Функции Azure)

Решение по умолчанию содержит два модуля: имитированный модуль датчика температуры и модуль канала. Имитируемый модуль датчика температуры отправляет сообщения в модуль канала, а затем сообщения отправляются по каналу в Центр Интернета вещей. В созданной папке модуля находится несколько файлов Docker для разных типов контейнеров. Вы можете использовать любой **DEBUG**-файл, чтобы создать модуль для тестирования.

В настоящее время отладка в режиме подключения поддерживается только следующим образом:

- Модули C#, в том числе для Функций Azure, поддерживают отладку в контейнерах amd64 Linux.
- Модули Node.js поддерживают отладку в контейнерах amd64 и arm32v7 Linux, а также в контейнерах amd64 Windows.
- Модули Java поддерживают отладку в контейнерах amd64 и arm32v7 Linux.

> [!TIP]
> Вы можете переключаться между вариантами для платформы по умолчанию для своего решения IoT Edge, щелкнув элемент в строке состояния Visual Studio Code.

### <a name="set-up-iot-edge-simulator-for-iot-edge-solution"></a>Настройка симулятора IoT Edge для решения IoT Edge

Вместо установки управляющей программы безопасности IoT Edge на компьютере разработки можно запустить симулятор IoT Edge для выполнения решения IoT Edge.

1. В обозревателе устройств с левой стороны щелкните идентификатор устройства IoT Edge правой кнопкой мыши, а затем выберите **Setup IoT Edge Simulator** (Настроить симулятор IoT Edge), чтобы запустить симулятор со строкой подключения устройства.

1. Прочитав сведения о ходе выполнения в интегрированном терминале, вы можете увидеть, что симулятор IoT Edge успешно настроен.

### <a name="build-and-run-container-for-debugging-and-debug-in-attach-mode"></a>Создание и выполнение контейнера для отладки и отладка в режиме подключения

1. Откройте файл модуля (`Program.cs`, `app.js`, `App.java` или `<your module name>.cs`) и добавьте точку останова.

1. В представлении обозревателя Visual Studio Code щелкните правой кнопкой мыши файл `deployment.debug.template.json` для своего решения и выберите **Build and Run IoT Edge solution in Simulator** (Выполнить сборку и запуск решения IoT Edge в симуляторе). Все журналы контейнеров модуля можно просмотреть в одном окне. Кроме того, можно перейти к представлению Docker, чтобы просмотреть состояние контейнера.

   ![Просмотр переменных](media/how-to-vs-code-develop-module/view-log.png)

1. Перейдите к представлению отладки Visual Studio Code и выберите файл конфигурации отладки для модуля. Имя опции отладки должно быть похоже на ** * &lt;имя&gt; модуля* Remote Debug**

1. Нажмите кнопку **Начать отладку** или клавишу **F5**. Выберите процесс для присоединения.

1. В представлении отладки Visual Studio Code можно просмотреть переменные на панели слева.

1. Чтобы остановить сеанс отладки, сначала выберите кнопку «Стоп» или нажмите **Shift и F5,** а затем выберите **Azure IoT Edge: Stop IoT Edge Simulator** из командной палитры.

> [!NOTE]
> В предыдущем примере показаны способы отладки модулей IoT Edge в контейнерах. В параметры `createOptions` контейнера вашего модуля были добавлены открытые порты. После завершения отладки модулей рекомендуется удалить эти открытые порты для модулей IoT Edge, готовых для рабочей среды.
>
> Для модулей, написанных на языке C#, включая Функции Azure, этот пример основан на отладочной версии файла `Dockerfile.amd64.debug`, который при сборке образа контейнера включает в него отладчик командной строки .NET Core (VSDBG). После отладки модулей C# рекомендуется непосредственно использовать файл Dockerfile без VSDBG для готовых модулей IoT Edge.

## <a name="debug-a-module-with-the-iot-edge-runtime"></a>Отладка модуля с использованием среды выполнения IoT Edge

В папке каждого модуля находится несколько файлов Docker для разных типов контейнеров. Вы можете использовать любой **DEBUG**-файл, чтобы создать модуль для тестирования.

При отладке модулей с помощью этого метода модули работают поверх среды выполнения IoT Edge. Устройство IoT Edge и ваш Visual Studio Code могут находиться на одном и том же компьютере или, как правило, на разных компьютерах (Visual Studio Code находится на компьютере разработчика, а среда выполнения IoT Edge и модули работают на другом физическом компьютере). Чтобы выполнять отладку из Visual Studio Code, необходимо сделать следующее:

- Настройте устройство IoT Edge, соберите модули IoT Edge с помощью Dockerfile **.debug**, а затем разверните их на устройство IoT Edge.
- Предоставьте протокол IP и порт модуля, чтобы можно было присоединить отладчик.
- Обновите файл `launch.json`, чтобы Visual Studio Code мог присоединиться к процессу в контейнере на удаленном компьютере. Этот файл находится в папке `.vscode` в вашей рабочей области и обновляется каждый раз при добавлении нового модуля, который поддерживает отладку.

### <a name="build-and-deploy-your-module-to-the-iot-edge-device"></a>Создание и развертывание модуля на устройство IoT Edge

1. В Visual Studio Code откройте файл `deployment.debug.template.json`, который содержит отладочную версию образов вашего модуля с соответствующими значениями `createOptions`.

1. Если вы разрабатываете свой модуль на языке Python, сначала выполните следующие шаги:
   - Откройте файл `main.py` и добавьте этот код после раздела импорта:

      ```python
      import ptvsd
      ptvsd.enable_attach(('0.0.0.0',  5678))
      ```

   - Добавьте следующую строку кода в обратный вызов, который необходимо отладить:

      ```python
      ptvsd.break_into_debugger()
      ```

     Например, если вы хотите `receive_message_listener` отладить функцию, вы введете эту строку кода, как показано ниже:

      ```python
      def receive_message_listener(client):
          ptvsd.break_into_debugger()
          global RECEIVED_MESSAGES
          while True:
              message = client.receive_message_on_input("input1")   # blocking call
              RECEIVED_MESSAGES += 1
              print("Message received on input1")
              print( "    Data: <<{}>>".format(message.data) )
              print( "    Properties: {}".format(message.custom_properties))
              print( "    Total calls received: {}".format(RECEIVED_MESSAGES))
              print("Forwarding message to output1")
              client.send_message_to_output(message, "output1")
              print("Message successfully forwarded")
      ```

1. В строке командной палитры Visual Studio Code выполните следующие действия:
   1. Запустите команду **Azure IoT Edge: создайте и нажмите на решение IoT Edge.**

   1. Выберите файл `deployment.debug.template.json` для вашего решения.

1. В представлении обозревателя Visual Studio Code в разделе **Azure IoT Hub Devices** (Устройства Центра Интернета вещей Azure) выполните следующие действия:
   1. Нажмите правой кнопкой IoT Edge идентификатор устройства, а затем выберите **Создать Развертывание для одного устройства.**

      > [!TIP]
      > Чтобы подтвердить, что выбранное устройство является устройством IoT Edge, выберите его, после чего развернется список модулей, где можно проверить наличие **$edgeHub** и **$edgeAgent**. Каждое устройство IoT Edge содержит эти два модуля.

   1. Перейдите к папке **config** решения, выберите файл `deployment.debug.amd64.json`, а затем щелкните **Select Edge Deployment Manifest** (Выбрать манифест развертывания Edge).

Ход развертывания можно отслеживать по идентификатору развертывания в интегрированном терминале.

Чтобы проверить состояние контейнера, выполните команду `docker ps` в окне терминала. Если ваш Visual Studio Code и среда выполнения IoT Edge работают на одном компьютере, вы также можете проверить состояние в представлении Docker Visual Studio Code.

### <a name="expose-the-ip-and-port-of-the-module-for-the-debugger"></a>Предоставление IP-адреса и порта модуля для отладчика

Вы можете пропустить этот раздел, если модули работают на том же компьютере, что и Visual Studio Code, так как вы используете localhost для присоединения к контейнеру и уже предоставили правильные параметры порта в файле Dockerfile с расширением **.debug**, параметрах `createOptions` контейнера модуля и файле `launch.json`. Если модули и Visual Studio Code работают на разных компьютерах, следуйте указаниям для выбранного языка разработки.

- **C#, включая Функции Azure**

  [Настройте канал SSH на компьютере разработки и устройство IoT Edge](https://github.com/OmniSharp/omnisharp-vscode/wiki/Attaching-to-remote-processes), а затем измените файл `launch.json` для присоединения.

- **Node.js**

  - Убедитесь, что модуль на компьютере для отладки запущен и готов для присоединения отладчиков и что порт 9229 доступен извне. Это можно проверить, открыв страницу `http://<target-machine-IP>:9229/json` на компьютере отладчика. Этот URL-адрес должен показать сведения о модуле Node.js для отладки.
  
  - На машине разработки откройте Visual `launch.json` Studio Code, а затем отредугите так, чтобы значение адреса ** * &lt;профиля&gt; * Удаленного отъежания модуля (Node.js)** (или ** * &lt;имя&gt; модуля* Remote Debug (Node.js в Windows Container)** при отъезде модуля в качестве контейнера Windows) — это IP-версия отладки машины.

- **Java**

  - Выполните сборку туннеля SSH на компьютере для отладки, запустив код `ssh -f <username>@<target-machine> -L 5005:127.0.0.1:5005 -N`.
  
  - На машине разработки откройте Visual Studio Code и отредкройте `launch.json` ** * &lt;профиль smodule&gt; * Remote Debug (Java),** чтобы можно было прикрепиться к целевой машине. Дополнительные сведения о редактировании файла `launch.json` и отладке Java с помощью Visual Studio Code см. в разделе [о настройке отладчика](https://code.visualstudio.com/docs/java/java-debugging#_configuration).

- **Python**

  - Убедитесь, что порт 5678 на компьютере, для которого требуется отладка, открыт и доступен.

  - В коде `ptvsd.enable_attach(('0.0.0.0', 5678))`, ранее вставленном в файл `main.py`, измените **0.0.0.0** на IP-адрес компьютера для отладки. Снова выполните сборку, отправку и развертывание своего модуля IoT Edge.

  - На машине разработки откройте Visual `launch.json` Studio Code, а затем отредкройте так, чтобы `host` значение ** * &lt;вашего профиля&gt; «Удаленное* отображение» (Python)** использования IP-адреса целевой `localhost`машины вместо .

### <a name="debug-your-module"></a>Отладка модуля

1. В представлении отладки Visual Studio Code выберите файл конфигурации отладки для модуля. Имя опции отладки должно быть похоже на ** * &lt;имя&gt; модуля* Remote Debug**

1. Откройте файл модуля для используемого языка разработки и добавьте точку останова:

   - **Функция Azure (C)**: Добавьте точку разрыва в файл. `<your module name>.cs`
   - **C q**: Добавьте точку разрыва в файл. `Program.cs`
   - **Node.js**: Добавьте точку `app.js`разрыва в файл.
   - **Java**: Добавьте точку `App.java`разрыва в файл.
   - **Python**: Добавить точку `main.py`разрыва в файл в `ptvsd.break_into_debugger()` методе обратного вызова, где вы добавили строку.
   - **C**: Добавьте точку `main.c`разрыва в файл.

1. Выберите **Начать отладку** или нажмите клавишу **F5**. Выберите процесс для присоединения.

1. В представлении отладки Visual Studio Code можно просмотреть переменные на панели слева.

> [!NOTE]
> В предыдущем примере показаны способы отладки модулей IoT Edge в контейнерах. В параметры `createOptions` контейнера вашего модуля были добавлены открытые порты. После завершения отладки модулей рекомендуется удалить эти открытые порты для модулей IoT Edge, готовых для рабочей среды.

## <a name="build-and-debug-a-module-remotely"></a>Удаленная сборка и отладка модуля

С последними изменениями в модулях Docker и Moby для поддержки соединений SSH, и новыми настройками в Инструментах Интернета вещей Azure, которые позволяют приспособление параметров среды в палитру команд Visual Studio Code и в терминалы Azure IoT Edge, вы можете создавать и делать отладку модулей на удаленных устройствах.

Дополнительные сведения и пошаговые инструкции см. в [Запись в блоге разработчиков Интернета вещей](https://devblogs.microsoft.com/iotdev/easily-build-and-debug-iot-edge-modules-on-your-remote-device-with-azure-iot-edge-for-vs-code-1-9-0/).

## <a name="next-steps"></a>Дальнейшие действия

После создания модуля узнайте, как [развернуть модули Azure IoT Edge в Visual Studio Code](how-to-deploy-modules-vscode.md).

Чтобы разрабатывать модули для устройств IoT Edge, см. раздел [Понимание и использование пакетов SDK для Центра Интернета вещей Azure](../iot-hub/iot-hub-devguide-sdks.md).
