---
title: Слишком большой заголовок запроса на устранение ошибки или 400 недопустимый запрос Azure Cosmos DB
description: Как диагностировать и устранить исключение слишком большого заголовка запроса
author: j82w
ms.service: cosmos-db
ms.date: 07/13/2020
ms.author: jawilley
ms.topic: troubleshooting
ms.reviewer: sngun
ms.openlocfilehash: 942af52c43a1d4526a42f20df40abf3f510e0ee6
ms.sourcegitcommit: dccb85aed33d9251048024faf7ef23c94d695145
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/28/2020
ms.locfileid: "87294670"
---
# <a name="diagnose-and-troubleshoot-azure-cosmos-db-request-header-too-large-message"></a>Диагностика и устранение неполадок Azure Cosmos DB заголовка запроса слишком большой размер сообщения
Сообщение о слишком большом заголовке запроса вызывается с кодом ошибки HTTP 400. Эта ошибка возникает, если размер заголовка запроса увеличился слишком большой и превышает максимально допустимый размер. Рекомендуется использовать последнюю версию пакета SDK. Используйте по меньшей мере версии 3. x или 2. x, так как эти версии добавляют к сообщению об исключении трассировку размера заголовка.

## <a name="troubleshooting-steps"></a>Действия по устранению неполадок
Если сеанс или маркер продолжения слишком велики, происходит слишком большое сообщение заголовка запроса. В следующих разделах описывается причина и решение проблемы в каждой категории.

### <a name="1-session-token-too-large"></a>1. токен сеанса слишком велик

#### <a name="cause"></a>Причина.
400. недопустимый запрос, скорее всего, вызван большим размером токена сеанса. Если следующие инструкции имеют значение true, то он подтверждает, что маркер сеанса слишком большой.

* Эта ошибка возникает в операции с точкой, например в операциях создания, чтения, обновления и т. д., где нет токена продолжения.
* Исключение запущено без внесения изменений в приложение. Маркер сеанса растет по мере увеличения числа секций в контейнере. Количество секций увеличивается по мере увеличения объема данных или увеличения пропускной способности.

#### <a name="temporary-mitigation"></a>Временное снижение: 
Перезапустите клиентское приложение, чтобы сбросить все токены сеанса. В конечном итоге маркер сеанса вернется к предыдущему размеру, вызвавшему эту неполадку. Поэтому используйте решение в следующем разделе, чтобы полностью избежать этой проблемы.

#### <a name="solution"></a>Решение:
1. Следуйте указаниям в статье Советы по повышению производительности [.NET v3](performance-tips-dotnet-sdk-v3-sql.md) или [.NET v2](performance-tips.md) и преобразуйте приложение в режим прямого подключения с протоколом TCP. Прямой режим с протоколом TCP не имеет ограничений на размер заголовка, таких как протокол HTTP, поэтому это позволяет избежать этой проблемы. Обязательно используйте последнюю версию пакета SDK, которая содержит исправление для операций запросов, если взаимодействие служб недоступно.
2. Если режим прямого подключения с протоколом TCP не является параметром для вашей рабочей нагрузки, его можно уменьшить, изменив [уровень согласованности клиента](how-to-manage-consistency.md). Токен сеанса используется только для обеспечения согласованности сеанса, что является уровнем согласованности по умолчанию для Azure Cosmos DB. Другие уровни согласованности не используют токен сеанса.

### <a name="2-continuation-token-too-large"></a>2. маркер продолжения слишком велик

#### <a name="cause"></a>Причина.
Недопустимый запрос 400 в операциях запроса, в которых используется токен продолжения. Значение, если маркер продолжения стал слишком большим, или если разные запросы имеют разные размеры маркеров продолжения.
    
#### <a name="solution"></a>Решение:
1. Следуйте указаниям в статье Советы по повышению производительности [.NET v3](performance-tips-dotnet-sdk-v3-sql.md) или [.NET v2](performance-tips.md) и преобразуйте приложение в режим прямого подключения с протоколом TCP. Прямой режим с протоколом TCP не имеет ограничений на размер заголовка, таких как протокол HTTP, поэтому это позволяет избежать этой проблемы. 
3. Если режим прямого подключения с протоколом TCP не является параметром для вашей рабочей нагрузки, попробуйте задать `ResponseContinuationTokenLimitInKb` параметр. Этот параметр можно найти в параметре `FeedOptions` for v2 или `QueryRequestOptions` в версии 3.

## <a name="next-steps"></a>Дальнейшие шаги
* [Диагностика и устранение неполадок](troubleshoot-dot-net-sdk.md) при использовании пакета SDK для Azure Cosmos DB .NET
* Сведения о рекомендациях по производительности для [.NET v3](performance-tips-dotnet-sdk-v3-sql.md) и [.NET v2](performance-tips.md)
