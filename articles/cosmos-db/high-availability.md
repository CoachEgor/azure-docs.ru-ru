---
title: Высокий уровень доступности в Azure Cosmos DB
description: В этой статье описывается, как Azure Cosmos DB обеспечивает высокий уровень доступности
author: markjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 05/21/2019
ms.author: mjbrown
ms.reviewer: sngun
ms.openlocfilehash: 74e2d7901d127c9dd7edd8509e5bba082c4ad220
ms.sourcegitcommit: 59fd8dc19fab17e846db5b9e262a25e1530e96f3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/21/2019
ms.locfileid: "65978971"
---
# <a name="high-availability-with-azure-cosmos-db"></a>Высокий уровень доступности при использовании Azure Cosmos DB

Azure Cosmos DB прозрачно реплицирует данные во всех регионах Azure, связанных с вашей учетной записью Cosmos. Cosmos DB реализует несколько уровней избыточности для данных, как показано на рисунке ниже.

![Физическое секционирование](./media/high-availability/cosmosdb-data-redundancy.png)

- Данные внутри контейнеров Cosmos [горизонтально секционированной](partitioning-overview.md).

- Каждая секция в каждом регионе защищена с помощью набора реплик. При этом все записи реплицируются и надежно фиксируются большей частью реплик. Реплики распределены между 10–20 доменами сбоя.

- Все секции реплицируются во всех регионах. Каждый регион содержит все секции данных контейнера Cosmos и может принимать записи и обслуживать операции чтения.  

Если вашей учетной записи Cosmos распределяется по *N* регионов Azure, будет существовать по крайней мере *N* x 4 копий всех данных. Помимо предоставления доступа к данным низкую задержку и Масштабирование пропускной способности чтения и записи в регионах, связанных с вашей учетной записью Cosmos, наличие дополнительных регионах (выше *N*) еще больше повышает доступность.  

## <a name="slas-for-availability"></a>Соглашения об уровне обслуживания для доступности

Как глобально распределенная база данных Cosmos DB предоставляет исчерпывающие Соглашения об уровне обслуживания, включающие пропускную способность, задержки на уровне 99-го процентиля, согласованность и высокую доступность. В приведенной ниже таблице указаны гарантии высокой доступности, предоставляемые Cosmos DB для учетных записей в одном и нескольких регионах. Для обеспечения высокой доступности всегда следует настройте учетные записи Cosmos в несколько регионов для записи.

|Operation type (Тип операции)  | Один регион |Несколько регионов (один регион записи)|Несколько регионов (несколько регионов записи) |
|---------|---------|---------|-------|
|Запись    | 99,99    |99,99   |99,999|
|Чтение     | 99,99    |99,999  |99,999|

> [!NOTE]
> На практике доступности фактическую запись для ограниченная с запаздыванием, сеанса, согласованность префиксов и согласованность модели значительно больше, чем опубликованных соглашения об уровне обслуживания. Фактическая доступность чтения для всех уровней согласованности значительно выше, чем в опубликованных Соглашениях об уровне обслуживания.

## <a name="high-availability-with-cosmos-db-in-the-event-of-regional-outages"></a>Высокий уровень доступности с помощью Cosmos DB в случае региональных сбоев

Встречаются регионов и Azure Cosmos DB гарантирует, что базы данных всегда является высокодоступной. Следующие сведения записи Cosmos DB поведение во время сбоя, в зависимости от конфигурации учетной записи Cosmos:

- Когда используется Cosmos DB, до того как операция записи подтверждается для клиента, данные продолжительно фиксируются кворумом реплик в том регионе, в котором происходит запись.

- Учетные записи, связанные с несколькими регионами, настроенные на использование нескольких регионов записи, будут сохранять высокую доступность как для операций записи, так и для операций чтения. Региональные отработки отказа происходят мгновенно и не требуют изменений приложения.

- **Мультирегиональные учетные записи с одной записи, регион (сбой региона записи):** будут сохранять высокий уровень доступности для операций чтения при сбое региона записи. Тем не менее, для операций записи необходимо **«включить автоматическую отработку отказа»** на вашей Cosmos запись для отработки отказа затронутом регионе в другой регион. Отработка отказа будет выполняться в указанном порядке приоритетов регионов. Когда затронутый регион не вернется в оперативный режим, нереплицированные данные в регионе затронутые записи во время сбоя становятся доступными через [конфликты веб-канала](how-to-manage-conflicts.md#read-from-conflict-feed). Приложения могут считывать конфликты веб-канала, устраните конфликты на основе логики приложения и записать обновленные данные обратно в контейнер Cosmos соответствующим образом. После восстановления ранее затронутый регион записи становится автоматически доступным как регион чтения. Вы можете вызвать отработку отказа вручную и настроить затронутый регион в качестве региона записи. Снова можно сделать на другой ресурс вручную с помощью [Azure CLI или портала Azure](how-to-manage-database-account.md#manual-failover). **Потеря данных или доступности исключена** до, во время или после отработки отказа вручную. Приложение сохраняет высокий уровень доступности. 

- **Мультирегиональные учетные записи с одной записи, регион (сбой региона чтения):** будут сохранять высокую доступность для операций чтения и записи при сбое региона чтения. Затронутый регион автоматически отсоединяется от региона записи и помечается как отключенный. [Пакеты SDK Cosmos DB](sql-api-sdk-dotnet.md) будет перенаправлять вызовы чтения к следующему доступному региону в списке предпочтительных регионов. Если ни один из регионов в списке предпочтительных регионов недоступен, вызовы автоматически будут перенаправлены к текущему региону записи. Для обработки сбоя региона чтения изменения в коде приложения не требуются. В конечном счете, когда работа затронутого региона восстанавливается, ранее затронутый регион чтения автоматически синхронизируется с текущим регионом записи и снова становится доступным для обслуживания операций чтения. Последующие операции чтения перенаправляются в восстановленный регион без каких-либо изменений в коде приложения. Во время отработки отказа и повторное присоединение завершившуюся области чтения согласованности, гарантии продолжают учитываться в Cosmos DB.

- Учетные записи с одним регионом могут потерять доступность после регионального сбоя. Всегда рекомендуется настроить **по крайней мере два региона** (предпочтительно, по крайней мере два записи регионах) с учетной записью Cosmos для обеспечения высокой доступности все время.

- Даже в очень редких и нежелательным событие при окончательно неисправимое регионе Azure есть без потери данных Если вашей учетной записи Cosmos межрегиональных настроен уровень согласованности по умолчанию *строгих*. В случае областью окончательно неисправимое записи для учетных записей Cosmos нескольких регионах, настроен с согласованностью с ограниченным устареванием, окна потенциальные потери данных ограничены окна устаревания (*K* или *T*); для сеанса, согласованность префиксов и окончательная согласованность уровней, окна потенциальные потери данных ограничены не более пяти секунд.

## <a name="building-highly-available-applications"></a>Создание высокодоступных приложений

- Чтобы обеспечить высокий уровень доступности операций записи и чтения, настройте учетную запись Cosmos на поддержку по крайней мере двух регионов с несколькими регионами записи. Эта конфигурация обеспечивает максимально высокий уровень доступности, задержки и максимальную масштабируемость для обоих считывает и записывает это прописано в соглашениях об уровне обслуживания. Дополнительные сведения см. в статье [Настройка глобального распределения Azure Cosmos DB с помощью API SQL](tutorial-global-distribution-sql-api.md).

- Для учетных записей Cosmos с несколькими регионами, для которых настроен один регион записи, см. раздел [Включение автоматического перехода на другой ресурс вручную для учетной записи Cosmos](how-to-manage-database-account.md#automatic-failover). При включенной автоматической отработке отказа в случае регионального сбоя Cosmos DB будет автоматически выполнять отработку отказа вашей учетной записи.  

- Даже если учетная запись Cosmos обеспечивает высокую доступность, из-за структуры приложение может не обеспечивать высокий уровень доступности. Чтобы протестировать end-to-end высокий уровень доступности приложения, периодически вызывать [на другой ресурс вручную с помощью Azure CLI или портала Azure](how-to-manage-database-account.md#manual-failover), как часть тестирования приложений и аварийного восстановления (DR) Детализирует.

- В среде глобально распределенной базы данных существует прямая связь между уровнем согласованности и устойчивостью данных при наличии простоя в регионе. При разработке плана обеспечения непрерывности бизнес-процессов нужно понимать, какое максимальное время до полного восстановления приложения после аварийного события допустимо. Время, необходимое приложению для полного восстановления, называется целевым временем восстановления (RTO). Необходимо также понимать, потерю какого максимального периода последних обновлений данных приложение может допустить при восстановлении после аварийного события. Этот период обновлений является целевой точкой восстановления (RPO). Значения RPO и RTO для Azure Cosmos DB см. в разделе [Уровни согласованности и устойчивость данных](consistency-levels-tradeoffs.md#rto).

## <a name="next-steps"></a>Дальнейшие действия

См. подробнее:

* [Достижение компромисса между доступностью и быстродействием для разных уровней согласованности](consistency-levels-tradeoffs.md)
* [Масштабирование пропускной способности в Azure Cosmos DB](scaling-throughput.md)
* [Глобальное распределение (взгляд изнутри)](global-dist-under-the-hood.md)
* [Настраиваемые уровни согласованности данных в Azure Cosmos DB](consistency-levels.md)
* [Настройка учетной записи Cosmos с использованием нескольких регионов записи](how-to-multi-master.md)
