---
title: Часто задаваемые вопросы о подготовленной пропускной способности автомасштабирования в Azure Cosmos DB
description: Часто задаваемые вопросы о подготовленной пропускной способности автомасштабирования для баз данных Azure Cosmos DB и контейнеров
author: deborahc
ms.author: dech
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 04/28/2020
ms.openlocfilehash: fa4c2708f34a377a17914c7e6e5abdd709cbb5b1
ms.sourcegitcommit: e0330ef620103256d39ca1426f09dd5bb39cd075
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/05/2020
ms.locfileid: "82791788"
---
# <a name="frequently-asked-questions-about-autoscale-provisioned-throughput-in-azure-cosmos-db"></a>Часто задаваемые вопросы о подготовленной пропускной способности автомасштабирования в Azure Cosmos DB

При подготовленной пропускной способности автомасштабирования Azure Cosmos DB будет автоматически управлять единицами запросов в контейнере или базе данных и масштабировать их в зависимости от их использования. В этой статье содержатся ответы на часто задаваемые вопросы об автомасштабировании.

## <a name="frequently-asked-questions"></a>Вопросы и ответы

### <a name="is-autoscale-supported-for-all-apis"></a>Поддерживается ли автомасштабирование для всех API?
Да, автомасштабирование поддерживается для всех API-интерфейсов: Core (SQL), Gremlin, Table, Cassandra и API для MongoDB.

### <a name="is-autoscale-supported-for-multi-master-accounts"></a>Поддерживается ли автомасштабирование для учетных записей с несколькими хозяевами?
Да, автомасштабирование поддерживается для учетных записей с несколькими хозяевами. В каждом регионе, который добавляется в учетную запись Cosmos, доступны максимальные единицы запросов в секунду. 

### <a name="what-is-the-pricing-for-autoscale-"></a>Каковы цены на Автомасштабирование?
Дополнительные сведения см. на [странице цен](https://azure.microsoft.com/pricing/details/cosmos-db/) на Azure Cosmos DB. 

### <a name="how-do-i-enable-autoscale-for-my-containers-or-databases"></a>Разделы справки включить Автомасштабирование для контейнеров или баз данных?
Автомасштабирование можно включить для новых контейнеров и баз данных, созданных с помощью портал Azure.

### <a name="is-there-cli-or-sdk-support-to-create-containers-or-databases-with-autoscale-provisioned-throughput"></a>Поддерживается ли интерфейс командной строки или пакет SDK для создания контейнеров или баз данных с подготовленной пропускной способностью автомасштабирования?
Сейчас вы можете создавать ресурсы только с подготовленной пропускной способностью автомасштабирования из портал Azure. Поддержка интерфейса командной строки и пакета SDK пока недоступна.

### <a name="can-i-enable-autoscale-on-an-existing-container-or-a-database"></a>Можно ли включить Автомасштабирование для существующего контейнера или базы данных?
В настоящее время можно включить Автомасштабирование для новых контейнеров и баз данных при их создании. Поддержка автоматического масштабирования в существующих контейнерах и базах данных пока недоступна. Вы можете перенести существующие контейнеры в новый контейнер с помощью [фабрики данных Azure](../data-factory/connector-azure-cosmos-db.md) или [веб-канала изменений](change-feed.md). 

### <a name="can-i-turn-off-autoscale-on-a-container-or-database"></a>Можно ли отключить Автомасштабирование для контейнера или базы данных?
Да, вы можете отключить Автомасштабирование, перейдя к параметру "Стандартный (ручной)" для подготовленной пропускной способности. В текущем выпуске после переключения с автомасштабирования на стандартную подготовленную пропускную способность вы не сможете снова включить Автомасштабирование для того же ресурса. 

### <a name="is-autoscale-supported-for-shared-throughput-databases"></a>Поддерживается ли автомасштабирование для баз данных с общей пропускной способностью?
Да, автомасштабирование поддерживается для баз данных с общей пропускной способностью. Чтобы включить эту функцию, выберите параметр Автомасштабирование и настройка **пропускной способности** при создании базы данных. 

### <a name="what-is-the-number-of-allowed-collections-per-shared-throughput-database-when-autoscale-is-enabled"></a>Каково число разрешенных коллекций для базы данных с общей пропускной способностью при включенном автомасштабировании?
Для баз данных с общим пропускной способностью с включенным автомасштабированием количество разрешенных коллекций: MIN (25, Max единиц запросов в секунду для базы данных/1000). Например, если максимальная пропускная способность базы данных составляет 20 000 единиц запросов в секунду, то база данных может иметь минимум (25, 20 000 единиц запросов в секунду/1000) = 20 коллекций. 


### <a name="what-is-the-storage-limit-associated-with-each-max-rus-option"></a>Какова предельная длина хранилища, связанная с каждым параметром max RU/s?  
Максимальный размер хранилища в ГБ для каждого максимального единиц запросов в секунду: Max единиц запросов в секунду или контейнера/100. Например, если максимальное количество единиц запросов в секунду — 20 000 единиц запросов в секунду, ресурс может поддерживать 200 ГБ хранилища. Доступные параметры максимального числа единиц запросов в секунду и хранилища см. в статье [ограничения автомасштабирования](provision-throughput-autoscale.md#autoscale-limits) . 

### <a name="what-happens-if-i-exceed-the-storage-limit-associated-with-my-max-throughput"></a>Что произойдет, если превышен предельный объем хранилища, связанный с максимальной пропускной способностью?
Если превышено ограничение объема хранилища, связанное с максимальной пропускной способностью базы данных или контейнера, Azure Cosmos DB автоматически увеличит максимальную пропускную способность до следующего уровня, поддерживающего этот уровень хранения. Например, предположим, что база данных или контейнер подготовлены с помощью параметра максимальной пропускной способности 4000 единиц запросов в секунду с ограничением в 50 ГБ. Если размер хранилища ресурса увеличится до 100 ГБ, максимальная единица запросов в секунду в базе данных или контейнере будет автоматически увеличена до 20 000 единиц запросов в секунду, что может поддерживать до 200 ГБ. 

### <a name="how-quickly-will-autoscale-up-and-down-based-on-spikes-in-traffic"></a>Насколько быстро выполняется автоматическое масштабирование в зависимости от пиков трафика?
С помощью автомасштабирования можно мгновенно увеличивать или уменьшать масштаб единиц запросов/с в пределах минимального и максимального диапазона единиц запросов в секунду на основе входящего трафика. Выставление счетов выполняется через 1-часовой уровень детализации, где за определенный час взимается плата за наибольший единиц запросов в секунду.

### <a name="can-i-specify-a-custom-max-throughput-rus-value-for-autoscale"></a>Можно ли указать пользовательскую максимальную пропускную способность (число единиц запросов в секунду) для автомасштабирования?
В настоящее время можно выбрать один из [четырех вариантов](provision-throughput-autoscale.md#autoscale-limits) для параметра Максимальная пропускная способность (единиц запросов в секунду).

### <a name="can-i-increase-the-max-rus-move-to-a-higher-tier-on-the-database-or-container"></a>Можно ли увеличить максимальное число единиц запросов в секунду (переместить на более высокий уровень) в базе данных или контейнере? 
Да. В параметре **масштабировать & параметры** для контейнера или параметра **масштаб** для базы данных можно выбрать более высокий коэффициент единиц запросов в секунду для автомасштабирования. Это асинхронная операция масштабирования, которая может занять некоторое время (обычно 4-6 часов в зависимости от выбранного количества единиц запросов в секунду), так как служба предоставляет больше ресурсов для поддержки более высоких масштабов. 

### <a name="can-i-reduce-the-max-rus-move-to-a-lower-tier-on-the-database-or-container"></a>Можно ли сократить максимальное число единиц запросов в секунду (переместить на более низкий уровень) в базе данных или контейнере?
Да. Пока текущее хранилище базы данных или контейнера меньше [предельного размера хранилища](#what-is-the-storage-limit-associated-with-each-max-rus-option) , связанного с максимальным уровнем единиц запросов в секунду, до которого нужно масштабироваться, можно уменьшить число единиц запросов в секунду на этом уровне. Например, если в качестве максимального числа единиц запросов в секунду выбрано 20 000 единиц запросов в секунду, можно уменьшить число единиц запросов в секунду до 4000 единиц запросов в секунду, если объем хранилища не превышает 50 ГБ (предельный размер хранилища, связанный с 4000 единиц запросов в секунду).

### <a name="what-is-the-mapping-between-the-max-rus-and-physical-partitions"></a>Что такое сопоставление между максимальной единицей запросов/с и физическими секциями?
При первом выборе параметра max единиц запросов в секунду Azure Cosmos DB будет подготавливаться: Max единиц запросов в секунду/10 000 единиц запросов/с = # для физических секций. Каждый [физический раздел](partition-data.md#physical-partitions) может поддерживать до 10 000 единиц запросов в секунду и 50 ГБ памяти. По мере роста размера хранилища Azure Cosmos DB автоматически разделит секции, чтобы добавить дополнительные физические секции для увеличения объема хранилища, или увеличить максимальный уровень единиц запросов в секунду, если размер хранилища [превышает соответствующее ограничение](#what-is-the-storage-limit-associated-with-each-max-rus-option). 

Максимальное количество единиц запросов в секунду для базы данных или контейнера распределяется равномерно по всем физическим секциям. Таким образом, Общая пропускная способность для одной физической секции может масштабироваться на: Max единиц запросов в секунду или контейнер/число физических секций. 

### <a name="what-happens-if-incoming-requests-exceed-the-max-rus-of-the-database-or-container"></a>Что произойдет, если входящие запросы превышают максимальную ЕДИНИЦу запросов в секунду для базы данных или контейнера?
Если общий объем занятых единиц запросов в секунду превышает максимальную ЕДИНИЦу запросов в секунду для контейнера или базы данных, запросы, превышающие максимальное количество единиц запросов в секунду, будут регулироваться и возвращать код состояния 429. Запросы, которые приводят к более 100% нормализованной загрузке, также будут регулироваться. Нормализованное использование определяется как максимальное значение использования единиц запросов/s во всех физических секциях. Например, предположим, что максимальная пропускная способность составляет 20 000 единиц запросов в секунду и имеется два физических раздела, P_1 и P_2, каждый из которых поддерживает масштабирование до 10 000 единиц запросов в секунду. В течение этой секунды, если P_1 использовал 6000 RUs и P_2 8000, то нормализованная Загрузка равна MAX (6000 единиц запроса/10 000 RU, 8000 единиц запросов/10 000 RU) = 0,8.

> [!NOTE]
> Azure Cosmos DB клиентские пакеты SDK и средства импорта данных (фабрика данных Azure, Библиотека массовых исполнителей) автоматически перезапускаются в 429s, поэтому иногда 429s хорошо. Длительное большое число 429s может означать, что необходимо увеличить максимальное количество единиц запросов в секунду, или проверить стратегию секционирования для [горячей секции](#autoscale-rate-limiting).

### <a name="is-it-still-possible-to-see-429s-throttlingrate-limiting-when-autoscale-is-enabled"></a><a id="autoscale-rate-limiting"></a>Можно ли по-прежнему видеть 429s (ограничение регулирования/частоты) при включенном автомасштабировании? 
Да. 429s можно увидеть в двух сценариях. Во-первых, если общий объем занятых единиц запросов в секунду превышает максимальное количество единиц запросов в секунду для контейнера или базы данных, служба будет регулировать запросы соответствующим образом. 

Во-вторых, если имеется горячая секция, т. е. значение ключа логической секции с непропорционально большим количеством запросов по сравнению с другими значениями ключей секций, то возможно, что базовая физическая Секция превысит его бюджет на ЕДИНИЦу. Рекомендуется [выбирать хороший ключ секции](partitioning-overview.md#choose-partitionkey) , который приводит к равномерному распределению хранилища и пропускной способности. 

Например, при выборе параметра максимальной пропускной способности 20 000 единиц запросов в секунду и наличии 200 ГБ хранилища с четырьмя физическими секциями можно автоматически масштабировать каждую физическую секцию до 5000 единиц запросов в секунду. Если для определенного ключа логической секции была создана горячая секция, вы увидите 429s, когда базовая физическая секция, в которой он находится, превышает 5000 единиц запросов в секунду, т. е. превышает 100% нормализованное использование.

## <a name="next-steps"></a>Дальнейшие действия

* Узнайте, как [включить Автомасштабирование в контейнере или базе данных Azure Cosmos](provision-throughput-autoscale.md#create-db-container-autoscale).
* Узнайте о [преимуществах подготовленной пропускной способности с помощью автомасштабирования ](provision-throughput-autoscale.md#autoscale-benefits).
* Дополнительные сведения о [логических и физических секциях](partition-data.md).
