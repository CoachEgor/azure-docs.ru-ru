---
title: Глобально распределенное хранилище транзакций и аналитические хранилища для контейнеров Azure Cosmos
description: Сведения о хранении транзакций и аналитических хранилища и их параметрах конфигурации для контейнеров Azure Cosmos.
author: markjbrown
ms.author: mjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 09/30/2019
ms.reviewer: sngun
ms.openlocfilehash: abf222b7a6d6e8fd053fa83c066d2b7850f575ab
ms.sourcegitcommit: 8074f482fcd1f61442b3b8101f153adb52cf35c9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/22/2019
ms.locfileid: "72756903"
---
# <a name="globally-distributed-transactional-and-analytical-storage-for-azure-cosmos-containers"></a>Глобально распределенное хранилище транзакций и аналитические хранилища для контейнеров Azure Cosmos

Контейнер Azure Cosmos внутренне поддерживается двумя ядрами хранилища — транзакционным подсистемой хранилища и обновляемым подсистемой аналитического хранилища. Оба ядра хранилища имеют структуру журналов и оптимизированы для записи для ускорения обновлений. Однако каждый из них кодируется по-разному:

* **Транзакционная система хранения данных** — она кодируется в формате, ориентированном на строки, для быстрого транзакционного чтения и запросов.

* **Модуль аналитического хранилища** — он кодируется в формате столбцов для быстрых аналитических запросов и проверок.

![Механизмы хранилища и сопоставление Azure Cosmos DB API](./media/globally-distributed-transactional-analytical-storage/storage-engines-api-mapping.png)

Транзакционная подсистема хранения данных поддерживается локальными твердотельными накопителями, а аналитическое хранилище хранится в недорогом хранилище SSD с некластеризованным кластером. В следующей таблице записаны важные различия между транзакционным и аналитическим хранилищем.


|Компонент  |Хранилище транзакций  |Аналитическое хранилище |
|---------|---------|---------|
|Максимальный объем хранилища на контейнер Azure Cosmos |   Неограниченная      |    Неограниченная     |
|Максимальный объем хранилища на ключ логической секции   |   10 ГБ      |   Неограниченная      |
|Кодирование хранилища  |   По строкам, используя внутренний формат.   |   Ориентированные на столбцы, с использованием формата Apache Parquet. |
|Локальность хранилища |   Реплицированное хранилище, созданное локально или внутри кластера твердотельных накопителей. |  Реплицированное хранилище, созданное с помощью недорогых твердотельных накопителей удаленного и недоступного кластера.       |
|Устойчивость  |    99,99999 (7-9 с)     |  99,99999 (7-9 с)       |
|Интерфейсы API, обращающиеся к данным  |   SQL, MongoDB, Cassandra, Gremlin, Tables и Etcd.       | Apache Spark         |
|Хранение (срок жизни или TTL)   |  На основе политики, настроенной в контейнере Azure Cosmos, с помощью свойства `DefaultTimeToLive`.       |   На основе политики, настроенной в контейнере Azure Cosmos, с помощью свойства `ColumnStoreTimeToLive`.      |
|Цена за ГБ    |   0,25 долл. США / ГБ      |  $0,02/ГБ       |
|Цена за транзакции в хранилище    | Для подготовленной пропускной способности взимается плата за $0,008 за 100 единиц запросов в секунду с почасовой оплатой.        |  Пропускная способность на основе потребления насчитывается в $0,05 для 10 000 транзакций записи и $0,004 для транзакций READ 10 000.       |

## <a name="benefits-of-transactional-and-analytical-storage"></a>Преимущества транзакционных и аналитических хранилищ

### <a name="no-etl-operations"></a>Нет операций ETL

Традиционные аналитические конвейеры сложны с несколькими этапами, каждый из которых требует операций извлечения-преобразования и загрузки (ETL) на уровнях вычислений и хранилища. Это приводит к комплексным архитектурам обработки данных. Это означает высокую стоимость для нескольких стадий хранения и вычислений, а высокая задержка — из-за больших объемов данных, передаваемых между различными этапами хранения и вычислений.  

Дополнительные издержки на выполнение операций ETL с Azure Cosmos DB отсутствуют. Каждый контейнер Azure Cosmos поддерживает транзакционные и аналитические хранилища, а передача данных между транзакционными и аналитическими подсистемами хранилища выполняется в ядре СУБД и без каких-либо прыжков сети. Результирующие задержки и затраты значительно ниже по сравнению с традиционными аналитическими решениями. И вы получаете единую глобальную распределенную систему хранения как для транзакционных, так и для аналитических рабочих нагрузок.  

### <a name="store-multiple-versions-update-and-query-the-analytical-storage"></a>Хранение нескольких версий, обновление и выполнение запросов к аналитическим хранилищам

Аналитическое хранилище является полностью обновляемым и содержит полный журнал версий всех обновлений транзакций, произошедших в контейнере Azure Cosmos.

Все обновления, внесенные в хранилище транзакций, гарантированно видимы для аналитического хранилища в течение 30 секунд. 

### <a name="globally-distributed-multi-master-analytical-storage"></a>Глобально распределенное аналитическое хранилище с несколькими хозяевами

Если ваша учетная запись Azure Cosmos ограничена одним регионом, хранящиеся в контейнерах данные (в транзакционном и аналитическом хранилище) также ограничены одним регионом. С другой стороны, если учетная запись Azure Cosmos глобально распределена, данные, хранящиеся в контейнерах, также глобально распределены.

Для учетных записей Azure Cosmos, настроенных с несколькими регионами записи, запись в контейнер (как для транзакций, так и для аналитического хранилища) всегда выполняется в локальном регионе, поэтому они выполняются быстро.

Для учетных записей Cosmos или нескольких регионов Azure, независимо от того, какой регион записи (один главный) или несколько регионов записи (также называемых несколькими хозяевами), как транзакционные, так и аналитические операции чтения и запросы выполняются локально в заданном регионе.

### <a name="performance-isolation-between-transactional-and-analytical-workloads"></a>Изоляция производительности между транзакционными и аналитическими рабочими нагрузками

В заданном регионе рабочие нагрузки транзакций работают с транзакционным хранилищем или хранилищами транзакций контейнера. С другой стороны, аналитические рабочие нагрузки работают с аналитическим хранилищем контейнера или столбцом. Два ядра хранилища работают независимо и обеспечивают изоляцию производительности между рабочими нагрузками.

Транзакционные рабочие нагрузки используют подготовленную пропускную способность (RUs). В отличие от транзакционных рабочих нагрузок, пропускная способность аналитических рабочих нагрузок основана на фактическом потреблении. Аналитические рабочие нагрузки потребляют ресурсы по требованию.

### <a name="on-demand-snapshots-and-time-travel-analytics"></a>Моментальные снимки по запросу и анализ времени и поездок

Вы можете в любое время создать моментальные снимки данных, хранящихся в аналитическом хранилище контейнеров Azure Cosmos, вызвав команду `CreateSnapshot (name, timestamp)` в контейнере. Моментальные снимки называются "закладками" в журнале обновлений, которые были выполнены в контейнере.

![Моментальные снимки по запросу и анализ времени и поездок](./media/globally-distributed-transactional-analytical-storage/ondemand-analytical-data-snapshots.png)

В момент создания моментального снимка в дополнение к имени можно указать метку времени, определяющую состояние контейнера в журнале обновлений. Затем можно загрузить данные моментального снимка в Spark и выполнить запросы.

В настоящее время моментальные снимки можно делать только по запросу в любой момент в контейнере, возможность автоматически создавать моментальные снимки на основе расписания или настраиваемой политики пока не поддерживается.

### <a name="configure-and-tier-data-between-transactional-and-analytical-storage-independently"></a>Настройка и распределение данных между транзакционными и аналитическими хранилищами независимо друг от друга

В зависимости от сценария можно независимо включать или отключать каждую из двух ядер хранилища. Ниже приведены конфигурации для каждого сценария.

|Сценарий |Параметр хранения транзакций  |Параметр аналитического хранилища |
|---------|---------|---------|
|Монопольное выполнение аналитических рабочих нагрузок (с бесконечным хранением) |  DefaultTimeToLive = 0       |  Колумнсторетиметоливе =-1       |
|Монопольное выполнение транзакционных рабочих нагрузок (с бесконечным хранением)  |   DefaultTimeToLive =-1      |  Колумнсторетиметоливе = 0       |
|Выполнение как транзакционных, так и аналитических рабочих нагрузок (с неограниченным сроком хранения)   |   DefaultTimeToLive =-1      | Колумнсторетиметоливе =-1        |
|Выполнение как транзакционных, так и аналитических рабочих нагрузок (с разными интервалами хранения, также называемыми уровнями хранилища)  |  DefaultTimeToLive = <Value1>       |     Колумнсторетиметоливе = <Value2>    |

1. **Настройка контейнера исключительно для аналитических рабочих нагрузок (с бесконечным хранением)**

   Вы можете настроить контейнер Azure Cosmos исключительно для аналитических рабочих нагрузок. Эта конфигурация имеет преимущество, когда вам не нужно платить за хранилище транзакций. Если ваша цель заключается в использовании контейнера только для аналитических рабочих нагрузок, можно отключить хранилище транзакций, установив для параметра `DefaultTimeToLive` значение 0 в контейнере Cosmos, а также включить аналитическое хранилище с бесконечным хранением, установив для `ColumnStoreTimeToLive` значение-1.

   ![Аналитические рабочие нагрузки с бесконечным хранением](./media/globally-distributed-transactional-analytical-storage/analytical-workload-configuration.png)

1. **Настройка контейнера исключительно для транзакционных рабочих нагрузок (с неограниченным сроком хранения)**

   Вы можете настроить контейнер Cosmos для Azure исключительно для транзакционных рабочих нагрузок. Вы можете отключить аналитическое хранилище, установив для `ColumnStoreTimeToLive` значение 0 в контейнере, а также включить аналитическое хранилище с бесконечным хранением, установив для `DefaultTimeToLive` значение-1.

   ![Рабочие нагрузки транзакций с бесконечным хранением](./media/globally-distributed-transactional-analytical-storage/transactional-workload-configuration.png)

1. **Настройка контейнера для транзакционных и аналитических рабочих нагрузок (с неограниченным сроком хранения)**

   Вы можете настроить контейнер Azure Cosmos для транзакционных и аналитических рабочих нагрузок с полной изоляцией производительности между ними. Вы можете включить аналитическое хранилище, задав для параметра `ColumnStoreTimeToLive` значение-1, а также включить хранилище транзакций с бесконечным хранением, установив для параметра `DefaultTimeToLive ` значение-1.

   ![Транзакционные и аналитические рабочие нагрузки с бесконечным хранением](./media/globally-distributed-transactional-analytical-storage/analytical-transactional-configuration-infinite-retention.png)

1. **Настройка контейнера для транзакционных и аналитических рабочих нагрузок с использованием уровней хранилища**

   Вы можете настроить контейнер Azure Cosmos для транзакционных и аналитических рабочих нагрузок с полной изоляцией производительности между ними с разными интервалами хранения. Azure Cosmos DB обеспечит постоянное хранение аналитического хранилища в течение более длительного времени, чем хранилище транзакций.

   Вы можете включить хранилище транзакций с бесконечным сроком хранения, задав для параметра `DefaultTimeToLive` значение < 1 > и включив аналитическое хранилище, установив для `ColumnStoreTimeToLive` < значение 2 >. Azure Cosmos DB обеспечит, что < значение 2 > всегда больше, чем < значение 1 >.

   ![Транзакционные и аналитические рабочие нагрузки с распределением по уровням хранилища](./media/globally-distributed-transactional-analytical-storage/analytical-transactional-configuration-specified-retention.png)

## <a name="next-steps"></a>Дальнейшие действия

* [Срок жизни в Azure Cosmos DB](time-to-live.md)
