---
title: Мониторинг использования пропускной способности операции в Azure Cosmos DB
description: Узнайте, как отслеживать использование пропускной способности или единиц запросов для операции в Azure Cosmos DB. Владельцы учетной записи Azure Cosmos DB могут понять, какие операции занимают больше единиц запросов.
ms.service: cosmos-db
ms.topic: conceptual
author: kanshiG
ms.author: govindk
ms.date: 04/09/2020
ms.openlocfilehash: bc39ef199a5d40d3eaa75023277d3e00b93e131a
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "81115434"
---
# <a name="how-to-monitor-throughput-or-request-unit-usage-of-an-operation-in-azure-cosmos-db"></a>Мониторинг пропускной способности или использования единиц запросов для операции в Azure Cosmos DB

Azure Monitor для Azure Cosmos DB предоставляет представление метрик для мониторинга учетной записи и создания панелей мониторинга. Метрики по Azure Cosmos DB собираются по умолчанию, для этого компонента не требуется явно включать или настраивать что-либо. Метрика " **Общая единица запросов** " используется для получения сведений об использовании единиц запросов для различных типов операций. Позже можно будет проанализировать, какие операции используют большую часть пропускной способности. По умолчанию данные о пропускной способности суммируются с интервалом в 1 минуту. Однако можно изменить единицу статистической обработки, изменив параметр гранулярности времени.

Существует два способа анализа данных об использовании единиц запросов.

* В течение заданного интервала времени, в течение которого операции занимают больше единиц запросов.
* Какие операции в целом являются общими для рабочей нагрузки за счет использования большего числа единиц запросов.
Этот анализ позволяет сосредоточиться на таких операциях, как INSERT, Upsert и смотреть их индексирование. Вы можете узнать, не превышено ли индексирование конкретных полей, и изменить [политику индексирования](index-policy.md#include-exclude-paths) для включения или исключения путей.

Если вы видите, что некоторые запросы занимают больше единиц запросов, можно выполнить следующие действия:

* Пересмотрите, если запрашивается правильный объем данных.
* Измените запрос, чтобы использовать индекс с предложением фильтра.
* Выполнение менее затратных вызовов функций UDF.
* Определите ключи секции, чтобы уменьшить вентилятор из запроса в разные секции.
* Вы также можете использовать метрики запроса, возвращенные в ответе на вызов, сведения о журнале диагностики и статью о [настройке производительности запросов](sql-api-query-metrics.md) , чтобы получить дополнительные сведения о выполнении запроса.
* Вы можете начать с Sum, а затем просмотреть среднее использование с помощью правильного измерения.

## <a name="view-the-total-request-unit-usage-metric"></a>Просмотр общей метрики использования единиц запросов

1. Войдите на [портал Azure](https://portal.azure.com/).

1. Выберите **монитор** на панели навигации слева и щелкните **метрики**.

   ![Панель "метрики" в Azure Monitor](./media/monitor-request-unit-usage/monitor-metrics-blade.png)

1. В области **метрики** > **выберите ресурс** > выберите нужную **подписку**и **группу ресурсов**. Для параметра **тип ресурса**выберите **учетные записи Azure Cosmos DB**, выберите одну из существующих учетных записей Azure Cosmos и нажмите кнопку **Применить**.

   ![Выберите учетную запись Azure Cosmos DB для просмотра метрик](./media/monitor-request-unit-usage/select-cosmos-db-account.png)

1. Далее выберите метрику **Общее количество единиц запроса** из списка доступных метрик. Подробные сведения обо всех доступных метриках в этом списке см. в статье [метрики по категориям](monitor-cosmos-db-reference.md) . В этом примере выберем **Общие единицы запроса** и **AVG** в качестве значения статистической обработки. В дополнение к этим сведениям можно также выбрать **диапазон времени** и **степень гранулярности времени** метрик. В поле максимум можно просмотреть метрики за последние 30 дней.  После применения фильтра на основе фильтра отобразится диаграмма. Вы видите среднее количество единиц запросов, потребляемых в минуту за выбранный период.  

   ![Выберите метрику из портал Azure](./media/monitor-request-unit-usage/request-unit-usage-metric.png)

## <a name="filters-for-request-unit-usage"></a>Фильтры для использования единиц запросов

Можно также фильтровать метрики и получать диаграммы, отображаемые конкретными **CollectionName**, **DatabaseName**, **OperationType**, **Region**, **Status**и **StatusCode**. Параметры **Добавить фильтр** и **Применить разбиение** позволяют фильтровать данные об использовании единиц запросов и группировать метрики.

Чтобы получить сведения об использовании единиц запросов для каждой операции либо по общему (SUM), либо по среднему значению, выберите **Применить разделение** и выберите **тип операции** и значение фильтра, как показано на следующем рисунке:

   ![Единицы запроса Cosmos DB для операций в Azure Monitor](./media/monitor-request-unit-usage/request-unit-usage-operations.png)

Если вы хотите просмотреть сведения об использовании единиц запросов по коллекциям, выберите **Применить разделение** и выберите имя коллекции в качестве фильтра. Вы увидите разговор, как показано ниже, с выбором коллекций на панели мониторинга. Затем можно выбрать определенное имя коллекции, чтобы просмотреть дополнительные сведения:

   ![Cosmos DB единиц запросов для всех операций коллекции в Azure Monitor](./media/monitor-request-unit-usage/request-unit-usage-collection.png)

## <a name="next-steps"></a>Дальнейшие шаги

* Отслеживайте Azure Cosmos DB данные с помощью [параметров диагностики](cosmosdb-monitor-resource-logs.md) в Azure.
* [Аудит операций Azure Cosmos DB плоскости управления](audit-control-plane-logs.md)