---
title: Мониторинг пропускной воды операции в Azure Cosmos DB
description: Узнайте, как контролировать пропускную связь или запрашивать использование единицы операции в Azure Cosmos DB. Владельцы учетной записи Azure Cosmos DB могут понять, какие операции требуют больше единиц запроса.
ms.service: cosmos-db
ms.topic: conceptual
author: kanshiG
ms.author: govindk
ms.date: 04/09/2020
ms.openlocfilehash: bc39ef199a5d40d3eaa75023277d3e00b93e131a
ms.sourcegitcommit: fb23286d4769442631079c7ed5da1ed14afdd5fc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/10/2020
ms.locfileid: "81115434"
---
# <a name="how-to-monitor-throughput-or-request-unit-usage-of-an-operation-in-azure-cosmos-db"></a>Как контролировать пропускную работу или запрашивать использование единицы операции в Azure Cosmos DB

Azure Monitor для Azure Cosmos DB предоставляет представление метрик для мониторинга учетной записи и создания панелей мониторинга. Метрики Azure Cosmos DB собираются по умолчанию, эта функция не требует от вас включения или настройки чего-либо явно. Для использования единиц запроса для различных типов операций используется метрика **«Общие единицы запроса».** Позже можно проанализировать, какие операции использовали большую часть пропускной выхадости. По умолчанию данные пропускной компании агрегируются с интервалом в одну минуту. Тем не менее, можно изменить единицу агрегации, изменив опцию детализации времени.

Существует два способа анализа данных об использовании единицы запроса:

* В течение данного интервала времени, какие операции принимают больше единиц запроса.
* Какие операции в целом доминируют над вашей рабочей нагрузкой, потребляя больше единиц запросов.
Этот анализ позволяет сосредоточиться на таких операциях, как вставка, upsert и посмотреть на их индексацию. Вы можете узнать, если вы более / под индексации конкретных полей и изменить [политику индексирования,](index-policy.md#include-exclude-paths) чтобы включить или исключить пути.

Если вы заметили, что некоторые запросы требуют больше единиц запросов, вы можете принять такие действия, как:

* Пересмотрите, если вы запрашиваете нужный объем данных.
* Измените запрос для использования индекса с помощью положения фильтра.
* Выполняйте менее дорогие вызовы функций UDF.
* Определите ключи раздела, чтобы свести к минимуму вентилятор из запроса на различные разделы.
* Вы также можете использовать метрики запроса, возвращенные в ответ на вызов, детали диагностического журнала и ссылаться на статью [настройки производительности запроса,](sql-api-query-metrics.md) чтобы узнать больше о выполнении запроса.
* Вы можете начать с суммы, а затем посмотреть на avg использования с помощью правильного измерения.

## <a name="view-the-total-request-unit-usage-metric"></a>Просмотр общей метрики использования единицы запроса

1. Войдите на [портал Azure](https://portal.azure.com/).

1. Выберите **монитор** из левой панели навигации и выберите **метрики.**

   ![Панель метрик в Azure Monitor](./media/monitor-request-unit-usage/monitor-metrics-blade.png)

1. Из панели **метрик** > **Выберите ресурс** > выбрать требуемую **подписку**и **группу ресурсов.** Для **типа ресурса**выберите **dB-учетные записи Azure Cosmos,** выберите одну из существующих учетных записей Azure Cosmos и выберите **Apply.**

   ![Выберите учетную запись Azure Cosmos DB для просмотра метрик](./media/monitor-request-unit-usage/select-cosmos-db-account.png)

1. Далее выберите метрику **Общих единиц запроса** из списка доступных метрик. Чтобы узнать подробно обо всех доступных метриках в этом списке, [см.](monitor-cosmos-db-reference.md) В этом примере давайте выберем **единицы общего запроса** и **Avg** в качестве значения агрегации. В дополнение к этим деталям, вы также можете выбрать **диапазон времени** и **детализацию времени** метрик. На макс, вы можете просмотреть метрики за последние 30 дней.  После нанесения фильтра на основе фильтра отображается диаграмма. Вы можете увидеть среднее количество единиц запроса, потребляемых в минуту за выбранный период.  

   ![Выберите метрику на портале Azure](./media/monitor-request-unit-usage/request-unit-usage-metric.png)

## <a name="filters-for-request-unit-usage"></a>Фильтры для использования единицы запроса

Вы также можете фильтровать метрики и получать диаграммы, отображаемые конкретным **CollectionName**, **DatabaseName**, **OperationType**, **Регион**, **Статус**, и **StatusCode**. Параметры разделения **добавить** и **применить** позволяют фильтровать использование единицы запроса и группировать метрики.

Чтобы получить использование единицы запроса каждой операции по сумме (сумма) или в среднем, выберите **Приложить расщепление** и выбрать **тип операции** и значение фильтра, как показано на следующем изображении:

   ![Блоки Запроса Накосмоса DB для работы в мониторе Azure](./media/monitor-request-unit-usage/request-unit-usage-operations.png)

Если вы хотите увидеть использование единицы запроса по сбору, выберите **Apply splitting** и выберите имя коллекции в качестве фильтра. Вы увидите чат, как следующее с выбором коллекций в панели мониторинга. Затем можно выбрать конкретное имя коллекции, чтобы просмотреть более подробную информацию:

   ![Блоки Cosmos DB Запрос для всех операций по сбору в мониторе Azure](./media/monitor-request-unit-usage/request-unit-usage-collection.png)

## <a name="next-steps"></a>Дальнейшие действия

* Мониторинг данных Azure Cosmos DB с помощью [диагностических настроек](cosmosdb-monitor-resource-logs.md) в Azure.
* [Аудит операций самолета управления Azure Cosmos DB](audit-control-plane-logs.md)