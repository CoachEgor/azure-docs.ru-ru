---
title: Использование уникальных ключей в Azure Cosmos DB
description: Узнайте, как использовать уникальные ключи в базе данных Azure Cosmos.
author: rockboyfor
ms.author: v-yeche
ms.service: cosmos-db
ms.topic: conceptual
origin.date: 04/08/2019
ms.date: 04/15/2019
ms.reviewer: sngun
ms.openlocfilehash: 3c5e8a2c85898175772dc353258e77fc8e0a74f2
ms.sourcegitcommit: 61c8de2e95011c094af18fdf679d5efe5069197b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62115729"
---
# <a name="unique-key-constraints-in-azure-cosmos-db"></a>Ограничения для уникальных ключей в Azure Cosmos DB

Уникальные ключи добавляют слой целостности данных в контейнер Azure Cosmos. Политика уникальных ключей создается одновременно с контейнером Azure Cosmos. Уникальные ключи гарантируют уникальность одного или нескольких значений в пределах логической секции. Вы также можете гарантировать уникальность для каждого [ключа секции](partition-data.md). 

После создания контейнера с политикой уникальных ключей, создание нового или обновления существующего элемента приводит к дубликат в логической секции не позволяет, как указано ограничение уникального ключа. Ключ секции в сочетании с уникальным ключом гарантирует уникальность элемента в области контейнера.

Для примера рассмотрим контейнер Azure Cosmos, в котором настроен уникальный ключ с ограничением по адресу электронной почты и ключ секции `CompanyID`. Когда вы настроите уникальный ключ для адреса электронной почты пользователей, каждый элемент будет гарантированно содержать уникальный адрес электронной почты в пределах каждого `CompanyID`. Невозможно создать два элемента с дублирующимся адресом электронной почты и с тем же значением ключа секции. 

Чтобы записи могли содержать одинаковые адреса электронной почты, но не одинаковые сочетания имени, фамилии и адреса электронной почты, добавьте в политику уникальных ключей дополнительные пути. Вместо создания уникального ключа, на основе только адреса электронной почты, также можно создать уникальный ключ с сочетанием имя, фамилию и адрес электронной почты. Такой ключ называется составным уникальным ключом. В этом случае разрешено каждое уникальное сочетание трех значений в пределах заданного `CompanyID`. 

Например, контейнер может содержать элементы со следующими значениями, в которых каждый элемент соблюдает ограничение уникального ключа.

| CompanyID | Имя | Фамилия |   Адрес электронной почты    |
|-----------|------------|-----------|--------------------|
|  Contoso  |    Гэби    |  Дюперре  |  gaby@contoso.com  |
|  Contoso  |    Гэби    |  Дюперре  | gaby@fabrikam.com  |
| Fabrikam  |    Гэби    |  Дюперре  | gaby@fabrikam.com  |
| Fabrikam  |    Иван    |  Дюперре  | gaby@fabrikam.com  |
|  Fabrkam  |            |  Дюперре  | gaby@fabraikam.com |
|  Fabrkam  |            |           | gaby@fabraikam.com |

При попытке вставить новый элемент с сочетанием значений, которое указано в предыдущей таблице, вы получите ошибку. Такая ошибка означает, что ограничение уникального ключа не соблюдается. Получение `Resource with specified ID or name already exists` или `Resource with specified ID, name, or unique index already exists` как ответное сообщение. 

## <a name="define-a-unique-key"></a>Определение уникального ключа

Уникальные ключи можно определить только при создании контейнера Azure Cosmos. Уникальный ключ ограничивается логической секцией. В предыдущем примере, если контейнер секционируется по почтовому индексу, вы получите повторяющиеся элементы в каждой логической секции. При создании уникальных ключей учитывайте следующие аспекты.

* Вы не можете изменить уникальный ключ для имеющегося контейнера. Другими словами, после создания контейнера с политикой уникальных ключей эту политику невозможно изменить.

* Чтобы задать уникальный ключ для уже существующего контейнера, создайте новый контейнер с ограничением уникального ключа. Используйте соответствующее средство миграции данных, чтобы переместить все данные из старого контейнера в новый. Между контейнерами SQL данные следует перемещать с помощью [средства переноса данных](import-data.md). Для контейнеров MongoDB используйте [mongoimport.exe или mongorestore.exe](mongodb-migrate.md) для перемещения данных.

* Политика уникальных ключей может содержать не более 16значений путей. Например, значения могут быть `/firstName`, `/lastName`, и `/address/zipCode`. Каждая политика уникальных ключей может иметь не более 10 ограничений уникальных ключей или сочетаний. Суммарная длина путей для каждого ограничения уникального индекса не может превышать 60 байт. В предыдущем примере имя, фамилия и адрес электронной почты в совокупности считаются одним ограничением. Это ограничение использует 3 из 16 допустимых путей.

* Если контейнер имеет политику уникальных ключей [единиц запроса (RU)](request-units.md) расходов для создания, обновления и удаления элемента значительно выше.

* Разреженные уникальные ключи не поддерживаются. Если для некоторых уникальных путей отсутствуют значения, для них в ограничении уникальности используется значение null. Это означает, что такое ограничение допускает наличие только одного элемента со значением null.

* В именах уникальных ключей учитывается регистр. Например, рассмотрим контейнер с ограничение уникального ключа, равным `/address/zipcode`. Если в данных есть поле с именем `ZipCode`, Azure Cosmos DB вставляет «null», как уникальный ключ поскольку `zipcode` отличается от версии `ZipCode`. Учет регистра в этой ситуации приводит к тому, что другие записи со значением ZipCode добавлены не будут, ведь новое значение null нарушит требование уникальности ключа.

## <a name="next-steps"></a>Дальнейшие действия

* Подробнее о [логических секциях](partition-data.md).

<!-- Update_Description: update meta propreties, wording update -->