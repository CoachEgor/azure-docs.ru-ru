---
title: Как выбрать правильное предложение пропускной способности в Azure Cosmos DB
description: Узнайте о том, как сделать правильный выбор между стандартной (ручной) и автомасштабируемой подготовленной пропускной способностью для рабочей нагрузки.
author: deborahc
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 08/19/2020
ms.author: dech
ms.openlocfilehash: fbe17d75ad809c54939624b1409e281b2f62a037
ms.sourcegitcommit: d661149f8db075800242bef070ea30f82448981e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "88605209"
---
# <a name="how-to-choose-between-standard-manual-and-autoscale-provisioned-throughput"></a>Как сделать выбор между стандартной (ручной) и автомасштабируемой подготовленной пропускной способностью 

Azure Cosmos DB поддерживает два типа (или предложения) подготовленной пропускной способности: стандартный (ручной) и автомасштабируемый. Оба типа пропускной способности подходят для критически важных рабочих нагрузок, требующих высокой производительности и масштабирования, и поддерживаются одними и теми же соглашениями об уровне обслуживания Azure Cosmos DB в отношении пропускной способности, доступности, задержки и согласованности.

Эта статья рассказывает о том, как сделать правильный выбор между стандартной (ручной) и автомасштабируемой подготовленной пропускной способностью для рабочей нагрузки. 

## <a name="overview-of-provisioned-throughput-types"></a>Общие сведения о подготовленных типах пропускной способности
Прежде чем коснуться различий между стандартным (ручным) и автомасштабируемым типами, важно сначала понять, как работает подготовленная пропускная способность в Azure Cosmos DB. 

При использовании подготовленной пропускной способности вы задаете пропускную способность, измеряемую в единицах запросов в секунду (ЕЗ/с), необходимых для вашей рабочей нагрузки. Служба подготавливает производительность, необходимую для поддержки требований к пропускной способности. Операции базы данных для службы, например операции чтения, записи и запросы, потребляют некоторый объем единиц запросов (ЕЗ). Дополнительные сведения о [единицах запросов](request-units.md).

В следующей таблице показано общее сравнение стандартного (ручного) и автомасштабируемого типов пропускной способности.

|Описание|Стандартный (ручной)|Автомасштабирование|
|-------------|------|-------|
|Лучше всего подходит для|Рабочих нагрузок с постоянным или предсказуемым трафиком|Рабочих нагрузок с переменным или непредсказуемым трафиком См. раздел [варианты использования автомасштабирования](provision-throughput-autoscale.md#use-cases-of-autoscale).|
|Принцип работы|Вы подготавливаете заданное количество ЕЗ/с `T`, статичное во времени, пока вы не измените это значение вручную. Каждую секунду можно использовать пропускную способность до `T` ЕЗ/с. <br/><br/>Например, если задать значение 400 ЕЗ/с для стандартной (ручной) пропускной способности, она будет постоянно находиться на указанном уровне.|Вы указываете наибольшее или максимальное количество ЕЗ/с `Tmax`, которое система не должна превышать. Система автоматически масштабирует пропускную способность `T` таким образом, чтобы она не превышала `0.1* Tmax <= T <= Tmax`. <br/><br/>Например, если задать максимальное значение для автомасштабирования, равное 4 000 ЕЗ/с, система будет масштабировать количество запросов в пределах 400–4 000 ЕЗ/с.|
|Сценарии использования|Вы хотите вручную управлять емкостью пропускной способности (ЕЗ/с) и масштабировать ее самостоятельно.<br/><br/>У вас высокое, стабильное использование подготовленных единиц запросов в секунду. Если вы установили подготовленное значение единиц запросов в секунду `T` и использовали 66 % от запланированных часов в месяц и более, по расчетам, вы сэкономите благодаря стандартному (ручному) значению подготовленных ЕЗ/с.<br/><br/>Это основано на сравнении значения параметра `T` при использовании стандартного (ручного) типа и того же количества `Tmax` при автомасштабировании. |Вы хотите управлять пропускной способностью (ЕЗ/с) и масштабированием на основе использования с помощью Azure Cosmos DB.<br/><br/>Число используемых единиц запросов в секунду у вас меняется, или его сложно прогнозировать. Если для автомасштабирования вы установили максимальное значение единиц запросов в секунду `Tmax` и использовали все это количество (`Tmax`) для 66 % от запланированных часов в месяц и менее, по расчетам, вы сэкономите благодаря автомасштабированию.<br/><br/>Это основано на сравнении значения параметра `Tmax` при автомасштабировании и того же количества `T` при использовании стандартного (ручного) типа.|
|Модель выставления счетов|Выставление счетов выполняется почасово для подготовленного числа единиц запросов в секунду, независимо от того, сколько их было использовано.<br/><br/>Пример <li>Подготовлено 400 ЕЗ/с</li><li>Час 1: нет запросов</li><li>Час 2: 400 единиц запросов в секунду</li><br/><br/>За оба часа 1 и 2 будет взиматься одинаковая плата за 400 единиц запросов в секунду по [тарифам за стандартный (ручной) тип масштабирования пропускной способности](https://azure.microsoft.com/pricing/details/cosmos-db/).|Выставление счетов выполняется на почасовой основе по максимальному количеству единиц запросов в секунду, до которого система выполняла масштабирование в течение часа. <br/><br/>Пример <li>Подготовленная максимальная пропускная способность для автомасштабирования: 4 000 ЕЗ/с (с масштабированием от 400 до 4 000 ЕЗ/с)</li><li>Час 1: система масштабировала пропускную способность до максимального значения в 3 500 ЕЗ/с</li><li>Час 2: система масштабировала пропускную способность до максимального значения в 400 ЕЗ/с (всегда 10 % от `Tmax`) из-за неиспользования</li><br/><br/>Счет выставляется за 3 500 ЕЗ/с за час 1 и 400 ЕЗ/с за час 2 согласно [тарифам на автомасштабирование подготовленной пропускной способности](https://azure.microsoft.com/pricing/details/cosmos-db/). Тариф на автомасштабирование за единицу запросов в секунду составляет 1,5 * тариф на стандартный (ручной) тип масштабирования пропускной способности.
|Что происходит при превышении количества подготовленных единиц запросов в секунду|Значение ЕЗ/с остается статичным по отношению к подготовленному значению. Все запросы, потребляемые свыше подготовленного значения единиц запросов в секунду, будут ограничены по скорости и получат отклик с рекомендацией подождать, прежде чем совершить повторную попытку. При необходимости можно вручную увеличить или уменьшить количество единиц запросов в секунду.| При автомасштабировании система будет увеличивать количество единиц запросов в секунду до максимального числа ЕЗ/с. Все запросы, потребляемые свыше максимального значения единиц запросов в секунду для автомасштабирования, будут ограничены по скорости и получат отклик с рекомендацией подождать, прежде чем совершить повторную попытку.|

## <a name="understand-your-traffic-patterns"></a>Общие сведения о шаблонах трафика

### <a name="new-applications"></a>Новые приложения ###

Если вы создаете новое приложение и еще не знаете, какой шаблон трафика использовать, вы можете начать с единиц запросов в секунду (или с минимального значения единиц запросов в секунду) для точки входа, чтобы избежать указания слишком большого значения в начале. Или, если у вас небольшое приложение, которое не нуждается в большом масштабе, для оптимизации затрат нужно подготовить лишь минимальное количество единиц запросов в секунду для точки входа. Для небольших приложений с низким ожидаемым трафиком можно также рассмотреть режим [бессерверной](throughput-serverless.md) емкости.

Если вы планируете использовать стандартную (ручную) или Автомасштабирование, то следует учитывать следующее.

Если вы подготовите значение в 400 единиц запросов в секунду для точки входа при стандартном (ручном) масштабировании, то не сможете потреблять больше указанного значения, пока не измените пропускную способность вручную. Вам будет выставлен счет за 400 ЕЗ/с в час при стандартном (ручном) указании подготовленной пропускной способности.

Если вы подготовите максимальное значение пропускной способности в 4000 единиц запросов в секунду для точки входа при автомасштабировании, ресурс будет сам масштабировать пропускную способность в пределах между 400 и 4000 ЕЗ/с. Так как ставка за единицу запросов в секунду при автомасштабировании пропускной способности в 1,5 раза выше ставки стандартного (ручного) масштабирования, за часы, когда система масштабируется до минимального значения в 400 ЕЗ/с, счет будет выше, чем при указании 400 ЕЗ/с вручную. Однако при использовании автомасштабирования в ситуациях, когда трафик приложения сильно меняется, вы сможете потребить до 4000 единиц запросов в секунду без каких-либо действий со стороны пользователя. В общем, следует сопоставить преимущества потребления максимального числа единиц запросов в секунду в любое время с увеличенной в 1,5 раза ставкой на автомасштабирование.

Чтобы оценить требования к пропускной способности, используйте [калькулятор емкости](estimate-ru-with-capacity-planner.md) Azure Cosmos DB. 

### <a name="existing-applications"></a>Существующие приложения ###

Если у вас есть приложение, использующее стандартное (ручное) масштабирование подготовленной пропускной способности, можно использовать [метрики Azure Monitor](../azure-monitor/insights/cosmosdb-insights-overview.md), чтобы определить, подходит ли шаблон трафика для автомасштабирования. 

Сначала найдите [метрику нормализованного потребления единиц запросов](monitor-normalized-request-units.md#view-the-normalized-request-unit-consumption-metric) для базы данных или контейнера. Нормализованное использование показывает, насколько вы используете стандартное (ручное) масштабирование подготовленной пропускной способности. Чем ближе показатель к 100 %, тем больше подготовленных единиц запросов в секунду вы используете. [Подробнее](monitor-normalized-request-units.md#view-the-normalized-request-unit-consumption-metric) о метрике.

Затем определите, как нормализованное использование меняется с течением времени. Если вы видите, что нормализованное использование меняется или является непредсказуемым, попробуйте включить автомасштабирование для базы данных или контейнера. Напротив, если оно устойчиво и предсказуемо, подумайте о том, чтобы продолжить использование стандартной (ручной) подготовленной пропускной способности. 

> [!TIP]
> Для стандартного (ручного) масштабирования пропускной способности можно применить метрику нормализованного использования, чтобы оценить фактическое количество единиц запросов в секунду, которые вы сможете потребить при переключении на автомасштабирование. Умножьте показатель нормализованного использования в конкретный момент времени на текущее значение единиц запросов в секунду в подготовленном стандартном (ручном) типе масштабирования. Например, если вы подготовили 5 000 ЕЗ/с и нормализованное использование составляет 90 %, то использование единиц запросов в секунду составляет 0,9 * 5 000 = 4 500 ЕЗ/с. Если вы видите, что шаблон трафика меняется, но вы указали слишком большое или слишком маленькое значение, вы можете включить автомасштабирование, а затем соответствующим образом изменить параметр максимального числа единиц запросов в секунду.

## <a name="measure-and-monitor-your-usage"></a>Измерение и отслеживание использования
Спустя некоторое время после выбора типа масштабирования пропускной способности следует понаблюдать за приложением и внести необходимые изменения. 

Если вы применяете автомасштабирование, используйте Azure Monitor, чтобы просмотреть значения подготовленного максимального количества единиц запросов в секунду (**максимальная пропускная способность при автомасштабировании**) и числа единиц запросов в секунду, которое в настоящий момент использует система (**подготовленная пропускная способность**). Ниже приведен пример переменной или непредсказуемой рабочей нагрузки при использовании автомасштабирования. Обратите внимание, что в случае отсутствия трафика система масштабирует количество единиц запросов в секунду до минимального значения, равного 10 % от максимального числа единиц запросов в секунду, что в данном случае составляет 5000 ЕЗ/с и 50 000 ЕЗ/с соответственно. 

:::image type="content" source="media/how-to-choose-offer/autoscale-metrics-azure-monitor.png" alt-text="Пример рабочей нагрузки, использующей автомасштабирование":::

> [!NOTE]
> Если используется стандартная (ручная) подготовленная пропускная способность, метрика **Подготовленная пропускная способность** указывает на то значение, которое вы настроили как пользователь. При использовании автомасштабирования пропускной способности эта метрика относится к числу единиц запросов в секунду, которое в настоящее время потребляет система.

## <a name="next-steps"></a>Дальнейшие действия
* Чтобы оценить пропускную способность для новых рабочих нагрузок, используйте [калькулятор единиц запросов](https://cosmos.azure.com/capacitycalculator/).
* Используйте [Azure Monitor](monitor-cosmos-db.md#view-operation-level-metrics-for-azure-cosmos-db) для отслеживания существующих рабочих нагрузок.
* Узнайте, как [подготовить автомасштабируемую пропускную способность для базы данных или контейнера Azure Cosmos](how-to-provision-autoscale-throughput.md).
* Изучите [часто задаваемые вопросы об автомасштабировании](autoscale-faq.md).