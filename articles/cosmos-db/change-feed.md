---
title: Работа с поддержкой веб-канала изменений в Azure Cosmos DB
description: Используйте Azure Cosmos DB поддержку веб-канала изменений для контроля изменений в документах, обработки на основе событий, таких как триггеры, а затем обновляйте кэши и аналитические системы в актуальном состоянии.
author: TheovanKraay
ms.author: thvankra
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 04/08/2020
ms.reviewer: sngun
ms.custom: seodec18
ms.openlocfilehash: e36e95aeb25c83ccd94f11e25bfe9f1b8f7bfdad
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "80984867"
---
# <a name="change-feed-in-azure-cosmos-db"></a>Канал изменений в Azure Cosmos DB

Канал изменений, поддерживаемый в Azure Cosmos DB, прослушивает изменения в контейнере Azure Cosmos. Затем он выводит отсортированный список документов в порядке, в котором они были изменены. Изменения сохраняются и обрабатываются асинхронно и пошагово, а выходные данные могут распределяться в один или несколько объектов-получателей для параллельной обработки.

Дополнительные сведения о [шаблонах разработки веб-канала изменений](change-feed-design-patterns.md).

## <a name="supported-apis-and-client-sdks"></a>Поддерживаемые API и клиентские пакеты SDK

Этот компонент сейчас поддерживается следующими API Cosmos DB и клиентскими пакетами SDK:

| **Клиентские драйверы**; | **API SQL** | **API Azure Cosmos DB для Cassandra** | **API Azure Cosmos DB для MongoDB** | **API Gremlin**|**API таблиц** |
| --- | --- | --- | --- | --- | --- | --- |
| .NET | Да | Да | Да | Да | Нет |
|Java|Да|Да|Да|Да|Нет|
|Python|Да|Да|Да|Да|Нет|
|Node/JS|Да|Да|Да|Да|Нет|

## <a name="change-feed-and-different-operations"></a>Канал изменений и разные операции

Сейчас вы увидите все операции вставки и обновления в веб-канале изменений. Невозможно отфильтровать веб-канал изменений для для конкретного типа операции. Одним из возможных альтернатив, является добавление "мягкого" маркера для элемента для обновлений и фильтрации на основе этого объекта при обработке элементов в веб-канале изменений.

В настоящее время веб-канал изменений не регистрирует удаления. Как и в предыдущем примере, можно добавить мягкий маркер для удаляемых элементов. Например, можно добавить атрибут в элемент "Deleted" и задать для него значение "true" и задать TTL для элемента, чтобы его можно было удалить автоматически. Вы можете прочитать канал изменений для исторических элементов (Последнее изменение, соответствующее элементу, оно не включает промежуточные изменения), например элементы, добавленные пятью лет назад. Вы можете прочитать веб-канал изменений до конца в качестве источника контейнера, но если элемент удален, он будет удален из канала изменений.

### <a name="sort-order-of-items-in-change-feed"></a>Порядок сортировки элементов в канале изменений

Элементы в канале изменений упорядочены по времени их изменения. Этот порядок сортировки гарантируется для каждого ключа логической секции.

### <a name="consistency-level"></a>Уровень согласованности

При использовании веб-канала изменений в конечном уровне согласованности могут существовать дублирующиеся события между последовательными операциями чтения канала изменений (Последнее событие одной операции чтения отображается как первое из следующих).

### <a name="change-feed-in-multi-region-azure-cosmos-accounts"></a>Канал изменений для учетных записей Azure Cosmos с поддержкой нескольких регионов

В учетной записи Azure Cosmos с поддержкой нескольких регионов действует следующее правило: если для региона записи выполнена отработка отказа, канал изменений учитывает отработку отказа вручную и сохраняет непрерывность.

### <a name="change-feed-and-time-to-live-ttl"></a>Канал изменений и срок жизни (TTL)

Если для элемента свойство TTL (Срок жизни) имеет значение -1, канал изменений будет сохраняться без ограничения по времени. Если данные не удаляются, они будут храниться в канале изменений.  

### <a name="change-feed-and-_etag-_lsn-or-_ts"></a>Канал изменений и теги _etag, _lsn или _ts

Формат _etag считается внутренним, и его не следует применять для важных элементов, так как он может измениться в любое время. Тег _ts содержит метку времени последнего изменения или создания. Этот идентификатор можно использовать для сравнения в хронологическом порядке. _lsn — это идентификатор пакета, который добавляется только для веб-канала изменений; Он представляет идентификатор транзакции. Значение _lsn будет одинаковым для многих элементов. ETag для FeedResponse отличается от eTag для элементов. Тег_etag — это внутренний идентификатор, который используется для управления параллелизмом как метка актуальной версии элемента, тогда как ETag используется для упорядочивания канала.

## <a name="working-with-change-feed"></a>Работа с каналом изменений

Для работы с каналом изменений у вас есть следующие варианты:

* [Как использовать канал изменений Azure Cosmos DB с Функциями Azure](change-feed-functions.md)
* [Использование канала изменений с обработчиком веб-канала изменений](change-feed-processor.md) 

Канал изменений доступен для каждого ключа логических разделов в контейнере, и его можно распределить для одного или нескольких потребителей для параллельной обработки, как показано на следующем рисунке.

![Распределенная обработка веб-канала изменений Azure Cosmos DB](./media/change-feed/changefeedvisual.png)

## <a name="features-of-change-feed"></a>Функции канала изменений

* Канал изменений по умолчанию включен для всех учетных записей Azure Cosmos.

* Вы можете использовать свою [подготовленную пропускную способность](request-units.md) для чтения из канала изменений, как и для любой другой операции Azure Cosmos DB, в любом регионе, настроенном для базы данных Azure Cosmos.

* Канал изменений поддерживает операции вставки и обновления, выполняемые по отношению к элементам в контейнере. Вы можете отслеживать операции удаления, используя вместо прямого удаления флаг обратимого удаления в элементах (например, документах). Или же можно установить ограниченный срок жизни элементов, используя настройки [срока жизни](time-to-live.md). Например, установите значение 24 часа и отслеживайте удаления по значению этого свойства. Эта возможность позволяет обрабатывать изменения быстрее, чем с использованием срока жизни.

* Каждое изменение в документе отображается в канале изменений ровно один раз, а логикой контрольных точек управляют клиенты. Если вы хотите избежать сложности управления контрольными точками, обработчик веб-канала изменений обеспечивает автоматическую контрольную точку и "хотя бы один раз" семантику. См. раздел [Использование веб-канала изменений с обработчиком веб-канала изменений](change-feed-processor.md).

* В журнал изменений вносится только самое последнее изменение в конкретном элементе. Промежуточные изменения могут быть недоступны.

* Канал изменений сортируется по времени изменения в пределах каждого значения ключа логических разделов. Для значений ключа разделов не четкий порядок не предусмотрен.

* Изменения можно синхронизировать в любой момент времени. Это означает, что фиксированный период хранения данных, в пределах которого доступны изменения, отсутствует.

* Изменения поступают параллельно для всех ключей логических разделов из контейнера Azure Cosmos. Это позволяет нескольким потребителям параллельно обрабатывать изменения из больших контейнеров.

* Приложения могут одновременно запрашивать несколько каналов изменения в одном контейнере. Свойство ChangeFeedOptions.StartTime позволяет определить начальную точку. Например, так можно найти токен продолжения за определенный период времени. ContinuationToken, если он указан, имеет приоритет над значениями StartTime и Стартфромбегиннинг. Точность ChangeFeedOptions.StartTime равняется приблизительно 5 секундам.

## <a name="change-feed-in-apis-for-cassandra-and-mongodb"></a>Веб-канал изменений в API для Cassandra и MongoDB

Функция веб-канала изменений отображается как поток изменений в API MongoDB и запрос с предикатом в API Cassandra. Дополнительные сведения о реализации API MongoDB см. в статье [потоки изменений в api Azure Cosmos DB для MongoDB](mongodb-change-streams.md).

Собственная технология Apache Cassandra предоставляет систему отслеживания измененных данных (CDC), механизм пометки определенных таблиц для архивации, а также отклонять операции записи в эти таблицы после достижения настраиваемого размера на диске для журнала CDC. Функция веб-канала изменений в Azure Cosmos DB API для Cassandra расширяет возможность запроса изменений с помощью предиката через CQL. Дополнительные сведения о реализации см. в статье [веб-канал изменений в Azure Cosmos DB API для Cassandra](cassandra-change-feed.md).

## <a name="next-steps"></a>Дальнейшие шаги

Вы можете продолжить знакомство с каналом изменений, перейдя к следующим статьям:

* [Reading Azure Cosmos DB change feed](read-change-feed.md) (Чтение канала изменений Azure Cosmos DB)
* [Как использовать канал изменений Azure Cosmos DB с Функциями Azure](change-feed-functions.md)
* [Использование обработчика канала изменений](change-feed-processor.md)
