---
title: Работа с поддержкой веб-канала изменений в Azure Cosmos DB
description: Используйте поддержку изменения dB-кода Azure Cosmos, чтобы отслеживать изменения в документах, обработку событий на основе триггеров и поддерживать кэши и аналитические системы в актуальном состоянии
author: TheovanKraay
ms.author: thvankra
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 04/08/2020
ms.reviewer: sngun
ms.custom: seodec18
ms.openlocfilehash: e36e95aeb25c83ccd94f11e25bfe9f1b8f7bfdad
ms.sourcegitcommit: 7d8158fcdcc25107dfda98a355bf4ee6343c0f5c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2020
ms.locfileid: "80984867"
---
# <a name="change-feed-in-azure-cosmos-db"></a>Канал изменений в Azure Cosmos DB

Канал изменений, поддерживаемый в Azure Cosmos DB, прослушивает изменения в контейнере Azure Cosmos. Затем он выводит отсортированный список документов в порядке, в котором они были изменены. Изменения сохраняются и обрабатываются асинхронно и пошагово, а выходные данные могут распределяться в один или несколько объектов-получателей для параллельной обработки.

Подробнее об [изменении шаблонов проектирования каналов.](change-feed-design-patterns.md)

## <a name="supported-apis-and-client-sdks"></a>Поддерживаемые API и клиентские пакеты SDK

Этот компонент сейчас поддерживается следующими API Cosmos DB и клиентскими пакетами SDK:

| **Клиентские драйверы**; | **API СЗЛ** | **API API Azure Cosmos DB для Кассандры** | **API Azure Cosmos DB для MongoDB** | **API Gremlin**|**API таблиц** |
| --- | --- | --- | --- | --- | --- | --- |
| .NET | Да | Да | Да | Да | нет |
|Java|Да|Да|Да|Да|нет|
|Python|Да|Да|Да|Да|нет|
|Node/JS|Да|Да|Да|Да|нет|

## <a name="change-feed-and-different-operations"></a>Канал изменений и разные операции

Сегодня вы видите все вставки и обновления в ленте изменений. Вы не можете фильтровать канал изменения для определенного типа операции. Одной из возможных альтернатив является добавление "мягкого маркера" на элемент для обновления и фильтрации на основе этого при обработке элементов в ленте изменений.

В настоящее время изменяется лента не регистрирует удаляет. Как и в предыдущем примере, можно добавить мягкий маркер на элементы, которые удаляются. Например, можно добавить атрибут в элемент под названием "удаленный" и установить его на "истинный" и установить TTL на элемент, так что он может быть автоматически удален. Вы можете прочитать ленту изменений для исторических элементов (последнее изменение, соответствующее элементу, оно не включает промежуточные изменения), например, элементы, которые были добавлены пять лет назад. Вы можете прочитать ленту изменений еще в начале вашего контейнера, но если элемент будет удален, он будет удален из ленты изменений.

### <a name="sort-order-of-items-in-change-feed"></a>Порядок сортировки элементов в канале изменений

Элементы в канале изменений упорядочены по времени их изменения. Этот порядок сортировки гарантируется в логическом ключе раздела.

### <a name="consistency-level"></a>Уровень согласованности

При потреблении канала изменения в уровне согласованности Eventual могут быть дублирующиеся события между последующими операциями чтения подачи на изменение (последнее событие одной операции чтения отображается как первое из следующих).

### <a name="change-feed-in-multi-region-azure-cosmos-accounts"></a>Канал изменений для учетных записей Azure Cosmos с поддержкой нескольких регионов

В учетной записи Azure Cosmos с поддержкой нескольких регионов действует следующее правило: если для региона записи выполнена отработка отказа, канал изменений учитывает отработку отказа вручную и сохраняет непрерывность.

### <a name="change-feed-and-time-to-live-ttl"></a>Канал изменений и срок жизни (TTL)

Если для элемента свойство TTL (Срок жизни) имеет значение -1, канал изменений будет сохраняться без ограничения по времени. Если данные не удаляются, они будут храниться в канале изменений.  

### <a name="change-feed-and-_etag-_lsn-or-_ts"></a>Канал изменений и теги _etag, _lsn или _ts

Формат _etag считается внутренним, и его не следует применять для важных элементов, так как он может измениться в любое время. Тег _ts содержит метку времени последнего изменения или создания. Этот идентификатор можно использовать для сравнения в хронологическом порядке. _lsn — это идентификатор пакетов, который добавляется только для подачи изменений; он представляет идентификатор транзакции. Значение _lsn будет одинаковым для многих элементов. ETag для FeedResponse отличается от eTag для элементов. Тег_etag — это внутренний идентификатор, который используется для управления параллелизмом как метка актуальной версии элемента, тогда как ETag используется для упорядочивания канала.

## <a name="working-with-change-feed"></a>Работа с каналом изменений

Для работы с каналом изменений у вас есть следующие варианты:

* [Как использовать канал изменений Azure Cosmos DB с Функциями Azure](change-feed-functions.md)
* [Использование канала изменений с процессором подачи изменений](change-feed-processor.md) 

Канал изменений доступен для каждого ключа логических разделов в контейнере, и его можно распределить для одного или нескольких потребителей для параллельной обработки, как показано на следующем рисунке.

![Распределенная обработка веб-канала изменений Azure Cosmos DB](./media/change-feed/changefeedvisual.png)

## <a name="features-of-change-feed"></a>Функции канала изменений

* Канал изменений по умолчанию включен для всех учетных записей Azure Cosmos.

* Вы можете использовать свою [подготовленную пропускную способность](request-units.md) для чтения из канала изменений, как и для любой другой операции Azure Cosmos DB, в любом регионе, настроенном для базы данных Azure Cosmos.

* Канал изменений поддерживает операции вставки и обновления, выполняемые по отношению к элементам в контейнере. Вы можете отслеживать операции удаления, используя вместо прямого удаления флаг обратимого удаления в элементах (например, документах). Или же можно установить ограниченный срок жизни элементов, используя настройки [срока жизни](time-to-live.md). Например, установите значение 24 часа и отслеживайте удаления по значению этого свойства. Эта возможность позволяет обрабатывать изменения быстрее, чем с использованием срока жизни.

* Каждое изменение в документе отображается в канале изменений ровно один раз, а логикой контрольных точек управляют клиенты. Если вы хотите избежать сложности управления контрольно-пропускных пунктов, процессор подачи изменений обеспечивает автоматическое контрольные точки и "по крайней мере один раз" семантики. Смотрите [с помощью канала изменения с изменением компромсом.](change-feed-processor.md)

* В журнал изменений вносится только самое последнее изменение в конкретном элементе. Промежуточные изменения могут быть недоступны.

* Канал изменений сортируется по времени изменения в пределах каждого значения ключа логических разделов. Для значений ключа разделов не четкий порядок не предусмотрен.

* Изменения можно синхронизировать в любой момент времени. Это означает, что фиксированный период хранения данных, в пределах которого доступны изменения, отсутствует.

* Изменения поступают параллельно для всех ключей логических разделов из контейнера Azure Cosmos. Это позволяет нескольким потребителям параллельно обрабатывать изменения из больших контейнеров.

* Приложения могут запрашивать несколько каналов изменения на одном контейнере одновременно. Свойство ChangeFeedOptions.StartTime позволяет определить начальную точку. Например, так можно найти токен продолжения за определенный период времени. ContinuationToken, если указано, имеет приоритет над значениями StartTime и StartFromStart. Точность ChangeFeedOptions.StartTime равняется приблизительно 5 секундам.

## <a name="change-feed-in-apis-for-cassandra-and-mongodb"></a>Изменение корма в AIS для Cassandra и MongoDB

Функциональность изменения корма всплывает как поток изменений в API и запросе MongoDB с предикатом в Cassandra API. Подробнее о деталях реализации API MongoDB можно узнать [в aPI-извне В Azure Cosmos DB API для MongoDB.](mongodb-change-streams.md)

Родной Apache Cassandra обеспечивает захват данных изменений (CDC), механизм для пометки конкретных таблиц для архивирования, а также отклонение записей на эти таблицы после того, как настраиваемый размер на диске для журнала CDC достигается. Функция подачи изменений в API Azure Cosmos DB для Cassandra повышает возможность запроса изменений с помощью предиката через C'L. Подробнее о деталях реализации читайте [в материале «Изменение» в API API Azure Cosmos DB для Cassandra.](cassandra-change-feed.md)

## <a name="next-steps"></a>Дальнейшие действия

Вы можете продолжить знакомство с каналом изменений, перейдя к следующим статьям:

* [Reading Azure Cosmos DB change feed](read-change-feed.md) (Чтение канала изменений Azure Cosmos DB)
* [Как использовать канал изменений Azure Cosmos DB с Функциями Azure](change-feed-functions.md)
* [Использование обработчика канала изменений](change-feed-processor.md)
