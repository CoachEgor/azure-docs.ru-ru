---
title: Устранение неполадок Azure Cosmos DB HTTP 408 или времени ожидания запроса с помощью пакета SDK для .NET
description: Как диагностировать и исправить исключение времени ожидания запроса пакета SDK для .NET
author: j82w
ms.service: cosmos-db
ms.date: 07/13/2020
ms.author: jawilley
ms.topic: troubleshooting
ms.reviewer: sngun
ms.openlocfilehash: 29b0c6237ae04ea5da9ec496498fc7c20890b173
ms.sourcegitcommit: dccb85aed33d9251048024faf7ef23c94d695145
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/28/2020
ms.locfileid: "87294630"
---
# <a name="diagnose-and-troubleshoot-azure-cosmos-db-net-sdk-request-timeout"></a>Диагностика и устранение неполадок Azure Cosmos DB время ожидания запроса пакета SDK для .NET
Ошибка HTTP 408 возникает, если пакету SDK не удалось выполнить запрос до наступления предельного времени ожидания.

## <a name="troubleshooting-steps"></a>Действия по устранению неполадок
Следующий список содержит известные причины и решения для исключений времени ожидания запроса.

### <a name="1-high-cpu-utilization-most-common-case"></a>1. Высокая загрузка ЦП (в большинстве случаев)
Для оптимальной задержки рекомендуется, чтобы загрузка ЦП составляла примерно 40%. Рекомендуется использовать 10 секунд в качестве интервала для наблюдения за максимальным (несредним) потреблением ресурсов ЦП. Пиковые нагрузки ЦП наиболее распространены с запросами между секциями, где они могут выполнять несколько подключений для одного запроса.

#### <a name="solution"></a>Решение:
Необходимо масштабировать клиентское приложение, использующее пакет SDK.

### <a name="2-socket--port-availability-might-be-low"></a>2. доступность сокета и порта может быть низкой
При работе в Azure клиенты, использующие пакет SDK для .NET, могут достичь нехватки портов Azure SNAT (PAT).

#### <a name="solution-1"></a>Решение 1.
Следуйте указаниям [по исчерпанию портов SNAT](troubleshoot-dot-net-sdk.md#snat).

#### <a name="solution-2"></a>Решение 2.
При использовании прокси-сервера HTTP убедитесь, что он может поддерживать число подключений, указанное в свойстве `ConnectionPolicy` пакета SDK.
В противном случае возникнут проблемы с подключением.

### <a name="3-creating-multiple-client-instances"></a>3. Создание нескольких экземпляров клиента
Создание нескольких экземпляров клиента может привести к конфликтам соединений и времени ожидания.

#### <a name="solution"></a>Решение:
Следуйте [рекомендациям по повышению производительности](performance-tips-dotnet-sdk-v3-sql.md#sdk-usage)и используйте один экземпляр космосклиент во всем процессе.

### <a name="4-hot-partition-key"></a>4. ключ горячей секции
Azure Cosmos DB распределяет общую пропускную способность равномерно по физическим секциям. При наличии критической секции один или несколько ключей логических секций в физическом разделе используют все единицы запросов к физическому разделу, в то время как единица запросов/с в других физических секциях не используется. В качестве симптома общее потребление единиц запросов в секунду будет меньше, чем общая подготовленная единица запросов/s в базе данных или контейнере, но вы по-прежнему увидите регулирование (429s) для запросов к ключу логической секции. Используйте [нормализованную метрику потребления на единицу](monitor-normalized-request-units.md) , чтобы определить, обнаруживается ли в рабочей нагрузке горячую секцию. 

#### <a name="solution"></a>Решение:
Выберите хороший ключ секции, который равномерно распределяет объем запросов и хранилище. Узнайте, как [изменить ключ секции](https://devblogs.microsoft.com/cosmosdb/how-to-change-your-partition-key/).

### <a name="5-high-degree-of-concurrency"></a>5. Высокая степень параллелизма
Приложение выполняет высокий уровень параллелизма, что может привести к состязанию в канале.

#### <a name="solution"></a>Решение:
Необходимо масштабировать клиентское приложение, использующее пакет SDK.

### <a name="6-large-requests-andor-responses"></a>6. большие запросы и ответы
Большие запросы или ответы могут привести к блокированию головного компьютера на основе усугубить, даже с относительно низкой степенью параллелизма.

#### <a name="solution"></a>Решение:
Необходимо масштабировать клиентское приложение, использующее пакет SDK.

### <a name="7-failure-rate-is-within-cosmos-db-sla"></a>7. Частота сбоев в рамках соглашения об уровне обслуживания Cosmos DB
Приложение должно иметь возможность обрабатывать временные сбои и при необходимости повторять попытку. 408. исключения не повторяются, так как при создании путей невозможно выяснить, создан ли элемент службой или нет. Повторная отправка одного и того же элемента для CREATE вызовет исключение конфликта. Бизнес-логика пользовательских приложений может иметь пользовательскую логику для обработки конфликтов, что приведет к нарушению неоднозначности существующего элемента и конфликта при повторном создании.

### <a name="8-failure-rate-is-violating-the-cosmos-db-sla"></a>8. Частота сбоев нарушает Cosmos DB соглашения об уровне обслуживания
Обратитесь в службу поддержки Azure.

## <a name="next-steps"></a>Дальнейшие действия
* [Диагностика и устранение неполадок](troubleshoot-dot-net-sdk.md) при использовании пакета SDK для Azure Cosmos DB .NET
* Сведения о рекомендациях по производительности для [.NET v3](performance-tips-dotnet-sdk-v3-sql.md) и [.NET v2](performance-tips.md)