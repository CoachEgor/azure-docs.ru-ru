---
title: Создание ключа синтетической перегородки в Azure Cosmos DB
description: Узнайте, как использовать синтетические ключи раздела в контейнерах Azure Cosmos для равномерного распределения данных и рабочей нагрузки по клавишам раздела
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 12/03/2019
author: markjbrown
ms.author: mjbrown
ms.openlocfilehash: e8786c2d6e93c18a5bf9856a5555d6b528f842c5
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75441224"
---
# <a name="create-a-synthetic-partition-key"></a>Создание искусственного ключа секции

Это лучшая практика, чтобы иметь ключ раздела со многими различными значениями, такими как сотни или тысячи. Главное — это равномерное распределение данных и рабочей нагрузки по всем элементам, связанным с этими значениями ключа секции. Если такого свойства в данных не существует, можно создать *синтетический ключ раздела.* В этом документе описано несколько основных методов создания ключа синтетической перегородки для контейнера Cosmos.

## <a name="concatenate-multiple-properties-of-an-item"></a>Сцепление нескольких свойств элемента

Вы можете создать ключ секции, объединив несколько значений свойств в одно искусственное свойство `partitionKey`. Эти ключи называются искусственными ключами. Рассмотрим следующий пример документа:

```JavaScript
{
"deviceId": "abc-123",
"date": 2018
}
```

Для предыдущего документа одним из вариантов является установка /deviceId или /date в качестве ключа секции. Используйте эту опцию, если вы хотите, чтобы разделить контейнер на основе идентификатора устройства или даты. Другой вариант заключается в сцеплении этих двух значений в искусственное свойство `partitionKey`, которое используется в качестве ключа секции.

```JavaScript
{
"deviceId": "abc-123",
"date": 2018,
"partitionKey": "abc-123-2018"
}
```

В сценариях реального времени в базе данных могут быть тысячи элементов. Вместо того, чтобы добавлять синтетический ключ вручную, определите логику клиента, чтобы спутать значения и вставьте синтетический ключ в элементы в контейнерах Cosmos.

## <a name="use-a-partition-key-with-a-random-suffix"></a>Использование ключа секции со случайным суффиксом

Другой возможной стратегией равномерного распределения рабочей нагрузки является добавление случайного числа в конце значения ключа секции. При таком распределении элементов вы можете выполнять параллельные операции записи по секциям.

Например, если ключ секции представляет собой дату, Вы можете выбрать случайное число между 1 и 400 и concatenate его как суффикс на дату. Этот метод приводит к разделу `2018-08-09.1`ключевых значений, как ,`2018-08-09.2`и так далее, через `2018-08-09.400`. Так как вы рандомизируете ключ секции, ежедневные операции записи в контейнере распределяются равномерно по нескольким секциям. Этот метод обеспечивает оптимальный параллелизм и высокую общую пропускную способность.

## <a name="use-a-partition-key-with-pre-calculated-suffixes"></a>Используйте ключ перегородки с предварительно рассчитанными суффиксами 

Стратегия случайного суффикса может значительно улучшить пропускную работу записи, но трудно читать конкретный элемент. Вы не знаете значение суффикса, которое использовалось при начняве предмете. Чтобы упростить чтение отдельных элементов, используйте заранее рассчитанную стратегию суффиксов. Вместо того, чтобы использовать случайное число для распределения элементов между разделами, используйте число, которое рассчитывается на основе того, что вы хотите задать.

Рассмотрим предыдущий пример, где контейнер использует дату в качестве ключа раздела. Теперь предположим, `Vehicle-Identification-Number` что`VIN`каждый элемент имеет атрибут ( ), к которым мы хотим получить доступ. Кроме того, предположим, что вы часто `VIN`запускаете запросы, чтобы найти элементы, в дополнение к дате. Прежде чем приложение запишет элемент в контейнер, оно может вычислить суффикс хэша на основе номера ТС и добавить его к дате ключа секции. Расчет может генерировать число между 1 и 400, которое равномерно распределено. Этот результат аналогичен результатам, полученным методом стратегии случайного суффикса. Значением ключа секции будет дата, сцепленная с вычисленным результатом.

С помощью этой стратегии записи равномерно распределяются по значениям ключа секции и по секциям. Вы можете легко прочитать определенный элемент и дату, потому что `Vehicle-Identification-Number`вы можете рассчитать значение ключа раздела для конкретного . Преимущество этого метода заключается в том, что можно избежать создания единого горячего ключа раздела, т.е. ключа раздела, который занимает всю рабочую нагрузку. 

## <a name="next-steps"></a>Дальнейшие действия

Подробнее о концепции разделения вы можете узнать в следующих статьях:

* Подробнее о [логических разделах.](partition-data.md)
* Подробнее о [подготовке пропускной способности в контейнерах и базах данных Azure Cosmos](set-throughput.md).
* Подробнее о [подготовке пропускной способности для контейнера Azure Cosmos](how-to-provision-container-throughput.md).
* Подробнее о [подготовке пропускной способности для базы данных Azure Cosmos](how-to-provision-database-throughput.md).
