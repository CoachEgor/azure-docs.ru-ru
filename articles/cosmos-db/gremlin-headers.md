---
title: Заголовки ответных заголовков Azure Cosmos DB Gremlin
description: Справочная документация для метаданных реакции сервера, которая позволяет дополнительно улавливать
ms.service: cosmos-db
ms.subservice: cosmosdb-graph
ms.topic: reference
ms.date: 09/03/2019
author: luisbosquez
ms.author: lbosq
ms.openlocfilehash: 95677f4c45c0213de5ffac5521bac1c6bf7294e4
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "72755083"
---
# <a name="azure-cosmos-db-gremlin-server-response-headers"></a>Заголовки ответных заголовков серверов Azure Cosmos DB Gremlin
В этой статье рассматриваются заголовки, которые сервер Cosmos DB Gremlin возвращает вызывающему объекту при выполнении запроса. Эти заголовки полезны для устранения неполадок с производительностью запросов, создания приложения, которое интегрируется со службой Cosmos DB, и упрощают поддержку клиентов.

Имейте в виду, что, принимая зависимость от этих заголовков, вы ограничиваете портативность приложения для других реализаций Gremlin. В свою очередь, вы получаете более жесткую интеграцию с Космос DB Gremlin. Эти заголовки не являются стандартом TinkerPop.

## <a name="headers"></a>Заголовки

| Заголовок | Тип | Образец значения | При включении | Объяснение |
| --- | --- | --- | --- | --- |
| **x-ms-request-charge** | double | 11.3243 | Успешные и неудачные события | Сумма сбора или пропускной памяти базы данных, потребляемая в [единицах запросов (RU/s или RUs)](request-units.md) для частичного сообщения ответа. Этот заголовок присутствует в каждом продолжении для запросов, которые имеют несколько фрагментов. Он отражает заряд конкретного отклика. Только для запросов, которые состоят из одного фрагмента ответа, этот заголовок соответствует общей стоимости обхода. Однако для большинства сложных обходов это значение представляет собой частичную стоимость. |
| **x-ms-total-request-charge** | double | 423.987 | Успешные и неудачные события | Сумма сбора или пропускной памяти базы данных, потребляемая в [единицах запроса (RU/s или RUs)](request-units.md) для всего запроса. Этот заголовок присутствует в каждом продолжении для запросов, которые имеют несколько фрагментов. Он указывает на совокупный заряд с начала запроса. Значение этого заголовка в последнем куске указывает полную плату запроса. |
| **x-ms-server-time-ms** | double | 13,75 | Успешные и неудачные события | Этот заголовок включен для устранения неполадок. Он указывает количество времени, в миллисекундах, что Космос DB Gremlin сервер взял для выполнения и получения частичного сообщения ответа. Использование значения этого заголовка и сравнение его с общими приложениями задержки запроса могут вычислить накладные расходы на задержку сети. |
| **x-ms-total-server-time-ms** | double | 130.512 | Успешные и неудачные события | Общее время, в миллисекундах, что Космос DB Gremlin сервер взял для выполнения всего обхода. Этот заголовок включен в каждый частичный ответ. Он представляет собой кумулятивное время выполнения с начала запроса. Последний ответ указывает общее время выполнения. Этот заголовок полезен для раздифференцирования между клиентом и сервером в качестве источника задержки. Вы можете сравнить время выполнения обхода клиента со значением этого заголовка. |
| **x-ms-статус-код** | long | 200 | Успешные и неудачные события | Заголовок указывает внутреннюю причину завершения или прекращения запроса. Приложению рекомендуется посмотреть на ценность этого заголовка и принять меры по исправлению положения. |
| **x-ms-субстатус-код** | long | 1003 | Только неудача | Cosmos DB — это многомодельная база данных, построенная поверх унифицированного слоя хранилища. Этот заголовок содержит дополнительные сведения о причине сбоя, когда сбой происходит в нижних слоях стека высокой доступности. Приложение рекомендуется хранить этот заголовок и использовать его при обращении в службу поддержки клиентов Cosmos DB. Значение этого заголовка полезно для инженера Cosmos DB для быстрого устранения неполадок. |
| **x-ms-retry-after-ms** | строка (TimeSpan) | "00:00:03.9500000" | Только неудача | Этот заголовок представляет собой строковое представление типа .NET [TimeSpan.](https://docs.microsoft.com/dotnet/api/system.timespan) Это значение будет включено только в запросы не удалось из-за резервированной пропускной выемки. Приложение должно повторно отправлять обход снова после упросила периода времени. |
| **x-ms-activity-id** | строка (Guid) | "A9218E01-3A3A-4716-9636-5BD86B056613" | Успешные и неудачные события | Заголовок содержит уникальный идентификатор запроса на стороне сервера. Каждому запросу присваивается сервер уникален уникальный идентификатор для целей отслеживания. Приложениядолжны регистрировать идентификаторы действий, возвращенные сервером для запросов, о которыми клиенты могут захотеть связаться со службой поддержки клиентов. Сотрудники службы поддержки Cosmos DB могут находить конкретные запросы по этим идентификаторам в телеметрии службы Cosmos DB. |

## <a name="status-codes"></a>Коды состояния

Наиболее распространенные коды статуса, возвращенные сервером, перечислены ниже.

| Состояние | Объяснение |
| --- | --- |
| **401** | Сообщение `"Unauthorized: Invalid credentials provided"` об ошибке возвращается, когда пароль проверки подлинности не соответствует ключу учетной записи Cosmos DB. Перейдите к учетной записи Cosmos DB Gremlin на портале Azure и подтвердите, что ключ правильный.|
| **404** | Параллельные операции, которые пытаются удалить и обновить тот же край или вершину одновременно. Сообщение об ошибке `"Owner resource does not exist"` означает, что в указанной базе данных или коллекции содержатся неправильные параметры подключения в формате `/dbs/<database name>/colls/<collection or graph name>`.|
| **408** | `"Server timeout"`указывает на то, что обход занял более **30 секунд** и был отменен сервером. Оптимизируйте свои обходы, чтобы быстро работать, фильтруя вершины или края на каждом переходе, чтобы сузить область поиска.|
| **409** | `"Conflicting request to resource has been attempted. Retry to avoid conflicts."` Это обычно происходит, если вершина или ребро с определенным идентификатором уже есть в графе.| 
| **412** | Код статуса дополняется `"PreconditionFailedException": One of the specified pre-condition is not met`сообщением об ошибке. Эта ошибка свидетельствует об оптимистичном нарушении контроля параллелизма между чтением края или вершины и написанием его обратно в магазин после модификации. Наиболее распространенными ситуациями, когда `g.V('identifier').property('name','value')`эта ошибка происходит является изменение свойства, например. Двигатель Гремлин будет читать вершины, изменить его, и написать его обратно. Если параллельно проходит еще один обход, пытающийся написать ту же вершину или край, один из них получит эту ошибку. Приложение должно повторно отправлять обход на сервер.| 
| **429** | Запрос отрегулирован. Его следует повторить по истечении времени, указанного в заголовке **x-ms-retry-after-ms**.| 
| **500** | Сообщение об ошибке `"NotFoundException: Entity with the specified id does not exist in the system."` указывает, что база данных и (или) коллекция была повторно создана с тем же именем. Эта ошибка исчезнет в течение 5 минут по мере распространения изменений и сделает кэши в разных компонентах Cosmos DB недействительными. Чтобы избежать этой проблемы, каждый раз используйте уникальные имена базы данных и коллекции.| 
| **1000** | Этот код состояния возвращается, когда сервер успешно разбирает сообщение, но не может выполнить. Обычно это указывает на проблему с запросом.| 
| **1001** | Этот код возвращается, когда сервер завершает выполнение обхода, но не выполняет ответ клиенту. Эта ошибка может произойти, когда обход генерирует сложный результат, который слишком велик или не соответствует спецификации протокола TinkerPop. Приложение должно упростить обход, когда он сталкивается с этой ошибкой. | 
| **1003** | `"Query exceeded memory limit. Bytes Consumed: XXX, Max: YYY"`возвращается, когда обход превышает допустимый предел памяти. Предел памяти составляет **2 ГБ** на обход.| 
| **1004** | Этот код состояния указывает на недоформированный запрос на график. Запрос может быть пороком, когда он не десериализации, незначение типа в настоящее время десериализована как тип значения или неподдерживаемые операции гремлина просил. Приложение не должно повторно пытаться запрос, потому что он не будет успешным. | 
| **1007** | Обычно этот код состояния возвращается с сообщением `"Could not process request. Underlying connection has been closed."`об ошибке. Такая ситуация может произойти, если драйвер клиента пытается использовать соединение, которое закрывается сервером. Приложение должно повторно пересмотреть обход на другом соединении.
| **1008** | Сервер Cosmos DB Gremlin может прекратить соединения для ребалансировки трафика в кластере. Драйверы клиентов должны справиться с этой ситуацией и использовать только живые соединения для отправки запросов на сервер. Иногда драйверы клиентов могут не обнаружить, что соединение было закрыто. Когда приложение сталкивается `"Connection is too busy. Please retry after sometime or open more connections."` с ошибкой, оно должно повторно пройти на другом соединении.

## <a name="samples"></a>Примеры

Пример клиентского приложения, основанный на Gremlin.Net, который читает один атрибут состояния:

```csharp
// Following example reads a status code and total request charge from server response attributes.
// Variable "server" is assumed to be assigned to an instance of a GremlinServer that is connected to Cosmos DB account.
using (GremlinClient client = new GremlinClient(server, new GraphSON2Reader(), new GraphSON2Writer(), GremlinClient.GraphSON2MimeType))
{
  ResultSet<dynamic> responseResultSet = await GremlinClientExtensions.SubmitAsync<dynamic>(client, requestScript: "g.V().count()");
  long statusCode = (long)responseResultSet.StatusAttributes["x-ms-status-code"];
  double totalRequestCharge = (double)responseResultSet.StatusAttributes["x-ms-total-request-charge"];

  // Status code and request charge are logged into application telemetry.
}
```

Пример, демонстрируя, как читать атрибут состояния от клиента Gremlin java:

```java
try {
  ResultSet resultSet = this.client.submit("g.addV().property('id', '13')");
  List<Result> results = resultSet.all().get();

  // Process and consume results

} catch (ResponseException re) {
  // Check for known errors that need to be retried or skipped
  if (re.getStatusAttributes().isPresent()) {
    Map<String, Object> attributes = re.getStatusAttributes().get();
    int statusCode = (int) attributes.getOrDefault("x-ms-status-code", -1);

    // Now we can check for specific conditions
    if (statusCode == 409) {
        // Handle conflicting writes
      }
    }

    // Check if we need to delay retry
    if (attributes.containsKey("x-ms-retry-after-ms")) {
      // Read the value of the attribute as is
      String retryAfterTimeSpan = (String) attributes.get("x-ms-retry-after-ms"));

      // Convert the value into actionable duration
            LocalTime locaTime = LocalTime.parse(retryAfterTimeSpan);
            Duration duration = Duration.between(LocalTime.MIN, locaTime);

      // Perform a retry after "duration" interval of time has elapsed
    }
  }
}

```

## <a name="next-steps"></a>Дальнейшие действия
* [Коды статуса HTTP для Azure Cosmos DB](https://docs.microsoft.com/rest/api/cosmos-db/http-status-codes-for-cosmosdb) 
* [Общие заголовки ответов Azure Cosmos DB REST](https://docs.microsoft.com/rest/api/cosmos-db/common-cosmosdb-rest-response-headers)
* [TinkerPop График Драйвер Требования поставщика]( http://tinkerpop.apache.org/docs/current/dev/provider/#_graph_driver_provider_requirements)
