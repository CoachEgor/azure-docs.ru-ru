---
title: Секционирование и горизонтальное масштабирование в Azure Cosmos DB
description: Узнайте, как работает секционирование в Azure Cosmos DB, как настроить секционирование и ключи секций, а также как выбрать правильный ключ секции для приложения.
author: deborahc
ms.author: dech
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 04/28/2020
ms.openlocfilehash: 57417a80ea83005c01b6f2a17206d46e6c049719
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "85112784"
---
# <a name="partitioning-and-horizontal-scaling-in-azure-cosmos-db"></a>Секционирование и горизонтальное масштабирование в Azure Cosmos DB

В этой статье объясняется связь между логическими и физическими секциями. Здесь также обсуждаются рекомендации по секционированию и представлено подробное представление о том, как работает горизонтальное масштабирование в Azure Cosmos DB. Нет необходимости понимать эти внутренние сведения, чтобы [выбрать ключ секции](partitioning-overview.md#choose-partitionkey) , но мы рассмотрели их, чтобы вы могли понять, как работает Azure Cosmos DB.

## <a name="logical-partitions"></a>Логические секции

Логическая Секция состоит из набора элементов, имеющих один и тот же ключ секции. Например, в контейнере, содержащем данные о Food информации питании, все элементы содержат `foodGroup` свойство. В `foodGroup` качестве ключа секции для контейнера можно использовать. Группы элементов, имеющие определенные значения для `foodGroup` , такие как `Beef Products` , `Baked Products` и `Sausages and Luncheon Meats` , формируют логические секции для различных форм. При удалении базовых данных не нужно беспокоиться об удалении логической секции.

Логическая Секция также определяет область транзакций базы данных. Элементы в логической секции можно обновить с помощью [транзакции с изоляцией моментальных снимков](database-transactions-optimistic-concurrency.md). При добавлении новых элементов в контейнер новые логические секции прозрачно создаются системой.

Количество логических секций в контейнере не ограничено. Каждый логический раздел может хранить до 20 ГБ данных. Хороший выбор ключа секции имеет широкий диапазон возможных значений. Например, в контейнере, где все элементы содержат `foodGroup` свойство, данные в `Beef Products` логической секции могут увеличиваться до 20 ГБ. [Выбор ключа секции](partitioning-overview.md#choose-partitionkey) с широким диапазоном возможных значений гарантирует возможность масштабирования контейнера.

## <a name="physical-partitions"></a>Физические секции

Контейнер Azure Cosmos масштабируется путем распределения данных и пропускной способности в физических секциях. На внутреннем уровне одна или несколько логических секций сопоставлены с одной физической секцией. В большинстве небольших контейнеров Cosmos много логических секций, но требуется только одна физическая секция. В отличие от логических секций физические секции являются внутренней реализацией системы и полностью управляются с помощью Azure Cosmos DB.

Число физических секций в контейнере Cosmos зависит от следующих факторов:

- Объем подготовленной пропускной способности (каждая отдельная физическая секция может обеспечить пропускную способность до 10 000 единиц запросов в секунду).
- Общее хранилище данных (каждая отдельная физическая секция может хранить до 50 ГБ)

Общее число физических секций в контейнере не ограничено. По мере роста подготовленной пропускной способности или размера данных Azure Cosmos DB автоматически создаст новые физические секции, разделив существующие. Разбиение физического раздела не влияет на доступность вашего приложения. После разбиения физического раздела все данные в пределах одной логической секции будут по-прежнему храниться в одной и той же физической секции. Разбиение физического раздела просто создает новое сопоставление логических секций с физическими секциями.

Пропускная способность, подготовленная для контейнера, распределяется равномерно между физическими секциями. Структура ключа секции, которая равномерно распределяет запросы пропускной способности, может создавать "горячий" секции. Использование критических секций может привести к ограничению скорости и неэффективному использованию подготовленной пропускной способности и более высоких затрат.

Физические разделы контейнера можно просмотреть в разделе **хранилище** в **колонке метрики** портал Azure:

:::image type="content" source="./media/partition-data/view-partitions-zoomed-out.png" alt-text="Просмотр числа физических разделов" lightbox="./media/partition-data/view-partitions-zoomed-in.png" ::: 

В этом примере контейнер, в котором мы выбрали `/foodGroup` ключ секции, каждый из трех прямоугольников представляет физическую секцию. В образе **диапазон ключей раздела** совпадает с физическим разделом. Выбранный физический раздел содержит три логических раздела: `Beef Products` , `Vegetable and Vegetable Products` и `Soups, Sauces, and Gravies` .

При подготовке пропускной способности 18 000 единиц запросов в секунду каждый из трех физических секций может использовать 1/3 из общей подготовленной пропускной способности. В пределах выбранной физической секции ключи логических секций, `Beef Products` `Vegetable and Vegetable Products` и, в `Soups, Sauces, and Gravies` совокупности, могут использовать подготовленные единицы запросов в 6 000 для физического раздела. Так как подготовленная пропускная способность равномерно распределяется по физическим секциям контейнера, важно выбрать ключ секции, который равномерно распределяет потребление пропускной способности, [выбрав правильный ключ логической секции](partitioning-overview.md#choose-partitionkey). При выборе ключа секции, который равномерно распределяет потребление пропускной способности по логическим секциям, вы обеспечите балансировку потребления пропускной способности в физических секциях.

## <a name="replica-sets"></a>Наборы реплик

Каждая физическая Секция состоит из набора реплик, которые также называют [*набором реплик*](global-dist-under-the-hood.md). На каждом наборе реплик размещен экземпляр ядра СУБД Azure Cosmos. Набор реплик делает данные, хранящиеся в физическом разделе, устойчивой, высокой доступностью и целостными. Каждая реплика, составляющая физическую секцию, наследует квоту хранилища секции. Все реплики физической секции совокупно поддерживают пропускную способность, выделенную для физической секции. Azure Cosmos DB автоматически управляет наборами реплик.

Большинству небольших контейнеров Cosmos требуется только одна физическая секция, но по-прежнему будет иметь по крайней мере 4 реплики.

На следующем рисунке показано, как логические секции сопоставляются с физическими, которые распределяются глобально:

:::image type="content" source="./media/partition-data/logical-partitions.png" alt-text="Изображение, демонстрирующее Azure Cosmos DB секционирования" border="false":::

## <a name="next-steps"></a>Дальнейшие шаги

* Узнайте [, как выбрать ключ секции](partitioning-overview.md#choose-partitionkey).
* Дополнительные сведения о [подготовленной пропускной способности в Azure Cosmos DB](request-units.md).
* Сведения о [глобальном распределении в Azure Cosmos DB](distribute-data-globally.md).
* Подробнее о [подготовке пропускной способности для контейнера Azure Cosmos](how-to-provision-container-throughput.md).
* Подробнее о [подготовке пропускной способности для базы данных Azure Cosmos](how-to-provision-database-throughput.md).
