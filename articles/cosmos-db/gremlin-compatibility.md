---
title: Azure Cosmos DB совместимость Gremlin с функциями TinkerPop
description: Справочная документация проблемы совместимости модуля Graph
author: SnehaGunda
ms.service: cosmos-db
ms.subservice: cosmosdb-graph
ms.topic: reference
ms.date: 09/10/2019
ms.author: sngun
ms.openlocfilehash: 1db7937cb574ce62986f25e0bfa688dc54b5c606
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "84700605"
---
# <a name="azure-cosmos-db-gremlin-compatibility"></a>Azure Cosmos DB совместимость Gremlin
Azure Cosmos DB подсистема графов выглядит в соответствии со спецификацией этапов обхода [Apache TinkerPop](https://tinkerpop.apache.org/docs/current/reference/#graph-traversal-steps) , но существуют различия в реализации, характерные для Azure Cosmos DB. Список поддерживаемых шагов Gremlin см. в статье о [поддержке протокола GREMLIN API](gremlin-support.md) .

## <a name="behavior-differences"></a>Различия в поведении

* Модуль Azure Cosmos DB Graph выполняет обход по ***ширине в ширину*** , а TinkerPop Gremlin — первый. Такое поведение обеспечивает лучшую производительность в горизонтально масштабируемых системах, таких как Cosmos DB. 

## <a name="unsupported-features"></a>Неподдерживаемые функции

* ***[Gremlin Bytecode](https://tinkerpop.apache.org/docs/current/tutorials/gremlin-language-variants/)***  — это независимая от языка спецификация для обходов графа. Граф Cosmos DB еще не поддерживается. Используйте `GremlinClient.SubmitAsync()` и передайте обход в виде текстовой строки.

* ***`property(set, 'xyz', 1)`*** Задание количества элементов в настоящее время не поддерживается. Взамен рекомендуется использовать `property(list, 'xyz', 1)`. Дополнительные сведения см. в разделе [Свойства вершин с помощью TinkerPop](http://tinkerpop.apache.org/docs/current/reference/#vertex-properties).

* Этот *** `match()` шаг*** сейчас недоступен. Этот шаг предоставляет возможности декларативного запроса.

* ***Объекты, так как свойства*** на вершинах или краях не поддерживаются. Как свойства могут использоваться только примитивные типы или массивы.

* ***Сортировка по свойствам массива*** `order().by(<array property>)` не поддерживается. Сортировка поддерживается только для примитивных типов.

* ***Типы JSON, отличные от примитивов*** , не поддерживаются. Используйте `string` `number` типы, или `true` / `false` . `null`значения не поддерживаются. 

* В настоящее время сериализатор ***GraphSONv3*** не поддерживается. Используйте `GraphSONv2` классы сериализаторов, модулей чтения и записи в конфигурации подключения. Результаты, возвращаемые API Azure Cosmos DB Gremlin, имеют формат GraphSON. 

* **Лямбда-выражения и функции** в настоящее время не поддерживаются. К ним относятся `.map{<expression>}` функции, `.by{<expression>}` и `.filter{<expression>}` . Дополнительные сведения и о том, как переписать их с помощью Gremlin шагов, см. в [примечании к лямбда-выражениям](http://tinkerpop.apache.org/docs/current/reference/#a-note-on-lambdas).

* ***Транзакции*** не поддерживаются из-за распределенного характера системы.  Настройте соответствующую модель согласованности для учетной записи Gremlin, чтобы она читала свои собственные записи, и используйте оптимистичный параллелизм для разрешения конфликтующих операций записи.

## <a name="known-limitations"></a>Известные ограничения

* **Использование индексов для запросов Gremlin с `.V()` шагами промежуточного обхода**: в настоящее время только первый `.V()` вызов обхода будет использовать индекс для разрешения всех фильтров или предикатов, присоединенных к нему. Последующие вызовы не будут обращаться к индексу, что может увеличить задержку и стоимость запроса.
    
    При использовании индексирования по умолчанию обычный запрос Read Gremlin, который начинается с `.V()` шага, будет использовать параметры в присоединенных шагах фильтрации, например `.has()` или `.where()` для оптимизации затрат и производительности запроса. Пример:

    ```java
    g.V().has('category', 'A')
    ```

    Однако если `.V()` в запрос Gremlin включено более одного шага, то разрешение данных для запроса может быть неоптимальным. В качестве примера рассмотрим следующий запрос:

    ```java
    g.V().has('category', 'A').as('a').V().has('category', 'B').as('b').select('a', 'b')
    ```

    Этот запрос возвратит две группы вершин на основе их свойств с именем `category` . В этом случае только первый вызов `g.V().has('category', 'A')` будет использовать индекс для разрешения вершин на основе значений их свойств.

    Обходной путь для этого запроса заключается в использовании шагов обхода, таких как `.map()` и `union()` . Это содержащиеся ниже:

    ```java
    // Query workaround using .map()
    g.V().has('category', 'A').as('a').map(__.V().has('category', 'B')).as('b').select('a','b')

    // Query workaround using .union()
    g.V().has('category', 'A').fold().union(unfold(), __.V().has('category', 'B'))
    ```

    Чтобы проверить производительность запросов, используйте [Gremlin `executionProfile()` Шаг] (Graph-Execution-Profile.md.

## <a name="next-steps"></a>Дальнейшие шаги
* Посетите страницу [Cosmos DB пользователя](https://feedback.azure.com/forums/263030-azure-cosmos-db) , чтобы поделиться отзывами и помочь команде сосредоточиться на важных для вас функциях.
