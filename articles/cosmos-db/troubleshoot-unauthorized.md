---
title: Устранение неполадок Azure Cosmos DB несанкционированного исключения
description: Как диагностировать и исправить несанкционированные исключения
author: j82w
ms.service: cosmos-db
ms.date: 07/13/2020
ms.author: jawilley
ms.topic: troubleshooting
ms.reviewer: sngun
ms.openlocfilehash: 872780ff65dabe5a931ae712c0f99b6e4f3e726d
ms.sourcegitcommit: dccb85aed33d9251048024faf7ef23c94d695145
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/28/2020
ms.locfileid: "87294516"
---
# <a name="diagnose-and-troubleshoot-azure-cosmos-db-unauthorized-exception"></a>Диагностика и устранение неполадок Azure Cosmos DB несанкционированных исключений

HTTP 401: подпись MAC, найденная в HTTP-запросе, отличается от вычисленной подписи.
Отображается следующее сообщение об ошибке 401: The MAC signature found in the HTTP request is not the same as the computed signature. (Подпись MAC в HTTP-запросе отличается от вычисляемой подписи). Это может быть вызвано следующими сценариями.

Старые пакеты SDK исключение может отображаться как недопустимое исключение JSON вместо правильного незаконного исключения 401. Более новые пакеты SDK правильно обрабатывали этот сценарий и выдают допустимое сообщение об ошибке.

## <a name="troubleshooting-steps"></a>Действия по устранению неполадок
Следующий список содержит известные причины и решения для несанкционированного исключения.

### <a name="1-key-was-not-properly-rotated-is-the-most-common-scenario"></a>1. неправильное вращение ключа является наиболее распространенным сценарием.
Ошибка подписи MAC с кодом 401 появляется вскоре после смены ключа и обычно исчезает сама. 

#### <a name="solution"></a>Решение:
Была выполнена смена ключа без соблюдения [рекомендаций](secure-access-to-data.md#key-rotation). Смена ключа учетной записи Cosmos DB может занять от нескольких секунд до, возможно, в днях, в зависимости от размера учетной записи Cosmos DB.

### <a name="2-the-key-is-misconfigured"></a>2. ключ настроен неправильно 
401. Ошибка подписи MAC будет одинаковой для всех вызовов, использующих этот ключ

#### <a name="solution"></a>Решение:
Ключ в приложении настроен неправильно и использует неправильный ключ для учетной записи или весь ключ не был скопирован.

### <a name="3-the-application-is-using-the-read-only-keys-for-write-operations"></a>3. приложение использует ключи только для чтения для операций записи.
401. проблема с подписью MAC возникает только для операций записи, таких как CREATE или Replace, но запрос на чтение выполнен.

#### <a name="solution"></a>Решение:
Чтобы разрешить успешное завершение операций, переключите приложение на использование ключа для чтения и записи.

### <a name="4-race-condition-with-create-container"></a>4. состояние гонки с созданием контейнера
401. в ближайшее время после создания контейнера возникает ошибка цифровой подписи MAC. Это происходит только до завершения создания контейнера.

#### <a name="solution"></a>Решение:
При создании контейнера наблюдается состояние гонки. Экземпляр приложения пытается получить доступ к контейнеру до окончательного создания контейнера. Наиболее распространенный сценарий для этого состояния гонки — если приложение работает и контейнер удаляется и создается повторно с тем же именем. Пакет SDK попытается использовать новый контейнер, но создание контейнера еще продолжается, поэтому у него нет ключей.

## <a name="next-steps"></a>Дальнейшие шаги
* [Диагностика и устранение неполадок](troubleshoot-dot-net-sdk.md) при использовании пакета SDK для Azure Cosmos DB .NET
* Сведения о рекомендациях по производительности для [.NET v3](performance-tips-dotnet-sdk-v3-sql.md) и [.NET v2](performance-tips.md)