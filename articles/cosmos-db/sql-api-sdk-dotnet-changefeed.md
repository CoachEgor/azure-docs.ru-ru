---
title: Azure Cosmos DB .NET изменение подачи процессора API, SDK релиз отмечает
description: Сведения об API и пакете SDK для обработчика канала изменений, включая даты выхода, даты прекращения, а также изменения, внесенные в каждую версию пакета SDK для обработчика канала изменений в .NET.
author: ealsur
ms.service: cosmos-db
ms.subservice: cosmosdb-sql
ms.devlang: dotnet
ms.topic: reference
ms.date: 01/30/2019
ms.author: maquaran
ms.openlocfilehash: 9252e3e41d0c639231a2abe20202499c6b3ee32a
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75444858"
---
# <a name="net-change-feed-processor-sdk-download-and-release-notes"></a>Пакет SDK для обработчика канала изменений в .NET: скачивание и заметки о выпуске

> [!div class="op_single_selector"]
>
> * [.NET](sql-api-sdk-dotnet.md)
> * [Лента изменения .NET](sql-api-sdk-dotnet-changefeed.md)
> * [.NET Core](sql-api-sdk-dotnet-core.md)
> * [Node.js](sql-api-sdk-node.md)
> * [Async Java](sql-api-sdk-async-java.md)
> * [Java](sql-api-sdk-java.md)
> * [Python](sql-api-sdk-python.md)
> * [Остальные](https://docs.microsoft.com/rest/api/cosmos-db/)
> * [Поставщик ресурсов REST](https://docs.microsoft.com/rest/api/cosmos-db-resource-provider/)
> * [SQL](sql-api-query-reference.md)
> * [Массовый исполнитель - .NET](sql-api-sdk-bulk-executor-dot-net.md)
> * [Массовый исполнитель - Java](sql-api-sdk-bulk-executor-java.md)

|   |   |
|---|---|
|**Загрузка SDK**|[NuGet](https://www.nuget.org/packages/Microsoft.Azure.DocumentDB.ChangeFeedProcessor/)|
|**Документация API**|[Справочная документация по изменению API библиотеки обработчика веб-каналов](/dotnet/api/microsoft.azure.documents.changefeedprocessor?view=azure-dotnet)|
|**Начало работы**|[Начало работы с пакетом SDK для обработчика канала изменений в .NET](change-feed.md)|
|**Текущая поддерживаемая платформа**| [Microsoft .NET Framework 4.5](https://www.microsoft.com/download/details.aspx?id=30653)</br> [Microsoft .NET Core](https://www.microsoft.com/net/download/core) |

> [!NOTE]
> Если вы используете процессор подачи изменений, пожалуйста, смотрите последнюю версию 3.x [.NET SDK](change-feed-processor.md), которая имеет изменение корма, встроенного в SDK. 

## <a name="release-notes"></a>Заметки о выпуске

### <a name="v2-builds"></a>Сборки версии 2

### <a name="228"></a><a name="2.2.8"/>2.2.8
* Улучшения стабильности и диагностизируемости:
  * Добавленная поддержка для обнаружения корма для изменения чтения занимает много времени. Когда это занимает больше времени, `ChangeFeedProcessorOptions.ChangeFeedTimeout` чем значение, указанное свойством, принимаются следующие шаги:
    * Операция по чтению канала изменения проблемного раздела прервана.
    * Экземпляр процессора изменения корма отбрасывает право собственности на проблемную аренду. Упавший лизинг будет выбран во время следующего шага приобретения аренды, который будет сделан тем же или другим экземпляром процессора подачи изменений. Таким образом, чтение изменения корма начнется сначала.
    * Сообщение о проблеме сообщается на мониторе здравоохранения. Монитор здоровья по умолчанию отправляет все зарегистрированные проблемы для отслеживания журнала.
  * Добавлена новая государственная собственность: `ChangeFeedProcessorOptions.ChangeFeedTimeout`. Значение этого свойства по умолчанию составляет 10 минут.
  * Добавлено новое публичное `Monitoring.MonitoredOperation.ReadChangeFeed`значение enum: . Когда значение `HealthMonitoringRecord.Operation` устанавливается, `Monitoring.MonitoredOperation.ReadChangeFeed`это указывает на проблемы со здоровьем, связанные с чтением изменения канала.

### <a name="227"></a><a name="2.2.7"/>2.2.7
* Улучшенная стратегия балансировки нагрузки для сценария при получении всех договоров аренды занимает больше времени, чем интервал действия аренды, например, из-за проблем с сетью:
  * В этом сценарии алгоритм балансировки нагрузки, используемый для ложного рассмотрения аренды как истекший, в результате чего кража аренды от активных владельцев. Это может вызвать ненужную перебалансировку большого количества договоров аренды.
  * Эта проблема фиксируется в этом выпуске, избегая повторной попытки на конфликт при приобретении просроченной аренды, владелец не изменился и posponing приобретения просроченной аренды на следующую нагрузку балансировки итерации.

### <a name="226"></a><a name="2.2.6"/>2.2.6
* Улучшена обработка исключений Observer.
* Добавлены сведения об ошибках Observer:
  * Если операции с Observer прерываются из-за исключения, вызванного ProcessChangesAsync, CloseAsync получит параметр reason с заданным значением ChangeFeedObserverCloseReason.ObserverError.
  * Добавлены трассировки для выявления ошибок в пользовательском коде в Observer.

### <a name="225"></a><a name="2.2.5"/>2.2.5
* Добавлена поддержка обработки разбиения коллекций, использующих пропускную способность общей базы данных.
  * В этом выпуске устранена такая проблема: во время разбиения коллекций с использованием пропускной способности общей базы данных происходило перераспределение разделов с созданием только одного диапазона ключей дочернего элемента (а не двух). В таких ситуациях обработчик канала изменений может зависнуть, удаляя аренду для старого диапазона ключей раздела и не создавая новые аренды. В этом выпуске эта проблема исправлена.

### <a name="224"></a><a name="2.2.4"/>2.2.4
* Добавлено новое свойство ChangeFeedProcessorOptions.StartContinuation для включения поддержки при запуске канала изменений из маркера продолжения запроса. Используется, только если возвращается пустая коллекция аренды или для аренды не настроен параметр ContinuationToken. Для аренды в коллекции аренды с настроенным и используемым параметром ContinuationToken свойство ChangeFeedProcessorOptions.StartContinuation игнорируется.

### <a name="223"></a><a name="2.2.3"/>2.2.3
* Добавлена поддержка пользовательского хранилища для хранения маркеров продолжения для секций.
  * Например, хранилище пользовательской аренды может быть коллекцией аренд Azure Cosmos DB, секционированной любым способом.
  * Хранилища пользовательских аренд могут использовать новый общедоступный интерфейс ILeaseStoreManager и свойство ChangeFeedProcessorBuilder.WithLeaseStoreManager(ILeaseStoreManager) точки расширяемости.
  * Для интерфейса ILeaseManager выполнен рефакторинг в нескольких интерфейсах роли.
* Незначительное критическое изменение: удалено свойство точки расширяемости ChangeFeedProcessorBuilder.WithLeaseManager(ILeaseManager). Вместо этого используйте свойство ChangeFeedProcessorBuilder.WithLeaseStoreManager(ILeaseStoreManager).

### <a name="222"></a><a name="2.2.2"/>2.2.2
* Этот выпуск устраняет проблему, которая происходит во время обработки разбиения в отслеживаемой коллекции и использования секционированной коллекции аренд. При обработке аренды для разбиения секций, аренда, соответствующая этой секции, не будет удалена. В этом выпуске эта проблема исправлена.

### <a name="221"></a><a name="2.2.1"/>2.2.1
* Исправлено вычисление оценки для учетных записей с несколькими источниками и нового формата токена сеанса.

### <a name="220"></a><a name="2.2.0"/>2.2.0
* Добавлена поддержка для секционированных коллекций аренд. Ключ секции должен быть определен как /id.
* Небольшое критическое изменение: методы интерфейса IChangeFeedDocumentClient и класса ChangeFeedDocumentClient были изменены для включения параметров RequestOptions и CancellationToken. IChangeFeedDocumentClient является передовой точкой расширяемости, которая позволяет обеспечить пользовательскую реализацию клиента документа для использования с процессором Change Feed, например, украсить DocumentClient и перехватить все звонки на него, чтобы сделать дополнительную трассировку, обработку ошибок Др. С этим обновлением код, реализуемый IChangeFeedDocumentClient, должен быть изменен, чтобы включить новые параметры в реализацию.
* Незначительные улучшения системы диагностики.

### <a name="210"></a><a name="2.1.0"/>2.1.0
* Добавлен новый API, Task&lt;IReadOnlyList&lt;RemainingPartitionWork&gt;&gt; IRemainingWorkEstimator.GetEstimatedRemainingWorkPerPartitionAsync(). Его можно использовать для получения оценки работ для каждого раздела.
* Поддерживает Microsoft.Azure.DocumentDB SDK 2.0. Требуется Microsoft.Azure.DocumentDB 2.0 или более поздней версии.

### <a name="206"></a><a name="2.0.6"/>2.0.6
* Добавлено общедоступное свойство ChangeEventHost.HostName для совместимости с версией 1.

### <a name="205"></a><a name="2.0.5"/>2.0.5
* Исправлено состояние гонки, которое возникло во время разделения секций. Состояние гонки может привести к получению аренды и немедленной потере права на нее при разделении секций, а также привести к состязанию. Проблема с состоянием гонки исправлена в этом выпуске.

### <a name="204"></a><a name="2.0.4"/>2.0.4
* Пакет SDK общей доступности.

### <a name="203-prerelease"></a><a name="2.0.3-prerelease"/>2.0.3-prerelease
* Исправлены следующие ошибки:
  * При разделении секции может дублироваться обработка документов, созданных до разделения.
  * API GetEstimatedRemainingWork возвратил 0 при отсутствии аренды в коллекции.

* Приведенные ниже исключения сделаны общедоступными. Расширения, реализующие IPartitionProcessor, могут выдавать эти исключения.
  * Microsoft.Azure.Documents.ChangeFeedProcessor.Exceptions.LeaseLostException. 
  * Microsoft.Azure.Documents.ChangeFeedProcessor.Exceptions.PartitionException. 
  * Microsoft.Azure.Documents.ChangeFeedProcessor.Exceptions.PartitionNotFoundException.
  * Microsoft.Azure.Documents.ChangeFeedProcessor.Exceptions.PartitionSplitException. 

### <a name="202-prerelease"></a><a name="2.0.2-prerelease"/>Предварительный выпуск 2.0.2:
* Незначительные изменения в API:
  * Удаление ChangeFeedProcessorOptions.IsAutoCheckpointEnabled как устаревшего.

### <a name="201-prerelease"></a><a name="2.0.1-prerelease"/>2.0.1-prerelease
* Улучшения стабильности:
  * Улучшение обработки при инициализации хранилища аренды. Если хранилище аренды пустое, инициализировать его может только один экземпляр обработчика. Остальные будут находиться в состоянии ожидания.
  * Более стабильное и эффективное обновление и освобождение аренды. Обновление и освобождение аренды одной секции не зависит от обновления других. В версии 1 процедура последовательно выполнялась для всех секций.
* Новый API версии 2:
  * Шаблон построителя для повышения гибкости при создании процессора: класс ChangeFeedProcessorBuilder.
    * Может принимать любое сочетание параметров.
    * Может принимать экземпляр DocumentClient для мониторинга и (или) коллекции аренды (недоступно в версии 1).
  * IChangeFeedObserver.ProcessChangesAsync теперь принимает CancellationToken.
  * IRemainingWorkEstimator — средство оценки оставшихся трудозатрат можно использовать отдельно от процессора.
  * Новые точки расширяемости:
    * IPartitionLoadBalancingStrategy — для пользовательской балансировки нагрузки в секциях между экземплярами процессора.
    * ILease, ILeaseManager — для пользовательского управления арендой.
    * IPartitionProcessor — для пользовательского обработки изменений в секции.
* Для ведения журнала используется библиотека [LibLog](https://github.com/damianh/LibLog).
* Полная обратная совместимость с API версии 1.
* Новая база кода.
* Совместимость с [пакетом SDK .NET для SQL](sql-api-sdk-dotnet.md) версии 1.21.1 и выше.

### <a name="v1-builds"></a>Сборки версии 1

### <a name="133"></a><a name="1.3.3"/>1.3.3
* В журнал записываются дополнительные сведения.
* Исправлена утечка DocumentClient при неоднократном вызове оценки работы в режиме ожидания.

### <a name="132"></a><a name="1.3.2"/>1.3.2
* Исправления в оценке работы в режиме ожидания.

### <a name="131"></a><a name="1.3.1"/>1.3.1
* Улучшение стабильности.
  * Исправление для обработки отмененных задач, что может привести к прекращению наблюдателей на некоторых разделах.
* Поддержка использования контрольных точек вручную.
* Совместимость с [пакетом SDK .NET для SQL](sql-api-sdk-dotnet.md) версии 1.21 и выше.

### <a name="120"></a><a name="1.2.0"/>1.2.0
* Добавляет поддержку .NET Standard 2.0. Теперь пакет поддерживает моникеры платформ `netstandard2.0` и `net451`.
* Совместимость с [пакетом SDK для .NET для SQL](sql-api-sdk-dotnet.md) версии 1.17.0 и более поздних версий.
* Совместимость с [пакетом SDK для .NET Core для SQL](sql-api-sdk-dotnet-core.md) версии 1.5.1 и более поздних версий.

### <a name="111"></a><a name="1.1.1"/>1.1.1
* Устраняет проблему при расчете оставшейся работы, если канал изменений был пуст или никакие действия не ожидались.
* Совместимость с [пакетом SDK для .NET для SQL](sql-api-sdk-dotnet.md) версии 1.13.2 и более поздних версий.

### <a name="110"></a><a name="1.1.0"/>1.1.0
* Добавлен метод для оценки оставшейся работы для обработки в веб-канале изменений.
* Совместимость с [пакетом SDK для .NET для SQL](sql-api-sdk-dotnet.md) версии 1.13.2 и более поздних версий.

### <a name="100"></a><a name="1.0.0"/>1.0.0
* Пакет SDK общей доступности.
* Совместимость с [пакетом SDK для .NET для SQL](sql-api-sdk-dotnet.md) версии 1.14.1 и более ранних версий.

## <a name="release--retirement-dates"></a>Даты выпуска и выбытия

Корпорация Майкрософт отправит уведомление минимум за **12 месяцев** до вывода пакета SDK из эксплуатации, чтобы обеспечить более плавный переход на новую или поддерживаемую версию.

Новые функции, возможности и оптимизации добавляются только в текущую версию пакета SDK, поэтому рекомендуется как можно раньше обновлять пакет SDK до последней версии. 

Любые запросы к Cosmos DB с помощью выведенного из эксплуатации пакета SDK будут отклонены службой.

<br/>

| Версия | Дата выпуска | Дата вывода |
| --- | --- | --- |
| [2.2.8](#2.2.8) |28 октября 2019 года |--- |
| [2.2.7](#2.2.7) |14 мая 2019 г. |--- |
| [2.2.6](#2.2.6) |29 января 2019 г. |--- |
| [2.2.5](#2.2.5) |13 декабря 2018 г. |--- |
| [2.2.4](#2.2.4) |29 ноября 2018 г. |--- |
| [2.2.3](#2.2.3) |19 ноября 2018 г. |--- |
| [2.2.2](#2.2.2) |31 октября 2018 г. |--- |
| [2.2.1](#2.2.1) |24 октября 2018 г. |--- |
| [1.3.3](#1.3.3) |8 мая 2018 г. |--- |
| [1.3.2](#1.3.2) |18 апреля 2018 г. |--- |
| [1.3.1](#1.3.1) |13 марта 2018 г. |--- |
| [1.2.0](#1.2.0) |31 октября 2017 г. |--- |
| [1.1.1](#1.1.1) |29 августа 2017 г. |--- |
| [1.1.0](#1.1.0) |13 августа 2017 г. |--- |
| [1.0.0](#1.0.0) |7 июля 2017 г. |--- |

## <a name="faq"></a>часто задаваемые вопросы

[!INCLUDE [cosmos-db-sdk-faq](../../includes/cosmos-db-sdk-faq.md)]

## <a name="see-also"></a>См. также

Дополнительные сведения о Cosmos DB см. на странице службы [Microsoft Azure Cosmos DB](https://azure.microsoft.com/services/cosmos-db/).
