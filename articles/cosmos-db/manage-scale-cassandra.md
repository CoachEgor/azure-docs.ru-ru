---
title: Эластичное масштабирование с помощью API Cassandra в Azure Cosmos DB
description: Узнайте о параметрах, доступных для масштабирования учетной записи API Cassandra Azure Cosmos DB и их преимуществах и недостатках.
author: TheovanKraay
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 01/13/2020
ms.author: thvankra
ms.openlocfilehash: 94cdeff36553268d691fc968036c5264e77fddc2
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "82188813"
---
# <a name="elastically-scale-an-azure-cosmos-db-cassandra-api-account"></a>Эластичное масштабирование учетной записи API Cassandra Azure Cosmos DB

Существует множество вариантов для изучения эластичной природы Azure Cosmos DB API для Cassandra. Чтобы понять, как эффективно масштабироваться в Azure Cosmos DB, важно понять, как подготавливать правильный объем единиц запросов (штук в секунду) для учета требований к производительности в системе. Дополнительные сведения о единицах запросов см. в статье [единицы запросов](request-units.md) . 

Для API Cassandra можно получить плату за единицу запроса для отдельных запросов с помощью [пакетов SDK для .NET и Java](https://docs.microsoft.com/azure/cosmos-db/find-request-unit-charge#cassandra-api). Это полезно для определения объема единиц запросов, которые необходимо выполнить в службе.

![Операции с базой данных потребляют единицы запроса](./media/request-units/request-units.png)

## <a name="handling-rate-limiting-429-errors"></a>Ограничение частоты обработки (429 ошибок)

Azure Cosmos DB возвращают ошибки с частотой (429), если клиенты потребляют больше ресурсов (единиц запросов в секунду), чем подготовлено. API Cassandra в Azure Cosmos DB преобразует эти исключения в ошибки перегрузки в собственном протоколе Cassandra. 

Если система не чувствительна к задержке, может быть достаточно для обработки ограничения скорости пропускной способности с помощью повторных попыток. См. [пример кода Java](https://github.com/Azure-Samples/azure-cosmos-cassandra-java-retry-sample) для прозрачного управления ограничением скорости с помощью [расширения Azure Cosmos DB](https://github.com/Azure/azure-cosmos-cassandra-extensions) для [политики повтора Cassandra](https://docs.datastax.com/en/developer/java-driver/4.4/manual/core/retries/) в Java. Для обработки ограничения скорости можно также использовать [расширение Spark](https://mvnrepository.com/artifact/com.microsoft.azure.cosmosdb/azure-cosmos-cassandra-spark-helper) .

## <a name="manage-scaling"></a>Управление масштабированием

Если необходимо уменьшить задержку, существует ряд вариантов для управления пропускной способностью масштабирования и подготовки (RUs) в API Cassandra.

* [Вручную с помощью портал Azure](#use-azure-portal)
* [Программно с помощью функций плоскости управления](#use-control-plane)
* [Программно с помощью команд CQL с конкретным пакетом SDK](#use-cql-queries)
* [Динамически с помощью автомасштабирования](#use-autoscale)

В следующих разделах объясняются преимущества и недостатки каждого из подходов. Затем можно выбрать оптимальную стратегию для балансировки потребностей в масштабировании системы, общей стоимости и эффективности решения.

## <a name="use-the-azure-portal"></a><a id="use-azure-portal"></a>Использование портала Azure

Вы можете масштабировать ресурсы в учетной записи Azure Cosmos DB API Cassandra с помощью портал Azure. Дополнительные сведения см. в статье о [подготовке пропускной способности для контейнеров и баз данных](set-throughput.md). В этой статье объясняются относительные преимущества настройки пропускной способности на уровне [базы данных](set-throughput.md#set-throughput-on-a-database) или [контейнера](set-throughput.md#set-throughput-on-a-container) в портал Azure. Термины "база данных" и "контейнер", упомянутые в этих статьях, сопоставляются с "пространства ключей" и "Table" соответственно для API Cassandra.

Преимущество этого метода заключается в том, что он является прямым готовым способом управления пропускной способностью в базе данных. Однако недостаток заключается в том, что во многих случаях подход к масштабированию может потребовать, чтобы определенные уровни автоматизации были экономичными и высокопроизводительными. В следующих разделах объясняются соответствующие сценарии и методы.

## <a name="use-the-control-plane"></a><a id="use-control-plane"></a>Использование плоскости управления

API Azure Cosmos DB для Cassandra обеспечивает возможность программной настройки пропускной способности с помощью наших различных функций плоскости управления. Инструкции и примеры см. в статьях [Azure Resource Manager](manage-cassandra-with-resource-manager.md), [PowerShell](powershell-samples-cassandra.md)и [Azure CLI](cli-samples-cassandra.md) .

Преимущество этого метода заключается в том, что вы можете автоматизировать масштабирование ресурсов на основе таймера, чтобы учитывать пиковые действия или периоды низкой активности. Ознакомьтесь с [нашим образцом](https://github.com/Azure-Samples/azure-cosmos-throughput-scheduler) , чтобы сделать это с помощью функций Azure и PowerShell.

Недостатком такого подхода может быть невозможность реагирования на непредсказуемые изменяющиеся потребности масштабирования в режиме реального времени. Вместо этого может потребоваться использовать контекст приложения в системе, на уровне клиента или пакета SDK или с помощью [автомасштабирования](provision-throughput-autoscale.md).

## <a name="use-cql-queries-with-a-specific-sdk"></a><a id="use-cql-queries"></a>Использование запросов CQL с конкретным пакетом SDK

Можно динамически масштабировать систему с помощью кода, выполняя [команды CQL ALTER](cassandra-support.md#keyspace-and-table-options) для заданной базы данных или контейнера.

Преимущество такого подхода заключается в том, что он позволяет вам отвечать на запросы масштабирования динамически и в пользовательском способе, который подходит для вашего приложения. При таком подходе вы по-прежнему можете использовать стандартную плату за ЕДИНИЦу/с и тариф. Если требования к масштабированию системы в основном являются прогнозируемыми (около 70% или более), использование пакета SDK с CQL может оказаться более экономичным методом автоматического масштабирования по сравнению с использованием автомасштабирования. Недостаток этого подхода заключается в том, что реализация повторных попыток может быть довольно сложной, а ограничение скорости может увеличить задержку.

## <a name="use-autoscale"></a><a id="use-autoscale"></a>Использование автомасштабирования

Кроме ручного или программного способа подготовки пропускной способности, можно также настроить контейнеры Azure Cosmos в режиме автомасштабирования. Режим автомасштабирования автоматически и мгновенно масштабируется в соответствии с потребностями в пределах диапазона единиц запросов, не нарушая соглашения об уровне обслуживания. Дополнительные сведения см. в статье [Создание контейнеров и баз данных Azure Cosmos в режиме автомасштабирования](provision-throughput-autoscale.md) .

Преимущество такого подхода заключается в том, что это самый простой способ управления потребностями масштабирования в системе. Он гарантирует не применять ограничение скорости **в пределах настроенных диапазонов единиц**. Недостатком является то, что, если потребности масштабирования в системе предсказуемы, автомасштабирование может оказаться менее экономичным способом обработки потребностей масштабирования, чем с помощью линейной плоскости управления или описанных выше подходов к уровню пакета SDK.

## <a name="next-steps"></a>Дальнейшие действия

- Начните с [создания учетной записи API Cassandra, базы данных и таблицы](create-cassandra-api-account-java.md) с помощью приложения Java.
