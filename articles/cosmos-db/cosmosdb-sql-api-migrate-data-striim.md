---
title: Перенос данных на aPI-аккаунт Azure Cosmos DB S'L с помощью Striim
description: Узнайте, как использовать Striim для переноса данных из базы данных Oracle в учетную запись API Azure Cosmos DB S'L.
author: SnehaGunda
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 07/22/2019
ms.author: sngun
ms.reviewer: sngun
ms.openlocfilehash: 36ba9e2d3385184f32876a6d067b58f7c21a90bd
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "71003285"
---
# <a name="migrate-data-to-azure-cosmos-db-sql-api-account-using-striim"></a>Перенос данных на aPI-аккаунт Azure Cosmos DB S'L с помощью Striim
 
Изображение Striim на рынке Azure обеспечивает непрерывное перемещение данных в режиме реального времени от складов данных и баз данных к Azure. При перемещении данных можно выполнять в режиме строки денормализации, преобразования данных, включить аналитику в режиме реального времени, и сценарии отчетности данных. С Striim легко начать постоянно перемещать корпоративные данные на API Azure Cosmos DB S'L. Azure предоставляет предложение на рынке, которое упрощает развертывание Striim и перенос данных в DB Azure Cosmos. 

В этой статье показано, как использовать Striim для переноса данных из **базы данных Oracle** в **учетную запись Azure Cosmos DB S'L API.**

## <a name="prerequisites"></a>Предварительные требования

* Если у вас нет [подписки Azure,](/azure/guides/developer/azure-developer-guide#understanding-accounts-subscriptions-and-billing)создайте [бесплатную учетную запись](https://azure.microsoft.com/free/?ref=microsoft.com&utm_source=microsoft.com&utm_medium=docs&utm_campaign=visualstudio) перед началом.

* База данных Oracle работает на месте с некоторыми данными в нем.

## <a name="deploy-the-striim-marketplace-solution"></a>Развертывание решения для рынка Striim

1. Войти на [портал Azure](https://portal.azure.com/).

1. Выберите **Создать ресурс** и поиск **Striim** на рынке Azure. Выберите первый вариант и **создайте**.

   ![Найти предмет рынка Striim](./media/cosmosdb-sql-api-migrate-data-striim/striim-azure-marketplace.png)

1. Затем введите свойства конфигурации экземпляра Striim. Среда Striim развернута в виртуальной машине. С панели **Basics** введите **имя пользователя VM,** **пароль VM** (этот пароль используется для SSH в VM). Выберите **информацию о подписке,** **ресурсной группе**и **местоположении,** где вы хотите развернуть Striim. После завершения, выберите **OK**.

   ![Настройка базовых настроек для Striim](./media/cosmosdb-sql-api-migrate-data-striim/striim-configure-basic-settings.png)

1. В **панели настроек Striim Cluster** выберите тип развертывания Striim и размер виртуальной машины.

   |Параметр | Значение | Описание |
   | ---| ---| ---|
   |Тип развертывания Striim |Автономный | Striim может работать в типах **развертывания Standalone** или **Cluster.** Автономный режим развернет сервер Striim на одной виртуальной машине, и вы можете выбрать размер виртуальных машин в зависимости от объема данных. Режим кластера развернет сервер Striim на двух или более вс-мизантах с выбранным размером. Кластерные среды с более чем 2 узлами обеспечивают автоматическую высокую доступность и сбой.</br></br> В этом уроке вы можете выбрать вариант Standalone. Используйте по умолчанию "Standard_F4s" размер VM.  | 
   | Название стилийского кластера|    <Striim_cluster_Name>|  Название стилийского кластера.|
   | Кластерный пароль Striim|   <Striim_cluster_password>|  Пароль для кластера.|

   После заполнения формы выберите **OK** для продолжения.

1. В **настройках доступа Striim панель,** настроить **общественный IP-адрес** (выбрать значения по умолчанию), **доменное имя для Striim**, **пароль админа,** который вы хотели бы использовать для входа в Striim UI. Нанастройка VNET и Subnet (выберите значения по умолчанию). После заполнения деталей, выберите **OK,** чтобы продолжить.

   ![Настройки доступа Striim](./media/cosmosdb-sql-api-migrate-data-striim/striim-access-settings.png)

1. Azure проверит развертывание и убедится, что все выглядит хорошо; проверка занимает несколько минут. После завершения проверки выберите **OK**.
  
1. Наконец, просмотрите условия использования и выберите **Создать** для создания экземпляра Striim. 

## <a name="configure-the-source-database"></a>Настройка исходной базы данных 

В этом разделе вы настраиваете базу данных Oracle в качестве источника для передачи данных.  Для подключения к Oracle вам понадобится [драйвер Oracle JDBC.](https://www.oracle.com/technetwork/database/features/jdbc/jdbc-ucp-122-3110062.html) Чтобы прочитать изменения из исходной базы данных Oracle, вы можете использовать [LogMiner](https://www.oracle.com/technetwork/database/features/availability/logmineroverview-088844.html) или [AIS XStream.](https://docs.oracle.com/cd/E11882_01/server.112/e16545/xstrm_intro.htm#XSTRM72647) Драйвер Oracle JDBC должен присутствовать в Java-классе Striim для чтения, записи или сохранения данных из базы данных Oracle.

Скачать драйвер [ojdbc8.jar](https://www.oracle.com/technetwork/database/features/jdbc/jdbc-ucp-122-3110062.html) на локальной машине. Вы установите его в кластере Striim позже.

## <a name="configure-the-target-database"></a>Настройка целевой базы данных

В этом разделе вы наверстируете учетную запись Azure Cosmos DB S'L API в качестве цели для движения данных.

1. Создайте [учетную запись API Azure Cosmos DB S'L](create-cosmosdb-resources-portal.md) с помощью портала Azure.

1. Перейдите к панели **Data Explorer** в учетной записи Azure Cosmos. Выберите **новый контейнер** для создания нового контейнера. Предположим, что вы мигрируете *продукты* и *заказываете* данные из базы данных Oracle в Azure Cosmos DB. Создайте новую базу данных под названием **StriimDemo** с контейнером под названием **Заказы.** Предоставление контейнера с **1000 RUs** (этот пример использует 1000 RUs, но вы должны использовать пропускную емкость, оцененную для вашей рабочей нагрузки), и **/ORDER_ID** в качестве ключа раздела. Эти значения будут отличаться в зависимости от исходных данных. 

   ![Создание учетной записи API SQL](./media/cosmosdb-sql-api-migrate-data-striim/create-sql-api-account.png)

## <a name="configure-oracle-to-azure-cosmos-db-data-flow"></a>Настройка Oracle в поток данных Azure Cosmos DB

1. Теперь вернемся к Стрийму. Прежде чем взаимодействовать со Striim, установите драйвер Oracle JDBC, который вы скачали ранее.

1. Перейдите к экземпляру Striim, развернутому на портале Azure. Выберите кнопку **«Подключение»** в верхней панели меню и на вкладке **SSH,** скопируйте URL в **Login с помощью локального поля учетной записи VM.**

   ![Получить URL-адрес SSH](./media/cosmosdb-sql-api-migrate-data-striim/get-ssh-url.png)

1. Откройте новое окно терминала и запустите команду SSH, скопированную с портала Azure. В этой статье используется терминал в MacOS, вы можете следовать аналогичным инструкциям с помощью PuTTY или другого клиента SSH на машине Windows. Когда попросят, введите **да,** чтобы продолжить и ввести **пароль,** который вы установили для виртуальной машины на предыдущем этапе.

   ![Подключение к Striim VM](./media/cosmosdb-sql-api-migrate-data-striim/striim-vm-connect.png)

1. Теперь откройте новую вкладку терминала, чтобы скопировать файл **ojdbc8.jar,** который вы загрузили ранее. Используйте следующую команду SCP, чтобы скопировать файл банки из локальной машины в папку tmp экземпляра Striim, работающего в Azure:

   ```bash
   cd <Directory_path_where_the_Jar_file_exists> 
   scp ojdbc8.jar striimdemo@striimdemo.westus.cloudapp.azure.com:/tmp
   ```

   ![Копирование файла Jar от машины местоположения к Striim](./media/cosmosdb-sql-api-migrate-data-striim/copy-jar-file.png)

1. Затем перейдите обратно в окно, где вы сделали SSH в экземплярs Striim и Логин как судо. Переместите файл **ojdbc8.jar** из **каталога /tmp** в каталог **lib** вашего экземпляра Striim со следующими командами:

   ```bash
   sudo su
   cd /tmp
   mv ojdbc8.jar /opt/striim/lib
   chmod +x ojdbc8.jar
   ```

   ![Переместите файл Jar в папку lib](./media/cosmosdb-sql-api-migrate-data-striim/move-jar-file.png)


1. Из того же окна терминала перезапустите сервер Striim, выполняя следующие команды:

   ```bash
   Systemctl stop striim-node
   Systemctl stop striim-dbms
   Systemctl start striim-dbms
   Systemctl start striim-node
   ```
 
1. Стрейим займет минуту, чтобы начать. Если вы хотите увидеть статус, запустите следующую команду: 

   ```bash
   tail -f /opt/striim/logs/striim-node.log
   ```

1. Теперь перейдите в Azure и скопируйте общедоступный IP-адрес вашего Striim VM. 

   ![Копия IP-адреса Striim VM](./media/cosmosdb-sql-api-migrate-data-striim/copy-public-ip-address.png)

1. Чтобы перейти к веб-интерфейсу Striim, откройте новую вкладку в браузере и скопируйте общедоступный IP, за которым следует: 9080. Восвай, используя имя пользователя **admin,** вместе с паролем админ, указанным на портале Azure.

   ![Войти на Стмим](./media/cosmosdb-sql-api-migrate-data-striim/striim-login-ui.png)

1. Теперь вы прибудете на домашнюю страницу Стриима. Есть три различных панелей - **панели мониторинга**, **приложения**, и **SourcePreview**. Панель dashboards позволяет перемещать данные в режиме реального времени и визуализировать их. Панель приложений содержит потоки потоков потоков потоков потоков потоков потоков потоков потоковой передачи данных. Справа от страницы находится SourcePreview, где вы можете просмотреть данные, прежде чем перемещать их.

1. Выберите панель **приложений,** мы сосредоточимся на этом панели на данный момент. Есть целый ряд примеров приложений, которые можно использовать, чтобы узнать о Striim, однако в этой статье вы будете создавать наши собственные. Выберите кнопку **Добавить app** в верхнем правом углу.

   ![Добавить приложение Striim](./media/cosmosdb-sql-api-migrate-data-striim/add-striim-app.png)

1. Существует несколько различных способов создания приложений Striim. Выберите **«Начни с шаблона»,** чтобы начать с существующего шаблона.

   ![Запустите приложение с шаблоном](./media/cosmosdb-sql-api-migrate-data-striim/start-with-template.png)

1. В поле **шаблонов поиска** введите "Космос" и выберите **Target: Azure Cosmos DB,** а затем выберите **Oracle CDC для Azure Cosmos DB.**

   ![Выберите Oracle CDC для Cosmos DB](./media/cosmosdb-sql-api-migrate-data-striim/oracle-cdc-cosmosdb.png)

1. На следующей странице назовите приложение. Вы можете предоставить имя, такое как **oraToCosmosDB,** а затем выбрать **Сохранить**.

1. Затем введите исходную конфигурацию исходного экземпляра Oracle. Введите значение для **имени источника.** Название источника является лишь именования конвенции для приложения Striim, вы можете использовать что-то вроде **src_onPremOracle**. Введите значения для остальной части **URL-адреса**параметров источника, **Имя пользователя,** **Пароль**, выберите **LogMiner** в качестве читателя для чтения данных от Oracle. Нажмите кнопку **Далее**, чтобы продолжить.

   ![Настройка параметров источника](./media/cosmosdb-sql-api-migrate-data-striim/configure-source-parameters.png)

1. Striim проверит вашу среду и убедится, что она может подключиться к исходутому экземпляру Oracle, иметь правильные привилегии, и что CDC был настроен должным образом. После проверки всех значений выберите **следующий**.

   ![Проверка параметров источника](./media/cosmosdb-sql-api-migrate-data-striim/validate-source-parameters.png)

1. Выберите таблицы из базы данных Oracle, которые вы хотели бы перенести. Например, давайте выберем таблицу заказов и выберем **следующий**. 

   ![Выбор исходных таблиц](./media/cosmosdb-sql-api-migrate-data-striim/select-source-tables.png)

1. После выбора исходной таблицы можно выполнять более сложные операции, такие как отображение и фильтрация. В этом случае вы просто создадите копию исходной таблицы в Azure Cosmos DB. Таким образом, выберите **Далее** для настройки цели

1. Теперь давайте настановим цель:

   * **Целевое имя** - Предоставьте дружественное имя для цели. 
   * **Вход From** - Из списка выпадающих данных выберите поток ввода из того, который вы создали в конфигурации исходного Oracle. 
   * **Коллекции**- Введите целевые свойства конфигурации Конфигурации Azure Cosmos DB. Коллекции синтаксис **АСВ SourceChema.SourceTable, TargetDatabase.TargetContainer**. В этом примере значение будет "SYSTEM. ORDERS, StriimDemo.Orders". 
   * **AccessKey** - PrimaryKey вашей учетной записи Azure Cosmos.
   * **ServiceEndpoint** - URI вашей учетной записи Azure Cosmos, они можно найти в разделе **Ключи** портала Azure. 

   Выберите **Сохранить** и **далее**.

   ![Настройка параметров цели](./media/cosmosdb-sql-api-migrate-data-striim/configure-target-parameters.png)


1. Далее вы прибудете к конструктору потока, где вы можете перетащить и выпасть из разъемов коробки для создания потоковых приложений. Вы не будете вносить какие-либо изменения в поток в этой точке. так что идите вперед и развернуть приложение, выбрав кнопку **Deploy App.**
 
   ![Развертывание приложения](./media/cosmosdb-sql-api-migrate-data-striim/deploy-app.png)

1. В окне развертывания можно указать, хотите ли выполнить определенные части приложения на определенных частях топологии развертывания. Поскольку мы работаем в простой топологии развертывания через Azure, мы будем использовать опцию по умолчанию.

   ![Используйте опцию по умолчанию](./media/cosmosdb-sql-api-migrate-data-striim/deploy-using-default-option.png)

1. После развертывания можно просмотреть поток, чтобы увидеть данные, протекающие через. Выберите значок **волны** и глазное яблоко рядом с ним. Выберите кнопку **«Развертывание»** в верхней панели меню и выберите **start App.**

   ![Запуск приложения](./media/cosmosdb-sql-api-migrate-data-striim/start-app.png)

1. С помощью считывателя **CDC (Change Data Capture)** Striim будет подбирать только новые изменения в базе данных. Если данные протекают через исходные таблицы, вы их увидите. Однако, поскольку это демо-таблица, источник не подключен ни к какому приложению. Если вы используете генератор выборочных данных, вы можете вставить цепочку событий в базу данных Oracle.

1. Вы увидите данные, протекающие через платформу Striim. Striim также подбирает все метаданные, связанные с таблицей, что полезно для мониторинга данных и защиты прав данных.

   ![Настройка конвейера CDC](./media/cosmosdb-sql-api-migrate-data-striim/configure-cdc-pipeline.png)

1. Наконец, давайте ввешемся в Azure и перейдем к учетной записи Azure Cosmos. Обновите исследователь данных, и вы можете видеть, что данные поступили.  

   ![Проверка миграционных данных в Azure](./media/cosmosdb-sql-api-migrate-data-striim/portal-validate-results.png)

Используя решение Striim в Azure, вы можете непрерывно переносить данные в Azure Cosmos DB из различных источников, таких как Oracle, Cassandra, MongoDB, и различные другие в Azure Cosmos DB. Чтобы узнать больше, пожалуйста, посетите [веб-сайт Striim](https://www.striim.com/), [скачать бесплатную 30-дневную пробную версию Striim](https://go2.striim.com/download-free-trial), и для любых вопросов при настройке пути миграции со Striim, файл [запрос на поддержку.](https://go2.striim.com/request-support-striim)

## <a name="next-steps"></a>Дальнейшие действия

* Если вы переносите данные на API Azure Cosmos DB S'L, узнайте, как перенести данные в [учетную запись Cassandra API с помощью Striim](cosmosdb-cassandra-api-migrate-data-striim.md)

* [Мониторинг и отладка данных с помощью метрик Azure Cosmos DB](use-metrics.md)
