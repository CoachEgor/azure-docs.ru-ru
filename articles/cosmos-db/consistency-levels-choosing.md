---
title: Выберите правильный уровень согласованности для приложения Azure Cosmos DB
description: Выбор правильного уровня согласованности для приложения в Azure Cosmos DB.
author: markjbrown
ms.author: mjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 07/23/2019
ms.reviewer: sngun
ms.openlocfilehash: cea157e272a2bf464141e592b8e742f314a83233
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75441924"
---
# <a name="choose-the-right-consistency-level"></a>Выбор правильного уровня согласованности 

Репликация распределенных баз данных для обеспечения высокого уровня их доступности и небольшой задержки предполагает компромисс между согласованностью чтения и такими параметрами, как доступность, время задержки и пропускная способность. Большинство коммерчески доступных распределенных баз данных просят разработчиков выбирать между двумя крайними моделями согласованности: *сильной* согласованностью и *возможной* согласованностью. Azure Cosmos DB позволяет разработчикам выбирать среди пяти четко определенных моделей согласованности: *сильная,* *ограниченная черствость,* *сессия,* *последовательная префикс* и *в конечном итоге*. Каждая из этих моделей согласованности четко определена, интуитивно понятна и может использоваться для конкретных реальных сценариев. Каждая из пяти моделей согласованности обеспечивает точную [доступность и производительность компромиссов](consistency-levels-tradeoffs.md) и опирается на комплексные SLAs. Приведенные ниже простые рекомендации помогут вам сделать правильный выбор для большинства распространенных сценариев.

## <a name="sql-api-and-table-api"></a>API SQL или API таблиц

Рассмотрим следующие моменты, если ваше приложение построено с помощью API или API таблицы:

- Для многих сценариев из реальной жизни оптимальным и рекомендуемым вариантом является согласованность на уровне сеанса. Для получения дополнительной [How-to manage session token for your application](how-to-manage-consistency.md#utilize-session-tokens)информации см.

- Если вашему приложению необходима строгая согласованность, рекомендуем использовать уровень согласованности "Ограниченное устаревание".

- Если вам нужны более строгие гарантии согласованности, нежели предоставляемые согласованностью на уровне сеанса, и низкие задержки (не более десяти миллисекунд) для операций записи, рекомендуем использовать уровень согласованности "Ограниченное устаревание".  

- Если приложению необходима итоговая согласованность, рекомендуем использовать уровень согласованности с постоянным префиксом.

- Если необходимы менее строгие гарантии согласованности, нежели предоставляемые согласованностью на уровне сеанса, рекомендуем использовать уровень согласованности с постоянным префиксом.

- Если вам нужна самая высокая доступность и самая низкая задержка, используйте возможный уровень согласованности.

- Если вам нужно обеспечить более высокую устойчивость данных не в ущерб производительности, можно создать уровень согласованности на уровне приложения. См. дополнительные сведения о [реализации настраиваемой синхронизации в приложениях](how-to-custom-synchronization.md).

## <a name="cassandra-mongodb-and-gremlin-apis"></a>Кассандра, MongoDB, и Гремлин AIS

- Дополнительные сведения о сопоставлении между уровнем согласованности чтения Apache Cassandra и уровнями согласованности Cosmos DB см. [здесь](consistency-levels-across-apis.md#cassandra-mapping).

- Дополнительные сведения о сопоставлении между уровнем операций чтения MongoDB и уровнями согласованности Cosmos DB см. в [этом разделе](consistency-levels-across-apis.md#mongo-mapping).

## <a name="consistency-guarantees-in-practice"></a>Гарантии согласованности на практике

На практике, вы часто можете получить более сильные гарантии согласованности. Гарантии согласованности для операции чтения соответствуют актуальности и упорядочению состояния запрашиваемой базы данных. Согласованность чтения связана с упорядочением и распространением операций записи или обновления.  

* Если установлен уровень согласованности **Ограниченное устаревание**, Cosmos DB гарантирует, что клиенты всегда считывают значения предыдущей записи с задержкой, ограниченной окном устаревания.

* Если установлен **строгий** уровень согласованности, окно устаревания равно нулю, и клиенты гарантировано считают последнее зафиксированное значение операции записи.

* На остальных трех уровнях согласованности окно устаревания в значительной степени зависит от рабочей нагрузки. Например, если в базе данных нет записей, операция чтения с **итоговой** согласованностью, согласованностью на уровне **сеанса** или согласованностью с **постоянным префиксом**, скорее всего, даст те же результаты, что и операция чтения со строгим уровнем согласованности.

Если ваша учетная запись Azure Cosmos настроена с уровнем согласованности, кроме сильной согласованности, вы можете узнать вероятность того, что ваши клиенты могут получить сильные и последовательные считываемые для ваших рабочих нагрузок, взглянув на метрика *Probabilistically Bounded Staleness* (PBS). Эта метрика предоставляется на портале Azure. Дополнительные сведения см. в разделе [Мониторинг метрики вероятностного ограниченного устаревания (PBS)](how-to-manage-consistency.md#monitor-probabilistically-bounded-staleness-pbs-metric).

Вероятностное ограниченное устаревание показывает степень итоговой согласованности. Эта метрика позволяет получить представление о том, как часто вы можете получить более сильную согласованность, чем уровень согласованности, который вы в настоящее время настроены на учетную запись Azure Cosmos. Другими словами, вы можете увидеть вероятность (в миллисекундах) выполнения строго согласованных операций чтения для комбинации регионов записи и чтения.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об уровнях согласованности см. по следующим ссылкам:

* [Согласование уровней согласованности в API Cosmos DB](consistency-levels-across-apis.md)
* [Достижение компромисса между доступностью и быстродействием для разных уровней согласованности](consistency-levels-tradeoffs.md)
* [Управление токенами сеанса для приложения](how-to-manage-consistency.md#utilize-session-tokens)
* [Мониторинг метрики вероятностного ограниченного устаревания (PBS)](how-to-manage-consistency.md#monitor-probabilistically-bounded-staleness-pbs-metric)
