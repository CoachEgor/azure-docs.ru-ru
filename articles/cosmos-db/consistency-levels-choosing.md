---
title: Выбор правильного уровня согласованности для приложения, использующего Azure Cosmos DB
description: Выбор правильного уровня согласованности для приложения в Azure Cosmos DB.
author: markjbrown
ms.author: mjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 05/22/2019
ms.reviewer: sngun
ms.openlocfilehash: b08f9a85b8c9f52724e2cd08eaf13eb1faae0977
ms.sourcegitcommit: 509e1583c3a3dde34c8090d2149d255cb92fe991
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/27/2019
ms.locfileid: "66243560"
---
# <a name="choose-the-right-consistency-level"></a>Выбор правильного уровня согласованности 

Репликация распределенных баз данных для обеспечения высокого уровня их доступности и небольшой задержки предполагает компромисс между согласованностью чтения и такими параметрами, как доступность, время задержки и пропускная способность. Большинство имеющихся на рынке распределенных баз данных спросить разработчиков выбирать между двумя моделями согласованности extreme: *строгого* согласованности и *итоговой* согласованности. Azure Cosmos DB позволяет разработчикам выбрать один из пяти четко определенных моделей согласованности: *строгого*, *ограниченное устаревание*, *сеанса*, *согласованность префикс* и *итоговой*. Каждая из этих моделей согласованности четко определена, интуитивно понятна и может использоваться для конкретных реальных сценариев. Каждый из пятью моделями согласованности обеспечивают точный [компромиссы, доступности и производительности](consistency-levels-tradeoffs.md) и обеспечиваются комплексные соглашения об уровне обслуживания. Приведенные ниже простые рекомендации помогут вам сделать правильный выбор для большинства распространенных сценариев.

## <a name="sql-api-and-table-api"></a>API SQL или API таблиц

Если приложение создано с помощью SQL API или API таблиц помните о следующем:

- Для многих сценариев из реальной жизни оптимальным и рекомендуемым вариантом является согласованность на уровне сеанса. Дополнительные сведения см. в разделе [Использование маркеров сеанса](how-to-manage-consistency.md#utilize-session-tokens).

- Если вашему приложению необходима строгая согласованность, рекомендуем использовать уровень согласованности "Ограниченное устаревание".

- Если вам нужны более строгие гарантии согласованности, нежели предоставляемые согласованностью на уровне сеанса, и низкие задержки (не более десяти миллисекунд) для операций записи, рекомендуем использовать уровень согласованности "Ограниченное устаревание".  

- Если приложению необходима итоговая согласованность, рекомендуем использовать уровень согласованности с постоянным префиксом.

- Если необходимы менее строгие гарантии согласованности, нежели предоставляемые согласованностью на уровне сеанса, рекомендуем использовать уровень согласованности с постоянным префиксом.

- Если вам требуется самого высокого уровня доступности и наименьшую задержку, используйте уровень согласованности в конечном счете.

- Если вам нужно обеспечить более высокую устойчивость данных не в ущерб производительности, можно создать уровень согласованности на уровне приложения. См. дополнительные сведения о [реализации настраиваемой синхронизации в приложениях](how-to-custom-synchronization.md).

## <a name="cassandra-mongodb-and-gremlin-apis"></a>Cassandra, MongoDB и API-интерфейсов Gremlin

- Дополнительные сведения о сопоставлении между уровнем согласованности чтения Apache Cassandra и уровнями согласованности Cosmos DB см. [здесь](consistency-levels-across-apis.md#cassandra-mapping).

- Дополнительные сведения о сопоставлении между уровнем операций чтения MongoDB и уровнями согласованности Cosmos DB см. в [этом разделе](consistency-levels-across-apis.md#mongo-mapping).

## <a name="consistency-guarantees-in-practice"></a>Гарантии согласованности на практике

На практике часто вы можете получить более строгие гарантии согласованности. Гарантии согласованности для операции чтения соответствуют актуальности и упорядочению состояния запрашиваемой базы данных. Согласованность чтения связана с упорядочением и распространением операций записи или обновления.  

* Если установлен уровень согласованности **Ограниченное устаревание**, Cosmos DB гарантирует, что клиенты всегда считывают значения предыдущей записи с задержкой, ограниченной окном устаревания.

* Если установлен **строгий** уровень согласованности, окно устаревания равно нулю, и клиенты гарантировано считают последнее зафиксированное значение операции записи.

* На остальных трех уровнях согласованности окно устаревания в значительной степени зависит от рабочей нагрузки. Например, если в базе данных нет записей, операция чтения с **итоговой** согласованностью, согласованностью на уровне **сеанса** или согласованностью с **постоянным префиксом**, скорее всего, даст те же результаты, что и операция чтения со строгим уровнем согласованности.

Если ваша учетная запись Azure Cosmos настроена с уровнем согласованности, отличные от строгой согласованности, вероятность того, что клиенты могут получить надежный и согласованных операций чтения для рабочих нагрузок можно найти, просмотрев *Probabilistically Ограниченное устаревание* метрики (PBS). Эта метрика предоставляется на портале Azure. Дополнительные сведения см. в разделе [Мониторинг метрики вероятностного ограниченного устаревания (PBS)](how-to-manage-consistency.md#monitor-probabilistically-bounded-staleness-pbs-metric).

Вероятностное ограниченное устаревание показывает степень итоговой согласованности. Эта метрика обеспечивает представление о том, как часто можно получить более строгим уровнем согласованности, чем уровень согласованности, который в данный момент вы настроили для учетной записи Azure Cosmos. Другими словами, вы можете увидеть вероятность (в миллисекундах) выполнения строго согласованных операций чтения для комбинации регионов записи и чтения.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об уровнях согласованности см. по следующим ссылкам:

* [Согласование уровней согласованности в API Cosmos DB](consistency-levels-across-apis.md)
* [Компромисс между доступностью и производительностью для различных уровней согласованности](consistency-levels-tradeoffs.md)
* [Управление токенами сеанса для приложения](how-to-manage-consistency.md#utilize-session-tokens)
* [Мониторинг метрики вероятностного ограниченного устаревания (PBS)](how-to-manage-consistency.md#monitor-probabilistically-bounded-staleness-pbs-metric)
