---
title: Выбор правильного уровня согласованности для приложения Azure Cosmos DB
description: Выбор правильного уровня согласованности для приложения в Azure Cosmos DB.
author: markjbrown
ms.author: mjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 04/23/2020
ms.reviewer: sngun
ms.openlocfilehash: aa8f2d14124e7cfc5db0025c295f9b38d96bf56c
ms.sourcegitcommit: dee7b84104741ddf74b660c3c0a291adf11ed349
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "85921841"
---
# <a name="choose-the-right-consistency-level"></a>Выбор правильного уровня согласованности 

Репликация распределенных баз данных для обеспечения высокого уровня их доступности и небольшой задержки предполагает компромисс между согласованностью чтения и такими параметрами, как доступность, время задержки и пропускная способность. Большинство коммерческих доступных распределенных баз данных запрашивают от разработчиков выбор между двумя экстремальными моделями согласованности: *строгая* согласованность и *Окончательная* согласованность. Azure Cosmos DB позволяет разработчикам выбрать одну из пяти четко определенных моделей согласованности: *строгая*, *ограниченная устаревания*, *сеанс*, *согласованный префикс* и, в *конечном итоге*,. Каждая из этих моделей согласованности четко определена, интуитивно понятна и может использоваться для конкретных реальных сценариев. Каждая из пяти моделей согласованности предоставляет точные [компромиссы по доступности и производительности](consistency-levels-tradeoffs.md) и обеспечивается комплексными соглашениями об уровне обслуживания. Можно настроить согласованность по умолчанию на уровне учетной записи и [переопределить ее на уровне запроса](how-to-manage-consistency.md#override-the-default-consistency-level). Приведенные ниже простые рекомендации помогут вам сделать правильный выбор для большинства распространенных сценариев.

## <a name="sql-api-and-table-api"></a>API SQL или API таблиц

Если приложение создано с помощью API SQL или API таблиц, учитывайте следующие моменты:

- Для многих сценариев из реальной жизни оптимальным и рекомендуемым вариантом является согласованность на уровне сеанса. Дополнительные сведения см. в разделе [как управлять маркером сеанса для приложения](how-to-manage-consistency.md#utilize-session-tokens).

- Если вашему приложению необходима строгая согласованность, рекомендуем использовать уровень согласованности "Ограниченное устаревание".

- Если вам нужны более строгие гарантии согласованности, нежели предоставляемые согласованностью на уровне сеанса, и низкие задержки (не более десяти миллисекунд) для операций записи, рекомендуем использовать уровень согласованности "Ограниченное устаревание".  

- Если приложению необходима итоговая согласованность, рекомендуем использовать уровень согласованности с постоянным префиксом.

- Если необходимы менее строгие гарантии согласованности, нежели предоставляемые согласованностью на уровне сеанса, рекомендуем использовать уровень согласованности с постоянным префиксом.

- Если требуется наибольшая доступность и наименьшая задержка, используйте окончательную степень согласованности.

- Если вам нужно обеспечить более высокую устойчивость данных не в ущерб производительности, можно создать уровень согласованности на уровне приложения. См. дополнительные сведения о [реализации настраиваемой синхронизации в приложениях](how-to-custom-synchronization.md).

## <a name="cassandra-mongodb-and-gremlin-apis"></a>API-интерфейсы Cassandra, MongoDB и Gremlin

- Дополнительные сведения о сопоставлении между уровнем согласованности чтения Apache Cassandra и уровнями согласованности Cosmos DB см. [здесь](consistency-levels-across-apis.md#cassandra-mapping).

- Дополнительные сведения о сопоставлении между уровнем операций чтения MongoDB и уровнями согласованности Cosmos DB см. в [этом разделе](consistency-levels-across-apis.md#mongo-mapping).

## <a name="consistency-guarantees-in-practice"></a>Гарантии согласованности на практике

На практике часто могут возникать более надежные гарантии согласованности. Гарантии согласованности для операции чтения соответствуют актуальности и упорядочению состояния запрашиваемой базы данных. Согласованность чтения связана с упорядочением и распространением операций записи или обновления.  

* Если установлен уровень согласованности **Ограниченное устаревание**, Cosmos DB гарантирует, что клиенты всегда считывают значения предыдущей записи с задержкой, ограниченной окном устаревания.

* Если установлен **строгий** уровень согласованности, окно устаревания равно нулю, и клиенты гарантировано считают последнее зафиксированное значение операции записи.

* На остальных трех уровнях согласованности окно устаревания в значительной степени зависит от рабочей нагрузки. Например, если в базе данных нет записей, операция чтения с **итоговой** согласованностью, согласованностью на уровне **сеанса** или согласованностью с **постоянным префиксом**, скорее всего, даст те же результаты, что и операция чтения со строгим уровнем согласованности.

Если ваша учетная запись Azure Cosmos настроена с уровнем согласованности, отличным от строгой согласованности, можно выяснить вероятность того, что клиенты могут получить надежные и согласованные операции чтения для рабочих нагрузок, просмотрев метрику *Probabilistically ограниченного устаревания* (PBS). Эта метрика предоставляется на портале Azure. Дополнительные сведения см. в разделе [Мониторинг метрики вероятностного ограниченного устаревания (PBS)](how-to-manage-consistency.md#monitor-probabilistically-bounded-staleness-pbs-metric).

Вероятностное ограниченное устаревание показывает степень итоговой согласованности. Эта метрика позволяет понять, насколько часто можно добиться более высокой согласованности, чем уровень согласованности, настроенный в вашей учетной записи Azure Cosmos. Другими словами, вы можете увидеть вероятность (в миллисекундах) выполнения строго согласованных операций чтения для комбинации регионов записи и чтения.

## <a name="next-steps"></a>Дальнейшие шаги

Дополнительные сведения об уровнях согласованности см. по следующим ссылкам:

* [Согласование уровней согласованности в API Cosmos DB](consistency-levels-across-apis.md)
* [Достижение компромисса между доступностью и быстродействием для разных уровней согласованности](consistency-levels-tradeoffs.md)
* [Управление токенами сеанса для приложения](how-to-manage-consistency.md#utilize-session-tokens)
* [Мониторинг метрики вероятностного ограниченного устаревания (PBS)](how-to-manage-consistency.md#monitor-probabilistically-bounded-staleness-pbs-metric)
