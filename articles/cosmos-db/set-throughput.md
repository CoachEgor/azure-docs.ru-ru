---
title: Подготовка пропускной способности в контейнерах и базах данных Azure Cosmos
description: Сведения о настройке подготовленной пропускной способности для контейнеров и баз данных Azure Cosmos.
author: rimman
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 08/12/2019
ms.author: rimman
ms.openlocfilehash: 146cc9e89959035ca211a036be4730b59cae8c0b
ms.sourcegitcommit: 5b76581fa8b5eaebcb06d7604a40672e7b557348
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/13/2019
ms.locfileid: "68987394"
---
# <a name="provision-throughput-on-containers-and-databases"></a>Обеспечение необходимой пропускной способности для контейнеров и баз данных

База данных Azure Cosmos представляет собой единицу управления для набора контейнеров. База данных состоит из набора схемонезависимых контейнеров. Контейнер Azure Cosmos — это единица масштабируемости как для пропускной способности, так и для хранения. Контейнер горизонтально разделяется между набором компьютеров в регионе Azure и распределяется по всем регионам Azure, связанным с учетной записью Azure Cosmos.

С Azure Cosmos DB можно подготавливать пропускную способность с двумя детализациями:
 
- Контейнеры Azure Cosmos
- Базы данных Azure Cosmos

## <a name="set-throughput-on-a-container"></a>Настройка пропускной способности в контейнере  

Пропускная способность, подготовленная в контейнере Azure Cosmos, зарезервирована исключительно для этого контейнера. Контейнер получает подготовленную пропускную способность постоянно. Финансовой гарантией подготовленной пропускной способности в контейнере являются соглашения об уровне обслуживания. Чтобы узнать, как настроить пропускную способность в контейнере, см. статью о [подготовке пропускной способности в контейнере Azure Cosmos](how-to-provision-container-throughput.md).

Параметр "подготовленная пропускная способность для контейнера" является наиболее часто используемым. Можно эластично масштабировать пропускную способность для контейнера путем подготовки любого объема пропускной способности с помощью [единиц запросов (RUs)](request-units.md). 

Пропускная способность в контейнере Azure Cosmos равномерно распределяется по всем его логическим разделам. Нельзя выборочно указывать пропускную способность для логических секций. Так как один логический раздел контейнера или несколько размещаются в физическом разделе, физические разделы относятся исключительно к данному контейнеру и поддерживают пропускную способность, подготовленную для контейнера. 

Если Рабочая нагрузка, запущенная в логической секции, использует больше пропускной способности, выделенной для этой логической секции, то операции получают ограничения по скорости. Если происходит ограничение скорости, можно либо увеличить подготовленную пропускную способность для всего контейнера, либо повторить операции. Дополнительные сведения о секционировании см. в статье о [логических разделах](partition-data.md).

Если нужно получить гарантированную производительность для определенного контейнера, мы рекомендуем настроить пропускную способность на уровне контейнера.

На следующем рисунке показано, как в физическом разделе размещаются один или несколько логических разделов контейнера.

![Физическая секция](./media/set-throughput/resource-partition.png)

## <a name="set-throughput-on-a-database"></a>Настройка пропускной способности в базе данных

При подготовке пропускной способности в базе данных Azure Cosmos пропускная способность совместно используется всеми контейнерами (называемыми общими контейнерами базы данных) в базе данных. Исключением является, если вы указали подготовленную пропускную способность для определенных контейнеров в базе данных. Совместное использование подготовленной пропускной способности на уровне базы данных в контейнерах аналогично размещению базы данных в кластере компьютеров. Так как все контейнеры в базе данных совместно используют ресурсы, доступные на компьютере, естественно, что для любого конкретного контейнера невозможно обеспечить прогнозируемую производительность. Сведения о настройке подготовленной пропускной способности в базе данных см. в статье [Настройка подготовленной пропускной способности в базе данных Azure Cosmos](how-to-provision-database-throughput.md).

Настройка пропускной способности в базе данных Azure Cosmos гарантирует, что подготовленная пропускная способность для этой базы данных будет все время. Так как все контейнеры в базе данных совместно используют подготовленную пропускную способность, Azure Cosmos DB не предоставляет никаких гарантий относительно прогнозируемой пропускной способности для определенного контейнера в этой базе данных. Часть пропускной способности, которую может получить определенный контейнер, зависит от:

* числа контейнеров;
* выбора ключей разделов для различных контейнеров;
* распределения рабочей нагрузки между различными логическими разделами контейнеров. 

Мы рекомендуем настроить пропускную способность на уровне базы данных, когда требуется совместно использовать пропускную способность в нескольких контейнерах, но нежелательно выделять ее какому-либо определенному контейнеру. 

В следующих примерах показано, когда предпочтительнее подготовить пропускную способность на уровне базы данных:

* Совместное использование пропускной способности базы данных набором контейнеров полезно для мультитенантного приложения. Каждый пользователь может быть представлен отдельным контейнером Azure Cosmos.

* Совместное использование подготовленной пропускной способности базы данных набором контейнеров полезно, если выполняется перенос базы данных NoSQL, например MongoDB или Cassandra, размещенной в кластере виртуальных машин или на локальных физических серверах, в Azure Cosmos DB. Подготовленную пропускную способность, настроенную в базе данных Azure Cosmos, можно представить как логический эквивалент (но более экономичный и эластичный) вычислительной мощности кластера MongoDB или Cassandra.  

Все контейнеры, созданные в базе данных с подготовленной пропускной способностью, должны быть созданы с [ключом секции](partition-data.md). В любой отдельно взятый момент времени пропускная способность, выделенная контейнеру в базе данных, распределяется по всем логическим разделам этого контейнера. При наличии контейнеров, использующих подготовленную пропускную способность, настроенную в базе данных, невозможно выборочно применить пропускную способность к конкретному контейнеру или логической секции. 

Если рабочая нагрузка, выполняемая в логическом разделе, потребляет больше пропускной способности, чем выделено определенному логическому разделу, скорость выполнения операций будет ограничена. Когда происходит ограничение скорости, можно либо увеличить пропускную способность для всей базы данных, либо повторить операции. Дополнительные сведения о секционировании см. в статье о [логических разделах](partition-data.md).

Пропускная способность, подготовленная к базе данных, может совместно использоваться контейнерами в этой базе данных. До 25 контейнеров может быть предоставлена пропускная способность, подготовленная в базе данных. Помимо 25 контейнеров для каждого нового контейнера, созданного в этой базе данных, может совместно использовать часть пропускной способности базы данных с другими коллекциями, уже доступными в базе данных. Объем общей пропускной способности зависит от количества контейнеров, подготовленных в базе данных. 

Если рабочие нагрузки предполагают удаление и повторное создание всех коллекций в базе данных, рекомендуется удалить пустую базу данных и создать новую базу данных перед созданием коллекции.

На следующем рисунке показано, как в физическом разделе можно разместить один логический раздел или несколько, которые относятся к разным контейнерам в базе данных.

![Физическая секция](./media/set-throughput/resource-partition2.png)

## <a name="set-throughput-on-a-database-and-a-container"></a>Настройка пропускной способности для базы данных и контейнера

Вы можете объединить эти две модели. Допускается подготовка пропускной способности для базы данных и для контейнера. В следующем примере показано, как подготовить пропускную способность для базы данных Azure Cosmos и контейнера.

* Вы можете создать базу данных Azure Cosmos с именем *Z* и подготовленную пропускную способность в *"K"* . 
* Затем создайте пять контейнеров с именами *A*, *B*, *C*, *D*и *E* в базе данных. При создании контейнера B обязательно включите функцию **подготовки выделенной пропускной способности для этого параметра контейнера** и явным образом настройте *"P"* в качестве отсчета для подготовленной пропускной способности в этом контейнере. Обратите внимание, что общая и выделенная пропускная способность можно настроить только при создании базы данных и контейнера. 

   ![Настройка пропускной способности на уровне контейнера](./media/set-throughput/coll-level-throughput.png)

* Пропускная способность *"K"* разбивается в четырех контейнерах *A*, *C*, *D*и *E*. Точный объем пропускной способности,доступной для, *C*, *D*или *E* , изменяется. Не существует Соглашения об уровне обслуживания для пропускной способности каждого отдельного контейнера.
* Контейнер с именем *B* гарантирует, что пропускная способность *"P"* доводится все время. Он поддерживается Соглашением об уровне обслуживания.

> [!NOTE]
> Контейнер с подготовленной пропускной способностью нельзя преобразовать в контейнер общей базы данных. И наоборот, невозможно преобразовать контейнер общей базы данных, чтобы получить выделенную пропускную способность.

## <a name="update-throughput-on-a-database-or-a-container"></a>Обновление пропускной способности в базе данных или контейнере

После создания контейнера Azure Cosmos или базы данных можно обновить подготовленную пропускную способность. Максимальное количество подготовленной пропускной способности, которое можно настроить в базе данных или контейнере, не ограничено. Минимальная подготовленная пропускная способность зависит от следующих факторов. 

* Максимальный размер данных, который вы когда-либо Храните в контейнере
* Максимальная пропускная способность, которую вы когда-либо подготавливаете к контейнеру
* Максимальное число контейнеров Azure Cosmos, создаваемых в базе данных с общей пропускной способностью. 

Вы можете программно получить минимальную пропускную способность контейнера или базы данных с помощью пакетов SDK или просмотреть значение в портал Azure. При использовании пакета SDK для .NET метод [DocumentClient. реплацеофферасинк](https://docs.microsoft.com/dotnet/api/microsoft.azure.documents.client.documentclient.replaceofferasync?view=azure-dotnet) позволяет масштабировать значение подготовленной пропускной способности. При использовании пакета SDK для Java метод [RequestOptions. сетофферсраугхпут](sql-api-java-samples.md#offer-examples) позволяет масштабировать значение подготовленной пропускной способности. 

При использовании пакета SDK для .NET метод [DocumentClient. реадофферасинк](https://docs.microsoft.com/dotnet/api/microsoft.azure.documents.client.documentclient.readofferasync?view=azure-dotnet) позволяет получить минимальную пропускную способность контейнера или базы данных. 

Вы можете в любое время масштабировать подготовленную пропускную способность контейнера или базы данных. Выполнение операции масштабирования для увеличения пропускной способности может занять больше времени из-за системных задач по подготовке необходимых ресурсов. Состояние операции масштабирования можно проверить в портал Azure или программно с помощью пакетов SDK. При использовании пакета SDK для .NET можно получить состояние операции масштабирования с помощью `DocumentClient.ReadOfferAsync` метода.

## <a name="comparison-of-models"></a>Сравнение моделей

|**Параметр**  |**Пропускная способность, подготовленная на уровне базы данных**  |**Пропускная способность, подготовленная на уровне контейнера**|
|---------|---------|---------|
|Минимум ЕЗ |400 (после первых четырех контейнеров для каждого дополнительного контейнера требуется не менее 100 ЕЗ/с.) |400|
|Минимум ЕЗ на контейнер|100|400|
|Максимум ЕЗ|Без ограничений, для базы данных.|Без ограничений, для контейнера.|
|ЕЗ, назначенные или доступные для определенного контейнера|Нет гарантий. ЕЗ, назначенные для заданного контейнера зависят от свойств. Свойствами могут быть выбор ключей разделов контейнеров, совместно использующих пропускную способность, распределение рабочей нагрузки и число контейнеров. |Все ЕЗ, настроенные для контейнера, резервируются исключительно для него.|
|Максимальный размер хранилища для контейнера|Без ограничений.|Без ограничений.|
|Максимальная пропускная способность на логический раздел контейнера|10 000 ЕЗ|10 000 ЕЗ|
|Максимальная пропускная способность (данные + индекс) на логический раздел контейнера|10 GB|10 GB|

## <a name="next-steps"></a>Следующие шаги

* Подробнее о [логических разделах](partition-data.md).
* Подробнее о [подготовке пропускной способности для контейнера Azure Cosmos](how-to-provision-container-throughput.md).
* Подробнее о [подготовке пропускной способности для базы данных Azure Cosmos](how-to-provision-database-throughput.md).

