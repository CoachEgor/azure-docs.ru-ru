---
title: Подготовка пропускной способности в контейнерах и базах данных Azure Cosmos
description: Сведения о настройке подготовленной пропускной способности для контейнеров и баз данных Azure Cosmos.
author: markjbrown
ms.author: mjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 08/12/2019
ms.openlocfilehash: e7a64776cba00a6840af70cecad5bf9c02b3f38e
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79251977"
---
# <a name="provision-throughput-on-containers-and-databases"></a>Обеспечение необходимой пропускной способности для контейнеров и баз данных

База данных Azure Cosmos представляет собой единицу управления для набора контейнеров. База данных состоит из набора схемонезависимых контейнеров. Контейнер Azure Cosmos — это единица масштабируемости как для пропускной способности, так и для хранения. Контейнер горизонтально разделяется между набором компьютеров в регионе Azure и распределяется по всем регионам Azure, связанным с учетной записью Azure Cosmos.

С Помощью Azure Cosmos DB можно обеспечить пропускную связь на двух гранулированных пунктах:
 
- Контейнеры Azure Cosmos
- Базы данных Azure Cosmos

## <a name="set-throughput-on-a-container"></a>Настройка пропускной способности в контейнере  

Пропускная часть, установленная в контейнере Azure Cosmos, зарезервирована исключительно для этого контейнера. Контейнер получает подготовленную пропускную способность постоянно. Финансовой гарантией подготовленной пропускной способности в контейнере являются соглашения об уровне обслуживания. Чтобы узнать, как настроить пропускную емкость на контейнере, [см.](how-to-provision-container-throughput.md)

Установка прокладки на контейнере является наиболее часто используемым вариантом. Вы можете упруго масштабировать пропускную емкость контейнера, присужая любое количество пропускной выхажей с помощью [единиц запроса (RUs).](request-units.md) 

Проницательность, подготовленная для контейнера, равномерно распределена между его физическими перегородками, и при условии, что хороший ключ раздела, который равномерно распределяет логические разделы между физическими перегородками, пропускная часть также равномерно распределяется по всем логические разделы контейнера. Невозможно выборочно указать пропускную систему для логических разделов. Так как один логический раздел контейнера или несколько размещаются в физическом разделе, физические разделы относятся исключительно к данному контейнеру и поддерживают пропускную способность, подготовленную для контейнера. 

Если рабочая нагрузка, работаемая на логическом разделе, потребляет больше, чем пропускная часть, которая была выделена этому логическому разделу, ваши операции становятся ограничены в скорости. При ограничении скорости можно либо увеличить прокладку прокладки для всего контейнера, либо повторить операцию. Дополнительные сведения о секционировании см. в статье о [логических разделах](partition-data.md).

Если нужно получить гарантированную производительность для определенного контейнера, мы рекомендуем настроить пропускную способность на уровне контейнера.

На следующем рисунке показано, как в физическом разделе размещаются один или несколько логических разделов контейнера.

![Физическая секция](./media/set-throughput/resource-partition.png)

## <a name="set-throughput-on-a-database"></a>Настройка пропускной способности в базе данных

При предоставлении пропускной информации в базе данных Azure Cosmos пропускная связь распределяется по всем контейнерам (так называемым общим ими баз данных) в базе данных. Исключением является указано, если вы указали запланированную пропускную емкость на определенные контейнеры в базе данных. Совместное использование прокладки на уровне базы данных между контейнерами аналогично размещению базы данных на кластере машин. Так как все контейнеры в базе данных совместно используют ресурсы, доступные на компьютере, естественно, что для любого конкретного контейнера невозможно обеспечить прогнозируемую производительность. Чтобы узнать, как настроить прокладку в базе данных, [см.](how-to-provision-database-throughput.md)

Настройка пропускной системы в базе данных Azure Cosmos гарантирует, что вы постоянно получаете резервированную пропускную связь для этой базы данных. Так как все контейнеры в базе данных совместно используют подготовленную пропускную способность, Azure Cosmos DB не предоставляет никаких гарантий относительно прогнозируемой пропускной способности для определенного контейнера в этой базе данных. Часть пропускной способности, которую может получить определенный контейнер, зависит от:

* числа контейнеров;
* выбора ключей разделов для различных контейнеров;
* распределения рабочей нагрузки между различными логическими разделами контейнеров. 

Мы рекомендуем настроить пропускную способность на уровне базы данных, когда требуется совместно использовать пропускную способность в нескольких контейнерах, но нежелательно выделять ее какому-либо определенному контейнеру. 

В следующих примерах показано, когда предпочтительнее подготовить пропускную способность на уровне базы данных:

* Совместное использование пропускной способности базы данных набором контейнеров полезно для мультитенантного приложения. Каждый пользователь может быть представлен отдельным контейнером Azure Cosmos.

* Совместное использование подготовленной пропускной способности базы данных набором контейнеров полезно, если выполняется перенос базы данных NoSQL, например MongoDB или Cassandra, размещенной в кластере виртуальных машин или на локальных физических серверах, в Azure Cosmos DB. Подготовленную пропускную способность, настроенную в базе данных Azure Cosmos, можно представить как логический эквивалент (но более экономичный и эластичный) вычислительной мощности кластера MongoDB или Cassandra.  

Все контейнеры, созданные внутри базы данных с прокладкой, должны быть созданы с [ключом перегородки.](partition-data.md) В любой момент времени пропускная часть, выделенная контейнеру в базе данных, распределяется по всем логическим разделам этого контейнера. Если в базе данных есть контейнеры, которые разделяют прокладку, настроенную на базу данных, нельзя избирательно применять пропускную емкость к определенному контейнеру или логическому разделу. 

Если рабочая нагрузка, выполняемая в логическом разделе, потребляет больше пропускной способности, чем выделено определенному логическому разделу, скорость выполнения операций будет ограничена. При ограничении скорости можно либо увеличить пропускную работу всей базы данных, либо повторить операцию. Дополнительные сведения о секционировании см. в статье о [логических разделах](partition-data.md).

Контейнеры в общей базе данных пропускной информации разделяют пропускную емкость (RU/s), выделенную для этой базы данных. В базе данных может быть до четырех контейнеров с минимум 400 ru/s. Каждый новый контейнер после первых четырех потребует дополнительно 100 RU/s минимум. Например, если у вас есть общая база данных пропускной платы с восемью контейнерами, минимальный ru/s в базе данных составит 800 руб./с.

> [!NOTE]
> В феврале 2020 года мы внесли изменения, которые позволяют иметь максимум 25 контейнеров в общей базе данных пропускной связи, что позволяет лучше обмениваться пропускной связью между контейнерами. После первых 25 контейнеров, вы можете добавить больше контейнеров в базу данных, только если они [подготовлены с выделенной пропускной однако,](#set-throughput-on-a-database-and-a-container)которая отделена от общей пропускной их пропускной суммы базы данных.<br>
Если учетная запись Azure Cosmos DB уже содержит общую базу данных пропускной связи с >контейнерами 25 евро, учетная запись и все другие учетные записи в той же подписке Azure освобождаются от этого изменения. Пожалуйста, [свяжитесь со службой поддержки продукта,](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) если у вас есть отзывы или вопросы. 

Если рабочие нагрузки предполагают удаление и воссоздание всех коллекций в базе данных, рекомендуется упустить пустую базу данных и воссоздать новую базу данных до создания коллекции. На следующем рисунке показано, как в физическом разделе можно разместить один логический раздел или несколько, которые относятся к разным контейнерам в базе данных.

![Физическая секция](./media/set-throughput/resource-partition2.png)

## <a name="set-throughput-on-a-database-and-a-container"></a>Настройка пропускной способности для базы данных и контейнера

Вы можете объединить эти две модели. Допускается подготовка пропускной способности для базы данных и для контейнера. В следующем примере показано, как подготовить пропускную способность для базы данных Azure Cosmos и контейнера.

* Можно создать базу данных Azure Cosmos под названием *з* с прокладкой *пропускной четырбы "K"* RUs. 
* Затем создайте пять контейнеров под названием *A,* *B,* *C,* *D*и *E* в базе данных. При создании контейнера B убедитесь, что для этого **контейнера предусмотренная пропускная стоимость предоставляется и** явно настраивает *rUs "P"* подготовленной пропускной связи на этом контейнере. Обратите внимание, что настроить общую и выделенную пропускную систему можно только при создании базы данных и контейнера. 

   ![Установка пропускной высохла на уровне контейнера](./media/set-throughput/coll-level-throughput.png)

* Пропускная часть *RUs "K"* распределяется по четырем контейнерам *A,* *C,* *D*и *E.* Точное количество пропускной записи, доступной для *A,* *C,* *D*или *E,* варьируется. Не существует Соглашения об уровне обслуживания для пропускной способности каждого отдельного контейнера.
* Контейнер под названием *B* гарантированно получает пропускную выливку *"P"* RUs все время. Он поддерживается Соглашением об уровне обслуживания.

> [!NOTE]
> Контейнер с подготовленной пропускной емкостью не может быть преобразован в общий контейнер базы данных. И наоборот, общий контейнер базы данных не может быть преобразован в специальную пропускную систему.

## <a name="update-throughput-on-a-database-or-a-container"></a>Обновление пропускной системы в базе данных или контейнере

После создания контейнера Azure Cosmos или базы данных можно обновить прокладку. Не существует ограничений на максимальную прокладку, которую можно настроить на базу данных или контейнер. [Минимальная предуместья пропускная плата](concepts-limits.md#storage-and-throughput) зависит от следующих факторов: 

* Максимальный размер данных, который вы когда-либо храните в контейнере
* Максимальная пропускная емкость, которую вы когда-либо предусматривали в контейнере
* Текущее количество контейнеров Azure Cosmos, которые есть в базе данных с общей пропускной стоимостью. 

Можно получить минимальную пропускную емкость контейнера или базы данных программно, используя SDK или просмотреть значение на портале Azure. При использовании .NET SDK метод [DocumentClient.ReplaceOfferAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.documents.client.documentclient.replaceofferasync?view=azure-dotnet) позволяет масштабировать резервируемую пропускную стоимость. При использовании Java SDK метод [RequestOptions.setOfferThroughput](sql-api-java-samples.md#offer-examples) позволяет масштабировать установленное значение пропускной выхважек. 

При использовании .NET SDK метод [DocumentClient.ReadOfferAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.documents.client.documentclient.readofferasync?view=azure-dotnet) позволяет получить минимальную пропускную емкость контейнера или базы данных. 

Вы можете масштабировать прокладку подготовленной пропускной системы контейнера или базы данных в любое время. При выполнении операции масштаба для увеличения пропускной связи может потребоваться больше времени из-за системных задач по предоставлению необходимых ресурсов. Вы можете проверить состояние операции масштаба на портале Azure или программно использовать SDK. При использовании SDK .Net можно получить статус операции масштаба `DocumentClient.ReadOfferAsync` с помощью метода.

## <a name="comparison-of-models"></a>Сравнение моделей

|**Параметр**  |**Пропускная способность, подготовленная на уровне базы данных**  |**Пропускная способность, подготовленная на уровне контейнера**|
|---------|---------|---------|
|Минимум ЕЗ |400 (после первых четырех контейнеров для каждого дополнительного контейнера требуется не менее 100 ЕЗ/с.) |400|
|Минимум ЕЗ на контейнер|100|400|
|Максимум ЕЗ|Без ограничений, для базы данных.|Без ограничений, для контейнера.|
|ЕЗ, назначенные или доступные для определенного контейнера|Нет гарантий. ЕЗ, назначенные для заданного контейнера зависят от свойств. Свойствами могут быть выбор ключей разделов контейнеров, совместно использующих пропускную способность, распределение рабочей нагрузки и число контейнеров. |Все ЕЗ, настроенные для контейнера, резервируются исключительно для него.|
|Максимальный размер хранилища для контейнера|Без ограничений.|Без ограничений.|
|Максимальная пропускная способность на логический раздел контейнера|10 000 ЕЗ|10 000 ЕЗ|
|Максимальная пропускная способность (данные + индекс) на логический раздел контейнера|20 ГБ|20 ГБ|

## <a name="next-steps"></a>Дальнейшие действия

* Подробнее о [логических разделах.](partition-data.md)
* Подробнее о [подготовке пропускной способности для контейнера Azure Cosmos](how-to-provision-container-throughput.md).
* Подробнее о [подготовке пропускной способности для базы данных Azure Cosmos](how-to-provision-database-throughput.md).

