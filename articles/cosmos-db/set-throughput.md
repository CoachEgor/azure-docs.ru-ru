---
title: Подготовка пропускной способности в контейнерах и базах данных Azure Cosmos
description: Сведения о настройке подготовленной пропускной способности для контейнеров и баз данных Azure Cosmos.
author: rimman
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 06/14/2019
ms.author: rimman
ms.openlocfilehash: adf0891203321ca02c47494f1865ca78a833e301
ms.sourcegitcommit: d3b1f89edceb9bff1870f562bc2c2fd52636fc21
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/04/2019
ms.locfileid: "67561391"
---
# <a name="provision-throughput-on-containers-and-databases"></a>Обеспечение необходимой пропускной способности для контейнеров и баз данных

База данных Azure Cosmos представляет собой единицу управления для набора контейнеров. База данных состоит из набора схемонезависимых контейнеров. Контейнер Azure Cosmos — это единица масштабируемости как для пропускной способности, так и для хранения. Контейнер горизонтально разделяется между набором компьютеров в регионе Azure и распределяется по всем регионам Azure, связанным с учетной записью Azure Cosmos.

С помощью Azure Cosmos DB можно подготовить пропускную способность на два степенью детализации:
 
- Контейнеры Azure Cosmos
- Базы данных Azure Cosmos

## <a name="set-throughput-on-a-container"></a>Настройка пропускной способности в контейнере  

Пропускная способность для контейнера Azure Cosmos зарезервировано исключительно для этого контейнера. Контейнер получает подготовленную пропускную способность постоянно. Финансовой гарантией подготовленной пропускной способности в контейнере являются соглашения об уровне обслуживания. Чтобы узнать, как настроить пропускную способность для контейнера, см. в разделе [Подготовка пропускной способности для контейнера Azure Cosmos](how-to-provision-container-throughput.md).

Наиболее часто используемые вариант параметр подготовленную пропускную способность для контейнера. Вы можете гибко масштабировать пропускную способность для контейнера, подготовив любого объема пропускной способности с помощью [единицы запроса (ЕЗ)](request-units.md). 

Пропускная способность в контейнере Azure Cosmos равномерно распределяется по всем его логическим разделам. Нельзя выборочно указать пропускную способность для логических секций. Так как один логический раздел контейнера или несколько размещаются в физическом разделе, физические разделы относятся исключительно к данному контейнеру и поддерживают пропускную способность, подготовленную для контейнера. 

Если рабочая нагрузка, выполняемая на логической секции занимает больше, чем пропускная способность, выделенное для этой логической секции, операции, получить ограничение скорости. При возникновении ограничения скорости, можно либо увеличить подготовленную пропускную способность для всего контейнера, либо повторите операции. Дополнительные сведения о секционировании см. в статье о [логических разделах](partition-data.md).

Если нужно получить гарантированную производительность для определенного контейнера, мы рекомендуем настроить пропускную способность на уровне контейнера.

На следующем рисунке показано, как в физическом разделе размещаются один или несколько логических разделов контейнера.

![Физическая секция](./media/set-throughput/resource-partition.png)

## <a name="set-throughput-on-a-database"></a>Настройка пропускной способности в базе данных

При подготовке пропускной способности в базе данных Azure Cosmos пропускная способность распределяется между всеми контейнерами в базе данных. Исключение, если вы указали подготовленной пропускной способности в конкретных контейнерах, в базе данных. Общий доступ к подготовленной пропускной способности на уровне базы данных между его контейнеры является аналогом размещение базы данных в кластере виртуальных машин. Так как все контейнеры в базе данных совместно используют ресурсы, доступные на компьютере, естественно, что для любого конкретного контейнера невозможно обеспечить прогнозируемую производительность. Сведения о настройке подготовленной пропускной способности в базе данных, см. в разделе [Настройка подготовленной пропускной способности в базе данных Azure Cosmos](how-to-provision-database-throughput.md).

Настраивая значение пропускной способности в базе данных Azure Cosmos гарантирует, что вы получили подготовленной пропускной способности для этой базы данных постоянно. Так как все контейнеры в базе данных совместно используют подготовленную пропускную способность, Azure Cosmos DB не предоставляет никаких гарантий относительно прогнозируемой пропускной способности для определенного контейнера в этой базе данных. Часть пропускной способности, которую может получить определенный контейнер, зависит от:

* числа контейнеров;
* выбора ключей разделов для различных контейнеров;
* распределения рабочей нагрузки между различными логическими разделами контейнеров. 

Мы рекомендуем настроить пропускную способность на уровне базы данных, когда требуется совместно использовать пропускную способность в нескольких контейнерах, но нежелательно выделять ее какому-либо определенному контейнеру. 

В следующих примерах показано, когда предпочтительнее подготовить пропускную способность на уровне базы данных:

* Совместное использование пропускной способности базы данных набором контейнеров полезно для мультитенантного приложения. Каждый пользователь может быть представлен отдельным контейнером Azure Cosmos.

* Совместное использование подготовленной пропускной способности базы данных набором контейнеров полезно, если выполняется перенос базы данных NoSQL, например MongoDB или Cassandra, размещенной в кластере виртуальных машин или на локальных физических серверах, в Azure Cosmos DB. Подготовленную пропускную способность, настроенную в базе данных Azure Cosmos, можно представить как логический эквивалент (но более экономичный и эластичный) вычислительной мощности кластера MongoDB или Cassandra.  

Все контейнеры, созданные внутри базы данных с подготовленной пропускной способности, которые должны создаваться с помощью [ключ секции](partition-data.md). В любой отдельно взятый момент времени пропускная способность, выделенная контейнеру в базе данных, распределяется по всем логическим разделам этого контейнера. При наличии контейнеры, которые совместно используют подготовленной пропускной способности, настроенной для базы данных, нельзя применить выборочно пропускной способности к конкретному контейнеру или логической секции. 

Если рабочая нагрузка, выполняемая в логическом разделе, потребляет больше пропускной способности, чем выделено определенному логическому разделу, скорость выполнения операций будет ограничена. При возникновении ограничения скорости, можно увеличить пропускную способность для всей базы данных или повторите попытку. Дополнительные сведения о секционировании см. в статье о [логических разделах](partition-data.md).

Несколько логических секций, которые принадлежат в разные контейнеры, которые совместно используют пропускную способность, подготовлены к базе данных могут размещаться на одной физической секции. Хотя одной логической секции контейнера всегда область в пределах физической, *«L»* логические разделы по *«C»* контейнеры, которые совместно используют подготовленной пропускной способности базы данных могут быть сопоставить и размещено на *«R»* физических секций. 

На следующем рисунке показано, как в физическом разделе можно разместить один логический раздел или несколько, которые относятся к разным контейнерам в базе данных.

![Физическая секция](./media/set-throughput/resource-partition2.png)

## <a name="set-throughput-on-a-database-and-a-container"></a>Настройка пропускной способности для базы данных и контейнера

Вы можете объединить эти две модели. Допускается подготовка пропускной способности для базы данных и для контейнера. В следующем примере показано, как подготовить пропускную способность для базы данных Azure Cosmos и контейнера.

* Можно создать базу данных Azure Cosmos с именем *Z* с подготовленной пропускной способностью *«K»* ЕЗ. 
* Создайте пять контейнеров с именем *объект*, *B*, *C*, *D*, и *E* в базе данных. При создании контейнера B, не забудьте включить **Подготовка выделенной пропускной способности для этого контейнера** параметр и явным образом настраивать *«P»* RUs подготовленной пропускной способностью для данного контейнера. Обратите внимание, что можно настроить общие и выделенные пропускной способности, только в том случае, при создании базы данных и контейнера. 

   ![Настройке значения пропускной способности на уровне контейнера](./media/set-throughput/coll-level-throughput.png)

* *«K»* RUs пропускную способность совместно используется четыре контейнера *объект*, *C*, *D*, и *E*. Точный объем пропускной способности, доступной *объект*, *C*, *D*, или *E* зависит. Не существует Соглашения об уровне обслуживания для пропускной способности каждого отдельного контейнера.
* Контейнер с именем *B* гарантированно получит *«P»* пропускной способности RUs постоянно. Он поддерживается Соглашением об уровне обслуживания.

## <a name="update-throughput-on-a-database-or-a-container"></a>Обновление пропускной способности для базы данных или контейнера

После создания контейнера Azure Cosmos или базу данных, можно обновить подготовленной пропускной способности. Нет ограничений на максимальный подготовленной пропускной способности, которые можно настроить для базы данных или контейнера. Минимальная Подготавливаемая пропускная способность зависит от следующих факторов: 

* Максимальный размер данных, которые постоянно хранятся в контейнере
* Максимальная пропускная способность, вы когда-либо подготовить к работе в контейнере
* Максимальное число контейнеров Azure Cosmos, которые нужно создавать в базе данных с использованием общей пропускной способности. 

Можно программно получить минимальное значение пропускной способности контейнера или базу данных с помощью пакетов SDK или просмотра значения на портале Azure. При использовании пакета SDK для .NET, [DocumentClient.ReplaceOfferAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.documents.client.documentclient.replaceofferasync?view=azure-dotnet) метод позволяет масштабировать значение подготовленной пропускной способности. При использовании пакета SDK для Java, [RequestOptions.setOfferThroughput](sql-api-java-samples.md#offer-examples) метод позволяет масштабировать значение подготовленной пропускной способности. 

При использовании пакета SDK для .NET, [DocumentClient.ReadOfferAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.documents.client.documentclient.readofferasync?view=azure-dotnet) метод позволяет получить минимальное значение пропускной способности контейнера или базу данных. 

Вы можете масштабировать подготовленной пропускной способности контейнера или базу данных в любое время. Когда выполняется масштабирование для увеличения пропускной способности, может занять больше времени из-за системных задач для подготовки необходимых ресурсов. Вы можете проверить состояние операции масштабирования на портале Azure либо программно с помощью пакетов SDK. При использовании пакета SDK для .net, можно получить состояние операции масштабирования с помощью `DocumentClient.ReadOfferAsync` метод.

## <a name="comparison-of-models"></a>Сравнение моделей

|**Параметр**  |**Пропускная способность, подготовленная на уровне базы данных**  |**Пропускная способность, подготовленная на уровне контейнера**|
|---------|---------|---------|
|Минимум ЕЗ |400 (после первых четырех контейнеров для каждого дополнительного контейнера требуется не менее 100 ЕЗ/с.) |400|
|Минимум ЕЗ на контейнер|100|400|
|Максимум ЕЗ|Без ограничений, для базы данных.|Без ограничений, для контейнера.|
|ЕЗ, назначенные или доступные для определенного контейнера|Нет гарантий. ЕЗ, назначенные для заданного контейнера зависят от свойств. Свойствами могут быть выбор ключей разделов контейнеров, совместно использующих пропускную способность, распределение рабочей нагрузки и число контейнеров. |Все ЕЗ, настроенные для контейнера, резервируются исключительно для него.|
|Максимальный размер хранилища для контейнера|Без ограничений.|Без ограничений.|
|Максимальная пропускная способность на логический раздел контейнера|10 000 ЕЗ|10 000 ЕЗ|
|Максимальная пропускная способность (данные + индекс) на логический раздел контейнера|10 ГБ|10 ГБ|

## <a name="next-steps"></a>Дальнейшие действия

* Подробнее о [логических разделах](partition-data.md).
* Подробнее о [подготовке пропускной способности для контейнера Azure Cosmos](how-to-provision-container-throughput.md).
* Подробнее о [подготовке пропускной способности для базы данных Azure Cosmos](how-to-provision-database-throughput.md).

