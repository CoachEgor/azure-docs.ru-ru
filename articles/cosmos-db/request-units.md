---
title: Пропускная способность и единицы запросов в Azure Cosmos DB
description: Сведения о том, как задать и оценить количество необходимых единиц запросов в Azure Cosmos DB
author: rimman
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 06/14/2019
ms.author: rimman
ms.openlocfilehash: 12f91676ac50511bf3d2d33f7fed2029e152dc98
ms.sourcegitcommit: 3e98da33c41a7bbd724f644ce7dedee169eb5028
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/17/2019
ms.locfileid: "67165003"
---
# <a name="request-units-in-azure-cosmos-db"></a>Единицы запросов в базе данных Azure Cosmos DB

При использовании Azure Cosmos DB вы платите на почасовой основе за пропускную способность, которую предоставляете, и за ресурсы хранения, которое вы потребляете. Чтобы обеспечить достаточный объем системных ресурсов для базы данных Azure Cosmos все время должны быть подготовлены пропускной способности. Требуется достаточно ресурсов для достижения или превышения [соглашения об уровне обслуживания для Azure Cosmos DB](https://azure.microsoft.com/support/legal/sla/cosmos-db/v1_2/).

Azure Cosmos DB поддерживает многие интерфейсы API, такие как SQL, MongoDB, Cassandra, Gremlin и Таблицы. У каждого API есть собственный набор операций базы данных, начиная от простого считывания и записи точек и заканчивая сложными запросами. Каждая операция базы данных потребляет системные ресурсы. Потребление зависит от сложности операции. 

Стоимость всех операций базы данных нормализуется с помощью Azure Cosmos DB и выражается с помощью *единиц запроса* (или RUs, для краткости). Вы можете считать ЕЗ/с в качестве пропускной способности. ЕЗ/с — это единица, основанная на тарифе. Он абстрагирует системные ресурсы (например, ЦП, операции ввода-вывода в секунду и память), необходимые для выполнения операций базы данных, поддерживаемых Azure Cosmos DB. 

Стоимость для чтения, размером 1 КБ элемент является 1 единицу запроса (или 1 ЕЗ). Все остальные операции базы данных аналогично назначена цена зарезервированных модулей. Независимо от того, какие API вы используете для взаимодействия с контейнером Azure Cosmos, затраты всегда измеряются в ЕЗ. Независимо от типа операции базы данных (запись, чтение или запрос) затраты всегда измеряются в ЕЗ.

На следующем рисунке показана высокоуровневые идея использования единиц запроса:

![Операции с базой данных потребляют единицы запроса](./media/request-units/request-units.png)

Чтобы обеспечить планирование пропускной способности и управление ею, Azure Cosmos DB гарантирует, что количество ЕЗ для операции базы данных над определенным набором данных является детерминированным. Проверьте заголовок ответа для отслеживания количества ЕЗ, используемых любая операция базы данных. Поняв [факторы, влияющие на затраты единиц Запросов](request-units.md#request-unit-considerations) и требования приложения к пропускной способности, вы можете запустить приложение с минимальными затратами.

Количество ЕЗ для приложения подготавливается на основе данных, получаемых в секунду, с шагом в 100 ЕЗ/с. Чтобы масштабировать подготовленную пропускную способность для приложения, вы можете увеличить или уменьшить количество единиц запросов в любое время. Вы можете масштабировать в увеличивает или уменьшает из 100 единиц запроса. Это можно сделать программным способом или с помощью портала Azure. Счета выставляются на почасовой основе.

Вы можете обеспечить пропускную способность с помощью двух различных уровней детализаций: 

* **Контейнеры.** Дополнительные сведения см. в статье [Подготовка пропускной способности для контейнера Azure Cosmos](how-to-provision-container-throughput.md).
* **Базы данных**: Дополнительные сведения см. в статье [Подготовка пропускной способности для базы данных в Azure Cosmos DB](how-to-provision-database-throughput.md).

## <a name="request-unit-considerations"></a>Рекомендации по оценке необходимого количества единиц запросов

Когда вы оцениваете количество ЕЗ в секунду для подготовки, учитывайте следующие факторы:

* **Размер элемента**. С увеличением размера элемента число единиц запросов, расходуемых на чтение и запись элемента, также увеличивается.

* **Индексирование элемента**. По умолчанию каждый элемент индексируется автоматически. Если не индексировать некоторые элементы в контейнере, будет использовано меньше единиц запросов.

* **Число свойств элемента**. Предположим, что по умолчанию индексирование выполняется для всех свойств, количество ЕЗ запросов, расходуемых на запись элемента увеличивает увеличением количества свойств элемента.

* **Индексируемые свойства**. Свойства, которые индексируются по умолчанию, определяются политикой индексирования для каждого контейнера. Чтобы сократить потребление единиц запросов для операций записи, ограничьте количество индексируемых свойств.

* **Согласованность данных**. Строгие уровни согласованности и согласованности с ограниченным устареванием потребляют примерно в 2 раза больше ЕЗ при выполнении операций чтения по сравнению с другими отложенными уровнями согласованности.

* **Шаблоны запросов**. Сложность запроса влияет на количество единиц запроса, потребляемых операцией. Факторы, которые влияют на стоимость операций запросов: 
    
    - Число результатов запроса
    - Количество предикатов
    - Характер предикаты
    - Количество определяемых пользователем функций
    - Размер источника данных
    - Размер результирующего набора
    - Проекции

  Azure Cosmos DB гарантирует, что при повторном выполнении один и тот же запрос к тем же данным всегда будет стоить то же количество ЕЗ.

* **Использование сценариев**. Так же как и запросы, хранимые процедуры и триггеры расходуют ЕЗ с учетом сложности выполняемых операций. При разработке приложения, проверять [заголовка запрос о затратах](optimize-cost-queries.md#evaluate-request-unit-charge-for-a-query) чтобы лучше понять, какая емкость единиц Запросов использует для каждой операции.

## <a name="next-steps"></a>Дальнейшие действия

* Подробнее о [подготовке пропускной способности в контейнерах и базах данных Azure Cosmos](set-throughput.md).
* Подробнее о [логических секциях](partition-data.md).
* Подробнее о [глобальном масштабировании подготовленной пропускной способности](scaling-throughput.md).
* Подробнее о [подготовке пропускной способности для контейнера Azure Cosmos](how-to-provision-container-throughput.md).
* Подробнее о [подготовке пропускной способности для базы данных Azure Cosmos](how-to-provision-database-throughput.md).
* Узнайте, как [найти затраты единиц запросов для операции](find-request-unit-charge.md).
* Узнайте, как [Оптимизируйте затраты подготовленной пропускной способности в Azure Cosmos DB](optimize-cost-throughput.md).
* Узнайте, как [оптимизировать операции чтения и записи стоимости в Azure Cosmos DB](optimize-cost-reads-writes.md).
* Узнайте, как [оптимизировать стоимость запроса в Azure Cosmos DB](optimize-cost-queries.md).
* Узнайте, как [использовать метрики пропускной способности монитор](use-metrics.md).
