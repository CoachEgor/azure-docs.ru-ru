---
title: Пропускная способность и единицы запросов в Azure Cosmos DB
description: Сведения о том, как задать и оценить количество необходимых единиц запросов в Azure Cosmos DB
author: markjbrown
ms.author: mjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 07/24/2020
ms.openlocfilehash: f1f203d17de9fb0fc9fe8bb0f6de80fe2b93ba8b
ms.sourcegitcommit: a76ff927bd57d2fcc122fa36f7cb21eb22154cfa
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/28/2020
ms.locfileid: "87327809"
---
# <a name="request-units-in-azure-cosmos-db"></a>Единицы запросов в базе данных Azure Cosmos DB

При использовании Azure Cosmos DB вы платите на почасовой основе за пропускную способность, которую предоставляете, и за ресурсы хранения, которое вы потребляете. Обеспечьте пропускную способность и убедитесь, что для базы данных Azure Cosmos всегда предоставляется достаточно системных ресурсов. Требуется достаточно ресурсов для удовлетворения или превышения [Azure Cosmos DB соглашений об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/cosmos-db/v1_2/).

Azure Cosmos DB поддерживает многие интерфейсы API, такие как SQL, MongoDB, Cassandra, Gremlin и Таблицы. У каждого API есть собственный набор операций базы данных, начиная от простого считывания и записи точек и заканчивая сложными запросами. Каждая операция базы данных потребляет системные ресурсы. Потребление зависит от сложности операции.

Затраты на все операции с базами данных нормализованы с помощью Azure Cosmos DB и выражаются *единицами запросов* (или, в качестве коротких). Вы можете считать ЕЗ/с в качестве пропускной способности. ЕЗ/с — это единица, основанная на тарифе. Он абстрагирует системные ресурсы (например, ЦП, операции ввода-вывода в секунду и память), необходимые для выполнения операций базы данных, поддерживаемых Azure Cosmos DB. Для хранения каждого 1 ГБ данных требуется не менее 10 единиц запросов в секунду.

Затраты на чтение точки для элемента размером 1 КБ — 1 единица запроса (или 1 RU). Цены на остальные операции с базой данных выражаются в ЕЗ аналогичным образом. Независимо от того, какие API вы используете для взаимодействия с контейнером Azure Cosmos, затраты всегда измеряются в ЕЗ. Является ли операция базы данных записью, чтением точки или запросом, затраты всегда измеряются в версии-получателей.

Обобщенная схема использования ЕЗ представлена на следующем изображении.

:::image type="content" source="./media/request-units/request-units.png" alt-text="Операции с базой данных потребляют единицы запроса" border="false":::

Чтобы обеспечить планирование пропускной способности и управление ею, Azure Cosmos DB гарантирует, что количество ЕЗ для операции базы данных над определенным набором данных является детерминированным. Вы можете изучить заголовок ответа, чтобы отслеживать количество ЕЗ, потребляемых любой операцией базы данных. Если вы понимаете [факторы, влияющие на сборы за единицу](request-units.md#request-unit-considerations) и требования к пропускной способности вашего приложения, можно эффективно выполнять ваши приложения.

Количество ЕЗ для приложения подготавливается на основе данных, получаемых в секунду, с шагом в 100 ЕЗ/с. Чтобы масштабировать подготовленную пропускную способность для приложения, вы можете увеличить или уменьшить количество единиц запросов в любое время. Масштабирование выполняется шагами по 100 ЕЗ. Это можно сделать программным способом или с помощью портала Azure. Счет выставляется на почасовой основе.

Вы можете обеспечить пропускную способность с помощью двух различных уровней детализаций:

* **Контейнеры**. Дополнительные сведения см. [в статье о подготовке пропускной способности в контейнере Azure Cosmos](how-to-provision-container-throughput.md).
* **Базы данных**. Дополнительные сведения см. [в статье о подготовке пропускной способности в базе данных Azure Cosmos](how-to-provision-database-throughput.md).

## <a name="request-unit-considerations"></a>Рекомендации по оценке необходимого количества единиц запросов

Оценивая число ЕЗ в секунду для инициализации, учитывайте следующие факторы:

* **Размер элемента**. По мере увеличения размера элемента число ЕЗ, потребляемое для чтения или записи элемента, также увеличивается.

* **Индексация элемента**. По умолчанию каждый элемент индексируется автоматически. Если вы решили не индексировать некоторые элементы в контейнере, потребляется меньше ЕЗ.

* **Количество свойств элемента**. Предполагая, что индексирование выполняется по умолчанию для всех свойств, количество ЕЗ, потребляемых для записи элемента, увеличивается по мере увеличения количества свойств элемента.

* **Индексируемые свойства**. Свойства, которые индексируются по умолчанию, определяются политикой индексирования для каждого контейнера. Чтобы сократить потребление ЕЗ в операциях записи, ограничьте количество индексированных свойств.

* **Согласованность данных**. уровни согласованности строгого и ограниченного устаревания требуют примерно в два раза больше, чем при выполнении операций чтения, по сравнению с другими ослабленными уровнями согласованности.

* **Тип операций чтения**: затраты на считывание точек значительно меньше, чем запросы.

* **Шаблоны запросов**. Сложность запроса влияет на количество ЕЗ, потребляемых операцией. Факторы, которые влияют на стоимость операций запросов: 
    
    - Количество результатов запроса.
    - Количество предикатов.
    - Характер предикатов.
    - Количество определяемых пользователем функций.
    - Размер исходных данных.
    - Размер результирующего набора.
    - Проекции.

  Azure Cosmos DB гарантирует, что при повторном выполнении один и тот же запрос к тем же данным всегда будет стоить то же количество ЕЗ.

* **Использование скриптов**: как и в случае с запросами, хранимые процедуры и триггеры используют в базе данных, которая усложняет выполнение операций. При разработке приложения проверяйте [заголовки со стоимостью запросов](optimize-cost-queries.md#evaluate-request-unit-charge-for-a-query), чтобы лучше понять, как ресурсы производительности используются каждой из операций.

## <a name="next-steps"></a>Дальнейшие действия

* Подробнее о [подготовке пропускной способности в контейнерах и базах данных Azure Cosmos](set-throughput.md).
* Подробнее о [логических секциях](partition-data.md).
* Подробнее о [глобальном масштабировании подготовленной пропускной способности](scaling-throughput.md).
* Подробнее о [подготовке пропускной способности для контейнера Azure Cosmos](how-to-provision-container-throughput.md).
* Подробнее о [подготовке пропускной способности для базы данных Azure Cosmos](how-to-provision-database-throughput.md).
* Узнайте, как [найти плату за единицу запросов для операции](find-request-unit-charge.md).
* Узнайте, как [оптимизировать стоимость подготовленной пропускной способности в Azure Cosmos DB](optimize-cost-throughput.md).
* Узнайте, как [оптимизировать чтение и запись затрат в Azure Cosmos DB](optimize-cost-reads-writes.md).
* Узнайте, как [оптимизировать стоимость запросов в Azure Cosmos DB](optimize-cost-queries.md).
* Узнайте, как [использовать метрики для мониторинга пропускной способности](use-metrics.md).
