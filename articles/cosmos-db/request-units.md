---
title: Пропускная способность и единицы запросов в Azure Cosmos DB
description: Сведения о том, как задать и оценить количество необходимых единиц запросов в Azure Cosmos DB
author: markjbrown
ms.author: mjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 07/23/2019
ms.openlocfilehash: a0058bf309e0ff4fbe687731d676e907d1c3fd82
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79246595"
---
# <a name="request-units-in-azure-cosmos-db"></a>Единицы запросов в базе данных Azure Cosmos DB

При использовании Azure Cosmos DB вы платите на почасовой основе за пропускную способность, которую предоставляете, и за ресурсы хранения, которое вы потребляете. Обеспечьте пропускную способность и убедитесь, что для базы данных Azure Cosmos всегда предоставляется достаточно системных ресурсов. Вам нужно достаточно ресурсов, чтобы удовлетворить или превзойти [ALS SA.](https://azure.microsoft.com/support/legal/sla/cosmos-db/v1_2/)

Azure Cosmos DB поддерживает многие интерфейсы API, такие как SQL, MongoDB, Cassandra, Gremlin и Таблицы. У каждого API есть собственный набор операций базы данных, начиная от простого считывания и записи точек и заканчивая сложными запросами. Каждая операция базы данных потребляет системные ресурсы. Потребление зависит от сложности операции. 

Стоимость всех операций базы данных нормализуется Azure Cosmos DB и выражается *в группах запросов* (или RUs, для краткости). Вы можете считать ЕЗ/с в качестве пропускной способности. ЕЗ/с — это единица, основанная на тарифе. Он абстрагирует системные ресурсы (например, ЦП, операции ввода-вывода в секунду и память), необходимые для выполнения операций базы данных, поддерживаемых Azure Cosmos DB. 

Чтение элемента размером 1 КБ соответствует 1 единице запроса (1 ЕЗ). Для хранения каждого 1 ГБ данных требуется не менее 10 руб./с. Цены на остальные операции с базой данных выражаются в ЕЗ аналогичным образом. Независимо от того, какие API вы используете для взаимодействия с контейнером Azure Cosmos, затраты всегда измеряются в ЕЗ. Независимо от типа операции базы данных (запись, чтение или запрос) затраты всегда измеряются в ЕЗ.

Обобщенная схема использования ЕЗ представлена на следующем изображении.

![Операции с базой данных потребляют единицы запроса](./media/request-units/request-units.png)

Чтобы обеспечить планирование пропускной способности и управление ею, Azure Cosmos DB гарантирует, что количество ЕЗ для операции базы данных над определенным набором данных является детерминированным. Вы можете изучить заголовок ответа, чтобы отслеживать количество ЕЗ, потребляемых любой операцией базы данных. Когда вы поймете [факторы, влияющие на сборы RU](request-units.md#request-unit-considerations) и требования к пропускной стоимости приложения, вы можете эффективно запустить приложение с затратами.

Количество ЕЗ для приложения подготавливается на основе данных, получаемых в секунду, с шагом в 100 ЕЗ/с. Чтобы масштабировать подготовленную пропускную способность для приложения, вы можете увеличить или уменьшить количество единиц запросов в любое время. Масштабирование выполняется шагами по 100 ЕЗ. Это можно сделать программным способом или с помощью портала Azure. Счет выставляется на почасовой основе.

Вы можете обеспечить пропускную способность с помощью двух различных уровней детализаций: 

* **Контейнеры**: Для получения [Provision throughput on an Azure Cosmos container](how-to-provision-container-throughput.md)дополнительной информации см.
* **Базы данных**: Для [Provision throughput on an Azure Cosmos database](how-to-provision-database-throughput.md)получения дополнительной информации см.

## <a name="request-unit-considerations"></a>Рекомендации по оценке необходимого количества единиц запросов

Когда вы оцениваете количество ЕЗ в секунду для подготовки, учитывайте следующие факторы:

* **Размер элемента**: По мере увеличения размера элемента увеличивается также количество RUs, потребляемых для чтения или записи элемента.

* **Индексирование элементов**: По умолчанию каждый элемент автоматически индексируется. Если не индексировать некоторые элементы в контейнере, будет использовано меньше единиц запросов.

* **Количество свойств элемента**: Предполагая, что индексация по умолчанию происходит на всех свойствах, количество RUs, потребляемых для написания элемента, увеличивается по мере увеличения количества свойств элемента.

* **Индексированные свойства**: Политика индекса по каждому контейнеру определяет, какие свойства индексируются по умолчанию. Чтобы сократить потребление единиц запросов для операций записи, ограничьте количество индексируемых свойств.

* **Последовательность данных**: Сильные и ограниченные уровни консистенции стихлости устаревшей потребляют примерно в два раза больше RUs при выполнении операций чтения по сравнению с другими уровнями расслабленной согласованности.

* **Шаблоны запросов**: Сложность запроса влияет на количество rUs, потребляемых для операции. Факторы, которые влияют на стоимость операций запросов: 
    
    - Количество результатов запроса.
    - Количество предикатов.
    - Характер предикатов.
    - Количество определяемых пользователем функций.
    - Размер исходных данных.
    - Размер результирующего набора.
    - Проекции

  Azure Cosmos DB гарантирует, что при повторном выполнении один и тот же запрос к тем же данным всегда будет стоить то же количество ЕЗ.

* **Использование скрипта**: Как и в запросах, сохраненные процедуры и триггеры потребляют RUs в зависимости от сложности выполняемых операций. При разработке приложения проинспектируйте [заголовок платы за запрос,](optimize-cost-queries.md#evaluate-request-unit-charge-for-a-query) чтобы лучше понять, сколько потребляет емкость RU в каждой операции.

## <a name="next-steps"></a>Дальнейшие действия

* Подробнее о [подготовке пропускной способности в контейнерах и базах данных Azure Cosmos](set-throughput.md).
* Подробнее о [логических разделах.](partition-data.md)
* Подробнее о [глобальном масштабировании подготовленной пропускной способности](scaling-throughput.md).
* Подробнее о [подготовке пропускной способности для контейнера Azure Cosmos](how-to-provision-container-throughput.md).
* Подробнее о [подготовке пропускной способности для базы данных Azure Cosmos](how-to-provision-database-throughput.md).
* Узнайте, как найти плату за [единицу запроса для операции.](find-request-unit-charge.md)
* Узнайте, как [оптимизировать стоимость прокладки в Azure Cosmos DB.](optimize-cost-throughput.md)
* Узнайте, как [оптимизировать стоимость чтения и записи в Azure Cosmos DB.](optimize-cost-reads-writes.md)
* Узнайте, как [оптимизировать стоимость запроса в Azure Cosmos DB.](optimize-cost-queries.md)
* Узнайте, как [использовать метрики для мониторинга пропускной выхадоки.](use-metrics.md)
