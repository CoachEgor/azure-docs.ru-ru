---
title: Запрос контейнеров в Azure Cosmos DB
description: Узнайте, как запрашивать контейнеры в Azure Cosmos DB с помощью запросов в разделите и перекрестных разделов
author: markjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 3/18/2019
ms.author: mjbrown
ms.openlocfilehash: 299980b67caaea85fbfb40cb1a30ee50fa32d0f7
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80131397"
---
# <a name="query-an-azure-cosmos-container"></a>Запрос контейнера Azure Cosmos

В этой статье описывается, как запрашивать контейнеры (коллекции, графы и таблицы) в Azure Cosmos DB. В частности, в нем рассказывается о том, как в разделительных и перекрестных разделах работают запросы в Azure Cosmos DB.

## <a name="in-partition-query"></a>Запрос в секции

При запросе данных из контейнеров, если в запросе указан фильтр ключа раздела, Azure Cosmos DB автоматически оптимизирует запрос. Он направляет запрос к [физическим разглаголиям,](partition-data.md#physical-partitions) соответствующим значениям ключей раздела, указанным в фильтре.

Например, рассмотрим нижеприведенный запрос `DeviceId`с фильтром равенства на . Если мы запланируем этот запрос на контейнере, разделенном на, `DeviceId`этот запрос будет фильтровать сякш для одной физической раздела.

```sql
    SELECT * FROM c WHERE c.DeviceId = 'XMS-0001'
```

Как и в предыдущем примере, этот запрос также будет фильтровать сятвор ноединую раздел. Добавление дополнительного `Location` фильтра не изменяет этого:

```sql
    SELECT * FROM c WHERE c.DeviceId = 'XMS-0001' AND c.Location = 'Seattle'
```

Вот запрос, который имеет диапазон фильтра на ключе раздела и не будет прицела к одной физической перегородке. Для того, чтобы быть запросом в разделении, запрос должен иметь фильтр равенства, который включает ключ раздела:

```sql
    SELECT * FROM c WHERE c.DeviceId > 'XMS-0001'
```

## <a name="cross-partition-query"></a>Запрос между секциями

В следующем запросе нет фильтра на ключе`DeviceId`раздела (). Таким образом, он должен раздувать все физические разделы, где он работает против индекса каждого раздела:

```sql
    SELECT * FROM c WHERE c.Location = 'Seattle`
```

Каждая физическая часть имеет свой собственный индекс. Поэтому при запуске запроса перекрестной перегородки в контейнере фактически выполнить один запрос *на* физическую перегородку. Azure Cosmos DB автоматически агрегирует результаты по различным физическим разделам.

Индексы в различных физических разделах независимы друг от друга. В Azure Cosmos DB нет глобального индекса.

## <a name="parallel-cross-partition-query"></a>Параллельный запрос между секциями

Пакеты SDK Azure Cosmos DB 1.9.0 и более поздних версий поддерживают параметры выполнения параллельных запросов. Параллельные запросы между секциями позволяют выполнять запросы с низкой задержкой.

Вы можете управлять параллельным выполнением запросов, регулируя следующие параметры.

- **MaxConcurrency**: Устанавливает максимальное количество одновременных сетевых соединений к перегородке контейнера. Если вы установите `-1`это свойство, SDK управляет степенью параллелизма. Если `MaxConcurrency` `0`набор, есть одно сетевое соединение с перегородками контейнера.

- **MaxBufferedItemCount**: задержка запросов на транзакции и использование памяти на стороне клиента. Если пропустить этот параметр или задать значение -1, пакет SDK будет регулировать число буферизованных элементов при параллельном выполнении запросов.

Из-за способности Azure Cosmos Cosmos DB параллелизировать запросы перекрестного раздела, задержка запроса, как правило, хорошо масштабируется, а система добавляет [физические разделы.](partition-data.md#physical-partitions) Тем не менее, ru заряд будет значительно увеличиваться по мере увеличения общего числа физических перегородок.

При запуске запроса перекрестной раздела, по существу, выполняется отдельный запрос на отдельный физический раздел. В то время как запросы перекрестного раздела будут использовать индекс, если они доступны, они по-прежнему не столь эффективны, как запросы в разделении.

## <a name="useful-example"></a>Полезный пример

Вот аналогия, чтобы лучше понять вопросы перекрестного раздела:

Представим, что вы водитель доставки, который должен доставить посылки в различные жилые комплексы. Каждый жилой комплекс имеет список на помещениях, которые имеет все номера квартиры резидентов. Мы можем сравнить каждый жилой комплекс с физическим перегородкой, а каждый список с индексом физической перегородки.

Мы можем сравнить запросы в разделении и перекрестной разделы с помощью этого примера:

### <a name="in-partition-query"></a>Запрос в секции

Если водитель доставки знает правильный жилой комплекс (физическая перегородка), то они могут сразу же проехать в нужное здание. Водитель может проверить список номеров квартирного комплекса (индекс) и быстро доставить соответствующие пакеты. В этом случае водитель не тратит время и усилия на вождение в жилой комплекс, чтобы проверить, живут ли там получатели пакета.

### <a name="cross-partition-query-fan-out"></a>Запрос перекрестного раздела (фан-аут)

Если водитель доставки не знает правильного жилого комплекса (физическая перегородка), ему нужно будет проехать в каждый многоквартирный дом и проверить список со всеми номерами единицы резидента (индекс). Как только они прибудут в каждый жилой комплекс, они все равно смогут использовать список адресов каждого жителя. Тем не менее, они должны будут проверить список каждого жилого комплекса, независимо от того, какие-либо пакет получателей живут там или нет. Так работают запросы перекрестного раздела. Хотя они могут использовать индекс (не нужно стучать в каждую дверь), они должны отдельно проверить индекс для каждого физического раздела.

### <a name="cross-partition-query-scoped-to-only-a-few-physical-partitions"></a>Запрос перекрестного раздела (с разбивка лишь для нескольких физических разделов)

Если водитель доставки знает, что все получатели пакета живут в пределах нескольких жилых комплексов, им не нужно будет ездить на каждый из них. Во время вождения в несколько жилых комплексов будет по-прежнему требуют больше работы, чем посещение только одного здания, водитель доставки по-прежнему экономит значительное время и усилия. Если в фильтре запроса есть ключ раздела с `IN` ключевым словом, он проверяет только соответствующие индексы физического раздела для данных.

## <a name="avoiding-cross-partition-queries"></a>Избегание запросов перекрестной перегородки

Для большинства контейнеров неизбежно будет иметься несколько запросов перекрестного раздела. Имея некоторые кросс-раздел запросы в порядке! Почти все операции запроса поддерживаются между разделами (как логические клавиши раздела, так и физические разделы). Azure Cosmos DB также имеет много оптимизаций в движке запросов и клиентских SDK для параллелиза выполнения запроса через физические разделы.

Для большинства сценариев чтения- иссяков мы рекомендуем просто выбрать наиболее распространенное свойство в фильтрах запросов. Вы также должны убедиться, что ключ раздела придерживается других [рекомендаций по выбору ключей раздела.](partitioning-overview.md#choose-partitionkey)

Избегая запросов перекрестной перекрестной раздел, как правило, имеет значение только с большими контейнерами. С вас взимается не менее 2,5 RU каждый раз, когда вы проверяете индекс физической перегородки на наличие результатов, даже если элементы в физическом перегородке не соответствуют фильтру запроса. Таким образом, если у вас есть только один (или только несколько) физических разделов, запросы перекрестного раздела не будут потреблять значительно больше RU, чем запросы в разделении.

Количество физических перегородок привязано к объему предусмотренных RU. Каждая физическая перегородка позволяет хранить до 10 000 рублей и может хранить до 50 ГБ данных. Azure Cosmos DB будет автоматически управлять физическими перегородками для вас. Количество физических перегородок в контейнере зависит от вашей просеченной пропускной памяти и потребляемого хранилища.

Следует стараться избегать запросов перекрестного раздела, если рабочая нагрузка соответствует приведенным ниже критериям:
- Вы планируете иметь более 30 000 RU в резерве
- Вы планируете хранить более 100 ГБ данных

## <a name="next-steps"></a>Дальнейшие действия

Чтобы узнать о секционировании в Azure Cosmos DB, ознакомьтесь со следующими статьями:

- [Секционирование в базе данных Azure Cosmos DB](partitioning-overview.md)
- [Искусственные ключи секций в Azure Cosmos DB](synthetic-partition-keys.md)
