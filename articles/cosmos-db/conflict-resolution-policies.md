---
title: Типы разрешения конфликтов и политики разрешения в Azure Cosmos DB
description: В этой статье описаны категории конфликтов и политики их устранения в Azure Cosmos DB.
author: markjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 08/05/2019
ms.author: mjbrown
ms.reviewer: sngun
ms.openlocfilehash: a8ee72f46e1789088e779c10a0824262469ffde8
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75441989"
---
# <a name="conflict-types-and-resolution-policies"></a>Типы конфликтов и политики их разрешения

Конфликты и политики их устранения целесообразно изучать, если ваша учетная запись Azure Cosmos DB настроена на несколько регионов записи.

Для учетных записей Azure Cosmos, настроенных с несколькими областями записи, могут возникать конфликты обновления, когда писатели одновременно обновляют один и тот же элемент в нескольких регионах. Конфликты обновления могут быть следующих трех типов:

* **Вставить конфликты**: Эти конфликты могут возникать, когда приложение одновременно вставляет два или более элементов с тем же уникальным индексом в двух или более регионах. Например, этот конфликт может возникнуть с свойством идентификатора.

* **Заменить конфликты**: Эти конфликты могут возникать, когда приложение обновляет один и тот же элемент одновременно в двух или более регионах.

* **Удаление конфликтов**: Эти конфликты могут возникать, когда приложение одновременно удаляет элемент в одном регионе и обновляет его в другом регионе.

## <a name="conflict-resolution-policies"></a>Политик разрешения конфликтов

Azure Cosmos DB предлагает гибкий механизм, управляемый политикой, для разрешения конфликтов записок. Вы можете выбрать из двух политик разрешения конфликтов в контейнере Azure Cosmos:

* **Последний момент вызывает победы (LWW):** Эта политика разрешения по умолчанию использует свойство временной метки, определяемое системой. (на основе протокола синхронизации времени). Если вы используете API S'L, можно указать любое другое пользовательское числовое свойство (например, ваше собственное понятие метки времени), используемое для разрешения конфликтов. Пользовательские численные свойства также называют *путь разрешения конфликта.* 

  Если во время вставки или замены двух или более элементов возникает конфликт, приоритет получает элемент с более высоким значением пути устранения конфликтов. Если несколько элементов имеют одинаковое числовое значение пути устранения конфликта, то приоритет определяется системой. Гарантируется, что во всех регионах используется та же версия единственного элемента, получившего приоритет. При наличии конфликтов удаления удаленная версия всегда имеет приоритет в конфликтах вставки или замены. Этот результат возникает независимо от ценности пути разрешения конфликтов.

  > [!NOTE]
  > Last Write Wins — это политика разрешения `_ts` конфликтов по умолчанию и использует метки времени для следующих AIS: S'L, MongoDB, Cassandra, Gremlin и Table. Пользовательское численное свойство доступно только для API S'L.

  Дополнительные сведения см. в разделе с [примерами использования политик устранения конфликтов LWW](how-to-manage-conflicts.md).

* **Пользовательские**: Эта политика разрешения предназначена для приложения определяемой семантики для примирения конфликтов. При установке этой политики в контейнере Azure Cosmos необходимо также зарегистрировать *процедуру хранения слияния.* Эта процедура автоматически вызывается при обнаружении конфликтов в рамках транзакции базы данных на сервере. Система гарантирует только однократное выполнение слияния в рамках протокола обязательств.  

  Если вы настраиваете контейнер с помощью пользовательского варианта разрешения и не регистрируете процедуру слияния в контейнере или процедура слияния выбрасывает исключение во время выполнения, конфликты записываются в *канал конфликтов.* Приложение должно затем устранить конфликты в веб-канале. Дополнительные сведения см. в разделе с [примерами использования веб-каналов и настраиваемой политики устранения конфликтов](how-to-manage-conflicts.md).

  > [!NOTE]
  > Настраиваемая политика устранения конфликтов доступна только для учетных записей API SQL.

## <a name="next-steps"></a>Дальнейшие действия

Узнайте, как настроить политики разрешения конфликтов:

* [Настройка нескольких источников в приложениях](how-to-multi-master.md)
* [Как управлять политикой разрешения конфликтов](how-to-manage-conflicts.md)
* [Как читать из ленты конфликтов](how-to-manage-conflicts.md#read-from-conflict-feed)
