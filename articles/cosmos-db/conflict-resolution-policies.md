---
title: Типы разрешения конфликтов и политики разрешения в Azure Cosmos DB при нескольких регионах записи
description: В этой статье описаны категории конфликтов и политики их устранения в Azure Cosmos DB.
author: markjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 03/24/2019
ms.author: mjbrown
ms.reviewer: sngun
ms.openlocfilehash: ebea55f769ca16bfa344d0a100fe16cec6d784d0
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60892597"
---
# <a name="conflict-types-and-resolution-policies"></a>Типы конфликтов и политики их устранения

Конфликты и политики их устранения целесообразно изучать, если ваша учетная запись Azure Cosmos DB настроена на несколько регионов записи.

Для учетных записей Azure Cosmos, настроен с использованием нескольких регионов записи при записи одновременно обновляют один и тот же элемент в нескольких регионах могут возникать конфликты обновления. Конфликты обновления могут быть следующих трех типов:

* **Конфликты вставки**. Эти конфликты могут возникать, когда приложение одновременно вставляет два или более элементов с одинаковым уникальным индексом в двух или нескольких регионах. Например этот конфликт может возникнуть со свойством ID.

* **Конфликты замены.** Эти конфликты могут возникать, если приложение обновляет один и тот же элемент одновременно в двух или нескольких регионах.

* **Конфликты удаления.** Эти конфликты могут возникать, когда приложение одновременно удаляет элемент в одном регионе и обновляет его в другом регионе.

## <a name="conflict-resolution-policies"></a>Политик разрешения конфликтов

Azure Cosmos DB предоставляет гибкий механизм на основе политики для разрешения конфликтов записи. Можно выбрать один из двух политик устранения конфликтов для контейнера Azure Cosmos:

- **Приоритет последней записи (LWW)**. При применении этой политики по умолчанию используется свойство метки времени, назначенное системой (на основе протокола синхронизации времени). Если вы используете SQL API, можно указать любого другого пользовательского числовые свойства (например, собственные понятие метку времени) должна использоваться для разрешения конфликтов. Пользовательское свойство числовой также называется *путь разрешения конфликтов*. 

  Если во время вставки или замены двух или более элементов возникает конфликт, приоритет получает элемент с более высоким значением пути устранения конфликтов. Если несколько элементов имеют одинаковое числовое значение пути устранения конфликта, то приоритет определяется системой. Гарантируется, что во всех регионах используется та же версия единственного элемента, получившего приоритет. При наличии конфликтов удаления удаленная версия всегда имеет приоритет в конфликтах вставки или замены. Этот результат происходит независимо от значения пути разрешения конфликтов.

  > [!NOTE]
  > Приоритет последней записи — это политика разрешения конфликтов по умолчанию. Он доступен для следующих API-интерфейсов: SQL, MongoDB, Cassandra, Gremlin и таблицы.

  Дополнительные сведения см. в разделе с [примерами использования политик устранения конфликтов LWW](how-to-manage-conflicts.md).

- **Настраиваемая**. Эта политика разрешения предназначена для определяемой приложением семантики для разрешения конфликтов. При установке этой политики для контейнера Azure Cosmos, необходимо зарегистрировать *слияния хранимой процедуры*. Эта процедура вызывается автоматически при обнаружении конфликтов в рамках транзакции базы данных на сервере. Система гарантирует только однократное выполнение слияния в рамках протокола обязательств.  

  Если настроить контейнер с параметром пользовательское разрешение и вы не зарегистрировать процедуры слияния в контейнере или процедура слияния вызывает исключение во время выполнения, конфликты, записываются в *конфликты веб-канала*. Приложение должно затем устранить конфликты в веб-канале. Дополнительные сведения см. в разделе с [примерами использования веб-каналов и настраиваемой политики устранения конфликтов](how-to-manage-conflicts.md).

  > [!NOTE]
  > Настраиваемая политика устранения конфликтов доступна только для учетных записей API SQL.

## <a name="next-steps"></a>Дальнейшие действия

Сведения о настройке политик устранения конфликтов:

* [Настройка нескольких источников в приложениях в Azure Cosmos DB](how-to-multi-master.md)
* [Как управлять политик устранения конфликтов](how-to-manage-conflicts.md)
* [Как выполнить чтение из канала конфликты](how-to-manage-conflicts.md#read-from-conflict-feed)
