---
title: Предложение ORDER BY в Azure Cosmos DB
description: Дополнительные сведения о предложении SQL ORDER BY для Azure Cosmos DB. Используйте SQL в качестве языка запросов JSON Azure Cosmos DB.
author: timsander1
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 02/12/2020
ms.author: tisande
ms.openlocfilehash: b88184be39a41ec42f8fb304a7511073f645f1cb
ms.sourcegitcommit: b07964632879a077b10f988aa33fa3907cbaaf0e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/13/2020
ms.locfileid: "77188737"
---
# <a name="order-by-clause-in-azure-cosmos-db"></a>Предложение ORDER BY в Azure Cosmos DB

Необязательное предложение ORDER BY задает порядок сортировки результатов, возвращаемых запросом.

## <a name="syntax"></a>Синтаксис
  
```sql  
ORDER BY <sort_specification>  
<sort_specification> ::= <sort_expression> [, <sort_expression>]  
<sort_expression> ::= {<scalar_expression> [ASC | DESC]} [ ,...n ]  
```  

## <a name="arguments"></a>Аргументы
  
- `<sort_specification>`  
  
   Указывает свойство или выражение, по которому производится сортировка результирующего набора запроса. Столбец сортировки может быть указан как имя или псевдоним свойства.  
  
   Можно указать несколько свойств. Имена свойств должны быть уникальными. Последовательность свойств сортировки в предложении ORDER BY определяет организацию отсортированного результирующего набора. То есть результирующий набор сортируется по первому свойству, а затем упорядоченный список сортируется по второму свойству и т. д.  
  
   Имена свойств, упоминаемых в предложении ORDER BY, должны соответствовать свойству в списке выбора или свойству, определенному в коллекции, указанной в предложении FROM без каких-либо неоднозначностей.  
  
- `<sort_expression>`  
  
   Задает одно или несколько свойств или выражений для сортировки результирующего набора запроса.  
  
- `<scalar_expression>`  
  
   Дополнительные сведения см. в разделе [Скалярные выражения](sql-query-scalar-expressions.md).  
  
- `ASC | DESC`  
  
   Указывает порядок сортировки значений в указанном столбце — по возрастанию или по убыванию. Значение ASC сортирует от низких значений к высоким. Значение DESC сортирует от высоких значений к низким. Порядок сортировки по умолчанию — ASC. Значения NULL рассматриваются как минимально возможные значения.  
  
## <a name="remarks"></a>Примечания  
  
   Для предложения `ORDER BY` требуется, чтобы политика индексирования включала индекс для полей, для которых выполняется сортировка. Среда выполнения запросов Azure Cosmos DB поддерживает сортировку по имени свойства, а не к вычисленным свойствам. Azure Cosmos DB поддерживает несколько свойств `ORDER BY`. Чтобы выполнить запрос с несколькими свойствами ORDER BY, необходимо определить [составной индекс](index-policy.md#composite-indexes) для полей, для которых выполняется сортировка.

> [!Note]
> Если свойства, для которых выполняется сортировка, могут быть неопределенными для некоторых документов и вы хотите получить их в запросе ORDER BY, необходимо явно включить этот путь в индекс. Политика индексирования по умолчанию не допускает получение документов, в которых свойство Sort не определено. [Ознакомьтесь с примерами запросов к документам с некоторыми отсутствующими полями](#documents-with-missing-fields).

## <a name="examples"></a>Примеры

Например, Вот запрос, извлекающий семейства в порядке возрастания названия резидентного города:

```sql
    SELECT f.id, f.address.city
    FROM Families f
    ORDER BY f.address.city
```

Результаты:

```json
    [
      {
        "id": "WakefieldFamily",
        "city": "NY"
      },
      {
        "id": "AndersenFamily",
        "city": "Seattle"
      }
    ]
```

Следующий запрос получает семейство `id`s в порядке их даты создания элемента. `creationDate` элемента — это число, представляющее *время эпохи*, или время, истекшее с января 1, 1970 в секундах.

```sql
    SELECT f.id, f.creationDate
    FROM Families f
    ORDER BY f.creationDate DESC
```

Результаты:

```json
    [
      {
        "id": "WakefieldFamily",
        "creationDate": 1431620462
      },
      {
        "id": "AndersenFamily",
        "creationDate": 1431620472
      }
    ]
```

Кроме того, можно упорядочить по нескольким свойствам. Запрос, который упорядочивается по нескольким свойствам, требует [составного индекса](index-policy.md#composite-indexes). Обратите внимание на следующий запрос:

```sql
    SELECT f.id, f.creationDate
    FROM Families f
    ORDER BY f.address.city ASC, f.creationDate DESC
```

Этот запрос получает семейство `id` в порядке возрастания названия города. Если несколько элементов имеют одинаковое название города, запрос будет упорядочен по `creationDate` в порядке убывания.

## <a name="documents-with-missing-fields"></a>Документы с отсутствующими полями

Запросы с `ORDER BY`, которые выполняются для контейнеров с политикой индексирования по умолчанию, не возвращают документы, в которых свойство Sort не определено. Если вы хотите включить документы, в которых свойство Sort не определено, следует явно включить это свойство в политику индексирования.

Например, ниже приведен контейнер с политикой индексирования, которая не содержит никаких путей, кроме `"/*"`:

```json
{
    "indexingMode": "consistent",
    "automatic": true,
    "includedPaths": [
        {
            "path": "/*"
        }
    ],
    "excludedPaths": []
}
```

При выполнении запроса, включающего `lastName` в предложении `Order By`, результаты будут содержать только те документы, для которых определено свойство `lastName`. Не определен явный включаемый путь для `lastName` поэтому документы без `lastName` не будут отображаться в результатах запроса.

Ниже приведен запрос, который сортирует по `lastName` двух документов, для которых не определен `lastName`.

```sql
    SELECT f.id, f.lastName
    FROM Families f
    ORDER BY f.lastName
```

Результаты включают только документ с определенным `lastName`:

```json
    [
        {
            "id": "AndersenFamily",
            "lastName": "Andersen"
        }
    ]
```

При обновлении политики индексирования контейнера для явного включения пути для `lastName`в результаты запроса будут включены документы с неопределенным свойством Sort. Необходимо явно определить путь, который будет приводить к этому скалярному значению (а не за его пределами). Следует использовать `?`ный символ в определении пути в политике индексирования, чтобы обеспечить явное индексирование `lastName` свойства и отсутствие дополнительных вложенных путей.

Ниже приведен пример политики индексации, которая позволяет использовать в результатах запроса документы с неопределенными `lastName`.

```json
{
    "indexingMode": "consistent",
    "automatic": true,
    "includedPaths": [
        {
            "path": "/lastName/?"
        },
        {
            "path": "/*"
        }
    ],
    "excludedPaths": []
}
```

Если выполнить тот же запрос снова, то документы, отсутствующие `lastName` отображаются первыми в результатах запроса:

```sql
    SELECT f.id, f.lastName
    FROM Families f
    ORDER BY f.lastName
```

Результаты:

```json
[
    {
        "id": "WakefieldFamily"
    },
    {
        "id": "AndersenFamily",
        "lastName": "Andersen"
    }
]
```

Если изменить порядок сортировки на `DESC`, документы с отсутствующими `lastName` будут отображаться в результатах запроса последними:

```sql
    SELECT f.id, f.lastName
    FROM Families f
    ORDER BY f.lastName DESC
```

Результаты:

```json
[
    {
        "id": "AndersenFamily",
        "lastName": "Andersen"
    },
    {
        "id": "WakefieldFamily"
    }
]
```

## <a name="next-steps"></a>Следующие шаги

- [Начало работы](sql-query-getting-started.md)
- [Indexing policy in Azure Cosmos DB](index-policy.md) (Политики индексации в Azure Cosmos DB)
- [Предложение ЛИМИТа смещения](sql-query-offset-limit.md)
