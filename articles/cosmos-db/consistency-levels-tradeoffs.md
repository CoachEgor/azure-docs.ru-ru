---
title: Согласованность, доступность и производительность Azure Cosmos DB
description: Достижение компромисса между доступностью и быстродействием для разных уровней согласованности в Azure Cosmos DB.
author: markjbrown
ms.author: mjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 04/06/2020
ms.reviewer: sngun
ms.openlocfilehash: 7cdaa9699b15000359c438bcc410e300415b759a
ms.sourcegitcommit: ea006cd8e62888271b2601d5ed4ec78fb40e8427
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81379963"
---
# <a name="consistency-availability-and-performance-tradeoffs"></a>Компромиссы согласованности, доступности и производительности

Распределенные базы данных, которые полагаются на репликацию для обеспечения высокого уровня доступности, низкой задержки или того и другого, должны быть компромиссными. Это компромиссы между согласованностью чтения и доступностью, задержкой и пропускной способностью.

В Azure Cosmos DB согласованность данных рассматривается как плавный спектр возможных вариантов. Этот подход включает дополнительные возможности помимо двух крайностей в виде строгой и итоговой согласованности. Вы можете выбрать один из пяти четко определенных уровней по спектру согласованности. От самых сильных к слабым, уровни:

- *Строгая*
- *Ограниченное устаревка*
- *Сеанс*
- *Последовательная префикс*
- *Итоговая*

Каждый уровень обеспечивает доступность и производительность компромиссов и опирается на всеобъемлющие SLAs.

## <a name="consistency-levels-and-latency"></a>Уровни согласованности и время задержки

Задержка чтения для всех уровней согласованности гарантированно никогда не превышает 10 миллисекунд для 99-го процентиля, что оговаривается Соглашением об уровне обслуживания. Средняя задержка чтения, на 50-й процентиль, как правило, 4 миллисекунды или меньше.

Задержка записи для всех уровней согласованности всегда гарантирована менее 10 миллисекунд на 99-м процентиле. Соглашение об уровне обслуживания хранит задержку записи. Среднее время задержки записи (50-й процентиль) обычно не превышает 5 миллисекунд. Учетные записи Azure Cosmos, охватывающие несколько регионов и настраиваемые со строгой согласованностью, являются исключением из этой гарантии.

### <a name="write-latency-and-strong-consistency"></a>Запись задержки и сильной согласованности

Для учетных записей Azure Cosmos, настроенных с сильной согласованностью с более чем одной областью, задержка записи равна двухкратному времени в оба конца (RTT) между любым из двух самых дальних регионов, плюс 10 миллисекунд на 99-м процентиле. Высокая сеть RTT между регионами приведет к более высокой задержке для запросов Cosmos DB, так как сильная согласованность завершает операцию только после того, как она была совершена во всех регионах в учетной записи.

Точная задержка RTT определяется расстоянием, которое преодолевает сигнал, двигаясь со скоростью света, и топологией сети Azure. Для сетей Azure не предусмотрены Соглашения об уровне обслуживания, определяющие задержки для RTT между любыми двумя регионами Azure. Задержки репликации учетной записи Azure Cosmos отображаются на портале Azure. Для мониторинга пропотывания репликации между различными областями, связанными с учетной записью Azure Cosmos, можно использовать портал Azure (перейдите на лезвие метрики, выберите вкладку Consistency) для мониторинга просрочки репликации между различными областями, связанными с учетной записью Azure Cosmos.

> [!IMPORTANT]
> Сильная согласованность учетных записей с регионами, охватывающими более 5000 миль (8000 километров), блокируется по умолчанию из-за высокой задержки записи. Для обеспечения этой возможности, пожалуйста, обратитесь в службу поддержки.

## <a name="consistency-levels-and-throughput"></a>Уровни согласованности и пропускная способность

- Для сильной и ограниченной черствости, считываемы выполняются против двух реплик в наборе четырех реплик (кворум меньшинства), чтобы обеспечить гарантии согласованности. Сессия, последовательная префикс и в конечном итоге сделать одну реплику читает. В результате, для того же количества единиц запроса пропускная связь для сильной и ограниченной черствости составляет половину других уровней согласованности.

- Для этого типа операций записи (вставка, замена, обновление или вставка, удаление и т. д.) пропускная способность одинаковая для всех уровней согласованности.

|**Уровень согласованности**|**Кворум читает**|**Кворум пишет**|
|--|--|--|
|**Строгая**|Местное меньшинство|Глобальное большинство|
|**Ограниченное устаревание**|Местное меньшинство|Местное большинство|
|**Сеанс**|Однозначная реплика (с использованием маркера сеанса)|Местное большинство|
|**Постоянный префикс**|Однозначная реплика|Местное большинство|
|**Итоговая**|Однозначная реплика|Местное большинство|

## <a name="consistency-levels-and-data-durability"></a><a id="rto"></a>Уровни согласованности и устойчивость данных

В среде глобально распределенной базы данных существует прямая связь между уровнем согласованности и устойчивостью данных при наличии простоя в регионе. При разработке плана обеспечения непрерывности бизнес-процессов нужно понимать, какое максимальное время до полного восстановления приложения после аварийного события допустимо. Время, необходимое для полного восстановления приложения, известно как **цель времени восстановления** **(RTO).** Необходимо также понимать, потерю какого максимального периода последних обновлений данных приложение может допустить при восстановлении после аварийного события. Период времени обновлений, которые вы могли бы позволить себе потерять известен как **цель точки восстановления** **(RPO**).

В приведенной ниже таблице определяется взаимосвязь между моделью согласованности и долговечностью данных при наличии широкого простоя региона. Важно отметить, что в распределенной системе, даже при сильной согласованности, невозможно иметь распределенную базу данных с RPO и RTO нуля из-за теоремы CAP. Чтобы узнать больше о [причинах, смотрите уровни согласованности в Azure Cosmos DB.](consistency-levels.md)

|**Регион (ы)**|**Режим репликации**|**Уровень согласованности**|**Rpo**|**Rto**|
|---------|---------|---------|---------|---------|
|1|Подход с одним или несколькими источниками|Любой уровень согласованности|< 240 минут|< 1 неделя|
|>1|Single Master|Сеанс, постоянный префикс, случайный|< 15 минут|< 15 минут|
|>1|Single Master|Ограниченное устаревание|*K* & *T*|< 15 минут|
|>1|Single Master|Уровень согласованности Strong (сильная)|0|< 15 минут|
|>1|Подход с несколькими источниками|Сеанс, постоянный префикс, случайный|< 15 минут|0|
|>1|Подход с несколькими источниками|Ограниченное устаревание|*K* & *T*|0|

*K* - количество *версий "K"* (т.е. обновлений) элемента.

*Т* - Интервал времени *"T"* с момента последнего обновления.

## <a name="strong-consistency-and-multi-master"></a>Сильная консистенция и мультимастер

Учетные записи Космоса, настроенные для мультимастеров, не могут быть настроены для сильной согласованности, так как распределенная система не может обеспечить RPO ноль и RTO нуля. Кроме того, нет никаких преимуществ задержки записи для использования сильной согласованности с мультимастером, так как любая запись в любом регионе должна быть воспроизведена и совершена во всех настроенных регионах в учетной записи. Это приводит к той же задержке записи, что и один основной счет.

## <a name="next-steps"></a>Следующие шаги

Узнайте о глобальном распределении и общих компромиссах согласованности в распределенных системах: См. следующие статьи:

- [Компромиссы согласованности в современной конструкции распределенных систем баз данных](https://www.computer.org/csdl/magazine/co/2012/02/mco2012020037/13rRUxjyX7k)
- [Высокий уровень доступности](high-availability.md)
- [Соглашение об уровне обслуживания для Azure Cosmos DB](https://azure.microsoft.com/support/legal/sla/cosmos-db/v1_2/)
