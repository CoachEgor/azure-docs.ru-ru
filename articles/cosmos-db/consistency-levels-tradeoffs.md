---
title: Azure Cosmos DB согласованности, доступности и производительности
description: Достижение компромисса между доступностью и быстродействием для разных уровней согласованности в Azure Cosmos DB.
author: markjbrown
ms.author: mjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 04/23/2020
ms.reviewer: sngun
ms.openlocfilehash: 4e2cb2b93010478338cd40236403da4ca0ca99fc
ms.sourcegitcommit: d2222681e14700bdd65baef97de223fa91c22c55
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/07/2020
ms.locfileid: "91825264"
---
# <a name="latency-availability-and-performance-tradeoffs-with-different-azure-cosmos-db-consistency-levels"></a>Недостатки задержки, доступности и производительности с различными Azure Cosmos DB уровнями согласованности

Распределенные базы данных, которые полагаются на репликацию для обеспечения высокого уровня доступности, низкой задержки или того и другого, должны быть компромиссными. Это компромиссы между согласованностью чтения и доступностью, задержкой и пропускной способностью.

В Azure Cosmos DB согласованность данных рассматривается как плавный спектр возможных вариантов. Этот подход включает дополнительные возможности помимо двух крайностей в виде строгой и итоговой согласованности. В спектре согласованности можно выбрать один из пяти четко определенных уровней. С самого стойки на слабые уровни:

- *Уровень согласованности "Строгая"*
- *Ограниченное устаревание*
- *Согласованность сеанса*
- *Последовательный префикс*
- *Рано*

Каждый уровень предоставляет компромиссы по доступности и производительности и обеспечивается комплексными соглашениями об уровне обслуживания.

## <a name="consistency-levels-and-latency"></a>Уровни согласованности и время задержки

Задержка чтения для всех уровней согласованности гарантированно никогда не превышает 10 миллисекунд для 99-го процентиля, что оговаривается Соглашением об уровне обслуживания. Средняя задержка чтения, на 50-й процентиль, обычно составляет 4 миллисекунды или меньше.

Задержка записи для всех уровней согласованности всегда гарантирована менее 10 миллисекунд на 99-м процентиль. Соглашение об уровне обслуживания хранит задержку записи. Среднее время задержки записи (50-й процентиль) обычно не превышает 5 миллисекунд. Учетные записи Azure Cosmos, охватывающие несколько регионов и настраиваемые со строгой согласованностью, являются исключением из этой гарантии.

### <a name="write-latency-and-strong-consistency"></a>Задержка записи и строгая согласованность

Для учетных записей Azure Cosmos, для которых настроена строгая согласованность с несколькими регионами, задержка записи равна двум значениям времени приема-передачи (RTT) между любым из двух самых крайних регионов плюс 10 миллисекунд на 99-м процентиль. Высокая задержка сетевого переключения между регионами перейдет к более высокой задержке для запросов Cosmos DB, так как строгая согласованность завершает операцию только после того, как гарантируется, что она зафиксирована во всех регионах в пределах учетной записи.

Точная задержка RTT определяется расстоянием, которое преодолевает сигнал, двигаясь со скоростью света, и топологией сети Azure. Для сетей Azure не предусмотрены Соглашения об уровне обслуживания, определяющие задержки для RTT между любыми двумя регионами Azure. Задержки репликации учетной записи Azure Cosmos отображаются на портале Azure. Вы можете использовать портал Azure (перейдите в колонку метрики, выберите вкладку согласованность), чтобы отслеживать задержки репликации между различными регионами, связанными с вашей учетной записью Azure Cosmos.

> [!IMPORTANT]
> Строгая согласованность для учетных записей с регионами, охватывающими более 5000 миль (8000 километров), по умолчанию блокируется из-за высокой задержки записи. Чтобы включить эту возможность, обратитесь в службу поддержки.

## <a name="consistency-levels-and-throughput"></a>Уровни согласованности и пропускная способность

- Для строгой и ограниченного устаревания операции чтения выполняются с двумя репликами в наборе из четырех наборов реплик (доли миноритария) для обеспечения гарантии согласованности. Сеанс, последовательный префикс и, в конечном итоге, операции чтения одной реплики. Результат заключается в том, что для одинакового количества единиц запроса пропускная способность чтения для строгой и ограниченной устаревания составляет половину других уровней согласованности.

- Для этого типа операций записи (вставка, замена, обновление или вставка, удаление и т. д.) пропускная способность одинаковая для всех уровней согласованности.

|**Уровень согласованности**|**Операции чтения кворума**|**Записи кворума**|
|--|--|--|
|**Уровень согласованности "Строгая"**|Местная доля|Глобальная часть|
|**Ограниченное устаревание**|Местная доля|Локальный большинство|
|**Согласованность сеанса**|Одна реплика (с использованием токена сеанса)|Локальный большинство|
|**Последовательный префикс**|Одна реплика|Локальный большинство|
|**Рано**|Одна реплика|Локальный большинство|

## <a name="consistency-levels-and-data-durability"></a><a id="rto"></a>Уровни согласованности и устойчивость данных

В среде глобально распределенной базы данных существует прямая связь между уровнем согласованности и устойчивостью данных при наличии простоя в регионе. При разработке плана обеспечения непрерывности бизнес-процессов нужно понимать, какое максимальное время до полного восстановления приложения после аварийного события допустимо. Время, необходимое для полного восстановления приложения, называется **целевым временем восстановления** (**RTO**). Необходимо также понимать, потерю какого максимального периода последних обновлений данных приложение может допустить при восстановлении после аварийного события. Период времени, в течение которого можно потерять обновления, называется **целевой точкой восстановления** (**RPO**).

В приведенной ниже таблице определяется связь между моделью согласованности и устойчивостью данных при непростом уровне региона. Важно отметить, что в распределенной системе даже при строгой согласованности невозможно иметь распределенную базу данных с RPO и RTO, равными нулю, из-за ограничения теорема. Дополнительные сведения о том, почему, см. [в разделе уровни согласованности в Azure Cosmos DB](consistency-levels.md).

|**Регион (ы)**|**Режим репликации**|**Уровень согласованности**|**RPO**|**RTO**|
|---------|---------|---------|---------|---------|
|1|Один или несколько регионов записи|Любой уровень согласованности|< 240 минут|< 1 неделя|
|>1|Регион с одной записью|Сеанс, постоянный префикс, случайный|< 15 минут|< 15 минут|
|>1|Регион с одной записью|Ограниченное устаревание|*Л*  &  *T*|< 15 минут|
|>1|Регион с одной записью|Уровень согласованности "Строгая"|0|< 15 минут|
|>1|Несколько регионов записи|Сеанс, постоянный префикс, случайный|< 15 минут|0|
|>1|Несколько регионов записи|Ограниченное устаревание|*Л*  &  *T*|0|

*K* = число версий *"K"* (т. е. обновлений) элемента.

*T* = интервал времени *"T"* с момента последнего обновления.

## <a name="strong-consistency-and-multiple-write-regions"></a>Строгая согласованность и несколько регионов записи

Для учетных записей Cosmos, настроенных с несколькими регионами записи, нельзя настроить строгую согласованность, так как невозможно предоставить распределенной системе значение RPO, равное нулю, и значение RTO, равное нулю. Кроме того, не существует преимуществ задержки записи при использовании строгой согласованности с несколькими регионами записи, так как запрос на запись в любой регион должен быть реплицирован и зафиксирован во всех настроенных регионах в учетной записи. Это приводит к тому же задержкам записи, что и у одной учетной записи региона записи.

## <a name="next-steps"></a>Дальнейшие действия

Узнайте о глобальном распределении и общих компромиссах согласованности в распределенных системах: Дополнительные сведения см. в следующих статьях:

- [Компромиссы согласованности в современных распределенных системах баз данных](https://www.computer.org/csdl/magazine/co/2012/02/mco2012020037/13rRUxjyX7k)
- [Высокая доступность](high-availability.md)
- [Соглашение об уровне обслуживания для Azure Cosmos DB](https://azure.microsoft.com/support/legal/sla/cosmos-db/v1_3/)
