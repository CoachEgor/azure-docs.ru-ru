---
title: Индексирование геопространственных данных с помощью Azure Cosmos DB
description: Индексирование пространственных данных с помощью Azure Cosmos DB
author: timsander1
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 02/20/2020
ms.author: tisande
ms.openlocfilehash: 2cf682a404154b9c1bb94680b3adb673892c1c72
ms.sourcegitcommit: f27b045f7425d1d639cf0ff4bcf4752bf4d962d2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/23/2020
ms.locfileid: "77566378"
---
# <a name="index-geospatial-data-with-azure-cosmos-db"></a>Индексирование геопространственных данных с помощью Azure Cosmos DB

Мы разработали ядро СУБД Azure Cosmos DB действительно независимым от схемы и предоставляющих первую поддержку для JSON. Оптимизированное для записи ядро СУБД Azure Cosmos DB изначально распознает пространственные данные, представленные в стандарте геоjson.

По сути, геометрия формируется путем проецирования геодезических координат на двумерную плоскость, которая затем постепенно разделяется на ячейки с помощью **дерева квадрантов**. Эти ячейки связываются с одномерным пространством на основе расположения ячейки на **кривой заполнения гильбертова пространства**, что позволяет сохранить расположение точек. Кроме того, при индексировании данных расположения ячейки проходят так называемый процесс **тесселяции**, то есть все ячейки, которые пересекают расположение, обнаруживаются и сохраняются в виде ключей в индексе Azure Cosmos DB. Во время обработки запроса такие аргументы, как точки и многоугольники, также тесселируются для извлечения диапазонов идентификаторов соответствующих ячеек, а затем используются для получения данных из индекса.

Если указать политику индексации, включающую пространственный индекс для/* (все пути), то все данные, найденные в контейнере, индексируются для эффективных пространственных запросов.

> [!NOTE]
> Azure Cosmos DB поддерживает индексирование точек, LineString, многоугольников и многомногоугольниковых элементов
>
>

## <a name="geography-data-indexing-examples"></a>Примеры индексирования географических данных

В следующем фрагменте кода JSON показана политика индексации с включенным пространственным индексированием для типа данных **Geography** . Он допустим для пространственных данных с типом данных geography и индексирует все геообъектные точки, многоугольники, многомногоугольники или LineString, найденные в документах для пространственного запроса. При изменении политики индексирования с помощью портал Azure можно указать следующий JSON для политики индексирования, чтобы включить пространственное индексирование в контейнере:

**Политика индексирования контейнеров JSON с пространственным индексированием географии**

```json
    {
       "automatic":true,
       "indexingMode":"Consistent",
        "includedPaths": [
        {
            "path": "/*"
        }
        ],
        "spatialIndexes": [
        {
            "path": "/*",
            "types": [
                "Point",
                "Polygon",
                "MultiPolygon",
                "LineString"
            ]
        }
    ],
       "excludedPaths":[]
    }
```

> [!NOTE]
> Если значение расположения GeoJSON в документе сформировано неверно или является недействительным, оно не будет индексироваться для пространственных запросов. Проверить значение расположения можно с помощью ST_ISVALID и ST_ISVALIDDETAILED.
>
>
>

[Политику индексирования](how-to-manage-indexing-policy.md) также можно изменить с помощью Azure CLI, PowerShell или любого пакета SDK.

## <a name="next-steps"></a>Следующие шаги

Теперь, когда вы ознакомились с предварительными сведениями о поддержке геопространственных данных в Azure Cosmos DB, вы можете сделать следующее:

* Дополнительные сведения о запросах Azure Cosmos DB см. [здесь](sql-query-getting-started.md).
* Дополнительные сведения о [запросе пространственных данных с помощью Azure Cosmos DB](sql-query-geospatial-query.md)
* Дополнительные сведения о [геопространственных и географических данных расположения в Azure Cosmos DB](sql-query-geospatial-intro.md)