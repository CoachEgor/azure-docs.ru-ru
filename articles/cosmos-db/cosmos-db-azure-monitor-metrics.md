---
title: Получить метрики Azure Cosmos DB из Azure Monitor
description: ''
author: SnehaGunda
ms.author: sngun
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 06/18/2019
ms.openlocfilehash: 2eb61a6b9afa3cabf1733be120dfbdacb7de4534
ms.sourcegitcommit: a52d48238d00161be5d1ed5d04132db4de43e076
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/20/2019
ms.locfileid: "67276799"
---
# <a name="monitor-and-debug-azure-cosmos-db-metrics-from-azure-monitor"></a>Мониторинг и отладка метрики Azure Cosmos DB из Azure Monitor

Можно просмотреть метрики Azure Cosmos DB с Azure Monitor API. Azure Monitor предоставляет несколько способов взаимодействия с метриками, включая портал Azure, доступ к метрикам через REST API или запрос метрик с помощью PowerShell или интерфейса командной строки. Метрики Azure Cosmos DB — это числовые значения малым временем задержки, собранные в один раз в минуту по умолчанию, можно выполнять статистическое вычисление этих метрик. Эти метрики можно использовать для поддержки сценариев в реальном времени.  

В этой статье описывается другой Azure Cosmos DB метрик, которые можно просмотреть из Azure Monitor с помощью портала Azure. Если вы заинтересованы в распространенных вариантов использования и как метрики Azure Cosmos DB повторно использовать для анализа и отладки проблем см. в разделе [мониторинга и отладки с помощью метрик в Azure Cosmos DB](use-metrics.md) статьи. Будет использоваться один из существующих учетных записей Azure Cosmos и просмотреть различные метрики уровне базы данных, контейнера, регион, запроса или операции. Убедитесь, что есть учетная запись Azure Cosmos с образцами данных и выполнять операции CRUD с этими данными.

## <a name="view-metrics-from-azure-portal"></a>Просмотр метрик на портале Azure

1. Войдите на [портале Azure](https://portal.azure.com/).

1. Выберите **монитор** из левой панели навигации и выберите **метрики**.

   ![Панель метрик в Azure Monitor](./media/cosmos-db-azure-monitor-metrics/monitor-metrics-blade.png)

1. Из **метрики** области > **выберите ресурс** > выберите необходимые **подписки**, и **группы ресурсов**. Для **тип ресурса**выберите **учетных записей Azure Cosmos DB**, выберите один из существующих учетных записей Azure Cosmos и выберите **применить**. 

   ![Выберите учетную запись Cosmos DB, чтобы просмотреть метрики](./media/cosmos-db-azure-monitor-metrics/select-cosmosdb-account.png)

1. Затем можно выбрать метрики из списка доступных метрик. Можно выбрать метрики, относящиеся к единиц запроса, хранилища, задержки, доступности, Cassandra и другим пользователям. Чтобы узнать подробности о всех доступных метрик в этом списке, см. в разделе [метрик по категориям](#metrics-by-category) этой статьи. В этом примере выберем **единицы запросов** и **Avg** как значение статистической обработки. 

   Помимо этих сведений можно также выбрать **диапазон времени** и **степень детализации времени** метрик. Максимум можно просмотреть метрики за последние 30 дней.  После применения фильтра, отображается диаграмма, в зависимости от фильтра. Вы увидите среднее число единиц запроса в минуту в течение выбранного периода.  

   ![Выберите метрику на портале Azure](./media/cosmos-db-azure-monitor-metrics/metric-types.png)

## <a name="add-filters-to-metrics"></a>Добавить фильтры к метрикам

Вы также можете фильтровать метрики и диаграммы, отображаемой конкретным классом **CollectionName**, **DatabaseName**, **OperationType**, **регион**, и **StatusCode**. Выберите, чтобы отфильтровать показатели **добавить фильтр** и выберите требуемое свойство, например **OperationType** и выберите значение, например **запроса**. Затем на графике отображается единиц запроса, используемых для выполнения запроса для выбранного периода. Операций, выполняемых с помощью хранимой процедуры не регистрируются, чтобы они не доступны в разделе OperationType метрики.

![Добавить фильтр, чтобы выбрать степень детализации метрик](./media/cosmos-db-azure-monitor-metrics/add-metrics-filter.png)

Метрики можно группировать с помощью **применить разделение** параметр. Например можно сгруппировать единиц запроса в тип операции и просмотрите график для всех операций за один раз в том случае, как показано на следующем рисунке: 

![Добавить фильтр разбиения](./media/cosmos-db-azure-monitor-metrics/apply-metrics-splitting.png)


## <a id="metrics-by-category"></a>Метрики по категориям

### <a name="request-metrics"></a>Метрики запросов
            
|Метрики (отображаемое имя метрики)|Единица (тип статистической обработки) |Описание|Измерения| Степени детализации времени| Сопоставление метрик прежних версий | Использование |
|---|---|---|---| ---| ---| ---|
| TotalRequests (общее количество запросов) | Count (количество) | Количество выполненных запросов| DatabaseName, CollectionName, Region, StatusCode| Все | TotalRequests, HTTP 2xx, HTTP 3xx, HTTP 400, HTTP 401, внутренняя ошибка сервера, служба недоступна, отрегулированные запросы, среднее число запросов в секунду | Позволяет отслеживать запросы в каждом коде состояния, коллекцию со степенью детализации до минуты. Чтобы получить среднее число запросов в секунду, используйте агрегат Count в минуту и разделите на 60. |
| MetadataRequests (запросы метаданных) |Count (количество) | Количество запросов метаданных. Azure Cosmos DB поддерживает сбор метаданных системы для каждой учетной записи, который позволяет перечислять коллекции баз данных, и т.д., и их конфигураций, бесплатно. | DatabaseName, CollectionName, Region, StatusCode| Все| |Позволяет отслеживать регулирование из-за запросов метаданных.|
| MongoRequests (запросов Mongo) | Count (количество) | Количество выполненных запросов Mongo | DatabaseName, CollectionName, Region, CommandName, ErrorCode| Все |Частота запросов на запрос Mongo, частота запросов на обновление Mongo, частота запросов на удаление Mongo, частота запросов на вставку Mongo, частота запросов на количество Mongo| Позволяет отслеживать ошибки запроса Mongo, использование каждого типа команды. |

### <a name="request-unit-metrics"></a>Метрики единиц запроса

|Метрики (отображаемое имя метрики)|Единица (тип статистической обработки)|Описание|Измерения| Степени детализации времени| Сопоставление метрик прежних версий | Использование |
|---|---|---|---| ---| ---| ---|
| MongoRequestCharge (плата за запрос Mongo) | Count (всего) |Использованные единицы запросов Mongo| DatabaseName, CollectionName, Region, CommandName, ErrorCode| Все |Расходы запросов на запрос Mongo, расходы запросов на обновление Mongo, расходы запросов на удаление Mongo, расходы запросов на вставку Mongo, расходы запросов на количество Mongo| Позволяет отслеживать единицы запросов ресурсов Mongo в минуту.|
| TotalRequestUnits (общее количество единиц запросов)| Count (всего) | Использованные единицы запросов| DatabaseName, CollectionName, Region, StatusCode |Все| TotalRequestUnits| Позволяет отслеживать использование общего количества единиц запросов со степенью детализации до минуты. Чтобы получить среднее число единиц запросов, потребленных в секунду, используйте общий объем агрегата в минуту и разделите на 60.|
| ProvisionedThroughput (подготовленной пропускной способности)| Count (максимум) |Подготовленная пропускная способность в степени детализации коллекции| DatabaseName, CollectionName| 5M| | Позволяет отслеживать подготовленную пропускную способность для коллекции.|

### <a name="storage-metrics"></a>Метрики хранения

|Метрики (отображаемое имя метрики)|Единица (тип статистической обработки)|Описание|Измерения| Степени детализации времени| Сопоставление метрик прежних версий | Использование |
|---|---|---|---| ---| ---| ---|
| AvailableStorage (доступное хранилище) |Байт (всего) | Общее доступное хранилище, сообщаемые точностью до 5 минут на регион| DatabaseName, CollectionName, Region| 5M| Доступная служба хранилища| Позволяет отслеживать доступную емкость хранилища (применимо только для фиксированных коллекций хранилища). Минимальная степень детализации должна составлять 5 минут.| 
| DataUsage (использование данных) |Байт (всего) |Общий объем данных данные об использовании на уровне детализации 5 минут на регион| DatabaseName, CollectionName, Region| 5M |Размер данных | Позволяет отслеживать общий объем используемых данных в коллекции и регионе, минимальная степень детализации должна составлять 5 минут.|
| IndexUsage (использование индексов) | Байт (всего) |Общее использование индексов, сообщаемые точностью до 5 минут на регион| DatabaseName, CollectionName, Region| 5M| Размер индексов| Позволяет отслеживать общий объем используемых данных в коллекции и регионе, минимальная степень детализации должна составлять 5 минут. |
| DocumentQuota (квота документа) | Байт (всего) | Общий объем хранилища квоты сообщил точностью до 5 минут на регион.| DatabaseName, CollectionName, Region| 5M |Емкость хранилища| Позволяет отслеживать общий объем квоты в коллекции и регионе, минимальная степень детализации должна составлять 5 минут.|
| DocumentCount (число документов) | Count (всего) |Число документов общее сообщил точностью до 5 минут на регион| DatabaseName, CollectionName, Region| 5M |Число документов|Позволяет отслеживать число документов в коллекции и регионе, минимальная степень детализации должна составлять 5 минут.|

### <a name="latency-metrics"></a>Метрики задержки

|Метрики (отображаемое имя метрики)|Единица (тип статистической обработки)|Описание|Измерения| Степени детализации времени| Использование |
|---|---|---|---| ---| ---|
| ReplicationLatency (задержка репликации)| Миллисекунды (минимальное, максимальное, среднее значение) | Задержка репликации P99 между исходными и целевыми регионами для геореплицируемой учетной записи| SourceRegion, TargetRegion| Все | Позволяет отслеживать задержку репликации P99 между любыми двумя регионами для геореплицируемой учетной записи. |


### <a name="availability-metrics"></a>Метрики доступности

|Метрики (отображаемое имя метрики) |Единица (тип статистической обработки)|Описание| Степени детализации времени| Сопоставление метрик прежних версий | Использование |
|---|---|---|---| ---| ---|
| ServiceAvailability (доступность службы)| Процентов (минимум, максимум) | Доступность запросов учетной записи со степенью детализации до одного часа| 1 ч | Доступность службы | Представляет процент от общего числа, переданный запросов. Запрос считается не удавшимся из-за ошибки системы, если код состояния — 410, 500 или 503. Позволяет отслеживать доступность учетной записи со степенью детализации до одного часа. |


### <a name="cassandra-api-metrics"></a>Метрики по API Cassandra

|Метрики (отображаемое имя метрики)|Единица (тип статистической обработки)|Описание|Измерения| Степени детализации времени| Использование |
|---|---|---|---| ---| ---|
| CassandraRequests (Cassandra запросов) | Count (количество) | Количество сделанных запросов API Cassandra| DatabaseName, CollectionName, ErrorCode, Region, OperationType, ResourceType| Все| Позволяет отслеживать запросы Cassandra со степенью детализации до минуты. Чтобы получить среднее число запросов в секунду, используйте агрегат Count в минуту и разделите на 60.|
| CassandraRequestCharges (затраты запросов Cassandra) | Count (Sum, Min, Max, Avg) | Единицы запросов, потребленные запросами API Cassandra| DatabaseName, CollectionName, Region, OperationType, ResourceType| Все| Позволяет отслеживать единицы запросов, используемые в минуту учетной записью API Cassandra.|
| CassandraConnectionClosures (Cassandra замыкания соединений) |Count (количество) |Число закрытых подключений Cassandra| ClosureReason, Region| Все | Позволяет отслеживать возможность подключения между клиентами и API Cassandra для Azure Cosmos DB.|

## <a name="next-steps"></a>Дальнейшие действия

* [Просматривать метрики из области метрики учетной записи Azure Cosmos DB](use-metrics.md)

* [Ведение журналов диагностики в Azure Cosmos DB](logging.md)
