---
title: Получение метрик Azure Cosmos DB из Azure Monitor
description: Узнайте, как просматривать различные категории метрик Azure Cosmos DB из Azure Monitor с помощью портал Azure.
author: SnehaGunda
ms.author: sngun
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 09/01/2019
ms.openlocfilehash: 905eca99c137af2fd40a1243de8fabd15314477c
ms.sourcegitcommit: c2e7595a2966e84dc10afb9a22b74400c4b500ed
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/05/2019
ms.locfileid: "71973739"
---
# <a name="monitor-and-debug-azure-cosmos-db-metrics-from-azure-monitor"></a>Мониторинг и отладка Azure Cosmos DB метрик из Azure Monitor

Вы можете просмотреть метрики Azure Cosmos DB из Azure Monitor API. Azure Monitor предоставляет несколько способов взаимодействия с метриками, включая портал Azure, доступ к ним через REST API или запросы с помощью PowerShell или CLI. Метрики Azure Cosmos DB — это числовые значения с низкой задержкой, собранные по умолчанию с частотой 1 минуту. также можно выполнить статистическую обработку этих метрик. Эти метрики могут поддерживать сценарии в режиме реального времени.  

В этой статье описываются различные метрики Azure Cosmos DB, которые можно просмотреть Azure Monitor с помощью портал Azure. Если вы заинтересованы в типичных вариантах использования и как Azure Cosmos DB метрики, используемые для анализа и отладки этих проблем, см. раздел [мониторинг и отладка с помощью метрик в Azure Cosmos DB](use-metrics.md) статье. Вы будете использовать одну из существующих учетных записей Azure Cosmos и просмотреть различные метрики на уровнях базы данных, контейнера, региона, запроса или операции. Поэтому убедитесь, что у вас есть учетная запись Azure Cosmos с демонстрационными данными, и выполните операции CRUD с этими данными.

## <a name="view-metrics-from-azure-portal"></a>Просмотр метрик из портал Azure

1. Войдите на [портале Azure](https://portal.azure.com/).

1. Выберите **монитор** на панели навигации слева и щелкните **метрики**.

   ![Панель "метрики" в Azure Monitor](./media/cosmos-db-azure-monitor-metrics/monitor-metrics-blade.png)

1. В области **метрики** > **выберите ресурс** > выберите нужную **подписку**и **группу ресурсов**. Для параметра **тип ресурса**выберите **учетные записи Azure Cosmos DB**, выберите одну из существующих учетных записей Azure Cosmos и нажмите кнопку **Применить**. 

   ![Выберите учетную запись Cosmos DB для просмотра метрик](./media/cosmos-db-azure-monitor-metrics/select-cosmosdb-account.png)

1. Затем можно выбрать метрику из списка доступных метрик. Вы можете выбрать метрики, связанные с единицами запросов, хранилищем, задержкой, доступностью, Cassandra и другими. Подробные сведения обо всех доступных метриках в этом списке см. в разделе [метрики по категориям](#metrics-by-category) этой статьи. В этом примере давайте выберем **единицы запроса** и **AVG** в качестве значения статистической обработки. 

   В дополнение к этим сведениям можно также выбрать **диапазон времени** и **степень гранулярности времени** метрик. В поле максимум можно просмотреть метрики за последние 30 дней.  После применения фильтра на основе фильтра отобразится диаграмма. Вы видите среднее количество единиц запросов, потребляемых в минуту за выбранный период.  

   ![Выберите метрику из портал Azure](./media/cosmos-db-azure-monitor-metrics/metric-types.png)

## <a name="add-filters-to-metrics"></a>Добавление фильтров в метрики

Можно также фильтровать метрики и диаграмму, отображаемую конкретными **CollectionName**, **DatabaseName**, **OperationType**, **Region**и **StatusCode**. Чтобы отфильтровать метрики, выберите **Добавить фильтр** и выберите требуемое свойство, например **OperationType** , и выберите значение, например **запрос**. Затем на графе отображаются единицы запросов, использованные для операции запроса за выбранный период. Операции, выполняемые с помощью хранимой процедуры, не регистрируются в журнале, поэтому они недоступны в метрике OperationType.

![Добавление фильтра для выбора степени гранулярности метрики](./media/cosmos-db-azure-monitor-metrics/add-metrics-filter.png)

Метрики можно группировать с помощью параметра **Применить разделение** . Например, можно сгруппировать единицы запросов на тип операции и просмотреть граф для всех операций одновременно, как показано на следующем рисунке: 

![Добавить фильтр "применить разделение"](./media/cosmos-db-azure-monitor-metrics/apply-metrics-splitting.png)


## <a id="metrics-by-category"></a>Метрики по категориям

### <a name="request-metrics"></a>Метрики запросов
            
|Метрика (отображаемое имя метрики)|Единица (тип агрегирования) |Описание|Измерения| Степени детализации времени| Сопоставление метрик прежних версий | Использование |
|---|---|---|---| ---| ---| ---|
| TotalRequests (Всего запросов) | Количество (число) | Количество выполненных запросов| DatabaseName, CollectionName, Region, StatusCode| Все | TotalRequests, HTTP 2xx, HTTP 3xx, HTTP 400, HTTP 401, внутренняя ошибка сервера, служба недоступна, отрегулированные запросы, среднее число запросов в секунду | Используется для отслеживания запросов по коду состояния, контейнеру с поминутной гранулярностью. Чтобы получить среднее число запросов в секунду, используйте агрегат Count в минуту и разделите на 60. |
| Метадатарекуестс (запросы метаданных) |Количество (число) | Количество запросов метаданных. Azure Cosmos DB поддерживает контейнер системных метаданных для каждой учетной записи, что позволяет перечислять коллекции, базы данных и т. д. и их конфигурации без оплаты. | DatabaseName, CollectionName, Region, StatusCode| Все| |Позволяет отслеживать регулирование из-за запросов метаданных.|
| MongoRequests (запросы Mongo) | Количество (число) | Количество выполненных запросов Mongo | DatabaseName, CollectionName, Region, CommandName, ErrorCode| Все |Частота запросов на запрос Mongo, частота запросов на обновление Mongo, частота запросов на удаление Mongo, частота запросов на вставку Mongo, частота запросов на количество Mongo| Позволяет отслеживать ошибки запроса Mongo, использование каждого типа команды. |

### <a name="request-unit-metrics"></a>Метрики единиц запроса

|Метрика (отображаемое имя метрики)|Единица (тип агрегирования)|Описание|Измерения| Степени детализации времени| Сопоставление метрик прежних версий | Использование |
|---|---|---|---| ---| ---| ---|
| Монгорекуестчарже (плата за запрос Mongo) | Количество (всего) |Использованные единицы запросов Mongo| DatabaseName, CollectionName, Region, CommandName, ErrorCode| Все |Расходы запросов на запрос Mongo, расходы запросов на обновление Mongo, расходы запросов на удаление Mongo, расходы запросов на вставку Mongo, расходы запросов на количество Mongo| Позволяет отслеживать единицы запросов ресурсов Mongo в минуту.|
| Тоталрекуестунитс (общее количество единиц запросов)| Количество (всего) | Использованные единицы запросов| DatabaseName, CollectionName, Region, StatusCode |Все| TotalRequestUnits| Позволяет отслеживать использование общего количества единиц запросов со степенью детализации до минуты. Чтобы получить среднее число единиц запросов, потребленных в секунду, используйте общий объем агрегата в минуту и разделите на 60.|
| Провисионедсраугхпут (подготовленная пропускная способность)| Количество (максимум) |Подготовленная пропускная способность на уровне гранулярности контейнера| DatabaseName, ContainerName| 5M| | Используется для мониторинга подготовленной пропускной способности для каждого контейнера.|

### <a name="storage-metrics"></a>Метрики хранения

|Метрика (отображаемое имя метрики)|Единица (тип агрегирования)|Описание|Измерения| Степени детализации времени| Сопоставление метрик прежних версий | Использование |
|---|---|---|---| ---| ---| ---|
| Аваилаблестораже (Доступное хранилище) |Байт (всего) | Общее Доступное хранилище, зарегистрированное в 5-минутном уровне детализации для региона| DatabaseName, CollectionName, Region| 5M| Доступная служба хранилища| Позволяет отслеживать доступную емкость хранилища (применимо только для фиксированных коллекций хранилища). Минимальная степень детализации должна составлять 5 минут.| 
| Использование данных (использование) |Байт (всего) |Общее количество использованных данных в 5-минутном уровне на регион| DatabaseName, CollectionName, Region| 5M |Размер данных | Для мониторинга общего использования данных в контейнере и регионе минимальная степень детализации должна составлять 5 минут.|
| Индексусаже (использование индекса) | Байт (всего) |Общее использование индекса получено в течение 5 минут на регион| DatabaseName, CollectionName, Region| 5M| Размер индекса| Для мониторинга общего использования данных в контейнере и регионе минимальная степень детализации должна составлять 5 минут. |
| Документкуота (квота документа) | Байт (всего) | Общая квота хранилища сообщила об уровне детализации в 5 минут на регион.| DatabaseName, CollectionName, Region| 5M |Емкость хранилища| Используется для мониторинга общей квоты в контейнере и регионе, минимальная степень детализации должна составлять 5 минут.|
| Документкаунт (число документов) | Количество (всего) |Общее число документов, сообщаемых с детализацией по 5 минутам на регион| DatabaseName, CollectionName, Region| 5M |Число документов|Используется для мониторинга количества документов в контейнере и регионе, минимальная степень детализации должна составлять 5 минут.|

### <a name="latency-metrics"></a>Метрики задержки

|Метрика (отображаемое имя метрики)|Единица (тип агрегирования)|Описание|Измерения| Степени детализации времени| Использование |
|---|---|---|---| ---| ---|
| Репликатионлатенци (задержка репликации)| Миллисекунды (минимальное, максимальное, среднее) | Задержка репликации P99 между исходными и целевыми регионами для геореплицируемой учетной записи| SourceRegion, TargetRegion| Все | Позволяет отслеживать задержку репликации P99 между любыми двумя регионами для геореплицируемой учетной записи. |


### <a name="availability-metrics"></a>Метрики доступности

|Метрика (отображаемое имя метрики) |Единица (тип агрегирования)|Описание| Степени детализации времени| Сопоставление метрик прежних версий | Использование |
|---|---|---|---| ---| ---|
| Сервицеаваилабилити (доступность службы)| Процент (минимум, максимум) | Доступность запросов учетной записи со степенью детализации до одного часа| 1 ч | Доступность службы | Представляет процент от общего числа переданных запросов. Запрос считается не удавшимся из-за ошибки системы, если код состояния — 410, 500 или 503. Позволяет отслеживать доступность учетной записи со степенью детализации до одного часа. |


### <a name="cassandra-api-metrics"></a>Метрики по API Cassandra

|Метрика (отображаемое имя метрики)|Единица (тип агрегирования)|Описание|Измерения| Степени детализации времени| Использование |
|---|---|---|---| ---| ---|
| Кассандрарекуестс (запросы Cassandra) | Количество (число) | Количество сделанных запросов API Cassandra| DatabaseName, CollectionName, ErrorCode, Region, OperationType, ResourceType| Все| Позволяет отслеживать запросы Cassandra со степенью детализации до минуты. Чтобы получить среднее число запросов в секунду, используйте агрегат Count в минуту и разделите на 60.|
| Кассандрарекуестчаржес (плата за запрос Cassandra) | Количество (SUM, min, Max, AVG) | Единицы запросов, потребленные запросами API Cassandra| DatabaseName, CollectionName, Region, OperationType, ResourceType| Все| Позволяет отслеживать единицы запросов, используемые в минуту учетной записью API Cassandra.|
| Кассандраконнектионклосурес (замыкания на Cassandra подключения) |Количество (число) |Число закрытых подключений Cassandra| ClosureReason, Region| Все | Позволяет отслеживать возможность подключения между клиентами и API Cassandra для Azure Cosmos DB.|

## <a name="next-steps"></a>Следующие шаги

* [Просмотр и мониторинг метрик на панели метрик учетной записи Azure Cosmos DB](use-metrics.md)

* [Ведение журнала диагностики в Azure Cosmos DB](logging.md)
