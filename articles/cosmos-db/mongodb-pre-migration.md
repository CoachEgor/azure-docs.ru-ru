---
title: Предмиграционные шаги для миграции данных в API API Azure Cosmos DB для MongoDB
description: Этот документ предоставляет обзор предпосылок для миграции данных из MongoDB в Космос DB.
author: LuisBosquez
ms.service: cosmos-db
ms.subservice: cosmosdb-mongo
ms.topic: conceptual
ms.date: 01/09/2020
ms.author: lbosq
ms.openlocfilehash: 73ac1a6ffd5fc2b2d52f169e1e0332044638f9f7
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75942079"
---
# <a name="pre-migration-steps-for-data-migrations-from-mongodb-to-azure-cosmos-dbs-api-for-mongodb"></a>Предмиграционные шаги для миграции данных из MongoDB в API API Azure Cosmos DB для MongoDB

Перед переносом данных из MongoDB (в помещении или в облаке) в API-изъяне Azure Cosmos DB для MongoDB следует:

1. [Ознакомьте основные соображения об использовании API-изап-центра Azure Cosmos DB для MongoDB](#considerations)
2. [Выберите опцию переноса данных](#options)
3. [Оценить пропускную работу, необходимую для рабочих нагрузок](#estimate-throughput)
4. [Выберите оптимальный ключ раздела для данных](#partitioning)
5. [Понимание политики индексирования, которую можно установить на данных](#indexing)

Если вы уже завершили приведенные выше предварительные требования к миграции, вы можете [перенести данные MongoDB в API API Azure Cosmos DB для MongoDB с помощью службы миграции базы данных Azure.](../dms/tutorial-mongodb-cosmos-db.md) Кроме того, если вы еще не создали учетную запись, вы можете просмотреть любой из [кикстартов,](create-mongodb-dotnet.md) которые показывают шаги для создания учетной записи.

## <a name="considerations-when-using-azure-cosmos-dbs-api-for-mongodb"></a><a id="considerations"></a>Рассмотрение при использовании API-избивательов Azure Cosmos DB для MongoDB

Ниже приведены специфические характеристики API API Azure Cosmos DB для MongoDB:

- **Модель емкости**: Емкость базы данных на Azure Cosmos DB основана на модели на основе пропускной способности. Эта модель основана на [единицах запроса в секунду,](request-units.md)которая представляет собой единицу, которая представляет количество операций базы данных, которые могут быть выполнены против коллекции в секунду. Эта емкость может быть выделена на [уровне базы данных или сбора,](set-throughput.md)и она может быть подготовлена по модели распределения, или с помощью [модели AutoPilot.](provision-throughput-autopilot.md)

- **Единицы запроса**: Каждая операция базы данных имеет связанные единицы запроса (RUs) в Azure Cosmos DB. При выполнении это вычитается из доступного уровня единиц запроса в заданную секунду. Если запрос требует больше RUs, чем выделенные в настоящее время RU/s, есть два варианта решения проблемы - увеличить количество RUs, или подождать, пока начнется следующая секунда, а затем повторить операцию.

- **Эластичная емкость**: Емкость данной коллекции или базы данных может изменяться в любое время. Это позволяет базе данных упруго адаптироваться к требованиям пропускной связи рабочей нагрузки.

- **Автоматическое осколочное :** Azure Cosmos DB обеспечивает автоматическую систему перегородки, которая требует только осколок (или ключа перегородки). [Механизм автоматического разгородки](partition-data.md) используется во всех AAP Azure Cosmos DB и обеспечивает бесшовные данные и масштабирование через горизонтальное распределение.

## <a name="migration-options-for-azure-cosmos-dbs-api-for-mongodb"></a><a id="options"></a>Варианты миграции для API API Azure Cosmos DB для MongoDB

[Служба миграции базы данных Azure Database для API API Azure Cosmos DB для MongoDB](../dms/tutorial-mongodb-cosmos-db.md) предоставляет механизм, который упрощает миграцию данных, предоставляя полностью управляемую хостинговую платформу, параметры мониторинга миграции и автоматическую обработку регулирования. Полный список опций:

|**Тип перемещения**|**Решение**|**Соображения**|
|---------|---------|---------|
|Вне сети|[Инструмент миграции данных](https://docs.microsoft.com/azure/cosmos-db/import-data)|&bull;Легко настроить и поддерживает несколько источников <br/>&bull;Не подходит для больших наборов данных.|
|Вне сети|[Фабрика данных Azure](https://docs.microsoft.com/azure/data-factory/connector-azure-cosmos-db)|&bull;Легко настроить и поддерживает несколько источников <br/>&bull;Использует библиотеку-исполнителя Azure Cosmos DB <br/>&bull;Подходит для больших наборов данных <br/>&bull;Отсутствие контрольно-пропускных пунктов означает, что любая проблема в ходе миграции потребует перезапуска всего процесса миграции<br/>&bull;Отсутствие мертвой очереди букв будет означать, что несколько ошибочных файлов могут остановить весь процесс миграции <br/>&bull;Требуется пользовательский код для увеличения пропускной вышифы чтения для определенных источников данных|
|Вне сети|[Существующие инструменты mongo (mongodump, mongorestore, Studio3T)](https://azure.microsoft.com/resources/videos/using-mongodb-tools-with-azure-cosmos-db/)|&bull;Легко настроить и интегрировать <br/>&bull;Потребности пользовательской обработки для дроссельной заслонки|
|Справка в Интернете|[Azure Database Migration Service](../dms/tutorial-mongodb-cosmos-db-online.md)|&bull;Полностью управляемая миграционная служба.<br/>&bull;Предоставляет решения для размещения и мониторинга для задачи миграции. <br/>&bull;Подходит для больших наборов данных и заботится о воспроизведении живых изменений <br/>&bull;Работает только с другими источниками MongoDB|


## <a name="estimate-the-throughput-need-for-your-workloads"></a><a id="estimate-throughput"></a>Оцените потребность в пропускной необходимости для рабочих нагрузок

В Azure Cosmos DB пропускная связь предоставляется заранее и измеряется в единицах запроса (RU) в секунду. В отличие от vMs или наемных серверов, RUs легко масштабировать вверх и вниз в любое время. Вы можете мгновенно изменить количество подготовленных RUs. Дополнительные сведения см. в статье [Единицы запроса в базе данных Azure Cosmos DB](request-units.md).

[Калькулятор емкости Azure Cosmos DB](https://cosmos.azure.com/capacitycalculator/) можно определить количество единиц запроса на основе конфигурации учетной записи базы данных, объема данных, размера документа и требуемых считок и записей в секунду.

Ниже приведены ключевые факторы, влияющие на количество необходимых RUs:
- **Размер документа**: По мере увеличения размера элемента/документа увеличивается также количество RUs, потребляемых для чтения или написания элемента/документа.

- **Количество свойств документов:** количество RUs, потребляемых для создания или обновления документа, связано с числом, сложностью и длиной его свойств. Можно уменьшить потребление единицы запроса для операций записи, [ограничив количество индексированных свойств.](mongodb-indexing.md)

- **Шаблоны запросов**: Сложность запроса влияет на количество единиц запроса, потребляемых запросом. 

Лучший способ понять стоимость запросов — использовать выборочные данные в Azure Cosmos DB [и запускать выборочные запросы из оболочки MongoDB с](connect-mongodb-account.md) помощью `getLastRequestStastistics` команды для получения платы за запрос, который выведет количество потребляемых RУ:

`db.runCommand({getLastRequestStatistics: 1})`

Эта команда выводит документ JSON, похожий на следующее:

```{  "_t": "GetRequestStatisticsResponse",  "ok": 1,  "CommandName": "find",  "RequestCharge": 10.1,  "RequestDurationInMilliSeconds": 7.2}```

Можно также использовать [диагностические настройки,](cosmosdb-monitor-resource-logs.md) чтобы понять частоту и закономерности запросов, выполняемых в отношении Azure Cosmos DB. Результаты диагностических журналов могут быть отправлены на учетную запись хранения, экземпляр EventHub или [аналитику журналов Azure.](https://docs.microsoft.com/azure/azure-monitor/log-query/get-started-portal)  

## <a name="choose-your-partition-key"></a><a id="partitioning"></a>Выберите ключ раздела
Раздел, также известный как Sharding, является ключевым моментом рассмотрения перед миграцией данных. Azure Cosmos DB использует полностью управляемый раздел для увеличения емкости базы данных для удовлетворения требований к хранению и пропускной способности. Эта функция не нуждается в хостинге или конфигурации серверов для разгрома.   

Аналогичным образом возможность раздела автоматически добавляет емкость и соответствующим образом перебалансирует данные. Для получения подробной информации и рекомендаций по выбору правильного ключа раздела для ваших данных, пожалуйста, смотрите [статью «Ключ к разделу».](https://docs.microsoft.com/azure/cosmos-db/partitioning-overview#choose-partitionkey) 

## <a name="index-your-data"></a><a id="indexing"></a>Индексирование данных
По умолчанию Azure Cosmos DB обеспечивает автоматическую индексацию всех вставленных данных. Возможности индексирования, предоставляемые Azure Cosmos DB, включают добавление композитных индексов, уникальных индексов и индексов time-to-live (TTL). Интерфейс управления индексом отображается `createIndex()` в команде. Узнайте больше на [индексировании в API API Azure Cosmos DB для MongoDB.](mongodb-indexing.md)

[Миграционная служба лазурных баз данных](../dms/tutorial-mongodb-cosmos-db.md) автоматически мигрирует в коллекции MongoDB с уникальными индексами. Однако уникальные индексы должны быть созданы до миграции. Azure Cosmos DB не поддерживает создание уникальных индексов, когда в ваших коллекциях уже есть данные. Дополнительные сведения см. в статье об [уникальных ключах в Azure Cosmos DB](unique-keys.md).

## <a name="next-steps"></a>Дальнейшие действия
* [Переносите данные MongoDB в Cosmos DB с помощью миграционной службы базы данных.](../dms/tutorial-mongodb-cosmos-db.md) 
* [Подготовка пропускной способности в контейнерах и базах данных Azure Cosmos](set-throughput.md)
* [Секционирование в базе данных Azure Cosmos DB](partition-data.md)
* [Глобальное распределение в Azure Cosmos DB](distribute-data-globally.md)
* [Индексирование в Azure Cosmos DB](index-overview.md)
* [Запросные подразделения в Azure Cosmos DB](request-units.md)
