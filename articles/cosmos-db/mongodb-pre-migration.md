---
title: Шаги перед переносом для переноса данных в API Azure Cosmos DB для MongoDB
description: Этот документ содержит общие сведения о предварительных требованиях для переноса данных из MongoDB в Cosmos DB.
author: LuisBosquez
ms.service: cosmos-db
ms.subservice: cosmosdb-mongo
ms.topic: conceptual
ms.date: 01/09/2020
ms.author: lbosq
ms.openlocfilehash: 73ac1a6ffd5fc2b2d52f169e1e0332044638f9f7
ms.sourcegitcommit: b5106424cd7531c7084a4ac6657c4d67a05f7068
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/14/2020
ms.locfileid: "75942079"
---
# <a name="pre-migration-steps-for-data-migrations-from-mongodb-to-azure-cosmos-dbs-api-for-mongodb"></a>Действия, выполняемые перед переносом данных из MongoDB в API Azure Cosmos DB для MongoDB

Перед переносом данных из MongoDB (локально или в облаке) в API Azure Cosmos DB для MongoDB необходимо выполнить следующие действия.

1. [Ознакомьтесь с основными замечаниями об использовании API Azure Cosmos DB для MongoDB.](#considerations)
2. [Выберите параметр для переноса данных](#options)
3. [Оценка пропускной способности, необходимой для рабочих нагрузок](#estimate-throughput)
4. [Выбор оптимального ключа секции для данных](#partitioning)
5. [Общие сведения о политике индексирования, которую можно задать для данных](#indexing)

Если вы уже выполнили описанные выше предварительные требования для миграции, вы можете [перенести данные MongoDB в API Azure Cosmos DB для MongoDB с помощью Azure Database Migration Service](../dms/tutorial-mongodb-cosmos-db.md). Кроме того, если вы еще не создали учетную запись, можно просмотреть любое из [кратких](create-mongodb-dotnet.md) руководств, в которых приведены действия по созданию учетной записи.

## <a id="considerations"></a>Рекомендации по использованию API Azure Cosmos DB для MongoDB

Ниже приведены конкретные характеристики API Azure Cosmos DB для MongoDB.

- **Модель емкости**. емкость базы данных на Azure Cosmos DB зависит от модели на основе пропускной способности. Эта модель основана на [единицах запросов в секунду](request-units.md). это единица, представляющая количество операций с базами данных, которые могут быть выполнены с коллекцией в секунду. Эта емкость может быть выделена на [уровне базы данных или коллекции](set-throughput.md)и может быть подготовлена в модели распределения или с помощью [модели автопилота](provision-throughput-autopilot.md).

- **Единицы запросов**: каждая операция базы данных имеет связанные единицы запроса (RUs) в Azure Cosmos DB. При исполнении это значение вычитается из доступного уровня единиц запросов в заданной секунде. Если для запроса требуется больше запросов, чем выделено единиц запросов в секунду, можно решить проблему двумя способами — увеличить количество получателей или подождать до начала следующей секунды, а затем повторить операцию.

- **Эластичная емкость**. емкость для данной коллекции или базы данных может измениться в любое время. Это позволяет гибко адаптировать базу данных к требованиям рабочей нагрузки к пропускной способности.

- **Автоматическое сегментирование**: Azure Cosmos DB предоставляет автоматическую систему секционирования, для которой требуется только сегмент (или ключ секции). [Механизм автоматического секционирования](partition-data.md) совместно используется всеми интерфейсами API Azure Cosmos DB и обеспечивает бесперебойность данных и масштабирование через горизонтальное распределение.

## <a id="options"></a>Параметры миграции для API Azure Cosmos DB для MongoDB

[Azure Database Migration Service для API Azure Cosmos DB для MongoDB](../dms/tutorial-mongodb-cosmos-db.md) предоставляет механизм, который упрощает перенос данных за счет предоставления полностью управляемой платформы размещения, параметров мониторинга миграции и автоматического регулирования. Ниже приведен полный список параметров.

|**Тип миграции**|**Решение**|**Рекомендации**|
|---------|---------|---------|
|Вне сети|[Средство переноса данных](https://docs.microsoft.com/azure/cosmos-db/import-data)|&bull; простота настройки и поддержки нескольких источников <br/>&bull; не подходит для больших наборов данных.|
|Вне сети|[Фабрика данных Azure](https://docs.microsoft.com/azure/data-factory/connector-azure-cosmos-db).|&bull; простота настройки и поддержки нескольких источников <br/>&bull; использует библиотеку Azure Cosmos DBного выполнителя <br/>&bull; подходит для больших наборов данных <br/>&bull; отсутствия контрольных точек означает, что все проблемы во время миграции потребуют перезапуска всего процесса миграции.<br/>&bull; недостаток очереди недоставленных сообщений означает, что несколько ошибочных файлов могут прерывать весь процесс миграции. <br/>&bull; требуется пользовательский код для увеличения пропускной способности чтения для определенных источников данных|
|Вне сети|[Существующие средства Mongo (монгодумп, mongorestore, Studio3T)](https://azure.microsoft.com/resources/videos/using-mongodb-tools-with-azure-cosmos-db/)|&bull; простота настройки и интеграции <br/>&bull; требуется настраиваемая обработка для регулирования|
|В сети|[Azure Database Migration Service](../dms/tutorial-mongodb-cosmos-db-online.md)|&bull; полностью управляемую службу миграции.<br/>&bull; предоставляет решения для размещения и мониторинга для задачи миграции. <br/>&bull; подходит для больших наборов данных и отвечает за репликацию динамических изменений <br/>&bull; работает только с другими источниками MongoDB|


## <a id="estimate-throughput"></a>Оценка потребности в пропускной способности для рабочих нагрузок

В Azure Cosmos DB пропускная способность подготавливается заранее и измеряется в единицах запроса (RU) в секунду. В отличие от виртуальных машин или локальных серверов, сервер RUs легко масштабируется в любое время. Можно мгновенно изменить число подготовленных получателей. Дополнительные сведения см. в статье [Единицы запроса в базе данных Azure Cosmos DB](request-units.md).

[Калькулятор емкости Azure Cosmos DB](https://cosmos.azure.com/capacitycalculator/) можно использовать для определения количества единиц запросов на основе конфигурации учетной записи базы данных, объема данных, размера документа и требуемых операций чтения и записи в секунду.

Ниже приведены ключевые факторы, влияющие на количество необходимых получателей.
- **Размер документа**: при увеличении размера элемента или документа число получателей, потребляемое для чтения или записи элемента или документа, также увеличивается.

- **Число свойств документа**. количество операций получения, использованных для создания или обновления документа, связано с числом, сложностью и длиной его свойств. Можно уменьшить потребление единиц запросов для операций записи, [ограничивая количество индексированных свойств](mongodb-indexing.md).

- **Шаблоны запросов**. сложность запроса влияет на количество единиц запросов, потребляемых запросом. 

Лучшим способом понять стоимость запросов является использование демонстрационных данных в Azure Cosmos DB [и выполнение примеров запросов из оболочки MongoDB](connect-mongodb-account.md) с помощью команды `getLastRequestStastistics` для получения платы за запрос, в результате чего выводится число использований.

`db.runCommand({getLastRequestStatistics: 1})`

Эта команда выводит документ JSON следующего вида:

```{  "_t": "GetRequestStatisticsResponse",  "ok": 1,  "CommandName": "find",  "RequestCharge": 10.1,  "RequestDurationInMilliSeconds": 7.2}```

Можно также использовать [параметры диагностики](cosmosdb-monitor-resource-logs.md) , чтобы узнать частоту и шаблоны запросов, выполняемых в Azure Cosmos DB. Результаты из журналов диагностики можно отправить в учетную запись хранения, экземпляр EventHub или [Azure log Analytics](https://docs.microsoft.com/azure/azure-monitor/log-query/get-started-portal).  

## <a id="partitioning"></a>Выбор ключа секции
Секционирование, также называемое сегментированием, является ключевой точкой для рассмотрения перед переносом данных. Azure Cosmos DB использует полностью управляемое секционирование для увеличения емкости базы данных в соответствии с требованиями к хранилищу и пропускной способности. Для этого компонента не требуется размещение или Настройка серверов маршрутизации.   

Аналогичным образом функция секционирования автоматически добавляет емкость и повторно распределяет данные соответствующим образом. Дополнительные сведения и рекомендации по выбору правильного ключа секции для данных см. в [статье Выбор ключа секции](https://docs.microsoft.com/azure/cosmos-db/partitioning-overview#choose-partitionkey). 

## <a id="indexing"></a>Индексирование данных
По умолчанию Azure Cosmos DB обеспечивает автоматическое индексирование всех вставленных данных. Возможности индексирования, предоставляемые Azure Cosmos DB, включают добавление составных индексов, уникальных индексов и индексов срока жизни (TTL). Интерфейс управления индексами сопоставляется с командой `createIndex()`. Дополнительные сведения см. [в статье индексирование в API Azure Cosmos DB для MongoDB](mongodb-indexing.md).

[Azure Database Migration Service](../dms/tutorial-mongodb-cosmos-db.md) автоматически переносит коллекции MongoDB с уникальными индексами. Однако перед миграцией необходимо создать уникальные индексы. Azure Cosmos DB не поддерживает создание уникальных индексов, если в коллекциях уже есть данные. Дополнительные сведения см. в статье об [уникальных ключах в Azure Cosmos DB](unique-keys.md).

## <a name="next-steps"></a>Дальнейшие действия
* [Перенесите данные MongoDB в Cosmos DB с помощью Database Migration Service.](../dms/tutorial-mongodb-cosmos-db.md) 
* [Обеспечение пропускной способности в контейнерах и базах данных Azure Cosmos](set-throughput.md)
* [Partitioning in Azure Cosmos DB](partition-data.md) (Секционирование в Azure Cosmos DB)
* [Глобальное распределение в Azure Cosmos DB](distribute-data-globally.md)
* [Индексирование в Azure Cosmos DB](index-overview.md)
* [Единицы запросов в Azure Cosmos DB](request-units.md)
