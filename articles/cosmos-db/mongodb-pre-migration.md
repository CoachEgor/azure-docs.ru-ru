---
title: Шаги подготовки к миграции для перемещения данных из MongoDB для Azure Cosmos DB API для MongoDB
description: Этот документ содержит общие сведения о предварительных требований для переноса данных из MongoDB в Cosmos DB.
author: roaror
ms.service: cosmos-db
ms.subservice: cosmosdb-mongo
ms.topic: conceptual
ms.date: 04/17/2019
ms.author: roaror
ms.openlocfilehash: 476a143555323bbb5058541000a5b1a26d23b71a
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "61330869"
---
# <a name="pre-migration-steps-for-data-migrations-from-mongodb-to-azure-cosmos-dbs-api-for-mongodb"></a>Шаги подготовки к миграции для перемещения данных из MongoDB для Azure Cosmos DB API для MongoDB

Перед переносом данных из MongoDB (локально или в облаке (IaaS)) для Azure Cosmos DB API для MongoDB, вы должны:

1. [Создание учетной записи Azure Cosmos DB](#create-account)
2. [Оценить пропускную способность, необходимые для рабочих нагрузок](#estimate-throughput)
3. [Выбрать ключ оптимальной секции для ваших данных](#partitioning)
4. [Понимание политики индексирования, которые можно задать на данные](#indexing)

Если вы уже выполнили выше предварительные требования для миграции, см. в разделе [данных переноса MongoDB для Azure Cosmos DB API для MongoDB](../dms/tutorial-mongodb-cosmos-db.md) для инструкции по переносу фактические данные. В противном случае этот документ содержит инструкции для обработки этих компонентов. 

## <a id="create-account"></a> Создание учетной записи Azure Cosmos DB 

Перед началом миграции, необходимо [создать учетную запись Azure Cosmos с помощью API Azure Cosmos DB для MongoDB](create-mongodb-dotnet.md). 

При создании учетной записи, можно выбрать параметры для [глобально распространить](distribute-data-globally.md) ваши данные. Также имеется параметр, чтобы включить нескольких регионах записи (или конфигурации с несколькими хозяевами), позволит каждой базе данных в областях для обоих записи и чтения, регион.

![Создание учетной записи](./media/mongodb-pre-migration/account-creation.png)

## <a id="estimate-throughput"></a> Оценка использования пропускной способности для рабочих нагрузок

Перед началом миграции с помощью [Database Migration Service (DMS)](../dms/dms-overview.md), следует оценить объем пропускной способности для подготовки для базы данных Azure Cosmos и коллекций.

Либо можно выполнить подготовку пропускной способности.

- Коллекция

- База данных

> [!NOTE]
> Также возможно сочетание перечисленных выше, где некоторые коллекции в базе данных может создать отдельные Подготовка пропускной способности и другие могут совместно использовать пропускную способность. Сведения см. в разделе [Настройка пропускной способности на базу данных и контейнер](set-throughput.md) страницы.
>

Сначала следует решить, нужно ли подготовить базы данных или уровня пропускной способности коллекции или их сочетание. Как правило рекомендуется настроить выделенную пропускную способность на уровне коллекции. Подготавливая пропускную способность на уровне базы данных позволяет коллекции в базе данных для совместного использования подготовленной пропускной способности. С общей пропускной способности Однако нет никакой гарантии для определенной пропускной способности для каждой отдельной коллекции, и вы не получаете прогнозируемую производительность на любой указанной коллекции.

Если вы не знаете точно, насколько большую пропускную способность должен быть выделенным для каждой отдельной коллекции, вы можете пропускной способности на уровне базы данных. Можно представить подготовленной пропускной способности настроен на базе данных Azure Cosmos как логический эквивалент, вычислительной мощности виртуальной Машины MongoDB или физического сервера, но более экономичным возможность гибко масштабировать. Дополнительные сведения см. в разделе [Подготовка пропускной способности в базах данных и контейнеры Azure Cosmos](set-throughput.md).

Если вы подготавливаете пропускную способность на уровне базы данных, все коллекции, созданные в этой базе данных должны создаваться с помощью ключа секции или сегмента. Дополнительные сведения о секционировании см. в разделе [секционирование и горизонтальное масштабирование в Azure Cosmos DB](partition-data.md). Если не указать ключ раздела/сегментов во время миграции, Azure Database Migration Service автоматически заполняет поле ключа сегментов с *_id* атрибут, который автоматически создается для каждого документа.

### <a name="optimal-number-of-request-units-rus-to-provision"></a>Оптимальное количество единиц запросов (ЕЗ) для подготовки

В Azure Cosmos DB пропускная способность подготавливается заранее и измеряется в единицах запроса (ЕЗ) в секунду. При наличии рабочих нагрузок, выполняемых MongoDB на виртуальной Машине или в локальной, считать единицы Запроса простые абстракции для физических ресурсов, такие как размер виртуальной Машины или – это локальные серверы, а также ресурсы, они имеют, например, памяти, ЦП, операций ввода-вывода. 

В отличие от виртуальных машин или на локальных серверах RUs можно легко масштабировать в любое время. Количеством подготовленных зарезервированных единиц можно изменить в течение нескольких секунд, и плата взимается только за максимальное число ЕЗ, которые можно подготовить за определенный период один час. Дополнительные сведения см. в статье [Единицы запроса в базе данных Azure Cosmos DB](request-units.md).

Ниже приведены ключевые факторы, влияющие на число необходимых единиц запросов.
- **Размер элемента (т. е. документ)** : С увеличением размера элемента или документа, количество ЕЗ запросов, расходуемых на чтение или запись элемента или документа также увеличивается.
- **Число свойств элемента**. При условии, что [индексирования по умолчанию](index-overview.md) обо всех свойствах, количество ЕЗ запросов, расходуемых на запись элемента увеличивает увеличением количества свойств элемента. Можно сократить расход единиц запросов для операций записи, выполненных [ограничение на количество индексированных свойств](index-policy.md).
- **Параллельные операции**: Запрос единиц запросов, расходуемых также зависит от частоты какие разных операций CRUD (например, операции записи, операций чтения, обновления, удаления) и более сложные запросы выполняются. Можно использовать [mongostat](https://docs.mongodb.com/manual/reference/program/mongostat/) для вывода потребностей параллелизма текущих данных MongoDB.
- **Шаблоны запросов**. Сложность запроса влияет на количество единиц запросов использованных запросом.

Если вы экспортируете файлы JSON с помощью [mongoexport](https://docs.mongodb.com/manual/reference/program/mongoexport/) и понять, сколько операций записи, чтения, обновления и удаления которые происходят в секунду, можно использовать [планировщик Azure Cosmos DB](https://www.documentdb.com/capacityplanner) для оценки Начальное количество единиц запросов для подготовки. Планировщик не влияют на стоимость более сложные запросы. Таким образом Если у вас есть сложные запросы на данные, будут использоваться дополнительные ЕЗ. Калькулятор также предполагается, что индексируются все поля, и используется согласованность уровня сеанса. Лучший способ понять стоимость запросов — перенос данных (или образец данных) в Azure Cosmos DB [подключиться к конечной точке в Cosmos DB](connect-mongodb-account.md) и выполнить образец запроса из оболочки MongoDB с помощью `getLastRequestStastistics` команду, чтобы получить плата за запрос, который будет выдавать количество в единицах запроса:

`db.runCommand({getLastRequestStatistics: 1})`

Эта команда выведет документ JSON, аналогичную следующей:

```{  "_t": "GetRequestStatisticsResponse",  "ok": 1,  "CommandName": "find",  "RequestCharge": 10.1,  "RequestDurationInMilliSeconds": 7.2}```

После того как вы понимаете количество ЕЗ, использованных запросом и параллельное для этого запроса, можно настроить количеством подготовленных зарезервированных единиц. Оптимизация RUs не является одноразовым событием - постоянно следует оптимизировать или увеличить масштаб единиц, в зависимости от того не ожидается интенсивного трафика, в отличие от высокой рабочей нагрузки или импорт данных.

## <a id="partitioning"></a>Выберите ключ секции
Секционирование является ключевой момент следует учитывать перед миграцией в глобально распределенной базы данных, как Azure Cosmos DB. Azure Cosmos DB использует секционирование, масштабирование отдельных контейнеров в базу данных в соответствии с потребностями масштабируемости и производительности приложения. В секционирование, элементы в контейнере можно разделить на различные подмножества, вызывается логические разделы. Сведения и рекомендации по выбору подходящего ключа секции для ваших данных, см. в разделе [Выбор ключа секции раздел](https://docs.microsoft.com/azure/cosmos-db/partitioning-overview#choose-partitionkey). 

## <a id="indexing"></a>Ваши данные индекса
По умолчанию Azure Cosmos DB индексирует все поля данных при приеме. Вы можете изменить [политика индексации](index-policy.md) в Azure Cosmos DB в любое время. На самом деле часто рекомендуется отключить индексирование при переносе данных, а затем включить ее снова когда данные уже находятся в Cosmos DB. Дополнительные сведения о индексировании Дополнительные сведения о нем в [индексирование в Azure Cosmos DB](index-overview.md) раздел. 

[Azure Database Migration Service](../dms/tutorial-mongodb-cosmos-db.md) автоматически переносит коллекций MongoDB уникальных индексов. Тем не менее уникальные индексы должны создаваться до миграции. При наличии данных в коллекциях Azure Cosmos DB не поддерживает создание уникальных индексов. Дополнительные сведения см. в статье об [уникальных ключах в Azure Cosmos DB](unique-keys.md).

## <a name="next-steps"></a>Дальнейшие действия
* [Перенос данных MongoDB в Cosmos DB с помощью Database Migration Service.](../dms/tutorial-mongodb-cosmos-db.md) 
* [Подготовка пропускной способности в базах данных и контейнеры Azure Cosmos](set-throughput.md)
* [Partitioning in Azure Cosmos DB](partition-data.md) (Секционирование в Azure Cosmos DB)
* [Глобальное распределение в Azure Cosmos DB](distribute-data-globally.md)
* [Индексирование в Azure Cosmos DB](index-overview.md)
* [Единицы запросов в Azure Cosmos DB](request-units.md)
