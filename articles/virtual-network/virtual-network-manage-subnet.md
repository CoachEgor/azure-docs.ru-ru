---
title: Создание, изменение или удаление подсети виртуальной сети Azure
titlesuffix: Azure Virtual Network
description: Сведения о создании, изменении и удалении виртуальной сети в Azure.
services: virtual-network
documentationcenter: na
author: KumudD
manager: twooley
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 02/09/2018
ms.author: kumud
ms.openlocfilehash: 8a8feb0f12fbf5eadcddf239ff2e13c058a566fe
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "64693299"
---
# <a name="add-change-or-delete-a-virtual-network-subnet"></a>Создание, изменение или удаление виртуальной сети

Сведения о создании, изменении и удалении подсетей виртуальной сети. Все ресурсы Azure, развернутые в виртуальной сети, также развертываются в подсети виртуальной сети. Если у вас нет опыта работы с виртуальными сетями, вы можете получить дополнительные сведения в [обзорной статье](virtual-networks-overview.md) или пройти [учебник](quick-create-portal.md). Сведения о создании, изменении или удалении виртуальной сети см. в статье [Управление виртуальной сетью](manage-virtual-network.md).

## <a name="before-you-begin"></a>Перед началом работы

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

Перед выполнением действий, описанных в любом разделе этой статьи, выполните следующие задачи.

- Если у вас нет учетной записи Azure, зарегистрируйтесь для получения [бесплатной пробной учетной записи](https://azure.microsoft.com/free).
- При использовании портала перейдите по адресу https://portal.azure.com и войдите с использованием своей учетной записи Azure.
- При использовании команд PowerShell для работы с этой статьей выполняйте их в [Azure Cloud Shell](https://shell.azure.com/powershell) или в PowerShell на своем компьютере. Azure Cloud Shell — это бесплатная интерактивная оболочка, с помощью которой можно выполнять действия, описанные в этой статье. Она включает предварительно установленные общие инструменты Azure и настроена для использования с вашей учетной записью. Для работы с этим руководством требуется модуль Azure PowerShell версии 1.0.0 и выше. Выполните командлет `Get-Module -ListAvailable Az`, чтобы узнать установленную версию. Если вам необходимо выполнить обновление, ознакомьтесь со статьей, посвященной [установке модуля Azure PowerShell](/powershell/azure/install-az-ps). Если модуль PowerShell запущен локально, необходимо также выполнить командлет `Connect-AzAccount`, чтобы создать подключение к Azure.
- При использовании команд интерфейса командной строки Azure (CLI) для работы с этой статьей выполняйте их в [Azure Cloud Shell](https://shell.azure.com/bash) или в интерфейсе командной строки на своем компьютере. Для этого руководства требуется Azure CLI 2.0.31 или более поздней версии. Выполните командлет `az --version`, чтобы узнать установленную версию. Если вам необходимо выполнить установку или обновление, см. статью [Установка Azure CLI 2.0](/cli/azure/install-azure-cli). Если Azure CLI запущен локально, необходимо также выполнить командлет `az login`, чтобы создать подключение к Azure.

Учетной записи, в которую вы входите или с помощью которой подключаетесь к Azure, должна быть назначена роль [Участник сетей](../role-based-access-control/built-in-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json#network-contributor) или [пользовательская роль](../role-based-access-control/custom-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json), которой назначены соответствующие действия, перечисленные в таблице [Разрешения](#permissions).

## <a name="add-a-subnet"></a>Добавление подсети

1. В поле поиска в верхней части портала введите *виртуальные сети*. Когда в результатах поиска появится пункт **Виртуальные сети**, выберите его.
2. Из списка виртуальных сетей выберите ту, которую нужно добавить к подсети.
3. В разделе **Параметры** выберите **Subnets** (Подсети).
4. Выберите **+Subnet** (+Подсеть).
5. Введите значения для следующих параметров.
   - **Имя.** Имя должно быть уникальным в пределах виртуальной сети. Для обеспечения максимальной совместимости с другими службами Azure рекомендуется использовать в качестве первого символа имени букву. Например, шлюз приложений Azure не удастся развернуть в подсети с именем, которое начинается с цифры.
   - **Диапазон адресов**. Диапазон должен быть уникальным в пределах адресного пространства виртуальной сети. Диапазон не должен перекрываться с другими диапазонами адресов подсетей в виртуальной сети. Адресное пространство должно быть указано с помощью нотации CIDR. Например, в виртуальной сети с адресным пространством 10.0.0.0/16 можно определить адресное пространство подсети 10.0.0.0/24. Наименьший допустимый диапазон — /29. Он обеспечивает восемь IP-адресов для подсети. Azure резервирует первый и последний адреса в каждой подсети для соответствия требованиям протоколов. Еще три адреса резервируются для служб Azure. Следовательно, если определить подсеть с диапазоном адресов /29, то в ней будет только три пригодных для использования IP-адреса. Если вы планируете подключать виртуальную сеть к VPN-шлюзу, необходимо создать подсеть шлюза. Узнайте больше о [рекомендациях по диапазонам адресов для подсетей шлюза](../vpn-gateway/vpn-gateway-about-vpn-gateway-settings.md?toc=%2fazure%2fvirtual-network%2ftoc.json#gwsub). При определенных условиях после создания подсети можно изменить диапазон адресов. Сведения об изменении диапазона адресов подсети см. в разделе [Изменение параметров подсети](#change-subnet-settings).
   - **Группа безопасности сети**. При необходимости вы можете связать с подсетью одну имеющуюся группу безопасности сети (или не связывать), чтобы фильтровать входящий и исходящий сетевой трафик подсети. Группа безопасности сети должна существовать в той же подписке и расположении, что и виртуальная сеть. Подробнее о [группах безопасности сети](security-overview.md) и [их создании](tutorial-filter-network-traffic.md).
   - **Таблица маршрутов**. С подсетью можно связать имеющуюся таблицу маршрутов (или не связывать), чтобы управлять маршрутизацией сетевого трафика в других сетях. Таблица маршрутов должна существовать в той же подписке и расположении, что и виртуальная сеть. Подробнее о [маршрутизации Azure](virtual-networks-udr-overview.md) и [создании таблиц маршрутов](tutorial-create-route-table-portal.md).
   - **Конечные точки службы**. Подсеть может иметь несколько включенных для нее конечных точек службы (или не иметь). Чтобы включить конечную точку службы, выберите одну или несколько служб, для которых необходимо включить конечные точки, из списка **Services** (Службы). Расположение для конечной точки настраивается автоматически. По умолчанию конечные точки служб настроены для региона виртуальной сети. Чтобы служба хранилища Azure поддерживала сценарии региональной отработки отказа, конечные точки автоматически настраиваются для [пар регионов Azure](../best-practices-availability-paired-regions.md?toc=%2fazure%2fvirtual-network%2ftoc.json#what-are-paired-regions).
   - **Делегирование подсети**. Подсеть может иметь несколько включенных для нее делегирований (или не иметь). Делегирование подсети прямо разрешает службе в процессе развертывания создавать в подсети необходимые для этой службы ресурсы с помощью уникального идентификатора. Чтобы делегировать подсеть службе, выберите службу, которой вы хотите ее делегировать, в списке **Службы**.

       Чтобы удалить конечную точку службы, снимите флажки для тех служб, для которых необходимо удалить конечную точку. Дополнительные сведения о конечных точках служб и службах, для которых их можно включить, см. в статье [Конечные точки служб для виртуальной сети](virtual-network-service-endpoints-overview.md). После включения конечной точки службы необходимо предоставить подсети сетевой доступ к ресурсам, созданным с помощью этой службы. Например, если включить конечную точку службы для *Microsoft.Storage*, необходимо также включить сетевой доступ для всех учетных записей хранения Azure, которым нужно предоставить доступ к сети. Дополнительные сведения о включении сетевого доступа к подсетям, доступным для конечной точки службы, см. в документации по службам, для которых включена эта конечная точка.

     Чтобы проверить, включена ли конечная точка службы для подсети, просмотрите [фактические маршруты](diagnose-network-routing-problem.md) для любого сетевого интерфейса в подсети. Если конечная точка настроена, отобразится маршрут *по умолчанию* с префиксами адресов службы, а nextHopType будет иметь значение **VirtualNetworkServiceEndpoint**. Дополнительные сведения о маршрутизации см. в [обзорной статье](virtual-networks-udr-overview.md).
6. Чтобы добавить подсеть в выбранную виртуальную сеть, щелкните **ОК**.

**Команды**

- Azure CLI: [az network vnet subnet create](/cli/azure/network/vnet/subnet)
- PowerShell: [Add-AzVirtualNetworkSubnetConfig](/powershell/module/az.network/add-azvirtualnetworksubnetconfig)

## <a name="change-subnet-settings"></a>Изменение параметров подсети

1. В поле поиска в верхней части портала введите *виртуальные сети*. Когда в результатах поиска появится пункт **Виртуальные сети**, выберите его.
2. В списке виртуальных сетей выберите сеть, содержащую подсеть, для которой нужно изменить параметры.
3. В разделе **Параметры** выберите **Subnets** (Подсети).
4. В списке подсетей выберите подсеть, для которой нужно изменить параметры. Вы можете изменить следующие параметры.

    - **Диапазон адресов**. Если в подсети не развернуты ресурсы, вы можете изменить диапазон адресов. Если в подсети имеются какие-либо ресурсы, необходимо удалить их или переместить в другую подсеть. Процедура удаления или перемещения ресурса зависит от его типа. Чтобы узнать, как удалить или переместить ресурсы, подключенные к подсети, прочтите документацию по всем типам ресурсов, которые вам необходимо удалить или переместить. Ограничения для **диапазона адресов** представлены на шаге 5 раздела [Добавление подсети](#add-a-subnet).
    - **Пользователи**. Вы можете управлять доступом к подсети, используя встроенные роли или собственные настраиваемые роли. Подробнее о назначении ролей и пользователей для доступа к подсети см. в статье [Использование управления доступом на основе ролей для контроля доступа к ресурсам в подписке Azure](../role-based-access-control/role-assignments-portal.md?toc=%2fazure%2fvirtual-network%2ftoc.json#add-a-role-assignment).
    - **Группа безопасности сети** и **Таблица маршрутов**. См. шаг 5 в разделе [Добавление подсети](#add-a-subnet).
    - **Конечные точки службы**. См. сведения о конечных точках службы на шаге 5 в разделе [Добавление подсети](#add-a-subnet). При включении конечной точки службы для существующей подсети убедитесь в том, что в ресурсах этой подсети не выполняются критически важные задачи. Конечные точки службы переключают каждый сетевой интерфейс в подсети с использования маршрута по умолчанию с префиксом адреса *0.0.0.0/0* и типом следующего прыжка *Internet* на использование нового маршрута с префиксами адреса службы и типом следующего прыжка *VirtualNetworkServiceEndpoint*. Во время переключения все открытые TCP-соединения могут быть завершены. Конечная точка службы не будет включена, пока все потоки трафика в службу через все сетевые интерфейсы не пойдут по новому маршруту. Дополнительные сведения о маршрутизации см. в [обзорной статье](virtual-networks-udr-overview.md).
    - **Делегирование подсети**. См. сведения о конечных точках службы на шаге 5 в разделе [Добавление подсети](#add-a-subnet). Делегирование можно изменить, включив для подсети несколько делегирований. Если ресурс для службы уже развернут в подсети, делегирование подсети нельзя будет удалить, пока не будут удалены все ресурсы для этой службы. Чтобы делегировать подсеть другой службе, выберите службу, которой вы хотите ее делегировать, в списке **Службы**.
5. Щелкните **Сохранить**.

**Команды**

- Azure CLI: [az network vnet subnet update](/cli/azure/network/vnet/subnet#az-network-vnet-subnet-update)
- PowerShell: [Set-AzVirtualNetworkSubnetConfig](/powershell/module/az.network/set-azvirtualnetworksubnetconfig)

## <a name="delete-a-subnet"></a>Удаление подсети

Подсеть можно удалить только если, к ней не подключены какие-либо ресурсы. Если в подсети есть подключенные ресурсы, их необходимо удалить, и только потом — саму подсеть. Конкретная процедура удаления ресурса зависит от его типа. Чтобы узнать, как удалить ресурсы, подключенные к подсети, прочтите документацию по всем типам ресурсов, которые вам необходимо удалить.

1. В поле поиска в верхней части портала введите *виртуальные сети*. Когда в результатах поиска появится пункт **Виртуальные сети**, выберите его.
2. В списке виртуальных сетей выберите сеть, содержащую подсеть, которую нужно удалить.
3. В разделе **Параметры** выберите **Subnets** (Подсети).
4. В списке подсетей справа щелкните **...** для подсети, которую нужно удалить.
5. Выберите **Удалить**, а затем — **Да**.

**Команды**

- Azure CLI: [az network vnet delete](/cli/azure/network/vnet/subnet#az-network-vnet-subnet-delete)
- PowerShell: [Remove-AzVirtualNetworkSubnetConfig](/powershell/module/az.network/remove-azvirtualnetworksubnetconfig?toc=%2fazure%2fvirtual-network%2ftoc.json)

## <a name="permissions"></a>Разрешения

Для выполнения задач в подсетях учетной записи должна быть назначена роль [Участник сетей](../role-based-access-control/built-in-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json#network-contributor) или [пользовательская](../role-based-access-control/custom-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json) роль, которой назначены соответствующие разрешения, перечисленные в таблице ниже.

|Действие                                                                   |   ИМЯ                                       |
|-----------------------------------------------------------------------  |   -----------------------------------------  |
|Microsoft.Network/virtualNetworks/subnets/read                           |   Чтение подсети виртуальной сети              |
|Microsoft.Network/virtualNetworks/subnets/write                          |   Создание или обновление подсети виртуальной сети  |
|Microsoft.Network/virtualNetworks/subnets/delete                         |   Удаление подсети виртуальной сети            |
|Microsoft.Network/virtualNetworks/subnets/join/action                    |   Присоединение виртуальной сети                     |
|Microsoft.Network/virtualNetworks/subnets/joinViaServiceEndpoint/action  |   Включение конечной точки службы для подсети     |
|Microsoft.Network/virtualNetworks/subnets/virtualMachines/read           |   Получение виртуальных машин в подсети       |

## <a name="next-steps"></a>Дальнейшие действия

- Создание виртуальной сети и подсетей с помощью образцов скриптов [PowerShell](powershell-samples.md) или [Azure CLI](cli-samples.md) либо на основе [шаблонов Azure Resource Manager](template-samples.md)
- Создание и применение [политики Azure](policy-samples.md) для виртуальных сетей
