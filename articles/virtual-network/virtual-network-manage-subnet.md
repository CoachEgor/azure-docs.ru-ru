---
title: Создание, изменение или удаление подсети виртуальной сети Azure
titlesuffix: Azure Virtual Network
description: Сведения о создании, изменении и удалении виртуальной сети в Azure.
services: virtual-network
documentationcenter: na
author: KumudD
manager: twooley
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/20/2020
ms.author: kumud
ms.openlocfilehash: e5b78969f6b4315bb02b3f4152c6eeab94adddb8
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80246948"
---
# <a name="add-change-or-delete-a-virtual-network-subnet"></a>Создание, изменение или удаление виртуальной сети

Сведения о создании, изменении и удалении подсетей виртуальной сети. Все ресурсы Azure, развернутые в виртуальной сети, также развертываются в подсети виртуальной сети. Если вы новичок в виртуальных сетях, вы можете узнать больше о них в [обзоре виртуальной сети](virtual-networks-overview.md) или, завершив [quickstart](quick-create-portal.md). Чтобы узнать больше об управлении виртуальной сетью, [см.](manage-virtual-network.md)

## <a name="before-you-begin"></a>Перед началом

Если у вас его нет, навяжните учетную запись Azure с активной подпиской. [Создайте учетную запись](https://azure.microsoft.com/free/?ref=microsoft.com&utm_source=microsoft.com&utm_medium=docs&utm_campaign=visualstudio) бесплатно. Затем выполните одну из этих задач перед запуском шагов в любом разделе этой статьи: 

- **Пользователи портала**: Войти на [портал Azure](https://portal.azure.com) с вашей учетной записью Azure.

- **Пользователи PowerShell:** либо запускать команды в [облачной оболочке Azure,](https://shell.azure.com/powershell)либо запускать PowerShell с компьютера. Azure Cloud Shell — это бесплатная интерактивная оболочка, с помощью которой можно выполнять действия, описанные в этой статье. Она включает предварительно установленные общие инструменты Azure и настроена для использования с вашей учетной записью. Во вкладке браузера Azure Cloud Shell найдите список выпадающих **средств для поиска среды Select,** а затем выберите **PowerShell,** если он еще не выбран.

    Если вы работаете локально PowerShell, используйте версию модуля Azure PowerShell 1.0.0 или позже. Выполните командлет `Get-Module -ListAvailable Az.Network`, чтобы узнать установленную версию. Если вам необходимо выполнить обновление, ознакомьтесь со статьей, посвященной [установке модуля Azure PowerShell](/powershell/azure/install-az-ps). Также `Connect-AzAccount` запускайте для создания соединения с Azure.

- **Пользователи интерфейса Командной строки Azure (CLI)**: либо запускают команды в [оболочке Azure Cloud Shell,](https://shell.azure.com/bash)либо запускают CLI с компьютера. Используйте версию Azure CLI 2.0.31 или позже, если вы используете Azure CLI локально. Выполните командлет `az --version`, чтобы узнать установленную версию. Если вам нужно установить или обновить, [см.](/cli/azure/install-azure-cli) Также `az login` запускайте для создания соединения с Azure.

Учетная запись, в которую вы входите или подключаетесь к Azure, должна быть назначена [роли участника Сети](../role-based-access-control/built-in-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json#network-contributor) или [пользовательской роли,](../role-based-access-control/custom-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json) которая присваивает соответствующие действия, перечисленные в [Permissions.](#permissions)

## <a name="add-a-subnet"></a>Добавление подсети

1. Перейдите на [портал Azure,](https://portal.azure.com) чтобы просмотреть ваши виртуальные сети. Поиск и выбор **виртуальных сетей.**

2. Выберите название виртуальной сети, в какую вы хотите добавить подсеть.

3. Из **настроек**выберите **подсети Subnet.** > **Subnet**

4. В диалоговом окне **добавления** введите значения для следующих настроек:

    | Параметр | Описание |
    | --- | --- |
    | **Название** | Имя должно быть уникальным в пределах виртуальной сети. Для обеспечения максимальной совместимости с другими службами Azure рекомендуется использовать в качестве первого символа имени букву. Например, шлюз приложений Azure не удастся развернуть в подсети с именем, которое начинается с цифры. |
    | **Диапазон адресов** | <p>Диапазон должен быть уникальным в пределах адресного пространства виртуальной сети. Диапазон не может перекрываться с другими диапазонами адресов подсети в виртуальной сети. Адресное пространство должно быть указано с помощью нотации CIDR.</p><p>Например, в виртуальной сети с адресным пространством *10.0.0.0/16*можно определить пространство адреса подсети *10.0.0.0/22.* Самый маленький диапазон, который вы можете указать, является */29*, который предоставляет восемь IP-адресов для подсети. Azure резервирует первый и последний адреса в каждой подсети для соответствия требованиям протоколов. Еще три адреса резервируются для служб Azure. В результате определение подсети с диапазоном *адресов /29* приводит к покрытию трех пригодных для упокоительных IP-адресов в подсети.</p><p>Если вы планируете подключать виртуальную сеть к VPN-шлюзу, необходимо создать подсеть шлюза. Узнайте больше о [рекомендациях по диапазонам адресов для подсетей шлюза](../vpn-gateway/vpn-gateway-about-vpn-gateway-settings.md?toc=%2fazure%2fvirtual-network%2ftoc.json#gwsub). При определенных условиях после создания подсети можно изменить диапазон адресов. Сведения об изменении диапазона адресов подсети см. в разделе [Изменение параметров подсети](#change-subnet-settings).</p> |
    | **Группа сетевой безопасности** | Для фильтрации входящего и исходящего сетевого трафика для подсети можно связать существующую группу сетевой безопасности с подсетью. Группа безопасности сети должна существовать в той же подписке и расположении, что и виртуальная сеть. Подробнее о [группах безопасности сети](security-overview.md) и [их создании](tutorial-filter-network-traffic.md). |
    | **Таблица маршрутов** | Для управления маршрутизацией сетевого трафика в другие сети можно дополнительно связать существующую таблицу маршрутов с подсетью. Таблица маршрутов должна существовать в той же подписке и расположении, что и виртуальная сеть. Узнайте больше о [маршрутизации Azure](virtual-networks-udr-overview.md) и [о том, как создать таблицу маршрутов.](tutorial-create-route-table-portal.md) |
    | **Конечные точки обслуживания** | <p>Подсеть может по желанию иметь одну или несколько конечных точек службы включен для него. Чтобы включить конечную точку службы, выберите одну или несколько служб, для которых необходимо включить конечные точки, из списка **Services** (Службы). Azure настраивает местоположение автоматически для конечных точек. По умолчанию Azure настраивает конечные точки службы для региона виртуальной сети. Для поддержки региональных сценариев сбоя Azure автоматически настраивает конечные точки в [парные области Azure](../best-practices-availability-paired-regions.md?toc=%2fazure%2fvirtual-network%2ftoc.json#what-are-paired-regions) для хранения Azure.</p><p>Чтобы удалить конечную точку службы, снимите флажки для тех служб, для которых необходимо удалить конечную точку. Чтобы узнать больше о конечных точках обслуживания и услугах, для которых они могут быть включены, [см.](virtual-network-service-endpoints-overview.md) После включения конечной точки службы необходимо предоставить подсети сетевой доступ к ресурсам, созданным с помощью этой службы. Например, если включить конечную точку службы для **Microsoft.Storage**, необходимо также включить сетевой доступ для всех учетных записей хранения Azure, которым нужно предоставить доступ к сети. Для обеспечения доступа к подсетям, для чего включена конечная точка службы, см.</p><p>Чтобы проверить, включена ли конечная точка службы для подсети, просмотрите [фактические маршруты](diagnose-network-routing-problem.md) для любого сетевого интерфейса в подсети. При настройке конечной точки вы видите маршрут *по умолчанию* с адресными префиксами службы и следующий тип перехода **VirtualNetworkServiceEndpoint.** Чтобы узнать больше о разгроме, [см.](virtual-networks-udr-overview.md)</p> |
    | **Делегация подсети** | Подсеть может по желанию иметь одну или несколько делегаций, включенных для него. Делегация Subnet дает явное разрешение службе на создание ресурсов, специфиченных для обслуживания, в подсети с использованием уникального идентификатора во время развертывания службы. Чтобы делегировать подсеть службе, выберите службу, которой вы хотите ее делегировать, в списке **Службы**. |

5. Чтобы добавить подсеть в выбранную виртуальную сеть, щелкните **ОК**.

### <a name="commands"></a>Команды

| Инструмент | Команда |
| ---- | ------- |
| Azure CLI | [az network vnet subnet create](/cli/azure/network/vnet/subnet#az-network-vnet-subnet-create) |
| PowerShell | [Add-AzVirtualNetworkSubnetConfig](/powershell/module/az.network/add-azvirtualnetworksubnetconfig) |

## <a name="change-subnet-settings"></a>Изменение параметров подсети

1. Перейдите на [портал Azure,](https://portal.azure.com) чтобы просмотреть ваши виртуальные сети. Поиск и выбор **виртуальных сетей.**

2. Выберите название виртуальной сети, содержащей подсеть, которая вы хотите изменить.

3. Из **настроек**выберите **подсети.**

4. В списке подсетей выберите подсеть, для которой нужно изменить параметры.

5. На странице подсети измените любые из следующих параметров:

    | Параметр | Описание |
    | --- | --- |
    | **Диапазон адресов** | Если в подсети не развернуты ресурсы, вы можете изменить диапазон адресов. Если в подсети имеются какие-либо ресурсы, необходимо удалить их или переместить в другую подсеть. Процедура удаления или перемещения ресурса зависит от его типа. Чтобы узнать, как перемещать или удалять ресурсы, находимые в подсетях, прочитайте документацию для каждого из этих типов ресурсов. См ограничения для **диапазона адресов** в шаге 4 [Добавить подсеть.](#add-a-subnet) |
    | **Пользователи** | Вы можете управлять доступом к подсети, используя встроенные роли или собственные настраиваемые роли. Чтобы узнать больше о назначении ролей и пользователей для доступа к подсети, [см.](../role-based-access-control/role-assignments-portal.md?toc=%2fazure%2fvirtual-network%2ftoc.json#add-a-role-assignment) |
    | **Группа безопасности сети** и **Таблица маршрутов** | Смотрите шаг 4 [Добавить подсеть](#add-a-subnet). |
    | **Конечные точки обслуживания** | <p>Посмотреть конечные точки службы в шаге 4 [Добавить подсеть.](#add-a-subnet) При включении конечной точки службы для существующей подсети убедитесь в том, что в ресурсах этой подсети не выполняются критически важные задачи. Конечные точки обслуживания переключаются на маршруты каждого сетевого интерфейса в подсети. Конечные точки службы переходят от использования маршрута по умолчанию с приставкой *0.0.0.0/0 и* следующего типа перехода *интернета*к использованию нового маршрута с адресными префиксами сервиса и следующим типом перехода *VirtualNetworkServiceEndpoint.*</p><p>Во время переключения все открытые TCP-соединения могут быть завершены. Конечная точка службы не включена до тех пор, пока трафик не перетекает в службу для всех сетевых интерфейсов, обновляемый новым маршрутом. Чтобы узнать больше о разгроме, [см.](virtual-networks-udr-overview.md)</p> |
    | **Делегация подсети** | Посмотреть конечные точки службы в шаге 4 [Добавить подсеть.](#add-a-subnet) Делегирование можно изменить, включив для подсети несколько делегирований. Если ресурс службы уже развернут в подсети, делегирование подсети не может быть добавлено или удалено до тех пор, пока не будут удалены все ресурсы службы. Чтобы делегировать подсеть другой службе, выберите службу, которой вы хотите ее делегировать, в списке **Службы**. |

6. Нажмите кнопку **Сохранить**.

### <a name="commands"></a>Команды

| Инструмент | Команда |
| ---- | ------- |
| Azure CLI | [az network vnet subnet update](/cli/azure/network/vnet/subnet#az-network-vnet-subnet-update) |
| PowerShell | [Set-AzVirtualNetworkSubnetConfig](/powershell/module/az.network/set-azvirtualnetworksubnetconfig) |

## <a name="delete-a-subnet"></a>Удаление подсети

Подсеть можно удалить только если, к ней не подключены какие-либо ресурсы. Если ресурсы находятся в подсети, необходимо удалить эти ресурсы, прежде чем вы сможете удалить подсеть. Конкретная процедура удаления ресурса зависит от его типа. Чтобы узнать, как удалить ресурсы, которые находятся в подсетях, прочитайте документацию для каждого из этих типов ресурсов.

1. Перейдите на [портал Azure,](https://portal.azure.com) чтобы просмотреть ваши виртуальные сети. Поиск и выбор **виртуальных сетей.**

2. Выберите название виртуальной сети, содержащей подсеть, которая вы хотите удалить.

3. Из **настроек**выберите **подсети.**

4. В списке подсетей выберите подсеть, которая требуется удалить.

5. Выберите **Удалить,** а затем выбрать **Да** в поле диалога подтверждения.

### <a name="commands"></a>Команды

| Инструмент | Команда |
| ---- | ------- |
| Azure CLI | [az сети Vnet подсеть удалить](/cli/azure/network/vnet/subnet#az-network-vnet-subnet-delete) |
| PowerShell | [Удалить-AzVirtualNetworkSubnetConfig](/powershell/module/az.network/remove-azvirtualnetworksubnetconfig?toc=%2fazure%2fvirtual-network%2ftoc.json) |

## <a name="permissions"></a>Разрешения

Для выполнения задач в подсетях учетная запись должна быть назначена [роли вкладчика Сети](../role-based-access-control/built-in-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json#network-contributor) или [пользовательской роли,](../role-based-access-control/custom-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json) которая присваивает соответствующие действия в следующей таблице:

|Действие                                                                   |   name                                       |
|-----------------------------------------------------------------------  |   -----------------------------------------  |
|Microsoft.Network/virtualNetworks/subnets/read                           |   Чтение подсети виртуальной сети              |
|Microsoft.Network/virtualNetworks/subnets/write                          |   Создание или обновление подсети виртуальной сети  |
|Microsoft.Network/virtualNetworks/subnets/delete                         |   Удаление подсети виртуальной сети            |
|Microsoft.Network/virtualNetworks/subnets/join/action                    |   Присоединение виртуальной сети                     |
|Microsoft.Network/virtualNetworks/subnets/joinViaServiceEndpoint/action  |   Включение конечной точки службы для подсети     |
|Microsoft.Network/virtualNetworks/subnets/virtualMachines/read           |   Получение виртуальных машин в подсети       |

## <a name="next-steps"></a>Дальнейшие действия

- Создание виртуальной сети и подсетей с помощью образцов скриптов [PowerShell](powershell-samples.md) или [Azure CLI](cli-samples.md) либо на основе [шаблонов Azure Resource Manager](template-samples.md)
- Создайте и примените [политику Azure](policy-samples.md) для виртуальных сетей.
