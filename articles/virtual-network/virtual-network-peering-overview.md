---
title: Пиринговая связь между виртуальными сетями Azure
titlesuffix: Azure Virtual Network
description: Сведения о пиринге между виртуальными сетями в Azure.
services: virtual-network
documentationcenter: na
author: anavinahar
ms.service: virtual-network
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/01/2019
ms.author: anavin
ms.openlocfilehash: 100bbb6e0ed8e2ea5b35e30e7759a3b11c169b60
ms.sourcegitcommit: 41ca82b5f95d2e07b0c7f9025b912daf0ab21909
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "67077624"
---
# <a name="virtual-network-peering"></a>Пиринговая связь между виртуальными сетями

Пиринг виртуальных сетей позволяет легко подключать Azure [виртуальных сетей](virtual-networks-overview.md). После создания пиринговой связи две виртуальные сети выглядят как одна сеть при подключении. Трафик между виртуальными машинами в виртуальных сетях с пиринговой связью направляется через магистральную инфраструктуру Майкрософт, точно так же, как трафик между виртуальными машинами в одной виртуальной сети направляется только через *частные* IP-адреса. Azure поддерживает следующие сценарии:
* пиринговая связь между виртуальными сетями — подключение между виртуальными сетями в одном регионе Azure;
* глобальная пиринговая связь между виртуальными сетями — подключение между виртуальными сетями в разных регионах Azure.

Преимущества пиринговой связи между виртуальными сетями (как локальной, так и глобальной):

* Сетевой трафик между одноранговыми виртуальными сетями является закрытым. Трафик между виртуальными сетями хранится в магистральной сети Майкрософт. При обмене данными между виртуальными сетями не требуется общий доступ к Интернету, шлюзы или шифрование.
* подключение между ресурсами в разных виртуальных сетях, характеризующееся низкой задержкой и высокой пропускной способностью;
* Возможность взаимодействия ресурсов в одной виртуальной сети с ресурсами в другой виртуальной сети после установки пиринга между виртуальными сетями.
* Эта возможность позволяет передавать данные между подписками Azure, моделями развертывания и регионами Azure.
* Пиринговую связь можно создать между двумя виртуальными сетями, созданными с помощью Azure Resource Manager, или между виртуальной сетью, созданную с помощью Resource Manager, и виртуальной сетью, созданной с помощью классической модели развертывания. Дополнительные сведения о моделях развертывания Azure см. в статье [Развертывание с помощью Azure Resource Manager и классическое развертывание: сведения о моделях развертывания и состоянии ресурсов](../azure-resource-manager/resource-manager-deployment-model.md?toc=%2fazure%2fvirtual-network%2ftoc.json).
* Отсутствие задержки при доступе к ресурсам в любой виртуальной сети при создании пиринга или после его создания.

## <a name="connectivity"></a>Соединение

После создания пиринговой связи между виртуальными сетями ресурсы в одной виртуальной сети могут напрямую подключаться к ресурсам в связанной виртуальной сети.

Задержки в сети между виртуальными машинами в пиринговых виртуальных сетях такие же, как и в пределах одной виртуальной сети. Пропускная способность сети зависит от пропускной способности виртуальной машины, которая пропорциональна ее размеру. Дополнительные ограничения пропускной способности при пиринге не применяются.

Трафик между виртуальными машинами в пиринговых виртуальных сетях передается напрямую через магистральную инфраструктуру Майкрософт, а не через шлюз или Интернет.

Чтобы заблокировать доступ к другим виртуальным сетям или подсетям, в любой виртуальной сети можно использовать группы безопасности сети.
При настройке пиринга можно открыть или закрыть правила группы безопасности сети между виртуальными сетями. При открытии полного подключения между пиринговыми виртуальными сетями (что является параметром по умолчанию) можно применить группы безопасности сети для определенных подсетей или виртуальных машин, чтобы блокировать или запретить доступ к ним. Дополнительные сведения о группах безопасности сети см. в статье [Фильтрация сетевого трафика с помощью групп безопасности сети](security-overview.md).

## <a name="service-chaining"></a>Цепочка служб

Вы можете настроить определяемые пользователем маршруты, указывающие, какие виртуальные машины в пиринговых виртуальных сетях используются для IP-адреса *следующего прыжка* или для шлюзов виртуальной сети, чтобы обеспечить цепочку служб. Цепочка служб позволяет направлять трафик из одной виртуальной сети на виртуальное устройство или шлюз виртуальной сети в пиринговой виртуальной сети через определенные пользователем маршруты.

Можно развернуть сети со звездообразным подключением, в которых в центральной виртуальной сети могут размещаться компоненты инфраструктуры, например виртуальный сетевой модуль или VPN-шлюз. Все остальные виртуальные сети ("лучи") могут подключаться по пиринговой связи к центральной виртуальной сети. Трафик сможет проходить через виртуальные сетевые модули или VPN-шлюзы в центральной виртуальной сети. 

В определяемой пользователем таблице маршрутизации можно указать для следующего прыжка IP-адрес виртуальной машины, входящей в пиринговую виртуальную сеть, или VPN-шлюз. Однако перемещение между виртуальными сетями невозможно, если в определяемой пользователем таблице маршрутизации для следующего прыжка указан шлюз ExpressRoute. Дополнительные сведения об определяемых пользователем маршрутах см. в статье [Определяемые пользователем маршруты и IP-пересылка](virtual-networks-udr-overview.md#user-defined). Сведения о создании топологии с центральной и периферийной сетью см. [здесь](/azure/architecture/reference-architectures/hybrid-networking/hub-spoke?toc=%2fazure%2fvirtual-network%2ftoc.json).

## <a name="gateways-and-on-premises-connectivity"></a>Использование шлюзов для локального подключения

Для каждой виртуальной сети, независимо от наличия пиринговой связи с другой виртуальной сетью, можно настроить собственный шлюз, который будет использоваться для подключения к локальной сети. С помощью шлюзов также можно настроить подключение [между виртуальными сетями](../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md?toc=%2fazure%2fvirtual-network%2ftoc.json), даже если для них установлена пиринговая связь.

Если для виртуальных сетей настроены оба типа подключения, трафик между виртуальными сетями проходит через пиринговую связь (т. е. через магистральную сеть Azure).

Если между виртуальными сетями установлена пиринговая связь, можно использовать шлюз в одной из этих сетей в качестве транзитного пункта при подключении к локальной сети. В этом случае виртуальная сеть, использующая удаленный шлюз, не может иметь свой собственный. У виртуальной сети может быть только один шлюз. Это может быть локальный или удаленный шлюз (в пиринговой виртуальной сети), как показано на следующем рисунке:

![Транзит в пиринговой виртуальной сети](./media/virtual-networks-peering-overview/figure04.png)

Транзит через шлюз поддерживается для Пиринга и Пиринга глобальной виртуальной сети. Транзит через шлюз между виртуальными сетями, созданными с помощью разных моделей развертывания (Resource Manager и классическая модель) поддерживается только в том случае, если шлюз находится в виртуальной сети (Resource Manager). См. дополнительные сведения о [настройке VPN-шлюза для передачи данных с помощью пиринга между виртуальными сетями](../vpn-gateway/vpn-gateway-peering-gateway-transit.md?toc=%2fazure%2fvirtual-network%2ftoc.json).

Трафик между пиринговыми виртуальными сетями, которые используют одно подключение Azure ExpressRoute, передается по пиринговой связи (т. е. через магистральную сеть Azure). Вы по-прежнему можете использовать в каждой виртуальной сети локальные шлюзы для подключения к локальному каналу. или настроить транзит через общий шлюз для локального подключения.

## <a name="troubleshoot"></a>Устранение неполадок

Чтобы подтвердить пиринг между виртуальными сетями, вы можете [проверить действующие маршруты](diagnose-network-routing-problem.md) для сетевого интерфейса в любой подсети виртуальной сети. Если пиринг между виртуальными сетями настроен, все подсети виртуальной сети будут иметь маршруты со следующим прыжком типа *Пиринг виртуальных сетей* для каждого адресного пространства в каждой пиринговой виртуальной сети.

Чтобы устранить неполадки подключения к виртуальной машине в пиринговой виртуальной сети, используйте [проверку подключения](../network-watcher/network-watcher-connectivity-portal.md?toc=%2fazure%2fvirtual-network%2ftoc.json) службы "Наблюдатель за сетями". Проверка подключения позволяет увидеть, как трафик направляется из сетевого интерфейса исходящей виртуальной машины к сетевому интерфейсу конечной виртуальной машины.

Также см. статью [об устранении неполадок с пирингом между виртуальными сетями](https://support.microsoft.com/help/4486956/troubleshooter-for-virtual-network-peering-issues).

## <a name="requirements-and-constraints"></a>Требования и ограничения

Когда создается глобальный пиринг виртуальных сетей, действуют следующие ограничения:
- Ресурсы в одной виртуальной сети не может взаимодействовать с IP-адрес внешнего интерфейса основные внутренней подсистемы балансировки нагрузки в глобально пиринговой виртуальной сети. Поддержка основные подсистемы балансировки нагрузки существует только в одном регионе. Поддержка стандартных подсистемы балансировки нагрузки существует, Пиринга и Пиринга глобальной виртуальной сети. Описаны служб, использующих подсистему балансировки нагрузки основные, не будет работать по глобальный Пиринг [здесь.](virtual-networks-faq.md#what-are-the-constraints-related-to-global-vnet-peering-and-load-balancers)

См. дополнительные сведения о [требованиях и ограничениях для виртуальных сетей](virtual-network-manage-peering.md#requirements-and-constraints). Дополнительные сведения об ограничениях на число пиринговых подключений, которые можно создать для виртуальной сети, см. в разделе о [сетевых ограничениях Azure](../azure-subscription-service-limits.md?toc=%2fazure%2fvirtual-network%2ftoc.json#azure-resource-manager-virtual-networking-limits). 

## <a name="permissions"></a>Разрешения

Дополнительные сведения о разрешениях, необходимых для создания пирингового подключения между виртуальными сетями, см. в разделе [Разрешения](virtual-network-manage-peering.md#permissions).

## <a name="pricing"></a>Цены

За входящий и исходящий трафик по пиринговой связи между виртуальными сетями взимается номинальная плата. Дополнительные сведения о пиринговой связи виртуальных сетей и ценах на глобальную пиринговую связь между ними см. на [странице цен](https://azure.microsoft.com/pricing/details/virtual-network).

Транзит через шлюз — это пиринга свойство, которое позволяет использовать шлюз VPN или ExpressRoute в пиринговой виртуальной сети для кросс-подключения к сети для локальной или виртуальной сети. Трафику, проходящему через шлюз удаленных в этом сценарии определяется [плата шлюза VPN](https://azure.microsoft.com/pricing/details/vpn-gateway/) или шлюз ExpressRoute расходов и не требует [плата пиринга виртуальной сети.](https://azure.microsoft.com/pricing/details/virtual-network) Например VNetA имеет VPN-шлюза для подключения к локальным ресурсам, VNetB является одноранговой для VNetA для соответствующего свойства, настроенные трафик из VNetB-локально только оплачивается исходящие данные за цены на шлюз VPN или ExpressRoute цены. Плата за пиринговую связь между виртуальными сетями не начисляется. Узнайте, как [настроить транзит VPN-шлюзов для пиринговой связи между виртуальными сетями](../vpn-gateway/vpn-gateway-peering-gateway-transit.md?toc=%2fazure%2fvirtual-network%2ftoc.json).

## <a name="next-steps"></a>Дальнейшие действия

* Пиринг виртуальных сетей создается между виртуальными сетями, созданными с помощью тех же или разных моделей развертывания, которые существуют в одной и той же или разных подписках. Изучите руководство одного из следующих сценариев:

    |Модель развертывания Azure             | Подписка  |
    |---------                          |---------|
    |Обе — диспетчер ресурсов              |[Та же](tutorial-connect-virtual-networks-portal.md)|
    |                                   |[Разные](create-peering-different-subscriptions.md)|
    |Одна — диспетчер ресурсов, вторая — классическая  |[Та же](create-peering-different-deployment-models.md)|
    |                                   |[Разные](create-peering-different-deployment-models-subscriptions.md)|

* См. сведения о создании [звездообразной топологии сети](/azure/architecture/reference-architectures/hybrid-networking/hub-spoke?toc=%2fazure%2fvirtual-network%2ftoc.json).
* Узнайте подробнее о [параметрах пиринговой связи между виртуальными сетями и о том, как их изменить](virtual-network-manage-peering.md).
* См. [вопросы и ответы о пиринге виртуальных сетей и глобальном пиринге](virtual-networks-faq.md#vnet-peering).
