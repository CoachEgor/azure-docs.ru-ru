---
title: Подключение к Dynamics 365 — Azure Logic Apps
description: Создавайте записи и управляйте ими с помощью интерфейсов REST API Dynamics 365 (интернет-версия) и Azure Logic Apps.
services: logic-apps
ms.service: logic-apps
ms.suite: integration
author: Mattp123
ms.author: matp
manager: carmonm
ms.reviewer: estfan, LADocs
ms.topic: conceptual
ms.date: 08/18/2018
tags: connectors
ms.openlocfilehash: ce83e6b1847a8f08467cb7877e517bdaace27953
ms.sourcegitcommit: bba811bd615077dc0610c7435e4513b184fbed19
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/27/2019
ms.locfileid: "70051015"
---
# <a name="manage-dynamics-365-records-with-azure-logic-apps"></a>Управление записями Dynamics 365 с помощью Azure Logic Apps

С помощью Azure Logic Apps и Dynamics 365 можно создать автоматизированные задачи и рабочие процессы на основе записей в Dynamics 365. Рабочие процессы могут создавать записи, обновлять элементы, возвращать записи и выполнять другие задачи в вашей учетной записи Dynamics 365. Действия можно включить в приложения логики, которые получают ответы из Dynamics 365 и делают выходные данные доступными для других действий. Например, при обновлении элемента в Dynamics 365 можно отправлять сообщение электронной почты с помощью Office 365.

В этой статье показано, как создать приложение логики, которое создаст задачу в Dynamics 365 после создания записи о новом потенциальном клиенте.
Если вы не знакомы с приложениями логики, ознакомьтесь со статьей [Что такое Azure Logic Apps](../logic-apps/logic-apps-overview.md).

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас еще нет подписки Azure, [зарегистрируйтесь для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/).

* [Учетная запись Dynamics 365](https://dynamics.microsoft.com)

* Базовые знания [создания приложений логики](../logic-apps/quickstart-create-first-logic-app-workflow.md).

* Приложение логики, из которого необходимо получить доступ к учетной записи Dynamics 365. Чтобы запустить приложение логики с помощью триггера Dynamics 365, требуется [пустое приложение логики](../logic-apps/quickstart-create-first-logic-app-workflow.md).

## <a name="add-dynamics-365-trigger"></a>Добавление триггера Dynamics 365

[!INCLUDE [Create connection general intro](../../includes/connectors-create-connection-general-intro.md)]

В первую очередь добавьте триггер Dynamics 365, который срабатывает при появлении записи о новом потенциальном клиенте в Dynamics 365.

1. На [портале Azure](https://portal.azure.com) откройте свое пустое приложение логики в конструкторе приложений логики, если оно еще не открыто.

1. В поле поиска введите фильтр "Dynamics 365". Для этого примера в списке триггеры выберите этот триггер: **When a record is created**

   ![Выбрать триггер](./media/connectors-create-api-crmonline/select-dynamics-365-trigger.png)

1. Если будет предложено войти в Dynamics 365, войдите в учетную запись.

1. Укажите для триггера следующие данные.

   | Свойство | Обязательно для заполнения | Описание |
   |----------|----------|-------------|
   | **Название организации** | Да | Имя отслеживаемого экземпляра Dynamics 365 вашей организации, например "Contoso" |
   | **Имя объекта** | Да | Имя отслеживаемого объекта, например "Интересы" | 
   | **Frequency** | Да | Единица времени, используемая для частоты проверки обновлений, связанных с триггером |
   | **Интервал** | Да | Количество секунд, минут, часов, дней или месяцев до следующей проверки |
   ||| 

   ![Сведения о триггере](./media/connectors-create-api-crmonline/trigger-details.png)

## <a name="add-dynamics-365-action"></a>Добавление действия Dynamics 365

Теперь добавьте действие Dynamics 365, которое создает запись задач для записи о новом потенциальном клиенте.

1. Выберите для своего триггера **Добавить шаг**.

1. В поле поиска введите фильтр "Dynamics 365". В списке действий выберите действие **Create a new record**

   ![Выбор действия](./media/connectors-create-api-crmonline/select-action.png)

1. Укажите для действия следующие данные.

   | Свойство | Обязательно для заполнения | Описание |
   |----------|----------|-------------|
   | **Название организации** | Да | Экземпляр Dynamics 365, на котором нужно создать запись, который не должен совпадать с экземпляром в триггере, но в данном примере он будет назван "Contoso" |
   | **Имя объекта** | Да | Объект, на котором вы хотите создать запись, например "Задачи" |
   | | |

   ![Сведения о действии](./media/connectors-create-api-crmonline/action-details.png)

1. Когда для действия отобразится поле **Тема**, щелкните в поле **Тема**, чтобы отобразить список динамического содержимого. В этом списке выберите значения для полей, которые будут включены в запись задачи, связанную с записью о новом потенциальном клиенте.

   | Поле | Описание |
   |-------|-------------|
   | **Фамилия** | Фамилия, полученная от потенциального клиента, в качестве основного контакта в записи |
   | **Раздел** | Описательное имя для потенциального клиента в записи |
   | | |

   ![Сведения о записи задачи](./media/connectors-create-api-crmonline/create-record-details.png)

1. На панели инструментов конструктора нажмите для своего приложения логики кнопку **Сохранить**. 

1. Чтобы вручную запустить приложение логики, на панели инструментов конструктора щелкните **Запустить**.

   ![Запуск приложения логики](./media/connectors-create-api-crmonline/designer-toolbar-run.png)

1. После этого создайте запись о потенциальном клиенте в Dynamics 365, чтобы создать триггер для рабочего процесса приложения логики.

## <a name="add-filter-or-query"></a>Добавление фильтра или запроса

Чтобы задать способ фильтрации данных для действия Dynamics 365, нажмите в этом действии **Показать расширенные параметры**. После этого можно добавить фильтр или упорядочить записи по запросу.
Например, можно использовать запрос фильтра, чтобы получить только активные учетные записи и упорядочить их по имени учетной записи. Для выполнения этой задачи выполните следующие действия.

1. В разделе **Запрос фильтра** введите следующий запрос фильтра OData: `statuscode eq 1`

2. В разделе **Порядок сортировки**, после появления списка динамического содержимого, выберите вариант **Имя учетной записи**. 

   ![Определение фильтра и порядка](./media/connectors-create-api-crmonline/advanced-options.png)

Для получения дополнительной информации можно использовать следующие варианты системных запросов веб-API Dynamics 365 Customer Engagement:

* [$filter](https://docs.microsoft.com/dynamics365/customer-engagement/developer/webapi/query-data-web-api#filter-results)
* [$orderby](https://docs.microsoft.com/dynamics365/customer-engagement/developer/webapi/query-data-web-api#order-results)

### <a name="best-practices-for-advanced-options"></a>Рекомендации по использованию расширенных параметров

При указании значения для поля действия или триггера тип данных значения должен соответствовать типу поля (как при вводе значения вручную, так и при его выборе из списка динамического содержимого).

В таблице ниже показаны некоторые типы полей и требуемые типы данных для значений в таких полях.

| Тип поля | Требуемый тип данных | Описание | 
|------------|--------------------|-------------|
| Текстовые поля | Одна строка текста | В эти поля необходимо вводить одну строку текста или динамическое содержимое текстового типа. <p><p>*Примеры полей*: **Описание** и **Категория** | 
| Целочисленные поля | Целое число | В некоторые поля необходимо ввести целое число или добавить динамическое содержимое целочисленного типа. <p><p>*Примеры полей*: **Процент завершения** и **Длительность** | 
| Поля даты | Дата и время | В некоторые поля необходимо ввести дату в формате "мм/дд/гггг" или добавить динамическое содержимое типа "дата". <p><p>*Примеры полей*: **Создано**, **Дата начала**, **Фактическое начало**, **Фактическое окончание**и **Дата выполнения** | 
| Поля, для которых требуется как идентификатор записи, так и тип поиска | Первичный ключ | Для некоторых полей, которые ссылаются на другую запись объекта, требуется как идентификатор записи, так и тип поиска. | 
||||

Ниже представлены примеры полей триггеров и действий Dynamics 365, для которых требуется как идентификатор записи, так и тип поиска. Это требование означает, что значения, выбранные из списка динамического содержимого, не будут работать.

| Поле | Описание |
|-------|-------------|
| **Владелец** | Требуется действительный идентификатор пользователя или записи команды. |
| **Тип владельца** | Значение `systemusers` должно быть или `teams`. |
| **В отношении** | Требуется допустимый идентификатор записи, например идентификатор учетной записи или записи контакта. |
| **Тип "в отношении"** | Должен быть типом уточняющего запроса, например `accounts` или `contacts`. |
| **Клиент** | Требуется допустимый идентификатор записи, например идентификатор учетной записи или записи контакта. |
| **Тип клиента** | Должен быть типом уточняющего запроса, например `accounts` или `contacts`. |
|||

В данном примере действие с именем **Создать новую запись** создает новую запись задачи.

![Создание записи задачи с идентификаторами записи и типами поиска](./media/connectors-create-api-crmonline/create-record-advanced.png)

Это действие присваивает запись задачи определенному идентификатору пользователя или идентификатору записи команды на основе идентификатора записи в поле **Владелец** и типа поиска в поле **Тип владельца**.

![Идентификатор записи владельца и тип поиска](./media/connectors-create-api-crmonline/owner-record-id-and-lookup-type.png)

Это действие также добавляет запись учетной записи, которая связана с идентификатором записи, добавленным в поле **В отношении**, и типом поиска в поле **Тип "в отношении"** .

![Идентификатор записи в поле "В отношении" и тип поиска](./media/connectors-create-api-crmonline/regarding-record-id-lookup-type-account.png)

## <a name="find-record-id"></a>Поиск идентификатора записи

Чтобы найти идентификатор записи, выполните следующие действия:

1. Откройте запись в Dynamics 365, например для учетной записи.

2. На панели инструментов выберите одно из следующих действий.

   * Выберите **Всплывающее окно**. ![запись всплывающего окна](./media/connectors-create-api-crmonline/popout-record.png) 
   * Выберите **ОТПРАВИТЬ ССЫЛКУ ПО ПОЧТЕ**, чтобы скопировать полный URL-адрес в программу для работы с электронной почтой по умолчанию.

   Идентификатор записи отобразится в URL-адресе между символами `%7b` и `%7d`.

   ![Поиск идентификатора записи](./media/connectors-create-api-crmonline/find-record-ID.png)

## <a name="troubleshoot-failed-runs"></a>Устранение неполадок, связанных с неудачными запусками

Чтобы найти и изучить неудачные действия в приложении логики, можно просмотреть журнал запусков приложения логики, состояние, входные и выходные данные, а также другую информацию.

1. На портале Azure, в главном меню приложения логики, выберите **Обзор**. В разделе **Журнал запусков**, содержащем сведения о состоянии всех запусков приложения логики, выберите неудачные запуски, чтобы получить дополнительную информацию.

   ![Состояние выполнения приложения логики](./media/connectors-create-api-crmonline/run-history.png)

1. Разверните неудачное действие, чтобы увидеть дополнительную информацию.

   ![Развертывание шага с ошибкой](./media/connectors-create-api-crmonline/expand-failed-step.png)

1. Просмотрите сведения о действии (например, входные и выходные данные), которые помогут установить причину ошибки.

   ![Неудачное действие: входные и выходные данные](./media/connectors-create-api-crmonline/expand-failed-step-inputs-outputs.png)

Дополнительные сведения об устранении неполадок в приложениях логики см. в статье [Диагностика сбоев приложений логики](../logic-apps/logic-apps-diagnosing-failures.md).

## <a name="connector-reference"></a>Справочник по соединителям

Для получения технических сведений, таких как триггеры, действия и ограничения, как описано в файле OpenAPI (ранее Swagger) соединителя, см. [страницу справочника](/connectors/dynamicscrmonline/)по соединителю.

## <a name="next-steps"></a>Следующие шаги

* См. дополнительные сведения о других [соединителях Logic Apps](../connectors/apis-list.md).
