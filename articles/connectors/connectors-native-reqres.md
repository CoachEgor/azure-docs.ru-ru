---
title: Получение и ответ на звонки с помощью HTTPS
description: Обработка входящих запросов HTTPS от внешних служб с помощью приложений логики Azure
services: logic-apps
ms.suite: integration
ms.reviewers: klam, logicappspm
ms.topic: conceptual
ms.date: 03/12/2020
tags: connectors
ms.openlocfilehash: 1885d7f8713b3801ce0c9846b7a8509b3864032a
ms.sourcegitcommit: 62c5557ff3b2247dafc8bb482256fef58ab41c17
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/03/2020
ms.locfileid: "80656305"
---
# <a name="receive-and-respond-to-inbound-https-requests-in-azure-logic-apps"></a>Получение и ответ на входящие запросы HTTPS в приложениях логики Azure

С [помощью приложений Azure Logic Apps](../logic-apps/logic-apps-overview.md) и встроенных триггеров запроса или действий реагирования можно создавать автоматизированные задачи и рабочие процессы, которые получают и отвечают на входящие запросы HTTPS. Например, можно иметь приложение логики:

* Получение и ответ на запрос HTTPS о предоставлении данных в предварительной базе данных.
* Запуск рабочего процесса при возникновении внешнего события webhook.
* Получайте и отвечайте на вызов HTTPS из другого приложения логики.

> [!NOTE]
> Триггер Запроса поддерживает *только* безопасность уровня транспорта (TLS) 1.2 для входящих вызовов. Исходящие вызовы продолжают поддерживать TLS 1.0, 1.1 и 1.2. Для получения дополнительной [информации см.](https://docs.microsoft.com/security/solving-tls1-problem)
>
> Если вы видите ошибки рукопожатия TLS, убедитесь, что вы используете TLS 1.2. Для входящих вызовов приведены поддерживаемые наборы шифров:
>
> * TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
> * TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
> * TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
> * TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
> * TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384
> * TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256
> * TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384
> * TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас нет подписки, вы можете [подписаться на бесплатную учетную запись Azure.](https://azure.microsoft.com/free/)

* Основные знания о [логических приложениях](../logic-apps/logic-apps-overview.md). Если вы новичок в логических приложениях, узнайте, [как создать свое первое логическое приложение.](../logic-apps/quickstart-create-first-logic-app-workflow.md)

<a name="add-request"></a>

## <a name="add-request-trigger"></a>Добавление триггера Запроса

Этот встроенный триггер создает вручную вызываемую конечную точку HTTPS, которая может получать *только* входящие запросы HTTPS. Когда это событие происходит, триггер запускает и запускает приложение логики. Для получения дополнительной информации о базовом определении JSON и о том, как вызвать этот триггер, можно увидеть [тип триггера запроса](../logic-apps/logic-apps-workflow-actions-triggers.md#request-trigger) и [вызов, триггер или рабочие процессы с помощью конечных точек HTTP в приложениях логики Azure.](../logic-apps/logic-apps-http-endpoint.md)

1. Войдите на [портал Azure](https://portal.azure.com). Создание пустого приложения логики.

1. После того, как Logic App Designer откроется в поле поиска, введите "http запрос" в качестве фильтра. Из списка триггеров выберите триггер **ный запрос HTTP,** который является первым шагом в рабочем процессе приложения логики.

   ![Выберите триггер запроса](./media/connectors-native-reqres/select-request-trigger.png)

   Триггер Запроса показывает следующие свойства:

   ![Триггер запросов](./media/connectors-native-reqres/request-trigger.png)

   | Имя свойства | Имя свойства JSON | Обязательно | Описание |
   |---------------|--------------------|----------|-------------|
   | **URL-адрес HTTP POST** | {нет} | Да | URL-адрес endpoint, сгенерированный после сохранения приложения логики и используемый для вызова приложения логики |
   | **Запрос органа JSON Схема** | `schema` | нет | Схема JSON, описывающая свойства и значения в корпусе входящего запроса |
   |||||

1. В поле **Запрос тела JSON Schema** по желанию введите схему JSON, описывающая тело в входящий запрос, например:

   ![Пример схемы JSON](./media/connectors-native-reqres/provide-json-schema.png)

   Дизайнер использует эту схему для генерации токенов для свойств в запросе. Таким образом, приложение логики может анализировать, потреблять и передавать данные из запроса через триггер в рабочий процесс.

   Вот схема образца:

   ```json
   {
      "type": "object",
      "properties": {
         "account": {
            "type": "object",
            "properties": {
               "name": {
                  "type": "string"
               },
               "ID": {
                  "type": "string"
               },
               "address": {
                  "type": "object",
                  "properties": {
                     "number": {
                        "type": "string"
                     },
                     "street": {
                        "type": "string"
                     },
                     "city": {
                        "type": "string"
                     },
                     "state": {
                        "type": "string"
                     },
                     "country": {
                        "type": "string"
                     },
                     "postalCode": {
                        "type": "string"
                     }
                  }
               }
            }
         }
      }
   }
   ```

   При вводе схемы JSON дизайнер показывает напоминание о `Content-Type` включении заголовка в запрос `application/json`и установке этого значения заголовка. Для получения дополнительной информации [см.](../logic-apps/logic-apps-content-type.md)

   ![Напоминание о включении заголовка "Content-Type"](./media/connectors-native-reqres/include-content-type.png)

   Вот как выглядит этот заголовок в формате JSON:

   ```json
   {
      "Content-Type": "application/json"
   }
   ```

   Для создания схемы JSON, основанной на ожидаемой полезной нагрузке (данных), можно использовать такой инструмент, как [JSONSchema.net,](https://jsonschema.net)или вы можете выполнить следующие действия:

   1. В триггере запросов выберите **Использовать пример полезной нагрузки, чтобы создать схему**.

      ![Создание схемы из полезной нагрузки](./media/connectors-native-reqres/generate-from-sample-payload.png)

   1. Введите образец полезной нагрузки и выберите **Done**.

      ![Создание схемы из полезной нагрузки](./media/connectors-native-reqres/enter-payload.png)

      Вот образец полезной нагрузки:

      ```json
      {
         "account": {
            "name": "Contoso",
            "ID": "12345",
            "address": { 
               "number": "1234",
               "street": "Anywhere Street",
               "city": "AnyTown",
               "state": "AnyState",
               "country": "USA",
               "postalCode": "11111"
            }
         }
      }
      ```

1. Чтобы указать дополнительные свойства, откройте новый список **параметров** и выберите параметры, которые вы хотите добавить.

   | Имя свойства | Имя свойства JSON | Обязательно | Описание |
   |---------------|--------------------|----------|-------------|
   | **Метод** | `method` | нет | Метод, который входящий запрос должен использовать для вызова приложения логики |
   | **Относительный путь** | `relativePath` | нет | Относительный путь для параметра, который может принять URL-адрес endpoint приложения логики |
   |||||

   Этот пример добавляет свойство **метода:**

   ![Добавление параметра Метода](./media/connectors-native-reqres/add-parameters.png)

   Свойство **метода** отображается в триггере, чтобы можно было выбрать метод из списка.

   ![Select - метод](./media/connectors-native-reqres/select-method.png)

1. Теперь добавьте еще одно действие в качестве следующего шага в рабочем процессе. Под спусковым крючком выберите **Следующий шаг,** чтобы вы могли найти действие, которое вы хотите добавить.

   Например, вы можете ответить на запрос, [добавив действие Response,](#add-response)которое можно использовать для возврата настроенного ответа и описано позже в этой теме.

   Приложение логики сохраняет входящий запрос открытым только в течение одной минуты. Если предположить, что рабочий процесс приложения логики включает в себя действие Response, если приложение `504 GATEWAY TIMEOUT` логики не возвращает ответ по прошечке, приложение логики возвращает вызывающему. В противном случае, если приложение логики не включает действие `202 ACCEPTED` Ответа, приложение логики немедленно возвращает ответ вызываюцу.

1. Сохраните приложение логики, когда закончите. На панели инструментов конструктора щелкните **Сохранить**. 

   Этот шаг генерирует URL для использования для отправки запроса, который запускает приложение логики. Чтобы скопировать этот URL, выберите значок копии рядом с URL-.

   ![URL для использования инициирующего приложения логики](./media/connectors-native-reqres/generated-url.png)

1. Чтобы запустить приложение логики, отправьте HTTP POST на созданный URL. Например, можно использовать такой инструмент, как [Postman.](https://www.getpostman.com/)

### <a name="trigger-outputs"></a>Выходные данные триггера

Вот более подробная информация о выводах из триггера Запроса:

| Имя свойства JSON | Тип данных | Описание |
|--------------------|-----------|-------------|
| `headers` | Объект | Объект JSON, описывающий заголовки запроса |
| `body` | Объект | Объект JSON, описывающий содержимое тела из запроса |
||||

<a name="add-response"></a>

## <a name="add-a-response-action"></a>Добавление действия «Ответ»

Вы можете использовать действие Response для ответа с полезной нагрузкой (данными) на входящий запрос HTTPS, но только в логическом приложении, инициированном запросом HTTPS. Вы можете добавить действие Ответа в любой момент рабочего процесса. Для получения дополнительной информации о базовом определении [Response action type](../logic-apps/logic-apps-workflow-actions-triggers.md#response-action)JSON для этого триггера см.

Приложение логики сохраняет входящий запрос открытым только в течение одной минуты. Если предположить, что рабочий процесс приложения логики включает в себя действие Response, если приложение `504 GATEWAY TIMEOUT` логики не возвращает ответ по прошечке, приложение логики возвращает вызывающему. В противном случае, если приложение логики не включает действие `202 ACCEPTED` Ответа, приложение логики немедленно возвращает ответ вызываюцу.

> [!IMPORTANT]
> Если действие Response включает эти заголовки, Logic Apps удаляет эти заголовки из генерируемого сообщения ответа без отображения предупреждения или ошибки:
>
> * `Allow`
> * `Content-*`с этими `Content-Disposition`исключениями: , `Content-Encoding`и`Content-Type`
> * `Cookie`
> * `Expires`
> * `Last-Modified`
> * `Set-Cookie`
> * `Transfer-Encoding`
>
> Хотя логические приложения не помешают вам сохранить логические приложения, которые имеют действие Response с этими заголовками, Logic Apps игнорирует эти заголовки.

1. В Logic App Designer, под шагом, где вы хотите добавить ответ действий, выберите **новый шаг**.

   Например, использование триггера Запроса от ранее:

   ![Добавление нового шага](./media/connectors-native-reqres/add-response.png)

   Чтобы добавить действие между шагами, переместите указатель на стрелку между этими шагами. Выберите знак**+** плюс (), который появляется, а затем выберите **Добавить действие.**

1. В **соответствии**с вами в поле поиска введите "ответ" в качестве фильтра и выберите действие **"Ответ".**

   ![Выберите действие «Ответ»](./media/connectors-native-reqres/select-response-action.png)

   Триггер запроса сворачивается в этом примере для простоты.

1. Добавьте все значения, необходимые для сообщения ответа. 

   В некоторых областях, нажав внутри своих ящиков открывает список динамического содержимого. Затем можно выбрать маркеры, представляющие доступные выходы из предыдущих этапов рабочего процесса. Свойства из схемы, указанные в предыдущем примере, теперь отображаются в списке динамического содержимого.

   Например, для окна **заголовков** включите `Content-Type` в качестве ключевого `application/json` имени и установите ключевое значение, как упоминалось ранее в этой теме. Для коробки **тела** можно выбрать выход триггерного тела из списка динамического содержимого.

   ![Подробная информация о действиях реагирования](./media/connectors-native-reqres/response-details.png)

   Для просмотра заголовков в формате JSON выберите **переключатель в текстовое представление.**

   ![Заголовки - Переключитесь на текстовое представление](./media/connectors-native-reqres/switch-to-text-view.png)

   Вот более подробная информация о свойствах, которые можно установить в действии «Ответ». 

   | Имя свойства | Имя свойства JSON | Обязательно | Описание |
   |---------------|--------------------|----------|-------------|
   | **Код статуса** | `statusCode` | Да | Код состояния для возврата в ответе |
   | **Заголовки** | `headers` | нет | Объект JSON, описывающий один или несколько заголовков для включения в ответ |
   | **Текст** | `body` | нет | Текст ответа |
   |||||

1. Чтобы указать дополнительные свойства, такие как схема JSON для тела ответа, откройте новый список **параметров Добавить** и выберите параметры, которые вы хотите добавить.

1. Сохраните приложение логики, когда закончите. На панели инструментов конструктора щелкните **Сохранить**. 

## <a name="next-steps"></a>Дальнейшие действия

* [Соединители для Logic Apps](../connectors/apis-list.md)
