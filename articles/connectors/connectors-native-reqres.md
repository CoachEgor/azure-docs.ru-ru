---
title: Получение вызовов и ответ на них по протоколу HTTPS
description: Обрабатывайте входящие HTTPS-запросы от внешних служб с помощью Azure Logic Apps.
services: logic-apps
ms.suite: integration
ms.reviewers: jonfan, logicappspm
ms.topic: conceptual
ms.date: 05/29/2020
tags: connectors
ms.openlocfilehash: 25aafee59c7f5f7ae59aa2fd7871de8926907f68
ms.sourcegitcommit: dabd9eb9925308d3c2404c3957e5c921408089da
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2020
ms.locfileid: "86261383"
---
# <a name="receive-and-respond-to-inbound-https-requests-in-azure-logic-apps"></a>Получение входящих HTTP-запросов и ответ на них в Azure Logic Apps

С помощью [Azure Logic Apps](../logic-apps/logic-apps-overview.md), а также встроенного триггера запроса и действия ответа можно создавать автоматизированные задачи и рабочие процессы, которые принимают входящие HTTPS-запросы и отвечают на них. Например, приложение логики может выполнять следующие действия:

* получение HTTPS-запроса и ответ на него для данных в локальной базе данных;

* запуск рабочего процесса при наступлении события внешнего веб-перехватчика;

* получение вызова HTTPS из другого приложения логики и ответ на него.

Триггер запроса поддерживает [открытую проверку подлинности Azure Active Directory](/azure/active-directory/develop/) (Azure AD OAuth) для авторизации входящих вызовов приложения логики. Дополнительные сведения о включении этой проверки подлинности см. в разделе [Включение Azure Active Directory OAuth](../logic-apps/logic-apps-securing-a-logic-app.md#enable-oauth) статьи "Безопасный доступ и данные в Azure Logic Apps".

## <a name="prerequisites"></a>Обязательные условия

* Подписка Azure. Если у вас нет ее, вы можете [зарегистрироваться для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/).

* Базовые сведения о [приложениях логики](../logic-apps/logic-apps-overview.md). Если вы пока не знакомы с приложениями логики, изучите статью [о создании первого приложения логики](../logic-apps/quickstart-create-first-logic-app-workflow.md).

<a name="tls-support"></a>

## <a name="transport-layer-security-tls"></a>Протокол TLS

* Входящие вызовы поддерживают *только* протокол TLS 1,2. Если вы получаете ошибки подтверждения TLS, убедитесь в том, что используется протокол TLS 1.2. Дополнительные сведения см. в статье [Решение проблемы с TLS 1.0](https://docs.microsoft.com/security/solving-tls1-problem). Исходящие вызовы поддерживают TLS 1,0, 1,1 и 1,2 в зависимости от возможности целевой конечной точки.

* Входящие вызовы поддерживают следующие комплекты шифров:

  * TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384

  * TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256

  * TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384

  * TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256

  * TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384

  * TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256

  * TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384

  * TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256

<a name="add-request"></a>

## <a name="add-request-trigger"></a>Добавление триггера запроса

Этот встроенный триггер создает вызываемую вручную конечную точку HTTPS, которая может принимать *только* входящие HTTPS-запросы. Когда происходит это событие, триггер срабатывает и запускает приложение логики. Дополнительные сведения о базовом определении JSON триггера и вызове этого триггера см. в статьях [Триггер запросов](../logic-apps/logic-apps-workflow-actions-triggers.md#request-trigger) и [Вызов, активация или вложение приложений логики с помощью конечных точек HTTPS в Azure Logic Apps](../logic-apps/logic-apps-http-endpoint.md).

1. Войдите на [портал Azure](https://portal.azure.com). Создание пустого приложения логики.

1. Когда откроется конструктор приложений логики, в поле поиска введите `http request` в качестве фильтра. В списке триггеров выберите триггер **При получении HTTP-запроса**. Это первый этап рабочего процесса вашего приложения логики.

   ![Выбор триггера запроса](./media/connectors-native-reqres/select-request-trigger.png)

   Триггер запроса имеет следующие свойства.

   ![Триггер запросов](./media/connectors-native-reqres/request-trigger.png)

   | Имя свойства | Имя свойства JSON | Обязательно | Описание |
   |---------------|--------------------|----------|-------------|
   | **URL-адрес HTTP POST** | {нет} | Да | URL-адрес конечной точки, создаваемый после сохранения приложения логики и используемый для его вызова |
   | **Схема JSON текста запроса** | `schema` | Нет | Схема JSON, описывающая свойства и значения в тексте входящего запроса |
   |||||

1. При необходимости в поле **Схема JSON текста запроса** введите схему JSON, описывающую текст входящего запроса, например:

   ![Пример схемы JSON](./media/connectors-native-reqres/provide-json-schema.png)

   Конструктор использует эту схему для создания токенов для свойств в запросе. Таким образом, приложение логики может анализировать, потреблять и передавать данные из запроса через триггер в рабочий процесс.

   Ниже приведен пример схемы.

   ```json
   {
      "type": "object",
      "properties": {
         "account": {
            "type": "object",
            "properties": {
               "name": {
                  "type": "string"
               },
               "ID": {
                  "type": "string"
               },
               "address": {
                  "type": "object",
                  "properties": {
                     "number": {
                        "type": "string"
                     },
                     "street": {
                        "type": "string"
                     },
                     "city": {
                        "type": "string"
                     },
                     "state": {
                        "type": "string"
                     },
                     "country": {
                        "type": "string"
                     },
                     "postalCode": {
                        "type": "string"
                     }
                  }
               }
            }
         }
      }
   }
   ```

   При вводе схемы JSON в конструкторе выводится напоминание о том, что в запрос необходимо включить заголовок `Content-Type` и присвоить ему значение `application/json`. Дополнительные сведения см. в статье [Обработка типов содержимого](../logic-apps/logic-apps-content-type.md).

   ![Напоминание о необходимости включить заголовок Content-Type](./media/connectors-native-reqres/include-content-type.png)

   Вот как выглядит этот заголовок в формате JSON:

   ```json
   {
      "Content-Type": "application/json"
   }
   ```

   Чтобы создать схему JSON на основе ожидаемых полезных данных, можно использовать такое средство, как [JSONSchema.net](https://jsonschema.net), или выполнить указанные ниже действия.

   1. В триггере запросов выберите **Использовать пример полезной нагрузки, чтобы создать схему**.

      ![Создание схемы на основе полезных данных](./media/connectors-native-reqres/generate-from-sample-payload.png)

   1. Введите образец полезных данных и нажмите кнопку **Готово**.

      ![Создание схемы на основе полезных данных](./media/connectors-native-reqres/enter-payload.png)

      Ниже представлен образец полезных данных.

      ```json
      {
         "account": {
            "name": "Contoso",
            "ID": "12345",
            "address": {
               "number": "1234",
               "street": "Anywhere Street",
               "city": "AnyTown",
               "state": "AnyState",
               "country": "USA",
               "postalCode": "11111"
            }
         }
      }
      ```

1. Чтобы убедиться, что входящий вызов имеет текст запроса, соответствующий указанной схеме, выполните следующие действия.

   1. В строке заголовка триггера запроса нажмите кнопку с многоточием (**...**).

   1. В параметрах триггера включите **проверку схемы**и нажмите кнопку **Готово**.

      Если текст запроса входящего вызова не соответствует схеме, триггер возвращает `HTTP 400 Bad Request` ошибку.

1. Чтобы указать дополнительные свойства, откройте список **Добавить новый параметр** и выберите параметры, которые требуется добавить.

   | Имя свойства | Имя свойства JSON | Обязательно | Описание |
   |---------------|--------------------|----------|-------------|
   | **Метод** | `method` | Нет | Метод, который входящий запрос должен использовать для вызова приложения логики |
   | **Относительный путь** | `relativePath` | нет | Относительный путь для параметра, который может принимать URL-адрес конечной точки приложения логики |
   |||||

   В этом примере добавляется свойство **Метод**:

   ![Добавление параметра "Метод"](./media/connectors-native-reqres/add-parameters.png)

   Свойство **Метод** отображается в триггере, что позволяет выбрать метод из списка.

   ![Выбор метода](./media/connectors-native-reqres/select-method.png)

1. Теперь добавьте еще одно действие в качестве следующего шага рабочего процесса. В триггере выберите **Следующий шаг**, чтобы найти действие, которое требуется добавить.

   Например, можно ответить на запрос, [добавив действие ответа](#add-response). Его можно использовать для возврата настраиваемого ответа. Это действие описывается далее в этой статье.

   Приложение логики оставляет входящий запрос открытым в течение [ограниченного времени](../logic-apps/logic-apps-limits-and-config.md#request-limits). Если рабочий процесс приложения логики включает действие ответа и приложение логики не возвращает ответ по истечении этого времени, оно возвращает `504 GATEWAY TIMEOUT` вызывающему объекту. В противном случае, если в приложении логики нет действия ответа, оно немедленно возвращает ответ `202 ACCEPTED` вызывающему объекту.

1. Сохраните приложение логики, когда закончите. На панели инструментов конструктора щелкните **Сохранить**.

   На этом шаге создается URL-адрес, который используется для отправки запроса, запускающего приложение логики. Чтобы скопировать этот URL-адрес, щелкните значок копирования рядом с URL-адресом.

   ![URL-адрес, используемый для активации приложения логики](./media/connectors-native-reqres/generated-url.png)

   > [!NOTE]
   > Если вы хотите включить в URI символ hash или решетки ( **#** ) при вызове триггера запроса, используйте вместо этого закодированную версию:`%25%23`

1. Чтобы активировать приложение логики, отправьте HTTP-запрос POST по созданному URL-адресу.

   Например, для отправки HTTP-запроса POST можно использовать такое средство, как [Postman](https://www.getpostman.com/). Если вы [включили открытую проверку подлинности Azure Active Directory](../logic-apps/logic-apps-securing-a-logic-app.md#enable-oauth) (Azure AD OAuth) для авторизации входящих вызовов триггера запроса, вызовите триггер либо с помощью [подписанного URL-адреса (SAS)](../logic-apps/logic-apps-securing-a-logic-app.md#sas), либо с помощью маркера проверки подлинности. Использовать и то и другое нельзя. Маркер проверки подлинности должен указывать тип `Bearer` в заголовке авторизации. Дополнительные сведения см. в разделе [Доступ к триггерам на основе запросов](../logic-apps/logic-apps-securing-a-logic-app.md#secure-triggers) статьи "Безопасный доступ и данные в Azure Logic Apps".

Дополнительные сведения о базовом определении JSON триггера и вызове этого триггера см. в разделе [Триггер запросов](../logic-apps/logic-apps-workflow-actions-triggers.md#request-trigger) и статье [Вызов, активация или вложение приложений логики с помощью конечных точек HTTPS в Azure Logic Apps](../logic-apps/logic-apps-http-endpoint.md).

### <a name="trigger-outputs"></a>Выходные данные триггера

Ниже приведены дополнительные сведения о выходных данных триггера запроса.

| Имя свойства JSON | Тип данных | Описание |
|--------------------|-----------|-------------|
| `headers` | Объект | Объект JSON, описывающий заголовки из запроса |
| `body` | Объект | Объект JSON, описывающий содержимое текста из запроса |
||||

<a name="add-response"></a>

## <a name="add-a-response-action"></a>Добавление действия ответа

Вы можете использовать действие ответа для предоставления полезных данных в ответ на входящий HTTPS-запрос, но только в приложении логики, которое активируется HTTPS-запросом. Действие ответа можно добавить в рабочий процесс в любой момент. Дополнительные сведения о базовом определении JSON для этого триггера см. в разделе [Действие ответа](../logic-apps/logic-apps-workflow-actions-triggers.md#response-action).

Приложение логики оставляет входящий запрос открытым в течение [ограниченного времени](../logic-apps/logic-apps-limits-and-config.md#request-limits). Если рабочий процесс приложения логики включает действие ответа и приложение логики не возвращает ответ по истечении этого времени, оно возвращает `504 GATEWAY TIMEOUT` вызывающему объекту. В противном случае, если в приложении логики нет действия ответа, оно немедленно возвращает ответ `202 ACCEPTED` вызывающему объекту.

> [!IMPORTANT]
> Если действие ответа включает эти заголовки, Logic Apps удаляет их из создаваемого ответного сообщения без вывода предупреждения или ошибки:
>
> * `Allow`
> * `Content-*` со следующими исключениями: `Content-Disposition`, `Content-Encoding` и `Content-Type`
> * `Cookie`
> * `Expires`
> * `Last-Modified`
> * `Set-Cookie`
> * `Transfer-Encoding`
>
> Хотя Logic Apps не запрещает сохранять приложения логики, в которых есть действие ответа с этими заголовками, Logic Apps игнорирует эти заголовки.

1. В конструкторе приложений логики в шаге, в который нужно добавить действие ответа, выберите **Новый шаг**.

   Вот пример с использованием предыдущего триггера запроса:

   ![Добавление нового шага](./media/connectors-native-reqres/add-response.png)

   Чтобы добавить действие между шагами, переместите указатель на стрелку между шагами. Нажмите появившийся знак "плюс" ( **+** ), а затем выберите **Добавить действие**.

1. В разделе **Выберите действие** в поле поиска введите фильтр "ответ" и выберите действие **Ответ**.

   ![Выбор действия "Ответ"](./media/connectors-native-reqres/select-response-action.png)

   Триггер запроса в этом примере свернут для простоты.

1. Добавьте любые значения, необходимые для ответного сообщения.

   При щелчке внутри некоторых полей открывается динамический список содержимого. Вы можете выбрать токены, которые представляют доступные выходные данные из предыдущих шагов рабочего процесса. Свойства из схемы, указанной в предыдущем примере, теперь отображаются в динамическом списке содержимого.

   Например, для поля **Заголовки** укажите `Content-Type` в качестве имени ключа и задайте для ключа значение `application/json`, как упоминалось ранее в этой статье. В поле **Текст** можно выбрать выходной текст триггера из динамического списка содержимого.

   ![Сведения о действии ответа](./media/connectors-native-reqres/response-details.png)

   Чтобы просмотреть заголовки в формате JSON, выберите команду **Перейти в представление текста**.

   ![Заголовки — перейти в представление текста](./media/connectors-native-reqres/switch-to-text-view.png)

   Ниже приведены дополнительные сведения о свойствах, которые можно задать в действии ответа.

   | Имя свойства | Имя свойства JSON | Обязательно | Описание |
   |---------------|--------------------|----------|-------------|
   | **Код состояния** | `statusCode` | Да | Код состояния, возвращаемый в ответе |
   | **Заголовки** | `headers` | Нет | Объект JSON, который описывает один или несколько заголовков, включаемых в ответ |
   | **Текст** | `body` | нет | Текст ответа |
   |||||

1. Чтобы указать дополнительные свойства, например схему JSON для текста ответа, откройте список **Добавить новый параметр** и выберите параметры, которые требуется добавить.

1. Сохраните приложение логики, когда закончите. На панели инструментов конструктора щелкните **Сохранить**.

## <a name="next-steps"></a>Дальнейшие действия

* [Соединители для Logic Apps](../connectors/apis-list.md)
