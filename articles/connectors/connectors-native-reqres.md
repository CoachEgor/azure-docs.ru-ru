---
title: Получение вызовов и реагирование на них с помощью HTTPS
description: Обрабатывайте Входящие HTTPS запросы от внешних служб с помощью Azure Logic Apps
services: logic-apps
ms.suite: integration
ms.reviewers: jonfan, logicappspm
ms.topic: conceptual
ms.date: 05/06/2020
tags: connectors
ms.openlocfilehash: c6d8dc087e6306173fc4d55368cd3c4c624d5302
ms.sourcegitcommit: 999ccaf74347605e32505cbcfd6121163560a4ae
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/08/2020
ms.locfileid: "82978575"
---
# <a name="receive-and-respond-to-inbound-https-requests-in-azure-logic-apps"></a>Получение и реагирование на входящие HTTPS запросы в Azure Logic Apps

С помощью [Azure Logic Apps](../logic-apps/logic-apps-overview.md) и встроенного триггера запроса и действия ответа можно создавать автоматизированные задачи и рабочие процессы, которые получают Входящие HTTPS-запросы и отвечают на них. Например, вы можете использовать приложение логики:

* Получение и ответ на запрос HTTPS для данных в локальной базе данных.
* Запускает рабочий процесс, когда происходит событие внешнего веб-перехватчика.
* Получение и ответ на вызов HTTPS из другого приложения логики.

Триггер запроса поддерживает [Azure Active Directory открытой аутентификации](../active-directory/develop/about-microsoft-identity-platform.md) (Azure AD OAuth) для авторизации входящих вызовов к приложению логики. Дополнительные сведения о включении этой проверки подлинности см. [в разделе безопасный доступ и данные в Azure Logic Apps. Включение проверки подлинности OAuth Azure AD](../logic-apps/logic-apps-securing-a-logic-app.md#enable-oauth).

> [!NOTE]
> Триггер запроса поддерживает *только* протокол TLS 1,2 для входящих вызовов. Исходящие вызовы поддерживают TLS 1,0, 1,1 и 1,2. Дополнительные сведения см. [в разделе решение проблемы TLS 1,0](https://docs.microsoft.com/security/solving-tls1-problem).
>
> Если вы получаете ошибки подтверждения TLS, убедитесь, что используется TLS 1,2. 
> Для входящих вызовов ниже приведены поддерживаемые комплекты шифров:
>
> * TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
> * TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
> * TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
> * TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
> * TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384
> * TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256
> * TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384
> * TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас нет подписки, вы можете [зарегистрироваться для бесплатной учетной записи Azure](https://azure.microsoft.com/free/).

* Основные сведения о [Logic Apps](../logic-apps/logic-apps-overview.md). Если вы не знакомы с Logic Apps, Узнайте, [как создать свое первое приложение логики](../logic-apps/quickstart-create-first-logic-app-workflow.md).

<a name="add-request"></a>

## <a name="add-request-trigger"></a>Добавить триггер запроса

Этот встроенный триггер создает конечную точку HTTPS, вызываемую вручную, которая может принимать *только* Входящие HTTPS-запросы. Когда происходит это событие, триггер срабатывает и запускает приложение логики. Дополнительные сведения о базовом определении JSON триггера и вызове этого триггера см. в разделе [тип триггера запроса](../logic-apps/logic-apps-workflow-actions-triggers.md#request-trigger) и [вызов, триггер или вложенные рабочие процессы с конечными точками HTTPS в Azure Logic Apps](../logic-apps/logic-apps-http-endpoint.md).

1. Войдите на [портал Azure](https://portal.azure.com). Создание пустого приложения логики.

1. После открытия конструктора приложений логики в поле поиска введите `http request` фильтр. В списке триггеров выберите **время получения HTTP-запроса** триггера, который является первым шагом в рабочем процессе приложения логики.

   ![Выбор триггера запроса](./media/connectors-native-reqres/select-request-trigger.png)

   Триггер запроса показывает следующие свойства:

   ![Триггер запросов](./media/connectors-native-reqres/request-trigger.png)

   | Имя свойства | Имя свойства JSON | Обязательный | Описание |
   |---------------|--------------------|----------|-------------|
   | **URL-адрес HTTP POST** | {нет} | Да | URL-адрес конечной точки, созданный после сохранения приложения логики и используемый для вызова приложения логики |
   | **Схема JSON тела запроса** | `schema` | нет | Схема JSON, описывающая свойства и значения в теле входящего запроса |
   |||||

1. В поле **схема JSON тела запроса** при необходимости введите схему JSON, описывающую текст входящего запроса, например:

   ![Пример схемы JSON](./media/connectors-native-reqres/provide-json-schema.png)

   Конструктор использует эту схему для создания токенов для свойств в запросе. Таким образом, приложение логики может анализировать, потреблять и передавать данные из запроса через триггер в рабочий процесс.

   Ниже приведен пример схемы.

   ```json
   {
      "type": "object",
      "properties": {
         "account": {
            "type": "object",
            "properties": {
               "name": {
                  "type": "string"
               },
               "ID": {
                  "type": "string"
               },
               "address": {
                  "type": "object",
                  "properties": {
                     "number": {
                        "type": "string"
                     },
                     "street": {
                        "type": "string"
                     },
                     "city": {
                        "type": "string"
                     },
                     "state": {
                        "type": "string"
                     },
                     "country": {
                        "type": "string"
                     },
                     "postalCode": {
                        "type": "string"
                     }
                  }
               }
            }
         }
      }
   }
   ```

   При вводе схемы JSON конструктор отображает напоминание, чтобы включить `Content-Type` заголовок в запрос и присвоить этому заголовку значение. `application/json` Дополнительные сведения см. в разделе [Handle Content Types](../logic-apps/logic-apps-content-type.md).

   ![Напоминание для включения заголовка Content-Type](./media/connectors-native-reqres/include-content-type.png)

   Вот как выглядит этот заголовок в формате JSON:

   ```json
   {
      "Content-Type": "application/json"
   }
   ```

   Чтобы создать схему JSON, основанную на ожидаемых полезных данных (данные), можно использовать такой инструмент, как [JSONSchema.NET](https://jsonschema.net), или выполнить следующие действия.

   1. В триггере запросов выберите **Использовать пример полезной нагрузки, чтобы создать схему**.

      ![Создать схему на основе полезных данных](./media/connectors-native-reqres/generate-from-sample-payload.png)

   1. Введите образец полезных данных и нажмите кнопку **Готово**.

      ![Создать схему на основе полезных данных](./media/connectors-native-reqres/enter-payload.png)

      Ниже приведен пример полезных данных.

      ```json
      {
         "account": {
            "name": "Contoso",
            "ID": "12345",
            "address": { 
               "number": "1234",
               "street": "Anywhere Street",
               "city": "AnyTown",
               "state": "AnyState",
               "country": "USA",
               "postalCode": "11111"
            }
         }
      }
      ```

1. Чтобы указать дополнительные свойства, откройте список **Добавить новый параметр** и выберите параметры, которые требуется добавить.

   | Имя свойства | Имя свойства JSON | Обязательный | Описание |
   |---------------|--------------------|----------|-------------|
   | **Method** | `method` | нет | Метод, который входящий запрос должен использовать для вызова приложения логики |
   | **Относительный путь** | `relativePath` | нет | Относительный путь для параметра, который может принимать URL-адрес конечной точки приложения логики |
   |||||

   В этом примере добавляется свойство **method** :

   ![Добавить параметр метода](./media/connectors-native-reqres/add-parameters.png)

   Свойство **method** отображается в триггере, чтобы можно было выбрать метод из списка.

   ![Select - метод](./media/connectors-native-reqres/select-method.png)

1. Теперь добавьте еще одно действие в качестве следующего шага в рабочем процессе. В разделе триггера выберите **следующий шаг** , чтобы найти действие, которое требуется добавить.

   Например, можно ответить на запрос, [добавив действие ответа](#add-response), которое можно использовать для возврата настраиваемого ответа и описано далее в этом разделе.

   Приложение логики оставляет входящий запрос открытым только в течение одной минуты. Предполагая, что рабочий процесс приложения логики включает действие ответ, если приложение логики не возвращает ответ после того, как это время прошло, приложение логики возвращает `504 GATEWAY TIMEOUT` вызывающему объекту. В противном случае, если приложение логики не включает в себя действие ответа, приложение логики немедленно возвращает `202 ACCEPTED` ответ вызывающему объекту.

1. Сохраните приложение логики, когда закончите. На панели инструментов конструктора щелкните **Сохранить**.

   На этом шаге создается URL-адрес, который будет использоваться для отправки запроса, запускающего приложение логики. Чтобы скопировать этот URL-адрес, щелкните значок копирования рядом с URL-адресом.

   ![URL-адрес, используемый для активации приложения логики](./media/connectors-native-reqres/generated-url.png)

1. Чтобы активировать приложение логики, отправьте HTTP-запрос POST по созданному URL-адресу.

   Например, можно использовать средство [POST](https://www.getpostman.com/) для отправки HTTP-запроса POST. Если вы [включили Azure Active Directory открытая проверка подлинности](../logic-apps/logic-apps-securing-a-logic-app.md#enable-oauth) (Azure AD OAuth) для авторизации входящих вызовов триггера запроса, либо вызовите триггер с помощью [URL-адреса подписи общего доступа (SAS)](../logic-apps/logic-apps-securing-a-logic-app.md#sas) , либо с помощью маркера проверки подлинности, но нельзя использовать оба способа. Токен проверки подлинности должен `Bearer` указывать тип в заголовке авторизации. Дополнительные сведения см. [в разделе безопасный доступ и данные в Azure Logic Apps — доступ к триггерам на основе запросов](../logic-apps/logic-apps-securing-a-logic-app.md#secure-triggers).

Дополнительные сведения о базовом определении JSON триггера и вызове этого триггера см. в следующих разделах: [тип триггера запроса](../logic-apps/logic-apps-workflow-actions-triggers.md#request-trigger) и [вызов, триггер или вложенные рабочие процессы с конечными точками HTTP в Azure Logic Apps](../logic-apps/logic-apps-http-endpoint.md).

### <a name="trigger-outputs"></a>Выходные данные триггера

Ниже приведены дополнительные сведения о выходных данных триггера запроса.

| Имя свойства JSON | Тип данных | Описание |
|--------------------|-----------|-------------|
| `headers` | Объект | Объект JSON, описывающий заголовки из запроса |
| `body` | Объект | Объект JSON, описывающий содержимое текста из запроса. |
||||

<a name="add-response"></a>

## <a name="add-a-response-action"></a>Добавление действия ответа

Вы можете использовать ответное действие, чтобы отреагировать на полезную нагрузку (данные) на входящий HTTPS-запрос, но только в приложении логики, которое запускается запросом HTTPS. Действие ответа можно добавить в любой момент в рабочем процессе. Дополнительные сведения о базовом определении JSON для этого триггера см. в разделе [тип действия ответа](../logic-apps/logic-apps-workflow-actions-triggers.md#response-action).

Приложение логики оставляет входящий запрос открытым только в течение одной минуты. Предполагая, что рабочий процесс приложения логики включает действие ответ, если приложение логики не возвращает ответ после того, как это время прошло, приложение логики возвращает `504 GATEWAY TIMEOUT` вызывающему объекту. В противном случае, если приложение логики не включает в себя действие ответа, приложение логики немедленно возвращает `202 ACCEPTED` ответ вызывающему объекту.

> [!IMPORTANT]
> Если действие отклика включает эти заголовки, Logic Apps удаляет эти заголовки из созданного ответного сообщения без отображения предупреждения или ошибки:
>
> * `Allow`
> * `Content-*`со следующими исключениями `Content-Disposition`: `Content-Encoding`, и`Content-Type`
> * `Cookie`
> * `Expires`
> * `Last-Modified`
> * `Set-Cookie`
> * `Transfer-Encoding`
>
> Хотя Logic Apps не останавливает сохранение приложений логики, которые имеют действие Response с этими заголовками, Logic Apps пропускает эти заголовки.

1. В конструкторе приложений логики на шаге, где нужно добавить действие ответа, выберите **новый шаг**.

   Например, с помощью триггера запроса из предыдущего:

   ![Добавить новый шаг](./media/connectors-native-reqres/add-response.png)

   Чтобы добавить действие между шагами, наведите указатель мыши на стрелку между этими шагами. Выберите отображаемый знак плюса (**+**), а затем щелкните **Добавить действие**.

1. В разделе **Выбор действия**в поле поиска введите "Response" в качестве фильтра и выберите действие **ответ** .

   ![Выбор действия ответа](./media/connectors-native-reqres/select-response-action.png)

   Триггер запроса свернут в этом примере для простоты.

1. Добавьте любые значения, необходимые для ответного сообщения. 

   В некоторых полях при щелчке внутри соответствующих полей открывается список динамического содержимого. Затем можно выбрать токены, которые представляют доступные выходные данные из предыдущих шагов в рабочем процессе. Свойства из схемы, указанной в предыдущем примере, теперь отображаются в списке динамического содержимого.

   Например, для поля **заголовки** добавьте `Content-Type` в качестве имени ключа и задайте значение ключа, `application/json` как упоминалось ранее в этом разделе. В поле **основной текст** можно выбрать выходные данные основного текста триггера из списка динамического содержимого.

   ![Сведения о действии ответа](./media/connectors-native-reqres/response-details.png)

   Чтобы просмотреть заголовки в формате JSON, выберите **Перейти к представлению текста**.

   ![Заголовки — переключение на представление текста](./media/connectors-native-reqres/switch-to-text-view.png)

   Ниже приведены дополнительные сведения о свойствах, которые можно задать в действии ответа. 

   | Имя свойства | Имя свойства JSON | Обязательный | Описание |
   |---------------|--------------------|----------|-------------|
   | **Код состояния** | `statusCode` | Да | Код состояния, возвращаемый в ответе |
   | **Заголовки** | `headers` | нет | Объект JSON, описывающий один или несколько заголовков, включаемых в ответ |
   | **Организм** | `body` | нет | Текст ответа |
   |||||

1. Чтобы указать дополнительные свойства, например схему JSON для текста ответа, откройте список **Добавить новый параметр** и выберите параметры, которые требуется добавить.

1. Сохраните приложение логики, когда закончите. На панели инструментов конструктора щелкните **Сохранить**. 

## <a name="next-steps"></a>Дальнейшие действия

* [Соединители для Logic Apps](../connectors/apis-list.md)