---
title: Подключение к серверу IBM MQ
description: Отправка и получение сообщений с помощью Azure или локального сервера IBM MQ и Azure Logic Apps
services: logic-apps
ms.suite: integration
author: ChristopherHouser
ms.author: chrishou
ms.reviewer: valthom, logicappspm
ms.topic: article
ms.date: 03/31/2020
tags: connectors
ms.openlocfilehash: 737c5b90b216156ca08346f4a64fd0b421ad6c19
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "80410246"
---
# <a name="connect-to-an-ibm-mq-server-from-azure-logic-apps"></a>Подключение к серверу IBM MQ с Azure Logic Apps

Соединитель IBM MQ отправляет и извлекает сообщения, хранящиеся на сервере IBM MQ в локальной среде или в Azure. Этот соединитель включает в себя клиент Microsoft MQ для взаимодействия с удаленным сервером IBM MQ по сети TCP/IP. В этой статье представлено начальное руководство по использованию соединителя MQ. Чтобы начать с обзора одного сообщения в очереди, а затем выполнить другие действия.

Соединитель IBM MQ включает эти действия, но не предоставляет триггеры.

- Просмотр одного сообщения без удаления сообщения с сервера IBM MQ.
- Просмотр пакета сообщений без удаления сообщений с сервера IBM MQ.
- Получение одного сообщения и удаление сообщения с сервера IBM MQ.
- Получение пакета сообщений и удаление сообщений с сервера IBM MQ.
- Отправка одного сообщения на сервер IBM MQ.

Ниже приведены официально поддерживаемые версии IBM WebSphere MQ:

  * MQ 7.5
  * MQ 8.0
  * MQ 9,0

## <a name="prerequisites"></a>Предварительные условия

* Если вы используете локальный сервер MQ, [установите локальный шлюз данных](../logic-apps/logic-apps-gateway-install.md) на сервере в сети. На сервере, на котором установлен локальный шлюз данных, также должен быть установлен .NET Framework 4,6, чтобы соединитель MQ работал.

  После завершения установки шлюза необходимо также создать ресурс в Azure для локального шлюза данных. Дополнительные сведения см. [в разделе Настройка подключения к шлюзу данных](../logic-apps/logic-apps-gateway-connection.md).

  Если сервер MQ является общедоступным или доступным в Azure, вам не нужно использовать шлюз данных.

* Приложение логики, в которое нужно добавить действие MQ. Это приложение логики должно использовать то же расположение, что и локальное подключение к локальному шлюзу данных, и он уже должен иметь триггер, запускающий рабочий процесс.

  Соединитель MQ не имеет триггеров, поэтому сначала необходимо добавить триггер в приложение логики. Например, можно использовать триггер повторения. Если вы не знакомы с Logic Apps, воспользуйтесь этим [кратким руководством, чтобы создать свое первое приложение логики](../logic-apps/quickstart-create-first-logic-app-workflow.md).

<a name="create-connection"></a>

## <a name="create-mq-connection"></a>Создать подключение MQ

Если у вас еще нет подключения MQ при добавлении действия MQ, вам будет предложено создать подключение, например:

![Указание сведений о подключении](media/connectors-create-api-mq/connection-properties.png)

1. Если вы подключаетесь к локальному серверу MQ, выберите **подключиться через локальный шлюз данных**.

1. Укажите сведения о подключении для сервера MQ.

   * В поле **Сервер** укажите имя сервера MQ или введите IP-адрес, после него поставьте двоеточие, а затем укажите номер порта.

   * Чтобы использовать SSL (SSL), выберите **включить SSL?**.

     Соединитель MQ в настоящее время поддерживает только проверку подлинности сервера, а не проверку подлинности клиента. Дополнительные сведения см. в статье [проблемы с подключением и проверкой подлинности](#connection-problems).

1. В разделе **шлюз** выполните следующие действия.

   1. В списке **Подписка** выберите подписку Azure, связанную с ресурсом шлюза Azure.

   1. В списке **шлюз подключения** выберите ресурс шлюза Azure, который вы хотите использовать.

1. Когда все будет готово, выберите **Создать**.

<a name="connection-problems"></a>

### <a name="connection-and-authentication-problems"></a>Проблемы подключения и проверки подлинности

Когда приложение логики пытается подключиться к локальному серверу MQ, может появиться следующее сообщение об ошибке:

`"MQ: Could not Connect the Queue Manager '<queue-manager-name>': The Server was expecting an SSL connection."`

* Если вы используете соединитель MQ непосредственно в Azure, сервер MQ должен использовать сертификат, выданный доверенным [центром сертификации](https://www.ssl.com/faqs/what-is-a-certificate-authority/).

* Если вы используете локальный шлюз данных, попробуйте использовать сертификат, выданный доверенным [центром сертификации](https://www.ssl.com/faqs/what-is-a-certificate-authority/) , когда это возможно. Однако если этот параметр недоступен, можно использовать самозаверяющий сертификат, который не выдается доверенным [центром сертификации](https://www.ssl.com/faqs/what-is-a-certificate-authority/) и считается менее безопасным.

  Чтобы установить самозаверяющий сертификат сервера, можно использовать средство " **Диспетчер сертификации Windows** " (Certmgr. msc). В этом сценарии на локальном компьютере, где запущена служба локального шлюза данных, необходимо установить сертификат в хранилище сертификатов на **локальном компьютере** на уровне **доверенных корневых центров сертификации** .

  1. На компьютере, где запущена служба локального шлюза данных, откройте меню Пуск, найдите и выберите **Управление сертификатами пользователей**.

  1. После того как откроется средство диспетчера сертификатов Windows, перейдите в папку **Сертификаты-локальный компьютер** >  **Доверенные корневые центры сертификации** и установите сертификат.

     > [!IMPORTANT]
     > Убедитесь, что установлен сертификат в хранилище**доверенных корневых центров сертификации** **локального компьютера** > .

* Для сервера MQ необходимо определить спецификацию шифра, которая будет использоваться для SSL-соединений. Однако SsLStream в .NET не позволяет указывать порядок спецификаций шифров. Чтобы обойти это ограничение, можно изменить конфигурацию сервера MQ в соответствии с первой спецификацией шифра в наборе, который соединитель отправляет в согласовании SSL.

  При попытке подключения сервер MQ регистрирует сообщение о событии, указывающее на сбой соединения, так как другая конечная точка использовала неверную спецификацию шифра. Сообщение о событии содержит спецификацию шифра, которая отображается первой в списке. Обновите спецификацию шифра в конфигурации канала, чтобы она соответствовала спецификации шифра в сообщении о событии.

## <a name="browse-single-message"></a>Просмотр одного сообщения

1. В приложении логики в триггере или другом действии выберите **новый шаг**.

1. В поле поиска введите `mq`и выберите действие **Просмотр сообщения** .

   ![Выбор действия "Обзор сообщения"](media/connectors-create-api-mq/browse-message.png)

1. Если вы еще не создали подключение MQ, вам будет предложено [создать это подключение](#create-connection).

1. После создания подключения настройте свойства действия " **Просмотр сообщения** ":

   | Свойство | Описание |
   |----------|-------------|
   | **Очереди** | Если очередь, указанная в соединении, отличается от очереди, укажите эту очередь. |
   | **MessageId**, **correlationId**, **groupId**и другие свойства | Поиск сообщения, основанного на различных свойствах сообщения MQ |
   | **Свойства includeinfo** | Чтобы включить дополнительные сведения о сообщении в выходные данные, выберите **значение true**. Чтобы пропустить дополнительные сведения о сообщении в выходных данных, выберите **значение false**. |
   | **Timeout** | Введите значение, чтобы определить время ожидания поступления сообщения в пустую очередь. Если это значение не задано, то извлекается первое сообщение в очереди, и, следовательно, время на ожидание сообщения не тратится. |
   |||

   Пример:

   ![Свойства действия "Просмотр сообщения"](media/connectors-create-api-mq/browse-message-properties.png)

1. Когда все будет готово, на панели инструментов конструктора нажмите кнопку **сохранить**. Чтобы протестировать приложение, выберите **выполнить**.

   После завершения выполнения конструктор отображает шаги рабочего процесса и их состояние, чтобы можно было просматривать выходные данные.

1. Чтобы просмотреть сведения о каждом шаге, щелкните заголовок шага. Чтобы просмотреть дополнительные сведения о выходных данных этапа, выберите **Показывать необработанные выходные данные**.

   ![Просмотр сообщения: выходные данные](media/connectors-create-api-mq/browse-message-output.png)

   Ниже приведен пример необработанного вывода.

   ![Просмотр сообщения: необработанные выходные данные](media/connectors-create-api-mq/browse-message-raw-output.png)

1. Если для **Свойства includeinfo** задано **значение true**, отображаются дополнительные выходные данные:

   ![Просмотр сообщения: IncludeInfo](media/connectors-create-api-mq/browse-message-include-info.png)

## <a name="browse-multiple-messages"></a>Просмотр нескольких сообщений

Действие **Обзор сообщений** содержит параметр **BatchSize** , указывающий количество сообщений, возвращаемых из очереди. Если **BatchSize** не имеет значения, возвращаются все сообщения. Возвращаемые выходные данные представляют собой массив сообщений.

1. Выполните описанные выше действия, но вместо этого добавьте действие **Обзор сообщений** .

1. Если вы еще не создали подключение MQ, вам будет предложено [создать это подключение](#create-connection). В противном случае по умолчанию используется первое ранее настроенное соединение. Чтобы создать новое соединение, выберите **изменить подключение**. Или выберите другое соединение.

1. Укажите сведения для действия.

1. Сохраните и запустите приложение логики.

   После завершения работы приложения логики ниже приведен пример выходных данных из действия " **Обзор сообщений** ":

   ![Пример выходных данных "Обзор сообщений"](media/connectors-create-api-mq/browse-messages-output.png)

## <a name="receive-single-message"></a>Получить одно сообщение

Действие **Получить сообщение** имеет такие входные и выходные данные, что и действие **Browse message** (Просмотреть сообщение). При использовании **получения сообщения**сообщение удаляется из очереди.

## <a name="receive-multiple-messages"></a>Получение нескольких сообщений

Действие **Получить сообщения** имеет такие входные и выходные данные, что и действие **Browse messages** (Просмотреть сообщения). При использовании **получения сообщений**сообщения удаляются из очереди.

> [!NOTE]
> При выполнении действия Browse или Receive в очереди, в которой нет сообщений, действие завершается с этим выходом:
>
> ![MQ "нет сообщения"](media/connectors-create-api-mq/mq-no-message-error.png)

## <a name="send-message"></a>Отправить сообщение

1. Выполните описанные выше действия, но вместо этого добавьте действие **Отправить сообщение** .

1. Если вы еще не создали подключение MQ, вам будет предложено [создать это подключение](#create-connection). В противном случае по умолчанию используется первое ранее настроенное соединение. Чтобы создать новое соединение, выберите **изменить подключение**. Или выберите другое соединение.

1. Укажите сведения для действия. Для **MessageType**выберите допустимый тип сообщения: **датаграмма**, **ответ**или **запрос** .

   ![Свойства для действия "отправить сообщение"](media/connectors-create-api-mq/send-message-properties.png)

1. Сохраните и запустите приложение логики.

   После завершения работы приложения логики ниже приведен пример выходных данных из действия **Отправить сообщение** :

   ![Пример выходных данных "Отправка сообщения"](media/connectors-create-api-mq/send-message-output.png)

## <a name="connector-reference"></a>Справочник по соединителям

Технические сведения о действиях и ограничениях, которые описаны в описании Swagger соединителя, см. на [странице справочника](/connectors/mq/)по соединителю.

## <a name="next-steps"></a>Дальнейшие шаги

* См. дополнительные сведения о других [соединителях Logic Apps](../connectors/apis-list.md).
