---
title: Ожидание и реагирование на события
description: Автоматизируйте рабочие процессы, которые запускаются, приостанавливаются и возобновляются на основе событий в конечной точке службы с помощью Azure Logic Apps
services: logic-apps
ms.suite: integration
ms.reviewer: klam, logicappspm
ms.topic: conceptual
ms.date: 03/06/2020
tags: connectors
ms.openlocfilehash: 1578ca030bc8bab971a44e1afcce1d1ab9e1d5e9
ms.sourcegitcommit: bc792d0525d83f00d2329bea054ac45b2495315d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78674117"
---
# <a name="create-and-run-automated-event-based-workflows-by-using-http-webhooks-in-azure-logic-apps"></a>Создание и Запуск автоматизированных рабочих процессов на основе событий с помощью веб-перехватчиков HTTP в Azure Logic Apps

С помощью [Azure Logic Apps](../logic-apps/logic-apps-overview.md) и встроенного соединителя HTTP веб-перехватчика можно автоматизировать рабочие процессы, которые ожидают и выполняются на основе конкретных событий, происходящих в КОНЕЧНОЙ точке HTTP или HTTPS, путем создания приложений логики. Например, можно создать приложение логики, которое отслеживает конечную точку службы, ожидая определенного события перед запуском рабочего процесса и выполнением указанных действий, вместо того чтобы регулярно проверять или *опрашивать* эту конечную точку.

Ниже приведены некоторые примеры рабочих процессов на основе событий.

* Дождитесь прибытия элемента из [концентратора событий Azure](https://github.com/logicappsio/EventHubAPI) перед запуском запуска приложения логики.
* Дождитесь утверждения, прежде чем продолжить рабочий процесс.

## <a name="how-do-webhooks-work"></a>Как работают веб-перехватчики?

Триггер веб-перехватчика HTTP основан на событиях, который не зависит от регулярной проверки или опроса для новых элементов. При сохранении приложения логики, которое начинается с триггера веб-перехватчика, или при изменении приложения логики с отключенного на включено, триггер веб-перехватчика *подписывается* на определенную службу или конечную точку путем регистрации *URL-адреса обратного вызова* в этой службе или конечной точке. Затем триггер ожидает, пока эта служба или конечная точка выполнит вызов URL-адреса, который начинает выполнение приложения логики. Аналогично [триггеру запроса](connectors-native-reqres.md)приложение логики срабатывает сразу после наступления указанного события. Триггер отменяет *подписываться* на службу или конечную точку, если вы удаляете триггер и сохраняете приложение логики, или если вы изменяете приложение логики с включено на отключено.

Действие веб-перехватчика HTTP также основано на событиях и *подписывается* на определенную службу или конечную точку путем регистрации *URL-адреса обратного вызова* в этой службе или конечной точке. Действие веб-перехватчика приостанавливает рабочий процесс приложения логики и ожидает, пока служба или конечная точка не вызовет URL-адрес до возобновления работы приложения логики. Приложение логики действий отменяет *подписываться* на службу или конечную точку в следующих случаях:

* После успешного завершения действия веб-перехватчика
* Если выполнение приложения логики отменено во время ожидания ответа
* До истечения времени ожидания приложения логики

Например, действие веб-перехватчика " [**отправить утверждение по электронной почте**](connectors-create-api-office365-outlook.md) " в Office 365 Outlook Этот шаблон можно расширить в любой службе с помощью действия веб-перехватчика.

> [!NOTE]
> Logic Apps обеспечивает безопасность транспортного уровня (TLS) 1,2 при получении вызова к триггеру или действию веб-перехватчика HTTP. Если вы видите ошибки подтверждения SSL, убедитесь, что вы используете TLS 1,2. Для входящих вызовов ниже приведены поддерживаемые комплекты шифров:
>
> * TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
> * TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
> * TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
> * TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
> * TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384
> * TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256
> * TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384
> * TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256

Дополнительные сведения см. в следующих статьях:

* [Параметры триггера веб-перехватчика HTTP](../logic-apps/logic-apps-workflow-actions-triggers.md#http-webhook-trigger)
* [Веб-перехватчики и подписки](../logic-apps/logic-apps-workflow-actions-triggers.md#webhooks-and-subscriptions)
* [Создание настраиваемых API, поддерживающих веб-перехватчик](../logic-apps/logic-apps-create-api-app.md)

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас еще нет подписки Azure, [зарегистрируйтесь для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/).

* URL-адрес для уже развернутой конечной точки или API, который поддерживает шаблон подписки веб-перехватчика и отмены подписки для [триггеров веб](../logic-apps/logic-apps-create-api-app.md#webhook-triggers) -перехватчика в приложениях логики или [действия веб-перехватчика в приложениях логики](../logic-apps/logic-apps-create-api-app.md#webhook-actions) соответствующим образом.

* Базовые знания о [создании приложений логики](../logic-apps/quickstart-create-first-logic-app-workflow.md). Если вы не знакомы с приложениями логики, ознакомьтесь со статьей [Что такое Azure Logic Apps](../logic-apps/logic-apps-overview.md).

* Приложение логики, в котором необходимо ожидать определенные события в целевой конечной точке. Чтобы начать с триггера веб-перехватчика HTTP, [создайте пустое приложение логики](../logic-apps/quickstart-create-first-logic-app-workflow.md). Чтобы использовать действие веб-перехватчика HTTP, запустите приложение логики с любым нужным триггером. В этом примере в качестве первого шага используется триггер HTTP.

## <a name="add-an-http-webhook-trigger"></a>Добавление триггера веб-перехватчика HTTP

Этот встроенный триггер вызывает конечную точку подписки в целевой службе и регистрирует URL-адрес обратного вызова в целевой службе. Затем приложение логики ожидает, что целевая служба отправит запрос `HTTP POST` URL-адресу обратного вызова. Когда происходит это событие, триггер срабатывает и передает все данные в запросе в рабочий процесс.

1. Войдите на [портал Azure](https://portal.azure.com). Откройте пустое приложение логики в конструкторе приложений логики.

1. В поле поиска конструктора введите `http webhook` в качестве фильтра. В списке **триггеры** Выберите триггер **веб-перехватчика HTTP** .

   ![Выбор триггера веб-перехватчика HTTP](./media/connectors-native-webhook/select-http-webhook-trigger.png)

   В этом примере триггер переименовывается в `HTTP Webhook trigger`, чтобы у шага было более описательное имя. Кроме того, в примере далее добавляется действие веб-перехватчика HTTP, и оба имени должны быть уникальными.

1. Укажите значения [параметров триггера веб-перехватчика HTTP](../logic-apps/logic-apps-workflow-actions-triggers.md#http-webhook-trigger) , которые необходимо использовать для вызовов подписки и отмены подписки.

   В этом примере триггер включает методы, URI и тексты сообщений для использования при выполнении операций подписки и отмены подписки.

   ![Введите параметры триггера веб-перехватчика HTTP](./media/connectors-native-webhook/http-webhook-trigger-parameters.png)

   | Свойство | Обязательно | Описание |
   |----------|----------|-------------|
   | **Метод Subscription** | Да | Метод, используемый при подписке на целевую конечную точку |
   | **Подписка — URI** | Да | URL-адрес, используемый для подписки на целевую конечную точку |
   | **Подписка — текст** | Нет | Любой текст сообщения, включаемый в запрос подписки. Этот пример включает URL-адрес обратного вызова, который уникальным образом идентифицирует подписчика, который является приложением логики, используя выражение `@listCallbackUrl()` для получения URL-адреса обратного вызова приложения логики. |
   | **Отмена подписки — метод** | Нет | Метод, используемый при отписке от целевой конечной точки |
   | **Отмена подписки — URI** | Нет | URL-адрес, используемый для отмены подписки из целевой конечной точки |
   | **Отмена подписки — основной текст** | Нет | Необязательный текст сообщения для включения в запрос на отмену подписки <p><p>**Примечание**. это свойство не поддерживает использование функции `listCallbackUrl()`. Однако триггер автоматически включает и отправляет заголовки, `x-ms-client-tracking-id` и `x-ms-workflow-operation-name`, которые целевая служба может использовать для уникальной идентификации подписчика. |
   ||||

1. Чтобы добавить другие свойства триггера, откройте список **Добавить новый параметр** .

   ![Добавить дополнительные свойства триггера](./media/connectors-native-webhook/http-webhook-trigger-add-properties.png)

   Например, если необходимо использовать проверку подлинности, можно добавить свойства **подписки и отмены** **подписки** . Дополнительные сведения о типах проверки подлинности, доступных для веб-перехватчика HTTP, см. [в разделе Добавление проверки подлинности исходящих вызовов](../logic-apps/logic-apps-securing-a-logic-app.md#add-authentication-outbound).

1. Продолжите создание рабочего процесса приложения логики с действиями, выполняемыми при срабатывании триггера.

1. Когда все будет готово, сохраните приложение логики. На панели инструментов конструктора щелкните **Сохранить**.

   При сохранении приложение логики вызывает конечную точку подписки в целевой службе и регистрирует URL-адрес обратного вызова. Затем приложение логики ожидает, что целевая служба отправит запрос `HTTP POST` URL-адресу обратного вызова. Когда происходит это событие, триггер срабатывает и передает все данные в запросе в рабочий процесс. Если эта операция завершается успешно, триггер отменяет подписывание конечной точки и приложение логики продолжит оставшийся рабочий процесс.

## <a name="add-an-http-webhook-action"></a>Добавление действия веб-перехватчика HTTP

Это встроенное действие вызывает конечную точку подписки в целевой службе и регистрирует URL-адрес обратного вызова в целевой службе. Затем приложение логики приостанавливает и ждет, пока целевая служба отправит запрос `HTTP POST` URL-адресу обратного вызова. Когда это событие происходит, действие передает все данные в запросе в рабочий процесс. Если операция завершается успешно, действие отменяет подписывание от конечной точки, и приложение логики продолжит выполнение оставшегося рабочего процесса.

1. Войдите на [портал Azure](https://portal.azure.com). Создание приложения логики в Конструкторе приложений логики.

   В этом примере в качестве первого шага используется триггер веб-перехватчика HTTP.

1. На шаге, где нужно добавить действие веб-перехватчика HTTP, выберите **новый шаг**.

   Чтобы добавить действие между шагами, переместите указатель на стрелку между шагами. Выберите отображаемый знак «плюс» ( **+** ), а затем щелкните **Добавить действие**.

1. В поле поиска конструктора введите `http webhook` в качестве фильтра. В списке **действия** выберите действие **веб-перехватчика HTTP** .

   ![Выбор действия веб-перехватчика HTTP](./media/connectors-native-webhook/select-http-webhook-action.png)

   В этом примере действие переименовывается в "действие веб-перехватчика HTTP", чтобы у шага было более описательное имя.

1. Укажите значения для параметров действия веб-перехватчика HTTP, которые похожи на [параметры триггера веб-перехватчика HTTP](../logic-apps/logic-apps-workflow-actions-triggers.md#http-webhook-trigger), которые необходимо использовать для вызовов подписки и отмены подписки.

   В этом примере действие включает методы, URI и тексты сообщений для использования при выполнении операций подписки и отмены подписки.

   ![Введите параметры действия веб-перехватчика HTTP](./media/connectors-native-webhook/http-webhook-action-parameters.png)

   | Свойство | Обязательно | Описание |
   |----------|----------|-------------|
   | **Метод Subscription** | Да | Метод, используемый при подписке на целевую конечную точку |
   | **Подписка — URI** | Да | URL-адрес, используемый для подписки на целевую конечную точку |
   | **Подписка — текст** | Нет | Любой текст сообщения, включаемый в запрос подписки. Этот пример включает URL-адрес обратного вызова, который уникальным образом идентифицирует подписчика, который является приложением логики, используя выражение `@listCallbackUrl()` для получения URL-адреса обратного вызова приложения логики. |
   | **Отмена подписки — метод** | Нет | Метод, используемый при отписке от целевой конечной точки |
   | **Отмена подписки — URI** | Нет | URL-адрес, используемый для отмены подписки из целевой конечной точки |
   | **Отмена подписки — основной текст** | Нет | Необязательный текст сообщения для включения в запрос на отмену подписки <p><p>**Примечание**. это свойство не поддерживает использование функции `listCallbackUrl()`. Однако действие автоматически включает и отправляет заголовки, `x-ms-client-tracking-id` и `x-ms-workflow-operation-name`, которые целевая служба может использовать для уникальной идентификации подписчика. |
   ||||

1. Чтобы добавить другие свойства действия, откройте список **Добавить новый параметр** .

   ![Добавление свойств действия](./media/connectors-native-webhook/http-webhook-action-add-properties.png)

   Например, если необходимо использовать проверку подлинности, можно добавить свойства **подписки и отмены** **подписки** . Дополнительные сведения о типах проверки подлинности, доступных для веб-перехватчика HTTP, см. [в разделе Добавление проверки подлинности исходящих вызовов](../logic-apps/logic-apps-securing-a-logic-app.md#add-authentication-outbound).

1. Закончив, не забудьте сохранить приложение логики. На панели инструментов конструктора щелкните **Сохранить**.

   Теперь при выполнении этого действия приложение логики вызывает конечную точку подписки в целевой службе и регистрирует URL-адрес обратного вызова. Затем приложение логики приостанавливает рабочий процесс и ждет, пока целевая служба не отправит запрос `HTTP POST` URL-адресу обратного вызова. Когда это событие происходит, действие передает все данные в запросе в рабочий процесс. Если операция завершается успешно, действие отменяет подписывание от конечной точки, и приложение логики продолжит выполнение оставшегося рабочего процесса.

## <a name="connector-reference"></a>Справочник по соединителям

Дополнительные сведения о параметрах триггера и действия, которые похожи на друг друга, см. в разделе [Параметры веб-перехватчика HTTP](../logic-apps/logic-apps-workflow-actions-triggers.md#http-webhook-trigger).

### <a name="output-details"></a>Сведения о выходных данных

Ниже приведены дополнительные сведения о выходных данных триггера или действия веб-перехватчика HTTP, которые возвращают следующие сведения:

| Имя свойства | Тип | Описание |
|---------------|------|-------------|
| верхние колонтитулы | object | Заголовки из запроса |
| body | object | JSON - объект | Объект с содержимым текста из запроса |
| Код состояния | int | Код состояния из запроса |
|||

| Код состояния | Описание |
|-------------|-------------|
| 200 | ОК |
| 202 | Принято |
| 400 | Недопустимый запрос |
| 401 | Не санкционировано |
| 403 | Запрещено |
| 404 | Не найдено |
| 500 | Ошибка внутреннего сервера Произошла неизвестная ошибка. |
|||

## <a name="next-steps"></a>Следующие шаги

* См. дополнительные сведения о других [соединителях Logic Apps](../connectors/apis-list.md).
