---
title: Подождите и реагируйте на события
description: Автоматизировать рабочие процессы, которые вызывают, приостанавливают и резюме на основе событий в конечном пункте службы, используя приложения Azure Logic Apps
services: logic-apps
ms.suite: integration
ms.reviewer: klam, logicappspm
ms.topic: conceptual
ms.date: 03/06/2020
tags: connectors
ms.openlocfilehash: 1578ca030bc8bab971a44e1afcce1d1ab9e1d5e9
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "78674117"
---
# <a name="create-and-run-automated-event-based-workflows-by-using-http-webhooks-in-azure-logic-apps"></a>Создавайте и запускайте автоматизированные рабочие процессы на основе событий с помощью веб-крючков HTTP в приложениях логики Azure

С [помощью приложений Azure Logic Apps](../logic-apps/logic-apps-overview.md) и встроенного разъема HTTP Webhook можно автоматизировать рабочие процессы, которые ждут и запускаются на основе конкретных событий, которые происходят в конечных точках HTTP или HTTPS, путем создания логических приложений. Например, можно создать логическое приложение, которое отслеживает конечную точку службы, ожидая определенного события перед запуском рабочего процесса и запуском указанных действий, а не регулярно проверять или *опрашивать* эту конечную точку.

Вот некоторые примеры рабочих процессов, основанных на событиях:

* Подождите, пока элемент прибудет из [концентратора событий Azure,](https://github.com/logicappsio/EventHubAPI) прежде чем запустить логическое приложение.
* Подождите утверждения, прежде чем продолжить рабочий процесс.

## <a name="how-do-webhooks-work"></a>Как работают веб-крючки?

Триггер HTTP webhook основан на событиях, который не зависит от регулярной проверки или опроса новых элементов. При сохранении логического приложения, которое начинается с триггера webhook, или при изменении приложения логики с отключенного на включено, триггер webhook *подписывается на* конкретную службу или конечную точку, регистрируя *URL-адрес обратного вызова* с помощью этой службы или конечную точку. Затем триггер ждет, когда эта служба или конечная точка вызовет URL-адрес, который запускает приложение логики. Подобно [триггеру Запроса,](connectors-native-reqres.md)приложение логики срабатывает сразу же, когда происходит указанное событие. Триггер *отменяется* от службы или конечную точку, если вы удалите триггер и сохраните приложение логики, или когда вы измените приложение логики от включенного к отключению.

Действие HTTP webhook также основано на событиях и *подписывается на* конкретную службу или конечную точку, регистрируя *URL-адрес обратного вызова* с этой услугой или конечным пунктом. Действие Webhook приостанавливает рабочий процесс приложения логики и ждет, пока служба или конечная точка не вызовут URL,прежде чем приложение логики возобновит работу. Приложение логики действий *отпишется* от службы или в конечных точках в следующих случаях:

* Когда действие webhook успешно завершается
* Если запуск приложения логики отменяется во время ожидания ответа
* Перед тем, как логическое приложение выходит из

Например, разъем разъем Office 365 [**Outlook's Send email**](connectors-create-api-office365-outlook.md) является примером действий Webhook, которые следуют этому шаблону. Вы можете расширить этот шаблон в любую службу с помощью действия webhook.

> [!NOTE]
> Логические приложения обеспечивают безопасность транспортного уровня (TLS) 1.2 при получении вызова обратно на триггер или действие http webhook. Если вы видите ошибки рукопожатия SSL, убедитесь, что вы используете TLS 1.2. Для входящих вызовов приведены поддерживаемые наборы шифров:
>
> * TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
> * TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
> * TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
> * TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
> * TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384
> * TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256
> * TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384
> * TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256

Дополнительные сведения см. в следующих статьях:

* [Параметры триггера HTTP Webhook](../logic-apps/logic-apps-workflow-actions-triggers.md#http-webhook-trigger)
* [Веб-перехватчики и подписки](../logic-apps/logic-apps-workflow-actions-triggers.md#webhooks-and-subscriptions)
* [Создание пользовательских AAP, поддерживающих веб-крюк](../logic-apps/logic-apps-create-api-app.md)

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас еще нет подписки Azure, [зарегистрируйтесь для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/).

* URL-адрес уже развернутой конечной точки или API, поддерживающий шаблон подписки и отписки webhook для [триггеров webhook в логических приложениях](../logic-apps/logic-apps-create-api-app.md#webhook-triggers) или [действиях Webhook в логических приложениях](../logic-apps/logic-apps-create-api-app.md#webhook-actions) по мере необходимости

* Базовые знания о [создании приложений логики](../logic-apps/quickstart-create-first-logic-app-workflow.md). Если вы новичок в логических приложениях, просмотрите [Что такое приложения логики Azure?](../logic-apps/logic-apps-overview.md)

* Приложение логики, где вы хотите ждать конкретных событий в целевой точке. Для начала спускового крючка HTTP Webhook [создайте пустое логическое приложение.](../logic-apps/quickstart-create-first-logic-app-workflow.md) Чтобы использовать действие HTTP Webhook, запустите логическое приложение с любым спусковым крючком. Этот пример использует триггер HTTP в качестве первого шага.

## <a name="add-an-http-webhook-trigger"></a>Добавить триггер HTTP Webhook

Этот встроенный триггер вызывает конечную точку подписки в целевой службе и регистрирует URL-адрес обратноса в целевой службе. Затем приложение логики ждет отправки запроса целевой `HTTP POST` службой на URL-адрес обратного вызова. Когда это событие происходит, триггер срабатывает и передает любые данные в запросе вместе с рабочим процессом.

1. Войдите на [портал Azure](https://portal.azure.com). Откройте свое пустое приложение логики в Logic App Designer.

1. В поле поиска дизайнера `http webhook` введите фильтр. Из списка **триггеров** выберите триггер **HTTP Webhook.**

   ![Выберите триггер HTTP Webhook](./media/connectors-native-webhook/select-http-webhook-trigger.png)

   Этот пример переименовывает триггер, чтобы `HTTP Webhook trigger` шаг получил более описательное имя. Кроме того, пример позже добавляет действие HTTP Webhook, и оба имени должны быть уникальными.

1. Укажите значения [параметров триггера HTTP Webhook,](../logic-apps/logic-apps-workflow-actions-triggers.md#http-webhook-trigger) которые вы хотите использовать для вызовов подписки и подписки.

   В этом примере триггер включает методы, УРИ и органы сообщений для использования при выполнении операций подписки и отписаться.

   ![Введите параметры триггера HTTP Webhook](./media/connectors-native-webhook/http-webhook-trigger-parameters.png)

   | Свойство | Обязательно | Описание |
   |----------|----------|-------------|
   | **Подписка - Метод** | Да | Метод использования при подписке на конечную точку цели |
   | **Подписка - URI** | Да | URL для использования для подписки на конечную точку цели |
   | **Подписка - Тело** | нет | Любой орган сообщения, который можно включить в запрос подписки. Этот пример включает URL-адрес обратного вызова, который однозначно идентифицирует абонента, который является вашим логическим приложением, с помощью `@listCallbackUrl()` выражения для получения URL-адреса обратного вызова приложения. |
   | **Отписаться - Метод** | нет | Метод использования при отпиши от целевой точки |
   | **Отписаться - URI** | нет | URL для использования для отпиши от целевой точки |
   | **Отписаться - Тело** | нет | Дополнительный орган сообщения для включения в запрос от подписки <p><p>**Примечание**: Это свойство не `listCallbackUrl()` поддерживает использование функции. Тем не менее, триггер автоматически включает `x-ms-client-tracking-id` и `x-ms-workflow-operation-name`отправляет заголовки, и , которые целевая служба может использовать для однозначной идентификации абонента. |
   ||||

1. Чтобы добавить другие триггерные свойства, откройте **список параметров Добавить.**

   ![Добавить дополнительные свойства триггера](./media/connectors-native-webhook/http-webhook-trigger-add-properties.png)

   Например, если вам необходимо использовать аутентификацию, вы можете добавить свойства **подписки - Аутентификация** и **отменить подписку - Аутентификация.** Для получения дополнительной информации о типах аутентификации, доступных для HTTP Webhook, [см.](../logic-apps/logic-apps-securing-a-logic-app.md#add-authentication-outbound)

1. Продолжите создание рабочего процесса приложения логики с действиями, выполняемыми при срабатывании триггера.

1. Когда вы закончите, закончите, не забудьте сохранить приложение логики. На панели инструментов конструктора щелкните **Сохранить**.

   Сохранение логики приложение вызывает конечную точку подписи на целевой службы и регистрирует URL-адрес обратного вызова. Затем приложение логики ждет отправки запроса целевой `HTTP POST` службой на URL-адрес обратного вызова. Когда это событие происходит, триггер срабатывает и передает любые данные в запросе вместе с рабочим процессом. Если эта операция успешно завершена, триггер откажется от конечных точек, и приложение логики продолжает оставшийся рабочий процесс.

## <a name="add-an-http-webhook-action"></a>Добавление действия HTTP Webhook

Это встроенное действие вызывает конечную точку подписки в целевой службе и регистрирует URL-адрес обратноса в целевой службе. Затем приложение логики приостанавливается и ждет, `HTTP POST` пока целевая служба отправит запрос на URL-адрес обратного вызова. Когда это событие происходит, действие передает любые данные в запросе вместе с рабочим процессом. Если операция успешно завершена, действие откажется от конечных точек, и приложение логики продолжает выполнять оставшийся рабочий процесс.

1. Войдите на [портал Azure](https://portal.azure.com). Создание приложения логики в Конструкторе приложений логики.

   В этом примере в качестве первого шага используется триггер HTTP Webhook.

1. Под шагом, где вы хотите добавить действие HTTP Webhook, выберите **новый шаг.**

   Чтобы добавить действие между шагами, переместите указатель на стрелку между шагами. Выберите знак**+** плюс (), который появляется, а затем выберите **Добавить действие.**

1. В поле поиска дизайнера `http webhook` введите фильтр. Из списка **действий** выберите действие **HTTP Webhook.**

   ![Выберите действие HTTP Webhook](./media/connectors-native-webhook/select-http-webhook-action.png)

   Этот пример переименовывает действие в "действие HTTP Webhook", так что шаг имеет более описательное имя.

1. Предоставьте значения для параметров действия HTTP Webhook, которые аналогичны [параметрам триггера HTTP Webhook,](../logic-apps/logic-apps-workflow-actions-triggers.md#http-webhook-trigger)которые необходимо использовать для вызовов подписки и подписки.

   В этом примере действие включает методы, УРИ и органы сообщений для использования при выполнении операций подписки и отписаться.

   ![Введите параметры действия HTTP Webhook](./media/connectors-native-webhook/http-webhook-action-parameters.png)

   | Свойство | Обязательно | Описание |
   |----------|----------|-------------|
   | **Подписка - Метод** | Да | Метод использования при подписке на конечную точку цели |
   | **Подписка - URI** | Да | URL для использования для подписки на конечную точку цели |
   | **Подписка - Тело** | нет | Любой орган сообщения, который можно включить в запрос подписки. Этот пример включает URL-адрес обратного вызова, который однозначно идентифицирует абонента, который является вашим логическим приложением, с помощью `@listCallbackUrl()` выражения для получения URL-адреса обратного вызова приложения. |
   | **Отписаться - Метод** | нет | Метод использования при отпиши от целевой точки |
   | **Отписаться - URI** | нет | URL для использования для отпиши от целевой точки |
   | **Отписаться - Тело** | нет | Дополнительный орган сообщения для включения в запрос от подписки <p><p>**Примечание**: Это свойство не `listCallbackUrl()` поддерживает использование функции. Тем не менее, действие автоматически включает `x-ms-client-tracking-id` и `x-ms-workflow-operation-name`отправляет заголовки, и, которые целевая служба может использовать для однозначной идентификации абонента. |
   ||||

1. Чтобы добавить другие свойства действия, откройте список **параметров Добавить.**

   ![Добавить дополнительные свойства действий](./media/connectors-native-webhook/http-webhook-action-add-properties.png)

   Например, если вам необходимо использовать аутентификацию, вы можете добавить свойства **подписки - Аутентификация** и **отменить подписку - Аутентификация.** Для получения дополнительной информации о типах аутентификации, доступных для HTTP Webhook, [см.](../logic-apps/logic-apps-securing-a-logic-app.md#add-authentication-outbound)

1. Когда вы закончите, не забудьте сохранить свое приложение логики. На панели инструментов конструктора щелкните **Сохранить**.

   Теперь, когда это действие выполняется, приложение логики вызывает конечную точку подписи в целевой службе и регистрирует URL-адрес обратного вызова. Затем приложение логики приостанавливает рабочий процесс и ждет, `HTTP POST` пока целевая служба отправит запрос на URL-адрес обратного вызова. Когда это событие происходит, действие передает любые данные в запросе вместе с рабочим процессом. Если операция успешно завершена, действие откажется от конечных точек, и приложение логики продолжает выполнять оставшийся рабочий процесс.

## <a name="connector-reference"></a>Справочник по соединителям

Для получения дополнительной [информации](../logic-apps/logic-apps-workflow-actions-triggers.md#http-webhook-trigger)о параметрах триггера и действия, которые похожи друг на друга, см.

### <a name="output-details"></a>Сведения о выходных данных

Вот более подробная информация о выводах из триггера или действия HTTP Webhook, который возвращает эту информацию:

| Имя свойства | Тип | Описание |
|---------------|------|-------------|
| Заголовки | объект | Заголовки из запроса |
| текст | объект | Объект JSON | Объект с содержанием тела из запроса |
| Код состояния | INT | Код состояния из запроса |
|||

| Код состояния | Описание |
|-------------|-------------|
| 200 | OK |
| 202 | Принято |
| 400 | Недопустимый запрос |
| 401 | Не авторизовано |
| 403 | Запрещено |
| 404 | Не найдено |
| 500 | Внутренняя ошибка сервера. Произошла неизвестная ошибка. |
|||

## <a name="next-steps"></a>Дальнейшие действия

* См. дополнительные сведения о других [соединителях Logic Apps](../connectors/apis-list.md).
