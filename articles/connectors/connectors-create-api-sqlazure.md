---
title: Подключение к серверу SQL Server или Базе данных SQL Azure
description: Автоматизируйте задачи для баз данных SQL в локальной среде или в облаке с помощью Azure Logic Apps.
services: logic-apps
ms.suite: integration
ms.reviewer: estfan, jonfan, logicappspm
ms.topic: conceptual
ms.date: 05/12/2020
tags: connectors
ms.openlocfilehash: c32e17aaf83c233ad77bbbf607c30cc526253352
ms.sourcegitcommit: 90d2d95f2ae972046b1cb13d9956d6668756a02e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/14/2020
ms.locfileid: "83402602"
---
# <a name="automate-workflows-for-sql-server-or-azure-sql-database-by-using-azure-logic-apps"></a>Автоматизация рабочих процессов для SQL Server или Базы данных SQL Azure с помощью Azure Logic Apps

В этой статье описано, как получить доступ к данным в базе данных SQL из приложения логики с помощью соединителя SQL Server. Так вы можете автоматизировать задачи, процессы или рабочие процессы, которые управляют данными и ресурсами SQL, создав приложения логики. Соединитель SQL Server можно использовать как для [локального сервера SQL Server](https://docs.microsoft.com/sql/sql-server/sql-server-technical-documentation), так и для [облачной Базы данных SQL Azure](https://docs.microsoft.com/azure/sql-database/sql-database-technical-overview).

Вы можете создавать приложения логики, которые активируются событиями в базе данных SQL или в других системах, таких как Dynamics CRM Online. Приложения логики могут получать, вставлять или удалять данные, а также выполнять хранимые процедуры и SQL-запросы. Например, вы можете создать приложение логики, которое автоматически проверяет наличие новых записей в Dynamics CRM Online, добавляет элементы в Базу данных SQL для новых записей, а затем отправляет оповещения по электронной почте о добавленных элементах.

Если вы не знакомы с приложениями логики, ознакомьтесь со статьями [Что такое Azure Logic Apps](../logic-apps/logic-apps-overview.md) и [Краткое руководство. Создание первого автоматизированного рабочего процесса с помощью Azure Logic Apps на портале Azure](../logic-apps/quickstart-create-first-logic-app-workflow.md). Технические сведения о соединителях, их ограничениях и известных проблемах доступны на странице [справочных материалов по соединителям SQL Server](https://docs.microsoft.com/connectors/sql/).

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас нет ее, вы можете [зарегистрироваться для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/).

* [База данных SQL Server](https://docs.microsoft.com/sql/relational-databases/databases/create-a-database) или [База данных SQL Azure](../sql-database/sql-database-get-started-portal.md).

  Чтобы при вызове операций приложение логики могло вернуть результаты, таблицы должны содержать данные. Если вы создаете базу данных SQL Azure, вы также можете использовать предоставляемые примеры баз данных.

* Имя сервера SQL, имя базы данных, а также имя пользователя и пароль. Эти учетные данные используются для авторизации приложения логики и получения доступа к серверу SQL.

  * Для Базы данных SQL Server эти сведения можно найти в строке подключения:

    `Server={your-server-address};Database={your-database-name};User Id={your-user-name};Password={your-password};`

  * Для Базы данных Azure SQL эти сведения можно найти в строке подключения или на портале Azure в свойствах базы данных SQL:

    `Server=tcp:{your-server-name}.database.windows.net,1433;Initial Catalog={your-database-name};Persist Security Info=False;User ID={your-user-name};Password={your-password};MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;`

* [Локальный шлюз данных](../logic-apps/logic-apps-gateway-install.md), установленный на локальном компьютере, и [ресурс шлюза данных Azure, созданный на портале Azure](../logic-apps/logic-apps-gateway-connection.md), для следующих сценариев.

  * Приложения логики не запускаются в [среде службы интеграции](../logic-apps/connect-virtual-network-vnet-isolated-environment-overview.md) (ISE).

  * Приложение логики *выполняется* в среде службы интеграции, но для подключения SQL Server необходимо использовать проверку подлинности Windows. В этом сценарии используйте версию соединителя SQL Server не для ISE и шлюз данных, так как версия для ISE не поддерживает проверку подлинности Windows.

* Приложения логики с возможностью доступа к базе данных SQL. Чтобы запустить приложение логики с помощью триггера SQL, требуется [пустое приложение логики](../logic-apps/quickstart-create-first-logic-app-workflow.md).

<a name="add-sql-trigger"></a>

## <a name="add-a-sql-trigger"></a>Добавление триггера SQL

В Azure Logic Apps каждое приложение логики должно запускаться по [триггеру](../logic-apps/logic-apps-overview.md#logic-app-concepts), который активируется, когда происходит определенное событие или если выполняются заданные условия. При каждом срабатывании триггера обработчик Logic Apps создает экземпляр приложения логики, запускающий рабочий процесс приложения логики.

1. На портале Azure или в Visual Studio создайте пустое приложение логики. Откроется конструктор Logic Apps. В этом примере используется портал Azure.

1. В конструкторе в поле поиска введите "sql server" в качестве фильтра. В списке триггеров выберите нужный триггер SQL.

   В этом примере используется триггер **При создании элемента**.

   ![Выбор триггера "При создании элемента"](./media/connectors-create-api-sqlazure/select-sql-server-trigger.png)

1. Если предлагается создать подключение, [создайте подключение SQL](#create-connection). Если подключение существует, выберите **Имя таблицы**.

   ![Выберите соответствующую таблицу.](./media/connectors-create-api-sqlazure/azure-sql-database-table.png)

1. Задайте **интервал** и **частоту**, с которыми приложение логики будет проверять таблицу.

   Этот триггер возвращает только одну строку из выбранной таблицы. Для выполнения других задач добавьте действия, которые выполняют эти задачи. Например, чтобы просмотреть данные в этой строке, можно добавить другие действия, которые создают файл, содержащий поля из возвращенной строки, а затем отправляют оповещения по электронной почте. Дополнительные сведения о других доступных действиях для этого соединителя см. на странице [справочных материалов по соединителю](https://docs.microsoft.com/connectors/sql/).

1. По завершении нажмите кнопку **Сохранить** на панели инструментов конструктора.

   Этот шаг автоматически включает и публикует приложение логики в Azure в реальном времени.

<a name="add-sql-action"></a>

## <a name="add-a-sql-action"></a>Добавление действия SQL

В Azure Logic Apps [действие](../logic-apps/logic-apps-overview.md#logic-app-concepts) — это шаг в рамках рабочего процесса, выполняемый после срабатывания триггера или другого действия. В этом примере приложение логики запускается при срабатывании [триггера повторения](../connectors/connectors-native-recurrence.md). Оно вызывает действие, которое получает строку из базы данных SQL.

1. На портале Azure или в Visual Studio откройте приложение логики в конструкторе Logic Apps. В этом примере используется портал Azure.

1. Для триггера или действия, в которое вы хотите добавить действие SQL, выберите **Создать шаг**.

   ![Добавление нового шага в приложение логики](./media/connectors-create-api-sqlazure/select-new-step-logic-app.png)

   Чтобы добавить действие между существующими шагами, наведите указатель мыши на соединяющую стрелку. Нажмите появившийся знак "плюс" ( **+** ), а затем выберите **Добавить действие**.

1. В разделе **Выберите действие** введите фильтр "sql server" в поле поиска. Из списка действий выберите соответствующее действие SQL.

   В этом примере используется действие **Получить строку**, которое получает одну запись.

   ![Поиск и выбор действия SQL "Получить строку"](./media/connectors-create-api-sqlazure/find-select-sql-get-row-action.png)

   Это действие возвращает только одну строку из выбранной таблицы. Чтобы просмотреть данные в этой строке, можно добавить другие действия, которые создают файл с полями из возвращенной строки и сохраняют этот файл в облачной учетной записи хранения. Дополнительные сведения о других доступных действиях для этого соединителя см. на странице [справочных материалов по соединителю](https://docs.microsoft.com/connectors/sql/).

1. Если предлагается создать подключение, [создайте подключение SQL](#create-connection). Если подключение существует, выберите **Имя таблицы** и введите **идентификатор строки** для нужной записи.

   ![Ввод имени таблицы и идентификатора строки](./media/connectors-create-api-sqlazure/specify-table-row-id-property-value.png)

1. По завершении нажмите кнопку **Сохранить** на панели инструментов конструктора.

   Этот шаг автоматически включает и публикует приложение логики в Azure в реальном времени.

<a name="create-connection"></a>

## <a name="connect-to-your-database"></a>Подключение к базе данных

[!INCLUDE [Create connection general intro](../../includes/connectors-create-connection-general-intro.md)]

[!INCLUDE [Create a connection to SQL Server or Azure SQL Database](../../includes/connectors-create-api-sqlazure.md)]

## <a name="handle-bulk-data"></a>Обработка больших данных

Иногда требуется оперировать такими большими результирующими наборами, что соединитель не может вернуть все результаты одновременно, либо требуется контролировать размер и структуру результирующих наборов. Ниже приведено несколько способов, помогающих справиться с большими результирующими наборами.

* Чтобы упростить управление результатами в виде небольших наборов, включите *разбиение на страницы*. Дополнительные сведения см. в разделе [Получение дополнительных данных, элементов или записей с помощью разбиения на страницы в Azure Logic Apps](../logic-apps/logic-apps-exceed-default-page-size-with-pagination.md).

* Создайте хранимую процедуру, которая упорядочивает результаты подходящим вам способом.

  При получении или вставке нескольких строк приложение логики может выполнять их итерацию с помощью [*цикла UNTIL*](../logic-apps/logic-apps-control-flow-loops.md#until-loop) с учетом этих [ограничений](../logic-apps/logic-apps-limits-and-config.md). Но иногда приложение логики должно работать с настолько большими наборами данных, например с тысячами или миллионами строк, что целесообразно сократить расходы на вызовы к базе данных.

  Чтобы упорядочить результаты подходящим вам способом, можно создать [*хранимую процедуру*](https://docs.microsoft.com/sql/relational-databases/stored-procedures/stored-procedures-database-engine), которая выполняется в экземпляре SQL и использует инструкцию **SELECT - ORDER BY**. Это решение позволяет управлять размером и структурой полученных результатов. Приложение логики вызывает хранимую процедуру с помощью действия **выполнения хранимой процедуры** соединителя SQL Server.

  Дополнительные сведения о решении:

  * [Разбиение на страницы в SQL для массовой передачи данных с помощью Logic Apps](https://social.technet.microsoft.com/wiki/contents/articles/40060.sql-pagination-for-bulk-data-transfer-with-logic-apps.aspx)

  * [Предложение SELECT - ORDER BY](https://docs.microsoft.com/sql/t-sql/queries/select-order-by-clause-transact-sql)

### <a name="handle-dynamic-bulk-data"></a>Обработка динамических больших данных

Иногда при вызове хранимой процедуры в соединителе SQL Server возвращаемые выходные данные являются динамическими. В этом случае выполните следующее.

1. Откройте **конструктор Logic Apps**.
1. Выполните тестовый запуск своего приложения логики, чтобы просмотреть выходной формат. Скопируйте пример выходных данных.
1. В конструкторе в действии, в котором вызывается хранимая процедура, выберите **Новый шаг**.
1. В разделе **Выберите действие** найдите и выберите действие [**Анализ JSON**](../logic-apps/logic-apps-perform-data-operations.md#parse-json-action).
1. В действии **Анализ JSON** выберите **Использовать образец полезных данных для создания схемы**.
1. В окне **Enter or paste a sample JSON payload** (Введите или вставьте пример полезных данных JSON) вставьте пример выходных данных, а затем выберите **Готово**.
1. Если появится сообщение о том, что Logic Apps не удается создать схему, проверьте правильность формата синтаксиса примера выходных данных. Если вы по-прежнему не можете создать схему, введите ее вручную в поле **Схема**.
1. На панели инструментов конструктора щелкните **Сохранить**.
1. Чтобы обращаться к свойствам содержимого JSON, используйте маркеры данных, которые отображаются в списке динамического содержимого для действия [**Анализ JSON**](../logic-apps/logic-apps-perform-data-operations.md#parse-json-action).

## <a name="connector-specific-details"></a>Сведения о соединителях

Дополнительные технические сведения о триггерах, действиях и ограничениях этого соединителя доступны на странице [справочных материалов о соединителе](https://docs.microsoft.com/connectors/sql/).

## <a name="next-steps"></a>Дальнейшие действия

* Узнайте больше о других [соединителях для Azure Logic Apps](../connectors/apis-list.md).
