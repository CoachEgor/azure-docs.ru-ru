---
title: Подключение к SQL Server или базе данных SQL Azure — Azure Logic Apps
description: Автоматизируйте задачи для баз данных SQL в локальной среде или в облаке с помощью Azure Logic Apps
services: logic-apps
ms.service: logic-apps
ms.suite: integration
author: ecfan
ms.author: estfan
ms.reviewer: klam; LADocs
manager: carmonm
ms.topic: conceptual
tags: connectors
ms.date: 11/08/2019
ms.openlocfilehash: a6367e5897e9bd548550b099c0bd2e6186845d6d
ms.sourcegitcommit: ac56ef07d86328c40fed5b5792a6a02698926c2d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/08/2019
ms.locfileid: "73826333"
---
# <a name="automate-workflows-for-sql-server-or-azure-sql-database-by-using-azure-logic-apps"></a>Автоматизация рабочих процессов для SQL Server или базы данных SQL Azure с помощью Azure Logic Apps

В этой статье описано, как получить доступ к данным в базе данных SQL из приложения логики с помощью соединителя SQL Server. Таким образом, можно автоматизировать задачи, процессы или рабочие процессы, которые управляют данными и ресурсами SQL, создавая приложения логики. Соединитель SQL Server работает как для [локальной SQL Server](https://docs.microsoft.com/sql/sql-server/sql-server-technical-documentation) , так и для [облачной базы данных SQL Azure](https://docs.microsoft.com/azure/sql-database/sql-database-technical-overview).

Вы можете создавать приложения логики, которые активируются событиями в базе данных SQL или в других системах, таких как Dynamics CRM Online. Приложения логики могут также получать, вставлять и удалять данные вместе с выполнением запросов SQL и хранимых процедур. Например, можно создать приложение логики, которое автоматически проверяет наличие новых записей в Dynamics CRM Online, добавляет элементы в базу данных SQL для новых записей, а затем отправляет оповещения по электронной почте о добавленных элементах.

Если вы не работали с приложениями логики, см. руководства по [Azure Logic Apps](../logic-apps/logic-apps-overview.md) и [созданию первого приложения логики](../logic-apps/quickstart-create-first-logic-app-workflow.md). Технические сведения, ограничения и известные проблемы, связанные с соединителем, см. на [странице справочника по соединителю SQL Server](https://docs.microsoft.com/connectors/sql/).

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас нет ее, вы можете [зарегистрироваться для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/).

* [База данных SQL Server](https://docs.microsoft.com/sql/relational-databases/databases/create-a-database) или [база данных SQL Azure](../sql-database/sql-database-get-started-portal.md)

  Чтобы при вызове операций приложение логики могло вернуть результаты, таблицы должны содержать данные. Если вы создаете базу данных SQL Azure, вы также можете использовать предоставляемые примеры баз данных.

* Имя сервера SQL, имя базы данных, а также имя пользователя и пароль. Эти учетные данные используются для авторизации приложения логики и получения доступа к серверу SQL.

  * Для Базы данных SQL Server эти сведения можно найти в строке подключения:

    `Server={your-server-address};Database={your-database-name};User Id={your-user-name};Password={your-password};`

  * Для Базы данных Azure SQL эти сведения можно найти в строке подключения или на портале Azure в свойствах базы данных SQL:

    `Server=tcp:{your-server-name}.database.windows.net,1433;Initial Catalog={your-database-name};Persist Security Info=False;User ID={your-user-name};Password={your-password};MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;`

* Локальный [шлюз данных](../logic-apps/logic-apps-gateway-install.md) , установленный на локальном компьютере, и [ресурс шлюза данных Azure, созданный в портал Azure](../logic-apps/logic-apps-gateway-connection.md) для следующих сценариев:

  * Приложения логики не выполняются в [среде службы интеграции (ISE)](../logic-apps/connect-virtual-network-vnet-isolated-environment-overview.md).

  * *Приложения логики выполняются в* среде службы интеграции, но для подключения к SQL Server необходимо использовать проверку подлинности Windows. В этом сценарии используется версия, не относящаяся к ИНТЕГРИРОВАНному соединителю SQL Server, а также шлюз данных, так как среда ISE не поддерживает проверку подлинности Windows.

* Приложения логики с возможностью доступа к базе данных SQL. Чтобы запустить приложение логики с помощью триггера SQL, требуется [пустое приложение логики](../logic-apps/quickstart-create-first-logic-app-workflow.md).

<a name="add-sql-trigger"></a>

## <a name="add-a-sql-trigger"></a>Добавление триггера SQL

В Azure Logic Apps каждое приложение логики должно запускаться по [триггеру](../logic-apps/logic-apps-overview.md#logic-app-concepts), который активируется, когда происходит определенное событие или если выполняются заданные условия. При каждом срабатывании триггера обработчик Logic Apps создает экземпляр приложения логики и начинает выполнение рабочего процесса приложения логики.

1. На портале Azure или в Visual Studio создайте пустое приложение логики. Откроется конструктор Logic Apps. В этом примере используется портал Azure.

1. В конструкторе в поле поиска введите "SQL Server" в качестве фильтра. В списке триггеров выберите нужный триггер SQL.

   В этом примере используется триггер **при создании элемента** .

   ![Выберите триггер "при создании элемента"](./media/connectors-create-api-sqlazure/select-sql-server-trigger.png)

1. При появлении запроса на создание подключения [Создайте подключение SQL](#create-connection). Если подключение существует, выберите **имя таблицы**.

   ![Выберите нужную таблицу.](./media/connectors-create-api-sqlazure/azure-sql-database-table.png)

1. Задайте **интервал** и **частоту**, с которыми приложение логики будет проверять таблицу.

   Этот триггер возвращает только одну строку из выбранной таблицы, что еще не происходит. Для выполнения других задач добавьте другие действия, которые выполняют нужные задачи. Например, чтобы просмотреть данные в этой строке, можно добавить другие действия, которые создают файл, включающий поля из возвращенной строки, а затем отправляют оповещения по электронной почте. Дополнительные сведения о других доступных действиях для этого соединителя см. на [странице справочника по соединителю](https://docs.microsoft.com/connectors/sql/).

1. Когда все будет готово, на панели инструментов конструктора нажмите кнопку **сохранить**.

   Этот шаг автоматически включает и публикует приложение логики в Azure в реальном времени.

<a name="add-sql-action"></a>

## <a name="add-a-sql-action"></a>Добавление действия SQL

В Azure Logic Apps [действие](../logic-apps/logic-apps-overview.md#logic-app-concepts) — это шаг в рамках рабочего процесса, выполняемый после срабатывания триггера или другого действия. В этом примере приложение логики запускается при срабатывании [триггера повторения](../connectors/connectors-native-recurrence.md). Оно вызывает действие, которое получает строку из базы данных SQL.

1. На портале Azure или в Visual Studio откройте приложение логики в конструкторе Logic Apps. В этом примере используется портал Azure.

1. В разделе триггер или действие, в которое необходимо добавить действие SQL, выберите **новый шаг**.

   ![Добавление нового шага в приложение логики](./media/connectors-create-api-sqlazure/select-new-step-logic-app.png)

   Чтобы добавить действие между существующими шагами, наведите указатель мыши на соединяющую стрелку. Выберите отображаемый знак «плюс» ( **+** ), а затем щелкните **Добавить действие**.

1. В разделе **выберите действие**в поле поиска введите "SQL Server" в качестве фильтра. В списке действия выберите нужное действие SQL.

   В этом примере используется действие **получить строку** , которое получает одну запись.

   ![Поиск и выбор действия "получить строку" SQL](./media/connectors-create-api-sqlazure/find-select-sql-get-row-action.png)

   Это действие возвращает только одну строку из выбранной таблицы, но не другие. Чтобы просмотреть данные в этой строке, можно добавить другие действия, которые создают файл, включающий поля из возвращенной строки, и сохраняют этот файл в облачной учетной записи хранения. Дополнительные сведения о других доступных действиях для этого соединителя см. на [странице справочника по соединителю](https://docs.microsoft.com/connectors/sql/).

1. При появлении запроса на создание подключения [Создайте подключение SQL](#create-connection). Если подключение существует, выберите **имя таблицы**и введите **идентификатор строки** для нужной записи.

   ![Ввод имени таблицы и идентификатора строки](./media/connectors-create-api-sqlazure/specify-table-row-id-property-value.png)

1. Когда все будет готово, на панели инструментов конструктора нажмите кнопку **сохранить**.

   Этот шаг автоматически включает и публикует приложение логики в Azure в реальном времени.

<a name="create-connection"></a>

## <a name="connect-to-your-database"></a>Подключение к базе данных

[!INCLUDE [Create connection general intro](../../includes/connectors-create-connection-general-intro.md)]

[!INCLUDE [Create a connection to SQL Server or Azure SQL Database](../../includes/connectors-create-api-sqlazure.md)]

## <a name="handle-bulk-data"></a>Обработку больших данных

Иногда приходится работать с результирующими наборами так, чтобы соединитель не возвращал все результаты одновременно, или вы хотите лучше контролировать размер и структуру для результирующих наборов. Вот несколько способов, с которыми можно справиться с большими результирующими наборами:

* Чтобы упростить управление результатами в виде небольших наборов, включите *разбивку на страницы*. Дополнительные сведения см. в разделе [получение небольшого объема данных, записей и элементов с помощью разбиения на страницы](../logic-apps/logic-apps-exceed-default-page-size-with-pagination.md).

* Создайте хранимую процедуру, которая упорядочивает результаты тем способом, который вам нужен.

  При получении или вставке нескольких строк приложение логики может выполнить итерацию по этим строкам, используя [*цикл Until*](../logic-apps/logic-apps-control-flow-loops.md#until-loop) в пределах этих [ограничений](../logic-apps/logic-apps-limits-and-config.md). Однако, если приложение логики должно работать с наборами записей настолько крупно, например, тысячи или миллионы строк, то необходимо сократить затраты, возникающие в результате вызовов к базе данных.

  Чтобы упорядочить результаты нужным образом, можно создать [*хранимую процедуру*](https://docs.microsoft.com/sql/relational-databases/stored-procedures/stored-procedures-database-engine) , которая выполняется в экземпляре SQL, и использовать инструкцию **SELECT-ORDER BY** . Это решение позволяет управлять размером и структурой полученных результатов. Приложение логики вызывает хранимую процедуру с помощью действия **выполнения хранимой процедуры** соединителя SQL Server.

  Дополнительные сведения о решении см. в следующих статьях:

  * [Разбиение на страницы в SQL для массовой передачи данных с помощью Logic Apps](https://social.technet.microsoft.com/wiki/contents/articles/40060.sql-pagination-for-bulk-data-transfer-with-logic-apps.aspx)

  * [Предложение SELECT - ORDER BY](https://docs.microsoft.com/sql/t-sql/queries/select-order-by-clause-transact-sql)

## <a name="connector-specific-details"></a>Сведения о соединителях

Технические сведения о триггерах, действиях и ограничениях этого соединителя см. на [странице справочника по соединителю](https://docs.microsoft.com/connectors/sql/).

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о других [соединителях для Azure Logic Apps](../connectors/apis-list.md)
