---
title: Подключение к серверу SFTP с помощью SSH
description: Автоматизация задач, которые отслеживают, создают, отправляют и получают файлы для SFTP-сервера, а также управляют ими с помощью SSH и Azure Logic Apps
services: logic-apps
ms.suite: integration
author: divyaswarnkar
ms.reviewer: estfan, klam, logicappspm
ms.topic: article
ms.date: 03/7/2020
tags: connectors
ms.openlocfilehash: d4ab7425c967d3a176c0a576d0be38ece1701b8b
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79128409"
---
# <a name="monitor-create-and-manage-sftp-files-by-using-ssh-and-azure-logic-apps"></a>Мониторинг и создание SFTP-файлов, а также управление ими с помощью SSH и Azure Logic Apps

Чтобы автоматизировать задачи мониторинга, создания, отправки и получения файлов на сервере [безопасного протокола передачи файлов (SFTP)](https://www.ssh.com/ssh/sftp/) с помощью протокола [SSH](https://www.ssh.com/ssh/protocol/), создайте и автоматизируйте рабочие процессы интеграции с помощью Azure Logic Apps и соединителя SFTP-SSH. SFTP является сетевым протоколом, которому предоставляется доступ к файлам, передаче файлов и управлению файлами на основе надежного потока данных. Ниже приведены некоторые примеры задач, которые можно автоматизировать:

* мониторинг добавления или изменения файлов;
* получение, создание, копирование, переименование, перечисление, обновление и удаление файлов;
* создание папок;
* получение содержимого и метаданных файлов;
* извлечение архивов в папки.

Вы можете использовать триггеры, которые отслеживают события сервера SFTP и делают выходные данные доступными для других действий. Вы можете использовать действия для выполнения различных задач на SFTP-сервере. Кроме того, в вашем приложении логики есть другие действия, которые могут использовать выходные данные действий SFTP. Например, если вы регулярно извлекаете файлы с сервера SFTP, то можете отправлять сообщения оповещений об этих файлах и их содержимое с помощью соединителя Outlook Office 365 или Outlook.com. Если вы новичок в логических приложениях, просмотрите [Что такое приложения логики Azure?](../logic-apps/logic-apps-overview.md)

Для получения различий между разъемом SFTP-SSH и разъемом SFTP просмотрите раздел [Сравнить SFTP-SSH по сравнению с разделом SFTP](#comparison) позже в этой теме.

## <a name="limits"></a>Ограничения

* Действия SFTP-SSH, поддерживающие [куски,](../logic-apps/logic-apps-handle-large-messages.md) могут обрабатывать файлы до 1 ГБ, в то время как действия SFTP-SSH, не поддерживающие куски, могут обрабатывать файлы до 50 МБ. Хотя размер куска по умолчанию составляет 15 МБ, этот размер может динамически меняться, начиная с 5 МБ и постепенно увеличиваясь до максимума 50 МБ, исходя из таких факторов, как задержка сети, время отклика сервера и так далее.

  > [!NOTE]
  > Для логических приложений в [среде служб интеграции (ISE)](../logic-apps/connect-virtual-network-vnet-isolated-environment-overview.md)эта версия с маркировкой ISE разъема использует вместо этого [ограничения сообщений ISE.](../logic-apps/logic-apps-limits-and-config.md#message-size-limits)

  Это адаптивное поведение можно переопределить, когда вместо этого [указать постоянный размер куска.](#change-chunk-size) Этот размер может варьироваться от 5 МБ до 50 МБ. Например, предположим, что у вас есть файл 45 МБ и сеть, которая может поддерживать размер этого файла без задержки. Адаптивный chunking приводит к нескольким вызовам, а что один вызов. Чтобы уменьшить количество вызовов, можно попробовать установить размер куска 50 МБ. В другом сценарии, если приложение логики выделяетвремя, например, при использовании 15 МБ, можно попытаться уменьшить размер до 5 МБ.

  Размер фрагмента связан с соединением, что означает, что вы можете использовать одно и то же соединение для действий, поддерживающих куски, а затем для действий, не поддерживающих куски. В этом случае размер куска для действий, не поддерживающих куски, колеблется от 5 МБ до 50 МБ. В этой таблице показано, какие действия SFTP-SSH поддерживают:

  | Действие | Поддержка chunking | Переопределение поддержки размера куска |
  |--------|------------------|-----------------------------|
  | **Копировать файл** | нет | Неприменимо |
  | **Создать файл** | Да | Да |
  | **Создание папки** | Неприменимо | Неприменимо |
  | **Удалить файл** | Неприменимо | Неприменимо |
  | **Извлечение архива в папку** | Неприменимо | Неприменимо |
  | **Получение содержимого файла** | Да | Да |
  | **Получение содержимого файла с помощью пути** | Да | Да |
  | **Получить метаданные файлов** | Неприменимо | Неприменимо |
  | **Получение метаданных файла с помощью пути** | Неприменимо | Неприменимо |
  | **Вывод списка файлов в папке** | Неприменимо | Неприменимо |
  | **Переименовать файл** | Неприменимо | Неприменимо |
  | **Обновление файла** | нет | Неприменимо |
  ||||

* Триггеры SFTP-SSH не поддерживают зажим сообщения. При запросе содержимого файла триггеры выбирают только файлы, которые 15 МБ или меньше. Чтобы получить файлы больше, чем 15 МБ, следуйте этому шаблону вместо:

  1. Используйте триггер SFTP-SSH, который возвращает только свойства файлов, **например, при добавлении или изменении файла (только свойства).**

  1. Следуйте спусковой крючок с SFTP-SSH **Получить файл содержание** действий, который читает полный файл и неявно использует сообщение chunking.

<a name="comparison"></a>

## <a name="compare-sftp-ssh-versus-sftp"></a>Сравнение SFTP-SSH и SFTP

Ниже приведены остальные ключевые различия между соединителями SFTP-SSH и SFTP. Соединитель SFTP-SSH имеет следующие возможности:

* Использует [SSH.NET библиотеку,](https://github.com/sshnet/SSH.NET)которая представляет собой библиотеку Secure Shell (SSH) с открытым исходным кодом, которая поддерживает .NET.

* Предоставляет действие **Создание папки**, которое создает папку по указанному пути на сервере SFTP.

* Предоставляет действие **Переименование файла**, которое переименовывает файл на сервере SFTP.

* Выполняет кэширование подключения к серверу SFTP *продолжительностью до 1 часа*, что повышает производительность и уменьшает количество попыток подключения к серверу. Чтобы указать длительность этого поведения кэширования, измените свойство [**ClientAliveInterval**](https://man.openbsd.org/sshd_config#ClientAliveInterval) в конфигурации SSH на SFTP-сервере.

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас еще нет подписки Azure, [зарегистрируйтесь для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/).

* Ваши адреса сервера SFTP и учетные данные учетной записи, которые позволяют приложению логики получать доступ к учетной записи SFTP. Вам также необходим доступ к закрытому ключу SSH и паролю закрытого ключа SSH. Для использования кусков при загрузке больших файлов необходимо как читать, так и писать разрешения для корневой папки на сервере SFTP. В противном случае вы получите ошибку "401 Несанкционированный".

  > [!IMPORTANT]
  >
  > Соединитель SFTP-SSH поддерживает *только* эти закрытые ключи, форматы, алгоритмы и отпечатки пальцев:
  >
  > * **Частные ключевые форматы:** RSA (Rivest Shamir Adleman) и DSA (Алгоритм цифровой подписи) в форматах OpenSSH и ssh.com. Если ваш закрытый ключ находится в формате файлов PuTTY (.ppk), сначала [преобразуйте ключ в формат файла OpenSSH (.pem).](#convert-to-openssh)
  >
  > * **Алгоритмы шифрования**. DES-EDE3-CBC, DES-EDE3-CFB, DES CBC, AES-128-CBC, AES-192-CBC и AES-256-CBC.
  >
  > * **Отпечаток**. MD5
  >
  > После добавления триггера SFTP-SSH или действия, которые вы хотите, в приложение логики, вы должны предоставить информацию о подключении для вашего сервера SFTP. Когда вы предоставляете свой закрытый ключ SSH для этого соединения, ***не вводите вручную и не отспособите ключ,*** что может привести к сбою соединения. Вместо этого убедитесь, что вы ***копируете ключ*** из файла sSH private key и ***вставьте*** этот ключ в детали соединения. 
  > Для получения дополнительной информации, [см. Подключение к SFTP с разделом SSH](#connect) позже в этой статье.

* Основные знания о [том, как создавать логические приложения](../logic-apps/quickstart-create-first-logic-app-workflow.md)

* Приложение логики, из которого необходимо получить доступ к учетной записи SFTP. Чтобы начать работу с триггером SFTP-SSH, [создайте пустое приложение логики](../logic-apps/quickstart-create-first-logic-app-workflow.md). Чтобы использовать действие SFTP-SSH, запустите приложение логики с другим триггером, например триггером **Периодичность**.

## <a name="how-sftp-ssh-triggers-work"></a>Как работает sFTP-SSH

SFTP-SSH запускает работу, опрашивая файловую систему SFTP и ища любой файл, который был изменен после последнего опроса. При изменении файлов некоторые средства позволяют сохранить метку времени. В этом случае необходимо отключить эту функцию, чтобы триггер мог работать. Ниже приведены некоторые распространенные параметры:

| Клиент SFTP | Действие |
|-------------|--------|
| Winscp | Перейти к >  **опционам** > **Предпочтения**Передача**Сохранить** > **Edit** > **Timestamp** > **Отключить** |
| FileZilla | Перейти к **передаче** > **Сохранить временные метки переданных файлов** > **отключить** |
|||

Найдя новый файл, триггер проверяет, записан ли файл полностью, а не частично. Например, во время проверки файлового сервера триггером в файл могут вноситься изменения. Чтобы избежать возврата частично записанного файла, триггер отмечает метку времени для файла с последними изменениями и не возвращает его сразу. Он возвращает его только при повторном опросе сервера. Иногда такое поведение может вызвать задержку, которая удваивает интервал опроса триггера.

<a name="convert-to-openssh"></a>

## <a name="convert-putty-based-key-to-openssh"></a>Преобразование ключа на основе PuTTY в OpenSSH

Если ваш закрытый ключ находится в формате PuTTY, который использует расширение имени файла .ppk (PuTTY Private Key), сначала преобразуйте ключ в формат OpenSSH, который использует расширение имени файла .pem (Privacy Enhanced Mail).

### <a name="unix-based-os"></a>Os на основе Unix

1. Если инструменты PuTTY еще не установлены в вашей системе, сделайте это сейчас, например:

   `sudo apt-get install -y putty`

1. Выполнить эту команду, которая создает файл, который можно использовать с разъемом SFTP-SSH:

   `puttygen <path-to-private-key-file-in-PuTTY-format> -O private-openssh -o <path-to-private-key-file-in-OpenSSH-format>`

   Пример:

   `puttygen /tmp/sftp/my-private-key-putty.ppk -O private-openssh -o /tmp/sftp/my-private-key-openssh.pem`

### <a name="windows-os"></a>ОС Windows

1. Если вы еще не сделали этого уже, [скачать последний PuTTY Генератор (puttygen.exe) инструмент](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html), а затем запустить инструмент.

1. На этом экране выберите **Load**.

   ![Выберите "Загрузить"](./media/connectors-sftp-ssh/puttygen-load.png)

1. Просматривайте свой личный файл ключа в формате PuTTY и выберите **Open.**

1. Из меню **Конверсий** выберите **ключ Export OpenSSH.**

   ![Выберите ключ "Экспорт OpenSSH"](./media/connectors-sftp-ssh/export-openssh-key.png)

1. Сохраните файл закрытого `.pem` ключа с расширением имени файла.

<a name="connect"></a>

## <a name="connect-to-sftp-with-ssh"></a>Подключение к SFTP с помощью SSH

[!INCLUDE [Create connection general intro](../../includes/connectors-create-connection-general-intro.md)]

1. Войдите на [портал Azure](https://portal.azure.com) и откройте свое приложение логики в конструкторе приложений логики, если оно еще не открыто.

1. Для пустых приложений логики, `sftp ssh` в поле поиска, введите как ваш фильтр. В списке триггеров выберите нужный триггер.

   -или-

   Для существующих логических приложений, в последнем шаге, где вы хотите добавить действие, выберите **Новый шаг.** В поле поиска введите `sftp ssh` в качестве фильтра. В списке действий выберите любое необходимое действие.

   Чтобы добавить действие между шагами, переместите указатель на стрелку между шагами. Выберите знак**+** плюс (), который появляется, а затем выберите **Добавить действие.**

1. Укажите необходимые сведения для подключения.

   > [!IMPORTANT]
   >
   > При вводе закрытого ключа SSH в свойстве **закрытого ключа SSH** выполните следующие дополнительные шаги, которые помогут убедиться, что вы предоставили полное и правильное значение для этого свойства. Недопустимый ключ вызывает сбой подключения.

   Несмотря на то, что можно использовать любой текстовый редактор, ниже приведены примеры шагов, которые показывают, как правильно копировать и вставлять в него ключ. Например, с помощью Notepad.exe.

   1. Откройте файл закрытого ключа SSH в текстовом редакторе. В этих шагах Notepad используется в качестве примера.

   1. В меню Notepad **Edit** выберите **все.**

   1. Выберите **edit** > **Copy**.

   1. В триггере SFTP-SSH или действии, которое вы добавили, вставьте *полный* ключ, скопированный в свойство **закрытого ключа SSH**, которое поддерживает несколько строк.  ***Обязательно вставьте*** ключ. ***Не вводите и не изменяйте ключ вручную***.

1. Когда вы закончите ввод деталей соединения, выберите **Создать.**

1. Теперь укажите необходимые сведения для выбранного триггера или действия и продолжайте создание рабочего процесса приложения логики.

<a name="change-chunk-size"></a>

## <a name="override-chunk-size"></a>Переопределение размера куска

Чтобы переопределить адаптивное поведение по умолчанию, которое использует chunking, можно указать постоянный размер куска от 5 МБ до 50 МБ.

1. В верхнем правом углу действия выберите кнопку эллипсов **(...),** а затем выберите **настройки.**

   ![Открытые настройки SFTP-SSH](./media/connectors-sftp-ssh/sftp-ssh-connector-setttings.png)

1. В соответствии с **передачей контента**, в `5` свойстве **размера Chunk,** введите значение integer от к, `50`например: 

   ![Указать размер куска для использования вместо](./media/connectors-sftp-ssh/specify-chunk-size-override-default.png)

1. По завершении нажмите кнопку **Готово**.

## <a name="examples"></a>Примеры

<a name="file-added-modified"></a>

### <a name="sftp---ssh-trigger-when-a-file-is-added-or-modified"></a>Триггер SFTP-SSH. Добавление или изменение файла

Если на сервере SFTP добавлен или изменен файл, триггер запускает рабочий процесс приложения логики. Например, вы можете добавить условие, которое проверяет содержимое файла и получает его в зависимости от того, соответствует ли содержимое указанному условию. Затем вы можете добавить действие, которое получает содержимое файла и помещает его в папку на сервере SFTP.

В **контексте предприятия** можно использовать этот триггер, чтобы отслеживать в папке SFTP новые файлы, представляющие заказы клиентов. Вы также можете использовать действие SFTP **Получить содержимое файла**, чтобы получить содержимое заказа для дальнейшей обработки и хранения в базе данных заказов.

<a name="get-content"></a>

### <a name="sftp---ssh-action-get-content-using-path"></a>SFTP - SSH действий: Получить содержание с помощью пути

Это действие получает содержимое из файла на сервере SFTP. Например, вы можете добавить триггер из предыдущего примера и условие, которому должно соответствовать содержимое файла. Если оно соответствует условию, действие, которое получает содержимое, может выполняться.

## <a name="connector-reference"></a>Справочник по соединителям

Для получения более подробной информации об этом разъеме, таких как триггеры, действия и ограничения, описанные в файле Swagger разъема, смотрите [страницу ссылки разъема.](https://docs.microsoft.com/connectors/sftpwithssh/)

> [!NOTE]
> Для логических приложений в [среде служб интеграции (ISE)](../logic-apps/connect-virtual-network-vnet-isolated-environment-overview.md)эта версия с маркировкой ISE разъема использует вместо этого [ограничения сообщений ISE.](../logic-apps/logic-apps-limits-and-config.md#message-size-limits)

## <a name="next-steps"></a>Дальнейшие действия

* См. дополнительные сведения о других [соединителях Logic Apps](../connectors/apis-list.md).
