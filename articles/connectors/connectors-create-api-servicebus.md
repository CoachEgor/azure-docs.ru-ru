---
title: Обмен сообщениями с автобусом Службы Azure
description: Создавайте автоматизированные задачи и рабочие процессы, которые отправляют и получают сообщения с помощью azure Service Bus в приложениях логики Azure
services: logic-apps
ms.suite: integration
ms.reviewer: klam, logicappspm
ms.topic: conceptual
ms.date: 09/19/2019
tags: connectors
ms.openlocfilehash: 1b38b8508dbe17d42bf191149410f5db638cf834
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "76261625"
---
# <a name="exchange-messages-in-the-cloud-by-using-azure-logic-apps-and-azure-service-bus"></a>Обмен сообщениями в облаке с помощью приложений Azure Logic Apps и шины служб Azure

С [помощью azure Logic Apps](../logic-apps/logic-apps-overview.md) и разъема [Azure Service Bus](../service-bus-messaging/service-bus-messaging-overview.md) можно создавать автоматизированные задачи и рабочие процессы, которые передают данные, такие как заказы на продажи и покупки, журналы и перемещения запасов по приложениям для организации. Соединитель не только отслеживает, отправляет сообщения и управляет ими, но также выполняет действия с очередями, сеансами, разделами, подписками и т. д., например:

* Отслеживает прибытие (автозавершение) или прием сообщений (с блокировкой при извлечении) в очередях, разделах и подписках на разделы.
* Отправляет сообщения.
* Создает и удаляет подписки на разделы.
* Управляет сообщениями в очередях и подписках на разделы, например, выполняет такие действия, как получение сообщения, получение отложенного сообщения, заполнение, отложение, прерывание и размещение недоставленных сообщений.
* Продлевает блокировку сообщений и сеансы в очередях и подписках на разделы.
* Закрывает сеансы в очередях и разделах.

Вы можете использовать триггеры, которые получают ответы из служебной шины и делают выходные данные доступными для других действий в приложениях логики. Кроме того, выходные данные действий служебной шины могут использоваться другими действиями. Если вы новичок в приложениях для обслуживания автобусов и логики, [просмотрите, что такое Автобус службы Azure?](../service-bus-messaging/service-bus-messaging-overview.md) и [что такое приложения логики Azure?](../logic-apps/logic-apps-overview.md)

[!INCLUDE [Warning about creating infinite loops](../../includes/connectors-infinite-loops.md)]

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас еще нет подписки Azure, [зарегистрируйтесь для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/).

* Пространство имен служебной шины и сущность обмена сообщениями, например очередь. Эти элементы и приложение логики должны использовать ту же подписку Azure. Если у вас нет этих элементов, узнайте, как [создавать пространство имен служебной шины и очередь](../service-bus-messaging/service-bus-create-namespace-portal.md).

* Основные знания о [том, как создавать логические приложения](../logic-apps/quickstart-create-first-logic-app-workflow.md)

* Логическое приложение, в котором используется пространство имен Service Bus и сущность обмена сообщениями. Приложение логики и автобус обслуживания должны использовать ту же подписку Azure. Чтобы начать рабочий процесс с триггера Service Bus, [создайте пустое приложение логики.](../logic-apps/quickstart-create-first-logic-app-workflow.md) Чтобы использовать действие шины обслуживания в рабочем процессе, запустите приложение логики с другим триггером, например, [триггером Recurrence.](../connectors/connectors-native-recurrence.md)

<a name="permissions-connection-string"></a>

## <a name="check-permissions"></a>Проверка разрешений

Убедитесь, что у приложения логики есть разрешения для доступа к пространству имен служебной шины.

1. Войдите на [портал Azure](https://portal.azure.com).

1. Перейдите к *пространству имен* служебной шины. На странице пространства имен в разделе **Параметры** выберите **Политики общего доступа**. В разделе **Утверждения** убедитесь, что у вас есть разрешения на **управление** для этого пространства имен.

   ![Управление разрешениями для пространства имен Service Bus](./media/connectors-create-api-azure-service-bus/azure-service-bus-namespace.png)

1. Получите строку подключения для пространства имен служебной шины. Эта строка нужна, когда вы предоставляете информацию о подключении в приложении логики.

   1. На панели **общих политик доступа** выберите **RootManageSharedAccessKey.**
   
   1. Рядом с основной строкой соединения выберите кнопку копирования. Сохраните строку подключения для дальнейшего использования.

      ![Копирование строки подключения к пространству имен служебной шины](./media/connectors-create-api-azure-service-bus/find-service-bus-connection-string.png)

   > [!TIP]
   > Чтобы проверить, относится ли строка подключения к пространству имен служебной шины или к сущности обмена сообщениями, например очереди, найдите в ней параметр `EntityPath` . Если в строке подключения есть такой параметр, значит она относится к определенной сущности и ее нельзя использовать в приложении логики.

## <a name="add-service-bus-trigger"></a>Добавление триггера сервисного автобуса

[!INCLUDE [Create connection general intro](../../includes/connectors-create-connection-general-intro.md)]

1. Вопийте на [портале Azure](https://portal.azure.com)и откройте свое пустое логическое приложение в Logic App Designer.

1. В поле поиска введите "лазурный сервисный автобус" в качестве фильтра. Из списка триггеров выберите нужный триггер.

   Например, чтобы запустить приложение логики при отправке нового элемента в очередь Service Bus, выберите **когда сообщение получено в триггере очереди (автозаполнении).**

   ![Выбор триггера служебной шины](./media/connectors-create-api-azure-service-bus/select-service-bus-trigger.png)

   Все триггеры Service Bus являются *триггерами длительного опроса.* Это описание означает, что при спусковом запуске триггер обрабатывает все сообщения, а затем ждет 30 секунд, пока в очереди или подписке темы появится больше сообщений. Если на протяжении 30 секунд новые сообщения не поступают, триггер больше не срабатывает. В противном случае триггер продолжит считывать сообщения, пока очередь или подписка раздела не опустеет. Следующий опрос триггера основывается на интервале повторения, установленном в свойствах триггера.

   Некоторые триггеры, такие как **когда одно или несколько сообщений поступают в очереди (авто-полный)** триггер, могут вернуть одно или несколько сообщений. Когда эти триггеры срабатывают, они возвращаются между одним и числом сообщений, указанных свойством **максимального количества сообщений** триггера.

1. Если триггер подключается к вашего пространства имен Service Bus в первый раз, выполните следующие действия, когда Logic App Designer подскажет вам информацию о подключении.

   1. Укажите имя для подключения и выберите нужное пространство имен служебной шины.

      ![Создание подключения к служебной шине, часть 1](./media/connectors-create-api-azure-service-bus/create-service-bus-connection-trigger-1.png)

      Вместо этого, чтобы вручную ввести строку соединения, выберите **ручную информацию о подключении.** Если у вас нет строки подключения, узнайте, [как ее найти](#permissions-connection-string).

   1. Выберите политику Сервисного автобуса и **создайте .**

      ![Создание подключения к служебной шине, часть 2](./media/connectors-create-api-azure-service-bus/create-service-bus-connection-trigger-2.png)

   1. Выберите пожелательную сущность обмена сообщениями, например очередь или тему. В этом примере выберите очередь Service Bus.
   
      ![Выбор очереди служебной шины](./media/connectors-create-api-azure-service-bus/service-bus-select-queue-trigger.png)

1. Предоставьте необходимую информацию для выбранного триггера. Чтобы добавить другие доступные свойства в действие, откройте **список параметров Добавить новый** и выберите нужные свойства.

   Для триггера этого примера выберите интервал опроса и частоту для проверки очереди.

   ![Настройка интервала опроса](./media/connectors-create-api-azure-service-bus/service-bus-trigger-details.png)

   Для получения дополнительной информации о доступных триггерах и свойствах смотрите [страницу ссылки](/connectors/servicebus/)разъема.

1. Продолжайте строить приложение логики, добавляя действия, которые вы хотите.

   Например, можно добавить действие, которое отправляет сообщение электронной почты при поступлении нового сообщения. Когда триггер проверяет вашу очередь и находит новое сообщение, ваше приложение логики запускает для него выбранные действия.

## <a name="add-service-bus-action"></a>Добавление действия сервисного автобуса

[!INCLUDE [Create connection general intro](../../includes/connectors-create-connection-general-intro.md)]

1. Вопийте на [портале Azure](https://portal.azure.com)и откройте приложение логики в Logic App Designer.

1. Под шагом, где вы хотите добавить действие, выберите **Новый шаг.**

   Или, чтобы добавить действие между шагами, переместите указатель на стрелку между этими шагами. Выберите знак**+** плюс (), который появляется, и выберите **Добавить действие.**

1. При **выборе действия,** в поле поиска, введите "лазурный автобус службы" в качестве фильтра. Из списка действий выберите захотевное действие. 

   В этом примере выберите действие **сообщения «Отправить».**

   ![Выбор действия служебной шины](./media/connectors-create-api-azure-service-bus/select-service-bus-send-message-action.png) 

1. Если ваше действие подключается к вашему пространстве имен Service Bus в первый раз, выполните следующие действия, когда Logic App Designer подскажет вам информацию о подключении.

   1. Укажите имя для подключения и выберите нужное пространство имен служебной шины.

      ![Создание подключения к служебной шине, часть 1](./media/connectors-create-api-azure-service-bus/create-service-bus-connection-action-1.png)

      Вместо этого, чтобы вручную ввести строку соединения, выберите **ручную информацию о подключении.** Если у вас нет строки подключения, узнайте, [как ее найти](#permissions-connection-string).

   1. Выберите политику Сервисного автобуса и **создайте .**

      ![Создание подключения к служебной шине, часть 2](./media/connectors-create-api-azure-service-bus/create-service-bus-connection-action-2.png)

   1. Выберите пожелательную сущность обмена сообщениями, например очередь или тему. В этом примере выберите очередь Service Bus.

      ![Выбор очереди служебной шины](./media/connectors-create-api-azure-service-bus/service-bus-select-queue-action.png)

1. Укажите необходимые сведения для выбранного действия. Чтобы добавить другие доступные свойства в действие, откройте **список параметров Добавить новый** и выберите нужные свойства.

   Например, выберите свойства типа **содержимого** и **содержимого,** чтобы добавить их в действие. Затем укажите содержимое сообщения, которое вы хотите отправить.

   ![Указание содержимого сообщения и сведений](./media/connectors-create-api-azure-service-bus/service-bus-send-message-details.png)

   Для получения дополнительной информации об имеющихся действиях и их свойствах смотрите [страницу ссылки](/connectors/servicebus/)разъема.

1. Продолжайте строить приложение логики, добавляя любые другие действия, которые вы хотите.

   Например, можно добавить действие, отправляевеее электронное письмо, чтобы подтвердить, что ваше сообщение было отправлено.

1. Сохраните приложение логики. На панели инструментов конструктора щелкните **Сохранить**.

## <a name="connector-reference"></a>Справочник по соединителям

Разъем Service Bus может сэкономить до 1500 уникальных сеансов одновременно от автобуса обслуживания до кэша разъема. Если количество сеансов превышает этот предел, старые сеансы удаляются из кэша. Для получения дополнительной информации смотрите [сеансы сообщения](../service-bus-messaging/message-sessions.md).

Для других технических деталей о триггерах, действиях и ограничениях, описанных описанием OpenAPI разъема (ранее Swagger), просмотрите ссылку на [страницу](/connectors/servicebus/)разъема. Подробнее о сообщении автобусных сообщений службы Azure читайте в сообщении [службы Azure?](../service-bus-messaging/service-bus-messaging-overview.md)

## <a name="next-steps"></a>Дальнейшие действия

* См. дополнительные сведения о других [соединителях Logic Apps](../connectors/apis-list.md).
