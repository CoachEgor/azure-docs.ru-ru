---
title: Подключение к хранению Azure Blob
description: Создавайте и управляйте каплями в учетных записях хранения данных Azure с помощью приложений Azure Logic Apps
services: logic-apps
ms.suite: integration
ms.reviewer: klam, logicappspm
ms.topic: conceptual
ms.date: 02/21/2020
tags: connectors
ms.openlocfilehash: eb943bfe36be10d1e95d569a5c1bf48563e909c1
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79247362"
---
# <a name="create-and-manage-blobs-in-azure-blob-storage-by-using-azure-logic-apps"></a>Создавайте и управляйте каплями в хранилище Azure Blob с помощью приложений Azure Logic

В этой статье описано, как получить доступ к файлам, хранящимся в виде больших двоичных объектов в учетной записи хранения Azure, из приложения логики с помощью соединителя хранилища BLOB-объектов Azure. Таким образом можно создавать приложения логики, которые автоматизируют задачи и рабочие процессы по управлению файлами. Например, можно создавать приложения логики, которые создают, получают, обновляют и удаляют файлы в вашей учетной записи хранения.

Предположим, что у вас есть средство, которое обновляется на веб-сайте Azure. Оно используется как триггер для приложения логики. Когда это событие происходит, приложение логики может обновить некоторые файлы в контейнере хранилища BLOB-объектов, что является действием в приложении логики.

Если вы не работали с приложениями логики, см. руководства по [Azure Logic Apps](../logic-apps/logic-apps-overview.md) и [созданию первого приложения логики](../logic-apps/quickstart-create-first-logic-app-workflow.md). См. технические сведения о [соединителях хранилища BLOB-объектов Azure](https://docs.microsoft.com/connectors/azureblobconnector/).

> [!IMPORTANT]
> Логические приложения не могут напрямую получить доступ к учетным записям хранения, которые находятся за брандмауэрами, если они оба находятся в одном регионе. В качестве обходного пути вы можете иметь свои логические приложения и учетную запись хранения данных в разных регионах. Для получения дополнительной информации о включении доступа из приложений логики Azure к учетным записям хранения за брандмауэрами см. учетные записи хранения доступа за разделом [брандмауэров](#storage-firewalls) позже в этой теме.

<a name="blob-storage-limits"></a>

## <a name="limits"></a>Ограничения

* По умолчанию действия Azure Blob Storage могут читать или писать файлы размером *50 МБ или меньше.* Для обработки файлов размером более 50 МБ, но до 1024 МБ, действия Azure Blob Storage поддерживают [сообщение.](../logic-apps/logic-apps-handle-large-messages.md) **Действие содержимого Get blob** неявно использует chunking.

* Триггеры хранения Azure Blob не поддерживают куски. При запросе содержимого файла триггеры выбирают только файлы, которые 50 МБ или меньше. Чтобы получить файлы размером более 50 МБ, следуйте приведенному ниже шаблону:

  * Используйте триггер Azure Blob Storage, который возвращает свойства файлов, **например, при добавлении или изменении капли (только свойства).**

  * Следуйте за триггером с Azure Blob Storage Получить действие **содержимого blob,** который читает полный файл и неявно использует chunking.

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас еще нет подписки Azure, [зарегистрируйтесь для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/).

* [Учетная запись хранения Azure и контейнер хранилища.](../storage/blobs/storage-quickstart-blobs-portal.md)

* Приложения логики с возможностью доступа к учетной записи хранилища BLOB-объектов Azure. Чтобы запустить приложение логики с помощью триггера хранилища BLOB-объектов Azure, требуется [пустое приложение логики](../logic-apps/quickstart-create-first-logic-app-workflow.md).

<a name="add-trigger"></a>

## <a name="add-blob-storage-trigger"></a>Добавление триггера хранилища BLOB-объектов

В Azure Logic Apps каждое приложение логики должно запускаться по [триггеру](../logic-apps/logic-apps-overview.md#logic-app-concepts), который активируется, когда происходит определенное событие или если выполняются заданные условия. При каждом срабатывании триггера обработчик Logic Apps создает экземпляр приложения логики, запускающий рабочий процесс.

В этом примере показано, как можно запустить рабочий процесс приложения логики с триггером **Когда капля добавлена или изменена (только свойства)** при добавлении или обновлении свойств капли в контейнере для хранения.

1. На [портале Azure](https://portal.azure.com) или Visual Studio создайте пустое логическое приложение, которое открывает Logic App Designer. В этом примере используется портал Azure.

2. В поле поиска введите "большой двоичный объект azure" в качестве условия фильтра. В списке триггеров выберите нужный триггер.

   Этот пример использует этот триггер: **Когда капля добавлена или изменена (только свойства)**

   ![Выберите триггер хранения Azure Blob](./media/connectors-create-api-azureblobstorage/add-azure-blob-storage-trigger.png)

3. Если вам будет предложено ввести сведения о подключении, [создайте подключение к хранилищу BLOB-объектов](#create-connection). Или, если подключение уже существует, введите необходимые сведения для триггера.

   Для этого примера выберите контейнер и папку, которую вы хотите отслеживать.

   1. В поле **Контейнер** выберите значок папки.

   2. В списке папок выберите кронштейн **>** с правого угла ( ), а затем просмотрите, пока не найдете и не выберите захотевнюю папку.

      ![Выберите папку хранения для использования с триггером](./media/connectors-create-api-azureblobstorage/trigger-select-folder.png)

   3. Укажите частоту и продолжительность, с которыми триггер будет проверять изменения в папке.

4. Завершив работу, нажмите кнопку **Сохранить** на панели инструментов конструктора.

5. Теперь продолжайте добавлять действия в приложение логики для задач, которые необходимо выполнить с результатами триггера.

<a name="add-action"></a>

## <a name="add-blob-storage-action"></a>Добавление действия хранилища BLOB-объектов

В Azure Logic Apps [действие](../logic-apps/logic-apps-overview.md#logic-app-concepts) — это шаг в рамках рабочего процесса, выполняемый после срабатывания триггера или другого действия. В этом примере приложение логики запускается при срабатывании [триггера повторения](../connectors/connectors-native-recurrence.md).

1. На [портале Azure](https://portal.azure.com) или в Visual Studio откройте приложение логики в конструкторе приложений логики. В этом примере используется портал Azure.

2. В Logic App Designer, под триггером или действием, выберите **новый шаг.**

   ![Добавление нового шага в рабочий процесс приложения логики](./media/connectors-create-api-azureblobstorage/add-new-step-logic-app-workflow.png) 

   Чтобы добавить действие между существующими шагами, наведите указатель мыши на соединяющую стрелку. Выберите знак**+** плюс (), который появляется, и выберите **Добавить действие.**

3. В поле поиска введите "большой двоичный объект azure" в качестве условия фильтра. В списке действий выберите любое необходимое действие.

   Этот пример использует это действие: **Получить содержание капли**

   ![Выберите действие хранилища Azure Blob](./media/connectors-create-api-azureblobstorage/add-azure-blob-storage-action.png)

4. Если вам будет предложено ввести сведения о подключении, [создайте подключение к хранилищу BLOB-объектов Azure](#create-connection).
Или, если подключение уже существует, введите необходимые сведения для действия.

   Для этого примера выберите нужный файл.

   1. В поле **Большой двоичный объект** выберите значок папки.
  
      ![Выберите папку хранения для использования с действием](./media/connectors-create-api-azureblobstorage/action-select-folder.png)

   2. Найдите и выберите нужный файл на основе **идентификационного** номера капли. Этот **идентификационный** номер можно найти в метаданных капли, которые возвращаются ранее описанным триггером для хранения капли.

5. Завершив работу, нажмите кнопку **Сохранить** на панели инструментов конструктора.
Для тестирования приложения логики выбранная папка должна содержать большой двоичный объект.

В этом примере возвращается только содержимое большого двоичного объекта. Чтобы просмотреть содержимое, добавьте другое действие для создания файла с большим двоичным объектом c использованием другого соединителя. Например, добавьте действие OneDrive, которое создает файл на основе содержимого большого двоичного объекта.

<a name="create-connection"></a>

## <a name="connect-to-storage-account"></a>Подключение к учетной записи хранилища

[!INCLUDE [Create connection general intro](../../includes/connectors-create-connection-general-intro.md)]

1. Когда вам будет предложено создать соединение, предоставьте эту информацию:

   | Свойство | Обязательно | Значение | Описание |
   |----------|----------|-------|-------------|
   | **Имя подключения** | Да | <*имя соединения*> | Имя создаваемого подключения |
   | **Учетная запись хранилища** | Да | <*учетная запись хранилища*> | Выберите свою учетную запись хранения в списке. |
   ||||

   Пример:

   ![Создание подключения к учетной записи хранилища Azure Blob](./media/connectors-create-api-azureblobstorage/create-storage-account-connection.png) 

1. Когда вы будете готовы, выберите **Создать**

1. После создания соединения продолжайте [добавлять триггер для хранения капли](#add-trigger) или [добавляйте действие на хранение капли.](#add-action)

## <a name="connector-reference"></a>Справочник по соединителям

Для получения более подробной информации об этом разъеме, таких как триггеры, действия и ограничения, описанные в файле Swagger разъема, смотрите [страницу ссылки разъема.](https://docs.microsoft.com/connectors/azureblobconnector/)

> [!NOTE]
> Для логических приложений в [среде служб интеграции (ISE)](../logic-apps/connect-virtual-network-vnet-isolated-environment-overview.md)эта версия с маркировкой ISE разъема использует вместо этого [ограничения сообщений ISE.](../logic-apps/logic-apps-limits-and-config.md#message-size-limits)

<a name="storage-firewalls"></a>

## <a name="access-storage-accounts-behind-firewalls"></a>Доступ к учетным записям хранения за брандмауэрами

Вы можете добавить сетевую безопасность в учетную запись хранения Azure, ограничив доступ с [помощью брандмауэра и правил брандмауэра.](../storage/common/storage-network-security.md) Однако эта настройка создает проблему для Azure и других служб Майкрософт, которым необходим доступ к учетной записи хранилища. Локальная коммуникация в центре обработки данных абстрагирует внутренние IP-адреса, поэтому нельзя устанавливать правила брандмауэра с ограничениями IP. Дополнительные сведения см. в статье [Настройка брандмауэров службы хранилища Azure и виртуальных сетей](../storage/common/storage-network-security.md).

Вот различные варианты доступа к учетным записям хранения за брандмауэрами из приложений Azure Logic Apps с помощью разъема хранения Azure Blob или других решений:

* Соединитель больших двоичных объектов службы хранилища Azure

  * [Доступ к учетным записям хранения в других регионах](#access-other-regions)
  * [Доступ к учетным записям хранения через доверенную виртуальную сеть](#access-trusted-virtual-network)

* Другие решения

  * [Доступ к учетным записям хранения как доверенной службы с управляемыми идентификаторами](#access-trusted-service)
  * [Доступ к учетным записям хранения через API-управление Azure](#access-api-management)

<a name="access-other-regions"></a>

### <a name="problems-accessing-storage-accounts-in-the-same-region"></a>Проблемы с доступом к учетным записям хранения в одном регионе

Логические приложения не могут напрямую получить доступ к учетным записям хранения за брандмауэрами, когда они оба находятся в одном регионе. В качестве обходного пути поместите логические приложения в область, которая отличается от учетной записи хранилища, и предоставьте доступ к [исходящим IP-адресам для управляемых разъемов в вашем регионе.](../logic-apps/logic-apps-limits-and-config.md#outbound)

> [!NOTE]
> Это решение не применяется к разъему для хранения таблицAzure и разъему для хранения очередей Azure. Вместо этого, чтобы получить доступ к таблице хранения или в очереди хранения, используйте встроенный триггер HTTP и действия.

<a name="access-trusted-virtual-network"></a>

### <a name="access-storage-accounts-through-a-trusted-virtual-network"></a>Доступ к учетным записям хранения через доверенную виртуальную сеть

Вы можете поместить учетную запись хранилища в виртуальную сеть Azure, которую вы управляете, а затем добавить эту виртуальную сеть в список доверенных виртуальных сетей. Чтобы получить доступ к учетной записи хранилища через [доверенную виртуальную сеть,](../virtual-network/virtual-networks-overview.md)необходимо развернуть это приложение логики в [среду службы интеграции (ISE),](../logic-apps/connect-virtual-network-vnet-isolated-environment-overview.md)которая может подключаться к ресурсам в виртуальной сети. Затем можно добавить подсети в этом ISE в доверенный список. Разъемы хранилища Azure, такие как разъем хранилища Blob, могут напрямую получить доступ к контейнеру для хранения. Эта настройка является тем же опытом, что и использование конечных точек службы от ISE.

<a name="access-trusted-service"></a>

### <a name="access-storage-accounts-as-a-trusted-service-with-managed-identities"></a>Доступ к учетным записям хранения как доверенной службы с управляемыми идентификаторами

Чтобы предоставить доверенным службам Майкрософт доступ к учетной записи хранилища через брандмауэр, можно настроить исключение для этой учетной записи хранения для этих служб. Это решение позволяет службам Azure, которые поддерживают [управляемые идентификаторы для проверки подлинности,](../active-directory/managed-identities-azure-resources/overview.md) получить доступ к учетным записям хранения за брандмауэрами в качестве надежных служб. В частности, для логического приложения в глобальном мультитенантном Azure для доступа к этим учетным записям хранения сначала можно [включить управляемую поддержку идентификации](../logic-apps/create-managed-service-identity.md) в приложении логики. Затем вы используете действие HTTP или триггер в приложении логики и [устанавливаете тип проверки подлинности для использования управляемой идентификации приложения логики.](../logic-apps/create-managed-service-identity.md#authenticate-access-with-managed-identity) Для этого сценария можно использовать *только* действие или триггер HTTP.

Чтобы настроить поддержку идентификатора исключений и управляемых идентификационных данных, выполните следующие общие шаги:

1. На вашем учете хранения, под **настройками,** выберите **брандмауэры и виртуальные сети.** При **разрешении доступа из**опции «Выбранные сети» выберите опцию **«Выбранные сети»,** чтобы отображались соответствующие настройки.

1. В соответствии с **исключениями**выберите **Разрешить доверенным службам Майкрософт доступ к этой учетной записи хранения,** а затем выберите **Сохранить.**

   ![Выберите исключение, которое позволяет надежным службам Майкрософт](./media/connectors-create-api-azureblobstorage/allow-trusted-services-firewall.png)

1. В настройках приложения логики [включите поддержку управляемого удостоверения.](../logic-apps/create-managed-service-identity.md)

1. В рабочем процессе приложения логики добавьте и настройте действие HTTP или триггер для доступа к учетной записи или объекту хранилища.

   > [!IMPORTANT]
   > Для исходящих действий HTTP или триггерных вызовов в учетные `x-ms-version` записи хранилища Azure убедитесь, что заголовок запроса включает свойство и версию API для операции, которую вы хотите запустить в учетной записи хранилища. Для получения дополнительной информации смотрите [доступ authenticate с управляемыми идентификаторами](../logic-apps/create-managed-service-identity.md#authenticate-access-with-managed-identity) и [версиями для служб хранения Azure.](https://docs.microsoft.com/rest/api/storageservices/versioning-for-the-azure-storage-services#specifying-service-versions-in-requests)

1. В этом [действии выберите управляемый итог](../logic-apps/create-managed-service-identity.md#authenticate-access-with-managed-identity) для проверки подлинности.

<a name="access-api-management"></a>

### <a name="access-storage-accounts-through-azure-api-management"></a>Доступ к учетным записям хранения через API-управление Azure

Если вы используете выделенный уровень для [управления API,](../api-management/api-management-key-concepts.md)вы можете выполнить aPI-хранилище, используя API Management и разрешив IP-адреса последнего через брандмауэр. В основном, добавьте виртуальную сеть Azure, используемую API Management, к настройкам брандмауэра учетной записи хранилища. Затем можно использовать действия управления API или действие HTTP для вызова APIs хранения Azure. Однако, если вы выберете этот вариант, вы должны обрабатывать процесс проверки подлинности самостоятельно. Дополнительные сведения см. в статье [Простая архитектура корпоративной интеграции](https://aka.ms/aisarch).

## <a name="next-steps"></a>Дальнейшие действия

* См. дополнительные сведения о других [соединителях Logic Apps](../connectors/apis-list.md).
