---
title: Настройка обнаружения двунаправленной передачи через ExpressRoute в Azure | Документация Майкрософт
description: Эта статья содержит инструкции по настройке обнаружения двунаправленной передачи (BFD) через частный пиринг по каналу ExpressRoute.
services: expressroute
author: rambk
ms.service: expressroute
ms.topic: article
ms.date: 11/1/2018
ms.author: rambala
ms.custom: seodec18
ms.openlocfilehash: a24e021c34fe1ad315ca7f75f9bfdb29d94b253a
ms.sourcegitcommit: c22327552d62f88aeaa321189f9b9a631525027c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2019
ms.locfileid: "73495003"
---
# <a name="configure-bfd-over-expressroute"></a>Настройка обнаружения двунаправленной передачи через ExpressRoute

ExpressRoute поддерживает обнаружение двунаправленной переадресации (БФД) как через частный, так и через пиринг Майкрософт. Включив БФД через ExpressRoute, можно ускорить обнаружение ошибок связи между устройствами Microsoft Enterprise (MSEE) и маршрутизаторами, на которых вы завершаете канал ExpressRoute (CE/PE). Вы можете завершить ExpressRoute через клиентские или партнерские пограничные устройства маршрутизации (если вы используете управляемые подключения третьего уровня). В этом документе рассматривается необходимость в BFD и включение BFD через ExpressRoute.

## <a name="need-for-bfd"></a>Необходимость обнаружения двунаправленной передачи

На следующей схеме показаны преимущества включения BFD через канал ExpressRoute: [![1]][1]

Вы можете установить канал ExpressRoute, используя подключения второго уровня или управляемые подключения третьего уровня. В любом случае, если в пути подключения ExpressRoute есть одно или несколько устройств уровня 2, ответственность за обнаружение любых сбоев связи на этом пути лежит на BGP.

На устройствах MSEE для параметров проверки активности и времени удержания для BGP обычно настроены значения 60 и 180 секунд соответственно. Таким образом, после сбоя связи для его обнаружения и переключения трафика на альтернативное подключение потребуется около трех минут.

Таймеры BGP можно контролировать, настроив для BGP более низкое значение проверки активности и времени удержания на пограничном пиринговом устройстве клиента. Если таймеры BGP не совпадают между двумя пиринговыми устройствами, сеанс BGP между одноранговыми узлами будет использовать меньшее значение таймера. Минимальное значение проверки активности для BGP — три секунды, а наименьшее время удержания — десятки секунд. Тем не менее, установка таймеров BGP агрессивно предпочтительнее, так как протокол обрабатывается интенсивно.

BFD может помочь в этом сценарии. BFD обеспечивает обнаружение сбоя связи с минимальными затратами в течение доли секунды. 


## <a name="enabling-bfd"></a>Включение BFD

BFD настроен по умолчанию во всех новых частных пиринговых интерфейсах ExpressRoute, созданных на устройствах MSEE. Таким образом, чтобы включить БФД, необходимо просто настроить БФД на сервере CEs/PEs (как на основном, так и на вторичном устройствах). Настройка БФД выполняется в два этапа: необходимо настроить БФД в интерфейсе, а затем связать его с сеансом BGP.

Ниже приведен пример конфигурации CE/PE (с использованием Cisco IOS XE). 

    interface TenGigabitEthernet2/0/0.150
      description private peering to Azure
      encapsulation dot1Q 15 second-dot1q 150
      ip vrf forwarding 15
      ip address 192.168.15.17 255.255.255.252
      bfd interval 300 min_rx 300 multiplier 3


    router bgp 65020
      address-family ipv4 vrf 15
        network 10.1.15.0 mask 255.255.255.128
        neighbor 192.168.15.18 remote-as 12076
        neighbor 192.168.15.18 fall-over bfd
        neighbor 192.168.15.18 activate
        neighbor 192.168.15.18 soft-reconfiguration inbound
      exit-address-family

>[!NOTE]
>Чтобы включить BFD в существующей частной пиринговой связи, необходимо выполнить сброс пиринга. См. раздел [Сброс пиринга ExpressRoute][ResetPeering] .
>

## <a name="bfd-timer-negotiation"></a>Согласование таймера BFD

Между одноранговыми узлами BFD скорость передачи определяет более медленный узел. Для интервалов передачи и получения BFD для MSEE установлено значение 300 миллисекунд. В некоторых случаях интервал может задаваться с более высоким значением в 750 миллисекунд. Настроив более высокие значения, вы можете принудительно увеличить длительность этих интервалов, но сделать их короче нельзя.

>[!NOTE]
>Если вы настроили геоизбыточные каналы ExpressRoute или используете VPN-подключение типа "сеть — сеть" в качестве резервной копии; Включение БФД может ускорить отработку отказа после сбоя подключения ExpressRoute. 
>

## <a name="next-steps"></a>Следующие шаги

Дополнительные сведения доступны в следующих источниках:

- [Создание и изменение канала ExpressRoute][CreateCircuit]
- [Создание и изменение маршрутизации для канала ExpressRoute][CreatePeering]

<!--Image References-->
[1]: ./media/expressroute-bfd/BFD_Need.png "BFD ускоряет время обнаружения сбоя связи"

<!--Link References-->
[CreateCircuit]: https://docs.microsoft.com/azure/expressroute/expressroute-howto-circuit-portal-resource-manager 
[CreatePeering]: https://docs.microsoft.com/azure/expressroute/expressroute-howto-routing-portal-resource-manager
[ResetPeering]: https://docs.microsoft.com/azure/expressroute/expressroute-howto-reset-peering






