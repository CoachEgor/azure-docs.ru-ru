---
title: 'Azure ExpressRoute: Проектирование для высокой доступности'
description: Эта страница содержит архитектурные рекомендации для высокой доступности при использовании Azure ExpressRoute.
services: expressroute
author: rambk
ms.service: expressroute
ms.topic: article
ms.date: 06/28/2019
ms.author: rambala
ms.openlocfilehash: 4c3c6ae5fbdd91e6e44438be7fef2a3a91564a34
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "74076680"
---
# <a name="designing-for-high-availability-with-expressroute"></a>Проектирование для высокой доступности с Помощью ExpressRoute

ExpressRoute предназначен для высокой доступности для обеспечения частного подключения к сети оператора для ресурсов Майкрософт. Другими словами, в сети Microsoft нет ни одной точки сбоя в маршруте ExpressRoute. Чтобы максимизировать доступность, клиент и сегмент поставщика услуг вашего направления ExpressRoute также должны быть отоднечены для высокой доступности. В этой статье сначала рассмотрим соображения сетевой архитектуры для создания надежного подключения к сети с помощью ExpressRoute, а затем рассмотрим функции тонкой настройки, которые помогут вам улучшить высокую доступность вашей схемы ExpressRoute.


## <a name="architecture-considerations"></a>Архитектурные соображения

Следующая цифра иллюстрирует рекомендуемый способ подключения с помощью схемы ExpressRoute для максимизации доступности схемы ExpressRoute.

 [![1]][1 1]

Для обеспечения высокой доступности необходимо поддерживать избыточность схемы ExpressRoute по всей сквозной сети. Другими словами, необходимо поддерживать избыточность в рамках своей сети и не должен ставить под угрозу избыточность в сети поставщиков услуг. Сохранение избыточности как минимум означает предотвращение одной точки сбоев сети. Избыточная мощность и охлаждение для сетевых устройств еще больше улучшат высокую доступность.

### <a name="first-mile-physical-layer-design-considerations"></a>Первая миля физических соображений дизайна слоя

 Если вы прекратите как основное, так и вторичное подключение схем ExpressRoute на одном и том же оборудовании для клиентов (CPE), вы ставите под угрозу высокую доступность в вашей сети. Кроме того, если настроить как первичные, так и вторичные соединения через один и тот же порт CPE (либо путем прекращения двух соединений под различными субинтерфейсами или путем слияния двух соединений в партнерской сети), вы заставляете партнера компромисс высокой доступности на их сетевом сегменте, а также. Этот компромисс иллюстрируется в следующей цифре.

[![2]][2]

С другой стороны, если вы прекратите первичное и вторичное соединения схем ExpressRoute в разных географических точках, то вы можете поставить под угрозу производительность подключения. Если трафик активно загружается сбалансированной по основным и вторичным соединениям, которые прекращаются в разных географических точках, потенциальная существенная разница в задержке сети между двумя путями приведет к неоптимальной сети Производительности. 

Для гео-излишних соображений дизайна, [см. Проектирование для аварийного восстановления с ExpressRoute][DR].

### <a name="active-active-connections"></a>Активно-активные соединения

Сеть Майкрософт настроена для работы первичных и вторичных соединений схем ExpressRoute в активном режиме. Тем не менее, через рекламу маршрута, вы можете заставить избыточные соединения схемы ExpressRoute работать в активно-пассивном режиме. Реклама более конкретных маршрутов и BGP AS путь prepending являются общими методами, используемыми, чтобы сделать один путь предпочтительным по сравнению с другим.

Для повышения доступности рекомендуется эксплуатировать как соединения схемы ExpressRoute, так и в активно-активном режиме. Если вы позволите соединениям работать в активно-активном режиме, сеть Майкрософт загрузит баланс трафика через соединения на основе потока.

Запуск первичных и вторичных соединений схемы ExpressRoute в активно-пассивном режиме сталкивается с риском сбоя обоих соединений после сбоя в активном пути. Распространенными причинами сбоя при переключении являются отсутствие активного управления пассивным соединением и пассивное подключение рекламы устаревших маршрутов.

Кроме того, запуск первичных и вторичных соединений схемы ExpressRoute в активном режиме приводит лишь к сбою примерно половины потоков и перенаправления после сбоя подключения ExpressRoute. Таким образом, активно-активный режим значительно улучшит среднее время восстановления (MTTR).

### <a name="nat-for-microsoft-peering"></a>NAT для пиринга Майкрософт 

Microsoft пиринг предназначен для общения между общедоступными конечными точками. Так часто, на местах частные конечные точки Network Address Translated (NATed) с общедоступным IP на клиента или партнерской сети, прежде чем они общаются через Microsoft пиринг. Предполагая, что вы используете как первичные, так и вторичные соединения в активно-активном режиме, где и как вы NAT влияет на то, как быстро вы восстанавливаетесь после сбоя в одном из подключений ExpressRoute. Два различных варианта NAT иллюстрируются в следующей цифре:

[![3]][3]

В варианте 1 NAT применяется после разделения трафика между первичным и вторичным соединениями ExpressRoute. Для удовлетворения требований NAT, независимые пулы NAT используются между первичными и вторичными устройствами, чтобы обратный трафик приходил на то же устройство края, через которое выходил поток.

В варианте 2 используется общий пул NAT перед разделением трафика между первичным и вторичным соединениями ExpressRoute. Важно сделать различие, что общий пул NAT перед разделением трафика не означает введение одной точки сбоя, тем самым ставя под угрозу высокую доступность.

С опцией 1, после сбоя подключения ExpressRoute, возможность достичь соответствующего пула NAT нарушается. Таким образом, все сломанные потоки должны быть восстановлены либо TCP или слой приложения после соответствующего тайм-аута окна. Если какой-либо из пулов NAT используется для фронт-энда любого из предприимчивых серверов и если соответствующее подключение было сбой, на местах серверы не могут быть достигнуты из Azure до тех пор, пока подключение не будет исправлено.

В то время как с опцией 2, NAT дотягивается даже после первичного или вторичного сбоя соединения. Таким образом, сам сетевой слой может перенаправить пакеты и помочь быстрее восстановить сяпосле сбоя. 

> [!NOTE]
> Если вы используете nat option 1 (независимые пулы NAT для первичных и вторичных подключений ExpressRoute) и наверстывает карту порта IP-адреса от одного из пулов NAT до внутреннего сервера, сервер не будет доступен через схему ExpressRoute, когда соответствующий подключение выходит из строя.
> 

## <a name="fine-tuning-features-for-private-peering"></a>Функции тонкой настройки для приватного пиринга

В этом разделе давайте рассмотрим дополнительные (в зависимости от развертывания Azure и насколько вы чувствительны к MTTR) функции, которые помогают повысить высокую доступность схемы ExpressRoute. В частности, давайте рассмотрим зоны осведомлены развертывания ExpressRoute виртуальных сетевых шлюзов, и двунаправленный обнаружения форвардинга (BFD).

### <a name="availability-zone-aware-expressroute-virtual-network-gateways"></a>Доступность Зона известно ExpressRoute виртуальные сетевые шлюзы

Зона доступности в регионе Azure — это сочетание домена сбоя и домена обновления. Если вы выберете развертывание Azure IaaS, излишним из зон, также может потребоваться настроить резервные виртуальные сетевые шлюзы, которые прекращают приватное пиринг ExpressRoute. Чтобы узнать больше, смотрите [О зонах избыточных виртуальных сетевых шлюзов в зонах доступности Azure.][zone redundant vgw] Для настройки излишних виртуальных сетевых шлюзов, [см.][conf zone redundant vgw]

### <a name="improving-failure-detection-time"></a>Улучшение времени обнаружения сбоев

ExpressRoute поддерживает BFD над частнымпир. BFD сокращает время обнаружения сбоев в сети 2 слоя между Microsoft Enterprise Edge (MSEEs) и их соседями BGP на внутренней стороне примерно с 3 минут (по умолчанию) до менее чем секунды. Быстрое время обнаружения сбоев помогает ускорить восстановление сбоев. Чтобы узнать дальше, [см.][BFD]

## <a name="next-steps"></a>Дальнейшие действия

В этой статье мы обсудили, как проектировать для высокой доступности подключения схемы ExpressRoute. Точка пиринга схемы ExpressRoute прикрепляется к географическому местоположению и, следовательно, может быть затронута катастрофическим сбоем, который влияет на все местоположение. 

Для разработки соображений для создания гео-избыточного подключения к сети Microsoft позвоночника, который может выдержать катастрофические сбои, которые влияют на весь регион, [см. Проектирование для аварийного восстановления с ExpressRoute частных пиринг][DR].

<!--Image References-->
[1]: ./media/designing-for-high-availability-with-expressroute/exr-reco.png "Рекомендуемый способ подключения с помощью ExpressRoute"
[2]: ./media/designing-for-high-availability-with-expressroute/suboptimal-lastmile-connectivity.png "Субоптимальные последней мили подключения"
[3]: ./media/designing-for-high-availability-with-expressroute/nat-options.png "варианты NAT"


<!--Link References-->
[zone redundant vgw]: https://docs.microsoft.com/azure/vpn-gateway/about-zone-redundant-vnet-gateways
[conf zone redundant vgw]: https://docs.microsoft.com/azure/vpn-gateway/create-zone-redundant-vnet-gateway
[Configure Global Reach]: https://docs.microsoft.com/azure/expressroute/expressroute-howto-set-global-reach
[BFD]: https://docs.microsoft.com/azure/expressroute/expressroute-bfd
[DR]: https://docs.microsoft.com/azure/expressroute/designing-for-disaster-recovery-with-expressroute-privatepeering




