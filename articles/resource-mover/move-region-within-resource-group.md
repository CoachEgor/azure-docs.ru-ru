---
title: Перемещение ресурсов в другой регион с помощью перемещения ресурсов Azure
description: Узнайте, как перемещать ресурсы в группе ресурсов в другой регион с помощью перемещения ресурсов Azure.
manager: evansma
author: rayne-wiselman
ms.service: resource-move
ms.topic: how-to
ms.date: 09/08/2020
ms.author: raynew
ms.openlocfilehash: 7d230ce068678bbc074b54ab361f3d70d9b102f8
ms.sourcegitcommit: 5d7f8c57eaae91f7d9cf1f4da059006521ed4f9f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2020
ms.locfileid: "89670786"
---
# <a name="move-resources-across-regions-from-resource-group"></a>Перемещение ресурсов между регионами (из группы ресурсов)

Из этой статьи вы узнаете, как перемещать ресурсы в определенной группе ресурсов в другой регион Azure. В группе ресурсов выберите ресурсы, которые требуется переместить. Затем вы перемещаете их с помощью средства [перемещения ресурсов Azure](overview.md).

> [!IMPORTANT]
> Сейчас для перемещения ресурсов Azure используется общедоступная Предварительная версия.


## <a name="prerequisites"></a>Предварительные требования

- Необходимо иметь права *владельца* на подписку, в которой находятся ресурсы, которые требуется переместить.
    - При первом добавлении ресурса для определенного сопоставления источника и назначения в подписке Azure средство перемещения ресурсов создает [управляемое системой удостоверение](../active-directory/managed-identities-azure-resources/overview.md#managed-identity-types) (ранее известное как управляемая служба идентификации (MSI)), которому доверяет подписка.
    - Чтобы создать удостоверение и назначить ему требуемую роль (для участника или администратора доступа пользователей в исходной подписке), учетной записи, используемой для добавления ресурсов, требуются права *владельца* для подписки. Дополнительные [сведения](../role-based-access-control/rbac-and-directory-admin-roles.md#azure-roles) о ролях Azure.
- Подписке требуется достаточно квота для создания исходных ресурсов в целевом регионе. В противном случае запросите дополнительные ограничения. [Подробнее](/azure/azure-resource-manager/management/azure-subscription-service-limits).
- Проверьте цены и расходы, связанные с целевым регионом, в который вы перемещаете виртуальные машины. Используйте [Калькулятор цен](https://azure.microsoft.com/pricing/calculator/) , чтобы помочь вам.
- Убедитесь, что ресурсы, которые требуется переместить, поддерживаются средством перемещения ресурсов:
    - Виртуальные машины Azure и связанные диски
    - Сетевые карты
    - Группы доступности
    - Виртуальные сети Azure
    - Общедоступные IP-адреса
    - Группы безопасности сети (NSG)
    - Внутренние и общедоступные подсистемы балансировки нагрузки
    - Базы данных SQL Azure и эластичные пулы


## <a name="check-vm-requirements"></a>Проверка требований к виртуальной машине

1. Убедитесь, что виртуальные машины, которые требуется переместить, поддерживаются.

    - [Проверьте](support-matrix-move-region-azure-vm.md#windows-vm-support) Поддерживаемые виртуальные машины Windows.
    - [Проверьте](support-matrix-move-region-azure-vm.md#linux-vm-support) Поддерживаемые виртуальные машины Linux и версии ядра.
    - Проверьте поддерживаемые параметры [вычислений](support-matrix-move-region-azure-vm.md#supported-vm-compute-settings), [хранения](support-matrix-move-region-azure-vm.md#supported-vm-storage-settings)и [сети](support-matrix-move-region-azure-vm.md#supported-vm-networking-settings) .
2. Убедитесь, что виртуальные машины имеют последние Доверенные корневые сертификаты и обновленный список отзыва сертификатов (CRL). 
    - На виртуальных машинах Azure под Windows установите последние обновления Windows.
    - На виртуальных машинах под управлением Linux следуйте указаниям по использованию распространителя Linux, чтобы убедиться, что на компьютере установлены последние сертификаты и список отзыва сертификатов. 
3. Разрешить исходящие подключения с виртуальных машин:
    - Если вы используете прокси-сервер брандмауэра на основе URL-адресов для управления исходящими подключениями, разрешите доступ к этим [URL-адресам](support-matrix-move-region-azure-vm.md#url-access) .
    - Если вы используете правила группы безопасности сети (NSG) для управления исходящими подключениями, создайте эти [правила тегов служб](support-matrix-move-region-azure-vm.md#nsg-rules).

## <a name="select-resources-to-move"></a>Выберите ресурсы для перемещения

Выберите ресурсы, которые требуется переместить. Ресурсы перемещаются в целевой регион в подписке исходного региона. Если вы хотите изменить подписку, это можно сделать после перемещения ресурсов.

1. В портал Azure откройте соответствующую группу ресурсов.
2. На странице Группа ресурсов выберите ресурсы, которые требуется переместить.
3. Выберите **переместить**  >  **переместить в другой регион**.

    ![Выбор для перемещения ресурсов в другой регион](./media/move-region-within-resource-group/select-move-region.png)
    
4. В поле **источник + назначение**выберите целевой регион, в который необходимо переместить ресурсы. Затем щелкните **Далее**.
5. В **области Метаданные**выберите место хранения метаданных о ресурсах, которые вы перемещаете.  Группа ресурсов создается специально для этой цели. Затем щелкните **Далее**.


    ![Исходная и целевая страницы для выбора целевой области](./media/move-region-within-resource-group/source-target.png)


7. В окне **перемещаемые ресурсы**нажмите кнопку **Далее**.  
8. В списке **выберите ресурсы**выберите ресурс, который требуется переместить. Можно добавлять только ресурсы, поддерживаемые для перемещения. Затем выберите **Готово**.
9. В окне **Перемещение ресурсов**нажмите кнопку **Далее**. 
10. На странице **Проверка и добавление**проверьте сведения об источнике и целевом объекте.
11. Убедитесь, что вы понимаете, что метаданные о перемещаемых ресурсах будут храниться в группе ресурсов, созданной для этой цели, и вы разрешаете источнику энергии создавать управляемое системой удостоверение для доступа к ресурсам подписки.
1. Выберите **продолжить** , чтобы начать добавление ресурсов.

    ![Страница "Сводка" для проверки сведений и продолжение перемещения](./media/move-region-within-resource-group/summary.png)    

11. Начинается операция добавления ресурса. По завершении операции уведомления показывают, что ресурсы были добавлены, и развертывание прошло успешно.
13. В уведомлениях выберите **Добавление ресурсов для перемещения**.

    ![Сообщение, отображаемое в уведомлениях](./media/move-region-within-resource-group/notification.png)    


14. После выбора уведомления выбранные ресурсы будут добавлены в коллекцию перемещения в центре перемещения ресурсов Azure.  С помощью перемещения ресурсов можно проверить зависимости, а затем начать перемещение ресурсов в целевой регион.

## <a name="resolve-dependencies"></a>Устранение ошибок, связанных с зависимостями

Перемещаемые ресурсы отобразятся на странице **между регионами** в состоянии " *Подготовка ожидается* ". Запустите проверку следующим образом.

1. Если в столбце " **проблемы** " в поле "ресурсы" отображается сообщение *Проверка зависимостей* , нажмите кнопку **проверить зависимости** . Начнется процесс проверки.

    ![Кнопка для проверки зависимостей](./media/move-region-within-resource-group/validate-dependencies.png)

2. Если зависимости найдены, выберите **добавить зависимости**. 
3. В окне **Добавление зависимостей**Выберите зависимые ресурсы, > **добавить зависимости**. Отслеживание хода выполнения в уведомлениях.

    ![Кнопка для добавления зависимостей](./media/move-region-within-resource-group/add-dependencies.png)

3. При необходимости добавьте дополнительные зависимости и проверьте зависимости. Выберите **Обновить** , чтобы убедиться в том, что ресурсы отображаются в актуальном состоянии.

4. На странице **между регионами** убедитесь, что ресурсы теперь находятся в состоянии " *Подготовка ожидает подготовки* " без проблем.

    ![Страница для отображения состояния подготовки в состоянии ожидания для всех ресурсов](./media/move-region-within-resource-group/prepare-pending.png)

## <a name="move-the-source-resource-group"></a>Перемещение исходной группы ресурсов 

Прежде чем можно будет подготовить и переместить ресурсы, исходная группа ресурсов должна присутствовать в целевом регионе. 

### <a name="prepare-to-move-the-source-resource-group"></a>Подготовка к перемещению исходной группы ресурсов

Подготовка выполняется следующим образом.

1. В **области в разных регионах**выберите исходную группу ресурсов > **подготовки**.
2. В окне **Подготовка ресурсов**выберите **Подготовка**.
1. 
    ![Кнопка для подготовки исходной группы ресурсов](./media/move-region-within-resource-group/prepare-source-resource-group.png)

    Во время подготовки перемещение ресурсов создает шаблоны Azure Resource Manager (ARM), используя параметры группы ресурсов. Ресурсы в группе ресурсов не затрагиваются.
    
> [!NOTE]
>  После подготовки группы ресурсов она находится в состоянии *Ожидание запуска перемещения* . Обновите, чтобы отобразить Последнее состояние.

![Состояние, показывающее состояние запуска "ожидание"](./media/move-region-within-resource-group/initiate-resource-group-pending.png)

### <a name="move-the-source-resource-group"></a>Перемещение исходной группы ресурсов

Запустите перемещение следующим образом:

1. В **области в разных регионах**выберите группу ресурсов > **начать перемещение** .
2. LN **Move Resources**, выберите **начать перемещение**. Группа ресурсов перемещается в состояние *начатого перемещения* .
3. После начала перемещения создается целевая группа ресурсов на основе созданного шаблона ARM. Исходная группа ресурсов перемещается в состояние *ожидания фиксации перемещения* .

![Состояние, показывающее перемещение фиксации](./media/move-region-availability-zone/commit-move-pending.png)

Чтобы зафиксировать и завершить процесс перемещения, сделайте следующее:

1. В **области в разных регионах**выберите группу ресурсов > **фиксация перемещения**
2. LN **Move Resources**, выберите **commit**.

> [!NOTE]
> После фиксации перемещения исходная группа ресурсов находится в состоянии *ожидания удаления источника* .

## <a name="modify-target-settings"></a>Изменить целевые параметры

Если вы не хотите перемещать исходный ресурс, можно выполнить одно из следующих действий.

- Создайте ресурс в целевом регионе с тем же именем и параметрами, что и у ресурса в исходном регионе.
- Создайте новый эквивалентный ресурс в целевом регионе. За исключением указанных параметров, целевой ресурс создается с теми же параметрами, что и у источника.
- Используйте существующий ресурс в целевом регионе.

Измените параметр следующим образом:

1. Чтобы изменить параметр, выберите запись в столбце **Целевая конфигурация** для ресурса.
2. На странице **Конфигурация назначения** укажите целевые параметры, которые вы хотите использовать.
    Изменения вносятся только в изменяемый ресурс. Все зависимые ресурсы необходимо обновлять отдельно.   
    
Точные изменяемые параметры зависят от типа ресурса. Дополнительные [сведения](modify-target-settings.md) о редактировании целевых параметров.

## <a name="prepare-resources-to-move"></a>Подготовка ресурсов для перемещения

Теперь, когда исходная группа ресурсов перемещена, можно подготовиться к перемещению других ресурсов.

1. В **области в разных регионах**выберите ресурсы, которые необходимо подготовить. 

    ![Страница для выбора подготовки к другим ресурсам](./media/move-region-availability-zone/prepare-other.png)

2. Выберите **Подготовка**.

> [!NOTE]
> - В процессе подготовки на виртуальных машинах для репликации устанавливается Azure Site Recovery агент мобильности.
> - Данные виртуальной машины периодически реплицируются в целевой регион. Это не влияет на исходную виртуальную машину.
> - При перемещении ресурсов создаются шаблоны ARM для других исходных ресурсов.
> - После подготовки ресурсов они находятся в состоянии *Ожидание запуска перемещения* .

![Страница, показывающая ресурсы в состоянии ожидания при запуске перемещения](./media/move-region-availability-zone/initiate-move-pending.png)

## <a name="initiate-the-move"></a>Начать перемещение

Теперь, когда ресурсы подготовлены, вы можете начать перемещение.

1. В **области в разных регионах**выберите ресурсы с состоянием *Запуск перемещения ожидание*. Затем выберите **начать перемещение**.
2. В окне **Перемещение ресурсов**выберите команду **начать перемещение**.

    ![Выберите для кнопки "начать перемещение"](./media/move-region-within-resource-group/initiate-move.png)

3. Отслеживать ход перемещения на панели уведомлений.


> [!NOTE]
> - Для виртуальных машин реплики виртуальных машин создаются в целевом регионе. Исходная виртуальная машина завершает работу, и происходит некоторое время простоя (обычно в минутах).<br/>
> - Перемещение ресурсов воссоздает другие ресурсы с помощью подготовленных шаблонов ARM. Обычно время простоя отсутствует.<br/> 
> - Для подсистем балансировки нагрузки правила NAT не копируются. Создайте их в целевом регионе после фиксации перемещения.
> - Для общедоступных IP-адресов метка DNS-имени не копируется. Повторно создайте метку после фиксации перемещения.
> - После подготовки ресурсов они находятся в состоянии *ожидания фиксации перемещения* .


## <a name="discard-or-commit"></a>Отменить или зафиксировать?

После первоначального перемещения можно решить, следует ли зафиксировать перемещение или отменить его. 

- **Отменить**. Вы можете отменить перемещение, если тестируете, и вы не хотите переносить исходный ресурс. При отмене перемещения ресурс возвращается в состояние *Ожидание инициированного перемещения*.
- **Фиксация**: фиксация завершает перемещение в целевой регион. После фиксации исходный ресурс будет находиться в состоянии *Ожидание удаления источника*, и вы можете решить, хотите ли вы удалить его.


## <a name="discard-the-move"></a>Отменить перемещение 

Вы можете отменить перемещение следующим образом:

1. В **области в разных регионах**выберите ресурсы с состоянием *фиксации ожидания перемещения*и щелкните **отменить перемещение**.
2. В окне **отменить перемещение**выберите **отменить**.
3. Отслеживать ход перемещения на панели уведомлений.
4. Когда уведомления показывают, что перемещение прошло успешно, выберите **Обновить**. 

> [!NOTE]
> Для виртуальных машин после отмены ресурсов они находятся в состоянии " *Ожидание запуска перемещения* ".

## <a name="commit-the-move"></a>Фиксация перемещения

Если вы хотите завершить процесс перемещения, зафиксируйте перемещение. 


1. В **области в разных регионах**выберите ресурсы с состоянием *фиксации ожидания перемещения*и нажмите кнопку **зафиксировать перемещение**.
2. В окне **фиксация ресурсов**выберите **фиксация**.

    ![Страница фиксации ресурсов для завершения перемещения](./media/move-region-within-resource-group/commit-resources.png)

3. Отслеживать ход фиксации на панели уведомлений.

> [!NOTE]
> - После фиксации перемещения виртуальные машины останавливают репликацию. Фиксация не влияет на исходную виртуальную машину.
> - Фиксация не влияет на исходные сетевые ресурсы.
> - После фиксации перемещения ресурсы находятся в состоянии *ожидания удаления источника* .

## <a name="configure-settings-after-the-move"></a>Настройка параметров после перемещения

1. Так как метки DNS-имен не копируются для общедоступных IP-адресов, после перемещения перейдите к целевым ресурсам и обновите метку. 
2. Для внутренних подсистем балансировки нагрузки, так как правила NAT не копируются, перейдите к ресурсам, созданным в целевом регионе, и обновите правила NAT.
3. Служба Mobility Service не удаляется автоматически с виртуальных машин. Удалите его вручную или оставьте, если планируется повторное перемещение сервера.
## <a name="delete-source-resources-after-commit"></a>Удалить исходные ресурсы после фиксации

После перемещения можно при необходимости удалить ресурсы в исходном регионе. 

1. В **области в разных регионах**выберите имя каждого исходного ресурса, который требуется удалить.
2. На странице свойства для каждого ресурса выберите **Удалить**.

## <a name="delete-additional-resources-created-for-move"></a>Удаление дополнительных ресурсов, созданных для перемещения

После перемещения можно вручную удалить коллекцию перемещения и Site Recovery созданные ресурсы.

- Коллекция перемещения по умолчанию скрыта. Чтобы увидеть его, необходимо включить скрытые ресурсы.
- Хранилище кэша имеет блокировку, которую необходимо удалить, прежде чем ее можно будет удалить.

Удалите следующим образом: 

1. Выберите ресурсы в группе ресурсов ```RegionMoveRG-<sourceregion>-<target-region>``` в исходном регионе.
2. Убедитесь, что все виртуальные машины и другие исходные ресурсы в коллекции перемещения перемещены или удалены. Это гарантирует, что у вас нет ресурсов, ожидающих их использования.
2. Удалите ресурсы:

    - Имя коллекции перемещения — ```movecollection-<sourceregion>-<target-region>``` .
    - Имя учетной записи хранения кэша: ```resmovecache<guid>```
    - Имя хранилища — ```ResourceMove-<sourceregion>-<target-region>-GUID``` .

## <a name="next-steps"></a>Дальнейшие действия


[Сведения о](about-move-process.md) процессе перемещения.
