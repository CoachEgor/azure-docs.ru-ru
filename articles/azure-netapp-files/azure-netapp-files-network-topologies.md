---
title: Рекомендации по Azure NetApp Files планированию сети | Документация Майкрософт
description: Описывает рекомендации, которые помогут спроектировать эффективную сетевую архитектуру с помощью Azure NetApp Files.
services: azure-netapp-files
documentationcenter: ''
author: b-juche
manager: ''
editor: ''
ms.assetid: ''
ms.service: azure-netapp-files
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 05/08/2019
ms.author: b-juche
ms.openlocfilehash: 087ecee053069a02e4d4dd6f636d05ea15269e2e
ms.sourcegitcommit: 04ec7b5fa7a92a4eb72fca6c6cb617be35d30d0c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/22/2019
ms.locfileid: "68383503"
---
# <a name="guidelines-for-azure-netapp-files-network-planning"></a>Рекомендации по планированию сети Azure NetApp Files

Планирование архитектуры сети — ключевой элемент разработки любой инфраструктуры приложений. Эта статья поможет вам разработать эффективную сетевую архитектуру для рабочих нагрузок, чтобы воспользоваться широкими возможностями Azure NetApp Files.

Azure NetApp Files тома размещаются в особой подсети, называемой [делегированной подсетью](https://docs.microsoft.com/azure/virtual-network/virtual-network-manage-subnet) в виртуальной сети Azure. Таким образом, можно получить доступ к томам непосредственно из виртуальной сети, из одноранговых виртуальных сетей в том же регионе или локально через шлюз виртуальной сети (с помощью ExpressRoute или VPN-шлюза), если это необходимо. Подсеть выделяется для Azure NetApp Files и отсутствует возможность подключения к другим службам Azure или Интернету.

## <a name="considerations"></a>Рекомендации  

При планировании Azure NetApp Files сети следует учитывать некоторые моменты.

### <a name="constraints"></a>Ограничения

Приведенные ниже функции в настоящее время не поддерживаются для Azure NetApp Files: 

* Группы безопасности сети (группы безопасности сети) применяются к делегированной подсети.
* Определяемые пользователем маршруты (определяемые пользователем маршруты) со следующим прыжком в качестве подсети файлов NetApp для Azure
* Политики Azure (например, пользовательские политики именования) в интерфейсе Azure NetApp Files
* Подсистемы балансировки нагрузки для трафика Azure NetApp Files

К Azure NetApp Files относятся следующие ограничения сети.

* Число IP-адресов, используемых в виртуальной сети с Azure NetApp Files (включая одноранговые виртуальных сетей), не может превышать 1000.
* В каждой виртуальной сети Azure можно делегировать только одну подсеть для Azure NetApp Files.


### <a name="supported-network-topologies"></a>Поддерживаемые сетевые топологии

В следующей таблице описаны сетевые топологии, поддерживаемые Azure NetApp Files.  Здесь также описаны обходные пути для неподдерживаемых топологий. 

|    Топологии    |    Поддерживается    |     Возможное решение    |
|-------------------------------------------------------------------------------------------------------------------------------|--------------------|-----------------------------------------------------------------------------|
|    Подключение к тому в локальной виртуальной сети    |    Да    |         |
|    Подключение к тому в одноранговой виртуальной сети (тот же регион)    |    Да    |         |
|    Подключение к тому в одноранговой виртуальной сети (между регионами или глобальными пиринга)    |    Нет    |    Отсутствуют    |
|    Подключение к тому через шлюз ExpressRoute    |    Да    |         |
|    Подключение между локальным и томом в периферийной виртуальной сети через шлюз ExpressRoute и пиринг виртуальных сетей с транзитом шлюза    |    Да    |        |
|    Подключение между локальным и томом в периферийной виртуальной сети через VPN-шлюз    |    Да    |         |
|    Подключение между локальным и томом в периферийной виртуальной сети через VPN-шлюз и пиринг виртуальной сети с транзитом шлюза    |    Да    |         |


## <a name="virtual-network-for-azure-netapp-files-volumes"></a>Виртуальная сеть для томов Azure NetApp Files

В этом разделе объясняются основные понятия, которые помогут при планировании виртуальных сетей.

### <a name="azure-virtual-networks"></a>Виртуальные сети Azure

Перед подготовкой Azure NetApp Filesого тома необходимо создать виртуальную сеть Azure или использовать ту, которая уже существует в вашей подписке. Виртуальная сеть определяет границу сети для тома.  Дополнительные сведения о создании виртуальных сетей см. в [документации по виртуальной сети Azure](https://docs.microsoft.com/azure/virtual-network/virtual-networks-overview).

### <a name="subnets"></a>Подсети

Подсети разбивают виртуальную сеть на отдельные адресные пространства, используемые ресурсами Azure.  Azure NetApp Filesные тома содержатся в подсети специального назначения, называемой [делегированной](https://docs.microsoft.com/azure/virtual-network/virtual-network-manage-subnet)подсетью. 

Делегирование подсети предоставляет явные разрешения на службу Azure NetApp Files для создания ресурсов, зависящих от службы, в подсети.  Он использует уникальный идентификатор при развертывании службы. В этом случае создается сетевой интерфейс, обеспечивающий подключение к Azure NetApp Files.

При использовании новой виртуальной сети можно создать подсеть и делегировать подсеть Azure NetApp Files, следуя инструкциям в разделе [Делегирование подсети для Azure NetApp Files](azure-netapp-files-delegate-subnet.md). Можно также делегировать существующую пустую подсеть, которая еще не делегирована другим службам.

Если виртуальная сеть соединена с другой виртуальной сетью, то нельзя расширить адресное пространство виртуальной сети. По этой причине Новая Делегированная подсеть должна быть создана в адресном пространстве виртуальной сети. Если необходимо расширить адресное пространство, необходимо удалить пиринг виртуальной сети, прежде чем разворачивать адресное пространство.

### <a name="udrs-and-nsgs"></a>Определяемые пользователем маршруты и группы безопасности сети

Определяемые пользователем маршруты (определяемые пользователем маршруты) и группы безопасности сети (группы безопасности сети) не поддерживаются в делегированных подсетях для Azure NetApp Files.

В качестве обходного решения можно применить группы безопасности сети к другим подсетям, которые позволяют или запрещают входящий и исходящий трафик в Azure NetApp Files делегированной подсети.  

## <a name="azure-native-environments"></a>Собственные среды Azure

На следующей схеме показана среда Azure Native:

![Среда Azure с собственной сетевой средой](../media/azure-netapp-files/azure-netapp-files-network-azure-native-environment.png)

### <a name="local-vnet"></a>Локальная виртуальная сеть

Основной сценарий — создать или подключиться к Azure NetApp Files тому из виртуальной машины в той же виртуальной сети. Для виртуальной сети 2 на приведенной выше схеме том 1 создается в делегированной подсети и может быть подключен к виртуальной машине 1 в подсети по умолчанию.

### <a name="vnet-peering"></a>Пиринг VNet

Если у вас есть дополнительные виртуальных сетей в том же регионе, который требует доступа к ресурсам друг друга, виртуальных сетей можно подключить с помощью [пиринга виртуальных сетей](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview) , чтобы обеспечить безопасное подключение через инфраструктуру Azure. 

Рассмотрим виртуальную сеть 2 и виртуальную сеть 3 на приведенной выше схеме. Если ВИРТУАЛЬНОЙ машине 2 необходимо подключиться к виртуальной машине 3 или 2, или если виртуальной машине 3 требуется подключиться к виртуальной машине 2 или 1, необходимо включить пиринг виртуальных сетей между VNet 2 и VNet 3. 

Кроме того, рассмотрим ситуацию, когда виртуальная сеть 1 соединена с виртуальной сетью 2, а виртуальная сеть 2 — с виртуальной сетью 3 в том же регионе. Ресурсы из виртуальной сети 1 могут подключаться к ресурсам в виртуальной сети 2, но не могут подключаться к ресурсам в виртуальной сети 3, если только не установлены соединения между виртуальными сетями 1 и VNet 3. 

На приведенной выше схеме, хотя виртуальная машина 3 может подключиться к тому 1, виртуальная машина 4 не может подключиться к тому 2.  Причина этого заключается в том, что периферийный виртуальных сетей не является одноранговым, а _транзитная маршрутизация не поддерживается через пиринг виртуальных сетей_.

## <a name="hybrid-environments"></a>Гибридные среды

На следующей схеме показана гибридная среда. 

![Гибридная сетевая среда](../media/azure-netapp-files/azure-netapp-files-network-hybrid-environment.png)

В гибридном сценарии приложениям из локальных центров обработки данных требуется доступ к ресурсам в Azure.  В этом случае вы хотите расширить центр обработки данных в Azure или использовать собственные службы Azure или для аварийного восстановления. Сведения о том, как подключить несколько локальных ресурсов к ресурсам в Azure с помощью VPN-подключения типа "сеть — сеть" или ExpressRoute, см. в статье [варианты планирования VPN-шлюза](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%2fazure%2fvirtual-network%2ftoc.json#planningtable) .

В гибридной топологии Hub-лучевой виртуальная сеть концентратора в Azure выступает в качестве центральной точки подключения к локальной сети. Периферийные серверы виртуальных сетей с концентратором, и их можно использовать для изоляции рабочих нагрузок.

В зависимости от конфигурации можно подключать локальные ресурсы к ресурсам в концентраторе и периферийных ресурсах.

В топологии выше локальная сеть подключена к виртуальной сети концентратора в Azure, а в одном регионе с виртуальной сетью концентратора существует 2 звезды виртуальных сетей.  В этом сценарии для Azure NetApp Files томов поддерживаются следующие параметры подключения:

* Локальные ресурсы VM 1 и VM 2 могут подключаться к тому 1 в концентраторе через VPN-подключение типа "сеть — сеть" или канал ExpressRoute. 
* Локальные ресурсы VM 1 и VM 2 могут подключаться к тому 2 или тому 3 через VPN-подключение типа "сеть — сеть" и в региональный пиринг виртуальной сети.
* Виртуальная машина 3 в виртуальной сети концентратора может подключаться к тому 2 в периферийной виртуальной сети 1 и томе 3 в периферийной виртуальной сети 2.
* Виртуальная машина 4 из периферийной виртуальной сети 1 и VM 5 из периферийной виртуальной сети 2 может подключаться к тому 1 в виртуальной сети концентратора.

Виртуальная машина 4 в периферийной виртуальной сети 1 не может подключиться к тому 3 в периферийной виртуальной сети 2. Кроме того, виртуальная машина 5 в лучевой VNet2 не может подключиться к тому 2 в периферийной виртуальной сети 1. Это происходит потому, что периферийные виртуальных сетей не поддерживают пиринг и _транзитная маршрутизация не поддерживается через пиринг виртуальных сетей_.

## <a name="next-steps"></a>Следующие шаги

[Делегирование подсети в Azure NetApp Files](azure-netapp-files-delegate-subnet.md)
