---
title: Рекомендации для службы файлов Azure NetApp сети планирование | Документация Майкрософт
description: Описывает правила, которые помогут вам разработать проект архитектуры действующие сети с помощью Azure NetApp файлов.
services: azure-netapp-files
documentationcenter: ''
author: b-juche
manager: ''
editor: ''
ms.assetid: ''
ms.service: azure-netapp-files
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 05/08/2019
ms.author: b-juche
ms.openlocfilehash: bf2262d8a222cec6c5d0d7e53ded7b2994481656
ms.sourcegitcommit: b7a44709a0f82974578126f25abee27399f0887f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/18/2019
ms.locfileid: "67205707"
---
# <a name="guidelines-for-azure-netapp-files-network-planning"></a>Рекомендации по планированию сети Azure NetApp Files

Планирование архитектуры сети является ключевым элементом проектирования любой инфраструктуры приложений. Эта статья поможет вам разработать проект архитектуры действующих сетевых рабочих нагрузок использовать преимущества расширенных возможностей Azure NetApp файлов.

Тома файлов NetApp Azure предназначены для размещения в особой целью подсеть с именем [делегированные подсети](https://docs.microsoft.com/azure/virtual-network/virtual-network-manage-subnet) виртуальной сети Azure. Таким образом доступны тома непосредственно из виртуальной сети, из пиринговых виртуальных сетях в одном регионе или из локальной отказа шлюза виртуальной сети (ExpressRoute или VPN-шлюза) при необходимости. Подсети выделяется для файлов Azure NetApp и отсутствует подключение к другим службам Azure или через Интернет.

## <a name="considerations"></a>Рекомендации  

Необходимо понимать некоторые рекомендации при планировании сети NetApp службы файлов Azure.

### <a name="constraints"></a>Ограничения

Ниже приведены функции сейчас не поддерживается для файлов Azure NetApp: 

* Группы безопасности сети (Nsg) в подсети
* Определяемые пользователем маршруты (Udr) с помощью следующего прыжка, что и подсеть Azure NetApp файлов
* Политики Azure (например, пользовательские именования политики) в интерфейсе NetApp службы файлов Azure
* Подсистемы балансировки нагрузки для трафика службы файлов Azure NetApp

Файлы NetApp Azure применяются следующие ограничения сети:

* Число IP-адресов, используемых в виртуальной сети с NetApp службы файлов Azure (включая пиринговых виртуальных сетях) не может превышать 1000.
* В каждой виртуальной сети Azure можно делегировать только одну подсеть для Azure NetApp Files.


### <a name="supported-network-topologies"></a>Поддерживаемые топологии сети

В следующей таблице описаны топологии сети, поддерживаемые службой файлов Azure NetApp.  Здесь также описываются способы решения неподдерживаемые топологии. 

|    Топологии    |    поддерживается    |     Возможное решение    |
|-------------------------------------------------------------------------------------------------------------------------------|--------------------|-----------------------------------------------------------------------------|
|    Подключение к тома в виртуальной локальной сети    |    Да    |         |
|    Подключение к тома в пиринговой виртуальной сети (в том же регионе)    |    Да    |         |
|    Подключение к тома в пиринговой виртуальной сети (кросс-области или глобальный пиринг)    |    Нет    |    Нет    |
|    Подключение к тому через шлюз ExpressRoute    |    Да    |         |
|    Подключение из локальной для тома в периферийную виртуальную сеть через шлюз ExpressRoute и Пиринг виртуальных сетей с Транзит через шлюз    |    Нет    |    Создание делегированного подсети в центральной виртуальной сети (виртуальной сети Azure с помощью шлюза)    |
|    Подключение из локальной для тома в периферийной виртуальной сети через VPN-шлюза    |    Да    |         |
|    Подключение из локальной для тома в периферийной виртуальной сети через VPN-шлюз и Пиринг виртуальных сетей с Транзит через шлюз    |    Да    |         |


## <a name="virtual-network-for-azure-netapp-files-volumes"></a>Виртуальную сеть для тома файлов Azure NetApp

Этот раздел описывает концепции, которые помогают выполнить планирование виртуальной сети.

### <a name="azure-virtual-networks"></a>Виртуальные сети Azure

Перед подготовкой тома службы файлов Azure NetApp, необходимо создать виртуальной сети Azure (VNet) или использовать уже существующую в вашей подписке. Виртуальная сеть определяет границу сети тома.  Дополнительные сведения о создании виртуальных сетей, см. в разделе [документацию по виртуальным сетям Azure](https://docs.microsoft.com/azure/virtual-network/virtual-networks-overview).

### <a name="subnets"></a>Подсети

Подсети разделить виртуальную сеть в отдельных адресных пространств, которые могут использоваться с ресурсами Azure, в них.  Тома файлов NetApp Azure содержатся в специальная подсеть с именем [делегированные подсети](https://docs.microsoft.com/azure/virtual-network/virtual-network-manage-subnet). 

Делегирование подсети предоставляет явные разрешения для службы файлов Azure NetApp для создания ресурсов конкретной службы в подсети.  Он использует уникальный идентификатор в развертывании службы. Таким образом чтобы обеспечить подключение к службе файлов Azure NetApp создается сетевой интерфейс.

Если вы используете новую виртуальную сеть, можно создать подсеть и делегировать подсети NetApp файлы Azure, следуя указаниям в [делегировать подсети в службу файлов Azure NetApp](azure-netapp-files-delegate-subnet.md). Вы также можете делегировать ней пустую подсеть, уже не делегированную для других служб.

Если виртуальная сеть является одноранговой для другой виртуальной сети, не может расширить адресное пространство виртуальной сети. По этой причине новую делегированного подсеть должна быть создана в адресном пространстве виртуальной сети. Если необходимо расширить пространство адресов, необходимо удалить пиринг перед расширением адресное пространство виртуальной сети.

### <a name="udrs-and-nsgs"></a>Определяемые пользователем маршруты и группами безопасности сети

Группы безопасности сети (Nsg) с типом следующего прыжка не может использоваться как делегированного подсетей для службы файлов Azure NetApp. Аналогичным образом определяемые пользователем маршруты (Udr) также не поддерживаются. 

Обойти это ограничение можно применить группы безопасности сети к другим подсетям, которые разрешают или запрещают трафик к и из подсети службы файлов Azure NetApp делегировать.  

## <a name="azure-native-environments"></a>Собственный среды Azure

На следующей схеме показана среду Azure-машинный код:

![Сетевая среда Azure-машинный код](../media/azure-netapp-files/azure-netapp-files-network-azure-native-environment.png)

### <a name="local-vnet"></a>Виртуальной локальной сети

Базовый сценарий — для создания или подключения к тома NetApp службы файлов Azure из виртуальной машины (VM) в той же виртуальной сети. Для виртуальной сети 2 на схеме выше том 1 создается в делегированного подсети и может быть установлена на 1 виртуальной Машины в подсети по умолчанию.

### <a name="vnet-peering"></a>Пиринговая связь между виртуальными сетями

При наличии дополнительных виртуальных сетей, в том же регионе, который требуется доступ к ресурсам друг друга, виртуальные сети можно подключить с помощью [пиринг](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview) для обеспечения безопасного подключения через инфраструктуру Azure. 

Рассмотрим виртуальную сеть 2 и 3 виртуальной сети на схеме выше. Если необходимо подключиться к виртуальной Машине 2 и тома 2 VM 1 или 2 виртуальной Машины должен подключиться к виртуальной Машины 1 или том 1, необходимо включить пиринговой связи между виртуальной сетью 2 и 3 виртуальной сети. 

Кроме того рассмотрим ситуацию, где участвует в пиринге виртуальной сети 1 с 2 виртуальной сети, и участвует в пиринге виртуальной сети 2 с 3 виртуальной сети в одном регионе. Ресурсы с 1 виртуальной сети могут подключаться к ресурсам в виртуальной сети 2, но она не может подключиться к ресурсам в виртуальной сети 3, если не пиринговой связи виртуальной сети 1 и 3 виртуальной сети. 

На приведенной выше схеме несмотря на то, что 3 виртуальной Машине можно подключиться к том 1, 4 виртуальной Машины не удается подключиться к том 2.  Причиной этого является то, что виртуальные сети периферийных зон не установлена пиринговая связь, и _Транзитная маршрутизация не поддерживается через пиринг_.

## <a name="hybrid-environments"></a>Гибридных средах

На следующей схеме показана в гибридной среде: 

![Гибридные сетевой среды](../media/azure-netapp-files/azure-netapp-files-network-hybrid-environment.png)

В гибридном сценарии приложений из локальных центров обработки данных требуется доступ к ресурсам в Azure.  Это происходит ли вы хотите расширить ваш центр обработки данных в Azure, или вы хотите использовать Azure собственных служб или для аварийного восстановления. См. в разделе [VPN-шлюз, параметры планирования](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%2fazure%2fvirtual-network%2ftoc.json#planningtable) о том, как соединиться с нескольких ресурсов локальных ресурсов в Azure через виртуальную частную сеть сеть или подключение ExpressRoute.

В звездообразной топологии гибридного центральной виртуальной сети в Azure выступает в качестве центральной точки подключения к локальной сети. Периферийные зоны виртуальными сетями установлена пиринговая связь с концентратором и они могут использоваться для изоляции рабочих нагрузок.

В зависимости от конфигурации. Может соединять ресурсы из локальных ресурсов в концентраторе и периферийных зонах.

В топологии, показано на рисунке выше в локальной сети подключен к концентратору виртуальной сети в Azure и существуют 2 виртуальной сети в одном регионе периферийных зон пиринговой связи с центральной виртуальной сети.  В этом случае параметры подключения, поддерживаемые для томов службы файлов Azure NetApp, следующим образом:

* Локальные ресурсы виртуальной Машины 1 и 2 на виртуальной Машине можно подключиться к том 1 в концентраторе через сеть сеть VPN или Express Route. 
* Для локальных ресурсов виртуальной Машины 1 и 2 виртуальной Машины можно подключиться к тома 2 или 3 тома через сеть сеть VPN, а пиринг региональной виртуальной сети.
* 3 виртуальной Машины в концентраторе виртуальной сети можно подключиться к том 2 в первой периферийной виртуальной сети и том 3 в периферийной зоне 2 виртуальной сети.
* 4 виртуальных Машин из периферийной виртуальной сети и 5 виртуальных Машин из периферийной зоны 2 виртуальной сети можно подключить тома 1 в виртуальной сети концентратора.

4 виртуальных Машин в первой периферийной виртуальной сети не удается подключиться к том 3 в периферийной зоне 2 виртуальной сети. Кроме того, 5 виртуальных Машин в периферийной зоне VNet2 не удается подключиться к том 2 в первой периферийной виртуальной сети. Это происходит потому, что виртуальные сети периферийных зон не установлена пиринговая связь и _Транзитная маршрутизация не поддерживается через пиринг_.

## <a name="next-steps"></a>Дальнейшие действия

[Делегирование подсети в Azure NetApp Files](azure-netapp-files-delegate-subnet.md)
