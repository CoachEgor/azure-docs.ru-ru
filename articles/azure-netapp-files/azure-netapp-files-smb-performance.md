---
title: Часто задаваемые вопросы о производительности SMB для файлов Azure NetApp Документы Майкрософт
description: Ответы часто задаваемые вопросы о производительности Малого и Среднего бизнеса для файлов Azure NetApp.
services: azure-netapp-files
documentationcenter: ''
author: b-juche
manager: ''
editor: ''
ms.assetid: ''
ms.service: azure-netapp-files
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 03/17/2020
ms.author: b-juche
ms.openlocfilehash: 24b3710861f0ee158619ae9103584dcdb181f3d5
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79460455"
---
# <a name="faqs-about-smb-performance-for-azure-netapp-files"></a>Часто задаваемые вопросы о производительности SMB для файлов Azure NetApp

В этой статье часто задаются вопросы (часто задаваемые вопросы) о рекомендациях по производительности малого и среднего бизнеса для файлов Azure NetApp.

## <a name="is-smb-multichannel-enabled-in-smb-shares"></a>Включен ли Multichannel SMB в акциях Малого и Среднего бизнеса? 

Да, SMB Multichannel включен по умолчанию, изменение введено в действие в начале января 2020 года. Все акции Малого и Среднего мв., существовавшие до существующих объемов малого и среднего бизнеса, имели функцию, и все вновь созданные тома также будут иметь функцию, включенную во время создания. 

Любое соединение SMB, установленное до включения функции, необходимо сбросить, чтобы воспользоваться функциональностью Multichannel SMB. Для сброса можно отключить и восстановить долю SMB.

## <a name="is-rss-supported"></a>Поддерживается ли RSS?

Да, Azure NetApp Files поддерживает масштабирование на стороне приема (RSS).

С включенным SMB Multichannel клиент SMB3 устанавливает несколько подключений TCP к серверу SMB SMB Сети NetApp по электронной карточке (NIC), которая является единственной RSS. 

## <a name="which-windows-versions-support-smb-multichannel"></a>Какие версии Windows поддерживают Multichannel SMB?

Windows поддерживает SMB Multichannel с Windows 2012, чтобы обеспечить лучшую производительность.  Подробнее о [расзнакомии Multichannel и](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn610980(v%3Dws.11)) [основах Multichannel SMB](https://blogs.technet.microsoft.com/josebda/2012/06/28/the-basics-of-smb-multichannel-a-feature-of-windows-server-2012-and-smb-3-0/) смотрите. 


## <a name="does-my-azure-virtual-machine-support-rss"></a>Поддерживает ли моя виртуальная машина Azure RSS?

Чтобы увидеть, поддерживает ли ваша виртуальная машина NiCs Azure RSS, запустите команду `Get-SmbClientNetworkInterface` следующим образом и проверьте поле: `RSS Capable` 

![ПОДДЕРЖКА RSS виртуальной машины Azure](../media/azure-netapp-files/azure-netapp-files-formance-rss-support.png)

## <a name="does-azure-netapp-files-support-smb-direct"></a>Поддерживают ли файлы Azure NetApp SMB Direct?

Нет, Файлы Azure NetApp не поддерживают SMB Direct. 

## <a name="what-is-the-benefit-of-smb-multichannel"></a>В чем преимущество Multichannel SMB? 

Функция SMB Multichannel позволяет клиенту SMB3 создать пул подключений по одной сетевой интерфейсной карте (NIC) или нескольким NICs и использовать их для отправки запросов на один сеанс SMB. В отличие от этого, по замыслу, SMB1 и SMB2 требуют от клиента установить одно соединение и отправить весь трафик SMB для данного сеанса по этому подключению. Это единое соединение ограничивает общую производительность протокола, которая может быть достигнута от одного клиента.

## <a name="should-i-configure-multiple-nics-on-my-client-for-smb"></a>Должен ли я настроить несколько NICs на моем клиенте для малого и среднего бизнеса?

Нет. Клиент SMB будет соответствовать подсчету NIC, возвращенному сервером SMB.  Каждый объем хранилища доступен с одной и только одной точки хранения.  Это означает, что только один NIC будет использоваться для любого данного отношения SMB.  

Как показано `Get-SmbClientNetworkInterace` на выходе ниже, виртуальная машина имеет два сетевых интерфейса - 15 и 12.  Как показано ниже `Get-SmbMultichannelConnection`под командой , даже если Есть два RSS-способных NICS, только интерфейс 12 используется в связи с долей малого и среднего бизнеса; интерфейс 15 не используется.

![RSS-способный NICS](../media/azure-netapp-files/azure-netapp-files-rss-capable-nics.png)

## <a name="is-nic-teaming-supported-in-azure"></a>Поддерживается ли объединение NIC в Azure?

Объединение NIC не поддерживается в Azure. Хотя несколько сетевых интерфейсов поддерживаются на виртуальных машинах Azure, они представляют собой скорее логическую, чем физическую конструкцию. Как таковые, они не обеспечивают толерантность к ошибкам.  Кроме того, пропускная способность, доступная виртуальной машине Azure, рассчитывается для самой машины, а не для какого-либо отдельного сетевого интерфейса.

## <a name="whats-the-performance-like-for-smb-multichannel"></a>Какова производительность, как для SMB Multichannel?

Следующие тесты и графики демонстрируют мощность Multichannel SMB на однопользовательских рабочих нагрузках.

### <a name="random-io"></a>Случайный вв/o  

С SMB Multichannel отключен на клиента, чистый 8-KiB читать и писать тесты были выполнены с помощью FIO и 40-GiB рабочий набор.  Доля SMB была отделена между каждым тестом, с шагом количества подключений клиентов `1``4`SMB на настройки сетевого интерфейса RSS,`8`.`16` `set-SmbClientConfiguration -ConnectionCountPerRSSNetworkInterface <count>` Тесты показывают, что `4` настройка по умолчанию достаточна для интенсивных рабочих нагрузок ввоза; приращения `8` `16` и не имели никакого эффекта. 

`netstat -na | findstr 445` Командование доказало, что дополнительные соединения были `1` `4` установлены с приращениями от туда `8` и к `16`.  Четыре ядра процессора были полностью использованы для малого и среднего `Per Processor Network Activity Cycles` бизнеса во время каждого теста, что подтверждается статистикой перфмона (не включена в эту статью).

![Случайные тесты вв/о-то](../media/azure-netapp-files/azure-netapp-files-random-io-tests.png)

Виртуальная машина Azure не влияет на ограничения вхогов/ввоза SMB (ни NFS).  Как показано ниже, тип экземпляра D16 имеет ограниченный тариф 32 000 для кэшированного IOPS хранения и 25 600 для некэшированного IOPS хранения.  Тем не менее, график выше показывает значительно больше ввихих/от над SMB.

![Случайное сравнение вв/о](../media/azure-netapp-files/azure-netapp-files-random-io-tests-list.png)

### <a name="sequential-io"></a>Последовательный IO 

Тесты, аналогичные описанным выше случайным тестам вв./о, проводились с последовательным вв/o 64-KiB. Хотя увеличение количества клиентских подключений на сетевой интерфейс RSS за пределами 4' не оказало заметного влияния на случайные вв/огню, то же самое не относится к последовательному входно-разъему. Как показано на следующем графике, каждое увеличение связано с соответствующим увеличением пропускной связи с чтением. Пропускная способность записи оставалась плоской из-за ограничений пропускной способности сети, установленных Azure для каждого типа/размера экземпляра. 

![Последовательные тесты на ви/осеи](../media/azure-netapp-files/azure-netapp-files-sequential-io-tests.png)

Azure устанавливает ограничения скорости сети на каждом виртуальном типе/размере машины. Ограничение скорости накладывается только на исходящий трафик. Количество NICs, присутствующих на виртуальной машине, не влияет на общее количество пропускной способности, доступной для машины.  Например, тип экземпляра D16 имеет установленный сетевой лимит в 8000 Мбит/с (1000 МБит/с).  Как показано на последовательном графике выше, ограничение влияет на исходящий трафик (пишет), но не на многоканальный считывание.

![Последовательное сравнение вв/о](../media/azure-netapp-files/azure-netapp-files-sequential-io-tests-list.png)

## <a name="is-accelerated-networking-recommended"></a>Рекомендуется ли ускоренная сеть?

Для максимальной производительности рекомендуется настраивать [ускоренную сеть,](https://docs.microsoft.com/azure/virtual-network/create-vm-accelerated-networking-powershell) где это возможно. Имейте в виду следующие соображения:  

* Портал Azure позволяет ускорить сеть по умолчанию для виртуальных машин, поддерживающих эту функцию.  Однако другие методы развертывания, такие как Ansible и аналогичные инструменты конфигурации, могут не быть.  Неспособность включить ускоренную сеть может затормозить производительность машины.  
* Если ускоренная сеть не включена в сетевом интерфейсе виртуальной машины из-за отсутствия поддержки типа или размера экземпляра, она будет оставаться отключенной с большими типами экземпляров. В таких случаях вам потребуется ручное вмешательство.

## <a name="are-jumbo-frames-supported"></a>Поддерживаются ли гигантские кадры?

Jumbo кадры не поддерживаются с помощью виртуальных машин Azure.

## <a name="is-smb-signing-supported"></a>Поддерживается ли подписание SMB? 

Протокол SMB обеспечивает основу для обмена файлами и печатью и других сетевых операций, таких как удаленное администрирование Windows. Для предотвращения атак "злоумышленник в середине", когда SMB-пакеты изменяются при передаче, протокол SMB поддерживает установку цифровой подписи для SMB-пакетов. 

Подписание SMB поддерживается для всех версий протоколов SMB, которые поддерживаются файлами Azure NetApp. 

## <a name="what-is-the-performance-impact-of-smb-signing"></a>Каково влияние sMB Signing на производительность?  

Подписание SMB оказывает пагубное влияние на производительность малого и среднего бизнеса. Среди других потенциальных причин ухудшения производительности, цифровое подписание каждого пакета потребляет дополнительный процессор со стороны клиента, как показано на выходе перфмона ниже. В этом случае, Core 0, как представляется, отвечает за SMB, в том числе SMB Подписание.  Сравнение с немногоканальными последовательными номерами пропускной записи чтения в предыдущем разделе показывает, что подписание SMB снижает общую пропускную стоимость с 875МБ/с примерно до 250МБ/с. 

![Влияние на производительность SMB](../media/azure-netapp-files/azure-netapp-files-smb-signing-performance.png)


## <a name="next-steps"></a>Дальнейшие действия  

- [Задаваемые вопросы о файлах NetApp Azure](azure-netapp-files-faqs.md)
- Ознакомьтесь с [файлами Azure NetApp: Управляемые корпоративные файлы для рабочих нагрузок SMB](https://cloud.netapp.com/hubfs/Resources/ANF%20SMB%20Quickstart%20doc%20-%2027-Aug-2019.pdf?__hstc=177456119.bb186880ac5cfbb6108d962fcef99615.1550595766408.1573471687088.1573477411104.328&__hssc=177456119.1.1573486285424&__hsfp=1115680788&hsCtaTracking=cd03aeb4-7f3a-4458-8680-1ddeae3f045e%7C5d5c041f-29b4-44c3-9096-b46a0a15b9b1) об использовании sMB-файлов с помощью файлов Azure NetApp Files.
