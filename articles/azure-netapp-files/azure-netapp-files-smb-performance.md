---
title: Часто задаваемые вопросы о производительности SMB для Azure NetApp Files | Документация Майкрософт
description: Ответы на часто задаваемые вопросы о производительности SMB для Azure NetApp Files.
services: azure-netapp-files
documentationcenter: ''
author: b-juche
manager: ''
editor: ''
ms.assetid: ''
ms.service: azure-netapp-files
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 03/17/2020
ms.author: b-juche
ms.openlocfilehash: 24b3710861f0ee158619ae9103584dcdb181f3d5
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "79460455"
---
# <a name="faqs-about-smb-performance-for-azure-netapp-files"></a>Часто задаваемые вопросы о производительности SMB для Azure NetApp Files

В этой статье содержатся ответы на часто задаваемые вопросы о рекомендациях по работе с SMB для Azure NetApp Files.

## <a name="is-smb-multichannel-enabled-in-smb-shares"></a>Включен ли многоканальный SMB в общих ресурсах SMB? 

Да, многоканальный протокол SMB включен по умолчанию, изменения помещаются в начале января 2020. Все общие ресурсы SMB, предварительно датировано существующие тома SMB, включили функцию, а все вновь созданные тома также будут включать эту функцию во время создания. 

Все подключения SMB, установленные до включения функции, необходимо сбросить, чтобы воспользоваться преимуществами многоканальных функций SMB. Для сброса можно отключить и повторно подключить общий ресурс SMB.

## <a name="is-rss-supported"></a>Поддерживается ли поддержка RSS?

Да, Azure NetApp Files поддерживает масштабирование на стороне приема (RSS).

При включении многоканального протокола SMB клиент SMB3 устанавливает несколько TCP-подключений к Azure NetApp Files SMB-серверу через сетевой адаптер (NIC), поддерживающий единый RSS. 

## <a name="which-windows-versions-support-smb-multichannel"></a>Какие версии Windows поддерживают многоканальный протокол SMB?

Windows поддерживает многоканальный протокол SMB с Windows 2012 для обеспечения лучшей производительности.  Дополнительные сведения см. в статье [развертывание многоканального протокола SMB](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn610980(v%3Dws.11)) и [основы многоканального SMB](https://blogs.technet.microsoft.com/josebda/2012/06/28/the-basics-of-smb-multichannel-a-feature-of-windows-server-2012-and-smb-3-0/) . 


## <a name="does-my-azure-virtual-machine-support-rss"></a>Поддерживает ли моя виртуальная машина Azure поддержку RSS?

Чтобы узнать, поддерживает ли сетевые адаптеры виртуальной машины Azure RSS, выполните команду, `Get-SmbClientNetworkInterface` как показано ниже, и установите флажок в поле `RSS Capable` : 

![Поддержка RSS для виртуальной машины Azure](../media/azure-netapp-files/azure-netapp-files-formance-rss-support.png)

## <a name="does-azure-netapp-files-support-smb-direct"></a>Поддерживает ли Azure NetApp Files SMB Direct?

Нет, Azure NetApp Files не поддерживает SMB Direct. 

## <a name="what-is-the-benefit-of-smb-multichannel"></a>Каково преимущество многоканального SMB? 

Функция многоканального SMB позволяет клиенту SMB3 устанавливать пул подключений через один сетевой адаптер или несколько сетевых интерфейсов и использовать их для отправки запросов на один сеанс SMB. Напротив, при проектировании протоколы SMB1 и SMB2 должны установить одно соединение и отправить весь трафик SMB для данного сеанса через это подключение. Это единственное подключение ограничивает общую производительность протокола, которая может быть достигнута одним клиентом.

## <a name="should-i-configure-multiple-nics-on-my-client-for-smb"></a>Следует ли настроить несколько сетевых адаптеров на моем клиенте для SMB?

Нет. Клиент SMB будет соответствовать количеству сетевых карт, возвращенному сервером SMB.  Каждый том хранилища доступен из одной и только одной конечной точки хранилища.  Это означает, что для любой конкретной связи SMB будет использоваться только одна сетевая карта.  

Как показано в выходных данных `Get-SmbClientNetworkInterace` ниже, виртуальная машина имеет два сетевых интерфейса — 15 и 12.  Как показано ниже, в команде `Get-SmbMultichannelConnection` , несмотря на наличие двух сетевых карт с поддержкой RSS, в подключении к общему ресурсу SMB используется только интерфейс 12; интерфейс 15 не используется.

![Сетевые карты с поддержкой RSS](../media/azure-netapp-files/azure-netapp-files-rss-capable-nics.png)

## <a name="is-nic-teaming-supported-in-azure"></a>Поддерживается ли объединение сетевых карт в Azure?

Объединение сетевых карт не поддерживается в Azure. Хотя на виртуальных машинах Azure поддерживается несколько сетевых интерфейсов, они представляют логическую, а не физическую конструкцию. Таким образом, они не обеспечивают отказоустойчивости.  Кроме того, пропускная способность, доступная для виртуальной машины Azure, вычисляется для самого компьютера, а не для отдельного сетевого интерфейса.

## <a name="whats-the-performance-like-for-smb-multichannel"></a>Какова производительность, например, для многоканального SMB?

Следующие тесты и графики демонстрируют возможности многоканального SMB в рабочих нагрузках с одним экземпляром.

### <a name="random-io"></a>Случайные операции ввода-вывода  

При отключении многоканального протокола SMB на клиенте проверяются чистые 8-Кибные тесты чтения и записи с помощью FIO и рабочего набора 40-гиб.  Общая папка SMB была отсоединена между тестами, с приращениями количества подключений клиентов SMB на параметры сетевого интерфейса RSS `1` , `4` ,,, `8` `16` `set-SmbClientConfiguration -ConnectionCountPerRSSNetworkInterface <count>` . Тесты показывают, что параметр по умолчанию `4` достаточно для рабочих нагрузок с интенсивным вводом-выводом, `8` что увеличивает значение и `16` не оказывает никакого влияния. 

Команда `netstat -na | findstr 445` доказала, что были установлены дополнительные соединения с приращением до `1` `4` `8` и до `16` .  Четыре ядра ЦП полностью использовались для SMB во время каждого теста, как подтверждено `Per Processor Network Activity Cycles` статистикой Perfmon (не включена в эту статью).

![Случайные тесты ввода-вывода](../media/azure-netapp-files/azure-netapp-files-random-io-tests.png)

Виртуальная машина Azure не влияет на ограничения ввода-вывода хранилища SMB (или NFS).  Как показано ниже, тип экземпляра D16 имеет ограниченную частоту 32 000 для кэшированных операций ввода-вывода и 25 600 для некэшированных операций ввода-вывода в хранилище.  Однако приведенный выше график показывает значительно больше операций ввода-вывода по протоколу SMB.

![Сравнение случайных операций ввода-вывода](../media/azure-netapp-files/azure-netapp-files-random-io-tests-list.png)

### <a name="sequential-io"></a>Последовательный ввод-вывод 

Тесты, аналогичные приведенным выше, были выполнены с 64-КИБ последовательными операциями ввода-вывода. Хотя увеличение числа подключений клиентов на сетевой интерфейс RSS, превышающее 4 ", не оказывает заметного воздействия на случайные операции ввода-вывода, такое же действие не применяется к последовательным операциям ввода-вывода. Как показано на следующем графике, каждое увеличение связано с соответствующим увеличением пропускной способности чтения. Пропускная способность записи оставалась плоской из-за ограничений пропускной способности сети, размещенных Azure для каждого типа или размера экземпляра. 

![Последовательные тесты ввода-вывода](../media/azure-netapp-files/azure-netapp-files-sequential-io-tests.png)

Azure размещает ограничения сетевой частоты для каждого типа или размера виртуальной машины. Ограничение скорости накладывается только на исходящий трафик. Количество сетевых адаптеров, имеющихся на виртуальной машине, не влияет на общий объем пропускной способности, доступной для компьютера.  Например, для типа экземпляра D16 накладывается ограничение сети 8000 Мбит/с (1 000 MiB/с).  Как показано на последовательном графике, ограничение влияет на исходящий трафик (записи), но не на многоканальные операции чтения.

![Сравнение последовательных операций ввода-вывода](../media/azure-netapp-files/azure-netapp-files-sequential-io-tests-list.png)

## <a name="is-accelerated-networking-recommended"></a>Рекомендуется ли использовать ускоренную сеть?

Для максимальной производительности рекомендуется настроить [ускоренную сеть](https://docs.microsoft.com/azure/virtual-network/create-vm-accelerated-networking-powershell) там, где это возможно. Учитывайте следующие соображения.  

* Портал Azure по умолчанию включает ускоренную сеть для виртуальных машин, поддерживающих эту функцию.  Однако другие методы развертывания, такие как Ansible и аналогичные средства настройки, могут не иметь.  Невозможность включения ускоренной сети может парализовать производительность компьютера.  
* Если в сетевом интерфейсе виртуальной машины не включено ускорение работы в сети из-за отсутствия поддержки типа или размера экземпляра, он останется отключенным с более крупными типами экземпляров. В таких случаях потребуется вмешательство вручную.

## <a name="are-jumbo-frames-supported"></a>Поддерживаются ли кадры крупного размера?

Крупные кадры не поддерживаются на виртуальных машинах Azure.

## <a name="is-smb-signing-supported"></a>Поддерживается ли подписывание SMB? 

Протокол SMB предоставляет базу для общего доступа к файлам и принтерам, а также другие сетевые операции, такие как удаленное администрирование Windows. Для предотвращения атак "злоумышленник в середине", когда SMB-пакеты изменяются при передаче, протокол SMB поддерживает установку цифровой подписи для SMB-пакетов. 

Подписывание SMB поддерживается для всех версий протокола SMB, поддерживаемых Azure NetApp Files. 

## <a name="what-is-the-performance-impact-of-smb-signing"></a>Каково влияние подписи SMB на производительность?  

Подписывание SMB оказывает делетериаус воздействие на производительность SMB. Помимо других возможных причин снижения производительности, цифровая подпись каждого пакета потребляет дополнительный процессор на стороне клиента, как показано в показанных ниже выходных данных системного монитора. В этом случае ядро 0 отображается в качестве ответственного за SMB, включая подписывание SMB.  В сравнении с последовательными номерами пропускной способности чтения, не являющимися многоканальными в предыдущем разделе, показано, что подписывание SMB сокращает общую пропускную способность от 875MiB/с до приблизительно 250MiB/с. 

![Влияние подписи SMB на производительность](../media/azure-netapp-files/azure-netapp-files-smb-signing-performance.png)


## <a name="next-steps"></a>Дальнейшие шаги  

- [Часто задаваемые вопросы о Azure NetApp Files](azure-netapp-files-faqs.md)
- См. раздел [Azure NetApp Files. управляемые корпоративные файловые ресурсы для рабочих нагрузок SMB](https://cloud.netapp.com/hubfs/Resources/ANF%20SMB%20Quickstart%20doc%20-%2027-Aug-2019.pdf?__hstc=177456119.bb186880ac5cfbb6108d962fcef99615.1550595766408.1573471687088.1573477411104.328&__hssc=177456119.1.1573486285424&__hsfp=1115680788&hsCtaTracking=cd03aeb4-7f3a-4458-8680-1ddeae3f045e%7C5d5c041f-29b4-44c3-9096-b46a0a15b9b1) об использовании файловых ресурсов smb с Azure NetApp Files.
