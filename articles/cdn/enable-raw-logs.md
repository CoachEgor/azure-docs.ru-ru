---
title: Необработанные журналы HTTP (Azure CDN)
description: В этой статье собраны сведения о необработанных журналах HTTP в службе Azure CDN.
services: cdn
author: sohamnchatterjee
manager: danielgi
ms.service: azure-cdn
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/23/2020
ms.author: sohamnc
ms.openlocfilehash: f4693cdac2d5d3a57987cc692797756314ded11e
ms.sourcegitcommit: 493b27fbfd7917c3823a1e4c313d07331d1b732f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/21/2020
ms.locfileid: "83747302"
---
# <a name="azure-cdn-http-raw-logs"></a>Необработанные журналы HTTP (Azure CDN)
Необработанные журналы предоставляют широкие сведения об операциях и ошибках, полезные для аудита и (или) устранения неполадок. Необработанные журналы отличаются от журналов действий. Журналы действий позволяют анализировать операции, выполненные с ресурсами Azure. Необработанные журналы содержат записи действий самого ресурса.

> [!IMPORTANT]
> Компонент необработанных журналов HTTP доступен только в Azure CDN корпорации Майкрософт.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу. 

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на портал Azure по адресу [https://portal.azure.com](https://portal.azure.com).

## <a name="configuration"></a>Конфигурация

Чтобы настроить необработанные журналы для Azure CDN из профиля Майкрософт, выполните следующие действия: 

1. В меню портала Azure выберите элементы **Все ресурсы** >>  **\<профиль_CDN>** .

2. В разделе **Мониторинг** выберите элемент **Параметры диагностики**.

3. Щелкните команду **Добавить параметр диагностики**.

    ![Параметр диагностики CDN](./media/cdn-raw-logs/raw-logs-01.png)

    > [!IMPORTANT]
    > Необработанные журналы доступны только на уровне профиля. Агрегированные журналы кодов состояний HTTP доступны на уровне конечной точки.

4. В разделе **Параметры диагностики** введите значение в поле **Имя параметра диагностики**.

5. Выберите вариант **Журнал** и задайте срок хранения в днях.

6. Выберите элемент **Сведения о назначении**. Доступны следующие варианты назначения:
    * **Отправить в Log Analytics.**
        * Выберите **подписку** и **рабочую область Log Analytics**.
    * **Архивировать в учетной записи хранения.**
        * Выберите **подписку** и **учетную запись хранения**.
    * **Передать в концентратор событий.**
        * Выберите **подписку**, **пространство имен концентратора событий**, **имя концентратора событий (необязательно)** и **имя политики концентратора событий**.

    ![Параметр диагностики CDN](./media/cdn-raw-logs/raw-logs-02.png)

7. Щелкните **Сохранить**.

## <a name="raw-logs-properties"></a>Свойства необработанных журналов

Сейчас Azure CDN из службы Майкрософт предоставляет необработанные журналы. Необработанные журналы содержат сведения о каждом запросе к API со следующей схемой: 

| Свойство              | Описание                                                                                                                                                                                          |
|-----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| TrackingReference     | Это уникальная эталонная строка, которая идентифицирует обслуженный Front Door запрос. Она же отправляется клиенту в заголовке X-Azure-Ref. Эта строка нужна для поиска в журналах доступа сведений о конкретном запросе. |
| HttpMethod            | Метод HTTP, используемый для запроса.                                                                                                                                                                     |
| HttpVersion           | Тип запроса или подключения.                                                                                                                                                                   |
| RequestUri            | URI полученного запроса.                                                                                                                                                                         |
| RequestBytes          | Размер сообщения с HTTP-запросом в байтах, включая заголовки и текст запроса.                                                                                                   |
| ResponseBytes         | Количество байтов, отправленных внутренним сервером в качестве ответа.                                                                                                                                                    |
| UserAgent             | Тип браузера, используемый клиентом.                                                                                                                                                               |
| ClientIp              | IP-адрес отправившего запрос клиента.                                                                                                                                                  |
| TimeTaken             | Количество времени, затраченное на выполнение действия (в миллисекундах).                                                                                                                                            |
| SecurityProtocol      | Версия протокола TLS/SSL, которая использовалась в запросе. Содержит значение NULL, если шифрование не использовалось.                                                                                                                           |
| Конечная точка              | Узел конечной точки CDN, который настроен в родительском профиле CDN.                                                                                                                                   |
| Имя внутреннего узла     | Имя узла внутреннего сервера или источника, куда отправляются запросы.                                                                                                                                |
| Отправлено на защиту источника | Если установлено значение true, значит, ответ на запрос был получен из кэша защиты источника, а не из граничной точки присутствия. Защитой источника называется родительский кэш, который предназначен для повышения коэффициента попаданий в кэш.                                       |
| HttpStatusCode        | Код состояния HTTP, полученный от прокси-сервера.                                                                                                                                                        |
| HttpStatusDetails     | Итоговое состояние запроса. Пояснения к этому строковому значению есть в ссылочной таблице "Состояние".                                                                                              |
| Pop                   | Граничная точка присутствия, которая ответила на запрос пользователя. Точки присутствия кодируются аббревиатурами аэропортов в соответствующих городах.                                                                                   |
| Состояние кэша          | Указывает, получен ли объект из кэша или напрямую из источника.                                                                                                             |
> [!IMPORTANT]
> Функциональность необработанных журналов HTTP автоматически становится доступной для всех профилей, созданных или обновленных после **25 февраля 2020 года**. Для ранее созданных профилей CDN следует обновить конечную точку CDN после настройки ведения журнала. Например, можно открыть раздел в географической фильтрации для конечных точек CDN и заблокировать любую страну или регион, которая не важна для вашей работы, а затем нажать кнопку "Сохранить". 

> [!NOTE]
> Журналы будут доступны для запросов в профиле Log Analytics. Пример запроса: AzureDiagnostics | where Category == "AzureCdnAccessLog"

## <a name="next-steps"></a>Next Steps
В рамках этой статьи вы включили поддержку необработанных журналов HTTP в службе Microsoft CDN.

Дополнительные сведения о Azure CDN и других службах Azure, упомянутых в этой статье, см. в следующих статьях:

* [Изучите](cdn-log-analysis.md) шаблоны использования Azure CDN

* Узнайте подробнее о службе [Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/overview).

* Настройте [Log Analytics в Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/log-query/get-started-portal).
