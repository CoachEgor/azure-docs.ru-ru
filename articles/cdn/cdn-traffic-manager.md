---
title: Failover через несколько конечных точек Azure CDN с менеджером трафика
description: Узнайте, как настроить диспетчер трафика Azure с использованием конечных точек Azure CDN.
services: cdn
documentationcenter: ''
author: mdgattuso
manager: danielgi
editor: ''
ms.assetid: ''
ms.service: azure-cdn
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/18/2019
ms.author: magattus
ms.custom: ''
ms.openlocfilehash: de91f61385942db077bc98721eabe9f3f0b8624c
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "74083006"
---
# <a name="set-up-failover-across-multiple-azure-cdn-endpoints-with-azure-traffic-manager"></a>Настройка отработки отказа между несколькими конечными точками Azure CDN при помощи диспетчера трафика Azure

В ходе настройки сети доставки содержимого Azure (Azure CDN) есть возможность выбора оптимального поставщика и ценовой категории, в соответствии с вашими потребностями. Azure CDN имеет глобально распределенную инфраструктуру, что позволяет по умолчанию создавать локальную и географическую избыточность и глобальную балансировку нагрузки с целью повышения доступности и производительности служб. Если расположение недоступно для обслуживания содержимого, запросы будут автоматически направляться в другое расположение и для обслуживания запроса каждого клиента используется оптимальная точка присутствия (с учетом таких факторов, как расположение запроса и загрузка сервера). 
 
Наличие нескольких профилей CDN создает возможность дальнейшего улучшения доступности и производительности с помощью диспетчера трафика Azure. Диспетчер трафика Azure с Azure CDN можно использовать для балансировки нагрузки между несколькими конечными точками CDN с целью отработки отказа, географической балансировки нагрузки и других сценариев. В случае обычной отработки отказа все клиентские запросы сначала направляются в основной профиль CDN; если профиль недоступен, запросы передаются на вспомогательный профиль CDN до тех пор, пока связь с основным профилем CDN не будет восстановлена. В этом случае использование диспетчера трафика Azure позволяет гарантировать постоянную доступность вашего веб-приложения. 

В этой статье приведено руководство и пример того, как настроить отработку отказа при помощи профилей **Azure CDN уровня "Стандартный" от Verizon** и **Azure CDN уровня "Стандартный" от Akamai**.

## <a name="set-up-azure-cdn"></a>Настройка Azure CDN 
Создайте два или более профиля и конечных точек Azure CDN через разных поставщиков.

1. Создайте профили **Azure CDN уровня "Стандартный" от Verizon** и **Azure CDN уровня "Стандартный" от Akamai** , следуя разделу [Создание профиля CDN](cdn-create-new-endpoint.md#create-a-new-cdn-profile).
 
   ![Несколько профилей CDN](./media/cdn-traffic-manager/cdn-multiple-profiles.png)

2. В каждом профиле создайте по крайней мере одну конечную точку, следуя пошаговому руководству в разделе [Создание конечной точки CDN](cdn-create-new-endpoint.md#create-a-new-cdn-endpoint).

## <a name="set-up-azure-traffic-manager"></a>Настройка диспетчера трафика Azure
Создайте профиль диспетчера трафика Azure и настройте балансировку нагрузки между ранее созданными конечными точками CDN. 

1. Создайте профиль диспетчера трафика Azure, следуя пошаговому руководству в разделе [Создание профиля диспетчера трафика Azure](https://docs.microsoft.com/azure/traffic-manager/traffic-manager-create-profile). 

    В пункте **Метод маршрутизации** выберите **Приоритет**.

2. Добавьте в профиль диспетчера трафика конечные точки CDN, следуя пошаговому руководству в разделе [Добавление конечных точек диспетчера трафика Azure](https://docs.microsoft.com/azure/traffic-manager/traffic-manager-create-profile#add-traffic-manager-endpoints)

    В пункте **Тип** выберите **Внешние конечные точки**. В пункте **Приоритет** введите число.

    Например, создайте конечные точки *cdndemo101akamai.azureedge.net* с приоритетом *1* и *cdndemo101verizon.azureedge.net* с приоритетом *2*.

   ![Добавление конечных точек диспетчера трафика Azure](./media/cdn-traffic-manager/cdn-traffic-manager-endpoints.png)


## <a name="set-up-custom-domain-on-azure-cdn-and-azure-traffic-manager"></a>Настройка пользовательского домена в Azure CDN и диспетчере трафика Azure
После настройки профилей в CDN и диспетчера трафика Azure, добавьте сопоставление DNS и зарегистрируйте пользовательский домен в конечных точках CDN в соответствии со следующими указаниями. В данном примере имя пользовательского домена *cdndemo101.dustydogpetcare.online*.

1. Перейдите на веб-сайт поставщика домена для своего пользовательского домена, например GoDaddy, и создайте две записи DNS CNAME. 

    а. Для первой записи CNAME подключите к конечной точке CDN пользовательский домен с поддоменом cdnverify. Эта запись нужна для регистрации пользовательского домена в конечной точке CDN, которая была добавлена в диспетчер трафика Azure в шаге 2.

      Пример: 

      `cdnverify.cdndemo101.dustydogpetcare.online  CNAME  cdnverify.cdndemo101akamai.azureedge.net`  

    b. Для второй записи CNAME подключите к конечной точке CDN пользовательский домен без поддомена cdnverify. Эта запись подключает пользовательский домен к диспетчеру трафика Azure. 

      Пример: 
      
      `cdndemo101.dustydogpetcare.online  CNAME  cdndemo101.trafficmanager.net`   

    > [!NOTE]
    > Если соединение с доменом активно и не может быть прервано, выполните этот шаг в последнюю очередь. Убедитесь, что конечные точки CDN и домены диспетчера трафика Azure активны, прежде чем обновить пользовательский домен DNS в диспетчере трафика Azure.
    >


2.  В своем профиле Azure CDN выберите первую конечную точку CDN (Akamai). Выберите **Добавить пользовательский домен** и ввод *cdndemo101.dustydogpetcare.online*. Убедитесь, что флажок, подтверждающий допустимость пользовательского домена, отображается зеленым цветом. 

    Для завершения процесса регистрации Azure CDN использует поддомен *cdnverify* с целью проверки сопоставления DNS. Дополнительные сведения см. в разделе [Создание записи CNAME DNS](cdn-map-content-to-custom-domain.md#create-a-cname-dns-record). Этот шаг позволяет Azure CDN распознавать пользовательский домен, чтобы отвечать на его запросы.
    
    > [!NOTE]
    > Чтобы включить SSL на **Azure CDN из** профилей Akamai, необходимо непосредственно защелки пользовательского домена к вашей цели. cdnverify для включения SSL еще не поддерживается. 
    >

3.  Вернитесь на веб-сайт поставщика домена для своего личного домена и обновите первое созданное сопоставление DNS, чтобы пользовательский домен был подключён ко второй конечной точке CDN.
                             
    Пример: 

    `cdnverify.cdndemo101.dustydogpetcare.online  CNAME  cdnverify.cdndemo101verizon.azureedge.net`  

4. В своем профиле Azure CDN выберите вторую конечную точку CDN (Verizon) и повторите шаг 2. Выберите **Добавить пользовательский домен**, и ввод *cdndemo101.dustydogpetcare.online*.
 
По завершении этих действий служба с несколькими сетями CDN с возможностью отработки отказа будет настроена с помощью диспетчера трафика Azure. У вас будет доступ с пользовательского домена к тестовым URL-адресам. Чтобы проверить функции, отключите основную конечную точку CDN и убедитесь, что запрос правильно перенесен на вспомогательную конечную точку CDN. 

## <a name="next-steps"></a>Дальнейшие действия
Можно также настроить другие методы маршрутизации, например географические, чтобы сбалансировать нагрузку между разными конечными точками CDN. Дополнительные сведения см. в разделе [Настройка метода маршрутизации трафика по географическому расположению с помощью диспетчера трафика Azure](https://docs.microsoft.com/azure/traffic-manager/traffic-manager-configure-geographic-routing-method).



