---
title: Безопасность для экземпляров контейнеров
description: Рекомендации по защите изображений и секретов для экземпляров контейнеров Azure, а также общие соображения безопасности для любой контейнерной платформы
ms.topic: article
ms.date: 01/10/2020
ms.custom: ''
ms.openlocfilehash: b5f2c4d9ca80318574e288110fd4ce7f490af00d
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "76260503"
---
# <a name="security-considerations-for-azure-container-instances"></a>Соображения безопасности для экземпляров контейнеров Azure

В этой статье рассматриваются соображения безопасности при использовании экземпляров контейнеров Azure для запуска контейнерных приложений. Будут рассмотрены следующие задачи:

> [!div class="checklist"]
> * **Рекомендации по безопасности** для управления изображениями и секретами для экземпляров контейнеров Azure
> * **Рассмотрение контейнерной экосистемы** на протяжении всего жизненного цикла контейнера для любой контейнерной платформы

## <a name="security-recommendations-for-azure-container-instances"></a>Рекомендации по безопасности для контейнерных инстанций Azure

### <a name="use-a-private-registry"></a>Использование частного реестра

Контейнеры состоят из образов, которые хранятся в одном или нескольких репозиториях. Эти репозитории могут принадлежать к государственному реестру, как [Docker Hub](https://hub.docker.com), или к частному реестру. Примером частного реестра является [Docker Trusted Registry](https://docs.docker.com/datacenter/dtr/), который можно установить локально или в виртуальном частном облаке. Вы также можете использовать облачные службы частного реестра контейнеров, включая [реестр контейнеров Azure.](../container-registry/container-registry-intro.md) 

Публично доступное изображение контейнера не гарантирует безопасность. Контейнерные изображения состоят из нескольких слоев программного обеспечения, и каждый слой программного обеспечения может иметь уязвимости. Чтобы уменьшить угрозу атак, необходимо хранить и извлекать изображения из частного реестра, например, реестр контейнеров Azure или Докер Доверенный реестр. Помимо предоставления управляемого частного реестра, Azure Container Registry поддерживает [основную аутентификацию служб](../container-registry/container-registry-authentication.md) через Azure Active Directory для основных потоков аутентификации. Эта аутентификация включает в себя ролевой доступ только для чтения (тянуть), писать (толчок) и другие разрешения.

### <a name="monitor-and-scan-container-images"></a>Мониторинг и сканирование изображений контейнеров

Воспользуйтесь преимуществами решений для сканирования изображений контейнеров в частном реестре и выявления потенциальных уязвимостей. Важно понимать глубину обнаружения угроз, которую обеспечивают различные решения.

Например, реестр контейнеров Azure дополнительно [интегрируется с Центром безопасности Azure](../security-center/azure-container-registry-integration.md) для автоматического сканирования всех изображений Linux, отодвинутых в реестр. Интегрированный сканер Azure Security Center в Цилисе обнаруживает уязвимости изображений, классифицирует их и дает рекомендации по исправлению положения.

Решения для мониторинга безопасности и сканирования изображений, такие как [Twistlock](https://azuremarketplace.microsoft.com/marketplace/apps/twistlock.twistlock?tab=Overview) и [Aqua Security,](https://azuremarketplace.microsoft.com/marketplace/apps/aqua-security.aqua-security?tab=Overview) также доступны через Azure Marketplace.  

### <a name="protect-credentials"></a>Защита учетных данных

Контейнеры могут распространяться по нескольким кластерам и регионам Azure. Таким образом, необходимо обеспечить учетные данные, необходимые для доступа к логиням или API, такие как пароли или токены. Убедитесь, что только привилегированные пользователи могут получить доступ к этим контейнерам в пути и в состоянии покоя. Инвентаризация всех секретов учетных данных, а затем требовать от разработчиков использовать новые инструменты управления секретами, которые предназначены для контейнерных платформ.  Убедитесь, что ваше решение включает в себя зашифрованные базы данных, шифрование TLS для данных секретов в пути и наименее привилегированный [элемент управления доступом.](../role-based-access-control/overview.md) [Azure Key Vault](../key-vault/key-vault-secure-your-key-vault.md) — это облачный сервис, который защищает ключи шифрования и секреты (например, сертификаты, строки подключения и пароли) для контейнерных приложений. Поскольку эти данные являются конфиденциальными и критически важными для бизнеса, безопасный доступ к хранилищам ключей, чтобы только авторизованные приложения и пользователи могли получить к ним доступ.

## <a name="considerations-for-the-container-ecosystem"></a>Рассмотрение контейнерной экосистемы

Следующие меры безопасности, хорошо реализованные и эффективно управляемые, помогут вам защитить и защитить экосистему контейнеров. Эти меры применяются на протяжении всего жизненного цикла контейнера, от разработки до развертывания производства и для целого ряда контейнерных оркестровщиков, хостов и платформ. 

### <a name="use-vulnerability-management-as-part-of-your-container-development-lifecycle"></a>Используйте управление уязвимостями как часть жизненного цикла разработки контейнеров 

Используя эффективное управление уязвимостями на протяжении всего жизненного цикла разработки контейнеров, вы повышаете вероятность того, что вы идентифицируете и решаете проблемы безопасности, прежде чем они станут более серьезной проблемой. 

### <a name="scan-for-vulnerabilities"></a>Сканирование уязвимостей 

Постоянно обнаруживаются новые уязвимости, поэтому сканирование и выявление уязвимостей — это непрерывный процесс. Включите сканирование уязвимости на протяжении всего жизненного цикла контейнера:

* В качестве окончательной проверки в конвейере разработки следует выполнить сканирование уязвимости на контейнерах, прежде чем выдвигать изображения в публичный или частный реестр. 
* Продолжайте сканировать изображения контейнеров в реестре как для выявления каких-либо недостатков, которые были каким-то образом упущены во время разработки, так и для устранения любых вновь обнаруженных уязвимостей, которые могут существовать в коде, используемом в изображениях контейнеров.  

### <a name="map-image-vulnerabilities-to-running-containers"></a>Карта уязвимостей изображения для запущенных контейнеров 

Необходимо иметь средства отображения уязвимостей, идентифицированных в контейнерных изображениях, для выполнения контейнеров, чтобы проблемы безопасности можно было смягчить или решить.  

### <a name="ensure-that-only-approved-images-are-used-in-your-environment"></a>Убедитесь, что в вашей среде используются только утвержденные изображения 

Там достаточно изменений и волатильности в контейнерной экосистемы, не позволяя неизвестных контейнеров, а также. Разрешить только утвержденные изображения контейнера. Используйте инструменты и процессы для мониторинга и предотвращения использования неодобренных изображений контейнеров. 

Эффективным способом уменьшения поверхности атаки и предотвращения ошибок в безопасности разработчиков является контроль потока изображений контейнеров в среду разработки. Например, можно санкционировать единое дистрибутив Linux в качестве базового изображения, предпочтительно бережливого (Alpine или CoreOS, а не Ubuntu), чтобы свести к минимуму поверхность для потенциальных атак. 

Подписание изображения или дактилоскопия может обеспечить цепочку хранения, которая позволяет проверить целостность контейнеров. Например, Azure Container Registry поддерживает модель доверия к [содержимому](https://docs.docker.com/engine/security/trust/content_trust) Docker, которая позволяет издателям изображений подписывать изображения, которые отодвигаются в реестр, а потребители изображений тянут только подписанные изображения.

### <a name="permit-only-approved-registries"></a>Разрешение только утвержденных реестров 

Расширение обеспечения того, чтобы ваша среда использует только утвержденные изображения, позволяет использовать только утвержденные реестры контейнеров. Требование использования утвержденных реестров контейнеров снижает риск, ограничивая возможность появления неизвестных уязвимостей или проблем безопасности. 

### <a name="ensure-the-integrity-of-images-throughout-the-lifecycle"></a>Обеспечить целостность изображений на протяжении всего жизненного цикла 

Одной из частей управления безопасностью на протяжении всего жизненного цикла контейнера является обеспечение целостности изображений контейнеров в реестре и при их изменении или развертывании в производство. 

* Изображения с уязвимостями, даже незначительными, не должны работать в производственной среде. В идеале все изображения, развернутые в производстве, должны быть сохранены в частном реестре, доступном для немногих избранных. Держите количество производственных изображений небольшим, чтобы гарантировать, что ими можно управлять эффективно.

* Поскольку трудно определить происхождение программного обеспечения из общедоступного изображения контейнера, создавайте изображения из источника, чтобы обеспечить знание происхождения слоя. Когда в автоматически созданном образе контейнера появляется уязвимость, клиенты могут достаточно быстро устранить эту проблему. С изображением общего имиджа, клиенты должны найти корень публичного изображения, чтобы исправить это или получить другое безопасное изображение от издателя. 

* Тщательно отсканированное изображение, развернутое в производстве, не гарантируется для актуальности в течение всего срока службы приложения. Вы можете получить сообщения об уязвимостях системы безопасности для слоев образа, с которыми вы не сталкивались ранее или которые были представлены после развертывания в рабочей среде. 

  Периодически проверяйте изображения, развернутые в производстве, для идентификации изображений, которые устарели или не обновлялись в течение некоторого времени. Можно использовать сине-зеленые методологии развертывания и механизмы обновления подвижного состава для обновления изображений контейнеров без простоев. Вы можете сканировать изображения с помощью инструментов, описанных в предыдущем разделе. 

* Используйте конвейер непрерывной интеграции (CI) с интегрированным сканированием безопасности для создания безопасных изображений и включения их в свой частный реестр. Сканирование уязвимостей, встроенное в решение непрерывной интеграции, обеспечивает отправку прошедших все проверки образов в частный реестр, из которого развертываются производственные рабочие нагрузки. 

  Сбой конвейера CI гарантирует, что уязвимые изображения не будут перемещены в частный реестр, который используется для развертывания рабочей нагрузки производства. Он также автоматизирует сканирование безопасности изображения, если есть значительное количество изображений. Выполнение аудита образов вручную для обнаружения уязвимостей системы безопасности очень долгий процесс, подверженный ошибкам. 

### <a name="enforce-least-privileges-in-runtime"></a>Обеспечить соблюдение наименьших привилегий во времени выполнения 

Концепция наименьших привилегий является основной наилучшей практикой безопасности, которая также применяется к контейнерам. При использовании уязвимости она обычно предоставляет злоумышленнику доступ и привилегии, равные скомпрометированным приложениям или процессу. Обеспечение того, чтобы контейнеры работали с самыми низкими привилегиями и доступом, необходимыми для выполнения работы, снижает риск. 

### <a name="reduce-the-container-attack-surface-by-removing-unneeded-privileges"></a>Уменьшение поверхности атаки контейнера путем удаления ненужных привилегий 

Можно также свести к минимуму потенциальную поверхность атаки, удалив из времени выполнения контейнера любые неиспользованные или ненужные процессы или привилегии. Привилегированные контейнеры работают как корень. Если вредоносный пользователь или рабочая нагрузка ускользает в привилегированном контейнере, контейнер будет работать как корень в этой системе.

### <a name="preapprove-files-and-executables-that-the-container-is-allowed-to-access-or-run"></a>Предварительно едкие файлы и исполнители, к которым контейнеру разрешен доступ или запуск 

Уменьшение количества переменных или неизвестных помогает поддерживать стабильную и надежную среду. Ограничение контейнеров, чтобы они могли получить доступ или запустить только предварительно утвержденных или safelisted файлов и исполнителей является проверенным методом ограничения подверженности риску.  

Гораздо проще управлять списком safelist, когда он реализован с самого начала. Безопасный список обеспечивает меру контроля и управляемости, как вы узнаете, какие файлы и исполняемые данные необходимы для приложения, чтобы функционировать правильно. 

Безопасный список не только уменьшает поверхность атаки, но также может обеспечить базовый уровень аномалий и предотвратить случаи использования сценариев «шумного соседа» и контейнера. 

### <a name="enforce-network-segmentation-on-running-containers"></a>Обеспечить сегментацию сети на беговых контейнерах  

Чтобы защитить контейнеры в одной подсети от рисков безопасности в другой подсети, поддерживайте сегментацию сети (или наносегментацию) или сегрегацию между бегущими контейнерами. Поддержание сегментации сети может также потребоваться для использования контейнеров в отраслях, которые необходимы для выполнения требований по соблюдению.  

Например, партнерский инструмент [Aqua](https://azuremarketplace.microsoft.com/marketplace/apps/aqua-security.aqua-security?tab=Overview) обеспечивает автоматизированный подход к наносегментации. Aqua отслеживает деятельность контейнерной сети во время выполнения. Он определяет все входящие и исходящие сетевые соединения в /из других контейнеров, услуг, IP-адресов и общедоступный Интернет. Наносегментация автоматически создается на основе контролируемого трафика. 

### <a name="monitor-container-activity-and-user-access"></a>Мониторинг активности контейнеров и доступа пользователей 

Как и в любой ИТ-среде, необходимо постоянно отслеживать активность и доступ пользователей к экосистеме контейнеров, чтобы быстро выявлять любые подозрительные или вредоносные действия. Azure предоставляет решения для мониторинга контейнеров, в ключая:

* [Azure Monitor для контейнеров](../azure-monitor/insights/container-insights-overview.md) отслеживает производительность рабочих нагрузок, развернутых в средах Kubernetes, размещенных в службе Azure Kubernetes Service (AKS). С помощью Azure Monitor для контейнеров можно отслеживать производительность, собирая данные метрик памяти и процессора из контроллеров, узлов и контейнеров, доступных в Kubernetes, используя API метрик. 

* [Решение Azure Container Monitoring](../azure-monitor/insights/containers.md) помогает просматривать и управлять другими хостами контейнеров Docker и Windows в одном месте. Пример:

  * Просмотр подробной информации о аудите, отображаемых команд, используемых с контейнерами. 
  * Устранение неполадок контейнеров путем просмотра и поиска централизованных журналов без удаленного просмотра узлов Docker или Windows.  
  * Найдите контейнеры, которые могут быть шумными и потреблять избыточные ресурсы на хосте.
  * Просмотр централизованного процессора, памяти, хранения и информации об использовании сети и производительности контейнеров.  

  Решение поддерживает контейнерные оркестровщики, включая Docker Swarm, DC/OS, неуправляемые Kubernetes, Service Fabric и Red Hat OpenShift. 

### <a name="monitor-container-resource-activity"></a>Мониторинг активности контейнерных ресурсов 

Мониторинг активности ресурсов, таких как файлы, сеть и другие ресурсы, к которым они обращаются. Мониторинг активности и потребления ресурсов полезен как для мониторинга производительности, так и в качестве меры безопасности. 

[Azure Monitor](../azure-monitor/overview.md) позволяет осуществлять основной мониторинг служб Azure, позволяя собирать метрики, журналы активности и диагностические журналы. Например, журнал действий содержит сведения о создании ресурсов или их изменении. 

  Доступны метрики, которые предоставляют статистику производительности разных ресурсов, а также операционной системы в виртуальной машине. Вы можете просмотреть эти данные с помощью нескольких инструментов на портале Azure, а также создать предупреждения на базе этих метрик. Azure Monitor гарантирует самую высокую скорость конвейера метрик (до 5 минут или даже до 1 минуты), и мы рекомендуем использовать его для оповещений и уведомлений, для которых время критически важно. 

### <a name="log-all-container-administrative-user-access-for-auditing"></a>Войти все контейнер административного доступа пользователя для аудита 

Поддерживайте точный аудит административного доступа к контейнерной экосистеме, включая кластер Kubernetes, реестр контейнеров и изображения контейнеров. Эти журналы могут быть необходимы для целей аудита и будут полезны в качестве судебно-медицинских доказательств после любого инцидента безопасности. Решения Azure включают в себя:

* [Интеграция службы Azure Kubernetes с Центром безопасности Azure](../security-center/azure-kubernetes-service-integration.md) для мониторинга конфигурации кластерной среды и выработки рекомендаций по безопасности
* [Решение для мониторинга контейнеров Azure](../azure-monitor/insights/containers.md)
* Журналы ресурсов для [экземпляров контейнеров Azure](container-instances-log-analytics.md) и [реестр контейнеров Azure](../container-registry/container-registry-diagnostics-audit-logs.md)

## <a name="next-steps"></a>Дальнейшие действия

* Подробнее об использовании [Центра безопасности Azure](../security-center/container-security.md) для обнаружения угроз в реальном времени в контейнерных средах.

* Подробнее об управлении уязвимостями контейнеров с помощью решений [twistlock](https://www.twistlock.com/solutions/microsoft-azure-container-security/) и [Aqua Security.](https://www.aquasec.com/solutions/azure-container-security/)