---
title: Управление интересами для взаимодействия с клиентами Dynamics 365 | Azure Marketplace
description: Настройка управления интересами для служб взаимодействия с клиентами Dynamics 365.
author: qianw211
ms.service: marketplace
ms.subservice: partnercenter-marketplace-publisher
ms.topic: conceptual
ms.date: 03/30/2020
ms.author: dsindona
ms.openlocfilehash: b9158f7b2e3fc73a2fe2a9b20ead2558b7467f6f
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "82131060"
---
# <a name="configure-lead-management-for-dynamics-365-customer-engagement"></a>Настройка управления интересами для служб взаимодействия с клиентами Dynamics 365

В этой статье описывается, как настроить взаимодействие с клиентом Dynamics 365 (ранее называлось Dynamics CRM Online). Дополнительные сведения об изменениях см. в статье [Настройка серверной проверки подлинности с участием клиентов и SharePoint Online](https://docs.microsoft.com/dynamics365/customerengagement/on-premises/admin/on-prem-server-based-sharepoint-online) для обработки интересов продаж из предложения коммерческого рынка.

>[!NOTE]
>Эти инструкции относятся только к облачной среде, размещенной корпорацией Майкрософт, для участия клиентов Dynamics 365. Прямое подключение к локальной среде Dynamics в настоящее время не поддерживается. Существуют и другие варианты получения интересов, таких как настройка [конечной точки HTTPS](./commercial-marketplace-lead-management-instructions-https.md) или [таблицы Azure](./commercial-marketplace-lead-management-instructions-azure-table.md).

## <a name="prerequisites"></a>Предварительные условия

Для выполнения действий, описанных в этой статье, необходимы следующие разрешения пользователя. Для этого необходимо:

* Быть администратором экземпляра взаимодействия с клиентами Dynamics 365, чтобы иметь возможность установить решение и выполнить следующие инструкции.
* Будьте администратор клиента, чтобы создать новую учетную запись службы для службы интересов, которая будет использоваться для отправки интересов из коммерческих решений Marketplace.
* Доступ к порталу администрирования Office 365.
* Иметь доступ к портал Azure.

## <a name="install-the-solution"></a>Установка решения

1. Скачайте [Microsoft Marketplace решение для записи интересов](https://mpsapiprodwus.blob.core.windows.net/documentation/MicrosoftMarketplacesLeadIntegrationSolution_1_0_0_0_target_CRM_6.1_managed.zip)и сохраните его локально на своем компьютере.

1. Откройте компонент "взаимодействие с клиентами Dynamics 365", перейдя по URL-адресу `https://tenant.crm.dynamics.com`экземпляра Dynamics, например.

1. Щелкните значок шестеренки на верхней панели и выберите **Дополнительные параметры**.
 
    ![Пункт меню дополнительных параметров Dynamics 365](./media/commercial-marketplace-lead-management-instructions-dynamics/dynamics-advanced-settings.png)

1. На странице **Параметры** откройте меню **Параметры** на верхней панели и выберите **решения**.

    >[!NOTE]
    >Если вы не видите параметры на следующем экране, у вас нет необходимых разрешений для продолжения. Обратитесь к администратору в экземпляре взаимодействия с клиентом Dynamics 365.

    ![Вариант решения Dynamics 365](./media/commercial-marketplace-lead-management-instructions-dynamics/dynamics-solutions.png)

1. На странице **решения** выберите **Импорт** и перейдите к месту, где вы сохранили **Microsoft Marketplace решение для записи интересов** , скачанное на шаге 1.

    ![Кнопка «Импорт»](./media/commercial-marketplace-lead-management-instructions-dynamics/dynamics-crm-import.png)

1. Завершите импорт решения, следуя мастеру импорта решений.

## <a name="configure-user-permissions"></a>Настройка разрешений пользователя

Чтобы написать интересы в экземпляре взаимодействия с клиентом Dynamics 365, необходимо предоставить учетной записи службы корпорации Майкрософт и настроить разрешения для учетной записи.

Чтобы создать учетную запись службы и назначить ей разрешения, выполните описанные ниже действия. Можно использовать Azure Active Directory или Office 365.

>[!NOTE]
>Перейдите к соответствующим инструкциям в зависимости от выбранного варианта проверки подлинности. См. статью [Azure Active Directory](https://docs.microsoft.com/azure/marketplace/partner-center-portal/commercial-marketplace-lead-management-instructions-dynamics#azure-active-directory) или [Office 365](https://docs.microsoft.com/azure/marketplace/partner-center-portal/commercial-marketplace-lead-management-instructions-dynamics#office-365).

### <a name="azure-active-directory"></a>Azure Active Directory

Мы рекомендуем использовать этот вариант, так как вам никогда не нужно обновлять имя пользователя или пароль для получения интересов. Чтобы использовать параметр Azure Active Directory, укажите идентификатор приложения, ключ приложения и идентификатор каталога из приложения Active Directory.

Настройка Azure Active Directory для служб взаимодействия с клиентами Dynamics 365:

1. Войдите на [портал Azure](https://portal.azure.com/). В области слева выберите **Azure Active Directory**.

1. Выберите **Свойства**и СКОПИРУЙТЕ значение **идентификатора каталога** на странице **свойства каталога** . Сохраните это значение, так как его необходимо предоставить на портале публикации, чтобы получить интересы для вашего предложения Marketplace.

    ![Пункт меню "свойства Azure Active Directory"](./media/commercial-marketplace-lead-management-instructions-dynamics/aad-properties.png)

1. Выберите **Регистрация приложений** на Azure Active Directory левой панели, а затем щелкните **Новая регистрация** на этой странице.
1. Введите понятное имя для имени приложения.
1. В разделе **Поддерживаемые типы учетных записей**выберите **учетные записи в любом организационном каталоге**.
1. В разделе **URI перенаправления (необязательно)** выберите **веб** и введите URI, например `https://contosoapp1/auth`. 
1. Выберите **Зарегистрировать**.

    ![Страница регистрации приложения](./media/commercial-marketplace-lead-management-instructions-dynamics/register-an-application.png)

1. Теперь, когда приложение зарегистрировано, обратитесь к странице обзора приложения. Скопируйте значение **идентификатора приложения (клиента)** на этой странице. Сохраните это значение, так как его необходимо предоставить на портале публикации и в Dynamics 365, чтобы получить интересы для вашего предложения Marketplace.

    ![Поле идентификатора приложения (клиента)](./media/commercial-marketplace-lead-management-instructions-dynamics/application-id.png)

1. Выберите **сертификаты & секреты** в левой области приложения и нажмите кнопку **создать секрет клиента** . Введите понятное описание секрета клиента и выберите параметр **никогда** в разделе **истечение срока действия**. Нажмите кнопку **Добавить** , чтобы создать секрет клиента.

    ![Пункт меню "сертификаты & секреты"](./media/commercial-marketplace-lead-management-instructions-dynamics/aad-certificates-secrets.png)

1. После успешного создания секрета клиента скопируйте значение **секрета клиента** . Вы не сможете получить значение после выхода из страницы. Сохраните это значение, так как его необходимо предоставить на портале публикации, чтобы получить интересы для вашего предложения Marketplace. 
1. Выберите **разрешения API** в левой области приложения, а затем выберите **+ Добавить разрешение**.
1. Выберите **API Майкрософт**, а затем выберите **Dynamics CRM** в качестве API.
1. В **каком типе разрешений требуется ваше приложение?** убедитесь, что выбраны **делегированные разрешения** . 
1. В разделе **разрешение**установите флажок **user_impersonation** для **доступа Common Data Service в качестве пользователей организации**. Нажмите кнопку **Добавить разрешения**.

    ![Кнопка "добавить разрешения"](./media/commercial-marketplace-lead-management-instructions-dynamics/api-permissions.png)

1. После выполнения шагов с 1 по 14 в портал Azure перейдите к экземпляру взаимодействия с клиентом Dynamics 365, перейдя по URL-адресу, `https://tenant.crm.dynamics.com`например.
1. Щелкните значок шестеренки на верхней панели и выберите **Дополнительные параметры**.
1. На странице **Параметры** откройте меню **Параметры** на верхней панели и выберите **Безопасность**.
1. На странице **Безопасность** выберите **Пользователи**. На странице **Пользователи** выберите раскрывающийся список **Включенные пользователи** , а затем выберите **Пользователи приложения**.
1. Нажмите **Создать**, чтобы создать пользователя. 

    ![Создание пользователя](./media/commercial-marketplace-lead-management-instructions-dynamics/application-users.png)

1. В области **создать пользователя** убедитесь, что выбран параметр **пользователь: пользователь приложения** . Укажите имя пользователя, полное имя и адрес электронной почты, которые будут использоваться для этого подключения. Кроме того, вставьте **идентификатор приложения** , созданного на портал Azure из шага 8. Нажмите кнопку **сохранить & закрыть** , чтобы завершить добавление пользователя.

    ![Новая область пользователя](./media/commercial-marketplace-lead-management-instructions-dynamics/new-user-info.png)

1. Перейдите к разделу "Параметры безопасности" в этой статье, чтобы завершить настройку подключения для этого пользователя.

### <a name="office-365"></a>Office 365

Если вы не хотите использовать Azure Active Directory, можно зарегистрировать нового пользователя в центре администрирования Microsoft 365. Чтобы продолжить получать интересы, вам потребуется обновить имя пользователя и пароль каждые 90 дней.

Чтобы настроить Office 365 для участия клиентов Dynamics 365, сделайте следующее:

1. Выполните вход в [центр администрирования Microsoft 365](https://admin.microsoft.com).

1. Нажмите **Добавить пользователя**.

    ![Microsoft 365 "добавить пользователя" в центре администрирования](./media/commercial-marketplace-lead-management-instructions-dynamics/ms-365-add-user.png)

1. Создайте пользователя для службы модуля записи интересов. Настройте следующие параметры.

    * Введите имя пользователя.
    * Введите пароль и снимите флажок **сделать этот пользователь сменой пароля при первом входе** .
    * Выберите **пользователь (нет прав администратора)** в качестве роли для пользователя.
    * В качестве лицензии на продукт выберите **Dynamics 365 "план взаимодействия клиентов** ", как показано на следующем снимке экрана. За выбранную лицензию будет начисляться плата. 

Сохраните эти значения, так как вам потребуется указать значения **имени пользователя** и **пароля** на портале публикации, чтобы получить интересы для вашего предложения Marketplace.

![Панель "новый пользователь" в центре администрирования Microsoft 365](./media/commercial-marketplace-lead-management-instructions-dynamics/ms-365-new-user.png)

## <a name="security-settings"></a>Параметры безопасности

Последним шагом является включение пользователя, созданного для записи интересов.

1. Откройте компонент "взаимодействие с клиентами Dynamics 365", перейдя по URL-адресу `https://tenant.crm.dynamics.com`экземпляра Dynamics, например.
1. Щелкните значок шестеренки на верхней панели и выберите **Дополнительные параметры**.
1. На странице **Параметры** откройте меню **Параметры** на верхней панели и выберите **Безопасность**.
1. На странице **Безопасность** выберите **Пользователи** и выберите пользователя, созданного в разделе "Настройка разрешений пользователей" этого документа. Затем выберите **Управление ролями**. 

    ![Вкладка «Управление ролями»](./media/commercial-marketplace-lead-management-instructions-dynamics/security-manage-roles.png)

1. Найдите имя роли **Microsoft Marketplace модуль записи интересов**и выберите его, чтобы назначить пользователю роль.

    ![Панель "Управление ролями пользователей"](./media/commercial-marketplace-lead-management-instructions-dynamics/security-manage-user-roles.png)

    >[!NOTE]
    >Эту роль создало импортированное решение, и ей предоставлены разрешения только на запись данных о потенциальных клиентах и на отслеживание версии решения для обеспечения совместимости.

1. Вернитесь на страницу **Безопасность** и выберите **роли безопасности**. Найдите роль **Microsoft Marketplace модуль записи интересов**и выберите ее.

    ![Панель «роли безопасности»](./media/commercial-marketplace-lead-management-instructions-dynamics/security-roles.png)

1. В роли безопасность перейдите на вкладку **основные записи** . Найдите элемент **Параметры пользовательского интерфейса сущности пользователя** . Включите разрешения на создание, чтение и запись для пользователя (1/4 желтого круга) для этой сущности, щелкнув один раз в каждом из соответствующих кругов.

    ![Вкладка "основные записи" Microsoft Marketplace модуля записи интересов](./media/commercial-marketplace-lead-management-instructions-dynamics/marketplace-lead-writer.png)

1. На вкладке **Настройка** найдите элемент **системное задание** . Включите разрешения чтение, запись и Аппендто для организации (сплошные зеленые кружки) для этой сущности, щелкнув четыре раза в каждом из соответствующих кругов.

    ![Microsoft Marketplace вкладку настройки модуля записи интересов](./media/commercial-marketplace-lead-management-instructions-dynamics/marketplace-lead-writer-customization.png)

1. Нажмите кнопку **сохранить и закрыть**.

## <a name="configure-your-offer-to-send-leads-to-dynamics-365-customer-engagement"></a>Настройка предложения для отправки интересов в службу "участие клиентов Dynamics 365" 

Чтобы настроить данные управления интересами для вашего предложения на портале публикации, выполните следующие действия.

1. Перейдите на страницу **настройки предложения** для вашего предложения.
1. Выберите **Подключиться** в разделе **управление интересами** .

    ![Кнопка подключения раздела управления интересами](./media/commercial-marketplace-lead-management-instructions-dynamics/connect-lead-management.png)

1. Во всплывающем окне сведения о подключении выберите **Dynamics 365** взаимодействие с клиентом для назначения интереса.

    ![Поле назначения интереса](./media/commercial-marketplace-lead-management-instructions-dynamics/connection-details-lead-destination.png)

1. Введите **URL-адрес** для экземпляра Dynamics 365, например `https://contoso.crm4.dynamics.com`.

1. Выберите метод **проверки подлинности**: Azure Active Directory или Office 365. 
1. Если вы выбрали **Azure Active Directory**, введите **идентификатор приложения** (например, `23456052-aaaa-bbbb-8662-1234df56788f`), **идентификатор каталога** (например `12345678-8af1-4asf-1234-12234d01db47`,) и **секрет клиента** (например, `1234ABCDEDFRZ/G/FdY0aUABCEDcqhbLn/ST122345nBc=`).

    ![Проверка подлинности с выбранным Azure Active Directory](./media/commercial-marketplace-lead-management-instructions-dynamics/connection-details-application-id.png)

1. Если вы выбрали **Office 365**, введите **имя пользователя** (например, `contoso@contoso.onmicrosoft.com`) и **пароль** (например, `P@ssw0rd`).

    ![Поле имени пользователя Office 365](./media/commercial-marketplace-lead-management-instructions-dynamics/connection-details-authentication.png)

1. В качестве **контактного сообщения электронной почты**введите адреса электронной почты сотрудников компании, которые должны получать уведомления по электронной почте при получении нового интереса. Можно ввести несколько адресов электронной почты, разделяя их точкой с запятой.
1. Нажмите кнопку **OK**.

Чтобы убедиться, что вы успешно подключились к цели назначения, нажмите кнопку **проверить** . В случае успеха вы получите руководителя тестирования в целевом месте назначения.

![Поле "контактный адрес электронной почты"](./media/commercial-marketplace-lead-management-instructions-dynamics/dynamics-connection-details.png)

>[!NOTE]
>Необходимо завершить настройку остальной части предложения и опубликовать его, прежде чем вы сможете получить интересы для предложения.
