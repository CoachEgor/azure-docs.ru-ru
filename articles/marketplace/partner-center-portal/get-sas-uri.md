---
title: Получение URI подписанного URL для образа виртуальной машины | Azure Marketplace
description: В этой статье объясняется, как получить URI подписанного URL-адрес (SAS) для каждого виртуального жесткого диска (VHD).
author: anbene
ms.service: marketplace
ms.subservice: partnercenter-marketplace-publisher
ms.topic: conceptual
ms.date: 04/09/2020
ms.author: mingshen
ms.openlocfilehash: c226d35647e4a5a2b1d583dd6328bfb73dae2a1c
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "81732638"
---
# <a name="get-shared-access-signature-uri-for-your-vm-image"></a>Получение универсального кода ресурса (URI) подписанного URL-адреса для образа виртуальной машины

> [!IMPORTANT]
> Мы переносим Управление предложениями виртуальной машины Azure из Портал Cloud Partner в центр партнеров. Пока ваши предложения не будут перенесены, следуйте инструкциям в разделе [Получение URI подписанного общего доступа для образа виртуальной машины](https://docs.microsoft.com/azure/marketplace/cloud-partner-portal/virtual-machine/cpp-get-sas-uri) , чтобы портал Cloud Partner для управления вашими предложениями.

В этой статье описывается, как создать универсальный код ресурса (URI) для подписи общего доступа (SAS) для каждого виртуального жесткого диска.

Во время процесса публикации необходимо предоставить универсальный код ресурса (URI) для каждого виртуального жесткого диска, связанного с планами. Эти планы ранее назывались номерами SKU или единицами хранения. Майкрософт понадобится доступ к этим дискам во время сертификации. Этот универсальный код ресурса (URI) вводится на вкладке **планы** в центре партнеров.

При создании URI SAS для виртуальных жестких дисков выполните следующие требования:

* поддерживаются только неуправляемые виртуальные жесткие диски;
* Требуются `List` только `Read` разрешения и. Не предоставлять доступ на запись или удаление.
* длительность предоставления доступа (до даты окончания срока действия) должна составлять не менее трех недель с момента создания URI SAS;
* Чтобы защититься от изменений времени в формате UTC, установите дату начала в один день до текущей даты. Например, если текущая дата — 6 октября 2019 г., выберите 10/5/2019.

## <a name="generate-the-sas-address"></a>Создание адреса SAS

Существует два стандартных средства, используемых для создания адреса SAS (URL):

* **Microsoft Обозреватель службы хранилища** — графическое средство, доступное для Windows, MacOS и Linux.
* **Microsoft Azure CLI** — рекомендуется для операционных систем, отличных от Windows, и для сред автоматической или непрерывной интеграции.

### <a name="use-microsoft-storage-explorer"></a>Использование Обозреватель службы хранилища Майкрософт

1. Скачайте и установите [Обозреватель службы хранилища Microsoft Azure](https://azure.microsoft.com/features/storage-explorer/).
2. Откройте обозреватель и в меню слева выберите **Добавить учетную запись**. Откроется диалоговое окно **Подключение к службе хранилища Azure** .
3. Выберите **Добавить учетную запись Azure** , а затем **выполните вход**. Выполните необходимые действия для входа в учетную запись Azure.
4. В левой области**обозревателя** перейдите к **учетным записям хранения** и разверните узел.
5. Щелкните правой кнопкой мыши виртуальный жесткий диск и выберите **получить подпись общего доступа**.
6. Откроется диалоговое окно **подпись общего доступа** . Заполните следующие поля.

    * **Время начала** — Дата начала разрешения для доступа к виртуальному жесткому диску. Укажите дату на день раньше текущей даты.
    * **Время окончания срока действия** — срок действия разрешения для доступа к виртуальному жесткому диску. Укажите дату по крайней мере за три недели после текущей даты.
    * **Разрешения** — выберите разрешения чтение и список.
    * **Уровень контейнера** — установите флажок **создать URI подписи общего доступа на уровне контейнера** .

        :::image type="content" source="media/create-sas-uri-storage-explorer.png" alt-text="Показывает диалоговое окно подписи общего доступа":::

7. Чтобы создать связанный URI SAS для этого виртуального жесткого диска, нажмите кнопку **создать**. Диалоговое окно обновляется и отображает сведения об этой операции.
8. Скопируйте **универсальный код ресурса (URI)** и сохраните его в текстовом файле в безопасном месте.

    :::image type="content" source="media/create-sas-uri-shared-access-signature-details.png" alt-text="Показывает поле сведений о подписанном общем доступе":::

    Этот созданный URI SAS предназначен для доступа на уровне контейнера. Чтобы сделать его специфическим, измените текстовый файл, добавив имя виртуального жесткого диска (следующий шаг).

9. Вставьте имя виртуального жесткого диска после строки VHD в URI SAS (добавьте косую черту). Окончательный URI SAS должен выглядеть следующим образом:

    `<blob-service-endpoint-url> + /vhds/ + <vhd-name>? + <sas-connection-string>`Например, если имя ВДХ имеет `TestRGVM2.vhd`значение, то полученный URI SAS будет выглядеть следующим образом:

    `https://catech123.blob.core.windows.net/vhds/TestRGVM2.vhd?st=2018-05-06T07%3A00%3A00Z&se=2019-08-02T07%3A00%3A00Z&sp=rl&sv=2017-04-17&sr=c&sig=wnEw9RfVKeSmVgqDfsDvC9IHhis4x0fc9Hu%2FW4yvBxk%3D`

10. Повторите эти действия для каждого виртуального жесткого диска в планах, которые будут опубликованы.

### <a name="using-azure-cli"></a>Использование Azure CLI

1. Скачайте и установите [Microsoft Azure CLI](https://azure.microsoft.com/documentation/articles/xplat-cli-install/). Доступны версии для macOS, Windows и различных дистрибутивов Linux.
2. Создайте файл PowerShell (расширение PS1), скопируйте в следующий код, а затем сохраните его локально.

    ```PowerShell
    az storage container generate-sas --connection-string 'DefaultEndpointsProtocol=https;AccountName=<account-name>;AccountKey=<account-key>;EndpointSuffix=core.windows.net' --name <vhd-name> --permissions rl --start '<start-date>' --expiry '<expiry-date>'
    ```

3. Измените файл, чтобы использовать следующие значения параметров. Укажите даты в формате UTC DateTime, например `2020-04-01T00:00:00Z`.

    * `<account-name>`— Имя учетной записи хранения Azure;
    * `<account-key>`— Ключ учетной записи хранения Azure;
    * `<vhd-name>`— Имя виртуального жесткого диска;
    * `<start-date>`— Дата начала разрешения для доступа к виртуальному жесткому диску. Укажите дату на день раньше текущей даты.
    * `<expiry-date>`— Срок действия разрешения для доступа к виртуальному жесткому диску. Укажите дату не менее трех недель после текущей даты.

    В этом примере показаны правильные значения параметров (на момент написания этой статьи):

    ```PowerShell
    az storage container generate-sas --connection-string 'DefaultEndpointsProtocol=https;AccountName=st00009;AccountKey=6L7OWFrlabs7Jn23OaR3rvY5RykpLCNHJhxsbn9ONc+bkCq9z/VNUPNYZRKoEV1FXSrvhqq3aMIDI7N3bSSvPg==;EndpointSuffix=core.windows.net' --name vhds --permissions rl --start '2020-04-01T00:00:00Z' --expiry '2021-04-01T00:00:00Z'
    ```

4. Сохраните изменения.
5. Используя один из следующих методов, запустите этот сценарий с правами администратора, чтобы создать **строку подключения SAS** для доступа на уровне контейнера.

    * Запуск скрипта из консоли. В Windows щелкните скрипт правой кнопкой мыши и выберите **Запуск от имени администратора**.
    * Запустите скрипт из редактора скриптов PowerShell, например [интегрированной среды сценариев Windows PowerShell](https://docs.microsoft.com/powershell/scripting/components/ise/introducing-the-windows-powershell-ise). На этом экране показано создание строки подключения SAS в этом редакторе:

     :::image type="content" source="media/create-sas-uri-power-shell-ise.png" alt-text="Иллюстрирует создание строки подключения SAS с помощью интегрированной среды сценариев Windows PowerShell":::

6. Скопируйте строку подключения SAS и сохраните ее в текстовом файле в безопасном месте. Измените эту строку, чтобы добавить сведения о расположении виртуального жесткого диска для создания окончательного URI SAS.
7. В портал Azure перейдите к хранилищу BLOB-объектов, содержащему виртуальный жесткий диск, связанный с новым URI.
8. Скопируйте URL-адрес **конечной точки службы больших двоичных объектов**, как показано на следующем снимке экрана.

    :::image type="content" source="media/create-sas-uri-blob-endpoint.png" alt-text="Иллюстрируется конечная точка службы BLOB-объектов":::

9. Измените текстовый файл, добавив строку подключения SAS, полученную на шаге 6. Создайте полный URI SAS в следующем формате:

    `<blob-service-endpoint-url> + /vhds/ + <vhd-name>? + <sas-connection-string>`

    Например, если имя виртуального жесткого диска — `TestRGVM2.vhd`, URI SAS будет следующим:

    `https://catech123.blob.core.windows.net/vhds/TestRGVM2.vhd?st=2018-05-06T07%3A00%3A00Z&se=2019-08-02T07%3A00%3A00Z&sp=rl&sv=2017-04-17&sr=c&sig=wnEw9RfVKeSmVgqDfsDvC9IHhis4x0fc9Hu%2FW4yvBxk%3D`

Повторите эти шаги для каждого виртуального жесткого диска в публикуемом номере SKU.

## <a name="verify-the-sas-uri"></a>Проверка URI SAS

Проверьте каждый созданный URI SAS, используя следующий контрольный список, чтобы убедиться в следующем.

* URI выглядит следующим образом:`<blob-service-endpoint-url>` + `/vhds/` + `<vhd-name>?` + `<sas-connection-string>`
* URI включает имя файла образа VHD, включая расширение имени файла. VHD.
* `sp=rl`отображается около середины URI. Эта строка показывает, `Read` что `List` доступ и указан.
* Когда `sr=c` отображается, это означает, что доступ на уровне контейнера указан.
* Скопируйте и вставьте универсальный код ресурса (URI) в браузер, чтобы проверить скачивание большого двоичного объекта (можно отменить операцию до завершения скачивания).

## <a name="next-step"></a>Дальнейшие действия

Если у вас возникли трудности при создании URI SAS, см. раздел [распространенные проблемы с URL-адресами SAS](https://docs.microsoft.com/azure/marketplace/partner-center-portal/common-sas-uri-issues). В противном случае сохраните URI SAS в надежном расположении для последующего использования. Он потребуется вам для публикации предложения виртуальной машины в центре партнеров.

* [Создание предложения по виртуальным машинам Azure](https://docs.microsoft.com/azure/marketplace/partner-center-portal/azure-vm-create-offer)
