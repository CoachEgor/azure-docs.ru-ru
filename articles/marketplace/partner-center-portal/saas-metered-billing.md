---
title: Оплата с оплатой с использованием службы измерения Marketplace | Azure Marketplace
description: Эта документация представляет собой руководство для независимых продавцов по публикации предложений SaaS с гибкими моделями выставления счетов.
author: MaggiePucciEvans
manager: evansma
ms.author: evansma
ms.service: marketplace
ms.subservice: partnercenter-marketplace-publisher
ms.topic: conceptual
ms.date: 07/10/2019
ms.openlocfilehash: f1b60831e08383ee455cd3afbfbc21ed27445ffc
ms.sourcegitcommit: 014e916305e0225512f040543366711e466a9495
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/14/2020
ms.locfileid: "75934173"
---
# <a name="metered-billing-using-the-marketplace-metering-service"></a>Расчет с оплатой с использованием службы измерения Marketplace

С помощью службы измерения Marketplace вы можете создавать предложения программного обеспечения как услуги (SaaS) в программе коммерческого рынка, которые начисляются в соответствии с нестандартными единицами.  Перед публикацией этого предложения необходимо определить такие измерения выставления счетов, как пропускная способность, билеты или сообщения электронной почты.  Клиенты затем платят в соответствии с их потреблением, и ваша система сообщает корпорации Майкрософт через API-интерфейс службы измерения рынка для оплаты событий по мере их возникновения.  

## <a name="prerequisites-for-metered-billing"></a>Предварительные требования для тарифного счета

Чтобы предложение SaaS использовало лимитное выставление счетов, оно должно:

* Выполните все требования предложения по [продаже через предложение Майкрософт](https://docs.microsoft.com/azure/marketplace/partner-center-portal/create-new-saas-offer#sell-through-microsoft) , как описано в подокне [Создание предложения SaaS](https://docs.microsoft.com/azure/marketplace/partner-center-portal/create-new-saas-offer).
* Интегрируйтесь с [API-интерфейсами выполнения SaaS](https://docs.microsoft.com/azure/marketplace/partner-center-portal/pc-saas-fulfillment-api-v2) , чтобы клиенты могли подготавливать свое предложение и подключаться к нему.  
* Необходимо настроить для модели ценообразования с **фиксированной ставкой** для оплаты клиентов за вашу службу.  Измерения являются дополнительным расширением модели ценообразования с фиксированной ставкой. 
* Интеграция с [API-интерфейсами службы измерения Marketplace](./marketplace-metering-service-apis.md) для информирования Майкрософт о оплачиваемых событиях.

>[!Note]
>Служба измерения Marketplace доступна только для модели выставления счетов с фиксированной ставкой и не применяется к модели выставления счетов для каждого пользователя.

## <a name="how-metered-billing-fits-in-with-pricing"></a>Как взимается плата за использование с учетом цен

Когда дело доходит до определения предложения вместе с его моделями ценообразования, важно понимать иерархию предложений.

* Каждое предложение SaaS настраивается на продажу через корпорацию Майкрософт.  Этот параметр нельзя изменить после публикации предложения.
* Каждое предложение SaaS, настроенное для продажи в корпорации Майкрософт, может иметь один или несколько планов. Пользователь подписывается на предложение SaaS, но его можно приобрести в корпорации Майкрософт в контексте плана.
* С каждым планом связана модель ценообразования: **фиксированная ставка** или **на пользователя**. Все планы в предложении должны быть связаны с одной и той же моделью ценообразования. Например, не может быть предложения, в котором один из планов является моделью ценообразования с фиксированной ставкой, а другая — на модель ценообразования для каждого пользователя.
* В каждом плане, настроенном для модели выставления счетов с фиксированной ставкой, включена по крайней мере одна повторяющаяся плата (которая может быть $0):
    * Ежегодная **ежемесячная** плата: Фиксированная ежемесячная плата, которая предоплачена за ежемесячное повторение, когда пользователь приобретает план.
    * **Ежегодная годовая** плата: фиксированная ежегодная плата, которая предоплачена на ежегодном повторении, когда пользователь приобретает план.
* Кроме повторяющихся выплат, план также может включать дополнительные измерения, используемые для оплаты за использование, не включенные в фиксированную ставку.   Каждое измерение представляет оплачиваемую единицу, которую служба будет обмениваться данными с корпорацией Майкрософт с помощью [API службы измерения Marketplace](./marketplace-metering-service-apis.md).

## <a name="sample-offer"></a>Пример предложения

Например, contoso — это издатель с службой SaaS, именуемый Contoso Notification Services (CNS). CNS позволяет клиентам отправлять уведомления с помощью электронной почты или текста. Contoso регистрируется как издатель в центре партнеров, чтобы программа коммерческого рынка опубликовала предложения для клиентов Azure.  С параметром CNS связаны два плана, описанные ниже.

* Базовый план
    * Отправка 10000 сообщений электронной почты и 1000 за $0 в месяц
    * Свыше 10000 сообщений электронной почты, платите $1 за каждые 100 сообщений электронной почты
    * За пределами 1000, платите $0,02 для каждого текста
* План "Премиум"
    * Отправка 50000 и 10000 сообщений электронной почты за $350 в месяц
    * Свыше 50000 сообщений электронной почты, платите $0,5 за каждые 100 сообщений электронной почты
    * За пределами 10000, платите $0,01 для каждого текста

Клиент Azure, подписавшийся на службу CNS, сможет отправить включенное количество текста и сообщений электронной почты в месяц на основе выбранного плана.  Компания Contoso измеряет использование до входящего количества без отправки каких бы то ни было событий использования в корпорацию Майкрософт.  Когда клиенты потребляют больше, чем количество входящих, не нужно изменять планы или выполнять какие-либо другие действия.  Компания Contoso будет измерять превышение по сравнению с включенным количеством и приступить к передаче событий использования в корпорацию Майкрософт для дополнительного использования с помощью [API службы измерения Marketplace](./marketplace-metering-service-apis.md).  Корпорация Майкрософт, в свою очередь, будет взимать плату за дополнительное использование, указанную издателем.

## <a name="billing-dimensions"></a>Измерения выставления счетов

Измерения выставления счетов используются для связи с клиентом, как они выставляются за использование программного обеспечения, а также для передачи событий использования в корпорацию Майкрософт. Они определяются следующим образом:

* **Идентификатор измерения**: неизменяемый идентификатор, на который указывает ссылка при выдаче событий использования.
* **Имя измерения**: отображаемое имя, связанное с измерением, например "Отправленные текстовые сообщения".
* **Единица измерения**: Описание единицы оплаты, например "на текстовое сообщение" или "за 100 сообщений электронной почты".
* **Цена за единицу**: Цена за одну единицу измерения.  
* **Включаемое количество для ежемесячного выражения**: количество измерений, включаемых в месяц для клиентов, которые платите за период ежегодной ежемесячной оплаты, должно быть целым числом.
* **Включаемое количество для ежегодного выражения**: количество измерений, включаемых в месяц для клиентов, которые платите за период ежегодной оплаты, должно быть целым числом.

Измерения выставления счетов совместно используются во всех планах предложения.  Некоторые атрибуты применяются к измерению во всех планах, а другие атрибуты зависят от плана.

Атрибуты, определяющие само измерение, совместно используются во всех планах предложения.  Перед публикацией предложения изменения, внесенные в эти атрибуты из контекста любого плана, повлияют на определение измерения во всех планах.  После публикации предложения эти атрибуты больше не будут доступны для изменения.  Они перечислены ниже.

* Идентификатор
* Имя
* Единица измерения

Другие атрибуты измерения относятся к каждому плану и могут иметь разные значения из плана планирования.  Перед публикацией плана можно изменить эти значения, и только этот план будет затронуты.  После публикации плана эти атрибуты больше не будут доступны для изменения.  Они перечислены ниже.

* Цена за единицу
* Включаемое количество для ежемесячных клиентов 
* Включаемое количество для ежегодных клиентов 

Измерения также имеют два специальных понятия: «включено» и «бесконечное».

* **Включено** указывает, что этот план участвует в этом измерении.  Если вы создаете новый план, который не отправляет события использования на основе этого измерения, вы можете оставить этот параметр непроверенным.  Кроме того, все новые измерения, добавленные после первоначальной публикации плана, будут отображаться как "не включено" для уже опубликованного плана.  Отключенное измерение не будет отображаться ни в одном списке измерений для плана, видимого для клиентов.
* **Бесконечное**значение, представленное символом бесконечности "∞", указывает, что этот план участвует в этом измерении, но не измеряет использование этого измерения.  Если вы хотите сообщить клиентам, что функции, представленные этим измерением, включены в план, но без ограничения на использование.  Измерение с бесконечным использованием будет отображаться в списках измерений для плана, видимого для клиентов, с указанием, что плата за этот план никогда не будет взиматься.

>[!Note] 
>Следующие сценарии поддерживаются явно: <br> — Можно добавить новое измерение в новый план.  Новое измерение не будет включено для всех уже опубликованных планов. <br> — Можно опубликовать план с **фиксированной ставкой** без каких-либо измерений, добавить новый план и настроить новое измерение для этого плана. Новое измерение не будет включено для уже опубликованных планов.

## <a name="constraints"></a>Ограничения

### <a name="trial-behavior"></a>Поведение пробной версии

Выставление счетов с оплатой с помощью службы измерения Marketplace несовместимо с предложением бесплатной пробной версии.  Невозможно настроить план на использование как тарифного счета, так и бесплатной пробной версии.

### <a name="locking-behavior"></a>Режим блокировки

Поскольку измерение, используемое в службе измерения Marketplace, представляет собой представление о том, как клиент будет платить за службу, все сведения об измерении больше не будут доступны для изменения после его публикации.  Перед публикацией важно, чтобы измерения были полностью определены для плана.
  
После публикации предложения с измерением сведения на уровне предложения для этого измерения больше не могут быть изменены:

* Идентификатор
* Имя
* Единица измерения

После публикации плана сведения на уровне плана больше не могут быть изменены:

* Цена за единицу
* Включаемое количество для ежемесячного выражения
* Включаемое количество для годового срока
* Включено ли измерение для плана

### <a name="upper-limits"></a>Верхние пределы

Максимальное число измерений, которое можно настроить для одного предложения, составляет 18 уникальных измерений.

## <a name="get-support"></a>Получить поддержку

Если у вас есть одно из следующих действий, можно открыть запрос в службу поддержки.

* Технические проблемы с API службы измерения Marketplace.
* Проблема, которая должна быть передана из-за ошибки или ошибки на стороне пользователя (например, неверное событие использования.)
* Другие проблемы, связанные с лимитным выставленным счетом. 

Выполните следующие действия, чтобы отправить запрос в службу поддержки:

1. Перейдите на [страницу службы поддержки](https://support.microsoft.com/supportforbusiness/productselection?sapId=48734891-ee9a-5d77-bf29-82bf8d8111ff). Первые несколько раскрывающихся меню заполняются автоматически. Для поддержки Marketplace выявление семейства продуктов в качестве **облачных и веб-служб**, а также продукта в качестве **издателя Marketplace**.  Не изменяйте предварительно заполненные элементы раскрывающегося меню.
2. В разделе "выберите версию продукта" выберите **Управление Live Offer**.
3. В разделе "выберите категорию, которая лучше описывать эту ошибку" выберите **приложения SaaS**.
4. В разделе "выберите проблему, которая лучше описывает проблему" выберите **счет**с оплатой.
5. Нажимая кнопку " **Далее** ", вы направляетесь на страницу **сведений об ошибке** , где можно ввести дополнительные сведения о возникшей ошибке.

Дополнительные варианты поддержки издателя см. [в разделе Поддержка программы коммерческого рынка в центре партнеров](https://docs.microsoft.com/azure/marketplace/partner-center-portal/support) .

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения см. в статье [API-интерфейсы службы измерения Marketplace](./marketplace-metering-service-apis.md) .
