---
title: Вопросы и ответы по API службы контроля использования — коммерческий магазин Майкрософт
description: Часто задаваемые вопросы о API службы измерения для предложений SaaS в Microsoft AppSource и Azure Marketplace.
author: dsindona
ms.author: dsindona
ms.service: marketplace
ms.subservice: partnercenter-marketplace-publisher
ms.topic: conceptual
ms.date: 04/13/2020
ms.openlocfilehash: eb27089777baaaa7a29e020318fbc7635792af2d
ms.sourcegitcommit: c535228f0b77eb7592697556b23c4e436ec29f96
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2020
ms.locfileid: "82857895"
---
# <a name="marketplace-metering-service-apis---faq"></a>Вопросы и ответы об API-интерфейсах службы из Marketplace для контроля потребления

Когда пользователь Azure подписывается на службу SaaS, которая включает в себя лимитное выставление счетов, будет отслеживаться потребление для каждого измерения выставления счетов, используемого клиентом. Если потребление превышает включенное количество, установленное для выбранного клиентом термина, служба будет отправлять события использования в корпорацию Майкрософт.

## <a name="emit-usage-events"></a>Выдавать события использования

>[!Note]
>Этот раздел применим только к предложениям SaaS, в которых по крайней мере один из планов имеет измерения службы отслеживания, определенные во время публикации предложения.

![Выдавать события использования](media/isv-emits-usage-event.png)

Сведения о контракте API для выпуска событий использования см. в разделе [API событий использования пакетной службы SaaS](./marketplace-metering-service-apis.md#batch-usage-event) .

### <a name="how-often-is-it-expected-to-emit-usage"></a>Как часто ожидается вывод сведений об использовании?

В идеале предполагается, что использование будет выдаваться каждый час за последний час, только если используется предыдущий час.

### <a name="what-is-the-maximum-delay-between-the-time-an-event-occurs-and-the-time-a-usage-event-is-emitted-to-microsoft"></a>Какова максимальная задержка между временем возникновения события и временем выпуска события использования в корпорацию Майкрософт?

В идеале событие использования создается каждый час для событий, произошедших за последний час. Однако ожидается задержка. Максимально допустимая задержка составляет 24 часа, после чего события использования не будут приниматься.

Например, если событие использования происходит в 1 РМ в день, то в следующий день у вас будет до 1 PM для создания события использования, связанного с этим событием. Когда в системе используется время простоя, выполняется восстановление, а затем отправляется событие использования в течение часового интервала, в течение которого было применено, без потери точности.

### <a name="what-happens-when-you-send-more-than-one-usage-event-on-the-same-hour"></a>Что происходит при отправке нескольких событий использования на один час?

В течение часового интервала принимается только одно событие использования. Интервал времени начинается в минуту 0 и заканчивается в 59 минут.  Если для одного и того же часового интервала выдается более одного события использования, все последующие события использования удаляются как дубликаты.

### <a name="what-happens-when-you-emit-usage-for-a-saas-subscription-that-has-been-unsubscribed-already"></a>Что происходит при выпуске использования подписки SaaS, для которой уже была отменена подписка?

Любое событие использования, отправленное на платформу Marketplace, не будет принято после удаления подписки SaaS.

### <a name="can-you-get-a-list-of-all-saas-subscriptions-including-active-and-unsubscribed-subscriptions"></a>Можно ли получить список всех подписок SaaS, включая активные и неподписанные подписки?

Да, при вызове `GET /saas/subscriptions` API он включает список всех подписок SaaS. В поле состояние в ответе для каждой подписки SaaS захватывается, является ли подписка активной или неподписанной. При вызове List Subscriptions в момент времени будет возвращено не более 100 подписок.

### <a name="what-happens-if-the-marketplace-metering-service-has-an-outage"></a>Что произойдет, если в службе измерения Marketplace возникает сбой?

Если поставщик программного обеспечения отправляет пользовательский счетчик и получает сообщение об ошибке, то поставщик программного обеспечения должен подождать и повторить попытку.

Если ошибка повторяется, отправьте настраиваемый измеритель на следующий час (накопление количества). Продолжайте процесс, пока не будет получен ответ, не связанный с ошибкой.

## <a name="next-steps"></a>Дальнейшие шаги

- Дополнительные сведения см. в разделе [API-интерфейсы службы измерения Marketplace](./marketplace-metering-service-apis.md).
