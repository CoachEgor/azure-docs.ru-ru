---
title: V2 реализации API SaaS | Azure Marketplace
description: Объясняет, как создавать и управлять ими на предложение SaaS на AppSource и Azure Marketplace с помощью связанных исполнение v2 API-интерфейсы.
services: Azure, Marketplace, Cloud Partner Portal,
author: v-miclar
ms.service: marketplace
ms.topic: reference
ms.date: 05/23/2019
ms.author: evansma
ms.openlocfilehash: ae477068e2413678d5dd755cb5a7334f85655c74
ms.sourcegitcommit: 25a60179840b30706429c397991157f27de9e886
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/28/2019
ms.locfileid: "66259259"
---
# <a name="saas-fulfillment-apis-version-2"></a>Выполнение приложениям SaaS API версии 2 

В этой статье описывается API, который обеспечивает независимых поставщиков программного обеспечения (ISV), чтобы продавать свои приложения SaaS в Azure Marketplace и AppSource. Этот API-это требование могут быть частью транзакции SaaS поддерживают на Azure Marketplace и AppSource.

## <a name="managing-the-saas-subscription-lifecycle"></a>Управление жизненным циклом подписки SaaS

Служба Microsoft SaaS управляет полным жизненным циклом покупки подписки SaaS и использует API выполнения, как механизм для диска фактическое выполнение изменения планов и удаление подписки с независимых поставщиков программного обеспечения. Сумма счета будет рассчитана на основе состояния подписки SaaS, корпорация Майкрософт поддерживает. На следующей схеме показано состояний и операций, которые управляют изменения между состояниями.

![Состояния жизненного цикла подписки SaaS](./media/saas-subscription-lifecycle-api-v2.png)


### <a name="states-of-a-saas-subscription"></a>Состояния подписки SaaS

Ниже перечислены состояния инициализации для подписки SaaS, включая описание и последовательности схема для каждого (если применимо). 

#### <a name="provisioning"></a>Подготовка

Когда покупатель начинает покупки, независимый поставщик получает эти сведения в код проверки подлинности клиента интерактивных веб-страницы с помощью параметра URL-адрес. Например: `https://contoso.com/signup?token=..`, где — это поставщик URL-адрес целевой страницы в центре партнеров `https://contoso.com/signup`. Код проверки подлинности можно проверить и обмен Дополнительные сведения о то, что необходимо подготовить путем вызова API устранения.  По завершении подготовки службы SaaS, он отправляет вызов активировать для обозначения завершения его выполнения и может быть выставлен счет клиента.  Следующая диаграмма показывает последовательность вызовов API для подготовки сценария.  

![Для подготовки службы SaaS вызовов API.](./media/saas-post-provisioning-api-v2-calls.png)

#### <a name="provisioned"></a>Подготовлено

Это состояние в рабочем режиме подготовленной службы.

#### <a name="provisioning-for-update"></a>Подготовка для обновления
(из marketplace) 

Это состояние представляет обновление к существующей службы находится в состоянии ожидания. Такое обновление может быть инициировано клиента в marketplace, или в службе SaaS (только для direct для операций клиента). В примере ниже показан действия при инициации обновления из marketplace.

![Вызовы API, когда обновление инициируется из marketplace.](./media/saas-update-api-v2-calls-from-marketplace-a.png)

#### <a name="provisioning-for-update"></a>Подготовка для обновления  
(из службы SaaS) 

В примере ниже показан действия при инициации обновления службой SaaS. (Вызов веб-перехватчика заменяется на обновление подписки, инициированных одной службой SaaS. 

![При инициации обновления службой SaaS вызовов API.](./media/saas-update-api-v2-calls-from-saas-service-a.png) 

#### <a name="suspended"></a>Приостановлено

Это состояние указывает, что платеж пользователя не были получены. С помощью политики мы предоставим клиента льготный период перед unfulfilling подписки. Если подписка находится в этом состоянии: 

- Как ISV вы можете привести к снижению или запретить доступ пользователя к службе. 
- Подписка должна оставаться в состоянии, допускающем восстановление, можно восстановить полную функциональность без потери данных или параметров. 
- Вы сможете получить запрос восстановить для этой подписки с помощью реализации API или отмены подготовки запрос, в конце этого периода. 

#### <a name="unsubscribed"></a>Подписка отменена 

Подписки попадает в эту ситуацию, в ответ на запрос явные клиента или в ответ на неуплаты сборам. От независимых поставщиков программного обеспечения ожидается, что данные клиента сохраняется для восстановления по запросу в течение минимум X дней и затем удаляется. 


## <a name="api-reference"></a>Справочник по API

В данном разделе описываются SaaS *подписки API* и *операций API*.  Значение `api-version` параметр версии 2 API-интерфейсов является `2018-08-31`.  


### <a name="parameter-and-entity-definitions"></a>Определения параметров и сущности

В следующей таблице перечислены определения общих параметров и сущности, используемые интерфейсы API для выполнения.

|     Параметр/субъекта     |     Определение                         |
|     ----------------     |     ----------                         |
| `subscriptionId`         | Идентификатор GUID для ресурсов SaaS  |
| `name`                   | Понятное имя, предоставленных клиентом для данного ресурса |
| `publisherId`            | Уникальный строковый идентификатор для каждого издателя, например «contoso» |
| `offerId`                | Уникальный строковый идентификатор для каждого предложения, например «offer1»  |
| `planId`                 | Уникальный строковый идентификатор для каждого плана или номера sku, например «серебряный» |
| `operationId`            | Идентификатор GUID для определенной операции  |
|  `action`                | Действие, выполняемое для ресурса, либо `subscribe`, `unsubscribe`, `suspend`, `reinstate`, или `changePlan`, `changeQuantity`, `transfer`  |
|   |   |

Глобальные уникальные идентификаторы ([идентификаторы GUID](https://en.wikipedia.org/wiki/Universally_unique_identifier)) являются числами 128-разрядный (32 шестнадцатеричном формате), которые обычно формируется автоматически. 

#### <a name="resolve-a-subscription"></a>Разрешить подписки 

Разрешение конечной точки позволяет издателю разрешить маркер marketplace в постоянный идентификатор ресурса. Идентификатор ресурса — это уникальный идентификатор для подписки SAAS.  Когда пользователь перенаправляется на веб-сайт ISV, URL-адрес содержит токен в параметрах запроса. Ожидается, что ISV будет использовать этот токен и отправит запрос на его разрешение. Ответ содержит уникальный идентификатор подписки SAAS, имя, идентификатор предложения и план для ресурса. Этот токен действителен только в течение часа. 

**Поместить:<br>`https://marketplaceapi.microsoft.com/api/saas/subscriptions/resolve?api-version=<ApiVersion>`**

*Параметры запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|  ApiVersion        |  Версию операции, используемой для данного запроса  |

*Заголовки запроса:*
 
|                    |                   |
|  ---------------   |  ---------------  |
|  Content-Type      | `application/json` |
|  x-ms-requestid    |  Уникальное строковое значение для отслеживания запроса от клиента, желательно GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа. |
|  x-ms-correlationid |  Уникальное строковое значение для операции на стороне клиента. Этот параметр сопоставляет все события из клиентской операции с событиями на стороне сервера. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа.  |
|  authorization     |  [Получение токена JSON web token (JWT) носителя](https://docs.microsoft.com/azure/marketplace/cloud-partner-portal/saas-app/cpp-saas-registration#get-a-token-based-on-the-azure-ad-app) |
|  x-ms-marketplace-token  |  Параметр маркера запроса в URL-АДРЕСЕ, когда пользователь перенаправляется на веб-сайт SaaS независимого поставщика программного обеспечения из Azure (например: `https://contoso.com/signup?token=..`). *Примечание.* URL-адрес декодирует значение токена из браузера перед его использованием.  |

*Коды ответов:*

Код: 200<br>
Разрешает непрозрачного токена на подписку SaaS.<br>

```json
Response body:
{
    "subscriptionId": "<guid>",  
    "subscriptionName": "Contoso Cloud Solution",
    "offerId": "offer1",
    "planId": "silver",
    "quantity": "20" 
}
```

Код: 404<br>
Не найдено

Код: 400<br>
Недопустимый запрос. x-ms-marketplace-token отсутствует, имеет неправильный формат или не истекшим сроком действия.

Код: 403<br>
Не авторизовано. Не указан. маркер проверки подлинности является недопустимым, или запрос пытается получить доступ к приобретения, не принадлежащие к текущего издателя.

Код: 500<br>
Внутренняя ошибка сервера

```json
{
    "error": {
      "code": "UnexpectedError",
      "message": "An unexpected error has occurred."
    }
}
```

### <a name="subscription-api"></a>API подписки

Данная подписка API поддерживает следующие операции HTTPS: **Получить**, **Post**, **Patch**, и **удалить**.


#### <a name="list-subscriptions"></a>Список подписок

Список всех подписок SaaS для издателя.

**Получить:<br>`https://marketplaceapi.microsoft.com/api/saas/subscriptions?api-version=<ApiVersion>`**

*Параметры запроса:*

|             |                   |
|  --------   |  ---------------  |
| ApiVersion  |  Версия операции, используемой для этого запроса.  |

*Заголовки запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
| Content-Type       |  `application/json`  |
| x-ms-requestid     |  Уникальное строковое значение для отслеживания запроса от клиента, желательно GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа. |
| x-ms-correlationid |  Уникальное строковое значение для операции на стороне клиента. Этот параметр сопоставляет все события из клиентской операции с событиями на стороне сервера. Если это значение не указано, один будет сгенерирован и в заголовке ответа.  |
| authorization      |  [Получите маркер JSON web token (JWT) носителя.](https://docs.microsoft.com/azure/marketplace/cloud-partner-portal/saas-app/cpp-saas-registration#get-a-token-based-on-the-azure-ad-app)  |

*Коды ответов:*

Код: 200 <br/>
Основываясь на маркер проверки подлинности, получите издателя и соответствующих подписок для предложений издателя.<br> Полезные данные ответа:<br>

```json
{
  [
      {
          "id": "<guid>",
          "name": "Contoso Cloud Solution",
          "publisherId": "contoso",
          "offerId": "offer1",
          "planId": "silver",
          "quantity": "10",
          "beneficiary": { // Tenant for which SaaS subscription is purchased.
              "tenantId": "<guid>"
          },
          "purchaser": { // Tenant that purchased the SaaS subscription. These could be different for reseller scenario
              "tenantId": "<guid>"
          },
          "allowedCustomerOperations": [
              "Read" // Possible Values: Read, Update, Delete.
          ], // Indicates operations allowed on the SaaS subscription. For CSP initiated purchases, this will always be Read.
          "sessionMode": "None", // Possible Values: None, DryRun (Dry Run indicates all transactions run as Test-Mode in the commerce stack)
          "saasSubscriptionStatus": "Subscribed" // Indicates the status of the operation. [Provisioning, Subscribed, Suspended, Unsubscribed]
      }
  ],
  "continuationToken": ""
}
```

Маркер продолжения появятся только в том случае, если существуют дополнительные «страницы» планов для извлечения. 

Код: 403 <br>
Не авторизовано. Не указан. маркер проверки подлинности является недопустимым, или запрос пытается получить доступ к приобретения, не принадлежащие к текущего издателя. 

Код: 500 — Внутренняя ошибка сервера

```json
{
    "error": {
      "code": "UnexpectedError",
      "message": "An unexpected error has occurred."
    }
}
```

#### <a name="get-subscription"></a>Получение подписки

Возвращает указанную подписку SaaS. Используйте этот вызов для получения сведений о лицензиях и сведения о плане.

**Получить:<br> `https://marketplaceapi.microsoft.com/api/saas/subscriptions/<subscriptionId?api-version=<ApiVersion>`**

*Параметры запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
| subscriptionId     |   Уникальный идентификатор подписки SaaS, полученный после устранения токен через разрешения API   |
|  ApiVersion        |   Версию операции, используемой для данного запроса   |

*Заголовки запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|  Content-Type      |  `application/json`  |
|  x-ms-requestid    |  Уникальное строковое значение для отслеживания запроса от клиента, желательно GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа. |
|  x-ms-correlationid |  Уникальное строковое значение для операции на стороне клиента. Этот параметр сопоставляет все события из клиентской операции с событиями на стороне сервера. Если это значение не указано, один будет сгенерирован и в заголовке ответа.  |
|  authorization     |  [Получите маркер JSON web token (JWT) носителя.](https://docs.microsoft.com/azure/marketplace/cloud-partner-portal/saas-app/cpp-saas-registration#get-a-token-based-on-the-azure-ad-app)  |

*Коды ответов:*

Код: 200<br>
Получает из идентификатора подписки SaaS<br> Полезные данные ответа:<br>

```json
Response Body:
{ 
        "id":"",
        "name":"Contoso Cloud Solution",
        "publisherId": "contoso",
        "offerId": "offer1",
        "planId": "silver",
        "quantity": "10",
          "beneficiary": { // Tenant for which SaaS subscription is purchased.
              "tenantId": "<guid>"
          },
          "purchaser": { // Tenant that purchased the SaaS subscription. These could be different for reseller scenario
              "tenantId": "<guid>"
          },
        "allowedCustomerOperations": ["Read"], // Indicates operations allowed on the SaaS subscription. For CSP initiated purchases, this will always be Read.
        "sessionMode": "None", // Dry Run indicates all transactions run as Test-Mode in the commerce stack
        "status": "Subscribed", // Indicates the status of the operation.
}
```

Код: 404<br>
Не найдено<br> 

Код: 403<br>
Не авторизовано. Не указан. маркер проверки подлинности является недопустимым, или запрос пытается получить доступ к приобретения, не принадлежащие к текущего издателя.

Код: 500<br>
Внутренняя ошибка сервера<br>

```json
{
    "error": {
      "code": "UnexpectedError",
      "message": "An unexpected error has occurred."
    }  
```

#### <a name="list-available-plans"></a>Список доступных планов

Используйте этот вызов, чтобы узнать, есть ли предложениями закрытого и открытого для текущего издателя.

**Получить:<br> `https://marketplaceapi.microsoft.com/api/saas/subscriptions/<subscriptionId>/listAvailablePlans?api-version=<ApiVersion>`**

*Параметры запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|  ApiVersion        |   Версию операции, используемой для данного запроса  |

*Заголовки запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|   Content-Type     |  `application/json` |
|   x-ms-requestid   |   Уникальное строковое значение для отслеживания запроса от клиента, желательно GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа. |
|  x-ms-correlationid  | Уникальное строковое значение для операции на стороне клиента. Этот параметр сопоставляет все события из клиентской операции с событиями на стороне сервера. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа. |
|  authorization     |  [Получите маркер JSON web token (JWT) носителя.](https://docs.microsoft.com/azure/marketplace/cloud-partner-portal/saas-app/cpp-saas-registration#get-a-token-based-on-the-azure-ad-app) |

*Коды ответов:*

Код: 200<br>
Получение списка доступных планов для клиента.<br>

Текст ответа:

```json
{
    "plans": [{
        "planId": "Platinum001",
        "displayName": "Private platinum plan for Contoso",
        "isPrivate": true
    }]
}
```

Код: 404<br>
Не найдено<br> 

Код: 403<br>
Не авторизовано. Не указан. маркер проверки подлинности является недопустимым, или запрос пытается получить доступ к приобретения, не принадлежащие к текущего издателя. <br> 

Код: 500<br>
Внутренняя ошибка сервера<br>

```json
{ 
    "error": { 
      "code": "UnexpectedError", 
      "message": "An unexpected error has occurred." 
    } 
```

#### <a name="activate-a-subscription"></a>Активировать подписку

**Поместить:<br> `https://marketplaceapi.microsoft.com/api/saas/subscriptions/<subscriptionId>/activate?api-version=<ApiVersion>`**

*Параметры запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|  ApiVersion        |  Версию операции, используемой для данного запроса  |
| subscriptionId     | Уникальный идентификатор, полученный после устранения маркер, с помощью API устранения подписки SaaS  |

*Заголовки запроса:*
 
|                    |                   |
|  ---------------   |  ---------------  |
|  Content-Type      | `application/json`  |
|  x-ms-requestid    | Уникальное строковое значение для отслеживания запроса от клиента, желательно GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа.  |
|  x-ms-correlationid  | Уникальное строковое значение для операции на стороне клиента. Эта строка сопоставляет все события из клиентской операции с событиями на стороне сервера. Если это значение не указано, один будет сгенерирован и в заголовке ответа.  |
|  authorization     |  [Получите маркер JSON web token (JWT) носителя.](https://docs.microsoft.com/azure/marketplace/cloud-partner-portal/saas-app/cpp-saas-registration#get-a-token-based-on-the-azure-ad-app) |

*Запрос:*

```json
{
    "planId": "gold",
    "quantity": ""
}
```

*Коды ответов:*

Код: 200<br>
Активирует подписку.<br>

Код: 404<br>
Не найдено

Код: 400<br>
Неправильный запрос проверки ошибок

Код: 403<br>
Не авторизовано. Не указан. маркер проверки подлинности является недопустимым, или запрос пытается получить доступ к приобретения, не принадлежащие к текущего издателя.

Код: 500<br>
Внутренняя ошибка сервера

```json
{
    "error": {
      "code": "UnexpectedError",
      "message": "An unexpected error has occurred."
    }
}
```

#### <a name="change-the-plan-on-the-subscription"></a>Изменить план на подписку.

Обновите план для подписки.

**Исправление:<br> `https://marketplaceapi.microsoft.com/api/saas/subscriptions/<subscriptionId>?api-version=<ApiVersion>`**

*Параметры запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|  ApiVersion        |  Версия операции, используемой для этого запроса.  |
| subscriptionId     | Уникальный идентификатор, полученный после устранения маркер, с помощью API устранения подписки SaaS.  |

*Заголовки запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|  Content-Type      | `application/json` |
|  x-ms-requestid    |   Уникальное строковое значение для отслеживания запроса клиента, желательно GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа.  |
|  x-ms-correlationid  |  Уникальное строковое значение для операции на стороне клиента. Этот параметр сопоставляет все события из клиентской операции с событиями на стороне сервера. Если это значение не указано, один будет сгенерирован и в заголовке ответа.    |
| authorization      |  [Получите маркер JSON web token (JWT) носителя.](https://docs.microsoft.com/azure/marketplace/cloud-partner-portal/saas-app/cpp-saas-registration#get-a-token-based-on-the-azure-ad-app)  |

*Полезные данные запроса:*

```json
Request Body:
{
    "planId": "gold"
}
```

*Заголовки запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
| Operation-Location | Ссылки на ресурс, чтобы получить состояние операции.   |

*Коды ответов:*

Код: 202<br>
Принял запрос на изменение плана. Независимый поставщик должен опрашивать Operation-Location, чтобы определить успешное завершение или сбой. <br>

Код: 404<br>
Не найдено

Код: 400<br>
Неправильный запрос проверки ошибок.

>[!Note]
>План или количество может быть исправлен за один раз, но не оба. Редактирует на подписки с помощью **обновление** не находится в `allowedCustomerOperations`.

Код: 403<br>
Не авторизовано. Не указан. маркер проверки подлинности является недопустимым, или запрос пытается получить доступ к приобретения, не принадлежащие к текущего издателя.

Код: 500<br>
Внутренняя ошибка сервера

```json
{
    "error": {
      "code": "UnexpectedError",
      "message": "An unexpected error has occurred."
    }
}
```

#### <a name="change-the-quantity-on-the-subscription"></a>Измените количество на подписку.

Обновление количества в подписке.

**Исправление:<br> `https://marketplaceapi.microsoft.com/api/saas/subscriptions/<subscriptionId>?api-version=<ApiVersion>`**

*Параметры запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|  ApiVersion        |  Версия операции, используемой для этого запроса.  |
| subscriptionId     | Уникальный идентификатор, полученный после устранения маркер, с помощью API устранения подписки SaaS.  |

*Заголовки запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|  Content-Type      | `application/json` |
|  x-ms-requestid    |   Уникальное строковое значение для отслеживания запроса клиента, желательно GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа.  |
|  x-ms-correlationid  |  Уникальное строковое значение для операции на стороне клиента. Этот параметр сопоставляет все события из клиентской операции с событиями на стороне сервера. Если это значение не указано, один будет сгенерирован и в заголовке ответа.    |
| authorization      |  [Получите маркер JSON web token (JWT) носителя.](https://docs.microsoft.com/azure/marketplace/cloud-partner-portal/saas-app/cpp-saas-registration#get-a-token-based-on-the-azure-ad-app)  |

*Полезные данные запроса:*

```json
Request Body:
{
    "quantity": 5
}
```

*Заголовки запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
| Operation-Location | Ссылки на ресурс, чтобы получить состояние операции.   |

*Коды ответов:*

Код: 202<br>
Принято. Запрос, чтобы изменить количество принят. Независимый поставщик должен опрашивать Operation-Location, чтобы определить успешное завершение или сбой. <br>

Код: 404<br>
Не найдено

Код: 400<br>
Неправильный запрос проверки ошибок.

>[!Note]
>План или количество может быть исправлен за один раз, но не оба. Редактирует на подписки с помощью **обновление** не находится в `allowedCustomerOperations`.

Код: 403<br>
Не авторизовано. Не указан. маркер проверки подлинности является недопустимым, или запрос пытается получить доступ к приобретения, не принадлежащие к текущего издателя.

Код: 500<br>
Внутренняя ошибка сервера

```json
{
    "error": {
      "code": "UnexpectedError",
      "message": "An unexpected error has occurred."
    }
}
```

#### <a name="delete-a-subscription"></a>Удаление подписки

Отказаться от подписки и удаление указанной подписки.

**Удаление:<br> `https://marketplaceapi.microsoft.com/api/saas/subscriptions/<subscriptionId> ?api-version=<ApiVersion>`**

*Параметры запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|  ApiVersion        |  Версия операции, используемой для этого запроса.  |
| subscriptionId     | Уникальный идентификатор, полученный после устранения маркер, с помощью API устранения подписки SaaS.  |

*Заголовки запроса:*
 
|                    |                   |
|  ---------------   |  ---------------  |
|   Content-Type     |  `application/json` |
|  x-ms-requestid    |   Уникальное строковое значение для отслеживания запроса клиента, желательно GUID. Если это значение не указано, один будет сгенерирован и в заголовке ответа.   |
|  x-ms-correlationid  |  Уникальное строковое значение для операции на стороне клиента. Этот параметр сопоставляет все события из клиентской операции с событиями на стороне сервера. Если это значение не указано, один будет сгенерирован и в заголовке ответа.   |
|  authorization     |  [Получите маркер JSON web token (JWT) носителя.](https://docs.microsoft.com/azure/marketplace/cloud-partner-portal/saas-app/cpp-saas-registration#get-a-token-based-on-the-azure-ad-app)  |

*Коды ответов:*

Код: 202<br>
Независимых поставщиков программного обеспечения инициируется вызов для указания отказаться от подписки на подписку SaaS.<br>

Код: 404<br>
Не найдено

Код: 400<br>
Удалить на подписки с помощью **удалить** не в `allowedCustomerOperations`.

Код: 403<br>
Не авторизовано. Не указан. маркер проверки подлинности является недопустимым, или запрос пытается получить доступ к приобретения, не принадлежащие к текущего издателя.

Код: 500<br>
Внутренняя ошибка сервера

```json
{
    "error": {
      "code": "UnexpectedError",
      "message": "An unexpected error has occurred."
    }
}
```


### <a name="operations-api"></a>Операции API

Операции API поддерживает следующие операции исправления и Get.

#### <a name="list-outstanding-operations"></a>Список незавершенных операций 

Список незавершенных операций для текущего издателя. 

**Получить:<br> `https://marketplaceapi.microsoft.com/api/saas/subscriptions/<subscriptionId>/operations?api-version=<ApiVersion>`**

*Параметры запроса:*

|             |        |
|  ---------------   |  ---------------  |
|    ApiVersion                |   Версия операции, используемой для этого запроса.                |
| subscriptionId     | Уникальный идентификатор, полученный после устранения маркер, с помощью API устранения подписки SaaS.  |

*Заголовки запроса:*
 
|                    |                   |
|  ---------------   |  ---------------  |
|   Content-Type     |  `application/json` |
|  x-ms-requestid    |  Уникальное строковое значение для отслеживания запроса клиента, желательно GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа.  |
|  x-ms-correlationid |  Уникальное строковое значение для операции на стороне клиента. Этот параметр сопоставляет все события из клиентской операции с событиями на стороне сервера. Если это значение не указано, один будет сгенерирован и в заголовке ответа.  |
|  authorization     |  [Получите маркер JSON web token (JWT) носителя.](https://docs.microsoft.com/azure/marketplace/cloud-partner-portal/saas-app/cpp-saas-registration#get-a-token-based-on-the-azure-ad-app)  |

*Коды ответов:*

Код: 200<br> Получает список ожидающих операций для подписки.<br>
Полезные данные ответа:

```json
[{
    "id": "<guid>",  
    "activityId": "<guid>",
    "subscriptionId": "<guid>",
    "offerId": "offer1",
    "publisherId": "contoso",  
    "planId": "silver",
    "quantity": "20",
    "action": "Convert",
    "timeStamp": "2018-12-01T00:00:00",  
    "status": "NotStarted"  
}]
```

Код: 404<br>
Не найдено

Код: 400<br>
Неправильный запрос проверки ошибок

Код: 403<br>
Не авторизовано. Не указан. маркер проверки подлинности является недопустимым, или запрос пытается получить доступ к приобретения, не принадлежащие к текущего издателя.

Код: 500<br>
Внутренняя ошибка сервера

```json
{
    "error": {
      "code": "UnexpectedError",
      "message": "An unexpected error has occurred."
    }
}

```

#### <a name="get-operation-status"></a>Получить состояние операции

Позволяет отслеживать состояние указанного активированные асинхронной операции издателю (подписки, отказаться от подписки, измените план / изменить количество).

**Получить:<br> `https://marketplaceapi.microsoft.com/api/saas/subscriptions/<subscriptionId>/operations/<operationId>?api-version=<ApiVersion>`**

*Параметры запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|  ApiVersion        |  Версия операции, используемой для этого запроса.  |

*Заголовки запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|  Content-Type      |  `application/json`   |
|  x-ms-requestid    |   Уникальное строковое значение для отслеживания запроса клиента, желательно GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа.  |
|  x-ms-correlationid |  Уникальное строковое значение для операции на стороне клиента. Этот параметр сопоставляет все события из клиентской операции с событиями на стороне сервера. Если это значение не указано, один будет сгенерирован и в заголовке ответа.  |
|  authorization     |[Получите маркер JSON web token (JWT) носителя.](https://docs.microsoft.com/azure/marketplace/cloud-partner-portal/saas-app/cpp-saas-registration#get-a-token-based-on-the-azure-ad-app)  |

*Коды ответов:* Код: 200<br> Возвращает указанный ожидающей операции SaaS<br>
Полезные данные ответа:

```json
Response body:
{
    "id  ": "<guid>",
    "activityId": "<guid>",
    "subscriptionId":"<guid>",
    "offerId": "offer1",
    "publisherId": "contoso",  
    "planId": "silver",
    "quantity": "20",
    "action": "Convert",
    "timeStamp": "2018-12-01T00:00:00",
    "status": "NotStarted"
}

```

Код: 404<br>
Не найдено

Код: 400<br>
Неправильный запрос проверки ошибок

Код: 403<br>
Не авторизовано. Не указан. маркер проверки подлинности является недопустимым, или запрос пытается получить доступ к приобретения, не принадлежащие к текущего издателя.
 
Код: 500<br> Внутренняя ошибка сервера

```json
{
    "error": {
      "code": "UnexpectedError",
      "message": "An unexpected error has occurred."
    }
}

```
#### <a name="update-the-status-of-an-operation"></a>Обновить состояние операции

Обновите состояние операции для указания об успехе или сбое, предоставленными значениями.

**Исправление:<br> `https://marketplaceapi.microsoft.com/api/saas/subscriptions/<subscriptionId>/operations/<operationId>?api-version=<ApiVersion>`**

*Параметры запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|   ApiVersion       |  Версия операции, используемой для этого запроса.  |
| subscriptionId     | Уникальный идентификатор, полученный после устранения маркер, с помощью API устранения подписки SaaS.  |
|  operationId       | Операция, которую было выполнено. |

*Заголовки запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|   Content-Type     | `application/json`   |
|   x-ms-requestid   |   Уникальное строковое значение для отслеживания запроса клиента, желательно GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа. |
|  x-ms-correlationid |  Уникальное строковое значение для операции на стороне клиента. Этот параметр сопоставляет все события из клиентской операции с событиями на стороне сервера. Если это значение не указано, один будет сгенерирован и в заголовке ответа. |
|  authorization     |  [Получите маркер JSON web token (JWT) носителя.](https://docs.microsoft.com/azure/marketplace/cloud-partner-portal/saas-app/cpp-saas-registration#get-a-token-based-on-the-azure-ad-app)  |

*Полезные данные запроса:*

```json
{
    "planId": "offer1",
    "quantity": "44",
    "status": "Success"    // Allowed Values: Success/Failure. Indicates the status of the operation.
}

```

*Коды ответов:*

Код: 200<br> Вызов для информирования о завершении операции на стороне независимых поставщиков программного обеспечения. Например этот ответ могут сигнализировать о изменение рабочих мест и планов.

Код: 404<br>
Не найдено

Код: 400<br>
Неправильный запрос проверки ошибок

Код: 403<br>
Не авторизовано. Не указан. маркер проверки подлинности является недопустимым, или запрос пытается получить доступ к приобретения, не принадлежащие к текущего издателя.

Код: 409<br>
Конфликт. Например новая транзакция уже выполняется

Код: 500<br> Внутренняя ошибка сервера

```json
{
    "error": {
      "code": "UnexpectedError",
      "message": "An unexpected error has occurred."
    }
}

```

## <a name="webhook-on-the-saas-service"></a>Веб-перехватчика в службе SaaS

Издатель должен реализовывать веб-перехватчика в эту службу SaaS, чтобы заранее уведомить пользователей об изменениях в свою службу. API должен быть не прошедших проверку подлинности и будет вызываться службой Microsoft SaaS. Ожидается, что служба SaaS вызов операций API для проверки и авторизации перед выполнением действия на веб-перехватчика уведомлений.

```json
{
    "operationId": "<guid>",
    "activityId": "<guid>",
    "subscriptionId":"<guid>",
    "offerId": "offer1",
    "publisherId": "contoso",
    "planId": "silver",
    "quantity": "20"  ,
    "action": "Subscribe",
    "timeStamp": "2018-12-01T00:00:00"
}
```

Когда действие может быть одно из следующих: 
- `Subscribe`  (Если ресурс был активирован)
- `Unsubscribe` (Если ресурс был удален)
- `ChangePlan` (После завершения операции изменения плана)
- `ChangeQuantity` (После завершения операции изменения количество)
- `Suspend` (Если ресурс был приостановлен)
- `Reinstate` (Когда после приостановки был восстановлен ресурсов)


## <a name="mock-api"></a>Макет API

Можно использовать наш макет API помогут вам приступить к работе с разработкой приложений, особенно создания прототипов и тестирование проектов. 

Конечная точка узла: `https://marketplaceapi.microsoft.com/api` <br/>
Версия API: `2018-09-15` <br/>
Проверка подлинности не требуется <br/>
Пример Uri: `https://marketplaceapi.microsoft.com/api/saas/subscriptions?api-version=2018-09-15` <br/>

Пути к конечной точке API одинаковы для всех макет и реальных API-интерфейсов, но имеют разные версии API. Версия — 2018-09-15 для макета и 2018-08-31 для рабочей версии. 

Любой из вызовов API в этой статье может быть сделан для конечной точки макет узла. Вы сможете получить фиктивные данные назад в качестве отклика. В общем случае можно ожидать получения фиктивные данные назад в качестве отклика. Вызовы методов обновления подписки на макет API всегда возвращает 500. 

## <a name="next-steps"></a>Дальнейшие действия

Разработчикам можно получить программным способом и обработку рабочих нагрузок, предложения и издателе профили с помощью [API-интерфейсов REST портал Cloud Partner](https://docs.microsoft.com/azure/marketplace/cloud-partner-portal-orig/cloud-partner-portal-api-overview).
