---
title: Регистрация приложения SaaS | Azure Marketplace
description: Описание регистрации приложения SaaS с помощью портал Azure.
services: Azure, Marketplace, Cloud Partner Portal, Azure portal
author: v-miclar
ms.service: marketplace
ms.subservice: partnercenter-marketplace-publisher
ms.topic: conceptual
ms.date: 05/23/2019
ms.author: evansma
ms.openlocfilehash: b2e02e42ab63f893574ca5217fd2f36c7481aabd
ms.sourcegitcommit: ac56ef07d86328c40fed5b5792a6a02698926c2d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/08/2019
ms.locfileid: "73827938"
---
# <a name="register-a-saas-application"></a>Регистрация приложения SaaS

В этой статье объясняется, как зарегистрировать приложение SaaS с помощью [портал Azure](https://portal.azure.com/)Майкрософт.  После успешной регистрации вы получите маркер безопасности Azure Active Directory (Azure AD), который можно использовать для доступа к API-интерфейсам выполнения SaaS.  Дополнительные сведения об Azure AD см. в статье [что такое проверка подлинности?](https://docs.microsoft.com/azure/active-directory/develop/authentication-scenarios)


## <a name="service-to-service-authentication-flow"></a>Поток проверки подлинности между службами

На следующей диаграмме показан поток действий при подписке нового клиента, а также этапы, на которых используются эти API:

![Процесс использования API для предложения SaaS](./media/saas-offer-publish-api-flow-v1.png)

Azure не налагает никаких ограничений на аутентификацию, которую служба SaaS предоставляет своим пользователям. Однако проверка подлинности с помощью API-интерфейсов выполнения SaaS выполняется с маркером безопасности Azure AD, который обычно получается путем регистрации приложения SaaS с помощью портал Azure. 


## <a name="register-an-azure-ad-secured-app"></a>Регистрация приложения, защищенного с помощью Azure AD

Все приложения, которые будут использовать возможности Azure AD, сначала следует зарегистрировать в клиенте Azure AD. Этот процесс регистрации включает в себя предоставление Azure AD сведений о приложении (например, URL-адрес, по которому расположено приложение, URL-адрес для отправки ответов после проверки подлинности пользователя, идентифицирующий приложение код URI и др.).  Чтобы зарегистрировать новое приложения с помощью портала Azure, сделайте следующее:

1.  Войдите на [портал Azure](https://portal.azure.com/).
2.  Если ваша учетная запись предоставляет вам доступ к более чем одной службе, щелкните свою учетную запись в правом верхнем углу и задайте для сеанса портала нужный клиент Azure AD.
3.  В области навигации слева щелкните службу **Azure Active Directory**, а затем выберите **Регистрация приложений** и щелкните **Регистрация нового приложения**.

    ![Регистрации приложений AD для SaaS](./media/saas-offer-app-registration-v1.png)

4.  На странице создания введите сведения о регистрации приложения.
    -   **Имя**. Введите понятное имя для приложения.
    -   **Тип приложения**. 
        - Выберите **Машинный код** для [клиентских приложений](https://docs.microsoft.com/azure/active-directory/develop/active-directory-dev-glossary#client-application), которые установлены локально на устройстве. Этот параметр используется для общедоступных [собственных клиентов](https://docs.microsoft.com/azure/active-directory/develop/active-directory-dev-glossary#native-client) OAuth.
        - Выберите **Веб-приложение или API** для [клиентских приложений](https://docs.microsoft.com/azure/active-directory/develop/active-directory-dev-glossary#client-application) и [приложений-ресурсов / приложений API](https://docs.microsoft.com/azure/active-directory/develop/active-directory-dev-glossary#resource-server), установленных на защищенном сервере. Этот параметр используется для конфиденциальных [веб-клиентов](https://docs.microsoft.com/azure/active-directory/develop/active-directory-dev-glossary#web-client) и общедоступных [клиентов с агентом пользователя](https://docs.microsoft.com/azure/active-directory/develop/active-directory-dev-glossary#user-agent-based-client), использующих OAuth.
        То же приложение может также предоставлять клиент и ресурс или API.
    -   **URL-адрес входа**. Для веб-приложений и API укажите основной URL-адрес приложения. Например, выполняемое на локальном компьютере веб-приложение может иметь адрес **http://localhost:31544** . Пользователи будут использовать этот URL-адрес для входа в приложение веб-клиента.
    -   **URI перенаправления**. Для приложений "Машинный код" укажите универсальный код ресурса (URI), который Azure AD будет использовать для возвращения токенов ответа. Укажите значение, используемое в вашем приложении, например **http://MyFirstAADApp** .

        ![Регистрации приложений AD для SaaS](./media/saas-offer-app-registration-v1-2.png)

        Конкретные примеры для веб-приложений или собственных приложений см. в разделе краткие руководства по установке, доступные в статье *Приступая к работе* с [руководством для разработчиков Azure AD](https://docs.microsoft.com/azure/active-directory/develop/active-directory-developers-guide).

5.  По завершении нажмите кнопку **Создать**. Azure AD назначает приложению уникальный *идентификатор приложения* , и вы\'повторно перенаправлены на главную страницу регистрации приложения\'s. В зависимости от того, является ли ваше приложение веб-приложением или собственным приложением, будут предоставлены различные параметры для добавления дополнительных возможностей в приложение.

>[!Note]
>По умолчанию только что зарегистрированное приложение настроено таким же, чтобы пользователи из одного клиента могли входить в приложение.


## <a name="using-the-azure-ad-security-token"></a>Использование маркера безопасности Azure AD

После регистрации приложения можно программно запросить маркер безопасности Azure AD.  Издатель должен использовать этот маркер и выполнить запрос на его разрешение.  При использовании различных интерфейсов API выполнения параметр запроса маркера находится в URL-адресе, когда пользователь перенаправляется на веб-сайт SaaS из Azure.  Этот токен действителен только один час.  Кроме того, следует декодировать значение токена из браузера перед его использованием.

Дополнительные сведения об этих токенах см. в разделе [Azure Active Directory доступа к маркерам](https://docs.microsoft.com/azure/active-directory/develop/access-tokens).


### <a name="get-a-token-based-on-the-azure-ad-app"></a>Получение токена для приложения Azure AD

Метод HTTP

`POST`

*Request URL* (URL-адрес запроса)

**https://login.microsoftonline.com/ *{идентификатор_клиента}* /oauth2/token**

*Параметр универсального кода ресурса*

|  **Имя параметра**  | **Обязательный**  | **Описание**                               |
|  ------------------  | ------------- | --------------------------------------------- |
| tenantId             | Да          | Идентификатор клиента для зарегистрированного приложения AAD   |
|  |  |  |


*Заголовок запроса*

|  **Имя заголовка**  | **Обязательный** |  **Описание**                                   |
|  --------------   | ------------ |  ------------------------------------------------- |
|  Content-Type     | Да         | Связанный с этим запросом тип содержимого. По умолчанию используется значение `application/x-www-form-urlencoded`.  |
|  |  |  |


*Текст запроса*

| **Имя свойства**   | **Обязательный** |  **Описание**                                                          |
| -----------------   | -----------  | ------------------------------------------------------------------------- |
|  Grant_type         | Да         | Тип предоставления разрешения. По умолчанию используется значение `client_credentials`.                    |
|  Client_id          | Да         |  Идентификатор клиента или приложения, связанный с приложением Azure AD.                  |
|  client_secret      | Да         |  Пароль, связанный с приложением Azure AD.                               |
|  Ресурс           | Да         |  Целевой ресурс, для которого запрашивается токен. По умолчанию используется значение `62d94f6c-d599-489b-a797-3e10e42fbe22`. |
|  |  |  |


*Ответ*

|  **имя**  | **Тип**       |  **Описание**    |
| ---------- | -------------  | ------------------- |
| 200 ОК    | TokenResponse  | Запрос успешно выполнен   |
|  |  |  |

*TokenResponse*

Пример токена ответа.

``` json
  {
      "token_type": "Bearer",
      "expires_in": "3600",
      "ext_expires_in": "0",
      "expires_on": "15251…",
      "not_before": "15251…",
      "resource": "62d94f6c-d599-489b-a797-3e10e42fbe22",
      "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6ImlCakwxUmNxemhpeTRmcHhJeGRacW9oTTJZayIsImtpZCI6ImlCakwxUmNxemhpeTRmcHhJeGRacW9oTTJZayJ9…"
  }               
```


## <a name="next-steps"></a>Дальнейшие действия

Приложение, защищенное с помощью Azure AD, теперь может использовать [API выполнения SaaS версии 2](./pc-saas-fulfillment-api-v2.md).
