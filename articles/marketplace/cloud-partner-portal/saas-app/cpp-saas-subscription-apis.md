---
title: Продажа SaaS с помощью Azure. API-интерфейсы | Документация Майкрософт
description: В этой статье описывается создание предложения SaaS через API-интерфейсы Marketplace.
services: Azure, Marketplace, Cloud Partner Portal,
documentationcenter: ''
author: v-miclar
manager: Patrick.Butler
editor: ''
ms.assetid: ''
ms.service: marketplace
ms.workload: ''
ms.tgt_pltfrm: ''
ms.devlang: ''
ms.topic: reference
ms.date: 09/17/2018
ms.author: pbutlerm
ms.openlocfilehash: d6ab18d68d6508a18f0b36ab5a39e15fa7c0555a
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60594487"
---
# <a name="saas-sell-through-azure---apis"></a>Продажа SaaS с помощью Azure. API-интерфейсы

В этой статье объясняется, как создать предложение SaaS через API-интерфейсы. API-интерфейсы используются для того, чтобы разрешить пользователям оформлять подписки на предложение SaaS, для которого выбран режим "Продажа с помощью Azure".  Эта статья разделена на две части:

-   аутентификация между службой SaaS и Azure Marketplace;
-   методы и конечные точки API.

Чтобы помочь вам интегрировать службу SaaS с Azure, мы предоставляем следующие API:

-   Разрешить
-   Подписаться
-   Преобразовать
-   Отписаться

На следующей диаграмме показана последовательность действий при подписке нового клиента, а также этапы, на которых используются эти API:

![Процесс использования API для предложения SaaS](./media/saas-offer-publish-api-flow.png)


## <a name="service-to-service-authentication-between-saas-service-and-azure-marketplace"></a>Аутентификация между службой SaaS и Azure Marketplace

Azure не налагает никаких ограничений на аутентификацию, которую служба SaaS предоставляет своим пользователям. Но для целей коммуникации службы SaaS с API-интерфейсами Azure Marketplace аутентификация обязательно выполняется в контексте приложения Azure Active Directory (Azure AD).

В следующем разделе описано, как создать приложение Azure AD.


### <a name="register-an-azure-ad-application"></a>Регистрация приложения Azure AD

Все приложения, которые будут использовать возможности Azure AD, сначала следует зарегистрировать в клиенте Azure AD. Этот процесс регистрации включает в себя предоставление Azure AD сведений о приложении (например, URL-адрес, по которому расположено приложение, URL-адрес для отправки ответов после проверки подлинности пользователя, идентифицирующий приложение код URI и др.).

Чтобы зарегистрировать новое приложения с помощью портала Azure, сделайте следующее:

1. Войдите на [портал Azure](https://portal.azure.com/).
2. Если учетная запись предоставляет доступ к нескольким клиентам, щелкните учетную запись в правом верхнем углу и выберите нужного клиента Azure AD для этого сеанса портала.
3. В области навигации слева щелкните службу **Azure Active Directory**, а затем выберите **Регистрация приложений** и щелкните **Регистрация нового приложения**.

   ![Регистрации приложений AD для SaaS](./media/saas-offer-app-registration.png)

4. На странице создания введите сведения о регистрации приложения.
   - **Имя.** Введите понятное имя для приложения.
   - **Тип приложения**. 
     - Выберите **Машинный код** для [клиентских приложений](https://docs.microsoft.com/azure/active-directory/develop/active-directory-dev-glossary#client-application), которые установлены локально на устройстве. Этот параметр используется для общедоступных [собственных клиентов](https://docs.microsoft.com/azure/active-directory/develop/active-directory-dev-glossary#native-client) OAuth.
     - Выберите **Веб-приложение или API** для [клиентских приложений](https://docs.microsoft.com/azure/active-directory/develop/active-directory-dev-glossary#client-application) и [приложений-ресурсов / приложений API](https://docs.microsoft.com/azure/active-directory/develop/active-directory-dev-glossary#resource-server), установленных на защищенном сервере. Этот параметр используется для конфиденциальных [веб-клиентов](https://docs.microsoft.com/azure/active-directory/develop/active-directory-dev-glossary#web-client) и общедоступных [клиентов с агентом пользователя](https://docs.microsoft.com/azure/active-directory/develop/active-directory-dev-glossary#user-agent-based-client), использующих OAuth.
     То же приложение может также предоставлять клиент и ресурс или API.
   - **URL-адрес для входа.** Для веб или API приложений необходимо указать основной URL-адрес приложения. Например **http:\//localhost:31544** может быть URL-адрес для веб-приложения, работающего на локальном компьютере. Пользователи будут использовать этот URL-адрес для входа в приложение веб-клиента.
   - **URI перенаправления.** Для собственных приложений укажите URI, который использует AAD для возвращения ответов маркера. Введите значение, относящимся к вашему приложению, например **http:\//MyFirstAADApp**.

     ![Регистрации приложений AD для SaaS](./media/saas-offer-app-registration-2.png) Конкретные примеры веб-или нативных приложений можно найти в кратком пошаговом руководстве из раздела о начале работы в [руководстве для разработчиков Azure AD](https://docs.microsoft.com/azure/active-directory/develop/active-directory-developers-guide).

5. По завершении нажмите кнопку **Создать**. Azure AD присвоит вашему приложению уникальный идентификатор, а затем откроет главную страницу регистрации приложения. В зависимости от того, является ли ваше приложение веб-приложением или собственным приложением, будут предоставлены различные параметры для добавления дополнительных возможностей в приложение.

   **Примечание**. По умолчанию в только что зарегистрированное приложение могут входить только пользователи того же клиента.

<a name="api-methods-and-endpoints"></a>Методы и конечные точки API
-------------------------

В следующих разделах описаны методы и конечные точки API, которые позволяют настраивать подписки для работы с предложением SaaS.

### <a name="get-a-token-based-on-the-azure-ad-app"></a>Получение токена для приложения Azure AD

Метод HTTP

`GET`

*Request URL* (URL-адрес запроса)

**https://login.microsoftonline.com/*{идентификатор_клиента}*/oauth2/token**

*Параметр универсального кода ресурса*

|  **Имя параметра**  | **Обязательный**  | **Описание**                               |
|  ------------------  | ------------- | --------------------------------------------- |
| tenantId             | Истина          | Идентификатор клиента для зарегистрированного приложения AAD   |
|  |  |  |


*Заголовок запроса*

|  **Имя заголовка**  | **Обязательный** |  **Описание**                                   |
|  --------------   | ------------ |  ------------------------------------------------- |
|  Content-Type     | Истина         | Связанный с этим запросом тип содержимого. По умолчанию используется значение `application/x-www-form-urlencoded`.  |
|  |  |  |


*Текст запроса*

| **Имя свойства**   | **Обязательный** |  **Описание**                                                          |
| -----------------   | -----------  | ------------------------------------------------------------------------- |
|  Grant_type         | Истина         | Тип предоставления разрешения. По умолчанию используется значение `client_credentials`.                    |
|  Client_id          | Истина         |  Идентификатор клиента или приложения, связанный с приложением Azure AD.                  |
|  client_secret      | Истина         |  Пароль, связанный с приложением Azure AD.                               |
|  Resource           | Истина         |  Целевой ресурс, для которого запрашивается токен. По умолчанию используется значение `62d94f6c-d599-489b-a797-3e10e42fbe22`. |
|  |  |  |


*Ответ*

|  **Имя**  | **Тип**       |  **Описание**    |
| ---------- | -------------  | ------------------- |
| 200 ОК    | TokenResponse  | Запрос успешно выполнен   |
|  |  |  |

*TokenResponse*

Пример токена ответа.

``` json
  {
      "token_type": "Bearer",
      "expires_in": "3600",
      "ext_expires_in": "0",
      "expires_on": "15251…",
      "not_before": "15251…",
      "resource": "62d94f6c-d599-489b-a797-3e10e42fbe22",
      "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6ImlCakwxUmNxemhpeTRmcHhJeGRacW9oTTJZayIsImtpZCI6ImlCakwxUmNxemhpeTRmcHhJeGRacW9oTTJZayJ9…"
  }               
```

### <a name="marketplace-api-endpoint-and-api-version"></a>Конечная точка API Marketplace и версия API

Конечная точка для API Azure Marketplace имеет адрес `https://marketplaceapi.microsoft.com`.

Текущая версия API — `api-version=2017-04-15`.


### <a name="resolve-subscription"></a>Разрешение подписки

Действие POST для конечной точки разрешения позволяет пользователям разрешать токен marketplace постоянному идентификатору ресурса.  Идентификатор ресурса — это уникальный идентификатор для подписки SAAS. 

Когда пользователь перенаправляется на веб-сайт ISV, URL-адрес содержит токен в параметрах запроса. Ожидается, что ISV будет использовать этот токен и отправит запрос на его разрешение. Ответ содержит уникальный идентификатор подписки SAAS, имя, идентификатор предложения и план для ресурса. Этот токен действителен только в течение часа.

*Запрос*

**POST**

**https://marketplaceapi.microsoft.com/api/saas/subscriptions/resolve?api-version=2017-04-15**

|  **Имя параметра** |     **Описание**                                      |
|  ------------------ |     ---------------------------------------------------- |
|  api-version        |  Версия операции, используемой для этого запроса.   |
|  |  |


*Заголовки*

| **Ключ заголовка**     | **Обязательный** | **Описание**                                                                                                                                                                                                                  |
|--------------------|--------------|-----------------------------------------------------------|
| x-ms-requestid     | Нет           | Уникальное строковое значение для отслеживания запроса клиента, желательно GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа.  |
| x-ms-correlationid | Нет           | Уникальное строковое значение для операции на стороне клиента. Это значение позволяет сопоставить все события клиентской операции с событиями на стороне сервера. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа. |
| Content-type       | Да          | `application/json`                                        |
| авторизация      | Да          | Токен носителя JSON Web Token (JWT).                    |
| x-ms-marketplace-token| Да| Параметр токена запроса в URL-адресе при перенаправлении пользователя из Azure на веб-сайт SaaS независимого поставщика программного обеспечения. **Примечание.** Этот маркер является действительным только на протяжении 1 часа. Кроме того, URL-адрес декодирует полученное из браузера значение токена, прежде чем использовать его.|
|  |  |  |
  

*Текст ответа*

``` json
{
    "id": "",
    "subscriptionName": "",
    "offerId": "",
    "planId": "",
}
```

| **Имя параметра** | **Тип данных** | **Описание**                       |
|--------------------|---------------|---------------------------------------|
| идентификатор                 | String        | Идентификатор подписки SaaS          |
| subscriptionName| String| Имя подписки SaaS, которое пользователь указал в Azure при подписке на службу SaaS.|
| OfferId            | String        | Идентификатор предложения, на которое подписан пользователь. |
| planId             | String        | Идентификатор плана, на который подписан пользователь.  |
|  |  |  |


*Коды отклика*

| **Код состояния HTTP** | **Код ошибки**     | **Описание**                                                                         |
|----------------------|--------------------| --------------------------------------------------------------------------------------- |
| 200                  | `OK`                 | Токен успешно разрешен.                                                            |
| 400                  | `BadRequest`         | Отсутствуют необходимые заголовки, или указано недопустимое значение api-version. Не удалось разрешить токен, так как он имеет неправильный формат или у него истек срок действия (маркер является действительным только на протяжении 1 часа после создания). |
| 403                  | `Forbidden`          | У вызывающей стороны нет прав на выполнение этой операции.                                 |
| 429                  | `RequestThrottleId`  | Служба занята обработкой запросов. Повторите попытку позже.                                |
| 503                  | `ServiceUnavailable` | Служба временно недоступна. Повторите попытку позже.                                        |
|  |  |  |


*Заголовки ответов*

| **Ключ заголовка**     | **Обязательный** | **Описание**                                                                                        |
|--------------------|--------------|--------------------------------------------------------------------------------------------------------|
| x-ms-requestid     | Да          | Полученный от клиента идентификатор запроса.                                                                   |
| x-ms-correlationid | Да          | Идентификатор корреляции, если клиент предоставил его. В противном случае — идентификатор корреляции сервера.                   |
| x-ms-activityid    | Да          | Уникальное строковое значение для отслеживания запроса от службы. Используется для сверок любого рода. |
| Retry-After        | Нет           | Это значение устанавливается только для ответов с кодом 429.                                                                   |
|  |  |  |


### <a name="subscribe"></a>Подписаться

Конечная точка подписки позволяет пользователям создать подписку на службу SaaS с определенным планом и настроить в коммерческой системе выставление счетов.

**PUT**

**https://marketplaceapi.microsoft.com/api/saas/subscriptions/*{идентификатор_подписки}*?api-version=2017-04-15**

| **Имя параметра**  | **Описание**                                       |
|---------------------|-------------------------------------------------------|
| subscriptionId      | Уникальный идентификатор подписки SaaS, полученный после разрешения токена через API Resolve.                              |
| api-version         | Версия операции, используемой для этого запроса. |
|  |  |

*Заголовки*

|  **Ключ заголовка**        | **Обязательный** |  **Описание**                                                  |
| ------------------     | ------------ | --------------------------------------------------------------------------------------- |
| x-ms-requestid         |   Нет         | Уникальное строковое значение для отслеживания запроса клиента, желательно GUID. Если не указано, создается случайным образом и возвращается в заголовке ответа. |
| x-ms-correlationid     |   Нет         | Уникальное строковое значение для операции на стороне клиента. Это значение позволяет сопоставить все события клиентской операции с событиями на стороне сервера. Если не указано, создается случайным образом и возвращается в заголовке ответа. |
| If-Match или If-None-Match |   Нет         |   Значение ETag сильного проверяющего серверного элемента управления.                                                          |
| content-type           |   Да        |    `application/json`                                                                   |
|  авторизация         |   Да        |    Токен носителя JSON Web Token (JWT).                                               |
| x-ms-marketplace-session-mode| Нет | Флаг, позволяющий включить режим пробного запуска при подписке на предложение SaaS. Если установлен, плата за подписку не начисляется. Независимые поставщики программного обеспечения могут использовать этот флаг для тестирования. Установите значение **dryrun**.|
|  |  |  |

*Текст*

``` json
{
    "lanId": "",
}
```

| **Имя элемента** | **Тип данных** | **Описание**                      |
|------------------|---------------|--------------------------------------|
| planId           | Строковое значение (обязательное)        | Идентификатор плана, на который подписывается пользователь службы SaaS.  |
|  |  |  |

*Коды отклика*

| **Код состояния HTTP** | **Код ошибки**     | **Описание**                                                           |
|----------------------|--------------------|---------------------------------------------------------------------------|
| 202                  | `Accepted`           | Активация подписки SaaS подтверждается для указанного плана.                   |
| 400                  | `BadRequest`         | Отсутствуют обязательные заголовки, или текст JSON имеет неправильный формат. |
| 403                  | `Forbidden`          | У вызывающей стороны нет прав на выполнение этой операции.                   |
| 404                  | `NotFound`           | Подписка с указанным идентификатором не найдена.                                  |
| 409                  | `Conflict`           | Выполняется другая операция для этой подписки.                     |
| 429                  | `RequestThrottleId`  | Служба занята обработкой запросов. Повторите попытку позже.                  |
| 503                  | `ServiceUnavailable` | Служба временно недоступна. Повторите попытку позже.                          |
|  |  |  |

При получении кода отклика 202 отследите состояние операции по заголовку "Operation-location". Аутентификация выполняется так же, как для других API Marketplace.

*Заголовки ответов*

| **Ключ заголовка**     | **Обязательный** | **Описание**                                                                                        |
|--------------------|--------------|--------------------------------------------------------------------------------------------------------|
| x-ms-requestid     | Да          | Полученный от клиента идентификатор запроса.                                                                   |
| x-ms-correlationid | Да          | Идентификатор корреляции, если клиент предоставил его. В противном случае — идентификатор корреляции сервера.                   |
| x-ms-activityid    | Да          | Уникальное строковое значение для отслеживания запроса от службы. Это значение используется для сверок любого рода. |
| Retry-After        | Да          | Интервал, в течение которого клиент может проверить состояние.                                                       |
| Operation-Location | Да          | Ссылка на ресурс для получения состояния операции.                                                        |
|  |  |  |

### <a name="change-plan-endpoint"></a>Конечная точка изменения плана

Конечная точка изменения плана позволяет пользователю преобразовать план, на который он подписан, в новый план.

**PATCH**

**https://marketplaceapi.microsoft.com/api/saas/subscriptions/*{идентификатор_подписки}*?api-version=2017-04-15**

| **Имя параметра**  | **Описание**                                       |
|---------------------|-------------------------------------------------------|
| subscriptionId      | Идентификатор подписки на SaaS                              |
| api-version         | Версия операции, используемой для этого запроса. |
|  |  |

*Заголовки*

| **Ключ заголовка**          | **Обязательный** | **Описание**                                                                                                                                                                                                                  |
|-------------------------|--------------|---------------------------------------------------------------------------------------------------------------------|
| x-ms-requestid          | Нет           | Уникальное строковое значение для отслеживания запроса от клиента. Мы рекомендуем использовать GUID. Если не указано, создается случайным образом и возвращается в заголовке ответа.   |
| x-ms-correlationid      | Нет           | Уникальное строковое значение для операции на стороне клиента. Это значение позволяет сопоставить все события клиентской операции с событиями на стороне сервера. Если не указано, создается случайным образом и возвращается в заголовке ответа. |
| If-Match или If-None-Match | Нет           | Значение ETag сильного проверяющего серверного элемента управления.                              |
| content-type            | Да          | `application/json`                                        |
| авторизация           | Да          | Токен носителя JSON Web Token (JWT).                    |
|  |  |  |

*Текст*

```json
{
    "planId": ""
}
```

|  **Имя элемента** |  **Тип данных**  | **Описание**                              |
|  ---------------- | -------------   | --------------------------------------       |
|  planId           |  Строковое значение (обязательное)         | Идентификатор плана, на который подписывается пользователь службы SaaS.          |
|  |  |  |

*Коды отклика*

| **Код состояния HTTP** | **Код ошибки**     | **Описание**                                                           |
|----------------------|--------------------|---------------------------------------------------------------------------|
| 202                  | `Accepted`           | Активация подписки SaaS подтверждается для указанного плана.                   |
| 400                  | `BadRequest`         | Отсутствуют обязательные заголовки, или текст JSON имеет неправильный формат. |
| 403                  | `Forbidden`          | У вызывающей стороны нет прав на выполнение этой операции.                   |
| 404                  | `NotFound`           | Подписка с указанным идентификатором не найдена.                                  |
| 409                  | `Conflict`           | Выполняется другая операция для этой подписки.                     |
| 429                  | `RequestThrottleId`  | Служба занята обработкой запросов. Повторите попытку позже.                  |
| 503                  | `ServiceUnavailable` | Служба временно недоступна. Повторите попытку позже.                          |
|  |  |  |

*Заголовки ответов*

| **Ключ заголовка**     | **Обязательный** | **Описание**                                                                                        |
|--------------------|--------------|--------------------------------------------------------------------------------------------------------|
| x-ms-requestid     | Да          | Полученный от клиента идентификатор запроса.                                                                   |
| x-ms-correlationid | Да          | Идентификатор корреляции, если клиент предоставил его. В противном случае — идентификатор корреляции сервера.                   |
| x-ms-activityid    | Да          | Уникальное строковое значение для отслеживания запроса от службы. Это значение используется для сверок любого рода. |
| Retry-After        | Да          | Интервал, в течение которого клиент может проверить состояние.                                                       |
| Operation-Location | Да          | Ссылка на ресурс для получения состояния операции.                                                        |
|  |  |  |

### <a name="delete-subscription"></a>Удалить подписку

Действие удаления на конечной точке подписки позволяет пользователю удалить подписку с определенным идентификатором.

*Запрос*

**DELETE**

**https://marketplaceapi.microsoft.com/api/saas/subscriptions/*{идентификатор_подписки}*?api-version=2017-04-15**

| **Имя параметра**  | **Описание**                                       |
|---------------------|-------------------------------------------------------|
| subscriptionId      | Идентификатор подписки на SaaS                              |
| api-version         | Версия операции, используемой для этого запроса. |
|  |  |

*Заголовки*

| **Ключ заголовка**     | **Обязательный** | **Описание**                                                                                                                                                                                                                  |
|--------------------|--------------| ----------------------------------------------------------|
| x-ms-requestid     | Нет           | Уникальное строковое значение для отслеживания запроса от клиента. Мы рекомендуем использовать GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа.                                                           |
| x-ms-correlationid | Нет           | Уникальное строковое значение для операции на стороне клиента. Это значение позволяет сопоставить все события клиентской операции с событиями на стороне сервера. Если не указано, создается случайным образом и возвращается в заголовке ответа. |
| авторизация      | Да          | Токен носителя JSON Web Token (JWT).                    |
|  |  |  |

*Коды отклика*

| **Код состояния HTTP** | **Код ошибки**     | **Описание**                                                           |
|----------------------|--------------------|---------------------------------------------------------------------------|
| 202                  | `Accepted`           | Активация подписки SaaS подтверждается для указанного плана.                   |
| 400                  | `BadRequest`         | Отсутствуют обязательные заголовки, или текст JSON имеет неправильный формат. |
| 403                  | `Forbidden`          | У вызывающей стороны нет прав на выполнение этой операции.                   |
| 404                  | `NotFound`           | Подписка с указанным идентификатором не найдена.                                  |
| 429                  | `RequestThrottleId`  | Служба занята обработкой запросов, повторите попытку позже.                  |
| 503                  | `ServiceUnavailable` | Служба временно недоступна. Повторите попытку позже.                          |
|  |  |  |

При получении кода отклика 202 отследите состояние операции по заголовку "Operation-location". Аутентификация выполняется так же, как для других API Marketplace.

*Заголовки ответов*

| **Ключ заголовка**     | **Обязательный** | **Описание**                                                                                        |
|--------------------|--------------|--------------------------------------------------------------------------------------------------------|
| x-ms-requestid     | Да          | Полученный от клиента идентификатор запроса.                                                                   |
| x-ms-correlationid | Да          | Идентификатор корреляции, если он предоставлен клиентом, в противном случае идентификатор корреляции сервера                   |
| x-ms-activityid    | Да          | Уникальное строковое значение для отслеживания запроса от службы. Используется для сверок любого рода. |
| Retry-After        | Да          | Интервал, в течение которого клиент может проверить состояние.                                                       |
| Operation-Location | Да          | Ссылка на ресурс для получения состояния операции.                                                        |
|   |  |  |

### <a name="get-operation-status"></a>Получение состояния операции

Эта конечная точка позволяет отслеживать состояние запущенной асинхронной операции (подписка, отмена подписки, изменение плана).

*Запрос*

**GET**

**https://marketplaceapi.microsoft.com/api/saas/operations/*{идентификатор_операции}*?api-version=2017-04-15**

| **Имя параметра**  | **Описание**                                       |
|---------------------|-------------------------------------------------------|
| operationId         | Уникальный идентификатор запущенной операции.                |
| api-version         | Версия операции, используемой для этого запроса. |
|  |  |

*Заголовки*

| **Ключ заголовка**     | **Обязательный** | **Описание**                                                                                                                                                                                                                  |
|--------------------|--------------|--------------------------------------------------------------------------------------------------------------------------|
| x-ms-requestid     | Нет           | Уникальное строковое значение для отслеживания запроса от клиента. Мы рекомендуем использовать GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа.   |
| x-ms-correlationid | Нет           | Уникальное строковое значение для операции на стороне клиента. Это значение позволяет сопоставить все события клиентской операции с событиями на стороне сервера. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа.  |
| авторизация      | Да          | Токен носителя JSON Web Token (JWT).                    |
|  |  |  | 

*Текст ответа*

```json
{
    "id": "",
    "status": "",
    "resourceLocation": "",
    "created": "",
    "lastModified": ""
}
```

| **Имя параметра** | **Тип данных** | **Описание**                                                                                                                                               |
|--------------------|---------------|-------------------------------------------------------------------------------------------|
| идентификатор                 | String        | Идентификатор операции.                                                                      |
| status             | Перечисление.          | Состояние операции: `In Progress`, `Succeeded` или `Failed`.          |
| resourceLocation   | String        | Ссылка на созданную или измененную подписку. Она позволяет клиенту получить обновленное состояние после операции. Это значение не задается для операций `Unsubscribe`. |
| создано            | DateTime      | Время создания операции в формате UTC.                                                           |
| lastModified       | DateTime      | Последнее обновление операции в формате UTC.                                                      |
|  |  |  |

*Коды отклика*

| **Код состояния HTTP** | **Код ошибки**     | **Описание**                                                              |
|----------------------|--------------------|------------------------------------------------------------------------------|
| 200                  | `OK`                 | Запрос GET разрешен успешно, текст ответа содержит требуемую информацию.    |
| 400                  | `BadRequest`         | Отсутствуют необходимые заголовки, или указано недопустимое значение api-version. |
| 403                  | `Forbidden`          | У вызывающей стороны нет прав на выполнение этой операции.                      |
| 404                  | `NotFound`           | Подписка с указанным идентификатором не найдена.                                     |
| 429                  | `RequestThrottleId`  | Служба занята обработкой запросов. Повторите попытку позже.                     |
| 503                  | `ServiceUnavailable` | Служба временно недоступна. Повторите попытку позже.                             |
|  |  |  |

*Заголовки ответов*

| **Ключ заголовка**     | **Обязательный** | **Описание**                                                                                        |
|--------------------|--------------|--------------------------------------------------------------------------------------------------------|
| x-ms-requestid     | Да          | Полученный от клиента идентификатор запроса.                                                                   |
| x-ms-correlationid | Да          | Идентификатор корреляции, если он предоставлен клиентом, в противном случае идентификатор корреляции сервера                   |
| x-ms-activityid    | Да          | Уникальное строковое значение для отслеживания запроса от службы. Используется для сверок любого рода. |
| Retry-After        | Да          | Интервал, в течение которого клиент может проверить состояние.                                                       |
|  |  |  |

### <a name="get-subscription"></a>Получение подписки

Действие получения на конечной точке подписки позволяет пользователю получить подписку по определенному идентификатору ресурса.

*Запрос*

**GET**

**https://marketplaceapi.microsoft.com/api/saas/subscriptions/*{идентификатор_подписки}*?api-version=2017-04-15**

| **Имя параметра**  | **Описание**                                       |
|---------------------|-------------------------------------------------------|
| subscriptionId      | Идентификатор подписки на SaaS                              |
| api-version         | Версия операции, используемой для этого запроса. |
|  |  |

*Заголовки*

| **Ключ заголовка**     | **Обязательный** | **Описание**                                                                                           |
|--------------------|--------------|-----------------------------------------------------------------------------------------------------------|
| x-ms-requestid     | Нет           | Уникальное строковое значение для отслеживания запроса клиента, желательно GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа.                                                           |
| x-ms-correlationid | Нет           | Уникальное строковое значение для операции на стороне клиента. Это значение позволяет сопоставить все события клиентской операции с событиями на стороне сервера. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа. |
| авторизация      | Да          | Токен носителя JSON Web Token (JWT).                                                                    |
|  |  |  |

*Текст ответа*

```json
{
    "id": "",
    "saasSubscriptionName": "",
    "offerId": "",
    "planId": "",
    "saasSubscriptionStatus": "",
    "created": "",
    "lastModified": ""
}
```

| **Имя параметра**     | **Тип данных** | **Описание**                               |
|------------------------|---------------|-----------------------------------------------|
| идентификатор                     | String        | Идентификатор ресурса подписки на SaaS в Azure.    |
| offerId                | String        | Идентификатор предложения, на которое подписан пользователь.         |
| planId                 | String        | Идентификатор плана, на который подписан пользователь.          |
| saasSubscriptionName   | String        | Имя подписки на SaaS.                |
| saasSubscriptionStatus | Перечисление.          | Состояние операции.  Один из следующих типов:  <br/> - `Subscribed`: подписка активна;  <br/> - `Pending`: пользователь создал ресурс, но независимый поставщик программного обеспечения еще не активировал его;   <br/> - `Unsubscribed`: пользователь отменил подписку;   <br/> - `Suspended`: пользователь приостановил подписку;   <br/> - `Deactivated`:  подписка Azure отключена.  |
| создано                | DateTime      | Значение времени создания подписки в формате UTC. |
| lastModified           | DateTime      | Значение времени изменения подписки в формате UTC. |
|  |  |  |

*Коды отклика*

| **Код состояния HTTP** | **Код ошибки**     | **Описание**                                                              |
|----------------------|--------------------|------------------------------------------------------------------------------|
| 200                  | `OK`                 | Запрос GET разрешен успешно, текст ответа содержит требуемую информацию.    |
| 400                  | `BadRequest`         | Отсутствуют необходимые заголовки, или указано недопустимое значение api-version. |
| 403                  | `Forbidden`          | У вызывающей стороны нет прав на выполнение этой операции.                      |
| 404                  | `NotFound`           | Подписка с указанным идентификатором не найдена.                                     |
| 429                  | `RequestThrottleId`  | Служба занята обработкой запросов. Повторите попытку позже.                     |
| 503                  | `ServiceUnavailable` | Служба временно недоступна. Повторите попытку позже.                             |
|  |  |  |

*Заголовки ответов*

| **Ключ заголовка**     | **Обязательный** | **Описание**                                                                                        |
|--------------------|--------------|--------------------------------------------------------------------------------------------------------|
| x-ms-requestid     | Да          | Полученный от клиента идентификатор запроса.                                                                   |
| x-ms-correlationid | Да          | Идентификатор корреляции, если он предоставлен клиентом, в противном случае идентификатор корреляции сервера                   |
| x-ms-activityid    | Да          | Уникальное строковое значение для отслеживания запроса от службы. Используется для сверок любого рода. |
| Retry-After        | Нет           | Интервал, в течение которого клиент может проверить состояние.                                                       |
| eTag               | Да          | Ссылка на ресурс для получения состояния операции.                                                        |
|  |  |  |

### <a name="get-subscriptions"></a>Получение подписок

Действие получения на конечной точке подписки позволяет пользователю получить список подписок для всех предложений этого поставщика программного обеспечения.

*Запрос*

**GET**

**https://marketplaceapi.microsoft.com/api/saas/subscriptions?api-version=2017-04-15**

| **Имя параметра**  | **Описание**                                       |
|---------------------|-------------------------------------------------------|
| api-version         | Версия операции, используемой для этого запроса. |
|  |  |

*Заголовки*

| **Ключ заголовка**     | **Обязательный** | **Описание**                                           |
|--------------------|--------------|-----------------------------------------------------------|
| x-ms-requestid     | Нет           | Уникальное строковое значение для отслеживания запроса от клиента. Мы рекомендуем использовать GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа.             |
| x-ms-correlationid | Нет           | Уникальное строковое значение для операции на стороне клиента. Это значение позволяет сопоставить все события клиентской операции с событиями на стороне сервера. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа. |
| авторизация      | Да          | Токен носителя JSON Web Token (JWT).                    |
|  |  |  |

*Текст ответа*

```json
{
    "id": "",
    "saasSubscriptionName": "",
    "offerId": "",
    "planId": "",
    "saasSubscriptionStatus": "",
    "created": "",
    "lastModified": ""
}
```

| **Имя параметра**     | **Тип данных** | **Описание**                               |
|------------------------|---------------|-----------------------------------------------|
| идентификатор                     | String        | Идентификатор ресурса подписки на SaaS в Azure.    |
| offerId                | String        | Идентификатор предложения, на которое подписан пользователь.         |
| planId                 | String        | Идентификатор плана, на который подписан пользователь.          |
| saasSubscriptionName   | String        | Имя подписки на SaaS.                |
| saasSubscriptionStatus | Перечисление.          | Состояние операции.  Один из следующих типов:  <br/> - `Subscribed`: подписка активна;  <br/> - `Pending`: пользователь создал ресурс, но независимый поставщик программного обеспечения еще не активировал его;   <br/> - `Unsubscribed`: пользователь отменил подписку;   <br/> - `Suspended`: пользователь приостановил подписку;   <br/> - `Deactivated`:  подписка Azure отключена.  |
| создано                | DateTime      | Значение времени создания подписки в формате UTC. |
| lastModified           | DateTime      | Значение времени изменения подписки в формате UTC. |
|  |  |  |

*Коды отклика*

| **Код состояния HTTP** | **Код ошибки**     | **Описание**                                                              |
|----------------------|--------------------|------------------------------------------------------------------------------|
| 200                  | `OK`                 | Запрос GET разрешен успешно, текст ответа содержит требуемую информацию.    |
| 400                  | `BadRequest`         | Отсутствуют необходимые заголовки, или указано недопустимое значение api-version. |
| 403                  | `Forbidden`          | У вызывающей стороны нет прав на выполнение этой операции.                      |
| 404                  | `NotFound`           | Подписка с указанным идентификатором не найдена.                                     |
| 429                  | `RequestThrottleId`  | Служба занята обработкой запросов, повторите попытку позже.                     |
| 503                  | `ServiceUnavailable` | Служба временно недоступна. Повторите попытку позже.                             |
|  |  |  |

*Заголовки ответов*

| **Ключ заголовка**     | **Обязательный** | **Описание**                                                                                        |
|--------------------|--------------|--------------------------------------------------------------------------------------------------------|
| x-ms-requestid     | Да          | Полученный от клиента идентификатор запроса.                                                                   |
| x-ms-correlationid | Да          | Идентификатор корреляции, если он предоставлен клиентом, в противном случае идентификатор корреляции сервера                   |
| x-ms-activityid    | Да          | Уникальное строковое значение для отслеживания запроса от службы. Используется для сверок любого рода. |
| Retry-After        | Нет           | Интервал, в течение которого клиент может проверить состояние.                                                       |
|  |  |  |

### <a name="saas-webhook"></a>Веб-перехватчик SaaS

Веб-перехватчик SaaS используется для предварительного уведомления об изменениях в службе SaaS. Ожидается, что этот API POST не прошел проверку подлинности и будет вызываться службой Майкрософт. Ожидается, что служба SaaS вызовет операции API для проверки и авторизации, прежде чем выполнять какие-либо действия над уведомлениями веб-перехватчика. 

*Текст*

``` json
  { 
    "id": "be750acb-00aa-4a02-86bc-476cbe66d7fa",
    "activityId": "be750acb-00aa-4a02-86bc-476cbe66d7fa",
    "subscriptionId":"cd9c6a3a-7576-49f2-b27e-1e5136e57f45",
    "offerId": "sampleSaaSOffer", // Provided with "Update" action
    "publisherId": "contoso", 
    "planId": "silver",     // Provided with "Update" action
    "action": "Activate", // Activate/Delete/Suspend/Reinstate/Update
    "timeStamp": "2018-12-01T00:00:00"
  }
```

| **Имя параметра**     | **Тип данных** | **Описание**                               |
|------------------------|---------------|-----------------------------------------------|
| идентификатор  | String       | Уникальный идентификатор запущенной операции.                |
| activityId   | String        | Уникальное строковое значение для отслеживания запроса от службы. Используется для сверок любого рода.               |
| subscriptionId                     | String        | Идентификатор ресурса подписки на SaaS в Azure.    |
| offerId                | String        | Идентификатор предложения, на которое подписан пользователь. Предоставляется только с действием "Обновить".        |
| publisherId                | String        | Идентификатор издателя предложения SaaS         |
| planId                 | String        | Идентификатор плана, на который подписан пользователь. Предоставляется только с действием "Обновить".          |
| action                 | String        | Событие, которое запускает это уведомление. Допустимые значения: Activate, Delete, Suspend, Reinstate, Update          |
| timeStamp (метка времени)                 | String        | Значение метки времени в формате UTC, когда это уведомление было активировано.          |
|  |  |  |
