---
title: Представление журналов контейнеров в реальном времени в Azure Monitor | Документация Майкрософт
description: В этой статье описывается представление журналов контейнеров (stdout/stderr) и событий в режиме реального времени без использования kubectl с Azure Monitor для контейнеров.
ms.service: azure-monitor
ms.subservice: ''
ms.topic: conceptual
author: mgoedtel
ms.author: magoedte
ms.date: 07/12/2019
ms.openlocfilehash: 25cfe10ec192f874d050bca22ce1b85c2d1afbb4
ms.sourcegitcommit: ae461c90cada1231f496bf442ee0c4dcdb6396bc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/17/2019
ms.locfileid: "72554090"
---
# <a name="how-to-view-logs-and-events-in-real-time-preview"></a>Просмотр журналов и событий в режиме реального времени (Предварительная версия)
Azure Monitor для контейнеров включает в себя функцию, которая в настоящее время находится на этапе предварительной версии, которая предоставляет интерактивное представление журналов контейнеров Azure Kubernetes Service (stdout/stderr) и событий без необходимости выполнять команды kubectl. При выборе любого из этих параметров Новая панель отображается под таблицей данных о производительности на **узлах**, **контроллерах**и в представлении **контейнеров** . Он показывает ведение журнала и события, созданные модулем контейнеров, для дальнейшей помощи в устранении неполадок в режиме реального времени.

>[!NOTE]
>Эта функция доступна во всех регионах Azure, включая Azure для Китая. Сейчас она недоступна в Azure для государственных организаций США.

>[!NOTE]
>Для работы этой функции требуется доступ к **роли пользователя кластера службы Kubernetes Azure** для ресурса кластера. Дополнительные [сведения о роли пользователя кластера Azure Kubernetes](https://docs.microsoft.com/en-us/azure/aks/control-kubeconfig-access#available-cluster-roles-permissions).

Журналы в реальном времени поддерживают три разных метода управления доступом к журналам.

1. AKS без включенной авторизации Kubernetes RBAC;
2. AKS со включенной авторизацией Kubernetes RBAC;
3. AKS с поддержкой единого входа Azure Active Directory (AD) на основе SAML

## <a name="kubernetes-cluster-without-rbac-enabled"></a>Кластер Kubernetes без включенного RBAC
 
Если для кластера Kubernetes не настроена авторизация Kubernetes RBAC или он не интегрирован с единым входом Azure AD, вам не нужно выполнять следующие действия. Так как авторизация Kubernetes использует kube-api, требуются разрешения только для чтения.

## <a name="kubernetes-rbac-authorization"></a>Авторизация Kubernetes RBAC
Если вы включили авторизацию Kubernetes RBAC, необходимо будет применить привязку роли кластера. Ниже приведены шаги по настройке привязки роли кластера на основе этого YAML-файла с шаблоном конфигурации. 

1. Скопируйте и вставьте YAML-файл, а затем сохраните его как LogReaderRBAC.yaml.  

    ```
    apiVersion: rbac.authorization.k8s.io/v1 
    kind: ClusterRole 
    metadata: 
       name: containerHealth-log-reader 
    rules: 
       - apiGroups: [""] 
         resources: ["pods/log", "events"] 
         verbs: ["get", "list"]  
    --- 
    apiVersion: rbac.authorization.k8s.io/v1 
    kind: ClusterRoleBinding 
    metadata: 
       name: containerHealth-read-logs-global 
    roleRef: 
        kind: ClusterRole 
        name: containerHealth-log-reader 
        apiGroup: rbac.authorization.k8s.io 
    subjects: 
       - kind: User 
         name: clusterUser 
         apiGroup: rbac.authorization.k8s.io
    ```

2. Если вы настраиваете его в первый раз, примените привязку правила кластера, выполнив следующую команду: `kubectl create -f LogReaderRBAC.yaml`. Если ранее вы включили поддержку интерактивной предварительной версии журналов, прежде чем появились динамические журналы событий, для обновления конфигурации выполните следующую команду: `kubectl apply -f LogReaderRBAC.yaml`.

## <a name="configure-aks-with-azure-active-directory"></a>Настройка AKS с Azure Active Directory

Службу Azure Kubernetes можно настроить на использование Azure Active Directory (AD) для аутентификации пользователей. Если вы настраиваете его в первый раз, см. статью [интеграция Azure Active Directory со службой Kubernetes Azure](../../aks/azure-ad-integration.md). В ходе действий по созданию [клиентского приложения](../../aks/azure-ad-integration.md#create-the-client-application)укажите следующие сведения.

-  **URI перенаправления**: необходимо создать два типа **веб-** приложений. Первое значение базового URL-адреса должно быть `https://afd.hosting.portal.azure.net/monitoring/Content/iframe/infrainsights.app/web/base-libs/auth/auth.html`, а второе значение базового URL-адреса должно быть `https://monitoring.hosting.portal.azure.net/monitoring/Content/iframe/infrainsights.app/web/base-libs/auth/auth.html`.
- После регистрации приложения на странице **Обзор** выберите **Проверка подлинности** на панели слева. На странице **Проверка подлинности** в разделе **Дополнительные параметры** неявным образом предоставьте **маркеры доступа** и **маркеры идентификации** , а затем сохраните изменения.

>[!NOTE]
>Если вы используете эту функцию в регионе Azure для Китая, первое значение базового URL-адреса должно быть `https://afd.hosting.azureportal.chinaloudapi.cn/monitoring/Content/iframe/infrainsights.app/web/base-libs/auth/auth.html`, а второе значение базового URL-адреса должно быть `https://monitoring.hosting.azureportal.chinaloudapi.cn/monitoring/Content/iframe/infrainsights.app/web/base-libs/auth/auth.html`.

>[!NOTE]
>Настройка проверки подлинности с помощью Azure Active Directory для единого входа может быть выполнена только во время первоначального развертывания нового кластера AKS. Настроить единый вход для кластера AKS, который уже развернут, невозможно.
  
>[!IMPORTANT]
>Если вы настроили Azure AD для проверки подлинности пользователя с помощью обновленного URI, очистите кэш браузера, чтобы убедиться, что обновленный маркер проверки подлинности скачан и применен.   

## <a name="view-live-logs-and-events"></a>Просмотр журналов и событий в реальном времени

События журнала в реальном времени можно просматривать по мере их создания подсистемой контейнеров из представления **узлов**, **контроллеров**и **контейнеров** . На панели «Свойства» выберите параметр **Просмотреть динамические данные (Предварительная версия)** , и появится область под таблицей данных о производительности, в которой можно просмотреть журнал и события в непрерывном потоке.

![Параметр "Просмотреть динамические журналы" в области "Свойства узла"](./media/container-insights-live-logs/node-properties-live-logs-01.png)  

Сообщения журнала и событий ограничены в зависимости от типа ресурса, выбранного в представлении.

| Показать | Тип ресурса | Журнал или событие | Представленные данные |
|------|---------------|--------------|----------------|
| Узлы | Узел | Мероприятие | Если узел выбран, события не фильтруются и не отображаются события Kubernetes на уровне кластера. В заголовке панели отображается имя кластера. |
| Узлы | Pod | Мероприятие | При выборе типа POD события фильтруются по его пространству имен. В заголовке области отображается пространство имен Pod. | 
| Controllers; | Pod | Мероприятие | При выборе типа POD события фильтруются по его пространству имен. В заголовке области отображается пространство имен Pod. |
| Controllers; | Controller | Мероприятие | Если контроллер выбран, события фильтруются по его пространству имен. В заголовке панели показано пространство имен контроллера. |
| Узлы, контроллеры и контейнеры | Контейнер | Журналы | В заголовке области отображается имя Pod, с которым будет сгруппирован контейнер. |

Если для кластера AKS настроен единый вход через AAD, вам будет предложено выполнить аутентификацию при первом использовании в этом сеансе браузера. Выберите свою учетную запись и выполните аутентификацию с помощью Azure.  

Когда аутентификация будет успешно пройдена, в нижнем разделе средней области отобразится область динамических журналов. Если в строке индикатора состояния получения отображается зеленая галочка (справа в области), это означает, что данные могут быть получены.
    
  ![Извлеченные данные из области динамических журналов](./media/container-insights-live-logs/live-logs-pane-01.png)  

На панели поиска можно отфильтровать по ключевому слову, чтобы выделить текст в журнале или событии, а на панели поиска — в крайнем правом — показать, сколько результатов соответствует фильтру.

  ![Пример фильтра области динамических журналов](./media/container-insights-live-logs/live-logs-pane-filter-example-01.png)

При просмотре событий можно дополнительно ограничить результаты с помощью **фильтра** пилюля, найденного справа от строки поиска. В зависимости от выбранного ресурса пилюля перечисляет модуль, пространство имен или кластер для выбора.  

Чтобы приостановить автоматическую прокрутку и управлять поведением панели и выполнить прокрутку новых данных вручную, щелкните параметр **прокрутки** . Чтобы повторно включить автоматическую прокрутку, просто нажмите кнопку **прокрутки** еще раз. Вы также можете приостановить получение данных журнала или события, щелкнув параметр **приостановить** и когда все будет готово к возобновлению, просто нажмите кнопку **воспроизвести**.  

![Представление в реальном времени, в котором приостановлено извлечение, в области динамических журналов](./media/container-insights-live-logs/live-logs-pane-pause-01.png)

Вы можете перейти в Azure Monitor журналы, чтобы просмотреть журналы журналов контейнеров, выбрав пункт **Просмотр журналов контейнеров** в раскрывающемся списке **в разделе Аналитика**.

## <a name="next-steps"></a>Дальнейшие действия

- Чтобы продолжить изучение способов использования Azure Monitor и отслеживать другие аспекты кластера AKS, ознакомьтесь со статьей [Общие сведения о мониторинге производительности кластера AKS с помощью Azure Monitor для контейнеров (предварительная версия)](container-insights-analyze.md).

- Просмотрите [примеры запросов журналов](container-insights-log-search.md#search-logs-to-analyze-data) , чтобы просмотреть предварительно определенные запросы и примеры для проверки или настройки предупреждений, визуализации или анализа кластеров.
