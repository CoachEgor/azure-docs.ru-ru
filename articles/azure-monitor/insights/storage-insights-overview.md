---
title: Мониторинг служб хранилища Azure с помощью Azure Monitor для хранилища (Предварительная версия) | Документация Майкрософт
description: В этой статье описывается Azure Monitor для функции хранения, которая предоставляет администраторам хранилища быстрое понимание проблем с производительностью и использованием учетных записей хранения Azure.
services: azure-monitor
documentationcenter: ''
author: mgoedtel
manager: carmonm
editor: tysonn
ms.assetid: ''
ms.service: azure-monitor
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/15/2019
ms.author: magoedte
ms.openlocfilehash: 17135f896140a843dd95c8d9624e9faf1d7194c3
ms.sourcegitcommit: 1752581945226a748b3c7141bffeb1c0616ad720
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/14/2019
ms.locfileid: "70996246"
---
# <a name="monitoring-your-storage-service-with-azure-monitor-for-storage-preview"></a>Мониторинг службы хранилища с помощью Azure Monitor для хранилища (Предварительная версия)

Azure Monitor для хранилища (Предварительная версия) обеспечивает полный мониторинг учетных записей хранения Azure, обеспечивая единое представление производительности, емкости и доступности служб хранилища Azure. Можно наблюдать за емкостью хранилища и двумя способами: просматривать их непосредственно из учетной записи хранения или представления из Azure Monitor для просмотра групп учетных записей хранения. 

Эта статья поможет вам разобраться в работе Azure Monitor хранилища (Предварительная версия), чтобы получить ценные знания о работоспособности и производительности учетных записей хранения в масштабе, с возможностью сосредоточиться на хот-спотах и диагностировать задержку, регулирование, и проблемы доступности.

## <a name="introduction-to-azure-monitor-for-storage-preview"></a>Общие сведения о Azure Monitor для хранилища (Предварительная версия)

Прежде чем углубляться в опыт, необходимо понять, как она представляет и визуализирует информацию. Независимо от того, выбрана ли функция хранилища непосредственно в учетной записи хранения или Azure Monitor, Azure Monitor для хранения обеспечивает единообразную работу. 

В объединении ИТ:

* **В перспективе с масштабом** отображается моментальный снимок их доступности в зависимости от работоспособности службы хранилища или операции API, использование показывает общее количество запросов, получаемых службой хранилища, и время задержки, показывающее среднее время, в течение которого Служба хранилища или тип операции API принимает запросы. Кроме того, можно просматривать емкость по большому двоичному объекту, файлу, таблице и очереди.

* **Детализированный анализ** конкретной учетной записи хранения для диагностики проблем или выполнения подробного анализа по категориям, производительности, сбоям и емкости. Выбор любого из этих параметров обеспечивает подробное представление метрик.  

* **Настраиваемое** расположение позволяет изменить отображаемые метрики, изменить или задать пороговые значения, которые будут согласованы с вашими ограничениями, и сохранить как собственную книгу. Диаграммы в книге можно закрепить на панели мониторинга Azure.  

Эта функция не требует включения или настройки. метрики хранилища из учетных записей хранения собираются по умолчанию. Если вы не знакомы с метриками, доступными в службе хранилища Azure, просмотрите описание и определение в метриках службы хранилища Azure, просмотрев [метрики службы хранилища Azure](../../storage/common/storage-metrics-in-azure-monitor.md).

>[!NOTE]
>Плата за доступ к этой функции не взимается, и плата взимается только за Azure Monitorные дополнительные функции, которые вы настраиваете или включаете, как описано на странице [сведений о ценах на Azure Monitor](https://azure.microsoft.com/pricing/details/monitor/) .

>[!NOTE]
>Azure Monitor для хранилища не поддерживает [учетные записи общего назначения v1](../../storage/common/storage-account-overview.md#general-purpose-v1-accounts).
>

## <a name="view-from-azure-monitor"></a>Просмотреть из Azure Monitor

В Azure Monitor можно просматривать сведения о транзакциях, задержках и емкости из нескольких учетных записей хранения в подписке, а также выявление проблем производительности, емкости и сбоев.

Чтобы просмотреть сведения об использовании и доступности учетных записей хранения во всех подписках, выполните следующие действия.

1. Войдите на [портале Azure](https://portal.azure.com).

2. Выберите **монитор** в области слева в портал Azure и в разделе **аналитика** выберите **учетные записи хранения (Предварительная версия)** .

    ![Представление нескольких учетных записей хранения](./media/storage-insights-overview/multiple-storage-accounts-view-01.png)

### <a name="overview-workbook"></a>Обзорная книга

В книге **Обзор** для выбранной подписки в таблице отображаются метрики интерактивного хранилища и состояние доступности службы для 10 учетных записей хранения, сгруппированных в рамках подписки. Результаты можно фильтровать на основе параметров, выбранных в следующих раскрывающихся списках:

* **Подписки** . перечислены только подписки с учетными записями хранения.  

* **Учетные записи хранения** . по умолчанию предварительно выбраны 10 учетных записей хранения. Если в селекторе области выбрать все или несколько учетных записей хранения, будут возвращены учетные записи хранения размером до 200. Например, если у вас есть 573 учетных записей хранения в трех выбранных подписках, отобразятся только учетные записи 200. 

* **Диапазон времени** — по умолчанию отображает данные за последние 4 часа на основе соответствующих параметров.

Плитка счетчиков в раскрывающихся списках обозначает общее количество учетных записей хранения в подписке и показывает, сколько из них выбрано. Существует условное выделение цветом или тепловые карты для столбцов в книге, которые сообщают метрики транзакций или ошибки. Самый глубокий цвет имеет наибольшее значение, а светлый — на основе наименьших значений. Для столбцов, основанных на ошибках, значение выделяется красным цветом, а для столбцов на основе метрика — синим.

Выберите значение в столбцах **доступность**, **E2E задержка**, **Задержка сервера**и **Ошибка транзакции** . указывает отчет, адаптированный к определенному типу метрик хранилища, соответствующий столбцу, выбранному для этого Учетная запись хранения. Дополнительные сведения о книгах для каждой категории см. в разделе " [подробные книги хранилища](#detailed-storage-workbooks) " ниже. 

>[!NOTE]
>Дополнительные сведения о том, какие ошибки могут отображаться в отчете, см. в разделе [схема типа ответа](../../storage/common/storage-metrics-in-azure-monitor.md#metrics-dimensions) и найдите такие типы ответов, как **серверосереррор**, **клиентосереррор**, **ClientThrottlingError**. В зависимости от выбранных учетных записей хранения, если обнаружено более трех типов ошибок, все остальные ошибки представлены в категории **другой**.

По умолчанию пороговое значение **доступности** :

* Предупреждение — 99%
* Критический — 90%

Чтобы установить пороговое значение доступности на основе результатов наблюдения или требований, см. раздел [Изменение порога доступности](#modify-the-availability-threshold). 

### <a name="capacity-workbook"></a>Книга емкости

В верхней части страницы выберите **емкость** , после чего откроется книга **емкость** . Он показывает объем общего хранилища, используемого в учетной записи и емкости, используемой каждой службой данных в учетной записи для выявления и использования хранилища.

![Книга с несколькими учетными записями хранения](./media/storage-insights-overview/storage-account-capacity-02.png) 

Существует условное выделение цветом или тепловые карты для столбцов в книге, которые сообщают метрики емкости с синим значением. Самый глубокий цвет имеет наибольшее значение, а светлый — на основе наименьших значений.

При выборе значения в одном из столбцов книги выполняется детализация в книге **емкости** для учетной записи хранения. Дополнительные сведения о детализированном отчете описаны в разделе " [подробные книги хранилища](#detailed-storage-workbooks) " ниже. 

## <a name="view-from-a-storage-account"></a>Просмотр из учетной записи хранения

Чтобы получить доступ к Azure Monitor для виртуальных машин непосредственно из учетной записи хранения, выполните следующие действия.

1. В портал Azure выберите учетные записи хранения.

2. В списке выберите учетную запись хранения. В разделе Мониторинг выберите Insights (Предварительная версия).

    ![Страница обзора выбранной учетной записи хранения](./media/storage-insights-overview/storage-account-direct-overview-01.png)

В книге **Обзор** для учетной записи хранения отображается несколько метрик производительности хранилища, которые помогут вам быстро оценить следующее:

* Работоспособность службы хранилища позволяет немедленно определить, что неполадка за пределами вашего элемента управления влияет на службу хранилища в регионе, в котором она развернута, что указано в столбце " **Сводка** ".

* Интерактивные диаграммы производительности с самыми важными сведениями, относящимися к емкости, доступности, транзакциям и задержкам хранилища.  

* Плитки метрик и состояния выделяют доступность службы, общее число транзакций в службу хранилища, E2E задержку и задержку сервера.

Если выбрать одну из кнопок для **сбоев**, **производительности**, **доступности**и **емкости** , откроется соответствующая книга. 

![Страница обзора выбранной учетной записи хранения](./media/storage-insights-overview/storage-account-capacity-01.png)

## <a name="detailed-storage-workbooks"></a>Подробные книги хранилища

Выбрано ли значение в столбцах **доступность**, **E2E задержка**, **Задержка сервера**и **тип ошибки транзакции** , из книги **обзора** нескольких учетных записей хранения или выбор одной из кнопок для **Сбои**, **производительность**, **доступность**и **емкость** в книге " **Обзор** " из определенной учетной записи хранения. Каждая из них поставляет набор интерактивных сведений, связанных с хранилищем, адаптированных к этой категории.  

* **Доступность** открывает книгу **доступности** . В нем отображается текущее состояние работоспособности службы хранилища Azure, таблица, показывающая доступное состояние работоспособности каждого объекта, отнесенного к службе данных, определенной в учетной записи хранения, с линией тренда, представляющей выбранный диапазон времени, и диаграммой тенденций доступности для Каждая служба данных в учетной записи.  

    ![Пример отчета о доступности](./media/storage-insights-overview/storage-account-availability-01.png)

* **E2E задержка** и **Задержка сервера** открывает книгу " **производительность** ". Он включает плитку состояния свертки, показывающую задержку E2E и задержку сервера, диаграмму производительности E2E и задержку сервера, а также таблицу, разворачивающую задержку успешных вызовов API, упорядоченных по службе данных, определенной в учетной записи хранения.

    ![Пример отчета о производительности](./media/storage-insights-overview/storage-account-performance-01.png)

* Выбрав любую из категорий ошибок, перечисленных в сетке, откройте книгу **сбой** . В отчете отображаются плитки метрик всех прочих ошибок на стороне клиента, за исключением описанных и успешных запросов, ошибок регулирования клиента, диаграммы производительности для **типа ответа транзакции тип** метрики, относящийся к атрибуту клиентосереррор и две таблицы — **транзакции по имени API** и **транзакциям по типу ответа**.

   ![Пример отчета о сбое](./media/storage-insights-overview/storage-account-failures-01.png)

* **Емкость** открывает книгу **емкости** . Он показывает общий объем хранилища, используемого для каждого объекта данных хранилища в учетной записи на плитках и диаграмме, а также количество объектов данных, хранящихся в учетной записи.  

    ![Страница выбранной емкости учетной записи хранения](./media/storage-insights-overview/storage-account-capacity-01.png) 

## <a name="pin-and-export"></a>Закрепление и экспорт

Вы можете закрепить один из разделов метрик на панели мониторинга Azure, щелкнув значок канцелярской кнопки в правом верхнем углу раздела.

![Пример закрепления раздела метрики на панели мониторинга](./media/storage-insights-overview/workbook-pin-example.png)

**Общие сведения о** нескольких подписках и учетных записях хранения, а также книги **емкости** поддерживают экспорт результатов в формате Excel, щелкнув значок со стрелкой вниз справа от значка канцелярской кнопки.

![Пример экспорта результатов сетки книги](./media/storage-insights-overview/workbook-export-example.png)

## <a name="customize-azure-monitor-for-storage-preview"></a>Настройка Azure Monitor для хранилища (Предварительная версия)

В этом разделе описываются распространенные сценарии редактирования книги для настройки в целях поддержки потребностей в анализе данных.

* Область действия книги всегда выбирайте определенную подписку или учетную запись хранения
* Изменение метрик в сетке
* Изменение порога доступности
* Изменение отображения цвета

Настройки сохраняются в пользовательской книге, чтобы предотвратить перезапись конфигурации по умолчанию в нашей опубликованной книге. Книги сохраняются в группе ресурсов либо в разделе **Мои отчеты** , который является частным, либо в разделе **Общие отчеты** , доступном всем пользователям с доступом к группе ресурсов. После сохранения пользовательской книги необходимо перейти в коллекцию книг, чтобы запустить ее.

![Запуск коллекции книг на панели команд](./media/storage-insights-overview/workbook-command-bar-gallery.png)

### <a name="specifying-a-subscription-or-storage-account"></a>Указание подписки или учетной записи хранения

Вы можете настроить **Общие сведения о** нескольких подписках и учетных записях хранения или рабочих книгах **емкости** , чтобы их можно было использовать в определенных подписках или учетных записях хранения при каждом запуске, выполнив следующие действия.

1. Выберите **монитор** на портале, а затем в области слева выберите **учетные записи хранения (Предварительная версия)** .

2. В рабочей книге **Обзор** на панели команд выберите **изменить**.

3. В раскрывающемся списке **подписки** выберите одну или несколько подписок, по умолчанию для которых требуется. Помните, что книга поддерживает выбор всего 10 подписок.  

4. Выберите из раскрывающегося списка **учетные записи хранения** одну или несколько учетных записей, по которым она должна быть по умолчанию. Помните, что книга поддерживает выбор всего 200 учетных записей хранения. 

5. Выберите команду **Сохранить как** на панели команд, чтобы сохранить копию книги с вашими настройками, а затем нажмите кнопку **Готово к редактированию** , чтобы вернуться в режим чтения.  

### <a name="modify-metrics-and-colors-in-the-workbook"></a>Изменение метрик и цветов в книге

Предварительно созданные книги содержат данные метрик, и вы можете изменять или удалять любую из визуализаций и настраивать конкретные потребности вашей команды. 

В нашем примере мы работаем с книгой о емкости нескольких подписок и учетных записей хранения, чтобы продемонстрировать, как:

* Удаление метрики
* Изменение цветовой отрисовки

Одни и те же изменения можно выполнить для любой из книг, готовых к построению **сбоев**, **производительности**, **доступности**и **емкости** .

1. Выберите **монитор** на портале, а затем в области слева выберите **учетные записи хранения (Предварительная версия)** .

2. Выберите **емкость** , чтобы переключиться на книгу емкости и на панели команд выберите **изменить** на панели команд.

    ![Выберите Изменить, чтобы изменить книгу](./media/storage-insights-overview/workbook-edit-workbook.png)

3. Рядом с разделом метрики выберите **изменить**. 

    ![Выберите Изменить, чтобы изменить метрики книги емкости](./media/storage-insights-overview/edit-metrics-capacity-workbook-01.png)

4. Мы удалим столбец **временной шкалы используемой учетной записи** , поэтому выберите **Параметры столбца** в сетке метрик.

    ![Изменить параметры столбца](./media/storage-insights-overview/edit-capacity-workbook-resource-grid.png)

5. В области **изменить параметры столбца** выберите в разделе **столбцы** , **временная шкала Microsoft. Storage/storageaccounts-Capacity-используемая емкость составляет $ | Для учетной записи используется временная шкала емкости $** , а в раскрывающемся списке **Визуализатор столбца** выберите **скрытый**. 

6. Нажмите кнопку **сохранить и закрыть** , чтобы зафиксировать изменения.

Теперь изменим цветовую тему для метрик емкости в отчете, чтобы использовать зеленый вместо синего.

1. Выберите **Параметры столбца** в сетке метрик.

2. В области **изменить параметры столбца** выберите в разделе **столбцы** **Microsoft. хранилище/storageaccounts-Capacity-используемая емкость составляет $ | Microsoft. хранилище/storageaccounts/блобсервицес-Capacity-BlobCapacity $ | Microsoft. Storage/ storageaccounts/филесервицес-Capacity-ФилекапаЦити $ | Microsoft. Storage/storageaccounts/куеуесервицес-емкости-КуеуекапаЦити $ | Microsoft. Storage/storageaccounts/таблесервицес-Capacity-ТаблекапаЦити $** . В раскрывающемся списке **цветовая палитра**выберите **зеленый**.

3. Нажмите кнопку **сохранить и закрыть** , чтобы зафиксировать изменения.

4. Выберите команду **Сохранить как** на панели команд, чтобы сохранить копию книги с вашими настройками, а затем нажмите кнопку **Готово к редактированию** , чтобы вернуться в режим чтения.  

### <a name="modify-the-availability-threshold"></a>Изменение порога доступности

В этом примере мы работаем с книгой "емкость учетной записи хранения" и показывая, как изменить пороговое значение доступности. По умолчанию доступность отчета "плитка и сетка" настраивается с минимальным пороговым значением 90 и максимальным пороговым значением 99. Мы планируем изменить минимальное пороговое значение **доступности%** в таблице **доступности по имени API** на 85%, что означает, что состояние работоспособности меняется на критическое, если порог меньше 85%. 

1. Выберите **учетные записи хранения** на портале, а затем выберите учетную запись хранения из списка.

2. Выберите **Insights (Предварительная версия)** в левой области.

3. В книге выберите **доступность** , чтобы переключиться в книгу доступности, а затем выберите **изменить** на панели команд. 

4. Прокрутите страницу вниз до нижней части страницы и в левой части рядом с сеткой **доступность по API** выберите **изменить**.

    ![Изменение доступности по параметрам сетки имен API](./media/storage-insights-overview/availability-workbook-avail-by-apiname.png)

5. Выберите **Параметры столбца** , а затем в области **изменить параметры столбца** в разделе **столбцы** выберите **доступность (%). (Пороговые значения + отформатированный)** .

6. Измените значение **критического** состояния работоспособности с **90** на **85** , а затем нажмите кнопку **сохранить и закрыть**.

    ![Изменение порогового значения доступности для критического состояния](./media/storage-insights-overview/edit-column-settings-capacity-workbook-01.png)

7. Выберите команду **Сохранить как** на панели команд, чтобы сохранить копию книги с вашими настройками, а затем нажмите кнопку **Готово к редактированию** , чтобы вернуться в режим чтения.

## <a name="troubleshooting"></a>Устранение неполадок

Этот раздел поможет вам в диагностике и устранении неполадок некоторых распространенных проблем, которые могут возникнуть при использовании Azure Monitor для хранения (Предварительная версия). Чтобы найти информацию о конкретной проблеме, просмотрите список ниже.

### <a name="resolving-performance-capacity-or-availability-issues"></a>Устранение проблем с производительностью, емкостью или доступностью

Чтобы помочь в устранении проблем, связанных с хранилищем, которые можно определить с помощью Azure Monitor для хранилища (Предварительная версия), см. [руководство по устранению неполадок](../../storage/common/storage-monitoring-diagnosing-troubleshooting.md#troubleshooting-guidance)службы хранилища Azure.  

## <a name="next-steps"></a>Следующие шаги

* Настройте [оповещения метрик](../platform/alerts-metric.md) и [уведомления о работоспособности службы](../../service-health/alerts-activity-log-service-notifications.md) , чтобы настроить автоматическое оповещение для облегчения обнаружения проблем.

* Ознакомьтесь с книгами сценариев, предназначенными для поддержки, создания новых и настройки существующих отчетов и многого другого, изучив [Создание интерактивных отчетов с помощью Azure Monitor книг](../app/usage-workbooks.md).

* Дополнительные указания о функциях аналитики хранилища и других инструментах идентификации, диагностики и устранения неполадок, связанных со службой хранилища Azure, см. в статье [Мониторинг, диагностика и устранение неполадок службы хранилища Microsoft Azure](../../storage/common/storage-monitoring-diagnosing-troubleshooting.md).
