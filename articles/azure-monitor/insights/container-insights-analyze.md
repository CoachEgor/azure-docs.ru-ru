---
title: Мониторинг производительности кластера AKS с Azure Monitor для контейнеров | Документация Майкрософт
description: В этой статье описывается, как можно просматривать и анализировать производительность и данные журналов с помощью Azure Monitor для контейнеров.
services: azure-monitor
documentationcenter: ''
author: mgoedtel
manager: carmonm
editor: ''
ms.assetid: ''
ms.service: azure-monitor
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 05/18/2019
ms.author: magoedte
ms.openlocfilehash: 531e51fbddb99ebba11284d5291b4cca26559bc1
ms.sourcegitcommit: 67625c53d466c7b04993e995a0d5f87acf7da121
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/20/2019
ms.locfileid: "65906774"
---
# <a name="understand-aks-cluster-performance-with-azure-monitor-for-containers"></a>Общие сведения о производительности кластера AKS с Azure Monitor для контейнеров 
С помощью диаграмм производительности и состояния работоспособности в Azure Monitor для контейнеров вы можете наблюдать производительность кластеров Службы Azure Kubernetes (AKS) с двух перспектив: напрямую из кластера AKS или всех AKS кластеров в подписке из Azure Monitor. Просмотр Экземпляров контейнеров Azure (ACI) возможен также при мониторинге конкретного кластера AKS.

Эта статья поможет вам понять, как взаимодействуют две перспективы, и поможет быстро оценить, изучить и устранить обнаруженные проблемы.

Дополнительные сведения о включении Azure Monitor для контейнеров см. в статье [How to onboard Azure Monitor for containers](container-insights-onboard.md) (Подключение Azure Monitor для контейнеров).

Azure Monitor предоставляет мультикластерной представление, отображающее состояние работоспособности всех отслеживаемых AKS кластеров под управлением Linux и Windows Server 2019 развертывания между группами ресурсов в ваших подписках.  Он показывает обнаруженные кластеры AKS, которые не отслеживаются этим решением. Вы сразу же сможете получить сведения о работоспособности кластера. Отсюда можно перейти на страницу производительности узла и контроллера или перейти к диаграммам производительности для кластера.  Для кластеров AKS, обнаруженных и определенных как неотслеживаемые, вы можете в любой момент включить мониторинг.  

Ниже перечислены основные различия мониторинг кластера Windows Server с Azure Monitor для контейнеров, по сравнению с кластера Linux.

- Метрика RSS памяти недоступен для узла Windows и контейнеры 
- Сведения о емкости диска хранилища недоступна для узлов Windows
- За исключением журналы контейнера Windows доступна поддержка оперативных журналов.
- Только pod, которые отслеживаются сред, а не сред Docker.
- С помощью предварительной версии поддерживается не более 30 контейнеры Windows Server. Это ограничение не применяется для контейнеров Linux.  

## <a name="sign-in-to-the-azure-portal"></a>Войдите на портал Azure
Войдите на [портале Azure](https://portal.azure.com). 

## <a name="multi-cluster-view-from-azure-monitor"></a>Мультикластерное представление из Azure Monitor 
Чтобы просмотреть состояние работоспособности всех развернутых кластеров AKS, в области слева на портале Azure выберите **Монитор**.  В разделе **Аналитика** выберите **Контейнеры**.  

![Пример мультикластерной панели мониторинга Azure Monitor](./media/container-insights-analyze/azmon-containers-multiview.png)

На вкладке **Monitored clusters** (Отслеживаемые кластеры) можно получить следующие сведения.

1. Сколько кластеров находятся в критическом состоянии или в состоянии неработоспособности, а сколько — работоспособны или не передают данные (то есть имеют неизвестное состояние).
2. Все ли мои развертывания [подсистемы Azure Kubernetes (подсистема AKS)](https://github.com/Azure/aks-engine) работоспособны?
3. Сколько узлов, пользователей и групп POD системы развертываются на кластер?
4. Место на диске доступен и проблема существует емкости?

Здесь используются следующие состояния работоспособности: 

* **Исправно.** Для виртуальной машины не обнаружено никаких проблем, и она работает так, как нужно. 
* **Critical** (Критическое). Обнаружена одна или несколько критических проблем, которые необходимо устранить для восстановления рабочего состояния.
* **Предупреждение.** Обнаружена одна или несколько проблем, без устранения которых состояние работоспособности может стать критическим.
* **Unknown** (Неизвестно). Если службе не удается установить соединение с узлом или модулем pod, устанавливается "неизвестное" состояние работоспособности.
* **Не найден**. Рабочая область, группа ресурсов или подписка, содержащая рабочую область для этого решения, удалена.
* **Не авторизовано**. Пользователь не имеет необходимых разрешений для чтения данных в рабочей области.
* **Ошибка**. Произошла ошибка при попытке чтения данных из рабочей области.
* **Неверно настроено**. Azure Monitor для контейнеров неправильно настроено в указанной рабочей области.
* **Нет данных**. За последние 30 минут данные не поступали в рабочую область.

Состояние работоспособности вычисляет общее состояние кластера, как *наихудшему* трех состояний за одним исключением — Если выполняется одно из трех состояний *Неизвестный*, будет показано общее состояние кластера **Unknown**.  

В следующей таблице приведена разбивка вычисления, управляющего состояниями работоспособности для отслеживаемого кластера в мультикластерном представлении.

| |Status |Доступность |  
|-------|-------|-----------------|  
|**Пользовательский модуль pod**| | |  
| |Работоспособна |100% |  
| |Предупреждение |90–99 % |  
| |критические ошибки. |<90 % |  
| |Unknown |Если данные не предоставляются в течение последних 30 минут |  
|**Системный модуль pod**| | |  
| |Работоспособна |100% |
| |Предупреждение |Н/Д |
| |критические ошибки. |<100 % |
| |Unknown |Если данные не предоставляются в течение последних 30 минут |
|**Node** | | |
| |Работоспособна |>85 % |
| |Предупреждение |60–84 % |
| |критические ошибки. |<60 % |
| |Unknown |Если данные не предоставляются в течение последних 30 минут |

Из списка кластеров можно перейти на страницу **Кластер**, щелкнув имя кластера, на страницу производительности **Узлы**, щелкнув свертку узлов в столбце **Узлы** для определенного кластера, или перейти на страницу производительности **Контроллеры**, выбрав свертку столбца **Пользовательские pod** или **Системные pod**.   

## <a name="view-performance-directly-from-an-aks-cluster"></a>Просмотр производительности непосредственно из кластера AKS
Доступ к Azure Monitor для контейнеров можно получить непосредственно из кластера AKS, выбрав **Аналитику** в области слева. Просмотреть сведения о кластере AKS можно посредством четырех перспектив:

- Кластер
- Nodes 
- Контроллеры  
- Контейнеры

Страница, которая по умолчанию открывается при выборе **Аналитики**, – это **Кластер**. Она включает четыре линейные диаграммы производительности, отображающие ключевые метрики производительности кластера. 

![Пример диаграммы производительности на вкладке "Кластер"](./media/container-insights-analyze/containers-cluster-perfview.png)

На диаграмме производительности отображаются четыре метрики производительности:

- **Использование ЦП узла&nbsp;%**: совокупная перспектива использования ЦП для всего кластера. Результаты для диапазона времени можно отфильтровать, выбрав **Avg**, **Min**, **Max**, **50**, **90** и **95** в селекторе процентилей над диаграммой (по отдельности или вместе). 
- **Использование памяти узлов&nbsp;%**: совокупная перспектива использования памяти для всего кластера. Результаты для диапазона времени можно отфильтровать, выбрав **Avg**, **Min**, **Max**, **50**, **90** и **95** в селекторе процентилей над диаграммой (по отдельности или вместе). 
- **Число узлов**: число и состояние узлов, полученные с Kubernetes. Состояние узлов кластера может быть: *Все*, *Готово* и *Не готово*. Используя селектор над диаграммой, их можно отфильтровать по отдельности или вместе. 
- **Счетчик активности модулей pod**: число и состояние модулей pod, полученные с Kubernetes. Состояние модулей pod может быть: *Все*, *Ожидание*, *Выполняется* и *Неизвестно*. Используя селектор над диаграммой, их можно отфильтровать по отдельности или вместе. 

Вы можете использовать клавиши со стрелками влево и вправо для циклического просмотра каждой точки данных на диаграмме и клавиши со стрелками вверх или вниз для циклического просмотра строк процентиля.

Azure Monitor для контейнеров также поддерживает Azure Monitor [обозревателя метрик](../platform/metrics-getting-started.md), где можно создавать собственные метрики построения, сопоставлять и исследовать тенденции и закреплять на панелях мониторинга. Обозреватель метрик, также можно использовать критерии, установки визуализировать метрики в качестве основы [метриками правила генерации оповещений](../platform/alerts-metric.md).  

## <a name="view-container-metrics-in-metrics-explorer"></a>Просмотр метрик контейнера в обозревателе метрик
В обозревателе метрик можно просмотреть агрегированные узел и метрики использования из Azure Monitor для контейнеров pod. В следующей таблице перечислены сведения, помогающие понять, как визуализировать метрики контейнера с помощью диаграммы метрик.

|Пространство имен | Метрика |
|----------|--------|
| Insights.Container/nodes | |
| | cpuUsageMillicores |
| | cpuUsagePercentage |
| | memoryRssBytes |
| | memoryRssPercentage |
| | memoryWorkingSetBytes |
| | memoryWorkingSetPercentage |
| | nodesCount |
| Insights.Container/PODS | |
| | podCount |

Можно применить [разделение](../platform/metrics-charts.md#apply-splitting-to-a-chart) метрики для просмотра аналитики и визуализации различными сегментами сравнивать друг с другом. Для узла, вы можете сегментировать диаграммы по *узла* измерения, и от pod можно сегментировать его по следующие измерения:

* Контроллер
* Пространство имен Kubernetes
* Узел
* Этап

## <a name="analyze-nodes-controllers-and-container-health"></a>Анализ узлов, контроллеры и работоспособности контейнера

При переключении на вкладку **Узлы**, **Контроллеры** и **Контейнеры** в правой области страницы автоматически отображается панель свойств. Он отображает свойства элемент выделен, включая метки, которые вы задали для организации объектов Kubernetes. При выборе узла Linux, также показано в разделе **локальная емкость диска** доступного пространства на диске и процент, используемый для каждого диска, представленных на узел. Щелкните на панели ссылку **>>**, чтобы просмотреть или скрыть панель. 

![Пример панели свойств перспектив Kubernetes](./media/container-insights-analyze/perspectives-preview-pane-01.png)

При развертывании объектов в иерархии панель свойств обновляется на основе выбранного объекта. На панели вы также можете просмотреть события Kubernetes с заранее определенными поисками по журналам. Для этого щелкните ссылку **Просмотреть журналы событий Kubernetes** в верхней части панели. Дополнительные сведения о просмотре данных журнала Kubernetes см. в разделе [Поиск по журналам для анализа данных](container-insights-log-search.md). При просмотре ресурсов кластера, вы увидите контейнер журналы и события в режиме реального времени. Дополнительные сведения об этой функции и конфигурации, необходимые для предоставления и управления доступом см. в разделе [способах просмотра журналов реального времени с помощью Azure Monitor для контейнеров](container-insights-live-logs.md). 

Используйте **+ добавить фильтр** параметр в верхней части страницы, чтобы отфильтровать результаты для представления с **службы**, **узел**, **пространства имен**, или  **Узлов в пуле** и выбрав область фильтра, вы выберите одно из значений, приведенных в **выберите значения** поля.  После настройки фильтра он применяется глобально при просмотре любой перспективы кластера AKS.  Формула поддерживает только знак равенства.  Поверх первого фильтра можно добавить дополнительные фильтры, чтобы сузить диапазон результатов.  Например, если указана фильтрация по **узлу**, вторым фильтром можно выбрать только **службу** или **пространство имен**.  

![Пример с использованием фильтра, чтобы сузить диапазон результатов](./media/container-insights-analyze/add-filter-option-01.png)

Если задать фильтр на одной вкладке, он продолжает применяться при выборе другого фильтра. Он удаляется после того, как вы щелкните символ **х** рядом с указанным фильтром.   

Перейдите на вкладку **Узлы**. Иерархия строк будет соответствовать объектной модели Kubernetes, начиная с узла в кластере. Разверните узел, и вы увидите один или несколько запущенных на нем модулей pod. Если в модуль pod сгруппировано несколько контейнеров, они будут отображаться как последняя строка в иерархии. Вы также можете увидеть количество рабочих нагрузок, отличных от модулей pod, которые выполняются на узле, если узел испытывает нехватку ресурсов процессора или памяти.

![Пример иерархии узлов Kubernetes в представлении производительности](./media/container-insights-analyze/containers-nodes-view.png)

Контейнеры Windows Server под управлением ОС Windows Server 2019 отображаются после всех узлов под управлением Linux в списке. При развертывании узла Windows Server, можно просмотреть один или несколько модулей POD и контейнеров, работающих на узле. При выборе узла панели свойств мы видим сведения о версии, за исключением сведения об агенте, так как узлы Windows Server не имеют установленного агента.  

![Пример иерархии узла с узлами Windows Server в списке](./media/container-insights-analyze/nodes-view-windows.png) 

Виртуальные узлы Экземпляров контейнеров Azure, работающие под управлением ОС Linux, отображаются после последнего узла кластера AKS в списке.  Развернув виртуальный узел ACI, вы можете просмотреть один или несколько модулей и контейнеров ACI, работающих на узле.  Метрики собираются и предоставляются только для модулей pod, а не для узлов.

![Пример иерархии узлов с перечисленными Экземплярами контейнера](./media/container-insights-analyze/nodes-view-aci.png)

На расширенном узле можно развернуть панель или контейнер, запущенные на узле, в контроллер, чтобы просмотреть данные о производительности, отфильтрованные для этого контроллера. Щелкните значение в столбце **Контроллер** для конкретного узла.   
![Пример перехода из узла к контроллеру в представление производительности](./media/container-insights-analyze/drill-down-node-controller.png)

Можно выбрать контроллеры или контейнеры в верхней части страницы и просмотреть для них состояние и данные об использовании ресурсов.  Если вместо этого требуется просмотреть данные об использовании памяти, из раскрывающегося списка **метрики** выберите **Memory RSS** (Память (RSS)) или **рабочий набор памяти**. Параметр **Memory RSS** (Память (RSS)) поддерживается только для Kubernetes версии 1.8 и более поздних. В противном случае значения **Min&nbsp;%** отображаются как *NaN&nbsp;%*. Это значение числового типа данных, представляющее неопределенное значение или значение, которое невозможно представить. 

![Представление производительности узлов контейнера](./media/container-insights-analyze/containers-node-metric-dropdown.png)

По умолчанию используются данные о производительности за последние шесть часов, но вы можете изменить этот период с помощью параметра **TimeRange**, который расположен в верхнем левом углу. Также в диапазоне времени можно отфильтровать результаты, выбрав **Avg**, **Min**, **Max**, **50**, **90** и **95** в селекторе процентилей. 

![Выбор процентилей для фильтрации данных](./media/container-insights-analyze/containers-metric-percentile-filter.png)

При наведении указателя мыши на гистограмму в столбце **Trend** (Тренд) каждая строка показывает использование памяти или ЦП в течение периода выборки 15 минут в зависимости от того, какая метрика выбрана. После выбора диаграммы тенденций с помощью клавиатуры вы можете использовать клавиши ALT+PAGEUP или ALT+PAGEDOWN для циклического просмотра каждой строки по отдельности и получить те же сведения, что и при наведении указателя мыши.

![Тренд линейчатой диаграмме при наведении указателя мыши на примере](./media/container-insights-analyze/containers-metric-trend-bar-01.png)    

В следующем примере обратите внимание, что для узла *aks-nodepool1-* (первого в списке) значение параметра для **Контейнеров** равно 9. Это сводное общее число развернутых контейнеров.

![Пример сводного числа контейнеров на узел](./media/container-insights-analyze/containers-nodes-containerstotal.png)

Это поможет быстро выявить соответствующее распределение контейнеров между узлами в кластере. 

В следующей таблице описаны сведения, отображаемые при просмотре узлов.

| столбец | Описание | 
|--------|-------------|
| ИМЯ | Имя узла. |
| Status | Представление Kubernetes о состоянии узла. |
| Avg&nbsp;%, Min&nbsp;%, Max&nbsp;%, 50&nbsp;%, 90&nbsp;% | Средний процент для узла на основе процентиля в течение выбранного периода времени. |
| Avg, Min, Max, 50, 90 | Среднее фактическое значение для узла на основе процентиля в течение выбранного периода времени. Среднее значение измеряется на основании лимита ЦП и памяти, установленного для узла. Для модулей pod и контейнеров это среднее значение, сообщаемое узлом. |
| Контейнеры | Число контейнеров. |
| Время работы | Представляет время с момента запуска или перезапуска узла. |
| Контроллеры | Только для контейнеров и модулей pod. Показывает, в каком контроллере размещен контейнер или pod. Не все модули pod будут размещаться в контроллере, поэтому для некоторых может отображаться значение **Н/Д**. | 
| Avg&nbsp;%, Min&nbsp;%, Max&nbsp;%, 50&nbsp;%, 90&nbsp;% | Гистограмма тренда представляет средний процент метрики процентиля контроллера. |

Выберите **Контроллеры** в селекторе.

![Представление выбора контроллеров](./media/container-insights-analyze/containers-controllers-tab.png)

Здесь можно просмотреть состояние производительности ваших контроллеров и контроллеров виртуального узла ACI или модулей pod виртуальных узлов, не подключенных к контроллеру.

![Представление производительности контейнеров <Имя>](./media/container-insights-analyze/containers-controllers-view.png)

Иерархия записи начинается с контроллером, и при его развертывании вы просматриваете один или несколько модулей pod.  Разверните pod, и в последней строке отобразится контейнер, сгруппированный в этот pod. Из развернутого контроллера можно перейти к узлу, который запущен, чтобы просмотреть данные производительности, отобранные для этого узла. Модули pod ACI, которые не подключены к контроллеру, наведены в конце списка.

![Пример иерархии контроллеров с перечисленными модулями pod Экземпляров контейнеров](./media/container-insights-analyze/controllers-view-aci.png)

Щелкните значение в столбце **Узел** для конкретного контролера.   

![Пример перехода из узла к контроллеру в представление производительности](./media/container-insights-analyze/drill-down-controller-node.png)

В следующей таблице описаны сведения, отображаемые при просмотре контроллеров.

| столбец | Описание | 
|--------|-------------|
| ИМЯ | Имя контроллера.|
| Status | Состояние сводного числа контейнеров после завершения выполнения, например *ОК*, *Завершено*, *Сбой*, *Остановлено* или *Приостановлено*. Если контейнер выполняется, но его состояние было неправильно представлено или не было выбрано агентом и не передавалось более 30 минут, то значением состояния будет *Неизвестно*. В таблице ниже приведены дополнительные сведения о значке состояния.|
| Avg&nbsp;%, Min&nbsp;%, Max&nbsp;%, 50&nbsp;%, 90&nbsp;% | Сводный среднее средний процент каждой сущности для выбранной метрики и процентиля. |
| Avg, Min, Max, 50, 90  | Сводное среднее значение производительности ЦП (в миллиядрах) или памяти для контейнера для выбранного процентиля. Среднее значение измеряется на основании лимита ресурсов ЦП и памяти, установленного для pod. |
| Контейнеры | Общее число контейнеров для контроллера или pod. |
| "Restarts" (Число перезапусков) | Сводное количество перезапусков из контейнеров. |
| Время работы | Представляет время с момента запуска контейнера. |
| Узел | Только для контейнеров и модулей pod. Показывает, в каком контроллере размещен контейнер или pod. | 
| Avg&nbsp;%, Min&nbsp;%, Max&nbsp;%, 50&nbsp;%, 90&nbsp;%| Гистограмма тренда представляет метрику процентиля контроллера. |

Значки в поле состояния указывают состояние контейнеров:
 
| Значок | Status | 
|--------|-------------|
| ![Значок состояния выполнения (готовности)](./media/container-insights-analyze/containers-ready-icon.png) | Выполняется (готово)|
| ![Значок состояния ожидания или паузы](./media/container-insights-analyze/containers-waiting-icon.png) | Ожидается или приостановлено|
| ![Значок состояния последнего зарегистрированного выполнения](./media/container-insights-analyze/containers-grey-icon.png) | Последнее выполнение зарегистрировано, но нет ответа более 30 минут|
| ![Значок состояния успешного выполнения](./media/container-insights-analyze/containers-green-icon.png) | Успешно остановлено или не удалось остановить|

Значок состояния отображает число на основе сведений, предоставляемых модулем pod. Он показывает два худших состояния и при наведении указателя мыши на значок показывает сводное состояния всех модулей pod в контейнере. Если это не состояние готовности, отображается значение состояния **(0)**. 

Выберите **Контейнеры** в селекторе.

![Представление выбора контейнеров](./media/container-insights-analyze/containers-containers-tab.png)

Здесь можно просмотреть состояние производительности контейнеров Azure Kubernetes и Экземпляров контейнеров Azure.  

![Представление производительности контейнеров <Имя>](./media/container-insights-analyze/containers-containers-view.png)

Из контейнера можно перейти к сведениям pod или узла, чтобы просмотреть отобранные данные производительности для этого объекта. Щелкните значение в столбце **Pod** или **Узел** для конкретного контролера.   

![Пример перехода из узла к контроллеру в представление производительности](./media/container-insights-analyze/drill-down-controller-node.png)

В следующей таблице описаны сведения, отображаемые при просмотре контейнеров.

| столбец | Описание | 
|--------|-------------|
| ИМЯ | Имя контроллера.|
| Status | Состояния контейнеров (при наличии). В таблице ниже приведены дополнительные сведения о значке состояния.|
| Avg&nbsp;%, Min&nbsp;%, Max&nbsp;%, 50&nbsp;%, 90&nbsp;% | Сводное значение среднего процента каждой сущности для выбранной метрики и процентиля. |
| Avg, Min, Max, 50, 90  | Сводное среднее значение производительности ЦП (в миллиардах) или памяти контейнера для выбранного процентиля. Среднее значение измеряется на основании лимита ресурсов ЦП и памяти, установленного для pod. |
| Pod | Контейнер, в котором находится pod.| 
| Узел |  Узел, на котором размещен контейнер. | 
| Перезапусков | Представляет время с момента запуска контейнера. |
| Время работы | Представляет время с момента запуска или перезапуска контейнера. |
| Avg&nbsp;%, Min&nbsp;%, Max&nbsp;%, 50&nbsp;%, 90&nbsp;% | Гистограмма тренда представляет средний процент метрики процентиля контроллера. |

Значки в поле состояния указывают состояния модулей pod в режиме реального времени, как описано в следующей таблице:
 
| Значок | Status |  
|--------|-------------|  
| ![Значок состояния выполнения (готовности)](./media/container-insights-analyze/containers-ready-icon.png) | Выполняется (готово)|  
| ![Значок состояния ожидания или паузы](./media/container-insights-analyze/containers-waiting-icon.png) | Ожидается или приостановлено|  
| ![Значок состояния последнего зарегистрированного выполнения](./media/container-insights-analyze/containers-grey-icon.png) | Последнее выполнение зарегистрировано, но ответа нет более 30 минут|  
| ![Значок состояния "Завершено"](./media/container-insights-analyze/containers-terminated-icon.png) | Успешно остановлено или не удалось остановить|  
| ![Значок состояния "Сбой"](./media/container-insights-analyze/containers-failed-icon.png) | Состояние сбоя |  

## <a name="next-steps"></a>Дальнейшие действия
- Просмотрите [Создание предупреждения о производительности с помощью Azure Monitor для контейнеров](container-insights-alerts.md) вы научитесь создавать оповещения для высокой загрузки ЦП и памяти для поддержки DevOps или рабочие процессы и процедуры. 
- Представление [журнала примеры запросов](container-insights-log-search.md#search-logs-to-analyze-data) предопределенных запросов и примеры для настройки предупреждений, визуализация и анализ кластеров и оценки.
