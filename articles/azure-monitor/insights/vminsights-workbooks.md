---
title: Создавайте интерактивные отчеты с книгами Azure Monitor | Документация Майкрософт
description: Упрощение создания сложных отчетов с стандартные и пользовательские параметризованные книгами для Azure Monitor для виртуальных машин.
services: azure-monitor
documentationcenter: ''
author: mgoedtel
manager: carmonm
editor: ''
ms.assetid: ''
ms.service: azure-monitor
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/05/2019
ms.author: magoedte
ms.openlocfilehash: 90c236347380bb5d5e51db56d0f431d2659a7258
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61387285"
---
# <a name="create-interactive-reports-with-azure-monitor-workbooks"></a>Создание интерактивных отчетов с книгами Azure Monitor

Workbooks объединяют текста, [журнал запросов](../log-query/query-language.md), метрики и параметры в подробные интерактивные отчеты. Их могут редактировать другие участники команды с доступом к тому же ресурсу Azure.

Workbooks полезны такие как для сценариев:

* Изучение использования виртуальной машины, если вы заранее не знаете интересующие вас метрики: Использование ЦП, дискового пространства, памяти, сети зависимостей, и т.д. В отличие от других средств анализа использования, книги позволяют объединить несколько видов визуализаций и анализа, что делает их удобными для такого рода исследований произвольной формы.
* Объяснение рабочей группе принципа как работает недавно подготовленной виртуальной Машины, отображая метрики для основных счетчиков и других журналов событий.
* Совместное использование результатов эксперимента по изменению размера виртуальной машины с другими членами вашей команды. Можно объяснить цели для экспериментов с текстом, а затем Показать каждого сведения об использовании метрик и аналитики запросов используется для оценки тестирования вместе с обозначениями для была ли каждая метрика выше - или ниже целевой.
* Последствия сбоя отчеты по использованию виртуальной машины, объединение данных, текстовое описание и обсуждение следующих шагов для предотвращения сбоев в будущем.

Azure Monitor для виртуальных машин включает в себя несколько книг, чтобы приступить к работе, и в следующей таблице перечислены их.

| Книга | Описание | Область |
|----------|-------------|-------|
| Производительность | Предоставляет настраиваемые версию нашего список первых N и представления диаграмм в одной книге, которая использует все счетчики производительности Log Analytics, для которых включен.| В нужном масштабе |
| Счетчики производительности | Представление диаграммы Top N через широкий набор счетчиков производительности. | В нужном масштабе |
| Подключения | Подключения предоставляет подробный обзор того, входящие и исходящие подключения из отслеживаемых виртуальные машины. | В нужном масштабе |
| Активные порты | Список процессов, которые привязаны к портам на отслеживаемых виртуальных машин и их действие в выбранный период времени. | В нужном масштабе |
| Открытие портов | Предоставляет число портов откройте ваших отслеживаемых виртуальных машин и подробную информацию о тех открыть порты. | В нужном масштабе |
| Неудачные подключения | Отображает количество неудачных попыток соединения на отслеживаемых виртуальных машинах, тренд сбоев, и если Доля сбоев увеличивается с течением времени. | В нужном масштабе |
| Безопасность и аудит | Анализ ваш трафик TCP/IP, содержащий сведения об общей подключения, вредоносных подключения, где глобально находятся конечные точки, IP-адрес.  Для включения всех возможностей, необходимо включить обнаружение системы безопасности. | В нужном масштабе |
| Трафик TCP | Ранжирующими значениями отчета для ваших отслеживаемых виртуальных машин и их отправки, полученных и общее сети трафик в сетке и отображаются как линии тренда. | В нужном масштабе |
| Сравнение трафика | Этой книги позволяет сравнить тенденции распределения сетевого трафика для одного компьютера или группы компьютеров. | В нужном масштабе |
| Производительность | Предоставляет настраиваемые версию нашего представления производительности, который использует все счетчики производительности Log Analytics, для которых включен. | Одиночная виртуальная машина | 
| Подключения | Подключения предоставляет подробный обзор того, входящие и исходящие подключения из виртуальной Машины. | Одиночная виртуальная машина |
 
## <a name="starting-with-a-template-or-saved-workbook"></a>Начните с шаблона или сохраненной книги

Книга составлена из разделов, состоящих из отдельно редактируемых диаграмм, таблиц, текста и элементов управления для ввода. Чтобы лучше понять книг, начнем с шаблона и пошаговые инструкции по созданию пользовательских книги. 

1. Войдите на [портале Azure](https://portal.azure.com).

2. Выберите **Виртуальные машины**.

3. Выберите виртуальную машину из списка.

4. На странице виртуальной машины в разделе **Мониторинг** выберите **Аналитические сведения (предварительная версия)**.

5. На странице аналитики виртуальной Машины, выберите **производительности** или **Maps** , а затем — **книгами View** по ссылке на странице. 

    ![Снимок экрана навигации к книгам](media/vminsights-workbooks/workbook-option-01.png)

6. В раскрывающемся списке выберите **перейти в коллекцию** в нижней части списка.

    ![Снимок экрана с раскрывающимся списком](media/vminsights-workbooks/workbook-dropdown-gallery-01.png)

    Она запускает книги коллекции с количеством предварительно созданные книги, чтобы помочь вам приступить к работе.

7. Мы начнем с **шаблона по умолчанию**, который находится под заголовком **Быстрый запуск**.

    ![Снимок экрана с коллекцией книг приложения](media/vminsights-workbooks/workbook-gallery-01.png)

## <a name="editing-workbook-sections"></a>Изменение разделов книги

Книги могут работать в двух режимах: **режиме редактирования** и **режиме чтения**. Книги шаблона по умолчанию первого запуска, он открывается в **режим редактирования**. Он показывает все содержимое книги, включая все шаги и параметры, которые в противном случае скрыты. **Режим чтения** представляет упрощенный стиль отчета. Режим чтения позволяет абстрагироваться от конкретных сложности, которые возникли Создание отчета, сохраняя лежащих в основе всего в несколько щелчков мышью при необходимости для изменения.

![Azure Monitor для элементов управления редактированием раздела книги виртуальных машин](media/vminsights-workbooks/workbook-new-workbook-editor-01.png)

1. Закончив редактирование раздела, щелкните **сделать редактирования** в нижнем левом углу раздела.

2. Чтобы создать копию раздела, щелкните значок **Clone this section** (Клонировать этот раздел). Создание повторяющихся разделов — это отличный способ для выполнения итерации по запросу без потери предыдущих итераций.

3. Чтобы перейти к следующему или к предыдущему разделу в книге, щелкните значок **Вверх** или **Вниз**.

4. Чтобы окончательно удалить раздел, щелкните значок **Удалить**.

## <a name="adding-text-and-markdown-sections"></a>Добавление текста и разделы разметки Markdown

Добавление заголовков, объяснений и комментариев в Workbooks позволяет превратить набор таблиц и диаграмм в описание. Разделы текста в книгах поддерживают [синтаксис разметки Markdown](https://daringfireball.net/projects/markdown/) для форматирования текста, например заголовков, полужирного шрифта, курсива и маркированных списков.

Чтобы добавить раздел текста в книгу, используйте кнопку **Добавить текст** в нижней части книги, либо в нижней части любого раздела.

## <a name="adding-query-sections"></a>Добавление разделов запроса

![Раздел "Запрос" в Workbooks](media/vminsights-workbooks/005-workbook-query-section.png)

Чтобы добавить раздел запроса в книгу, используйте кнопку **Добавить запрос** в нижней части книги либо в нижней части любого раздела.

Разделы запросов очень гибки и позволяют отвечать на вопросы наподобие следующих:

* Каким образом был мой использования ЦП во время тот же период времени, как увеличение сетевого трафика?
* Какова тенденции в доступного пространства на диске за последний месяц?
* Количество сбоев подключения сети столкнулись моей виртуальной Машины за последние две недели? 

Вы также не только ограничены запроса из контекста виртуальной машины запущен из книги. Можно выполнять запросы в нескольких виртуальных машин, а также рабочих областей Log Analytics, при условии, что у вас есть разрешение на доступ к этим ресурсам.

Чтобы включить данные из других рабочих областей Log Analytics или из конкретного приложения Application Insights с помощью **рабочей области** идентификатор. Дополнительные сведения о запросах между ресурсами, см. [воспользоваться рекомендациями](../log-query/cross-workspace-query.md).

### <a name="advanced-analytic-query-settings"></a>Расширенные параметры запросов аналитики

Каждый раздел имеет свои собственные дополнительные параметры, которым осуществляется с помощью параметров ![книг разделе элементы управления для редактирования](media/vminsights-workbooks/006-settings.png) значок, расположенный справа от **добавить параметры** кнопки.

![Azure Monitor для элементов управления редактированием раздела книги виртуальных машин](media/vminsights-workbooks/007-settings-expanded.png)

|         |          |
| ---------------- |:-----|
| **Настраиваемая ширина**    | Делает элемент произвольного размера, поэтому много элементов может поместиться на одной строке, что позволяет лучше организовать диаграмм и таблиц в подробные интерактивные отчеты.  |
| **Условная видимость** | Укажите, чтобы скрыть шаги на основе параметра в режиме чтения. |
| **Экспорт параметра**| Разрешить выбранной строки в таблице или диаграмму, чтобы привести к более поздней версии действия, чтобы изменить значения или сделать их видимыми.  |
| **Отображать запрос, когда он не редактируется** | Отображает запрос выше диаграмму или таблицу даже в режиме чтения.
| **Показать кнопку "Открыть в службе аналитики", если редактирование не ведется** | Добавляет синий значок "Аналитика" в правом углу диаграммы, чтобы предоставить доступ одним щелчком.|

Большинство из этих параметров довольно очевидны, но для понимания того, как работает **Экспорт параметра**, лучше изучить книгу, использующую эту функцию.

Один из предварительно созданных книг - **TCP-трафик**, приведены сведения о метрик подключения из виртуальной Машины.

В первой части книги основывается на данных журнала запросов. Во втором разделе также основывается на данных журнала запросов, но при выборе строки в первой таблице интерактивно обновляют содержимое диаграммы:

![Azure Monitor для элементов управления редактированием раздела книги виртуальных машин](media/vminsights-workbooks/008-workbook-tcp-traffic.png)

Поведение возможно благодаря использованию **при выборе элемента, экспортировать параметр** Дополнительные параметры, которые включены в таблицы журнала запросов.

![Azure Monitor для элементов управления редактированием раздела книги виртуальных машин](media/vminsights-workbooks/009-settings-export.png)

Второй запрос журнала применяет экспортированных значений при выборе строки для создания набора значений, которые используются с заголовком раздела и диаграммы. Если строка не выбран, он скрывает заголовком раздела и диаграммы. 

Например скрытый параметр во втором разделе использует следующую ссылку из строки, выбранной в сетке:

```
VMConnection
| where TimeGenerated {TimeRange}
| where Computer in ("{ComputerName}") or '*' in ("{ComputerName}") 
| summarize Sent = sum(BytesSent), Received = sum(BytesReceived) by bin(TimeGenerated, {TimeRange:grain})
```

## <a name="adding-metrics-sections"></a>Добавление разделов метрики

Разделы метрики дают вам полный доступ для включения данных метрик Azure Monitor в интерактивные отчеты. В Azure Monitor для виртуальных машин предварительно созданные книг обычно содержат аналитические запросы к данным, а не данные метрик.  Вы можете для создания книг с данными метрик, что позволяет воспользоваться всеми преимуществами лучшее из обоих компонентов в одном месте. Также есть возможность извлечения данных метрики из ресурсов любой из подписок, к которым у вас есть доступ.

Ниже приведен пример данных виртуальных машин, запрашиваемой в книгу для наглядного представления сетки производительность ЦП:

![Azure Monitor для элементов управления редактированием раздела книги виртуальных машин](media/vminsights-workbooks/010-metrics-grid.png)

## <a name="adding-parameter-sections"></a>Добавление разделов параметров

Параметры книги позволяют изменять значения в книге без ручного редактирования в разделах запросов или текста. Это устраняет необходимость изучения базового языка запросов аналитики и значительно расширяет возможности потенциальной аудитории отчетов на основе книг.

Значения параметров подставляются в запросы, текст или в другие разделы параметров; для этого поместите имя параметра в фигурные скобки, например ``{parameterName}``. Имена параметров ограничены схожим правилам для идентификаторов JavaScript, буквенные символы или символы подчеркивания, за которым следует буквенно-цифровые символы или символы подчеркивания. Так, **a1** разрешено, но **1a** не допускается.

Параметры являются линейными, начиная с верхней части книги и до последующих шагов.  Параметры, объявленные в книге можно переопределить параметры, которые были объявлены ранее. Это также позволяет параметров, которые используют запросы для доступа к значениям из параметров, определенных ранее. В пределах самого шага параметров параметры также линейны и идут слева направо; параметры справа могут зависеть от параметра, объявленного ранее на этом же шаге.
 
Существует четыре различных типа параметров, которые в настоящее время поддерживаются:

|                  |      |
| ---------------- |:-----|
| **Text**    | Позволяет пользователю изменить текстовое поле, и при необходимости можно указать запрос, чтобы указать значения по умолчанию. |
| **Раскрывающийся список** | Позволяет пользователю выбрать из набора значений. |
| **Средство выбора диапазона времени**| Позволяет пользователю выбрать набор стандартных значений диапазона времени, или выбрать из заданного интервала времени.|
| **Средство выбора ресурсов** | Позволяет пользователю выбирать из ресурсов, выбранных для книги.|

### <a name="using-a-text-parameter"></a>Использование текстового параметра

Значение, пользователь вводит в текстовое поле заменяется непосредственно в запросе без экранирования или заключения в кавычки. Если нужное значение — строка, параметр в запросе должен быть заключен в кавычки (например, **'{parameter}'**).

Параметр текстового допускаются значения в текстовом поле для использования в любом месте. Это может быть имя таблицы, имя столбца, имя функции, оператор и т. д.  Тип параметра текст содержит параметр **получить значение по умолчанию из запроса аналитики**, что позволяет автору книги использовать запрос для заполнения значения по умолчанию для этого текстового поля.

Если используется значение по умолчанию из запроса журнала, как значение по умолчанию используется только первое значение первой строки (строка 0, столбец 0). Поэтому рекомендуется ограничить запрос, чтобы он возвращал только одну строку и один столбец. Любые другие данные, возвращаемые запросом, не учитываются. 

Какое бы значение ни вернул запрос, оно будет подставлено напрямую без экранирования или заключения в кавычки. Если запрос не возвращает строки, результат параметра будет пустой строкой (если параметр не является обязательным) или не определен (если параметр является обязательным).

### <a name="using-a-drop-down"></a>С помощью раскрывающегося списка

Тип параметра раскрывающийся список позволяет создать раскрывающийся элемент управления допускает выбор одного или нескольких значений.

Раскрывающийся список заполняется с помощью запроса журнала или JSON. Если запрос возвращает один столбец, значения в этом столбце являются значение и метку в элементе управления раскрывающегося списка. Если запрос возвращает два столбца, первый столбец имеет значение, а во втором — метка, отображаемая в раскрывающемся списке. Если запрос возвращает три столбца, а в третьем используется для указания выбора по умолчанию в этом раскрывающемся списке. Этот столбец может быть любого типа, но проще всего использовать логические или числовые типы, где 0 — ложь, а 1 — истина.

Если столбец имеет строковый тип, пустая строка рассматривается как ложное значение, а любое другое значение считается истинным. Для одиночного выбора раскрывающимися списками выбранным по умолчанию используется первое значение со значением true.  Для нескольких выбора раскрывающийся список все значения со значением true используются в качестве набора выбора по умолчанию. Эти элементы в раскрывающемся списке отображаются в порядке, независимо от запрос вернул строки. 

Давайте взглянем на параметры, представленные в отчете Общие сведения о подключениях. Щелкните значок редактирования рядом с полем **направление**.

![Azure Monitor для элементов управления редактированием раздела книги виртуальных машин](media/vminsights-workbooks/011-workbook-using-dropdown.png)

Это приведет к запуску **изменить параметр** пункта меню.

![Azure Monitor для элементов управления редактированием раздела книги виртуальных машин](media/vminsights-workbooks/012-workbook-edit-parameter.png)

JSON вы можете создать таблицу произвольные заполняются содержимым. Например приведенный ниже код JSON создает два значения в раскрывающемся списке:

```
[
    { "value": "inbound", "label": "Inbound"},
    { "value": "outbound", "label": "Outbound"}
]
```

Более подходящих примере используется раскрывающийся список для выбора из набора счетчиков производительности по имени:

```
Perf
| summarize by CounterName, ObjectName
| order by ObjectName asc, CounterName asc
| project Counter = pack('counter', CounterName, 'object', ObjectName), CounterName, group = ObjectName
```

Запрос выводит результаты так:

![Раскрывающийся список счетчиков производительности](media/vminsights-workbooks/013-workbook-edit-parameter-perf-counters.png)

Раскрывающиеся меню являются невероятно мощные средства для индивидуальной настройки и создания интерактивных отчетов.

### <a name="time-range-parameters"></a>Параметры диапазонов времени

Хотя вы можете создать собственный параметр с настраиваемыми диапазонами времени, используя тип параметра раскрывающегося списка, можно применить готовый тип параметра диапазона времени, если гибкость настройки не так важна. 

В типе параметров с диапазонами времени есть 15 диапазонов по умолчанию: от пяти минут до последних 90 дней. Есть также возможность разрешить выбор настраиваемого диапазона времени, который позволяет явно задать в отчете начальное и конечное значения для диапазона времени.

### <a name="resource-picker"></a>Средство выбора ресурсов

Тип параметра со средством выбора ресурсов дает возможность ограничить отчет определенными типами ресурсов. Например предварительно созданные книги, которая использует средство выбора типа ресурса, **производительности** книги.

![Раскрывающийся список рабочих областей](media/vminsights-workbooks/014-workbook-edit-parameter-workspaces.png)

## <a name="saving-and-sharing-workbooks-with-your-team"></a>Сохранение и совместное использование книг с коллегами

Книги будут сохраняться в рабочей области Log Analytics или ресурс виртуальной машины, в зависимости от того, как получить доступ к коллекции книг. Можно сохранить книгу **«Мои отчеты»** закрытом, или в разделе **Общие отчеты** раздел, в котором доступна для всех пользователей с доступом к ресурсу. Для просмотра всех книг в ресурсе нажмите кнопку **Открыть** на панели действий.

Чтобы опубликовать книгу, которая находится в разделе **Мои отчеты**, сделайте следующее:

1. На панели действий щелкните **Сохранить**.
2. Нажмите кнопку "..." рядом с книгой, к которой необходимо предоставить доступ.
3. Щелкните **Move to Shared Reports** (Переместить в общие отчеты).

Чтобы опубликовать книгу с помощью ссылки или по электронной почте, нажмите кнопку **Поделиться** в области действия. Имейте в виду, что получателю ссылки потребуется доступ к этому ресурсу на портале Azure, чтобы просмотреть книгу. Чтобы внести изменения, получателям потребуется по крайней мере разрешения участника ресурса.

Чтобы закрепить ссылку на книгу на панели мониторинга Azure, сделайте следующее:

1. На панели действий щелкните **Сохранить**.
2. Нажмите кнопку "..." рядом с книгой, которую требуется закрепить.
3. Щелкните **Закрепить на панели мониторинга**.

## <a name="next-steps"></a>Дальнейшие действия
Чтобы узнать, как использовать функцию работоспособности, см. в разделе [просмотреть состояние работоспособности виртуальной Машины Azure](vminsights-health.md), или для просмотра зависимостей обнаруженных приложений, см. в разделе [представление Azure Monitor для виртуальных машин карты](vminsights-maps.md). 