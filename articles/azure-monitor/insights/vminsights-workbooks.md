---
title: Create interactive reports Azure Monitor for VMs with workbooks (Создание интерактивных отчетов Azure Monitor для виртуальных машин с книгами)
description: Упростить сложную отчетность с предопределенными и пользовательскими параметрами для Azure Monitor для VMs.
ms.subservice: ''
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 03/12/2020
ms.openlocfilehash: a6ab126c3a5b0d2a82b17fac42dcc9e20f6aba3f
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79480459"
---
# <a name="create-interactive-reports-azure-monitor-for-vms-with-workbooks"></a>Create interactive reports Azure Monitor for VMs with workbooks (Создание интерактивных отчетов Azure Monitor для виртуальных машин с книгами)

В богатых интерактивных отчетах рабочие книги объединяют текст, [запросы журналов,](../log-query/query-language.md)метрики и параметры. Их могут редактировать другие участники команды с доступом к тому же ресурсу Azure.

Учебники полезны для таких сценариев, как:

* Изучение использования виртуальной машины, когда вы не знаете метрик интерес заранее: использование процессора, дисковое пространство, память, сетевые зависимости и т.д. В отличие от других инструментов аналитики использования, трудовые книжки позволяют сочетать несколько видов визуализаций и анализов, что делает их отличными для такого рода исследований свободной формы.
* Объясняя вашей команде, как работает недавно подготовленный VM, показывая метрики для ключевых счетчиков и других событий журнала.
* Совместное использование результатов эксперимента по размеру вашего VM с другими членами вашей команды. Вы можете объяснить цели эксперимента с текстом, а затем показать каждое использование метрики и аналитики запросы, используемые для оценки эксперимента, а также четкие вызовы для ли каждая метрика была выше или ниже цели.
* Сообщение о влиянии сбоя на использование ВМ, объединение данных, текстовых пояснений и обсуждение дальнейших шагов по предотвращению простоев в будущем.

В следующей таблице кратко излагаются трудовые книжки, которые включает Azure Monitor для вс-кейсов, чтобы начать работу.

| Книга | Описание | Область |
|----------|-------------|-------|
| Производительность | Предоставляет настраиваемую версию нашего представления Top N List and Charts в одной трудовой книжке, в которых используются все счетчики производительности Log Analytics, которые вы включили.| В большом масштабе |
| Счетчики производительности | Представление диаграммы Top N на широком наборе счетчиков производительности. | В большом масштабе |
| Соединения | Соединения обеспечивают углубленное представление входящих и исходящих соединений с контролируемых VMs. | В большом масштабе |
| Активные порты | Предоставляет список процессов, связанных с портами на контролируемых ВМ, и их активность в выбранные сроки. | В большом масштабе |
| Открытие портов | Обеспечивает количество портов, открытых на контролируемых VMs, и подробную информацию об этих открытых портах. | В большом масштабе |
| Неудачные подключения | Отображение количества сбоенных подключений на контролируемых ВМ, тренда сбоев и если процент сбоев увеличивается с течением времени. | В большом масштабе |
| Безопасность и аудит | Анализ трафика TCP/IP, который отчитывается об общих соединениях, вредоносных соединениях, где конечные точки IP находятся во всем мире.  Для включения всех функций необходимо включить систему обнаружения безопасности. | В большом масштабе |
| Трафик TCP | Рейтинговый отчет для контролируемых ВМ и их отправленных, полученных и общих сетевых трафика в сетке и отображается в виде линии тренда. | В большом масштабе |
| Сравнение трафика | Эти трудовые книжки позволяют сравнивать тенденции сетевого трафика для одной машины или группы машин. | В большом масштабе |
| Производительность | Обеспечивает настраиваемую версию нашего представления производительности, которая использует все счетчики производительности Log Analytics, которые вы включили. | Одиночная виртуальная машина | 
| Соединения | Соединения обеспечивают углубленное представление входящих и исходящих соединений с вашего VM. | Одиночная виртуальная машина |
 
## <a name="creating-a-new-workbook"></a>Создание новой трудовой книжки

Книга составлена из разделов, состоящих из отдельно редактируемых диаграмм, таблиц, текста и элементов управления для ввода. Чтобы лучше понять трудовые книжки, давайте начнем с открытия шаблона и пройдем через создание пользовательской книги. 

1. Войдите на [портал Azure](https://portal.azure.com).

2. Выберите **Виртуальные машины**.

3. Выберите виртуальную машину из списка.

4. На странице VM, в разделе **Мониторинг,** выберите **Исследования**.

5. На странице сведения о VM выберите вкладку **«Производительность** или **карты»,** а затем выберите **«Посмотреть трудовые книжки»** по ссылке на странице. Из списка выпадающих вниз, выберите **Перейти в галерею**.

    ![Скриншот выпадающего списка из трудовой книжки](media/vminsights-workbooks/workbook-dropdown-gallery-01.png)

    Это запускает галерею трудовых книжек с рядом заранее построенных трудовых книжек, чтобы помочь вам начать работу.

7. Создайте новую трудовую книжку, выбрав **новый**.

    ![Снимок экрана с коллекцией книг приложения](media/vminsights-workbooks/workbook-gallery-01.png)

## <a name="editing-workbook-sections"></a>Editing workbook sections (Правка разделов книги)

Книги могут работать в двух режимах: **режиме редактирования** и **режиме чтения**. Когда новая трудовая книжка впервые запущена, она открывается в **режиме редактирования.** Он показывает все содержание трудовой книжки, включая любые шаги и параметры, которые в противном случае скрыты. **Режим чтения** представляет упрощенный стиль отчета. Режим чтения позволяет абстрагировать сяострание от сложности, которая вошла в создание отчета, в то же время имея базовую механику всего в нескольких кликах, когда это необходимо для модификации.

![Azure Monitor для элементов управления редактированием разделов с вс-миноносов](media/vminsights-workbooks/workbook-new-workbook-editor-01.png)

1. Когда вы закончите редактирование раздела, нажмите **«Сделано Редактирование»** в левом нижнем углу раздела.

2. Чтобы создать копию раздела, щелкните значок **Clone this section** (Клонировать этот раздел). Создание повторяющихся разделов — это отличный способ для выполнения итерации по запросу без потери предыдущих итераций.

3. Чтобы перейти к следующему или к предыдущему разделу в книге, щелкните значок **Вверх** или **Вниз**.

4. Чтобы окончательно удалить раздел, щелкните значок **Удалить**.

## <a name="adding-text-and-markdown-sections"></a>Добавление текста и разделы разметки Markdown

Добавление заголовков, объяснений и комментариев в Workbooks позволяет превратить набор таблиц и диаграмм в описание. Разделы текста в книгах поддерживают [синтаксис разметки Markdown](https://daringfireball.net/projects/markdown/) для форматирования текста, например заголовков, полужирного шрифта, курсива и маркированных списков.

Чтобы добавить раздел текста в книгу, используйте кнопку **Добавить текст** в нижней части книги, либо в нижней части любого раздела.

## <a name="adding-query-sections"></a>Добавление разделов запроса

![Раздел "Запрос" в Workbooks](media/vminsights-workbooks/005-workbook-query-section.png)

Чтобы добавить раздел запроса в книгу, используйте кнопку **Добавить запрос** в нижней части книги либо в нижней части любого раздела.

Разделы запросов очень гибки и позволяют отвечать на вопросы наподобие следующих:

* Как было использование моего процессора в течение того же периода времени, как увеличение сетевого трафика?
* Какова была тенденция в доступном дисковом пространстве за последний месяц?
* Сколько сбоев сетевого подключения сделал мой опыт VM за последние две недели? 

Вы также не ограничиваетесь только запросами из контекста виртуальной машины, с ней вы запустили трудовую книжку. Вы можете задать запрос в нескольких виртуальных машинах, а также в рабочих пространствах Log Analytics, если у вас есть разрешение на доступ к этим ресурсам.

Включить данные из других рабочих областей анализа журнала или из конкретного приложения Insights с использованием идентификатора **рабочего пространства.** Чтобы узнать больше о межресурсных запросах, обратитесь к [официальному руководству.](../log-query/cross-workspace-query.md)

### <a name="advanced-analytic-query-settings"></a>Расширенные параметры запросов аналитики

Каждый раздел имеет свои собственные расширенные настройки, которые доступны](media/vminsights-workbooks/006-settings.png) через значок управления управления разделом ![Workbooks, расположенный справа от **кнопки параметров Добавления.**

![Azure Monitor для элементов управления редактированием разделов с вс-миноносов](media/vminsights-workbooks/007-settings-expanded.png)

|         |          |
| ---------------- |:-----|
| **Настраиваемая ширина**    | Делает элемент произвольного размера, так что вы можете поместить многие элементы на одной линии позволяет лучше организовать диаграммы и таблицы в богатых интерактивных отчетов.  |
| **Условная видимость** | Укажите, чтобы скрыть шаги на основе параметра при чтении режиме. |
| **Экспорт параметра**| Разрешить выбранную строку в сетке или диаграмме, чтобы вызвать более поздние шаги, чтобы изменить значения или стать видимыми.  |
| **Отображать запрос, когда он не редактируется** | Отображает запрос над диаграммой или таблицей даже при чтении.
| **Показать кнопку "Открыть в службе аналитики", если редактирование не ведется** | Добавляет значок blue Analytics в правый угол диаграммы, чтобы разрешить доступ одним щелчком мыши.|

Большинство из этих параметров довольно очевидны, но для понимания того, как работает **Экспорт параметра**, лучше изучить книгу, использующую эту функцию.

Один из заранее построенных трудовых книжек - **TCP Traffic**, предоставляет информацию о метриках соединения от VM.

Первый раздел книги основан на данных запроса журнала. Второй раздел также основан на данных запроса журнала, но выбор строки в первой таблице будет интерактивно обновлять содержимое диаграмм:

![Azure Monitor для элементов управления редактированием разделов с вс-миноносов](media/vminsights-workbooks/008-workbook-tcp-traffic.png)

Поведение возможно за счет использования **при выборе элемента, экспортирования** расширенных параметров параметров, которые включены в запрос еде журнала таблицы.

![Azure Monitor для элементов управления редактированием разделов с вс-миноносов](media/vminsights-workbooks/009-settings-export.png)

Второй запрос журнала затем использует экспортированные значения, когда строка выбрана для создания набора значений, которые затем используются заголовком раздела и диаграммами. Если строка не выбрана, она скрывает заголовок раздела и диаграммы. 

Например, скрытый параметр во втором разделе использует следующую ссылку из строки, выбранной в сетке:

```
VMConnection
| where TimeGenerated {TimeRange}
| where Computer in ("{ComputerName}") or '*' in ("{ComputerName}") 
| summarize Sent = sum(BytesSent), Received = sum(BytesReceived) by bin(TimeGenerated, {TimeRange:grain})
```

## <a name="adding-metrics-sections"></a>Добавление разделов метрики

Разделы метрики дают вам полный доступ для включения данных метрик Azure Monitor в интерактивные отчеты. В Azure Monitor для VMs, предварительно построенные рабочие книги, как правило, содержат аналитические данные запросов, а не метрические данные.  Вы можете создать трудовые книжки с метрическими данными, что позволит вам в полной мере воспользоваться лучшими из обеих функций в одном месте. Также есть возможность извлечения данных метрики из ресурсов любой из подписок, к которым у вас есть доступ.

Вот пример виртуальных машинных данных, втягиваенных в трудовую книгу, чтобы обеспечить визуализацию производительности процессора в сетке:

![Azure Monitor для элементов управления редактированием разделов с вс-миноносов](media/vminsights-workbooks/010-metrics-grid.png)

## <a name="adding-parameter-sections"></a>Добавление разделов параметров

Параметры книги позволяют изменять значения в книге без ручного редактирования в разделах запросов или текста. Это устраняет необходимость изучения базового языка запросов аналитики и значительно расширяет возможности потенциальной аудитории отчетов на основе книг.

Значения параметров подставляются в запросы, текст или в другие разделы параметров; для этого поместите имя параметра в фигурные скобки, например ``{parameterName}``. Имена параметров ограничены аналогичными правилами, как идентификаторы JavaScript, алфавитные символы или подчеркивание, а затем алфавитные символы или подчеркивание. Так, **a1** разрешено, но **1a** не допускается.

Параметры являются линейными, начиная с верхней части книги и до последующих шагов.  Параметры, заявленные позже в трудовой книжке, могут переопределить параметры, которые были объявлены ранее. Это также позволяет параметрам, которые используют запросы для доступа к значениям из параметров, определенных ранее. В пределах самого шага параметров параметры также линейны и идут слева направо; параметры справа могут зависеть от параметра, объявленного ранее на этом же шаге.
 
Существует четыре различных типа параметров, которые в настоящее время поддерживаются:

|                  |      |
| ---------------- |:-----|
| **Text**    | Позволяет пользователю отсеивать текстовый ящик, и вы можете по желанию предоставить запрос для заполнения значения по умолчанию. |
| **Раскрывающийся список** | Позволяет пользователю выбирать из набора значений. |
| **Средство выбора диапазона времени**| Позволяет пользователю выбирать из заданного набора значений временного диапазона или выбирать из пользовательского диапазона времени.|
| **Сборщик ресурсов** | Позволяет пользователю выбирать из ресурсов, выбранных для рабочей книги.|

### <a name="using-a-text-parameter"></a>Использование текстового параметра

Значение, вводящее сявок пользователя в текстовом поле, заменяется непосредственно в запросе, без каких-либо процитирований. Если нужное значение — строка, параметр в запросе должен быть заключен в кавычки (например, **'{parameter}'**).

Параметр текста позволяет использовать значение в текстовом поле в любом месте. Это может быть имя таблицы, название столбца, имя функции, оператор и т.д.  Тип параметра текста имеет значение настройки **Получить значение по умолчанию из запроса аналитики,** что позволяет автору рабочей книги использовать запрос для заполнения значения по умолчанию для этого текстового поля.

При использовании значения по умолчанию из запроса журнала в качестве значения по умолчанию используется только первое значение первого ряда (строка 0, столбец 0). Поэтому рекомендуется ограничить запрос, чтобы он возвращал только одну строку и один столбец. Любые другие данные, возвращаемые запросом, не учитываются. 

Какое бы значение ни вернул запрос, оно будет подставлено напрямую без экранирования или заключения в кавычки. Если запрос не возвращает строки, результат параметра будет пустой строкой (если параметр не является обязательным) или не определен (если параметр является обязательным).

### <a name="using-a-drop-down"></a>Использование выпадения вниз

Тип параметра выпадения позволяет создать элемент управления выпадения, что позволяет повыбору одного или нескольких значений.

Выпадение заполняется запросом журнала или JSON. Если запрос возвращает один столбец, значения в этом столбце являются как значением, так и меткой в элементе выпадения. Если запрос возвращает два столбца, то первый столбец — значение, а второй — это метка, показанная в выпадающем. Если запрос возвращает три столбца, третий столбец используется для обозначения выбора по умолчанию в этом выпадении. Этот столбец может быть любого типа, но проще всего использовать логические или числовые типы, где 0 — ложь, а 1 — истина.

Если столбец имеет строковый тип, пустая строка рассматривается как ложное значение, а любое другое значение считается истинным. Для одного выбора выпадающих вниз, первое значение с истинным значением используется в качестве выбора по умолчанию.  Для нескольких выпадающих отеков все значения с истинным значением используются в качестве выбранного набора по умолчанию. Элементы в выпадении отображаются отображаются в любом порядке, ответные строки запроса. 

Рассмотрим параметры, присутствующие в отчете «Обзор подключений». Нажмите символ отсвагиваем рядом с **Направлением.**

![Azure Monitor для элементов управления редактированием разделов с вс-миноносов](media/vminsights-workbooks/011-workbook-using-dropdown.png)

Это позволит запустить элемент меню **параметры изменения.**

![Azure Monitor для элементов управления редактированием разделов с вс-миноносов](media/vminsights-workbooks/012-workbook-edit-parameter.png)

JSON позволяет создавать произвольный стол, населенный содержимым. Например, следующий JSON генерирует два значения в падении:

```
[
    { "value": "inbound", "label": "Inbound"},
    { "value": "outbound", "label": "Outbound"}
]
```

Более применимым примером является использование выпадения вниз, чтобы выбрать из набора счетчиков производительности по имени:

```
Perf
| summarize by CounterName, ObjectName
| order by ObjectName asc, CounterName asc
| project Counter = pack('counter', CounterName, 'object', ObjectName), CounterName, group = ObjectName
```

Запрос выводит результаты так:

![Perf счетчик выпадения](media/vminsights-workbooks/013-workbook-edit-parameter-perf-counters.png)

Падение являются невероятно мощными инструментами для настройки и создания интерактивных отчетов.

### <a name="time-range-parameters"></a>Параметры диапазонов времени

Хотя вы можете создать собственный параметр с настраиваемыми диапазонами времени, используя тип параметра раскрывающегося списка, можно применить готовый тип параметра диапазона времени, если гибкость настройки не так важна. 

В типе параметров с диапазонами времени есть 15 диапазонов по умолчанию: от пяти минут до последних 90 дней. Есть также возможность разрешить выбор настраиваемого диапазона времени, который позволяет явно задать в отчете начальное и конечное значения для диапазона времени.

### <a name="resource-picker"></a>Средство выбора ресурсов

Тип параметра со средством выбора ресурсов дает возможность ограничить отчет определенными типами ресурсов. Примером заранее построенной рабочей книги, которая использует тип сборщика ресурсов, является рабочая книга **производительности.**

![Удаление рабочих пространств](media/vminsights-workbooks/014-workbook-edit-parameter-workspaces.png)

## <a name="saving-and-sharing-workbooks-with-your-team"></a>Сохранение и совместное использование книг с коллегами

Рабочие книги сохраняются в рабочем пространстве журнала Analytics или виртуальном машинном ресурсе, в зависимости от того, как вы получаете доступ к галерее трудовых книжек. Рабочая книга может быть сохранена в разделе **"Мои отчеты",** который является конфиденциальной для вас, или в разделе **Общие отчеты,** доступном каждому, имеешь доступ к ресурсу. Для просмотра всех книг в ресурсе нажмите кнопку **Открыть** на панели действий.

Чтобы опубликовать книгу, которая находится в разделе **Мои отчеты**, сделайте следующее:

1. На панели действий щелкните **Сохранить**.
2. Нажмите кнопку "..." рядом с книгой, к которой необходимо предоставить доступ.
3. Щелкните **Move to Shared Reports** (Переместить в общие отчеты).

Чтобы опубликовать книгу с помощью ссылки или по электронной почте, нажмите кнопку **Поделиться** в области действия. Имейте в виду, что получателю ссылки потребуется доступ к этому ресурсу на портале Azure, чтобы просмотреть книгу. Чтобы внести изменения, получателям потребуется по крайней мере разрешения участника ресурса.

Чтобы закрепить ссылку на книгу на панели мониторинга Azure, сделайте следующее:

1. На панели действий щелкните **Сохранить**.
2. Нажмите кнопку "..." рядом с книгой, которую требуется закрепить.
3. Щелкните **Закрепить на панели мониторинга**.

## <a name="next-steps"></a>Дальнейшие действия

- Чтобы определить ограничения и общую производительность VM, [см. Производительность VM Azure.](vminsights-performance.md)

- Чтобы узнать об обнаруженных зависимостях приложений, [см.](vminsights-maps.md)
