---
title: Оценки состояния работоспособности виртуальных машин Azure | Документация Майкрософт
description: В этой статье описывается, как для оценки состояния работоспособности виртуальных машин и базовых операционных систем с помощью Azure Monitor для виртуальных машин.
services: azure-monitor
documentationcenter: ''
author: mgoedtel
manager: carmonm
editor: ''
ms.assetid: ''
ms.service: azure-monitor
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 05/22/2019
ms.author: magoedte
ms.openlocfilehash: 2bf891f8cfecbb9e78e511dcee7ed1c61c170016
ms.sourcegitcommit: a12b2c2599134e32a910921861d4805e21320159
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/24/2019
ms.locfileid: "67340144"
---
# <a name="understand-the-health-of-your-azure-virtual-machines"></a>Оценки состояния работоспособности виртуальных машин Azure

Azure предлагает служб для определенной роли или задачи в панели "Наблюдение", но он не предоставляет подробные работоспособности перспективы операционных систем (ОС), размещенных на виртуальных машинах (ВМ) Azure. Несмотря на то, что Azure Monitor можно использовать для различных условий, он не предназначен для моделирования и представления работоспособности ключевых компонентов или общую работоспособность виртуальных машин.

С помощью Azure Monitor для работоспособности виртуальных машин, может активно отслеживать доступность и производительность гостевой ОС Windows или Linux. Компонент работоспособности использует модель, которая представляет основные компоненты и их отношений, предоставляет критерии, указывает, как измерить работоспособность компонента и отправляет оповещение при обнаружении неработоспособном состоянии.

Просмотр общего состояния работоспособности виртуальной Машины Azure и базовой операционной системы можно наблюдать с двух точек зрения: непосредственно из виртуальной Машины или на всех виртуальных машинах в группе ресурсов из Azure Monitor.

В этой статье показано, как быстро оценить, исследования и устранения проблем с работоспособностью, обнаруженные монитором Azure для виртуальных машин работоспособности компонента.

Сведения о настройке Azure Monitor для виртуальных машин, см. в [этой статье](vminsights-enable-overview.md).

## <a name="monitoring-configuration-details"></a>Сведения о настройке мониторинга

В этом разделе описываются критерии работоспособности по умолчанию для мониторинга виртуальных машин Linux и Windows Azure. Все критерии работоспособности предварительно настроены для отправки предупреждения, когда они неработоспособном состоянии.

### <a name="windows-vms"></a>Виртуальные машины Windows

- доступный объем памяти, мегабайт;
- среднее время на операцию записи, секунд (логический диск);
- среднее время на операцию записи, секунд (диск);
- среднее время на операцию чтения, секунд (логический диск);
- среднее время на операцию перемещения, секунд (логический диск);
- среднее время на операцию чтения, секунд (диск);
- среднее время на операцию перемещения, секунд (диск);
- текущая длина очереди диска (логический диск);
- текущая длина очереди диска (диск);
- процент времени простоя диска;
- ошибка или повреждение файловой системы;
- мало свободного пространства на логическом диске (в процентах);
- мало свободного пространства на логическом диске (в мегабайтах);
- процент времени простоя логического диска;
- страниц памяти в секунду;
- процент используемой пропускной способности чтения;
- процент используемой общей пропускной способности;
- процент используемой пропускной способности записи;
- процент используемой выделенной памяти;
- процент времени простоя диска;
- работоспособность службы DHCP-клиента;
- работоспособность службы DNS-клиента;
- работоспособность службы RPC;
- работоспособность службы сервера;
- общий процент использования ЦП;
- работоспособность службы журнала событий Windows;
- работоспособность службы брандмауэра Windows;
- работоспособность службы удаленного управления Windows.

### <a name="linux-vms"></a>Виртуальные машины Linux

- диск, средн. — время обращения к диску (с)
- диск, средн. — время чтения с диска (с)
- диск, средн. — время записи на диск (с)
- работоспособность диска;
- свободное пространство на логическом диске;
- свободное пространство на логическом диске (в процентах);
- свободные дескрипторы на логическом диске (в процентах);
- работоспособность сетевого адаптера;
- общее процессорное время в процентах;
- доступный для операционной системы объем памяти, мегабайт.

## <a name="sign-in-to-the-azure-portal"></a>Вход на портал Azure

Чтобы войти в систему, перейдите в раздел [портала Azure](https://portal.azure.com).

## <a name="introduction-to-azure-monitor-for-vms-health"></a>Введение в Azure Monitor для работоспособности виртуальных машин

Прежде чем использовать функцию работоспособности для одной виртуальной Машины или группы виртуальных машин, важно понять, как эти сведения можно найти и визуализации представления.

### <a name="view-health-directly-from-a-vm"></a>Просмотр состояния работоспособности непосредственно из виртуальной Машины

Чтобы просмотреть состояние работоспособности виртуальной машины Azure, выберите **Insights (Предварительная версия)** в левой области виртуальной машины. На странице аналитики виртуальной Машины **работоспособности** вкладка по умолчанию открывается и отображается представление работоспособности виртуальной машины.

![Представление работоспособности выбранной виртуальной машины Azure в Azure Monitor для виртуальных машин](./media/vminsights-health/vminsights-directvm-health.png)

В **работоспособности** в списке **работоспособности гостевой виртуальной Машины**, в таблице показаны состояние работоспособности виртуальной машины, и общее число оповещений о работоспособности виртуальной Машины, вызванных неработоспособный компонент.

Дополнительные сведения см. в статье [Как отслеживать кэш Redis для Azure](#alerts).

В следующей таблице описываются состояния работоспособности, которые могут быть определены для виртуальной машины:

|Значок |Исправное состояние |Значение |
|-----|-------------|---------------|
| |Healthy |Виртуальная машина находится в пределах условия определения работоспособности. Это состояние указывает на наличие проблемы не обнаружены, и виртуальная машина работает нормально. Родительский монитор свертки работоспособности сведение и отражает оптимистичный и пессимистичный состояние дочернего элемента.|
| |критические ошибки. |Состояние размещены не в условия определения работоспособности, указывающее, что один или более важные проблемы были обнаружены. Эти проблемы должны направляться для восстановления функциональности. С помощью родительский монитор свертки состояние работоспособности сведение и отражает оптимистичный и пессимистичный состояние дочернего элемента.|
| |Предупреждение |Между двумя пороговыми значениями для условия определения работоспособности, где один указывает состояние предупреждения, а другой указывает на критическое состояние, (можно настроить три пороговые состояния работоспособности), или когда некритические проблема может вызвать критические проблемы, если находится в состоянии неразрешенных. С родительским сводный монитор Если один или несколько дочерних элементов находится в состоянии предупреждения, родительского будет отражать состояние предупреждения. Если один дочерний элемент находится в критическом состоянии, а другой дочерний элемент в состояние предупреждения, родительский накопительный пакет обновления будет отображаться состояние работоспособности как критические.|
| |Unknown |Состояние не может быть вычислено по следующим причинам. В следующем разделе приведены дополнительные сведения и возможные решения. |

Неизвестное состояние может быть вызвана следующие проблемы:

- Изменена конфигурация агента с указанием больше не отчеты в рабочую область при включении Azure Monitor для виртуальных машин. Чтобы настроить агент для отправки отчетов в рабочей области см. в разделе, [Добавление или удаление рабочей области](../platform/agent-manage.md#adding-or-removing-a-workspace).
- Виртуальная машина была удалена.
- Рабочая область, связанная с Azure Monitor для виртуальных машин была удалена. Если у вас есть преимущества поддержки Premier можно восстановить рабочую область. Перейдите к [Premier](https://premier.microsoft.com/) и откройте запрос в службу поддержки.
- Зависимости решения были удалены. Чтобы снова включить ServiceMap и InfrastructureInsights решения в рабочей области Log Analytics, повторно установить эти решения с помощью [шаблона Azure Resource Manager](vminsights-enable-at-scale-powershell.md#install-the-servicemap-and-infrastructureinsights-solutions). Или используйте параметр настройки рабочей области вкладки приступить к работе.
- Виртуальная машина была завершена.
- Виртуальная машина Azure служба недоступна, или производится обслуживание.
- Рабочая область [ежедневные данные или срок хранения](../platform/manage-cost-storage.md) было выполнено.

Выберите **Просмотр диагностики работоспособности** для открытия страницы, на которой показаны все компоненты виртуальной Машины связанными критерия работоспособности, изменения состояния и другие проблемы, обнаруживаемые наблюдение за компонентами, которые относятся к виртуальной Машине.

Дополнительные сведения см. в разделе [Диагностика работоспособности](#health-diagnostics).

В **работоспособности** раздел, в таблице приводится сводный показатель индекса производительности компонентов наблюдением критерия работоспособности. К этим компонентам относятся **ЦП**, **памяти**, **диска**, и **сети**. При выборе компонента открывается страница, на которой перечислены все критерии, мониторинга и состояние работоспособности этого компонента.

При доступе к работоспособности виртуальной машины Azure, работающей в Windows, состояние работоспособности пять основных служб Windows отображается в разделе **основные службы работоспособности**. При выборе каких-либо служб открывается страница, на которой перечислены критерии работоспособности мониторинга для этого компонента, а также состояния.

Выбрав имя критерия работоспособности откроется на панели свойств. В этой области можно просмотреть сведения о конфигурации, включая Если критерии работоспособности у соответствующего предупреждения Azure Monitor.

Дополнительные сведения см. в разделе [диагностики работоспособности и работа с критерия работоспособности](#health-diagnostics).

### <a name="aggregate-vm-perspective"></a>Статистической точки зрения виртуальной Машины

Чтобы просмотреть коллекцию работоспособности для всех виртуальных машин в группе ресурсов, выберите **Azure Monitor** в списке навигации портала, а затем выберите **виртуальных машин (Предварительная версия)** .

![Страница аналитики виртуальных машин. Представление мониторинга в Azure Monitor](./media/vminsights-health/vminsights-aggregate-health.png)

В **подписки** и **группы ресурсов** раскрывающиеся списки, выберите группу соответствующего ресурса, содержащим виртуальные машины связаны с группой, чтобы просмотреть состояние работоспособности, сообщаемых. Выбор применяется только к компоненту работоспособности и не применяется к **производительности** или **карты** вкладки.

**Работоспособности** вкладке содержатся следующие сведения:

* Сколько виртуальных машин находятся в состоянии критическое или неработоспособное, и сколько находятся в работоспособном состоянии, или не отправляете данные (именуемые неизвестное состояние).
* Какие и сколько виртуальных машин с ОС сообщаете о неработоспособном состоянии.
* Сколько виртуальных машин находятся в неработоспособном состоянии из-за проблемы с процессора, диска, памяти или сетевого адаптера, по категориям по состоянию работоспособности.
* Сколько виртуальных машин находятся в неработоспособном состоянии из-за проблемы с базовой службой операционной системы, по категориям по состоянию работоспособности.

На **работоспособности** вкладке, можно определить критические проблемы, обнаруживаемые критерия работоспособности, мониторинга виртуальной Машины и сведения о проверке предупреждений, а также связанных статей базы знаний. Эти статьи могут помочь в диагностике и исправлению неполадок. Чтобы открыть страницу [Все оповещения](../../azure-monitor/platform/alerts-overview.md#all-alerts-page), отфильтрованную по конкретной серьезности, щелкните ее.

В списке **Распределение виртуальных машин по операционной системе** перечислены виртуальные машины по каждому выпуску Windows и (или) версии дистрибутива Linux. В каждой категории ОС виртуальных машин разбивается дальше на основе работоспособности виртуальной машины.

![Страница аналитики виртуальных машин. Представление с распределением виртуальных машин](./media/vminsights-health/vminsights-vmdistribution-by-os.png)

Выберите любой столбец, включая **число виртуальных Машин**, **критическое**, **предупреждение**, **Исправен**, или **Неизвестный**. Просмотр списка отфильтрованных результатов в **виртуальных машин** страницу, которая соответствует выбранного столбца.

Например, чтобы просмотреть все виртуальные машины под управлением Red Hat Enterprise Linux версии 7.5, выберите **число виртуальных Машин** значение для этой ОС, который будут перечислены виртуальные машины, этот фильтр и их текущих состояний работоспособности.

![Пример сводного монитора для виртуальных машин Red Hat Linux](./media/vminsights-health/vminsights-rollup-vm-rehl-01.png)

В **виртуальных машин** странице, если выбрать имя виртуальной Машины в столбце **имя виртуальной Машины**, вы будете направлены **экземпляра виртуальной Машины** страницы. Эта страница содержит дополнительные сведения о предупреждениях и проблем работоспособности критерии, которые влияют на выбранной виртуальной Машины. Отфильтровать сведения о состоянии работоспособности, выбрав **состояние работоспособности** значок в левом верхнем углу страницы, чтобы увидеть, какие компоненты находятся в неработоспособном состоянии. Можно также просмотреть оповещения о работоспособности виртуальной Машины, вызванных неработоспособный компонент, относится к категории по уровню серьезности предупреждения.

Из **список виртуальных Машин** просмотра, выберите имя виртуальной Машины, чтобы открыть **работоспособности** странице для этой виртуальной Машины, точно так же, как если бы вы выбрали **Insights (Предварительная версия)** от НЕЕ напрямую.

![Страница аналитики виртуальных машин. Информация по выбранной виртуальной машине Azure](./media/vminsights-health/vminsights-directvm-health.png)

**Insights (Предварительная версия)** странице отображается сводный показатель состояния работоспособности для виртуальной Машины и оповещения. Это состояние работоспособности относится к категории по уровню серьезности, который представляет виртуальную Машину оповещения о работоспособности возникает при изменении состояния работоспособности с работоспособного на неработоспособное, на основе критериев. Выбрав **виртуальных машин в критическое состояние** , откроется страница со списком один или несколько виртуальных машин в критическом состоянии.

Выберите состояние работоспособности для одной из виртуальных машин показывает **диагностики работоспособности** представление виртуальной машины. В этом представлении можно определить, какие критерии работоспособности отражения проблема состояние работоспособности. Когда **диагностики работоспособности** откроется страница, то выводятся все компоненты виртуальной Машины и критериев их работоспособности с текущим состоянием работоспособности.

Дополнительные сведения см. в разделе [Диагностика работоспособности](#health-diagnostics).

Щелкните **Просмотреть все условия работоспособности**, чтобы открыть страницу со списком всех доступных для этой функции критериев работоспособности. Эти данные можно дополнительно отфильтровать по следующим параметрам:

* **Тип**. Существует три вида критерия работоспособности для оценки условия и сведение общего состояния работоспособности наблюдаемого виртуальной машины.
    - **Единица**. Измеряют определенный аспект виртуальной Машины. Этот тип критериев работоспособности может быть проверка счетчика производительности для определения производительности компонента, выполнение скрипта для синтетической транзакции или наблюдение за события, которое указывает на ошибку. Фильтр имеет значение к единице, по умолчанию.
    - **Зависимость**. Обеспечивают сводку работоспособности разных сущностей. Этот критерий работоспособности позволяет работоспособности сущности зависят от работоспособности другого типа сущности, необходимого для успешной работы.
    - **Агрегатные**. Предоставляет объединенное состояние работоспособности аналогичные критериев работоспособности. Критерий работоспособности единиц и зависимостей обычно настраиваются в разделе критерий агрегатов работоспособности. Критерий агрегации не только позволяет лучше упорядочить несколько разных критериев для одной сущности, но и определить уникальные состояния работоспособности для отдельных категорий сущностей.

* **Категория**. Тип критерия работоспособности для группирования подобные критерии для составления отчетов. Эти категории являются **доступности** и **производительности**.

Чтобы увидеть, какие экземпляры находятся в неработоспособном состоянии, выберите значение в разделе **неработоспособный компонент** столбца. На этой странице таблице перечислены компоненты, которые находятся в состоянии объекта "Критическое".

## <a name="health-diagnostics"></a>Диагностика работоспособности

**Диагностики работоспособности** страницы позволяет визуализировать модели работоспособности виртуальной машины. На этой странице перечислены все компоненты виртуальной Машины, критерии работоспособности, изменения состояния и другие серьезные проблемы, идентифицируемый отслеживаемых компонентов, относящихся к виртуальной Машине.

![Пример страницы диагностики работоспособности для виртуальной машины](./media/vminsights-health/health-diagnostics-page-01.png)

Запуск диагностики работоспособности с помощью следующих методов:

* По состоянию сводный показатель работоспособности для всех виртуальных машин с статистической точки зрения виртуальной Машины в Azure Monitor:

    1. На **работоспособности** выберите значок **критическое**, **предупреждение**, **Исправен**, или **Неизвестный** состояние работоспособности в разделе **работоспособности гостевой виртуальной Машины**.
    2. Перейдите на страницу, в котором перечислены все виртуальные машины, соответствующие этой категории отфильтрованные.
    3. Выберите значение в **состояние работоспособности** столбца, чтобы открыть на эту виртуальную Машину с заданной областью диагностические сведения о работоспособности.

* ОС с точки зрения агрегатные виртуальной Машины в Azure Monitor. Из раздела **Распределение виртуальных машин** при выборе любого из значений в столбцах открывается страница **Виртуальные машины** со списком в табличном виде, который отфильтрован по выбранной категории. Выбор этого значения в разделе **состояние работоспособности** столбец открывает диагностики работоспособности для выбранной виртуальной Машины.
 
* Из гостевой виртуальной Машине в Azure Monitor для виртуальных машин **работоспособности** вкладку, выбрав **Просмотр диагностики работоспособности**.

Диагностика работоспособности организует данные о работоспособности на две категории: доступность и производительность.
 
Без фильтрации на две категории можно просмотреть все критерии работоспособности, определенные для компонента, например логического диска, ЦП и т. д. Эти представления можно в представлении комплексная критериев или с помощью фильтрации результатов по категориям, либо при выборе **доступности** или **производительности**.

Кроме того, категории критериев отображаются рядом с полем **критерия работоспособности** столбца. Если условия не соответствуют выбранной категории, сообщение о том, **без критериев работоспособности, доступных для выбранной категории** отображается в **критерия работоспособности** столбца.

Состояние критериев работоспособности определяется с помощью одного из четырех типов: **Критические**, **предупреждение**, **работоспособное**, и **Неизвестный**. Первые три — для настройки, это означает, что можно изменить пороговые значения мониторов непосредственно в **критерия работоспособности** области конфигурации. Это также можно сделать с помощью Azure Monitor REST API [монитор операция обновления](https://docs.microsoft.com/rest/api/monitor/microsoft.workloadmonitor/monitors/update). **Неизвестный** не настраивается и зарезервирован для конкретных сценариев.

**Диагностики работоспособности** страница содержит три основных раздела:

* "Модель компонентов";
* Health Criteria (Критерии работоспособности);
* "Изменения состояния".

![Разделы страницы диагностики работоспособности](./media/vminsights-health/health-diagnostics-page-02.png)

### <a name="component-model"></a>Модель компонентов

В крайнем левом столбце **диагностики работоспособности** страница **модели компонентов**. Все компоненты, которые связаны с виртуальной Машиной, отображаются в этом столбце, а также их текущее состояние работоспособности.

В следующем примере, обнаруженные компоненты представляют собой **диска**, **логический диск**, **процессора**, **памяти**, и  **Операционная система**. В этом столбце обнаруживаются и отображаются несколько экземпляров этих компонентов.

Например, на следующем рисунке показано, что виртуальная машина имеет два экземплярами логических дисков **C:** и **D:** , которого находятся в работоспособном состоянии:

![Пример модели компонентов в разделе диагностики работоспособности](./media/vminsights-health/health-diagnostics-page-component.png)

### <a name="health-criteria"></a>Критерии работоспособности

Столбец center на странице диагностики работоспособности **критерия работоспособности**. Модель работоспособности, созданная для виртуальной машины, отображается здесь в виде иерархического дерева. Модель работоспособности для виртуальной машины состоит из критериев работоспособности "Блок" и "Агрегация".

![Пример критериев работоспособности в разделе диагностики работоспособности](./media/vminsights-health/health-diagnostics-page-healthcriteria.png)

Критерия работоспособности для оценки работоспособности отслеживаемого экземпляра, который может быть пороговое значение, состояние сущности и т. д. Критерий работоспособности имеет два или три пороговые состояния работоспособности можно настроить, как описано выше. В любой момент критерия работоспособности может быть только в одном из потенциальных состояний.

Модель работоспособности определяет условия, которые определяют состояние работоспособности общей цели и компоненты целевого объекта. Иерархия критериев показана на **критерия работоспособности** разделе **диагностики работоспособности** страницы.

Политика сводного показателя работоспособности является частью конфигурации агрегатов работоспособности критериев (значение по умолчанию имеет значение **худшее of**). Вы найдете набор по умолчанию выполняется как часть эту функцию в критерии работоспособности [конфигурации сведения о наблюдении за](#monitoring-configuration-details) этой статьи.

Можно также использовать Azure Monitor REST API [список экземпляров монитора по ресурсу](https://docs.microsoft.com/rest/api/monitor/microsoft.workloadmonitor/monitorinstances/listbyresource) для получения списка всех критериев работоспособности. Этому критерию включает в себя сведения о конфигурации, использующим ресурса виртуальной Машины Azure.

**Единицы** тип критериев работоспособности может иметь свою конфигурацию, изменить, выбрав ссылку кнопку с многоточием справа от оператора. Выберите **Показать подробности** чтобы открыть область конфигурации.

![Пример конфигурации критериев работоспособности](./media/vminsights-health/health-diagnostics-vm-example-02.png)

В области конфигурации работоспособности выбранного критерия, если вы используете пример **среднее секунд записи на диск**, можно настроить пороговое значение с другим числовым значением. Монитор двух состояний, то есть его можно изменить только из **Исправен** для **предупреждение**.

Другие критерии работоспособности иногда используют три состояния, где можно задать значение для предупреждения и критическим пороговым значением состояния работоспособности. Можно также изменить пороговое значение с помощью Azure Monitor REST API [конфигурации монитора](https://docs.microsoft.com/rest/api/monitor/microsoft.workloadmonitor/monitors/update).

>[!NOTE]
>Применение изменений конфигурации критериев работоспособности для одного экземпляра применяет их для всех отслеживаемых экземпляров. Например, если вы выберите **на диске D:-1** и измените **среднее секунд записи на диск** порогового значения, применяется ко всем экземплярам обнаружению и мониторингу на виртуальной Машине.


![Пример настройки критерия работоспособности для базового монитора](./media/vminsights-health/health-diagnostics-criteria-config-01.png)

Если вы хотите узнать больше о критерия работоспособности, мы включили статей базы знаний, чтобы помочь выявить проблемы, причины и способы их устранения. Выберите **сведения** на странице, чтобы см. в статье базы знаний, относящиеся.

Чтобы просмотреть все статьи базы знаний, в состав Azure Monitor для работоспособности виртуальных машин, см. в разделе [документации знаний о работоспособности Azure Monitor](https://docs.microsoft.com/azure/monitoring/infrastructure-health/).

### <a name="state-changes"></a>Изменения состояний

В крайнем правом столбце **диагностики работоспособности** страница **изменения состояния**. В этом столбце перечислены все изменения состояния, связанные с работоспособностью критериям, выбранным в **критерия работоспособности** раздела или изменение состояния виртуальной машины, если был выбран виртуальную Машину из **модели компонентов** или  **Критерии работоспособности** столбца таблицы.

![Пример изменений состояний в разделе диагностики работоспособности](./media/vminsights-health/health-diagnostics-page-statechanges.png)

В следующем разделе показано состояние критерия работоспособности и связанного времени. Здесь можно просмотреть последнее состояние в верхней части столбца.

### <a name="association-of-component-model-health-criteria-and-state-changes-columns"></a>Сопоставление столбцов модели компонентов, критерии работоспособности и изменения состояния

Эти три столбца связаны друг с другом. При выборе экземпляра в **модели компонентов** столбце **критерия работоспособности** столбец фильтруется для этого компонента представления. Соответственно **изменения состояния** обновляется на основе критериев работоспособности выбранный столбец.

![Пример выбора отслеживаемого экземпляра и фильтрации результатов](./media/vminsights-health/health-diagnostics-vm-example-01.png)

Например, если вы выберите *диск — 1 D:* в списке **модели компонентов**, **критерия работоспособности** фильтров к *диск — 1 D:* и  **Изменений состояния** указывается изменение состояния на основании доступность *диск — 1 D:* .

Чтобы просмотреть состояние обновленные данные о работоспособности, можно обновить страницу диагностики работоспособности, выбрав **обновить** ссылку. Если состояние работоспособности для критерия работоспособности изменяется с определенным заданным интервалом, это действие позволит избежать ожидания и сразу отобразить свежие данные о работоспособности. **Критериев состояние работоспособности** является фильтром, который позволяет определить область результатов на основе состояния работоспособности выбранного: Работоспособное, предупреждение, критическое, Unknown и все. **Последнего обновления** время последнего обновления на странице диагностики работоспособности представляет время в правом верхнем углу.

## <a name="alerts"></a>Оповещения

Azure Monitor для работоспособности виртуальных машин можно интегрировать с [оповещений Azure](../../azure-monitor/platform/alerts-overview.md). Он выдает оповещения, когда предопределенными критериями, при обнаружении изменения с работоспособного на другое в неработоспособное состояние. Оповещения упорядочены по уровню серьезности, из Sev 0 – 4 уровень серьезности с уровень серьезности 0 для высшего уровня.

Оповещения не связаны с группы действий для уведомления о том, когда было запущено оповещение. Владелец подписки необходимо настроить уведомления, выполнив действия, описанные в [Настройка оповещений](#configure-alerts) раздел.

Общее число оповещений о работоспособности виртуальной Машины, на категории по уровню серьезности можно найти в **работоспособности** панели мониторинга в разделе **оповещения** раздел. Когда вы выбираете общее число оповещений или число, соответствующее определенному уровню серьезности, открывается страница **Оповещения** со списком всех оповещений для выбранного элемента.

Например, если выбрать строку, соответствующую **уровень серьезности 1**, вы увидите следующее представление:

![Пример оповещений для уровня серьезности 1](./media/vminsights-health/vminsights-sev1-alerts-01.png)

**Все оповещения** страницы не ограничиваются Показать только предупреждения, ваш выбранного способа сопоставления. Также он фильтруется по **тип ресурса** для отображения только предупреждений о работоспособности, вызванных ресурса виртуальной Машины. Этот формат отражается в список оповещений, в столбце **целевой ресурс**, где указано на виртуальной Машине Azure вызванное предупреждение при неработоспособном состоянии было выполнено.

Оповещения от других типов ресурсов или службы не предназначены для включения в этом представлении. Эти предупреждения содержат оповещений журнала, которые основаны на запросов к журналу или оповещений метрик, которые можно будет просматривать по умолчанию Azure Monitor [все оповещения](../../azure-monitor/platform/alerts-overview.md#all-alerts-page) страницы.

Это представление можно фильтровать, выбрав значения в раскрывающихся меню в верхней части страницы.

|столбец |Описание |
|-------|------------|
|Подписка |Выберите подписку Azure. В представление включены только оповещения из выбранных подписок. |
|Группа ресурсов |Выбор одной группы ресурсов. Только те предупреждения, которые отмечены в выбранной группе ресурсов, включены в представление. |
|Тип ресурса |Выбор одной или нескольких группу ресурсов. По умолчанию только оповещения целевого объекта **Виртуальные машины** выбраны и включены в это представление. Этот столбец становится доступным только после указания группы ресурсов. |
|Ресурс |Выбор ресурса. В представление включены только те оповещения, целью которых выбраны ресурсы. Этот столбец доступен только в том случае, после был указан тип ресурса. |
|Уровень серьезности |Чтобы включить оповещения всех уровней, выберите уровни оповещения или **Все**. |
|Состояние монитора |Выберите состояние монитора на фильтр оповещения, если они были инициируется или разрешено системой, если условие больше не активна. Также можно выбрать **все** для включения оповещения из всех условий. |
|Состояние оповещения |Выберите состояние предупреждения, **New**, **Acknowledge**, **закрыто**, или **все** для включения оповещения всех состояний. |
|Мониторинг службы |Чтобы включить все службы, выберите службу или **Все**. Для этой функции поддерживаются только оповещения из виртуальной Машины Insights.|
|Диапазон времени| Только оповещения, выполненные в рамках выбранного временного интервала, будут включены в представление. Поддерживаемые значения: за последний час, за последние 24 часа, за последние 7 дней и за последние 30 дней. |

При выборе оповещения, **предупреждения подробно** откроется страница. Эта страница предоставляет сведения об оповещении и позволяет изменить его состояние.

Дополнительные сведения об управлении оповещениями см. в статье [Создание и просмотр оповещений метрик, а также управление ими с помощью Azure Monitor](../../azure-monitor/platform/alerts-metric.md).

>[!NOTE]
>Создание новых оповещениях на основе критерия работоспособности или изменение существующего работоспособности правила генерации оповещений в Azure Monitor с портала сейчас не поддерживается.


![Панель сведений о выбранном оповещении](./media/vminsights-health/alert-details-pane-01.png)

Состояние оповещения для одного или нескольких предупреждений можно изменить, выбрав их, а затем выбрав **изменить состояние** из **все оповещения** страницы в левом верхнем углу. Выберите одно из состояний на **изменить состояние оповещения** панель, добавьте описание внесенного изменения в **комментарий** поле, а затем выберите **ОК** для фиксации изменений. После проверки данных и применения изменений, отслеживать ход выполнения в разделе **уведомления** в меню.

### <a name="configure-alerts"></a>Настройка оповещений
Некоторые задачи управления предупреждение нельзя управлять с помощью портала Azure. Эти задачи должны выполняться с помощью [Azure Monitor REST API](https://docs.microsoft.com/rest/api/monitor/microsoft.workloadmonitor/components). В частности:

- Включение или отключение оповещения для критерия работоспособности
- Настройка уведомлений для оповещений о работоспособности критериев

Каждый пример использует [ARMClient](https://github.com/projectkudu/armclient) на компьютере Windows. Если вы не знакомы с этим способом, см. в разделе [ARMClient с помощью](../platform/rest-api-walkthrough.md#use-armclient).

#### <a name="enable-or-disable-an-alert-rule"></a>Включить или отключить правило генерации оповещений

Чтобы включить или отключить оповещение о работоспособности определенных критериев, свойство **alertGeneration** изменения следует использовать значение **отключено** или **включено**.

Для идентификации *monitorId* работоспособности определенных критериев, в следующем примере показано, как запрос для этого значения для критериев **Диск\ср секунд на обращения к диску**:

1. В окне терминала введите **armclient.exe login**. При этом появится запрос на вход в Azure.

2. Введите следующую команду, чтобы получить все критерии работоспособности, активным на определенной виртуальной Машины и определить значение для *monitorId* свойство:

    ```
    armclient GET "subscriptions/subscriptionId/resourceGroups/resourcegroupName/providers/Microsoft.Compute/virtualMachines/vmName/providers/Microsoft.WorkloadMonitor/monitors?api-version=2018-08-31-preview”
    ```

    В следующем примере показано выходные данные *armclient GET* команды. Запишите значение *MonitorId*. Это значение является обязательным для выполнения следующего шага, где необходимо указать идентификатор критерия работоспособности и изменить его свойства, чтобы создать оповещение.

    ```
    "id": "/subscriptions/a7f23fdb-e626-4f95-89aa-3a360a90861e/resourcegroups/Lab/providers/Microsoft.Compute/virtualMachines/SVR01/providers/Microsoft.WorkloadMonitor/monitors/ComponentTypeId='LogicalDisk',MonitorId='Microsoft_LogicalDisk_AvgDiskSecPerRead'",
      "name": "ComponentTypeId='LogicalDisk',MonitorId='Microsoft_LogicalDisk_AvgDiskSecPerRead'",
      "type": "Microsoft.WorkloadMonitor/virtualMachines/monitors"
    },
    {
      "properties": {
        "description": "Monitor the performance counter LogicalDisk\\Avg Disk Sec Per Transfer",
        "monitorId": "Microsoft_LogicalDisk_AvgDiskSecPerTransfer",
        "monitorName": "Microsoft.LogicalDisk.AvgDiskSecPerTransfer",
        "monitorDisplayName": "Average Logical Disk Seconds Per Transfer",
        "parentMonitorName": null,
        "parentMonitorDisplayName": null,
        "monitorType": "Unit",
        "monitorCategory": "PerformanceHealth",
        "componentTypeId": "LogicalDisk",
        "componentTypeName": "LogicalDisk",
        "componentTypeDisplayName": "Logical Disk",
        "monitorState": "Enabled",
        "criteria": [
          {
            "healthState": "Warning",
            "comparisonOperator": "GreaterThan",
            "threshold": 0.1
          }
        ],
        "alertGeneration": "Enabled",
        "frequency": 1,
        "lookbackDuration": 17,
        "documentationURL": "https://aka.ms/Ahcs1r",
        "configurable": true,
        "signalType": "Metrics",
        "signalName": "VMHealth_Avg. Logical Disk sec/Transfer"
      },
      "etag": null,
    ```

3. Введите следующую команду, чтобы изменить *alertGeneration* свойство:

    ```
    armclient patch subscriptions/subscriptionId/resourceGroups/resourcegroupName/providers/Microsoft.Compute/virtualMachines/vmName/providers/Microsoft.WorkloadMonitor/monitors/Microsoft_LogicalDisk_AvgDiskSecPerTransfer?api-version=2018-08-31-preview "{'properties':{'alertGeneration':'Disabled'}}"
    ```   

4. Введите команду GET, использовавшееся на шаге 2, чтобы проверить, присвоено значение свойства **отключено**.

#### <a name="associate-an-action-group-with-health-criteria"></a>Связать группу действий с критерия работоспособности

Azure Monitor для работоспособности виртуальных машин поддерживает уведомления, SMS и электронной почты, при создании предупреждений из критерия неработоспособное работоспособности. Чтобы настроить уведомления, запомните имя группы настроенное действие для отправки уведомлений электронной почты или SMS.

>[!NOTE]
>Это действие необходимо выполнить от каждого отслеживаемых виртуальных Машин, который вы хотите получать уведомления об. Он не применяется ко всем виртуальным машинам в группе ресурсов.

1. В окне терминала введите *armclient.exe login*. При этом появится запрос на вход в Azure.

2. Введите следующую команду, чтобы связать группу действий с правилами генерации оповещений:
 
    ```
    $payload = "{'properties':{'ActionGroupResourceIds':['/subscriptions/subscriptionId/resourceGroups/resourcegroupName/providers/microsoft.insights/actionGroups/actiongroupName']}}"
    armclient PUT https://management.azure.com/subscriptions/subscriptionId/resourceGroups/resourcegroupName/providers/Microsoft.Compute/virtualMachines/vmName/providers/Microsoft.WorkloadMonitor/notificationSettings/default?api-version=2018-08-31-preview $payload
    ```

3. Чтобы убедиться, что значение свойства **actionGroupResourceIds** был успешно обновлен, введите следующую команду:

    ```
    armclient GET "subscriptions/subscriptionName/resourceGroups/resourcegroupName/providers/Microsoft.Compute/virtualMachines/vmName/providers/Microsoft.WorkloadMonitor/notificationSettings?api-version=2018-08-31-preview"
    ```

    Выходные данные должны выглядеть следующим критериям:
    
    ```
    {
      "value": [
        {
          "properties": {
            "actionGroupResourceIds": [
              "/subscriptions/a7f23fdb-e626-4f95-89aa-3a360a90861e/resourceGroups/Lab/providers/microsoft.insights/actionGroups/Lab-IT%20Ops%20Notify"
            ]
          },
          "etag": null,
          "id": "/subscriptions/a7f23fdb-e626-4f95-89aa-3a360a90861e/resourcegroups/Lab/providers/Microsoft.Compute/virtualMachines/SVR01/providers/Microsoft.WorkloadMonitor/notificationSettings/default",
          "name": "notificationSettings/default",
          "type": "Microsoft.WorkloadMonitor/virtualMachines/notificationSettings"
        }
      ],
      "nextLink": null
    }
    ```

## <a name="next-steps"></a>Дальнейшие действия

- Чтобы определить ограничения и общую производительность виртуальной Машины, см. в разделе [производительности виртуальной Машины Azure представление](vminsights-performance.md).
- Дополнительные сведения о зависимостях обнаруженных приложений, см. в разделе [представление Azure Monitor для виртуальных машин карты](vminsights-maps.md).
