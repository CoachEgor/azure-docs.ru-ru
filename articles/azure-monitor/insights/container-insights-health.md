---
title: Мониторинг работоспособности кластера Kubernetes с помощью Azure Monitor для контейнеров | Документация Майкрософт
description: Эта статья содержит сведения о просмотре и анализе работоспособность кластеров AKS и кластеров, не являющихся AKS, с помощью Azure Monitor для контейнеров.
ms.topic: conceptual
ms.date: 05/18/2020
ms.openlocfilehash: 94fdb6388134eae326ed5a8e46fbd3d13f8da2d5
ms.sourcegitcommit: fdec8e8bdbddcce5b7a0c4ffc6842154220c8b90
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2020
ms.locfileid: "83649578"
---
# <a name="understand-kubernetes-cluster-health-with-azure-monitor-for-containers"></a>Общие сведения о мониторинге работоспособности кластера Kubernetes с помощью Azure Monitor для контейнеров

С помощью Azure Monitor для контейнеров вы можете отслеживать состояние работоспособности управляемых компонентов инфраструктуры и всех узлов, работающих в любых кластерах Kubernetes, поддерживаемых в Azure Monitor для контейнеров, и создавать отчеты. Эта процедура выходит за пределы определения состояния работоспособности кластера и создания отчетов в [мультикластерном представлении](container-insights-analyze.md#multi-cluster-view-from-azure-monitor). Теперь вы можете определить, ограничен ли ресурсами один или несколько узлов в кластере, или доступен ли узел или модуль pod. Если они недоступны, это может повлиять на работу приложения в кластере на основе проверенных метрик.

>[!NOTE]
>Функция проверки работоспособности будет доступна для использования в качестве закрытой предварительной версии в конце июня 2020 г. Дополнительные сведения см. в следующем [объявлении об обновлениях Azure](https://azure.microsoft.com/updates/ci-health-limited-preview/).
>

Дополнительные сведения о включении Azure Monitor для контейнеров см. в [этой статье](container-insights-onboard.md).

>[!NOTE]
>Для поддержки кластеров обработчика AKS убедитесь, что он соответствует следующим требованиям:
>- Используется последняя версия [клиента HELM](https://helm.sh/docs/using_helm/).
>- Контейнерная версия агента — *microsoft/oms:ciprod11012019*. Сведения об обновлении агента см. в разделе [Способы обновления агента решения "Azure Monitor для контейнеров"](container-insights-manage-agent.md#how-to-upgrade-the-azure-monitor-for-containers-agent).
>

## <a name="overview"></a>Обзор

В Azure Monitor для контейнеров функция работоспособности (предварительная версия) обеспечивает упреждающий мониторинг работоспособности кластера Kubernetes для выявления и диагностики проблем. Она дает возможность просматривать обнаруженные серьезные проблемы. Мониторы, оценивающие работоспособность кластера, запускаются на контейнерном агенте в вашем кластере, и данные о работоспособности записываются в таблицу **KubeHealth** в рабочей области Log Analytics. 

Работоспособность кластера Kubernetes основана на ряде сценариев мониторинга, упорядоченных по следующим объектам Kubernetes и абстракциям:

- Инфраструктура Kubernetes предоставляет свертку сервера API Kubernetes, ReplicaSets и DaemonSets, выполняющихся на узлах, развернутых в кластере, с помощью оценки использования ЦП и памяти, а также доступности модулей Pod.

    ![Представление свертки работоспособности инфраструктуры Kubernetes](./media/container-insights-health/health-view-kube-infra-01.png)

- В разделе "Узлы" предоставлена свертка пулов узлов и отдельных узлов в каждом пуле, путем оценки ЦП и памяти, а также состояния узла по данным Kubernetes.

    ![Представление свертки работоспособности узлов](./media/container-insights-health/health-view-nodes-01.png)

В настоящее время поддерживается только состояние Virtual Kubelet. Состояние работоспособности для использования ЦП и памяти узлов Virtual Kubelet отмечено как **Неизвестное**, так как от них не получен сигнал.

Все мониторы отображаются в иерархическом макете на панели иерархии работоспособности, где составной монитор, представляющий объект Kubernetes или абстракцию (то есть инфраструктуру Kubernetes или узлы), является самым верхним монитором, отражающим объединенное состояние работоспособности всех зависимых дочерних мониторов. Ключевые сценарии мониторинга, используемые для формирования работоспособности:

* Оценка использования ЦП на узле и в контейнере.
* Оценка использования памяти на узле и в контейнере.
* Состояние модулей Pod и узлов на основе вычисления их состояния готовности по данным Kubernetes.

Для обозначения состояния используются следующие значки:

|Значок|Значение|  
|--------|-----------|  
|![Зеленая галочка обозначает работоспособное состояние](./media/container-insights-health/healthyicon.png)|Успешно, работоспособность в норме (зеленый)|  
|![Желтый треугольник и восклицательный знак обозначают предупреждение](./media/container-insights-health/warningicon.png)|Предупреждение (желтый)|  
|![Красная кнопка с белым знаком X обозначает критическое состояние](./media/container-insights-health/criticalicon.png)|Критическое (красный)|  
|![Значок серого цвета](./media/container-insights-health/grayicon.png)|Неизвестно (серый)|  

## <a name="monitor-configuration"></a>Конфигурация монитора

Сведения о поведении и конфигурации каждого монитора, поддерживающего функцию проверки работоспособности Azure Monitor для контейнеров, см. в [этой статье](container-insights-health-monitors-config.md).

## <a name="sign-in-to-the-azure-portal"></a>Вход на портал Azure

Войдите на [портал Azure](https://portal.azure.com). 

## <a name="view-health-of-an-aks-or-non-aks-cluster"></a>Просмотр работоспособности кластера AKS или кластера, отличного от AKS

Доступ к функции проверки работоспособности (предварительная версия) Azure Monitor для контейнеров можно получить непосредственно из кластера AKS, выбрав **Аналитика** в области слева на портале Azure. В разделе **Аналитика** выберите **Контейнеры**. 

Чтобы просмотреть работоспособность из кластера, не являющегося AKS, то есть кластера обработчика AKS, размещенного локально или в Azure Stack, выберите **Azure Monitor** на портале Azure в области слева. В разделе **Аналитика** выберите **Контейнеры**.  На странице с несколькими кластерами выберите в списке кластер, отличный от AKS.

В Azure Monitor для контейнеров на странице **Кластер** выберите **Работоспособность**.

![Пример панели мониторинга работоспособности кластера](./media/container-insights-health/container-insights-health-page.png)

## <a name="review-cluster-health"></a>Проверка работоспособности кластера

После открытия страницы работоспособности в сетке **Аспект работоспособности** по умолчанию выбран параметр **Инфраструктура Kubernetes**.  В сетке предоставлены общие сведения о текущем состоянии свертки работоспособности инфраструктуры Kubernetes и узлов кластера. При выборе одного из аспектов работоспособности результаты на панели Health Hierarchy (Иерархия работоспособности) (то есть на средней панели) будут изменены, а на всех дочерних мониторах в иерархическом макете будет отображаться из текущее состояние работоспособности. Чтобы просмотреть дополнительные сведения о зависимом мониторе, можно выбрать один из них, и в правой части страницы автоматически отобразится панель свойств. 

![Панель свойств работоспособности кластера](./media/container-insights-health/health-view-property-pane.png)

На панели свойств вы узнаете следующее:

- На вкладке **Обзор** отображается текущее состояние выбранного монитора, время последнего вычисления монитора и последнего изменения состояния. Дополнительные сведения отображаются в зависимости от типа монитора, выбранного в иерархии.

    При выборе составного монитора на панели иерархии работоспособности на вкладке **Обзор** на панели свойств отображается свертка общего числа дочерних мониторов в иерархии, а также количество мониторов, которые находятся в критическом состоянии и состоянии предупреждения и работоспособности. 

    ![Вкладка "Обзор" на панели свойств работоспособности для составного монитора](./media/container-insights-health/health-overview-aggregate-monitor.png)

    Если выбрать базовый монитор на панели иерархии работоспособности, он также будет отображаться в разделе **Последнее изменение состояния** предыдущих выборок, вычисляемых и сообщаемых контейнерным агентом за последние четыре часа. Эта процедура основывается на вычислении базовых мониторов для сравнения нескольких последовательных значений, чтобы определить их состояние. Например, если вы выбрали базовый монитор *Pod ready state* (Модуль Pod в состоянии готовности), он показывает две выборки, управляемые с помощью параметра *ConsecutiveSamplesForStateTransition*. Для получения дополнительных сведений о базовых мониторах ознакомьтесь с этим [разделом](container-insights-health-monitors-config.md#unit-monitors).
    
    ![Вкладка "Обзор" на панели свойств работоспособности](./media/container-insights-health/health-overview-unit-monitor.png)

    Если время, указанное в разделе **Последнее изменение состояния**, составляет один день или больше, состояние монитора не изменится. Однако если с момента последней выборки, полученной для базового монитора, прошло более четырех часов, это, скорее всего, означает что контейнерный агент не отправлял данные. Если агенту известно, что существует определенный ресурс, например узел, но он не получил данные от мониторов, использующих память или ЦП узлов, то для работоспособности монитора устанавливается состояние **Неизвестно**.  

- На вкладке**Конфигурация** отображаются параметры конфигурации по умолчанию (только для базовых мониторов, не для составных мониторов) и их значения.
- На вкладке **База знаний** содержатся сведения, объясняющие поведение монитора и то, как он оценивает наличие неработоспособного состояния.

Данные мониторинга на этой странице не обновляются автоматически, поэтому для просмотра последнего состояния работоспособности, полученного из кластера, необходимо нажать кнопку **Обновить** в верхней части страницы.

## <a name="next-steps"></a>Дальнейшие действия

Просмотрите [примеры запросов журналов](container-insights-log-search.md#search-logs-to-analyze-data), чтобы увидеть предопределенные запросы и примеры для оценки или настройки оповещений, визуализации или анализа кластеров.
