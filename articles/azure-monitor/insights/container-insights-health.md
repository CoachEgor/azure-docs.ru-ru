---
title: Мониторинг здоровья кластеров Kubernetes с Azure Monitor для контейнеров Документы Майкрософт
description: В этой статье описывается, как можно просматривать и анализировать работоспособность кластеров AKS и не AKS с помощью Azure Monitor для контейнеров.
ms.topic: conceptual
ms.date: 12/01/2019
ms.openlocfilehash: f50ef13efca78bbb5285b99759b8111dc1915ad0
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "76843996"
---
# <a name="understand-kubernetes-cluster-health-with-azure-monitor-for-containers"></a>Понять здоровье кластера Kubernetes с помощью Azure Monitor для контейнеров

С Azure Monitor для контейнеров он отслеживает и сообщает о состоянии работоспособности управляемых компонентов инфраструктуры и всех узлов, работающих на любом кластере Kubernetes, поддерживаемых Azure Monitor для контейнеров. Этот опыт выходит за рамки состояния кластера, рассчитанного и сообщаемого в [представлении мультикластера,](container-insights-analyze.md#multi-cluster-view-from-azure-monitor)где теперь можно понять, ограничен ли один или несколько узлов в кластере, или узла или стручка, которые могут повлиять на запущенное приложение в кластере на основе курируемых метрик.

>[!NOTE]
>Функция «Здоровье» в настоящее время находится в открытом доступе.
>

Для получения информации о том, как включить Azure Monitor для контейнеров, можно ознакомиться на [борту Azure Monitor для контейнеров.](container-insights-onboard.md)

>[!NOTE]
>Чтобы поддержать кластеры AKS Engine, убедитесь, что они соответствуют следующим требованиям:
>- Он использует последнюю версию [клиента HELM](https://helm.sh/docs/using_helm/).
>- Версия контейнерного агента *microsoft/oms:ciprod11012019*. Для обновления агента [см.](container-insights-manage-agent.md#upgrade-agent-on-monitored-kubernetes-cluster)
>

## <a name="overview"></a>Обзор

Функция «Монитор Azure Monitor» для контейнеров обеспечивает упреждающий мониторинг работоспособности кластера Kubernetes, помогая выявлять и диагностировать проблемы. Это дает вам возможность просматривать значительные обнаруженные проблемы. Мониторы, оценивающие работоспособность кластера, работают на контейнерном агенте в кластере, а данные о работоспособности записываются в таблицу **KubeHealth** в рабочем пространстве log Analytics. 

Здоровье кластера Kubernetes основано на ряде сценариев мониторинга, организованных следующими объектами и абстракциями Kubernetes:

- Инфраструктура Kubernetes - обеспечивает свертывание сервера API Kubernetes, ReplicaSets и DaemonSets, работающих на узлах, развернутых в кластере, путем оценки использования процессора и памяти, а также доступности Pods

    ![Представление представления о свертывании инфраструктуры инфраструктуры Kubernetes](./media/container-insights-health/health-view-kube-infra-01.png)

- Узлы - обеспечивает свертывание пулов узлов и состояние отдельных узлов в каждом пуле, путем оценки использования процессора и памяти, а также состояние узла, как сообщает Kubernetes.

    ![Представление осконзанки узлов](./media/container-insights-health/health-view-nodes-01.png)

В настоящее время поддерживается только статус виртуального кубелета. Состояние работоспособности для процессора и использования памяти виртуальных узлов kublet сообщается как **неизвестный**, так как сигнал не получен от них.

Все мониторы отображаются в иерархической компоновке в панели иерархии работоспособности, где агрегатный монитор, представляющий объект Kubernetes или абстракцию (т.е. инфраструктура Kubernetes или узлы) является самым верхним монитором, отражающим общее состояние всех мониторы на иждивении ребенка. Ключевыми сценариями мониторинга, используемыми для получения работоспособности, являются:

* Оцените использование процессора из узла и контейнера.
* Оцените использование памяти из узла и контейнера.
* Состояние стручков и узлов на основе расчета их готового состояния сообщает Kubernetes.

Для обозначения состояния используются перечисленные ниже значки.

|Значок|Значение|  
|--------|-----------|  
|![Зеленая галочка обозначает работоспособное состояние](./media/container-insights-health/healthyicon.png)|Успешно, работоспособное состояние (зеленый)|  
|![Желтый треугольник и восклицательный знак обозначают предупреждение](./media/container-insights-health/warningicon.png)|Предупреждение (желтый)|  
|![Красная кнопка с белым знаком X обозначает критическое состояние](./media/container-insights-health/criticalicon.png)|Критическое состояние (красный)|  
|![Серая иконка](./media/container-insights-health/grayicon.png)|Неизвестный (серый)|  

## <a name="monitor-configuration"></a>Конфигурация монитора

Чтобы понять поведение и конфигурацию каждого монитора, поддерживающего [Health monitor configuration guide](container-insights-health-monitors-config.md)Azure Monitor для функции «Здоровье контейнеров», см.

## <a name="sign-in-to-the-azure-portal"></a>Вход на портал Azure

Войдите на [портал Azure](https://portal.azure.com). 

## <a name="view-health-of-an-aks-or-non-aks-cluster"></a>Просмотр работоспособности кластера AKS или неAKS

Доступ к функции Azure Monitor для контейнеров Health (preview) доступен непосредственно из кластера AKS, выбрав **Исследования** из левого стекла на портале Azure. В разделе **Аналитика** выберите **Контейнеры**. 

Для просмотра работоспособности из кластера, не связанного с AKS, который является кластером AKS Engine, размещенным на месте или в Azure Stack, выберите **Azure Monitor** из левого стекла на портале Azure. В разделе **Аналитика** выберите **Контейнеры**.  На странице мультикластера выберите кластер non-AKS из списка.

В Azure Monitor для контейнеров со страницы **кластера** выберите **Здоровье.**

![Пример панели мониторинга кластера](./media/container-insights-health/container-insights-health-page.png)

## <a name="review-cluster-health"></a>Обзор здоровья кластеров

При открытии страницы "Здоровье" по умолчанию **инфраструктура Kubernetes** выбирается в сетке **"Аспект аработоспособности".**  Сетка обобщает текущее состояние свертывания работоспособности инфраструктуры Kubernetes и кластерных узлов. Выбор любого аспекта работоспособности обновляет результаты в панели иерархии работоспособности (т.е. в середине панели) и показывает все мониторы ребенка в иерархической компоновке, отображая их текущее состояние работоспособности. Для просмотра дополнительной информации о любом зависимом мониторе можно выбрать один из них, а панель свойств автоматически отображается на правой стороне страницы. 

![Панель свойств кластера здоровья](./media/container-insights-health/health-view-property-pane.png)

На панели свойств вы узнаете следующее:

- На вкладке **«Обзор»** отображается текущее состояние выбранного монитора, когда монитор был последним рассчитан, и когда произошло последнее изменение состояния. Дополнительная информация отображается в зависимости от типа монитора, выбранного в иерархии.

    При выборе агрегированного монитора в панели иерархии работы под вкладкой **«Обзор»** на панели свойств отображается свертывание общего числа мониторов в иерархии, а также количество агрегированных мониторов в критическом, предупреждении и здоровом состоянии. 

    ![Вкладка панели панели свойств работы для агрегатного монитора](./media/container-insights-health/health-overview-aggregate-monitor.png)

    При выборе монитора единицы в панели иерархии работы также отображается под **последним изменением состояния** предыдущие образцы, рассчитанные и сообщенные контейнерным агентом в течение последних четырех часов. Это основано на расчете мониторов единицы для сравнения нескольких последовательных значений для определения его состояния. Например, если вы выбрали монитор *готового состояния Pod,* он показывает последние два образца, контролируемых параметром *ConsecutiveSamplesForStateTransition.* Для получения дополнительной информации, смотрите подробное описание [единицы мониторов](container-insights-health-monitors-config.md#unit-monitors).
    
    ![Вкладка панели панели свойств работоспособности](./media/container-insights-health/health-overview-unit-monitor.png)

    Если время, сообщенное **В последней смене состояния,** является днем или старше, это результат отсутствия изменений состояния монитора. Однако, если последний образец, полученный для монитора единицы, более четырех часов, это, вероятно, указывает на то, что контейнерный агент не посылал данные. Если агент знает, что определенный ресурс существует, например, узла, но он не получил данные из процессора узла или мониторов использования памяти (например), то состояние работоспособности монитора устанавливается **неизвестному**.  

- На вкладке**Config** отображается параметр конфигурации по умолчанию (только для мониторов единиц, а не для агрегированных мониторов) и их значения.
- На вкладке **Знание** содержится информация, объясняющая поведение монитора и то, как он оценивает нездоровое состояние.

Мониторинг данных на этой странице не обновляется автоматически, и вам необходимо выбрать **Обновление** в верхней части страницы, чтобы увидеть последнее состояние работоспособности, полученное из кластера.

## <a name="next-steps"></a>Дальнейшие действия

Просмотр [примеров запросов журналов](container-insights-log-search.md#search-logs-to-analyze-data) для просмотра предопределенных запросов и примеров для оценки или настройки для оповещения, визуализации или анализа кластеров.
