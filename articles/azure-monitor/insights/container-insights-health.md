---
title: Мониторинг работоспособности кластера Kubernetes с помощью Azure Monitor для контейнеров | Документация Майкрософт
description: В этой статье описывается, как просмотреть и проанализировать работоспособность AKS и AKS кластеров с помощью Azure Monitor для контейнеров.
services: azure-monitor
documentationcenter: ''
author: mgoedtel
manager: carmonm
editor: ''
ms.assetid: ''
ms.service: azure-monitor
ms.topic: conceptual
ms.workload: infrastructure-services
ms.date: 11/18/2019
ms.author: magoedte
ms.openlocfilehash: 08f7cf5a26108608aa3719085d69ec9543f4aa51
ms.sourcegitcommit: 653e9f61b24940561061bd65b2486e232e41ead4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/21/2019
ms.locfileid: "74279655"
---
# <a name="understand-kubernetes-cluster-health-with-azure-monitor-for-containers"></a>Сведения о работоспособности кластера Kubernetes с Azure Monitor для контейнеров

С Azure Monitor для контейнеров он отслеживает состояние работоспособности управляемых компонентов инфраструктуры и сообщает о них, а также о всех узлах, работающих в любом кластере Kubernetes, поддерживаемом Azure Monitor для контейнеров. Этот процесс выходит за пределы состояния работоспособности кластера и сообщает о нем в [представлении с несколькими кластерами](container-insights-analyze.md#multi-cluster-view-from-azure-monitor), где теперь можно понять, ограничен ли ресурс одним или несколькими узлами в кластере, или недоступен узел или модуль, которые могут повлиять на работу приложения в кластере на основе проверенных метрик.

>[!NOTE]
>В настоящее время функция работоспособности доступна в общедоступной предварительной версии.
>

Сведения о том, как включить Azure Monitor для контейнеров, см. в разделе подключение [Azure Monitor для контейнеров](container-insights-onboard.md).

>[!NOTE]
>Для поддержки кластеров AKS Engine убедитесь, что он соответствует следующим требованиям.
>- Он использует последнюю версию [клиента Helm](https://helm.sh/docs/using_helm/).
>- Контейнерная версия агента — *Microsoft/OMS: ciprod11012019*. Сведения об обновлении агента см. в статье [обновление агента в кластере Kubernetes](container-insights-manage-agent.md#upgrading-agent-on-monitored-kubernetes-cluster).
>

## <a name="overview"></a>Обзор

В Azure Monitor для контейнеров функция работоспособности (Предварительная версия) обеспечивает упреждающий мониторинг работоспособности кластера Kubernetes для выявления и диагностики проблем. Она дает возможность просматривать обнаруженные серьезные проблемы. Мониторы, оценивающие работоспособность кластера в контейнерном агенте в кластере, а данные о работоспособности записываются в таблицу **кубехеалс** в рабочей области log Analytics. 

Работоспособность кластера Kubernetes основана на ряде сценариев мониторинга, упорядоченных по следующим объектам Kubernetes и абстракциям:

- Инфраструктура Kubernetes — включает свертку сервера API Kubernetes, Репликасетс и Daemonset, работающих на узлах, развернутых в кластере, с помощью оценки использования ЦП и памяти, а также доступности модулей

    ![Сводное представление работоспособности инфраструктуры Kubernetes](./media/container-insights-health/health-view-kube-infra-01.png)

- Nodes — предоставляет сводный показатель пулов узлов и состояний отдельных узлов в каждом пуле, оценивая использование ЦП и памяти, и состояние узла, сообщаемое Kubernetes.

    ![Сводное представление работоспособности узлов](./media/container-insights-health/health-view-nodes-01.png)

В настоящее время поддерживается только состояние виртуальной kubelet. Состояние работоспособности для использования ЦП и памяти виртуальных узлов кублет сообщается как **неизвестное**, так как от них не получен сигнал.

Все мониторы отображаются в иерархическом макете на панели Иерархия работоспособности, где составной монитор, представляющий объект Kubernetes или абстракцию (то есть инфраструктура Kubernetes или узлы), является самым верхним монитором, отражающим объединенное состояние работоспособности всех зависимые дочерние мониторы. Ключевые сценарии мониторинга, используемые для формирования работоспособности:

* Оцените использование ЦП на узле и в контейнере.
* Оцените использование памяти на узле и в контейнере.
* Состояние модулей Pod и узлов на основе вычисления состояния готовности, сообщаемого Kubernetes.

Для обозначения состояния используются следующие значки:

|Значок|Значение|  
|--------|-----------|  
|![Зеленый значок галочки указывает на работоспособность](./media/container-insights-health/healthyicon.png)|Успешно, работоспособность — нормальное состояние (зеленый)|  
|![Желтый треугольник и восклицательный знак — предупреждение](./media/container-insights-health/warningicon.png)|Предупреждение (желтый)|  
|![Красная кнопка с белым крестиком означает критическое состояние](./media/container-insights-health/criticalicon.png)|Критический (красный)|  
|![Значок серого цвета](./media/container-insights-health/grayicon.png)|Неизвестно (серый)|  

## <a name="monitor-configuration"></a>Конфигурация монитора

Чтобы разобраться в поведении и конфигурации каждого монитора, поддерживающего Azure Monitor для работоспособности контейнеров, см. раздел [руководств по настройке монитора исправности](container-insights-health-monitors-config.md).

## <a name="sign-in-to-the-azure-portal"></a>Вход на портал Azure

Войдите на [портал Azure](https://portal.azure.com). 

## <a name="view-health-of-an-aks-or-non-aks-cluster"></a>Просмотр работоспособности кластера AKS или AKS

Доступ к функции "Azure Monitor для работоспособности контейнеров (Предварительная версия)" доступен непосредственно из кластера AKS. для этого выберите **аналитику** на левой панели в портал Azure. В разделе **Аналитика** выберите **Контейнеры**. 

Чтобы просмотреть сведения о работоспособности из кластера, отличного от AKS, который является кластером AKS, размещенным локально или Azure Stack, выберите **Azure Monitor** в левой области в портал Azure. В разделе **Аналитика** выберите **Контейнеры**.  На странице с несколькими кластерами выберите в списке кластер, отличный от AKS.

В Azure Monitor для контейнеров на странице **кластер** выберите **работоспособность**.

![Пример панели мониторинга работоспособности кластера](./media/container-insights-health/container-insights-health-page.png)

## <a name="review-cluster-health"></a>Проверка работоспособности кластера

Когда откроется страница работоспособность, в сетке **аспект работоспособности** будет выбрана **инфраструктура Kubernetes** по умолчанию.  Сетка суммирует текущее состояние сводного показателя работоспособности инфраструктуры Kubernetes и узлов кластера. При выборе одного из аспектов работоспособности результаты отображаются на панели Иерархия работоспособности (то есть на средней панели), а все дочерние мониторы — в иерархическом макете, отображая текущее состояние работоспособности. Чтобы просмотреть дополнительные сведения о зависимом мониторе, можно выбрать один из них, и панель свойств будет автоматически отображаться в правой части страницы. 

![Панель свойств «работоспособность кластера»](./media/container-insights-health/health-view-property-pane.png)

На панели свойств вы узнаете следующее:

- На вкладке **Обзор** отображается текущее состояние выбранного монитора, время последнего вычисления монитора и время последнего изменения состояния. Дополнительные сведения отображаются в зависимости от типа монитора, выбранного в иерархии.

    При выборе составного монитора в области иерархия работоспособности на вкладке **Обзор** панели свойств отображается сводное значение общего числа дочерних мониторов в иерархии, а также число мониторов, которые находятся в критическом, предупреждении и работоспособном состоянии. 

    ![Вкладка обзора панели свойств работоспособности для составного монитора](./media/container-insights-health/health-overview-aggregate-monitor.png)

    Если выбрать базовый монитор на панели Иерархия работоспособности, он также будет отображаться в **последнем состоянии изменить** предыдущие примеры, вычисленные и переданные контейнером агентом в течение последних четырех часов. Это основано на вычислении базовых мониторов для сравнения нескольких последовательных значений, чтобы определить его состояние. Например, если вы выбрали базовый монитор *состояния "модуль готовности* ", он показывает два последних примера, управляемых с помощью параметра *консекутивесамплесфорстатетранситион*. Дополнительные сведения см. в подробном описании [базовых мониторов](container-insights-health-monitors-config.md#unit-monitors).
    
    ![Вкладка обзора панели свойств работоспособности](./media/container-insights-health/health-overview-unit-monitor.png)

    Если время, сообщаемое **последним изменением состояния** , относится к дню или более раннему, оно является результатом отсутствия изменений в состоянии для данного монитора. Однако если последний пример, полученный для базового монитора, имеет более четырех часов, это может означать, что контейнерный агент не отправлял данные. Если агент знает, что существует определенный ресурс, например узел, но он не получил данные от мониторов ЦП или использования памяти узла (например,), то состояние работоспособности монитора устанавливается равным **Unknown**.  

- На вкладке**Конфигурация** отображаются параметры конфигурации по умолчанию (только для базовых мониторов, не для составных мониторов) и их значения.
- На вкладке **Knowledge (база знаний** ) содержатся сведения, объясняющие поведение монитора и его оценку на наличие неработоспособного состояния.

Данные мониторинга на этой странице не обновляются автоматически. для просмотра последнего состояния работоспособности, полученного из кластера, необходимо выбрать **Обновление** в верхней части страницы.

## <a name="next-steps"></a>Дополнительная информация

Просмотрите [примеры запросов журналов](container-insights-log-search.md#search-logs-to-analyze-data) , чтобы ознакомиться с предопределенными запросами и примерами, чтобы оценить, визуализировать или проанализировать кластеры.