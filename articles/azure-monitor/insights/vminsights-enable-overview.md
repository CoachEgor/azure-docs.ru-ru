---
title: Включить обзор Azure Monitor для виртуальных машин
description: Узнайте, как развертывать и настраивать Azure Monitor для виртуальных машин. Ознакомьтесь с требованиями к системе.
ms.subservice: ''
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 04/08/2020
ms.openlocfilehash: 5bb5d5dd5110f176b59a99f6a3aa223184158da5
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "80982316"
---
# <a name="enable-azure-monitor-for-vms-overview"></a>Включить обзор Azure Monitor для виртуальных машин

В этой статье представлен обзор доступных параметров, позволяющих Azure Monitor для виртуальных машин на виртуальных машинах отслеживать работоспособность и производительность. Обнаружение зависимостей приложений, выполняемых на виртуальных машинах Azure и масштабируемых наборах виртуальных машин, локальных виртуальных машин или виртуальных машин, размещенных в другой облачной среде.  

Чтобы настроить Azure Monitor для виртуальных машин, выполните следующие действия.

* Включите одну ВИРТУАЛЬную машину Azure или масштабируемый набор виртуальных машин, выбрав **аналитику** непосредственно из виртуальной машины или масштабируемого набора виртуальных машин.
* Включите две или больше виртуальных машин Azure и масштабируемых наборов виртуальных машин с помощью политики Azure. Этот метод гарантирует, что на существующих и новых виртуальных машинах и масштабируемых наборах необходимые зависимости установлены и настроены правильно. Выводятся сведения о несоответствующих виртуальных машинах и масштабируемых наборах, поэтому можно решить, следует ли их включить и исправить.
* Включите две или несколько виртуальных машин или масштабируемых наборов виртуальных машин Azure в определенной подписке или группе ресурсов с помощью PowerShell.
* Включите Azure Monitor для виртуальных машин для мониторинга виртуальных машин или физических компьютеров, размещенных в корпоративной сети или в другой облачной среде.

## <a name="prerequisites"></a>Предварительные условия

Прежде чем начинать работу, убедитесь, что вы понимаете сведения, содержащиеся в следующих разделах. 

>[!NOTE]
>Следующие сведения, описанные в этом разделе, также применимы к [решению сопоставление служб](service-map.md).  

### <a name="log-analytics"></a>Log Analytics

Azure Monitor для виртуальных машин поддерживает рабочую область Log Analytics в следующих регионах:

- центрально-западная часть США
- западная часть США
- западная часть США 2
- Центрально-южная часть США
- Восточная часть США
- восточная часть США 2
- Центральная часть США
- Центрально-северная часть США
- Центральная Канада
- южная часть Соединенного Королевства
- Северная Европа
- Западная Европа
- Восточная Азия
- Юго-Восточная Азия
- Центральная Индия
- Восточная Япония
- Восточная Австралия
- Юго-Восточная часть Австралии

>[!NOTE]
>Вы можете отслеживать виртуальные машины Azure в любом регионе. Сами виртуальные машины не ограничиваются регионами, поддерживаемыми Log Analytics рабочей областью.
>

Если у вас нет рабочей области Log Analytics, можно создать ее с помощью одного из ресурсов:
* [Azure CLI](../../azure-monitor/learn/quick-create-workspace-cli.md)
* [PowerShell](../../azure-monitor/learn/quick-create-workspace-posh.md)
* [Портал Azure](../../azure-monitor/learn/quick-create-workspace.md)
* [Azure Resource Manager](../../azure-monitor/platform/template-workspace-configuration.md)

Вы также можете создать рабочую область, пока вы включаете мониторинг для отдельной ВИРТУАЛЬНОЙ машины Azure или масштабируемого набора виртуальных машин в портал Azure.

Чтобы настроить сценарий масштабирования, в котором используется политика Azure, Azure PowerShell или шаблоны Azure Resource Manager, в рабочей области Log Analytics:

* Установите решения *ServiceMap* и *инфраструктуреинсигхтс* . Эту установку можно выполнить с помощью предоставленного шаблона Azure Resource Manager. Или на вкладке Начало **работы** в портал Azure выберите **Настройка рабочей области**.
* Настройте рабочую область Log Analytics для сбора данных счетчиков производительности.

Чтобы настроить рабочую область для сценария с масштабом, используйте один из следующих методов.

* Используйте [Azure PowerShell](vminsights-enable-at-scale-powershell.md#set-up-a-log-analytics-workspace).
* На странице " [**покрытие политики**](vminsights-enable-at-scale-policy.md#manage-policy-coverage-feature-overview) Azure Monitor для виртуальных машин" выберите **настроить рабочую область**. 

### <a name="supported-operating-systems"></a>Поддерживаемые операционные системы

В следующей таблице перечислены операционные системы Windows и Linux, поддерживаемые Azure Monitor для виртуальных машин. Далее в этом разделе вы найдете полный список, в котором подробно описывается основной и дополнительный выпуск ОС Linux и поддерживаемые версии ядра.

|Версия ОС |Тестирование |Карты |
|-----------|------------|-----|
|Windows Server 2019 | X | X |
|Windows Server 2016 1803 | X | X |
|Windows Server 2016 | X | X |
|Windows Server 2012 R2 | X | X |
|Windows Server 2012 | X | X |
|Windows Server 2008 R2 | X | X|
|Windows 10 1803 | X | X |
|Windows 8.1 | X | X |
|Windows 8 | X | X |
|Windows 7 с пакетом обновления 1 (SP1); | X | X |
|Red Hat Enterprise Linux (RHEL) 6, 7| X | X| 
|Ubuntu 18,04, 16,04 | X | X |
|CentOS Linux 7, 6 | X | X |
|SUSE Linux Enterprise Server (SLES) 12 | X | X |
|Debian 9.4, 8 | X<sup>1</sup> | |

<sup>1</sup> Функция "Производительность" Azure Monitor для виртуальных машин доступна только в Azure Monitor. Она недоступна непосредственно из левой панели виртуальной машины Azure.

>[!NOTE]
>В операционной системе Linux:
> - Поддерживаются только версии ядра по умолчанию и SMP для Linux.
> - Нестандартные версии ядра, такие как расширение физических адресов (PAE) и Xen, не поддерживаются ни в одном дистрибутиве Linux. Например, система со строкой версии *2.6.16.21-0.8-xen* не поддерживается.
> - Пользовательские ядра, включая перекомпиляции стандартных ядер, не поддерживаются.
> - Поддерживается ядро Центосплус.
> - Для уязвимости устранением рисков Spectre необходимо исправление ядра Linux. Дополнительные сведения см. в поставщике дистрибутива Linux.

#### <a name="red-hat-linux-7"></a>Red Hat Linux 7

| Версия ОС | Версия ядра |
|:--|:--|
| 7.6 | 3.10.0-957 |
| 7.5 | 3.10.0-862 |
| 7.4 | 3.10.0-693 |

#### <a name="red-hat-linux-6"></a>Red Hat Linux 6

| Версия ОС | Версия ядра |
|:--|:--|
| 6.10 | 2.6.32-754 |
| 6.9 | 2.6.32-696 |

#### <a name="centosplus"></a>центосплус

| Версия ОС | Версия ядра |
|:--|:--|
| 6.10 | 2.6.32 — 754.3.5<br>2.6.32 — 696.30.1 |
| 6.9 | 2.6.32 — 696.30.1<br>2.6.32 — 696.18.7 |

#### <a name="ubuntu-server"></a>Сервер Ubuntu

| Версия ОС | Версия ядра |
|:--|:--|
| 18,04 | 5,0 (включает ядро, настроенное Azure)<br>4,18*<br>4,15* |
| 16.04.3 | 4,15. * |
| 16.04 | 4.13.\*<br>4.11.\*<br>4.10.\*<br>4.8.\*<br>4.4.\* |

#### <a name="suse-linux-12-enterprise-server"></a>SUSE Linux 12 Enterprise Server

| Версия ОС | Версия ядра |
|:--|:--|
|12 SP4 | 4,12. * (включает в себя настраиваемый в Azure ядро) |
|12 с пакетом обновления 3 | 4.4.* |
|12 с пакетом обновления 2 | 4.4.* |

#### <a name="debian"></a>Debian 

| Версия ОС | Версия ядра |
|:--|:--|
| 9 | 4,9 | 

### <a name="the-microsoft-dependency-agent"></a>Microsoft Dependency Agent

Функция Map в Azure Monitor для виртуальных машин получает данные от агента зависимостей Майкрософт. Dependency Agent является зависимым от агента Log Analytics для создания подключений к Log Analytics. Поэтому в системе должен быть установлен и настроен агент Log Analytics с агентом зависимостей.

Независимо от того, включено ли Azure Monitor для виртуальных машин для одной виртуальной машины Azure или используется метод масштабируемого развертывания, используйте расширение агента зависимости виртуальной машины Azure для [Windows](../../virtual-machines/extensions/agent-dependency-windows.md) или [Linux](../../virtual-machines/extensions/agent-dependency-linux.md) , чтобы установить агент как часть работы.

>[!NOTE]
>Следующие сведения, описанные в этом разделе, также применимы к [решению сопоставление служб](service-map.md).  

В гибридной среде можно загрузить и установить агент зависимостей вручную или с помощью автоматизированного метода.

В приведенной ниже таблице описаны подключенные источники, которые функция схемы поддерживает в гибридной среде.

| Подключенный источник | Поддерживается | Описание |
|:--|:--|:--|
| Агенты Windows | Да | Вместе с [агентом log Analytics для Windows](../../azure-monitor/platform/log-analytics-agent.md)агентам Windows требуется агент зависимостей. Дополнительные сведения см. в разделе [Поддерживаемые операционные системы](#supported-operating-systems). |
| Агенты Linux | Да | Вместе с [агентом log Analytics для Linux](../../azure-monitor/platform/log-analytics-agent.md)агентам Linux требуется агент зависимостей. Дополнительные сведения см. в разделе [Поддерживаемые операционные системы](#supported-operating-systems). |
| Группа управления System Center Operations Manager | Нет | |

Вы можете скачать агент зависимостей из следующих расположений:

| Файл | Операционная система | Version | SHA-256 |
|:--|:--|:--|:--|
| [InstallDependencyAgent-Windows.exe](https://aka.ms/dependencyagentwindows) | Windows | 9.10.3.9380 | 40763BD0A5B60707DF3F9E7BCC17D917F5CE995F2F5A4633D8B733F3BE143921  |
| [InstallDependencyAgent-Linux64.bin](https://aka.ms/dependencyagentlinux) | Linux | 9.10.3.9380 | BB41BB59BDD293968F02A9EF821F9639406AA1BDF1F67925DB9EE00D54AA7F0B |

## <a name="role-based-access-control"></a>Управление доступом на основе ролей

Чтобы включить функции и получить доступ к ним в Azure Monitor для виртуальных машин, необходимо иметь роль *участника log Analytics* . Для просмотра данных о производительности, работоспособности и сопоставлении необходимо иметь роль " *читатель мониторинга* " для виртуальной машины Azure. Необходимо настроить рабочую область Log Analytics для Azure Monitor для виртуальных машин.

Дополнительные сведения о том, как управлять доступом к рабочей области Log Analytics, см. в статье [Управление рабочими областями](../../azure-monitor/platform/manage-access.md).

## <a name="how-to-enable-azure-monitor-for-vms"></a>Включение Azure Monitor для виртуальных машин

Включите Azure Monitor для виртуальных машин с помощью одного из методов, описанных в этой таблице.

| Состояние развертывания | Метод | Описание |
|------------------|--------|-------------|
| Одна ВИРТУАЛЬная машина Azure или масштабируемый набор виртуальных машин | [Включение из виртуальной машины](vminsights-enable-single-vm.md) | Вы можете включить одну виртуальную машину Azure, выбрав **аналитику** непосредственно из виртуальной машины или масштабируемого набора виртуальных машин. |
| Несколько виртуальных машин Azure или масштабируемых наборов виртуальных машин | [Включить с помощью политики Azure](vminsights-enable-at-scale-policy.md) | Вы можете включить несколько виртуальных машин Azure, используя политику Azure и доступные определения политик. |
| Несколько виртуальных машин Azure или масштабируемых наборов виртуальных машин | [Включение с помощью Azure PowerShell или шаблонов Azure Resource Manager](vminsights-enable-at-scale-powershell.md) | Вы можете включить несколько виртуальных машин Azure или масштабируемых наборов виртуальных машин в указанной подписке или группе ресурсов с помощью шаблонов Azure PowerShell или Azure Resource Manager. |
| Гибридное облачное решение | [Включить для гибридной среды](vminsights-enable-hybrid-cloud.md) | Можно выполнить развертывание на виртуальных машинах или физических компьютерах, размещенных в вашем центре обработки данных или в других облачных средах. |

## <a name="management-packs"></a>Пакеты управления

Если Azure Monitor для виртуальных машин включена и настроена с Log Analytics рабочей областью, пакет управления перенаправляется на все компьютеры Windows, передающие данные в эту рабочую область. Если [Группа управления System Center Operations Manager интегрирована](../../azure-monitor/platform/om-agents.md) с рабочей областью log Analytics, пакет управления сопоставление служб развертывается из группы управления на компьютерах Windows, отправляющих отчеты в группу управления.  

Пакет управления называется *Microsoft. IntelligencePacks. ApplicationDependencyMonitor*. Его запись в `%Programfiles%\Microsoft Monitoring Agent\Agent\Health Service State\Management Packs\` папку. Источником данных, который использует пакет управления, является `%Program files%\Microsoft Monitoring Agent\Agent\Health Service State\Resources\<AutoGeneratedID>\Microsoft.EnterpriseManagement.Advisor.ApplicationDependencyMonitorDataSource.dll`.

## <a name="diagnostic-and-usage-data"></a>Данные диагностики и использования

Корпорация Майкрософт автоматически собирает данные об использовании и производительности при работе службы Azure Monitor. Корпорация Майкрософт использует эти данные для повышения качества, безопасности и целостности службы. 

Чтобы обеспечить точную и эффективную работу по устранению неполадок, функция Map включает данные о конфигурации программного обеспечения. Данные содержат такие сведения, как операционная система, версия, IP-адрес, DNS-имя и имя рабочей станции. Корпорация Майкрософт не собирает сведения об именах, адресах и другую контактную информацию.

Дополнительные сведения о сборе и использовании данных см. в [заявлении о конфиденциальности служб Microsoft Online Services](https://go.microsoft.com/fwlink/?LinkId=512132).

[!INCLUDE [GDPR-related guidance](../../../includes/gdpr-dsr-and-stp-note.md)]

Теперь, когда вы включили мониторинг для виртуальной машины, данные мониторинга доступны для анализа в Azure Monitor для виртуальных машин.

## <a name="next-steps"></a>Дальнейшие шаги

Сведения об использовании функции наблюдения за производительностью см. в разделе [View Azure Monitor для виртуальных машин Performance](vminsights-performance.md). Для просмотра обнаруженных зависимостей приложений см. статью о [просмотре схемы Azure Monitor для виртуальных машин](vminsights-maps.md).
