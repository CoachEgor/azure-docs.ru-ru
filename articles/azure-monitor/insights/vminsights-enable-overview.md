---
title: Включение Azure Monitor для обзор виртуальных машин (Предварительная версия) | Документация Майкрософт
description: В этой статье описывается, как развернуть и настроить Azure Monitor для виртуальных машин и необходимые системные требования.
services: azure-monitor
documentationcenter: ''
author: mgoedtel
manager: carmonm
editor: ''
ms.assetid: ''
ms.service: azure-monitor
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 05/22/2019
ms.author: magoedte
ms.openlocfilehash: c84c3eb74d214a5c98aabef7b2e2987dfdf67c0f
ms.sourcegitcommit: cababb51721f6ab6b61dda6d18345514f074fb2e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/04/2019
ms.locfileid: "66472604"
---
# <a name="enable-azure-monitor-for-vms-preview-overview"></a>Включение Azure Monitor для обзор виртуальных машин (Предварительная версия)

В этой статье представлен обзор вариантов установки Azure Monitor для виртуальных машин отслеживать работоспособность и производительность и обнаружить зависимости приложения, работающие на виртуальных машинах Azure и масштабируемые наборы виртуальных машин, локальных виртуальных машин, или виртуальных машин, размещенными в другой облачной среде.  

Azure Monitor для виртуальных машин включается одним из следующих способов:

* Включение одной виртуальной машины Azure или масштабируемого набора, выбрав виртуальных машин **Insights (Предварительная версия)** непосредственно от виртуальной Машины или виртуальной машины масштабируемого набора.
* Включить две или задает дополнительные возможности виртуальных машин Azure и виртуальных машин с помощью политики Azure. Через этот метод необходимые зависимости, существующих и новых виртуальных машин и масштабируемых наборов установлен и правильно настроен. Выводятся несовместимых виртуальных машин и масштабируемых наборов, что дает возможность решить, следует ли включить их, и как следует исправлять их.
* Включите две или несколько виртуальных машин или масштабируемых наборов виртуальных машин Azure в определенной подписке или группе ресурсов с помощью PowerShell.
* Включите мониторинг виртуальных машин или физических компьютеров, размещенных в корпоративной сети или другой облачной среде.

## <a name="prerequisites"></a>Технические условия

Прежде чем начинать работу, убедитесь, что вы понимаете сведения, содержащиеся в следующих разделах.

### <a name="log-analytics"></a>Log Analytics

Azure Monitor для виртуальных машин поддерживает рабочую область Log Analytics в следующих регионах:

- Западно-центральная часть США
- Западная часть США 2<sup>1</sup>
- Восточная часть США
- Центральная Канада<sup>1</sup>
- UK South<sup>1</sup>
- Западная Европа
- Юго-Восточная Азия<sup>1</sup>

<sup>1</sup> Этот регион сейчас не поддерживает функцию мониторинга работоспособности в Azure Monitor для виртуальных машин.

>[!NOTE]
>Виртуальные машины Azure можно развернуть из любого региона, а не только из поддерживаемых регионов для рабочей области Log Analytics.
>

Если у вас нет рабочей области, можно создать ее одним из следующих способов:
* [CLI Azure.](../../azure-monitor/learn/quick-create-workspace-cli.md)
* [PowerShell](../../azure-monitor/learn/quick-create-workspace-posh.md)
* [Портал Azure](../../azure-monitor/learn/quick-create-workspace.md)
* [Azure Resource Manager](../../azure-monitor/platform/template-workspace-configuration.md)

Если вы включаете мониторинг для отдельной виртуальной Машины или масштабируемого набора на портале Azure виртуальных машин, можно создать рабочую область в ходе этого процесса.

Для сценария в масштабе, с помощью политики Azure, Azure PowerShell или шаблонов Azure Resource Manager рабочую область Log Analytics прежде всего необходимо настроено следующее:

* Установите решения ServiceMap и InfrastructureInsights. Можно выполнить установку с помощью шаблона Azure Resource Manager, который предоставляется или с помощью **Настройка рабочей области** параметр найти на **приступить к работе** вкладки.
* Настройте рабочую область Log Analytics для сбора данных счетчиков производительности.

Чтобы настроить рабочую область для сценария в масштабе, можно настроить с помощью одного из следующих методов:

* [Azure PowerShell](vminsights-enable-at-scale-powershell.md#set-up-a-log-analytics-workspace)
* Из **Настройка рабочей области** параметр в Azure Monitor для виртуальных машин [покрытия политики](vminsights-enable-at-scale-policy.md#manage-policy-coverage-feature-overview) страницы

### <a name="supported-operating-systems"></a>Поддерживаемые операционные системы

В таблице ниже перечислены версии операционных систем Windows и Linux, которые поддерживает Azure Monitor для виртуальных машин. Полный список с описанием основных и дополнительных выпусков ОС Linux и поддерживаемых версий ядра приводится далее в этом разделе.

|Версия ОС |Производительность |Maps |Health |
|-----------|------------|-----|-------|
|Windows Server 2019 | X | X | X |
|Windows Server 2016 1803 | X | X | X |
|Windows Server 2016 | X | X | X |
|Windows Server 2012 R2 | X | X | X |
|Windows Server 2012 | X | X | |
|Windows Server 2008 R2 | X | X| |
|Red Hat Enterprise Linux (RHEL) 6, 7| X | X| X |
|Ubuntu 14.04, 16.04, 18.04 | X | X | X |
|CentOS Linux 6, 7 | X | X | X |
|SUSE Linux Enterprise Server (SLES) 11, 12 | X | X | X |
|Debian 8, 9.4 | X<sup>1</sup> | | X |

<sup>1</sup> Функция "Производительность" Azure Monitor для виртуальных машин доступна только в Azure Monitor. К ней нельзя получить доступ непосредственно с левой панели виртуальной машины Azure.

>[!NOTE]
>Следующие сведения относятся к поддержке ОС Linux:
> - Поддерживаются только версии ядра по умолчанию и SMP для Linux.
> - Нестандартные версии ядра, такие как расширение физических адресов (PAE) и Xen, не поддерживаются ни в одном дистрибутиве Linux. Например, система со строкой версии *2.6.16.21-0.8-xen* не поддерживается.
> - Пользовательские ядра, включая повторные компиляции стандартных ядер, не поддерживаются.
> - Ядро centosplus поддерживается.

#### <a name="red-hat-linux-7"></a>Red Hat Linux 7

| Версия ОС | Версия ядра |
|:--|:--|
| 7.4 | 3.10.0-693 |
| 7.5 | 3.10.0-862 |
| 7.6 | 3.10.0-957 |

#### <a name="red-hat-linux-6"></a>Red Hat Linux 6

| Версия ОС | Версия ядра |
|:--|:--|
| 6.9 | 2.6.32-696 |
| 6.10 | 2.6.32-754 |

### <a name="centosplus"></a>CentOSPlus
| Версия ОС | Версия ядра |
|:--|:--|
| 6.9 | 2.6.32-696.18.7<br>2.6.32-696.30.1 |
| 6.10 | 2.6.32-696.30.1<br>2.6.32-754.3.5 |

#### <a name="ubuntu-server"></a>Сервер Ubuntu

| Версия ОС | Версия ядра |
|:--|:--|
| Ubuntu 18.04 | ядро 4.15.* |
| Ubuntu 16.04.3 | ядро 4.15.* |
| 16.04 | 4.4.\*<br>4.8.\*<br>4.10.\*<br>4.11.\*<br>4.13.\* |
| 14.04 | 3.13.\*<br>4.4.\* |

#### <a name="suse-linux-11-enterprise-server"></a>SUSE Linux 11 Enterprise Server

| Версия ОС | Версия ядра
|:--|:--|
|11 SP4 | 3.0.* |

#### <a name="suse-linux-12-enterprise-server"></a>SUSE Linux 12 Enterprise Server

| Версия ОС | Версия ядра
|:--|:--|
|12 с пакетом обновления 2 | 4.4.* |
|12 с пакетом обновления 3 | 4.4.* |

### <a name="the-microsoft-dependency-agent"></a>Microsoft Dependency Agent

Функция схемы в Azure Monitor для виртуальных машин получает данные от Microsoft Dependency Agent. Dependency Agent является зависимым от агента Log Analytics для создания подключений к Log Analytics. Таким образом, в системе нужно установить агент Log Analytics и настроить для него Dependency Agent.

При включении решения "Azure Monitor для виртуальных машин" для отдельной виртуальной машины или при использовании методов для масштабируемого развертывания необходимо с помощью расширения Dependency Agent для виртуальных машин Azure установить агент в рамках этого процесса.

В гибридной среде, можно загрузить и установить агент зависимостей в двумя способами: вручную или с помощью автоматического развертывания для виртуальных машин, размещенных за пределами Azure.

В приведенной ниже таблице описаны подключенные источники, которые функция схемы поддерживает в гибридной среде.

| Подключенный источник | Поддерживаются | Описание |
|:--|:--|:--|
| Агенты Windows | Да | Кроме [агента Log Analytics для Windows](../../azure-monitor/platform/log-analytics-agent.md) агентам Windows требуется Microsoft Dependency Agent. Полный список версий операционных систем см. в разделе [Поддерживаемые операционные системы](#supported-operating-systems). |
| Агенты Linux | Да | Кроме [агента Log Analytics для Linux](../../azure-monitor/platform/log-analytics-agent.md) агентам Linux требуется Microsoft Dependency Agent. Полный список версий операционных систем см. в разделе [Поддерживаемые операционные системы](#supported-operating-systems). |
| Группа управления System Center Operations Manager | Нет | |

Dependency Agent можно скачать из следующего расположения:

| Файл | ОС | Version (версия) | SHA-256 |
|:--|:--|:--|:--|
| [InstallDependencyAgent-Windows.exe](https://aka.ms/dependencyagentwindows) | Windows | 9.8.1 | 622C99924385CBF539988D759BCFDC9146BB157E7D577C997CDD2674E27E08DD |
| [InstallDependencyAgent-Linux64.bin](https://aka.ms/dependencyagentlinux) | Linux | 9.8.1 | 3037934A5D3FB7911D5840A9744AE9F980F87F620A7F7B407F05E276FE7AE4A8 |

## <a name="role-based-access-control"></a>Управление доступом на основе ролей

Чтобы включить функции Azure Monitor для виртуальных машин и получить к ним доступ, нужно назначить следующие роли доступа:

- Чтобы включить ее, необходимо иметь *участник Log Analytics* роли.

- Для просмотра данных о производительности, работоспособности и схеме у вас должна быть роль *Читатель данных мониторинга* для виртуальной машины Azure. Необходимо настроить рабочую область Log Analytics для Azure Monitor для виртуальных машин.

Дополнительные сведения о том, как управлять доступом к рабочей области Log Analytics, см. в статье [Управление рабочими областями](../../azure-monitor/platform/manage-access.md).

## <a name="how-to-enable-azure-monitor-for-vms-preview"></a>Как включить Azure Monitor для виртуальных машин (Предварительная версия)

Включить Azure Monitor для виртуальных машин с помощью одного из следующих методов, описанных в следующей таблице.

| Состояние развертывания | Метод | Описание |
|------------------|--------|-------------|
| Один масштабируемый набор виртуальных Машин Azure или виртуальной машины | [Непосредственно из виртуальной Машины](vminsights-enable-single-vm.md) | Вы можете включить одной виртуальной машины Azure, выбрав **Insights (Предварительная версия)** непосредственно от виртуальной Машины или виртуальной машины масштабируемого набора. |
| Несколько виртуальных машин Azure или масштабируемые наборы виртуальных машин | [Политика Azure](vminsights-enable-at-scale-policy.md) | Вы можете включить несколько виртуальных машин Azure, с помощью политики Azure и доступные определения политик. |
| Несколько виртуальных машин Azure или масштабируемые наборы виртуальных машин | [Шаблоны Azure PowerShell или Azure Resource Manager](vminsights-enable-at-scale-powershell.md) | Вы можете включить несколько наборов масштабирования виртуальных машин Azure или виртуальной машины в указанной группе ресурсов или подписку с помощью шаблонов Azure Resource Manager или Azure PowerShell. |
| Гибридное облачное решение | [Включить в гибридной среде](vminsights-enable-hybrid-cloud.md) | Развертыванием на виртуальных машинах или физических компьютеров, размещенных в вашем центре обработки данных или других облачных средах. |

## <a name="performance-counters-enabled"></a>Включение счетчиков производительности

Azure Monitor для виртуальных машин настраивает рабочую область Log Analytics для сбора данных счетчиков производительности, используемых им. В следующей таблице перечислены объекты и счетчики, которые собираются каждые 60 секунд.

### <a name="windows-performance-counters"></a>Счетчики производительности Windows

|Имя объекта |Имя счетчика |
|------------|-------------|
|Логический диск |Процент свободного места |
|Логический диск |Среднее время чтения с диска (с) |
|Логический диск |Среднее время обращения к диску (с) |
|Логический диск |Среднее время записи на диск (с) |
|Логический диск |Байт в секунду для диска |
|Логический диск |Скорость чтения с диска (байт/с) |
|Логический диск |Операций чтения с диска в секунду |
|Логический диск |Обращений к диску в секунду |
|Логический диск |Скорость записи на диск (байт/с) |
|Логический диск |Операций записи на диск в секунду |
|Логический диск |Свободно мегабайт |
|Память |Доступный объем в МБ |
|Сетевой адаптер |Полученных байтов/с |
|Сетевой адаптер |Отправленных байтов/с |
|Процессор |% загруженности процессора |

### <a name="linux-performance-counters"></a>Счетчики производительности Linux

|Имя объекта |Имя счетчика |
|------------|-------------|
|Логический диск |Процент используемого места |
|Логический диск |Скорость чтения с диска (байт/с) |
|Логический диск |Операций чтения с диска в секунду |
|Логический диск |Обращений к диску в секунду |
|Логический диск |Скорость записи на диск (байт/с) |
|Логический диск |Операций записи на диск в секунду |
|Логический диск |Свободно мегабайт |
|Логический диск |Скорость обмена с логическим диском (байт/с) |
|Память |Доступный объем памяти в МБ |
|Сеть |Всего получено байт |
|Сеть |Всего передано байт |
|Процессор |% загруженности процессора |

## <a name="diagnostic-and-usage-data"></a>Данные диагностики и использования

Корпорация Майкрософт автоматически собирает данные об использовании и производительности при работе службы Azure Monitor. Эти данные используются, чтобы поддерживать и улучшать качество, безопасность и целостность службы. Чтобы предоставить возможности для точного и эффективного устранения неполадок, данные функции схемы включают в себя сведения о конфигурации программного обеспечения, такие как версия операционной системы, а также IP-адрес, DNS-имя и имя рабочей станции. Корпорация Майкрософт не собирает сведения об именах, адресах и другую контактную информацию.

Дополнительные сведения о сборе и использовании данных см. в [заявлении о конфиденциальности служб Microsoft Online Services](https://go.microsoft.com/fwlink/?LinkId=512132).

[!INCLUDE [GDPR-related guidance](../../../includes/gdpr-dsr-and-stp-note.md)]

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда мониторинг для виртуальной машины включен, эта информация доступна для анализа в Azure Monitor для виртуальных машин. Чтобы узнать, как использовать функцию работоспособности, см. статью о [просмотре сведений о работоспособности Azure Monitor для виртуальных машин](vminsights-health.md). Для просмотра обнаруженных зависимостей приложений см. статью о [просмотре схемы Azure Monitor для виртуальных машин](vminsights-maps.md).
