---
title: Включение Azure Monitor для обзор виртуальных машин (Предварительная версия) | Документация Майкрософт
description: Узнайте, как развернуть и настроить Azure Monitor для виртуальных машин. Узнайте требования к системе.
services: azure-monitor
documentationcenter: ''
author: mgoedtel
manager: carmonm
editor: ''
ms.assetid: ''
ms.service: azure-monitor
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 06/28/2019
ms.author: magoedte
ms.openlocfilehash: 6fb7e6b9611b28dab856209aaf03aa93c25d3968
ms.sourcegitcommit: f811238c0d732deb1f0892fe7a20a26c993bc4fc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/29/2019
ms.locfileid: "67478048"
---
# <a name="enable-azure-monitor-for-vms-preview-overview"></a>Включение Azure Monitor для обзор виртуальных машин (Предварительная версия)

В этой статье содержатся общие сведения о параметрах, доступных для настройки Azure Monitor для виртуальных машин. Используйте Azure Monitor для виртуальных машин, мониторинг работоспособности и производительности. Обнаружить зависимости приложений, работающих на виртуальных машинах (ВМ) Azure и масштабируемый набор виртуальных машин задает, локальных виртуальных машин или виртуальных машин, размещенных в другой облачной среде.  

Чтобы настроить Azure Monitor для виртуальных машин:

* Включить одной виртуальной Машине Azure или виртуальной машины масштабируемого набора, выбрав **Insights (Предварительная версия)** непосредственно от виртуальной Машины или виртуальной машины масштабируемого набора.
* Включить две или задает дополнительные возможности виртуальных машин Azure и виртуальных машин с помощью политики Azure. Этот метод гарантирует, что на существующих и новых виртуальных машин и масштабируемых наборов, необходимые зависимости установлены и правильно настроен. Выводятся несовместимых виртуальных машин и масштабируемых наборов, что дает возможность решить, следует ли включить их и исправлять их.
* Включите две или несколько виртуальных машин или масштабируемых наборов виртуальных машин Azure в определенной подписке или группе ресурсов с помощью PowerShell.
* Включите монитор Azure для виртуальных машин для мониторинга виртуальных машин или физических компьютеров, размещенных в корпоративной сети или другой облачной среде.

## <a name="prerequisites"></a>Технические условия

Прежде чем начинать работу, убедитесь, что вы понимаете сведения, содержащиеся в следующих разделах.

### <a name="log-analytics"></a>Log Analytics

Azure Monitor для виртуальных машин поддерживает рабочую область Log Analytics в следующих регионах:

- Западно-центральная часть США
- Западная часть США 2<sup>1</sup>
- East US
- Центральная Канада
- Южная часть Великобритании
- Западная Европа
- Юго-Восточная Азия

<sup>1</sup> Этот регион сейчас не поддерживает функцию мониторинга работоспособности в Azure Monitor для виртуальных машин.

>[!NOTE]
>Вы можете развернуть виртуальные машины Azure с любым регионом. Эти виртуальные машины не только для регионов, поддерживаемых рабочей области Log Analytics.
>

Если у вас нет рабочей области, можно создать с помощью одного из этих ресурсов:
* [CLI Azure.](../../azure-monitor/learn/quick-create-workspace-cli.md)
* [PowerShell](../../azure-monitor/learn/quick-create-workspace-posh.md)
* [Портал Azure](../../azure-monitor/learn/quick-create-workspace.md)
* [Azure Resource Manager](../../azure-monitor/platform/template-workspace-configuration.md)

Также можно создать рабочую область, при вы включаете мониторинг для одной виртуальной Машине Azure или виртуальной машины масштабируемого набора на портале Azure.

Для настройки в масштабе сценарий, который использует шаблоны политики Azure, Azure PowerShell или Azure Resource Manager, в рабочей области Log Analytics:

* Установите решения ServiceMap и InfrastructureInsights. Можно выполнить установку с помощью предоставленного шаблона Azure Resource Manager. Или на **приступить к работе** выберите **Настройка рабочей области**.
* Настройте рабочую область Log Analytics для сбора данных счетчиков производительности.

Чтобы настроить рабочую область для сценария в масштабе, используйте один из следующих методов:

* Используйте [Azure PowerShell](vminsights-enable-at-scale-powershell.md#set-up-a-log-analytics-workspace).
* В Azure Monitor для виртуальных машин [ **покрытия политики** ](vminsights-enable-at-scale-policy.md#manage-policy-coverage-feature-overview) выберите **Настройка рабочей области**. 

### <a name="supported-operating-systems"></a>Поддерживаемые операционные системы

В следующей таблице перечислены операционные системы Windows и Linux, поддерживаемые Azure Monitor для виртуальных машин. Позже в этом разделе вы найдете полный список, в которых описаны ОС Linux основных и дополнительных версий выпуска и поддерживаемые версии ядра.

|Версия ОС |Производительность |Maps |Health |
|-----------|------------|-----|-------|
|Windows Server 2019 | X | X | X |
|Windows Server 2016 1803 | X | X | X |
|Windows Server 2016 | X | X | X |
|Windows Server 2012 R2 | X | X | X |
|Windows Server 2012 | X | X | |
|Windows Server 2008 R2 | X | X| |
|Red Hat Enterprise Linux (RHEL) 6, 7| X | X| X |
|Ubuntu 14.04, 16.04, 18.04 | X | X | X |
|CentOS Linux 6, 7 | X | X | X |
|SUSE Linux Enterprise Server (SLES) 12 | X | X | X |
|Debian 8, 9.4 | X<sup>1</sup> | | X |

<sup>1</sup> Функция "Производительность" Azure Monitor для виртуальных машин доступна только в Azure Monitor. Группа ресурсов недоступна, непосредственно из левой области на виртуальной Машине Azure.

>[!NOTE]
>Функция работоспособности монитора Azure для виртуальных машин не поддерживает [вложенной виртуализации](../../virtual-machines/windows/nested-virtualization.md) на виртуальной Машине Azure.
>

>[!NOTE]
>В операционной системе Linux:
> - Поддерживаются только версии ядра по умолчанию и SMP для Linux.
> - Нестандартные версии ядра, такие как расширение физических адресов (PAE) и Xen, не поддерживаются ни в одном дистрибутиве Linux. Например, система со строкой версии *2.6.16.21-0.8-xen* не поддерживается.
> - Пользовательские ядра, включая повторные компиляции стандартных ядер, не поддерживаются.
> - Ядро centosplus поддерживается.

#### <a name="red-hat-linux-7"></a>Red Hat Linux 7

| Версия ОС | Версия ядра |
|:--|:--|
| 7.4 | 3.10.0-693 |
| 7.5 | 3.10.0-862 |
| 7.6 | 3.10.0-957 |

#### <a name="red-hat-linux-6"></a>Red Hat Linux 6

| Версия ОС | Версия ядра |
|:--|:--|
| 6.9 | 2.6.32-696 |
| 6.10 | 2.6.32-754 |

#### <a name="centosplus"></a>CentOSPlus
| Версия ОС | Версия ядра |
|:--|:--|
| 6.9 | 2.6.32-696.18.7<br>2.6.32-696.30.1 |
| 6.10 | 2.6.32-696.30.1<br>2.6.32-754.3.5 |

#### <a name="ubuntu-server"></a>Сервер Ubuntu

| Версия ОС | Версия ядра |
|:--|:--|
| Ubuntu 18.04 | ядро 4.15.\*<br>4.18* |
| Ubuntu 16.04.3 | ядро 4.15.* |
| 16.04 | 4.4.\*<br>4.8.\*<br>4.10.\*<br>4.11.\*<br>4.13.\* |
| 14.04 | 3.13.\*<br>4.4.\* |

#### <a name="suse-linux-12-enterprise-server"></a>SUSE Linux 12 Enterprise Server

| Версия ОС | Версия ядра
|:--|:--|
|12 с пакетом обновления 2 | 4.4.* |
|12 с пакетом обновления 3 | 4.4.* |
|12 SP4 | 4.4.* |
|12 SP4 | Настраиваемые Azure ядра |

### <a name="the-microsoft-dependency-agent"></a>Microsoft Dependency Agent

Функция карты в Azure Monitor для виртуальных машин получает данные от агента зависимостей Майкрософт. Dependency Agent является зависимым от агента Log Analytics для создания подключений к Log Analytics. Поэтому в системе должны быть установлен и настроен агент зависимостей агент Log Analytics.

Включить Azure Monitor для виртуальных машин для одной виртуальной Машине Azure или использовать метод развертывания в масштабе, используйте расширение агента зависимостей виртуальной Машины Azure для установки агента в процессе работы.

В гибридной среде можно загрузить и установить агент зависимостей вручную. Если виртуальные машины размещаются вне Azure, используйте метод автоматического развертывания.

В приведенной ниже таблице описаны подключенные источники, которые функция схемы поддерживает в гибридной среде.

| Подключенный источник | Поддерживаются | Описание |
|:--|:--|:--|
| Агенты Windows | Да | Вместе с [агент Log Analytics для Windows](../../azure-monitor/platform/log-analytics-agent.md), агенты Windows должны агент зависимостей. Дополнительные сведения см. в разделе [поддерживаемые операционные системы](#supported-operating-systems). |
| Агенты Linux | Да | Вместе с [агент Log Analytics для Linux](../../azure-monitor/platform/log-analytics-agent.md), агенты Linux требуется агент зависимостей. Дополнительные сведения см. в разделе [поддерживаемые операционные системы](#supported-operating-systems). |
| Группа управления System Center Operations Manager | Нет | |

Можно загрузить агент зависимостей из этих расположений:

| Файл | ОС | Version (версия) | SHA-256 |
|:--|:--|:--|:--|
| [InstallDependencyAgent-Windows.exe](https://aka.ms/dependencyagentwindows) | Windows | 9.8.1 | 622C99924385CBF539988D759BCFDC9146BB157E7D577C997CDD2674E27E08DD |
| [InstallDependencyAgent-Linux64.bin](https://aka.ms/dependencyagentlinux) | Linux | 9.8.1 | 3037934A5D3FB7911D5840A9744AE9F980F87F620A7F7B407F05E276FE7AE4A8 |

## <a name="role-based-access-control"></a>Управление доступом на основе ролей

Чтобы включить и доступ к функциям Azure Monitor для виртуальных машин, необходимо иметь *участник Log Analytics* роли. Для просмотра производительности, работоспособности и сопоставить данные, необходимо иметь *роль monitoring reader* роли для виртуальной Машины Azure. Необходимо настроить рабочую область Log Analytics для Azure Monitor для виртуальных машин.

Дополнительные сведения о том, как управлять доступом к рабочей области Log Analytics, см. в статье [Управление рабочими областями](../../azure-monitor/platform/manage-access.md).

## <a name="how-to-enable-azure-monitor-for-vms-preview"></a>Как включить Azure Monitor для виртуальных машин (Предварительная версия)

Включите Azure Monitor для виртуальных машин с помощью одного из методов, описанных в этой таблице:

| Состояние развертывания | Метод | Описание |
|------------------|--------|-------------|
| Один масштабируемый набор виртуальных Машин Azure или виртуальной машины | [Включить из виртуальной Машины](vminsights-enable-single-vm.md) | Вы можете включить отдельной виртуальной Машины, выбрав **Insights (Предварительная версия)** непосредственно от виртуальной Машины или виртуальной машины масштабируемого набора. |
| Несколько виртуальных машин Azure или масштабируемые наборы виртуальных машин | [Включить с помощью политики Azure](vminsights-enable-at-scale-policy.md) | Вы можете включить несколько виртуальных машин Azure с помощью политики Azure и доступные определения политик. |
| Несколько виртуальных машин Azure или масштабируемые наборы виртуальных машин | [Включить с помощью шаблонов Azure Resource Manager или Azure PowerShell](vminsights-enable-at-scale-powershell.md) | Вы можете включить несколько наборов масштабирования виртуальных машин Azure или виртуальной машины в указанной подписке или группе ресурсов с помощью шаблонов Azure Resource Manager или Azure PowerShell. |
| Гибридное облачное решение | [Включить в гибридной среде](vminsights-enable-hybrid-cloud.md) | Развертыванием на виртуальных машинах или физических компьютеров, размещенных в вашем центре обработки данных или других облачных средах. |

## <a name="performance-counters-enabled"></a>Включение счетчиков производительности 

Azure Monitor для виртуальных машин настраивает рабочую область Log Analytics для сбора данных счетчиков производительности, используемых им. В следующих таблицах перечислены объекты и счетчики, которые собираются каждые 60 секунд.

### <a name="windows-performance-counters"></a>Счетчики производительности Windows

|Имя объекта |Имя счетчика |
|------------|-------------|
|Логический диск |Процент свободного места |
|Логический диск |Среднее время чтения с диска (с) |
|Логический диск |Среднее время обращения к диску (с) |
|Логический диск |Среднее время записи на диск (с) |
|Логический диск |Байт в секунду для диска |
|Логический диск |Скорость чтения с диска (байт/с) |
|Логический диск |Операций чтения с диска в секунду |
|Логический диск |Обращений к диску в секунду |
|Логический диск |Скорость записи на диск (байт/с) |
|Логический диск |Операций записи на диск в секунду |
|Логический диск |Свободно мегабайт |
|Память |Доступный объем в МБ |
|Сетевой адаптер |Полученных байтов/с |
|Сетевой адаптер |Отправленных байтов/с |
|Процессор |% загруженности процессора |

### <a name="linux-performance-counters"></a>Счетчики производительности Linux

|Имя объекта |Имя счетчика |
|------------|-------------|
|Логический диск |Процент используемого места |
|Логический диск |Скорость чтения с диска (байт/с) |
|Логический диск |Операций чтения с диска в секунду |
|Логический диск |Обращений к диску в секунду |
|Логический диск |Скорость записи на диск (байт/с) |
|Логический диск |Операций записи на диск в секунду |
|Логический диск |Свободно мегабайт |
|Логический диск |Скорость обмена с логическим диском (байт/с) |
|Память |Доступный объем памяти в МБ |
|Сеть |Всего получено байт |
|Сеть |Всего передано байт |
|Процессор |% загруженности процессора |

## <a name="diagnostic-and-usage-data"></a>Данные диагностики и использования

Корпорация Майкрософт автоматически собирает данные об использовании и производительности при работе службы Azure Monitor. Корпорация Майкрософт использует эти данные для повышения качества, безопасности и целостности службы. 

Чтобы предоставить возможности для точного и эффективного устранения неполадок, функция карты содержит данные о конфигурации программного обеспечения. Данные сведения, такие как операционная система и версия, IP-адрес, DNS-имя и имя рабочей станции. Корпорация Майкрософт не собирает сведения об именах, адресах и другую контактную информацию.

Дополнительные сведения о сборе и использовании данных см. в [заявлении о конфиденциальности служб Microsoft Online Services](https://go.microsoft.com/fwlink/?LinkId=512132).

[!INCLUDE [GDPR-related guidance](../../../includes/gdpr-dsr-and-stp-note.md)]

Теперь, когда вы настроили мониторинг для виртуальной Машины, мониторинг сведения доступен для анализа в Azure Monitor для виртуальных машин.

## <a name="next-steps"></a>Дальнейшие действия

Чтобы узнать, как использовать функцию работоспособности, см. статью о [просмотре сведений о работоспособности Azure Monitor для виртуальных машин](vminsights-health.md). Для просмотра обнаруженных зависимостей приложений см. статью о [просмотре схемы Azure Monitor для виртуальных машин](vminsights-maps.md).
