---
title: Включить обзор Azure Monitor для виртуальных машин
description: Узнайте, как развертывать и настраивать Azure Monitor для виртуальных машин. Ознакомьтесь с требованиями к системе.
ms.subservice: ''
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 07/27/2020
ms.openlocfilehash: e3c5f6d7e04620cf36f6cd952467d47afd775b19
ms.sourcegitcommit: 2ff0d073607bc746ffc638a84bb026d1705e543e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/06/2020
ms.locfileid: "87824772"
---
# <a name="enable-azure-monitor-for-vms-overview"></a>Включить обзор Azure Monitor для виртуальных машин

В этой статье представлен обзор доступных параметров, позволяющих Azure Monitor для виртуальных машин отслеживать работоспособность и производительность следующих элементов:

- Виртуальные машины Azure 
- Масштабируемые наборы виртуальных машин Azure
- Гибридные виртуальные машины, подключенные к службе "Дуга Azure"
- Локальные виртуальные машины
- Виртуальные машины, размещенные в другой облачной среде.  

Чтобы настроить Azure Monitor для виртуальных машин, выполните следующие действия.

* Включите одну ВИРТУАЛЬную машину Azure, Azure VMSS или машину Arc Azure, выбрав **аналитику** непосредственно в меню портал Azure.
* Включите несколько виртуальных машин Azure, Azure VMSS или машин Arc Azure с помощью политики Azure. Этот метод гарантирует, что на существующих и новых виртуальных машинах и масштабируемых наборах необходимые зависимости установлены и настроены правильно. Выводятся сведения о несоответствующих виртуальных машинах и масштабируемых наборах, поэтому можно решить, следует ли их включить и исправить.
* Используйте PowerShell для включения нескольких виртуальных машин Azure, виртуальных машин Arc Azure, Azure VMSS или машин Arc Azure в указанной подписке или группе ресурсов.
* Включите Azure Monitor для виртуальных машин для мониторинга виртуальных машин или физических компьютеров, размещенных в корпоративной сети или в другой облачной среде.

## <a name="prerequisites"></a>Предварительные требования

Прежде чем начинать работу, убедитесь, что вы понимаете сведения, содержащиеся в следующих разделах. 

>[!NOTE]
>Следующие сведения, описанные в этом разделе, также применимы к [решению сопоставление служб](service-map.md).  

### <a name="log-analytics"></a>Log Analytics

Azure Monitor для виртуальных машин поддерживает рабочую область Log Analytics в следующих регионах:

- центрально-западная часть США
- западная часть США
- западная часть США 2
- Центрально-южная часть США
- Восточная часть США
- восточная часть США 2
- Центральная часть США
- Центрально-северная часть США
- US Gov AZ
- US Gov ва
- Центральная Канада
- южная часть Соединенного Королевства
- Северная Европа
- Западная Европа
- Восточная Азия
- Юго-Восточная Азия
- Центральная Индия
- Восточная Япония
- Восточная Австралия
- Юго-Восточная часть Австралии

>[!NOTE]
>Вы можете отслеживать виртуальные машины Azure в любом регионе. Сами виртуальные машины не ограничиваются регионами, поддерживаемыми Log Analytics рабочей областью.
>

Если у вас нет рабочей области Log Analytics, можно создать ее с помощью одного из ресурсов:
* [Azure CLI](../learn/quick-create-workspace-cli.md)
* [PowerShell](../platform/powershell-workspace-configuration.md)
* [Портал Azure](../learn/quick-create-workspace.md)
* [Azure Resource Manager](../platform/template-workspace-configuration.md)

- Виртуальная машина Azure
- Масштабируемый набор виртуальных машин Azure
- Гибридная виртуальная машина, подключенная к службе "Дуга Azure"

## <a name="supported-operating-systems"></a>Поддерживаемые операционные системы

В следующей таблице перечислены операционные системы Windows и Linux, поддерживаемые Azure Monitor для виртуальных машин. Далее в этом разделе вы найдете полный список, в котором подробно описывается основной и дополнительный выпуск ОС Linux и поддерживаемые версии ядра.

|Версия ОС |Производительность |Maps |
|-----------|------------|-----|
|Windows Server 2019 | X | X |
|Windows Server 2016 1803 | X | X |
|Windows Server 2016 | X | X |
|Windows Server 2012 R2 | X | X |
|Windows Server 2012 | X | X |
|Windows Server 2008 R2 | X | X|
|Windows 10 1803 | X | X |
|Windows 8.1 | X | X |
|Windows 8 | X | X |
|Windows 7 с пакетом обновления 1 (SP1) | X | X |
|Red Hat Enterprise Linux (RHEL) 6, 7| X | X| 
|Ubuntu 18,04, 16,04 | X | X |
|CentOS Linux 7, 6 | X | X |
|SUSE Linux Enterprise Server (SLES) 12 | X | X |
|Debian 9.4, 8 | X<sup>1</sup> | |

<sup>1</sup> Функция "Производительность" Azure Monitor для виртуальных машин доступна только в Azure Monitor. Она недоступна непосредственно из левой панели виртуальной машины Azure.

>[!NOTE]
>В операционной системе Linux:
> - Поддерживаются только версии ядра по умолчанию и SMP для Linux.
> - Нестандартные версии ядра, такие как расширение физических адресов (PAE) и Xen, не поддерживаются ни в одном дистрибутиве Linux. Например, система со строкой версии *2.6.16.21-0.8-xen* не поддерживается.
> - Пользовательские ядра, включая перекомпиляции стандартных ядер, не поддерживаются.
> - Поддерживается ядро Центосплус.
> - Для уязвимости устранением рисков Spectre необходимо исправление ядра Linux. Дополнительные сведения см. в поставщике дистрибутива Linux.

#### <a name="red-hat-linux-7"></a>Red Hat Linux 7

| Версия ОС | Версия ядра |
|:--|:--|
| 7.6 | 3.10.0-957 |
| 7.5 | 3.10.0-862 |
| 7.4 | 3.10.0-693 |

#### <a name="red-hat-linux-6"></a>Red Hat Linux 6

| Версия ОС | Версия ядра |
|:--|:--|
| 6.10 | 2.6.32-754 |
| 6.9 | 2.6.32-696 |

#### <a name="centosplus"></a>центосплус

| Версия ОС | Версия ядра |
|:--|:--|
| 6.10 | 2.6.32 — 754.3.5<br>2.6.32 — 696.30.1 |
| 6.9 | 2.6.32 — 696.30.1<br>2.6.32 — 696.18.7 |

#### <a name="ubuntu-server"></a>Сервер Ubuntu

| Версия ОС | Версия ядра |
|:--|:--|
| 18,04 | 5.3.0-1020<br>5,0 (включает ядро, настроенное Azure)<br>4,18* <br> 4,15* |
| 16.04.3 | 4,15. * |
| 16.04 | 4.13.\*<br>4.11.\*<br>4.10.\*<br>4.8.\*<br>4.4.\* |

#### <a name="suse-linux-12-enterprise-server"></a>SUSE Linux 12 Enterprise Server

| Версия ОС | Версия ядра |
|:--|:--|
|12 SP4 | 4,12. * (включает в себя настраиваемый в Azure ядро) |
|12 с пакетом обновления 3 | 4.4.* |
|12 с пакетом обновления 2 | 4.4.* |

#### <a name="debian"></a>Debian 

| Версия ОС | Версия ядра |
|:--|:--|
| 9 | 4.9 | 

## <a name="supported-azure-arc-machines"></a>Поддерживаемые машины Azure Arc
Azure Monitor для виртуальных машин доступен для серверов с поддержкой ARC в Azure в регионах, где доступна служба расширения ARC. Необходимо запустить агент Arc версии 0,9 или более поздней.

| Подключенный источник | Поддерживается | Описание |
|:--|:--|:--|
| Агенты Windows | Да | Вместе с [агентом log Analytics для Windows](../platform/log-analytics-agent.md)агентам Windows требуется агент зависимостей. Дополнительные сведения см. в разделе [Поддерживаемые операционные системы](#supported-operating-systems). |
| Агенты Linux | Да | Вместе с [агентом log Analytics для Linux](../platform/log-analytics-agent.md)агентам Linux требуется агент зависимостей. Дополнительные сведения см. в разделе [Поддерживаемые операционные системы](#supported-operating-systems). |
| Группа управления System Center Operations Manager | Нет | |

## <a name="agents"></a>Агенты
Для Azure Monitor для виртуальных машин требуется установить следующие два агента на каждой виртуальной машине или масштабируемом наборе виртуальных машин, которые необходимо отслеживать. Установка этих агентов и их подключение к рабочей области является единственным требованием для адаптации ресурса.

- [Агент log Analytics](../platform/log-analytics-agent.md). Сбор данных о событиях и производительности из масштабируемого набора виртуальных машин и их доставка в рабочую область Log Analytics. Методы развертывания для агента Log Analytics в ресурсах Azure используют расширение виртуальной машины для [Windows](../../virtual-machines/extensions/oms-windows.md) и [Linux](../../virtual-machines/extensions/oms-linux.md).
- Агент зависимостей. Собирает обнаруженные данные о процессах, выполняемых на виртуальной машине, и зависимостях внешних процессов, которые используются [функцией Map в Azure Monitor для виртуальных машин](vminsights-maps.md). Агент зависимостей использует агент Log Analytics для доставки данных в Azure Monitor. Методы развертывания для агента зависимостей в ресурсах Azure используют расширение виртуальной машины для [Windows](../../virtual-machines/extensions/agent-dependency-windows.md) и [Linux](../../virtual-machines/extensions/agent-dependency-linux.md).

> [!NOTE]
> Агент Log Analytics — это тот же агент, который используется System Center Operations Manager. Azure Monitor для виртуальных машин может отслеживать агенты, которые также отслеживаются Operations Manager, если они подключены напрямую, и вы устанавливаете на них агент зависимостей. Azure Monitor для виртуальных машин не наблюдает за агентами, подключенными к Azure Monitor через [группу управления](../tform/../platform/om-agents.md) .

Ниже приведены несколько методов развертывания этих агентов. 

| Метод | Описание |
|:---|:---|
| [Портал Azure](./vminsights-enable-portal.md) | Установите оба агента на одной виртуальной машине, масштабируемом наборе виртуальных машин или гибридных виртуальных машинах, подключенных к службе "Дуга Azure". |
| [Шаблоны диспетчер ресурсов](vminsights-enable-powershell.md) | Установите оба агента с помощью любого из поддерживаемых методов, чтобы развернуть шаблон диспетчер ресурсов, включая CLI и PowerShell. |
| [Политика Azure](./vminsights-enable-policy.md) | Назначение инициативы политики Azure для автоматической установки агентов при создании виртуальной машины или масштабируемого набора виртуальных машин. |
| [Установка вручную](./vminsights-enable-hybrid.md) | Установите агенты в гостевой операционной системе на компьютерах, размещенных за пределами Azure, включая в вашем центре обработки данных или в других облачных средах. |




## <a name="management-packs"></a>Пакеты управления
При настройке Log Analytics рабочей области для Azure Monitor для виртуальных машин два пакета управления перенаправляются на все компьютеры Windows, подключенные к этой рабочей области. Пакеты управления называются *Microsoft. IntelligencePacks. ApplicationDependencyMonitor* и *Microsoft. IntelligencePacks. вминсигхтс* и записываются в *%ProgramFiles%\Microsoft Monitoring Agent\Agent\Health Service state\management Packs Packs \* . 

Пакет управления *ApplicationDependencyMonitor* использует источник данных **% Program Files%\Microsoft Monitoring Agent\Agent\Health Service State\Resources \<AutoGeneratedID>\Microsoft.EnterpriseManagement.Advisor.ApplicationDependencyMonitorDataSource.dll*. Пакет управления *вминсигхтс* использует источник данных *% Program Files%\Microsoft Monitoring Agent\Agent\Health Service State\Resources \<AutoGeneratedID> \ Microsoft.VirtualMachineMonitoringModule.dll*.

## <a name="diagnostic-and-usage-data"></a>Данные диагностики и использования

Корпорация Майкрософт автоматически собирает данные об использовании и производительности при работе службы Azure Monitor. Корпорация Майкрософт использует эти данные для повышения качества, безопасности и целостности службы. 

Чтобы обеспечить точную и эффективную работу по устранению неполадок, функция Map включает данные о конфигурации программного обеспечения. Данные содержат такие сведения, как операционная система, версия, IP-адрес, DNS-имя и имя рабочей станции. Корпорация Майкрософт не собирает сведения об именах, адресах и другую контактную информацию.

Дополнительные сведения о сборе и использовании данных см. в [заявлении о конфиденциальности служб Microsoft Online Services](https://go.microsoft.com/fwlink/?LinkId=512132).

[!INCLUDE [GDPR-related guidance](../../../includes/gdpr-dsr-and-stp-note.md)]

## <a name="next-steps"></a>Дальнейшие действия

Сведения об использовании функции наблюдения за производительностью см. в разделе [View Azure Monitor для виртуальных машин Performance](vminsights-performance.md). Для просмотра обнаруженных зависимостей приложений см. статью о [просмотре схемы Azure Monitor для виртуальных машин](vminsights-maps.md).