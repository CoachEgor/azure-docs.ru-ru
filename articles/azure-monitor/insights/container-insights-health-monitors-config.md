---
title: Azure Monitor для конфигурации мониторов работоспособности контейнеров (ru) Документы Майкрософт
description: В этой статье приводится содержание, описывающее подробную конфигурацию мониторов работоспособности в Azure Monitor для контейнеров.
ms.topic: conceptual
ms.date: 12/01/2019
ms.openlocfilehash: 99ea6e96f5a8a486784cb3d633a6e031b60eaad7
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80055704"
---
# <a name="azure-monitor-for-containers-health-monitor-configuration-guide"></a>Azure Monitor для руководства по настройке монитора работоспособности контейнеров

Мониторы являются основным элементом измерения работоспособности и обнаружения ошибок в Azure Monitor для контейнеров. Эта статья поможет вам понять концепции измерения работоспособности и элементы, составляющие модель работоспособности для мониторинга и отчета о работоспособности кластера Kubernetes с функцией [«Здоровье» (предварительный просмотр).](container-insights-health.md)

>[!NOTE]
>Функция «Здоровье» в настоящее время находится в открытом доступе.
>

## <a name="monitors"></a>Мониторы

Монитор измеряет работоспособность определенного аспекта управляемого объекта. У каждого монитора два и три состояния работоспособности. В каждый момент времени монитор может находиться только в одном из потенциальных состояний. Когда монитор загружается контейнерным агентом, он инициализируется до здорового состояния. Состояние изменяется только в том случае, если обнаружены указанные условия для другого состояния.

Общая работоспособность объекта определяется работоспособностью каждого из его мониторов. Эта иерархия иллюстрируется в панели иерархии работ в Azure Monitor для контейнеров. Политика в отношении сворачивания работоспособности является частью конфигурации агрегированных мониторов.

## <a name="types-of-monitors"></a>Типы мониторов

|Монитор | Описание | 
|--------|-------------|
| Монитор модуля |Контроль подразделения измеряет некоторые аспекты ресурса или приложения. Это может быть проверка счетчика производительности для определения производительности ресурса или его доступности. |
|Составной монитор | Агрегированные мониторы группируют несколько мониторов, чтобы обеспечить единое состояние здоровья, агрегированное состояние работоспособности. Мониторы групп, как правило, настроены под определенным агрегатным монитором. Например, агрегатный монитор узлов свертывает состояние использования процессора узлов, использования памяти и состояния узлов.
 |

### <a name="aggregate-monitor-health-rollup-policy"></a>Агрегированный мониторинг политики свертывания работоспособности

Каждый агрегатный монитор определяет политику свертывания работоспособности, которая является логикой, которая используется для определения работоспособности агрегатного монитора на основе работоспособности мониторов под ним. Возможные политики свертывания работоспособности для агрегатного монитора следующие:

#### <a name="worst-state-policy"></a>Худшая государственная политика

Состояние агрегатного монитора соответствует состоянию монитора ребенка с наихудшим состоянием работоспособности. Это наиболее распространенная политика, используемая агрегированными мониторами.

![Пример совокупного свертывания монитора наихудшее состояние](./media/container-insights-health-monitoring-cfg/aggregate-monitor-rollup-worstof.png)

### <a name="percentage-policy"></a>Процентная политика

Объект исходного кода соответствует худшему состоянию одного элемента определенного процента целевых объектов в лучшем состоянии. Эта политика используется, когда определенный процент целевых объектов должен быть работоспособным, чтобы целевой объект считался здоровым. Процентная политика сортирует мониторы в порядке убывания серьезности состояния, а состояние совокупного монитора вычисляется как наихудшее состояние N% (N диктуется параметром конфигурации *StateThresholdPercentage).*

Например, предположим, что существует пять экземпляров контейнера изображения контейнера, и их отдельные состояния являются **критическими,** **Предупреждение**, **Здоровый**, **Здоровый**, **Здоровый**.  Состояние монитора использования процессора контейнера будет **критическим,** так как наихудшее состояние 90% контейнеров **является критическим** при сортировке в порядке убывания тяжести.

## <a name="understand-the-monitoring-configuration"></a>Понимание конфигурации мониторинга

Azure Monitor для контейнеров включает в себя ряд ключевых сценариев мониторинга, которые настроены следующим образом.

### <a name="unit-monitors"></a>Мониторы единиц

|**Имя монитора** | Тип монитора | **Описание** | **Параметр** | **Значение** |
|-----------------|--------------|-----------------|---------------|-----------|
|Использование памяти узлов |Монитор модуля |Этот монитор оценивает использование памяти узла каждую минуту, используя данные cadvisor. |Последовательныевыборыдлядлягосударственногоперехода<br> FailIfGreaterThanПроцент<br> WarnIfGreaterThanПроцент | 3<br> 90<br> 80  ||
|Использование узлового процессора |Базовый монитор |Этот монитор проверяет использование процессора узла каждую минуту, используя данные cAdvisor. | Последовательныевыборыдлядлягосударственногоперехода<br> FailIfGreaterThanПроцент<br> WarnIfGreaterThanПроцент | 3<br> 90<br> 80  ||
|Статус узла |Монитор модуля |Этот монитор проверяет условия узлов, о которых сообщает Kubernetes.<br> В настоящее время проверяются следующие условия узлов: Давление диска, Давление памяти, ДАВЛЕНИЕ PID, Out of Disk, Сеть недоступна, готовый статус для узла.<br> Из вышеуказанных условий, если либо *из диска* или *сети недоступны* **верно,** монитор изменяется в **критическим** состоянием.<br> Если какие-либо другие условия равны **истине,** кроме статуса **Ready,** монитор изменяется в состояние **Предупреждения.** | NodeconditionTypeForfailedState | outofdisk, networkunavailable ||
|Использование памяти контейнеров |Монитор модуля |Этот монитор сообщает о комбинированном состоянии работоспособности использования памяти (RSS) экземпляров контейнера.<br> Он выполняет простое сравнение, которое сравнивает каждый образец с одним порогом и определяется параметром **конфигурации ConsecutiveSamplesForStateTransition.**<br> Его состояние рассчитывается как наихудшее состояние 90% экземпляров контейнера (StateThresholdPercentage), отсортированных в порядке убывания тяжести состояния здоровья контейнера (то есть критическое, Предупреждение, Здоровое).<br> Если запись не получена из экземпляра контейнера, то состояние работоспособности экземпляра контейнера сообщается как **Неизвестное**и имеет более высокий приоритет в порядке сортировки над **критическим** состоянием.<br> Состояние каждого отдельного экземпляра контейнера рассчитывается с использованием пороговых значений, указанных в конфигурации. Если использование превышает критический порог (90%), то экземпляр находится в **критическом** состоянии, если он меньше критического порога (90%) но больше, чем порог предупреждения (80%), то экземпляр находится в состоянии **предупреждения.** В противном случае, он находится в **здоровом состоянии.** |Последовательныевыборыдлядлягосударственногоперехода<br> FailIflessThanПроцент<br> StateThresholdПроцент<br> WarnIfGreaterThanПроцент| 3<br> 90<br> 90<br> 80 ||
|Использование процессора контейнера |Монитор модуля |Этот монитор сообщает о комбинированном состоянии здоровья cPU использования экземпляров контейнера.<br> Он выполняет простое сравнение, которое сравнивает каждый образец с одним порогом и определяется параметром **конфигурации ConsecutiveSamplesForStateTransition.**<br> Его состояние рассчитывается как наихудшее состояние 90% экземпляров контейнера (StateThresholdPercentage), отсортированных в порядке убывания тяжести состояния здоровья контейнера (то есть критическое, Предупреждение, Здоровое).<br> Если запись не получена из экземпляра контейнера, то состояние работоспособности экземпляра контейнера сообщается как **Неизвестное**и имеет более высокий приоритет в порядке сортировки над **критическим** состоянием.<br> Состояние каждого отдельного экземпляра контейнера рассчитывается с использованием пороговых значений, указанных в конфигурации. Если использование превышает критический порог (90%), то экземпляр находится в **критическом** состоянии, если он меньше критического порога (90%) но больше, чем порог предупреждения (80%), то экземпляр находится в состоянии **предупреждения.** В противном случае, он находится в **здоровом состоянии.** |Последовательныевыборыдлядлягосударственногоперехода<br> FailIflessThanПроцент<br> StateThresholdПроцент<br> WarnIfGreaterThanПроцент| 3<br> 90<br> 90<br> 80 ||
|Системная рабочая нагрузка стручки готовы |Монитор модуля |Этот монитор сообщает о состоянии на основе процента стручков в готовом состоянии в данной рабочей нагрузке. Его состояние **критическое,** если менее 100% стручков находятся в **здоровом** состоянии |Последовательныевыборыдлядлягосударственногоперехода<br> FailIflessThanПроцент |2<br> 100 ||
|Статус API Kube |Монитор модуля |Этот монитор сообщает о состоянии службы API Kube. Монитор находится в критическом состоянии в случае, если конечная точка Kube API недоступна. Для данного монитора состояние определяется путем запроса в конечную точку «узлов» для сервера kube-api. Все, что кроме кода ответа OK, изменяет монитор в **критическое** состояние. | Нет свойств конфигурации |||

### <a name="aggregate-monitors"></a>Агрегатные мониторы

|**Имя монитора** | **Описание** | **Алгоритм** |
|-----------------|-----------------|---------------|
|Узел |Этот монитор представляет собой совокупность всех мониторов узлов. Он соответствует состоянию монитора ребенка с худшим состоянием здоровья:<br> Использование процессора узла<br> Использование удовобояльной памяти<br> Статус узла | Худший из|
|Узлы бассейн |Этот монитор сообщает о комбинированном состоянии здоровья всех узлов в *агентупуле*пула пула узлов. Это три монитора состояния, состояние которого основано на худшем состоянии 80% узлов в пуле узлов, отсортированных в порядке убывания состояния узлов (то есть, критические, Предупреждающие, Здоровые).|Процент |
|Узлы (родитель пула узлов) |Это агрегатный монитор всех пулов узлов. Его состояние основано на худшем состоянии его детских мониторов (т.е. пулов узлов, присутствующих в кластере). |Худший из |
|Кластер (родитель узлов/<br> Инфраструктура Кубернете) |Это родительский монитор, который соответствует состоянию монитора ребенка с наихудшим состоянием здоровья, то есть инфраструктурой и узлами kubernetes. |Худший из |
|Инфраструктура Кубернете |Этот мониторинг сообщает о комбинированном состоянии работоспособности управляемых компонентов инфраструктуры кластера. его статус рассчитывается как «худший из» состояния мониторов ребенка, т.е. рабочие нагрузки kube-системы и статус API Server. |Худший из|
|Нагрузка системы |Этот монитор сообщает о состоянии работоспособности рабочей нагрузки kube-системы. Этот монитор соответствует состоянию детского монитора с наихудшим состоянием работоспособности, то есть **стручками в готовом состоянии** (монитор и контейнеры в рабочей нагрузке). |Худший из |
|Контейнер |Этот монитор сообщает об общем состоянии работоспособности контейнера в заданной рабочей нагрузке. Этот монитор соответствует состоянию монитора ребенка с наихудшим состоянием работоспособности, т.е. мониторами **использования процессора** и **памяти.** |Худший из |

## <a name="next-steps"></a>Дальнейшие действия

Просмотр [мониторинга работоспособности кластера,](container-insights-health.md) чтобы узнать о состоянии здоровья кластера Kubernetes.
