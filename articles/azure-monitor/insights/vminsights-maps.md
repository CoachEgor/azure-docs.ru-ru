---
title: Просмотр зависимостей приложений с помощью Azure Monitor для св-носов
description: Карта — это функция Azure Monitor для VMs. Он автоматически обнаруживает компоненты приложений в системах Windows и Linux и отображает связь между службами. В этой статье приводится подробная информация о том, как использовать функцию Карты в различных сценариях.
ms.subservice: ''
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 03/20/2020
ms.openlocfilehash: acb96984a49e4ad8535f87a41da11b3b63ae207b
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80283860"
---
# <a name="use-the-map-feature-of-azure-monitor-for-vms-to-understand-application-components"></a>Используйте функцию Карты Azure Monitor для vMs для понимания компонентов приложений
В Azure Monitor для виртуальных технологий можно просматривать обнаруженные компоненты приложений на виртуальных компьютерах Windows и Linux( которые работают в Azure или в вашей среде. Вы можете наблюдать за вдвисы в двух направлениях. Просмотр карты непосредственно с VM или просмотр карты из Azure Monitor, чтобы увидеть компоненты в группах VMs. Эта статья поможет вам понять эти два метода просмотра и как использовать функцию Карты. 

Сведения о настройке Azure Monitor для виртуальных машин, см. в [этой статье](vminsights-enable-overview.md).

## <a name="sign-in-to-azure"></a>Вход в Azure
Войдите на [портал Azure](https://portal.azure.com).

## <a name="introduction-to-the-map-experience"></a>Введение в опыт Карты
Прежде чем погрузиться в опыт Карты, вы должны понять, как она представляет и визуализирует информацию. Независимо от того, выбираете ли вы функцию «Карта» непосредственно из VM или из Azure Monitor, функция «Карта» представляет собой согласованный опыт. Разница лишь в том, что из Azure Monitor на одной карте показаны все участники многоуровневого приложения или кластера.

Функция «Карта» визуализирует зависимости VM, открывая запущенные процессы, которые: 

- Активные сетевые соединения между серверами.
- Задержка входящих и исходящих соединений.
- Порты в любой архитектуре, подключенной к TCP, в течение определенного диапазона времени.  
 
Расширьте VM, чтобы показать детали процесса и только те процессы, которые общаются с VM. Группа клиентов показывает количество фронт-энд-клиентов, которые подключаются к VM. Группы сервер-порт показывают количество серверов, к ним подключается VM. Расширьте группу сервера-порта, чтобы увидеть подробный список серверов, которые соединяются над этим портом.  

При выборе VM панель **Свойств** справа показывает свойства VM. Свойства включают системную информацию, сообщаемую операционной системой, свойства Azure VM и диаграмму пончиков, которая обобщает обнаруженные соединения. 

![Область свойств](./media/vminsights-maps/properties-pane-01.png)

На правой стороне панели выберите **События журнала,** чтобы показать список данных, которые VM отправил в Azure Monitor. Эти данные доступны для запроса.  Выберите любой тип записи, чтобы открыть страницу **журналов,** где вы увидите результаты для этого типа записи. Вы также видите преднастроенный запрос, отфильтрованный против VM.  

![Панель событий журнала](./media/vminsights-maps/properties-pane-logs-01.png)

Закройте страницу **журналов** и вернитесь к панели **Свойств.** Там выберите **оповещения** для просмотра оповещений о критериях работоспособности VM. Функция «Карта» интегрируется с оповещениями Azure Alerts для отображения оповещений для выбранного сервера в выбранном временном диапазоне. Сервер отображает значок для текущих оповещений, а панель **оповещения машины** перечисляет оповещения. 

![Панель оповещения](./media/vminsights-maps/properties-pane-alerts-01.png)

Чтобы функция Map отобразила соответствующие оповещения, создайте правило оповещения, которое применяется к определенному компьютеру:

- Включите положение для группы оповещений с помощью компьютера (например, **с интервалом в 1 минуту).**
- Основы оповещения на метрике.

Для получения дополнительной информации о оповещениях [Unified alerts in Azure Monitor](../../azure-monitor/platform/alerts-overview.md)Azure и создании правил оповещения см.

В правом верхнем углу опция **«Легенда»** описывает символы и роли на карте. Для более внимательного изучения карты и перемещения карты используйте элементы управления зумом в правом нижнем углу. Вы можете установить уровень зума и соответствовать карте размеру страницы.  

## <a name="connection-metrics"></a>Метрики подключения
Панель **соединения** отображает стандартные метрики для выбранного соединения из VM над портом TCP. Среди них имеются метрики времени отклика, количества запросов в минуту, пропускной способности трафика и каналов.  

![Диаграммы подключения к сети на панели соединения](./media/vminsights-maps/map-group-network-conn-pane-01.png)  

### <a name="failed-connections"></a>Неудачные подключения
На карте показаны неудавные подключения для процессов и компьютеров. Разбитая красная линия указывает на то, что клиентская система не достигает процесса или порта. Для систем, использующихся агента зависимости, агент сообщает о неудачных попытках подключения. Функция Карта отслеживает процесс, наблюдая за разъемами TCP, которые не могут установить соединение. Этот сбой может возникнуть в результате брандмауэра, неправильной настройки в клиенте или сервере или недоступной удаленной службы.

![Неудавное соединение на карте](./media/vminsights-maps/map-group-failed-connection-01.png)

Понимание сбоем ных подключений может помочь выслать неполадки, проверить миграцию, проанализировать безопасность и понять общую архитектуру службы. Неудачные соединения иногда безвредны, но они часто указывают на проблему. Соединения могут выйти из строя, например, когда среда сбоя внезапно становится недоступной или когда два уровня приложения не могут общаться друг с другом после миграции облака.

### <a name="client-groups"></a>Группы клиентов
На карте группы клиентов представляют клиентские машины, которые подключаются к отображеной машине. Одна группа клиентов представляет клиентов для индивидуального процесса или машины.

![Группа клиентов на карте](./media/vminsights-maps/map-group-client-groups-01.png)

Чтобы увидеть контролируемых клиентов и IP-адреса систем в группе клиентов, выберите группу. Содержимое группы отображается ниже.  

![Список IP-адресов группы клиентов на карте](./media/vminsights-maps/map-group-client-group-iplist-01.png)

Если группа включает в себя контролируемых и неконтролируемых клиентов, вы можете выбрать соответствующий раздел кольцевой диаграммы группы для фильтрации клиентов.

### <a name="server-port-groups"></a>Группы сервер-порт
Группы серверных портов представляют порты на серверах, которые имеют входные соединения с картографной машины. Группа содержит порт сервера и количество серверов, которые имеют соединения с этим портом. Выберите группу, чтобы увидеть отдельные серверы и соединения. 

![Группа сервера-порта на карте](./media/vminsights-maps/map-group-server-port-groups-01.png)  

Если группа включает в себя контролируемые и неконтролируемые серверы, можно выбрать соответствующий раздел кольцевой диаграммы группы для фильтрации серверов.

## <a name="view-a-map-from-a-vm"></a>Просмотр карты с VM 

Чтобы получить доступ к Azure Monitor для vMs непосредственно с VM:

1. На портале Azure выберите **Виртуальные машины**. 
2. Из списка выберите VM. В разделе **Мониторинг** выберите **Исследования**.  
3. Откройте вкладку **Схема**.

Карта визуализирует зависимости VM, обнаруживая запущенные технологические группы и процессы, которые имеют активные сетевые соединения в течение определенного диапазона времени.  

По умолчанию на схеме показаны последние 30 минут. Если вы хотите увидеть, как выглядели зависимости в прошлом, можно запросить исторические временные диапазоны до одного часа. Для выполнения запроса используйте селектор **TimeRange** в левом верхнем углу. Запрос можно запустить, например, во время инцидента или увидеть состояние перед изменением.  

![Общие сведения о непосредственной схеме виртуальной машины](./media/vminsights-maps/map-direct-vm-01.png)

## <a name="view-a-map-from-a-virtual-machine-scale-set"></a>Просмотр карты из набора виртуальной шкалы машины

Чтобы получить доступ к Azure Monitor для виртуальных вывеши, непосредственно из набора виртуальной машины:

1. На портале Azure выберите **наборы виртуальной шкалы машин.**
2. Из списка выберите VM. Затем в разделе **Мониторинг** выберите **Исследования**.  
3. Откройте вкладку **Схема**.

Карта визуализирует все экземпляры в шкале, установленной как групповой узлы вместе с зависимостями группы. Расширенный узлы перечисляет экземпляры в наборе шкалы. Вы можете прокрутить эти экземпляры по 10 за раз. 

Чтобы загрузить карту для определенного экземпляра, сначала выберите этот экземпляр на карте. Затем выберите кнопку **эллипсис** (...) вправо и выберите **карту сервера нагрузки.** На появляются на появляются карты, вы видите группы процессов и процессы, которые имеют активные сетевые соединения в течение определенного диапазона времени. 

По умолчанию на схеме показаны последние 30 минут. Если вы хотите увидеть, как выглядели зависимости в прошлом, можно запросить исторические временные диапазоны до одного часа. Для выполнения запроса используйте селектор **TimeRange.** Запрос можно запустить, например, во время инцидента или увидеть состояние перед изменением.

![Общие сведения о непосредственной схеме виртуальной машины](./media/vminsights-maps/map-direct-vmss-01.png)

>[!NOTE]
>Вы также можете получить доступ к карте для конкретного экземпляра из представления **Instances** для набора виртуальной шкалы машин. В разделе **Настройки** перейдите в **Instances** > **Insights**.

## <a name="view-a-map-from-azure-monitor"></a>Просмотр карты с Azure Monitor

Функция Azure Monitor в Azure Monitor предоставляет глобальное представление о ви-хау и их зависимостях. Чтобы получить доступ к функции Карты в Azure Monitor:

1. На портале Azure выберите **Monitor**. 
2. В разделе **Исследования** выберите **виртуальные машины.**
3. Откройте вкладку **Схема**.

   ![Обзорная карта нескольких VMs-мониторов Azure Monitor](./media/vminsights-maps/map-multivm-azure-monitor-01.png)

Выберите рабочее пространство, используя селектор **рабочего пространства** в верхней части страницы. Если у вас есть несколько рабочих мест Log Analytics, выберите рабочее пространство, которое включено с помощью решения и которое имеет VMs отчетности к нему. 

Селектор **группы** возвращает подписи, группы ресурсов, [компьютерные группы](../../azure-monitor/platform/computer-groups.md)и наборы компьютеров с виртуальным масштабом машин, которые связаны с выбранным рабочим пространством. Ваш выбор относится только к функции Карты и не переносится на performance или Health.

По умолчанию на схеме показаны последние 30 минут. Если вы хотите увидеть, как выглядели зависимости в прошлом, можно запросить исторические временные диапазоны до одного часа. Для выполнения запроса используйте селектор **TimeRange.** Запрос можно запустить, например, во время инцидента или увидеть состояние перед изменением.  

## <a name="next-steps"></a>Дальнейшие действия

Чтобы определить узкие места, проверить производительность и понять общее [View performance status for Azure Monitor for VMs](vminsights-performance.md)использование ваших ВМ, см. 
