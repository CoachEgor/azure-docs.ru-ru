---
title: Мониторинг ресурсов Azure с помощью Azure Monitor Документы Майкрософт
description: Описывает, как собирать и анализировать данные мониторинга из ресурсов Azure с помощью Azure Monitor.
ms.subservice: logs
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 10/08/2019
ms.openlocfilehash: 01d188e0e39888297ff8d6a57129a3a17e1654fe
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79249273"
---
# <a name="monitoring-azure-resources-with-azure-monitor"></a>Мониторинг ресурсов Azure с помощью Azure Monitor
При наличии критических приложений и бизнес-процессов, опирающихся на ресурсы Azure, необходимо отслеживать их доступность, производительность и работу. В этой статье описаны данные мониторинга, генерируемые ресурсами Azure, и то, как можно использовать функции Azure Monitor для анализа и оповещения об этих данных.

> [!IMPORTANT]
> Эта статья распространяется на все службы Azure, которые используют Azure Monitor. Вычисляющие ресурсы, включая VMs и App Service, генерируют те же данные мониторинга, описанные здесь, но также имеют гостевую операционную систему, которая также может генерировать журналы и метрики. Подробную информацию о том, как собирать и анализировать эти данные, можно получить в документации мониторинга для этих служб.

## <a name="what-is-azure-monitor"></a>Общие сведения об Azure Monitor
Azure Monitor — это служба мониторинга полного стека в Azure, которая предоставляет полный набор функций для мониторинга ресурсов Azure в дополнение к ресурсам в других облаках и на месте. [Платформа данных Azure Monitor](../platform/data-platform.md) собирает данные в [журналы](../platform/data-platform-logs.md) и [метрики,](../platform/data-platform-metrics.md) где они могут быть проанализированы вместе с помощью полного набора инструментов мониторинга, описанных в следующих разделах.

- [Что можно сделать с Azure Monitor Metrics?](../platform/data-platform-metrics.md#what-can-you-do-with-azure-monitor-metrics)
- [Что можно сделать с журналами Azure Monitor?](../platform/data-platform-logs.md#what-can-you-do-with-azure-monitor-logs)

Как только вы создаете ресурс Azure, Azure Monitor запускается и начинает собирать метрики и журналы активности, которые можно [просматривать и анализировать на портале Azure.](#monitoring-in-the-azure-portal) С некоторой конфигурацией можно собирать дополнительные данные мониторинга и включать дополнительные функции. Ниже [приведены данные мониторинга,](#monitoring-data) подробную информацию о любых требованиях к конфигурации.


## <a name="costs-associated-with-monitoring"></a>Затраты, связанные с мониторингом
Анализ данных мониторинга, собираемых по умолчанию, не обходится. Это включает следующие действия.

- Сбор метрик платформы и анализ их с помощью исследователя метрик.
- Сбор журналов активности и анализ его на портале Azure.
- Создание правила оповещения о журнале активности.

Затраты Azure Monitor на сбор и экспорт журналов и метрик не связаны с этим, но могут быть связаны с назначением:

- Затраты, связанные с использованием и хранением данных при сборе журналов и метрик в рабочей области Log Analytics. Смотрите [цены На Azure Monitor для аналитики журналов](https://azure.microsoft.com/pricing/details/monitor/).
- Затраты, связанные с хранением данных при сборе журналов и метрик в учетную запись хранения Azure. Смотрите [цены на хранение Azure для хранения кабл.](https://azure.microsoft.com/pricing/details/storage/blobs/)
- Затраты, связанные с потоковой передачей концентратора событий при пересылке журналов и метрик в концентраторы событий Azure. Смотрите [цены на центры событий Azure](https://azure.microsoft.com/pricing/details/event-hubs/).

Могут быть расходы Azure Monitor, связанные со следующими. Смотрите [цены На Azure Monitor:](https://azure.microsoft.com/pricing/details/monitor/)

- Запуск запроса журнала.
- Создание правила предупреждения запроса метрики или журнала.
- Отправка уведомления из любого правила оповещения.
- Доступ к метрикам через API.

## <a name="monitoring-data"></a>Данные мониторинга
Ресурсы в Azure генерируют [журналы](../platform/data-platform-logs.md) и [метрики, показанные](../platform/data-platform-metrics.md) на следующей диаграмме. Ссылайтесь на документацию для каждой службы Azure для конкретных данных, которые они генерируют, и любых дополнительных решений или идей, которые они предоставляют.

![Обзор](media/monitor-azure-resource/logs-metrics.png)



- [Метрики платформы](../platform/data-platform-metrics.md) - численные значения, которые автоматически собираются через регулярные промежутки времени и описывают некоторые аспекты ресурса в определенное время. 
- [Журналы ресурсов](../platform/platform-logs-overview.md) — Предоставьте информацию об операциях, выполняемых в ресурсе Azure (плоскости данных), например, получение секрета из Убежища ключей или запрос в базу данных. Содержание и структура журналов ресурсов зависит от типа службы Azure и типа ресурсов.
- [Журнал действий](../platform/platform-logs-overview.md) — обеспечивает понимание операций на каждом ресурсе Azure в подписке извне (плоскость управления), например, создание нового ресурса или запуск виртуальной машины. Это информация о том, что, кто и когда для любых операций записи (PUT, POST, DELETE) приняты на ресурсы в вашей подписке.


## <a name="configuration-requirements"></a>Требования настройки

### <a name="configure-monitoring"></a>Настройка мониторинга
Некоторые данные мониторинга собираются автоматически, но возможно, что вам придется выполнять некоторую конфигурацию в зависимости от ваших требований. Ниже приведена информация для получения конкретной информации по каждому типу данных мониторинга.

- [Метрики платформы](../platform/data-platform-metrics.md) - Метрики платформы собираются автоматически в [azure Monitor Metrics](../platform/data-platform-metrics.md) без необходимости конфигурации. Создайте диагностическую настройку для отправки записей в журналы мониторинга Azure или для их переадресации за пределы Azure.
- [Журналы ресурсов](../platform/platform-logs-overview.md) - журналы ресурсов автоматически генерируются ресурсами Azure, но не собираются без диагностической настройки.  Создайте диагностическую настройку для отправки записей в журналы мониторинга Azure или для их переадресации за пределы Azure.
- [Журнал активности](../platform/platform-logs-overview.md) - журнал активности собирается автоматически без необходимости конфигурации и может быть просмотрен на портале Azure. Создайте диагностическую настройку, чтобы скопировать их в журналы мониторинга Azure или перенаправить их за пределы Azure.

### <a name="log-analytics-workspace"></a>Рабочая область Log Analytics
Для сбора данных в журналах Azure Monitor требуется рабочее пространство для анализа журналов. Вы можете быстро начать мониторинг службы, создав новое рабочее пространство, но может возникнуть ценность в использовании рабочего пространства, которое собирает данные из других служб. [См. Создать рабочее пространство для аналитики журналов на портале Azure](../learn/quick-create-workspace.md) для получения подробной информации о создании рабочего пространства и [развертывании журналов Azure Monitor,](../platform/design-logs-deployment.md) чтобы определить оптимальный дизайн рабочего пространства для ваших требований. Если вы используете существующее рабочее пространство в организации, то вам потребуются соответствующие разрешения, описанные в [управлении доступом к данным журнала и рабочим областям в Azure Monitor.](../platform/manage-access.md) 





## <a name="diagnostic-settings"></a>Параметры диагностики
Диагностические настройки определяют, куда должны отправляться журналы ресурсов и метрики для конкретного ресурса. Возможные направления:

- [Рабочее пространство log Analytics,](../platform/resource-logs-collect-workspace.md) позволяющее анализировать данные с помощью других данных мониторинга, собранных Azure Monitor, с помощью мощных запросов журналов, а также использовать другие функции Azure Monitor, такие как оповещения о журналах и визуализации. 
- [Концентраторы событий](../platform/resource-logs-stream-event-hubs.md) для потоковой передачи данных на внешние системы, такие как сторонние SIEMs и другие решения для анализа журналов. 
- [Учетная запись хранения Azure,](../platform/resource-logs-collect-storage.md) которая полезна для аудита, статического анализа или резервного копирования.

Следите за процедурой в [настройках диагностики Create для сбора журналов платформ и метрик в Azure](../platform/diagnostic-settings.md) для создания и управления диагностическими настройками через портал Azure. Просрнёте [настройки диагностики в Azure с помощью шаблона «Менеджер ресурсов»,](../platform/diagnostic-settings-template.md) чтобы определить их в шаблоне и включить полный мониторинг ресурса при его создании.


## <a name="monitoring-in-the-azure-portal"></a>Мониторинг на портале Azure
 Вы можете получить доступ к данным мониторинга для большинства ресурсов Azure из меню ресурса на портале Azure. Это даст вам доступ к данным одного ресурса с помощью стандартных инструментов Azure Monitor. Некоторые службы Azure предоставят различные варианты, поэтому следует ссылаться на документацию для этой службы для получения дополнительной информации. Используйте меню **Azure Monitor** для анализа данных всех контролируемых ресурсов. 

### <a name="overview"></a>Обзор
Многие службы отображают данные мониторинга на странице **Обзор**, что позволяет быстро оценить их работу. Как правило, этот механизм основан на подмножестве метрик платформы, хранящихся в службе метрик Azure Monitor. Другие варианты мониторинга, как правило, доступны в разделе **Мониторинг** абонеминов. .

![Страница "Обзор"](media/monitor-azure-resource/overview-page.png)


### <a name="insights-and-solutions"></a>Исследования и решения 
Некоторые службы будут предоставлять инструменты, выходящие за рамки стандартных функций Azure Monitor. [Исследования](../insights/insights-overview.md) предоставляют индивидуальный опыт мониторинга, построенный на платформе данных Azure Monitor и стандартных функциях. [Решения](../insights/solutions.md) обеспечивают предопределенную логику мониторинга, построенную на журналах Azure Monitor. 

Если в службе есть информация о мониторинге Azure, вы можете получить к нему доступ из **меню Мониторинга** в каждом ресурсе. Получите доступ ко всем сведениям и решениям из меню **Azure Monitor.**

![Аналитика](media/monitor-azure-resource/insights.png)

### <a name="metrics"></a>Метрики
Анализ метрик на портале Azure с помощью [исследователя метрик,](../platform/metrics-getting-started.md) который доступен из пункта меню **Метрики** для большинства служб. Этот инструмент позволяет работать с отдельными метриками или объединить несколько для определения корреляций и тенденций. 

- Смотрите [Начало работы с Azure Metrics Explorer](../platform/metrics-getting-started.md) для основ использования исследователя метрик.
- Просмотрите [расширенные функции Azure Metrics Explorer](../platform/metrics-charts.md) для расширенных функций исследователя метрик, таких как использование нескольких метрик и применение фильтров и расщепления.

![Метрики](media/monitor-azure-resource/metrics.png)


### <a name="activity-log"></a>Журнал действий 
Просмотр записей в журнале активности на портале Azure с исходным фильтром, установленным на текущем ресурсе. Копируйте журнал активности в рабочее пространство Log Analytics, чтобы получить к нему доступ, чтобы использовать его в запросах журнала и трудовых книжках. 

- Просматривайте [и извлекайте события журналов Azure Activity](../platform/activity-log-view.md) для получения подробной информации о просмотре журнала activity и извлечении записей с помощью различных методов.
- Просмотрите документацию для службы Azure для определенных событий, которые регистрируются.

![Журнал действий](media/monitor-azure-resource/activity-log.png)

### <a name="azure-monitor-logs"></a>Журналы Azure Monitor
Журналы Azure Monitor объединяют журналы и метрики из нескольких служб и других источников данных для анализа с помощью мощного инструмента запроса. Как описано выше, создайте диагностическую настройку для сбора метрик платформы, журналов активности и журналов ресурсов в рабочее пространство анализа журналов журналов в Azure Monitor.

[Log Analytics](../log-query/get-started-portal.md) позволяет работать с [запросами журналов,](../log-query/log-query-overview.md)что является мощной особенностью Azure Monitor, которая позволяет выполнять расширенный анализ данных журнала с помощью полнофункционального языка запросов. Открытая аналитика **журналов** из меню **мониторинга** для ресурса Azure для работы с запросами журналов, используя ресурс в качестве [области запросов.](../log-query/scope.md#query-scope) Это позволяет анализировать данные в нескольких таблицах только для этого ресурса. Используйте **журналы** из меню Azure Monitor для доступа к журналам для всех ресурсов. 

- [См. Начало с запросами журнала в Azure Monitor](../log-query/get-started-queries.md) для получения учебника по использованию языка запросов, используемого для записи запросов журнала.
- В [рабочей области Analytics журнала «Сбор azure» в рабочей области журналов Журнала Analytics](../platform/resource-logs-collect-workspace.md) можно найти информацию о том, как собираются журналы ресурсов в журналах Azure Monitor, а также подробную информацию о том, как получить к ним доступ в запросе.
- Ознакомьтесь с [режимом сбора,](../platform/resource-logs-collect-workspace.md#resource-log-collection-mode) чтобы объяснить, как структурированы данные журнала ресурсов в журналах Azure Monitor.
- Подробную информацию о каждом сервисе Azure можно узнать в журнале Azure Monitor Logs.

![Журналы](media/monitor-azure-resource/logs.png)

## <a name="monitoring-from-command-line"></a>Мониторинг с командной строки
Вы можете получить доступ к данным мониторинга, собранным с вашего ресурса из командной строки, или включить в скрипт с помощью [интерфейса Azure PowerShell](/powershell/azure/) или [Azure Command Line Interface.](/cli/azure/) 

- Смотрите [ссылку на метрики CLI](/cli/azure/monitor/metrics) для доступа к метрическим данным из CLI.
- Смотрите [ссылку CLI Log Analytics](/cli/azure/ext/log-analytics/monitor/log-analytics) для доступа к данным журналов Azure Monitor, используя запрос журнала от CLI.
- Смотрите [ссылку на метрики Azure PowerShell](/powershell/module/azurerm.insights/get-azurermmetric) для доступа к метрическим данным из Azure PowerShell.
- Смотрите [ссылку на запрос запроса журнала Azure PowerShell](/powershell/module/az.operationalinsights/Invoke-AzOperationalInsightsQuery) для доступа к данным журналов Azure Monitor, используя запрос журнала из Azure PowerShell.

## <a name="monitoring-from-rest-api"></a>Мониторинг от REST API
Включите данные мониторинга, собранные с вашего ресурса, в пользовательское приложение с помощью REST API.

- Подробную информацию о доступе к метрикам из API Azure Monitor REST можно просмотреть [пошаговый материал Azure Monitoring REST.](../platform/rest-api-walkthrough.md)
- Спомощью [API Azure Log Analytics REST](https://dev.loganalytics.io/) для получения информации о доступе к данным журналов Azure Monitor с помощью запроса журнала azure PowerShell.

## <a name="alerts"></a>видны узлы
[Оповещения](../platform/alerts-overview.md) упреждающе уведомляют вас и потенциально принимают меры при обнаружении важных условий в данных мониторинга. Создается правило оповещения, определяющее цель оповещения, условия создания оповещения и любые действия, которые необходимо предпринять в ответ.

Различные виды данных мониторинга используются для различных видов правил оповещения.

- [Оповещение журнала активности](../platform/alerts-activity-log.md) - Создайте оповещение при создании записи в журнале действий, который соответствует определенным критериям. Это позволяет получать уведомления, например, при создании определенного типа ресурса или в случае сбоя изменения конфигурации.
- [Метрическое оповещение](../platform/alerts-metric.md) - Создание оповещения, когда значение метрики превышает определенный порог. Метрические оповещения более отзывчивы, чем другие оповещения, и могут быть автоматически решены при исправлении проблемы.
- [Оповещение о запросе журнала](../platform/alerts-log.md) - Выполнить запрос журнала через регулярные промежутки времени и создать оповещение при обнаружении конкретного состояния. Это позволяет выполнять комплексный анализ по нескольким наборам данных и .

Используйте **оповещения** из меню ресурса для просмотра предупреждений и управления правилами оповещения для этого ресурса. Только оповещения о журнале активности и метеологии используют отдельные ресурсы Azure в качестве мишени. Оповещения запроса в журнале используют рабочее пространство Log Analytics в качестве цели и основаны на запросе, который может получить доступ к любым журналам, хранящимся в этом рабочем пространстве. Используйте меню Azure Monitor для просмотра и управления оповещениями для всех ресурсов и правил оповещения запроса поиска.

- Приведенные выше статьи для различных видов предупреждений приведены в подробности о создании правил оповещения.
- [См. Создание и управление группами действий на портале Azure](../platform/action-groups.md) для получения подробной информации о создании группы действий, которая позволяет управлять ответами на оповещения.



## <a name="next-steps"></a>Дальнейшие действия

* Ознакомиться с сведениями о журналах ресурсов для различных служб Azure можно просмотреть [поддерживаемые службы, схемы и категории для журналов ресурсов Azure.](../platform/diagnostic-logs-schema.md)  
