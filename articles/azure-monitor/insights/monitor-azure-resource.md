---
title: Мониторинг ресурсов Azure с помощью Azure Monitor | Документация Майкрософт
description: Описание процесса получения и анализа данных мониторинга из ресурсов в Azure с помощью Azure Monitor.
ms.service: azure-monitor
ms.subservice: logs
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 10/08/2019
ms.openlocfilehash: 5a46de9fa17790cb93ce7d5a2af8008d34d4dc35
ms.sourcegitcommit: 8bd85510aee664d40614655d0ff714f61e6cd328
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/06/2019
ms.locfileid: "74888790"
---
# <a name="monitoring-azure-resources-with-azure-monitor"></a>Мониторинг ресурсов Azure с помощью Azure Monitor
При наличии критически важных приложений и бизнес-процессов, использующих ресурсы Azure, необходимо отслеживать эти ресурсы на предмет их доступности, производительности и работы. В этой статье описываются данные мониторинга, созданные ресурсами Azure, а также способы использования функций Azure Monitor для анализа и оповещения об этих данных.

> [!IMPORTANT]
> Эта статья относится ко всем службам в Azure, использующим Azure Monitor. Ресурсы для вычислений, включая виртуальные машины и службы приложений, создают те же данные мониторинга, которые описаны здесь, но также имеют гостевую операционную систему, которая также может создавать журналы и метрики. Дополнительные сведения о том, как собираются и анализируют эти данные, см. в документации по мониторингу этих служб.

## <a name="what-is-azure-monitor"></a>Общие сведения об Azure Monitor
Azure Monitor — это полная служба мониторинга стека в Azure, которая предоставляет полный набор функций для мониторинга ресурсов Azure в дополнение к ресурсам в других облаках и локальных средах. [Azure Monitor платформа данных](../platform/data-platform.md) собирает данные в [журналы](../platform/data-platform-logs.md) и [метрики](../platform/data-platform-metrics.md) , где их можно анализировать вместе с помощью полного набора средств мониторинга, как описано в следующих разделах.

- [Что можно сделать с помощью метрик Azure Monitor?](../platform/data-platform-metrics.md#what-can-you-do-with-azure-monitor-metrics)
- [Что можно делать с Azure Monitor журналами?](../platform/data-platform-logs.md#what-can-you-do-with-azure-monitor-logs)

После создания ресурса Azure Azure Monitor включается и начинает сбор метрик и журналов действий, которые можно [просматривать и анализировать в портал Azure](#monitoring-in-the-azure-portal). В некоторых конфигурациях можно собирать дополнительные данные мониторинга и включать дополнительные функции. Дополнительные сведения о требованиях к конфигурации см. в разделе [мониторинг данных](#monitoring-data) ниже.


## <a name="costs-associated-with-monitoring"></a>Затраты, связанные с мониторингом
Анализ данных мониторинга, собираемых по умолчанию, не взимается. В их состав входят:

- Сбор метрик платформы и их анализ с помощью обозревателя метрик.
- Сбор журнала действий и его анализ в портал Azure.
- Создание правила генерации оповещений журнала действий.

Нет Azure Monitorных затрат на сбор и экспорт журналов и метрик, но могут возникнуть связанные затраты, связанные с назначением:

- Затраты, связанные с приемом и хранением данных при сборе журналов и метрик в Log Analytics рабочей области. См. [Azure Monitor цены на log Analytics](https://azure.microsoft.com/pricing/details/monitor/).
- Затраты, связанные с хранилищем данных при сборе журналов и метрик в учетную запись хранения Azure. См. раздел [цены на службу хранилища Azure для хранилища BLOB-объектов](https://azure.microsoft.com/pricing/details/storage/blobs/).
- Затраты, связанные с потоковой передачей концентратора событий при пересылке журналов и метрик в концентраторы событий Azure. См. [цены на концентраторы событий Azure](https://azure.microsoft.com/pricing/details/event-hubs/).

Возможны Azure Monitor затраты, связанные со следующим. См. [Azure Monitor цены](https://azure.microsoft.com/pricing/details/monitor/):

- Выполнение запроса журнала.
- Создание правила оповещения о метрике или запросе журнала.
- Отправка уведомления из любого правила генерации оповещений.
- Доступ к метрикам через API.

## <a name="monitoring-data"></a>Данные мониторинга
Ресурсы в Azure создают [журналы](../platform/data-platform-logs.md) и [метрики](../platform/data-platform-metrics.md) , показанные на следующей схеме. Ознакомьтесь с документацией по каждому из служб Azure, чтобы получить конкретные данные, которые они создают, а также любые дополнительные решения или аналитические сведения, которые они предоставляют.

![Краткое описание](media/monitor-azure-resource/logs-metrics.png)



- [Метрики платформы](../platform/data-platform-metrics.md) — числовые значения, которые автоматически собираются через регулярные интервалы и описывают некоторые аспекты ресурса в определенное время. 
- [Журналы ресурсов](../platform/resource-logs-overview.md) — содержат сведения об операциях, которые выполнялись в ресурсе Azure (плоскость данных), например получение секрета из Key Vault или выполнение запроса к базе данных. Содержимое и структура журналов ресурсов зависит от службы и типа ресурса Azure.
- [Журнал действий](../platform/activity-logs-overview.md) . предоставляет сведения об операциях с каждым ресурсом Azure в подписке за пределами (плоскость управления), например создание нового ресурса или запуск виртуальной машины. Это сведения о том, кто и когда для любых операций записи (размещение, публикация, удаление), выполненных с ресурсами в вашей подписке.


## <a name="configuration-requirements"></a>Требования к конфигурации

### <a name="configure-monitoring"></a>Настройка мониторинга
Некоторые данные мониторинга собираются автоматически, но может потребоваться выполнить некоторые настройки в зависимости от требований. Подробные сведения о каждом типе данных мониторинга см. ниже.

- [Метрики платформы](../platform/data-platform-metrics.md) — метрики платформы автоматически собираются в [метрики Azure Monitor](../platform/data-platform-metrics.md) без необходимости настройки. Создайте параметр диагностики для отправки записей в журналы Azure Monitor или для перенаправления их за пределы Azure.
- [Журналы ресурсов](../platform/resource-logs-overview.md) . журналы ресурсов автоматически создаются ресурсами Azure, но не собираются без параметра диагностики.  Создайте параметр диагностики для отправки записей в журналы Azure Monitor или для перенаправления их за пределы Azure.
- [Журнал действий](../platform/activity-logs-overview.md) . журнал действий автоматически собирается без настройки и может быть представлен в портал Azure. Создайте параметр диагностики, чтобы скопировать их в журналы Azure Monitor или пересылать их за пределы Azure.

### <a name="log-analytics-workspace"></a>Рабочая область Log Analytics
Для сбора данных в Azure Monitor журналов требуется рабочая область Log Analytics. Вы можете быстро приступить к наблюдению за службой, создав новую рабочую область, но при этом может быть значение в рабочей области, которая собирает данные из других служб. Дополнительные сведения о создании рабочей области и [проектировании развертывания журналов Azure Monitor](../platform/design-logs-deployment.md) см. в разделе [создание рабочей области log Analytics на портал Azure](../learn/quick-create-workspace.md) . Если вы используете существующую рабочую область в Организации, вам потребовались соответствующие разрешения, как описано в статье [Управление доступом к данным и рабочим областям журнала в Azure Monitor](../platform/manage-access.md). 





## <a name="diagnostic-settings"></a>Параметры диагностики
Параметры диагностики определяют, куда должны отправляться журналы и метрики для определенного ресурса. Возможные места назначения:

- [Log Analytics рабочей области](../platform/resource-logs-collect-workspace.md) , которая позволяет анализировать данные с помощью других данных мониторинга, собираемых Azure Monitor используя мощные запросы журналов, а также использовать другие функции Azure Monitor, такие как оповещения журнала и визуализации. 
- [Концентраторы событий](../platform/resource-logs-stream-event-hubs.md) для потоковой передачи данных в внешние системы, такие как сторонние решения Siem и другие решения log Analytics. 
- [Учетная запись хранения Azure](../platform/resource-logs-collect-storage.md) , которая полезна для аудита, статического анализа или резервного копирования.

Выполните процедуру, описанную в разделе [Создание параметров диагностики для сбора журналов и метрик платформы в Azure](../platform/diagnostic-settings.md) для создания параметров диагностики и управления ими с помощью портал Azure. Ознакомьтесь с разделом [Создание параметра диагностики в Azure с помощью шаблона диспетчер ресурсов](../platform/diagnostic-settings-template.md) , чтобы определить их в шаблоне и включить полный мониторинг ресурса при его создании.


## <a name="monitoring-in-the-azure-portal"></a>Мониторинг на портале Azure
 Вы можете получить доступ к данным мониторинга для большинства ресурсов Azure из меню ресурса в портал Azure. Это обеспечит доступ к данным одного ресурса с помощью стандартных средств Azure Monitor. Некоторые службы Azure предоставляют различные параметры, поэтому для получения дополнительных сведений следует обратиться к документации по этой службе. Используйте меню **Azure Monitor** для анализа данных из всех отслеживаемых ресурсов. 

### <a name="overview"></a>Краткое описание
Многие службы будут включать данные мониторинга на странице **обзора** как краткий обзор их работы. Как правило, это основано на подмножестве метрик платформы, хранящихся в Azure Monitor метриках. Другие параметры мониторинга, как правило, доступны в разделе " **мониторинг** " служб. .

![Страница "Обзор"](media/monitor-azure-resource/overview-page.png)


### <a name="insights-and-solutions"></a>Аналитические сведения и решения 
Некоторые службы предоставляют средства, выходящие за рамки стандартных функций Azure Monitor. [Insights](../insights/insights-overview.md) предоставляет настраиваемый опыт мониторинга, основанный на Azure Monitor платформе данных и стандартных функциях. [Решения](../insights/solutions.md) предоставляют стандартную логику мониторинга, основанную на журналах Azure Monitor. 

Если у службы есть Azure Monitor аналитика, к ней можно обращаться из **наблюдения** в меню каждого ресурса. Доступ ко всем аналитикам и решениям из меню **Azure Monitor** .

![Аналитические сведения](media/monitor-azure-resource/insights.png)

### <a name="metrics"></a>Метрики
Анализируйте метрики в портал Azure с помощью [обозревателя метрик](../platform/metrics-getting-started.md) , который доступен в пункте меню **метрики** для большинства служб. Это средство позволяет работать с отдельными метриками или объединять несколько для выявления корреляций и тенденций. 

- Основные сведения об использовании обозревателя метрик см. в статье [Приступая к работе с Azure обозреватель метрик](../platform/metrics-getting-started.md) .
- Дополнительные возможности обозревателя метрик, такие как использование нескольких метрик и применение фильтров и разбиение, см. в статье [Расширенные возможности обозреватель метрик Azure](../platform/metrics-charts.md) .

![Метрики](media/monitor-azure-resource/metrics.png)


### <a name="activity-log"></a>Журнал действий 
Просмотрите записи в журнале действий в портал Azure с начальным фильтром, равным текущему ресурсу. Скопируйте журнал действий в рабочую область Log Analytics, чтобы получить доступ к ней для использования в журналах запросов и книг. 

- Дополнительные сведения о просмотре журнала действий и извлечении записей с помощью различных методов см. в статье [Просмотр и получение событий журнала действий Azure](../platform/activity-log-view.md) .
- Сведения о событиях, регистрируемых в журнале, см. в документации по службе Azure.

![Журнал действий](media/monitor-azure-resource/activity-log.png)

### <a name="azure-monitor-logs"></a>Журналы Azure Monitor
Журналы Azure Monitor консолидируют журналы и метрики из нескольких служб и других источников данных для анализа с помощью мощного инструмента для работы с запросами. Как описано выше, создайте параметр диагностики для сбора метрик платформы, журнала действий и журналов ресурсов в Log Analytics рабочей области в Azure Monitor.

[Log Analytics](../log-query/get-started-portal.md) позволяет работать с запросами к [журналу](../log-query/log-query-overview.md), что является мощным компонентом Azure Monitor, позволяющим выполнять расширенный анализ данных журнала с помощью полнофункционального языка запросов. Откройте Log Analytics из **журналов** в меню **мониторинг** для ресурса Azure, чтобы работать с запросами к журналу, используя ресурс в качестве [области запроса](../log-query/scope.md#query-scope). Это позволяет анализировать данные в нескольких таблицах только для этого ресурса. Используйте **журналы** из меню Azure Monitor, чтобы получить доступ к журналам для всех ресурсов. 

- Руководство по использованию языка запросов, используемого для написания запросов журнала, см. в разделе Начало [работы с запросами журналов в Azure Monitor](../log-query/get-started-queries.md) .
- Сведения о сборе журналов ресурсов в Azure Monitor журналах и сведения о том, как получить доступ к ним в запросе, см. в статье [Сбор журналов ресурсов Azure в log Analytics рабочей области в Azure Monitor](../platform/resource-logs-collect-workspace.md) .
- Описание структурирования данных журнала ресурсов в Azure Monitor журналов см. в разделе [режим сбора](../platform/resource-logs-collect-workspace.md#collection-mode) .
- Дополнительные сведения о таблице в журналах Azure Monitor см. в документации по каждой службе Azure.

![Журналы](media/monitor-azure-resource/logs.png)

## <a name="monitoring-from-command-line"></a>Мониторинг из командной строки
Доступ к данным мониторинга, собранным из ресурса, можно получить из командной строки или включить в скрипт с помощью [Azure PowerShell](/powershell/azure/) или [интерфейса командной строки Azure](/cli/azure/). 

- Сведения о доступе к данным метрик из CLI см. в статье [Справочник по метрикам CLI](/cli/azure/monitor/metrics) .
- См. Log Analytics Справочник по интерфейсу [командной строки](/cli/azure/ext/log-analytics/monitor/log-analytics) для доступа к Azure Monitor данным журнала с помощью запроса к журналу из интерфейса командной строки.
- См. раздел [Справочник по метрикам Azure PowerShell](/powershell/module/azurerm.insights/get-azurermmetric) для доступа к данным метрик из Azure PowerShell.
- См. [Azure PowerShell Справочник по запросам журнала](/powershell/module/az.operationalinsights/Invoke-AzOperationalInsightsQuery) для доступа к Azure Monitor данным журнала с помощью запроса к журналу из Azure PowerShell.

## <a name="monitoring-from-rest-api"></a>Мониторинг с REST API
Включите данные мониторинга, собранные из ресурса, в пользовательское приложение, используя REST API.

- Дополнительные сведения о доступе к метрикам из REST API Azure Monitor см. в разделе [REST API мониторинга Azure](../platform/rest-api-walkthrough.md) .
- Сведения о доступе к данным Azure Monitor журналов с помощью запроса журнала Azure PowerShell см. в статье [log Analytics Azure REST API](https://dev.loganalytics.io/) .

## <a name="alerts"></a>Оповещения
[Оповещения](../platform/alerts-overview.md) заблаговременно уведомляют Вас и потенциально принимают меры при обнаружении важных условий в данных мониторинга. Вы создаете правило генерации оповещений, определяющее целевой объект для предупреждения, условия создания предупреждения и действия, которые необходимо выполнить в ответе.

Для различных типов правил генерации оповещений используются различные виды данных мониторинга.

- [Оповещение журнала действий](../platform/alerts-activity-log.md) . создает оповещение при создании записи в журнале действий, соответствующей указанным условиям. Это позволяет получать уведомления, например при создании определенного типа ресурса или при сбое изменения конфигурации.
- [Оповещение метрики](../platform/alerts-metric.md) — создает оповещение, если значение метрики превышает определенный порог. Оповещения метрик более отвечают, чем другие оповещения, и могут быть автоматически разрешены после устранения проблемы.
- [Оповещение о запросе журнала](../platform/alerts-log.md) — выполнение запроса к журналу через регулярные промежутки времени и создание предупреждения при обнаружении определенного условия. Это позволяет выполнять сложный анализ по нескольким наборам данных и.

Используйте **оповещения** из меню ресурса для просмотра предупреждений и управления правилами оповещений для этого ресурса. Только оповещения журнала действий и оповещения метрик используют отдельные ресурсы Azure в качестве целевых объектов. Оповещения о запросах журнала используют рабочую область Log Analytics в качестве цели и основываются на запросе, который может обращаться к любым журналам, хранящимся в этой рабочей области. Используйте меню Azure Monitor для просмотра и управления оповещениями для всех ресурсов и правил оповещения об управлении запросами к журналу.

- Дополнительные сведения о создании правил генерации оповещений см. в статьях, посвященных различным типам оповещений.
- Дополнительные сведения о создании группы действий, которая позволяет управлять ответами на предупреждения, см. в разделе [Создание групп действий и управление ими в портал Azure](../platform/action-groups.md) .



## <a name="next-steps"></a>Дальнейшие действия

* Подробные сведения о журналах ресурсов для различных служб Azure см. в статье [Поддерживаемые службы, схемы и категории для журналов ресурсов Azure](../platform/diagnostic-logs-schema.md) .  
