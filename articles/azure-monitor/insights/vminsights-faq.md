---
title: 'Azure Monitor для виртуальных машин (предварительная версия): часто задаваемые вопросы | Документация Майкрософт'
description: Azure Monitor для виртуальных машин — это решение в Azure, которое отслеживает работоспособность и производительность ОС виртуальных машин Azure, автоматически обнаруживает компоненты приложений и их зависимости от других ресурсов, а также строит схему каналов связи между ними. В этой статье приведены ответы на распространенные вопросы.
services: azure-monitor
author: mgoedtel
manager: carmonm
editor: tysonn
ms.service: azure-monitor
ms.topic: article
ms.workload: infrastructure-services
ms.date: 01/09/2018
ms.author: magoedte
ms.openlocfilehash: 420ba9d74532095c2d028fef8f549d532e5dfa05
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "65522207"
---
# <a name="azure-monitor-for-vms-preview-frequently-asked-questions"></a>Azure Monitor для виртуальных машин (предварительная версия): часто задаваемые вопросы
В этом списке вопросов и ответов от Майкрософт приведены часто задаваемые вопросы об Azure Monitor для виртуальных машин. Если у вас есть другие вопросы об этом решении, вы можете задать их на [форуме для обсуждений](https://feedback.azure.com/forums/34192--general-feedback). Если вопрос задается часто, мы добавим его в эту статью, чтобы его можно было найти быстро и легко.

## <a name="can-i-onboard-to-an-existing-workspace"></a>Можно ли подключиться к существующей рабочей области?
Если ваши виртуальные машины уже подключены к рабочей области Log Analytics, вы можете продолжить использовать эту рабочую область при подключении к Azure Monitor для виртуальных машин при условии, что эта рабочая область находится в одном из перечисленных [здесь](vminsights-enable-overview.md#prerequisites) поддерживаемых регионов.

При подключении мы настраиваем счетчики производительности для рабочей области. В результате система начинает собирать отчетные данные обо всех виртуальных машинах в рабочей области, а затем отображает и анализирует их в Azure Monitor для виртуальных машин.  В результате будут отображаться данные производительности, которые получены со всех виртуальных машин, подключенных к выбранной рабочей области.  Функции "Работоспособность" и "Схема" будут включены только для тех виртуальных машин, которые вы укажете для подключения.

На производительность, какие счетчики включены дополнительные сведения см. наш [включить Обзор](vminsights-enable-overview.md#performance-counters-enabled) статьи.

## <a name="can-i-onboard-to-a-new-workspace"></a>Можно ли подключиться к новой рабочей области? 
Если на данный момент ваши виртуальные машины не подключены к существующей рабочей области Log Analytics, вам потребуется создать рабочую область для хранения ваших данных. Если вы настроите одну виртуальную машину Azure для Azure Monitor для виртуальных машин на портале Azure, будет автоматически создана рабочая область, используемая по умолчанию.

Если вы решили использовать метод на основе сценария, эти действия рассматриваются в [включить Azure Monitor для виртуальных машин (Предварительная версия) с помощью шаблона Resource Manager или Azure PowerShell](vminsights-enable-at-scale-powershell.md) статьи. 

## <a name="what-do-i-do-if-my-vm-is-already-reporting-to-an-existing-workspace"></a>Что делать, если виртуальная машина уже отправляет отчеты в существующую рабочую область?
Если вы уже собираете данные со своих виртуальных машин, возможно, вы уже настроили их для передачи отчетных данных в существующую рабочую область Log Analytics.  Пока эта рабочая область находится в одном из поддерживаемых регионов, вы можете включить Azure Monitor для виртуальных машин для этой существующей рабочей области.  Если рабочая область, которую вы уже используете, не находится в одном из поддерживаемых нами регионов, то на данный момент вам не удастся подключиться к Azure Monitor для виртуальных машин.  Мы активно работаем над поддержкой дополнительных регионов.

>[!NOTE]
>Мы настраиваем счетчики производительности для рабочей области, которые затрагивают все виртуальные машины, отправляющие отчетные данные в эту рабочую область, независимо от того, подключите ли вы их к Azure Monitor для виртуальных машин. Дополнительные сведения о настройке счетчиков производительности для рабочей области см. в нашей [документации](../../azure-monitor/platform/data-sources-performance-counters.md). Сведения о счетчиках, настроенных для Azure Monitor для виртуальных машин, обратитесь к нашей [включить Azure Monitor для виртуальных машин](vminsights-enable-overview.md#performance-counters-enabled) статьи.  

## <a name="why-did-my-vm-fail-to-onboard"></a>Почему не удалось подключить мою виртуальную машину?
При подключении виртуальной машины Azure на портале Azure выполняются указанные ниже действия.

* Система создает рабочую область Log Analytics, используемую по умолчанию, если был выбран соответствующий параметр.
* Система настраивает счетчики производительности для выбранной рабочей области. Если не удастся выполнить это действие, вы заметите, что в некоторых диаграммах и таблицах производительности не отображаются данные для подключенной вами виртуальной машины. Это можно исправить, только выполнив скрипт PowerShell, описанный [здесь](vminsights-enable-at-scale-powershell.md#enable-performance-counters).
* Если система определяет, что необходим агент Log Analytics, она устанавливает его на виртуальных машинах Azure, используя расширение виртуальной машины.  
* При необходимости на виртуальных машинах Azure с использованием расширения устанавливается программа Dependency Agent. Ее требует функция "Схема" в Azure Monitor для виртуальных машин.  
* При необходимости настраиваются компоненты Azure Monitor, поддерживающие функцию "Работоспособность". Кроме того, настраивается виртуальная машина так, чтобы она предоставляла данные о работоспособности.

В процессе подключения мы проверяем состояние на каждом из указанных выше элементов, чтобы возвращать сведения о состоянии уведомления вам на портале. Настройка рабочей области и установка агента обычно занимает 5–10 минут. Просмотр данных мониторинга и работоспособности на портале занимает еще 5–10 минут.  

Если вы инициировали подключение, но после этого отображаются сообщения о том, что необходимо подключить виртуальную машину, подождите около 30 минут, пока виртуальная машина завершит процесс. 

## <a name="i-only-enabled-azure-monitor-for-vms-why-do-i-see-all-my-vms-monitored-by-the-health-feature"></a>После включения решения "Azure Monitor для виртуальных машин" я вижу, что функция работоспособности отслеживает все мои виртуальные машины. Почему?
Функция работоспособности включена для всех виртуальных машин, которые подключены к рабочей области Log Analytics, даже если это действие запускалось с отдельной виртуальной машины.

## <a name="can-i-modify-the-schedule-for-when-health-criteria-evaluates-a-condition"></a>Могу ли я изменить график, по которому критерии работоспособности будут оценивать состояние?
Нет, в этом выпуске невозможно изменить период времени и частоту проверки работоспособности. 

## <a name="can-i-disable-health-criteria-for-a-condition-i-dont-need-to-monitor"></a>Могу ли я отключить критерии работоспособности для состояния, которое мне не нужно контролировать?
Критерии работоспособности нельзя отключить в этом выпуске.

## <a name="are-the-health-alert-severities-configurable"></a>Настраивается ли степень серьезности оповещения о работоспособности?  
Степень серьезности оповещения о работоспособности нельзя изменить. Его можно только включить или отключить. Кроме того, некоторые степени серьезности оповещения обновляются на основе состояния критериев работоспособности. 

## <a name="if-i-reconfigure-the-settings-of-a-particular-health-criteria-can-it-be-scoped-to-a-specific-instance"></a>Если перенастроить параметры определенного критерия работоспособности, можно ли его применить к конкретному экземпляру?  
При изменении любого параметра экземпляра критерия работоспособности изменяются все экземпляры критериев работоспособности того же типа на виртуальной машине Azure. Например, если изменяется пороговое значение экземпляра критерия работоспособности диска, соответствующего логическому диску C, этот порог будет применяться ко всем другим логическим дискам, обнаруженным и контролируемым для этой же виртуальной машины.

## <a name="does-the-health-feature-monitor-logical-processors-and-cores"></a>Контролирует ли функция работоспособности логические процессоры и ядра?
Нет, критерии работоспособности отдельного процессора и уровня логического процессора для Windows не включены. По умолчанию отслеживается только общий процент использования ЦП, чтобы эффективно оценить нагрузку на ЦП на основе общего количества логических ЦП, доступных для виртуальной машины Azure. 

## <a name="are-all-health-criteria-thresholds-configurable"></a>Все ли пороговые значения критериев работоспособности настраиваются?  
Пороговые значения для критериев работоспособности виртуальной машины Windows невозможно изменить, так как для работоспособности виртуальной машины настроено состояние *Выполняется* или *Доступно*. При запросе состояния работоспособности из [API мониторинга рабочей нагрузки](https://docs.microsoft.com/rest/api/monitor/microsoft.workloadmonitor/components) отображается параметр *comparisonOperator* со значением **LessThan** или **GreaterThan** и с *пороговым* значением **4** для службы или объекта при таких ошибках:
   - Служба "Работоспособность служб" DNS-клиента не запущена. 
   - Служба "Работоспособность служб" DHCP-клиента не запущена. 
   - Служба "Работоспособность служб" RPC не запущена. 
   - Служба "Работоспособность служб" брандмауэра Windows не запущена.
   - Служба "Работоспособность служб" журнала событий Windows не запущена. 
   - Служба "Работоспособность служб" сервера не запущена. 
   - Служба "Работоспособность служб" удаленного управления Windows не запущена. 
   - Ошибка или повреждение файловой системы — логический диск недоступен.

Пороговые значения для следующих критериев работоспособности Linux невозможно изменить, так как для их состояния работоспособности уже установлено значение *true*. Для состояния работоспособности отображается параметр *compareOperator* со значением **LessThan** и *пороговым* значением **1** при запросе из API мониторинга рабочей нагрузки для объекта в зависимости от его контекста:
   - Состояние логического диска — логический диск работает в автономном режиме или недоступен.
   - Состояние диска — диск работает в автономном режиме или недоступен.
   - Состояние сетевого адаптера — сетевой адаптер отключен.

## <a name="how-do-i-modify-alerts-that-are-included-with-the-health-feature"></a>Как изменить оповещения, включенные в функцию работоспособности?
Правила генерации оповещений, определенные для каждого критерия работоспособности, не отображаются на портале Azure. Вы можете включить или отключить правило генерации оповещений о работоспособности только в [API мониторинга рабочей нагрузки](https://docs.microsoft.com/rest/api/monitor/microsoft.workloadmonitor/components). На портале Azure нельзя также присвоить [группы действий Azure Monitor](../../azure-monitor/platform/action-groups.md) для оповещений о работоспособности. Можно использовать API параметров уведомлений для настройки группы действий, которая будет запускаться всякий раз, когда выдается оповещение о работоспособности. Группы действий сейчас можно назначать виртуальной машине, чтобы все *оповещения о работоспособности* для этой виртуальной машины активировали одни и те же группы действий. В отличие от традиционных оповещений Azure, для каждого правила генерации оповещений о работоспособности не предусмотрены отдельные группы действий. Кроме того, при активации оповещений о работоспособности поддерживаются только группы действий, настроенные для уведомления по электронной почте или с помощью SMS. 

## <a name="i-dont-see-some-or-any-data-in-the-performance-charts-for-my-vm"></a>На диаграммах производительности не отображаются некоторые или все данные для моей виртуальной машины
Если данные производительности не отображаются в таблице дисков или в некоторых диаграммах производительности, возможно, не настроены счетчики производительности в рабочей области. Чтобы решить эту проблему, выполните указанный ниже [скрипт PowerShell](vminsights-enable-at-scale-powershell.md#enable-with-powershell).

## <a name="how-is-azure-monitor-for-vms-map-feature-different-from-service-map"></a>Чем функция "Схема" в Azure Monitor для виртуальных машин отличается от решения "Сопоставление служб"?
Функция "Схема" в Azure Monitor для виртуальных машин основана на решении "Сопоставление служб", но при этом имеет указанные ниже отличия.

* Доступ к представлению "Схема" можно получить, выбрав колонку "Виртуальная машина" или элемент "Azure Monitor для виртуальных машин" в Azure Monitor.
* Теперь в функции "Схема" можно щелкать подключения и отображать представления с данными метрик подключений на боковой панели для выбранного подключения.
* Появился новый API, который используется для создания схем с целью улучшения поддержки сложных схем.
* Отслеживаемые виртуальные машины теперь включены в узел групп клиентов, а на кольцевой диаграмме показаны доли отслеживаемых и неотслеживаемых виртуальных машин в группе.  Теперь ее также можно использовать для фильтрации списка компьютеров при развертывании группы.
* Отслеживаемые виртуальные машины теперь включены в узлы групп портов серверов, а на кольцевой диаграмме показаны доли отслеживаемых и неотслеживаемых машин в группе.  Теперь ее также можно использовать для фильтрации списка компьютеров при развертывании группы.
* Стиль схем был обновлен, и теперь он больше соответствует схеме приложений в Application Insights.
* Боковые панели были обновлены и не имеют полный набор интеграции которые поддерживались в схеме услуги - управление обновлениями, отслеживания изменений, безопасности и службы поддержки. 
* Параметр для выбора групп и машин, которые необходимо сопоставить, был обновлен, и теперь поддерживает "Подписки", "Группы ресурсов", масштабируемые наборы виртуальных машин Azure и облачные службы.
* Вам не удастся создать группы компьютеров в решении "Сопоставление служб", используя функцию "Схема" в Azure Monitor для виртуальных машин.  

## <a name="why-do-my-performance-charts-show-dotted-lines"></a>Почему диаграммы производительности отображаются пунктирными линиями?
Это может произойти по нескольким причинам.  В случаях, когда есть пробелы в собранных данных, мы отображаем строки пунктирной линией.  Если вы изменили частоту выборки данных для включенных счетчиков производительности (по умолчанию сбор данных выполняется каждые 60 секунд), на диаграмме могут отображаться пунктирные линии. Это происходит, если вы выбрали малый диапазон времени для диаграммы, а частота выборки меньше, чем размер сегмента, используемого в диаграмме (например, частота выборки составляет один раз в 10 минут, а каждый сегмент на диаграмме соответствует 5 минутам).  В этом случае, если вы выберете больший диапазон времени для отображения, линии диаграммы должны вновь стать сплошными.

## <a name="are-groups-supported-with-azure-monitor-for-vms"></a>Поддерживаются ли группы в Azure Monitor для виртуальных машин?
Да, после установки агента зависимостей мы собираем сведения с виртуальных машин для отображения групп в зависимости от подписки, группы ресурсов, масштабируемых наборов виртуальных машин и облачных служб.  Если вы используете Сопоставление служб и создали группы компьютеров, они также отображаются.  Группы компьютеров также появятся в фильтре групп, если они были созданы для просматриваемой рабочей области. 

## <a name="how-do-i-see-the-details-for-what-is-driving-the-95th-percentile-line-in-the-aggregate-performance-charts"></a>Как отобразить сведения о факторах, влияющих на линию 95-го процентиля на агрегированных диаграммах производительности?
По умолчанию список отсортирован так, что в нем отображаются виртуальные машины с самым большим значением для 95-го процентиля для выбранной метрики. Исключение составляет диаграмма "Доступная память", на которой показаны компьютеры с самым маленьким значением 5-го процентиля.  Если щелкнуть диаграмму, откроется представление со списком компьютеров с **лучшими параметрами**.

## <a name="how-does-the-map-feature-handle-duplicate-ips-across-different-vnets-and-subnets"></a>Как функция "Схема" обрабатывает дублирующиеся IP-адреса в разных виртуальных сетях и подсетях?
Если диапазоны IP-адресов дублируются при использовании виртуальных машин либо масштабируемых наборов виртуальных машин Azure в подсетях и виртуальных сетях, в функции "Схема" Azure Monitor для виртуальных машин может отображаться неправильная информация. Это известная проблема, и мы работаем над ее решением.

## <a name="does-map-feature-support-ipv6"></a>Поддерживает ли функция "Схема" протокол IPv6?
На данный момент функция "Схема" поддерживает только протокол IPv4, но мы работаем над поддержкой протокола IPv6. Мы также поддерживаем протокол IPv4, туннелируемый через протокол IPv6.

## <a name="when-i-load-a-map-for-a-resource-group-or-other-large-group-the-map-is-difficult-to-view"></a>Когда я загружаю схему для группы ресурсов или другой большой группы, становится трудно просматривать схему
Несмотря на то что мы усовершенствовали функцию "Схема" в части отображения больших и сложных конфигураций, мы понимаем, что на схеме может быть много узлов, подключений и узлов, работающих как кластеры.  Мы намерены продолжать работу над улучшением функции масштабирования.   

## <a name="why-does-the-network-chart-on-the-performance-tab-look-different-than-the-network-chart-on-the-azure-vm-overview-page"></a>Почему внешний вид диаграммы сети на вкладке "Производительность" отличается от внешнего вида диаграммы сети на странице общих сведений о виртуальной машине Azure?

На странице общих сведений о виртуальной машине Azure отображаются диаграммы, основанные на измерениях активности гостевой виртуальной машины, выполняемых узлом.  На диаграмме сети на странице общих сведений о виртуальной машине Azure отображается только сетевой трафик, за который будет выставлен счет.  Здесь не учитывается трафик между виртуальными сетями.  Данные и диаграммы, отображаемые в Azure Monitor для виртуальных машин, основаны на данных, получаемых из гостевой виртуальной машины, а на диаграмме сети отображается весь входящий и исходящий трафик TCP/IP виртуальной машины, включая трафик между виртуальными сетями.

## <a name="how-is-response-time-measured-for-data-stored-in-vmconnection-and-displayed-in-the-connection-panel-and-workbooks"></a>Как измеряется время ответа для данных сохраняется в VMConnection и отображается в панели «подключения» и книги

Время отклика является приблизительным. Так как мы не инструментировать код приложения, мы не знаем действительно начинает выполнение запроса, и когда приходит ответ. Вместо этого мы заметили, данные, отправляемые на подключение, а затем данных для этого соединения. Наш агент отслеживает эти отправляет и получает и пытается сопоставить их: Получает последовательность отправляет, следуют последовательность интерпретируется как пары запрос/ответ. Время между этими операциями является время ответа. Сюда входят задержки в сети и временем обработки на сервере.

Такое приближение хорошо подходит для протоколов, на основе запросов и ответов: отправляется один запрос на подключение и прибывает в одном ответе. Это происходит для HTTP (S) (без конвейеризации), но не удовлетворяет для других протоколов.

## <a name="are-their-limitations-if-i-am-on-the-log-analytics-free-pricing-plan"></a>Есть ли ограничения для Log Analytics ценовой категории "Бесплатный"?
Если вы настроили Azure Monitor с рабочей областью Log Analytics в ценовой категории *Бесплатный*, функция сопоставления Azure Monitor для виртуальных машин будет поддерживать подключение только пяти машин к рабочей области. Если к бесплатной рабочей области подключено пять виртуальных машин, после отключения одной виртуальной машины и последующего подключения новой виртуальной машины эта новая виртуальная машина не будет отслеживаться и отображаться на странице сопоставления.  

В этом случае отобразится предложение **Попробовать сейчас** при открытии виртуальной машины и выборе функции **Аналитические сведения (предварительная версия)** в левой области, даже если эта функция ранее была установлена на виртуальной машине.  Предложение не отобразится, если эта виртуальная машина не подключена к Azure Monitor для виртуальных машин. 

## <a name="next-steps"></a>Дальнейшие действия
Просмотрите [включить Azure Monitor для виртуальных машин](vminsights-enable-overview.md) сведения о требованиях и методы, чтобы включить мониторинг виртуальных машин.
