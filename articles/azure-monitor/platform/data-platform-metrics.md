---
title: Метрики в Azure Monitor | Документация Майкрософт
description: В этой статье описаны метрики в Azure Monitor, являющиеся данными для упрощенного мониторинга, которые можно использовать в сценариях почти в реальном времени.
documentationcenter: ''
author: bwren
manager: carmonm
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/26/2019
ms.author: bwren
ms.openlocfilehash: 2f82d5d4dcb29504abbfa6881fa825b6d8efce0d
ms.sourcegitcommit: 3d79f737ff34708b48dd2ae45100e2516af9ed78
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/23/2020
ms.locfileid: "87049529"
---
# <a name="metrics-in-azure-monitor"></a>Метрики в Azure Monitor

> [!NOTE]
> Платформа данных Azure Monitor основана на двух основных типах данных: метрики и журналы. В этой статье рассматриваются метрики. Подробные описания журналов см. в статье [Журналы в Azure Monitor](data-platform-logs.md), а сравнение метрик и журналов — в статье [Платформа данных Azure Monitor](data-platform.md).

Метрики в Azure Monitor являются упрощенными. Их можно использовать в сценариях почти в реальном времени, что делает их особенно полезными для создания оповещений и быстрого обнаружения проблем. В этой статье описана структура метрик, возможные действия с ними и различные источники данных, которые хранят данные в метриках.

## <a name="what-are-metrics"></a>Что такое метрики
Метрики — это числовые значения, которые описывают конкретный аспект системы в определенный момент времени. Метрики собираются через определенные промежутки времени. Их удобно использовать для создания оповещений — можно делать выборку с высокой частотой и быстро создавать оповещения с использованием относительно простой логики.

## <a name="what-can-you-do-with-azure-monitor-metrics"></a>Как можно использовать метрики Azure Monitor?
В следующей таблице перечислены различные способы использования данных метрик в Azure Monitor.

|  | Описание |
|:---|:---|
| **Анализ** | Используйте [обозреватель метрик](metrics-charts.md) для анализа собранных метрик на диаграмме и сравнения метрик из разных ресурсов. |
| **Визуализация** | Закрепите диаграмму из обозревателя метрик на [панели мониторинга Azure](../learn/tutorial-app-dashboards.md).<br>Создайте [книгу](../platform/workbooks-overview.md), чтобы объединить с несколькими наборами данных в интерактивном отчете. Экспортируйте результаты запроса в решение [Grafana](grafana-plugin.md), чтобы использовать его панель мониторинга и объединить с другими источниками данных. |
| **Оповещение** | Настройте [правило генерации оповещения по метрике](alerts-metric.md), которое отправляет уведомление или выполняет [автоматическое действие](action-groups.md), когда значение метрики переходит пороговое значение. |
| **Автоматизация** |  С помощью [автомасштабирования](autoscale-overview.md) можно увеличивать или уменьшать ресурсы, когда метрика выходит за пороговое значение. |
| **Экспорт** | [Перенаправляйте метрики в журналы](./resource-logs.md#send-to-azure-storage) для анализа данных в метриках Azure Monitor вместе с данными в журналах Azure Monitor и хранения значений метрик дольше 93 дней.<br>Организуйте потоковую передачу метрик в [концентратор событий](stream-monitoring-data-event-hubs.md) для их перенаправления во внешние системы. |
| **Получение** | Доступ к значениям метрик из командной строки с помощью [командлетов PowerShell](/powershell/module/az.applicationinsights).<br>Доступ к значениям метрик из настраиваемого приложения посредством [REST API](rest-api-walkthrough.md).<br>Доступ к значениям метрик из командной строки с помощью [CLI](/cli/azure/monitor/metrics). |
| **Архив** | [Архивация](./platform-logs-overview.md) журнала производительности и работоспособности ресурса в целях соответствия требованиям, аудита или автономной отчетности. |

## <a name="how-is-data-in-azure-monitor-metrics-structured"></a>Как структурированы данные в метриках Azure Monitor?
Данные, собранные метриками Azure Monitor, хранятся в базе данных временных рядов, которая оптимизирована для анализа данных с отметками времени. Каждый набор значений метрик представляет собой временной ряд со следующими свойствами:

* время получения значения;
* ресурс, с которым сопоставлено значение;
* пространство имен, используемое в качестве категории метрики;
* имя метрики;
* само значение;
* некоторые метрики могут иметь несколько измерений, как будет рассказано в разделе [Многомерные метрики](#multi-dimensional-metrics). Пользовательские метрики могут иметь до 10 измерений.

## <a name="multi-dimensional-metrics"></a>Многомерные метрики
Одной из проблем при работе с метриками данных является то, что они часто содержат ограниченные сведения для предоставления контекста для собранных значений. Azure Monitor решает эту проблему благодаря многомерным метрикам. Измерения метрики — это пары имя-значение, которые используются для передачи дополнительных данных с описаниями значения метрики. Например, метрика _Доступное место на диске_ может иметь измерение с названием _Диск_ со значениями _C:_ и _D:_ . Это позволяет просматривать сведения о доступном месте на всех дисках или на отдельных дисках.

В примере ниже показаны два набора данных для гипотетической метрики с названием _Пропускная способность сети_. В первом наборе данных нет измерений. Во втором наборе данных показаны значения с двумя измерениями, _IP-адрес_ и _Направление_:

### <a name="network-throughput"></a>Пропускная способность сети

| Timestamp     | Значение метрики |
| ------------- |:-------------|
| 8/9/2017 8:14 | 1331,8 Кбит/с |
| 8/9/2017 8:15 | 1141,4 Кбит/с |
| 8/9/2017 8:16 | 1110,2 Кбит/с |

Такая метрика без измерений поможет найти ответ только на простые вопросы, например о том, какой была пропускная способность в определенный момент времени.

### <a name="network-throughput--two-dimensions-ip-and-direction"></a>Пропускная способность сети и два измерения ("IP-адрес" и "Направление")

| Отметка времени     | Измерение "IP-адрес"   | Измерение "Направление" | Значение метрики|
| ------------- |:-----------------|:------------------- |:-----------|
| 8/9/2017 8:14 | IP-адрес — 192.168.5.2 | Направление — отправка    | 646,5 Кбит/с |
| 8/9/2017 8:14 | IP-адрес — 192.168.5.2 | Направление — получение | 420,1 Кбит/с |
| 8/9/2017 8:14 | IP-адрес — 10.24.2.15  | Направление — отправка    | 150,0 Кбит/с |
| 8/9/2017 8:14 | IP-адрес — 10.24.2.15  | Направление — получение | 115,2 Кбит/с |
| 8/9/2017 8:15 | IP-адрес — 192.168.5.2 | Направление — отправка    | 515,2 Кбит/с |
| 8/9/2017 8:15 | IP-адрес — 192.168.5.2 | Направление — получение | 371,1 Кбит/с |
| 8/9/2017 8:15 | IP-адрес — 10.24.2.15  | Направление — отправка    | 155,0 Кбит/с |
| 8/9/2017 8:15 | IP-адрес — 10.24.2.15  | Направление — получение | 100,1 Кбит/с |

Эта метрика поможет найти ответ на вопросы о том, какая пропускная способность для каждого IP-адреса и сколько данных было отправлено и получено. Многомерные метрики имеют дополнительные значения аналитики и диагностики в отличие от метрик без измерений.

## <a name="interacting-with-azure-monitor-metrics"></a>Взаимодействие с метриками Azure Monitor
С помощью [обозревателя метрик](metrics-charts.md) можно интерактивно анализировать данные непосредственно в базе данных метрик и отображать на диаграмме изменение значений нескольких метрик во времени. Вы можете закрепить диаграммы на панели мониторинга, чтобы просматривать их с другими визуализациями. Кроме того, вы можете извлечь метрики с помощью [REST API мониторинга Azure](rest-api-walkthrough.md).

![Обозреватель метрик](media/data-platform/metrics-explorer.png)

## <a name="sources-of-azure-monitor-metrics"></a>Источники метрик в Microsoft Azure
Существует три основных источника метрик, собираемых службой Azure Monitor. После сбора метрик в базе данных метрик Azure Monitor их можно оценить вместе, независимо от источников.

**Метрики платформы** создаются ресурсами Azure и наглядно отображают работоспособность и производительность этих ресурсов. Каждый тип ресурсов создает [отдельный набор метрик](metrics-supported.md), который не нужно настраивать. Метрики платформы собираются из ресурсов Azure с частотой раз в минуту, если в определении метрики не указано иное. 

**Метрики гостевой ОС** собираются из гостевой операционной системы на виртуальной машине. Включите метрики гостевой ОС для виртуальных машин Windows с помощью [Windows Diagnostic Extension (WAD)](../platform/diagnostics-extension-overview.md), а для виртуальных машин Linux — с помощью [агента InfluxData Telegraf ](https://www.influxdata.com/time-series-platform/telegraf/).

**Метрики приложений** создаются службой Application Insights для отслеживаемых приложений и помогают обнаруживать проблемы производительности и отслеживать тенденции использования приложений. Сюда входит ряд значений, в том числе значения _Время отклика сервера_ и _Исключения браузера_.

**Пользовательские метрики** — это метрики, которые вы определяете в дополнение к стандартным метрикам, которые доступны автоматически. Вы можете [определить настраиваемые метрики в приложении](../app/api-custom-events-metrics.md), которое отслеживается с помощью Application Insights, или создать настраиваемые метрики для службы Azure с помощью[API настраиваемых метрик](metrics-store-custom-rest-api.md).

## <a name="retention-of-metrics"></a>Хранение метрик
Для большинства ресурсов в Azure метрики хранятся в течение 93 дней. Существуют некоторые исключения.

**Метрики гостевой ОС**
-   **Классические метрики гостевой ОС.** Это счетчики производительности, которые собираются [Windows Diagnostic Extension (WAD)](../platform/diagnostics-extension-overview.md) или [Linux Diagnostic Extension (LAD)](../../virtual-machines/extensions/diagnostics-linux.md) и направляются в учетную запись хранения Azure. Период хранения этих метрик составляет 14 дней.
-   **Метрики гостевой ОС, отправляемые в метрики Azure Monitor.** Это счетчики производительности, которые собираются с помощью [Windows Diagnostic Extension (WAD)](diagnostics-extension-overview.md) и отправляются в [приемник данных Azure Monitor](diagnostics-extension-overview.md#data-destinations), или собираются с помощью [агента InfluxData Telegraf](https://www.influxdata.com/time-series-platform/telegraf/) на компьютерах Linux. Период хранения этих метрик составляет 93 дней.
-   **Метрики гостевой ОС, собираемые агентом Log Analytics.** Это счетчики производительности, собираемые агентом Log Analytics и отправляемые в рабочую область Log Analytics. Период хранения этих метрик составляет 31 день, но его можно увеличить до 2 лет.

**Метрики на основе журналов Application Insights.** 
- В фоновом режиме [метрики на основе журналов](../app/pre-aggregated-metrics-log-metrics.md) преобразовываются в запросы журналов. Период хранения для них соответствует периоду хранения событий в базовых журналах. Для ресурсов Application Insights журналы хранятся в течение 90 дней.


> [!NOTE]
> Вы можете [отправить метрики платформы для ресурсов Azure Monitor в рабочую область Log Analytics](./resource-logs.md#send-to-azure-storage) для анализа долгосрочных тенденций.





## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о [платформе данных Azure Monitor](data-platform.md).
- Дополнительные сведения о [данных журналов в Azure Monitor](data-platform-logs.md).
- Узнайте о [доступных данных мониторинга](data-sources.md) для различных источников в Azure.
