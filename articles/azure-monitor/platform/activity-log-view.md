---
title: Просмотр событий журнала действий Azure в Azure Monitor
description: Просмотрите журнал действий Azure в Azure Monitor и извлеките его с помощью PowerShell, CLI и REST API.
author: bwren
services: azure-monitor
ms.topic: conceptual
ms.date: 12/07/2019
ms.author: johnkem
ms.subservice: logs
ms.openlocfilehash: 9df7593a9fd191d3a734fba5e81fb1aecba08345
ms.sourcegitcommit: 7b25c9981b52c385af77feb022825c1be6ff55bf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/13/2020
ms.locfileid: "79275052"
---
# <a name="view-and-retrieve-azure-activity-log-events"></a>Просмотр и получение событий журнала действий Azure

[Журнал действий Azure](platform-logs-overview.md) позволяет получить представление о событиях уровня подписки, произошедших в Azure. В этой статье приводятся подробные сведения о различных методах просмотра и извлечения событий журнала действий.

## <a name="azure-portal"></a>Портал Azure
Просмотрите журнал действий для всех ресурсов в меню " **монитор** " в портал Azure. Просмотрите журнал действий для определенного ресурса из пункта **Журнал действий** в меню этого ресурса.

![Просмотр журнала действий](./media/activity-logs-overview/view-activity-log.png)

События журнала действий можно отфильтровать по следующим полям:

* **TimeSpan**: время начала и окончания событий.
* **Категория**: Категория событий, как описано в разделе [категории в журнале действий](activity-log-view.md#categories-in-the-activity-log).
* **Подписка**: одно или несколько имен подписок Azure.
* **Группа ресурсов**: одна или несколько групп ресурсов в выбранных подписках.
* **Ресурс (имя)** : — имя определенного ресурса.
* **Тип ресурса**: тип ресурса, например _Microsoft. COMPUTE/virtualmachines_.
* **Имя операции** — имя операции Azure Resource Manager, например _Microsoft. SQL/Servers/Write_.
* **Серьезность**: степень серьезности события. Доступные значения: _информационное_, _предупреждение_, _Ошибка_, _критическое_.
* **Событие, инициированное**: пользователь, выполнивший операцию.
* **Открыть Поиск**: Откройте поле поиска текста, которое ищет эту строку во всех полях во всех событиях.

## <a name="categories-in-the-activity-log"></a>Категории в журнале действий
Каждое событие в журнале действий имеет определенную категорию, описанную в следующей таблице. Подробные сведения см. в статье [Схема событий журнала действий Azure](activity-log-schema.md). 

| Категория | Description |
|:---|:---|
| Administrative | Содержит запись всех операций создания, обновления, удаления и действий, выполненных с помощью диспетчер ресурсов. К примерам административных событий относятся _Создание виртуальной машины_ и _Удаление группы безопасности сети_.<br><br>Каждое действие, выполняемое пользователем или приложением с помощью диспетчер ресурсов, моделируется как операция с определенным типом ресурса. Если тип операции — _запись_, _Удаление_или _действие_, то записи как запуска, так и успешной или неуспешной работы регистрируются в административной категории. Административные события также включают в себя любые изменения в управлении доступом на основе ролей в подписке. |
| Работоспособность служб | Содержит записи всех инцидентов работоспособности служб, произошедших в Azure. Пример события работоспособности службы _SQL Azure в восточной части США — время простоя_. <br><br>События работоспособности службы бывают шестью: _обязательным действием_, _аварийным восстановлением_, _инцидентом_, _обслуживанием_, _информацией_или _безопасностью_. Эти события создаются только при наличии в подписке ресурса, на который повлияло событие.
| Работоспособность ресурса | Содержит записи о событиях работоспособности ресурсов, произошедших в ресурсах Azure. Пример события Работоспособность ресурсов — _состояние работоспособности виртуальной машины изменено на "недоступно_".<br><br>События Работоспособность ресурсов могут представлять одно из четырех состояний работоспособности: _доступно_, _недоступно_, _снижено_и _неизвестно_. Кроме того, Работоспособность ресурсов события могут классифицироваться как _инициированные платформой_ или _инициированные пользователем_. |
| Предупреждение | Содержит запись активаций для оповещений Azure. Пример события предупреждения —% загруженности _ЦП на myVM за последние 5 минут в течение 80_.|
| Автомасштабирование | Содержит записи всех событий, связанных с операцией механизма автомасштабирования на основе всех параметров автомасштабирования, определенных в подписке. В качестве примера события автомасштабирования не _удалось выполнить действие автоматического масштабирования_. |
| Рекомендация | Содержит события рекомендаций из помощника по Azure. |
| безопасность | Содержит записи всех предупреждений, созданных центром безопасности Azure. Примером события безопасности является _подозрительный файл двойного расширения_. |
| Политика | Содержит записи всех операций действий, выполняемых политикой Azure. К примерам событий политики относятся _Audit_ и _Deny_. Каждое действие, выполняемое Политикой, моделируется как операция для ресурса. |

## <a name="view-change-history"></a>Просмотр журнала изменений

При просмотре журнала действий он может помочь увидеть, какие изменения произошли во время события. Эти сведения можно просмотреть с помощью **журнала изменений**. Выберите событие из журнала действий, который необходимо более подробно изучить. Перейдите на вкладку **История изменений (Предварительная версия)** , чтобы просмотреть все связанные изменения с этим событием.

![Список журнала изменений для события](media/activity-logs-overview/change-history-event.png)

Если с событием связаны какие-либо изменения, вы увидите список изменений, которые можно выбрать. Откроется страница **Журнал изменений (Предварительная версия)** . На этой странице отображаются изменения ресурса. Как видно из следующего примера, мы можем видеть не только изменение размера виртуальной машины, но и то, что предыдущий размер виртуальной машины был до изменения и что он изменил.

![Страница "журнал изменений" с различиями](media/activity-logs-overview/change-history-event-details.png)

Дополнительные сведения о журнале изменений см. в разделе [Получение изменений ресурсов](../../governance/resource-graph/how-to/get-resource-changes.md).






## <a name="powershell"></a>PowerShell
Используйте командлет [Get-AzLog](https://docs.microsoft.com/powershell/module/az.monitor/get-azlog) , чтобы получить журнал действий из PowerShell. Ниже приведены некоторые распространенные примеры.

> [!NOTE]
> `Get-AzLog` предоставляет данные журнала только за 15 дней. Используйте параметр **-MaxEvents** для запроса последних N событий, превышающих 15 дней. Чтобы получить доступ к событиям старше 15 дней, используйте REST API или пакет SDK. Если не указать **StartTime**, то значением **EndTime** по умолчанию будет минус один час. Если не указать **EndTime**, то значением по умолчанию будет текущее время. Все значения времени указаны в формате UTC.


Получение записей журнала, созданных после определенной даты и времени:

```powershell
Get-AzLog -StartTime 2016-03-01T10:30
```

Получение записей журнала между диапазонами дат и времени:

```powershell
Get-AzLog -StartTime 2015-01-01T10:30 -EndTime 2015-01-01T11:30
```

Получение записей журнала для определенной группы ресурсов.

```powershell
Get-AzLog -ResourceGroup 'myrg1'
```

Получение записей журнала от определенного поставщика ресурсов между диапазонами дат и времени:

```powershell
Get-AzLog -ResourceProvider 'Microsoft.Web' -StartTime 2015-01-01T10:30 -EndTime 2015-01-01T11:30
```

Получить записи журнала с конкретным вызывающим объектом:

```powershell
Get-AzLog -Caller 'myname@company.com'
```

Получение последних 1000 событий:

```powershell
Get-AzLog -MaxEvents 1000
```


## <a name="cli"></a>CLI
Чтобы получить журнал действий из интерфейса командной строки, используйте команду [AZ Monitor активности-log](cli-samples.md#view-activity-log-for-a-subscription) . Ниже приведены некоторые распространенные примеры.


Просмотрите все доступные параметры.

```azurecli
az monitor activity-log list -h
```

Получение записей журнала для определенной группы ресурсов.

```azurecli
az monitor activity-log list --resource-group <group name>
```

Получить записи журнала с конкретным вызывающим объектом:

```azurecli
az monitor activity-log list --caller myname@company.com
```

Получение журналов с помощью вызывающей стороны для типа ресурса в диапазоне дат:

```azurecli
az monitor activity-log list --resource-provider Microsoft.Web \
    --caller myname@company.com \
    --start-time 2016-03-08T00:00:00Z \
    --end-time 2016-03-16T00:00:00Z
```

## <a name="rest-api"></a>REST API
Используйте [REST API Azure Monitor](https://docs.microsoft.com/rest/api/monitor/) , чтобы получить журнал действий от клиента RESTful. Ниже приведены некоторые распространенные примеры.

Получить журналы действий с фильтром:

``` HTTP
GET https://management.azure.com/subscriptions/089bd33f-d4ec-47fe-8ba5-0753aa5c5b33/providers/microsoft.insights/eventtypes/management/values?api-version=2015-04-01&$filter=eventTimestamp ge '2018-01-21T20:00:00Z' and eventTimestamp le '2018-01-23T20:00:00Z' and resourceGroupName eq 'MSSupportGroup'
```

Получите журналы действий с фильтром и выберите:

```HTTP
GET https://management.azure.com/subscriptions/089bd33f-d4ec-47fe-8ba5-0753aa5c5b33/providers/microsoft.insights/eventtypes/management/values?api-version=2015-04-01&$filter=eventTimestamp ge '2015-01-21T20:00:00Z' and eventTimestamp le '2015-01-23T20:00:00Z' and resourceGroupName eq 'MSSupportGroup'&$select=eventName,id,resourceGroupName,resourceProviderName,operationName,status,eventTimestamp,correlationId,submissionTimestamp,level
```

Получить журналы действий с помощью SELECT:

```HTTP
GET https://management.azure.com/subscriptions/089bd33f-d4ec-47fe-8ba5-0753aa5c5b33/providers/microsoft.insights/eventtypes/management/values?api-version=2015-04-01&$select=eventName,id,resourceGroupName,resourceProviderName,operationName,status,eventTimestamp,correlationId,submissionTimestamp,level
```

Получить журналы действий без фильтра или выбрать:

```HTTP
GET https://management.azure.com/subscriptions/089bd33f-d4ec-47fe-8ba5-0753aa5c5b33/providers/microsoft.insights/eventtypes/management/values?api-version=2015-04-01
```


## <a name="activity-logs-analytics-monitoring-solution"></a>Решение для мониторинга журналов действий
Решение для мониторинга Log Analytics Azure включает несколько запросов и представлений журнала для анализа записей журнала действий в рабочей области Log Analytics.

### <a name="prerequisites"></a>предварительные требования
Необходимо создать параметр диагностики, чтобы отправить журнал действий для подписки в Log Analytics рабочую область. См. раздел [Получение журналов платформы Azure в log Analytics рабочей области в Azure Monitor](resource-logs-collect-workspace.md).

### <a name="install-the-solution"></a>Установка решения
Используйте процедуру, описанную в разделе [Установка решения для мониторинга](../insights/solutions.md#install-a-monitoring-solution) для установки **аналитика журнала действий** решения. Дополнительная настройка не требуется.

### <a name="use-the-solution"></a>Использование решения
Щелкните **журналы** в верхней части страницы **журнала действий** , чтобы открыть [решение аналитика журнала действий мониторинга](activity-log-collect.md) для подписки. Или откройте все решения мониторинга в меню **мониторинга** подписки в портал Azure. Выберите **больше** в разделе **Insights** , чтобы открыть страницу **обзора** с плитками решения. На плитке **журналы действий Azure** отображается количество записей **AzureActivity** в рабочей области.

![Плитка "Журналы действий Azure"](media/collect-activity-logs/azure-activity-logs-tile.png)


Щелкните плитку **журналы действий Azure** , чтобы открыть представление **журналы действий Azure** . Представление включает в себя элементы визуализации, приведенные в следующей таблице. Каждая часть содержит до 10 элементов, соответствующих критериям этой части за указанный диапазон времени. Можно выполнить запрос журнала, возвращающий все совпадающие записи, щелкнув **Просмотреть все** в нижней части части.

![Панель мониторинга "Журналы действий Azure"](media/collect-activity-logs/activity-log-dash.png)

| Визуализация, часть | Description |
| --- | --- |
| Записи журнала действий Azure | Отображает линейчатую диаграмму с общими суммами записей журнала действий Azure для выбранного диапазона дат и показывает список 10 вызывающих элементов с максимальным числом вызовов. Щелкните линейчатую диаграмму, чтобы выполнить поиск `AzureActivity`. Щелкните вызывающий элемент, чтобы выполнить поиск по журналам, возвращающий все записи журнала действий для этого элемента. |
| Журналы действий по состоянию | Показывает кольцевую диаграмму состояния журнала действий Azure для выбранного диапазона дат и список первых десяти записей состояния. Щелкните диаграмму, чтобы выполнить запрос журнала для `AzureActivity | summarize AggregatedValue = count() by ActivityStatus`. Щелкните элемент состояния, чтобы выполнить поиск по журналам, возвращая все записи журнала действий для этой записи состояния. |
| Журналы действий по ресурсу | Показывает общее число ресурсов с журналами действий и список первых десяти ресурсов с количеством записей для каждого ресурса. Щелкните область итогов, чтобы запустить поиск `AzureActivity | summarize AggregatedValue = count() by Resource` по журналам, который возвратит все доступные для решения ресурсы Azure. Щелкните ресурс, чтобы выполнить запрос журнала, возвращающий все записи о действиях для этого ресурса. |
| Журналы действий по поставщику ресурсов | Показывает общее число поставщиков ресурсов, создающих журналы действий, и список первых десяти. Щелкните область итогов, чтобы выполнить запрос журнала для `AzureActivity | summarize AggregatedValue = count() by ResourceProvider`, в котором отображаются все поставщики ресурсов Azure. Щелкните поставщик ресурсов, чтобы выполнить запрос журнала, возвращающий все записи действий для поставщика. |




## <a name="next-steps"></a>Дальнейшие действия

* [Ознакомьтесь с обзором журналов платформы.](platform-logs-overview.md)
* [Создание параметра диагностики для отправки журналов действий в другие назначения](diagnostic-settings.md)
