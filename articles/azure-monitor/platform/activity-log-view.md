---
title: Просмотр событий в журнале действий Azure (Azure Monitor)
description: Сведения о просмотре журнала действий Azure в Azure Monitor и извлечении данных с помощью PowerShell, CLI и REST API.
author: bwren
services: azure-monitor
ms.topic: conceptual
ms.date: 12/07/2019
ms.author: johnkem
ms.subservice: logs
ms.openlocfilehash: 3327f0bdaff641055cf84ab205d847f0fb73bfe8
ms.sourcegitcommit: 0b80a5802343ea769a91f91a8cdbdf1b67a932d3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/25/2020
ms.locfileid: "83834617"
---
# <a name="view-and-retrieve-azure-activity-log-events"></a>Просмотр и извлечение событий из журнала действий Azure

[Журнал действий Azure](platform-logs-overview.md) предоставляет подробные сведения о событиях на уровне подписки, которые произошли в Azure. В этой статье приводятся подробные сведения о разных методах просмотра и извлечения событий из журнала действий.

## <a name="azure-portal"></a>Портал Azure
Журнал действий для всех ресурсов можно открыть через меню **Монитор** на портале Azure. Журнал действий для конкретного ресурса открывается с помощью элемента **Журнал действий** в меню для этого ресурса.

![Просмотр журнала действий](./media/activity-logs-overview/view-activity-log.png)

События журнала действий можно фильтровать по следующим полям.

* **Временной диапазон**: время начала и окончания событий.
* **Категория**: категория событий, как описано в разделе [Категории в журнале действий](activity-log-view.md#categories-in-the-activity-log).
* **Подписка**: одно или несколько имен подписок Azure.
* **Группа ресурсов.** одна или несколько групп ресурсов в этих подписках.
* **Имя ресурса**: имя определенного ресурса.
* **Тип ресурса**. тип ресурса, например, _Microsoft.Compute/virtualmachines_.
* **Имя операции**: имя операции Azure Resource Manager, например _Microsoft.SQL/servers/Write_.
* **Уровень серьезности**. Уровень серьезности события. Доступные значения: _информационное_, _предупреждение_, _ошибка_, _критическое_.
* **Кем инициировано событие**. пользователь, который выполнил операцию.
* **Открыть поиск**: открывает текстовое поле поиска, с помощью которого можно найти указанную строку во всех полях всех событий.

## <a name="categories-in-the-activity-log"></a>Категории в журнале действий
Каждое событие в журнале действий имеет определенную категорию, как описано в следующей таблице. Подробные сведения см. в статье [Схема событий журнала действий Azure](activity-log-schema.md). 

| Категория | Описание |
|:---|:---|
| Administrative | Содержит записи всех операций создания, обновления, удаления и других действий, которые выполняются через Resource Manager. Административными событиями считаются, например, _создание виртуальной машины_ и _удаление группы безопасности сети_.<br><br>Каждое действие, выполняемое пользователем или приложением с помощью Resource Manager, моделируется как операция с определенным типом ресурса. Если операция относится к типу _Запись_, _Удаление_ или _Действие_, то сведения о запуске, успешном выполнении или сбое такой операции относятся к категории "Административная". К административным событиям также относятся любые изменения в управлении доступом на основе ролей, которые происходят в подписке. |
| Работоспособность служб | Содержит записи всех инцидентов, связанных с работоспособностью службы, которые произошли в Azure. Пример события "Работоспособность служб": _SQL Azure in East US is experiencing downtime_ (SQL Azure в регионе "Восточная часть США" не работает). <br><br>Существует шесть разновидностей событий работоспособности служб: _Action Required_ (Требуется действие), _Assisted Recovery_ (Помощь при восстановлении), _Incident_ (Инцидент), _Maintenance_ (Техническое обслуживание), _Information_ (Информация) и _Security_ (Безопасность). Эти события создаются только при наличии в подписке ресурса, на который может повлиять это событие.
| Работоспособность ресурса | Содержит записи всех событий, связанных с работоспособностью службы, которые произошли с ресурсами Azure. Пример события "Работоспособность ресурсов": _Virtual Machine health status changed to unavailable_ (Состояние работоспособности виртуальной машины изменилось на "недоступно").<br><br>Существует четыре вида событий работоспособности ресурсов: _Available_ (Доступно), _Unavailable_ (Недоступно), _Degraded_ (Понижено) и _Unknown_ (Неизвестно). Кроме того, события работоспособности ресурсов могут классифицироваться по аспекту _PlatformInitiated_ (Инициировано платформой) или _UserInitiated_ (Инициировано пользователем). |
| Предупреждение | Содержит записи активаций для оповещений Azure. Пример события "Предупреждение": _CPU % on myVM has been over 80 for the past 5 minutes_ (Загрузка ЦП на виртуальной машине myVM в течение последних 5 минут превышает 80 %).|
| Автомасштабирование | Содержит записи всех событий, связанных с операциями системы автоматического масштабирования, которые основаны на определенных в подписке параметрах автомасштабирования. Пример события "Автомасштабирование": _Autoscale scale up action failed_ (Не удалось выполнить действие автоматического увеличения масштаба). |
| Рекомендация | Содержит события рекомендаций Помощника по Azure. |
| Безопасность | Содержит записи любых предупреждений, созданных Центром безопасности Azure. Пример события "Безопасность": _Suspicious double extension file executed_ (Выполнен файл с подозрительным двойным расширением). |
| Политика | Содержит записи всех операций действия эффекта, выполняемых Политикой Azure. Примеры событий "Политика": _Audit_ (Аудит) и _Deny_ (Запрет). Каждое действие, выполняемое Политикой, моделируется как операция для ресурса. |

## <a name="view-change-history"></a>Просмотр журнала изменений

При просмотре журнала действий иногда полезно выяснить, какие изменения происходили одновременно с событием. Эти сведения можно просмотреть в **журнале изменений**. Выберите из журнала действий событие, которое вам нужно изучить более подробно. Выберите вкладку **Журнал изменений (предварительная версия)** , чтобы просмотреть все изменения, связанные с этим событием.

![Список журнала изменений для события](media/activity-logs-overview/change-history-event.png)

Если с событием связаны какие-либо изменения, вы увидите здесь список изменений, которые можно выбрать. Это действие открывает страницу **Журнал изменений (предварительная версия)** . На этой странице отображаются все изменения ресурса. Как видно в следующем примере, здесь можно не только увидеть, что изменился размер виртуальной машины, но и узнать ее размер до изменения и после изменения.

![Страница журнала изменений с отображением различий](media/activity-logs-overview/change-history-event-details.png)

Дополнительные сведения о журнале изменений см. в статье [Получение данных об изменении ресурса](../../governance/resource-graph/how-to/get-resource-changes.md).






## <a name="powershell"></a>PowerShell
Чтобы получить журнал действий с помощью PowerShell, используйте командлет [Get-AzLog](https://docs.microsoft.com/powershell/module/az.monitor/get-azlog). Ниже приведено несколько типичных примеров.

> [!NOTE]
> `Get-AzLog` предоставляет данные журнала только за 15 дней. С помощью параметра **-MaxRecord** можно запрашивать N последних событий за 15 дней. Чтобы получить события старше 15 дней, используйте REST API или пакет SDK. Если не указать **StartTime**, то значением **EndTime** по умолчанию будет минус один час. Если не указать **EndTime**, то значением по умолчанию будет текущее время. Все значения времени указаны в формате UTC.


Получение записей журнала, созданных после определенного момента времени.

```powershell
Get-AzLog -StartTime 2016-03-01T10:30
```

Получение записей журнала в пределах диапазона дат и времени.

```powershell
Get-AzLog -StartTime 2015-01-01T10:30 -EndTime 2015-01-01T11:30
```

Получение записей журнала для определенной группы ресурсов.

```powershell
Get-AzLog -ResourceGroup 'myrg1'
```

Получение записей журнала от конкретного поставщика ресурсов в пределах диапазона даты и времени.

```powershell
Get-AzLog -ResourceProvider 'Microsoft.Web' -StartTime 2015-01-01T10:30 -EndTime 2015-01-01T11:30
```

Получение всех записей журнала для конкретной вызывающей стороны.

```powershell
Get-AzLog -Caller 'myname@company.com'
```

Получение последних 1000 событий.

```powershell
Get-AzLog -MaxRecord 1000
```


## <a name="cli"></a>CLI
Чтобы получить журнал действий с помощью интерфейса командной строки, используйте команду [az monitor activity-log](../samples/cli-samples.md#view-activity-log-for-a-subscription). Ниже приведено несколько типичных примеров.


Просмотр всех доступных вариантов.

```azurecli
az monitor activity-log list -h
```

Получение записей журнала для определенной группы ресурсов.

```azurecli
az monitor activity-log list --resource-group <group name>
```

Получение всех записей журнала для конкретной вызывающей стороны.

```azurecli
az monitor activity-log list --caller myname@company.com
```

Получение журналов с указанием вызывающего объекта, типа ресурса и диапазона дат.

```azurecli
az monitor activity-log list --resource-provider Microsoft.Web \
    --caller myname@company.com \
    --start-time 2016-03-08T00:00:00Z \
    --end-time 2016-03-16T00:00:00Z
```

## <a name="rest-api"></a>REST API
Чтобы получить журнал действий из клиента REST, используйте [Azure Monitor REST API](https://docs.microsoft.com/rest/api/monitor/). Ниже приведено несколько типичных примеров.

Получение журналов действий с фильтром.

``` HTTP
GET https://management.azure.com/subscriptions/089bd33f-d4ec-47fe-8ba5-0753aa5c5b33/providers/microsoft.insights/eventtypes/management/values?api-version=2015-04-01&$filter=eventTimestamp ge '2018-01-21T20:00:00Z' and eventTimestamp le '2018-01-23T20:00:00Z' and resourceGroupName eq 'MSSupportGroup'
```

Получение журналов действий с фильтром и выбором.

```HTTP
GET https://management.azure.com/subscriptions/089bd33f-d4ec-47fe-8ba5-0753aa5c5b33/providers/microsoft.insights/eventtypes/management/values?api-version=2015-04-01&$filter=eventTimestamp ge '2015-01-21T20:00:00Z' and eventTimestamp le '2015-01-23T20:00:00Z' and resourceGroupName eq 'MSSupportGroup'&$select=eventName,id,resourceGroupName,resourceProviderName,operationName,status,eventTimestamp,correlationId,submissionTimestamp,level
```

Получение журналов действий с выбором.

```HTTP
GET https://management.azure.com/subscriptions/089bd33f-d4ec-47fe-8ba5-0753aa5c5b33/providers/microsoft.insights/eventtypes/management/values?api-version=2015-04-01&$select=eventName,id,resourceGroupName,resourceProviderName,operationName,status,eventTimestamp,correlationId,submissionTimestamp,level
```

Получение журналов действий без фильтра и выбора.

```HTTP
GET https://management.azure.com/subscriptions/089bd33f-d4ec-47fe-8ba5-0753aa5c5b33/providers/microsoft.insights/eventtypes/management/values?api-version=2015-04-01
```


## <a name="next-steps"></a>Дальнейшие действия

* Ознакомьтесь со статьей [Общие сведения о журналах платформы Azure](platform-logs-overview.md).
* См. статью о [создании параметра диагностики для отправки журналов действий в другие целевые расположения](diagnostic-settings.md).
