---
title: Просмотр событий журналов деятельности Azure в Azure Monitor
description: Просмотр входа в журнал Azure Activity в Azure Monitor и получении с помощью PowerShell, CLI и REST API.
author: bwren
services: azure-monitor
ms.topic: conceptual
ms.date: 12/07/2019
ms.author: johnkem
ms.subservice: logs
ms.openlocfilehash: 9df7593a9fd191d3a734fba5e81fb1aecba08345
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79275052"
---
# <a name="view-and-retrieve-azure-activity-log-events"></a>Просмотр и извлечение событий журнала azure Activity

[В журнале деятельности Azure](platform-logs-overview.md) содержится информация о событиях уровня подписки, произошедших в Azure. В этой статье приводится подробная информация о различных методах просмотра и извлечения событий журнала активности.

## <a name="azure-portal"></a>Портал Azure
Просмотр журнала активности для всех ресурсов из меню **Монитор** на портале Azure. Просмотр журнала активности для определенного ресурса из опции **«Вход активности»** в меню этого ресурса.

![Просмотр журнала о действиях](./media/activity-logs-overview/view-activity-log.png)

Вы можете отфильтровать события журнала активности по следующим полям:

* **Промежуток времени**: Время начала и окончания событий.
* **Категория**: Категория событий, описанная [в категории в журнале активности](activity-log-view.md#categories-in-the-activity-log).
* **Подписка**: Одно или несколько имен подписок Azure.
* **Группа ресурсов**: Одна или несколько групп ресурсов в выбранных подписках.
* **Ресурс (название)**: - Название конкретного ресурса.
* **Тип ресурса**: Тип ресурса, например _Microsoft.Compute/virtualmachines._
* **Название операции** - Название операции Azure Resource Manager, например _Microsoft.S'L/servers/Write_.
* **Тяжесть**: Уровень серьезности события. Доступные значения _являются информационными,_ _Предупреждение_, _Ошибка_, _Критические_.
* **Событие, инициированное**: Пользователь, выполнявший операцию.
* **Откройте поиск**: Откройте поле поиска текста, которое ищет эту строку во всех полях во всех событиях.

## <a name="categories-in-the-activity-log"></a>Категории в журнале активности
Каждое событие в журнале активности имеет определенную категорию, описанную в следующей таблице. Подробные сведения см. в статье [Схема событий журнала действий Azure](activity-log-schema.md). 

| Категория | Описание |
|:---|:---|
| Administrative | Содержит запись всех операций создания, обновления, удаления и действия, выполняемых через диспетчер ресурсов. Примеры административных событий включают _создание виртуальной машины_ и _удаление группы сетевой безопасности._<br><br>Каждое действие, предпринимаемое пользователем или приложением с помощью ресурсного менеджера, моделируется как операция по определенному типу ресурсов. Если тип операции _— «Запись,_ _удаление»_ или _«Действие»,_ записи о начале и успехе или сбое этой операции регистрируются в административной категории. Административные события также включают любые изменения в элементе управления доступом на основе ролей в подписке. |
| Работоспособность служб | Содержит запись любых инцидентов работоспособности службы, произошедших в Azure. Пример события службы работоспособности _S'L Azure в Восточной Части США переживает простои._ <br><br>События службы здоровья приходят в шести разновидностях: _Требуемые действия_, _Вспомогательное восстановление,_ _Инцидент,_ _Техническое обслуживание,_ _Информация,_ или _Безопасность_. Эти события создаются только в том случае, если в подписке есть ресурс, на который повлияет событие.
| Работоспособность ресурса | Содержит запись любых событий работоспособности ресурсов, произошедших с вашими ресурсами Azure. Примером события «Здоровье ресурсов» является _состояние работоспособности виртуальной машины, измененное на недоступное._<br><br>События ресурсного здоровья могут представлять один из четырех состояний работоспособности: _Доступные,_ _Недоступные,_ _Деградированные_и _Неизвестные._ Кроме того, события «Здоровье ресурсов» могут быть классифицированы как _инициированные платформой_ или _инициированные пользователем_события. |
| Предупреждение | Содержит запись активаций для предупреждений Azure. Примером события оповещения является _CPU % на myVM было более 80 за последние 5 минут._|
| Автомасштабирование | Содержит запись любых событий, связанных с работой автоматического двигателя на основе любых параметров автомасштаба, определенных в подписке. Примером события Autoscale является _неудавшийся элемент автоматического масштабирования действия._ |
| Рекомендация | Содержит рекомендательные события от Советника Azure. |
| Безопасность | Содержит запись любых оповещений, генерируемых Центром безопасности Azure. Примером события безопасности является _подозрительный двойной файл расширения выполняется._ |
| Политика | Содержит записи всех операций действия эффекта, выполняемых политикой Azure. Примеры событий политики включают _аудит_ и _отрицание_. Каждое действие, выполняемое Политикой, моделируется как операция для ресурса. |

## <a name="view-change-history"></a>Просмотр журнала изменений

При просмотре журнала активности можно увидеть, какие изменения произошли во время этого события. Вы можете просмотреть эту информацию с **историей изменений**. Выберите событие из журнала активности, в который вы хотите углубиться. Выберите вкладку **«История изменений» (Preview)** для просмотра любых связанных с этим событием изменений.

![Изменение списка истории для события](media/activity-logs-overview/change-history-event.png)

При наличии каких-либо связанных с событием изменений вы увидите список изменений, которые можно выбрать. Это открывает страницу **истории изменений (Preview).** На этой странице вы видите изменения в ресурсе. Как вы можете видеть из следующего примера, мы можем видеть не только, что VM изменил размеры, но то, что предыдущий размер VM был до изменения и то, что он был изменен.

![Изменение страницы истории с различиями](media/activity-logs-overview/change-history-event-details.png)

Чтобы узнать больше об истории изменений, [см.](../../governance/resource-graph/how-to/get-resource-changes.md)






## <a name="powershell"></a>PowerShell
Используйте cmdlet [Get-AzLog](https://docs.microsoft.com/powershell/module/az.monitor/get-azlog) для получения журнала активности от PowerShell. Ниже приведены некоторые общие примеры.

> [!NOTE]
> `Get-AzLog` предоставляет данные журнала только за 15 дней. Используйте параметр **-MaxEvents** для запроса последних событий N за 15 дней. Чтобы получить доступ к событиям старше 15 дней, используйте REST API или SDK. Если не указать **StartTime**, то значением **EndTime** по умолчанию будет минус один час. Если не указать **EndTime**, то значением по умолчанию будет текущее время. Все значения времени указаны в формате UTC.


Получите записи журнала, созданные после определенного времени даты:

```powershell
Get-AzLog -StartTime 2016-03-01T10:30
```

Получите записи в журнале между диапазоном времени даты:

```powershell
Get-AzLog -StartTime 2015-01-01T10:30 -EndTime 2015-01-01T11:30
```

Получение записей журнала для определенной группы ресурсов.

```powershell
Get-AzLog -ResourceGroup 'myrg1'
```

Получите записи журналов от конкретного поставщика ресурсов между диапазоном времени даты:

```powershell
Get-AzLog -ResourceProvider 'Microsoft.Web' -StartTime 2015-01-01T10:30 -EndTime 2015-01-01T11:30
```

Получить записи журнала с конкретным абонентом:

```powershell
Get-AzLog -Caller 'myname@company.com'
```

Получить последние 1000 событий:

```powershell
Get-AzLog -MaxEvents 1000
```


## <a name="cli"></a>CLI
Используйте [журнал активности мониторинга az](cli-samples.md#view-activity-log-for-a-subscription) для получения журнала активности из CLI. Ниже приведены некоторые общие примеры.


Просмотр всех доступных опций.

```azurecli
az monitor activity-log list -h
```

Получение записей журнала для определенной группы ресурсов.

```azurecli
az monitor activity-log list --resource-group <group name>
```

Получить записи журнала с конкретным абонентом:

```azurecli
az monitor activity-log list --caller myname@company.com
```

Получайте журналы по вызывающей абоненту на типресурса в пределах диапазона дат:

```azurecli
az monitor activity-log list --resource-provider Microsoft.Web \
    --caller myname@company.com \
    --start-time 2016-03-08T00:00:00Z \
    --end-time 2016-03-16T00:00:00Z
```

## <a name="rest-api"></a>REST API
Используйте [API Azure Monitor REST](https://docs.microsoft.com/rest/api/monitor/) для получения журнала активности от клиента REST. Ниже приведены некоторые общие примеры.

Получить журналы активности с фильтром:

``` HTTP
GET https://management.azure.com/subscriptions/089bd33f-d4ec-47fe-8ba5-0753aa5c5b33/providers/microsoft.insights/eventtypes/management/values?api-version=2015-04-01&$filter=eventTimestamp ge '2018-01-21T20:00:00Z' and eventTimestamp le '2018-01-23T20:00:00Z' and resourceGroupName eq 'MSSupportGroup'
```

Получить журналы активности с фильтром и выбрать:

```HTTP
GET https://management.azure.com/subscriptions/089bd33f-d4ec-47fe-8ba5-0753aa5c5b33/providers/microsoft.insights/eventtypes/management/values?api-version=2015-04-01&$filter=eventTimestamp ge '2015-01-21T20:00:00Z' and eventTimestamp le '2015-01-23T20:00:00Z' and resourceGroupName eq 'MSSupportGroup'&$select=eventName,id,resourceGroupName,resourceProviderName,operationName,status,eventTimestamp,correlationId,submissionTimestamp,level
```

Получить журналы активности с выбором:

```HTTP
GET https://management.azure.com/subscriptions/089bd33f-d4ec-47fe-8ba5-0753aa5c5b33/providers/microsoft.insights/eventtypes/management/values?api-version=2015-04-01&$select=eventName,id,resourceGroupName,resourceProviderName,operationName,status,eventTimestamp,correlationId,submissionTimestamp,level
```

Получить журналы активности без фильтра или выбрать:

```HTTP
GET https://management.azure.com/subscriptions/089bd33f-d4ec-47fe-8ba5-0753aa5c5b33/providers/microsoft.insights/eventtypes/management/values?api-version=2015-04-01
```


## <a name="activity-logs-analytics-monitoring-solution"></a>Решение мониторинга журналов активности
Решение мониторинга Azure Log Analytics включает в себя несколько запросов журналов и представлений для анализа записей журнала активности в рабочем пространстве журнала Analytics.

### <a name="prerequisites"></a>Предварительные требования
Необходимо создать диагностическую настройку для отправки журнала activity для подписки в рабочее пространство Log Analytics. Смотрите [журналы платформы Collect Azure в рабочем пространстве log Analytics в Azure Monitor.](resource-logs-collect-workspace.md)

### <a name="install-the-solution"></a>Установка решения
Используйте процедуру в [установке решения мониторинга](../insights/solutions.md#install-a-monitoring-solution) для установки решения **Activity Log Analytics.** Дополнительная конфигурация не требуется.

### <a name="use-the-solution"></a>Использование решения
Нажмите журналы в верхней части **страницы** **журнала активности,** чтобы открыть [решение мониторинга журнала активности](activity-log-collect.md) для подписки. Или получите доступ ко всем решениям мониторинга в меню **мониторинга** подписки на портале Azure. Выберите **больше** в разделе **Исследования,** чтобы открыть страницу **Обзор** с плиткой решения. Плитка **журналов активности Azure** отображает количество записей **AzureActivity** в рабочем пространстве.

![Плитка "Журналы действий Azure"](media/collect-activity-logs/azure-activity-logs-tile.png)


Нажмите на плитку **журналов активности Azure,** чтобы открыть представление **журналов активности Azure.** Представление включает в себя части визуализации в следующей таблице. Каждая часть перечисляет до 10 элементов, соответствующих критериям, установленным этими частями для указанного диапазона времени. Вы можете запустить запрос журнала, который возвращает все соответствующие записи, нажав **Смотрите все** в нижней части.

![Панель мониторинга "Журналы действий Azure"](media/collect-activity-logs/activity-log-dash.png)

| Часть визуализации | Описание |
| --- | --- |
| Записи журнала действий Azure | Отображает диаграмму верхней записи записи записи входа в журнал Azure Activity Log для выбранного диапазона дат и отображается список 10 лучших абонентов активности. Щелкните линейчатую диаграмму, чтобы выполнить поиск `AzureActivity`. Нажмите на элемент вызываемого абонента, чтобы выполнить поиск журнала, вернув все записи журнала активности для этого элемента. |
| Журналы действий по состоянию | Отображается диаграмма пончиков для состояния журнала деятельности Azure для выбранного диапазона дат и список записей о статусе десяти лучших. Нажмите на диаграмму, чтобы `AzureActivity | summarize AggregatedValue = count() by ActivityStatus`выполнить запрос журнала для. Нажмите элемент состояния для выполнения поиска журнала, вернув все записи журнала activity Для этой записи состояния. |
| Журналы действий по ресурсу | Отображает общее количество ресурсов с журналами активности и перечисляет десятку ресурсов с рекордным количеством для каждого ресурса. Щелкните область итогов, чтобы запустить поиск `AzureActivity | summarize AggregatedValue = count() by Resource` по журналам, который возвратит все доступные для решения ресурсы Azure. Нажмите на ресурс для выполнения запроса журнала, вернув все записи активности для этого ресурса. |
| Журналы действий по поставщику ресурсов | Отображаетобщее количество поставщиков ресурсов, которые производят журналы активности, и перечисляет первую десятку. Нажмите на общую область для `AzureActivity | summarize AggregatedValue = count() by ResourceProvider`выполнения запроса журнала, который показывает все поставщики ресурсов Azure. Нажмите на поставщика ресурсов, чтобы запустить запрос журнала, вернув все записи активности для поставщика. |




## <a name="next-steps"></a>Дальнейшие действия

* [Читайте обзор журналов платформ](platform-logs-overview.md)
* [Создание диагностических параметров для отправки журналов активности в другие пункты назначения](diagnostic-settings.md)
