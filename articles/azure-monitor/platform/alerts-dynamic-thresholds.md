---
title: Создание оповещений с динамическими пороговыми значениями в Azure Monitor
description: Создание оповещений с использованием динамических пороговых значений на основе машинного обучения
author: yanivlavi
services: azure-monitor
ms.service: azure-monitor
ms.topic: conceptual
ms.date: 04/26/2019
ms.author: yalavi
ms.reviewer: mbullwin
ms.openlocfilehash: 0d6c578186dab9622ce650f535e11d505efcecb3
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "65067621"
---
# <a name="metric-alerts-with-dynamic-thresholds-in-azure-monitor"></a>Оповещения метрик с динамическими порогами в Azure Monitor

Оповещения по метрикам с динамическими порогами — это обнаружение на основе сложного машинного обучения, которое позволяет изучить исторические сведения о поведении метрик, отслеживать закономерности и аномалии, свидетельствующие о потенциальном наличии проблем. Они поддерживают как простой пользовательский интерфейс, так и операции в крупном масштабе, позволяя настроить правила генерации оповещений в полностью автоматическом режиме с помощью API Azure Resource Manager.

Созданное правило генерации оповещений срабатывает только, когда отслеживаемая метрика проявляет нетипичное поведение, то есть выходит за пределы настроенных для нее порогов.

Нам очень важны ваши отзывы, которые вы можете отправить на адрес <azurealertsfeedback@microsoft.com>.

## <a name="why-and-when-is-using-dynamic-condition-type-recommended"></a>Когда и для чего можно использовать динамический тип условия?

1. **Масштабируемая система оповещений**. Правила генерации оповещений на основе динамических порогов позволяют создать точно настроенные пороги для нескольких сотен метрик одновременно. При этом вы сохраните простоту и удобство, определяя правила генерации оповещений только для одной метрики. В пользовательском интерфейсе и в результатах, полученных с помощью API Azure Resource Manager, вам придется контролировать небольшое число правил генерации оповещений. Такой масштабируемый подход особенно эффективен при работе с измерениями метрик или при работе с несколькими ресурсами, например со всеми ресурсами в некоторой подписке. Все это означает существенную экономию времени на создание правил генерации оповещений и управление ими. [Дополнительные сведения о настройке оповещений по метрикам с динамическими порогами с помощью шаблонов](alerts-metric-create-templates.md).

1. **Интеллектуальное распознавание закономерностей в изменении метрик**. Наша уникальная технология машинного обучения позволяет автоматически обнаруживать закономерности в изменении метрик и адаптироваться к периодическим изменениям метрик (ежечасно, ежедневно, еженедельно). Адаптации к поведению метрик и учет тенденции при генерации оповещений избавляет от необходимости назначать "единственно верное" пороговое значение для каждой метрики. Алгоритм машинного обучения, который применяется для создания динамических порогов, специально разработан для устранения слишком шумных (с низкой точностью) и слишком широких (с низкой полнотой) порогов для метрик без очевидных тенденций.

1. **Интуитивно удобная конфигурация**. Динамические пороги позволяют настраивать оповещения по метрикам, используя высокоуровневые концепции, то есть не требуют подробных знаний о предметной области метрик.

## <a name="how-to-configure-alerts-rules-with-dynamic-thresholds"></a>Как правильно настроить оповещения с динамическими порогами?

Вы можете настроить оповещения с динамическими порогами с помощью функции "Оповещения метрики" в Azure Monitor. [Дополнительные сведения о настройке оповещений по метрикам](alerts-metric.md).

## <a name="how-are-the-thresholds-calculated"></a>Как вычисляются пороговые значения?

Динамические пороги постоянно изучают ряд данных метрики и пытаются смоделировать их по нескольким алгоритмам и методам. Она выявляет закономерности в данных, например периодические изменения (ежечасно, ежедневно, еженедельно), и поддерживает обработку шумных метрик (например, использование ЦП или памяти компьютера) и метрик с низкой дисперсией (например, уровень доступности и количество ошибок).

Пороги выбираются так, чтобы любое отклонение от выбранных значений обозначало аномальное поведение метрики.

> [!NOTE]
> Обнаружение сезоне присваивается час, день или неделю интервал. Это означает, что другие шаблоны, такие как шаблон bihourly или могут не определяться semiweekly.

## <a name="what-does-sensitivity-setting-in-dynamic-thresholds-mean"></a>Что означает параметр "Sensitivity" (Чувствительность) в настройке динамических порогов?

Чувствительность порога для оповещения — это концепция высокого уровня, которая обозначает допустимое отклонение от типичного поведения метрики, при превышении которого срабатывает оповещение.
Такой параметр не требует понимания предметной области и сведений о статических пороговых значениях метрики. Доступны следующие варианты.

- Высокий — пороги будут близки к ожидаемому поведению данных метрики. Правило оповещения будут создаваться на наименьшее отклонение, приводит к больше оповещений.
- Средний (используется по умолчанию) — менее строгий и более сбалансированный уровень порога, на котором создается меньше оповещений, чем на высоком уровне.
- Низкий — пороги будут достаточно "вольными", то есть располагаются дальше от ожидаемых значений метрик. Правило генерации оповещений будет активировать только на больших отклонений, приводит к меньшим числом оповещений.

## <a name="what-are-the-operator-setting-options-in-dynamic-thresholds"></a>Что означает параметр "Operator" (Оператор) в настройке динамических порогов?

Одно правило генерации оповещений с динамическими порогами может создавать пороги для верхнего и нижнего пределов на основе поведения конкретной метрики.
Вы можете настроить срабатывание оповещения по одному из следующих трех условий.

- Больше верхнего порогового значения или меньше нижнего порогового значения (по умолчанию)
- Больше верхнего порогового значения
- Меньше нижнего порогового значения

## <a name="what-do-the-advanced-settings-in-dynamic-thresholds-mean"></a>Что можно настроить в дополнительных параметрах для динамических порогов?

**Failing Periods** (Периоды сбоя) — динамические пороги позволяют настроить параметр "Number violations to trigger the alert" (Количество нарушений для срабатывания оповещения), который обозначает минимальное количество отклонений за определенное временное окно, при превышении которого система создаст оповещение (по умолчанию настраиваются четыре отклонения за 20 минут). Пользователь может настроить периоды сбоя и поведение оповещения, изменяя периоды сбоя и временное окно. Эта возможность сокращает количество "шума" от лишних оповещений при кратковременных всплесках. Пример:

Чтобы инициировать оповещение, если проблема возникает непрерывно в течение 20 минут, то есть 4 раза подряд с группировкой по 5-минутному периоду, используйте следующие параметры:

![Настройки периода сбоя для непрерывного нарушения в течение 20 минут, 4 раза подряд по периодам с группировкой по 5 минут](media/alerts-dynamic-thresholds/0008.png)

Чтобы инициировать оповещение при нарушении динамического порогового значения в течение 20 минут за последние 30 минут с 5-минутным периодом, используйте следующие параметры:

![Настройки периода сбоя для нарушения в течение 20 минут за последние 30 минут с группировкой по 5 минут](media/alerts-dynamic-thresholds/0009.png)

**Игнорировать данные до** — пользователи могут определить начальную дату, с которой система начнет вычисление порогов. Такая возможность полезна, например, если ресурс ранее работал в режиме тестирования, и только сейчас переводится в рабочую нагрузку для рабочей среды. Это означает, что поведение любых метрик на стадии тестирования следует исключить из рассмотрения.

## <a name="how-do-you-find-out-why-a-dynamic-thresholds-alert-was-triggered"></a>Как узнать почему было активировано оповещение с динамическими порогами?

Вы можете изучить активированных экземпляров предупреждений в представлении "предупреждения", щелкнув ссылку в электронной почты или текстовое сообщение или браузер, чтобы просмотреть предупреждения просмотреть на портале Azure. [Дополнительные сведения о представлении "предупреждения"](alerts-overview.md#alerts-experience).

Отображает представление "предупреждения":

- Все сведения о метрике в данный момент и сработало оповещение динамическими порогами.
- Диаграмма периода, в котором было активировано оповещение, который включает динамическое пороговые значения, используемые в определенный момент времени.
- Возможность отправить отзыв о динамических пороговые значения предупреждений и оповещений возможности представления, которые можно улучшить будущие обнаружений.

## <a name="will-slow-behavior-change-in-the-metric-trigger-an-alert"></a>Будет ли срабатывать оповещение при медленном изменении метрики?

Скорее всего, нет. Динамические пороговые значения подходят для обнаружения значительных отклонений, а не постепенно накапливающихся проблем.

## <a name="how-much-data-is-used-to-preview-and-then-calculate-thresholds"></a>Какой объем данных используется для анализа и вычисления порогов?

Пороговые значения, отображаемых на диаграмме, перед созданием правила генерации оповещений на основе метрики, вычисляются на основании достаточное количество данных журнала, для которого требуется вычислить час или день сезонным (10 дн.). После создания правила оповещения, динамическими порогами будет использовать все необходимые данные журнала, доступна и будет непрерывно и адаптируемые обеспечивают более высокую точность пороговые значения на основе новых данных. Это означает, что после этого вычисления на диаграмме также будут отображаться еженедельные закономерности.

## <a name="how-much-data-is-needed-to-trigger-an-alert"></a>Какой объем данных необходим для активации оповещения?

Если у вас есть новый ресурс или отсутствующие данные метрик, динамическими порогами не вызовет срабатывания оповещения до трех дней данные доступны для обеспечения точных пороговые значения.

## <a name="dynamic-thresholds-best-practices"></a>Рекомендации по динамическим порогам

Динамические пороги можно применять к любой платформе или пользовательской метрике в Azure Monitor. Они также настроены для метрик распространенных приложений и инфраструктур.
Следующие подразделы являются рекомендациями по настройке оповещений для некоторых из этих метрик с использованием динамических порогов.

### <a name="dynamic-thresholds-on-virtual-machine-cpu-percentage-metrics"></a>Динамические пороги для метрик процента потребления ЦП виртуальной машины

1. На [портале Azure](https://portal.azure.com) выберите **Монитор**. В представлении "Монитор" объединены все параметры мониторинга и все данные.

2. Щелкните **Оповещения** и выберите **+ Новое правило генерации оповещений**.

    > [!TIP]
    > В большинстве колонок ресурсов в меню ресурсов также есть **оповещения** в разделе **Мониторинг**, и вы также можете создать оповещения там.

3. Щелкните **Выбор цели**, в загружаемой контекстной области выберите целевой ресурс, для которого следует создать оповещение. В раскрывающихся списках **Подписка** и **'Virtual Machines' Resource type** (Тип ресурса "Виртуальная машина") найдите ресурс, который вы хотите отслеживать. Вы также можете найти ресурс с помощью панели поиска.

4. После выбора целевого ресурса щелкните **Добавить условие**.

5. Выберите **Процент ЦП**.

6. При необходимости уточните метрику, настроив**период** и **агрегирование**. Не рекомендуется использовать тип агрегирования "Максимальный" для этого типа метрики, так как он не точно представляет реакцию на событие. Статистический порог более подходит для типа агрегирования "Максимальный".

7. Вы увидите график метрики за последние 6 часов. Определите параметры оповещений.
    1. **Тип условия** — выберите параметр "Динамический".
    1. **Чувствительность** — выберите средний или низкий уровень чувствительности, чтобы сократить количество лишних оповещений.
    1. **Оператор** — выберите параметр "Больше чем", если реакция на событие не представляет использование приложения.
    1. **Частота** — рассмотрите возможность снижения частоты на основе влияния оповещений на бизнес.
    1. **Failing Periods** (Периоды сбоя) (расширенный параметр) — окно должно быть не менее 15 минут. Например, если период равен пяти минутам, периоды сбоя должны быть равны трем или большему числу.

8. На диаграмме метрик отображаются вычисленные пороговые значения на основе последних данных.

9. Нажмите кнопку **Done**(Готово).

10. Заполните **сведения об оповещении**, такие как **имя правила генерации оповещений**, **описание** и **серьезность**.

11. Добавьте группу действий в оповещение: выберите имеющуюся или создайте группу действий.

12. Нажмите кнопку **Готово** для сохранения правила генерации оповещений метрики.

> [!NOTE]
> Правила генерации оповещений метрики, созданные на портале, создаются в той же группе ресурсов, что и целевой ресурс.

### <a name="dynamic-thresholds-on-application-insights-http-request-execution-time"></a>Динамические пороги для времени выполнения HTTP-запроса в Application Insights

1. На [портале Azure](https://portal.azure.com) выберите **Монитор**. В представлении "Монитор" объединены все параметры мониторинга и все данные.

2. Щелкните **Оповещения** и выберите **+ Новое правило генерации оповещений**.

    > [!TIP]
    > В большинстве колонок ресурсов в меню ресурсов также есть **оповещения** в разделе **Мониторинг**, и вы также можете создать оповещения там.

3. Щелкните **Выбор цели**, в загружаемой контекстной области выберите целевой ресурс, для которого следует создать оповещение. В раскрывающихся списках **Подписка** и **'Application Insights' Resource type** (Тип ресурса "Application Insights") найдите ресурс, который вы хотите отслеживать. Вы также можете найти ресурс с помощью панели поиска.

4. После выбора целевого ресурса щелкните **Добавить условие**.

5. Выберите **Время выполнения HTTP-запроса**.

6. При необходимости уточните метрику, настроив**период** и **агрегирование**. Не рекомендуется использовать тип агрегирования "Максимальный" для этого типа метрики, так как он не точно представляет реакцию на событие. Статистический порог более подходит для типа агрегирования "Максимальный".

7. Вы увидите график метрики за последние 6 часов. Определите параметры оповещений.
    1. **Тип условия** — выберите параметр "Динамический".
    1. **Оператор** — выберите "Больше чем", чтобы уменьшить количество оповещений при улучшении продолжительности.
    1. **Частота** — рассмотрите возможность снижения частоты на основе влияния оповещений на бизнес.

8. На диаграмме метрик отображаются вычисленные пороговые значения на основе последних данных.

9. Нажмите кнопку **Done**(Готово).

10. Заполните **сведения об оповещении**, такие как **имя правила генерации оповещений**, **описание** и **серьезность**.

11. Добавьте группу действий в оповещение: выберите имеющуюся или создайте группу действий.

12. Нажмите кнопку **Готово** для сохранения правила генерации оповещений метрики.

> [!NOTE]
> Правила генерации оповещений метрики, созданные на портале, создаются в той же группе ресурсов, что и целевой ресурс.
