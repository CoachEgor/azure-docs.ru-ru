---
title: Создание оповещений с динамическими пороговыми значениями в Azure Monitor
description: Создание оповещений с использованием динамических пороговых значений на основе машинного обучения
author: yanivlavi
ms.author: yalavi
ms.topic: conceptual
ms.date: 02/16/2020
ms.openlocfilehash: 1d21c7ed93ac2ce2ab61282707d57fbf43e0b71a
ms.sourcegitcommit: 8dc84e8b04390f39a3c11e9b0eaf3264861fcafc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/13/2020
ms.locfileid: "81261080"
---
# <a name="metric-alerts-with-dynamic-thresholds-in-azure-monitor"></a>Метрические оповещения с динамическими порогами в Azure Monitor

Оповещения по метрикам с динамическими порогами — это обнаружение на основе сложного машинного обучения, которое позволяет изучить исторические сведения о поведении метрик, отслеживать закономерности и аномалии, свидетельствующие о потенциальном наличии проблем. Они поддерживают как простой пользовательский интерфейс, так и операции в крупном масштабе, позволяя настроить правила генерации оповещений в полностью автоматическом режиме с помощью API Azure Resource Manager.

Созданное правило генерации оповещений срабатывает только, когда отслеживаемая метрика проявляет нетипичное поведение, то есть выходит за пределы настроенных для нее порогов.

Нам очень важны ваши отзывы, которые вы можете отправить на адрес <azurealertsfeedback@microsoft.com>.

## <a name="why-and-when-is-using-dynamic-condition-type-recommended"></a>Когда и для чего можно использовать динамический тип условия?

1. **Масштабируемое оповещение** - Динамические правила оповещения порога могут создавать индивидуальные пороговые значения для сотен метрических рядов одновременно, но при этом обеспечивая ту же простоту определения правила оповещения по одной метрике. Они дают вам меньше оповещения для создания и управления. Для создания этого аима менеджера ресурсов Azure можно использовать портал Azure или API-менеджера ресурсов Azure. Масштабируемый подход особенно полезен при работе с метрическими измерениями или при применении к нескольким ресурсам, например ко всем ресурсам подписки.  [Дополнительные сведения о настройке оповещений по метрикам с динамическими порогами с помощью шаблонов](alerts-metric-create-templates.md).

1. **Smart Metric Распознавание шаблонов** - Используя нашу технологию ML, мы можем автоматически обнаруживать метрические закономерности и адаптироваться к метрическим изменениям с течением времени, которые часто могут включать сезонность (часовых / ежедневно / еженедельно). Адаптация к поведению метрик с течением времени и оповещение на основе отклонений от шаблона снимает бремя знания «правильного» порога для каждой метрики. Алгоритм машинного обучения, который применяется для создания динамических порогов, специально разработан для устранения слишком шумных (с низкой точностью) и слишком широких (с низкой полнотой) порогов для метрик без очевидных тенденций.

1. **Интуитивная конфигурация** – Динамические пороги позволяют настраивать метрические оповещения с использованием концепций высокого уровня, облегчая необходимость иметь обширные знания домена о метрике.

## <a name="how-to-configure-alerts-rules-with-dynamic-thresholds"></a>Как правильно настроить оповещения с динамическими порогами?

Вы можете настроить оповещения с динамическими порогами с помощью функции "Оповещения метрики" в Azure Monitor. [Дополнительные сведения о настройке оповещений по метрикам](alerts-metric.md).

## <a name="how-are-the-thresholds-calculated"></a>Как вычисляются пороговые значения?

Динамические пороги постоянно изучают ряд данных метрики и пытаются смоделировать их по нескольким алгоритмам и методам. Она выявляет закономерности в данных, например периодические изменения (ежечасно, ежедневно, еженедельно), и поддерживает обработку шумных метрик (например, использование ЦП или памяти компьютера) и метрик с низкой дисперсией (например, уровень доступности и количество ошибок).

Пороги выбираются так, чтобы любое отклонение от выбранных значений обозначало аномальное поведение метрики.

> [!NOTE]
> Сезонное обнаружение шаблонов устанавливается на часовой, дневной или недельный интервал. Это означает, что другие шаблоны, такие как двухчасовой шаблон или полунедельный, могут не быть обнаружены.

## <a name="what-does-sensitivity-setting-in-dynamic-thresholds-mean"></a>Что означает параметр "Sensitivity" (Чувствительность) в настройке динамических порогов?

Чувствительность порога для оповещения — это концепция высокого уровня, которая обозначает допустимое отклонение от типичного поведения метрики, при превышении которого срабатывает оповещение.
Такой параметр не требует понимания предметной области и сведений о статических пороговых значениях метрики. Доступны следующие варианты.

- Высокий — пороги будут близки к ожидаемому поведению данных метрики. Правило оповещения будет срабатывать при наименьшем отклонении, что приведет к большему количестве предупреждений.
- Средний (используется по умолчанию) — менее строгий и более сбалансированный уровень порога, на котором создается меньше оповещений, чем на высоком уровне.
- Низкий — пороги будут достаточно "вольными", то есть располагаются дальше от ожидаемых значений метрик. Правило оповещения будет вызывать только большие отклонения, что приведет к меньшему количеству предупреждений.

## <a name="what-are-the-operator-setting-options-in-dynamic-thresholds"></a>Что означает параметр "Operator" (Оператор) в настройке динамических порогов?

Одно правило генерации оповещений с динамическими порогами может создавать пороги для верхнего и нижнего пределов на основе поведения конкретной метрики.
Вы можете настроить срабатывание оповещения по одному из следующих трех условий.

- Больше верхнего порогового значения или меньше нижнего порогового значения (по умолчанию)
- Больше верхнего порогового значения
- Меньше нижнего порогового значения

## <a name="what-do-the-advanced-settings-in-dynamic-thresholds-mean"></a>Что можно настроить в дополнительных параметрах для динамических порогов?

**Failing Periods** - Dynamic Thresholds также позволяет настроить "Число нарушений для запуска оповещения", минимальное количество отклонений, необходимых в течение определенного временного окна для системы, чтобы поднять оповещение (окно времени по умолчанию составляет четыре отклонения в 20 минут). Пользователь может настроить периоды сбоя и поведение оповещения, изменяя периоды сбоя и временное окно. Эта возможность сокращает количество "шума" от лишних оповещений при кратковременных всплесках. Пример:

Чтобы инициировать оповещение, если проблема возникает непрерывно в течение 20 минут, то есть 4 раза подряд с группировкой по 5-минутному периоду, используйте следующие параметры:

![Настройки периода сбоя для непрерывного нарушения в течение 20 минут, 4 раза подряд по периодам с группировкой по 5 минут](media/alerts-dynamic-thresholds/0008.png)

Чтобы инициировать оповещение при нарушении динамического порогового значения в течение 20 минут за последние 30 минут с 5-минутным периодом, используйте следующие параметры:

![Настройки периода сбоя для нарушения в течение 20 минут за последние 30 минут с группировкой по 5 минут](media/alerts-dynamic-thresholds/0009.png)

**Игнорировать данные до** — пользователи могут определить начальную дату, с которой система начнет вычисление порогов. Такая возможность полезна, например, если ресурс ранее работал в режиме тестирования, и только сейчас переводится в рабочую нагрузку для рабочей среды. Это означает, что поведение любых метрик на стадии тестирования следует исключить из рассмотрения.

## <a name="how-do-you-find-out-why-a-dynamic-thresholds-alert-was-triggered"></a>Как узнать, почему сработало предупреждение о динамических порогах?

Вы можете изучить случаи срабатывания оповещения в представлении предупреждений, нажав на ссылку в электронной почте или текстовом сообщении, или браузер, чтобы увидеть представление оповещений на портале Azure. [Подробнее о представлении оповещений.](alerts-overview.md#alerts-experience)

Отображается представление оповещения:

- Все метрические детали на данный момент оповещают динамические пороги.
- Диаграмма периода, в котором было срабатывано оповещение, включающая динамические пороги, используемые в данный момент времени.
- Возможность обеспечивать обратную связь с предупреждением dynamic Thresholds и опытом представления оповещений, которые могут улучшить будущие обнаружения.

## <a name="will-slow-behavior-changes-in-the-metric-trigger-an-alert"></a>Срабатывает ли медленные изменения поведения в метрике, вызывая оповещение?

Скорее всего, нет. Динамические пороговые значения подходят для обнаружения значительных отклонений, а не постепенно накапливающихся проблем.

## <a name="how-much-data-is-used-to-preview-and-then-calculate-thresholds"></a>Какой объем данных используется для анализа и вычисления порогов?

При первом создании правила оповещения пороговые значения, появляющиеся на графике, рассчитываются на основе достаточного количества исторических данных для расчета часовых или ежедневных сезонных моделей (10 дней). После создания правила оповещения Dynamic Thresholds использует все необходимые исторические данные, которые доступны, и будет постоянно изучать и адаптировать на основе новых данных, чтобы сделать пороги более точными. Это означает, что после этого расчета диаграмма также будет отображать еженедельные шаблоны.

## <a name="how-much-data-is-needed-to-trigger-an-alert"></a>Сколько данных необходимо для запуска оповещения?

Если у вас есть новый ресурс или отсутствуют метрические данные, динамические пороги не будут вызывать оповещения до трех дней и по крайней мере 30 образцов метрических данных доступны, чтобы обеспечить точные пороги.
Для существующих ресурсов с достаточным количеством метрических данных динамические пороги могут немедленно вызывать оповещения.

## <a name="dynamic-thresholds-best-practices"></a>Рекомендации по динамическим порогам

Динамические пороги можно применять к любой платформе или пользовательской метрике в Azure Monitor. Они также настроены для метрик распространенных приложений и инфраструктур.
Следующие подразделы являются рекомендациями по настройке оповещений для некоторых из этих метрик с использованием динамических порогов.

### <a name="dynamic-thresholds-on-virtual-machine-cpu-percentage-metrics"></a>Динамические пороги для метрик процента потребления ЦП виртуальной машины

1. На [портале Azure](https://portal.azure.com)нажмите на **монитор**. В представлении "Монитор" объединены все параметры мониторинга и все данные.

2. Щелкните **Оповещения** и выберите **+ Новое правило генерации оповещений**.

    > [!TIP]
    > В большинстве колонок ресурсов в меню ресурсов также есть **оповещения** в разделе **Мониторинг**, и вы также можете создать оповещения там.

3. Щелкните **Выбор цели**, в загружаемой контекстной области выберите целевой ресурс, для которого следует создать оповещение. В раскрывающихся списках **Подписка** и **'Virtual Machines' Resource type** (Тип ресурса "Виртуальная машина") найдите ресурс, который вы хотите отслеживать. Вы также можете найти ресурс с помощью панели поиска.

4. После выбора целевого ресурса щелкните **Добавить условие**.

5. Выберите **Процент ЦП**.

6. При необходимости уточните метрику, настроив**период** и **агрегирование**. Не рекомендуется использовать тип агрегирования "Максимальный" для этого типа метрики, так как он не точно представляет реакцию на событие. Статистический порог более подходит для типа агрегирования "Максимальный".

7. Вы увидите график метрики за последние 6 часов. Определите параметры оповещений.
    1. **Тип условия** — выберите параметр "Динамический".
    1. **Чувствительность** — выберите средний или низкий уровень чувствительности, чтобы сократить количество лишних оповещений.
    1. **Оператор** — выберите параметр "Больше чем", если реакция на событие не представляет использование приложения.
    1. **Частота** — рассмотрите возможность снижения частоты на основе влияния оповещений на бизнес.
    1. **Failing Periods** (Периоды сбоя) (расширенный параметр) — окно должно быть не менее 15 минут. Например, если период равен пяти минутам, периоды сбоя должны быть равны трем или большему числу.

8. На диаграмме метрик отображаются вычисленные пороговые значения на основе последних данных.

9. Нажмите кнопку **Готово**.

10. Заполните **сведения об оповещении**, такие как **имя правила генерации оповещений**, **описание** и **серьезность**.

11. Добавьте группу действий в оповещение: выберите имеющуюся или создайте группу действий.

12. Нажмите кнопку **Готово** для сохранения правила генерации оповещений метрики.

> [!NOTE]
> Правила генерации оповещений метрики, созданные на портале, создаются в той же группе ресурсов, что и целевой ресурс.

### <a name="dynamic-thresholds-on-application-insights-http-request-execution-time"></a>Динамические пороги для времени выполнения HTTP-запроса в Application Insights

1. На [портале Azure](https://portal.azure.com)нажмите на **монитор**. В представлении "Монитор" объединены все параметры мониторинга и все данные.

2. Щелкните **Оповещения** и выберите **+ Новое правило генерации оповещений**.

    > [!TIP]
    > В большинстве колонок ресурсов в меню ресурсов также есть **оповещения** в разделе **Мониторинг**, и вы также можете создать оповещения там.

3. Щелкните **Выбор цели**, в загружаемой контекстной области выберите целевой ресурс, для которого следует создать оповещение. В раскрывающихся списках **Подписка** и **'Application Insights' Resource type** (Тип ресурса "Application Insights") найдите ресурс, который вы хотите отслеживать. Вы также можете найти ресурс с помощью панели поиска.

4. После выбора целевого ресурса щелкните **Добавить условие**.

5. Выберите **Время выполнения HTTP-запроса**.

6. При необходимости уточните метрику, настроив**период** и **агрегирование**. Не рекомендуется использовать тип агрегирования "Максимальный" для этого типа метрики, так как он не точно представляет реакцию на событие. Статистический порог более подходит для типа агрегирования "Максимальный".

7. Вы увидите график метрики за последние 6 часов. Определите параметры оповещений.
    1. **Тип условия** — выберите параметр "Динамический".
    1. **Оператор** — выберите "Больше чем", чтобы уменьшить количество оповещений при улучшении продолжительности.
    1. **Частота** — рассмотрите возможность снижения частоты на основе влияния оповещений на бизнес.

8. На диаграмме метрик отображаются вычисленные пороговые значения на основе последних данных.

9. Нажмите кнопку **Готово**.

10. Заполните **сведения об оповещении**, такие как **имя правила генерации оповещений**, **описание** и **серьезность**.

11. Добавьте группу действий в оповещение: выберите имеющуюся или создайте группу действий.

12. Нажмите кнопку **Готово** для сохранения правила генерации оповещений метрики.

> [!NOTE]
> Правила генерации оповещений метрики, созданные на портале, создаются в той же группе ресурсов, что и целевой ресурс.

## <a name="interpreting-dynamic-threshold-charts"></a>Интерпретация динамических пороговых диаграмм

Ниже приведена диаграмма, показывающая метрику, ее динамические пороговые пределы и некоторые оповещения, выпущенные, когда значение находилось за пределами допустимых пороговых значений.

![Подробнее о том, как настроить метрические оповещения](media/alerts-dynamic-thresholds/threshold-picture-8bit.png)

Используйте следующую информацию для интерпретации предыдущей диаграммы.

- **Голубая линия** - фактическая измеренная метрика с течением времени.
- **Голубая затенена область** - показывает допустимый диапазон для метрики. До тех пор, пока значения метрики остаются в пределах этого диапазона, оповещения не будет.
- **Синие точки** - Если вы оставили нажать на часть диаграммы, а затем нависнуть над синей линией, вы увидите, что под курсором появляется синяя точка, показывающая индивидуальное агрегированное метрическое значение.
- **Всплывающее окно с синей точкой** - показывает измеренное метрическое значение (голубая точка) и верхние и нижние значения допустимого диапазона.  
- **Красная точка с черным кругом** - отображает первое метрическое значение из допустимого диапазона. Это значение, которое запускает метеолерическое оповещение и помещает его в активное состояние.
- **Красные точки**- Укажите дополнительные измеренные значения за пределами допустимого диапазона. Они не будут увольнять дополнительные метрические оповещения, но оповещение остается в активном.
- **Красная область** - Отображает время, когда значение метрики находилось за пределами допустимого диапазона. Предупреждение остается в активном состоянии до тех пор, пока последующие измеренные значения находятся вне допустимого диапазона, но новые предупреждения не выходят.
- **Конец красной области** - Когда синяя линия возвращается внутри допустимых значений, красная область останавливается, и измеренная линия значения становится синей. Состояние метрика рвения, выпущенного во время красной точки с черным контуром, будет решено. 
