---
title: Расширенные возможности обозревателя метрик Azure
description: Дополнительные сведения о дополнительных возможностях Azure Monitor обозреватель метрик
author: vgorbenko
services: azure-monitor
ms.topic: conceptual
ms.date: 01/22/2019
ms.author: vitalyg
ms.subservice: metrics
ms.openlocfilehash: e6ff33b6a23cb85649a8811a8bef27ab455ab9e6
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "82980904"
---
# <a name="advanced-features-of-azure-metrics-explorer"></a>Расширенные возможности обозревателя метрик Azure

> [!NOTE]
> В этой статье предполагается, что вы знакомы с основными функциями обозреватель метрик. Если вы являетесь новым пользователем и хотите узнать, как создать свою первую диаграмму метрики, см. статью [Приступая к работе с Azure обозреватель метрик](metrics-getting-started.md).

## <a name="metrics-in-azure"></a>Метрики в Azure

[Метрики в Azure Monitor](data-platform-metrics.md) — это ряд измеренных значений и счетчиков, которые собираются и сохраняются в течение определенного времени. Существуют стандартные метрики (или "метрики платформы") и настраиваемые метрики. Стандартные метрики предоставляет платформа Azure. Стандартные метрики показывают работоспособность и статистику потребления ресурсов Azure. В то время как пользовательские метрики отправляются в Azure приложениями с помощью [Application Insights API для пользовательских событий и метрик](https://docs.microsoft.com/azure/application-insights/app-insights-api-custom-events-metrics), [расширения Windows система диагностики Azure (WAD)](https://docs.microsoft.com/azure/azure-monitor/platform/diagnostics-extension-overview)или [Azure Monitor REST API](https://docs.microsoft.com/azure/azure-monitor/platform/metrics-store-custom-rest-api).

## <a name="create-views-with-multiple-metrics-and-charts"></a>Создание представлений с несколькими метриками и диаграммами

Можно создавать диаграммы, отображающие несколько линий метрик, или одновременно отображать несколько диаграмм метрик. Эта функция позволяет выполнять следующие задачи:

- Сопоставьте связанные метрики на том же графе, чтобы увидеть, как одно значение связано с другим
- Отображение метрик с разными единицами измерения в близком близком отношении
- визуальное агрегирование и сравнение метрик из нескольких ресурсов

Например, если у вас есть 5 учетных записей хранения и вы хотите понять, сколько общего пространства потребляется между ними, можно создать диаграмму с областями с накоплением, в которой будет показана отдельная и сумма всех значений в определенные моменты времени.

### <a name="multiple-metrics-on-the-same-chart"></a>Несколько метрик на одной диаграмме

Сначала [Создайте новую диаграмму](metrics-getting-started.md#create-your-first-metric-chart). Щелкните **Добавить метрику** и повторите шаги, чтобы добавить еще одну метрику на ту же диаграмму.

   > [!NOTE]
   > Как правило, метрики с различными единицами измерения (например, миллисекундами и килобайтами) или значительно отличающимися масштабами на одной диаграмме не требуются. Вместо этого следует использовать несколько диаграмм. Нажмите кнопку "Добавить диаграмму", чтобы создать несколько диаграмм в обозревателе метрик.

### <a name="multiple-charts"></a>Несколько диаграмм

Щелкните **Добавить диаграмму** и создайте другую диаграмму с другой метрикой.

### <a name="order-or-delete-multiple-charts"></a>Упорядочивание или удаление нескольких диаграмм

Чтобы заказать или удалить несколько диаграмм, щелкните значок с многоточием ( **...** ), чтобы открыть меню диаграммы и выбрать соответствующий пункт меню **вверх, вниз**или **Удалить**. **Move down**

## <a name="changing-aggregation"></a>Изменение статистической обработки

При добавлении метрики в диаграмму обозреватель метрик автоматически выбирает агрегирование по умолчанию. Значение по умолчанию имеет смысл в основных сценариях, но для получения дополнительных сведений о метрике можно использовать другую статистическую обработку. Для просмотра различных агрегатов на диаграмме необходимо понимать, как обозреватель метрик обрабатывает их. 

Метрики — это ряд измерений (или «значений метрик»), захваченных за период времени. При построении диаграммы значения выбранной метрики обрабатываются отдельно по *времени*. Размер временных граней можно выбрать [с помощью панели выбора времени обозреватель метрик](metrics-getting-started.md#select-a-time-range). Если вы не сделаете явно выбранный промежуток времени, то гранулярность времени будет автоматически выбрана в зависимости от выбранного в данный момент диапазона времени. После определения Грана времени значения метрик, которые были захвачены в течение каждого интервала времени, объединяются и помещаются в диаграмму — по одному значению на один момент времени.

Например, предположим, что на диаграмме показана метрика **времени ответа сервера** , использующая **Среднее** агрегирование за **последние 24 часа** .

- Если для интервала времени задано значение 30 минут, Диаграмма выводится из 48 агрегированных точек данных (например, график соединяет 48 точек в области построения диаграммы). То есть 24 часа x 2 точек на час. Каждая точка данных представляет собой *среднее значение* всех захватывается времени ответа для запросов сервера, произошедших в течение каждого из соответствующих 30 минут периодов времени.
- Если вы переключаете гранулярность времени на 15 минут, вы получаете 96 агрегированных точек.  То есть 24 часа x 4 точек на час.

В обозревателе метрик доступны пять типов статистической обработки статистики: **Sum**, **Count**, **min**, **Max**и **Average**. Статистическое вычисление **сумм** иногда называют **общим** агрегатом. Для многих метрик обозреватель метрик будет скрывать агрегаты, которые совершенно несущественные и не могут использоваться.

- **Sum** — сумма всех значений, захваченных за интервал агрегирования
- **Count** — количество измерений, захваченных за интервал агрегирования. Обратите внимание, что **Счетчик** будет равен **сумме** в случае, когда метрика всегда захватывается значением 1. Это часто происходит, когда метрика отслеживает количество отдельных событий, и каждое измерение представляет одно событие (т. е. код срабатывает для записи метрики каждый раз, когда поступает новый запрос).
- **Среднее** — среднее значение метрики, захваченное за интервал агрегирования
- **Min** — наименьшее значение, захваченное за интервал агрегирования
- **Max** — наибольшее значение, захваченное за интервал агрегирования

## <a name="apply-filters-to-charts"></a>Применение фильтров к диаграммам

К диаграммам, на которых показаны метрики с измерениями, можно применить фильтры. Например, если метрика "Счетчик транзакций" имеет измерение "Тип ответа", которое указывает, успешен ли ответ от транзакции, тогда при фильтрации по этому измерению будет создана диаграмма только для успешных (или только неудачных) транзакций. 

### <a name="to-add-a-filter"></a>Добавление фильтра

1. Выберите **Добавить фильтр** над диаграммой.

2. Выберите измерение (свойство), которое необходимо отфильтровать.

   ![изображение метрики](./media/metrics-charts/00006.png)

3. Выберите значения измерения, которые нужно включить при создании диаграммы (в этом примере показаны отфильтрованные успешные транзакции с хранилищем):

   ![изображение метрики](./media/metrics-charts/00007.png)

4. Выбрав значения фильтра, щелкните за пределами средства выбора фильтра, чтобы закрыть его. Теперь на диаграмме показано, сколько транзакций с хранилищем не удалось выполнить:

   ![изображение метрики](./media/metrics-charts/00008.png)

5. Шаги 1–4 можно повторить, чтобы применить несколько фильтров к одной диаграмме.



## <a name="apply-splitting-to-a-chart"></a>Применение разделения к диаграмме

Метрики можно разделить по измерениям, чтобы визуализировать сравнения между различными сегментами метрики и идентифицировать внешние сегменты измерения.

### <a name="apply-splitting"></a>Применение разделения

1. Щелкните **Применить разделение** над диаграммой.
 
   > [!NOTE]
   > Разделение не может использоваться с диаграммами, имеющими несколько метрик. Кроме того, можно использовать несколько фильтров, но только одно разделенное измерение применяется к одной диаграмме.

2. Выберите измерения, по которому необходимо сегментировать диаграммы:

   ![изображение метрики](./media/metrics-charts/00010.png)

   Теперь на диаграмме отображаются несколько строк, по одной для каждого сегмента измерения:

   ![изображение метрики](./media/metrics-charts/00012.png)

3. Щелкните за пределами **селектора группирования**, чтобы закрыть его.

   > [!NOTE]
   > С помощью фильтрации и разделения одного измерения можно скрыть сегменты, которые не имеют значения для сценария, и облегчить анализ диаграмм.

## <a name="lock-boundaries-of-chart-y-axis"></a>Фиксирование границ диаграммы по оси Y

Фиксирование диапазона оси Y приобретает значение, если в диаграмме отображаются небольшие колебания больших значений. 

Например, когда объем успешных запросов снижается с 99,99 % до 99,5 %, это может представлять собой значительное снижение качества обслуживания. Тем не менее будет трудно или даже невозможно заметить маленькое колебание числового значения, если заданы параметры диаграммы по умолчанию. В этом случае можно зафиксировать самую нижнюю границу диаграммы на уровне 99 %, в результате чего небольшой спад будет более очевидным. 

Другой пример — колебание объема доступной памяти, когда значение технически никогда не достигнет значения 0. Благодаря фиксированию диапазона на уровне большего значения легче обнаружить уменьшение объема доступной памяти. 

Для управления диапазоном оси Y используйте меню диаграммы "..." и выберите **Изменить диаграмму**, чтобы получить доступ к дополнительным параметрам диаграммы. Измените значения в разделе "Диапазон оси Y" или нажмите кнопку **Автоматически**, чтобы вернуть значения по умолчанию.

![изображение метрики](./media/metrics-charts/00014-manually-set-granularity.png)

> [!WARNING]
> При фиксировании границ оси Y диаграмм, отслеживающих различные количества или суммы за период времени (и таким образом использующих количество, сумму, минимальные или максимальные агрегирования) обычно требуется указать степень детализации фиксированного времени, а не полагаться на автоматические значения по умолчанию. Это необходимо, так как значения на диаграммах изменяются из-за автоматического изменения степени детализации, когда пользователь изменяет размер окна браузера или переходит от одного разрешения экрана к другому. Полученное изменение степени детализации времени влияет на внешний вид диаграммы таким образом, что текущее выделение диапазона оси Y становится недопустимым.

## <a name="change-colors-of-chart-lines"></a>Изменить цвета линий диаграммы

После настройки диаграмм линии диаграммы автоматически назначаются цветом из палитры по умолчанию. Эти цвета можно изменить.

Чтобы изменить цвет линии диаграммы, щелкните цветную полосу в условных обозначениях, соответствующих диаграмме. Откроется диалоговое окно Палитра цветов. Используйте палитру цветов для настройки цвета линии.

После настройки цветов диаграммы они останутся таким образом при закреплении диаграммы на панели мониторинга. В следующем разделе показано, как закрепить диаграмму.

![изображение метрики](./media/metrics-charts/018.png)

## <a name="pin-charts-to-dashboards"></a>Закрепление диаграмм на панелях мониторинга

После настройки диаграмм их можно добавить на панели мониторинга, чтобы их можно было просмотреть повторно, возможно, в контексте другой телеметрии мониторинга или совместно с другими участниками команды.

Чтобы закрепить настроенную диаграмму на панели мониторинга, сделайте следующее:

После настройки диаграммы щелкните меню **Chart Actions** (Действия на диаграмме) в правом верхнем углу диаграммы и выберите **Закрепить на панели мониторинга**.

![изображение метрики](./media/metrics-charts/00013.png)

## <a name="create-alert-rules"></a>Создание правил генерации оповещений

Условия, которые вы задали для визуализации метрик, можно использовать как основу для правила генерации оповещений на основе метрик. В новом правиле генерации оповещений будет указан целевой ресурс, метрика, разделение и измерения фильтров из диаграммы. Вы сможете изменить эти параметры позднее в области создания правила генерации оповещений.

### <a name="to-create-a-new-alert-rule-click-new-alert-rule"></a>Чтобы создать правило генерации оповещений, щелкните **Новое правило генерации оповещений**.

![Кнопка "Создать правило генерации оповещений", выделенная красным цветом](./media/metrics-charts/015.png)

Откроется панель создания правила генерации оповещений с измерениями базовой метрики из предварительно заполненной диаграммы, чтобы вам было проще создавать настраиваемые правила генерации оповещений.

![Создать правило генерации оповещений](./media/metrics-charts/016.png)

Ознакомьтесь с этой [статьей](alerts-metric.md), чтобы узнать больше о настройке оповещений на основе метрик.

## <a name="troubleshooting"></a>Устранение неполадок

*Данные не отображаются на диаграмме.*

* Фильтры применяются ко всем диаграммам на панели. Убедитесь, что, рассматривая какую-либо диаграмму, вы не задали фильтр, исключающий все данные на другой диаграмме.

* Если вы хотите задать разные фильтры для различных диаграмм, создайте их на разных колонках и по отдельности сохраните в избранное. Если необходимо, вы можете закрепить их на панели мониторинга, чтобы их можно было видеть вместе.

* Если сегментировать диаграмму по свойству, которое не определено в метрике, то на диаграмме ничего не отобразится. Попробуйте очистить сегментацию (разбиение) или выберите другое свойство.

## <a name="next-steps"></a>Дальнейшие шаги

  Дополнительные сведения о рекомендациях по созданию готовых к работе панелей мониторинга с метриками см. в статье [Create custom KPI dashboards using Azure Application Insights](https://docs.microsoft.com/azure/application-insights/app-insights-tutorial-dashboards) (Создание пользовательских панелей мониторинга KPI с помощью Azure Application Insights).

