---
title: Правила действий для оповещений Azure Monitor
description: Понимание того, что такое правила действий в Azure Monitor и как настроить и управлять ими.
author: anantr
services: azure-monitor
ms.service: azure-monitor
ms.topic: conceptual
ms.date: 04/25/2019
ms.author: anantr
ms.subservice: alerts
ms.openlocfilehash: df069ee398ea2937f03765b10576061b5e541390
ms.sourcegitcommit: cf438e4b4e351b64fd0320bf17cc02489e61406a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/08/2019
ms.locfileid: "67656723"
---
# <a name="action-rules-preview"></a>Правила действий (Предварительная версия)

Действие правила помогут определить или подавлять действия в любой области диспетчера ресурсов Azure (подписки Azure, группу ресурсов или целевой ресурс). Они имеют различные фильтры, которые справки сужения списка определенное подмножество экземпляров предупреждения, которые собираетесь работать.

## <a name="why-and-when-should-you-use-action-rules"></a>Когда и почему следует использовать действие правила?

### <a name="suppression-of-alerts"></a>Подавление предупреждений

Существует множество сценариев, где это целесообразно запретить появление уведомления, которые создают оповещения. Эти сценарии варьируются от подавления во время запланированного обслуживания до подавления нерабочее время. Например, группа, ответственная за **ContosoVM** хочет подавлять уведомления об оповещениях для предстоящих выходных дней, так как **ContosoVM** запланированного обслуживания. 

Несмотря на то, что команда можно отключить каждого правила генерации оповещений, который настроен на **ContosoVM** вручную (и включите ее снова после обслуживания), это не простой процесс. Действие правила позволяют задать Подавление предупреждений в нужном масштабе с возможностью гибкого Настройка периода подавления. В предыдущем примере, команда может определить одно правило действия на **ContosoVM** , подавляет все уведомления об оповещениях для выходных дней.


### <a name="actions-at-scale"></a>Действия в нужном масштабе

Несмотря на то, что правила генерации оповещений помогают определить группу действий, которое активируется, когда оповещение создается, клиенты часто имеют общей группы действий по их объем операций. Например, группа отвечает за группу ресурсов **ContosoRG** будет возможно, определяете группу действий для всех правил генерации оповещений, определенные в **ContosoRG**. 

Действие правила помогают упростить этот процесс. Путем определения действий в масштабе, группы действий можно активировать оповещение, которое создается в заданной области. В предыдущем примере, команда может определить одно правило действия на **ContosoRG** наступлении той же группе действие для всех предупреждений, создаваемых внутри него.

> [!NOTE]
> В настоящее время действие правила не применяются к оповещения о работоспособности служб Azure.

## <a name="configuring-an-action-rule"></a>Настройка правила действия

Функцию можно открыть, выбрав **Управление действиями** из **оповещения** целевая страница в Azure Monitor. Выберите **правилах действий (Предварительная версия)** . Перейдите к правилам, выбрав **правилах действий (Предварительная версия)** из панели мониторинга целевой страницы для оповещений.

![Действие правила на целевой странице Azure Monitor](media/alerts-action-rules/action-rules-landing-page.png)

Выберите **+ новое правило действия**. 

![Добавить новое правило действия](media/alerts-action-rules/action-rules-new-rule.png)

Кроме того можно создать правила действия, при настройке правила генерации оповещений.

![Добавить новое правило действия](media/alerts-action-rules/action-rules-alert-rule.png)

Теперь вы увидите страница flow для создания правил для действия. Настройте следующие элементы: 

![Новый поток для создания правила действие](media/alerts-action-rules/action-rules-new-rule-creation-flow.png)

### <a name="scope"></a>`Scope`

Сначала выберите область (подписки Azure, группу ресурсов или целевой ресурс). Вы можете также выбора нескольких сочетание областей в одной подписке.

![Область действия правила](media/alerts-action-rules/action-rules-new-rule-creation-flow-scope.png)

### <a name="filter-criteria"></a>условия фильтра

Кроме того, можно определить фильтры, чтобы сузить их вниз с некоторыми из оповещения. 

Доступны следующие фильтры: 

* **Уровень серьезности**. Параметр, чтобы выбрать один или несколько уровней серьезности предупреждения. **Серьезность = Sev1** означает, что для всех предупреждений значение Sev1 применимо действия правила.
* **Мониторинг службы**: Фильтр на основе исходной службы мониторинга. Кроме того, этот фильтр выбора нескольких. Например **мониторинг службы = «Application Insights»** означает, что действие правило применяется для всех оповещений на основе Application Insights.
* **Тип ресурса**:  Фильтр, основанный на определенных типов ресурсов. Кроме того, этот фильтр выбора нескольких. Например **тип ресурса = «Виртуальные машины»** означает, что действие правило применяется для всех виртуальных машин.
* **Идентификатор правила оповещений**: Позволяет выполнять фильтрацию определенные правила оповещений с помощью Resource Manager идентификатор правила генерации оповещений.
* **Мониторинг условие**:  Фильтр для экземпляров предупреждений с помощью **Fired** или **разрешено** как условие монитора.
* **Описание** (Регулярное выражение) регулярное выражение, определяет соответствие строку описания, определенных как часть правила генерации оповещений. Например **описание содержит 'prod'** будет соответствовать все оповещения, которые содержат строку «prod» в соответствии с описаниями.
* **Контекст (полезные данные) предупреждения**: Регулярное выражение, определяющий строку соответствие контекст предупреждения поля полезных данных этого предупреждения. Например **предупреждений «компьютер-01"содержит контекст (полезные данные)** будет соответствовать все предупреждения, полезные данные содержат строку «Компьютер-01».

Эти фильтры применяются в сочетании друг с другом. Например, если задать **тип ресурса "= виртуальных машин** и **серьезности" = Sev0**, то фильтрации для всех **Sev0** оповещения на ваших виртуальных машинах. 

![Фильтры действий правила](media/alerts-action-rules/action-rules-new-rule-creation-flow-filters.png)

### <a name="suppression-or-action-group-configuration"></a>Конфигурация группы подавления или действие

Далее настройте действия правила для подавления предупреждений или поддержка группы действий. Невозможно выбрать оба. Конфигурация действует на всех экземплярах предупреждений, которые соответствуют ранее заданной области и фильтры.

#### <a name="suppression"></a>Подавление

При выборе **подавления**, задать длительность для подавления действий и уведомлений. Выберите один из следующих параметров.
* **Коди (всегда)** : Подавляет все уведомления неопределенное время.
* **В запланированное время**: Отключает уведомления в течение ограниченного промежутка.
* **С помощью повторение**: Отключает уведомления по расписанию ежедневно, еженедельно или ежемесячно.

![Действие правила подавления](media/alerts-action-rules/action-rules-new-rule-creation-flow-suppression.png)

#### <a name="action-group"></a>Группа действий

При выборе **группы действий** добавить существующую группу действий в переключатель, или создайте новую. 

> [!NOTE]
> Можно связать только одну группу действий с правила действия.

![Добавьте или создайте новое правило действия, выбрав группу действий](media/alerts-action-rules/action-rules-new-rule-creation-flow-action-group.png)

### <a name="action-rule-details"></a>Действие сведения о правиле

Наконец настройте следующие сведения для действия правила:
* ИМЯ
* Группа ресурсов, в котором будет сохранен
* Описание 

## <a name="example-scenarios"></a>Примеры сценариев

### <a name="scenario-1-suppression-of-alerts-based-on-severity"></a>Сценарий 1. Подавление предупреждений, в зависимости от уровня серьезности

Компания Contoso хочет подавлять уведомления для всех предупреждений Sev4 на всех виртуальных машинах в подписке **ContosoSub** каждое воскресенье.

**Решение.** Создание правила действия с:
* Область = **ContosoSub**
* Фильтры
    * Серьезность = **Sev4**
    * Тип ресурса = **виртуальных машин**
* Подавление с повторением присвоено каждую неделю, и **суббота** и **воскресенье** проверки

### <a name="scenario-2-suppression-of-alerts-based-on-alert-context-payload"></a>Сценарий 2. Подавление предупреждений, исходя из контекста предупреждения (полезные данные)

Компания Contoso хочет подавлять уведомления для всех журналов, оповещения, созданные для **компьютера-01** в **ContosoSub** бесконечно, проходит через обслуживания.

**Решение.** Создание правила действия с:
* Область = **ContosoSub**
* Фильтры
    * Мониторинг службы = **Log Analytics**
    * Предупреждения, контекст (полезные данные) содержит **компьютера-01**
* Значение подавления **Коди (всегда)**

### <a name="scenario-3-action-group-defined-at-a-resource-group"></a>Сценарий 3. Группу действий, определенную в группу ресурсов

Компания Contoso определила [оповещения метрики на уровне подписки](https://docs.microsoft.com/azure/azure-monitor/platform/alerts-metric-overview#monitoring-at-scale-using-metric-alerts-in-azure-monitor). Но он хочет определяют действия, которые активируют специально для предупреждений, созданных из группы ресурсов **ContosoRG**.

**Решение.** Создание правила действия с:
* Область = **ContosoRG**
* Ни одного фильтра
* Группа действий присвоено **ContosoActionGroup**

> [!NOTE]
> *Группы действий, определенных в правилах действий и правил генерации оповещений работать независимо, без дедупликации.* В сценарии, описанном более ранней версии, если группа действий, определен для правила генерации оповещений, она инициирует совместно с группой действий, определенных в правиле действие. 

## <a name="managing-your-action-rules"></a>Управление правилами ваши действия

Можно просматривать и управлять правилами действие в представлении списка.

![Представление списка действие правила](media/alerts-action-rules/action-rules-list-view.png)

На этой странице можно включить, отключить или удалить действие правила в масштабе, установив флажок рядом с ними. При выборе правила действия откроется его страница конфигурации. Страницы поможет вам обновить определение действия правила, а также включить или отключить его.

## <a name="best-practices"></a>Рекомендации

Оповещения, созданные с помощью журналов [число результатов](alerts-unified-log.md) параметр создать один экземпляр предупреждения об изменении с помощью результат поиска, целиком (который может распространяться на нескольких компьютерах). В этом случае, если используются правила действия **контекст предупреждения (полезные данные)** фильтр, он обрабатывает экземпляр предупреждения до тех пор, пока совпадения. В сценарии 2 было сказано ранее, если результаты поиска для созданного журнала оповещение содержит оба **компьютера-01** и **компьютера-02**, подавляются все уведомления. Нет никакого оповещения, созданные для **компьютера-02** вообще.

![Действие правила и оповещения журналов (количество результатов)](media/alerts-action-rules/action-rules-log-alert-number-of-results.png)

Лучше всего использовать оповещений журнала с помощью действия правил, создание оповещений журнала с [измерение метрик](alerts-unified-log.md) параметр. Этим параметром, на основе его поля для определенной группы создаются отдельные экземпляры предупреждений об изменении. Затем в сценарии 2 отдельных экземпляров предупреждений создаются для **компьютера-01** и **компьютера-02**. Из-за правило действия, описанные в сценарии только уведомления для **компьютера-01** подавляется. Уведомление для **компьютера-02** продолжает запускать в обычном режиме.

![Действие правила и оповещения журналов (количество результатов)](media/alerts-action-rules/action-rules-log-alert-metric-measurement.png)

## <a name="faq"></a>Часто задаваемые вопросы

### <a name="while-im-configuring-an-action-rule-id-like-to-see-all-the-possible-overlapping-action-rules-so-that-i-avoid-duplicate-notifications-is-it-possible-to-do-that"></a>Хотя я настройте правило действия, я бы хотел см. в разделе все возможные перекрывающиеся действия правил, таким образом, чтобы избежать повторяющихся уведомлений. Это можно сделать?

После определения область при настройке правила действия, отобразится список действий правил, которые пересекаются в одной области (если таковые имеются). Такое перекрытие может принимать одно из следующих вариантов:

* Точное соответствие: Например действие правила, которые вы определяете и перекрывающиеся действия правила находятся на той же подписке.
* Подмножество: Например, действие правила, которые вы определяете включена подписки, и перекрывающиеся действия правила находится в группе ресурсов в подписке.
* Надмножество: Например действие правила, которые вы определяете находится на группу ресурсов и перекрывающиеся действия правила находится на подписку, которая содержит группу ресурсов.
* Пересечение: Например, при определении правила действий ведет на **VM1** и **VM2**, и включен перекрывающиеся действия правила **VM2** и **VM3**.

![Перекрывающиеся действия правила](media/alerts-action-rules/action-rules-overlapping.png)

### <a name="while-im-configuring-an-alert-rule-is-it-possible-to-know-if-there-are-already-action-rules-defined-that-might-act-on-the-alert-rule-im-defining"></a>Хотя я Настройка правила генерации оповещений, — можно ли узнать, если есть уже определенные правила действий, которые могут действовать на правило генерации оповещений, которые я определяю?

После определения целевой ресурс для правила генерации оповещений, можно увидеть список правил действия, влияющие на той же области (если таковые имеются), выбрав **представление настроить действия** под **действия** раздел. Этот список заполняется на основе следующих сценариев для области:

* Точное соответствие: Например правило генерации оповещений, которые вы определяете и действия правила находятся на той же подписке.
* Подмножество: Например правило генерации оповещений, которые вы определяете находится на подписку и правило действие находится в группе ресурсов в подписке.
* Надмножество: Например правило генерации оповещений, которые вы определяете находится на группу ресурсов и правило действие находится на подписку, которая содержит группу ресурсов.
* Пересечение: Например, при определении правила генерации оповещений ведет на **VM1** и **VM2**, и правило действие находится на **VM2** и **VM3**.
    
![Перекрывающиеся действия правила](media/alerts-action-rules/action-rules-alert-rule-overlapping.png)

### <a name="can-i-see-the-alerts-that-have-been-suppressed-by-an-action-rule"></a>Можно просмотреть оповещения, которые были отключены правилом действие?

В [странице списка оповещений](https://docs.microsoft.com/azure/azure-monitor/platform/alerts-managing-alert-instances), вы можете выбрать дополнительный столбец называется **состояние подавления**. Если уведомления для экземпляр предупреждения об изменении было подавлено, он отображается в списке этого состояния.

![Подавленные экземпляров предупреждений](media/alerts-action-rules/action-rules-suppressed-alerts.png)

### <a name="if-theres-an-action-rule-with-an-action-group-and-another-with-suppression-active-on-the-same-scope-what-happens"></a>Если правила действия с помощью группы действий, а другой с помощью подавления active на той же области, что происходит?

Подавление всегда имеет приоритет в одной области.

### <a name="what-happens-if-i-have-a-resource-thats-monitored-in-two-separate-action-rules-do-i-get-one-or-two-notifications-for-example-vm2-in-the-following-scenario"></a>Что произойдет, если у меня есть ресурс, который отслеживается в два отдельных действия правила? Получить один или два уведомления? Например **VM2** в следующем сценарии:

      "action rule AR1 defined for VM1 and VM2 with action group AG1
      action rule AR2 defined for VM2 and VM3 with action group AG1"

Для каждого оповещения на виртуальной машине 1 и VM3 группы действий AG1 будет создаваться один раз. Для каждого оповещения на **VM2**, AG1 будет создаваться дважды, так как действие правила не дедуплицируйте действий группы действий. 

### <a name="what-happens-if-i-have-a-resource-monitored-in-two-separate-action-rules-and-one-calls-for-action-while-another-for-suppression-for-example-vm2-in-the-following-scenario"></a>Что произойдет, если у меня есть ресурс отслеживать в два отдельных действия правила и один из них вызывает для действия во время выполнения другой для подавления? Например **VM2** в следующем сценарии:

      "action rule AR1 defined for VM1 and VM2 with action group AG1 
      action rule AR2 defined for VM2 and VM3 with suppression"

Для каждого оповещения на VM1 группа действий AG1 будет создаваться один раз. Действия и уведомления для каждого оповещения на VM2 и VM3 не отобразится. 

### <a name="what-happens-if-i-have-an-alert-rule-and-an-action-rule-defined-for-the-same-resource-calling-different-action-groups-for-example-vm1-in-the-following-scenario"></a>Что произойдет, если у меня есть правило генерации оповещений и действия правила, определенные для одного ресурса, вызывая другое действие группы? Например **VM1** в следующем сценарии:

      "alert rule rule1 on VM1 with action group AG2
      action rule AR1 defined for VM1 with action group AG1" 
 
Для каждого оповещения на VM1 группа действий AG1 будет создаваться один раз. Каждый раз, когда правило генерации оповещений «rule1» активируется, он также активирует AG2 Кроме того. Группы действий, определенных в правилах действий и правил генерации оповещений работать независимо, без дедупликации. 

## <a name="next-steps"></a>Следующие шаги

- [Дополнительные сведения об оповещениях в Azure](https://docs.microsoft.com/azure/azure-monitor/platform/alerts-overview)
