---
title: Правила действий для предупреждений Azure Monitor
description: Понимание правил действий в Azure Monitor и способов их настройки и управления.
ms.topic: conceptual
ms.date: 04/25/2019
ms.subservice: alerts
ms.openlocfilehash: 42f8d9cd30caa48376cda049f6404aa897a6866c
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "77668474"
---
# <a name="action-rules-preview"></a>Правила действия (предварительный просмотр)

Правила действий помогают определить или пресечь действия в любой области управления ресурсами Azure (подписка Azure, группа ресурсов или целевой ресурс). Они имеют различные фильтры, которые помогут вам сузить определенный подмножество экземпляров оповещения, которые вы хотите действовать.

## <a name="why-and-when-should-you-use-action-rules"></a>Почему и когда следует использовать правила действий?

### <a name="suppression-of-alerts"></a>Подавление предупреждений

Существует множество сценариев, в которых полезно подавлять оповещения, генерируемые оповещения. Эти сценарии варьируются от подавления во время запланированного окна обслуживания до подавления в нерабочие часы. Например, команда, ответственная за **ContosoVM,** хочет подавить уведомления о предстоящих выходных, так как **ContosoVM** проходит плановое техническое обслуживание. 

Хотя команда может отключить каждое правило оповещения, настроенное на **ContosoVM** вручную (и включить его снова после обслуживания), это не простой процесс. Правила действия помогают определить подавление оповещения в масштабе с возможностью гибкой настройки периода подавления. В предыдущем примере группа может определить одно правило действия на **ContosoVM,** которое подавляет все уведомления о предупреждениях за выходные.


### <a name="actions-at-scale"></a>Действия в масштабе

Хотя правила оповещения помогают определить группу действий, которая вызывает сядеб, когда генерируется оповещение, клиенты часто имеют общую группу действий в рамках операций. Например, группа, ответственная за группу ресурсов **ContosoRG,** вероятно, определит одну и ту же группу действий для всех правил оповещения, определенных в **ContosoRG.** 

Правила действий помогут вам упростить этот процесс. Определяя действия в масштабе, группа действий может быть запущена для любого оповещения, сгенерированного в настроенной области. В предыдущем примере группа может определить одно правило действия на **ContosoRG,** которое запустит одну и ту же группу действий для всех предупреждений, генерируемых в ней.

> [!NOTE]
> Правила действия в настоящее время не применяются к оповещениям о здоровье службы Azure.

## <a name="configuring-an-action-rule"></a>Настройка правила действия

Вы можете получить доступ к функции, выбрав **действия Управления** с целевой **страницы оповещения** в Azure Monitor. Затем выберите **правила действий (предварительный просмотр).** Вы можете получить доступ к правилам, выбрав **правила действий (предварительный просмотр)** из панели мониторинга целевой страницы для оповещений.

![Правила действий с целевой страницы Azure Monitor](media/alerts-action-rules/action-rules-landing-page.png)

Выберите **новое правило действий**. 

![Добавление нового правила действия](media/alerts-action-rules/action-rules-new-rule.png)

Кроме того, можно создать правило действия при настройке правила оповещения.

![Добавление нового правила действия](media/alerts-action-rules/action-rules-alert-rule.png)

Теперь вы должны увидеть страницу потока для создания правил действий. Нанастройка следующих элементов: 

![Поток создания нового правила действия](media/alerts-action-rules/action-rules-new-rule-creation-flow.png)

### <a name="scope"></a>Область

Сначала выберите область (подписка Azure, группа ресурсов или целевой ресурс). Можно также несколько выбрать комбинацию областей в рамках одной подписки.

![Сфера действия правила](media/alerts-action-rules/action-rules-new-rule-creation-flow-scope.png)

### <a name="filter-criteria"></a>Критерии фильтра

Можно дополнительно определить фильтры, чтобы сузить их до определенного подмноза оповещений. 

Доступны следующие фильтры: 

* **Тяжесть**: Возможность выбрать один или несколько предупреждений severities. **Тяжесть sev1** означает, что правило действия применимо для всех предупреждений, установленных на Sev1.
* **Служба мониторинга**: Фильтр, основанный на исходной службе мониторинга. Этот фильтр также несколько выберите. Например, **служба мониторинга и «Исследования приложений»** означает, что правило действия применимо ко всем оповещениям на основе Application Insights.
* **Тип ресурса**: Фильтр, основанный на определенном типе ресурса. Этот фильтр также несколько выберите. Например, **тип ресурса - "Виртуальные машины"** означает, что правило действия применимо ко всем виртуальным машинам.
* **Идентификатор правил оповещения**: возможность фильтрации для определенных правил оповещения с помощью идентификатора менеджера ресурсов правила оповещения.
* **Состояние монитора**: Фильтр для экземпляров оповещения с либо **уволенным** или **решенным** в качестве условия монитора.
* **Описание**: Regex (обычное выражение) совпадает, которое определяет строку сопоставления с описанием, определяемое как часть правила оповещения. Например, **описание содержит "prod",** будет соответствовать всем предупреждениям, содержащим строку "prod" в их описаниях.
* **Контекст оповещения (полезная нагрузка)**: Совпадение regex, определяющее совпадение строки с полями контекста оповещения полезной нагрузки оповещения. Например, **контекст оповещения (полезная нагрузка) содержит "Computer-01",** который будет соответствовать всем предупреждениям, чьи полезные нагрузки содержат строку "Computer-01".

Эти фильтры применяются в сочетании друг с другом. Например, если вы установите **тип ресурса ' - Виртуальные машины** и **серьезность' Sev0**, то вы отфильтровали для всех оповещений **Sev0** только на ваших Виртуальных ВМ. 

![Фильтры правил действий](media/alerts-action-rules/action-rules-new-rule-creation-flow-filters.png)

### <a name="suppression-or-action-group-configuration"></a>Конфигурация группы подавления или действия

Затем настройте правило действия для подавления оповещения или поддержки группы действий. Вы не можете выбрать и то, и другое. Конфигурация действует на всех экземплярах оповещения, которые соответствуют ранее определенному объему и фильтрам.

#### <a name="suppression"></a>Подавление

Если вы выберете **подавление,** назначайте продолжительность для подавления действий и уведомлений. Выберите один из следующих параметров.
* **Отныне (Всегда)**: Подавляет все уведомления на неопределенный срок.
* **В назначенное время:** Подавляет уведомления в пределах ограниченного срока.
* **С повторением**: Подавляет уведомления на повторяющийся ежедневный, еженедельный или ежемесячный график.

![Подавление правил действий](media/alerts-action-rules/action-rules-new-rule-creation-flow-suppression.png)

#### <a name="action-group"></a>Группа действий

Если вы выберете **группу действий** в переключении, либо добавьте существующую группу действий, либо создайте новую. 

> [!NOTE]
> Можно связать только одну группу действий с правилом действия.

![Добавление или создание нового правила действия, выбрав группу действий](media/alerts-action-rules/action-rules-new-rule-creation-flow-action-group.png)

### <a name="action-rule-details"></a>Детали правила действия

Наконец, настройте следующие детали для правила действия:
* name
* Группа ресурсов, в которой она сохранена
* Описание 

## <a name="example-scenarios"></a>Примеры сценариев

### <a name="scenario-1-suppression-of-alerts-based-on-severity"></a>Сценарий 1: Подавление предупреждений на основе тяжести

Contoso хочет, чтобы подавить уведомления для всех Sev4 оповещения на всех ВМ в рамках подписки **ContosoSub** каждые выходные.

**Решение:** Создайте правило действия с помощью:
* Область действия и **ContosoSub**
* Фильтры
    * Тяжесть и **Sev4**
    * Тип ресурсов - **Виртуальные машины**
* Подавление с рецидивом установлен на еженедельно, и **в субботу** и **воскресенье** проверили

### <a name="scenario-2-suppression-of-alerts-based-on-alert-context-payload"></a>Сценарий 2: Подавление предупреждений на основе контекста оповещения (полезная нагрузка)

Contoso хочет подавить уведомления для всех журналов оповещения, генерируемые для **компьютера-01** в **ContosoSub** на неопределенный срок, как он проходит техническое обслуживание.

**Решение:** Создайте правило действия с помощью:
* Область действия и **ContosoSub**
* Фильтры
    * Служба мониторинга - **Аналитика журналов**
    * Контекст оповещения (полезная нагрузка) содержит **Computer-01**
* Подавление установлено **отныне (Всегда)**

### <a name="scenario-3-action-group-defined-at-a-resource-group"></a>Сценарий 3: Группа действий, определяемая в группе ресурсов

Contoso определил [оповещение метрики на уровне подписки.](https://docs.microsoft.com/azure/azure-monitor/platform/alerts-metric-overview#monitoring-at-scale-using-metric-alerts-in-azure-monitor) Но он хочет определить действия, которые срабатывают специально для предупреждений, генерируемых из группы ресурсов **ContosoRG.**

**Решение:** Создайте правило действия с помощью:
* Область действия - **ContosoRG**
* Нет фильтров
* Группа действий настроена на **ContosoActionGroup**

> [!NOTE]
> *Группы действий, определяемые в рамках правил действий и правил оповещения, действуют независимо друг от лица, без каких-либо обезврённых.* В описанном ранее сценарии, если группа действий определена для правила оповещения, она срабатывает в сочетании с группой действий, определенной в правиле действия. 

## <a name="managing-your-action-rules"></a>Управление правилами действий

Вы можете просматривать и управлять правилами действий из представления списка:

![Представление списка правил действий](media/alerts-action-rules/action-rules-list-view.png)

Отсюда можно включить, отключить или удалить правила действия в масштабе, выбрав флажок рядом с ними. При выборе правила действия открывается его страница конфигурации. Страница помогает обновить определение правила действия и включить или отключить его.

## <a name="best-practices"></a>Рекомендации

Оповещения журнала, которые создаются с [помощью опции «количество результатов»,](alerts-unified-log.md) генерируют единый экземпляр оповещения, используя весь результат поиска (который может охватывать несколько компьютеров). В этом случае, если правило действия использует фильтр **alert Context (полезная нагрузка),** оно действует в экземпляре оповещения при наличии совпадения. В сценарии 2, описанном ранее, если результаты поиска для генерируемого оповещения журнала содержат как **Computer-01,** так и **Computer-02,** все уведомление подавляется. Для **Computer-02** нет никаких уведомлений.

![Правила действий и оповещения о журнале (количество результатов)](media/alerts-action-rules/action-rules-log-alert-number-of-results.png)

Чтобы наилучшим образом использовать оповещения журнала с правилами действий, создайте оповещения о журнале с опцией [измерения метрики.](alerts-unified-log.md) Отдельные экземпляры оповещения генерируются этой опцией, на основе определенного поля группы. Затем в сценарии 2 создаются отдельные экземпляры оповещения для **Computer-01** и **Computer-02.** Из-за правила действия, описанного в сценарии, только уведомление для **Computer-01** подавляется. Уведомление для **Computer-02** продолжает работать в обычном режиме.

![Правила действий и оповещения о журнале (количество результатов)](media/alerts-action-rules/action-rules-log-alert-metric-measurement.png)

## <a name="faq"></a>часто задаваемые вопросы

### <a name="while-im-configuring-an-action-rule-id-like-to-see-all-the-possible-overlapping-action-rules-so-that-i-avoid-duplicate-notifications-is-it-possible-to-do-that"></a>При настройке правила действия я хотел бы видеть все возможные правила перекрывающихся действий, чтобы избежать дублирования уведомлений. Можно ли это сделать?

После определения области при настройке правила действия можно увидеть список правил действия, которые перекрываются в той же области (если таковая имеется). Это перекрытие может быть одним из следующих вариантов:

* Точное соответствие: Например, определяющее правило действия и правило перекрывающихся действий находятся в одной подписке.
* Подмножество: Например, определяющее вами правило действия находится в подписке, а правило перекрывающихся действий — в группе ресурсов в подписи.
* Суперсет: Например, определяющее правило действия находится в группе ресурсов, а правило перекрывающихся действий — в подписке, содержащей группу ресурсов.
* Пересечение: Например, правило действия, определяемые на **VM1** и **VM2,** и правило перекрывающихся действий находится на **VM2** и **VM3.**

![Правила перекрывающихдействия действий](media/alerts-action-rules/action-rules-overlapping.png)

### <a name="while-im-configuring-an-alert-rule-is-it-possible-to-know-if-there-are-already-action-rules-defined-that-might-act-on-the-alert-rule-im-defining"></a>В то время как я настраиваю правило оповещения, можно ли узнать, существуют ли уже правила действия, которые могут действовать в соответствии с определяемым мною правилом оповещения?

После определения целевого ресурса для правила оповещения можно увидеть список правил действия, которые действуют в одном и том же объеме (если таковые имеются), выбрав **настроенные действия view** в разделе **Действия.** Этот список заполняется на основе следующих сценариев для области:

* Точное соответствие: Например, определяющее правило оповещения и правило действия находятся в одной подписке.
* Подмножество: Например, определяющее вами правило оповещения — в подписке, а правило действия — в группе ресурсов в подписи.
* Например, правило оповещения, которое вы определяете, находится в группе ресурсов, а правило действия — в подписке, содержащей группу ресурсов.
* Пересечение: Например, правило оповещения, определяемые на **VM1** и **VM2,** и правило действия находится на **VM2** и **VM3.**
    
![Правила перекрывающихдействия действий](media/alerts-action-rules/action-rules-alert-rule-overlapping.png)

### <a name="can-i-see-the-alerts-that-have-been-suppressed-by-an-action-rule"></a>Могу ли я увидеть оповещения, которые были подавлены правилом действия?

На [странице списка предупреждений](https://docs.microsoft.com/azure/azure-monitor/platform/alerts-managing-alert-instances)можно выбрать дополнительный столбец под названием **«Статус подавления».** Если уведомление для экземпляра оповещения было подавлено, он будет отображать этот статус в списке.

![Подавленные экземпляры оповещения](media/alerts-action-rules/action-rules-suppressed-alerts.png)

### <a name="if-theres-an-action-rule-with-an-action-group-and-another-with-suppression-active-on-the-same-scope-what-happens"></a>Если есть правило действия с группой действий и другое с подавлением, активное на той же области, что происходит?

Подавление всегда имеет приоритет на одном и том же объеме.

### <a name="what-happens-if-i-have-a-resource-thats-monitored-in-two-separate-action-rules-do-i-get-one-or-two-notifications-for-example-vm2-in-the-following-scenario"></a>Что произойдет, если у меня есть ресурс, который контролируется в двух отдельных правилах действий? Получу ли я одно или два уведомления? Например, **VM2** в следующем сценарии:

      action rule AR1 defined for VM1 and VM2 with action group AG1
      action rule AR2 defined for VM2 and VM3 with action group AG1

Для каждого оповещения на VM1 и VM3, группа действий AG1 будет срабатывать один раз. Для каждого оповещения на **VM2,** группа действий AG1 будет срабатывать дважды, потому что правила действий не дублировать действия. 

### <a name="what-happens-if-i-have-a-resource-monitored-in-two-separate-action-rules-and-one-calls-for-action-while-another-for-suppression-for-example-vm2-in-the-following-scenario"></a>Что произойдет, если у меня есть ресурс, контролируемый в двух отдельных правилах действия и один призывает к действию, а другой для подавления? Например, **VM2** в следующем сценарии:

      action rule AR1 defined for VM1 and VM2 with action group AG1 
      action rule AR2 defined for VM2 and VM3 with suppression

Для каждого оповещения на VM1, группа действий AG1 будет срабатывать один раз. Действия и уведомления для каждого оповещения на VM2 и VM3 будут подавлены. 

### <a name="what-happens-if-i-have-an-alert-rule-and-an-action-rule-defined-for-the-same-resource-calling-different-action-groups-for-example-vm1-in-the-following-scenario"></a>Что произойдет, если у меня будет правило оповещения и правило действий, определенное для одного и того же ресурса, вызывая различные группы действий? Например, **VM1** в следующем сценарии:

      alert rule rule1 on VM1 with action group AG2
      action rule AR1 defined for VM1 with action group AG1 
 
Для каждого оповещения на VM1, группа действий AG1 будет срабатывать один раз. Всякий раз, когда срабатывает правило оповещения "правило1", оно также вызовет AG2 дополнительно. Группы действий, определяемые в рамках правил действий и правил оповещения, действуют независимо друг от лица, без каких-либо обезврённых. 

## <a name="next-steps"></a>Дальнейшие действия

- [Подробнее о оповещениях в Azure](https://docs.microsoft.com/azure/azure-monitor/platform/alerts-overview)
