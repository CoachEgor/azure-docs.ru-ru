---
title: Правила действий для оповещений Azure Monitor
description: Понимание того, что такое действие правила и как настроить и управлять ими.
author: anantr
services: azure-monitor
ms.service: azure-monitor
ms.topic: conceptual
ms.date: 04/25/2019
ms.author: anantr
ms.component: alerts
ms.openlocfilehash: c260273c647dd5dd6050f1fd543ebd5a5aa47b89
ms.sourcegitcommit: 2028fc790f1d265dc96cf12d1ee9f1437955ad87
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/30/2019
ms.locfileid: "64922768"
---
# <a name="action-rules-preview"></a>Правила действий (Предварительная версия)

Этой статье описывается, что такое действие правила и как настроить и управлять ими.

## <a name="what-are-action-rules"></a>Что такое действие правила?

Действие правила позволяют определять действия (или подавления действий) в любой области диспетчера ресурсов (подписки, группу ресурсов или ресурсов). Они имеют различные фильтры, которые позволяют сузить определенное подмножество экземпляров предупреждения, которые вы собираетесь работать. 

С помощью действия правила можно:

* Если необходимы запланированные окна обслуживания или выходные и праздничные, вместо того, чтобы каждый отключить правило генерации оповещений по отдельности отключайте действия и уведомления.
* Определите действия и уведомления в нужном масштабе. Вместо того, чтобы определить группы действий по отдельности для каждого правила генерации оповещений, теперь можно определять группы действий для активации для предупреждений, созданных в любой области. Например можно выбрать для триггера «ContosoActionGroup» группы действий для каждого оповещения, созданные в рамках подписки.

## <a name="configuring-an-action-rule"></a>Настройка правила действия

Функцию можно открыть, выбрав **Управление действиями** целевой страницы в Azure Monitor оповещения, связанные с. Затем выберите **правилах действий (Предварительная версия)**. Их можно открыть, выбрав **правилах действий (Предварительная версия)** из панели мониторинга целевой страницы для оповещений.

![Действие правила на целевой странице Azure Monitor](media/alerts-action-rules/action-rules-landing-page.png)

Выберите **+ новое правило действия**. 

![Добавить новое правило действия](media/alerts-action-rules/action-rules-new-rule.png)

Кроме того также можно создать правило действия при настройке правила генерации оповещений.

![Добавить новое правило действия](media/alerts-action-rules/action-rules-alert-rule.png)

Теперь вы увидите процесс создания правила действие открыть. Настройте следующие элементы: 

![Новый поток для создания правила действие](media/alerts-action-rules/action-rules-new-rule-creation-flow.png)

### <a name="scope"></a>Область

Сначала выберите область, то есть, целевой ресурс, группу ресурсов или подписку. Также имеется возможность множественного выбора сочетания любого из перечисленных выше (в пределах одной подписки). 

![Область действия правила](media/alerts-action-rules/action-rules-new-rule-creation-flow-scope.png)

### <a name="filter-criteria"></a>условия фильтра

Кроме того, можно определить фильтры Чтобы сузить до определенное подмножество предупреждения для заданной области. 

Доступны следующие фильтры: 

* **Уровень серьезности**. Выберите один или несколько уровней серьезности предупреждения. Серьезность = Sev1 означает, что применимо для всех оповещений со степенью серьезности, что Sev1 действия правила.
* **Мониторинг службы**: Фильтрация в зависимости от исходной службой мониторинга. Это также множественного выбора. Например, службу монитора = «Application Insights» означает, что действие правило применяется для всех «Application Insights» на основе оповещений.
* **Тип ресурса**: Фильтрация в зависимости от определенных типов ресурсов. Это также множественного выбора. Например, тип ресурса = «Виртуальные машины» означает, что действие правило применяется для всех виртуальных машин.
* **Идентификатор правила оповещений**: Позволяет фильтровать определенные правила оповещений с помощью Resource Manager идентификатор правила генерации оповещений.
* **Мониторинг условие**: Фильтр для экземпляров предупреждений с «Срабатывания» или «Разрешено», как условие монитора.
* **Описание** Регулярное выражение сопоставления в описании, определенных как часть правила генерации оповещений.
* **Контекст предупреждения (полезные данные)**: Сопоставление регулярному выражению, в рамках [контекст предупреждения](https://docs.microsoft.com/azure/azure-monitor/platform/alerts-common-schema-definitions#alert-context-fields) поля экземпляр предупреждения.

Эти фильтры применяются в сочетании друг с другом. Например, если поставить «Тип ресурса» = «Виртуальные машины» и «Серьезность» = «Sev0», а затем я фильтрации для всех предупреждений «Sev0» на моей виртуальной машиной. 

![Фильтры действий правила](media/alerts-action-rules/action-rules-new-rule-creation-flow-filters.png)

### <a name="suppression-or-action-group-configuration"></a>Конфигурация группы подавления или действие

Далее настройте действия правила для подавления предупреждений или поддержка группы действий. Невозможно выбрать оба. Конфигурация действует на всех экземплярах предупреждений, соответствующие ранее заданной области и фильтры.

#### <a name="suppression"></a>Подавление

При выборе **подавления**, задать длительность для подавления действий и уведомлений. Выберите один из следующих:
* **Коди (всегда)**: Подавляет все уведомления неопределенное время.
* **В запланированное время**: Подавлять уведомления в течение ограниченного промежутка.
* **С помощью повторение**: Отключает расписание повторения, который может быть ежедневно, еженедельно или ежемесячно.

![Действие правила подавления](media/alerts-action-rules/action-rules-new-rule-creation-flow-suppression.png)

#### <a name="action-group"></a>Группа действий

При выборе **группы действий** добавить существующую группу действий в переключатель, или создайте новую. 

> [!NOTE]
> Можно связать только одну группу действий с правила действия.

![Группы действий действия правила](media/alerts-action-rules/action-rules-new-rule-creation-flow-action-group.png)

### <a name="action-rule-details"></a>Действие сведения о правиле

Наконец настройте следующие сведения для действия правила
* ИМЯ
* Группа ресурсов, в котором будет сохранен
* ОПИСАНИЕ 

## <a name="example-scenarios"></a>Примеры сценариев

### <a name="scenario-1-suppression-of-alerts-based-on-severity"></a>Сценарий 1. Подавление предупреждений, в зависимости от уровня серьезности

Contoso хочет подавлять уведомления для всех предупреждений Sev4 на всех виртуальных машин в рамках их подписки «ContosoSub» каждое воскресенье.

**Решение.** Создание правила действия с
* Scope = «ContosoSub»
* Фильтры
    * Серьезность = «Sev4»
    * Тип ресурса = «Виртуальные машины»
* Значение подавления с повторением еженедельно, а проверка «Суббота» и «Воскресенье»

### <a name="scenario-2-suppression-of-alerts-based-on-alert-context-payload"></a>Сценарий 2. Подавление предупреждений, исходя из контекста предупреждения (полезные данные)

Contoso хочет подавлять уведомления для всех журналов, оповещения, созданные для «компьютер-01"в «ContosoSub» бесконечно так как она будет обслуживания.

**Решение.** Создание правила действия с
* Scope = «ContosoSub»
* Фильтры
    * Мониторинг службы = «Log Analytics»
    * Контекст предупреждения (полезные данные) содержит 'Компьютер-01'
* Значение подавления "Коди (всегда)"

### <a name="scenario-3-action-group-defined-at-a-resource-group"></a>Сценарий 3. Группу действий, определенную в группу ресурсов

Компания Contoso определила [оповещения метрики на уровне подписки](https://docs.microsoft.com/azure/azure-monitor/platform/alerts-metric-overview#monitoring-at-scale-using-metric-alerts-in-azure-monitor), но хочет определить действия, которые активируют оповещения отдельно для своей группы ресурсов «ContosoRG».

**Решение.** Создание правила действия с
* Scope = «ContosoRG»
* Ни одного фильтра
* Группа действий, равным «ContosoActionGroup»

## <a name="managing-your-action-rules"></a>Управление правилами ваши действия

Можно просматривать и управлять правилами действие в представлении списка, как показано ниже.

![Представление списка действие правила](media/alerts-action-rules/action-rules-list-view.png)

На этой странице вы можете включить/отключить или удалить действие правила в масштабе, установив флажок рядом с ними. Щелкнув любое правило, действие открывает страницу конфигурации, что позволяет обновить его определение и включить или отключить его.

## <a name="best-practices"></a>Рекомендации

Оповещения, созданные с помощью журналов [«число результатов»](https://docs.microsoft.com/azure-monitor/platform/alerts-unified-log) вариант создание **один экземпляр предупреждения об изменении** используя результат поиска, целиком (который может быть на нескольких компьютерах к примеру). В этом случае если правила действия использует фильтр «Контекст предупреждения (полезные данные)», он будет действовать экземпляр предупреждения до тех пор, пока совпадения. В сценарии 2 как описано выше, если результаты поиска для созданного предупреждения журнала содержат «компьютер-01"и «компьютер-02" подавляется уведомлений (то есть нет, уведомление не создан для «компьютер-02").

![Действие правила и оповещения журналов (количество результатов)](media/alerts-action-rules/action-rules-log-alert-number-of-results.png)

В наиболее оповещения журнала используйте с правилами действия, мы советуем вам создание оповещений журнала с [«измерение метрик»](https://docs.microsoft.com/azure-monitor/platform/alerts-unified-log) параметр. Используя этот параметр, отдельные экземпляры предупреждений об изменении создаются на основе определенных поля группы. Затем в сценарии 2, «компьютер-01"и «компьютер-02" создаются отдельные экземпляры предупреждений об изменении. С правилом действия, описанные в сценарии только уведомления для «компьютер-01"будет подавлять уведомления для «компьютер-02" будет продолжено срабатывание в обычном режиме.

![Действие правила и оповещения журналов (количество результатов)](media/alerts-action-rules/action-rules-log-alert-metric-measurement.png)

## <a name="faq"></a>Часто задаваемые вопросы

* В. При настройке правила действия, я бы хотел увидеть, что все возможные перекрывающиеся действия правила, чтобы избежать повторяющихся уведомлений. Это можно сделать?

    О. После определения область при настройке правила действия можно просмотреть список правил действия, которые пересекаются в одной области (если таковые имеются). Такое перекрытие может принимать одно из следующих вариантов:
    * Точное соответствие: Например правило действие, которое вы определяете и перекрывающиеся действия правила находятся на той же подписке.
    * Набор: Например, правило действие, которое вы определяете включена подписки, и перекрывающиеся действия правила находится в группе ресурсов в подписке.
    * Расширенный: Например правило действие, которое вы определяете находится на группу ресурсов и перекрывающиеся действия правила находится на подписку, которая содержит группу ресурсов.
    * Пересечение: Например правило действие, которое вы определяете включен «VM1» и «2», и перекрывающиеся действия правила «VM2» и «VM3».

    ![Перекрывающиеся действия правила](media/alerts-action-rules/action-rules-overlapping.png)

* В. При настройке правила оповещения, его можно узнать, если есть уже определенные правила действий, которые могут действовать на правило генерации оповещений, которые я определяю?

    О. После определения целевой ресурс для правила генерации оповещений, вы увидите список правил действия, которые работают на одной и той же области (если таковые имеются), щелкнув «Представление настроено действия» в разделе «Действия». Этот список заполняется на основе следующих сценариев для области:
    * Точное соответствие: Например правило генерации оповещений, которые вы определяете и действия правила находятся на той же подписке.
    * Набор: Например правило генерации оповещений, которые вы определяете находится на подписку и правило действие находится в группе ресурсов в подписке.
    * Расширенный: Например правило генерации оповещений, которые вы определяете находится на группу ресурсов и правило действие находится на подписку, которая содержит группу ресурсов.
    * Пересечение: Например включено правило оповещения, которые вы определяете «VM1» и «2», и действие правила «VM2» и «VM3».
    
    ![Перекрывающиеся действия правила](media/alerts-action-rules/action-rules-alert-rule-overlapping.png)

* В. Можно просмотреть оповещения, которые были отключены правилом действие?

    О. В [странице списка оповещений](https://docs.microsoft.com/azure/azure-monitor/platform/alerts-managing-alert-instances), есть дополнительный столбец, который может быть выбрано в вызываемой «подавления Status». Если уведомления для экземпляр предупреждения об изменении было подавлено, он отображается в списке этого состояния.

    ![Подавленные экземпляров предупреждений](media/alerts-action-rules/action-rules-suppressed-alerts.png)

* В. Если правила действия с помощью группы действий, а другой с помощью подавления active на той же области, что происходит?

    О. **Подавление всегда имеет приоритет в одной области**.

* В. Что произойдет, если у меня есть ресурс отслеживать в два отдельных действия правила? Получить один или два уведомления? Например, «VM2» в этом сценарии:

      action rule 'AR1' defined for 'VM1' and 'VM2' with action group 'AG1' 
      action rule 'AR2' defined for 'VM2' and 'VM3' with action group 'AG1' 

    О. Для каждого оповещения на «1» и «VM3» группы действий «AG1» будет создаваться один раз. Для каждого оповещения на «VM2» группы действий «AG1» будет создаваться дважды (**действие правила не дубликаты действия**). 

* В. Что произойдет, если у меня есть ресурс отслеживать в два отдельных действия правила и один из них вызывает для действия во время выполнения другой для подавления? Например, «VM2» в этом сценарии:

      action rule 'AR1' defined for 'VM1' and 'VM2' with action group 'AG1' 
      action rule 'AR2' defined for 'VM2' and 'VM3' with suppression

    О. Для каждого оповещения на «VM1» группы действий «AG1» будет создаваться один раз. Действия и уведомления для каждого оповещения на «VM2» и «VM3» будет подавляться. 

* В. Что произойдет, если у меня есть правило генерации оповещений и действия правила, определенные для одного ресурса, вызывая другое действие группы? Например, «VM1» в этом сценарии:

     правило генерации оповещений «правило 1» на «VM1» с «AG2» действие действия группы правил «AR1», заданные для «VM1» с помощью группы действий «AG1»,  
 
    О. Для каждого оповещения на «VM1» группы действий «AG1» будет создаваться один раз. Каждый раз, когда правило генерации оповещений «rule1» активируется, он также активирует «AG2» Кроме того. (**действия групп, определенных в правилах действий и правил генерации оповещений работать независимо, с без удаления дубликатов**) 

## <a name="next-steps"></a>Дальнейшие действия

- [Дополнительные сведения об оповещениях в Azure](https://docs.microsoft.com/azure/azure-monitor/platform/alerts-overview)
