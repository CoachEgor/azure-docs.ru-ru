---
title: Создание, просмотр и управление метрическими оповещениями с помощью Azure Monitor
description: Узнайте, как использовать портал Azure или CLI для создания, просмотра и управления правилами предупреждения метрики.
author: harelbr
ms.author: harelbr
ms.topic: conceptual
ms.date: 03/13/2020
ms.subservice: alerts
ms.openlocfilehash: cefccd08ea66638f08f00e280fe2704444a7f916
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79369392"
---
# <a name="create-view-and-manage-metric-alerts-using-azure-monitor"></a>Создание и просмотр оповещений метрик, а также управление ими с помощью Azure Monitor

Метрические оповещения в Azure Monitor предоставляют способ получения уведомления при пересечении порога одной из метрик. Оповещения метрик работают со множеством многомерных метрик платформы, пользовательских метрик, стандартных и пользовательских метрик Application Insights. В этой статье мы опишите, как создавать, просматривать и управлять правилами оповещения метрик и минимизировать через портал Azure и Azure CLI. Можно также создать правила оповещения метрики с помощью шаблонов Azure Resource Manager, которые описаны в [отдельной статье](alerts-metric-create-templates.md).

Подробнее о том, как работают оповещения метрик, см. в [этом обзоре](alerts-metric-overview.md).

## <a name="create-with-azure-portal"></a>Создание с помощью портала Azure

Следующая процедура описывает, как создать правило генерации оповещений метрики на портале Azure:

1. На [портале Azure](https://portal.azure.com)нажмите на **монитор**. В колонке "Монитор" объединены все параметры мониторинга и данные в одном представлении.

2. Щелкните **Оповещения** и выберите **+ Новое правило генерации оповещений**.

    > [!TIP]
    > В большинстве колонок ресурсов в меню ресурсов также есть **оповещения** в разделе **Мониторинг**, и вы также можете создать оповещения там.

3. Щелкните **Выбор цели**, в загружаемой контекстной области выберите целевой ресурс, для которого следует создать оповещение. В раскрывающихся списках **Подписка** и **Тип ресурса** найдите ресурс, который вы хотите отслеживать. Вы также можете найти ресурс с помощью панели поиска.

4. Если выбранный ресурс имеет метрики, по которым можно создавать оповещения, эти метрики будут отображаться на вкладке **Available signals** (Доступные сигналы) в правом нижнем углу. Полный список типов ресурсов, поддерживаемых для оповещений метрик, см. в этой [статье](../../azure-monitor/platform/alerts-metric-near-real-time.md#metrics-and-dimensions-supported).

5. После выбора целевого ресурса щелкните **Добавить условие**.

6. Вы увидите список сигналов, поддерживаемых для ресурса, и сможете выбрать метрику, для которой хотите создать оповещение.

7. Вы увидите диаграмму для метрики за последние шесть часов. Используйте выпадение **периода диаграммы,** чтобы выбрать, чтобы увидеть более длинную историю для метрики.

8. Если метрика имеет размеры, вы увидите представленную таблицу измерений. Выберите одно или несколько значений для каждого измерения.
    - Значения отображаемых измерений основаны на метрических данных за последние три дня.
    - Если значение размера, которое вы ищете, не отображается, нажмите кнопку "Я", чтобы добавить пользовательское значение.
    - Вы также можете **выбрать \*** для любого из измерений. Если **выбрать \***, выбор всех текущих и будущих значений измерений будет динамически масштабироваться.

    Правило предупреждения метрики будет оценивать состояние для всех выбранных комбинаций значений. [Дополнительные сведения о том, как срабатывают оповещения на основе многомерных метрик](alerts-metric-overview.md).

9. Выберите тип **порога,** **оператор**и **тип агрегации.** Это определит логику, которую оценит правило метрика- оповещения.
    - Если вы используете **порог Статический,** продолжайте определять **значение Порога**. Метрическая диаграмма может помочь определить, что может быть разумным порогом.
    - Если вы используете **динамический** порог, продолжайте определять **чувствительность порога.** На диаграмме метрик отображаются вычисленные пороговые значения на основе последних данных. [Дополнительные сведения о типе условия "Динамические пороговые значения" и значениях параметра конфиденциальности](alerts-dynamic-thresholds.md).

10. Дополнительно уточните условие, регулируя **детализацию агрегации** и **частоту оценки.** 

11. Нажмите кнопку **Готово**.

12. При необходимости добавьте еще один критерий, если вы хотите отслеживать сложное правило генерации оповещений. Сейчас пользователи могут применять правила оповещения с одиночным условием динамического порогового значения.

13. Заполните **сведения оповещения,** такие как **название правила оповещения,** **Описание**и **серьезность.**

14. Добавьте группу действий в оповещение: выберите имеющуюся или создайте группу действий.

15. Нажмите кнопку **Готово** для сохранения правила генерации оповещений метрики.

> [!NOTE]
> Правила генерации оповещений метрики, созданные на портале, создаются в той же группе ресурсов, что и целевой ресурс.

## <a name="view-and-manage-with-azure-portal"></a>Просмотр и управление с помощью портала Azure

Вы можете просматривать правила генерации оповещений метрики и управлять ими, используя колонку "Управление правилами" в разделе "Оповещения". В приведенной ниже процедуре показано, как просмотреть свои правила генерации оповещений метрики и изменить одно из них.

1. На портале Azure выберите **Монитор**.

2. Щелкните **Оповещения**, а затем **Управление правилами**.

3. В колонке **Управление правилами** вы можете просмотреть все правила генерации оповещений по подпискам. Далее можно фильтровать правила с помощью **группы ресурсов,** **типа ресурсов**и **ресурса.** Если вы хотите видеть только оповещения метрики, выберите метрику в качестве **типа сигнала**.

    > [!TIP]
    > В колонке **Управление правилами** вы можете выбрать несколько правил генерации оповещений и включить или отключить их. Это может быть полезно, когда необходимо выполнить обслуживание определенных целевых ресурсов.

4. Щелкните имя правила генерации оповещений метрики, которое вы хотите изменить.

5. На вкладке "Изменить правило" щелкните **критерии предупреждения**, которые вы хотите отредактировать. Вы можете изменить метрику, условие порогового значения и другие поля по мере необходимости.

    > [!NOTE]
    > Нельзя изменить **целевой ресурс** и **имя правила генерации оповещений** после создания оповещения метрики.

6. Нажмите кнопку **Готово**, чтобы сохранить изменения.

## <a name="with-azure-cli"></a>С помощью Azure CLI

В предыдущих разделах описано, как создавать, просматривать и управлять правилами предупреждения метрики с помощью портала Azure. В этом разделе вы узнаете, как сделать то же самое с помощью кроссплатформенного [Azure CLI](https://docs.microsoft.com/cli/azure/get-started-with-azure-cli?view=azure-cli-latest). Самый быстрый способ начать использовать Azure CLI посредством [Azure Cloud Shell](https://docs.microsoft.com/azure/cloud-shell/overview?view=azure-cli-latest). Для этой статьи мы будем использовать Cloud Shell.

1. Перейдите на портал Azure, нажмите на **Облачную оболочку**.

2. В командной строке вы можете использовать команды с параметром ``--help``, чтобы узнать больше о команде и о том, как ее использовать. Например, следующая команда показывает список команд, доступных для создания, просмотра и управления метрическими оповещениями

    ```azurecli
    az monitor metrics alert --help
    ```

3. Вы можете создать простое правило генерации оповещений метрики, которое срабатывает, если средняя загрузка ЦП на виртуальной машине превышает 90 %.

    ```azurecli
    az monitor metrics alert create -n {nameofthealert} -g {ResourceGroup} --scopes {VirtualMachineResourceID} --condition "avg Percentage CPU > 90" --description {descriptionofthealert}
    ```

4. Вы можете просмотреть все оповещения метрики в группе ресурсов, используя следующую команду.

    ```azurecli
    az monitor metrics alert list  -g {ResourceGroup}
    ```

5. Вы можете увидеть подробности определенного правила генерации оповещений метрики, используя имя или идентификатор ресурса правила.

    ```azurecli
    az monitor metrics alert show -g {ResourceGroup} -n {AlertRuleName}
    ```

    ```azurecli
    az monitor metrics alert show --ids {RuleResourceId}
    ```

6. Вы можете отключить правило генерации оповещений, используя следующую команду.

    ```azurecli
    az monitor metrics alert update -g {ResourceGroup} -n {AlertRuleName} --enabled false
    ```

7. Вы можете удалить правило генерации оповещений метрики, используя следующую команду.

    ```azurecli
    az monitor metrics alert delete -g {ResourceGroup} -n {AlertRuleName}
    ```

## <a name="next-steps"></a>Дальнейшие действия

- [Создание классического оповещения метрики с помощью шаблона Resource Manager](../../azure-monitor/platform/alerts-metric-create-templates.md).
- [Сведения о работе оповещений метрики в Azure Monitor](alerts-metric-overview.md).
- [Оповещения с динамическими пороговыми значениями в Azure Monitor (ограниченная закрытая предварительная версия)](alerts-dynamic-thresholds.md).
- [Схема полезных данных](../../azure-monitor/platform/alerts-metric-near-real-time.md#payload-schema)

