---
title: Узнайте о работе оповещений о метриках в Azure Monitor.
description: Ознакомьтесь с обзором действий, применимых к оповещениям о метриках, а также узнайте о том, как они работают в Azure Monitor.
author: snehithm
ms.author: snmuvva
ms.date: 9/18/2018
ms.topic: conceptual
ms.service: azure-monitor
ms.subservice: alerts
ms.openlocfilehash: 6138a9ff6bb6d34b09c49fa7b5dbb67cbf5eb1b6
ms.sourcegitcommit: 509e1583c3a3dde34c8090d2149d255cb92fe991
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/27/2019
ms.locfileid: "66244906"
---
# <a name="understand-how-metric-alerts-work-in-azure-monitor"></a>Сведения о работе оповещений о метриках в Azure Monitor

Оповещения о метриках в Azure Monitor работают для основных многомерных метрик. Это могут быть [метрики платформы](alerts-metric-near-real-time.md#metrics-and-dimensions-supported), [пользовательские метрики](../../azure-monitor/platform/metrics-custom-overview.md), [популярные журналы из Azure Monitor, преобразованные в метрики](../../azure-monitor/platform/alerts-metric-logs.md), метрики Application Insights. Для оповещений о метриках регулярно выполняется анализ, чтобы проверить соответствие условий одного временного ряда метрик или более. Если зафиксированы правильные значения, отправляется соответствующее уведомление. Функция оповещений о метриках работает с отслеживанием состояния, то есть уведомления отправляются только при изменении состояния.

## <a name="how-do-metric-alerts-work"></a>Как работают оповещения о метриках?

Вы можете определить правило генерации оповещений о метрике, указав целевой ресурс, который нужно отслеживать, имя метрики, тип условия (статическое и динамическое) и условие (оператор и порог или конфиденциальность), а также группу действий, которую нужно активировать при срабатывании правила генерации оповещений. Типы условий влияют на способ определения пороговых значений. [Дополнительные сведения о типе условия "Динамические пороговые значения" и значениях параметра конфиденциальности](alerts-dynamic-thresholds.md).

### <a name="alert-rule-with-static-condition-type"></a>Правило генерации оповещений со статическим типом условия

Предположим, что вы создали простое правило генерации оповещений о метрике со статическим пороговым значением следующим образом:

- Целевой ресурс (ресурс Azure, который требуется отслеживать): myVM.
- Метрика: Percentage CPU
- Тип условия: Статическое
- Агрегат времени (Статистический показатель, который выполняется в необработанных значениях метрик. Поддерживаемые временные агрегаты — Min, Max, Avg, общее число, число): Средние
- Период (окно, в рамках которого проверяются значения метрик): за последние 5 минут
- Частота (частота, с которой оповещение о метрике проверяет, соблюдены ли условия): 1 мин
- Оператор: Больше чем
- Пороговое значение: 70

С момента создания правила генерации оповещений мониторинг выполняется каждую минуту, просматриваются значения метрики за последние 5 минут и проверяется, превышает ли среднее значение этих значений 70. Если условие выполняется, то есть средняя загрузка ЦП за последние 5 минут превышает 70, правило генерации оповещений запускает активированное уведомление. Если вы настроили действие электронной почты или веб-перехватчика в группе действий, связанной с правилом генерации оповещений, вы получите активированное уведомление для настроенных параметров.

### <a name="alert-rule-with-dynamic-condition-type"></a>Правило генерации оповещений с динамическим типом условия

Предположим, что вы создали простое правило генерации оповещений о метрике с динамическим пороговым значением следующим образом:

- Целевой ресурс (ресурс Azure, который требуется отслеживать): myVM.
- Метрика: Percentage CPU
- Тип условия: Динамический
- Агрегат времени (Статистический показатель, который выполняется в необработанных значениях метрик. Поддерживаемые временные агрегаты — Min, Max, Avg, общее число, число): Средние
- Период (окно, в рамках которого проверяются значения метрик): за последние 5 минут
- Частота (частота, с которой оповещение о метрике проверяет, соблюдены ли условия): 1 мин
- Оператор: Больше чем
- Уровень конфиденциальности: Средние
- Периоды поиска: 4.
- Число нарушений: 4.

После создания правила генерации оповещений алгоритм машинного обучения с динамическими пороговыми значениями будет получать доступные исторические данные, вычислять порог, который наилучшим образом соответствует шаблону поведения ряда метрик, а также будет непрерывно обучаться на основе новых данных, чтобы сделать порог более точным.

С момента создания правила генерации оповещений мониторинг выполняется каждую минуту. При этом просматриваются значения метрик за последние 20 минут, сгруппированные в 5-минутные периоды, а также проверяется, превышает ли среднее значение за период ожидаемый порог в каждом из 4 периодов. Если условие выполняется, то есть средний процент загрузки ЦП за последние 20 минут (четыре 5-минутных периода) отклонялся от ожидаемого поведения четыре раза, правило генерации оповещений запускает активированное уведомление. Если вы настроили действие электронной почты или веб-перехватчика в группе действий, связанной с правилом генерации оповещений, вы получите активированное уведомление для настроенных параметров.

### <a name="view-and-resolution-of-fired-alerts"></a>Просмотр и разрешение сработавших оповещений

Представленные выше примеры выполнения правила генерации оповещений можно также просмотреть на портале Azure или в колонке **Все оповещения**.

Скажем, если показатели использования в ресурсе myVM продолжают превышать порог при последующих проверках, правило генерации оповещений не сработает повторно, пока не будут устранены условия.

Если позже показатели использования в ресурсе myVM вернутся к нормальному состоянию, значение будет ниже порога. Правило генерации оповещений отслеживает это условие еще два раза, чтобы отправить уведомление об устранении. Правило генерации оповещений отправляет сообщение об устранении или деактивации, когда условие оповещения не выполняется в течение трех последовательных периодов для сокращения отправки нежелательных оповещений в случае нестабильности условий.

По мере того как уведомление об устранении отправляется через веб-перехватчик или электронную почту, на портале Azure также обновляется состояние экземпляра оповещения (называемое состоянием мониторинга) на "Разрешено".

### <a name="using-dimensions"></a>Использование измерений

Оповещения о метриках в Azure Monitor также поддерживают отслеживание комбинаций значений нескольких измерений с одним правилом. Поясним на примере, почему вы можете использовать комбинации нескольких измерений.

Предположим, что у вас есть план службы приложений для веб-сайта. Вы хотите отследить использование ЦП на нескольких экземплярах, на которых запущен веб-сайт или приложение. Это можно сделать следующим образом, используя правило генерации оповещений о метрике.

- Целевой ресурс: myAppServicePlan
- Метрика: Percentage CPU
- Тип условия: Статическое
- Измерения
  - Экземпляр = InstanceName1, InstanceName2
- Агрегат времени: Средние
- Период: за последние 5 минут
- Частота: 1 мин
- Оператор: GreaterThan
- Пороговое значение: 70

Как и раньше, это правило отслеживает, превышает ли среднее потребление ЦП за последние 5 минут 70 %. Тем не менее с помощью того же правила вы можете отслеживать два экземпляра, на которых запущен сайт. Каждый экземпляр будет отслеживаться индивидуально, и вы будете получать уведомления отдельно.

Скажем, у вас есть веб-приложение, которое очень часто используется, и вам нужно добавить больше экземпляров. Правило выше по-прежнему отслеживает только два экземпляра. Тем не менее можно создать правило следующим образом.

- Целевой ресурс: myAppServicePlan
- Метрика: Percentage CPU
- Тип условия: Статическое
- Измерения
  - Экземпляр = *
- Агрегат времени: Средние
- Период: за последние 5 минут
- Частота: 1 мин
- Оператор: GreaterThan
- Пороговое значение: 70

Это правило будет автоматически отслеживать все значения для экземпляра, например вы можете отслеживать экземпляры по мере их появления без необходимости снова изменять правило генерации оповещений о метрике.

При мониторинге нескольких измерений правило генерации оповещений с динамическим пороговым значением позволяет создать точно настроенные пороги для нескольких сотен метрик одновременно. Динамические пороговые значения приводят к управлению меньшим количеством правил генерации оповещений и значительной экономии времени на управление и создание правил генерации оповещений.

Предположим, у вас есть веб-приложение со множеством экземпляров и вы не знаете, какой порог является наиболее подходящим. Приведенные выше правила всегда будут использовать порог 70 %. Тем не менее можно создать правило следующим образом.

- Целевой ресурс: myAppServicePlan
- Метрика: Percentage CPU
- Тип условия: Динамический
- Измерения
  - Экземпляр = *
- Агрегат времени: Средние
- Период: за последние 5 минут
- Частота: 1 мин
- Оператор: GreaterThan
- Уровень конфиденциальности: Средние
- Периоды поиска: 1
- Число нарушений: 1

Это правило отслеживает, превышает ли среднее потребление ЦП за последние 5 минут ожидаемое поведение для каждого экземпляра. По этому же правилу вы можете отслеживать экземпляры по мере их появления без необходимости снова изменять правило генерации оповещений о метрике. Каждый экземпляр получит пороговое значение, которое соответствует шаблону поведения ряда метрик, и будет постоянно меняться на основе новых данных, чтобы обеспечить более точное пороговое значение. Как и прежде, каждый экземпляр будет отслеживаться индивидуально и вы будете получать уведомления отдельно.

При увеличении периодов просмотра и числа нарушений также можно выполнить фильтрацию только до оповещения о вашем определении значительного отклонения. [Дополнительные сведения о расширенных параметрах динамических пороговых значений](alerts-dynamic-thresholds.md#what-do-the-advanced-settings-in-dynamic-thresholds-mean).

## <a name="monitoring-at-scale-using-metric-alerts-in-azure-monitor"></a>Мониторинг в масштабе с помощью оповещений о метриках в Azure Monitor

На данный момент вы узнали, как одно предупреждение метрики можно использовать для отслеживания одного или нескольких метрических временных рядов, связанных с одним ресурсом Azure. Во многих случаях вы можете захотеть, чтобы одно и то же правило генерации оповещений применялось ко многим ресурсам. Azure Monitor также поддерживает мониторинг нескольких ресурсов с одним правилом генерации оповещений о метриках. Эта функция сейчас поддерживается только на виртуальных машинах. Кроме того, для одного оповещения о метрике ресурсы отслеживаются в одном регионе Azure.

Можно указать три следующие области мониторинга для одного оповещения:

- список виртуальных машин в одном регионе Azure в рамках подписки;
- все виртуальные машины (в одном регионе Azure) в одной или нескольких группах одной подписки;
- все виртуальные машины (в одном регионе Azure) в одной подписке.

Создание правил генерации оповещений метрики, которые отслеживают несколько ресурсов, аналогично созданию [любого другого оповещения метрики](alerts-metric.md), которое отслеживает один ресурс. Единственным отличием является то, что следует выбрать все ресурсы, которые вы хотите отслеживать. Эти правила также можно создать, используя [шаблоны Azure Resource Manager](../../azure-monitor/platform/alerts-metric-create-templates.md#template-for-metric-alert-that-monitors-multiple-resources). Для каждой виртуальны машины вы получите отдельное уведомление.

## <a name="typical-latency"></a>Обычная задержка

Для оповещений о метриках, как правило можно получить уведомление в течение 5 минут, если задать частоту правила генерации оповещений в 1 минуту. В случае серьезных нагрузок для систем отправки уведомлений может наблюдаться более длительная задержка.

## <a name="supported-resource-types-for-metric-alerts"></a>Поддерживаемые типы ресурсов оповещений о метриках

Полный список поддерживаемых типов ресурсов можно найти в этой [статье](../../azure-monitor/platform/alerts-metric-near-real-time.md#metrics-and-dimensions-supported).

Если в настоящее время вы используете классические оповещения метрики и необходимо узнать, поддерживают ли они все типы используемых ресурсов, следующая таблица показывает эти ресурсы и актуальность их поддержки на сегодняшний день.

|Тип ресурса, который поддерживается стандартными оповещениями метрики | Поддерживаются оповещениями метрики |
|-------------------------------------------------|----------------------------|
| Microsoft.ApiManagement/service | Да |
| Microsoft.Batch/batchAccounts| Да|
|Microsoft.Cache/redis| Да |
|Microsoft.classicСompute/virtualMachines | Нет |
|Microsoft.ClassicCompute/domainNames/slots/roles | Нет|
|Microsoft.CognitiveServices/accounts | Нет |
|Microsoft.Compute/virtualMachines | Да|
|Microsoft.Compute/virtualMachineScaleSets;| Да|
|Microsoft.ClassicStorage/storageAccounts| Нет |
|Microsoft.DataFactory/datafactories | Да|
|Microsoft.DBforMySQL/servers| Да|
|Microsoft.DBforPostgreSQL/servers| Да|
|Microsoft.Devices/IotHubs | Нет|
|Microsoft.DocumentDB/databaseAccounts| Да|
|Microsoft.EventHub/namespaces | Да|
|Microsoft.Logic/workflows | Да|
|Microsoft.Network/loadBalancers |Да|
|Microsoft.Network/publicIPAddresses| Да|
|Microsoft.Network/applicationGateways| Да|
|Microsoft.Network/expressRouteCircuits| Да|
|Microsoft.Network/trafficManagerProfiles | Да|
|Microsoft.Search/searchServices | Да|
|Microsoft.ServiceBus/namespaces| Да |
|Microsoft.Storage/storageAccounts | Да|
|Microsoft.StreamAnalytics/streamingjobs| Да|
|Microsoft.TimeSeriesInsights/environments | Да|
|Microsoft. Web/serverfarms | Да |
|Microsoft. Web/sites (за исключением функций) | Да|
|Microsoft. Web/hostingEnvironments/multiRolePools | Нет|
|Microsoft. Web/hostingEnvironments/workerPools| Нет |
|Microsoft.SQL/Servers | Нет |

## <a name="next-steps"></a>Дальнейшие действия

- [Создание и просмотр оповещений о метриках, а также управление ими с помощью Azure Monitor](alerts-metric.md)
- [Сведения о развертывании оповещений о метриках с помощью шаблонов Azure Resource Manager](../../azure-monitor/platform/alerts-metric-create-templates.md)
- [Дополнительные сведения о группах действий](action-groups.md)
- [Оповещения с динамическими пороговыми значениями в Azure Monitor (ограниченная закрытая предварительная версия)](alerts-dynamic-thresholds.md)
