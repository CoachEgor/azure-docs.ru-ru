---
title: Используйте журналы мониторинга Azure с помощью приложений логики Azure и автоматизации питания
description: Узнайте, как можно использовать приложения Azure Logic Apps и Power Automate для быстрого автоматизации повторяемых процессов с помощью разъема Azure Monitor.
ms.service: azure-monitor
ms.subservice: logs
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 03/13/2020
ms.openlocfilehash: 6961b7bd94c9b3fe70365055851c488efa2cbeca
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79480017"
---
# <a name="azure-monitor-logs-connector-for-logic-apps-and-flow"></a>Разъем журналов Azure Monitor для логических приложений и потока
[Приложения Azure Logic Apps](/azure/logic-apps/) и [Power Automate](https://ms.flow.microsoft.com) позволяют создавать автоматизированные рабочие процессы, используя сотни действий для различных служб. Разъем журналов Azure Monitor logs позволяет создавать рабочие процессы, которые извлекают данные из рабочего пространства log Analytics или приложения Application Insights в Azure Monitor. В этой статье описаны действия, включенные в разъем, и содержится пошаговая работа для создания рабочего процесса с использованием этих данных.

Например, можно создать логическое приложение для использования данных журнала Azure Monitor в уведомлении по электронной почте Office 365, создать ошибку в Azure DevOps или опубликовать сообщение Slack.  Вы можете запускать рабочие процессы с помощью простого расписания или какого-либо действия в подключенной службе, например при получении почты или твита. 

## <a name="actions"></a>Действия
В следующей таблице описаны действия, включенные в разъем журналов Azure Monitor. Оба позволяют запускать журнал запроса в отношении рабочего пространства Log Analytics или приложения Application Insights. Разница заключается в способе возврата данных.

> [!NOTE]
> Разъем журналов Azure Monitor заменяет [разъем Analytics журнала Azure](https://docs.microsoft.com/connectors/azureloganalytics/) и [разъем Azure Application Insights.](https://docs.microsoft.com/connectors/applicationinsights/) Этот разъем обеспечивает ту же функциональность, что и другие, и является предпочтительным методом для выполнения запроса в отношении рабочего пространства Log Analytics или приложения Application Insights.


| Действие | Описание |
|:---|:---|
| [Выполнить запрос и список результатов](https://docs.microsoft.com/connectors/azuremonitorlogs/#run-query-and-list-results) | Возвращает каждую строку в качестве собственного объекта. Используйте это действие, когда требуется работать с каждой строкой отдельно в остальной части рабочего процесса. За действием обычно следует [для каждого действия.](../../logic-apps/logic-apps-control-flow-loops.md#foreach-loop) |
| [Запуск запроса и визуализации результатов](https://docs.microsoft.com/connectors/azuremonitorlogs/#run-query-and-visualize-results) | Возвращает все строки в наборе результатов в виде одного отформатированных объектов. Используйте это действие, когда требуется использовать результаты, настроенные вместе в остальной части рабочего процесса, например отправку результатов по почте.  |

## <a name="walkthroughs"></a>Пошаговые руководства
Следующие учебники иллюстрируют использование разъемов Azure Monitor в приложениях Azure Logic Apps. Вы можете выполнить этот же пример с Power Automate, с той лишь разницей, как создать исходный рабочий процесс и запустить его, когда он завершен. Конфигурация рабочего процесса и действий одинакова между обоими. Для начала [см.](https://docs.microsoft.com/power-automate/get-started-logic-template)


### <a name="create-a-logic-app"></a>Создание приложения логики

Перейдите к **логическим приложениям** на портале Azure и нажмите **Добавить**. Выберите **группу подписки,** **ресурсы**и **регион** для хранения нового приложения логики, а затем дайте ему уникальное имя. Настройка **log Analytics** можно включить для сбора данных о времени выполнения и событиях, описанных в [журналах Setup Azure Monitor, и сбора диагностических данных для приложений azure Logic Apps.](../../logic-apps/monitor-logic-apps-log-analytics.md) Эта настройка не требуется для использования разъема журналов Azure Monitor.

![Создание приложения логики](media/logicapp-flow-connector/create-logic-app.png)


Нажмите **Обзор и создайте,** а затем **создайте**. Когда развертывание будет завершено, нажмите **Перейдите на ресурс,** чтобы открыть **Logic Apps Designer.**

### <a name="create-a-trigger-for-the-logic-app"></a>Создание триггера для приложения логики
Под **стартом с общим триггером**выберите **Recurrence**. Это создает логическое приложение, которое автоматически работает с регулярным интервалом. В **частотной** коробке действия выберите **День** и в поле **Interval,** введите **1** для запуска рабочего процесса один раз в день.

![Повторение действий](media/logicapp-flow-connector/recurrence-action.png)

## <a name="walkthrough-mail-visualized-results"></a>Пошаговая прогулка: Почта визуализированные результаты
В следующем уроке показано, как создать логическое приложение, которое отправляет результаты запроса журнала Azure Monitor по электронной почте. 

### <a name="add-azure-monitor-logs-action"></a>Добавление действий журналов мониторинга Azure
Нажмите **новый шаг,** чтобы добавить действие, которое выполняется после повторения действия. Под **выберите действие,** введите **лазурный монитор,** а затем выберите **журналы azure Monitor.**

![Действия журналов Azure Monitor](media/logicapp-flow-connector/select-azure-monitor-connector.png)

Щелкните **Azure Log Analytics – Run query and visualize results** (Azure Log Analytics – выполнить запрос и отобразить результаты).

![Запуск запроса и визуализация действий результатов](media/logicapp-flow-connector/select-query-action-visualize.png)


### <a name="add-azure-monitor-logs-action"></a>Добавление действий журналов мониторинга Azure

Выберите **группу** **подписки** и ресурсов для рабочего пространства Log Analytics. Выберите *рабочее пространство для* анализа журнала для **типа ресурсов,** а затем выберите имя рабочего пространства под **названием ресурсов.**

В окне **Запрос** добавьте следующий запрос журнала.  

```Kusto
Event
| where EventLevelName == "Error" 
| where TimeGenerated > ago(1day)
| summarize TotalErrors=count() by Computer
| sort by Computer asc   
```

Выберите *набор в запросе* для **диапазона времени** и **HTML Таблица** для **типа диаграммы.**
   
![Запуск запроса и визуализация действий результатов](media/logicapp-flow-connector/run-query-visualize-action.png)

Почта будет отправлена учетной записью, связанной с текущим соединением. Вы можете указать другую учетную запись, нажав на **подключение Конъюнтом перемены.**

### <a name="add-email-action"></a>Добавление действия по электронной почте

Нажмите **на новый шаг,** а затем нажмите **кнопку и добавьте действие.** В **рамках группы «Выберите действие,** введите **прогноз»,** а затем выберите **Office 365 Outlook.**

![Выберите разъем Outlook](media/logicapp-flow-connector/select-outlook-connector.png)

Выберите **Отправить электронное письмо (V2).**

![Окно выбора Office 365 Outlook](media/logicapp-flow-connector/select-mail-action.png)

Нажмите в любом месте в поле **тела,** чтобы открыть окно **динамического содержимого** открывается значениями из предыдущих действий в приложении логики. Выберите **Подробнее,** а затем **орган,** который является результатом запроса в действии Log Analytics.

![Выбор текста](media/logicapp-flow-connector/select-body.png)

В окне **Кому** укажите адрес электронной почты получателя, а в окне **Тема** — тему сообщения. 

![Действия по почте](media/logicapp-flow-connector/mail-action.png)


### <a name="save-and-test-your-logic-app"></a>Сохранение и тестирование приложения логики
Нажмите **Сохранить,** а затем **запустить** для выполнения тестового запуска приложения логики.

![Сохранение и запуск](media/logicapp-flow-connector/save-run.png)


Когда логическое приложение завершится, проверьте указанную вами почту получателя.  Вы должны получить сообщение с текстом, подобным этому:

![Пример электронного сообщения](media/logicapp-flow-connector/sample-mail.png)



## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о запросах журнала в Azure Monitor см. в [этой статье](../log-query/log-query-overview.md).
- Узнайте больше о [приложениях логики](/azure/logic-apps/)
- Дополнительные сведения о [Microsoft Flow](https://ms.flow.microsoft.com).

