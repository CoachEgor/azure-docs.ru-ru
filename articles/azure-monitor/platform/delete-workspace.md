---
title: Удаление и восстановление рабочей области Azure Log Analytics | Документация Майкрософт
description: Узнайте, как удалить рабочую область Log Analytics, если она была создана в личной подписке, или как изменить структуру модели рабочей области.
ms.subservice: logs
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 05/26/2020
ms.openlocfilehash: 3784eda2db5f375f04cdde84108a78ae277baf60
ms.sourcegitcommit: 95269d1eae0f95d42d9de410f86e8e7b4fbbb049
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/26/2020
ms.locfileid: "83860670"
---
# <a name="delete-and-recover-azure-log-analytics-workspace"></a>Удаление и восстановление рабочей области Azure Log Analytics

В этой статье объясняется понятие обратимого удаления в рабочей области Azure Log Analytics и восстановление удаленной рабочей области.

## <a name="considerations-when-deleting-a-workspace"></a>Важные моменты при удалении рабочей области

При удалении рабочей области Log Analytics выполняется операция обратимого удаления, позволяющая восстановить рабочую область, включая ее данные и подключенные агенты, в течение 14 дней. По завершении периода обратимого удаления все данные рабочей области не смогут быть восстановлены — они будут помещены в очередь необратимого удаления и полностью стерты в течение 30 дней. Имя рабочей области будет освобождено, и его можно будет использовать для создания новой области.

> [!NOTE]
> Если вы хотите проигнорировать обратимое удаление и удалить рабочую область без возможности восстановления, выполните действия, описанные в статье по [перманентному удалению рабочей области](#permanent-workspace-delete).

Необходимо соблюдать осторожность при удалении рабочей области, так как в ней могут быть важные данные и настройки, удаление которых может отрицательно повлиять на работу службы. Данные агенты, решения и службы Azure хранят свои данные в Log Analytics:

* Решения для управления
* Служба автоматизации Azure
* агенты, работающие на виртуальных машинах Windows и Linux;
* агенты, работающие на компьютерах Windows и Linux в вашей среде;
* System Center Operations Manager

Операция обратимого удаления удаляет ресурс рабочей области и тем самым повреждает настройки разрешений для пользователей. Если пользователи связаны с другими рабочими областями, они смогут продолжить использовать Log Analytics в этих рабочих областях.

## <a name="soft-delete-behavior"></a>Поведение обратимого удаления

Операция удаления рабочей области удаляет ресурс рабочей области диспетчера ресурсов, делая его внешне недоступным, но его конфигурация и данные хранятся в течение 14 дней. Все агенты и группы управления System Center Operations Manager, для которых настроена отправка отчетов в рабочую область, будут продолжать работу в потерянном состоянии во время периода обратимого удаления. Служба также предоставляет механизм восстановления удаленной рабочей области, включая все данные и связанные ресурсы, по сути отменяя удаление.

> [!NOTE] 
> Установленные решения и связанные службы, такие как учетная запись службы автоматизации Azure, окончательно удаляются из рабочей области в процессе удаления, и их невозможно восстановить. После процедуры восстановления их необходимо будет перенастроить, чтобы вернуть рабочую область в ранее настроенное состояние.

Удалить рабочую область можно с помощью [PowerShell](https://docs.microsoft.com/powershell/module/azurerm.operationalinsights/remove-azurermoperationalinsightsworkspace?view=azurermps-6.13.0), [REST API](https://docs.microsoft.com/rest/api/loganalytics/workspaces/delete) или через [портал Azure](https://portal.azure.com).

### <a name="azure-portal"></a>Портал Azure

1. Войдите на [портал Azure](https://portal.azure.com). 
2. На портале Azure щелкните **Все службы**. В списке ресурсов введите **Log Analytics**. Как только вы начнете вводить символы, список отфильтруется соответствующим образом. Выберите **Рабочие области Log Analytics**.
3. В списке областей Log Analytics выберите нужную рабочую область, а затем щелкните **Удалить** вверху средней панели.
4. Появится страница подтверждения, на которой будет дана сводка приема данных в рабочей области за последнюю неделю. Введите название рабочей области для подтверждения и затем нажмите кнопку **Удалить**.

   ![Подтверждение удаления рабочей области](media/delete-workspace/workspace-delete.png)

### <a name="powershell"></a>PowerShell
```PowerShell
PS C:\>Remove-AzOperationalInsightsWorkspace -ResourceGroupName "resource-group-name" -Name "workspace-name"
```

## <a name="permanent-workspace-delete"></a>Удаление рабочей области без возможности восстановления
В определенных случаях метод обратимого удаления может быть неприменим, например при разработке и тестировании, когда необходимо повторять развертывание с теми же параметрами и именем рабочей области. Для этого вы можете проигнорировать обратимое удаление и удалить рабочую область окончательно. Операция удаления постоянной рабочей области освобождает имя рабочей области, и вы можете создать новую рабочую область с тем же именем.


> [!IMPORTANT]
> Используйте постоянную операцию удаления рабочей области с осторожностью, так как она необратима и вы не сможете восстановить рабочую область и ее данные.

Чтобы окончательно удалить рабочую область, используйте запрос REST [Workspaces — Delete](https://docs.microsoft.com/rest/api/loganalytics/workspaces/delete) с добавлением тега принудительного удаления (force):

```rst
DELETE https://management.azure.com/subscriptions/<subscription-id>/resourcegroups/<resource-group-name>/providers/Microsoft.OperationalInsights/workspaces/<workspace-name>?api-version=2015-11-01-preview&force=true
Authorization: Bearer <token>
```

Также можно выполнить эту операцию через сайт документации Azure REST:
1.  Перейдите в раздел [Workspaces — Delete](https://docs.microsoft.com/rest/api/loganalytics/workspaces/delete) в REST API и щелкните **Попробовать**. 
2.  Введите сведения о рабочей области, которую нужно навсегда удалить
3.  Добавьте новый параметр *force* со значением *true*
4.  Щелкните значок "+" справа от значения. Это добавит *force = true* в URL запроса
5.  Нажмите на кнопку *Запустить*

В качестве ответа должно появиться сообщение "200 ОК"

## <a name="recover-workspace"></a>Восстановление рабочей области
При случайном или намеренном удалении рабочей области Log Analytics служба помещает ее в состояние обратимого удаления, делая ее недоступной для операций. Имя рабочей области сохраняется во время процесса обратимого удаления и не может быть использовано для создания новой области. По окончании периода рабочая область становится недоступной для восстановления и переходит в очередь для необратимого удаления, а ее имя освобождается и в дальнейшем может быть использовано для создания новой области.

Рабочую область можно восстановить в течение периода обратимого удаления, включая ее данные, настройки и подключенные агенты. Для выполнения операции требуется права к подписке и группе ресурсов, с которыми рабочая область была связана до ее обратимого удаления, на уровне Участника. Восстановление рабочей области выполняется путем создания рабочей области Log Analytics с подробными сведениями об удаленной рабочей области, такими как:

- Идентификатор подписки
- Имя группы ресурсов
- имя рабочей области.
- Регион

### <a name="azure-portal"></a>Портал Azure

1. Войдите на [портал Azure](https://portal.azure.com). 
2. На портале Azure щелкните **Все службы**. В списке ресурсов введите **Log Analytics**. Как только вы начнете вводить символы, список отфильтруется соответствующим образом. Выберите **Рабочие области Log Analytics**. Отобразится список рабочих областей с выбранными фильтром параметрами.
3. Щелкните **Восстановить** в верхнем левом меню, чтобы открыть страницу с рабочими областями в состоянии обратимого удаления, которые можно восстановить.

   ![Восстановление рабочей области](media/delete-workspace/recover-menu.png)

4. Выберите рабочую область и щелкните **Восстановить**, чтобы восстановить эту рабочую область.

   ![Восстановление рабочей области](media/delete-workspace/recover-workspace.png)


### <a name="powershell"></a>PowerShell
```PowerShell
PS C:\>Select-AzSubscription "subscription-name-the-workspace-was-in"
PS C:\>New-AzOperationalInsightsWorkspace -ResourceGroupName "resource-group-name-the-workspace-was-in" -Name "deleted-workspace-name" -Location "region-name-the-workspace-was-in"
```

После завершения операции восстановления рабочая область и все ее данные возвращаются обратно. Решения и связанные службы навсегда удаляются из рабочей области в момент процедуры удаления, и их нужно будет перенастроить, чтобы привести рабочую область в предыдущее состояние. Некоторые данные могут быть недоступны для запроса после восстановления рабочей области до тех пор, пока не будут повторно установлены связанные решения, а их схемы — добавлены в рабочую область.

> [!NOTE]
> * Повторное создание рабочей области в течение периода обратимого удаления будет выдавать сообщение о том, что имя рабочей области уже используется. 
 
### <a name="troubleshooting"></a>Устранение неполадок
Чтобы удалить рабочую область Log Analytics, необходимо иметь разрешение на уровне *участника Log Analytics*.<br>
При создании рабочей области вы можете получить сообщение о том, что *имя рабочей области уже используется* или же *совпадает*. Эта ошибка может происходить по ряду причин:
* Имя рабочей области недоступно и используется кем-либо в вашей организации или другим клиентом.
* Рабочая область была удалена в течение последних 14 дней, а ее имя зарезервировано на период обратимого удаления. Чтобы обойти функцию обратимого удаления, окончательно удалить рабочую область и создать новую рабочую область с тем же именем, выполните следующие шаги, чтобы восстановить область и затем выполнить удаление:<br>
   1. [Восстановите](https://docs.microsoft.com/azure/azure-monitor/platform/delete-workspace#recover-workspace) рабочую область.
   2. [Навсегда удалите](https://docs.microsoft.com/azure/azure-monitor/platform/delete-workspace#permanent-workspace-delete) рабочую область.
   3. Создайте новую рабочую область, используя выбранное имя.
