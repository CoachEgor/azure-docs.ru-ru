---
title: Удаление и восстановление рабочего пространства анализа журналов Azure (ru) Документы Майкрософт
description: Узнайте, как удалить рабочую область Log Analytics, если она была создана в личной подписке, или как изменить структуру модели рабочей области.
ms.subservice: logs
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 01/14/2020
ms.openlocfilehash: ead0ac04fbd2244fce97dd043ebd44f24fb0f67f
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80054919"
---
# <a name="delete-and-recover-azure-log-analytics-workspace"></a>Удаление и восстановление рабочего пространства анализа журналов Azure

В этой статье объясняется концепция мягкого удаления рабочего пространства Azure Log Analytics и способы восстановления удаленного рабочего пространства. 

## <a name="considerations-when-deleting-a-workspace"></a>Рассмотрение при удалянии рабочего пространства

При удалении рабочего пространства Log Analytics выполняется операция с мягким удалением, позволяющая восстановить рабочее пространство, включая его данные и подключенные агенты, в течение 14 дней, независимо от того, было ли удаление случайным или преднамеренным. После периода «мягкого удаления» ресурс рабочей области и его данные не могут быть восстановлены – его данные выстраиваются в очередь для постоянного удаления и полностью удалены в течение 30 дней. Имя рабочего пространства "выпущено", и вы можете использовать его для создания нового рабочего пространства.

> [!NOTE]
> Если вы хотите переопределить поведение с мгновенным удалением и удалить рабочее пространство навсегда, выполните последующие шаги в [постоянном рабочем пространстве](#permanent-workspace-delete)удалить .

При удалении рабочего пространства необходимо проявлять осторожность, поскольку могут быть важные данные и конфигурация, которые могут негативно повлиять на работу службы. Просмотрите, какие агенты, решения и другие службы Azure и источники, храняющие их данные в журнале Analytics, такие как:

* Решения для управления
* Служба автоматизации Azure
* агенты, работающие на виртуальных машинах Windows и Linux;
* агенты, работающие на компьютерах Windows и Linux в вашей среде;
* System Center Operations Manager

Операция «мягкое удаление» удаляет ресурс рабочего пространства, и разрешение любых связанных пользователей нарушается. Если пользователи связаны с другими рабочими пространствами, они могут продолжать использовать Log Analytics с другими рабочими пространствами.

## <a name="soft-delete-behavior"></a>Поведение обратимого удаления

Операция удаления рабочего пространства удаляет ресурс менеджера рабочего пространства, но его конфигурация и данные хранятся в течение 14 дней, при этом появляется видимость удаления рабочего пространства. Любые агенты и группы управления операциями Системного центра, настроенные для отчета в рабочее пространство, остаются в состоянии сирот в период "мягкого удаления". Служба также предоставляет механизм восстановления удаленного рабочего пространства, включая его данные и подключенные ресурсы, по существу отменяя удаление.

> [!NOTE] 
> Установленные решения и связанные службы, такие как учетная запись Azure Automation, постоянно удаляются из рабочего пространства во время удаления и не могут быть восстановлены. Они должны быть перенастроены после операции восстановления, чтобы довести рабочее пространство до ранее настроенного состояния.

Вы можете удалить рабочее пространство с помощью [PowerShell,](https://docs.microsoft.com/powershell/module/azurerm.operationalinsights/remove-azurermoperationalinsightsworkspace?view=azurermps-6.13.0) [REST API](https://docs.microsoft.com/rest/api/loganalytics/workspaces/delete)или на [портале Azure.](https://portal.azure.com)

### <a name="azure-portal"></a>Портал Azure

1. Чтобы войти в систему, перейдите на [портал Azure](https://portal.azure.com). 
2. На портале Azure выберите **все сервисы.** В списке ресурсов введите **log Analytics**. Как только вы начнете вводить символы, список отфильтруется соответствующим образом. Выберите **Рабочие области Log Analytics**.
3. В списке рабочих областей анализа журналов выберите рабочее пространство, а затем нажмите **«Удалить»** из верхней части среднего стекла.
   ![Параметр "Удалить" в области свойств рабочей области](media/delete-workspace/log-analytics-delete-workspace.png)
4. Когда отобразится окно с запросом подтверждения удаления рабочей области, щелкните **Да**.
   ![Подтверждение удаления рабочей области](media/delete-workspace/log-analytics-delete-workspace-confirm.png)

### <a name="powershell"></a>PowerShell
```PowerShell
PS C:\>Remove-AzOperationalInsightsWorkspace -ResourceGroupName "resource-group-name" -Name "workspace-name"
```

## <a name="permanent-workspace-delete"></a>Постоянное удаление рабочей области
Метод «мягкого удаления» может не вписаться в некоторые сценарии, такие как разработка и тестирование, где необходимо повторить развертывание с теми же настройками и названием рабочей области. В таких случаях вы можете навсегда удалить рабочее пространство и «переопределить» период мягкого удаления. Постоянная операция удаления рабочего пространства освобождает имя рабочего пространства, и вы можете создать новое рабочее пространство с использованием того же имени.


> [!IMPORTANT]
> Используйте постоянную операцию удаления рабочего пространства с осторожностью, так как ее необратимые, и вы не сможете восстановить рабочее пространство и его данные.

Постоянное удаление рабочего пространства в настоящее время может быть выполнено через REST API.

> [!NOTE]
> Любой запрос API должен включать маркер авторизации Bearer в заголовок запроса.
>
> Вы можете приобрести токен, используя:
> - [Регистрация приложений](https://docs.microsoft.com/graph/auth/auth-concepts#access-tokens)
> - Перейдите на портал Azure с помощью консоли разработчика (F12) в браузере. Посмотрите в одном из **экземпляров?** экземпляры строки проверки подлинности под **заголовками запросов**. Это будет в *шаблоне авторизации: Носитель <token> *. Копируйте и добавляйте это в свой вызов API, как показано на примерах.
> - Перейдите на сайт документации Azure REST. **Нажмите** на любой API, скопируйте токен Bearer и добавьте его в свой вызов API.
Чтобы навсегда удалить рабочее пространство, используйте [Workspace - Удалить]( https://docs.microsoft.com/rest/api/loganalytics/workspaces/delete) вызов REST API с помощью тега силы:
>
> ```rst
> DELETE https://management.azure.com/subscriptions/<subscription-id>/resourcegroups/<resource-group-name>/providers/Microsoft.OperationalInsights/workspaces/<workspace-name>?api-version=2015-11-01-preview&force=true
> Authorization: Bearer eyJ0eXAiOiJKV1Qi….
> ```
Где 'eyJ0eXAiOiJKV1'i ...' представляет токен полного авторизации.

## <a name="recover-workspace"></a>Восстановление рабочей области

Если у вас есть разрешения на подписку и группу ресурсов, где рабочее пространство было связано до операции "мягкого удаления", вы можете восстановить его в период его мягкого удаления, включая его данные, конфигурацию и подключенные агенты. После периода смягче-удаленного рабочее пространство не воспламеняется и назначается для постоянного удаления. Имена удаленных рабочих пространств сохраняются в период смягче-удаляния и не могут быть использованы при попытке создания нового рабочего пространства.  

Восстановить рабочее пространство можно, восполнив его с помощью следующих методов создания рабочего пространства: [PowerShell](https://docs.microsoft.com/powershell/module/az.operationalinsights/New-AzOperationalInsightsWorkspace) или [REST API,]( https://docs.microsoft.com/rest/api/loganalytics/workspaces/createorupdate) пока следующие свойства заполнены удаленными деталями рабочего пространства:

* Идентификатор подписки
* Имя группы ресурсов
* имя рабочей области.
* Регион

### <a name="powershell"></a>PowerShell
```PowerShell
PS C:\>Select-AzSubscription "subscription-name-the-workspace-was-in"
PS C:\>New-AzOperationalInsightsWorkspace -ResourceGroupName "resource-group-name-the-workspace-was-in" -Name "deleted-workspace-name" -Location "region-name-the-workspace-was-in"
```

Рабочее пространство и все его данные возвращаются после операции восстановления. Решения и связанные службы были навсегда удалены из рабочего пространства, когда оно было удалено, и они должны быть перенастроены, чтобы привести рабочее пространство в ранее настроенное состояние. Некоторые данные могут быть недоступны для запроса после восстановления рабочего пространства до тех пор, пока связанные с ними решения не будут переустановлены и их схемы не будут добавлены в рабочее пространство.

> [!NOTE]
> * Восстановление рабочего пространства не поддерживается на [портале Azure.](https://portal.azure.com) 
> * Повторное создание рабочего пространства в период смягче-удаляющего указывает на то, что это имя рабочего пространства уже используется. 
> 
