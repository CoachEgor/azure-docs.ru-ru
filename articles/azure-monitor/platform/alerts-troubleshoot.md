---
title: Устранение неполадок Azure Monitor оповещений и уведомлений
description: Распространенные проблемы с Azure Monitor оповещениями и возможными решениями.
author: ofirmanor
ms.author: ofmanor
ms.topic: reference
ms.date: 03/16/2020
ms.subservice: alerts
ms.openlocfilehash: beb47f961c6f24453bd49aa5807c9d801fc199a3
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "80132324"
---
# <a name="troubleshooting-problems-in-azure-monitor-alerts"></a>Устранение неполадок в Azure Monitor оповещениях 

В этой статье обсуждаются распространенные проблемы в Azure Monitor предупреждений.

Azure Monitor оповещения заблаговременно уведомляют Вас при обнаружении важных условий в данных мониторинга. Они позволяют выявить и устранить проблемы, прежде чем пользователи системы обнаружат их. Дополнительные сведения о предупреждениях см. [в разделе Обзор оповещений в Microsoft Azure](alerts-overview.md).

## <a name="action-or-notification-on-my-alert-did-not-work-as-expected"></a>Действие или уведомление по моему оповещению не работает должным образом

Если вы видите оповещение в портал Azure, но у вас возникли проблемы с некоторыми его действиями или уведомлениями, см. следующие разделы.

## <a name="did-not-receive-expected-email"></a>Не получал ожидаемый адрес электронной почты

Если вы видите оповещение в портал Azure, но не получили сообщение, которое вы настроили, выполните следующие действия. 

1. **Было ли сообщение подавлено [правилом действий](alerts-action-rules.md)**? 

    Проверьте, щелкнув на портале созданное оповещение, и просмотрите вкладку Журнал для подавленных [групп действий](action-groups.md): 

    ![Журнал подавления правил для действий предупреждений](media/alerts-troubleshoot/history-action-rule.png)

1. **Тип действия "Azure Resource Managerная роль электронной почты"?**

    Это действие рассматривает только Azure Resource Manager назначения ролей, которые находятся в области действия подписки, и типа *User*.  Убедитесь, что роль назначена на уровне подписки, а не на уровне ресурса или группы ресурсов.

1. **Ваш почтовый сервер и почтовые ящики принимают внешние сообщения электронной почты?**

    Убедитесь, что сообщения с этих трех адресов не заблокированы:
      - azure-noreply@microsoft.com  
      - azureemail-noreply@microsoft.com
      - alerts-noreply@mail.windowsazure.com

    Обычно внутренние списки рассылки или списки рассылки блокируют сообщения с внешних адресов электронной почты. Необходимо список разрешений указанные выше адреса электронной почты.  
    Чтобы протестировать, добавьте обычный рабочий адрес электронной почты (не список рассылки) в группу действий и проверьте, приходят ли оповещения по этому адресу. 

1. **Были ли сообщения электронной почты обработаны правилами папки "Входящие" или фильтром спама?** 

    Убедитесь, что отсутствуют правила папки "Входящие", которые удаляют эти сообщения электронной почты или перемещают их в боковую папку. Например, правила для входящих сообщений могут перехватывать определенные отправители или конкретные слова в теме.

    Кроме того, проверьте следующее:
    
      - Параметры нежелательной почты почтового клиента (например, Outlook, Gmail)
      - Параметры ограничений отправителя/спама/карантина почтового сервера (например, Exchange, Office 365, G-Suite)
      - Параметры устройства безопасности электронной почты (если таковые имеются) (например, Barracuda, Cisco). 

1. **Вы случайно отменили подписывание группы действий?** 

    В сообщении электронной почты содержится ссылка для отмены подписки на группу действий. Чтобы проверить, не была ли случайно отменена подписка в этой группе действий, выполните одно из следующих действий.

    1. Откройте группу действий на портале и проверьте столбец Состояние:

    ![столбец состояния группы действий](media/alerts-troubleshoot/action-group-status.png)

    2. Выполните поиск по электронной почте, чтобы отменить подтверждение подписки:

    ![Подписка от группы действий предупреждений отменена](media/alerts-troubleshoot/unsubscribe-action-group.png)

    Для повторной подписки используйте ссылку в полученном сообщении электронной почты с подтверждением отмены подписки или удалите адрес электронной почты из группы действий, а затем снова добавьте его. 
 
1. **Были ли вы ограничены из-за большого количества сообщений электронной почты по одному адресу?** 

    Частота сообщений электронной почты [ограничена](alerts-rate-limiting.md) до 100. каждый час для каждого адреса электронной почты. Если передать это пороговое значение, отбрасываются дополнительные уведомления по электронной почте.  Проверьте, получено ли сообщение, указывающее, что адрес электронной почты был временно ограничен. 
 
   ![Ограниченная частота электронной почты](media/alerts-troubleshoot/email-paused.png)

   Если вы хотите получать большое количество уведомлений без ограничения скорости, рассмотрите возможность использования другого действия, такого как веб-перехватчик, приложение логики, функция Azure или модули Runbook службы автоматизации. ни одна из этих функций не ограничена скоростью. 

## <a name="did-not-receive-expected-sms-voice-call-or-push-notification"></a>Не получил ожидаемый SMS, голосовое вызов или Push-уведомление

Если на портале отображается вызванное предупреждение, но не получено SMS, голосовое или Push-уведомление, которое вы настроили, выполните следующие действия. 

1. **Было ли действие подавлено [правилом действий](alerts-action-rules.md)?** 

    Проверьте, щелкнув на портале созданное оповещение, и просмотрите вкладку Журнал для подавленных [групп действий](action-groups.md): 

    ![Журнал подавления правил для действий предупреждений](media/alerts-troubleshoot/history-action-rule.png)

   Если это было непреднамеренно, можно изменить, отключить или удалить правило действия.
 
1. **SMS/Voice: правильный номер телефона?**

   Проверьте действие SMS на наличие опечаток в коде страны или номере телефона. 
 
1. **SMS/Voice: вы получили ограниченную частоту?** 

    Скорость вызовов SMS и голосовой связи ограничена не более чем одним уведомлением каждые пять минут на номер телефона. Если передать это пороговое значение, уведомления будут удалены. 

      - Голосовое вызов — проверьте журнал звонков и убедитесь, что в течение предыдущих пяти минут был другой вызов из Azure. 
      - SMS. Проверьте наличие в журнале SMS сообщения о том, что для номера телефона задано ограничение скорости. 

    Если вы хотите получать большое количество уведомлений без ограничения скорости, рассмотрите возможность использования другого действия, такого как веб-перехватчик, приложение логики, функция Azure или модули Runbook службы автоматизации. ни одна из этих функций не ограничена скоростью. 
 
1. **SMS: вы случайно отменили подписывание группы действий?**

    Откройте журнал SMS и проверьте, не отказался ли доставка SMS из этой конкретной группы действий (с помощью ответа "отключить action_group_short_name") или из всех групп действий (с помощью ответа "отменить"). Для повторной подписки отправьте соответствующую команду SMS (ENABLE action_group_short_name или START) или удалите действие SMS из группы действий, а затем снова добавьте его.  Дополнительные сведения см. [в разделе поведение предупреждений SMS в группах действий](alerts-sms-behavior.md).

1. **Вы случайно заблокировали уведомления на телефоне?**

   Большинство мобильных телефонов позволяют блокировать вызовы или SMS с конкретных номеров телефонов или коротких кодов или блокировать push-уведомления от конкретных приложений (например, мобильное приложение Azure). Чтобы проверить, не были ли случайно заблокированы уведомления на телефоне, выполните поиск по документации, относящейся к телефонной операционной системе и модели, или протестируйте с другим номером телефона и телефона. 

## <a name="expected-another-type-of-action-to-trigger-but-it-did-not"></a>Ожидался другой тип действия для активации, но он не 

Если на портале отображается вызванное предупреждение, но его настроенное действие не активировалось, выполните следующие действия. 

1. **Было ли действие подавлено правилом действий?** 

    Проверьте, щелкнув на портале созданное оповещение, и просмотрите вкладку Журнал для подавленных [групп действий](action-groups.md): 

    ![Журнал подавления правил для действий предупреждений](media/alerts-troubleshoot/history-action-rule.png)
 
    Если это было непреднамеренно, можно изменить, отключить или удалить правило действия. 

1. **Не активировали веб-перехватчик?**

    1. **Заблокированы ли исходные IP-адреса?**
    
       Список разрешений [IP-адреса](action-groups.md#action-specific-information) , из которых вызывается веб-перехватчик.

    1. **Работает ли конечная точка веб-перехватчика правильно?**

       Проверьте правильность настроенной конечной точки веб-перехватчика и убедитесь, что конечная точка работает правильно. Проверьте журналы веб-перехватчика или выполните инструментирование своего кода, чтобы можно было исследовать их (например, регистрировать входящие полезные данные). 

    1. **Вы вызываете резервное время или Microsoft Teams?**  
    Каждая из этих конечных точек принимает конкретный формат JSON. Используйте [эти инструкции](action-groups-logic-app.md) , чтобы настроить действие приложения логики.

    1. **Веб-перехватчик стал недоступным или возвращали ошибки?** 

        Наш период ожидания для ответа веб-перехватчика составляет 10 секунд. Вызов веб-перехватчика будет повторен до двух дополнительных случаев, когда возвращаются следующие коды состояния HTTP: 408, 429, 503, 504 или если конечная точка HTTP не отвечает. Первый повторный вызов происходит через 10 секунд, Вторая и последняя повторная попытка происходит через 100 секунд. Если вторая повторная попытка не удалась, конечная точка больше не будет вызываться в течение 30 минут ни для одной из групп действий.

## <a name="action-or-notification-happened-more-than-once"></a>Действие или уведомление произошло несколько раз 

Если вы получили уведомление о предупреждении (например, сообщение электронной почты или SMS) несколько раз, или действие предупреждения (например, веб-перехватчик или функция Azure) было запущено несколько раз, выполните следующие действия. 

1. **Действительно ли это предупреждение?** 

    В некоторых случаях несколько аналогичных предупреждений срабатывают в одно и то же время. Таким образом, он может выглядеть так же, как одно оповещение, запускающее его действия несколько раз. Например, правило генерации оповещений журнала действий может быть настроено на срабатывание как при запуске события, так и после его завершения (успешно или неудачно), если не применять фильтрацию по полю состояние события. 

    Чтобы проверить, появились ли эти действия или уведомления из разных предупреждений, изучите сведения о предупреждении, такие как отметка времени и идентификатор предупреждения или его идентификатор корреляции. Также можно проверить список запущенных оповещений на портале. Если это так, необходимо адаптировать логику правила оповещения или иным образом настроить источник оповещения. 

1. **Повторяется ли действие в нескольких группах действий?** 

    При срабатывании предупреждения каждая из групп действий обрабатывается независимо. Таким образом, если действие (например, адрес электронной почты) появляется в нескольких активируемых группах действий, оно будет вызываться один раз для каждой группы действий. 

    Чтобы проверить, какие группы действий были активированы, перейдите на вкладку Журнал предупреждений. Вы увидите, что в правиле оповещения определены группы действий и группы действий, добавленные к предупреждению по правилам действий: 

    ![Действие повторяется в нескольких группах действий](media/alerts-troubleshoot/action-repeated-multi-action-groups.png)

## <a name="action-or-notification-has-an-unexpected-content"></a>Непредвиденное содержимое действия или уведомления

Если вы получили оповещение, но считаете, что некоторые из его полей отсутствуют или неправильные, выполните следующие действия. 

1. **Выбран правильный формат для действия?** 

    Каждый тип действия (электронная почта, веб-перехватчик и т. д.) имеет два формата: по умолчанию, устаревший формат и [более новый общий формат схемы](alerts-common-schema.md). При создании группы действий вы указываете необходимый формат для каждого действия — различные действия в группах действий могут иметь разные форматы. 

    Например, для действия веб-перехватчика: 

    ![параметр схемы действия веб-перехватчика](media/alerts-troubleshoot/webhook.png)

    Проверьте, является ли формат, указанный на уровне действий, предполагаемым. Например, вы могли разрабатывать код, реагирующий на предупреждения (веб-перехватчик, функцию, приложение логики и т. д.), ожидая одного формата, но позже в действии, которое вы или другой пользователь указал другим форматом.  

    Кроме того, проверьте формат полезных данных (JSON) для [оповещений журнала действий](activity-log-alerts-webhook.md)для оповещений [поиска по журналам](alerts-log-webhook.md) (как Application Insights, так и log Analytics), для [оповещений метрик](alerts-metric-near-real-time.md#payload-schema), для [общей схемы предупреждений](alerts-common-schema-definitions.md)и для нерекомендуемых [оповещений о классической метрике](alerts-webhooks.md).

 
1. **Оповещения журнала действий: сведения, доступные в журнале действий.** 

    [Оповещения журнала действий](activity-log-alerts.md) — это оповещения, основанные на событиях, записываемых в журнал действий Azure, например о событиях создания, обновления или удаления ресурсов Azure, событий работоспособности служб и ресурсов, а также результатов, полученных от помощника по Azure и политики Azure. Если вы получили оповещение на основе журнала действий, но некоторые необходимые поля отсутствуют или неверны, сначала проверьте события в журнале действий. Если ресурс Azure не записал искомые поля в своем событии журнала действий, эти поля не будут включены в соответствующее предупреждение. 

## <a name="action-rule-is-not-working-as-expected"></a>Правило действия работает не так, как ожидалось 

Если на портале отображается вызванное предупреждение, но связанное правило не работает должным образом, выполните следующие действия. 

1. **Включено ли правило действий?** 

    Проверьте столбец состояние правила действия, чтобы убедиться, что соответствующая роль действия включена. 

    ![графика](media/alerts-troubleshoot/action-rule-status.png) 

    Если оно не включено, можно включить правило действия, выбрав его и нажав кнопку включить. 

1. **Это предупреждение о работоспособности службы?** 

    Правила действий не влияют на оповещения о работоспособности службы (служба Monitor = "работоспособность службы"). 

1. **Действует ли правило действия с вашим оповещением?** 

    Проверьте, обрабатывало ли правило действие, щелкнув оповещение на портале, и просмотрите вкладку Журнал.

    Ниже приведен пример правила действия, подавления всех групп действий. 
 
     ![Журнал подавления правил для действий предупреждений](media/alerts-troubleshoot/history-action-rule.png)

    Ниже приведен пример правила действия, которое добавляет другую группу действий:

    ![Действие повторяется в нескольких группах действий](media/alerts-troubleshoot/action-repeated-multi-action-groups.png)
 

1. **Соответствует ли область правила действия и фильтр выданному оповещению?** 

    Если вы считаете, что правило действия должно быть запущено, но не должно было быть запущено, но это не так, внимательно изучите область правила действия и условия фильтра, а также свойства вызванного предупреждения. 


## <a name="how-to-find-the-alert-id-of-a-fired-alert"></a>Как найти идентификатор предупреждения об срабатывании предупреждения

При открытии обращения к конкретному запущенному оповещению (например, если вы не получили уведомление по электронной почте) необходимо указать идентификатор оповещения. 

Чтобы его выбрать, выполните следующие действия.

1. В портал Azure перейдите к списку запущенных предупреждений и найдите это конкретное оповещение. Фильтры можно использовать для их нахождение. 

1. Щелкните оповещение, чтобы открыть сведения о предупреждении. 

1. Прокрутите вниз в полях "предупреждение" на первой вкладке (вкладке "Сводка"), пока не обнаружите ее и не скопируйте. Это поле также содержит вспомогательную кнопку "Копировать в буфер обмена", которую можно использовать.  

    ![найти идентификатор оповещения](media/alerts-troubleshoot/get-alert-id.png)

## <a name="problem-creating-updating-or-deleting-action-rules-in-the-azure-portal"></a>Проблема при создании, обновлении или удалении правил действий в портал Azure

Если при попытке создать, обновить или удалить [правило действия](alerts-action-rules.md)возникла ошибка, выполните следующие действия. 

1. **Вы получили ошибку разрешения?**  

    У вас должна быть [Встроенная роль участника мониторинга](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#monitoring-contributor)или конкретные разрешения, связанные с правилами действий и оповещениями.

1. **Вы проверяли параметры правила действий?**  

    Проверьте [документацию по правилу действий](alerts-action-rules.md)или команду [PowerShell Set-азактионруле в правиле действий](https://docs.microsoft.com/powershell/module/az.alertsmanagement/Set-AzActionRule?view=azps-3.5.0) . 


## <a name="next-steps"></a>Дальнейшие шаги
- Если используется оповещение журнала, см. также раздел [Устранение неполадок с оповещениями журнала](alert-log-troubleshoot.md).
- Вернитесь к [портал Azure](https://portal.azure.com) , чтобы проверить, решена ли ваша ошибка с помощью приведенных выше инструкций. 
