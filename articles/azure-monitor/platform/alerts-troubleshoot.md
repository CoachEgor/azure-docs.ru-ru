---
title: Устранение предупреждений и уведомлений о устранении проблем Azure Monitor
description: Общие проблемы с оповещениями Azure Monitor и возможными решениями.
author: ofirmanor
ms.author: ofmanor
ms.topic: reference
ms.date: 03/16/2020
ms.subservice: alerts
ms.openlocfilehash: beb47f961c6f24453bd49aa5807c9d801fc199a3
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80132324"
---
# <a name="troubleshooting-problems-in-azure-monitor-alerts"></a>Проблемы устранения неполадок в оповещениях Azure Monitor 

В этой статье рассматриваются общие проблемы в предупреждении Azure Monitor.

Оповещения Azure Monitor упреждающе уведомляют вас о том, что в данных мониторинга находятся важные условия. Они позволяют выявить и устранить проблемы, прежде чем пользователи системы обнаружат их. Для получения дополнительной информации о [оповещениях](alerts-overview.md)см.

## <a name="action-or-notification-on-my-alert-did-not-work-as-expected"></a>Действия или уведомления на моем оповещении не работали, как ожидалось

Если вы можете увидеть оповещение об увольнении на портале Azure, но имеете проблемы с некоторыми из его действий или уведомлений, смотрите следующие разделы.

## <a name="did-not-receive-expected-email"></a>Не получил ожидаемое письмо

Если вы можете увидеть оповещение об увольнении на портале Azure, но не получили электронное письмо, которое вы настроили на него, выполните следующие действия: 

1. **Было ли письмо подавлено [правилом действий?](alerts-action-rules.md)** 

    Проверьте, нажав на уволен оповещения на портале, и посмотрите на вкладку истории для подавленных [групп действий:](action-groups.md) 

    ![История подавления правил оповещения](media/alerts-troubleshoot/history-action-rule.png)

1. **Является ли тип действия "Роль менеджера ресурсов Azure email"?**

    В этом действии рассматриваются только ролевые задания менеджера ресурсов Azure, которые находятся в области подписки, и тип *пользователя.*  Убедитесь, что вы назначили роль на уровне подписки, а не на уровне ресурсов или группы ресурсов уровне.

1. **Ваш почтовый сервер и почтовый ящик принимают внешние электронные письма?**

    Убедитесь, что электронные письма с этих трех адресов не заблокированы:
      - azure-noreply@microsoft.com  
      - azureemail-noreply@microsoft.com
      - alerts-noreply@mail.windowsazure.com

    Обычно внутренние списки рассылки или списки рассылки блокируют электронные письма с внешних адресов электронной почты. Вам нужно в белый список выше адреса электронной почты.  
    Чтобы протестировать, добавьте обычный рабочий адрес электронной почты (не список рассылки) в группу действий и посмотреть, если оповещения поступают на это письмо. 

1. **Обработано ли письмо по правилам "Входящие" или спам-фильтру?** 

    Убедитесь, что нет правил почтового ящика, которые удаляют эти письма или перемещают их в боковую папку. Например, правила папки "Входящие" могут улавливать конкретных отправителей или конкретные слова в теме.

    Кроме того, проверьте:
    
      - настройки спама вашего почтового клиента (например, Outlook, Gmail)
      - ограничения отправителя / настройки спама / карантинные настройки вашего почтового сервера (например, Exchange, Office 365, G-suite)
      - настройки вашего почтового прибора безопасности, если таковые имеется (например, Barracuda, Cisco). 

1. **Вы случайно отписались от группы действий?** 

    Оповещения электронной почты обеспечивают ссылку на отписаться от группы действий. Чтобы проверить, если вы случайно отписались от этой группы действий, либо:

    1. Откройте группу действий на портале и проверьте столбец «Статус»:

    ![столбец состояния группы действий](media/alerts-troubleshoot/action-group-status.png)

    2. Поиск электронной почты для подтверждения отписаться:

    ![отписаться от группы действий оповещения](media/alerts-troubleshoot/unsubscribe-action-group.png)

    Чтобы подписаться еще раз - либо использовать ссылку в письме подтверждения подписки вы получили, или удалить адрес электронной почты из группы действий, а затем добавить его обратно. 
 
1. **Вы были оценены ограничено из-за многих писем собирается на один адрес электронной почты?** 

    Электронная почта является [ставка ограничена](alerts-rate-limiting.md) не более чем 100 писем каждый час на каждый адрес электронной почты. При прохождении этого порога дополнительные уведомления по электронной почте будут удалены.  Проверьте, получили ли вы сообщение о том, что ваш адрес электронной почты был временно ограничен: 
 
   ![Скорость электронной почты ограничена](media/alerts-troubleshoot/email-paused.png)

   Если вы хотите получать большие объемы уведомлений без ограничения скорости, рассмотрите возможность использования различных действий, таких как webhook, logic app, функция Azure или запуски автоматизации, ни один из которых не ограничен. 

## <a name="did-not-receive-expected-sms-voice-call-or-push-notification"></a>Не получил ожидаемого SMS, голосового вызова или push-уведомления

Если вы можете увидеть уволенное оповещение на портале, но не получили SMS, голосовой вызов или push-уведомление, которое вы настроили на него, выполните следующие действия: 

1. **Было ли действие подавлено [правилом действия?](alerts-action-rules.md)** 

    Проверьте, нажав на уволен оповещения на портале, и посмотрите на вкладку истории для подавленных [групп действий:](action-groups.md) 

    ![История подавления правил оповещения](media/alerts-troubleshoot/history-action-rule.png)

   Если это было непреднамеренно, можно изменить, отключить или удалить правило действия.
 
1. **SMS / голос: Ваш номер телефона правильно?**

   Проверьте действие SMS для опечаток в коде страны или номертелефона. 
 
1. **SMS / голос: Вы были ограничены тариф?** 

    Скорость SMS и голосовых вызовов ограничена не более чем одним уведомлением каждые пять минут на номер телефона. Если вы пройдете этот порог, уведомления будут удалены. 

      - Голосовой вызов - проверьте историю вызовов и убедитесь, что у вас был другой вызов от Azure в предыдущие пять минут. 
      - SMS - проверьте историю SMS для сообщения о том, что ваш номер телефона был ограничен. 

    Если вы хотите получать большие объемы уведомлений без ограничения скорости, рассмотрите возможность использования различных действий, таких как webhook, logic app, функция Azure или запуски автоматизации, ни один из которых не ограничен. 
 
1. **SMS: Вы случайно отписались от группы действий?**

    Откройте свою историю SMS и проверьте, если вы отказались от доставки SMS из этой конкретной группы действий (с помощью DISABLE action_group_short_name ответа) или из всех групп действий (с помощью ответа STOP). Чтобы подписаться снова, либо отправьте соответствующую команду SMS (ENABLE action_group_short_name или Start), либо удалите действие SMS из группы действий, а затем переместите его обратно.  Для получения дополнительной информации смотрите [поведение SMS-оповещения в группах действий.](alerts-sms-behavior.md)

1. **Вы случайно заблокировали уведомления на телефоне?**

   Большинство мобильных телефонов позволяют блокировать звонки или SMS с определенных телефонных номеров или коротких кодов, или блокировать push-уведомления из определенных приложений (таких как мобильное приложение Azure). Чтобы проверить, случайно ли вы заблокировали уведомления на телефоне, проверьте документацию, конкретную для операционной системы и модели телефона, или проверьте с другим телефоном и номером телефона. 

## <a name="expected-another-type-of-action-to-trigger-but-it-did-not"></a>Ожидалось, что другой тип действий срабатывает, но это не 

Если на портале можно увидеть оповещение об увольнении, но его настроенное действие не сработало, выполните следующие действия: 

1. **Было ли действие подавлено правилом действия?** 

    Проверьте, нажав на уволен оповещения на портале, и посмотрите на вкладку истории для подавленных [групп действий:](action-groups.md) 

    ![История подавления правил оповещения](media/alerts-troubleshoot/history-action-rule.png)
 
    Если это было непреднамеренно, можно изменить, отключить или удалить правило действия. 

1. **Разве веб-крюк не срабатывает?**

    1. **Заблокирован ли исходный IP-адрес?**
    
       Белый список [IP-адресов,](action-groups.md#action-specific-information) с которого вызывается веб-крюк.

    1. **Правильно ли работает ваша конечная точка веб-крючка?**

       Проверить конечную точку веб-крючка вы настроили правильно и конечная точка работает правильно. Проверьте журналы веб-крючка или инструмент его код, чтобы вы могли исследовать (например, войти входящие полезной нагрузки). 

    1. **Вы звоните в команды Slack или Microsoft?**  
    Каждая из этих конечных точек ожидает определенный формат JSON. Следуйте [этим инструкциям,](action-groups-logic-app.md) чтобы настроить действие логического приложения.

    1. **Ваш веб-крюк стал безответным или возвращенным ошибкам?** 

        Наш период тайм-аута для ответа webhook составляет 10 секунд. Вызов веб-крючка будет повторен до двух дополнительных раз, когда будут возвращены следующие коды статуса HTTP: 408, 429, 503, 504, или когда конечная точка HTTP не отвечает. Первый повторный вызов происходит через 10 секунд, Вторая и последняя повторная попытка происходит через 100 секунд. Если вторая повторная попытка не удалась, конечная точка больше не будет вызываться в течение 30 минут ни для одной из групп действий.

## <a name="action-or-notification-happened-more-than-once"></a>Действия или уведомления случались несколько раз 

Если вы получили уведомление о предупреждении (например, электронное письмо или SMS) более одного раза или действие оповещения (например, webhook или функция Azure) было срабатывает несколько раз, выполните следующие действия: 

1. **Это действительно то же самое предупреждение?** 

    В некоторых случаях несколько подобных оповещений выражаются примерно в одно и то же время. Таким образом, это может показаться, что одно и то же предупреждение вызвало его действия несколько раз. Например, правило оповещения о журнале активности может быть настроено для запуска как при запуске события, так и при его завершении (успешном или сбоем), не фильтруя поле состояния событий. 

    Чтобы проверить, были ли эти действия или уведомления получены из разных оповещений, изучите сведения опредупреждения, такие как метка времени и идентификатор оповещений или идентификатор корреляции. Кроме того, проверьте список уволенных предупреждений на портале. Если это так, то необходимо адаптировать логику правила оповещения или иным образом настроить источник оповещения. 

1. **Повторяется ли действие в нескольких группах действий?** 

    При увольнении оповещения каждая из его групп действий обрабатывается независимо. Таким образом, если действие (например, адрес электронной почты) отображается в нескольких группах срабатываний действий, оно будет вызываться один раз в группу действий. 

    Чтобы проверить, какие группы действий были срабатываны, проверьте вкладку истории оповещения. Вы увидите, что в правиле оповещения будут добавлены группы действий, определенные в правиле оповещения: 

    ![Действия, повторение в нескольких группах действий](media/alerts-troubleshoot/action-repeated-multi-action-groups.png)

## <a name="action-or-notification-has-an-unexpected-content"></a>Действие или уведомление имеет неожиданное содержание

Если вы получили оповещение, но считаете, что некоторые из его полей отсутствуют или неверны, выполните следующие действия: 

1. **Вы выбрали правильный формат для акции?** 

    Каждый тип действия (электронная почта, веб-крюк и т.д.) имеет два формата: по умолчанию, устаревший формат и [новый общий формат схемы.](alerts-common-schema.md) При создании группы действий указывается формат, который вы хотите за действие – различные действия в группах действий могут иметь разные форматы. 

    Например, для действий webhook: 

    ![веб-хук действий схема вариант](media/alerts-troubleshoot/webhook.png)

    Проверьте, ожидается ли, что формат, указанный на уровне действий, является ожидаемым. Например, вы можете разработать код, который реагирует на оповещения (webhook, функция, приложение логики и т.д.), ожидая один формат, но позже в действии вы или другой человек указал другой формат.  

    Кроме того, проверьте формат полезной нагрузки (JSON) для [оповещения о журнале активности,](activity-log-alerts-webhook.md)для [оповещения о поиске журналов](alerts-log-webhook.md) (как исследования приложений и аналитики журнала), для [метрических предупреждений,](alerts-metric-near-real-time.md#payload-schema)для [общей схемы оповещения](alerts-common-schema-definitions.md), и для универшенных [классических метрических предупреждений.](alerts-webhooks.md)

 
1. **Оповещения о журнале активности: Доступна ли информация в журнале действий?** 

    [Оповещения журналов активности](activity-log-alerts.md) — это оповещения, основанные на событиях, написанных в журнале активности Azure, такие как события о создании, обновлении или утихе ресурсов Azure, события работы службы и работоспособности ресурсов, а также выводы из Azure Advisor и Политики Azure. Если вы получили оповещение на основе журнала активности, но некоторые поля, которые вам нужны, отсутствуют или неверны, сначала проверьте события в самом журнале активности. Если ресурс Azure не написал поля, которые вы ищете в своем событии журнала активности, эти поля не будут включены в соответствующее предупреждение. 

## <a name="action-rule-is-not-working-as-expected"></a>Правило действий работает не так, как ожидалось 

Если на портале можно увидеть оповещение об увольнении, но соответствующее правило действий не сработало, как ожидалось, выполните следующие действия: 

1. **Включено ли правило действия?** 

    Проверьте столбец состояния состояния действия, чтобы убедиться, что включена соответствующая роль действия. 

    ![графика](media/alerts-troubleshoot/action-rule-status.png) 

    Если он не включен, можно включить правило действия, выбрав его и нажав Enable. 

1. **Это оповещение о работоспособности службы?** 

    Предупреждения о работоспособности службы (служба мониторинга - "Service Health") не затрагиваются правилами действий. 

1. **Действовало ли правило действия по вашему сигналу тревоги?** 

    Проверьте, обработало ли правило действия ваше оповещение, нажав на выпущенное оповещение на портале, и посмотрите на вкладку «История».

    Вот пример правила действий, подавляющего все группы действий: 
 
     ![История подавления правил оповещения](media/alerts-troubleshoot/history-action-rule.png)

    Вот пример правила действий, добавляя другую группу действий:

    ![Действия, повторение в нескольких группах действий](media/alerts-troubleshoot/action-repeated-multi-action-groups.png)
 

1. **Соответствует ли область действия правил и фильтра предупреждению об увольнении?** 

    Если вы считаете, что правило действия должно было быть уволено, но не смогло его сделать, или что оно не должно было выстрелить, но оно было запущено, внимательно изучите область действия и условия фильтрации по сравнению с свойствами уволенного оповещения. 


## <a name="how-to-find-the-alert-id-of-a-fired-alert"></a>Как найти идентификатор оповещения уволенного оповещения

При открытии дела о конкретном предупреждении (например, если вы не получили уведомление по электронной почте), вам необходимо будет предоставить идентификатор оповещения. 

Чтобы найти его, выполните следующие действия:

1. На портале Azure перейдите к списку готовых оповещений и найдите это конкретное оповещение. Вы можете использовать фильтры, чтобы помочь вам найти его. 

1. Нажмите на оповещение, чтобы открыть информацию о предупреждении. 

1. Прокрутите вниз в полях оповещения первой вкладки (вкладка резюме), пока не найдете ее и не скопируйте. Это поле также включает в себя "Копировать буфер обмена" кнопку помощника вы можете использовать.  

    ![найти идентификатор оповещения](media/alerts-troubleshoot/get-alert-id.png)

## <a name="problem-creating-updating-or-deleting-action-rules-in-the-azure-portal"></a>Создание, обновление или удаляние правил действий на портале Azure

Если вы получили ошибку при попытке создать, обновить или удалить [правило действия,](alerts-action-rules.md)выполните следующие действия: 

1. **Вы получили ошибку разрешения?**  

    Вы должны иметь [встроенную роль вкладчика мониторинга](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#monitoring-contributor)или конкретные разрешения, связанные с правилами действий и оповещениями.

1. **Вы проверили параметры правила действия?**  

    Проверьте [документацию правила действий](alerts-action-rules.md)или команду [правила действий PowerShell Set-AzActionRule.](https://docs.microsoft.com/powershell/module/az.alertsmanagement/Set-AzActionRule?view=azps-3.5.0) 


## <a name="next-steps"></a>Дальнейшие действия
- При использовании оповещения о [Troubleshooting Log Alerts](alert-log-troubleshoot.md)журнале также см.
- Вернитесь на [портал Azure,](https://portal.azure.com) чтобы проверить, решили ли вы свою проблему с руководством выше 
