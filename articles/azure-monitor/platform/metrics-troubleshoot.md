---
title: Устранение неполадок в метрических диаграммах Azure Monitor
description: Устранение проблем с созданием, настройкой или интерпретацией метрических диаграмм
author: vgorbenko
services: azure-monitor
ms.topic: conceptual
ms.date: 04/23/2019
ms.author: vitalyg
ms.subservice: metrics
ms.openlocfilehash: e1ad4e53596b8228bdef5beb18aa250a9512c49f
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "77659668"
---
# <a name="troubleshooting-metrics-charts"></a>Устранение неполадок с диаграммами метрик

Используйте эту статью, если вы столкнулись с проблемами с созданием, настройкой или интерпретацией диаграмм в Explorer метрик Azure. Если вы новичок в метриках, узнайте о [начале работы с исследователем метрик](metrics-getting-started.md) и [расширенными функциями исследователя метрик.](metrics-charts.md) Вы также можете увидеть [примеры](metric-chart-samples.md) настроенных метрических диаграмм.

## <a name="cant-find-your-resource-to-select-it"></a>Не успокоив ресурс для его выбора

Вы нажали кнопку **Выбрать ресурс**, но ресурс в не отображается в диалоговом окне средства выбора ресурсов.

**Решение:** Исследователь метрик требует, чтобы вы выбирали подписки и группы ресурсов, прежде чем перечислять доступные ресурсы. Если ресурс не отображается, сделайте следующее:

1. Убедитесь, что в раскрывающемся списке **Подписка** выбрана нужная подписка. Если подписка не включена в список, щелкните **Параметры каталога и подписки** и добавьте подписку с ресурсом.

1. Убедитесь, что вы выбрали правильную группу ресурсов.
    > [!WARNING]
    > Для наилучшей производительности при первом открытии обозревателя метрик раскрывающийся список **Группа ресурсов** не содержит предварительно выбранных групп ресурсов. Выберите хотя бы одну группу, чтобы увидеть ресурсы.

## <a name="chart-shows-no-data"></a>Диаграмма не показывает данных

Иногда диаграммы могут отображать сядек и не отображать данные после выбора правильных ресурсов и метрик. Такое поведение может быть вызвано несколькими из следующих причин:

### <a name="microsoftinsights-resource-provider-isnt-registered-for-your-subscription"></a>Поставщик ресурсов Microsoft.Insights не зарегистрирован для подписки

Для обзора метрик необходимо зарегистрировать поставщика ресурсов *Microsoft.Insights* в вашей подписке. Во многих случаях он регистрируется автоматически (то есть после настройки правила генерации оповещений, настройки параметров диагностики для любого ресурса или настройки правила автомасштабирования). Если поставщик ресурсов Microsoft.Insights не зарегистрирован, необходимо вручную зарегистрировать его, выяснив следующие шаги, описанные в [поставщиках ресурсов Azure и типах.](../../azure-resource-manager/management/resource-providers-and-types.md)

**Решение:** Открытые **подписки,** **вкладка поставщиков ресурсов** и проверка того, что *Microsoft.Insights* зарегистрирована для вашей подписки.

### <a name="you-dont-have-sufficient-access-rights-to-your-resource"></a>У вас недостаточно прав для доступа к ресурсу

В Azure для доступа к метрикам используется [управление доступом на основе ролей (RBAC)](../../role-based-access-control/overview.md). Вы должны иметь роль [читателя данных мониторинга](../../role-based-access-control/built-in-roles.md#monitoring-reader), [участника мониторинга](../../role-based-access-control/built-in-roles.md#monitoring-contributor) или [участника](../../role-based-access-control/built-in-roles.md#contributor) для просмотра метрик по любому ресурсу.

**Решение:** Убедитесь, что у вас есть достаточно едоков для ресурса, с которого вы изучаете метрики.

### <a name="your-resource-didnt-emit-metrics-during-the-selected-time-range"></a>Ресурс не сгенерировал метрики для выбранного диапазона времени

Некоторые ресурсы генерируют метрики только в определенных случаях. Например, Azure не будет собирать метрики для остановленных виртуальных машин. Другие ресурсы могут генерировать свои метрики только при соблюдении некоторых условий. Например, метрика, отображающая время обработки транзакции, требует наличия по меньшей мере одной транзакции. При отсутствии транзакций в выбранном диапазоне времени диаграмма будет пуста. Кроме того, хотят большинство метрик в Azure собираются ежеминутно, частота сбора некоторых из них меньше. Подробные сведения о метриках и их просмотре см. в документации по метрикам.

**Решение:** Измените время диаграммы в более широком диапазоне. Вы можете начать с "Последние 30 дней", используя большую детализацию времени (или опираясь на "Автоматическое время детализации" вариант).

### <a name="you-picked-a-time-range-greater-than-30-days"></a>Вы выбрали диапазон времени более 30 дней

[Большинство метрик в Azure хранятся 93 дня](data-platform-metrics.md#retention-of-metrics). Но вы можете запрашивать для отображения на отдельной диаграмме данные не более чем за 30 дней. Это ограничение не применяется к [метрикам на основе журналов](../app/pre-aggregated-metrics-log-metrics.md#log-based-metrics).

**Решение:** Если вы видите пустую диаграмму или диаграмму отображает только часть метрических данных, убедитесь, что разница между датами начала и конца в сборщике времени не превышает 30-дневного интервала.

### <a name="all-metric-values-were-outside-of-the-locked-y-axis-range"></a>Все значения метрик находились вне диапазона зафиксированной оси Y

[Зафиксировав границы оси Y в диаграмме](metrics-charts.md#lock-boundaries-of-chart-y-axis), вы можете непреднамеренно создать условия, при которых линия диаграммы не будет отображаться. Например, если ось Y зафиксирована по диапазону от 0 % до 50 %, а метрика имеет постоянное значение 100 %, линия диаграммы всегда будет отрисовываться за пределами видимой области, а диаграмма будет пустой.

**Решение:** Убедитесь, что границы y-оси диаграммы не заблокированы за пределами диапазона значений метрики. Если границы оси Y зафиксированы, возможно, вам потребуется временно сбросить их, чтобы значения метрик не выходили за пределы диапазона для диаграммы. Фиксирование диапазона оси Y не рекомендуется с включенной автоматической детализацией для диаграмм с агрегатами **sum**, **min** и **max**, так как их значения изменятся с заданной детализацией при изменении размеров окна браузера или разрешения экрана. А после выбора другого значения детализации область отображения диаграммы может стать пустой.

### <a name="you-are-looking-at-a-guest-os-metric-but-didnt-enable-azure-diagnostic-extension"></a>Вы просматриваете метрика Гостевой ОС, но не позволяете диагностическое расширение Azure

Сбор метрик **гостевой ОС** требует настройки расширения "Диагностика Azure" или его включения с помощью панели **Параметры диагностики** для вашего ресурса.

**Решение:** Если расширение Azure Diagnostics включено, но вы все еще не можете увидеть ваши метрики, выполните последующие шаги, изложенные в [руководстве по устранению неполадок Azure Diagnostics Extension.](diagnostics-extension-troubleshooting.md#metric-data-doesnt-appear-in-the-azure-portal) Также можно ознакомиться с шагами по устранению неполадок для [Неусстышного пространства имен оС и метрик](metrics-troubleshoot.md#cannot-pick-guest-os-namespace-and-metrics)

## <a name="error-retrieving-data-message-on-dashboard"></a>Сообщение "Ошибка извлечения данных" на панели мониторинга

Эта проблема может произойти при создании панели мониторинга с использованием устаревшей метрики, которая удалена из Azure. Чтобы убедиться, что это так, откройте вкладку **Метрики** ресурса и проверьте доступные метрики в средстве выбора метрик. Если метрика не отображается, это значит, что она удалена из Azure. Как правило, устаревшие метрики заменяются новыми оптимизированными метриками, которые предоставляют аналогичные сведения о работоспособности ресурсов.

**Решение:** Обновление неисправной плитки, выбрав альтернативную метрику для диаграммы на панели мониторинга. См. [список доступных метрик для служб Azure](metrics-supported.md).

## <a name="chart-shows-dashed-line"></a>Диаграмма показывает пунктирной линии

Диаграммы метрик Azure используют стиль линии пунктирных, чтобы указать, что существует недостающее значение (также известное как «нулевая величина») между двумя известными точками данных о времени. Например, если в селектора времени вы выбрали детализацию времени "1 минута", но о метрике сообщалось в 07:26, 07:27, 07:29 и 07:30 (обратите внимание на минутный разрыв между второй и третьей точками данных), то пунктирная линия соединится 07:27 и 07:29, и твердая линия соединится все остальные точки данных. Линия пунктирной спускается к нулю, когда в метрике используется **количество** и агрегация **сумм.** Для **avg,** **мин** или **макс** агрегации, пунктирной линии соединяет две ближайшие известные точки данных. Также, если данные отсутствуют в крайней правой или левой части диаграммы, пунктирная линия расширяется в направлении отсутствующей точки данных.
  ![изображение метрики](./media/metrics-troubleshoot/missing-data-point-line-chart.png)

**Решение:** Такое поведение является дизайном. Это удобно для определения отсутствующих точек данных. Диаграмма линии является превосходным выбором для визуализации тенденций метрик высокой плотности, но может быть трудно интерпретировать для метрик с редкими значениями, особенно когда соотношения значений с зерном времени имеет важное значение. Пунктирные линии упрощают чтение этих графиков, но если они все равно непонятны, попробуйте представить метрики на диаграмме другого типа. Например, рассеянная диаграмма сюжета для одной и той же метрики ясно показывает каждый раз, когда зерно, только визуализируя точку, когда есть значение и пропуская точку данных вообще, когда значение отсутствует: ![метрическое изображение](./media/metrics-troubleshoot/missing-data-point-scatter-chart.png)

   > [!NOTE]
   > Если вы все равно хотите рассматривать метрику на линейном графике, вы можете оценить степень детализации времени, перемещая по графику курсор мыши и выделяя точки данных под указателем мыши.

## <a name="chart-shows-unexpected-drop-in-values"></a>Диаграмма показывает неожиданное падение значений

Во многих случаях кажущийся спад значений метрик объясняется некорректным толкованием отображаемых на диаграмме данных. Вас может ввести в заблуждение спад значений сумм или счетчиков, если диаграмма отображает данные за последние минуты, так как последние точки данных метрик еще не были получили или обработаны Azure. В зависимости от службы, задержка на обработку метрик может составлять две минуты. Для диаграмм, показывающих недавний диапазон времени с 1- или 5-минутной детализацией, падение значения ![за последние несколько минут становится более заметным: метрическое изображение](./media/metrics-troubleshoot/drop-in-values.png)

**Решение:** Такое поведение является дизайном. Мы считаем, что отображение данных сразу же после их получения полезно, даже если они *отрывочны* или *неполны*. Они позволяют вам быстрее принять важное решение и без задержек начать исследование. Например, для метрики, которая отображает число сбоев, отображение неполного значения X позволяет вам сделать вывод, что за конкретную минуту произошло по меньшей мере X сбоев. Благодаря этому вы можете немедленно начать исследование, а не ожидать получения точного значения сбоев для этой минуты, которое в итоге может быть не настолько важным. Диаграмма будет обновлена после получения полного набора данных, но при этом также могут быть отображены новые неполные точки данных для самых последних минут.

## <a name="cannot-pick-guest-os-namespace-and-metrics"></a>Не удается выбрать пространство имен гостевой ОС и метрики

Виртуальные машины и наборы виртуальных машин имеют две категории метрик: показатели **виртуального мотоста,** которые собираются средой хостинга Azure, и метрики **гостевой ОС (классические),** которые собираются [агентом мониторинга,](agents-overview.md) работающим на виртуальных машинах. Для установки агента мониторинга включите [расширение диагностики Azure](diagnostics-extension-overview.md).

По умолчанию метрики гостевой ОС сохраняются в учетной записи хранения Azure, которую можно выбрать на вкладке **Параметры диагностики** вашего ресурса. Если метрики гостевой ОС не собираются или обозреватель метрик не может получить к ним доступ, вам будет отображаться только пространство имен метрик для **узла виртуальной машины**:

![изображение метрики](./media/metrics-troubleshoot/cannot-pick-guest-os-namespace.png)

**Решение:** Если вы не видите **гостевой ОС (классический)** пространство имен и метрик в метриках explorer:

1. Убедитесь, что [расширение диагностики Azure](diagnostics-extension-overview.md) включено и настроено на сбор метрик.
    > [!WARNING]
    > Вы не можете использовать [агент Log Analytics](agents-overview.md#log-analytics-agent) (также называется Microsoft Monitoring Agent, или MMA) для отправки метрик **гостевой ОС** в учетную запись хранения.

1. Убедитесь, что поставщик ресурсов **Microsoft.Insights** [зарегистрирован для подписки.](metrics-troubleshoot.md#microsoftinsights-resource-provider-isnt-registered-for-your-subscription)

1. Убедитесь, что учетная запись хранения не защищена брандмауэром. Порталу Azure необходим доступ к учетной записи хранения для получения данных метрик и составления диаграмм.

1. С помощью [обозревателя службы хранилища Azure](https://azure.microsoft.com/features/storage-explorer/) убедитесь, что метрики передаются в учетную запись хранения. Если метрики не собираются, выполните инструкции из [руководства по устранению неполадок для расширения диагностики Azure](diagnostics-extension-troubleshooting.md#metric-data-doesnt-appear-in-the-azure-portal).

## <a name="next-steps"></a>Дальнейшие действия

* [Узнайте о начале работы с Помощью Metric Explorer](metrics-getting-started.md)
* [Узнайте о расширенных функциях Metric Explorer](metrics-charts.md)
* [Список доступных метрик для служб Azure](metrics-supported.md)
* [Примеры настроенных диаграмм](metric-chart-samples.md)
