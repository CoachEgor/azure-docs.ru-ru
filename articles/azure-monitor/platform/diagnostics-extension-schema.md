---
title: Журнал версий схемы конфигурации расширения для Системы диагностики Azure
description: Используется для сбора данных со счетчиков производительности в виртуальных машинах Azure, масштабируемых наборах виртуальных машин, Service Fabric и облачных службах.
services: azure-monitor
author: rboucher
ms.service: azure-monitor
ms.devlang: dotnet
ms.topic: reference
ms.date: 09/20/2018
ms.author: robb
ms.subservice: diagnostic-extension
ms.openlocfilehash: 1230a9bcea01ef394a6299c50b8d5537850cfee5
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60527315"
---
# <a name="azure-diagnostics-extension-configuration-schema-versions-and-history"></a>Журнал и версии схемы конфигурации расширения системы диагностики Azure
На этой странице приведен указатель версий схемы расширения системы диагностики Azure, которые поставляются в составе пакета Microsoft Azure SDK.  

> [!NOTE]
> Расширение системы диагностики Azure — это компонент, который используется для сбора данных счетчиков производительности и других статистических данных из:
> - Виртуальные машины Azure
> - Масштабируемые наборы виртуальных машин Microsoft Azure
> - Service Fabric
> - Облачные службы
> - группы сетевой безопасности;
>
> Данная страница применяется только в том случае, если вы используете одну из этих служб.

Расширение системы диагностики Azure используется с другими продуктами диагностики корпорации Майкрософт, таких как Azure Monitor, включающий Application Insights и Log Analytics. Дополнительные сведения см. в статье [Обзор мониторинга в Microsoft Azure](../../azure-monitor/overview.md).

## <a name="azure-sdk-and-diagnostics-versions-shipping-chart"></a>Диаграмма версий пакета SDK для Azure и системы диагностики  

|Версия пакета SDK для Azure | Версия расширения системы диагностики | Модель|  
|------------------|-------------------------------|------|  
|1.x               |1.0                            |Подключаемый модуль|  
|2.0–2.4         |1.0                            |Подключаемый модуль|  
|2.5               |1.2                            |Расширение|  
|2.6               |1,3                            |"|  
|2.7               |1.4                            |"|  
|2.8               |1.5                            |"|  
|2,9               |1.6                            |"|
|2.96              |1.7                            |"|
|2.96              |1.8                            |"|
|2.96              |1.8.1                          |"|
|2.96              |1.9                            |"|
|2.96              |1.11                           |"|


 Система диагностики Azure версии 1.0 сначала поставлялась как подключаемый модуль, устанавливаемый вместе с пакетом SDK для Azure.  

 Начиная с пакета SDK 2.5 (версия системы диагностики 1.2) для системы диагностики Azure стала использоваться модель расширения. Средства, использующие новые функции, были доступны только в более новых пакетах SDK для Azure, но любая служба, использующая систему диагностики Azure, имела возможность выбрать последнюю доступную версию прямо в Azure. Например, любой пользователь, все еще использующий пакет SDK 2.5, загрузит последнюю версию, отображаемую в предыдущей таблице, даже если он не применяет новые функции.  

## <a name="schemas-index"></a>Указатель схем  
Для разных версий системы диагностики Azure используются разные схемы конфигурации.

[Схема конфигурации системы диагностики Azure 1.0](diagnostics-extension-schema-1dot0.md)  

[Схема конфигурации системы диагностики Azure 1.2](diagnostics-extension-schema-1dot2.md)  

[Схема конфигурации системы диагностики версии 1.3 и более поздние версии](diagnostics-extension-schema-1dot3.md)  

## <a name="version-history"></a>Журнал версий

### <a name="diagnostics-extension-111"></a>Расширение системы диагностики 1.11
Добавлена поддержка для приемника Azure Monitor. Сейчас этот приемник работает только с данными счетчиков производительности. Он позволяет отправлять данные счетчиков производительности виртуальной машины, масштабируемого набора виртуальных машин или облачной службы в Azure Monitor в виде пользовательских метрик. Приемник Azure Monitor поддерживает такие функции:
* Получение данных всех счетчиков производительности, отправляемых в Azure Monitor с помощью [API метрик Azure Monitor](https://docs.microsoft.com/rest/api/monitor/metrics/list).
* Настройка оповещений для всех данных счетчиков производительности, отправляемых в Azure Monitor, с помощью нового [унифицированного интерфейса оповещений](../../azure-monitor/platform/alerts-overview.md) в Azure Monitor.
* Обработка оператора подстановочного знака в счетчиках в контексте экземпляра в метрике. Например, если вы собираете данные счетчика LogicalDisk(\*)/DiskWrites/sec, вы можете отфильтровать или разделить эти данные по отдельным экземплярам для каждого логического диска (C:, D: и т. д.) для построения графика или настройки оповещения.

Определение Azure Monitor в качестве нового приемника в конфигурации расширения системы диагностики
```json
"SinksConfig": {
    "Sink": [
        {
            "name": "AzureMonitorSink",
            "AzureMonitor": {}
        },
    ]
}
```

```XML
<SinksConfig>  
  <Sink name="AzureMonitorSink">
      <AzureMonitor/>
  </Sink>
</SinksConfig>
```
> [!NOTE]
> Для настройки приемника Azure Monitor для классических виртуальных машин и классической облачной службы требуются дополнительные параметры, определяемые в закрытой конфигурации расширения системы диагностики.
>
> Дополнительные сведения см. в [документации по схеме расширения системы диагностики](diagnostics-extension-schema-1dot3.md).

Затем можно настроить счетчики производительности для перенаправления в приемник Azure Monitor.
```json
"PerformanceCounters": {
    "scheduledTransferPeriod": "PT1M",
    "sinks": "AzureMonitorSink",
    "PerformanceCounterConfiguration": [
        {
            "counterSpecifier": "\\Processor(_Total)\\% Processor Time",
            "sampleRate": "PT1M",
            "unit": "percent"
        }
    ]
},
```
```XML
<PerformanceCounters scheduledTransferPeriod="PT1M", sinks="AzureMonitorSink">  
  <PerformanceCounterConfiguration counterSpecifier="\Processor(_Total)\% Processor Time" sampleRate="PT1M" unit="percent" />  
</PerformanceCounters>
```

### <a name="diagnostics-extension-19"></a>Расширение системы диагностики версии 1.9
Добавлена поддержка Docker.


### <a name="diagnostics-extension-181"></a>Расширение системы диагностики версии 1.8.1
Вы можете указать маркер SAS вместо ключа учетной записи хранения в закрытой конфигурации. Если он указан, ключ учетной записи хранения не учитывается.


```json
{
    "storageAccountName": "diagstorageaccount",
    "storageAccountEndPoint": "https://core.windows.net",
    "storageAccountSasToken": "{sas token}",
    "SecondaryStorageAccounts": {
        "StorageAccount": [
            {
                "name": "secondarydiagstorageaccount",
                "endpoint": "https://core.windows.net",
                "sasToken": "{sas token}"
            }
        ]
    }
}
```

```xml
<PrivateConfig>
    <StorageAccount name="diagstorageaccount" endpoint="https://core.windows.net" sasToken="{sas token}" />
    <SecondaryStorageAccounts>
        <StorageAccount name="secondarydiagstorageaccount" endpoint="https://core.windows.net" sasToken="{sas token}" />
    </SecondaryStorageAccounts>
</PrivateConfig>
```


### <a name="diagnostics-extension-18"></a>Расширение системы диагностики версии 1.8
Добавлен тип хранилища в PublicConfig. StorageType может иметь значение*Table*, *Blob* и *TableAndBlob*. Значение *Table* используется по умолчанию.


```json
{
    "WadCfg": {
    },
    "StorageAccount": "diagstorageaccount",
    "StorageType": "TableAndBlob"
}
```

```xml
<PublicConfig>
    <WadCfg />
    <StorageAccount>diagstorageaccount</StorageAccount>
    <StorageType>TableAndBlob</StorageType>
</PublicConfig>
```


### <a name="diagnostics-extension-17"></a>Расширение системы диагностики версии 1.7
Добавлена возможность маршрутизации в концентратор событий.

### <a name="diagnostics-extension-15"></a>Расширение системы диагностики версии 1.5
Добавлен элемент sinks и возможность отправлять данные диагностики в [Application Insights](../../azure-monitor/app/cloudservices.md). Это упрощает диагностирование проблем в приложении, а также на уровне системы и инфраструктуры.

### <a name="azure-sdk-26-and-diagnostics-extension-13"></a>Пакет SDK для Azure 2.6 и расширение системы диагностики версии 1.3
Для проектов облачной службы, созданных в Visual Studio, были внесены следующие изменения. (Эти изменения действуют и в более поздних версиях Azure SDK.)

* Локальный эмулятор теперь поддерживает систему диагностики. Это изменение означает, что на этапе разработки и тестирования в Visual Studio вы можете собирать диагностические данные. Это позволит вам убедиться, что приложение создает правильные трассировки. При запуске проекта облачной службы в Visual Studio строка подключения `UseDevelopmentStorage=true` включает сбор диагностических данных с помощью эмулятора хранения Azure. Все диагностические данные собираются в учетную запись хранения (хранилище для разработки).
* Строка подключения к учетной записи хранения диагностической информации (Microsoft.WindowsAzure.Plugins.Diagnostics.ConnectionString) также хранится в файле конфигурации (CSCFG) службы. В пакете Azure SDK версии 2.5 учетная запись хранения диагностических данных указывается в файле diagnostics.wadcfgx.

Существуют важные различия между работой строки подключения в старых версиях пакета Azure SDK (до версии 2.4 включительно) и более новых (начиная с версии 2.6).

* В пакете SDK для Azure 2.4 и более ранних версиях строка подключения использовалась как среда выполнения подключаемого модуля диагностики, который получал из нее параметры учетной записи хранения для передачи журналов диагностики.
* В пакете SDK для Azure 2.6 и более поздних версиях Visual Studio использует строку подключения диагностики для настройки учетной записи хранения в расширении системы диагностики Azure во время публикации. Строка подключения позволяет вам указать разные учетные записи хранения для различных конфигураций службы. Visual Studio будет использовать их во время публикации. Но подключаемый модуль диагностики больше не доступен (в пакетах Azure SDK, начиная с версии 2.5), поэтому сам CSCFG-файл уже не может включить расширение диагностики. Его нужно включать отдельно с помощью таких средств, как Visual Studio или PowerShell.
* Выходные данные пакета Visual Studio содержат, среди прочего, общедоступный XML-файл конфигурации расширения диагностики для каждой роли. Это позволяет упростить процесс настройки расширения с помощью PowerShell. С помощью строки подключения диагностики Visual Studio получает из общедоступной конфигурации данные учетной записи хранения. Общедоступные файлы конфигураций создаются в папке расширений и используют шаблон `PaaSDiagnostics.<RoleName>.PubConfig.xml`. Все развертывания с использованием PowerShell могут использовать этот шаблон имени для сопоставления каждой конфигурации с ролью.
* Строку подключения из CSCFG-файла также использует портал Azure для доступа к диагностическим данным, отображаемым на вкладке **Мониторинг** . Строка подключения позволяет настроить в службе отображение на портале подробных данных мониторинга.

#### <a name="migrating-projects-to-azure-sdk-26-and-later"></a>Перенос проектов на Azure SDK версии 2.6 и выше
Когда проект переносится с Azure SDK 2.5 на Azure SDK 2.6 или более новую версию, данные учетной записи хранения диагностической информации, указанные в WADCFGX-файле, сохраняются. Чтобы воспользоваться преимуществами гибкости использования различных учетных записей хранения для разных конфигураций хранилища, необходимо вручную добавить строку подключения в проект. Если при переносе проекта на основе пакета SDK для Azure 2.4 или более ранней версии на пакет SDK для Azure 2.6 строки подключения системы диагностики сохраняются. Однако не забывайте, что в пакете SDK для Azure 2.6 строки подключения используются иначе (см. предыдущий раздел).

#### <a name="how-visual-studio-determines-the-diagnostics-storage-account"></a>Определение учетной записи хранения диагностических данных в Visual Studio
* Если в CSCFG-файле указана строка подключения диагностики, Visual Studio использует ее для настройки расширения диагностики во время публикации, а также при создании общедоступных XML-файлов конфигурации на этапе упаковки.
* Если в CSCFG-файле строка подключения диагностики не указана, Visual Studio использует для этих же целей учетную запись хранения, указанную в WADCFGX-файле.
* Строка подключения диагностики в CSCFG-файле имеет более высокий приоритет, чем учетная запись хранения в WADCFGX-файле. Если в CSCFG-файле присутствует строка подключения диагностики, Visual Studio использует именно ее, игнорируя учетную запись хранения в WADCFGX-файле.

#### <a name="what-does-the-update-development-storage-connection-strings-checkbox-do"></a>Для чего используется флажок "Обновлять строки подключения хранилища разработки"?
Флажок **Обновлять строки подключения хранилища разработки для диагностики и кэширования, используя учетную запись хранения Microsoft Azure, при публикации в Microsoft Azure** позволяет быстро заменить строку подключения хранилища для разработки учетной записью хранения Azure, указанной во время публикации.

Предположим, вы установили этот флажок, а в строке подключения диагностики указан параметр `UseDevelopmentStorage=true`. Когда вы будете публиковать проект в Azure, Visual Studio автоматически заменит строки подключения диагностики учетной записью хранения, которую вы указали в мастере публикации. Но если в строке подключения диагностики указана реальная учетная запись хранения, будет использоваться именно она.

### <a name="diagnostics-functionality-differences-between-azure-sdk-24-and-earlier-and-azure-sdk-25-and-later"></a>Функциональные различия диагностики в Azure SDK между более ранними (до 2.4 включительно) и более поздними (с 2.5 включительно) версиями
Обновляя свой проект с Azure SDK 2.4 на Azure SDK 2.5 и выше, помните о следующих функциональных различиях.

* **API конфигурации больше не используются.** Программная конфигурация диагностики доступна в пакете SDK для Azure 2.4 и более ранних версий, но в дальнейших выпусках, начиная с версии SDK для Azure 2.5, она не используется. Если конфигурация диагностики в вашем проекте определена в коде, после переноса проекта на более новую версию SDK все нужно настроить заново, иначе диагностика работать не будет. Azure SDK 2.4 используется файл конфигурации диагностики diagnostics.wadcfg, а Azure SDK 2.5 и более поздние версии — diagnostics.wadcfgx.
* **Диагностику для приложений облачной службы можно настроить только на уровне роли, а не на уровне экземпляра.**
* **Конфигурация диагностики обновляется при каждом развертывании приложения.** Если изменить конфигурацию диагностики в обозревателе сервера и повторно развернуть приложение, могут возникнуть проблемы с контролем четности.
* **В пакете SDK для Azure 2.5 и более поздних версиях аварийные дампы настраиваются в файле конфигурации диагностики, а не в коде.** Если вы настроили аварийные дампы в коде проекта, следует вручную перенести параметры из кода в файл конфигурации, так как при переходе на пакет SDK для Azure 2.6 аварийные дампы не переносятся.

