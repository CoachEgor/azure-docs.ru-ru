---
title: Передача журналов ресурсов Azure в рабочую область Log Analytics
description: Узнайте, как передавать журналы ресурсов Azure в рабочее пространство журналов журнала Analytics в Azure Monitor.
author: bwren
services: azure-monitor
ms.topic: conceptual
ms.date: 12/18/2019
ms.author: bwren
ms.subservice: logs
ms.openlocfilehash: 36bd464624118b7671a3879bcc1d34114bba9ce3
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79248597"
---
# <a name="collect-azure-platform-logs-in-log-analytics-workspace-in-azure-monitor"></a>Сбор журналов платформы Azure в рабочем пространстве log Analytics в Azure Monitor
[Платформы журналов](platform-logs-overview.md) в Azure, включая журналы деятельности Azure и журналы ресурсов, предоставляют подробную информацию о диагностике и аудите для ресурсов Azure и платформы Azure, от которой они зависят. В этой статье описывается сбор журналов ресурсов в рабочей области Log Analytics, что позволяет анализировать его с помощью других данных мониторинга, собранных в журналах Azure Monitor, используя мощные запросы журналов, а также использовать другие функции Azure Monitor, такие как оповещения и Визуализации. 


## <a name="what-you-can-do-with-platform-logs-in-a-workspace"></a>Что можно сделать с журналами платформы в рабочей области
Сбор журналов платформы в рабочее пространство Log Analytics позволяет совместно анализировать журналы всех ресурсов Azure и использовать все функции, доступные [для журналов Azure Monitor,](data-platform-logs.md) которые включают в себя следующие:

* **Запросы журнала** - Создавайте [запросы журналов](../log-query/log-query-overview.md) с помощью мощного языка запросов для быстрого анализа и получения информации о ваших диагностических данных, а также для анализа данных, собранных из других источников в Azure Monitor.
* Предупреждение - **Получайте** упреждающее уведомление о критических условиях и шаблонах, определенных в журналах ресурсов, используя [оповещения журналов в Azure Monitor.](alerts-log.md)
* **Визуализации** - Прикрепите результаты запроса журнала к панели мониторинга Azure или включите его в трудовую книгу как часть интерактивного отчета.

## <a name="prerequisites"></a>Предварительные требования
Вам нужно [создать новое рабочее пространство,](../learn/quick-create-workspace.md) если у вас его еще нет. Рабочее пространство не должно находиться в той же подписке, что и ресурс, отправляющий журналы, пока пользователь, настраивающий настройку, имеет соответствующий доступ RBAC к обеим подпискам.

## <a name="create-a-diagnostic-setting"></a>Создание параметра диагностики
Отправьте журналы платформы в рабочее пространство analytics журнала и другие направления, создав диагностическую настройку для ресурса Azure. Смотрите [Создать диагностическую настройку для сбора журналов и метрик в Azure](diagnostic-settings.md) для получения подробной информации.


## <a name="activity-log-collection"></a>Сбор журналов активности
Вы можете отправить журнал активности из любой одной подписки до пяти рабочих областей Log Analytics. Данные журнала ресурсов, собранные в рабочем пространстве Analytics log, хранятся в таблице **AzureActivity.** 

## <a name="resource-log-collection-mode"></a>Режим сбора ресурсов
Данные журнала ресурсов, собранные в рабочей области Log Analytics, хранятся в таблицах, описанных в [структуре журналов Azure Monitor.](../log-query/logs-structure.md) Таблицы, используемые журналами ресурсов, зависят от типа сбора ресурсов:

- Диагностика Azure - Все записанные данные в таблице _AzureDiagnostics._
- Ресурс-специфические - Данные записываются в отдельную таблицу для каждой категории ресурса.

### <a name="azure-diagnostics-mode"></a>Режим azure Диагностика 
В этом режиме все данные из любой [диагностической настройки](diagnostic-settings.md) будут собраны в таблице _AzureDiagnostics._ Это устаревший метод, используемый сегодня большинством служб Azure.

Поскольку несколько типов ресурсов отправляют данные в одну таблицу, их схема представляет собой супермножество схем всех собираемых типов данных.

Рассмотрим следующий пример, когда диагностические настройки собираются в одном рабочем пространстве для следующих типов данных:

- Аудит журналов службы 1 (с схемой, состоящей из столбцов A, B и C)  
- Ошибки журналы службы 1 (с схемой, состоящей из столбцов D, E и F)  
- Аудит журналов службы 2 (имеющая схему, состоящую из столбцов G, H и I)  

Таблица AzureDiagnostics будет выглядеть следующим образом:  

| ResourceProvider    | Категория     | Объект  | B  | C  | D  | E  | F  | G.  | H  | I  |
| -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- |
| Microsoft.Service1 | AuditLogs    | x1 | y1 | Z1 |    |    |    |    |    |    |
| Microsoft.Service1 | ОшибкиЛоги    |    |    |    | q1 | w1 | e1 |    |    |    |
| Microsoft.Service2 | AuditLogs    |    |    |    |    |    |    | j1 | k1 | l1 |
| Microsoft.Service1 | ОшибкиЛоги    |    |    |    | q2 | w2 | e2 |    |    |    |
| Microsoft.Service2 | AuditLogs    |    |    |    |    |    |    | j3 | k3 | l3 |
| Microsoft.Service1 | AuditLogs    | x5 | y5 | z5 |    |    |    |    |    |    |
| ... |

### <a name="resource-specific"></a>Ресурс-специфический
В этом режиме для каждой категории, выбранной в диагностической настройке, создаются отдельные таблицы в выбранном рабочем пространстве. Этот метод рекомендуется, так как он значительно упрощает работу с данными в запросах журнала, обеспечивает лучшую обнаруживаемость схем и их структуры, повышает производительность как во время задержки приема, так и во время запроса, а также в возможности предоставления прав RBAC на конкретная таблица. Все службы Azure в конечном итоге перейдут в режим ресурсо-специфический. 

Приведенный выше пример приведет к созданию трех таблиц:
 
- Таблица *Service1AuditLogLogs* следующим образом:

    | Поставщик ресурсов | Категория | Объект | B | C |
    | -- | -- | -- | -- | -- |
    | Service1 | AuditLogs | x1 | y1 | Z1 |
    | Service1 | AuditLogs | x5 | y5 | z5 |
    | ... |

- Таблица *Service1ОшибодНые Логи:*  

    | Поставщик ресурсов | Категория | D | E | F |
    | -- | -- | -- | -- | -- | 
    | Service1 | ОшибкиЛоги |  q1 | w1 | e1 |
    | Service1 | ОшибкиЛоги |  q2 | w2 | e2 |
    | ... |

- Таблица *Service2AuditLogLogs* следующим образом:  

    | Поставщик ресурсов | Категория | G. | H | I |
    | -- | -- | -- | -- | -- |
    | Сервис2 | AuditLogs | j1 | k1 | l1|
    | Сервис2 | AuditLogs | j3 | k3 | l3|
    | ... |



### <a name="select-the-collection-mode"></a>Выберите режим сбора
Большинство ресурсов Azure будут записывать данные в рабочее пространство в режиме **Azure Diagnostic** или **Resource-Specific,** не давая вам выбора. Подробную информацию о том, в каком режиме она используется, можно узнать о [документации для каждой службы.](diagnostic-logs-schema.md) Все службы Azure в конечном итоге будут использовать режим ресурсо-специфический. В рамках этого перехода некоторые ресурсы позволят выбрать режим в диагностической настройке. Необходимо указать режим, специфичный для ресурсов, для любых новых диагностических настроек, так как это упрощает управление данными и может помочь избежать сложных миграций на более поздний срок.
  
   ![Селектор режима диагностических настроек](media/resource-logs-collect-workspace/diagnostic-settings-mode-selector.png)




> [!NOTE]
> В настоящее время **диагностика Azure** и **режим, специфичный для ресурсов,** могут быть выбраны только при настройке диагностической настройки на портале Azure. Если настроить настройку с помощью CLI, PowerShell или Rest API, она будет по умолчанию для **диагностики Azure.**

Можно изменить существующую диагностическую настройку в режим, связанный с конкретнымресурсами. В этом случае данные, которые уже были собраны, будут оставаться в таблице _AzureDiagnostics_ до тех пор, пока они не будут удалены в соответствии с настройками удержания рабочего пространства. Новые данные будут собраны в выделенной таблице. Используйте [оператора профсоюза](https://docs.microsoft.com/azure/kusto/query/unionoperator) для запроса данных в обеих таблицах.

Продолжайте смотреть блог [Обновления Azure](https://azure.microsoft.com/updates/) для объявлений об службах Azure, поддерживающих режим ресурсо-специфический режим.

### <a name="column-limit-in-azurediagnostics"></a>Ограничение столбцов в AzureDiagnostics
В журналах Azure Monitor существует ограничение на свойство 500 свойств для любой таблицы. Как только этот предел будет достигнут, любые строки, содержащие данные с любым свойством за пределами первых 500, будут удалены во время приема. Таблица *AzureDiagnostics* особенно восприимчива к этому пределу, поскольку она включает в себя свойства для всех служб Azure, пишущих на нее.

Если вы собираете журналы ресурсов из нескольких служб, _AzureDiagnostics_ может превысить этот предел, и данные будут упущены. До тех пор, пока все службы Azure не будут поддерживать ресурсный режим, следует настроить ресурсы для записи в несколько рабочих областей, чтобы уменьшить вероятность достижения предела столбца 500.

### <a name="azure-data-factory"></a>Фабрика данных Azure
Фабрика данных Azure из-за очень подробного набора журналов — это служба, которая, как известно, пишет большое количество столбцов и потенциально может привести к превышению _лимита AzureDiagnostics._ Для любых диагностических параметров, настроенных до включения режима, конкретного ресурса, будет создан новый столбец для каждого однозначно названного параметра пользователя против любого действия. Дополнительные столбцы будут созданы из-за многословного характера входов и выходов активности.
 
Необходимо как можно скорее перенести журналы, чтобы использовать режим, связанный с конкретнымресурсами. Если вы не можете сделать это немедленно, промежуточной альтернативой является изоляция журналов Azure Data Factory в их собственное рабочее пространство, чтобы свести к минимуму вероятность того, что эти журналы повлияют на другие типы журналов, собираемые в рабочих пространствах.


## <a name="next-steps"></a>Дальнейшие действия

* [Подробнее о журналах ресурсов.](platform-logs-overview.md)
* [Создайте диагностическую настройку для сбора журналов и метрик в Azure.](diagnostic-settings.md)
