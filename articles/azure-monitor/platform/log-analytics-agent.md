---
title: Общие сведения об агенте Log Analytics
description: В этой статье содержатся сведения о том, как собирать данные и наблюдать за компьютерами, размещенными в Azure, локальной или другой облачной среде, с помощью Log Analytics.
ms.subservice: logs
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 02/04/2020
ms.openlocfilehash: 36b94f53d3a9113c3980c94c3b8eff0713f11814
ms.sourcegitcommit: cee72954f4467096b01ba287d30074751bcb7ff4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/30/2020
ms.locfileid: "87446533"
---
# <a name="log-analytics-agent-overview"></a>Общие сведения об агенте Log Analytics
Агент Log Analytics разработан для комплексного управления на виртуальных машинах, размещенных на облаке, на локальных компьютерах, и других отслеживаемых с помощью [System Center Operations Manager](/system-center/scom/) компьютерах. Агенты Windows и Linux отправляют в рабочую область вашего Log Analytics в Azure Monitor собранные данные из разных источников, а также уникальные журналы и метрики, как задано в решении мониторинга. Агент Log Analytics также поддерживает аналитику и другие службы в Azure Monitor, такие как [Azure Monitor для виртуальных машин](../insights/vminsights-enable-overview.md), [Центр безопасности Azure](../../security-center/index.yml) и [Служба автоматизации Azure](../../automation/automation-intro.md).

В этой статье предоставлен подробный обзор требований к агенту, системе и сети, а также различных методов развертывания.

> [!NOTE]
> Агент Log Analytics также называется агентом Microsoft Monitoring Agent (MMA) или агентом OMS Linux.

> [!NOTE]
> Расширение "Диагностика Azure" — это один из агентов, доступных для сбора данных мониторинга из гостевой операционной системы, обслуживающей вычислительные ресурсы. В статье [Общие сведения об агентах Azure Monitor](agents-overview.md) вы найдете описание разных агентов и рекомендации по выбору правильного варианта для конкретных требований.

## <a name="comparison-to-azure-diagnostics-extension"></a>Сравнение с расширением Диагностика Azure
Для получения данных мониторинга из гостевой ОС виртуальной машины Azure вы также можете использовать [Расширение Диагностика Azure](diagnostics-extension-overview.md) в Azure Monitor. Вы можете использовать любое из этих средств или оба сразу в зависимости от конкретных требований. В статье [Общие сведения об агентах Azure Monitor](agents-overview.md) приведено подробное сравнение разных агентов. 

Основные различия:

- Расширение "Диагностика Azure" может работать только с виртуальными машинами Azure. Агент Log Analytics совместим с виртуальными машинами в Azure, других облачных и локальной среде.
- Расширение "Диагностика Azure" отправляет данные в службу хранилища Azure, в [метрики мониторинга Azure](data-platform-metrics.md) (только для ОС Windows) и в Центры событий. Агент Log Analytics собирает данные в [журналы Azure Monitor](data-platform-logs.md).
- Агент Log Analytics является обязательным компонентом [решений](../monitor-reference.md#insights-and-core-solutions), [Azure Monitor для виртуальных машин](../insights/vminsights-overview.md) и других служб, например [Центра безопасности Azure](../../security-center/index.yml).

## <a name="costs"></a>Затраты
Плата за агента Log Analytics не взимается, но, возможно, вам придется оплатить полученные данные. Дополнительные сведения о ценах на данные, собираемые в рабочей области Log Analytics, см. в статье [Управление использованием и затратами с помощью журналов Azure Monitor](manage-cost-storage.md).

## <a name="data-collected"></a>Собираемые данные
В этой таблице перечислены типы собираемых из всех подключенных агентов данных, которые вы можете настроить для рабочей области Log Analytics. Список аналитических сведений, и других решений, использующих агент Log Analytics для получения данных других типов, вы сможете найти в статье [Что отслеживается Azure Monitor?](../monitor-reference.md).

| Источник данных | Описание |
| --- | --- |
| [Журналы событий Windows](data-sources-windows-events.md) | Информация, отправляемая системой ведения журналов событий Windows. |
| [Syslog](data-sources-syslog.md)                     | Информация, отправляемая системой ведения журналов событий Linux. |
| [Производительность](data-sources-performance-counters.md)  | Числовые значения, представляющие собой оценки производительности разных элементов операционной системы и рабочих нагрузок. |
| [Журналы IIS](data-sources-iis-logs.md)                 | Информация о потреблении для веб-сайтов на IIS, которые выполняются в гостевой ОС. |
| [Пользовательские журналы](data-sources-custom-logs.md)           | События из текстовых файлов на компьютерах Windows и Linux. |

## <a name="data-destinations"></a>Целевое расположение данных
Агент Log Analytics отправляет данные в рабочую область Log Analytics в Azure Monitor. Агент Windows может быть общим, отправляя данные в несколько рабочих областей и групп управления System Center Operations Manager. Агент Linux может отправлять данные только в одно назначение.

## <a name="other-services"></a>Другие службы
Агент для Linux и Windows предназначен не только для подключения к Azure Monitor, в нем также поддерживается подключение к службе автоматизации Azure для размещения гибридной рабочей роли Runbook и других служб (например, [Отслеживание изменений](../../automation/change-tracking.md), [Управление обновлениями](../../automation/update-management/update-mgmt-overview.md) и [Центр безопасности Azure](../../security-center/security-center-intro.md)). Дополнительные сведения о гибридной рабочей роли Runbook см. в разделе [Общие сведения об архитектуре автоматизации](../../automation/automation-hybrid-runbook-worker.md).  

## <a name="installation-and-configuration"></a>Установка и настройка

При использовании агентов Log Analytics для получения данных, чтобы спланировать развертывание агента, вам необходимо знать следующее:

* для получения данных от агентов Windows можно [настроить каждый агент для отправки отчетов в одну или несколько рабочих областей](agent-windows.md) даже если отчет передается в группу управления System Center Operations Manager; агент Windows может отправлять отчеты вплоть до четырех рабочих областей;
* агент Linux может отправлять отчет только в одну рабочую область;
* агент Windows поддерживает [стандарт FIPS 140](/windows/security/threat-protection/fips-140-validation), в то время как агент Linux не поддерживает его.  

Если вы используете System Center Operations Manager 2012 R2 и более поздние версии:

* каждая группа управления Operations Manager может быть [подключена только к одной рабочей области](om-agents.md);
* компьютеры Linux, передающие данные в группу управления, должны быть настроены для отправки отчетов непосредственно в рабочую область Log Analytics; если компьютеры Linux уже отправляют отчеты непосредственно в рабочую область и вы хотите отслеживать их с помощью Operations Manager, следуйте этим указаниям, чтобы [отправлять отчеты в группу управления Operations Manager](agent-manage.md#configure-agent-to-report-to-an-operations-manager-management-group);
* вы можете установить агент Log Analytics Windows на компьютере Windows и настроить его таким образом, чтобы агент отправлял отчеты как в рабочую область, связанную с Operations Manager, так и в другую рабочую область.


Существует несколько методов установки агента Log Analytics и подключения компьютера к Azure Monitor в зависимости от ваших требований. В следующей таблице описан каждый метод. Эти данные помогут вам определить, какой из методов наиболее подходящий для вашей организации.

|Источник | Метод | Описание|
|-------|-------------|-------------|
|Azure| [Вручную с помощью портала Azure](../learn/quick-collect-azurevm.md?toc=%2fazure%2fazure-monitor%2ftoc.json) | Укажите виртуальные машины для развертывания из рабочей области Log Analytics. |
| | Расширение виртуальной машины Log Analytics для [Windows](../../virtual-machines/extensions/oms-windows.md) или [Linux](../../virtual-machines/extensions/oms-linux.md) с использованием Azure CLI или шаблона Azure Resource Manager | Это расширение устанавливает агент Log Analytics на виртуальных машинах Azure и регистрирует элементы в существующей рабочей области Azure Monitor. |
| | [Azure Monitor для виртуальных машин](../insights/vminsights-enable-overview.md) | При включении мониторинга с помощью Azure Monitor для виртуальных машин устанавливается расширение и агент Log Analytics. |
| | [Автоматическая подготовка Центра безопасности Azure](../../security-center/security-center-enable-data-collection.md) | Центр безопасности Azure может подготовить к работе агента Log Analytics на всех поддерживаемых и на всех созданных виртуальных машинах Azure, если он активирован для отслеживания уязвимостей и угроз безопасности. Если эта функция активирована, любая новая виртуальная машина будет подготовлена к работе без установленного агента. |
| Гибридные компьютеры Windows| [Установка вручную](agent-windows.md) | Установите агент Microsoft Monitoring из командной строки. |
| | [DSC в службе автоматизации Azure](agent-windows.md#install-the-agent-using-dsc-in-azure-automation) | Автоматизируйте установку с помощью Azure Automation DSC. |
| | [Шаблон Resource Manager с Azure Stack](https://github.com/Azure/AzureStack-QuickStart-Templates/tree/master/MicrosoftMonitoringAgent-ext-win) | Используйте шаблон Azure Resource Manager, если в центре обработки данных развернут Microsoft Azure Stack.| 
| Гибридные компьютеры Linux| [Установка вручную](../learn/quick-collect-linux-computer.md)|Установка агента для Linux путем вызова сценария-оболочки, размещенного в GitHub. | 
| System Center Operations Manager|[Интеграция Operations Manager с Log Analytics](./om-agents.md) | Вы можете настроить интеграцию между Operations Manager и журналами Azure Monitor для пересылки отчетов о собранных данных из компьютеров Windows в группу управления.|  


## <a name="supported-windows-operating-systems"></a>Поддерживаемые операционные системы Windows

Для агента Windows официально поддерживаются следующие версии операционной системы Windows:

* Windows Server 2019
* Windows Server 2016, версии 1709 и 1803
* Windows Server 2012, 2012 R2
* Windows Server 2008 (x64) с пакетом обновления 2 (SP2), 2008 R2
* Все устройства с Windows 10 Корпоративная (с несколькими сеансами), и Профессиональная
* Windows 8 Корпоративная и Профессиональная 
* Windows 7 с пакетом обновления 1 (SP1)

>[!NOTE]
>Хотя агент Log Analytics для Windows был разработан для контроля серверов, мы понимаем, что клиент Windows можно использовать для контроля рабочих нагрузок, настроенных и оптимизированных для серверной операционной системы. Агент поддерживает клиент Windows, но наши решения мониторинга не сосредоточены на контроле за клиентом, если не указано иное.

## <a name="supported-linux-operating-systems"></a>Поддерживаемые операционные системы Linux

В этом разделе приведены сведения о поддерживаемых дистрибутивах Linux.

Начиная с версий, выпущенных после августа 2018 года, мы вносим следующие изменения в свою модель поддержки:  

* Поддерживаются только версии серверов, а не клиентов.  
* Сосредоточьтесь на любом из [поддерживаемых дистрибутивов Azure Linux](../../virtual-machines/linux/endorsed-distros.md). Обратите внимание, что между новыми дистрибутивом или версией, поддерживаемой Azure Linux, и агентом Log Analytics Linux может возникнуть задержка.
* Все вспомогательные версии поддерживаются для каждого основного номера версии в списке.
* Версии, для которых прошла дата окончания поддержки производителем, не поддерживаются.  
* Новые версии AMI не поддерживаются.  
* Поддерживаются только версии, работающие с SSL 1.x по умолчанию.

>[!NOTE]
>Если вы используете дистрибутив или версию, которые в настоящее время не поддерживаются и не соответствуют нашей модели поддержки, мы рекомендуем вам сделать вилку этого репозитория, согласившись, что специалисты службы поддержки Майкрософт не будут предоставлять помощь при работе с версиями разветвленных агентов.


### <a name="python-2-requirement"></a>Требование к Python 2
 Для агента Log Analytics требуется Python 2. Если ваша виртуальная машина использует дистрибутив, которая по умолчанию не включает Python 2, ее необходимо установить. Приведенные ниже примеры команд будут устанавливать Python 2 на разных дистрибутивов.

 - Red Hat, CentOS, Oracle:`yum install -y python2`
 - Ubuntu, Debian:`apt-get install -y python2`
 - SUSE: `zypper install -y python2`

Исполняемый файл python2 должен иметь псевдоним для Python с помощью следующей команды:

```
alternatives --set python `which python2`
```

### <a name="supported-distros"></a>Поддерживаемые дистрибутивы

Следующие версии операционной системы Linux официально поддерживаются для агента Linux:

* Amazon Linux 2017.09 (x64)
* CentOS Linux 6 (x64) и 7 (x64)  
* Oracle Linux 6 и 7 (x64) 
* Red Hat Enterprise Linux Server 6 (x64), 7 (x64) и 8 (x64)
* Debian GNU/Linux 8 и 9 (x64)
* Ubuntu 14.04 LTS (x86/x64), 16.04 LTS(x64), и 18.04 LTS (x64)
* SUSE Linux Enterprise Server 12 (x64) и 15 (x64)

>[!NOTE]
>OpenSSL 1.1.0 поддерживается только на платформах x86_x64 (64-разрядная версия), а OpenSSL версии более ранней, чем 1.x, не поддерживается ни на каких платформах.
>

### <a name="agent-prerequisites"></a>Предварительные требования к агенту

В этой таблице перечислены пакеты, необходимые для поддерживаемых дистрибутивов Linux, на которых агент будет установлен.

|Требуемый пакет |Описание |Минимальная версия |
|-----------------|------------|----------------|
|Glibc |    Библиотека C GNU | 2.5-12 
|Openssl    | Библиотеки OpenSSL | 1.0. x или 1.1. x |
|Curl | Веб-клиент cURL | 7.15.5 |
|Python | | 2.6 + или 3.3 +
|Python-ctypes | | 
|PAM | Подключаемые модули аутентификации | | 

>[!NOTE]
>Для сбора сообщений системного журнала требуется rsyslog или syslog-ng. Управляющая программа syslog по умолчанию не поддерживается для сбора событий системного журнала в Red Hat Enterprise Linux версии 5, CentOS и Oracle Linux (sysklog). Чтобы собирать данные системного журнала из дистрибутивов этих версий, требуется установить и настроить управляющую программу rsyslog, которая заменит sysklog.

## <a name="tls-12-protocol"></a>Протокол TLS 1.2

Чтобы обеспечить безопасность передаваемых данных в журналы Azure Monitor, настоятельно рекомендуем настроить для агента использование протокола TLS как минимум версии 1.2. Более старые версии протоколов TLS/SSL оказались уязвимы. Хотя они все еще используются для обеспечения обратной совместимости, применять их **не рекомендуется**.  См. дополнительные сведения о [безопасной отправке данных с помощью TLS 1.2](data-security.md#sending-data-securely-using-tls-12). 


## <a name="sha-2-code-signing-support-requirement-for-windows"></a>Требования для поддержки подписывания кода SHA-2 для Windows
Агент Windows начнет монопольное использование подписывания SHA-2 с 17 августа 2020 года. Это изменение повлияет на клиентов, использующих агент Log Analytics в устаревшей ОС в составе любой службы Azure (Azure Monitor, Служба автоматизации Azure, Управление обновлениями Azure, Отслеживание изменений Azure, Центр безопасности Azure, Azure Sentinel, Защитник Windows ATP). Это изменение не требует никаких действий клиента, если только агент не используется в устаревшей версии ОС (Windows 7, Windows Server 2008 R2 и Windows Server 2008). Клиенты, работающие в устаревшей версии ОС, должны выполнить такие действия на своих компьютерах до 17 августа 2020 года, или их агенты перестанут отправлять данные в свои рабочие области Log Analytics:

1. установить последний пакет обновления для своей ОС. Необходимые версии пакета обновления:
    - Windows 7 с пакетом обновления 1 (SP1)
    - Windows Server 2008 с пакетом обновления 2 (SP2)
    - Windows Server 2008 R2 с пакетом обновления 1 (SP1)

2. Установите обновления Windows для подписывания SHA-2 для вашей ОС, как описано в разделе [Требования для поддержки подписывания кода SHA-2 для Windows и WSUS (2019)](https://support.microsoft.com/help/4472027/2019-sha-2-code-signing-support-requirement-for-windows-and-wsus)
3. Обновите до последней версии агент Windows (версия 10.20.18029).
4. Рекомендуется настроить агент для [использования TLS 1.2](agent-windows.md#configure-agent-to-use-tls-12). 


## <a name="network-requirements"></a>Требования к сети
Агент для Linux и Windows обмениваются исходящими данными со службой Azure Monitor через TCP-порт 443. Если компьютер подключен к брандмауэру или прокси-серверу для обмена данными через Интернет, ознакомьтесь с предварительными требованиями ниже, чтобы должным образом настроить сеть. Если политики IT-безопасности запрещают подключение компьютеров в сети к Интернету, вы можете настроить [шлюз Log Analytics](gateway.md), а затем настроить агент для подключения к журналам Azure Monitor через шлюз. После этого агент сможет получать сведения о конфигурации и отправлять данные, которые зависят от выбранных правил сбора и решений мониторинга в вашей рабочей области.

![Схема связей агента Log Analytics](./media/log-analytics-agent/log-analytics-agent-01.png)

Ниже приводятся сведения о конфигурации прокси-сервера и брандмауэра, необходимые для взаимодействия агента Windows и Linux с журналами Azure Monitor.

### <a name="firewall-requirements"></a>Требования к брандмауэру

|Ресурс агента|порты; |Направление |Обход проверки HTTPS|
|------|---------|--------|--------|   
|*.ods.opinsights.azure.com |Порт 443 |Исходящие|Да |  
|*.oms.opinsights.azure.com |Порт 443 |Исходящие|Да |  
|*.blob.core.windows.net |Порт 443 |Исходящие|Да |
|*.azure-automation.net |Порт 443 |Исходящие|Да |

Сведения о брандмауэре, необходимые для управления Azure для государственных организаций, см. в [здесь](../../azure-government/compare-azure-government-global-azure.md#azure-monitor-logs). 

Если планируется использование Azure Automation Hybrid Runbook Worker для подключения к службе автоматизации и регистрации в ней, чтобы применить runbook или решения для управления в вашей среде, они должны иметь доступ к номеру порта и URL-адресам, описанным в разделе [Настройка сети для Hybrid Runbook Worker](../../automation/automation-hybrid-runbook-worker.md#network-planning). 

### <a name="proxy-configuration"></a>Конфигурация прокси-сервера

Агенты Windows и Linux поддерживают обмен данными со службой Azure Monitor через прокси-сервер или шлюз Log Analytics по протоколу HTTPS.  Поддерживается анонимная и базовая аутентификация (с именем пользователя и паролем).  Для агента Windows, подключенного непосредственно к службе, конфигурация прокси-сервера указывается во время установки или [после развертывания](agent-manage.md#update-proxy-settings) — в панели управления или с помощью PowerShell.  

Для агента Linux прокси-сервер определяется во время или [после установки](agent-manage.md#update-proxy-settings), или при изменении файла конфигурации proxy.conf.  Конфигурация прокси-сервера агента Linux имеет следующий синтаксис:

`[protocol://][user:password@]proxyhost[:port]`

> [!NOTE]
> Если прокси-сервер не требует аутентификацию, для агента Linux все равно необходимо указать псевдо-имя пользователя или пароль. Вы можете указать любое имя пользователя или пароль.

|Свойство| Описание |
|--------|-------------|
|Протокол | HTTPS |
|пользователь | Необязательное имя пользователя для аутентификации прокси-сервера |
|password | Необязательный пароль для аутентификации прокси-сервера |
|proxyhost | Адрес или полное доменное имя прокси-сервера или шлюза Log Analytics |
|порт | Необязательный номер порта прокси-сервера или шлюза Log Analytics |

Например: `https://user01:password@proxy01.contoso.com:30443`

> [!NOTE]
> Если в пароле использованы специальные знаки (например, \@), отобразится ошибка подключения прокси-сервера из-за неправильного анализа значения.  Чтобы обойти эту проблему, закодируйте пароль в URL-адрес, используя специальные инструменты (например, [URLDecode](https://www.urldecoder.org/)).  



## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения об источниках данных, доступных для сбора данных из операционных систем Windows или Linux, см. в статье [Data sources in Log Analytics](agent-data-sources.md) (Источники данных в Log Analytics). 
* Узнайте больше о [запросах журнала](../log-query/log-query-overview.md), которые можно применять для анализа данных, собираемых из источников данных и решений. 
* Узнайте больше о [решениях мониторинга](../insights/solutions.md), которые расширяют функции службы Azure Monitor и собирают данные в ее рабочей области.

