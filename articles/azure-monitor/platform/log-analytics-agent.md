---
title: Обзор агента журналов
description: В этой статье содержатся сведения о том, как собирать данные и наблюдать за компьютерами, размещенными в Azure, локальной или другой облачной среде, с помощью Log Analytics.
ms.subservice: logs
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 02/04/2020
ms.openlocfilehash: d52d8e6d0f6e3325b5c5cdc9a2e21654e6a2b621
ms.sourcegitcommit: b0ff9c9d760a0426fd1226b909ab943e13ade330
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/01/2020
ms.locfileid: "80520723"
---
# <a name="log-analytics-agent-overview"></a>Обзор агента журналов
Агент Azure Log Analytics был разработан для всестороннего управления виртуальными машинами в любых облачных, предприимчательных машинах и тех, которые контролируются [менеджером по эксплуатации Системного центра.](https://docs.microsoft.com/system-center/scom/) Агенты Windows и Linux отправляют собранные данные из разных источников в рабочее пространство журнала Analytics в Azure Monitor, а также любые уникальные журналы или метрики, определенные в решении мониторинга. Агент Log Analytics также поддерживает аналитические данные и другие службы в Azure Monitor, такие как [Azure Monitor для vMs,](../insights/vminsights-enable-overview.md) [Центр безопасности Azure](/azure/security-center/)и [Azure Automation.](../../automation/automation-intro.md)

В этой статье предоставлен подробный обзор требований к агенту, системе и сети, а также различных методов развертывания.

> [!NOTE]
> Вы также можете увидеть агента Log Analytics, называемого агентом мониторинга Майкрософт (MMA) или агентом OMS Linux.

> [!NOTE]
> Расширение Azure Diagnostics является одним из агентов, доступных для сбора данных мониторинга из гостевой операционной системы вычислительных ресурсов. [См. Обзор агентов Azure Monitor](agents-overview.md) для описания различных агентов и рекомендаций по выбору соответствующих агентов для ваших требований.

## <a name="comparison-to-azure-diagnostics-extension"></a>Сравнение с расширением диагностики Azure
[Расширение диагностики Azure](diagnostics-extension-overview.md) в Azure Monitor также может быть использовано для сбора данных мониторинга с гостевой операционной системы виртуальных машин Azure. Вы можете использовать один или оба в зависимости от ваших требований. Для детального сравнения агентов Azure Monitor смотрите [обзор агентов Azure Monitor.](agents-overview.md) 

Основные различия, которые следует учитывать:

- Расширение Azure Diagnostics может использоваться только с помощью виртуальных машин Azure. Агент Log Analytics можно использовать с виртуальными машинами в Azure, других облаках и на территории.
- Расширение Azure Diagnostics отправляет данные в Azure Storage, [Azure Monitor Metrics](data-platform-metrics.md) (только Windows) и концентраторы событий. Агент Log Analytics собирает данные в [журналы мониторинга Azure.](data-platform-logs.md)
- Агент Log Analytics необходим для [решений,](../monitor-reference.md#insights-and-core-solutions) [Azure Monitor для вс-ми- и](../insights/vminsights-overview.md)других служб, таких как [Центр безопасности Azure.](/azure/security-center/)

## <a name="costs"></a>Затраты
Агент уlog Analytics не стоит, но вы можете понести плату за понижаемые данные. Проверьте [использование и затраты на использование и затраты с помощью журналов Azure Monitor](manage-cost-storage.md) для получения подробной информации о ценах на данные, собранные в рабочей области Log Analytics.

## <a name="data-collected"></a>Собираемые данные
В следующей таблице перечислены типы данных, которые можно настроить рабочее пространство Log Analytics для сбора от всех подключенных агентов. [Посмотрите, что контролируется Azure Monitor?](../monitor-reference.md) для списка аналитических данных, решений и других решений, которые используют агент Log Analytics для сбора других видов данных.

| Источник данных | Описание |
| --- | --- |
| [Журналы событий Windows](data-sources-windows-events.md) | Информация, отправляемая системой ведения журналов событий Windows. |
| [Syslog](data-sources-syslog.md)                     | Информация, отправленная в систему регистрации событий Linux. |
| [Производительность](data-sources-performance-counters.md)  | Численные значения, измеряющие производительность различных аспектов операционной системы и рабочих нагрузок. |
| [Журналы IIS](data-sources-iis-logs.md)                 | Информация об использовании для веб-сайтов IIS, работающих на гостевой операционной системе. |
| [Пользовательские журналы](data-sources-custom-logs.md)           | События из текстовых файлов на компьютерах Windows и Linux. |

## <a name="data-destinations"></a>Целевое расположение данных
Агент Log Analytics отправляет данные в рабочее пространство аналитики журналов в Azure Monitor. Агент Windows может быть многодометным для отправки данных в несколько рабочих областей и групп управления управлением операциями Системного центра. Агент Linux может отправить только в один пункт назначения.

## <a name="other-services"></a>Другие службы
Агент для Linux и Windows не только для подключения к Azure Monitor, он также поддерживает Azure Automation для размещения гибридных ролей сотрудников Runbook и других услуг, таких как [отслеживание изменений,](../../automation/change-tracking.md) [управление обновлением](../../automation/automation-update-management.md)и [Центр безопасности Azure.](../../security-center/security-center-intro.md) Дополнительные сведения о гибридной рабочей роли Runbook см. в разделе [Общие сведения об архитектуре автоматизации](../../automation/automation-hybrid-runbook-worker.md).  

## <a name="installation-and-configuration"></a>Установка и настройка

При использовании агентов Log Analytics для сбора данных необходимо понимать следующее, чтобы спланировать развертывание агента:

* Для сбора данных от агентов Windows можно [настроить каждый агент для отчета в одном или нескольких рабочих областях,](agent-windows.md)даже если он отчитывается перед группой управления управлением операциями ВИЭ. Агент Windows может сообщать о четырех рабочих областях.
* Агент Linux не поддерживает мульти-гонатинг и может отчитываться только о одном рабочем пространстве.
* Агент Windows поддерживает [стандарт FIPS 140,](https://docs.microsoft.com/windows/security/threat-protection/fips-140-validation)в то время как агент Linux не поддерживает его.  

Если вы используете диспетчер операций System Center 2012 R2 или позже:

* Каждая группа управления менеджером операций может быть [подключена только к одному рабочему пространству.](om-agents.md)
* Компьютеры Linux, сообщающие группе управления, должны быть настроены для непосредственного отчета в рабочее пространство Log Analytics. Если ваши компьютеры Linux уже отчитываются непосредственно в рабочей области, и вы хотите контролировать их с помощью менеджера операций, выполните следующие действия, чтобы [сообщить об этом группе управления операциями.](agent-manage.md#configure-agent-to-report-to-an-operations-manager-management-group)
* Вы можете установить агент Log Analytics Windows на компьютер Windows и сообщить об этом как менеджеру операций, интегрированному с рабочим пространством, так и другому рабочему пространству.


Существует несколько методов установки агента log Analytics и подключения машины к Azure Monitor в зависимости от ваших требований. В следующей таблице описан каждый метод. Эти данные помогут вам определить, какой из методов наиболее подходящий для вашей организации.

|Источник | Метод | Описание|
|-------|-------------|-------------|
|Azure| [Вручную с портала Azure](../../azure-monitor/learn/quick-collect-azurevm.md?toc=/azure/azure-monitor/toc.json) | Укажите vMs для развертывания из рабочего пространства Log Analytics. |
| | Расширение Журнала Аналитика VM для [Windows](../../virtual-machines/extensions/oms-windows.md) или [Linux](../../virtual-machines/extensions/oms-linux.md) с помощью Azure CLI или с шаблоном управления ресурсами Azure | Это расширение устанавливает агент Log Analytics на виртуальных машинах Azure и регистрирует элементы в существующей рабочей области Azure Monitor. |
| | [Azure Monitor для vMs](../insights/vminsights-enable-overview.md) | При включании мониторинга с помощью Azure Monitor для вс-мидов, он устанавливает расширение и агент Log Analytics. |
| | [Автоматическое обеспечение Центра безопасности Azure](../../security-center/security-center-enable-data-collection.md) | Центр безопасности Azure может предоставлять агенту Log Analytics все поддерживаемые чаты вазовские ввовы и любые новые, которые создаются, если позволить ему отслеживать уязвимости и угрозы безопасности. Если включена, любой новый или существующий VM без установленного агента будет подготовлен. |
| Гибридные компьютеры Windows| [Установка вручную](agent-windows.md) | Установите агент мониторинга Майкрософт из командной строки. |
| | [DSC в службе автоматизации Azure](agent-windows.md#install-the-agent-using-dsc-in-azure-automation) | Автоматизировать установку с помощью Azure Automation DSC. |
| | [Шаблон Resource Manager с Azure Stack](https://github.com/Azure/AzureStack-QuickStart-Templates/tree/master/MicrosoftMonitoringAgent-ext-win) | Используйте шаблон менеджера ресурсов Azure, если вы развернули стек Microsoft Azure в центре обработки данных.| 
| Гибридные компьютеры Linux| [Установка вручную](../../azure-monitor/learn/quick-collect-linux-computer.md)|Установка агента для Linux путем вызова сценария-оболочки, размещенного в GitHub. | 
| System Center Operations Manager|[Интеграция Operations Manager с Log Analytics](../../azure-monitor/platform/om-agents.md) | Нанастройка интеграции между журналами «Менеджер операций» и журналами Azure Monitor для передачи собранных данных с компьютеров Windows, сообщающих об этом группе управления.|  


## <a name="supported-windows-operating-systems"></a>Поддерживаемые операционные системы Windows

Для агента Windows официально поддерживаются следующие версии операционной системы Windows:

* Windows Server 2019
* Windows Server 2008 SP2 (x64), 2008 R2, 2012, 2012 R2, 2016, версия 1709 и 1803
* Windows 7 SP1, Windows 8 Предприятие и Pro, и Windows 10 Предприятие и Pro

>[!NOTE]
>В то время как агент Log Analytics для Windows был разработан для поддержки сценариев мониторинга серверов, мы понимаем, что вы можете запустить клиент Windows для поддержки рабочих нагрузок, настроенных и оптимизированных для операционной системы сервера. Агент поддерживает клиента Windows, однако наши решения по мониторингу не фокусируются на сценариях мониторинга клиентов, если не указано прямо.

## <a name="supported-linux-operating-systems"></a>Поддерживаемые операционные системы Linux

В этом разделе приведены сведения о поддерживаемых дистрибутивах Linux.

Начиная с версий, выпущенных после августа 2018 года, мы вносим следующие изменения в свою модель поддержки:  

* Поддерживаются только версии серверов, а не клиентов.  
* Сосредоточьте поддержку на любом из [одобренных Azure Linux дистросов.](../../virtual-machines/linux/endorsed-distros.md) Обратите внимание, что может быть некоторая задержка между новым дистро / версия является Azure Linux Одобрено и она поддерживается для журнала Analytics Linux агента.
* Все вспомогательные версии поддерживаются для каждого основного номера версии в списке.
* Версии, для которых прошла дата окончания поддержки производителем, не поддерживаются.  
* Новые версии AMI не поддерживаются.  
* Поддерживаются только версии, работающие с SSL 1.x по умолчанию.

>[!NOTE]
>Если вы используете дистрибутив или версию, которые в настоящее время не поддерживаются и не соответствуют нашей модели поддержки, мы рекомендуем вам сделать вилку этого репозитория, согласившись, что специалисты службы поддержки Майкрософт не будут предоставлять помощь при работе с версиями разветвленных агентов.

* Amazon Linux 2017.09 (x64)
* CentOS Linux 6 (x86/x64) и 7 (x64)  
* Oracle Linux 6 и 7 (x86/x64) 
* Red Hat Enterprise Linux Server 6 (x86/x64) и 7 (x64)
* Debian GNU/Linux 8 и 9 (x86/x64)
* Ubuntu 14.04 LTS (x86/x64), 16.04 LTS (x86/x64) и 18.04 LTS (x64)
* SUSE Linux Enterprise Server 12 (x64) и 15 (x64)

>[!NOTE]
>OpenSSL 1.1.0 поддерживается только на платформах x86_x64 (64-разрядная версия), а OpenSSL версии более ранней, чем 1.x, не поддерживается ни на каких платформах.
>

### <a name="agent-prerequisites"></a>Предварительные требования к агенту

В следующей таблице освещаются пакеты, необходимые для поддерживаемых дистро Linux, на которые будет установлен агент.

|Требуемый пакет |Описание |Минимальная версия |
|-----------------|------------|----------------|
|Glibc |    Библиотека C GNU | 2.5-12 
|Openssl    | Библиотеки OpenSSL | 1.0.x или 1.1.x |
|Curl | Веб-клиент cURL | 7.15.5 |
|Python-ctypes | | 
|PAM | Подключаемые модули аутентификации | | 

>[!NOTE]
>Для сбора сообщений системного журнала требуется rsyslog или syslog-ng. Управляющая программа syslog по умолчанию не поддерживается для сбора событий системного журнала в Red Hat Enterprise Linux версии 5, CentOS и Oracle Linux (sysklog). Чтобы собирать данные системного журнала из дистрибутивов этих версий, требуется установить и настроить управляющую программу rsyslog, которая заменит sysklog.

## <a name="tls-12-protocol"></a>Протокол TLS 1.2

Для обеспечения безопасности данных, передаваемых в журналы Azure Monitor, мы настоятельно рекомендуем настроить агента для использования по крайней мере безопасности транспортного уровня (TLS) 1.2. Более старые версии протоколов TLS/SSL оказались уязвимы. Хотя они все еще используются для обеспечения обратной совместимости, применять их **не рекомендуется**.  См. дополнительные сведения о [безопасной отправке данных с помощью TLS 1.2](data-security.md#sending-data-securely-using-tls-12). 


## <a name="sha-2-code-signing-support-requirement-for-windows"></a>Sha-2 Требование подписи к коду для Windows
Агент Windows начнет использовать исключительно SHA-2 подписания 18 мая 2020 года. Это изменение повлияет на клиентов, использующих агент Log Analytics на устаревшей ОС как часть любой службы Azure (Azure Monitor, Azure Automation, Управление обновлениями Azure, отслеживание изменений Azure, Центр безопасности Azure, Azure Sentinel, Windows Defender ATP). Это изменение не требует каких-либо действий клиента, если вы работаете агента на устаревшей версии ОС (Windows 7, Windows Server 2008 R2 и Windows Server 2008). Клиенты, работающие на устаревшей версии ОС, должны предпринять следующие действия на своих машинах до 18 мая 2020 года, иначе их агенты перестанут отправлять данные в свои рабочие области Log Analytics:

1. Установите новейший пакет услуг для ОС. Необходимые версии пакета услуг:
    - Windows 7 с пакетом обновления 1 (SP1)
    - Windows Server 2008 с пакетом обновления 2 (SP2)
    - Windows Server 2008 R2 с пакетом обновления 1 (SP1)

2. Установите SHA-2 подписание Windows обновления для Вашей ОС, как описано в [2019 SHA-2 Код Подписание Поддержка требования для Windows и WSUS](https://support.microsoft.com/help/4472027/2019-sha-2-code-signing-support-requirement-for-windows-and-wsus)
3. Обновление до последней версии агента Windows (версия 10.20.18029).
4. Рекомендуется настроить агент для [использования TLS 1.2](agent-windows.md#configure-agent-to-use-tls-12). 


## <a name="network-requirements"></a>Требования к сети
Агент Для Linux и Windows передает исходящий в службу Azure Monitor через порт TCP 443, и если машина подключается через брандмауэр или прокси-сервер для связи через Интернет, просмотрите требования ниже, чтобы понять требуемую конфигурацию сети. Если политики ИТ-безопасности не позволяют компьютерам в сети подключаться к Интернету, можно настроить [шлюз Log Analytics,](gateway.md) а затем настроить агент для подключения через шлюз к журналам Azure Monitor. Затем агент может получать информацию о конфигурации и отправлять собранные данные в зависимости от правил сбора данных и решений мониторинга, которые вы включили в рабочее пространство.

![Схема связей агента Log Analytics](./media/log-analytics-agent/log-analytics-agent-01.png)

В следующей таблице перечислены сведения о конфигурации прокси и брандмауэра, необходимые агентам Linux и Windows для связи с журналами Azure Monitor.

### <a name="firewall-requirements"></a>Требования к брандмауэру

|Ресурс агента|порты; |Направление |Обход проверки HTTPS|
|------|---------|--------|--------|   
|*.ods.opinsights.azure.com |Порт 443 |Входящий и исходящий|Да |  
|*.oms.opinsights.azure.com |Порт 443 |Входящий и исходящий|Да |  
|*.blob.core.windows.net |Порт 443 |Входящий и исходящий|Да |
|*.azure-automation.net |Порт 443 |Входящий и исходящий|Да |
|*.azure.com |Порт 443|Входящий и исходящий|Да |

Для получения информации о брандмауэре, необходимой для правительства Azure, [см.](../../azure-government/documentation-government-services-monitoringandmanagement.md#azure-monitor-logs) 

Если вы планируете использовать Azure Automation Hybrid Runbook Worker для подключения и регистрации в службе автоматизации для использования runbooks или решений управления в вашей среде, он должен иметь доступ к номеру порта и URL-адресам, описанным в [настройке вашей сети для Hybrid Runbook Worker.](../../automation/automation-hybrid-runbook-worker.md#network-planning) 

### <a name="proxy-configuration"></a>Конфигурация прокси-сервера

Агент Windows и Linux поддерживает общение либо через прокси-сервер, либо через шлюз Log Analytics на Azure Monitor с помощью протокола HTTPS.  Поддерживается анонимная и базовая аутентификация (с именем пользователя и паролем).  Для агента Windows, подключенного непосредственно к службе, конфигурация прокси указана во время установки или [после развертывания](agent-manage.md#update-proxy-settings) от панели управления или с PowerShell.  

Для агента Linux прокси-сервер определяется во время или [после установки](agent-manage.md#update-proxy-settings), или при изменении файла конфигурации proxy.conf.  Конфигурация прокси-сервера агента Linux имеет следующий синтаксис:

`[protocol://][user:password@]proxyhost[:port]`

> [!NOTE]
> Если прокси-сервер не требует аутентификацию, для агента Linux все равно необходимо указать псевдо-имя пользователя или пароль. Вы можете указать любое имя пользователя или пароль.

|Свойство| Описание |
|--------|-------------|
|Протокол | HTTPS |
|пользователь | Необязательное имя пользователя для аутентификации прокси-сервера |
|password | Необязательный пароль для аутентификации прокси-сервера |
|proxyhost | Адрес или полное доменное имя прокси-сервера или шлюза Log Analytics |
|порт | Необязательный номер порта прокси-сервера или шлюза Log Analytics |

Например: `https://user01:password@proxy01.contoso.com:30443`

> [!NOTE]
> Если вы используете специальные\@символы, такие как «в вашем пароле», вы получаете ошибку прокси-соединения, потому что значение разбирается неправильно.  Чтобы обойти эту проблему, закодируйте пароль в URL-адрес, используя специальные инструменты (например, [URLDecode](https://www.urldecoder.org/)).  



## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения об источниках данных, доступных для сбора данных из операционных систем Windows или Linux, см. в статье [Data sources in Log Analytics](agent-data-sources.md) (Источники данных в Log Analytics). 
* Узнайте больше о [запросах журнала](../log-query/log-query-overview.md), которые можно применять для анализа данных, собираемых из источников данных и решений. 
* Узнайте больше о [решениях мониторинга](../insights/solutions.md), которые расширяют функции службы Azure Monitor и собирают данные в ее рабочей области.

