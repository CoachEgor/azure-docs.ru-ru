---
title: Сбор данных журнала с помощью агента Azure Log Analytics | Документация Майкрософт
description: В этой статье содержатся сведения о том, как собирать данные и наблюдать за компьютерами, размещенными в Azure, локальной или другой облачной среде, с помощью Log Analytics.
services: log-analytics
documentationcenter: ''
author: mgoedtel
manager: carmonm
editor: ''
ms.assetid: ''
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.topic: conceptual
ms.date: 04/22/2019
ms.author: magoedte
ms.openlocfilehash: b410dab40d5434a6f23950a9f151e50240ace63b
ms.sourcegitcommit: 2028fc790f1d265dc96cf12d1ee9f1437955ad87
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/30/2019
ms.locfileid: "64916363"
---
# <a name="collect-log-data-with-the-azure-log-analytics-agent"></a>Сбор данных журнала с помощью агента Azure Log Analytics

Агент Azure Log Analytics, который ранее назывался агентом Microsoft Monitoring Agent (MMA) или агентом OMS для Linux, был разработан для обеспечения комплексного управления на компьютерах в локальной среде, компьютерах, отслеживаемых с помощью [System Center Operations Manager](https://docs.microsoft.com/system-center/scom/), и виртуальных машинах в любом облаке. Агенты Windows и Linux присоединение к Azure Monitor и хранить собранные данные журнала из различных источников в рабочей области Log Analytics, а также уникальные журналы и метрики, как определено в решении для мониторинга. 

В этой статье предоставлен подробный обзор требований к агенту, системе и сети, а также различных методов развертывания.   

## <a name="overview"></a>Обзор

![Схема связей агента Log Analytics](./media/log-analytics-agent/log-analytics-agent-01.png)

Перед анализом и обработкой собранных данных, необходимо сначала установить и подключить агенты для всех виртуальных машин, которые вы хотите отправить данные в службу Azure Monitor. Вы можете установить агенты на виртуальных машинах Azure с помощью расширения виртуальной машины Azure Log Analytics для Windows и Linux, а также на компьютерах в гибридной среде с помощью программы установки, командной строки или настройки требуемого состояния (DSC) в службе автоматизации Azure. 

Агент для Linux и Windows обменивается исходящими данными в службу Azure Monitor через TCP-порт 443 и если компьютер подключается через брандмауэр или прокси-сервер для обмена данными через Интернет, ознакомьтесь с требованиями к ниже для понимания конфигурации сети Обязательно. Если политики ИТ-безопасности позволяет компьютерам в сети для подключения к Интернету, можно настроить [шлюза Log Analytics](gateway.md) и затем настроить агент для подключения через шлюз к журналам Azure Monitor. Агент можно получать сведения о конфигурации и отправлять данные, собранные в зависимости от того, какие данные правила сбора данных и решения для мониторинга вы включили в рабочей области. 

Если ведется мониторинг компьютера, с помощью System Center Operations Manager 2012 R2 или более поздней версии, он может быть как многосетевой. с помощью службы Azure Monitor для сбора данных и пересылаться в службу и по-прежнему осуществляться [Operations Manager](../../azure-monitor/platform/om-agents.md). Компьютерами Linux агент не включает компонент службы работоспособности, как агент Windows выполняет и информация собирается и обрабатывает сервером управления, от его имени. Так как компьютеры Linux по-разному отслеживаются с помощью Operations Manager, они не получают конфигурацию или собирать данные напрямую и пересылать через группы управления, как управляемой агентом системе Windows. Таким образом этот сценарий не поддерживается компьютерами Linux, отчеты в Operations Manager.  

Агент для Windows может отправлять отчет в четыре рабочих области Log Analytics, а агент для Linux поддерживает отчетность только для одной рабочей области.  

Агент для Linux и Windows не только для подключения к Azure Monitor, она также поддерживает службы автоматизации Azure для размещения гибридной рабочей роли Runbook и других служб, таких как [отслеживания изменений](../../automation/change-tracking.md) и [управления обновлениями](../../automation/automation-update-management.md). Дополнительные сведения о гибридной рабочей роли Runbook см. в разделе [Общие сведения об архитектуре автоматизации](../../automation/automation-hybrid-runbook-worker.md).  

## <a name="supported-windows-operating-systems"></a>Поддерживаемые операционные системы Windows
Для агента Windows официально поддерживаются следующие версии операционной системы Windows:

* Windows Server 2019
* Windows Server 2008 R2, 2012, 2012 R2, 2016 г., версии 1709 и 1803
* Windows 7 с пакетом обновления 1 и более поздних версий

## <a name="supported-linux-operating-systems"></a>Поддерживаемые операционные системы Linux
В этом разделе приведены сведения о поддерживаемых дистрибутивах Linux.    

Начиная с версий, выпущенных после августа 2018 года, мы вносим следующие изменения в свою модель поддержки:  

* Поддерживаются только версии серверов, а не клиентов.  
* Новые версии [рекомендуемых дистрибутивов Azure Linux](../../virtual-machines/linux/endorsed-distros.md) всегда поддерживаются.  
* Все вспомогательные версии поддерживаются для каждого основного номера версии в списке.
* Версии, для которых прошла дата окончания поддержки производителем, не поддерживаются.  
* Новые версии AMI не поддерживаются.  
* Поддерживаются только версии, работающие с SSL 1.x по умолчанию.

Если вы используете дистрибутив или версию, которые в настоящее время не поддерживаются и не соответствуют нашей модели поддержки, мы рекомендуем вам сделать вилку этого репозитория, согласившись, что специалисты службы поддержки Майкрософт не будут предоставлять помощь при работе с версиями разветвленных агентов.

* Amazon Linux 2017.09 (x64)
* CentOS Linux 6 (x86/x64) и 7 (x64)  
* Oracle Linux 6 и 7 (x86/x64) 
* Red Hat Enterprise Linux Server 6 (x86/x64) и 7 (x64)
* Debian GNU/Linux 8 и 9 (x86/x64)
* Ubuntu 14.04 LTS (x86/x64), 16.04 LTS (x86/x64) и 18.04 LTS (x64)
* SUSE Linux Enterprise Server 12 (x64)

>[!NOTE]
>OpenSSL 1.1.0 поддерживается только на платформах x86_x64 (64-разрядная версия), а OpenSSL версии более ранней, чем 1.x, не поддерживается ни на каких платформах.
>

## <a name="tls-12-protocol"></a>Протокол TLS 1.2
Чтобы обеспечить безопасность данных в пути к журналам монитора Azure, настоятельно рекомендуется настроить агент для использования по крайней мере уровень безопасности транспорта (TLS) 1.2. Более старые версии протоколов TLS/SSL оказались уязвимы. Хотя они все еще используются для обеспечения обратной совместимости, применять их **не рекомендуется**.  См. дополнительные сведения о [безопасной отправке данных с помощью TLS 1.2](../../azure-monitor/platform/data-security.md#sending-data-securely-using-tls-12). 

## <a name="network-firewall-requirements"></a>Требования к брандмауэру в сети
Сведения ниже приводятся данные конфигурации прокси-сервера и брандмауэра, необходимые для взаимодействия с Azure Monitor журналы агента Linux и Windows.  

|Ресурс агента|порты; |Направление |Обход проверки HTTPS|
|------|---------|--------|--------|   
|*.ods.opinsights.azure.com |Порт 443 |Исходящие|Yes |  
|*.oms.opinsights.azure.com |Порт 443 |Исходящие|Yes |  
|*.blob.core.windows.net |Порт 443 |Исходящие|Yes |  
|*.azure-automation.net |Порт 443 |Исходящие|Yes |  

Сведения о брандмауэрах, необходимые для Azure для государственных организаций, см. в разделе [управления Azure для государственных организаций](../../azure-government/documentation-government-services-monitoringandmanagement.md#azure-monitor-logs). 

Если планируется использование Azure Automation Hybrid Runbook Worker для подключения к службе автоматизации и регистрации в ней, чтобы применить runbook в вашей среде, они должны иметь доступ к номеру порта и URL-адресам, описанным в разделе [Настройка сети для Hybrid Runbook Worker](../../automation/automation-hybrid-runbook-worker.md#network-planning). 

Агент Windows и Linux поддерживает обмен данными со через прокси-сервер или шлюз Log Analytics в Azure Monitor с помощью протокола HTTPS.  Поддерживается анонимная и базовая аутентификация (с именем пользователя и паролем).  Для агента Windows, подключенного непосредственно к службе, конфигурация прокси-сервера указывается во время установки или [после развертывания](agent-manage.md#update-proxy-settings) — в панели управления или с помощью PowerShell.  

Для агента Linux прокси-сервер определяется во время или [после установки](agent-manage.md#update-proxy-settings), или при изменении файла конфигурации proxy.conf.  Конфигурация прокси-сервера агента Linux имеет следующий синтаксис:

`[protocol://][user:password@]proxyhost[:port]`

> [!NOTE]
> Если прокси-сервер не требует аутентификацию, для агента Linux все равно необходимо указать псевдо-имя пользователя или пароль. Вы можете указать любое имя пользователя или пароль.

|Свойство| ОПИСАНИЕ |
|--------|-------------|
|Протокол | HTTPS |
|user | Необязательное имя пользователя для аутентификации прокси-сервера |
|password | Необязательный пароль для аутентификации прокси-сервера |
|proxyhost | Адрес или полное доменное имя прокси-сервера или шлюза Log Analytics |
|порт | Необязательный номер порта прокси-сервера или шлюза Log Analytics |

Например: `https://user01:password@proxy01.contoso.com:30443`

> [!NOTE]
> Если в пароле использованы специальные знаки (например, \@), отобразится ошибка подключения прокси-сервера из-за неправильного анализа значения.  Чтобы обойти эту проблему, закодируйте пароль в URL-адрес, используя специальные инструменты (например, [URLDecode](https://www.urldecoder.org/)).  

## <a name="install-and-configure-agent"></a>Установка и настройка агента 
Подключение компьютеров в вашей подписке Azure или гибридной среде напрямую с помощью журналов Azure Monitor может осуществляться разными способами в зависимости от требований. В следующей таблице описан каждый метод. Эти данные помогут вам определить, какой из методов наиболее подходящий для вашей организации.

|Источник | Метод | ОПИСАНИЕ|
|-------|-------------|-------------|
|Azure| Расширение виртуальной машины Log Analytics для [Windows](../../virtual-machines/extensions/oms-windows.md) или [Linux](../../virtual-machines/extensions/oms-linux.md) с использованием Azure CLI или шаблона Azure Resource Manager<br>- [Вручную с помощью портала Azure](../../azure-monitor/learn/quick-collect-azurevm.md?toc=/azure/azure-monitor/toc.json). | Это расширение устанавливает агент Log Analytics на виртуальных машинах Azure и регистрирует элементы в существующей рабочей области Azure Monitor.|
| Гибридные компьютеры Windows|- [Установка вручную](agent-windows.md)<br>- [DSC службы автоматизации Azure](agent-windows.md#install-the-agent-using-dsc-in-azure-automation)<br>- [Шаблон Resource Manager с Azure Stack](https://github.com/Azure/AzureStack-QuickStart-Templates/tree/master/MicrosoftMonitoringAgent-ext-win) |Установка агента Microsoft Monitoring Agent из командной строки или автоматически, например с помощью DSC службы автоматизации Azure, [System Center Configuration Manager](https://docs.microsoft.com/sccm/apps/deploy-use/deploy-applications) или шаблона Azure Resource Manager, если Microsoft Azure Stack уже развернут в центре обработки данных.| 
| Гибридные компьютеры Linux| [Установка вручную](../../azure-monitor/learn/quick-collect-linux-computer.md)|Установка агента для Linux путем вызова сценария-оболочки, размещенного в GitHub. | 
| System Center Operations Manager|[Интеграция Operations Manager с Log Analytics](../../azure-monitor/platform/om-agents.md) | Настроить интеграцию между Operations Manager и Azure Monitor журналы, чтобы пересылают собранные данные с компьютеров Windows к группе управления.|  

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения об источниках данных, доступных для сбора данных из операционных систем Windows или Linux, см. в статье [Data sources in Log Analytics](../../azure-monitor/platform/agent-data-sources.md) (Источники данных в Log Analytics). 

* Узнайте больше о [запросах журнала](../../azure-monitor/log-query/log-query-overview.md), которые можно применять для анализа данных, собираемых из источников данных и решений. 

* Узнайте больше о [решениях мониторинга](../../azure-monitor/insights/solutions.md), которые расширяют функции службы Azure Monitor и собирают данные в рабочей области Log Analytics.
