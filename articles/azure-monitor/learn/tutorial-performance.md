---
title: Диагностика проблем производительности с помощью Azure Application Insights | Документация Майкрософт
description: Руководство по поиску и диагностике проблем производительности в приложении с помощью Azure Application Insights.
services: application-insights
keywords: ''
author: mrbullwinkle
ms.author: mbullwin
ms.date: 09/18/2017
ms.service: application-insights
ms.custom: mvc
ms.topic: tutorial
manager: carmonm
ms.openlocfilehash: f906ab5db35ce8b239eceac9cdc8244f230f5a77
ms.sourcegitcommit: 1fbc75b822d7fe8d766329f443506b830e101a5e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/14/2019
ms.locfileid: "65596025"
---
# <a name="find-and-diagnose-performance-issues-with-azure-application-insights"></a>Поиск и диагностика проблем производительности с помощью Azure Application Insights

Azure Application Insights собирает данные телеметрии из приложения для анализа его работы и производительности.  Эти сведения можно использовать, чтобы определить возможные проблемы или улучшить приложения, которые могут повлиять на работу пользователей.  В этом руководстве описан процесс анализа производительности обоих компонентов сервера вашего приложения и перспектива клиента.  Вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Определение производительности операций на стороне сервера.
> * Анализ операций сервера для определения первопричины низкой производительности.
> * Определение самых медленных операций на стороне клиента.
> * Анализ сведений просмотра страниц с помощью языка запросов.


## <a name="prerequisites"></a>Предварительные требования

Для работы с этим руководством:

- Установите [Visual Studio 2019](https://www.visualstudio.com/downloads/) с указанными ниже рабочими нагрузками:
    - ASP.NET и веб-разработка.
    - разработка Azure;
- Разверните приложение .NET в Azure и [включите пакет SDK для Application Insights](../../azure-monitor/app/asp-net.md).
- [Включите Application Insights Profiler](../../azure-monitor/app/profiler.md#installation) для вашего приложения.

## <a name="log-in-to-azure"></a>Вход в Azure
Войдите на портал Azure по адресу [https://portal.azure.com](https://portal.azure.com).

## <a name="identify-slow-server-operations"></a>Определение медленных операций сервера
Application Insights собирает данные о производительности различных операций в приложении. Определив операции с наибольшей длительностью, можно диагностировать потенциальные проблемы или наиболее подходящее целевое значение ваших текущих операций разработки, чтобы повысить общую производительность приложения.

1. Выберите **Application Insights**, а затем выберите подписку.  
1. Чтобы открыть панель **Производительность**, выберите **Производительность** в меню **Исследовать** или выберите диаграмму **Время ответа сервера**.

    ![Производительность](media/tutorial-performance/performance.png)

2. На панели **Производительность** отображается количество операций и средняя продолжительность каждой операции приложения.  Эти сведения можно использовать, чтобы определить операции, которые больше всего влияют на пользователей. В этом примере операции **GET Customers/Details** и **GET Home/Index** — наиболее вероятные кандидаты для анализа из-за их относительно высокой длительности и значительного количества вызовов.  Другие операции могут иметь более высокую длительность и малое количество вызовов, поэтому результат их улучшения будет минимальным.  

    ![Панель производительности](media/tutorial-performance/performance-blade.png)

3. Сейчас на диаграмме отображается средняя длительность выбранных операций с течением времени. Вы можете выбрать отображение 95-й процентиля для поиска проблем с производительностью. Добавьте необходимые операции, закрепив их на диаграмме.  Это означает, что некоторые пиковые нагрузки следует изучить подробнее.  Далее изолируйте эти нагрузки за счет снижения временного окна графа.

    ![Операции закрепления](media/tutorial-performance/pin-operations.png)

4.  На панели производительности справа показано распределение длительности разных запросов для выбранной операции.  Уменьшите окно, чтобы отобразить 95-й процентиль. Карта с подробными сведениями "Три ведущие зависимости" предоставляет сведения о том, какие внешние зависимости вероятнее всего замедляют транзакции.  Нажмите кнопку с числом выборок, чтобы просмотреть соответствующий список. Затем можно выбрать любую выборку, чтобы просмотреть сведения о транзакциях.

    ![Распределение длительности](media/tutorial-performance/duration-distribution.png)

5.  Вы можете увидеть, что больше всего общую длительность транзакции влияет вызов к таблице Azure Fabrikamaccount. Вы также можете увидеть исключение, которое привело к сбою. Щелкните любой элемент в списке, чтобы просмотреть соответствующие сведения в области справа. См. дополнительные сведения об [интерфейсе диагностики транзакций](../../azure-monitor/app/transaction-diagnostics.md).

    ![Сведения об операции](media/tutorial-performance/operation-details.png)
    

6.  **Профилировщик** помогает получить диагностические сведения на уровне кода, отображая фактический код, выполняемый для операции, и время, необходимое для выполнения каждого этапа. Некоторые операции могут не иметь трассировки, так как профилировщик запускается периодически.  Со временем большее количество операций будут иметь трассировки.  Чтобы запустить профилировщик для операции, выберите **Profiler traces** (Трассировки профилировщика).
5.  Трассировка отображает отдельные события каждой операции, поэтому вы можете определить первопричину длительности всех операций.  Выберите один из примеров вверху, которые имеют наибольшую длительность.
6.  Выберите **Показать критический путь**, чтобы выделить конкретный путь событий, которые больше всего влияют на итоговою длительность операции.  В этом примере видно, что наиболее медленный вызов осуществляется из метода *FabrikamFiberAzureStorage.GetStorageTableData*. И больше всего времени занимает выполнение метода *CloudTable.CreateIfNotExist*. Если эта строка кода будет выполняться при каждом вызове функции, то будут нецелесообразно использоваться сетевые вызовы и ресурсы ЦП. Для исправления кода рекомендуется поместить эту строку в какой-либо метод запуска, который выполняется только один раз. 

    ![Сведения о профилировщике](media/tutorial-performance/profiler-details.png)

7.  Параметр **Совет по производительности** в верхней части экрана помогает оценить длительность ожидания.  Щелкните ссылку **ожидания**, чтобы отобразить документацию с интерпретацией различных типов событий.

    ![Совет по производительности](media/tutorial-performance/performance-tip.png)

8.  Для дальнейшего анализа выберите **Скачать ETL-файл трассировки**, чтобы скачать файл трассировки в Visual Studio.

## <a name="use-analytics-data-for-server"></a>Использование данных аналитики для сервера
Аналитика Application Insights предоставляет полнофункциональный язык запросов, позволяющий анализировать все данные, собранные Application Insights.  Это позволяет выполнить глубокий анализ запроса и данных о производительности.

1. Вернитесь на панель сведений об операции и нажмите кнопку аналитики.

    ![Кнопка аналитики](media/tutorial-performance/server-analytics-button.png)

2. В аналитике Application Insights откроется запрос для каждого представления на панели.  Вы можете выполнить эти запросы или изменить их в соответствии с требованиями.  Первый запрос отображает длительность этой операции с течением времени.

    ![Analytics](media/tutorial-performance/server-analytics.png)


## <a name="identify-slow-client-operations"></a>Определение медленных операций клиента
Помимо определений процессов сервера, которые необходимо оптимизировать, Application Insights может анализировать перспективу браузеров клиента.  Это может помочь определить возможные улучшения компонентов клиента и даже определить проблемы разных браузеров или разных местоположений.

1. Выберите **Браузер** в разделе **Исследовать**, чтобы открыть сводку браузера.  Вы увидите визуальную сводку различных данных телеметрии с точки зрения браузера.

    ![Сводка браузера](media/tutorial-performance/browser-summary.png)

2.  Прокрутите вниз до элемента **Какие страницы открывались дольше всего?** .  Отобразится список страниц приложения, которые загружались для клиента дольше всего.  Эти сведения можно использовать, чтобы определить страницы, которые оказывают значительное влияние на пользователя.
3.  Выберите одну из этих страниц, чтобы открыть панель **Разметка страницы**.  В этом примере на странице **/FabrikamProd** отображается повышенная средняя длительность.  Панель **Разметка страницы** содержит подробные сведения об этой странице, включая разбивку разных диапазонов длительности.

    ![Разметка страницы](media/tutorial-performance/page-view.png)

4.  Выберите наибольшую длительность, чтобы просмотреть подробные сведения этих запросов.  Затем выберите отдельный запрос, чтобы просмотреть сведения о клиенте, выполнив запрос страницы, включая тип браузера и его местоположение.  Эти сведения могут помочь определить, имеются ли проблемы с производительностью, связанные с определенными типами клиентов.

    ![Сведения о запросе](media/tutorial-performance/request-details.png)

## <a name="use-analytics-data-for-client"></a>Использование данных аналитики для клиента
Аналогично данным, собранным для производительности сервера, Application Insight позволяет выполнить глубокий анализ данных клиента с помощью аналитики.

1. Вернитесь к сводке браузера и щелкните значок аналитики.

    ![Значок аналитики](media/tutorial-performance/client-analytics-icon.png)

2. В аналитике Application Insights откроется запрос для каждого представления на панели. Первый запрос отображает длительность различных просмотров страниц с течением времени.

    ![Analytics](media/tutorial-performance/client-analytics.png)

3.  Интеллектуальная диагностика — это функция аналитики Application Insights, определяющая уникальные шаблоны в данных.  Если щелкнуть точку интеллектуальной диагностики на графике, будет выполнен аналогичный запрос, который не содержит записей, вызвавших аномалию.  Сведения об этих записях можно просмотреть в разделе комментариев запроса. Вы можете определить свойства просмотров страниц, которые вызвали чрезмерную длительность выполнения.

    ![Интеллектуальная диагностика](media/tutorial-performance/client-smart-diagnostics.png)


## <a name="next-steps"></a>Дополнительная информация
Теперь, когда вы узнали, как определить исключения времени выполнения, перейдите к следующему руководству, чтобы научиться создавать оповещения в ответ на неполадки.

> [!div class="nextstepaction"]
> [Мониторинг и оповещение о работоспособности приложения с помощью Azure Application Insights](../../azure-monitor/learn/tutorial-alert.md)
