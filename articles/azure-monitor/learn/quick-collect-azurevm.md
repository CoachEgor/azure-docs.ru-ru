---
title: Сбор данных о виртуальных машинах Azure | Документация Майкрософт
description: Узнайте, как включить расширение виртуальной машины для агента Log Analytics и сбор данных из виртуальных машин Azure с помощью Log Analytics.
services: log-analytics
documentationcenter: log-analytics
author: mgoedtel
manager: carmonm
editor: ''
ms.assetid: ''
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.topic: quickstart
ms.date: 08/19/2019
ms.author: magoedte
ms.custom: mvc
ms.openlocfilehash: 1a61c0f96f62712bbd2500b2e80fd08565990bbe
ms.sourcegitcommit: b3bad696c2b776d018d9f06b6e27bffaa3c0d9c3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2019
ms.locfileid: "69874915"
---
# <a name="collect-data-about-azure-virtual-machines"></a>Сбор данных о виртуальных машинах Azure

[Azure Log Analytics](../../azure-monitor/log-query/log-query-overview.md) может собирать данные напрямую c виртуальных машин Azure и других ресурсов в среде в один репозиторий для подробного анализа и корреляции. В этом кратком руководстве показано, как настроить и собирать данные c виртуальных машин под управлением Linux или Windows с помощью нескольких простых действий.  
 
В этом кратком руководстве предполагается, что у вас уже есть виртуальная машина Azure. Если нет, можно создать [виртуальную машину Windows](../../virtual-machines/windows/quick-create-portal.md) или [виртуальную машину Linux](../../virtual-machines/linux/quick-create-cli.md) с помощью соответствующих кратких руководств.

## <a name="sign-in-to-azure-portal"></a>Вход на портал Azure

Войдите на портал Azure по адресу [https://portal.azure.com](https://portal.azure.com). 

## <a name="create-a-workspace"></a>Создание рабочей области

1. На портале Azure щелкните **Все службы**. В списке ресурсов введите **Log Analytics**. Как только вы начнете вводить символы, список отфильтруется соответствующим образом. Выберите **Log Analytics**.

    ![Портал Azure](media/quick-collect-azurevm/azure-portal-01.png)<br>  

2. Выберите **Создать** и задайте следующие параметры:

   * Введите имя для новой **рабочей области Log Analytics**, например *DefaultLAWorkspace*.  
   * Выберите в раскрывающемся списке **подписку**, с которой нужно связать рабочую область, если выбранная по умолчанию не подходит.
   * В разделе **Группа ресурсов** выберите имеющуюся группу ресурсов, в которой содержится одна или несколько виртуальных машин Azure.  
   * Выберите **Расположение**, в котором развернуты виртуальные машины.  Дополнительные сведения о доступности службы Log Analytics в регионах см. в [этой статье](https://azure.microsoft.com/regions/services/).
   * При создании рабочей области в новой подписке, созданной после 2 апреля 2018 г., будет автоматически использоваться тарифный план *За ГБ*, и выбор ценовой категории будет недоступен.  При создании рабочей области в существующей подписке, созданной до 2 апреля, или в подписке, которая была привязана к существующей регистрации EA, выберите нужную ценовую категорию.  Дополнительные сведения о конкретной ценовой категории см. в статье [Цены на Log Analytics](https://azure.microsoft.com/pricing/details/log-analytics/).
  
        ![Колонка создания ресурса Log Analytics](media/quick-collect-azurevm/create-loganalytics-workspace-02.png) 

3. Завершив ввод обязательных сведений на панели **Рабочая область Log Analytics**, щелкните **OK**.  

Пока проверяются данные, ход создания рабочей области можно проверить в разделе **Уведомления** в меню. 

## <a name="enable-the-log-analytics-vm-extension"></a>Включение расширения виртуальной машины Log Analytics

[!INCLUDE [log-analytics-agent-note](../../../includes/log-analytics-agent-note.md)] 

На виртуальные машины Windows и Linux, развернутые в Azure, устанавливается агент Log Analytics с расширением виртуальной машины Log Analytics. Использование расширения упрощает процесс установки и автоматически настраивает агент на отправку данных в указанную вами рабочую область Log Analytics. Кроме того, агент обновляется автоматически, обеспечивая наличие новейших компонентов и исправлений. Прежде чем продолжить, проверьте, запущена ли виртуальная машина. В противном случае процесс не будет успешно завершен.  

>[!NOTE]
>Агент Log Analytics для Linux невозможно настроить для отправки отчетов в несколько рабочих областей Log Analytics. 

1. На портале Azure щелкните **Все службы** вверху слева. В списке ресурсов введите **Log Analytics**. Как только вы начнете вводить символы, список отфильтруется соответствующим образом. Выберите **Рабочие области Log Analytics**.

2. В списке рабочих областей Log Analytics выберите рабочую область *DefaultLAWorkspace*, созданную ранее.

3. В меню слева в разделе "Источники данных рабочей области" щелкните **Виртуальные машины**.  

4. В списке **виртуальных машин** выберите ту, на которую необходимо установить агент. Обратите внимание, что в **состоянии подключения Log Analytics** выбранной виртуальной машины указано значение **Не подключено**.

5. В колонке сведений о выбранной виртуальной машине выберите **Подключить**. Агент будет автоматически установлен и настроен для рабочей области Log Analytics. Этот процесс занимает несколько минут. Все это время отображается **состояние** **Подключение**.

6. После установки и подключения агента **состояние подключения Log Analytics** обновится и примет значение **Эта рабочая область**.

## <a name="collect-event-and-performance-data"></a>Сбор данных событий и производительности

Log Analytics может собирать события из журналов событий Windows или системного журнала Linux и счетчиков производительности, указанных для долгосрочного анализа и формирования отчетов, а также предпринимать действия при обнаружении определенного условия. Сначала выполните такие действия для настройки сбора событий из системного журнала Windows и Linux, а также нескольких стандартных счетчиков производительности.  

### <a name="data-collection-from-windows-vm"></a>Сбор данных из виртуальной машины Windows

1. Выберите **Дополнительные параметры**.

    ![Дополнительные параметры Log Analytics](media/quick-collect-azurevm/log-analytics-advanced-settings-01.png)

2. Выберите **Данные**, а затем — **Журналы событий Windows**.

3. Чтобы добавить журнал событий, введите его имя.  Введите **Система** и щелкните знак "плюс" ( **+** ).

4. Проверьте степени серьезности **Ошибка** и **Предупреждение** в таблице.

5. Вверху щелкните **Сохранить**, чтобы сохранить конфигурацию.

6. Выберите **Windows Performance Data** (Данные производительности Windows), чтобы включить сбор данных счетчиков производительности на компьютере Windows.

7. При первой настройке счетчиков производительности Windows для новой рабочей области Log Analytics вы можете быстро создать несколько распространенных счетчиков. Рядом с каждым счетчиком в списке есть флажок.

    ![Выбраны стандартные счетчики производительности Windows](media/quick-collect-azurevm/windows-perfcounters-default.png)

    Щелкните **Добавить выбранные счетчики производительности**.  Они добавляются и устанавливаются с десятисекундным интервалом сбора.
  
8. Вверху щелкните **Сохранить**, чтобы сохранить конфигурацию.

### <a name="data-collection-from-linux-vm"></a>Сбор данных из виртуальной машины Linux

1. Выберите **Системный журнал**.  

2. Чтобы добавить журнал событий, введите его имя.  Введите **Системный журнал** и щелкните знак "плюс" ( **+** ).  

3. В таблице снимите флажок для степеней серьезности **Информация**, **Уведомление** и **Отладить**. 

4. Вверху щелкните **Сохранить**, чтобы сохранить конфигурацию.

5. Выберите **Linux Performance Data** (Данные производительности Linux), чтобы включить сбор данных счетчиков производительности на компьютере Linux. 

6. При первой настройке счетчиков производительности Linux для новой рабочей области Log Analytics вы можете быстро создать несколько распространенных счетчиков. Рядом с каждым счетчиком в списке есть флажок.

    ![Выбраны стандартные счетчики производительности Windows](media/quick-collect-azurevm/linux-perfcounters-default.png)

    Выберите **Применение конфигурации, указанной ниже, к моим машинам** и щелкните **Добавить выбранные счетчики производительности**.  Они добавляются и устанавливаются с десятисекундным интервалом сбора.  

7. Вверху щелкните **Сохранить**, чтобы сохранить конфигурацию.

## <a name="view-data-collected"></a>Просмотр собранных данных

Теперь, когда сбор данных включен, можно запустить простой пример поиска по журналам, чтобы просмотреть некоторые данные из целевых виртуальных машин.  

1. На портале Azure перейдите к Log Analytics и выберите рабочую область, созданную ранее.

2. Щелкните плитку **Поиск по журналам** и в соответствующей области в поле запроса введите `Perf`, а затем нажмите клавишу ВВОД и нажмите кнопку "Поиск" справа от поля запроса.

    ![Пример запроса поиска по журналам Log Analytics](./media/quick-collect-azurevm/log-analytics-portal-perf-query.png) 

Например, запрос на следующем рисунке вернул 735 записей о производительности.  Ваши результаты будут значительно меньше.

![Результат поиска по журналам Log Analytics](media/quick-collect-azurevm/log-analytics-search-perf.png)

## <a name="clean-up-resources"></a>Очистка ресурсов

Удалите рабочую область Log Analytics, если она больше не нужна. Для этого выберите рабочую область Log Analytics, созданную ранее, и на странице ресурсов щелкните **Удалить**.


![Удаление ресурса Log Analytics](media/quick-collect-azurevm/log-analytics-portal-delete-resource.png)

## <a name="next-steps"></a>Дополнительная информация

Теперь, когда вы собираете данные о работе и производительности со своих виртуальных машин Windows или Linux, можно легко начать изучение и анализ собранных данных, а также работать с ними *бесплатно*.  

Чтобы узнать, как просматривать и анализировать данные, перейдите к следующему руководству.

> [!div class="nextstepaction"]
> [Просмотр и анализ данных, собранных с помощью поиска по журналам Log Analytics](../../azure-monitor/learn/tutorial-viewdata.md)
