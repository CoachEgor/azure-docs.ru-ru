---
title: Использование анализа изменений приложений в Azure Monitor для поиска проблем с веб-приложениями | Документация Майкрософт
description: Используйте анализ изменений приложений в Azure Monitor для устранения проблем с приложениями на активных веб-сайтах в службе приложений Azure.
ms.service: azure-monitor
ms.subservice: application-insights
ms.topic: conceptual
author: cawams
ms.author: cawa
ms.date: 05/07/2019
ms.openlocfilehash: dc572d29b4e6d95525959becad0ed8069735e33c
ms.sourcegitcommit: c62a68ed80289d0daada860b837c31625b0fa0f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/05/2019
ms.locfileid: "73605986"
---
# <a name="use-application-change-analysis-preview-in-azure-monitor"></a>Использование анализа изменений приложений (Предварительная версия) в Azure Monitor

При возникновении проблем на рабочем сайте или в случае сбоя быстро определить основную причину очень важно. Стандартные решения для мониторинга могут сообщить о проблеме. Они могут даже указывать, какой компонент не работает. Но это предупреждение не всегда немедленно объясняет причину сбоя. Вы уверены, что ваш сайт работал пять минут назад, и теперь он нарушен. Что изменилось за последние пять минут? Это вопрос, что анализ изменений приложения предназначен для ответа в Azure Monitor.

Основываясь на возможностях [графа ресурсов Azure](https://docs.microsoft.com/azure/governance/resource-graph/overview), анализ изменений позволяет получить ценные сведения об изменениях в приложении Azure, чтобы увеличить наблюдаемость и сократить MTTR (среднее время ремонта).

> [!IMPORTANT]
> Анализ изменений сейчас находится на этапе предварительной версии. Эта предварительная версия предоставляется без соглашения об уровне обслуживания. Эта версия не рекомендуется для рабочих нагрузок в рабочей среде. Некоторые функции могут не поддерживаться или иметь ограниченные возможности. Дополнительные сведения см. в разделе Дополнительные [условия использования для предварительных версий Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

## <a name="overview"></a>Обзор

Средство анализа изменений обнаруживает различные типы изменений, от уровня инфраструктуры до развертывания приложений. Это поставщик ресурсов Azure уровня подписки, который проверяет изменения ресурсов в подписке. Анализ изменений предоставляет данные для различных диагностических средств, которые помогают пользователям понять, какие изменения могут вызвать проблемы.

На следующей схеме показана архитектура анализа изменений.

![Схема архитектуры, с которой средство анализа изменений получает данные об изменениях и предоставляет их клиентским средствам](./media/change-analysis/overview.png)

Анализ изменений в настоящее время интегрирован в веб-приложение службы приложений для **диагностики и устранения проблем** . Чтобы включить обнаружение изменений и просмотреть изменения в веб-приложении, см. раздел *анализ изменений для функции веб-приложений* далее в этой статье.

### <a name="azure-resource-manager-deployment-changes"></a>Azure Resource Manager изменения развертывания

С помощью [графа ресурсов Azure](https://docs.microsoft.com/azure/governance/resource-graph/overview)анализ изменений позволяет вести историю того, как ресурсы Azure, на которых размещены приложения, изменились с течением времени. Анализ изменений может обнаружить, например, изменения в правилах IP-конфигурации, управляемых удостоверениях и параметров SSL. Поэтому при добавлении тега в веб-приложение анализ изменений отражает изменение. Эта информация доступна при условии, что поставщик ресурсов `Microsoft.ChangeAnalysis` включен в подписке Azure.

### <a name="changes-in-web-app-deployment-and-configuration-in-guest-changes"></a>Изменения в развертывании и настройке веб-приложения (изменения в гостевой системе)

Анализ изменений отслеживает развертывание и состояние конфигурации приложения каждые 4 часа. Это может обнаружить, например, изменения в переменных среды приложения. Средство вычислит различия и повлечет за собой изменения. В отличие от диспетчер ресурсов изменения, сведения об изменении развертывания кода могут быть недоступны сразу же в средстве. Чтобы просмотреть последние изменения в анализе изменений, выберите **проверить изменения сейчас**.

![Снимок экрана: кнопка "проверить изменения сейчас"](./media/change-analysis/scan-changes.png)

### <a name="dependency-changes"></a>Изменения зависимостей

Изменения зависимостей ресурсов также могут вызвать проблемы в веб-приложении. Например, если веб-приложение вызывает кэш Redis, номер SKU кэша Redis может повлиять на производительность веб-приложения. Для обнаружения изменений в зависимостях анализ изменений проверяет запись DNS веб-приложения. Таким образом, он определяет изменения во всех компонентах приложений, которые могут вызвать проблемы.
В настоящее время поддерживаются следующие зависимости:
- Веб-приложения
- Хранилище Azure
- Azure SQL

## <a name="viewing-changes-for-all-resources-in-azure"></a>Просмотр изменений для всех ресурсов в Azure
В Azure Monitor есть отдельная колонка для анализа изменений, позволяющая просматривать все изменения с ресурсами "аналитика" и "зависимости приложений".

Выполните поиск по запросу анализ изменений в строке поиска на портал Azure, чтобы запустить колонку.

![Снимок экрана: Поиск изменений в портал Azure](./media/change-analysis/search-change-analysis.png)

Выберите группу ресурсов и ресурсы, чтобы начать просмотр изменений.

![Снимок экрана: колонка "анализ изменений" в портал Azure](./media/change-analysis/change-analysis-standalone-blade.png)

Вы видите сведения о ресурсах и связанных зависимостях, в которых размещено ваше приложение. Это представление призвано быть ориентированным на приложения для разработчиков, устраняющих неполадки.

В настоящее время поддерживаются следующие ресурсы:
- Виртуальные машины
- Масштабируемый набор виртуальных машин
- Сетевые ресурсы Azure
- Изменение переменных среды для веб-приложения с отслеживанием файлов в гостевой системе

Для получения отзывов используйте кнопку Отправить отзыв в колонке или changeanalysisteam@microsoft.comэлектронной почты. 

![Снимок экрана: кнопка "Отзывы" в колонке "анализ изменений"](./media/change-analysis/change-analysis-feedback.png)

## <a name="change-analysis-for-the-web-apps-feature"></a>Анализ изменений для функции веб-приложений

В Azure Monitor анализ изменений также встроен в самостоятельную **диагностику и решение проблем** . Доступ к этому интерфейсу осуществляется со страницы **Обзор** приложения службы приложений.

![Снимок экрана с кнопкой "Обзор" и кнопкой "Диагностика и устранение проблем"](./media/change-analysis/change-analysis.png)

### <a name="enable-change-analysis-in-the-diagnose-and-solve-problems-tool"></a>Включение анализа изменений в средстве "Диагностика и устранение проблем"

1. Выберите **доступность и производительность**.

    ![Снимок экрана с параметрами устранения неполадок "доступность и производительность"](./media/change-analysis/availability-and-performance.png)

1. Выберите **изменения приложения**. Это не значит, что эта функция также доступна в случае **сбоев приложений**.

   ![Снимок экрана: кнопка "сбои приложения"](./media/change-analysis/application-changes.png)

1. Чтобы включить анализ изменений, выберите **Включить сейчас**.

   ![Снимок экрана: параметры "сбои приложений"](./media/change-analysis/enable-changeanalysis.png)

1. Включите **анализ изменений** и нажмите кнопку **сохранить**.

    ![Снимок экрана: Пользовательский интерфейс "Включение анализа изменений"](./media/change-analysis/change-analysis-on.png)


1. Чтобы получить доступ к анализу изменений, выберите **Диагностика и решение проблем** > **доступности и производительности** > **сбои приложений**. Вы увидите граф, который суммирует тип изменений со временем, а также подробные сведения об этих изменениях.

     ![Снимок экрана представления "изменение инструмента сравнения"](./media/change-analysis/change-view.png)


### <a name="enable-change-analysis-at-scale"></a>Включить анализ изменений в масштабе

Если ваша подписка включает множество веб-приложений, включение службы на уровне веб-приложения будет неэффективным. Выполните следующий скрипт, чтобы включить все веб-приложения в подписке.

Предварительные требования:
* Модуль PowerShell AZ. Следуйте инструкциям по [установке модуля Azure PowerShell](https://docs.microsoft.com/powershell/azure/install-az-ps?view=azps-2.6.0)

Выполните следующий скрипт:

```PowerShell
# Log in to your Azure subscription
Connect-AzAccount

# Get subscription Id
$SubscriptionId = Read-Host -Prompt 'Input your subscription Id'

# Make Feature Flag visible to the subscription
Set-AzContext -SubscriptionId $SubscriptionId

# Register resource provider
Register-AzResourceProvider -ProviderNamespace "Microsoft.ChangeAnalysis"


# Enable each web app
$webapp_list = Get-AzWebApp | Where-Object {$_.kind -eq 'app'}
foreach ($webapp in $webapp_list)
{
    $tags = $webapp.Tags
    $tags[“hidden-related:diagnostics/changeAnalysisScanEnabled”]=$true
    Set-AzResource -ResourceId $webapp.Id -Tag $tags -Force
}

```



## <a name="next-steps"></a>Дальнейшие действия

- Включите Application Insights для [приложений служб приложений Azure](azure-web-apps.md).
- Включите Application Insights для [виртуальных машин Azure и масштабируемых наборов виртуальной машины Azure, размещенных в IIS](azure-vm-vmss-apps.md).
- Узнайте больше о [графе ресурсов Azure](https://docs.microsoft.com/azure/governance/resource-graph/overview), который помогает анализировать изменения в Power On.
