---
title: Используйте анализ изменений приложений в Azure Monitor, чтобы найти проблемы с веб-приложением Документы Майкрософт
description: Используйте анализ изменений приложений в Azure Monitor для устранения неполадок в приложениях на живых сайтах службы приложений Azure.
ms.topic: conceptual
author: cawams
ms.author: cawa
ms.date: 05/07/2019
ms.openlocfilehash: 036b8c084bdfdc11c02274758c550c76bdc7b1e7
ms.sourcegitcommit: 8a9c54c82ab8f922be54fb2fcfd880815f25de77
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "80348729"
---
# <a name="use-application-change-analysis-preview-in-azure-monitor"></a>Используйте анализ изменений приложений (предварительный просмотр) в Azure Monitor

При возникновении проблемы или сбоя в реальном времени, быстрое определение основной причины имеет решающее значение. Стандартные решения мониторинга могут предупредить вас о проблеме. Они могут даже указывать, какой компонент не удается. Но это предупреждение не всегда сразу объясняет причину сбоя. Вы знаете, ваш сайт работал пять минут назад, и теперь он сломан. Что изменилось за последние пять минут? Этот вопрос предназначен для ответа в Azure Monitor.

Опираясь на возможности [Azure Resource Graph,](https://docs.microsoft.com/azure/governance/resource-graph/overview)анализ изменений позволяет получить представление об изменениях приложения Azure, чтобы повысить наблюдаемость и сократить MTTR (среднее время ремонта).

> [!IMPORTANT]
> Анализ изменений в настоящее время находится в предварительном просмотре. Эта предварительная версия предоставляется без соглашения об уровне обслуживания. Эта версия не рекомендуется для производственных нагрузок. Некоторые функции могут не поддерживаться или иметь ограниченные возможности. Для получения дополнительной [информации см.](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)

## <a name="overview"></a>Обзор

Анализ изменений обнаруживает различные типы изменений, от слоя инфраструктуры до развертывания приложений. Это поставщик ресурсов уровня подписки Azure, который проверяет изменения ресурсов в подписке. Анализ изменений предоставляет данные для различных диагностических инструментов, чтобы помочь пользователям понять, какие изменения могли вызвать проблемы.

Следующая диаграмма иллюстрирует архитектуру анализа изменений:

![Архитектурная диаграмма того, как анализ изменений получает данные об изменениях и предоставляет их инструментам клиента](./media/change-analysis/overview.png)

В настоящее время анализ изменений интегрирован в диагностику **и решение проблем** в веб-приложении App Service, а также доступен в качестве отдельной вкладки на портале Azure.
Посмотреть изменения для всех ресурсов в разделе *Azure,* чтобы получить доступ к лезвию анализа изменений, и раздел *«Анализ изменений» для раздела «Веб-приложения» для* использования его на портале Web App позже в этой статье.

### <a name="azure-resource-manager-tracked-properties-changes"></a>Диспетчер ресурсов Azure отслеживал изменения свойств

С помощью [графика ресурсов Azure](https://docs.microsoft.com/azure/governance/resource-graph/overview)— анализ изменений предоставляет историческую запись о том, как ресурсы Azure, хостайки, худощавые приложения, менялись с течением времени. Отслеживаемые настройки, такие как управляемые идентификаторы, обновление ОС платформы и имена хоста, могут быть обнаружены.

### <a name="azure-resource-manager-proxied-setting-changes"></a>Настройки настройки менеджера ресурсов Azure
Такие параметры, как правило конфигурации IP, настройки TLS и версии расширений, еще не доступны в ARG, поэтому анализ изменений требует и вычисляет эти изменения надежно, чтобы предоставить более подробную информацию о том, что изменилось в приложении. Эта информация пока не доступна в графике ресурсов Azure, но будет доступна в ближайшее время.

### <a name="changes-in-web-app-deployment-and-configuration-in-guest-changes"></a>Изменения в развертывании и конфигурации веб-приложений (изменения в гостях)

Анализ изменений фиксирует состояние развертывания и конфигурации приложения каждые 4 часа. Он может обнаруживать, например, изменения в переменных среды приложения. Инструмент вычисляет различия и представляет, что изменилось. В отличие от изменений менеджера ресурсов, информация об изменении развертывания кода может быть недоступна сразу в инструменте. Для просмотра последних изменений в анализе изменений выберите **изменения сканирования сейчас.**

![Скриншот кнопки "Сканирование изменений сейчас"](./media/change-analysis/scan-changes.png)

### <a name="dependency-changes"></a>Изменения зависимости

Изменения в зависимостях ресурсов также могут вызвать проблемы в веб-приложении. Например, если веб-приложение вызывает кэш Redis, SKU кэша Redis может повлиять на производительность веб-приложения. Чтобы обнаружить изменения в зависимостях, анализ изменений проверяет DNS запись веб-приложения. Таким образом, он определяет изменения во всех компонентах приложения, которые могут вызвать проблемы.
В настоящее время поддерживаются следующие зависимости:
- Веб-приложения
- Хранилище Azure
- Azure SQL

### <a name="enablement"></a>Включение
Поставщик ресурсов "Microsoft.ChangeAnalysis" должен быть зарегистрирован с подпиской на отслеживаемые свойства и доступные данные по настройкам ресурсов Azure. При вводе web App диагностировать и решать проблемы инструмент или воспитывать анализ изменений автономной вкладке, этот поставщик ресурсов автоматически регистрируется. Он не имеет каких-либо реализаций производительности и затрат для вашей подписки. Когда вы включите анализ изменений для веб-приложений (или включение в инструмент диагностики и решения проблем), это будет иметь незначительное влияние на производительность веб-приложения и без затрат на выставление счетов.
Для изменений в веб-приложении в гостях требуется отдельное включение для сканирования файлов кода в веб-приложении. Для получения дополнительной информации смотрите [анализ изменений включить в разделе Диагностика и решить проблемы инструмент](https://docs.microsoft.com/azure/azure-monitor/app/change-analysis#enable-change-analysis-in-the-diagnose-and-solve-problems-tool) позже в этой статье для более подробной информации.


## <a name="viewing-changes-for-all-resources-in-azure"></a>Просмотр изменений для всех ресурсов azure
В Azure Monitor имеется автономное лезвие для анализа изменений для просмотра всех изменений с помощью ресурсов сведения и зависимости приложений.

Поиск анализа изменений в панели поиска на портале Azure для запуска лезвия.

![Скриншот анализа изменений в Azure на портале Azure](./media/change-analysis/search-change-analysis.png)

Выберите группу ресурсов и ресурсы, чтобы начать просмотр изменений.

![Скриншот лезвия анализа изменений на портале Azure](./media/change-analysis/change-analysis-standalone-blade.png)

Можно увидеть исследования и связанные с ними ресурсы зависимостей, которые размещали ваше приложение. Это представление предназначено для того, чтобы разработчики не укладывали неполадки.

В настоящее время поддерживаемые ресурсы включают:
- Виртуальные машины
- Масштабируемый набор виртуальных машин
- Сетевые ресурсы Azure
- Веб-приложение с отслеживанием файлов в гостях и изменениями переменных среды

Для любой обратной связи используйте кнопку обратной связи в лезвии или электронной почте. changeanalysisteam@microsoft.com

![Скриншот кнопки обратной связи в лезвии анализа изменений](./media/change-analysis/change-analysis-feedback.png)

## <a name="change-analysis-for-the-web-apps-feature"></a>Анализ изменений для функции веб-приложений

В Azure Monitor анализ изменений также встроен в диагностику самообслуживания **и решение проблем.** Получите доступ к этому опыту со страницы **«Обзор»** приложения Службы приложения.

![Скриншот кнопки "Обзор" и кнопки "Диагностика и решение проблем"](./media/change-analysis/change-analysis.png)

### <a name="enable-change-analysis-in-the-diagnose-and-solve-problems-tool"></a>Включить анализ изменений в инструменте диагностики и решения проблем

1. Выберите **доступность и производительность**.

    ![Скриншот вариантов устранения неполадок «Доступность и производительность»](./media/change-analysis/availability-and-performance.png)

1. Выберите **изменения приложения**. Не то чтобы функция также доступна в **приложениях сбоев**.

   ![Скриншот кнопки "Сбои приложений"](./media/change-analysis/application-changes.png)

1. Для включения анализа изменений выберите **Enable now.**

   ![Скриншот опций "Application Crashes"](./media/change-analysis/enable-changeanalysis.png)

1. Включите **анализ изменений** и выберите **Сохранить**. Инструмент отображает все веб-приложения в соответствии с планом Службы приложений. Вы можете использовать переключатель уровня плана, чтобы включить анализ изменений для всех веб-приложений в соответствии с планом.

    ![Скриншот пользовательского интерфейса "Анализ изменений"](./media/change-analysis/change-analysis-on.png)


1. Чтобы получить доступ к анализу изменений, выберите **диагностику и устранение проблем** > доступности и**сбоев приложений****производительности.** >  Вы увидите график, который обобщает тип изменений с течением времени вместе с подробной информацией об этих изменениях. По умолчанию изменения за последние 24 часа отображаются, чтобы помочь при немедленных проблемах.

     ![Скриншот представления дисфа изменения](./media/change-analysis/change-view.png)


### <a name="enable-change-analysis-at-scale"></a>Включить анализ изменений в масштабе

Если ваша подписка включает в себя многочисленные веб-приложения, включение службы на уровне веб-приложения будет неэффективным. Выполнить следующий скрипт, чтобы включить все веб-приложения в подписке.

Предварительные требования:
* Модуль PowerShell Az. Следуйте инструкциям в [модуле «Установка Силы»](https://docs.microsoft.com/powershell/azure/install-az-ps?view=azps-2.6.0)

Выполните следующий скрипт:

```PowerShell
# Log in to your Azure subscription
Connect-AzAccount

# Get subscription Id
$SubscriptionId = Read-Host -Prompt 'Input your subscription Id'

# Make Feature Flag visible to the subscription
Set-AzContext -SubscriptionId $SubscriptionId

# Register resource provider
Register-AzResourceProvider -ProviderNamespace "Microsoft.ChangeAnalysis"


# Enable each web app
$webapp_list = Get-AzWebApp | Where-Object {$_.kind -eq 'app'}
foreach ($webapp in $webapp_list)
{
    $tags = $webapp.Tags
    $tags[“hidden-related:diagnostics/changeAnalysisScanEnabled”]=$true
    Set-AzResource -ResourceId $webapp.Id -Tag $tags -Force
}

```



## <a name="next-steps"></a>Дальнейшие действия

- Включите анализ приложений для [приложений приложений Azure](azure-web-apps.md)App Services.
- Включите приложения Исследования для [Azure VM и Azure виртуальной машинной шкалы набор IIS-хостинг приложений.](azure-vm-vmss-apps.md)
- Узнайте больше о [графике ресурсов Azure,](https://docs.microsoft.com/azure/governance/resource-graph/overview)который помогает анализу изменений мощности.
