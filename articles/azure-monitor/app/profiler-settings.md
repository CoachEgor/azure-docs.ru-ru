---
title: Использование панели параметров Azure Application Insights Profiler | Документация Майкрософт
description: Просмотр состояния средства Profiler и запуск сеансов профилирования
ms.topic: conceptual
author: cweining
ms.author: cweining
ms.date: 08/06/2018
ms.reviewer: mbullwin
ms.openlocfilehash: f66a23c0562ec9f1987bd119a45b7b767f2dfe46
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "77671636"
---
# <a name="configure-application-insights-profiler"></a>Настройка Application Insights Profiler

## <a name="updated-profiler-agent"></a>Обновленный агент профиля
Функции триггера работают только с версией 2.6 или более новой версией агента профайлера. Если вы работаете с службой приложений Azure, ваш агент будет обновляться автоматически. Вы можете увидеть, какую версию агента вы работаете, если вы идете на URL Kudu для вашего веб-сайта и приложение "DiagnosticServices к концу его, как это: https://yourwebsite.scm.azurewebsites.net/diagnosticservices. Приложение Insights Profiler Webjob должна версию 2.6 или новее. Вы можете заставить обновление путем перезапуска веб-приложения. 

Если вы работаете с профилировщиком на VM или облачной службе, вам необходимо установить версию расширения Windows Azure Diagnostics (WAD) 16.0.4 или более новую. Вы можете проверить версию WAD, войдя на свой VM и посмотреть этот каталог: C: «Пакеты»-Плагины»Microsoft.Azure.Diagnostics.IaaSDiagnostics 1.16.0.4. Название каталога является версия WAD, которая установлена. Агент Azure VM будет обновлять WAD автоматически, когда появляются новые версии.

## <a name="profiler-settings-page"></a>Страница настроек профиля

Чтобы открыть панель настроек Azure Application Insights Profiler, перейдите на панель производительности Application Insights, а затем выберите кнопку **Configure Profiler.**

![Ссылка на открытую страницу настроек Профилера][configure-profiler-entry]

Это открывает страницу, которая выглядит следующим образом:

![Страница настроек профиля][configure-profiler-page]

Страница **Configure Application Insights Profiler** имеет следующие функции:

| | |
|-|-|
Профиль сейчас | Запускает сеансы профилирования для всех приложений, связанных с этим экземпляром Application Insights.
Триггеры | Позволяет настроить триггеры, которые вызывают профайлер для запуска. 
Последние сеансы профилирования | Отображает сведения о прошлых сеансах профилирования.

## <a name="profile-now"></a>Профиль сейчас
Эта опция позволяет начать сеанс профилирования по требованию. При нажатии на эту ссылку все агенты-профайлера, отправляющие данные в этот экземпляр Application Insights, начнут захватывать профиль. Через 5-10 минут сессия профиля будет отображаться в списке ниже.

Для того чтобы пользователь вручную запускал сеанс профайлера, он требует как минимум "записи" доступа к своей роли для компонента Application Insights. В большинстве случаев вы получаете этот доступ автоматически, и дополнительная работа не требуется. Если у вас возникли проблемы, роль сферы подписки, чтобы добавить будет "Application Insights Компонент вкладчика" роль. [Подробнее о контроле доступа к роли с помощью мониторинга Azure.](https://docs.microsoft.com/azure/azure-monitor/app/resources-roles-access-control)

## <a name="trigger-settings"></a>Настройки триггера
![Настройки триггеров][trigger-settings-flyout]

Нажатие кнопки Триггеры в панели меню открывает окно настроек триггера. Можно настроить триггер, чтобы начать профилирование, когда процент использования процессора или памяти достигает установленного уровня.

| | |
|-|-|
На /Выключить кнопку | На: профайлер может быть запущен с помощью этого триггера; Выключите: профайлер не будет запущен с помощью этого триггера.
Порог памяти | Когда этот процент памяти используется, будет запущен профайлер.
Duration | Устанавливает продолжительность времени, в течение чем профайлер будет работать при срабатывании.
Cooldown | Устанавливает продолжительность времени, который профайлер будет ждать, прежде чем проверить использование памяти или процессора снова после его срабатывания.

## <a name="recent-profiling-sessions"></a>Последние сессии профилирования
В этом разделе страницы отображается информация о последних сеансах профилирования. Сеанс профилирования представляет собой период времени, когда агент профайлера брал профиль на одной из машин, принимающих ваше приложение. Вы можете открыть профили от сессии, нажав на один из строк. Для каждой сессии мы показываем:

| | |
|-|-|
Запуск по | Как сеанс был запущен либо триггером, профилем Now, либо выборкой по умолчанию. 
Имя приложения | Название приложения, которое было профилировано.
Машинная инстанция | Название машины, на которую побежал агент профайлера.
Отметка времени | Время, когда профиль был захвачен.
Трейси | Количество следов, которые были прикреплены к индивидуальным запросам.
% загрузки ЦП | Процент процессора, который использовался во время работы профайлера.
Память % | Процент памяти, которая использовалась во время работы профайлера.

## <a name="use-web-performance-tests-to-generate-traffic-to-your-application"></a><a id="profileondemand"></a>Используйте веб-тесты производительности для генерации трафика в приложении

Вы можете запустить средство Profiler вручную одним щелчком. Предположим, вы выполняете веб-тест производительности. Вам понадобятся следы, которые помогут вам понять, как ваше веб-приложение работает под нагрузкой. Очень важна возможность контролировать время записи трассировок, так как вам известно, когда будет выполняться нагрузочный тест. Однако это время может не совпадать с интервалом случайной выборки.

В следующем разделе объясняется, как работает этот сценарий.

### <a name="step-1-generate-traffic-to-your-web-app-by-starting-a-web-performance-test"></a>Шаг 1: Создание трафика в веб-приложении, начав тест на производительность в Интернете

Если в веб-приложение уже поступает входящий трафик или вы хотите создавать трафик вручную, пропустите этот раздел и перейдите к шагу 2.

1. На портале Application Insights выберите **Тестирование** > **производительности.** 

1. Нажмите кнопку **Создать**, чтобы запустить новый тест производительности.

   ![Создание теста производительности][create-performance-test]

1. В области **Новый тест производительности** настройте целевой URL-адрес теста. Примите все параметры по умолчанию, а затем выберите **Запустить тест**, чтобы запустить нагрузочный тест.

    ![Настройка нагрузочного теста][configure-performance-test]

    Вы увидите, что новый тест будет поставлен в очередь первым, а за ним будет следовать состояние *Выполняется*.

    ![Нагрузочный тест отправлен и поставлен в очередь][load-test-queued]

    ![Нагрузочный тест выполняется][load-test-in-progress]

### <a name="step-2-start-a-profiler-on-demand-session"></a>Шаг 2: Начало сеанса профилировщика по требованию

1. После запуска нагрузочного теста можно запустить средство Profiler для записи трассировок для веб-приложения в то время, когда оно получает нагрузку.

1. Перейдите на панель **настройки средства Profiler**.


### <a name="step-3-view-traces"></a>Шаг 3. Просмотр трассировок

После завершения работы средства Profiler следуйте инструкциям в уведомлении, чтобы перейти на панель "Производительность" и просмотреть трассировки.

## <a name="next-steps"></a>Дальнейшие действия
[Профилирование приложений в рабочей среде Azure с помощью Application Insights Profiler](profiler-overview.md?toc=/azure/azure-monitor/toc.json)

[profiler-on-demand]: ./media/profiler-settings/Profiler-on-demand.png
[configure-profiler-entry]: ./media/profiler-settings/configure-profiler-entry.png
[configure-profiler-page]: ./media/profiler-settings/configureBlade.png
[trigger-settings-flyout]: ./media/profiler-settings/CPUTrigger.png
[create-performance-test]: ./media/profiler-settings/new-performance-test.png
[configure-performance-test]: ./media/profiler-settings/configure-performance-test.png
[load-test-queued]: ./media/profiler-settings/load-test-queued.png
[load-test-in-progress]: ./media/profiler-settings/load-test-inprogress.png
[enable-app-insights]: ./media/profiler-settings/enable-app-insights-blade-01.png
[update-site-extension]: ./media/profiler-settings/update-site-extension-01.png
[change-and-save-appinsights]: ./media/profiler-settings/change-and-save-appinsights-01.png
[app-settings-for-profiler]: ./media/profiler-settings/appsettings-for-profiler-01.png
[check-for-extension-update]: ./media/profiler-settings/check-extension-update-01.png
[profiler-timeout]: ./media/profiler-settings/profiler-timeout.png
