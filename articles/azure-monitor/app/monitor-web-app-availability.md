---
title: Наблюдение за доступностью и скоростью реагирования веб-сайта | Документация Майкрософт
description: Настройка веб-тестов в Application Insights. Получение оповещений, когда веб-сайт становится недоступным или медленно реагирует на запросы.
ms.topic: conceptual
ms.date: 09/16/2019
ms.reviewer: sdash
ms.openlocfilehash: 61358051a8ddc32bc01ec5e231f4c28ebfa18ee0
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "77670038"
---
# <a name="monitor-the-availability-of-any-website"></a>Мониторинг наличия любого веб-сайта

После развертывания веб-приложения/веб-сайта можно настроить повторяющиеся тесты для мониторинга доступности и оперативности. [Azure Application Insights](../../azure-monitor/app/app-insights-overview.md) отправляет веб-запросы через одинаковые промежутки времени из разных точек по всему миру. Он может предупредить вас, если приложение не отвечает, или если он реагирует слишком медленно.

Вы можете настроить тесты доступности для любой конечной точки HTTP или HTTPS, доступной из Интернета. Вам не нужно вносить какие-либо изменения в веб-сайт, который вы тестируете. В самом деле, он даже не должен быть сайт у вас есть. Вы можете протестировать наличие API REST, от которого зависит ваша служба.

### <a name="types-of-availability-tests"></a>Типы тестов доступности:

Существует три типа тестов доступности:

* [Тест проверки связи с URL-адресом](#create-a-url-ping-test)– простой тест, который вы можете создать на портале Azure.
* [Многоступенчатый веб-тест](availability-multistep.md): Запись последовательности веб-запросов, которые могут быть воспроизведены для тестирования более сложных сценариев. Многоступенчатые веб-тесты создаются в Visual Studio Enterprise и загружаются на портал для выполнения.
* [Пользовательские тесты доступности треков:](https://docs.microsoft.com/dotnet/api/microsoft.applicationinsights.telemetryclient.trackavailability?view=azure-dotnet)Если вы решите создать `TrackAvailability()` пользовательское приложение для выполнения тестов доступности, метод может быть использован для отправки результатов в Application Insights.

**Можно создать до 100 тестов доступности на ресурс Application Insights.**

## <a name="create-an-application-insights-resource"></a>Создание ресурса Application Insights

Для создания теста доступности сначала необходимо создать ресурс Application Insights. Если вы уже создали ресурс, перейдите к следующему разделу, чтобы [создать тест URL Ping.](#create-a-url-ping-test)

На портале Azure выберите **«Создайте анализ приложений** > **для разработчиков инструментов»** > **Application Insights** и [создайте ресурс Application Insights.](create-new-resource.md)

## <a name="create-a-url-ping-test"></a>Создание теста проверки связи с URL-адресом

Название "URL пинг тест" немного неправильно. Чтобы было ясно, этот тест не использует ICMP (Интернет-протокол управления сообщениями) для проверки доступности вашего сайта. Вместо этого он использует более продвинутую функциональность запроса HTTP для проверки того, отвечает ли конечная точка. Он также измеряет производительность, связанную с этим ответом, и добавляет возможность устанавливать пользовательские критерии успеха в сочетании с более продвинутыми функциями, такими как разбор зависимых запросов, и позволяет повторно.

Чтобы создать первый запрос на доступность, откройте панель доступности и выберите **«Создать тест».**

![Укажите хотя бы URL-адрес своего веб-сайта](./media/monitor-web-app-availability/availability-create-test-001.png)

### <a name="create-a-test"></a>Создание теста

|Параметр| Объяснение
|----|----|----|
|**URL-адрес** |  Вы можете указать URL-адрес любой веб-страницы, которую требуется протестировать, но он должен быть видимым из общедоступного Интернета. URL-адрес может содержать строку запроса, поэтому вы, например, сможете немного поупражняться в работе с базой данных. Если URL-адрес указывает на перенаправление, мы будем переходить по нему до 10 раз.|
|**Запросы на парс-зависимые**| Тест запрашивает изображения, скрипты, файлы стилей и другие файлы, которые являются частью тестируемой веб-страницы. Записанное время ответа включает время, затраченное на получение этих файлов. Тест завершается неудачей, если какой-либо из этих ресурсов не может быть успешно загружен в течение тайм-аута для всего теста. Если этот флажок не установлен, то тест запросит только файл по указанному URL-адресу. Включение этой опции приводит к более строгой проверке. Тест может не выполниться в случаях, которые могут быть незаметны при ручном просмотре сайта.
|**Включить повторы**|когда тест завершается неудачей, он выполняется повторно после короткого интервала. Сообщение об ошибке отобразится только после трех неудачных попыток подряд. Последующие тесты будут выполняться с обычной частотой. Повторные попытки будут временно приостановлены до следующей успешной попытки. Это правило действует в любом расположении тестирования. **Мы рекомендуем этот вариант.** В среднем около 80 % неудачных попыток решаются при повторной попытке.|
|**Частота теста**| Задает частоту выполнения теста для всех тестовых расположений. При стандартной частоте в пять минут и с пятью тестовыми расположениями ваш сайт будет проверяться в среднем каждую минуту.|
|**Местопроведения**| Это места, откуда наши серверы отправляют веб-запросы на ваш URL. **Наше минимальное количество рекомендуемых тестовых мест составляет пять,** чтобы гарантировать, что вы можете отличить проблемы на вашем сайте от сетевых проблем. Вы можете выбрать до 16 таких расположений.

**Если ваш URL-адрес не виден из общедоступного интернета, вы можете выборочно открыть брандмауэр, чтобы разрешить только тестовые транзакции через.** Чтобы узнать больше об исключениях брандмауэра для наших агентов по тестированию доступности, обратитесь в руководство по [IP-адресам.](https://docs.microsoft.com/azure/azure-monitor/app/ip-addresses#availability-tests)

> [!NOTE]
> Мы настоятельно рекомендуем тестирование из нескольких мест, **как минимум пять местоположений.** Это позволяет предотвратить ложные предупреждения, которые могут возникнуть в результате временных проблем с определенным местоположением. Кроме того, мы обнаружили, что оптимальная конфигурация состоит в том, чтобы **количество тестовых местоположений было равно порогу местоположения оповещения No 2.**

### <a name="success-criteria"></a>Критерии успеха

|Параметр| Объяснение
|----|----|----|
| **Тайм-аут тестирования** |Уменьшите значение этого параметра, чтобы получать оповещения о медленных откликах. Тест считается неудачной попыткой, если ответы от сайта не были получены в течение заданного периода. Если выбрать параметр **Анализировать зависимые запросы**, все изображения, файлы стилей, скрипты и другие зависимые ресурсы будут получены в течение этого периода.|
| **ОТВЕТ HTTP** | Возвращаемый код состояния, который считается успешным результатом. Код 200 указывает на возврат нормальной веб-страницы.|
| **совпадение содержимого** | Строка, как "Добро пожаловать!" Проверим наличие точного совпадения (с учетом регистра) в каждом ответе. Это должна быть строка обычного текста без подстановочных знаков. Не забывайте, что если контент страницы изменяется, необходимо обновить эту строку. **Только английские символы поддерживаются с одержимо-совпадением** |

### <a name="alerts"></a>видны узлы

|Параметр| Объяснение
|----|----|----|
|**Ближайшее время (Предварительный просмотр)** | Рекомендуем использовать оповещения в режиме реального времени. Настройка этого типа оповещения выполняется после создания теста доступности.  |
|**Классический** | Мы больше не рекомендуем использовать классические оповещения для новых тестов доступности.|
|**Порог местоположения оповещения**|Мы рекомендуем как минимум 3 из 5 расположений. Оптимальная взаимосвязь между порогом местоположения оповещения и числом местоположений **тестирования** = — это**пороговое число тестовых мест - 2, с минимум пятью тестовыми местами.**|

## <a name="see-your-availability-test-results"></a>Просмотр результатов теста доступности

Результаты теста доступности могут быть визуализированы как с помощью строки, так и с броска просмотров участков.

Через несколько минут нажмите **«Освежите»,** чтобы увидеть результаты теста.

![Представление строк](./media/monitor-web-app-availability/availability-refresh-002.png)

Представление рассеяния показывает образцы результатов теста, в которых есть деталь диагностического теста.- Обработчик тестов хранит сведения о диагностике тестов, которые завершились сбоем. Диагностические сведения об успешно выполненных тестах хранятся для подмножества выполнений. Нависните над любой из зеленых/ красных точек, чтобы увидеть тест, имя теста и местоположение.

![Представление строк](./media/monitor-web-app-availability/availability-scatter-plot-003.png)

Выберите конкретный тест, расположение или сократите период времени, чтобы просмотреть дополнительные результаты для нужного периода времени. Используйте обозреватель поиска, чтобы просмотреть результаты всех тестов или воспользуйтесь запросами аналитики, чтобы запустить пользовательские отчеты для этих данных.

## <a name="inspect-and-edit-tests"></a> Изменение и проверка тестов

Чтобы отсечь, временно отключить или удалить тест щелкните эллипсы рядом с тестовым именем. Распространение изменений конфигурации для всех тестовых агентов после внесения изменений может занять до 20 минут.

![Просмотр данных теста. Отспособить и отключить веб-тест](./media/monitor-web-app-availability/edit.png)

При обслуживании службы может потребоваться отключить тесты доступности или правила оповещения, связанные с ними.

## <a name="if-you-see-failures"></a>При возникновении сбоев

Щелкните красную точку.

![Щелкните красную точку.](./media/monitor-web-app-availability/open-instance-3.png)

С помощью результатов тестов доступности вы увидите сведения о транзакциях для всех компонентов. Здесь можно:

* изучить ответ, полученный от сервера;
* диагностировать сбой на основе коррелированной телеметрии на стороне сервера, собранной во время обработки теста доступности, завершившегося сбоем;
* добавить в журнал проблему или рабочий элемент в Git или Azure Boards для отслеживания проблемы; ошибка будет содержать ссылку на это событие;
* открыть результат веб-теста в Visual Studio.

См. дополнительные сведения об [интерфейсе сквозной диагностики транзакций](../../azure-monitor/app/transaction-diagnostics.md).

Щелкните строку исключения, чтобы просмотреть подробности исключения на стороне сервера, вызвавшего сбой искусственного теста доступности. Можно также получить [отладочный моментальный снимок](../../azure-monitor/app/snapshot-debugger.md) для более широкой диагностики на уровне кода.

![Диагностика на стороне сервера](./media/monitor-web-app-availability/open-instance-4.png)

В дополнение к необработанным результатам, вы также можете просмотреть две ключевые метрики доступности в [Metrics Explorer:](https://docs.microsoft.com/azure/azure-monitor/platform/metrics-getting-started)

1. Доступность. Количество успешно выполненных тестов (в процентах).
2. Продолжительность теста. Средняя длительность всех тестов.

## <a name="automation"></a>Служба автоматизации

* [Используйте сценарии PowerShell, чтобы настройка теста доступности](../../azure-monitor/app/powershell.md#add-an-availability-test) выполнялась автоматически.
* Настройте вызов [webhook](../../azure-monitor/platform/alerts-webhooks.md), активируемый оповещением.

## <a name="troubleshooting"></a>Устранение неполадок

Выделенная [статья для устранения неполадок](troubleshoot-availability.md).

## <a name="next-steps"></a>Дальнейшие действия

* [Оповещения о доступности](availability-alerts.md)
* [Многошаговые веб-тесты](availability-multistep.md)


