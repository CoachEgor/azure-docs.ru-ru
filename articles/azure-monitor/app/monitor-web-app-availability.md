---
title: Наблюдение за доступностью и скоростью реагирования веб-сайта | Документация Майкрософт
description: Настройка веб-тестов в Application Insights. Получение оповещений, когда веб-сайт становится недоступным или медленно реагирует на запросы.
ms.service: azure-monitor
ms.subservice: application-insights
ms.topic: conceptual
author: mrbullwinkle
ms.author: mbullwin
ms.date: 09/16/2019
ms.reviewer: sdash
ms.openlocfilehash: 074b5c175305131cd67cc6660d13756a83386c11
ms.sourcegitcommit: 8e271271cd8c1434b4254862ef96f52a5a9567fb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/23/2019
ms.locfileid: "72819294"
---
# <a name="monitor-the-availability-of-any-website"></a>Мониторинг доступности любого веб-сайта

После развертывания веб-приложения или веб-сайта можно настроить повторяющиеся тесты для отслеживания доступности и реагирования. [Azure Application Insights](../../azure-monitor/app/app-insights-overview.md) отправляет веб-запросы через одинаковые промежутки времени из разных точек по всему миру. Он может оповещать вас о том, что приложение не отвечает, или если оно реагирует слишком медленно.

Вы можете настроить тесты доступности для любой конечной точки HTTP или HTTPS, доступной из Интернета. Вам не нужно вносить никаких изменений в тестируемый веб-сайт. На самом деле, даже не обязательно быть владельцем сайта. Можно проверить доступность REST API, от которой зависит служба.

### <a name="types-of-availability-tests"></a>Типы тестов доступности:

Существует три типа тестов доступности.

* [Тест проверки связи с URL-адресом](#create-a-url-ping-test)– простой тест, который вы можете создать на портале Azure.
* [Многошаговый веб-тест](availability-multistep.md): запись последовательности веб-запросов, которую можно воспроизводить для тестирования более сложных сценариев. Многошаговые веб-тесты создаются в Visual Studio Enterprise и передаются на портал для выполнения.
* [Тесты доступности пользовательской трассировки](https://docs.microsoft.com/dotnet/api/microsoft.applicationinsights.telemetryclient.trackavailability?view=azure-dotnet). Если вы решили создать пользовательское приложение для выполнения тестов доступности, то для отправки результатов в Application Insights можно использовать метод `TrackAvailability()`.

**Для каждого Application Insights ресурса можно создать до 100 тестов доступности.**

## <a name="create-an-application-insights-resource"></a>Создание ресурса Application Insights

Чтобы создать тест доступности, сначала необходимо создать ресурс Application Insights. Если вы уже создали ресурс, перейдите к следующему разделу, чтобы [создать тест проверки связи по URL-адресу](#create-a-url-ping-test).

На портал Azure выберите **создать ресурс** > **средства для разработчиков** > **Application Insights** и [Создайте ресурс Application Insights](create-new-resource.md).

## <a name="create-a-url-ping-test"></a>Создание теста проверки связи с URL-адресом

Имя "Проверка связи по URL-адресу" является битом атрибутаDurableService. Для проверки доступности веб-узла этот тест не использует ICMP (Протокол управляющих сообщений Интернета). Вместо этого для проверки того, отвечает ли конечная точка, используется более сложная функциональность HTTP-запросов. Он также измеряет производительность, связанную с этим ответом, и добавляет возможность установки настраиваемых критериев успеха, связанных с более сложными функциями, такими как синтаксический анализ зависимых запросов и разрешение на повторные попытки.

Чтобы создать первый запрос на доступность, откройте область доступность и выберите **создать тест**.

![Укажите хотя бы URL-адрес своего веб-сайта](./media/monitor-web-app-availability/availability-create-test-001.png)

### <a name="create-a-test"></a>Создание теста

|Параметр| Пояснение
|----|----|----|
|**URL-адрес** |  URL-адрес может быть любой веб-страницей, которую вы хотите протестировать, но она должна быть видима из общедоступного Интернета. URL-адрес может содержать строку запроса, поэтому вы, например, сможете немного поупражняться в работе с базой данных. Если URL-адрес указывает на перенаправление, мы будем переходить по нему до 10 раз.|
|**Анализ зависимых запросов**| Обрабатываются изображения, сценарии, файлы стилей и другие файлы, которые являются частью тестируемой веб-страницы. Записанное время ответа включает время, затраченное на получение этих файлов. Тест завершается ошибкой, если какие-либо из этих ресурсов невозможно загрузить в течение времени ожидания для всего теста. Если этот флажок не установлен, то тест запросит только файл по указанному URL-адресу. Включение этого параметра приводит к более тщательной проверке. Тест может завершиться ошибкой в случаях, которые могут быть незаметны при ручном просмотре сайта.
|**Разрешить повторные попытки**|при неудачном завершении теста оно повторяется через короткий интервал. Сообщение об ошибке отобразится только после трех неудачных попыток подряд. Последующие тесты будут выполняться с обычной частотой. Повторные попытки будут временно приостановлены до следующей успешной попытки. Это правило действует в любом расположении тестирования. **Рекомендуется использовать этот вариант**. В среднем около 80 % неудачных попыток решаются при повторной попытке.|
|**Периодичность проверки**| Задает частоту выполнения теста для всех тестовых расположений. При стандартной частоте в пять минут и с пятью тестовыми расположениями ваш сайт будет проверяться в среднем каждую минуту.|
|**Расположения тестов**| — Это места, из которых наши серверы отправляют веб-запросы на ваш URL-адрес. **Минимальное количество рекомендуемых тестовых расположений — пять** , чтобы вы могли отличать проблемы на веб-сайте от сетевых проблем. Вы можете выбрать до 16 таких расположений.

**Если ваш URL-адрес не виден из общедоступного Интернета, можно выбрать выборочное открытие брандмауэра, чтобы разрешить только тестовые транзакции с помощью**. Дополнительные сведения об исключениях брандмауэра для агентов тестирования доступности см. в описании [IP-адресов](https://docs.microsoft.com/azure/azure-monitor/app/ip-addresses#availability-tests).

> [!NOTE]
> Настоятельно рекомендуется выполнять тестирование из нескольких расположений, в которых не **менее пяти расположений**. Это позволяет предотвратить ложные предупреждения, которые могут возникнуть в результате временных проблем с определенным местоположением. Кроме того, мы обнаружили, что оптимальной конфигурацией является то, что **количество тестовых расположений будет равно порогу расположения предупреждений + 2**.

### <a name="success-criteria"></a>Условия успеха

|Параметр| Пояснение
|----|----|----|
| **Время ожидания теста** |Уменьшите значение этого параметра, чтобы получать оповещения о медленных откликах. Тест считается неудачной попыткой, если ответы от сайта не были получены в течение заданного периода. Если выбрать параметр **Анализировать зависимые запросы**, все изображения, файлы стилей, скрипты и другие зависимые ресурсы будут получены в течение этого периода.|
| **HTTP-ответ** | Возвращаемый код состояния, который считается успешным результатом. Код 200 указывает на возврат нормальной веб-страницы.|
| **Совпадение содержимого** | Строка, например "Добро пожаловать!" Проверим наличие точного совпадения (с учетом регистра) в каждом ответе. Это должна быть строка обычного текста без подстановочных знаков. Не забывайте, что если контент страницы изменяется, необходимо обновить эту строку. **С совпадением содержимого поддерживаются только английские символы** |

### <a name="alerts"></a>Оповещения

|Параметр| Пояснение
|----|----|----|
|**Почти в реальном времени (Предварительная версия)** | Мы рекомендуем использовать оповещения практически в реальном времени. Настройка этого типа оповещений выполняется после создания теста доступности.  |
|**Классический** | Мы больше не рекомендуем использовать классические оповещения для новых тестов доступности.|
|**Порог расположения предупреждения**|Мы рекомендуем как минимум 3 из 5 расположений. Оптимальное отношение между пороговым значением расположения предупреждений и числом расположений тестов — **пороговое значение расположения предупреждений**  = **число расположений тестирования — 2, с минимум пятью расположениями тестов.**|

## <a name="see-your-availability-test-results"></a>Просмотр результатов теста доступности

Результаты теста доступности можно отображать как в виде графика, так и в виде точечной диаграммы.

Через несколько минут нажмите кнопку " **Обновить** ", чтобы просмотреть результаты теста.

![Линейное представление](./media/monitor-web-app-availability/availability-refresh-002.png)

В представлении точечная диаграмма отображаются образцы результатов теста, в которых содержатся диагностические сведения о тестовых шагах. Обработчик тестов хранит сведения о диагностике тестов, которые завершились сбоем. Диагностические сведения об успешно выполненных тестах хранятся для подмножества выполнений. Наведите указатель мыши на любую из зеленых или красных точек, чтобы увидеть тест, имя теста и расположение.

![Линейное представление](./media/monitor-web-app-availability/availability-scatter-plot-003.png)

Выберите конкретный тест, расположение или сократите период времени, чтобы просмотреть дополнительные результаты для нужного периода времени. Используйте обозреватель поиска, чтобы просмотреть результаты всех тестов или воспользуйтесь запросами аналитики, чтобы запустить пользовательские отчеты для этих данных.

## <a name="inspect-and-edit-tests"></a>Проверка и изменение тестов

Чтобы изменить, временно отключить или удалить тест, нажмите кнопку с многоточием рядом с именем теста. После внесения изменений изменения конфигурации для распространения на все агенты тестирования могут занять до 20 минут.

![Просмотр сведений о тесте. Изменение и отключение веб-теста](./media/monitor-web-app-availability/edit.png)

При обслуживании службы может потребоваться отключить тесты доступности или правила оповещения, связанные с ними.

## <a name="if-you-see-failures"></a>Если отображаются ошибки

Щелкните красную точку.

![Щелкните красную точку.](./media/monitor-web-app-availability/open-instance-3.png)

С помощью результатов тестов доступности вы увидите сведения о транзакциях для всех компонентов. Здесь можно:

* изучить ответ, полученный от сервера;
* диагностировать сбой на основе коррелированной телеметрии на стороне сервера, собранной во время обработки теста доступности, завершившегося сбоем;
* добавить в журнал проблему или рабочий элемент в Git или Azure Boards для отслеживания проблемы; ошибка будет содержать ссылку на это событие;
* открыть результат веб-теста в Visual Studio.

См. дополнительные сведения об [интерфейсе сквозной диагностики транзакций](../../azure-monitor/app/transaction-diagnostics.md).

Щелкните строку исключения, чтобы просмотреть подробности исключения на стороне сервера, вызвавшего сбой искусственного теста доступности. Можно также получить [отладочный моментальный снимок](../../azure-monitor/app/snapshot-debugger.md) для более широкой диагностики на уровне кода.

![Диагностика на стороне сервера](./media/monitor-web-app-availability/open-instance-4.png)

Помимо необработанных результатов, можно также просмотреть две метрики доступности в [Обозреватель метрик](https://docs.microsoft.com/azure/azure-monitor/platform/metrics-getting-started).

1. Доступность. Количество успешно выполненных тестов (в процентах).
2. Продолжительность теста. Средняя длительность всех тестов.

## <a name="automation"></a>Служба автоматизации

* [Используйте сценарии PowerShell, чтобы настройка теста доступности](../../azure-monitor/app/powershell.md#add-an-availability-test) выполнялась автоматически.
* Настройте вызов [webhook](../../azure-monitor/platform/alerts-webhooks.md), активируемый оповещением.

## <a name="troubleshooting"></a>Устранение неисправностей

Выделенная [статья по устранению неполадок](troubleshoot-availability.md).

## <a name="next-steps"></a>Дальнейшие действия

* [Оповещения о доступности](availability-alerts.md)
* [Многошаговые веб-тесты](availability-multistep.md)


