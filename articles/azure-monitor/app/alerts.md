---
title: Установите оповещения в Azure Application Insights
description: Получайте уведомления о малом времени отклика, исключениях или других изменениях производительности или использования в веб-приложении.
ms.topic: conceptual
ms.date: 01/23/2019
ms.reviewer: lagayhar
ms.subservice: alerts
ms.openlocfilehash: 28fd59556a586b85a6d3caf188d9e02c11d31e3b
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80295082"
---
# <a name="set-alerts-in-application-insights"></a>Настройка оповещений в Application Insights

[Azure Application Insights][start] может предупреждать об изменениях в метриках производительности или использования в веб-приложении. 

Application Insights выполняет мониторинг живого приложения на [разнообразных платформах][platforms], чтобы помочь вам диагностировать проблемы с производительностью и понять закономерности использования приложения.

Существует несколько типов оповещений:

* [**Метрические оповещения**](../../azure-monitor/platform/alerts-metric-overview.md) говорят вам, когда метрика пересекает пороговое значение для определенного периода - например, время отклика, количество исключений, использование процессора или просмотры страниц.
* [**Оповещения журнала**](../../azure-monitor/platform/alerts-unified-log.md) используются для описания оповещений, где сигнал оповещения основан на пользовательском запросе Kusto.
* [**веб-тесты**][availability], сообщающие о том, что сайт недоступен в Интернете или медленно реагирует на запросы. Ознакомьтесь с [дополнительными сведениями][availability].
* [**Упреждающая диагностика**](../../azure-monitor/app/proactive-diagnostics.md) автоматически настроена для отправки уведомлений о необычных показателях производительности.

## <a name="how-to-set-an-exception-alert-using-custom-log-search"></a>Как настроить оповещение об исключении с помощью пользовательского поиска журналов

В этом разделе мы посмотрим, как настроить оповещение об исключении на основе запроса. В этом примере предположим, что мы хотим получить оповещение, когда неудавшийся показатель превышает 10% за последние 24 часа.

1. Перейдите на ресурс Application Insight на портале Azure.
2. Слева, под настройкой нажмите на **alert**.

    ![Слева под настройкой нажмите оповещения](./media/alerts/1appinsightalert.png)

3. В верхней части вкладки оповещения выберите **новое правило оповещения.**

     ![В верхней части вкладки оповещения нажмите новое правило оповещения](./media/alerts/2createalert.png)

4. Ваш ресурс должен быть автоматически выбран. Чтобы установить условие, нажмите **Добавить условие**.

    ![Нажмите добавить состояние](./media/alerts/3addcondition.png)

5. В вкладке логики настройки сигнала выберите **пользовательский поиск журнала**

    ![Нажмите пользовательский поиск журнала](./media/alerts/4customlogsearch.png)

6. В пользовательской вкладке поиска журнала введите запрос в поле "Поиск запроса". В этом примере мы будем использовать ниже query Kusto.
    ```kusto
    let percentthreshold = 10;
    let period = 24h;
    requests
    | where timestamp >ago(period)
    | summarize requestsCount = sum(itemCount)
    | project requestsCount, exceptionsCount = toscalar(exceptions | where timestamp >ago(period) | summarize sum(itemCount))
    | extend exceptionsRate = toreal(exceptionsCount)/toreal(requestsCount) * 100
    | where exceptionsRate > percentthreshold

    ```

    ![Введите запрос в поле поиска запроса](./media/alerts/5searchquery.png)
    
    > [!NOTE]
    > Эти действия можно также применить к другим типам оповещений на основе запросов. Вы можете узнать больше о языке запроса Kusto от этого [Kusto получать начал документ](https://docs.microsoft.com/azure/kusto/concepts/) или это [S'L к кусто шпаргалка](https://docs.microsoft.com/azure/kusto/query/sqlcheatsheet)

7. В соответствии с "Логика оповещения", выбрать, является ли это на основе количества результатов или метрических измерений. Затем выберите условие (больше, чем, равно, меньше, чем) и порог. При изменении этих значений можно заметить изменения предложения предварительного просмотра состояния. В этом примере мы используем "равный".

    ![В логике оповещения выберите из вариантов, предусмотренных на основе и состоянии, а затем введите порог](./media/alerts/6alertlogic.png)

8. В соответствии с "Оценка на основе", установить период и частоту. Период здесь должен соответствовать значению, которое мы ставим за период в запросе выше. Затем нажмите **сделано**.

    ![Установите период и частоту в нижней части, а затем нажмите сделано](./media/alerts/7evaluate.png)

9. Теперь мы видим состояние, которое мы создали с оценочной ежемесячной стоимостью. Ниже [приведены "Группы действий",](../platform/action-groups.md) вы можете создать новую группу или выбрать существующую. Если вы хотите, вы можете настроить действия.

    ![нажмите на выбрать или создать кнопки под группой действий](./media/alerts/8actiongroup.png)

10. Наконец, добавьте свои данные оповещения (имя правила оповещения, описание, серьезность). Когда вы закончите, нажмите **Создать правило оповещения** в нижней части.

    ![Под оповещением подробно введите имя правила оповещения, напишите описание и выберите тяжесть](./media/alerts/9alertdetails.png)

## <a name="how-to-unsubscribe-from-classic-alert-e-mail-notifications"></a>Как отписаться от классических уведомлений по электронной почте

Этот раздел относится к **классическим предупреждениям о доступности,** **классическим предупреждениям о прогнозах приложений Insights,** а также к **классическим предупреждениям аномалий отказа.**

Вы получаете уведомления по электронной почте для этих классических оповещений, если какое-либо из следующих применяется:

* Ваш адрес электронной почты указан в поле получателей сообщений электронной почты уведомления в настройках правил оповещения.

* Функция отправки уведомлений по электронной почте пользователям, имеющим определенные роли для подписки, активирована, и вы занимаете соответствующую роль для этой конкретной подписки Azure.

![Скриншот уведомления оповещения](./media/alerts/alert-notification.png)

Чтобы лучше контролировать вашу безопасность и конфиденциальность, мы обычно рекомендуем вам прямо указать получателей уведомлений для классических оповещений в поле **получателей электронной почты Уведомления.** Возможность уведомлять всех пользователей, имеющих определенные роли, предоставляется для обратной совместимости.

Чтобы отписаться от уведомлений по электронной почте, генерируемых определенным правилом оповещения, удалите свой адрес электронной почты из поля **получателей электронной почты Уведомления.**

Если ваш адрес электронной почты не указан явно, мы рекомендуем вам отключить возможность автоматически уведомлять всех участников определенных ролей, а вместо этого перечислить все сообщения электронной почты пользователей, которым необходимо получать уведомления для этого правила оповещения в сообщении уведомления получателей поля.

## <a name="who-receives-the-classic-alert-notifications"></a>Кто получает (классические) оповещения?

Этот раздел относится только к классическим оповещениям, он поможет вам оптимизировать уведомления так, чтобы они приходили только желаемым получателям. Чтобы понять разницу между [классическими предупреждениями](../platform/alerts-classic.overview.md) и новым опытом оповещения, обратитесь к [статье обзора предупреждений.](../platform/alerts-overview.md) Для управления оповещениями в новом опыте оповещения используйте [группы действий.](../platform/action-groups.md)

* Мы рекомендуем использовать определенных получателей для классических оповещений.

* Если флажок **bulk/group** (массовый/групповой) включен, оповещения на основе соответствующих метрик Application Insights будут отправляться пользователям с ролями владельца, участника или читателя в подписке. Фактически, _все_ пользователи, имеющие доступ к подписке Application Insights, находятся в области действия и будут получать уведомления.

> [!NOTE]
> При отключении используемого флажка **bulk/group** (массовый/груповой) вы не сможете отменить изменение.

Используйте новые возможности оповещений и оповещения почти в реальном времени, если вам нужно уведомлять пользователей в зависимости от их ролей. С помощью [групп действий](../platform/action-groups.md) вы можете настроить уведомления по электронной почте для пользователей с любой из ролей — участника, владельца или читателя (не объединяемых вместе как один параметр).

## <a name="automation"></a>Служба автоматизации
* [Использование PowerShell для автоматизации настройки оповещений](../../azure-monitor/app/powershell-alerts.md)
* [Использование объектов webhook для автоматизации реагирования на оповещения](../../azure-monitor/platform/alerts-webhooks.md)

## <a name="see-also"></a>См. также
* [Доступность веб-тестов](../../azure-monitor/app/monitor-web-app-availability.md)
* [Автоматическая настройка оповещений](../../azure-monitor/app/powershell-alerts.md)
* [Упреждающая диагностика](../../azure-monitor/app/proactive-diagnostics.md) 

<!--Link references-->

[availability]: ../../azure-monitor/app/monitor-web-app-availability.md
[client]: ../../azure-monitor/app/javascript.md
[platforms]: ../../azure-monitor/app/platforms.md
[roles]: ../../azure-monitor/app/resources-roles-access-control.md
[start]: ../../azure-monitor/app/app-insights-overview.md

