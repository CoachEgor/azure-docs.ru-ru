---
title: Настройка оповещений в Azure Application Insights
description: Получайте уведомления о малом времени отклика, исключениях или других изменениях производительности или использования в веб-приложении.
ms.topic: conceptual
ms.date: 01/23/2019
ms.reviewer: lagayhar
ms.subservice: alerts
ms.openlocfilehash: 28fd59556a586b85a6d3caf188d9e02c11d31e3b
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "80295082"
---
# <a name="set-alerts-in-application-insights"></a>Настройка оповещений в Application Insights

[Azure Application Insights][start] может предупреждать об изменениях в метриках производительности или использования в веб-приложении. 

Application Insights выполняет мониторинг живого приложения на [разнообразных платформах][platforms], чтобы помочь вам диагностировать проблемы с производительностью и понять закономерности использования приложения.

Существует несколько типов оповещений.

* [**Оповещения метрики**](../../azure-monitor/platform/alerts-metric-overview.md) сообщают, когда метрика пересекает пороговое значение в течение некоторого периода, например время отклика, количество исключений, загрузка ЦП или Просмотры страниц.
* [**Оповещения журнала**](../../azure-monitor/platform/alerts-unified-log.md) используются для описания предупреждений, в которых сигнал оповещения основан на пользовательском запросе Kusto.
* [**веб-тесты**][availability], сообщающие о том, что сайт недоступен в Интернете или медленно реагирует на запросы. [Подробнее][availability].
* [**Упреждающая диагностика**](../../azure-monitor/app/proactive-diagnostics.md) автоматически настроена для отправки уведомлений о необычных показателях производительности.

## <a name="how-to-set-an-exception-alert-using-custom-log-search"></a>Настройка предупреждения об исключении с помощью пользовательского поиска по журналам

В этом разделе мы рассмотрим, как задать предупреждение об исключении на основе запроса. Для этого примера предположим, что нам требуется оповещение, если частота сбоев превышает 10% за последние 24 часа.

1. Перейдите к ресурсу Application Insight в портал Azure.
2. Слева в разделе Настройка щелкните **оповещение**.

    ![Слева в разделе Настройка щелкните оповещение.](./media/alerts/1appinsightalert.png)

3. В верхней части вкладки оповещение выберите **новое правило генерации оповещений**.

     ![В верхней части вкладки оповещение щелкните новое правило генерации оповещений.](./media/alerts/2createalert.png)

4. Ресурс должен быть выбран для автоматического выбора. Чтобы задать условие, нажмите кнопку **Добавить условие**.

    ![Нажмите кнопку Добавить условие.](./media/alerts/3addcondition.png)

5. На вкладке Настройка логики сигнала выберите **Пользовательский поиск по журналам** .

    ![Щелкните Пользовательский поиск по журналам](./media/alerts/4customlogsearch.png)

6. На вкладке пользовательский поиск по журналу введите запрос в поле поисковый запрос. В этом примере мы будем использовать приведенный ниже запрос Kusto.
    ```kusto
    let percentthreshold = 10;
    let period = 24h;
    requests
    | where timestamp >ago(period)
    | summarize requestsCount = sum(itemCount)
    | project requestsCount, exceptionsCount = toscalar(exceptions | where timestamp >ago(period) | summarize sum(itemCount))
    | extend exceptionsRate = toreal(exceptionsCount)/toreal(requestsCount) * 100
    | where exceptionsRate > percentthreshold

    ```

    ![Запрос типа в поле поискового запроса](./media/alerts/5searchquery.png)
    
    > [!NOTE]
    > Эти действия также можно применить к другим типам оповещений на основе запросов. Дополнительные сведения о языке запросов Kusto можно узнать из этого [документа Kusto Start doc](https://docs.microsoft.com/azure/kusto/concepts/) или с этого [SQL в Kusto Памятка по](https://docs.microsoft.com/azure/kusto/query/sqlcheatsheet) .

7. В разделе "логика оповещения" выберите, будет ли он основываться на количестве результатов или измерении метрик. Затем выберите условие (больше, равно, меньше) и пороговое значение. При изменении этих значений можно заметить, что предложение предварительного просмотра условия изменяется. В этом примере используется «Equal to».

    ![В разделе логика оповещений выберите из параметров, предоставленных для, на основе условия и введите пороговое значение.](./media/alerts/6alertlogic.png)

8. В разделе "Оценено на основе" задайте период и частоту. Период здесь должен соответствовать значению, которое мы поместили для периода в приведенном выше запросе. Затем нажмите кнопку **Готово**.

    ![Задайте период и частоту внизу и нажмите кнопку Готово.](./media/alerts/7evaluate.png)

9. Теперь мы увидим созданное нами условие с расчетной месячной стоимостью. Ниже в разделе ["группы действий"](../platform/action-groups.md) можно создать новую группу или выбрать существующую. При необходимости можно настроить действия.

    ![Нажмите кнопку Выбрать или создать в группе действий.](./media/alerts/8actiongroup.png)

10. Наконец, добавьте сведения о предупреждении (имя правила оповещения, описание, серьезность). По завершении нажмите кнопку **создать правило генерации оповещений** внизу.

    ![В разделе сведения о предупреждении введите имя правила оповещения, запишите описание и выберите серьезность.](./media/alerts/9alertdetails.png)

## <a name="how-to-unsubscribe-from-classic-alert-e-mail-notifications"></a>Отмена подписки на уведомления по электронной почте с классическими оповещениями

Этот раздел относится к **классическим**оповещениям о доступности, **классическим Application Insights оповещениям метрик**и к **классическим предупреждениям о сбоях**.

Вы получаете уведомления по электронной почте для этих классических оповещений, если выполняется одно из следующих условий.

* Ваш адрес электронной почты указан в поле Получатели уведомлений по электронной почте в параметрах правила генерации оповещений.

* Параметр для отправки уведомлений по электронной почте пользователям, владеющим определенными ролями для подписки, активируется, и вы сохраняете соответствующую роль для этой конкретной подписки Azure.

![Снимок экрана уведомления об оповещениях](./media/alerts/alert-notification.png)

Для лучшего контроля над безопасностью и конфиденциальностью обычно рекомендуется явно указывать получателей уведомлений для классических оповещений в поле **получатели уведомлений по электронной почте** . Параметр уведомления всех пользователей, владеющих определенными ролями, предоставляется для обеспечения обратной совместимости.

Чтобы отменить подписывание уведомлений по электронной почте, созданных определенным правилом генерации оповещений, удалите адрес электронной почты из поля " **получатели уведомлений по электронной** почте".

Если адрес электронной почты не указан явно, рекомендуется отключить параметр, чтобы автоматически уведомлять всех членов определенных ролей, а также вывести список всех сообщений электронной почты пользователя, которым необходимо получать уведомления для этого правила в поле Получатели уведомлений по электронной почте.

## <a name="who-receives-the-classic-alert-notifications"></a>Кто получает (классические) оповещения?

Этот раздел относится только к классическим оповещениям, он поможет вам оптимизировать уведомления так, чтобы они приходили только желаемым получателям. Дополнительные сведения о разнице между [классическими предупреждениями](../platform/alerts-classic.overview.md) и новым интерфейсом оповещений см. в [статье Обзор оповещений](../platform/alerts-overview.md). Чтобы управлять уведомлениями о предупреждениях в новом интерфейсе оповещений, используйте [группы действий](../platform/action-groups.md).

* Мы рекомендуем использовать определенных получателей для классических оповещений.

* Если флажок **bulk/group** (массовый/групповой) включен, оповещения на основе соответствующих метрик Application Insights будут отправляться пользователям с ролями владельца, участника или читателя в подписке. Фактически, _все_ пользователи, имеющие доступ к подписке Application Insights, находятся в области действия и будут получать уведомления.

> [!NOTE]
> При отключении используемого флажка **bulk/group** (массовый/груповой) вы не сможете отменить изменение.

Используйте новые возможности оповещений и оповещения почти в реальном времени, если вам нужно уведомлять пользователей в зависимости от их ролей. С помощью [групп действий](../platform/action-groups.md) вы можете настроить уведомления по электронной почте для пользователей с любой из ролей — участника, владельца или читателя (не объединяемых вместе как один параметр).

## <a name="automation"></a>Служба автоматизации
* [Использование PowerShell для автоматизации настройки оповещений](../../azure-monitor/app/powershell-alerts.md)
* [Использование объектов webhook для автоматизации реагирования на оповещения](../../azure-monitor/platform/alerts-webhooks.md)

## <a name="see-also"></a>См. также
* [Доступность веб-тестов](../../azure-monitor/app/monitor-web-app-availability.md)
* [Автоматическая настройка оповещений](../../azure-monitor/app/powershell-alerts.md)
* [Упреждающая диагностика](../../azure-monitor/app/proactive-diagnostics.md) 

<!--Link references-->

[availability]: ../../azure-monitor/app/monitor-web-app-availability.md
[client]: ../../azure-monitor/app/javascript.md
[platforms]: ../../azure-monitor/app/platforms.md
[roles]: ../../azure-monitor/app/resources-roles-access-control.md
[start]: ../../azure-monitor/app/app-insights-overview.md

