---
title: Задание оповещений в Azure Application Insights | Документация Майкрософт
description: Получайте уведомления о малом времени отклика, исключениях или других изменениях производительности или использования в веб-приложении.
ms.service: azure-monitor
ms.subservice: application-insights
ms.topic: conceptual
author: mrbullwinkle
ms.author: mbullwin
ms.date: 01/23/2019
ms.reviewer: lagayhar
ms.openlocfilehash: a21e2676d1b03472c58e2f95095a1a59d00b16be
ms.sourcegitcommit: 1bd2207c69a0c45076848a094292735faa012d22
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/21/2019
ms.locfileid: "72678411"
---
# <a name="set-alerts-in-application-insights"></a>Настройка оповещений в Application Insights
[Application Insights Azure][start] может оповещать вас об изменениях в метриках производительности или использования в веб-приложении. 

Application Insights отслеживает ваше активное приложение на [самых разных платформах][platforms] , чтобы помочь в диагностике проблем с производительностью и понять характер использования.

Существует несколько типов оповещений.

* [**Оповещения метрики**](../../azure-monitor/platform/alerts-metric-overview.md) сообщают, когда метрика пересекает пороговое значение в течение некоторого периода, например время отклика, количество исключений, загрузка ЦП или Просмотры страниц.
* [**Оповещения журнала**](../../azure-monitor/platform/alerts-unified-log.md) используются для описания предупреждений, в которых сигнал оповещения основан на пользовательском запросе Kusto.
* [**Веб-тесты**][availability] сообщают, когда ваш сайт недоступен в Интернете или медленно отвечает. [Узнайте больше][availability].
* [**Упреждающая диагностика**](../../azure-monitor/app/proactive-diagnostics.md) автоматически настроена для отправки уведомлений о необычных показателях производительности.

## <a name="set-a-metric-alert"></a>Задание оповещения о метриках
Откройте вкладку Правила генерации оповещений и нажмите кнопку Добавить.

![На вкладке Правила генерации оповещений выберите Добавить оповещение. Установите приложение в качестве ресурса для измерения, введите имя оповещения и выберите метрику.](./media/alerts/01-set-metric.png)

* Выбирайте ресурс прежде других свойств. **Выберите ресурс («компоненты»)** , если нужно задать предупреждения для метрик производительности или использования.
* Имя, присваиваемое предупреждению, должно быть уникальным в пределах группы ресурсов (не только приложения).
* Аккуратно указывайте единицы измерения для пороговых значений.
* Если установить флажок Email owners (Отправлять по электронной почте владельцам), оповещения будут отправляться по электронной почте всем, кто имеет доступ к этой группе ресурсов. Чтобы предоставить такой доступ другим пользователям, добавьте их в [группу ресурсов или подписку](../../azure-monitor/app/resources-roles-access-control.md) (но не ресурс).
* Если в поле Additional emails (Дополнительные электронные адреса) указать электронные адреса, оповещения будут отправляться на эти адреса отдельных пользователей или групп (независимо от того, установлен ли флажок Email owners [Отправлять по электронной почте владельцам]). 
* Задайте [адрес объекта webhook](../../azure-monitor/platform/alerts-webhooks.md), если вы настроили веб-приложение, которое будет реагировать на оповещения. Оно будет вызываться, когда оповещение будет активировано и разрешено. (Обратите внимание, что в настоящее время параметры запроса не передаются как свойства объекта webhook.)
* Вы можете отключить или включить оповещение: см. кнопки вверху.

*Отсутствует кнопка «Добавить оповещение».*

* Вы используете учетную запись организации? Вы можете настроить оповещения, если у вас есть доступ к этому ресурсу приложения на правах владельца или участника. Взгляните на вкладку Управление доступом. [Дополнительные сведения об управлении доступом][roles].

> [!NOTE]
> В колонке "Оповещения" вы увидите, что оповещение уже настроено: [Упреждающая диагностика](../../azure-monitor/app/proactive-failure-diagnostics.md). Это автоматическое оповещение, которое отслеживает одну определенную метрику — процент сбоев запросов. Если вы не хотите отключать упреждающее оповещение, не нужно задавать собственное оповещение о проценте сбоев запросов.
> 
> 

## <a name="see-your-alerts"></a>Отображение оповещений
Вы получите сообщение электронной почты при изменении состояния предупреждения с неактивного на активное. 

Текущее состояние каждого предупреждения отображается на вкладке Правила генерации оповещений.

Ниже показана сводка недавних действий в раскрывающемся списке оповещений.

![Раскрывающийся список оповещений](./media/alerts/010-alert-drop.png)

Журнал изменений состояния находится в журнале действий.

![На вкладке Обзор щелкните Параметры, журналы аудита.](./media/alerts/09-alerts.png)

## <a name="how-alerts-work"></a>Принципы работы оповещений
* У оповещения бывает три состояния: Never activated (Еще не активировалось), "Активировано" и "Разрешено". Активация означает, что при последней оценке указанное условие имело значение true.
* Когда оповещение изменяет состояние, создается уведомление. (Если при создании оповещения его условие уже имело значение true, возможно, вы не получите уведомление, пока условие не примет значение false.)
* Каждое уведомление создает электронное сообщение, если вы установили флажок отправки электронных сообщений или указали электронные адреса. Можно также просмотреть раскрывающийся список уведомлений.
* Каждый раз при получении метрики выполняется оценка оповещения (но не в других случаях).
* При такой оценке выполняется вычисление метрики за предыдущий период и ее сравнение с пороговым значением для определения нового состояния оповещения.
* Выбранный вами период определяет интервал, для которого выполняется вычисление метрики. Он не влияет на периодичность оценки оповещения. Она зависит от частоты получения метрик.
* Если в течение некоторого времени для определенной метрики не поступает никаких данных, то такая ситуация оказывает различное влияние на оценку оповещения и на диаграммы в обозревателе метрик. Если данные не поступают в обозреватель метрик в течение периода, превышающего интервал выборки диаграммы, то на диаграмме будет отображено значение 0. При этом не будет выполняться повторная оценка оповещения, основанного на прежней метрике, и его состояние останется неизменным. 
  
    Когда, наконец, данные поступят, значение диаграммы снова станет ненулевым. Будет выполнена оценка оповещения на основе данных, доступных за указанный вами период. Если новая точка данных — это единственная доступная в периоде, то для вычисления будет использована только она.
* Даже если задать длительный период, оповещение может часто менять свое состояние с "предупреждение" на "работоспособен" и наоборот. Это может происходить, если значение метрики находится вблизи порогового значения. Для порогового значения не предусмотрен гистерезис: переход из состояния "предупреждение" в состояние "работоспособен" и наоборот происходит при одном и том же значении.

## <a name="what-are-good-alerts-to-set"></a>Какие оповещения следует настраивать
Это зависит от приложения. Прежде всего, лучше не задавать слишком много метрик. Просмотрите диаграммы метрик во время выполнения приложения, чтобы понять, как работает приложение в нормальном режиме. Это поможет найти способы повышения его производительности. Затем настройте оповещения, которые будут предупреждать вас, если метрики превысят пределы обычного режима работы. 

Чаще всего используются следующие оповещения.

* [Метрики браузера][client], особенно **время загрузки страниц**браузера, хорошо подходят для веб-приложений. Если на странице имеется много сценариев, следует искать **исключения браузера**. Чтобы получить эти метрики и оповещения, необходимо настроить [мониторинг веб-страниц][client].
* **Время ответа сервера** для серверной части веб-приложений. Кроме настройки оповещений следите за этой метрикой, чтобы определить, насколько пропорционально она меняется по мере увеличения частоты запросов, так как изменение может указывать на то, что в приложении заканчиваются ресурсы. 
* **Исключения сервера.** Чтобы отобразить их, необходимо выполнить [дополнительную настройку](../../azure-monitor/app/asp-net-exceptions.md).

Не забывайте, что [упреждающая диагностика частоты сбоев](../../azure-monitor/app/proactive-failure-diagnostics.md) автоматически отслеживает скорость, с которой приложение отвечает на запросы с кодом ошибки.

## <a name="how-to-set-an-exception-alert-using-custom-log-search"></a>Настройка предупреждения об исключении с помощью пользовательского поиска по журналам

В этом разделе мы рассмотрим, как задать предупреждение об исключении на основе запроса. Для этого примера предположим, что нам требуется оповещение, если частота сбоев превышает 10% за последние 24 часа.

1. Перейдите к ресурсу Application Insight в портал Azure.
2. Слева в разделе Настройка щелкните **оповещение**.

    ![Слева в разделе Настройка щелкните оповещение.](./media/alerts/1appinsightalert.png)

3. В верхней части вкладки оповещение выберите **новое правило генерации оповещений**.

     ![В верхней части вкладки оповещение щелкните новое правило генерации оповещений.](./media/alerts/2createalert.png)

4. Ресурс должен быть выбран для автоматического выбора. Чтобы задать условие, нажмите кнопку **Добавить условие**.

    ![Нажмите кнопку Добавить условие.](./media/alerts/3addcondition.png)

5. На вкладке Настройка логики сигнала выберите **Пользовательский поиск по журналам** .

    ![Щелкните Пользовательский поиск по журналам](./media/alerts/4customlogsearch.png)

6. На вкладке пользовательский поиск по журналу введите запрос в поле поисковый запрос. В этом примере мы будем использовать приведенный ниже запрос Kusto.
    ```kusto
    let percentthreshold = 10;
    let period = 24h;
    requests
    | where timestamp >ago(period)
    | summarize requestsCount = sum(itemCount)
    | project requestsCount, exceptionsCount = toscalar(exceptions | where timestamp >ago(period) | summarize sum(itemCount))
    | extend exceptionsRate = toreal(exceptionsCount)/toreal(requestsCount) * 100
    | where exceptionsRate > percentthreshold

    ```

    ![Запрос типа в поле поискового запроса](./media/alerts/5searchquery.png)
    
    > [!NOTE]
    > Эти действия также можно применить к другим типам оповещений на основе запросов. Дополнительные сведения о языке запросов Kusto можно узнать из этого [документа Kusto Start doc](https://docs.microsoft.com/azure/kusto/concepts/) или с этого [SQL в Kusto Памятка по](https://docs.microsoft.com/azure/kusto/query/sqlcheatsheet) .

7. В разделе "логика оповещения" выберите, будет ли он основываться на количестве результатов или измерении метрик. Затем выберите условие (больше, равно, меньше) и пороговое значение. При изменении этих значений можно заметить, что предложение предварительного просмотра условия изменяется. В этом примере используется «Equal to».

    ![В разделе логика оповещений выберите из параметров, предоставленных для, на основе условия и введите пороговое значение.](./media/alerts/6alertlogic.png)

8. В разделе "Оценено на основе" задайте период и частоту. Период здесь должен соответствовать значению, которое мы поместили для периода в приведенном выше запросе. Затем нажмите кнопку **Готово**.

    ![Задайте период и частоту внизу и нажмите кнопку Готово.](./media/alerts/7evaluate.png)

9. Теперь мы увидим созданное нами условие с расчетной месячной стоимостью. Ниже в разделе ["группы действий"](../platform/action-groups.md) можно создать новую группу или выбрать существующую. При необходимости можно настроить действия.

    ![Нажмите кнопку Выбрать или создать в группе действий.](./media/alerts/8actiongroup.png)

10. Наконец, добавьте сведения о предупреждении (имя правила оповещения, описание, серьезность). По завершении нажмите кнопку **создать правило генерации оповещений** внизу.

    ![В разделе сведения о предупреждении введите имя правила оповещения, запишите описание и выберите серьезность.](./media/alerts/9alertdetails.png)

## <a name="how-to-unsubscribe-from-classic-alert-e-mail-notifications"></a>Отмена подписки на уведомления по электронной почте с классическими оповещениями

Этот раздел относится к **классическим**оповещениям о доступности, **классическим Application Insights оповещениям метрик**и к **классическим предупреждениям о сбоях**.

Вы получаете уведомления по электронной почте для этих классических оповещений, если выполняется одно из следующих условий.

* Ваш адрес электронной почты указан в поле Получатели уведомлений по электронной почте в параметрах правила генерации оповещений.

* Параметр для отправки уведомлений по электронной почте пользователям, владеющим определенными ролями для подписки, активируется, и вы сохраняете соответствующую роль для этой конкретной подписки Azure.

![Снимок экрана уведомления об оповещениях](./media/alerts/alert-notification.png)

Для лучшего контроля над безопасностью и конфиденциальностью обычно рекомендуется явно указывать получателей уведомлений для классических оповещений в поле **получатели уведомлений по электронной почте** . Параметр уведомления всех пользователей, владеющих определенными ролями, предоставляется для обеспечения обратной совместимости.

Чтобы отменить подписывание уведомлений по электронной почте, созданных определенным правилом генерации оповещений, удалите адрес электронной почты из поля " **получатели уведомлений по электронной** почте".

Если ваш адрес электронной почты не указан явно, рекомендуется отключить параметр, чтобы автоматически уведомлять всех членов определенных ролей, а также вывести список всех сообщений электронной почты пользователя, которым необходимо получать уведомления для этого правила оповещения в электронном письме с уведомлением. поле Получатели.

## <a name="who-receives-the-classic-alert-notifications"></a>Кто получает (классические) оповещения?

Этот раздел относится только к классическим оповещениям, он поможет вам оптимизировать уведомления так, чтобы они приходили только желаемым получателям. Дополнительные сведения о разнице между [классическими предупреждениями](../platform/alerts-classic.overview.md) и новым интерфейсом оповещений см. в [статье Обзор оповещений](../platform/alerts-overview.md). Чтобы управлять уведомлениями о предупреждениях в новом интерфейсе оповещений, используйте [группы действий](../platform/action-groups.md).

* Мы рекомендуем использовать определенных получателей для классических оповещений.

* Если флажок **bulk/group** (массовый/групповой) включен, оповещения на основе соответствующих метрик Application Insights будут отправляться пользователям с ролями владельца, участника или читателя в подписке. Фактически, _все_ пользователи, имеющие доступ к подписке Application Insights, находятся в области действия и будут получать уведомления.

> [!NOTE]
> При отключении используемого флажка **bulk/group** (массовый/груповой) вы не сможете отменить изменение.

Используйте новые возможности оповещений и оповещения почти в реальном времени, если вам нужно уведомлять пользователей в зависимости от их ролей. С помощью [групп действий](../platform/action-groups.md) вы можете настроить уведомления по электронной почте для пользователей с любой из ролей — участника, владельца или читателя (не объединяемых вместе как один параметр).

## <a name="automation"></a>Служба автоматизации
* [Использование PowerShell для автоматизации настройки оповещений](../../azure-monitor/app/powershell-alerts.md)
* [Использование объектов webhook для автоматизации реагирования на оповещения](../../azure-monitor/platform/alerts-webhooks.md)

## <a name="see-also"></a>Дополнительные материалы
* [Доступность веб-тестов](../../azure-monitor/app/monitor-web-app-availability.md)
* [Автоматическая настройка оповещений](../../azure-monitor/app/powershell-alerts.md)
* [Упреждающая диагностика](../../azure-monitor/app/proactive-diagnostics.md) 

<!--Link references-->

[availability]: ../../azure-monitor/app/monitor-web-app-availability.md
[client]: ../../azure-monitor/app/javascript.md
[platforms]: ../../azure-monitor/app/platforms.md
[roles]: ../../azure-monitor/app/resources-roles-access-control.md
[start]: ../../azure-monitor/app/app-insights-overview.md

