---
title: Отладка в Visual Studio с помощью Application Insights Azure
description: Анализ производительности веб-приложения и диагностика во время отладки и в рабочей среде.
ms.topic: conceptual
author: NumberByColors
ms.author: daviste
ms.date: 07/07/2017
ms.reviewer: mbullwin
ms.custom: vs-azure
ms.openlocfilehash: 1bb18cc43ef306a208500ff49ec41dbfb74b788e
ms.sourcegitcommit: a76ff927bd57d2fcc122fa36f7cb21eb22154cfa
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/28/2020
ms.locfileid: "87323474"
---
# <a name="debug-your-applications-with-azure-application-insights-in-visual-studio"></a>Отладка приложений с помощью Azure Application Insights в Visual Studio
В Visual Studio 2015 и более поздних версиях можно анализировать производительность веб-приложения ASP.NET и диагностировать проблемы во время отладки и в рабочей среде с помощью телеметрии из [Azure Application Insights](./app-insights-overview.md).

Если вы создали веб-приложение ASP.NET с помощью Visual Studio 2017 или более поздней версии, оно уже содержит пакет SDK Application Insights. Если вы используете другую версию, [добавьте Application Insights в свое приложение](./asp-net.md), если вы еще это не сделали.

Чтобы отслеживать приложение в рабочей среде, можно просматривать данные телеметрии Application Insights на [портале](https://portal.azure.com) (там же можно настроить оповещения и применить эффективные средства мониторинга). Но для приложения в состоянии отладки можно также искать и анализировать данные телеметрии в Visual Studio. С помощью Visual Studio вы можете анализировать телеметрию рабочего сайта и выполнения отладки на компьютере разработчика. В последнем случае вы можете анализировать выполнения отладки, даже если вы еще не настроили пакет SDK для отправки данных телеметрии на портал Azure. 

## <a name="debug-your-project"></a><a name="run"></a> Отладка проекта
Нажмите клавишу F5, чтобы запустить веб-приложение в режиме локальной отладки. Откройте разные страницы, чтобы создать некоторый объем данных телеметрии.

В Visual Studio вы видите число событий, которые были зарегистрированы модулем Application Insights в вашем проекте.

![В Visual Studio кнопка Application Insights доступна во время отладки.](./media/visual-studio/appinsights-09eventcount.png)

Нажмите эту кнопку для поиска данных телеметрии. 

## <a name="application-insights-search"></a>Поиск Application Insights
В окне поиска Application Insights отображаются события, которые были зарегистрированы. (Если во время настройки Application Insights вы вошли в Azure, эти же события вы можете найти на портале Azure.)

![Щелкните проект правой кнопкой мыши и последовательно выберите пункты "Application Insights" и "Поиск".](./media/visual-studio/34.png)

> [!NOTE] 
> Выберите фильтры или отмените их выбор. Нажмите кнопку поиска в конце текстового поля поиска.
>

Бесплатный полнотекстовый поиск охватывает все поля в журнале событий. Например, можно выполнить поиск по фрагменту URL-адреса страницы, а также по значению свойства (например, город клиента) или ключевым словам в журнале трассировки.

Выберите любое событие, чтобы подробно просмотреть его свойства.

Чтобы выполнить запрос к веб-приложению, щелкните код.

![В разделе сведений о запросе щелкните код](./media/visual-studio/31.png)

Чтобы продиагностировать невыполненные запросы или исключения, вы можете открыть связанные элементы.

![В разделе сведений о запросе прокрутите страницу вниз до связанных элементов](./media/visual-studio/41.png)

## <a name="view-exceptions-and-failed-requests"></a>Просмотр исключений и неудачно завершенных запросов
Отчеты об исключениях отображаются в окне поиска. В некоторых типах приложений ASP.NET предыдущих версий необходимо [настроить отслеживание исключений](./asp-net-exceptions.md), чтобы просматривать исключения, которые обрабатываются платформой.

Щелкните исключение, чтобы просмотреть трассировку стека. Если код приложения открыт в среде Visual Studio, можно щелкнуть трассировку стека в соответствующей строке кода.

![Трассировка стека исключений](./media/visual-studio/17.png)

## <a name="view-request-and-exception-summaries-in-the-code"></a>Просмотр сводки по запросам и исключениям в коде
В строке CodeLens над каждым методом-обработчиком указано число запросов и исключений, зарегистрированных Application Insights за последние 24 часа.

![Трассировка стека исключений](./media/visual-studio/21.png)

> [!NOTE] 
> Группа связанных элементов кода показывает данные Application Insights, только если вы [настроили приложение для отправки данных телеметрии на портал Application Insights](./asp-net.md).
>

[Телеметрия Application Insights в Visual Studio CodeLens](./visual-studio-codelens.md)

## <a name="trends"></a>Тренды
Тренды — это средство для визуализации того, как изменяется поведение приложения со временем. 

Нажмите кнопку **Обзор трендов телеметрии** на панели инструментов Application Insights или в окне поиска Application Insights. Выберите один из пяти стандартных запросов, чтобы приступить к работе. Анализировать разные наборы данных можно на основе типов данных телеметрии, диапазонов времени и других свойств. 

Чтобы найти аномалии в данных, выберите один из вариантов аномалий в раскрывающемся списке "Тип представления". Параметры фильтрации в нижней части окна позволяют легко находить конкретные подмножества данных телеметрии.

![Тренды](./media/visual-studio/51.png)

[Дополнительные сведения о тенденциях](./visual-studio-trends.md)

## <a name="local-monitoring"></a>Локальный мониторинг
(Относится к Visual Studio 2015 с обновлением 2) Если ваш пакет SDK не отправляет данные телеметрии на портал Application Insights (то есть в файле ApplicationInsights.config нет ключа инструментирования), в окне диагностики выводятся данные телеметрии, полученные в ходе последнего сеанса отладки. 

Это предпочтительно, если вы уже опубликовали предыдущую версию своего приложения. Кроме того, не рекомендуется, чтобы данные телеметрии, полученные на ваших сеансах отладки, смешивались с данными телеметрии на портале Application Insights, полученными от опубликованного приложения.

Это также полезно, если у вас есть [данные пользовательской телеметрии](./api-custom-events-metrics.md) , которые необходимо отладить перед отправкой на портал.

* *Сначала мы полностью настроили Application Insights для отправки данных телеметрии на портал. Но теперь нужно, чтобы данные телеметрии отображались только в Visual Studio.*
  
  * В параметрах окна поиска можно включить поиск локальной диагностики, который будет выполняться, даже если ваше приложение отправляет данные телеметрии на портал.
  * Чтобы отключить отправку данных телеметрии на портал, закомментируйте строку `<instrumentationkey>...` с ApplicationInsights.config. Когда вы будете готовы отправить данные телеметрии на портал, раскомментируйте его.


## <a name="next-steps"></a>Дальнейшие действия
|  |  |
| --- | --- |
| **[Добавление данных](./asp-net-more.md)**<br/>Мониторинг использования, доступности, зависимостей и исключений. Интеграция трассировок из платформ ведения журналов. Написание пользовательской телеметрии. |![Visual studio](./media/visual-studio/64.png) |
| **[Работа с порталом Application Insights](./overview-dashboard.md)**<br/>Просмотр панелей мониторинга, эффективных средств диагностики и анализа, оповещений, карты динамических зависимостей приложения, а также экспортированных данных телеметрии. |![Visual studio](./media/visual-studio/62.png) |

