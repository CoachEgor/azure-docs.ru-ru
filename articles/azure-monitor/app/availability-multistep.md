---
title: Мониторинг веб-приложения с помощью многошаговые веб-тесты и Azure Application Insights | Документация Майкрософт
description: Настройки многошаговые веб-тесты для наблюдения за веб-приложений с помощью Azure Application Insights
services: application-insights
author: mrbullwinkle
manager: carmonm
ms.assetid: 46dc13b4-eb2e-4142-a21c-94a156f760ee
ms.service: application-insights
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.topic: conceptual
ms.date: 06/19/2019
ms.reviewer: sdash
ms.author: mbullwin
ms.openlocfilehash: d8bfe92af4e8afc4edae76efb2e1cb7b287c7aa9
ms.sourcegitcommit: 82efacfaffbb051ab6dc73d9fe78c74f96f549c2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/20/2019
ms.locfileid: "67305200"
---
# <a name="multi-step-web-tests"></a>Многошаговые веб-тесты

Вы можете отслеживать, записанную последовательность URL-адреса и взаимодействия с веб-сайта с помощью многошаговых веб-тестов. В этой статье пошагово продемонстрирует процесс создания Многошаговый веб-тест с помощью Visual Studio Enterprise.

> [!NOTE]
> Многошаговые веб-тесты имеют дополнительные затраты, связанные с ними. Дополнительные сведения см. Дополнительные [официальное руководство ценообразования](https://azure.microsoft.com/pricing/details/application-insights/).

## <a name="pre-requisites"></a>Предварительные требования

* Visual Studio 2017 Enterprise или более поздней версии.
* Visual Studio web performance и средств тестирования нагрузки.

Чтобы найти тестирования предварительные инструменты. Запустите **установщик Visual Studio** > **отдельные компоненты** > **отладка и тестирование**  >   **Веб-производительности и средства тестирования нагрузки**.

![Снимок экрана: пользовательский Интерфейс установщика Visual Studio с помощью отдельных компонентов, выбранных с флажком рядом с элементом для средств тестирования нагрузки и веб-тестами производительности](./media/availability-multistep/web-performance-load-testing.png)

## <a name="record-a-multi-step-web-test"></a>Запись Многошаговый веб-тест

Для создания многошагового теста вам сначала нужно записать сценарий с помощью Visual Studio Enterprise, а затем отправить запись в Application Insights. Application Insights воспроизводит сценарий через заданные интервалы времени и проверяет ответ.

> [!IMPORTANT]
> * В тестах нельзя использовать запрограммированные функции или циклы. Тест должен полностью находиться в WEBTEST-файле скрипта. Однако вы можете использовать стандартные подключаемые модули.
> * В многошаговых веб-тестах поддерживаются только символы английского алфавита. Если вы используете Visual Studio на других языках, обновите файл определения веб-теста, чтобы перевести или исключить символы языков, отличных от английского.

Для записи веб-сеанса используйте Visual Studio Enterprise.

1. Создание веб-тестами производительности и нагрузочных тестов. **Файл** > **новый** > **проекта** > **Visual C#**   >  **теста**

    ![Visual Studio новый проект пользовательского интерфейса](./media/availability-multistep/vs-web-performance-and-load-test.png)

2. Откройте `.webtest` файл и начните запись.

    ![Visual Studio test, запись пользовательского интерфейса](./media/availability-multistep/open-web-test.png)

3. Выберите шаги, тест для моделирования как часть записи.

    ![Запись пользовательского интерфейса обозревателя](./media/availability-multistep/record.png)

4. Отредактируйте тест, чтобы:

    * Добавить проверки полученного текста и кодов ответов.
    * Удалите все uneccesary взаимодействия. Можно также удалить зависимые запросы для изображений или добавить сайты отслеживания, которые не относятся к выделение теста успешно.
    
    Имейте в виду, что изменить можно только тестовый сценарий — можно добавить пользовательский код или вызывать другие веб-тесты. Не вставляйте в тест циклы. Вы можете использовать стандартные подключаемые модули для веб-тестов.

5. Запустите тест в Visual Studio, чтобы проверить и убедиться, что оно работает.

    Средство выполнения веб-тестов откроет веб-браузер и повторит записанные действия. Убедитесь, что все правильно работает.

## <a name="upload-the-web-test"></a>Отправка веб-теста

1. На портале Application Insights в области доступности выберите **создания теста** > **тип теста** > **Многошаговый веб-тест**.

2. Набор тестовых местоположений, частоты и параметров оповещения.

### <a name="frequency--location"></a>Частота & расположение

|Параметр| Объяснение
|----|----|----|
|**Частота проверки**| Задает частоту выполнения теста для всех тестовых расположений. При стандартной частоте в пять минут и с пятью тестовыми расположениями ваш сайт будет проверяться в среднем каждую минуту.|
|**Расположения тестирования**| Это окна, из которых наши серверы отправляют веб-запросов в URL-адрес. **Наши минимальное количество рекомендуемых тестовыми расположениями равно пяти** чтобы убедиться, что вы можно было различать проблемы веб-сайта сетевые проблемы. Вы можете выбрать до 16 таких расположений.

### <a name="success-criteria"></a>Критерии успеха

|Параметр| Объяснение
|----|----|----|
| **Время ожидания тестов** |Уменьшите значение этого параметра, чтобы получать оповещения о медленных откликах. Тест считается неудачной попыткой, если ответы от сайта не были получены в течение заданного периода. Если выбрать параметр **Анализировать зависимые запросы**, все изображения, файлы стилей, скрипты и другие зависимые ресурсы будут получены в течение этого периода.|
| **HTTP-ответа** | Возвращаемый код состояния, который считается успешным результатом. Код 200 указывает на возврат нормальной веб-страницы.|
| **Совпадения содержимого** | Строка, например «Добро пожаловать!» Проверим наличие точного совпадения (с учетом регистра) в каждом ответе. Это должна быть строка обычного текста без подстановочных знаков. Не забывайте, что если контент страницы изменяется, необходимо обновить эту строку. **Поддерживаются только символы латинского алфавита совпадения содержимого** |

### <a name="alerts"></a>Оповещения

|Параметр| Объяснение
|----|----|----|
|**Почти в реальном времени (Предварительная версия)** | Мы рекомендуем использовать оповещения почти в реальном времени. Настройка оповещений этого типа выполняется после создания теста доступности.  |
|**Классический** | Не рекомендуется использовать с помощью классических оповещений для новые тесты доступности.|
|**Пороговое значение для расположения оповещения**|Мы рекомендуем как минимум 3 из 5 расположений. Оптимальной отношения между пороговым значением предупреждения расположение и число тестовых местоположений **пороговое значение для предупреждения расположения** = **число тестовых местоположений - 2, с минимальным объемом пятью тестовыми расположениями.**|

## <a name="advanced-configuration"></a>Расширенная конфигурация

### <a name="plugging-time-and-random-numbers-into-your-test"></a>Вставка времени и случайных чисел в тест

Предположим, что вы тестируете инструмент, который получает зависящие от времени данные (например, запасы) от внешнего источника. При записи веб-теста необходимо использовать определенные значения времени, но они должны быть заданы как параметры теста StartTime и EndTime.

![Снимок экрана My потрясающего приложения акций](./media/availability-multistep/app-insights-72webtest-parameters.png)

При запуске теста параметру EndTime следует всегда присваивать текущее время, а параметру StartTime – время за 15 минут до текущего.

Дата время Web Test Plugin предоставляет способ обработки параметризовать время.

1. Добавьте подключаемые модули веб-теста для всех необходимых значений переменных параметров. На панели инструментов веб-теста выберите **Добавить подключаемый модуль веб-теста**.
    
    ![Добавить подключаемый модуль веб-тестов](./media/availability-multistep/app-insights-72webtest-plugin-name.png)
    
    В этом примере используется два экземпляра подключаемого модуля даты и времени. Для первого экземпляра будет задано время за 15 минут до текущего, а для второго — текущее время.

2. Откройте свойства каждого подключаемого модуля. Присвойте ему имя и настройте его для использования текущего времени. Для одного из экземпляров задайте для параметра "Добавление минут" значение "-15".

    ![Параметры контекста](./media/availability-multistep/app-insights-72webtest-plugin-parameters.png)

3. В параметрах веб-теста используйте {{имя подключаемого модуля}} для ссылки на имя подключаемого модуля.

    ![StartTime](./media/availability-multistep/app-insights-72webtest-plugins.png)

Теперь можно передать тест на портал. Он будет использовать динамические значения при каждом тестировании.

### <a name="dealing-with-sign-in"></a>Работа с входом

Если пользователи входят в приложение, вы можете протестировать страницы входа, используя несколько способов имитации входа. Выбор подхода зависит от типа безопасности в приложении.

Во всех случаях учетную запись в приложении следует создавать только для целей тестирования. По возможности ограничьте разрешения для этой тестовой учетной записи, чтобы веб-тесты не доставляли неудобств реальным пользователям.

**Простое имя пользователя и пароль** записи в веб-тест обычным образом. Сначала удалите файлы cookie.

**Проверка подлинности SAML** использовать подключаемый модуль SAML, который доступен для веб-тестов. Доступ к подключаемый модуль по...

**Секрет клиента** Если приложение имеет маршрут входа, который включает в себя секрет клиента, используйте этот маршрут. Azure Active Directory (AAD) — это пример службы, в которой доступен вход в систему с использованием секрета клиента. В AAD секрет клиента — это ключ приложения.

Ниже приведен пример веб-теста веб-приложения Azure с использованием ключа приложения.

![Снимок экрана](./media/availability-multistep/client-secret.png)

Получите токен из Azure AD с помощью секрета клиента (AppKey).
Извлеките токен носителя из ответа.
Вызовите интерфейс API, используя токен носителя в заголовке авторизации.
Убедитесь, что веб-тест является фактическим клиентом, — то есть существует собственное приложение в AAD и использовать его значения clientId и приложения ключ. У тестируемой службы также есть собственное приложение в AAD: универсальный код ресурса URI appID этого приложения содержится в веб-тесте в поле resource.

### <a name="open-authentication"></a>Открытая проверка подлинности
Пример открытой проверки подлинности — это вход с помощью учетной записи Майкрософт или Google. Многие приложения, использующие OAuth, предоставляют альтернативный вариант с использованием секрета клиента, поэтому сначала стоит попробовать эту возможность.

Если в вашем тесте должен выполняться вход с использованием OAuth, общий порядок действий таков:

Проверьте трафик между веб-браузером, сайтом проверки подлинности и приложением при помощи Fiddler или аналогичного средства.
Выполните вход несколько раз с разных компьютеров или из разных браузеров либо через большие промежутки времени (чтобы истек срок действия маркеров).
Сравнивая различные сеансы, определите маркер, возвращаемый с сайта проверки подлинности, который затем передается на сервер приложения после входа.
Запишите веб-тест с помощью Visual Studio.
Параметризуйте маркеры, задав параметр при возврате маркера из структуры проверки подлинности и использовав его в запросе к сайту. (Visual Studio попытается параметризовать тест, но не сможет правильно параметризовать маркеры).

## <a name="troubleshooting"></a>Устранение неполадок

Выделенные [статьи об устранении неполадок](troubleshoot-availability.md).

## <a name="next-steps"></a>Дальнейшие действия

* [Оповещения доступности](availability-alerts.md)
* [URL-адрес проверки связи веб-тестов](monitor-web-app-availability.md)
