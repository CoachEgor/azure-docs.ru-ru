---
title: Устранение неполадок тестов доступности Application Insights Azure
description: Устранение неполадок веб-тестов в Azure Application Insights. Получение оповещений, когда веб-сайт становится недоступным или медленно реагирует на запросы.
ms.topic: conceptual
author: lgayhardt
ms.author: lagayhar
ms.date: 04/28/2020
ms.reviewer: sdash
ms.openlocfilehash: 8544ad292d9e8982e236566fb53189c70922232c
ms.sourcegitcommit: 3d79f737ff34708b48dd2ae45100e2516af9ed78
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/23/2020
ms.locfileid: "87041378"
---
# <a name="troubleshooting"></a>Диагностика

Эта статья поможет вам устранить распространенные проблемы, которые могут возникнуть при использовании мониторинга доступности.

## <a name="ssltls-errors"></a>Ошибки SSL/TLS

|Симптом/сообщение об ошибке| Возможные причины|
|--------|------|
|Не удалось создать защищенный канал SSL/TLS  | Версия SSL. Поддерживаются только TLS 1,0, 1,1 и 1,2. **SSLv3 не поддерживается.**
|Слой записи TLSv 1.2: предупреждение (уровень: неустранимый, описание: Неправильная запись MAC)| [Дополнительные сведения](https://security.stackexchange.com/questions/39844/getting-ssl-alert-write-fatal-bad-record-mac-during-openssl-handshake)см. в разделе StackExchange Thread.
|Неудачный URL-адрес — CDN (сеть доставки содержимого) | Это может быть вызвано неисправной конфигурацией CDN |  

### <a name="possible-workaround"></a>Возможное решение

* Если URL-адреса, на которых возникла проблема, всегда являются зависимыми ресурсами, рекомендуется отключить **анализ зависимых запросов** для веб-теста.

## <a name="test-fails-only-from-certain-locations"></a>Тест завершается сбоем только из определенных расположений

|Симптом/сообщение об ошибке| Возможные причины|
|----|---------|
|Попытка подключения не удалась, так как подключенная сторона не ответила должным образом через определенный промежуток времени  | Агенты тестирования в определенных расположениях блокируются брандмауэром.|
|    |Перенаправление определенных IP-адресов происходит через (подсистемы балансировки нагрузки, диспетчеры географических трафика, Azure Express Route). 
|    |При использовании Azure ExpressRoute существуют сценарии, в которых пакеты могут быть удалены в случаях, когда [происходит асимметричная маршрутизация](../../expressroute/expressroute-asymmetric-routing.md).|

## <a name="test-failure-with-a-protocol-violation-error"></a>Сбой теста с ошибкой нарушения протокола

|Симптом/сообщение об ошибке| Возможные причины| Возможные способы устранения |
|----|---------|-----|
|Сервер зафиксировал нарушение протокола. Section = Респонсехеадер Detail = CR должен следовать за LF | Это происходит при обнаружении неправильно сформированных заголовков. В частности, некоторые заголовки могут не использовать CRLF для указания конца строки, что нарушает спецификацию HTTP. Application Insights применяет эту спецификацию HTTP и отказывается от неверно сформированных заголовков.| А. Чтобы исправить неисправные серверы, обратитесь к поставщику или поставщику узла веб-сайта. <br> Б. Если неудачные запросы являются ресурсами (например, файлы стилей, изображения, скрипты), можно отключить анализ зависимых запросов. Помните, что, если вы сделаете это, вы потеряли возможность отслеживать доступность этих файлов.

> [!NOTE]
> При переходе по URL-адресу в браузерах, для которых установлена упрощенная проверка заголовков HTTP, может не произойти сбой. См. подробное описание проблемы в этой записи блога: http://mehdi.me/a-tale-of-debugging-the-linkedin-api-net-and-http-protocol-violations/  

## <a name="common-troubleshooting-questions"></a>Общие вопросы по устранению неполадок

### <a name="site-looks-okay-but-i-see-test-failures-why-is-application-insights-alerting-me"></a>Сайт выглядит правильно, но возникают сбои тестирования. Почему Application Insights оповещает меня?

   * Включены ли в тест **зависимые запросы на анализ** ? Это приводит к тщательной проверке ресурсов, таких как сценарии, изображения и т. д. Эти типы сбоев могут быть не заметны в браузере. Проверьте все изображения, скрипты, таблицы стилей и любые другие файлы, загружаемые на страницу. Если какой-либо из них завершается неудачей, тест сообщается как сбой, даже если Главная HTML-страница загружается без проблем. Чтобы десенситизе тест на такие сбои ресурсов, просто снимите флажки для запросов, зависимых от анализа, из конфигурации теста.

   * Чтобы уменьшить вероятность шума от временной сети нестабильной работе и т. д., убедитесь, что установлен флажок Включить повторные попытки для конфигурации ошибок тестирования. Вы также можете выполнять тестирование из любого расположения и соответствующим образом управлять пороговым значением правила генерации оповещений для предотвращения проблем с конкретными расположениями, вызывающих ненужные оповещения.

   * Щелкните любую из красных точек в интерфейсе доступности или любой сбой доступности в проводнике поиска для просмотра сведений о том, почему мы сообщили о сбое. Результат теста, а также коррелированные данные телеметрии на стороне сервера (если они включены) должны помочь понять, почему тест завершился ошибкой. Распространенные причины временных неполадок — проблемы сети или подключения.

   * Истекло ли время ожидания теста? Мы прерываем тесты через две минуты. Если ваша проверка связи или многошаговый тест занимает более двух минут, мы воспринимаем это как сбой. Разбейте тест на несколько сеансов, которые можно выполнить последовательно.

   * Все ли расположения сообщили о сбоях? Если только некоторые их них прислали отчет о сбое, возможно, причина в проблемах с сетью или CDN. Щелкая красные точки, вы можете понять, почему расположение сообщило о сбое.

### <a name="i-did-not-get-an-email-when-the-alert-triggered-or-resolved-or-both"></a>Мне не пришло сообщение электронной почты при активации или разрешении оповещения.

Проверьте конфигурацию классических оповещений, чтобы убедиться, что ваш адрес электронной почты явно указан, или список рассылки, в который вы входите, настроен для получения уведомлений. Если это так, проверьте конфигурацию списка рассылки, чтобы убедиться, что он может получать внешние сообщения электронной почты. Проверьте также, не настроил ли администратор электронной почты политики, которые могут вызвать эту проблему.

### <a name="i-did-not-receive-the-webhook-notification"></a>Я не получаю уведомления веб-перехватчика.

Убедитесь, что приложение, получающее уведомления от веб-перехватчика, доступно и успешно обрабатывает запросы веб-перехватчика. Дополнительную информацию см. [здесь](../platform/alerts-log-webhook.md).

### <a name="i-am-getting--403-forbidden-errors-what-does-this-mean"></a>Я получаю 403 недопустимых ошибок, что это значит?

Эта ошибка означает, что необходимо добавить исключения брандмауэра, чтобы разрешить агентам доступности тестировать целевой URL-адрес. Полный список разрешенных IP-адресов агента см. в статье об [исключении IP](./ip-addresses.md#availability-tests).

### <a name="intermittent-test-failure-with-a-protocol-violation-error"></a>Периодические сбои тестирования и ошибка с уведомлением о нарушении протокола.

Ошибка ("нарушение протокола...За возвратом каретки должен следовать перевод строки") свидетельствует о возможной неполадке с сервером (или зависимостями). Такое происходит, когда в ответе задаются неправильно сформированные заголовки. Это может быть вызвано подсистемами балансировки нагрузки или сетями доставки содержимого (CDN). В частности, некоторые заголовки могут не использовать символ CRLF для обозначения конца строки, что нарушает спецификацию HTTP и, следовательно, не проходит проверку на уровне WebRequest .NET. Проверьте ответ на плашечные заголовки, которые могут быть нарушены.

> [!NOTE]
> При переходе по URL-адресу в браузерах, для которых установлена упрощенная проверка заголовков HTTP, может не произойти сбой. См. подробное описание проблемы в этой записи блога: http://mehdi.me/a-tale-of-debugging-the-linkedin-api-net-and-http-protocol-violations/  

### <a name="i-dont-see-any-related-server-side-telemetry-to-diagnose-test-failures"></a>Я не вижу связанных данных телеметрии на стороне сервера для диагностики сбоев тестирования? *

Если служба Application Insights настроена для серверного приложения, возможно, это произошло из-за [выборки](../../azure-monitor/app/sampling.md) в операции. Выберите другой результат доступности.

### <a name="can-i-call-code-from-my-web-test"></a>Можно ли вызывать код из моего веб-теста?

Нет. Действия теста должны находиться в WEBTEST-файле. Кроме того, нельзя вызывать другие веб-тесты и использовать циклы. Но есть несколько подключаемых модулей, которые могут оказаться полезными.


### <a name="is-there-a-difference-between-web-tests-and-availability-tests"></a>Есть ли разница между понятиями "веб-тесты" и "тесты доступности"?

Эти два термина могут быть взаимозаменяемыми. Тест доступности является более универсальным термином, так как кроме многошаговых веб-тестов вам доступны проверка связи с отдельным URL-адресом.

### <a name="id-like-to-use-availability-tests-on-our-internal-server-that-runs-behind-a-firewall"></a>Мне нужно использовать тесты доступности на нашем внутреннем сервере, который работает за брандмауэром.

   Существует два возможных решения:

   * Разрешите в брандмауэре входящие запросы с [IP-адресов агентов веб-тестирования](../../azure-monitor/app/ip-addresses.md).
   * Напишите собственный код для периодической проверки внутреннего сервера. Запустите код в виде фонового процесса на тестовом сервере за брандмауэром. Процесс тестирования может отправлять результаты в Application Insights с помощью API [TrackAvailability()](/dotnet/api/microsoft.applicationinsights.telemetryclient.trackavailability) в основном пакете SDK. Для этого тестовый сервер должен иметь исходящий доступ к конечной точке приема в Application Insights, что представляет гораздо меньшую угрозу безопасности, чем разрешение входящих запросов. Результаты будут отображаться в колонках веб-тестов доступности, хотя процесс будет немного упрощен из доступных для тестов, созданных с помощью портала. Пользовательские тесты доступности также будут отображаться как результаты доступности в аналитике, поиске и метриках.

### <a name="uploading-a-multi-step-web-test-fails"></a>Сбой отправки многошагового веб-теста.

Некоторые причины, по которым он может произойти:
   * Максимальный размер — 300 000.
   * Циклы не поддерживаются.
   * Ссылки на другие веб-тесты не поддерживаются.
   * Источники данных не поддерживаются.

### <a name="my-multi-step-test-doesnt-complete"></a>Мой многошаговый тест не выполняется.

Максимальное количество запросов в тесте — 100. Кроме того, тест будет остановлен, если он выполняется дольше двух минут.

### <a name="how-can-i-run-a-test-with-client-certificates"></a>Как запустить тест с клиентскими сертификатами?

В настоящее время это не поддерживается.

## <a name="who-receives-the-classic-alert-notifications"></a>Кто получает (классические) оповещения?

Этот раздел относится только к классическим оповещениям, он поможет вам оптимизировать уведомления так, чтобы они приходили только желаемым получателям. Чтобы узнать больше о различиях между [классическими оповещениями](../platform/alerts-classic.overview.md) и новыми возможностями оповещений, ознакомьтесь с [обзорной статьей об оповещениях](../platform/alerts-overview.md). Чтобы управлять оповещениями в новом интерфейсе оповещений, используйте [группы действий](../platform/action-groups.md).

* Мы рекомендуем использовать определенных получателей для классических оповещений.

* Если флажок **bulk/group** (массовый/групповой) включен, оповещения о сбоях из X из Y расположений будут оправляться пользователям с ролями администратора или соадминистратора.  По сути, _все_ администраторы _подписки_ будут получать уведомления.

* Для оповещений о метриках доступности параметр **многогруппового** флажка, если он включен, отправляет пользователям с ролями владельца, участника или читателя в подписке. Фактически, _все_ пользователи, имеющие доступ к подписке Application Insights, находятся в области действия и будут получать уведомления. 

> [!NOTE]
> При отключении используемого флажка **bulk/group** (массовый/груповой) вы не сможете отменить изменение.

Используйте новые возможности оповещений и оповещения почти в реальном времени, если вам нужно уведомлять пользователей в зависимости от их ролей. С помощью [групп действий](../platform/action-groups.md) вы можете настроить уведомления по электронной почте для пользователей с любой из ролей — участника, владельца или читателя (не объединяемых вместе как один параметр).

## <a name="next-steps"></a>Дальнейшие действия

* [Многошаговое веб-тестирование](availability-multistep.md)
* [Проверки связи URL-адреса](monitor-web-app-availability.md)
