---
title: Устранение проблем в тестах доступности Azure Application Insights
description: Устранение проблем в веб-тестах в Azure Application Insights. Получение оповещений, когда веб-сайт становится недоступным или медленно реагирует на запросы.
ms.topic: conceptual
author: lgayhardt
ms.author: lagayhar
ms.date: 09/19/2019
ms.reviewer: sdash
ms.openlocfilehash: 94b00a36445b0f4284caba218f6416db726611eb
ms.sourcegitcommit: 8dc84e8b04390f39a3c11e9b0eaf3264861fcafc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/13/2020
ms.locfileid: "81255453"
---
# <a name="troubleshooting"></a>Устранение неполадок

Эта статья поможет вам устранить общие проблемы, которые могут возникнуть при использовании мониторинга доступности.

## <a name="ssltls-errors"></a>Ошибки SSL/TLS

|Сообщение о симптомах/ошибках| Возможные причины|
|--------|------|
|Не удалось создать Безопасный канал SSL/TLS  | Версия SSL. Поддерживаются только TLS 1.0, 1.1 и 1.2. **SSLv3 не поддерживается.**
|TLSv1.2 Запись Слой: Предупреждение (уровень: Фатальный, Описание: Плохой MAC записи)| Дополнительную [информацию](https://security.stackexchange.com/questions/39844/getting-ssl-alert-write-fatal-bad-record-mac-during-openssl-handshake)можно узнать в потоке StackExchange.
|URL, который не удается, является CDN (Сеть доставки контента) | Это может быть вызвано неправильной конфигурацией на CDN |  

### <a name="possible-workaround"></a>Возможный обходной путь

* Если URL-адреса, испытывающие проблему, всегда зависят от зависимых ресурсов, рекомендуется отключить **анализ зависимых запросов** для веб-теста.

## <a name="test-fails-only-from-certain-locations"></a>Тест завершается неудачей только в определенных местах

|Сообщение о симптомах/ошибках| Возможные причины|
|----|---------|
|Попытка подключения не удалась, потому что подключенная сторона не ответила должным образом после определенного периода времени  | Тестовые агенты в определенных местах блокируются брандмауэром.|
|    |Перенаправление некоторых IP-адресов происходит через (Балансы нагрузки, менеджеры трафика Geo, Azure Express Route.) 
|    |При использовании Azure ExpressRoute существуют сценарии, при которых пакеты могут быть удалены в случаях [асимметричного маршрутирования.](https://docs.microsoft.com/azure/expressroute/expressroute-asymmetric-routing)|

## <a name="test-failure-with-a-protocol-violation-error"></a>Сбой теста с ошибкой нарушения протокола

|Сообщение о симптомах/ошибках| Возможные причины| Возможные решения |
|----|---------|-----|
|Сервер допустил нарушение протокола. Раздел-ОтветХедер Деталь-CR должен сопровождаться LF | Это происходит при обнаружении пороков оговорок. В частности, некоторые заголовки могут не использовать CRLF для указания конца строки, что нарушает спецификацию HTTP. Application Insights обеспечивает выполнение этой спецификации HTTP и не отвечает ответам с неправильно сформированными заголовками.| а. Свяжитесь с поставщиком веб-сайта host / cdN-провайдером, чтобы исправить неисправные серверы. <br> b. В случае, если неудавшимися запросами являются ресурсы (например, файлы стилей, изображения, скрипты), можно отключить разбор зависимых запросов. Имейте в виду, если вы сделаете это, вы потеряете возможность контролировать наличие этих файлов).

> [!NOTE]
> При переходе по URL-адресу в браузерах, для которых установлена упрощенная проверка заголовков HTTP, может не произойти сбой. См. подробное описание проблемы в этой записи блога: http://mehdi.me/a-tale-of-debugging-the-linkedin-api-net-and-http-protocol-violations/  

## <a name="common-troubleshooting-questions"></a>Общие вопросы по устранению неполадок

### <a name="site-looks-okay-but-i-see-test-failures-why-is-application-insights-alerting-me"></a>Сайт выглядит правильно, но возникают сбои тестирования. Почему Application Insights оповещает меня?

   * Включены ли **в тесте зависимые запросы Parse?** Это приводит к строгой проверке ресурсов, таких как скрипты, изображения и т.д. Эти типы сбоев могут быть не заметны в браузере. Проверьте все изображения, скрипты, таблицы стилей и любые другие файлы, загружаемые на страницу. Если какой-либо из них не удается, тест сообщается как не удавшийся, даже если основная страница HTML загружается без проблем. Чтобы десенсибилизировать тест на такие сбои ресурсов, просто отоверьте зависимые запросы Parse из тестовой конфигурации.

   * Чтобы уменьшить вероятность шума от переходных сетевых вспышек и т.д., убедитесь, что повторы включения для конфигурации тестовых сбоев проверяется. Вы также можете выполнять тестирование из любого расположения и соответствующим образом управлять пороговым значением правила генерации оповещений для предотвращения проблем с конкретными расположениями, вызывающих ненужные оповещения.

   * Щелкните любую из красных точек в интерфейсе доступности или любой сбой доступности в проводнике поиска для просмотра сведений о том, почему мы сообщили о сбое. Результат теста, а также коррелированные данные телеметрии на стороне сервера (если они включены) должны помочь понять, почему тест завершился ошибкой. Распространенные причины временных неполадок — проблемы сети или подключения.

   * Истекло ли время ожидания теста? Мы прерываем тесты через две минуты. Если ваша проверка связи или многошаговый тест занимает более двух минут, мы воспринимаем это как сбой. Разбейте тест на несколько сеансов, которые можно выполнить последовательно.

   * Все ли расположения сообщили о сбоях? Если только некоторые их них прислали отчет о сбое, возможно, причина в проблемах с сетью или CDN. Щелкая красные точки, вы можете понять, почему расположение сообщило о сбое.

### <a name="i-did-not-get-an-email-when-the-alert-triggered-or-resolved-or-both"></a>Мне не пришло сообщение электронной почты при активации или разрешении оповещения.

Проверьте конфигурацию классических оповещений, чтобы убедиться, что ваш адрес электронной почты явно указан, или список рассылки, в который вы входите, настроен для получения уведомлений. Если это так, проверьте конфигурацию списка рассылки, чтобы убедиться, что он может получать внешние сообщения электронной почты. Проверьте также, не настроил ли администратор электронной почты политики, которые могут вызвать эту проблему.

### <a name="i-did-not-receive-the-webhook-notification"></a>Я не получаю уведомления веб-перехватчика.

Убедитесь, что приложение, получающее уведомления от веб-перехватчика, доступно и успешно обрабатывает запросы веб-перехватчика. Дополнительную информацию см. [здесь](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitor-alerts-unified-log-webhook).

### <a name="intermittent-test-failure-with-a-protocol-violation-error"></a>Периодические сбои тестирования и ошибка с уведомлением о нарушении протокола.

Ошибка ("нарушение протокола...За возвратом каретки должен следовать перевод строки") свидетельствует о возможной неполадке с сервером (или зависимостями). Такое происходит, когда в ответе задаются неправильно сформированные заголовки. Это может быть вызвано подсистемами балансировки нагрузки или сетями доставки содержимого (CDN). В частности, некоторые заголовки могут не использовать CRLF для указания конца строки, что нарушает спецификацию HTTP и, следовательно, не соответствует действительности на уровне .NET WebRequest. Проинспектировать ответ на точечные заголовки, которые могут быть в нарушении.

> [!NOTE]
> При переходе по URL-адресу в браузерах, для которых установлена упрощенная проверка заголовков HTTP, может не произойти сбой. См. подробное описание проблемы в этой записи блога: http://mehdi.me/a-tale-of-debugging-the-linkedin-api-net-and-http-protocol-violations/  

### <a name="i-dont-see-any-related-server-side-telemetry-to-diagnose-test-failures"></a>Я не вижу никакой связанной телеметрии сервера для диагностики сбоев тестирования?»

Если служба Application Insights настроена для серверного приложения, возможно, это произошло из-за [выборки](../../azure-monitor/app/sampling.md) в операции. Выберите другой результат доступности.

### <a name="can-i-call-code-from-my-web-test"></a>Можно ли вызывать код из моего веб-теста?

Нет. Действия теста должны находиться в WEBTEST-файле. Кроме того, нельзя вызывать другие веб-тесты и использовать циклы. Но есть несколько подключаемых модулей, которые могут оказаться полезными.


### <a name="is-there-a-difference-between-web-tests-and-availability-tests"></a>Есть ли разница между понятиями "веб-тесты" и "тесты доступности"?

Эти два термина могут быть взаимозаменяемыми. Тест доступности является более универсальным термином, так как кроме многошаговых веб-тестов вам доступны проверка связи с отдельным URL-адресом.

### <a name="id-like-to-use-availability-tests-on-our-internal-server-that-runs-behind-a-firewall"></a>Мне нужно использовать тесты доступности на нашем внутреннем сервере, который работает за брандмауэром.

   Существует два возможных решения:

   * Разрешите в брандмауэре входящие запросы с [IP-адресов агентов веб-тестирования](../../azure-monitor/app/ip-addresses.md).
   * Напишите собственный код для периодической проверки внутреннего сервера. Запустите код в виде фонового процесса на тестовом сервере за брандмауэром. Процесс тестирования может отправлять результаты в Application Insights с помощью API [TrackAvailability()](https://docs.microsoft.com/dotnet/api/microsoft.applicationinsights.telemetryclient.trackavailability) в основном пакете SDK. Для этого тестовый сервер должен иметь исходящий доступ к конечной точке приема в Application Insights, что представляет гораздо меньшую угрозу безопасности, чем разрешение входящих запросов. Результаты будут отображаться в доступности веб-тестов лезвия, хотя опыт будет немного упрощен от того, что доступно для тестов, созданных через портал. Тесты пользовательского доступа также будут отображаться по мере получения результатов в области аналитики, поиска и метрик.

### <a name="uploading-a-multi-step-web-test-fails"></a>Сбой отправки многошагового веб-теста.

Некоторые причины, по которым он может произойти:
   * Максимальный размер — 300 000.
   * Циклы не поддерживаются.
   * Ссылки на другие веб-тесты не поддерживаются.
   * Источники данных не поддерживаются.

### <a name="my-multi-step-test-doesnt-complete"></a>Мой многошаговый тест не выполняется.

Максимальное количество запросов в тесте — 100. Кроме того, тест будет остановлен, если он выполняется дольше двух минут.

### <a name="how-can-i-run-a-test-with-client-certificates"></a>Как запустить тест с клиентскими сертификатами?

В настоящее время это не поддерживается.

## <a name="who-receives-the-classic-alert-notifications"></a>Кто получает (классические) оповещения?

Этот раздел относится только к классическим оповещениям, он поможет вам оптимизировать уведомления так, чтобы они приходили только желаемым получателям. Чтобы узнать больше о различиях между [классическими оповещениями](../platform/alerts-classic.overview.md) и новыми возможностями оповещений, ознакомьтесь с [обзорной статьей об оповещениях](../platform/alerts-overview.md). Чтобы управлять оповещениями в новом интерфейсе оповещений, используйте [группы действий](../platform/action-groups.md).

* Мы рекомендуем использовать определенных получателей для классических оповещений.

* Если флажок **bulk/group** (массовый/групповой) включен, оповещения о сбоях из X из Y расположений будут оправляться пользователям с ролями администратора или соадминистратора.  По сути, _все_ администраторы _подписки_ будут получать уведомления.

* Для предупреждений о метриках доступности **опция "объем/групповой** чек-бокс", если включена, отправляет пользователям роли владельца, участника или читателя в подписке. Фактически, _все_ пользователи, имеющие доступ к подписке Application Insights, находятся в области действия и будут получать уведомления. 

> [!NOTE]
> При отключении используемого флажка **bulk/group** (массовый/груповой) вы не сможете отменить изменение.

Используйте новые возможности оповещений и оповещения почти в реальном времени, если вам нужно уведомлять пользователей в зависимости от их ролей. С помощью [групп действий](../platform/action-groups.md) вы можете настроить уведомления по электронной почте для пользователей с любой из ролей — участника, владельца или читателя (не объединяемых вместе как один параметр).

## <a name="next-steps"></a>Дальнейшие действия

* [Многоступенчатое веб-тестирование](availability-multistep.md)
* [Тесты URL-пинга](monitor-web-app-availability.md)
