---
title: Начало работы со службой Log Analytics в Azure Monitor | Документация Майкрософт
description: В этой статье описано, как использовать портал аналитики для написания запросов в Log Analytics.
ms.service: azure-monitor
ms.subservice: logs
ms.topic: tutorial
author: bwren
ms.author: bwren
ms.date: 07/19/2019
ms.openlocfilehash: 1117ebbb8d2c3b133156c6b63a0ab13185f9f4a5
ms.sourcegitcommit: 4c3d6c2657ae714f4a042f2c078cf1b0ad20b3a4
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/25/2019
ms.locfileid: "72933055"
---
# <a name="get-started-with-log-analytics-in-azure-monitor"></a>Начало работы со службой Log Analytics в Azure Monitor

> [!NOTE]
> Вы можете выполнить это упражнение в своей среде, если собираете данные, по крайней мере, с одной виртуальной машины. Если нет, используйте нашу [демонстрационную среду](https://portal.loganalytics.io/demo), которая содержит большое количество образцов данных.

В этом руководстве рассматривается использование Log Analytics на портале Azure для записывания запросов журнала Azure Monitor. Вы научитесь:

- использовать Log Analytics для записи простого запроса;
- разобраться со схемой данных;
- фильтровать, сортировать и группировать результаты;
- применять диапазон времени;
- создавать диаграммы;
- сохранять и загружать запросы;
- экспортировать запросы и совместно использовать их.

Руководство по написанию запросов журналов см. в разделе [Начало работы с запросами журналов в Azure Monitor](get-started-queries.md).<br>
Дополнительные сведения о запросах журналов см. в разделе [Общие сведения о запросах журналов в Azure Monitor](log-query-overview.md).

## <a name="meet-log-analytics"></a>Служба Log Analytics
Log Analytics — это веб-инструмент, используемый для записывания и выполнения запросов журналов Azure Monitor. Откройте их, выбрав **Журналы** в меню Azure Monitor. Она начинается с нового пустого запроса.

![главная страница](media/get-started-portal/homepage.png)

## <a name="firewall-requirements"></a>Требования к брандмауэру
Чтобы использовать Log Analytics, ваш браузер запрашивает доступ к следующим адресам. Если браузер обращается к порталу Azure через брандмауэр, необходимо разрешить доступ для этих адресов.

| URI | IP-адрес | порты; |
|:---|:---|:---|
| portal.loganalytics.io | Динамический | 80, 443 |
| api.loganalytics.io | Динамический | 80, 443 |
| docs.loganalytics.io | Динамический | 80, 443 |

## <a name="basic-queries"></a>Базовые запросы
Запросы могут использоваться для поиска терминов, определения тенденций, анализа шаблонов и предоставления многих других сведений на основе ваших данных. Начните с базового запроса:

```Kusto
Event | search "error"
```

Этот запрос выполняет в таблице _Event_ поиск записей, содержащих термин _error_ в любом свойстве.

Запросы могут начинаться с имени таблицы или команды [search](/azure/kusto/query/searchoperator). Приведенный выше пример начинается с имени таблицы _Событие_, которое извлекает все записи из таблицы "Событие". Символ вертикальной черты (|) разделяет команды, поэтому выходные данные первой команды выступают в качестве входных данных следующей команды. Вы можете добавить любое количество команд в один запрос.

Другой способ написать тот же запрос:

```Kusto
search in (Event) "error"
```

В этом примере команда **search** привязана к таблице _Event_, и во всех записях в этой таблице выполняется поиск термина _error_.

## <a name="running-a-query"></a>Выполнение запроса
Выполните запрос, нажав кнопку **Запуск** или клавиши **SHIFT+ENTER**. Рассмотрите следующие сведения, которые определяют код для запуска, и возвращаемые данные:

- Разрывы строк: один разрыв упрощает чтение запроса. Несколько разрывов строк разделяют его на отдельные запросы.
- Курсор: поместите курсор внутри запроса для его выполнения. Текущий запрос считается кодом до тех пор, пока не будет найдена пустая строка.
- Диапазон времени: по умолчанию установлен диапазон времени _за последние 24 часа_. Чтобы использовать другой диапазон, используйте инструмент выбора времени или добавьте в свой запрос явный фильтр диапазона времени.


## <a name="understand-the-schema"></a>Изучение схемы
Схема представляет собой коллекцию таблиц, визуально сгруппированных в логической категории. Некоторые из категорий относятся к решениям мониторинга. Категория _LogManagement_ содержит общие данные, такие как события Windows и Syslog, данные о производительности и пакеты пульса агента.

![Схема](media/get-started-portal/schema.png)

В каждой таблице данные упорядочены в столбцы с разными типами данных, которые указаны с помощью значков рядом с именем столбца. Например, таблица _Event_, показанная на снимке экрана, содержит такие столбцы, как _Computer_ с текстовым типом данных, _EventCategory_ с числовым типом данных и _TimeGenerated_ с типом даты и времени.

## <a name="filter-the-results"></a>Фильтрация результатов
Начните с получения всех сведений в таблице _Event_.

```Kusto
Event
```

Служба Log Analytics автоматически задает область результатов по следующим критериям.

- Диапазон времени:  по умолчанию запросы ограничиваются последними 24 часами.
- Число результатов: результаты не могут включать более 10 000 записей.

Этот запрос очень общий, и он возвращает слишком много результатов, поэтому является неэффективным. Вы можете фильтровать результаты с помощью элементов таблицы или путем явного добавления фильтра в запрос. Фильтрация результатов с помощью элементов таблицы применяется к имеющемуся результирующему набору, тогда как фильтр в самом запросе возвращает новый отфильтрованный результирующий набор и, следовательно, может обеспечивать более точные результаты.

### <a name="add-a-filter-to-the-query"></a>Добавление фильтра в запрос
Слева от каждой записи находится стрелка. Щелкните эту стрелку, чтобы открыть сведения о конкретной записи.

Наведите указатель мыши над именем столбца, чтобы появились значки "+" и "-". Чтобы добавить фильтр, который будет возвращать только записи с одинаковым значением, щелкните значок "+". Щелкните значок "-", чтобы исключить записи с этим значением, а затем нажмите кнопку **Запуск**, чтобы снова запустить запрос.

![Добавление фильтра к запросу](media/get-started-portal/add-filter.png)

### <a name="filter-through-the-table-elements"></a>Фильтрация по элементам таблицы
Теперь давайте сосредоточимся на событиях с уровнем серьезности _Ошибка_. Серьезность указана в столбце с именем _EventLevelName_. Прокрутите вправо, чтобы увидеть этот столбец.

Щелкните значок "Фильтр" рядом с заголовком столбца, а во всплывающем окне выберите значения, которые _начинаются со_ слова _error_:

![Фильтр](media/get-started-portal/filter.png)


## <a name="sort-and-group-results"></a>Сортировка и группирование результатов
Теперь результаты сужены и включают только события ошибок из SQL Server, созданные за последние 24 часа. Однако результаты не отсортированы каким-либо образом. Чтобы отсортировать результаты по определенному столбцу, например, _timestamp_, щелкните заголовок столбца. Первый щелчок сортирует по возрастанию, а второй — по убыванию.

![Сортировка столбца](media/get-started-portal/sort-column.png)

Другой способ упорядочить результаты — по группам. Чтобы сгруппировать результаты по определенному столбцу, просто перетащите заголовок столбца над другими столбцами. Чтобы создать подгруппы, перетащите другие столбцы на верхнюю панель.

![Группы](media/get-started-portal/groups.png)

## <a name="select-columns-to-display"></a>Выбор столбцов для отображения
Таблица результатов часто содержит множество столбцов. Вы можете обнаружить, что некоторые возвращенные столбцы не отображаются по умолчанию, или вы можете удалить некоторые столбцы, которые отображаются. Чтобы выбрать столбцы для отображения, нажмите кнопку "Столбцы":

![Выбор столбцов](media/get-started-portal/select-columns.png)


## <a name="select-a-time-range"></a>Выбор диапазона времени
По умолчанию служба Log Analytics применяет диапазон времени за _последние 24 часа_. Чтобы использовать другой диапазон, выберите другое значение через средство выбора времени и нажмите кнопку **Запуск**. В дополнение к заданным значениям вы можете использовать параметр _Настраиваемый диапазон времени_, чтобы выбрать абсолютный диапазон для своего запроса.

![Средство выбора времени](media/get-started-portal/time-picker.png)

При выборе настраиваемого диапазона времени выбранные значения указаны в формате UTC, который может отличаться от локального часового пояса.

Если запрос явно содержит фильтр по столбцу _TimeGenerated_, в заголовке средства выбора времени будет отображено _Set in query_ (Задано в запросе). Выбор вручную будет отключен, чтобы предотвратить конфликт.


## <a name="charts"></a>Диаграммы
Кроме возврата результатов в таблице, результаты запроса могут быть представлены в визуальных форматах. В качестве примера используйте следующий запрос:

```Kusto
Event 
| where EventLevelName == "Error" 
| where TimeGenerated > ago(1d) 
| summarize count() by Source 
```

По умолчанию результаты отображаются в таблице. Щелкните _Диаграмма_, чтобы увидеть результаты в графическом представлении:

![Линейчатая диаграмма](media/get-started-portal/bar-chart.png)

Результаты показаны на линейчатой диаграмме с накоплением. Щелкните _Гистограмма с накоплением_ и выберите _Круговая диаграмма_, чтобы отобразить другое представление результатов:

![Круговая диаграмма](media/get-started-portal/pie-chart.png)

Различные свойства представления, например оси x и y, или группирования и разделения параметров можно изменить вручную на панели элементов управления.

Можно также задать нужное представление в самом запросе, используя оператор отображения.

### <a name="smart-diagnostics"></a>Интеллектуальная диагностика
Если на временной диаграмме есть внезапный пик или шаг в данных, то вы можете видеть на линии выделенную точку. Это указывает на то, что _интеллектуальная диагностика_ выявила сочетание свойств, которое отфильтровывает внезапные изменения. Щелкните данную точку, чтобы узнать больше о фильтре и просмотреть отфильтрованную версию. Эти сведения могут помочь определить причину изменения.

![Интеллектуальная диагностика](media/get-started-portal/smart-diagnostics.png)

## <a name="pin-to-dashboard"></a>Закрепить на панели мониторинга
Вы можете закрепить диаграмму или таблицу на одной из общих панелей мониторинга Azure. Для этого просто щелкните значок закрепления. Обратите внимание, что этот значок перемещен в верхнюю часть окна Log Analytics, что отличается от снимка экрана ниже.

![Закрепить на панели мониторинга](media/get-started-portal/pin-dashboard.png)

При закреплении на панели мониторинга к диаграмме применяются определенные упрощения.

- Столбцы и строки таблицы. Чтобы закрепить таблицу на панели мониторинга, она должна содержать четыре или меньше столбцов. Отображаются только семь верхних строк.
- Ограничение времени. Автоматически отображаются запросы только за последние 14 дней.
- Ограничение количества ячеек. Если отображается диаграмма, содержащая много отдельных ячеек, менее заполненные ячейки автоматически группируются в одну ячейку с именем _Другие_.

## <a name="save-queries"></a>Сохранение запросов
После создания удобного запроса вы можете сохранить его или поделиться им с другими. Значок **Сохранить** находится на верхней панели.

Вы можете сохранить либо всю страницу запроса, либо один запрос как функцию. Функции — это запросы, на которые также могут ссылаться другие запросы. Чтобы сохранить запрос как функцию, вы должны указать псевдоним функции, который является именем, используемым для вызова этого запроса, когда на него ссылаются другие запросы.

![Сохранение функции](media/get-started-portal/save-function.png)

>[!NOTE]
>Следующие символы поддерживаются: `a–z, A–Z, 0-9, -, _, ., <space>, (, ), |` в поле **Имя** при сохранении или изменении сохраненного запроса.

Запросы Log Analytics всегда сохраняются в выбранную рабочую область и используются другими пользователями этой рабочей области.

## <a name="load-queries"></a>Загрузка запросов
Значок обозревателя запросов находится в верхней правой области. Здесь содержится список всех сохраненных запросов по категориям. Он также позволяет отмечать определенные запросы как избранные, чтобы быстро найти их в будущем. Дважды щелкните сохраненный запрос, чтобы добавить его в текущее окно.

![Обозреватель запросов](media/get-started-portal/query-explorer.png)

## <a name="export-and-share-as-link"></a>Экспорт и создание общей ссылки на запрос
Служба Log Analytics поддерживает несколько методов экспорта.

- Excel: сохраните результаты как CSV-файл.
- Power BI: экспортируйте результаты в Power BI. Дополнительные сведения см. в статье [Импорт данных Log Analytics Azure в Power BI](../../azure-monitor/platform/powerbi.md).
- Общий доступ к ссылке: на сам запрос можно создать общую ссылку, которую затем можно отправить для выполнения другими пользователями, у которых есть доступ к той же рабочей области.

## <a name="next-steps"></a>Дополнительная информация

- Дополнительные сведения о написании запросов журнала в Azure Monitor см. в [этой статье](get-started-queries.md).
