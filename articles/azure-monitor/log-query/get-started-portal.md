---
title: Руководство по Начало работы с запросами Log Analytics
description: В этом учебнике рассматривается, как создавать запросы к журналам Azure Monitor и управлять ими с помощью Log Analytics на портале Azure.
ms.subservice: logs
ms.topic: tutorial
author: bwren
ms.author: bwren
ms.date: 03/17/2020
ms.openlocfilehash: 8917c73474b81ee76e6acdf8c6f274e962ee1215
ms.sourcegitcommit: dea88d5e28bd4bbd55f5303d7d58785fad5a341d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/06/2020
ms.locfileid: "87874237"
---
# <a name="tutorial-get-started-with-log-analytics-queries"></a>Руководство по Начало работы с запросами Log Analytics

В этом учебнике показано, как использовать Log Analytics для записи и выполнения запросов к журналам Azure Monitor на портале Azure, а также для управления ими. Запросы Log Analytics можно использовать для поиска терминов, определения тенденций, анализа шаблонов и предоставления многих других сведений на основе ваших данных. 

В этом учебнике вы узнаете, как с помощью Log Analytics выполнять следующие задачи:

> [!div class="checklist"]
> * Изучение общей схемы данных журнала.
> * Создание и выполнение простых запросов и изменение диапазона времени для запросов.
> * Фильтрация, сортировка и группирование результатов запроса.
> * Просмотр, изменение и совместное использование визуальных элементов результатов запроса.
> * Сохранение, загрузка, экспорт и копирование запросов и результатов.

Дополнительные сведения о запросах журналов см. в разделе [Общие сведения о запросах журналов в Azure Monitor](log-query-overview.md).<br/>
Инструкции по написанию запросов к журналам Azure Monitor см. в [этой статье](get-started-queries.md).

## <a name="open-log-analytics"></a>Открытие Log Analytics
Чтобы использовать Log Analytics, необходимо войти в учетную запись Azure. Если у вас нет учетной записи Azure, можно [создать ее бесплатно](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).

Для выполнения большинства действий, описанных в этом учебнике, можно использовать [эту демонстрационную среду](https://ms.portal.azure.com/#blade/Microsoft_Azure_Monitoring_Logs/DemoLogsBlade), которая включает в себя множество образцов данных. В демонстрационной среде нельзя сохранять запросы или закреплять результаты на панели мониторинга.

Вы также можете использовать собственную среду, если вы используете Azure Monitor для сбора данных журнала по крайней мере одного ресурса Azure. Чтобы открыть рабочую область Log Analytics, на левой панели навигации Azure Monitor щелкните **Журналы**. 

## <a name="understand-the-schema"></a>Изучение схемы
 
*Схема* представляет собой коллекцию таблиц, сгруппированных по логическим категориям. В демонстрационной схеме несколько категорий из решений для мониторинга. Категория **LogManagement** содержит общие данные, такие как события Windows и системного журнала, данные о производительности и пакеты пульса агента.

Таблицы схемы отображаются на вкладке **Таблицы** в рабочей области Log Analytics. Таблицы содержат столбцы, в каждом из которых отображается тип данных в виде значка рядом с именем столбца. Например, таблица **Event** содержит текстовые столбцы, такие как **Computer**, и числовые столбцы, такие как **EventCategory**.

![схема](media/get-started-portal/schema.png)

## <a name="write-and-run-basic-queries"></a>Создание и выполнение основных запросов

Log Analytics открывается с новым пустым запросом в окне **Редактора запросов**.

![Log Analytics](media/get-started-portal/homepage.png)

### <a name="write-a-query"></a>Напишите запрос

В запросах журналов Azure Monitor используется язык запросов Kusto. Запросы могут начинаться с имени таблицы или команды [search](/azure/kusto/query/searchoperator). 

Следующий запрос получает все записи из таблицы **Event**:

```Kusto
Event
```

Символ вертикальной черты ("|") разделяет команды, поэтому выходные данные первой команды содержатся во входных данных следующей команды. Вы можете добавить любое количество команд в один запрос. Следующий запрос получает записи из таблицы **Event**, а затем ищет термин **error** в любом свойстве:

```Kusto
Event 
| search "error"
```

Одинарный разрыв строки упрощает чтение запросов. Несколько разрывов строки разбивают запрос на отдельные запросы.

Вот другой вариант написания того же запроса:

```Kusto
search in (Event) "error"
```

Во втором примере команда **search** выполняет поиск термина **error** только в записях таблицы **Event**.

По умолчанию Log Analytics ограничивает запросы по диапазону времени, составляющему последние 24 часа. Чтобы задать другой диапазон времени, можно явно добавить в запрос фильтр **TimeGenerated** или использовать элемент управления **Диапазон времени**.

### <a name="use-the-time-range-control"></a>Использование элемента управления "Диапазон времени"
Чтобы использовать элемент управления **Диапазон времени**, выберите его на верхней панели, а затем выберите значение из раскрывающегося списка, или выберите элемент **особый**, чтобы создать настраиваемый диапазон времени.

![Средство выбора времени](media/get-started-portal/time-picker.png)

- Выбранные значения диапазона указаны в формате UTC, поэтому время может отличаться от времени локального часового пояса.
- Если запрос явно задает фильтр **TimeGenerated**, в элементе управления выбора времени отображается параметр **Задать значение в запросе**, который отключен для предотвращения конфликта.

### <a name="run-a-query"></a>Выполнение запроса
Чтобы выполнить запрос, поместите курсор внутри запроса и нажмите кнопку **Запустить** на верхней панели или нажмите клавиши **SHIFT**+**ВВОД**. Запрос выполняется до тех пор, пока не будет найдена пустая строка.

## <a name="filter-results"></a>Фильтрация результатов
Log Analytics ограничивает максимальное количество результатов до 10 000 записей. Общий запрос типа `Event` возвращает слишком много результатов, чтобы быть полезным. Результаты запроса можно отфильтровать либо с помощью ограниченных табличных элементов в запросе, либо путем явного добавления фильтра к результатам. При фильтрации по элементам таблицы возвращается новый результирующий набор, а к существующему результирующему набору применяется явный фильтр.

### <a name="filter-by-restricting-table-elements"></a>Фильтрация путем ограничения элементов таблицы
Чтобы отфильтровать результаты запроса `Event` по событиям **Error**, ограничив элементы таблицы в запросе, выполните следующие шаги:

1. В результатах запроса выберите стрелку раскрывающегося списка рядом с любой записью c состоянием **Error** в столбце **EventLevelName**. 
   
1. В развернутых сведениях наведите указатель мыши на меню-многоточие ( **...** ) рядом с **EventLevelName**, а затем выберите пункт **Включить"Error"** . 
   
   ![Добавление фильтра к запросу](media/get-started-portal/add-filter.png)
   
1. Обратите внимание, что запрос в **редакторе запросов** теперь изменился:
   
   ```Kusto
   Event
   | where EventLevelName == "Error"
   ```
   
1. Нажмите кнопку **Запуск**, чтобы выполнить новый запрос.

### <a name="filter-by-explicitly-filtering-results"></a>Фильтрация по явному фильтру результатов
Чтобы отфильтровать результаты запроса `Event` по событиям **Error**, выполните фильтрацию результатов:

1. В результатах запроса щелкните значок **Фильтр** рядом с заголовком столбца **EventLevelName**. 
   
1. В первом поле всплывающего окна выберите значение **Равно**, а в следующем поле введите *error*. 
   
1. Нажмите кнопку **Фильтр**.
   
   ![Filter](media/get-started-portal/filter.png)

## <a name="sort-group-and-select-columns"></a>Сортировка, группировка и выбор столбцов
Чтобы отсортировать результаты запроса по определенному столбцу, например **TimeGenerated [UTC]** , выберите заголовок столбца. Снова выберите заголовок, чтобы переключить упорядочивание с возрастающего на убывающее и наоборот.

![Сортировка столбца](media/get-started-portal/sort-column.png)

Другой способ упорядочить результаты — по группам. Чтобы сгруппировать результаты по определенному столбцу, перетащите заголовок столбца на панель над таблицей результатов с надписью **Drag a column header and drop it here to group by that column** (Перетащите заголовок столбца и поместите его сюда, чтобы сгруппировать по этому столбцу). Чтобы создать подгруппы, перетащите другие столбцы на верхнюю панель. Можно изменить иерархию и сортировку групп и подгрупп на панели.

![Группы](media/get-started-portal/groups.png)

Чтобы скрыть или показать столбцы в результатах, выберите меню **Столбцы** над таблицей, а затем выберите или отмените выбор нужных столбцов в раскрывающемся списке.

![Выбор столбцов](media/get-started-portal/select-columns.png)

## <a name="view-and-modify-charts"></a>Просмотр и изменение диаграмм
Результаты запроса можно также просматривать в разных визуальных форматах. В качестве примера введите следующий запрос:

```Kusto
Event 
| where EventLevelName == "Error" 
| where TimeGenerated > ago(1d) 
| summarize count() by Source 
```

По умолчанию результаты отображаются в виде таблицы. Щелкните представление **Диаграмма** над таблицей, чтобы просмотреть результаты в графическом представлении.

![Линейчатая диаграмма](media/get-started-portal/bar-chart.png)

Результаты будут показаны на линейчатой диаграмме с накоплением. Выберите другие варианты, такие как **Гистограмма с накоплением** или **Круговая диаграмма**, чтобы просмотреть результаты в других представлениях.

![Круговая диаграмма](media/get-started-portal/pie-chart.png)

Различные свойства представления, например оси x, y, или группирования и разделения параметров можно изменить вручную на панели управления.

Можно также задать нужное представление в самом запросе, используя оператор [render](/azure/kusto/query/renderoperator).

## <a name="pin-results-to-a-dashboard"></a>Закрепление результатов на панели мониторинга

Чтобы закрепить таблицу результатов или диаграмму из Log Analytics на общей панели мониторинга Azure, выберите элемент **Закрепить на панели мониторинга** на верхней панели. 

![Закрепить на панели мониторинга](media/get-started-portal/pin-dashboard.png)

На панели **Закрепить на другой панели мониторинга** выберите или создайте общую панель мониторинга для закрепления и нажмите кнопку **Применить**. Таблица или диаграмма появится на выбранной панели мониторинга Azure.

![Диаграмма, закрепленная на панели мониторинга](media/get-started-portal/pin-dashboard2.png)

Таблица или диаграмма, закрепленные на общей панели мониторинга, предусматривают следующие упрощения: 

- Данные ограничиваются последними 14 днями.
- В таблице отображается только максимум четыре столбца и верхние семь строк.
- В диаграммах со множеством дискретных категорий менее заполненные категории автоматически группируются в одну ячейку **Другие**.

## <a name="save-load-or-export-queries"></a>Сохранение, загрузка и экспорт запросов

После создания запроса можно сохранить его или поделиться запросом или результатами с другими пользователями. 

### <a name="save-queries"></a>Сохранение запросов

Чтобы сохранить запрос, выполните следующие шаги:

1. Нажмите кнопку **Сохранить** на верхней панели.
   
1. В диалоговом окне **Сохранить** присвойте запросу **имя**, используя символы a–z, A–Z, 0–9, пробел, дефис, символ подчеркивания, точку, круглую скобку или вертикальную черту. 
   
1. Выберите, следует ли сохранить запрос как **запрос** или **функцию**. Функции — это запросы, на которые также могут ссылаться другие запросы. 
   
   Чтобы сохранить запрос как функцию, укажите **Псевдоним функции**, который является кратким именем для других запросов, используемых для вызова этого запроса.
   
1. Если вы используете рабочую область Log Analytics, укажите **категорию**, чтобы **обозреватель запросов** использовал ее для запроса. (Категории недоступны для запросов Application Insights.)
   
1. Щелкните **Сохранить**.
   
   ![Сохранение функции](media/get-started-portal/save-function.png)

### <a name="load-queries"></a>Загрузка запросов
Чтобы загрузить сохраненный запрос, щелкните **Обозреватель запросов** в правом верхнем углу. Откроется панель **Обозреватель запросов**, в которой будут перечислены все запросы по категориям. Разверните категории или введите имя запроса в строке поиска, а затем выберите запрос, чтобы загрузить его в **редактор запросов**. Можно добавить запрос в **Избранное**, щелкнув звездочку рядом с именем запроса.

![Обозреватель запросов](media/get-started-portal/query-explorer.png)

### <a name="export-and-share-queries"></a>экспортировать запросы и совместно использовать их.
Чтобы экспортировать запрос, щелкните меню **Экспорт** на верхней панели, а затем выберите **Экспорт в CSV — все столбцы**, **Экспорт в CSV — отображаемые столбцы**или **Экспорт в Power BI (запрос M)** в раскрывающемся списке.

В следующем видео показано, как интегрировать Log Analytics с Excel.

> [!VIDEO https://www.microsoft.com/en-us/videoplayer/embed/RE4Asme]

Чтобы поделиться ссылкой на запрос, щелкните меню **Копировать ссылку** на верхней панели, а затем выберите **Копировать ссылку на запрос**, **Копировать текст запроса** или **Copy query results** (Копировать результаты запросов), чтобы копировать данные в буфер обмена. Вы можете отправить ссылку на запрос другим пользователям, у которых есть доступ к той же рабочей области.

## <a name="next-steps"></a>Дальнейшие действия

Перейдите к следующему учебнику, чтобы узнать больше о написании запросов журналов Azure Monitor.
> [!div class="nextstepaction"]
> [Написание запросов к журналам Azure Monitor](get-started-queries.md)
