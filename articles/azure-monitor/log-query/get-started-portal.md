---
title: Начало работы с Azure Monitor Log Analytics | Документация Майкрософт
description: В этой статье описано, как использовать портал аналитики для написания запросов в Log Analytics.
services: log-analytics
author: bwren
manager: carmonm
ms.service: log-analytics
ms.topic: conceptual
ms.date: 07/19/2019
ms.author: bwren
ms.openlocfilehash: cf2aee475f5d3933421de45fa5b2ade687bed62f
ms.sourcegitcommit: e72073911f7635cdae6b75066b0a88ce00b9053b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/19/2019
ms.locfileid: "68348082"
---
# <a name="get-started-with-log-analytics-in-azure-monitor"></a>Начало работы с Log Analytics в Azure Monitor

[!INCLUDE [log-analytics-demo-environment](../../../includes/log-analytics-demo-environment.md)]

В этом учебнике вы узнаете, как использовать Log Analytics в портал Azure для записи Azure Monitor запросов журналов. Вы научитесь:

- Создание простого запроса с помощью Log Analytics
- разобраться со схемой данных;
- фильтровать, сортировать и группировать результаты;
- применять диапазон времени;
- создавать диаграммы;
- сохранять и загружать запросы;
- экспортировать запросы и совместно использовать их.

Руководство по написанию запросов к журналам см. в разделе Начало [работы с запросами журналов в Azure Monitor](get-started-queries.md).<br>
Дополнительные сведения о запросах журналов см. [в разделе Общие сведения о запросах журналов в Azure Monitor](log-query-overview.md).

## <a name="meet-log-analytics"></a>Соответствие Log Analytics
Log Analytics — это веб-средство, используемое для записи и выполнения Azure Monitor запросов журналов. Откройте их, выбрав **Журналы** в меню Azure Monitor. Она начинается с нового пустого запроса.

![Домашняя страница](media/get-started-portal/homepage.png)

## <a name="firewall-requirements"></a>Требования к брандмауэру
Чтобы использовать Log Analytics, браузеру требуется доступ к следующим адресам. Если браузер обращается к порталу Azure через брандмауэр, необходимо разрешить доступ для этих адресов.

| URI | IP | Порты |
|:---|:---|:---|
| portal.loganalytics.io | Динамический | 80, 443 |
| api.loganalytics.io | Динамический | 80, 443 |
| docs.loganalytics.io | Динамический | 80, 443 |

## <a name="basic-queries"></a>Базовые запросы
Запросы могут использоваться для поиска терминов, определения тенденций, анализа шаблонов и предоставления многих других сведений на основе ваших данных. Начните с базового запроса:

```Kusto
Event | search "error"
```

Этот запрос выполняет поиск записей, содержащих термин " _Ошибка_ " в любом свойстве, в таблице _событий_ .

Запросы могут начинаться с имени таблицы или команды [search](/azure/kusto/query/searchoperator). Приведенный выше пример начинается с _события_Table name, которое извлекает все записи из таблицы событий. Символ вертикальной черты (|) разделяет команды, поэтому выходные данные первого из них служат в качестве входных данных для следующей команды. Вы можете добавить любое количество команд в один запрос.

Другой способ написать тот же запрос:

```Kusto
search in (Event) "error"
```

В этом примере поиск выполняется в области таблицы _событий_ , а все записи в этой таблице **выполняют** Поиск по термину _Ошибка_.

## <a name="running-a-query"></a>Выполнение запроса
Выполните запрос, нажав кнопку **Запуск** или клавиши **SHIFT+ENTER**. Рассмотрите следующие сведения, которые определяют код для запуска, и возвращаемые данные:

- Разрывы строк: Единый останов упрощает чтение запроса. Несколько разрывов строк разделяют его на отдельные запросы.
- Курсор: поместите курсор внутри запроса для его выполнения. Текущий запрос считается кодом до тех пор, пока не будет найдена пустая строка.
- Диапазон времени: по умолчанию установлен диапазон времени _за последние 24 часа_. Чтобы использовать другой диапазон, используйте инструмент выбора времени или добавьте в свой запрос явный фильтр диапазона времени.


## <a name="understand-the-schema"></a>Изучение схемы
Схема представляет собой коллекцию таблиц, визуально сгруппированных в логической категории. Некоторые из категорий относятся к решениям мониторинга. Категория _логманажемент_ содержит общие данные, такие как события Windows и syslog, данные производительности и пульсы агентов.

![Схема](media/get-started-portal/schema.png)

В каждой таблице данные упорядочены в столбцы с разными типами данных, которые указаны с помощью значков рядом с именем столбца. Например, таблица _Event_, показанная на снимке экрана, содержит такие столбцы, как _Computer_ с текстовым типом данных, _EventCategory_ с числовым типом данных и _TimeGenerated_ с типом даты и времени.

## <a name="filter-the-results"></a>Фильтрация результатов
Начните с получения всех сведений в таблице _Event_.

```Kusto
Event
```

Log Analytics автоматически области выводятся по:

- Диапазон времени:  по умолчанию запросы ограничиваются последними 24 часами.
- Число результатов: результаты не могут включать более 10 000 записей.

Этот запрос очень общий, и он возвращает слишком много результатов, поэтому является неэффективным. Вы можете фильтровать результаты с помощью элементов таблицы или путем явного добавления фильтра в запрос. Фильтрация результатов с помощью элементов таблицы применяется к имеющемуся результирующему набору, тогда как фильтр в самом запросе возвращает новый отфильтрованный результирующий набор и, следовательно, может обеспечивать более точные результаты.

### <a name="add-a-filter-to-the-query"></a>Добавление фильтра в запрос
Слева от каждой записи находится стрелка. Щелкните эту стрелку, чтобы открыть сведения о конкретной записи.

Наведите указатель мыши над именем столбца, чтобы появились значки "+" и "-". Чтобы добавить фильтр, который будет возвращать только записи с одинаковым значением, щелкните значок "+". Щелкните значок "-", чтобы исключить записи с этим значением, а затем нажмите кнопку **Запуск**, чтобы снова запустить запрос.

![Добавление фильтра к запросу](media/get-started-portal/add-filter.png)

### <a name="filter-through-the-table-elements"></a>Фильтрация по элементам таблицы
Теперь давайте сосредоточимся на событиях с уровнем серьезности _Ошибка_. Серьезность указана в столбце с именем _EventLevelName_. Прокрутите вправо, чтобы увидеть этот столбец.

Щелкните значок "Фильтр" рядом с заголовком столбца, а во всплывающем окне выберите значения, которые _начинаются со_ слова _error_:

![Filter](media/get-started-portal/filter.png)


## <a name="sort-and-group-results"></a>Сортировка и группирование результатов
Теперь результаты сужены и включают только события ошибок из SQL Server, созданные за последние 24 часа. Однако результаты не отсортированы каким-либо образом. Чтобы отсортировать результаты по определенному столбцу, например, _timestamp_, щелкните заголовок столбца. Первый щелчок сортирует по возрастанию, а второй — по убыванию.

![Сортировка столбца](media/get-started-portal/sort-column.png)

Другой способ упорядочить результаты — по группам. Чтобы сгруппировать результаты по определенному столбцу, просто перетащите заголовок столбца над другими столбцами. Чтобы создать подгруппы, перетащите другие столбцы на верхнюю панель.

![Группы](media/get-started-portal/groups.png)

## <a name="select-columns-to-display"></a>Выбор столбцов для отображения
Таблица результатов часто содержит множество столбцов. Вы можете обнаружить, что некоторые возвращенные столбцы не отображаются по умолчанию, или вы можете удалить некоторые столбцы, которые отображаются. Чтобы выбрать столбцы для отображения, нажмите кнопку "Столбцы":

![Выбор столбцов](media/get-started-portal/select-columns.png)


## <a name="select-a-time-range"></a>Выберите диапазон времени
По умолчанию Log Analytics применяет диапазон времени за _последние 24 часа_ . Чтобы использовать другой диапазон, выберите другое значение через средство выбора времени и нажмите кнопку **Запуск**. В дополнение к заданным значениям вы можете использовать параметр _Настраиваемый диапазон времени_, чтобы выбрать абсолютный диапазон для своего запроса.

![Средство выбора времени](media/get-started-portal/time-picker.png)

При выборе настраиваемого диапазона времени выбранные значения указаны в формате UTC, который может отличаться от локального часового пояса.

Если запрос явно содержит фильтр по столбцу _TimeGenerated_, в заголовке средства выбора времени будет отображено _Set in query_ (Задано в запросе). Выбор вручную будет отключен, чтобы предотвратить конфликт.


## <a name="charts"></a>Диаграммы
Кроме возврата результатов в таблице, результаты запроса могут быть представлены в визуальных форматах. В качестве примера используйте следующий запрос:

```Kusto
Event 
| where EventLevelName == "Error" 
| where TimeGenerated > ago(1d) 
| summarize count() by Source 
```

По умолчанию результаты отображаются в таблице. Щелкните _Диаграмма_, чтобы увидеть результаты в графическом представлении:

![Линейчатая диаграмма](media/get-started-portal/bar-chart.png)

Результаты показаны на линейчатой диаграмме с накоплением. Щелкните _Гистограмма с накоплением_ и выберите _Круговая диаграмма_, чтобы отобразить другое представление результатов:

![Круговая диаграмма](media/get-started-portal/pie-chart.png)

Различные свойства представления, например оси x и y, или группирования и разделения параметров можно изменить вручную на панели элементов управления.

Можно также задать нужное представление в самом запросе, используя оператор отображения.

### <a name="smart-diagnostics"></a>Интеллектуальная диагностика
Если на временной диаграмме есть внезапный пик или шаг в данных, то вы можете видеть на линии выделенную точку. Это указывает на то, что _интеллектуальная диагностика_ выявила сочетание свойств, которое отфильтровывает внезапные изменения. Щелкните данную точку, чтобы узнать больше о фильтре и просмотреть отфильтрованную версию. Эти сведения могут помочь определить причину изменения.

![Интеллектуальная диагностика](media/get-started-portal/smart-diagnostics.png)

## <a name="pin-to-dashboard"></a>Закрепить на панели мониторинга
Вы можете закрепить диаграмму или таблицу на одной из общих панелей мониторинга Azure. Для этого просто щелкните значок закрепления.

![Закрепить на панели мониторинга](media/get-started-portal/pin-dashboard.png)

При закреплении на панели мониторинга к диаграмме применяются определенные упрощения.

- Столбцы и строки таблицы. Чтобы закрепить таблицу на панели мониторинга, она должна содержать четыре или меньше столбцов. Отображаются только семь верхних строк.
- Ограничение времени. Автоматически отображаются запросы только за последние 14 дней.
- Ограничение количества ячеек. Если отображается диаграмма, содержащая много отдельных ячеек, менее заполненные ячейки автоматически группируются в одну ячейку с именем _Другие_.

## <a name="save-queries"></a>Сохранение запросов
После создания удобного запроса вы можете сохранить его или поделиться им с другими. Значок **Сохранить** находится на верхней панели.

Вы можете сохранить либо всю страницу запроса, либо один запрос как функцию. Функции — это запросы, на которые также могут ссылаться другие запросы. Чтобы сохранить запрос как функцию, вы должны указать псевдоним функции, который является именем, используемым для вызова этого запроса, когда на него ссылаются другие запросы.

![Сохранение функции](media/get-started-portal/save-function.png)

>[!NOTE]
>Поддерживаются следующие символы — `a–z, A–Z, 0-9, -, _, ., <space>, (, ), |` в поле **имя** при сохранении или изменении сохраненного запроса.

Запросы Log Analytics всегда сохраняются в выбранную рабочую область и используются другими пользователями этой рабочей области.

## <a name="load-queries"></a>Загрузка запросов
Значок обозревателя запросов находится в верхней правой области. Здесь содержится список всех сохраненных запросов по категориям. Он также позволяет отмечать определенные запросы как избранные, чтобы быстро найти их в будущем. Дважды щелкните сохраненный запрос, чтобы добавить его в текущее окно.

![Обозреватель запросов](media/get-started-portal/query-explorer.png)

## <a name="export-and-share-as-link"></a>Экспорт и создание общей ссылки на запрос
Log Analytics поддерживает несколько методов экспорта:

- Excel: сохраните результаты как CSV-файл.
- Power BI: Экспортируйте результаты в Power BI. Дополнительные сведения см. в статье [Импорт данных Log Analytics Azure в Power BI](../../azure-monitor/platform/powerbi.md).
- Общий доступ к ссылке: на сам запрос можно создать общую ссылку, которую затем можно отправить для выполнения другими пользователями, у которых есть доступ к той же рабочей области.

## <a name="next-steps"></a>Следующие шаги

- Дополнительные сведения о написании запросов журнала в Azure Monitor см. в [этой статье](get-started-queries.md).
