---
title: Аудит запросов в Azure Monitor запросов журналов
description: Сведения журналов аудита запросов журнала, которые предоставляют данные телеметрии о выполнении запросов журнала в Azure Monitor.
ms.subservice: logs
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 08/25/2020
ms.openlocfilehash: cb38dcba2f61a432decb56164b816688ad3192d8
ms.sourcegitcommit: c6b9a46404120ae44c9f3468df14403bcd6686c1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2020
ms.locfileid: "88893802"
---
# <a name="audit-queries-in-azure-monitor-logs-preview"></a>Аудит запросов в журналах Azure Monitor (Предварительная версия)
Журналы аудита запросов предоставляют данные телеметрии о выполнении запросов журнала в Azure Monitor. Сюда входят такие сведения, как время выполнения запроса, его выполнение, использование инструмента, текст запроса и статистика производительности, описывающая выполнение запроса.

## <a name="current-limitations"></a>Текущие ограничения
Во время общедоступной предварительной версии применяются следующие ограничения.

- Регистрируются только запросы, ориентированные на рабочие области. Запросы выполняются в режиме, ориентированном на ресурсы, или выполняются с Application Insights, не настроенным как на основе рабочей области, не регистрируются.


## <a name="configure-query-auditing"></a>Настройка аудита запросов
Аудит запросов включается с [параметром диагностики](../platform/diagnostic-settings.md) в рабочей области log Analytics. Это позволяет отправить данные аудита в текущую рабочую область или любую другую рабочую область в подписке, в концентраторы событий Azure для отправки за пределы Azure или в службу хранилища Azure для архивации. 

### <a name="azure-portal"></a>Портал Azure
Получите доступ к параметру диагностики для Log Analytics рабочей области в портал Azure в любом из следующих расположений:

- В меню **Azure Monitor** выберите **параметры диагностики**, а затем найдите и выберите рабочую область.

    [![Azure Monitor ](media/log-query-audit/diagnostic-setting-monitor.png) параметров диагностики ](media/log-query-audit/diagnostic-setting-monitor.png#lightbox) 

- В меню **log Analytics рабочие области** выберите рабочую область, а затем выберите **параметры диагностики**.

    [![Параметры диагностики Log Analytics рабочей области ](media/log-query-audit/diagnostic-setting-workspace.png)](media/log-query-audit/diagnostic-setting-workspace.png#lightbox) 

### <a name="resource-manager-template"></a>Шаблон Resource Manager
Пример диспетчер ресурсов шаблона можно получить из [параметра диагностики для log Analytics рабочей области](../samples/resource-manager-diagnostic-settings.md#diagnostic-setting-for-log-analytics-workspace).

## <a name="audit-data"></a>Данные аудита
Запись аудита создается каждый раз при выполнении запроса. Если данные отправляются в рабочую область Log Analytics, они хранятся в таблице с именем *лакуерилогс*. В следующей таблице описаны свойства каждой записи данных аудита.

| Поле | Описание |
|:---|:---|
| TimeGenerated         | Время отправки запроса в формате UTC. |
| CorrelationId         | Уникальный идентификатор для идентификации запроса. Может использоваться в сценариях устранения неполадок при обращении в корпорацию Майкрософт за помощью. |
| аадобжектид           | Azure Active Directory идентификатор учетной записи пользователя, запустившего запрос.  |
| AADTenantId           | Идентификатор клиента учетной записи пользователя, запустившего запрос.  |
| аадемаил              | Электронная почта клиента учетной записи пользователя, запустившего запрос.  |
| аадклиентид           | ИДЕНТИФИКАТОР и разрешенное имя приложения, используемого для запуска запроса. |
| рекуестклиентапп      | Разрешенное имя приложения, используемое для запуска запроса. |
| куеритимеранжестарт   | Начало диапазона времени, выбранного для запроса. Это может быть не заполнено в определенных сценариях, например при запуске запроса с Log Analytics, а диапазон времени указывается в запросе, а не в средстве выбора времени. |
| куеритимеранжеенд     | Конец диапазона времени, выбранного для запроса. Это может быть не заполнено в определенных сценариях, например при запуске запроса с Log Analytics, а диапазон времени указывается в запросе, а не в средстве выбора времени.  |
| QueryText             | Текст запроса, который был запущен. |
| рекуесттаржет         | URL-адрес API был использован для отправки запроса.  |
| RequestContext        | Список ресурсов, для которых был запрошен запрос. Содержит до трех массивов строк: рабочих областей, приложений и ресурсов. Подписка или группа ресурсов. целевые запросы будут отображаться как *ресурсы*. Включает целевой объект, подразумеваемый Рекуесттаржет. |
| рекуестконтекстфилтерс | Набор фильтров, заданных как часть вызова запроса. Включает до трех возможных массивов строк:<br>-Ресаурцетипес — тип ресурса, ограничивающий область запроса.<br>-Workspaces — список рабочих областей, для которых необходимо ограничить запрос.<br>-Воркспацерегионс — список регионов рабочей области для ограничения запроса. |
| ResponseCode          | Код ответа HTTP, возвращаемый при отправке запроса. |
| респонседуратионмс    | Время возврата ответа.  |
| статскпутимемс       | Общее время вычислений, используемое для вычисления, анализа и выборки данных. Заполняется, только если запрос возвращает код состояния 200. |
| статсдатапроцесседкб | Объем данных, к которым осуществлялся доступ для обработки запроса. Зависит от размера целевой таблицы, используемого диапазона времени, примененных фильтров и количества столбцов, на которые имеются ссылки. Заполняется, только если запрос возвращает код состояния 200. |
| статсдатапроцесседстарт | Время самых старых данных, к которым осуществлялся доступ для обработки запроса. На это влияет запрос на явное время и применение фильтров. Это может быть больше, чем явный период времени из-за секционирования данных. Заполняется, только если запрос возвращает код состояния 200. |
| статсдатапроцесседенд  |Время новых данных, к которым осуществлялся доступ для обработки запроса. На это влияет запрос на явное время и применение фильтров. Это может быть больше, чем явный период времени из-за секционирования данных. Заполняется, только если запрос возвращает код состояния 200. |
| статсворкспацекаунт | Число рабочих областей, к которым обращается запрос. Заполняется, только если запрос возвращает код состояния 200. |
| статсрегионкаунт | Число регионов, к которым обращается запрос. Заполняется, только если запрос возвращает код состояния 200. |



## <a name="next-steps"></a>Дальнейшие шаги

- Дополнительные сведения о [параметрах диагностики](../platform/diagnostic-settings.md).
- Дополнительные сведения об [оптимизации запросов журналов](query-optimization.md).