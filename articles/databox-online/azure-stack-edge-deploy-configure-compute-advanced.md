---
title: Руководство по фильтрации, анализу данных для расширенного развертывания с помощью вычислений в Azure Stack Edge | Документация Майкрософт
description: Узнайте, как настроить роль вычислений в Azure Stack Edge и использовать ее для преобразования данных для процесса расширенного развертывания перед отправкой в Azure.
services: databox
author: alkohli
ms.service: databox
ms.subservice: edge
ms.topic: tutorial
ms.date: 05/20/2019
ms.author: alkohli
Customer intent: As an IT admin, I need to understand how to configure compute on Azure Stack Edge for advanced deployment flow so I can use it to transform the data before sending it to Azure.
ms.openlocfilehash: eb7bb7933303aaf16f320e219ad3673bf1efde72
ms.sourcegitcommit: 856db17a4209927812bcbf30a66b14ee7c1ac777
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/29/2020
ms.locfileid: "82564662"
---
# <a name="tutorial-transform-data-with-azure-stack-edge-for-advanced-deployment-flow"></a>Руководство по преобразованию данных с помощью Azure Stack Edge для процесса расширенного развертывания

В этом учебнике описывается, как настроить роль вычислений для процесса расширенного развертывания в устройстве Azure Stack Edge. После того как роль вычислений настроена, Azure Stack Edge может преобразовывать данные перед отправкой в ​​Azure.

Вычисления можно настроить для процесса простого или расширенного развертывания в устройстве.

|                  | Простое развертывание                                | Расширенное развертывание                   |
|------------------|--------------------------------------------------|---------------------------------------|
| Предполагаемое использование     | ИТ-администраторы                                | Разработчики                            |
| Тип             | Использование службы Azure Stack Edge для развертывания модулей      | Использование службы Центр Интернета вещей для развертывания модулей |
| Развернутые модули | Один                                           | Цепочка или несколько модулей           |


Эта процедура может занять от 20 до 30 минут.

В этом руководстве описано следующее:

> [!div class="checklist"]
> * настройка вычислений;
> * добавление общих папок;
> * Добавление триггера
> * Добавление модуля вычислений.
> * Проверка преобразования и передачи данных

 
## <a name="prerequisites"></a>Предварительные требования

Прежде чем вы настроите роль вычисления на устройстве Azure Stack Edge, убедитесь, что:

- устройство Azure Stack Edge активировано, как описано в статье [Руководство по подключению, настройке и активации Azure Stack Edge](azure-stack-edge-deploy-connect-setup-activate.md).


## <a name="configure-compute"></a>настройка вычислений;

Чтобы настроить вычисления в Azure Stack Edge, необходимо создать ресурс Центра Интернета вещей.

1. На портале Azure своего ресурса Azure Stack Edge перейдите к разделу **Обзор**. В области справа на плитке **Вычисления** щелкните **Начало работы**.

    ![Начало работы с вычислениями](./media/azure-stack-edge-deploy-configure-compute-advanced/configure-compute-1.png)

2. На плитке **Настройка вычислений Edge** щелкните **Настройка вычислений**.

    ![Начало работы с вычислениями](./media/azure-stack-edge-deploy-configure-compute-advanced/configure-compute-2.png)

3. В колонке **Настройка вычислений Edge** введите следующие значения:

   
    |Поле  |Значение  |
    |---------|---------|
    |Центр Интернета вещей     | Выберите **Новый** или **Существующий**. <br> По умолчанию для создания ресурса Интернета вещей используется уровень служб "Стандартный" (S1). Чтобы использовать ресурс Интернета вещей уровня служб "Бесплатный", создайте его и выберите существующий ресурс. <br> В любом случае для ресурса Интернета вещей используется та же подписка и группа ресурсов, что и для ресурса Azure Stack Edge.     |
    |Имя     |Введите имя ресурса Центра Интернета вещей.         |

    ![Начало работы с вычислениями](./media/azure-stack-edge-deploy-configure-compute-advanced/configure-compute-3.png)

4. Нажмите кнопку **создания**. Для создания ресурса Центра Интернета вещей нужно несколько минут. После этого на плитке **Настройка вычислений Edge** появляется конфигурация вычислений. Чтобы подтвердить настройку роли пограничных вычислений, на плитке **Настройка вычислений** щелкните **Просмотреть конфигурацию**.
    
    ![Начало работы с вычислениями](./media/azure-stack-edge-deploy-configure-compute-advanced/configure-compute-4.png)

    При настройке роли вычислений Edge на устройстве Edge создается два устройства — устройство Интернета вещей и устройство IoT Edge. Оба устройства можно просмотреть в ресурсе Центра Интернета вещей. На этом устройстве IoT Edge также запущена среда выполнения IoT Edge.

    На данный момент доступна только платформа Linux для устройства IoT Edge.


## <a name="add-shares"></a>добавление общих папок;

Для расширенного развертывания, описанного в этом учебнике, вам понадобятся две общие папки: общая папка Edge и еще одна локальная общая папка Edge.

1. Добавьте общую папку Edge на устройство следующим образом:

    1. В ресурсе Azure Stack Edge поочередно выберите **Вычисления Edge > Начало работы**.
    2. На плитке **Добавление общих папок** щелкните **Добавить**.
    3. В колонке **Добавление общего файлового ресурса** укажите имя общей папки и выберите ее тип.
    4. Чтобы подключить общую папку Edge, установите флажок **Использовать общую папку с пограничными вычислениями**.
    5. Выберите **учетную запись хранения**, **службу хранилища**, существующего пользователя, а затем щелкните **Создать**.

        ![Добавление общей папки Edge](./media/azure-stack-edge-deploy-configure-compute-advanced/add-edge-share-1.png)

    <!--If you created a local NFS share, use the following remote sync (rsync) command option to copy files onto the share:

    `rsync <source file path> < destination file path>`

    For more information about the rsync command, go to [Rsync documentation](https://www.computerhope.com/unix/rsync.htm).-->

    После создания общей папки Edge вы получите уведомление об успешном создании. Список общих папок обновляется с учетом новых.

2. Добавьте локальную общую папку Edge на устройство Edge. Для этого повторите все шаги, описанные на предыдущем этапе, и установите флажок **Настройка в качестве локальной общей папки Edge**. Данные из локальной обшей папки остаются на устройстве.

    ![Добавление локальной общей папки Edge](./media/azure-stack-edge-deploy-configure-compute-advanced/add-edge-share-2.png)

3. В колонке **Общие папки** вы увидите обновленный список общих папок.

    ![Обновленный список общих папок](./media/azure-stack-edge-deploy-configure-compute-advanced/add-edge-share-3.png)

4. Выберите из списка созданную локальную общую папку, чтобы просмотреть ее свойства. Скопируйте значение, соответствующее этому ресурсу, в поле **Локальная точка подключения для модулей пограничных вычислений**.

    Эта локальная точка подключения используется при развертывании модуля.

    ![Поле "Локальная точка подключения для модулей пограничных вычислений"](./media/azure-stack-edge-deploy-configure-compute-advanced/add-edge-share-4.png)
 
5. Выберите из списка созданную общую папку Edge, чтобы просмотреть ее свойства. Скопируйте значение, соответствующее этому ресурсу, в поле **Локальная точка подключения для модулей пограничных вычислений**.

    Эта локальная точка подключения используется при развертывании модуля.

    ![Добавление настраиваемого модуля](./media/azure-stack-edge-deploy-configure-compute-advanced/add-edge-share-5.png)


## <a name="add-a-trigger"></a>Добавление триггера

1. Поочередно выберите **Вычисления Edge > Триггеры**. Выберите **+ Добавить триггер**.

    ![Добавление триггера](./media/azure-stack-edge-deploy-configure-compute-advanced/add-trigger-1.png)

2. В колонке **Добавить триггер** введите следующие значения.

    |Поле  |Значение  |
    |---------|---------|
    |Имя триггера     | Уникальное имя триггера.         |
    |Тип триггера     | Выберите триггер **файла**. Триггер файла срабатывает, когда возникает событие файла, например файл записывается во входную общую папку. С другой стороны, запланированный триггер срабатывает в соответствии с определенным вами расписанием. В этом примере нам нужен триггер файла.    |
    |Входная общая папка     | Выберите входную общую папку. В этом случае входной общей папкой будет локальная общая папка Edge. Используемый здесь модуль позволяет переместить файлы из локальной общей папки Edge в общую папку Edge, из которой они передаются в облако.        |

    ![Добавление триггера](./media/azure-stack-edge-deploy-configure-compute-advanced/add-trigger-2.png)

3. После создания триггера вы получите уведомление. Список триггеров обновляется, чтобы отобразить только что созданный триггер. Выберите только что созданный триггер.

    ![Добавление триггера](./media/azure-stack-edge-deploy-configure-compute-advanced/add-trigger-3.png)

4. Скопируйте и сохраните пример маршрута. Вам предстоит изменить этот пример маршрута и использовать его позже в Центре Интернета вещей.

    `"sampleroute": "FROM /* WHERE topic = 'mydbesmbedgelocalshare1' INTO BrokeredEndpoint(\"/modules/modulename/inputs/input1\")"`

    ![Добавление триггера](./media/azure-stack-edge-deploy-configure-compute-advanced/add-trigger-4.png)

## <a name="add-a-module"></a>Добавление модуля

На этом устройстве Edge нет пользовательских модулей. Можно добавить пользовательский или готовый модуль. Чтобы узнать, как создать пользовательский модуль, ознакомьтесь со статьей [Разработка на C# модуля IoT Edge для перемещения файлов в Azure Stack Edge](azure-stack-edge-create-iot-edge-module.md).

В этом разделе вы добавите пользовательский модуль к устройству IoT Edge, которое было создано с помощью руководства [Разработка на C# модуля IoT Edge для перемещения файлов в Azure Stack Edge](azure-stack-edge-create-iot-edge-module.md). Этот пользовательский модуль позволяет получить файлы из локальной общей папки Edge на устройстве Edge и перенести их в облачную общую папку Edge на устройстве. Затем облачный ресурс переносит файлы в учетную запись Azure, связанную с облачным ресурсом.

1. Поочередно выберите **Вычисления Edge > Начало работы**. На плитке **Добавление модулей** выберите **расширенный** тип сценария. Выберите **Перейти в центр Интернета вещей**.

    ![Выбор расширенного развертывания](./media/azure-stack-edge-deploy-configure-compute-advanced/add-module-1.png)

<!--2. In the **Configure and add module** blade, input the following values:  

    |Input share     | Select an input share. The Edge local share is the input share in this case. The module used here moves files from the Edge local share to an Edge share where they are uploaded into the cloud.        |
    |Output share     | Select an output share. The Edge share is the output share in this case.        |
-->

2. В ресурсе Центра Интернета вещей перейдите к **устройству IoT Edge**, а затем выберите устройство IoT Edge.

    ![Переход к устройству IoT Edge в Центре Интернета вещей](./media/azure-stack-edge-deploy-configure-compute-advanced/add-module-2.png)

3. В разделе **Сведения об устройстве** выберите **Задание модулей**.

    ![Ссылка "Задание модулей"](./media/azure-stack-edge-deploy-configure-compute-advanced/add-module-3.png)

4. В разделе **Добавить модули** выполните следующее:

    1. Введите имя, адрес, имя пользователя и пароль для параметров реестра контейнеров для настраиваемого модуля.
    Имя, адрес и перечисленные учетные данные используются для извлечения модулей с соответствующим URL-адресом. Чтобы развернуть этот модуль, в разделе **Модули развертывания** выберите **Модуль IoT Edge**. Этот модуль IoT Edge является контейнером Docker, который можно развернуть на устройстве IoT Edge, связанном с вашим устройством Azure Stack Edge.

        ![Страница "Задание модулей"](./media/azure-stack-edge-deploy-configure-compute-advanced/add-module-4.png) 
 
    2. Укажите настройки для настраиваемого модуля IoT Edge. Введите следующие значения.
     
        |Поле  |Значение  |
        |---------|---------|
        |Имя     | Уникальное имя модуля. Этот модуль является контейнером Docker, который можно развернуть на устройстве IoT Edge, связанном с вашим устройством Azure Stack Edge.        |
        |URI образа     | URI образа для соответствующего образа контейнера для модуля.        |
        |Требуются учетные данные     | Если установлен этот флажок, для получения модулей с соответствующим URL-адресом используются имя пользователя и пароль.        |
    
        В поле **Параметры создания контейнера** введите локальные точки подключения для модулей Edge, которые вы скопировали на предыдущих шагах для общей папки Edge и локальной общей папки Edge.

        > [!IMPORTANT]
        > Пути, используемые здесь, вставляются в контейнер, поэтому они должны соответствовать тому, какие ожидаются функциональные возможности в контейнере. Если вы [создаете пользовательский модуль](azure-stack-edge-create-iot-edge-module.md#update-the-module-with-custom-code), в код, указанный в этом модуле, нужно ввести скопированные пути. Не изменяйте эти пути.
    
        В поле **Параметры создания контейнера** можно вставить следующий пример:
    
        ```
        {
          "HostConfig": 
          {
           "Binds": 
            [
             "/home/hcsshares/mydbesmbedgelocalshare1:/home/input",
             "/home/hcsshares/mydbesmbedgeshare1:/home/output"
            ]
           }
        }
        ```

        Укажите все переменные среды, используемые в вашем модуле. Переменные среды предоставляют дополнительные сведения, которые помогают определить среду, где выполняется модуль.

        ![Поле "Параметры создания контейнера"](./media/azure-stack-edge-deploy-configure-compute-advanced/add-module-5.png) 
 
    4. При необходимости настройте расширенные параметры Edge, а затем нажмите кнопку **Далее**.

        ![Добавление настраиваемого модуля](./media/azure-stack-edge-deploy-configure-compute-advanced/add-module-6.png)
 
5.    В разделе **Укажите маршруты** настройте маршруты между модулями.  
    
    ![Указание маршрутов](./media/azure-stack-edge-deploy-configure-compute-advanced/add-module-7.png)

    *Маршрут* можно заменить следующей строкой маршрута, скопированной ранее. В этом случае введите имя локального общего ресурса, который будет отправлять данные в облачный общий ресурс. Замените `modulename` именем модуля. Выберите **Далее**.
        
    ```
    "route": "FROM /* WHERE topic = 'mydbesmbedgelocalshare1' INTO BrokeredEndpoint(\"/modules/filemove/inputs/input1\")"
    ```

    ![Раздел "Укажите маршруты"](./media/azure-stack-edge-deploy-configure-compute-advanced/add-module-8.png)

6.    В разделе **Проверка развертывания** просмотрите все параметры, а затем выберите **Отправить**, чтобы отправить модуль для развертывания.

    ![Страница "Задание модулей"](./media/azure-stack-edge-deploy-configure-compute-advanced/add-module-9.png)
 
    Это действие запускает развертывание модуля. После завершения развертывания **состояние среды выполнения** модуля изменится на **Запущен**.

    ![Добавление настраиваемого модуля](./media/azure-stack-edge-deploy-configure-compute-advanced/add-module-10.png)

## <a name="verify-data-transform-transfer"></a>Проверка преобразования и передачи данных

Последний шаг — убедиться, что модуль подключен и работает как ожидалось. Состояние выполнения модуля должно быть "Работает" для вашего устройства IoT Edge в ресурсе Центра Интернета вещей.

Для проверки преобразования и передачи данных в Azure сделайте следующее.
 
1.    С помощью проводника подключитесь к локальным и облачным общим папкам Edge, созданным ранее.

    ![Проверка преобразования данных](./media/azure-stack-edge-deploy-configure-compute-advanced/verify-data-2.png)
 
1.    Добавьте данные в локальную общую папку.

    ![Проверка преобразования данных](./media/azure-stack-edge-deploy-configure-compute-advanced/verify-data-3.png)
 
    Данные переносятся в облачную общую папку.

    ![Проверка преобразования данных](./media/azure-stack-edge-deploy-configure-compute-advanced/verify-data-4.png)  

    Затем данные переносятся из облачного ресурса в учетную запись хранения. Для просмотра данных перейдите в свою учетную запись хранения и выберите **Обозреватель службы хранилища Azure**. Вы можете просмотреть отправленные данные в своей учетной записи хранения.

    ![Проверка преобразования данных](./media/azure-stack-edge-deploy-configure-compute-advanced/verify-data-5.png)
 
Вы завершили процесс проверки.

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы узнали, как выполнять следующие задачи:

> [!div class="checklist"]
> * настройка вычислений;
> * добавление общих папок;
> * Добавление триггера
> * Добавление модуля вычислений.
> * Проверка преобразования и передачи данных

Чтобы узнать, как администрировать устройство Azure Stack Edge, перейдите к следующему руководству.

> [!div class="nextstepaction"]
> [Управление доступом, питанием и режимом подключения для Azure Stack Edge](azure-stack-edge-manage-access-power-connectivity-mode.md)
