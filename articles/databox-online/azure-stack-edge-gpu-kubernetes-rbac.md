---
title: Общие сведения об управлении доступом на основе ролей на Azure Stack пограничном устройстве | Документация Майкрософт
description: Описывает, как на Azure Stack пограничном устройстве выполняется управление доступом на основе ролей.
services: databox
author: alkohli
ms.service: databox
ms.subservice: edge
ms.topic: conceptual
ms.date: 08/27/2020
ms.author: alkohli
ms.openlocfilehash: 697c686b61a86cb01327364ad73f30f88e2e151d
ms.sourcegitcommit: bcda98171d6e81795e723e525f81e6235f044e52
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/01/2020
ms.locfileid: "89268080"
---
# <a name="kubernetes-role-based-access-control-on-your-azure-stack-edge-gpu-device"></a>Kubernetes управления доступом на основе ролей на устройстве GPU Azure Stack


При настройке роли вычислений на Azure Stack пограничной устройстве создается кластер Kubernetes. Вы можете использовать Kubernetes управления доступом на основе ролей (RBAC), чтобы ограничить доступ к ресурсам кластера на устройстве.

В этой статье приведены общие сведения о системе RBAC, предоставляемой Kubernetes, а также о том, как Kubernetes RBAC реализован на устройстве Azure Stackного периметра. 

## <a name="rbac-for-kubernetes"></a>RBAC для Kubernetes

Kubernetes RBAC позволяет назначать пользователям или группам пользователей разрешения на выполнение таких действий, как создание или изменение ресурсов, а также просмотр журналов из рабочих нагрузок приложений. Эти разрешения могут быть ограничены одним пространством имен или предоставлены во всем кластере. 

При настройке кластера Kubernetes создается один пользователь, соответствующий этому кластеру, и он называется администратором кластера.  `kubeconfig`Файл связан с пользователем администратора кластера. `kubeconfig`Файл представляет собой текстовый файл, содержащий все сведения о конфигурации, необходимые для подключения к кластеру для проверки подлинности пользователя.

## <a name="namespaces-types"></a>Типы пространств имен

Ресурсы Kubernetes, такие как Pod и развертывания, логически группируются в пространство имен. Эти группы позволяют логически разделить кластер Kubernetes и ограничить доступ к созданию, просмотру и управлению ресурсами. Пользователи смогут взаимодействовать только с ресурсами из назначенных им пространств имен.

Пространства имен предназначены для использования в средах с множеством пользователей, распределенных по нескольким командам или проектам. Для кластеров с небольшими десятками пользователей не нужно создавать или думать о пространствах имен. Приступите к использованию пространств имен, если вам нужны предоставляемые ими функции.

Дополнительные сведения см. в [документации по пространствам имен в Kubernetes](https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/).


У Azure Stack пограничных устройств есть следующие пространства имен:

- **Пространство имен System** — это пространство имен, в котором существуют основные ресурсы, такие как DNS и прокси, или панель мониторинга Kubernetes. Обычно вам не нужно развертывать приложения в этом пространстве имен. Используйте это пространство имен для отладки любых проблем с кластером Kubernetes. 

    На устройстве имеется несколько пространств имен System, и имена, соответствующие этим системным пространствам имен, зарезервированы. Ниже приведен список зарезервированных пространств имен System. 
    - KUBE — система
    - металлб — система
    - DBE — пространство имен
    - default
    - kubernetes — панель мониторинга
    - default
    - KUBE — Аренда узла
    - KUBE — Открытый
    - iotedge
    - Azure — дуга

    Обязательно используйте зарезервированные имена для создаваемых пространств имен пользователей. 
<!--- **default namespace** - This namespace is where pods and deployments are created by default when none is provided and you have admin access to this namespace. When you interact with the Kubernetes API, such as with `kubectl get pods`, the default namespace is used when none is specified.-->

- **Пространство имен пользователя** . это пространства имен, которые можно создать с помощью **kubectl** для локального развертывания приложений.
 
- **IOT Edge Namespace** — вы подключаетесь к этому `iotedge` пространству имен, чтобы развертывать приложения с помощью IOT Edge.

- **Пространство имен Azure Arc** — вы подключаетесь к этому `azure-arc` пространству имен для развертывания приложений через дугу Azure. 

## <a name="namespaces-and-users"></a>Пространства имен и пользователи

В реальном мире важно разделить кластер на несколько пространств имен. 

- **Несколько пользователей**. Если у вас несколько пользователей, то несколько пространств имен будут разрешать этим пользователям развертывать свои приложения и службы в отдельных пространствах имен, изолированных друг от друга. 
- **Один пользователь**. даже если существует один пользователь, несколько пространств имен позволяли пользователю запускать несколько версий приложений в одном кластере Kubernetes.

### <a name="roles-and-rolebindings"></a>Роли и Ролебиндингс

Kubernetes имеет концепцию привязки ролей и ролей, которая позволяет предоставлять разрешения пользователям или ресурсам на уровне пространства имен и на уровне кластера. 

- **Роли**. Вы можете определить разрешения для пользователей в качестве **роли** , а затем использовать **роли** для предоставления разрешений в пределах пространства имен. 
- **Ролебиндингс**. После определения ролей можно использовать **ролебиндингс** для назначения ролей для заданного пространства имен. 

Такой подход позволяет логически разделить один кластер Kubernetes, при этом пользователи могут получить доступ только к ресурсам приложения в назначенном им пространстве имен. 

## <a name="rbac-on-azure-stack-edge"></a>RBAC на Azure Stack границе

В текущей реализации RBAC Azure Stack ребра позволяет выполнять следующие действия из ограниченного пространства выполнения PowerShell:

- Создание пространств имен.  
- Создание дополнительных пользователей.
- Предоставьте администратору доступ к созданным пространствам имен. Помните, что у вас не будет доступа к роли администратора кластера или к просмотру ресурсов в масштабе кластера.
- Получите `kubeconfig` файл со сведениями для доступа к кластеру Kubernetes.


Azure Stack пограничное устройство имеет несколько пространств имен System, и вы можете создавать пространства имен пользователей с `kubeconfig` файлами для доступа к этим пространствам имен. Пользователи имеют полный контроль над этими пространствами имен и могут создавать или изменять пользователей, а также предоставлять пользователям доступ. Только администратор кластера имеет полный доступ к системным пространствам имен и ресурсам на уровне кластера. `aseuser`Имеет доступ только для чтения к системным пространствам имен.

Ниже приведена схема, на которой показана реализация RBAC на Azure Stack пограничном устройстве.

![RBAC на Azure Stack пограничном устройстве](./media/azure-stack-edge-gpu-kubernetes-rbac/rbac-view-1.png)

На этой схеме Алиса, Боб и Чак имеют доступ только к назначенным пространствам имен пользователей (в данном случае это `ns1` , `ns2` и соответственно) `ns3` . В этих пространствах имен они имеют доступ администратора. Администратор кластера с другой стороны имеет доступ администратора к системным пространствам имен и ресурсам на уровне кластера.

Команды можно использовать `kubectl` для создания пространств имен, назначения пользователей, назначения пользователей или загрузки `kubeconfig` файлов. Ниже приведен рабочий процесс высокого уровня.

1. Создание пространства имен и пользователя.  

    `New-HcsKubernetesNamespace -Namespace`  

2. Создайте пользователя.  

    `New-HcsKubernetesUser -UserName`  

3. Свяжите пространство имен с созданным пользователем.  

    `Grant-HcsKubernetesNamespaceAccess -Namespace -UserName`  

4. Сохраните конфигурацию пользователя в `C:\Users\<username>\.kube` .  

5. Установите `kubectl` и приступите к развертыванию приложений в `kubectl` . 

Подробные пошаговые инструкции см. в статье [доступ к кластеру Kubernetes через куебктл на Azure Stack пограничных](azure-stack-edge-gpu-create-kubernetes-cluster.md)устройствах.


При работе с пространствами имен и пользователями на Azure Stack пограничных устройствах применяются следующие предостережения.

- Вы не можете выполнять никакие операции, такие как создание пользователей, предоставление или Отмена доступа к пространству имен пользователю для любых пространств имен System. Примеры пространств имен System:, `kube-system` , `metallb-system` `kubernetes-dashboard` ,, `default` `kube-node-lease` , `kube-public` . Пространства имен System также включают пространства имен, зарезервированные для таких типов развертывания, как `iotedge` (IOT Edge пространство имен) и `azure-arc` (пространство имен Arc Azure).
- Вы можете создавать пространства имен пользователей и в этих пространствах имен создавать дополнительных пользователей, а также предоставлять или отменять доступ к пространству имен этим пользователям.
- Не разрешается создавать пространства имен с именами, идентичными именам системных пространств имен. Имена пространств имен System зарезервированы.  
- Вам запрещено создавать пространства имен пользователей с именами, которые уже используются другими пользовательскими пространствами имен. Например, если `test-ns` создан созданный объект, нельзя создать другое `test-ns` пространство имен.
- Вам запрещено создавать пользователей с уже зарезервированными именами. Например, `aseuser` является зарезервированным администратором кластера и не может использоваться.


## <a name="next-steps"></a>Дальнейшие действия

Чтобы понять, как можно создать пользователя, создать пространство имен и предоставить пользователю доступ к пространству имен, см. раздел [доступ к кластеру Kubernetes через kubectl](azure-stack-edge-gpu-create-kubernetes-cluster.md).

