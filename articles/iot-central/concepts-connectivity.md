---
title: Подключение устройства в Azure IoT Central | Документация Майкрософт
description: В этой статье описаны ключевые понятия, связанные с подключением устройства в Azure IoT Central.
author: dominicbetts
ms.author: dobett
ms.date: 04/09/2019
ms.topic: conceptual
ms.service: iot-central
services: iot-central
manager: timlt
ms.openlocfilehash: f11d1c6b727799f2cc67c6f5012dc4d117556d2e
ms.sourcegitcommit: e6d53649bfb37d01335b6bcfb9de88ac50af23bd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/09/2019
ms.locfileid: "65467806"
---
# <a name="device-connectivity-in-azure-iot-central"></a>Подключение устройства в Azure IoT Central

В этой статье описаны ключевые понятия, связанные с подключением устройства в Microsoft Azure IoT Central.

Azure IoT Central использует [службы подготовки устройств Azure IoT Hub (DPS)](https://docs.microsoft.com/azure/iot-dps/about-iot-dps) для управления регистрацию устройства и подключения.

С помощью службы подготовки устройств позволяет:

- Центр Интернета вещей для поддержки адаптации и подключающиеся устройства в нужном масштабе.
- Для создания устройства учетные данные и настройки устройств в автономном режиме без регистрации устройств через IoT Central пользовательского интерфейса.
- Устройства для подключения с использованием подписи общего доступа (SAS).
- Устройства для подключения с использованием стандартных отраслевых сертификатов X.509.
- Вы можете использовать собственные идентификаторов устройств для регистрации устройств в центр Интернета вещей. С помощью собственных идентификаторов устройств упрощает интеграцию с существующими системами отдела.
- Единая, согласованная способ подключения устройств к IoT Central.

В этой статье описывается следующих четырех случаях:

1. [Быстрое подключение одного устройства с помощью SAS](#connect-a-single-device)
1. [Подключение устройств в нужном масштабе с помощью SAS](#connect-devices-at-scale-using-sas)
1. [Подключение устройств в нужном масштабе с помощью сертификатов X.509](#connect-devices-using-x509-certificates) этот подход рекомендуется для рабочей среды.
1. [Подключение без предварительной регистрации устройства](#connect-without-registering-devices)

## <a name="connect-a-single-device"></a>Подключение одного устройства

Этот подход полезен в тех случаях, когда будете экспериментировать с IoT Central или тестирование устройств. Сведения о подключении устройства из приложения IoT Central можно использовать для создания строки подключения для устройства. Подробные инструкции см. в разделе [способы создания строки подключения устройства для подключения к приложению Azure IoT Central](howto-generate-connection-string.md).

## <a name="connect-devices-at-scale-using-sas"></a>Подключение устройств в нужном масштабе с помощью SAS

Подключение устройств к центр Интернета вещей в нужном масштабе, используя технологию SAS, необходимо зарегистрировать, а затем настройте устройства:

### <a name="register-devices-in-bulk"></a>Регистрация устройств в пакетном режиме

Чтобы зарегистрировать большое количество устройств IoT Central приложения, используйте CSV-файл [импортировать идентификаторы устройств и имена устройств](howto-manage-devices.md#import-devices).

Чтобы получить сведения о подключении для импортированных устройств, [Экспорт в CSV-файл из приложения IoT Central](howto-manage-devices.md#export-devices).

> [!NOTE]
> Чтобы узнать, как вы можете подключать устройства не регистрируя их в центр Интернета вещей, см. в разделе [Connect без первого регистрировать устройства](#connect-without-registering-devices).

### <a name="set-up-your-devices"></a>Настройка устройства

Используйте сведения о подключении из файла экспорта в коде устройства, чтобы позволить устройствам подключение и отправка данных для Интернета вещей в приложение IoT Central. Дополнительные сведения о подключении устройств см. в разделе [дальнейшие действия](#next-steps).

## <a name="connect-devices-using-x509-certificates"></a>Подключение устройств с использованием сертификатов X.509

В рабочей среде с использованием сертификатов X.509 — это механизм проверки подлинности рекомендуется устройств для IoT Central. Дополнительные сведения см. в статье [Device Authentication using X.509 CA Certificates](../iot-hub/iot-hub-x509ca-overview.md) (Аутентификация устройств с помощью сертификатов ЦС X.509).

Далее описано подключение устройств к IoT Central, с использованием сертификатов X.509:

1. В приложении IoT Central _добавить и проверить промежуточные или корневой сертификат X.509_ вы используете для создания сертификатов устройства:

    - Перейдите к **администрирования > подключение к устройству > сертификаты (X.509)** и добавьте X.509 корневой или промежуточный сертификат, вы используете для создания сертификатов конечного устройства.

      ![Параметры подключения](media/concepts-connectivity/connection-settings.png)

      Если у вас нарушения безопасности системы или вашей основной сертификат, срок действия которого истекает, используйте дополнительный сертификат, чтобы сократить время простоя. Вы можете подготавливать устройства с помощью дополнительного сертификата во время обновления основного сертификата.

    - Проверка владельца сертификата гарантирует, что отправитель сертификата содержит закрытый ключ сертификата. Для проверки сертификата:
        - Нажмите кнопку рядом с полем **код проверки** для создания кода.
        - Создание сертификата проверки X.509 с кодом проверки, который был создан на предыдущем шаге. Сохраните сертификат как CER-файл.
        - Передача подписанного сертификата проверки и выбор **Verify**.

          ![Параметры подключения](media/concepts-connectivity/verify-cert.png)

1. Использование файла CSV для _импорта и регистрации устройств_ в приложении IoT Central.

1. _Настройки устройств._ Создайте конечные сертификаты, используя переданный корневой сертификат. Используйте **идентификатор устройства** значение CNAME конечные сертификаты. Идентификатор устройства должен содержать только строчные буквы. Затем запрограммируйте устройствах с помощью службы данные инициализации. Когда устройство включается впервые, она получает сведения о подключении для вашего приложения IoT Central из DPS.

### <a name="further-reference"></a>Дополнительные ссылки

- Пример реализации для [RaspberryPi.](https://aka.ms/iotcentral-docs-Raspi-releases)

- [Пример клиента устройства на языке C.](https://github.com/Azure/azure-iot-sdk-c/blob/dps_symm_key/provisioning_client/devdoc/using_provisioning_client.md)

### <a name="for-testing-purposes-only"></a>Только для тестов

Только для тестирования, можно использовать эти служебные программы для создания сертификатов ЦС и сертификаты устройств.

- Если вы используете устройство DevKit, это [средство командной строки](https://aka.ms/iotcentral-docs-dicetool) создает сертификат ЦС, что можно добавить в приложение IoT Central, для проверки сертификатов.

- Используйте этот [средство командной строки](https://github.com/Azure/azure-iot-sdk-c/blob/master/tools/CACertificates/CACertificateOverview.md ) для:
  - Создайте цепочку сертификатов. В этой статье GitHub, выполните шаг 2.
  - Сохраните сертификаты как CER-файлы для загрузки приложения IoT Central.
  - Используйте код проверки из приложения центра Интернета вещей для создания сертификата проверки. Выполните шаг 3 в статье GitHub.
  - Создайте конечные сертификаты для ваших устройств, использование устройства идентификаторы в качестве параметра в средство. В этой статье GitHub, выполните шаг 4.

## <a name="connect-without-registering-devices"></a>Подключения без регистрации устройств

Ключевой сценарий IoT Central позволяет — для изготовителей оборудования для массового производства устройств, которые могут подключаться к приложению центра Интернета вещей без предварительной регистрации. Производитель необходимо создать подходящие учетные данные и настройки устройств в фабрике. Если впервые включает устройство, он автоматически подключается к приложению IoT Central. IoT Central оператор должен утвердить устройство, прежде чем его можно stat отправку данных.

На следующей схеме показаны этот поток:

![Параметры подключения](media/concepts-connectivity/device-connection-flow1.png)

Следующие шаги описывают этот процесс более подробно. Действия немного отличаются в зависимости от того, используете ли вы SAS или X.509 сертификаты для проверки подлинности устройства:

1. Настройте параметры подключения:

    - **Сертификаты X.509:** [Добавление и проверка корневого или промежуточного сертификата](#connect-devices-using-x509-certificates) и использовать его для создания сертификатов устройства, на следующем шаге.
    - **SAS**. Скопируйте первичный ключ. Этот ключ является ключ SAS группы для приложения центра Интернета вещей. Ключ можно используете для создания ключей SAS устройств на следующем шаге.
    ![Параметры подключения SAS](media/concepts-connectivity/connection-settings-sas.png)

1. Создать учетные данные устройства
    - **Сертификаты X.509:** Создание конечных сертификатов для устройств с помощью корневой или промежуточный сертификат, добавленный в приложение IoT Central. Убедитесь, что при использовании строчные **идентификатор устройства** как запись CNAME в конечные сертификаты. Для целей тестирования, используйте это [средство командной строки](https://github.com/Azure/azure-iot-sdk-c/blob/master/tools/CACertificates/CACertificateOverview.md ) для создания сертификатов устройства.
    - **SAS**. Используйте этот [средство командной строки](https://www.npmjs.com/package/dps-keygen) для создания ключей SAS для устройства. Используйте группу **первичный ключ** из предыдущего шага. Идентификатор устройства должны быть заданы строчными буквами.

      Чтобы установить [ключа программа создания](https://github.com/Azure/dps-keygen), выполните следующую команду:

      ```cmd/sh
      npm i -g dps-keygen
      ```

      Для создания ключа устройства из первичного ключа SAS группы, выполните следующую команду:

      ```cmd/sh
      dps-keygen -mk:<Primary_Key(GroupSAS)> -di:<device_id>
      ```

1. Чтобы настроить устройства, устройство флэш-памяти каждого с **идентификатор области**, **идентификатор устройства**, и **сертификат X.509 устройства** или **ключ SAS**.

1. Затем включите устройство для подключения к приложению IoT Central. При переходе на устройстве, он сначала подключается к DPS для получения сведений о регистрации его IoT Central.

1. Подключенное устройство изначально отображается как **несвязанные устройства** на **Device Explorer** страницы. Состояние подготовки устройства — **Зарегистрировано**. **Связать** устройство к шаблону подходящее устройство и утверждения устройства для подключения к приложению IoT Central. Устройства можно получить строку соединения из центра Интернета вещей и начать отправку данных. Подготовка устройств уже выполнено и состояние подготовки — теперь **инициализировано**.

## <a name="provisioning-status"></a>Состояние подготовки

Когда реальное устройство подключается к его подготовки изменения состояния приложения IoT Central, следующим образом:

1. Устройства, состояние подготовки первой **зарегистрированные**. Это состояние означает, что устройства создается в центр Интернета вещей и идентификатор устройства. В ходе регистрации при:
    - Новый реальное устройство добавляется на **Device Explorer** страницы.
    - Добавить набор устройств с помощью **импорта** на **Device Explorer** страницы.
    - Устройство не было зарегистрировано вручную в **Device Explorer** странице, но связи с действительными учетными данными и отображаются как **«не связан»** устройства на **Device Explorer**страницы.

1. Состояние подготовки устройства изменяется на **инициализировано** завершении шага подготовки устройства, подключенные к вашему приложению IoT Central с действительными учетными данными. На этом этапе устройство извлекает строку подключения из Интернета вещей. Устройство теперь может подключаться к центру Интернета вещей и начать отправку данных.

1. Оператор может заблокировать устройство. Если устройство заблокировано, он не может отправить данные приложения IoT Central. Блокировка устройств с состоянием подготовки **Blocked**. Оператор необходимо сбросить устройство, прежде чем его можно возобновить отправку данных. Когда оператор разблокирует состояние подготовки возвращает предыдущее значение, устройство **зарегистрированные** или **инициализировано**.

## <a name="sdk-support"></a>Поддержка пакетов SDK

Пакеты SDK для устройств Azure предложение самый простой способ для вас реализовать кода устройства. Доступны следующие пакеты SDK для устройств:

- [Пакет SDK для Azure IoT для C](https://github.com/azure/azure-iot-sdk-c).
- [Пакет SDK для Azure IoT для Python](https://github.com/azure/azure-iot-sdk-python).
- [Пакет SDK для Azure IoT для Node.js](https://github.com/azure/azure-iot-sdk-node).
- [Пакет SDK для Azure IoT для Java](https://github.com/azure/azure-iot-sdk-java).
- [Пакет SDK для Azure IoT для .NET](https://github.com/azure/azure-iot-sdk-csharp).

Каждое устройство подключается с помощью уникальной строки подключения, идентифицирующей устройство. Устройство может подключиться только к центру Интернета вещей, где было зарегистрировано. При создании физического устройства в приложении Azure IoT Central, приложение выдает сведения, необходимые для создания строки подключения с помощью `dps-keygen`.

### <a name="sdk-features-and-iot-hub-connectivity"></a>Функции пакета SDK и возможность подключения Центра Интернета вещей

Для всего обмена данными устройства с Центром Интернета вещей используются следующие варианты подключения Центра Интернета вещей:

- [передача сообщений с устройства в облако](../iot-hub/iot-hub-devguide-messages-d2c.md);
- [Двойники устройств](../iot-hub/iot-hub-devguide-device-twins.md)

В следующей таблице содержатся сведения о том, каким образом возможности устройства Azure IoT Central сопоставляются с возможностями Центра Интернета вещей.

| Azure IoT Central | Центр Интернета вещей Azure |
| ----------- | ------- |
| Измерения Телеметрия | Передача сообщений с устройства в облако |
| Свойства устройства | Сообщаемые свойства двойника устройства |
| Параметры | Требуемые и передаваемые свойства двойника устройства |

Чтобы узнать больше об использовании пакетов SDK для устройств, см. пример кода в одной из следующих статей:

- [Подключение универсального клиентского приложения к приложению Azure IoT Central (Node.js)](howto-connect-nodejs.md)
- [Подключение Raspberry Pi к приложению Azure IoT Central (Python)](howto-connect-raspberry-pi-python.md)
- [Подключение устройства MXChip IoT DevKit к приложению Azure IoT Central](howto-connect-devkit.md)

### <a name="protocols"></a>Протоколы

Пакеты SDK для устройства поддерживают следующие сетевые протоколы для подключения к Центру Интернета вещей.

- MQTT
- AMQP
- HTTPS

Дополнительные сведения об этих разных протоколах и рекомендации по их выбору см. в статье [Справочник — выбор протокола связи](../iot-hub/iot-hub-devguide-protocols.md).

Если ваше устройство не может использовать любой из поддерживаемых протоколов, вы можете использовать Azure IoT Edge для преобразования протокола. IoT Edge поддерживает другие сценарии интеллектуальной обработки на пограничном устройстве, позволяющие снизить нагрузку на пограничное устройство из приложения Azure IoT Central.

## <a name="security"></a>Безопасность

Все данные, передаваемые между устройствами и Azure IoT Central, зашифрованы. Центр Интернета вещей выполняет проверку подлинности каждого запроса с устройства, которое подключается к любой конечной точке Центра Интернета вещей, обращенной к устройству. Чтобы избежать обмена учетными данными по сети, для проверки подлинности устройство использует подписанные маркеры. Дополнительные сведения см. в статье [Управление доступом к Центру Интернета вещей](../iot-hub/iot-hub-devguide-security.md).

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы узнали о возможности подключения устройств в Azure IoT Central, ниже приведены предлагаемые дальнейшие действия.

- [Подготовка и подключение устройства DevKit](howto-connect-devkit.md)
- [Подготовка и подключение Raspberry Pi](howto-connect-raspberry-pi-python.md)
- [Подключение универсального клиентского приложения к приложению Azure IoT Central (Node.js)](howto-connect-nodejs.md)
- [C SDK: Пакет SDK для клиента подготовки устройства](https://github.com/Azure/azure-iot-sdk-c/blob/master/provisioning_client/devdoc/using_provisioning_client.md)
