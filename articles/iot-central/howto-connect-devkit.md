---
title: Подключение устройства DevKit к приложению Azure IoT Central | Документация Майкрософт
description: Вы узнаете, как разработчик устройства может подключить устройство MXChip IoT DevKit к приложению Azure IoT Central.
author: dominicbetts
ms.author: dobett
ms.date: 03/22/2019
ms.topic: conceptual
ms.service: iot-central
services: iot-central
manager: philmea
ms.openlocfilehash: 82222dd927f46761941a6a750d96222cc626e71b
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60887344"
---
# <a name="connect-an-mxchip-iot-devkit-device-to-your-azure-iot-central-application"></a>Подключение устройства MXChip IoT DevKit к приложению Azure IoT Central

В этой статье описано, каким образом разработчик устройства может подключить устройство MXChip IoT DevKit (DevKit) к приложению Microsoft Azure IoT Central.

## <a name="before-you-begin"></a>Перед началом работы

Чтобы выполнить действия, описанные в этой статье, вам понадобятся следующие ресурсы:

1. Приложение Azure IoT Central, созданное на основе шаблона приложения **Sample Devkits** (Образец Devkits). Дополнительные сведения см. в [кратком руководстве по созданию приложения](quick-deploy-iot-central.md).
1. Устройство DevKit. Чтобы приобрести устройство DevKit, посетите сайт [MXChip IoT DevKit](https://microsoft.github.io/azure-iot-developer-kit/).

## <a name="sample-devkits-application"></a>Пример приложения Devkits

Приложения, созданного из **Devkits пример** шаблон приложения включает в себя **MXChip** шаблон устройства, который определяет следующие характеристики устройства:

- Измерения данные телеметрии для **влажности**, **температуры**, **давление**, **магнитометр** (измеряется вдоль X, Y, оси Z), **Акселерометр** (измеряется вдоль X, Y, оси Z), и **гироскоп** (измеряется вдоль X, Y, оси Z).
- Состояние измерения для **состояние устройства**.
- Событие измерения для **нажата кнопка B**.
- Параметры для **напряжения**, **текущей**, **скорость вентилятора**и **IR** переключателя.
- Свойства устройства **die номера** и **местоположение устройства**, который является свойством расположение.
- Облако свойство **производства в**.
- Команды **Echo** и **обратного отсчета**. При получении реального устройства **Echo** команда, он показывает, отправленных значение на экране устройства. При получении реального устройства **обратного отсчета** команды циклов светодиодный Индикатор через шаблон, и устройство отправляет обратный отсчет значений обратно в центр Интернета вещей.

Подробные сведения о конфигурации см. в разделе [сведений об устройстве MXChip шаблона](#mxchip-device-template-details)

## <a name="add-a-real-device"></a>Добавление реального устройства

### <a name="get-your-device-connection-details"></a>Получение сведений о подключении устройства

В приложении Azure IoT Central, добавьте реального устройства из **MXChip** шаблон устройства и запишите сведения о подключении устройства: **Область идентификатор, идентификатор устройства и первичный ключ**:

1. Добавить **реальное устройство** Device Explorer, выберите **+ Создать > реальных** Добавление реального устройства.

    * Введите в нижнем регистре **идентификатор устройства**, или используйте предложенные **идентификатор устройства**.
    * Введите **имя_устройства**, или используйте предложенное имя

    ![Добавить устройство](media/howto-connect-devkit/add-device.png)

1. Чтобы получить сведения о подключении устройства **идентификатор области**, **идентификатор устройства**, и **первичный ключ**выберите **Connect** на странице "устройства".

    ![Сведения о подключении](media/howto-connect-devkit/device-connect.png)

1. Запомните или запишите сведения о подключении. При подготовке устройство DevKit на следующем шаге вы временно отключен от Интернета.

### <a name="prepare-the-devkit-device"></a>Подготовка устройства DevKit

Если вы ранее использовали устройства и хотите перенастроить его, чтобы использовать другую сеть Wi-Fi, строку подключения или измерения данные телеметрии, нажмите клавишу оба **объект** и **B** кнопки в то же время. Если это не поможет, нажмите клавишу **Сброс** кнопку и повторите попытку.

#### <a name="to-prepare-the-devkit-device"></a>Чтобы подготовить устройство DevKit, сделайте следующее:

1. Скачайте последнюю версию встроенного ПО Azure IoT Central для MXChip на [этой](https://aka.ms/iotcentral-docs-MXChip-releases) странице на сайте GitHub.
1. Подключите устройство DevKit к компьютеру, на котором будет выполняться разработка, с помощью USB-кабеля. В Windows в проводнике откроется диск, сопоставленный с хранилищем на устройстве DevKit. Например, этот диск может называться **AZ3166 (D:)**.
1. Перетащите файл **iotCentral.bin** в окно диска. По завершении копирования устройство перезагрузится с новой версией встроенного ПО.

1. При перезапуске устройства DevKit отображается следующий экран:

    ```
    Connect HotSpot:
    AZ3166_??????
    go-> 192.168.0.1
    PIN CODE xxxxx
    ```

    > [!NOTE]
    > Если на экране отображается что-либо еще, сбросьте устройство и нажмите одновременно кнопки **A** и **B** на устройстве, чтобы перезагрузить его.

1. Устройство находится в режиме точки доступа. Вы можете подключаться к точке доступа Wi-Fi с компьютера или мобильного устройства.

1. На компьютере, телефоне или планшете подключитесь к сети Wi-Fi с именем, отображаемым на экране устройства. При подключении к этой сети, у вас нет доступа к Интернету. Это состояние является нормальным, и вы подключены только к этой сети в течение короткого времени во время настройки устройства.

1. Откройте веб-браузер и перейдите по адресу [http://192.168.0.1/start](http://192.168.0.1/start). Откроется следующая веб-страница:

    ![Страница конфигурации устройства](media/howto-connect-devkit/configpage.png)

    На веб-странице введите следующую команду:
    - Имя сети Wi-Fi
    - пароль сети Wi-Fi
    - ПИН-кода, показан на дисплее устройства
    - Сведения о подключении **идентификатор области**, **идентификатор устройства**, и **первичный ключ** устройства (вы должны уже сохранили это, выполнив действия, описанные)
    - Выберите все доступные данные телеметрии измерения

1. Если выбрать **Настройка устройства**, откроется следующая страница:

    ![Устройство настроено](media/howto-connect-devkit/deviceconfigured.png)

1. Нажмите кнопку **Reset** (Сбросить) на устройстве.

## <a name="view-the-telemetry"></a>Просмотр телеметрии

При перезапуске устройства DevKit на экране устройства можно увидеть следующее:

* количество отправленных сообщений телеметрии;
* количество сбоев;
* количество полученных требуемых свойств и отправленных передаваемых свойств.

> [!NOTE]
> Если устройство будет отображаться в цикл, когда он пытается подключиться, проверьте, если устройство находится **Blocked** в центр Интернета вещей, и **Unblock** устройства, чтобы он мог подключаться к приложению.

Встряхните устройство для отправки сообщаемого свойства. Устройство отправляет случайное число в качестве свойства устройства **Серийный номер**.

Вы можете просмотреть измерения телеметрии и значения передаваемых свойств, а также настроить параметры в Azure IoT Central:

1. Используйте **Device Explorer**, чтобы перейти на страницу **Measurements** (Измерения) реального устройства MXChip, которое вы добавили:

    ![Переход к реальному устройству](media/howto-connect-devkit/realdevicenew.png)

1. На странице **Measurements** (Измерения) можно просмотреть данные телеметрии, поступающие из устройства MXChip.

    ![Просмотр данных телеметрии из реального устройства](media/howto-connect-devkit/devicetelemetrynew.png)

1. На странице **Свойства** можно просмотреть последний серийный номер и сведения о расположении устройства, переданные устройством:

    ![Просмотр свойств устройства](media/howto-connect-devkit/devicepropertynew.png)

1. На странице **Параметры** можно обновить параметры устройства MXChip:

    ![Просмотр параметров устройства](media/howto-connect-devkit/devicesettingsnew.png)

1. На **команды** страницы, можно вызвать **Echo** и **обратного отсчета** команды:

    ![Вызов команды](media/howto-connect-devkit/devicecommands.png)

1. На странице **Панель мониторинга** вы увидите карту расположения.

    ![Просмотр панели мониторинга устройства](media/howto-connect-devkit/devicedashboardnew.png)

## <a name="download-the-source-code"></a>Скачивание исходного кода

Если вы хотите просмотреть и изменить код устройства, его можно скачать с сайта GitHub. Если вы планируете изменить код, необходимо следовать этим инструкциям по [подготовке среды разработки](https://microsoft.github.io/azure-iot-developer-kit/docs/get-started/#step-5-prepare-the-development-environment) для операционной системы настольных устройств.

Чтобы скачать исходный код, выполните следующую команду на настольном компьютере:

```cmd/sh
git clone https://github.com/Azure/iot-central-firmware
```

Исходный код будет скачан в папку с именем `iot-central-firmware`.

> [!NOTE]
> Если **git** не установлен в среде разработки, его можно скачать здесь: [https://git-scm.com/download](https://git-scm.com/download).

## <a name="review-the-code"></a>Просмотр кода

Использование Visual Studio Code, чтобы открыть `MXCHIP/mxchip_advanced` папку в `iot-central-firmware` папку:

![Код Visual Studio](media/howto-connect-devkit/vscodeview.png)

Чтобы увидеть, как данные телеметрии отправляется в приложение Azure IoT Central, откройте **telemetry.cpp** файл `src` папку:

- Функция `TelemetryController::buildTelemetryPayload` создает полезные данные телеметрии JSON, используя данные из датчиков устройства.

- Функция `TelemetryController::sendTelemetryPayload` вызовы `sendTelemetry` в **AzureIOTClient.cpp** для отправки в полезных данных JSON в центр Интернета вещей Azure IoT Central используются приложением.

Чтобы увидеть, каким образом значения свойств передаются в приложение Azure IoT Central, откройте **telemetry.cpp** файл `src` папку:

- Функция `TelemetryController::loop` отправляет **расположение** сообщаемое свойство примерно каждые 30 секунд. Она использует `sendReportedProperty` работать в **AzureIOTClient.cpp** исходный файл.

- Функция `TelemetryController::loop` отправляет **dieNumber** сообщаемое свойство, когда устройства акселерометр обнаруживает двойного касания. Она использует `sendReportedProperty` работать в **AzureIOTClient.cpp** исходный файл.

Чтобы увидеть, как устройство отвечает на команды, вызывается из приложения центра Интернета вещей, откройте **registeredMethodHandlers.cpp** файл `src` папку:

- **DmEcho** функция является обработчиком для **echo** команды. Он показывает **displayedValue** зарегистрирована в полезных данных на экране устройства.

- **DmCountdown** функция является обработчиком для **обратного отсчета** команды. Он изменяет цвет Индикатора устройства и использует переданное свойство для обратной отправки значение обратного отсчета приложения центра Интернета вещей. Сообщаемое свойство имеет имя, совпадающее с именем команды. Эта функция использует `sendReportedProperty` работать в **AzureIOTClient.cpp** исходный файл.

Код в **AzureIOTClient.cpp** исходном файле используются функции из [пакетов SDK Интернета вещей Microsoft Azure и библиотек для C](https://github.com/Azure/azure-iot-sdk-c) для взаимодействия с центром Интернета вещей.

Сведения о способах изменения, создания и отправки примера кода на устройство, см. в файле **readme.md** в папке `MXCHIP/mxchip_advanced`.

## <a name="mxchip-device-template-details"></a>Сведения о шаблоне устройства MXChip

Приложение, созданное из шаблона приложения примера Devkits, включает в себя шаблон устройства MXChip со следующими характеристиками:

### <a name="measurements"></a>Измерения

#### <a name="telemetry"></a>Телеметрия

| Имя поля     | Единицы  | Минимум | Максимум | Число десятичных знаков |
| -------------- | ------ | ------- | ------- | -------------- |
| Влажность       | %      | 0       | 100     | 0              |
| temp           | °C     | –40     | 120     | 0              |
| pressure       | гПа    | 260     | 1260    | 0              |
| magnetometerX  | мГс | –1000   | 1000    | 0              |
| magnetometerY  | мГс | –1000   | 1000    | 0              |
| magnetometerZ  | мГс | –1000   | 1000    | 0              |
| accelerometerX | mg     | –2000   | 2000    | 0              |
| accelerometerY | mg     | –2000   | 2000    | 0              |
| accelerometerZ | mg     | –2000   | 2000    | 0              |
| gyroscopeX     | милиградусов/с   | –2000   | 2000    | 0              |
| gyroscopeY     | милиградусов/с   | –2000   | 2000    | 0              |
| gyroscopeZ     | милиградусов/с   | –2000   | 2000    | 0              |

#### <a name="states"></a>Состояния 
| ИМЯ          | Отображаемое имя   | ОБЫЧНЫЙ РЕЖИМ | ВНИМАНИЕ! | ОПАСНОСТЬ! | 
| ------------- | -------------- | ------ | ------- | ------ | 
| DeviceState   | Состояние устройства   | Зеленый  | Оранжевый  | Красный    | 

#### <a name="events"></a>События 
| ИМЯ             | Отображаемое имя      | 
| ---------------- | ----------------- | 
| ButtonBPressed   | Нажата кнопка B  | 

### <a name="settings"></a>Параметры

Числовые параметры

| Отображаемое имя | Имя поля | Единицы | Число десятичных знаков | Минимум | Максимум | Исходный |
| ------------ | ---------- | ----- | -------------- | ------- | ------- | ------- |
| Напряжение      | setVoltage | В | 0              | 0       | 240     | 0       |
| Текущий      | setCurrent | Амперы  | 0              | 0       | 100     | 0       |
| Скорость вращения вентилятора    | fanSpeed   | Об/мин   | 0              | 0       | 1000    | 0       |

Параметры переключения

| Отображаемое имя | Имя поля | Включение текста | Отключение текста | Исходный |
| ------------ | ---------- | ------- | -------- | ------- |
| IR           | activateIR | ВКЛ.      | ВЫКЛ.      | Выключено     |

### <a name="properties"></a>properties

| type            | Отображаемое имя | Имя поля | Тип данных |
| --------------- | ------------ | ---------- | --------- |
| Свойство устройства | Серийный номер   | dieNumber  | номер    |
| Свойство устройства | Расположение устройства   | location  | location    |
| Text            | Произведено в     | manufacturedIn   | Н/Д       |

### <a name="commands"></a>Команды

| Отображаемое имя | Имя поля | Тип возвращаемого значения | Отображаемое имя поля ввода | Имя поля ввода | Тип поля ввода |
| ------------ | ---------- | ----------- | ------------------------ | ---------------- | ---------------- |
| echo         | echo (вывод на экран)       | Text        | отображаемое значение         | displayedValue   | Text             |
| обратный отсчет    | Обратный отсчет  | номер      | Отсчет от               | countFrom        | номер           |

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы узнали, как для подключения устройства Raspberry Pi к Azure IoT Central приложения, мы предлагаем — Узнайте, как [настроить шаблон пользовательского устройства](howto-set-up-template.md) для устройства Интернета вещей.
