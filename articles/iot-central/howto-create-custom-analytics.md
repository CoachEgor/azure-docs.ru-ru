---
title: Расширение центра Интернета вещей Azure с пользовательским аналитическим | Документация Майкрософт
description: Разработчикам решений настройте приложения IoT Central пользовательских аналитику и визуализации. Это решение использует Azure Databricks.
author: dominicbetts
ms.author: dobett
ms.date: 05/21/2019
ms.topic: conceptual
ms.service: iot-central
services: iot-central
ms.custom: mvc
manager: philmea
ms.openlocfilehash: e039e2b8d9c183b5bfee1bee47e4addc4c873bf7
ms.sourcegitcommit: 7042ec27b18f69db9331b3bf3b9296a9cd0c0402
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/06/2019
ms.locfileid: "66743445"
---
# <a name="extend-azure-iot-central-with-custom-analytics"></a>Расширение центра Интернета вещей Azure с пользовательским аналитическим

В этом практическом руководстве показано, как разработчик решения, как можно расширить ваше приложение центра Интернета вещей с помощью пользовательских аналитики и визуализации. В примере используется [Azure Databricks](https://docs.microsoft.com/azure/azure-databricks/) рабочей области, чтобы анализировать поток данных телеметрии IoT Central и для создания визуализации, например [поле графики](https://wikipedia.org/wiki/Box_plot).

В этом практическом руководстве показано, как выходит за его уже действия с IoT Central [встроенного средства](howto-create-analytics.md).

В этом практическом руководстве вы узнаете, как:

* Данные телеметрии из приложения IoT Central с помощью Stream *непрерывный Экспорт данных*.
* Создание среды Azure Databricks для анализа и отображения данных телеметрии устройства.

## <a name="prerequisites"></a>Технические условия

Чтобы выполнить действия, описанные в этом руководстве, вам потребуется активная подписка Azure.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

### <a name="iot-central-application"></a>Приложения центра Интернета вещей

Создайте приложение IoT Central из [Azure IoT Central — Мои приложения](https://aka.ms/iotcentral) страницы со следующими параметрами:

| Параметр | Value |
| ------- | ----- |
| План оплаты | Оплата по мере использования |
| Шаблон приложения | Sample Contoso (Образец Contoso) |
| имя приложения; | Примите имя по умолчанию или выберите другое имя |
| URL-адрес | Примите имя по умолчанию или выберите собственный уникальный префикс URL-адреса |
| Каталог | Клиент Azure Active Directory |
| Подписка Azure. | Ваша подписка Azure. |
| Регион | Восточная часть США |

Примеры и снимки экрана в этой статье используется **восточной части США** регион. Выберите расположение рядом с вами и убедитесь, что вы создаете все ресурсы в одном регионе.

### <a name="resource-group"></a>Группа ресурсов

Используйте [портал Azure, чтобы создать группу ресурсов](https://portal.azure.com/#create/Microsoft.ResourceGroup) вызывается **IoTCentralAnalysis** должен содержать другие ресурсы, создании. Создание ресурсов Azure в том же расположении, что приложения IoT Central.

### <a name="event-hubs-namespace"></a>пространство имен Центров событий;

Используйте [портал Azure, чтобы создать пространство имен концентраторов событий](https://portal.azure.com/#create/Microsoft.EventHub) со следующими параметрами:

| Параметр | Значение |
| ------- | ----- |
| Name    | Выберите имя пространства имен |
| Ценовая категория | базовая; |
| Подписка | Ваша подписка |
| Группа ресурсов | IoTCentralAnalysis |
| Расположение | Восточная часть США |
| Единицы пропускной способности | 1 |

### <a name="azure-databricks-workspace"></a>Рабочая область Azure Databricks

Используйте [порталу Azure для создания службы Azure Databricks](https://portal.azure.com/#create/Microsoft.Databricks) со следующими параметрами:

| Параметр | Value |
| ------- | ----- |
| имя рабочей области.    | Выберите имя рабочей области |
| Подписка | Ваша подписка |
| Группа ресурсов | IoTCentralAnalysis |
| Расположение | Восточная часть США |
| Ценовая категория | Стандартная |

Если вы создали необходимые ресурсы вашей **IoTCentralAnalysis** группы ресурсов выглядит примерно так:

![Группа ресурсов analysis IoT Central](media/howto-create-custom-analytics/resource-group.png)

## <a name="create-an-event-hub"></a>Создание концентратора событий

Можно настроить приложения IoT Central непрерывный Экспорт данных телеметрии в концентратор событий. В этом разделе создайте концентратор событий для получения данных телеметрии из приложения IoT Central. Концентратор событий обеспечивает данные телеметрии к заданию Stream Analytics для обработки.

1. На портале Azure, перейдите к пространству имен концентраторов событий и выберите **+ концентратор событий**.
1. Имя концентратора событий **centralexport**и выберите **создать**.
1. В списке концентраторов событий в пространстве имен, выберите **centralexport**. Затем выберите **политики общего доступа**.
1. Выберите **+ добавить**. Создайте политику с именем **прослушивания** с **прослушивания** утверждения.
1. Когда политика будет готово, выберите его в списке и скопируйте **строка подключения — первичный ключ** значение.
1. Запомните или запишите эту строку подключения, он понадобится позже при настройке записной книжки Databricks для чтения из концентратора событий.

Пространству имен концентраторов событий выглядит примерно так:

![пространство имен Центров событий;](media/howto-create-custom-analytics/event-hubs-namespace.png)

## <a name="configure-export-in-iot-central"></a>Настроить экспорт в IoT Central

Перейдите к [приложения центра Интернета вещей](https://aka.ms/iotcentral) создан из шаблона Contoso. В этом разделе описано настройте приложение для потоковой передачи данных телеметрии в концентратор событий из его виртуальных устройств. Настройка экспорта:

1. Перейдите к **непрерывного экспорта данных** выберите **+ создать**, а затем **концентраторов событий**.
1. Используйте следующие параметры для настройки экспорта, а затем выберите **Сохранить**:

    | Параметр | Value |
    | ------- | ----- |
    | Название | Экспорт в концентраторы событий |
    | Enabled | С |
    | пространство имен Центров событий; | Имя пространства имен концентраторов событий |
    | концентратор событий; | centralexport |
    | Измерения | С |
    | Устройства | Отключить |
    | Шаблоны устройств | Отключить |

![Экспорт непрерывных данных конфигурации](media/howto-create-custom-analytics/cde-configuration.png)

Подождите, пока состояние экспорта **под управлением** перед продолжением.

## <a name="configure-databricks-workspace"></a>Настройка рабочей области Databricks

На портале Azure перейдите к службе Azure Databricks, а затем выберите **запуска рабочей области**. Новую вкладку в браузере откроется и выполняет вход в рабочей области.

### <a name="create-a-cluster"></a>Создание кластера

На **Azure Databricks** страницы, в списке общих задач, выберите **новый кластер**.

Чтобы создать кластер, используйте сведения в следующей таблице:

| Параметр | Value |
| ------- | ----- |
| Имя кластера, | centralanalysis |
| Режим кластера | Стандартная |
| Версия среды выполнения Databricks | 5.3 (Scala 2.11, Spark версии 2.4.0) |
| Версия Python | 3 |
| Включение автомасштабирования | Нет |
| Завершают работу после бездействия в минутах | 30 |
| Тип рабочего элемента | Standard_DS3_v2 |
| Рабочие роли | 1 |
| Тип драйвера | Так же, как рабочей роли |

Создание кластера может занять несколько минут, дождитесь завершения, прежде чем продолжить создание кластера.

### <a name="install-libraries"></a>Установка библиотек

На **кластеров** странице, подождите, пока состояние кластера **под управлением**.

Ниже показано, как импортировать библиотеки, ваш пример должен быть в кластере:

1. На **кластеров** странице, подождите, пока состояние **centralanalysis** интерактивного кластера является **под управлением**.

1. Выберите кластер, а затем выберите **библиотеки** вкладки.

1. На **библиотеки** вкладке, выберите **Установка новых**.

1. На **установить библиотеку** выберите **Maven** как источник библиотеки.

1. В **координирует** текстовом поле введите следующее значение: `com.microsoft.azure:azure-eventhubs-spark_2.11:2.3.10`

1. Выберите **установить** Чтобы установить библиотеку в кластере.

1. Теперь находится в состоянии библиотеки **установленные**:

    ![Установленная библиотека](media/howto-create-custom-analytics/cluster-libraries.png)

### <a name="import-a-databricks-notebook"></a>Импорт записной книжки Databricks

Следуйте инструкциям ниже, чтобы импортировать записную книжку Databricks, который содержит код Python для анализа и визуализации данных телеметрии IoT Central:

1. Перейдите к **рабочей области** страницы в вашей среде Databricks. Щелкните раскрывающийся список рядом с именем учетной записи, а затем выберите **импорта**.

1. Выберите импортировать с URL-адрес и введите следующий адрес: [https://github.com/Azure-Samples/iot-central-docs-samples/blob/master/databricks/IoT%20Central%20Analysis.dbc?raw=true](https://github.com/Azure-Samples/iot-central-docs-samples/blob/master/databricks/IoT%20Central%20Analysis.dbc?raw=true)

1. Чтобы импортировать записную книжку, выберите **импорта**.

1. Выберите **рабочей области** для просмотра импортированного записную книжку:

    ![Импортированные записной книжки](media/howto-create-custom-analytics/import-notebook.png)

1. Измените код в первой ячейке Python для добавления строки подключения концентраторов событий, сохраненный ранее:

    ```python
    from pyspark.sql.functions import *
    from pyspark.sql.types import *

    ###### Event Hub Connection strings ######
    telementryEventHubConfig = {
      'eventhubs.connectionString' : '{your Event Hubs connection string}'
    }
    ```

## <a name="run-analysis"></a>Запуск анализа

Для выполнения анализа, необходимо присоединить записную книжку к кластеру:

1. Выберите **Detached** , а затем выберите **centralanalysis** кластера.
1. Если кластер не запущен, запустите ее.
1. Чтобы запустить записную книжку, выберите кнопку выполнения.

Может появиться ошибка в последнюю ячейку. Если Да, проверка работы предыдущего ячеек, подождите минуту каких-либо данных, записываемых в хранилище и затем снова запустите последнюю ячейку.

### <a name="view-smoothed-data"></a>Представление области данных

В записной книжке прокрутите вниз до ячейки 14, чтобы увидеть график скользящее среднее влажности по типу устройства. Этот график постоянно обновляется при поступлении потоковой передачи данных телеметрии:

![Сглаженный график телеметрии](media/howto-create-custom-analytics/telemetry-plot.png)

Можно изменить размер диаграммы в записной книжке.

### <a name="view-box-plots"></a>Представление блочных диаграмм

В записной книжке, прокрутите вниз до 20, чтобы увидеть ячейки [поле графики](https://en.wikipedia.org/wiki/Box_plot). Блочных диаграмм основаны на статические данные, поэтому для их обновления необходимо повторно ячейки:

![Блочные диаграммы](media/howto-create-custom-analytics/box-plots.png)

Вы можете изменить размер диаграмм в записной книжке.

## <a name="tidy-up"></a>Удаление ненужных элементов

Чтобы освободить после этого практического руководства и избежать ненужных затрат, удалите **IoTCentralAnalysis** группу ресурсов на портале Azure.

Для удаления приложения IoT Central из **управления** страницы в приложении.

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы узнали следующее:

* Данные телеметрии из приложения IoT Central с помощью Stream *непрерывный Экспорт данных*.
* Создание среды Azure Databricks для анализа и отображения данных телеметрии.

Теперь, когда вы знаете, как создать пользовательский analytics, мы предлагаем — Узнайте, как [визуализировать и анализировать данные центра Интернета вещей Azure на панели мониторинга Power BI](howto-connect-powerbi.md).
