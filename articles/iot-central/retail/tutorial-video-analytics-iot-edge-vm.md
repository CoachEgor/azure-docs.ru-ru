---
title: Руководство. Создание экземпляра видеоаналитики IoT Edge в Azure IoT Central (виртуальная машина Linux)
description: В этом учебнике показано, как создать экземпляр видеоаналитики IoT Edge на виртуальных машинах Linux для использования с шаблоном приложения видеоаналитики для распознавания объектов и движения.
services: iot-central
ms.service: iot-central
ms.subservice: iot-central-retail
ms.topic: tutorial
ms.author: nandab
author: KishorIoT
ms.date: 07/31/2020
ms.openlocfilehash: 23173432db9364f25901e6e9b285d390c6a63a34
ms.sourcegitcommit: 0dcafc8436a0fe3ba12cb82384d6b69c9a6b9536
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2020
ms.locfileid: "94426551"
---
# <a name="tutorial-create-an-iot-edge-instance-for-video-analytics-linux-vm"></a>Руководство по созданию экземпляра IoT Edge для видеоаналитики (виртуальная машина Linux)

Azure IoT Edge — это полностью управляемая служба, которая предоставляет облачную аналитику в локальной среде, развертывая и запуская следующие возможности:

* пользовательская логика;
* Службы Azure
* Искусственный интеллект

В IoT Edge эти службы выполняются непосредственно на кросс-платформенных устройствах Интернета вещей, позволяя вам безопасно выполнять решения Интернета вещей в большом масштабе как в облаке, так и локально.

В этом руководстве показано, как подготовить устройство IoT Edge на виртуальной машине Azure. Экземпляр IoT Edge выполняет модули динамической видеоаналитики, которые используются шаблоном приложения видеоаналитики для распознавания объектов и движения.

В этом руководстве описано следующее:
> [!div class="checklist"]
> * создание виртуальной машины Azure с установленной средой выполнения Azure IoT Edge;
> * подготовка установки IoT Edge для размещения модуля динамической видеоаналитики и подключения к IoT Central.

## <a name="prerequisites"></a>Предварительные требования

Прежде чем начать работу, необходимо выполнить инструкции из статей [Руководство. Создание приложения видеоаналитики для распознавания объектов и движения в Azure IoT Central (YOLO v3)](./tutorial-video-analytics-create-app-yolo-v3.md) и [Руководство. Создание приложения видеоаналитики для распознавания объектов и движения в Azure IoT Central (OpenVINO&trade;)](tutorial-video-analytics-create-app-openvino.md).

Вам также понадобится подписка Azure. Если у вас еще нет подписки, создайте ее бесплатно на [странице регистрации в Azure](https://aka.ms/createazuresubscription).

## <a name="deploy-azure-iot-edge"></a>Развертывание Azure IoT Edge

Чтобы создать виртуальную машину Azure с установленными средой выполнения IoT Edge последней версии и модулями динамической видеоаналитики, нажмите следующую кнопку:

[![Кнопка "Развернуть в Azure" для iotedge-vm-deploy](https://aka.ms/deploytoazurebutton)](https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2Flive-video-analytics%2Fmaster%2Fref-apps%2Flva-edge-iot-central-gateway%2Fvm_deploy%2FedgeModuleVMDeploy.json)

Используйте собранные в следующей таблице сведения, чтобы заполнить форму **Custom deployment** (Настраиваемое развертывание):

| Поле | Значение |
| ----- | ----- |
| Подписка | Выберите подписку Azure. |
| Группа ресурсов | *lva-rg* — группа ресурсов, которую вы создали при работе с предыдущим руководством. |
| Регион       | *Восточная часть США* |
| Префикс метки DNS | Выберите для виртуальной машины уникальный префикс DNS. |
| Имя входа администратора | *AzureUser* |
| Пароль администратора | Введите пароль. Запишите пароль в файле *scratchpad.txt*, он понадобится вам позже. |
| Идентификатор области | Это **идентификатор области**, который вы сохранили в файле *scratchpad.txt*, добавляя устройство шлюза при работе с предыдущим руководством. |
| Идентификатор устройства | *gateway-001* — устройство шлюза, которое вы создали при работе с предыдущим учебником. |
| Ключ устройства | Первичный ключ устройства, который вы сохранили в файл *scratchpad.txt*, добавляя устройство шлюза при работе с предыдущим руководством. |
| Узел приложений IoT Central | Это **URL-адрес приложения**, который вы записали в файл *scratchpad.txt* при работе с предыдущим руководством. Например, *traders.azureiotcentral.com*. |
| Маркер API приложения IoT Central | Маркер API оператора, который вы сохранили при работе с предыдущим руководством. |
| Ключ подготовки устройства IoT Central | Маркер подписанного URL-адреса основной группы, который вы сохранили в файле *scratchpad.txt* при работе с предыдущим руководством. |
| Размер виртуальной машины | *Standard_DS1_v2* |
| Версия ОС Ubuntu | *18.04-LTS* |
| Расположение | *[resourceGroup().location]* |

Выберите **Проверить и создать**. После завершения проверки щелкните **Создать**. Для завершения развертывания обычно требуется около трех минут. После завершения развертывания перейдите к группе ресурсов **lva-rg** на портале Azure.

## <a name="ensure-the-iot-edge-runtime-loads-the-modules"></a>Убедитесь, что среда выполнения IoT Edge загружает модули.

На портале Azure перейдите к группе ресурсов **lva-rg** и выберите виртуальную машину. Затем в разделе **Поддержка и устранение неполадок** щелкните **Серийная консоль**.

Нажмите кнопку **ВВОД**, чтобы получить приглашение `login:`. Введите *AzureUser* в качестве имени пользователя и введите пароль, который вы указали при создании виртуальной машины.

Выполните следующую команду, чтобы проверить версию среды выполнения IoT Edge. На момент написания статьи это версия 1.0.9.

```bash
sudo iotedge --version
```

Получите список модулей IoT Edge с помощью следующей команды.

```bash
sudo iotedge list
```

Развертывание настраивает запуск следующих пяти модулей IoT Edge:

* LvaEdgeGatewayModule;
* edgeAgent;
* edgeHub;
* lvaEdge;
* lvaYolov3.

Развертывание создает пользовательскую среду IoT Edge с необходимыми модулями для динамической видеоаналитики. Развертывание обновляет стандартный файл **config.yaml**, чтобы среда выполнения IoT Edge использовала для подключения к IoT Central службу подготовки устройств IoT. Также развертывание создает файл с именем **state.json** в папке **/data/storage**, который используется для предоставления модулям дополнительных данных конфигурации. Дополнительные сведения см. в статье [Руководство. Создание экземпляра IoT Edge для видеоаналитики (Intel NUC)](./tutorial-video-analytics-iot-edge-nuc.md).

См. статью [Устранение неполадок с устройством IoT Edge](../../iot-edge/troubleshoot.md).

## <a name="use-the-rtsp-simulator"></a>Использование симулятора RTSP

Если у вас нет устройств с настоящей камерой, которые можно подключить к устройству IoT Edge, вы можете использовать два имитированных устройства камеры, которые определены в шаблоне приложения видеоаналитики. В этом разделе показано, как использовать имитированный поток видео на устройстве IoT Edge.

В этих инструкциях в качестве симулятора RTSP используется [Live555 Media Server](http://www.live555.com/mediaServer/) в контейнере Docker.

> [!NOTE]
> Ссылки на программы сторонних разработчиков в этом репозитории приводятся только для информирования и удобства. Корпорация Майкрософт не предоставляет права на ПО сторонних поставщиков или рекомендации по его использованию. См. сведения о [Live555 Media Server](http://www.live555.com/mediaServer/).

Используйте следующую команду, чтобы запустить служебную программу **rtspvideo** в контейнере Docker на виртуальной машине IoT Edge. Этот контейнер Docker создает фоновый поток RTSP.

```bash
sudo docker run -d --name live555 --rm -p 554:554 mcr.microsoft.com/lva-utilities/rtspsim-live555:1.2
```

Чтобы получить список контейнеров Docker, выполните следующую команду:

```bash
sudo docker ps
```

В этот список включается контейнер с именем **live555**.

## <a name="next-steps"></a>Дальнейшие действия

Итак, вы развернули среду выполнения IoT Edge, модули LVA и имитированный поток Live555 на виртуальной машине Linux, работающей в Azure.

Чтобы управлять камерами, воспользуйтесь указаниями из следующего руководства:

> [!div class="nextstepaction"]
> [Мониторинг и администрирование приложения видеоаналитики для распознавания объектов и движения](./tutorial-video-analytics-manage.md)