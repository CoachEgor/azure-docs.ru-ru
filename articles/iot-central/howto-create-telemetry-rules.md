---
title: Создание правил телеметрии и управление ими в приложении Azure IoT Central | Документация Майкрософт
description: Правила телеметрии Azure IoT Central позволяют отслеживать устройства практически в реальном времени и автоматически вызывать действия (например, отправлять сообщение электронной почты) при срабатывании правила.
author: ankitgupta
ms.author: ankitgup
ms.date: 06/09/2019
ms.topic: conceptual
ms.service: iot-central
services: iot-central
manager: peterpr
ms.openlocfilehash: 3ac8e488de11abc3471df836ca852cf3dc85c82f
ms.sourcegitcommit: b3bad696c2b776d018d9f06b6e27bffaa3c0d9c3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2019
ms.locfileid: "69877350"
---
# <a name="create-a-telemetry-rule-and-set-up-notifications-in-your-azure-iot-central-application"></a>Создание правила телеметрии и настройка уведомлений в приложении Azure IoT Central

*Эта статья предназначена для операторов, разработчиков и администраторов.*

[!INCLUDE [iot-central-original-pnp](../../includes/iot-central-original-pnp-note.md)]

Вы можете использовать Azure IoT Central для удаленного мониторинга подключенных устройств. Правила Azure IoT Central позволяют вам отслеживать устройства практически в реальном времени и автоматически вызывать действия, например, отправлять сообщение электронной почты или активировать Microsoft Flow. Всего в несколько щелчков вы можете определить условие для отслеживания данных устройства и настроить соответствующее действие. В этой статье объясняется, как создать правила для отслеживания телеметрии, отправляемой устройством.

Устройства могут использовать измерение телеметрии для отправки числовых данных с устройства. Правило телеметрии срабатывает, когда данные телеметрии выбранного устройства превышают указанное пороговое значение.

## <a name="create-a-telemetry-rule"></a>Создание правила телеметрии

Чтобы создать правило телеметрии, шаблон устройства должен иметь по крайней мере одно определенное измерение телеметрии. В этом примере используется охлаждаемый торговый автомат, который отправляет данные телеметрии о температуре и влажности. Правило отслеживает передаваемые устройством данные температуры и отправляет сообщение электронной почты, когда температура превышает 80 градусов.

1. На странице **шаблоны устройств** перейдите к шаблону устройства, для которого добавляется правило.

1. Если вы еще не создали правило, появится следующий экран:

    ![Правила отсутствуют](media/howto-create-telemetry-rules/rules_landing_page1.png)

1. На вкладке **правила** выберите **+ создать правило** , чтобы просмотреть типы правил, которые можно создать.

1. Выберите элемент **телеметрии** , чтобы создать правило для отслеживания телеметрии устройства.

    ![Типы правил](media/howto-create-telemetry-rules/rule_types1.png)

1. Введите имя, определяющее правило в этом шаблоне устройства.

1. Чтобы немедленно включить правило для всех устройств, созданных на основе этого шаблона, переведите переключатель **Включить правило** в положение "Вкл." для всех устройств в этом шаблоне.

   ![Сведения о правиле](media/howto-create-telemetry-rules/rule_detail1.png)

    Правило автоматически применяется ко всем устройствам в шаблоне устройств.

### <a name="configure-the-rule-conditions"></a>Настройка условий правила

Условие определяет критерии, которые отслеживаются этим правилом.

1. Выберите **+** рядом с **условием** , чтобы добавить новое условие.

1. Выберите телеметрию, которую нужно отслеживать, в раскрывающемся списке **Измерение**.

1. Затем выберите **Агрегирование**, **Оператор** и введите **пороговое значение**.
   - Агрегирование не является обязательным. Без агрегирования правило запускается для каждой точки данных телеметрии, которая соответствует условию. Например, если правило настроено для активации, когда температура превышает 80, правило срабатывает почти мгновенно, когда устройство сообщает о температуре > 80.
   - Если выбрана такая агрегатная функция, как Average, Min, Max, Count, тогда вам необходимо предоставить **окно времени агрегирования**, в котором необходимо оценить условие. Например, если задать период "5 минут" и правило ищет среднюю температуру выше 80, оно сработает, если средняя температура превышает 80 в течение как минимум 5 минут. Частота оценки правила такая же, как и **период времени агрегирования**. Это означает, что в этом примере правило оценивается один раз каждые 5 минут.

     ![Условие](media/howto-create-telemetry-rules/aggregate_condition_filled_out1.png)

     >[!NOTE]
     >В поле **Условие** можно добавить несколько измерений телеметрии. Если задано несколько условий, для срабатывания правила необходимо, чтобы были соблюдены все условия. Каждое условие неявно присоединяется с использованием предложения AND. При использовании агрегирования каждое измерение должно быть агрегировано.

### <a name="configure-actions"></a>Настройка действий

В этом разделе показано, как настроить действия, предпринимаемые при запуске правила. Действия вызываются в том случае, если соблюдаются все условия, указанные в правиле.

1. Выберите **+** рядом с разделом **Действия**. Здесь отобразится список доступных действий.  

    ![Добавление действия](media/howto-create-telemetry-rules/add_action1.png)

1. Выберите действие **Электронное письмо**, введите допустимый адрес электронной почты в поле **Кому** и укажите примечание, отображаемое в тексте сообщения при срабатывании правила.

    > [!NOTE]
    > Письма отправляются только пользователям, которые были добавлены в приложение и входили в систему минимум один раз. Узнайте больше об [управлении пользователями](howto-administer.md) в Azure IoT Central.

   ![Настройка действия](media/howto-create-telemetry-rules/configure_action1.png)

1. Чтобы сохранить правило, нажмите кнопку **Сохранить**. Правило станет активным в течение нескольких минут и начнет выполнять мониторинг данных телеметрии, отправляемых в приложение. Если указанное в правиле условие соблюдается, правило активирует настроенное действие отправки электронной почты.

Вы можете добавить другие действия в правило, например действия Microsoft Flow и веб-перехватчики. Для каждого правила можно добавить до 5 действий.

- [действие Microsoft Flow](howto-add-microsoft-flow.md) для запуска рабочего процесса в Microsoft Flow при срабатывании правила; 
- [действие веб-перехватчика](howto-create-webhooks.md) для уведомления других служб при срабатывании правила.

## <a name="parameterize-the-rule"></a>Параметризация правила

Для правила можно задать определенные значения **свойств устройства** в качестве параметров. Параметры можно использовать в сценариях, когда пороговые значения телеметрии отличаются для различных устройств. При создании правила выберите свойство устройства, определяющее пороговое значение (например, **Maximum Ideal Threshold** (Максимальное идеальное пороговое значение)), вместо предоставления абсолютного значения (например 80 градусов). Когда правило выполняется, оно сопоставляет данные телеметрии устройства с набором значений, указанным в свойстве устройства.

За счет использования параметров можно уменьшить количество управляемых правил в шаблоне устройства.

Действия также можно настроить, используя **свойство устройства** в качестве параметра. Если адрес электронной почты хранится в виде свойстве, его можно использовать при определении адреса **Кому**.

## <a name="delete-a-rule"></a>Удаление правила

Если вам больше не нужно правило, удалите его. Для этого откройте правило и щелкните **Удалить**. Удаление правила приводит к его удалению из шаблона устройства и всех связанных устройств.

## <a name="enable-or-disable-a-rule-for-a-device-template"></a>Включение или отключение правила для шаблона устройства

Перейдите к устройству и выберите правило, которое требуется включить или отключить. Переведите переключатель **Enable rule for all devices of this template** (Включить правило для всех устройств в шаблоне) в правиле, чтобы включить или отключить правило для всех устройств, связанных с определенным шаблоном.

## <a name="enable-or-disable-a-rule-for-a-device"></a>Включение или отключение правила для устройства

Перейдите к устройству и выберите правило, которое требуется включить или отключить. Переведите переключатель **Enable rule for this device** (Включить правило для этого устройства), чтобы включить или отключить правило для этого устройства.

## <a name="next-steps"></a>Следующие шаги

Вы узнали, как создавать правила в приложении Azure IoT Central, а значит вы готовы к следующему шагу:

- [Добавление действия Microsoft Flow в правилах](howto-add-microsoft-flow.md)
- [Добавление действия веб-перехватчика в правилах](howto-create-webhooks.md)
- [Группирование нескольких действий для запуска из одного или нескольких правил](howto-use-action-groups.md)
- [Управление устройствами](howto-manage-devices.md)
