---
title: Создание правил события и управление ими в приложении Azure IoT Central | Документация Майкрософт
description: Правила события Azure IoT Central позволяют отслеживать устройства практически в реальном времени и автоматически вызывать действия (например, отправлять сообщение электронной почты) при срабатывании правила.
author: dominicbetts
ms.author: dobett
ms.date: 07/23/2019
ms.topic: conceptual
ms.service: iot-central
services: iot-central
manager: peterpr
ms.openlocfilehash: 1a7fc2b38e8354fb29255bb7f9d6b2c03ed53725
ms.sourcegitcommit: b3bad696c2b776d018d9f06b6e27bffaa3c0d9c3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2019
ms.locfileid: "69879959"
---
# <a name="create-an-event-rule-and-set-up-notifications-in-your-azure-iot-central-application-preview-features"></a>Создание правила событий и Настройка уведомлений в приложении IoT Central Azure (Предварительная версия компонентов)

*Эта статья предназначена для операторов, разработчиков и администраторов.*

[!INCLUDE [iot-central-pnp-original](../../includes/iot-central-pnp-original-note.md)]

Вы можете использовать Azure IoT Central для удаленного мониторинга подключенных устройств. Правила IoT Central Azure позволяют отслеживать устройства практически в реальном времени и автоматически вызывать действия, такие как отправка сообщения электронной почты. Всего в несколько щелчков вы можете определить условие для отслеживания данных устройства и настроить соответствующее действие. В этой статье объясняется, как создать правила для отслеживания событий, отправляемых устройством.

Устройства могут использовать измерение событий для отправки важных или информационных событий. Правило события активируется, когда с устройства передается выбранное событие

## <a name="create-an-event-rule"></a>Создание правила события

Чтобы создать правило события, шаблон устройства должен иметь по крайней мере одно определенное измерение события. В этом примере используется устройство охлаждаемого торгового автомата, сообщающее о событии сбоя в работе мотора вентилятора. Правило отслеживает передаваемые устройством данные события и отправляет сообщение при каждой передаче события.

1. Перейдите на страницу **правила** .

1. Если вы еще не создали правило, появится следующий экран:

   ![Правила отсутствуют](media/howto-create-event-rules-pnp/rules-landing-page1.png)

1. Выберите **+ новое правило** , чтобы просмотреть типы правил, которые можно создать.

1. Выберите **событие** , чтобы создать правило мониторинга событий.

   ![Типы правил](media/howto-create-event-rules-pnp/rule-types1.png)

1. Введите имя, которое поможет вам найти правило, и нажмите клавишу ВВОД.

1. Выберите определение устройства для определения области действия этого правила в разделе **области** . На этом экране также можно отфильтровать устройства, к которым применяется правило, с помощью **+ Filter**. Правило автоматически применяется ко всем устройствам в шаблоне устройств. Чтобы отключить правило, нажмите кнопку **Отключить** в заголовке.

### <a name="configure-the-rule-conditions"></a>Настройка условий правила

Условие определяет критерии, которые отслеживаются этим правилом.

1. Выберите, следует ли **устанавливать статистическое выражение** как on или OFF.

   - Без агрегирования правило запускается для каждой точки данных события, которая соответствует условию. Например, если настроить условие правила для запуска при возникновении события «ошибка электропитания **вентилятора** », правило срабатывает почти сразу же после того, как устройство сообщает о событии.
   - Если параметр **Count** используется как агрегатная функция, необходимо предоставить **значение** и **временной интервал** , в течение которого должно быть вычислено условие. В этом случае выполняется статистическое вычисление счетчика событий и правило срабатывает только в том случае, если общее число событий соответствует значению.

1. Выберите событие, которое необходимо отслеживать, из раскрывающегося списка **измерение** . В этом примере выбрано событие **Fan Motor Error** (Ошибка мотора вентилятора).

1. При необходимости можно также задать параметр **Count** как **агрегат** и указать значение, по которому будет срабатывать правило.

     Например, если вы хотите оповещать, когда в течение 5 минут имеется более трех событий устройства, выберите событие и задайте агрегатную функцию как **Count**, operator как **больше**, а **значение** — как 3. Задайте **временное окно** как **5 минут**. Правило срабатывает, когда устройство отправляет более трех событий в течение 5 минут. Частота оценки правила совпадает с **периодом времени**. Это означает, что в этом примере правило вычисляется каждые 5 минут.

 ![Условие](media/howto-create-event-rules-pnp/aggregate-condition-filled-out1.png)

> [!NOTE]
> В поле **Условие** можно добавить несколько измерений события. Если задано несколько условий, для срабатывания правила необходимо, чтобы были соблюдены все условия. Каждое условие присоединяется с помощью предложения "и" неявно. При использовании агрегирования каждое измерение должно быть агрегировано.

### <a name="configure-actions"></a>Настройка действий

В этом разделе показано, как настроить действия, предпринимаемые при запуске правила. Действия вызываются в том случае, если соблюдаются все условия, указанные в правиле.

1. Щелкните **действие +** в разделах **действие** . Здесь отобразится список доступных действий.  

   ![Добавление действия](media/howto-create-event-rules-pnp/add-action1.png)

1. Выберите действие **Электронная почта** , введите отображаемое имя действия, допустимый адрес электронной почты в поле **Кому** и введите Примечание, которое будет отображаться в тексте сообщения электронной почты при срабатывании правила.

   > [!NOTE]
   > Письма отправляются только пользователям, которые были добавлены в приложение и входили в систему минимум один раз. Узнайте больше об [управлении пользователями](howto-administer-pnp.md?toc=/azure/iot-central-pnp/toc.json&bc=/azure/iot-central-pnp/breadcrumb/toc.json) в Azure IoT Central.

   ![Настройка действия](media/howto-create-event-rules-pnp/configure-action1.png)

1. Чтобы сохранить действие, нажмите кнопку **Готово**.

1. Чтобы сохранить правило, нажмите кнопку **Сохранить**. Правило станет активным в течение нескольких минут и начнет выполнять мониторинг событий, отправляемых в приложение. Если указанное в правиле условие соблюдается, правило активирует настроенное действие отправки электронной почты.

## <a name="parameterize-the-rule"></a>Параметризация правила

Для правила можно задать определенные значения **свойств устройства** в качестве параметров. Использование параметров полезно в сценариях, где пороговые значения событий различаются для разных устройств. При создании правила выберите свойство устройства, которое указывает пороговое значение, например **Максимальное идеальное**пороговое значение, вместо указания абсолютного значения, например 3 события. При выполнении правила оно сопоставляет события устройства со значением, заданным в свойстве устройства.

Использование параметров — это эффективный способ сократить количество правил для управления.

Действия также можно настроить, используя **свойство устройства** в качестве параметра. Если адрес электронной почты хранится в виде свойства устройства, его можно использовать при определении адреса **Кому**.

## <a name="delete-a-rule"></a>Удаление правила

Если вам больше не нужно правило, удалите его. Для этого откройте правило и щелкните **Удалить**. Удаление правила приводит к его удалению из шаблона устройства и всех связанных устройств.

## <a name="enable-or-disable-a-rule"></a>Включение или отключение правила

Выберите правило, которое необходимо включить или отключить. Включите или отключите в правиле кнопку **включить** или **Отключить** , чтобы включить или отключить правило для всех устройств, которые находятся в области действия правила.

## <a name="enable-or-disable-a-rule-for-a-device"></a>Включение или отключение правила для устройства

Выберите правило, которое необходимо включить или отключить. Добавьте фильтр в раздел **области** , чтобы включить или исключить определенное устройство в шаблоне устройства.

## <a name="next-steps"></a>Следующие шаги

Теперь, когда вы узнали, как создавать правила в приложении IoT Central Azure, предлагаем следующий шаг — Узнайте, [как управлять устройствами](howto-manage-devices-pnp.md?toc=/azure/iot-central-pnp/toc.json&bc=/azure/iot-central-pnp/breadcrumb/toc.json) .
