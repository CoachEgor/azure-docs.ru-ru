---
title: Учебник. Определение нового типа устройства Azure IoT Edge в Azure IoT Central
description: В этом учебнике показано, как сборщики могут создать устройство Azure IoT Edge в приложении Azure IoT Central. Вы определите данные телеметрии, состояние, свойства и команды для своего типа.
author: rangv
ms.author: rangv
ms.date: 10/22/2019
ms.topic: tutorial
ms.service: iot-central
services: iot-central
ms.custom: mvc
manager: peterpr
ms.openlocfilehash: 97bfd2b1e8b571f44c0b782459567f5677dd36a7
ms.sourcegitcommit: c69c8c5c783db26c19e885f10b94d77ad625d8b4
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/03/2019
ms.locfileid: "74702795"
---
# <a name="tutorial-define-a-new-azure-iot-edge-device-type-in-your-azure-iot-central-application-preview-features"></a>Руководство по определению нового типа устройства Azure IoT Edge в приложении Azure IoT Central (предварительная версия функций)

[!INCLUDE [iot-central-pnp-original](../../../includes/iot-central-pnp-original-note.md)]

В этом учебнике показано, как сборщики могут использовать шаблон устройства для определения нового типа устройства Azure IoT Edge в приложении Azure IoT Central. 

Дополнительные сведения см. в статье [Сведения об Azure IoT Central](overview-iot-central.md). 

IoT Edge состоит из трех компонентов:
* **Модули IoT Edge** — это контейнеры, в которых выполняются службы Azure, партнерские службы или ваш собственный код. Модули развертываются на устройства IoT Edge и выполняются на них локально.
* **Среда выполнения IoT Edge** запускается на каждом устройстве IoT Edge и позволяет управлять модулями, развернутыми на каждом устройстве.
* С помощью **облачного интерфейса** вы можете осуществлять мониторинг устройств IoT Edge и управлять ими удаленно. Роль облачного интерфейса выполняет IoT Central.

Устройство **Azure IoT Edge** может представлять собой устройство шлюза с подчиненными устройствами, подключенными к устройству IoT Edge. В этом учебнике приводятся дополнительные сведения о шаблонах подключения подчиненных устройств.

**Шаблон устройства** определяет возможности устройства и модулей IoT Edge. К возможностям относятся отправляемые модулем данные телеметрии, свойства этого модуля и команды, на которые он реагирует.

В рамках этого учебника вы создадите шаблон устройства датчика среды. Устройство датчика среды выполняет следующие функции:

* отправляет данные телеметрии, например температуру;
* реагирует на доступные к записи свойства при обновлении в облаке, например интервал отправки телеметрии;
* реагирует на такие команды, как сброс температуры.

В рамках этого учебника вы также создадите шаблон устройства шлюза среды. Устройство шлюза среды:

* отправляет данные телеметрии, например температуру;
* реагирует на доступные к записи свойства при обновлении в облаке, например интервал отправки телеметрии;
* реагирует на такие команды, как сброс температуры;
* разрешает связи с другими моделями возможностей устройства.


Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * создание шаблона устройства Azure IoT Edge;
> * отправка манифеста развертывания;
> * создание возможностей, включая телеметрию, свойства и команды для каждого модуля;
> * определение визуализации для телеметрии модуля;
> * добавление связей к шаблонам подчиненных устройств;
> * публикация шаблона устройства.

## <a name="prerequisites"></a>Предварительные требования

Для работы с этим учебником вам потребуется [создать приложение Azure IoT Central](quick-deploy-iot-central.md).


## <a name="downstream-device-relationships-with-a-gateway-and-modules"></a>Связи подчиненных устройств со шлюзом и модулями

Подчиненные устройства могут подключаться к устройству шлюза IoT Edge через модуль `$edgeHub`. В этом сценарии это устройство IoT Edge становится прозрачным шлюзом.

![Схема прозрачного шлюза](./media/tutorial-define-edge-device-type/gateway-transparent.png)

Подчиненные устройства также могут подключаться к устройству шлюза IoT Edge через настраиваемый модуль. В следующем сценарии подчиненные устройства подключаются через настраиваемый модуль Modbus.

![Схема подключения настраиваемого модуля](./media/tutorial-define-edge-device-type/gateway-module.png)

На следующей схеме показано подключение к устройству шлюза IoT Edge через модули обоих типов (настраиваемый и `$edgeHub`).  

![Схема подключения с помощью обоих модулей подключения](./media/tutorial-define-edge-device-type/gateway-module-transparent.png)

Наконец, подчиненные устройства могут подключаться к устройству шлюза IoT Edge через несколько настраиваемых модулей. На следующей схеме показаны подчиненные устройства, подключающиеся через настраиваемый модуль Modbus, настраиваемый модуль BLE и модуль `$edgeHub`. 

![Схема подключения с помощью нескольких настраиваемых модулей](./media/tutorial-define-edge-device-type/gateway-module2-transparent.png)


## <a name="create-a-template"></a>Создание шаблона

Вы (как разработчик) можете создавать и редактировать шаблоны устройств IoT Edge в своем приложении. После публикации шаблона устройства вы можете подключить реальные устройства, реализующие этот шаблон устройства.

### <a name="select-device-template-type"></a>Выбор типа шаблона устройства 

Чтобы добавить в приложение новый шаблон устройства, выберите **Шаблоны устройств** в левой области.

![Снимок экрана: страница "Предварительная версия приложения" с выделенным пунктом "Шаблоны устройств"](./media/tutorial-define-edge-device-type/edgedevicetemplate.png)

Выберите **+ Создать**, чтобы создать шаблон устройства.

![Снимок экрана: страница "Шаблоны устройств" с выделенным элементом "Создать"](./media/tutorial-define-edge-device-type/edgedevicetemplatenew.png)

На странице **Выбрать тип шаблона** выберите **Azure IoT Edge** и нажмите **Далее: Настройка**.

![Снимок экрана: страница "Выбрать тип шаблона"](./media/tutorial-define-edge-device-type/selectiotedge.png)

### <a name="customize-device-template"></a>Настройка шаблона устройства

В IoT Edge можно развертывать модули бизнес-логики и управлять этими модулями. Модуль IoT Edge представляет собой наименьшую единицу вычислительных ресурсов, которыми управляет IoT Edge. Эти модули могут содержать службы Azure (например, Azure Stream Analytics) или пользовательский код для конкретного решения. Чтобы понять, как модули разрабатываются, развертываются и обслуживаются, ознакомьтесь со статьей [Understand Azure IoT Edge modules](../../iot-edge/iot-edge-modules.md) (Общие сведения о модулях Azure IoT Edge).

В общих чертах манифест развертывания представляет собой список двойников модулей, для которых настроены требуемые свойства. Манифест развертывания сообщает устройству IoT Edge (или группе устройств), какие модули нужно установить и как их нужно настроить. Манифесты развертывания содержат требуемые свойства для каждого двойника модуля. Устройства IoT Edge передают сообщаемые свойства от каждого модуля.

Используйте Visual Studio Code для создания манифеста развертывания. Дополнительные ведения об Azure IoT Edge для Visual Studio Code см. [здесь](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-edge).

Вот пример простого манифеста развертывания с одним модулем, который будет использоваться в этом учебнике. Скопируйте следующий код JSON и сохраните его в формате JSON-файла. 

   ```JSON
   {
     "modulesContent": {
       "$edgeAgent": {
         "properties.desired": {
           "schemaVersion": "1.0",
           "runtime": {
             "type": "docker",
             "settings": {
               "minDockerVersion": "v1.25",
               "loggingOptions": "",
               "registryCredentials": {}
             }
           },
           "systemModules": {
             "edgeAgent": {
               "type": "docker",
               "settings": {
                 "image": "mcr.microsoft.com/azureiotedge-agent:1.0",
                 "createOptions": "{}"
               }
             },
             "edgeHub": {
               "type": "docker",
               "status": "running",
               "restartPolicy": "always",
               "settings": {
                 "image": "mcr.microsoft.com/azureiotedge-hub:1.0",
                 "createOptions": "{}"
               }
             }
           },
           "modules": {
             "SimulatedTemperatureSensor": {
               "version": "1.0",
               "type": "docker",
               "status": "running",
               "restartPolicy": "always",
               "settings": {
                 "image": "mcr.microsoft.com/azureiotedge-simulated-temperature-sensor:1.0",
                 "createOptions": "{}"
               }
             }
           }
         }
       },
       "$edgeHub": {
         "properties.desired": {
           "schemaVersion": "1.0",
           "routes": {
               "route": "FROM /* INTO $upstream"
           },
           "storeAndForwardConfiguration": {
             "timeToLiveSecs": 7200
           }
         }
       },
       "SimulatedTemperatureSensor": {
         "properties.desired": {
              "SendData": true,
              "SendInterval": 10
         }
       }
     }
   }
   ```

#### <a name="upload-an-iot-edge-deployment-manifest"></a>Отправка манифеста развертывания IoT Edge

На странице **Customize device** (Настройка устройства) в разделе **Upload an Azure IoT Edge deployment manifest** (Отправка манифеста развертывания Azure IoT Edge) выберите **Обзор**. 

![Снимок экрана: страница настройки устройства с выделенным пунктом "Обзор"](./media/tutorial-define-edge-device-type/edgedevicetemplateuploadmanifest.png)

Если вы планируете создать шаблон устройства шлюза IoT Edge, установите флажок **Gateway device with downstream devices** (Устройство шлюза с подчиненными устройствами).

![Снимок экрана: страница настройки устройства с выделенным элементом Gateway device with downstream devices (Устройство шлюза с подчиненными устройствами)](./media/tutorial-define-edge-device-type/gateway-upload.png)

В диалоговом окне выбора файла выберите файл манифеста развертывания и щелкните **Открыть**.

IoT Edge проверяет файл манифеста развертывания на соответствие схеме. Если проверка выполнена успешно, выберите **Проверка**.

![Снимок экрана: страница настройки устройства с выделенными элементами "Манифест развертывания" и "Проверка"](./media/tutorial-define-edge-device-type/deploymentmanifestvalidate.png)

На следующей блок-схеме приведен жизненный цикл манифеста развертывания в IoT Central.

![Блок-схема жизненного цикла манифеста развертывания](./media/tutorial-define-edge-device-type/dmflow.png)

После этого отобразится страница просмотра со сведениями о манифесте развертывания. На этой странице отображается список модулей из манифеста развертывания. Обратите внимание, что в этом учебнике указан модуль `SimulatedTemperatureSensor`. Нажмите кнопку **Создать**.

![Снимок экрана: страницы "Проверка" с выделенными элементами "Модуль" и "Создать"](./media/tutorial-define-edge-device-type/edgedevicetemplatereview.png)

Если вы выбрали устройство шлюза, отобразится следующая страница проверки.

![Снимок экрана: страница "Проверка" с выделенным элементом "Шлюз Azure IoT Edge"](./media/tutorial-define-edge-device-type/gateway-review.png)


Вы создаете шаблон устройства с моделями возможностей модуля. В этом учебнике вы создаете шаблон устройства с моделью возможностей модуля `SimulatedTemperatureSensor`. 

Измените название шаблона устройства на **Шаблон устройства датчика среды**.

![Снимок экрана: шаблон устройства с выделенным обновленным названием](./media/tutorial-define-edge-device-type/edgedevicetemplatelanding.png)

В устройстве IoT Edge смоделируйте IoT Plug and Play, как показано ниже.
* В каждом шаблоне устройства IoT Edge есть модель возможностей устройства.
* Для каждого настраиваемого модуля, указанного в манифесте развертывания, создается модель возможностей модуля.
* Между каждой моделью возможностей модуля и моделью возможностей устройства устанавливается связь.
* Модель возможностей модуля реализует интерфейсы модуля.
* Каждый интерфейс модуля содержит данные телеметрии, свойства и команды.

![Схема моделирования IoT Edge](./media/tutorial-define-edge-device-type/edgemodelling.png)

#### <a name="add-capabilities-to-a-module-capability-model"></a>Добавление возможностей к модели возможностей модуля

Пример выходных данных из модуля `SimulatedTemperatureSensor`:
```json
{

    "machine": {

        "temperature": 75.0,
        "pressure": 40.2
    },
    "ambient": {
        "temperature": 23.0,
        "humidity": 30.0
    },
    "timeCreated": ""
}
```

В модуль `SimulatedTemperatureSensor` можно добавить возможности, которые будут отражать предыдущие выходные данные. 

1. Чтобы управлять интерфейсом модели возможностей модуля `SimulatedTemperatureSensor`, выберите **Управление** > **Добавить возможность**. 

    ![Снимок экрана: шаблон датчика среды с выделенным элементом "Добавить возможность"](./media/tutorial-define-edge-device-type/edgetemplateaddcapability.png)
  
1. Добавьте компьютер в качестве типа объекта.
  
    ![Снимок экрана: раздел "Возможности" шаблона датчика среды с выделенным элементом "Схема"](./media/tutorial-define-edge-device-type/edgetemplatemachineobject.png)

1. Выберите **Определить**. В появившемся диалоговом окне измените имя объекта на **machine**. Создайте свойства температуры и давления, а затем выберите **Применить**.
  
    ![Снимок экрана: диалоговое окно атрибутов с несколькими выделенными параметрами](./media/tutorial-define-edge-device-type/edgetemplatemachineattributes.png)
  
1. Добавьте **ambient** в качестве типа объекта.

1. Выберите **Определить**. В появившемся диалоговом окне измените имя объекта на **ambient**. Создайте свойства температуры и влажности, а затем выберите **Применить**.
  
    ![Снимок экрана: диалоговое окно атрибутов с несколькими выделенными параметрами](./media/tutorial-define-edge-device-type/edgetemplateambientattributes.png)

  
1. Добавьте `timeCreated` в качестве типа `DateTime` и выберите **Сохранить**.
  
    ![Снимок экрана: шаблон датчика среды с выделенным элементом "Сохранить"](./media/tutorial-define-edge-device-type/edgetemplateallattributes.png)


### <a name="add-relationships"></a>Добавление связей

Если вы выбрали устройство IoT Edge в качестве устройства шлюза, можно добавить подчиненные связи к моделям возможностей устройств для устройств, которые необходимо подключить к устройству шлюза.
  
  ![Снимок экрана: шаблон шлюза среды с выделенным элементом "Добавить связь"](./media/tutorial-define-edge-device-type/gateway-add-relationship.png)

Связь можно добавить на устройстве или в модуле.
  
  ![Снимок экрана: шаблон шлюза среды с выделенными связями на устройстве и в модуле](./media/tutorial-define-edge-device-type/gateway-relationship-types.png)


Вы можете выбрать модель возможностей подчиненного устройства или символ звездочки. 
  
  ![Снимок экрана: шаблон шлюза среды с выделенным элементом "Целевой объект"](./media/tutorial-define-edge-device-type/gateway-downstream-rel.png)

  В рамках этого учебника выберите звездочку. Этот параметр позволяет устанавливать все подчиненные связи. Затем нажмите кнопку **Save** (Сохранить).

  ![Снимок экрана: шаблон шлюза среды с выделенным элементом "Целевой объект"](./media/tutorial-define-edge-device-type/gateway-add-relationship-asterix.png)


### <a name="add-cloud-properties"></a>Добавление свойств облака

Шаблон устройства может содержать свойства облака. Свойства облака существуют только в приложении IoT Central и никогда не отправляются на устройство и не принимаются с него.

1. Выберите **Свойства облака** >  **+ Add Cloud Property** (+ Добавить облачное свойство). Воспользуйтесь сведениями в следующей таблице, чтобы добавить свойство облака в шаблон устройства.

    | Отображаемое имя      | Семантический тип | Схема |
    | ----------------- | ------------- | ------ |
    | Дата последнего обслуживания | Нет          | Дата   |
    | Имя клиента.     | Нет          | Строка, |

2. Щелкните **Сохранить**.

  
    ![Снимок экрана: шаблон датчика среды с выделенным элементом "Сохранить"](./media/tutorial-define-edge-device-type/edgetemplatecloudproperties.png)

### <a name="add-customizations"></a>Добавление настройки

С помощью настроек можно изменить интерфейс или добавить функции IoT Central для возможности, которая не требует создания новой версии модели возможностей устройства. Вы можете изменять поля, когда модель возможностей находится в черновом или опубликованном состоянии. Настраивать можно только те поля, которые не нарушают совместимость интерфейса. Например, вы можете просматривать:

- Настроить отображаемое имя и единицы измерения для возможности.
- Добавить цвет по умолчанию, который используется для значений на диаграмме.
- Указать начальные, минимальные и максимальные значения для свойства.

Вы не сможете изменить имя или тип возможности.

По завершении настройки нажмите кнопку **Сохранить**.
  
![Снимок экрана: страница "Настройка" шаблона датчика среды](./media/tutorial-define-edge-device-type/edgetemplatecustomize.png)


### <a name="create-views"></a>Создание представлений

Вы (как разработчик) можете настроить в приложении отображение для оператора сведений о подключенном датчике среды. Ваши настройки позволят оператору управлять устройствами датчиков среды, подключенными к приложению. Вы можете создать два типа представлений, которые позволят оператору взаимодействовать с устройствами.

* Формы для просмотра и редактирования свойств устройства и облака.
* Панели мониторинга для визуализации устройств.

### <a name="configure-a-view-to-visualize-devices"></a>Настройка представления для визуализации устройств

Панель мониторинга устройства позволяет оператору визуализировать устройство с помощью диаграмм и метрик. Вы (как разработчик) можете определить, какие сведения будут отображаться на панели мониторинга устройства. Вы можете определить для устройства несколько панелей мониторинга. Чтобы создать панель мониторинга для визуализации телеметрии датчика среды, выберите **Представления** > **Визуализация устройства**:

  
![Снимок экрана: страница "Представления" шаблона датчика среды с выделенным элементом "Визуализация устройства"](./media/tutorial-define-edge-device-type/visualizingthedevice.png)


Телеметрия Ambient и Machine — это сложные объекты. Для создания диаграмм сделайте следующее:

1. Перетащите **Ambient Telemetry** (Телеметрия Ambient) и выберите **График**. 
  
   ![Снимок экрана: шаблон датчика среды с выделенными элементами Ambient Telemetry (Телеметрия Ambient) и "График"](./media/tutorial-define-edge-device-type/sensorambientchart.png)

1. Щелкните значок настройки. Выберите **Температура** и **Влажность** для визуализации данных и выберите **Обновление конфигурации**. 
  
   ![Снимок экрана: шаблон датчика среды с несколькими выделенными параметрами](./media/tutorial-define-edge-device-type/sensorambienttelemetrychart.png)

1. Щелкните **Сохранить**.

Вы можете добавить дополнительные плитки для других свойств или значений телеметрии. Можно также добавить статический текст, ссылки и (или) изображения. Чтобы переместить плитку на панели мониторинга или изменить ее размер, наведите указатель мыши на плитку, а затем перетащите ее на новое место или перетащите границу.
  
![Снимок экрана: представление панели мониторинга шаблона датчика среды](./media/tutorial-define-edge-device-type/viewsdashboard.png)

### <a name="add-a-device-form"></a>Добавление формы устройств

Форма устройства позволяет оператору изменять доступные для записи свойства устройства и свойства облака. Вы (как разработчик) можете определить несколько форм и выбрать, какие свойства устройства и облака будут отображаться в каждой из них. В форме также можно отображать свойства устройства, доступные только для чтения.

Чтобы создать форму для просмотра и редактирования свойств датчика среды, сделайте следующее:

1. В **Environmental Sensor Template** (Шаблон датчика среды) перейдите к разделу **Представления**. Выберите плитку **Изменение устройства и облачных данных**, чтобы добавить новое представление.
  
   ![Снимок экрана: страница "Представления" шаблона датчика среды с выделенным элементом "Изменение устройства и облачных данных"](./media/tutorial-define-edge-device-type/editingdeviceandclouddata.png)

1. Введите имя формы **Environmental Sensor properties** (Свойства датчика среды).

1. Перетащите свойства облака **Customer name** (Имя клиента) и **Last service date** (Дата последнего обслуживания) в существующий раздел формы.
  
   ![Снимок экрана: страница "Представления" шаблона датчика среды с несколькими выделенными элементами](./media/tutorial-define-edge-device-type/views-properties.png)

1. Щелкните **Сохранить**.

## <a name="publish-a-device-template"></a>Публикация шаблона устройства

Прежде чем создать имитированный датчик среды или подключить реальный датчик, необходимо опубликовать шаблон устройства.

Для публикации шаблона устройства сделайте следующее:

1. Откройте шаблон устройства на странице **Шаблоны устройств**.

2. Нажмите кнопку **Опубликовать**.
  
    ![Снимок экрана: страница "Представления" шаблона датчика среды с выделенным элементом "Опубликовать"](./media/tutorial-define-edge-device-type/edgetemplatepublish.png)

1. В диалоговом окне **Publish a Device Template** (Публикация шаблона устройства) щелкните **Опубликовать**.
  
    ![Снимок экрана: диалоговое окно Publish a Device Template (Публикация шаблона устройства) с выделенным элементом "Опубликовать"](./media/tutorial-define-edge-device-type/edgepublishtemplate.png)

После публикации шаблона устройства он отображается на странице **Устройства** и в представлении для оператора. В опубликованном шаблоне устройства уже нельзя изменить модель возможностей устройства без создания новой версии. Но вы можете вносить изменения в свойства облака, настройки и представления в шаблоне опубликованного устройства. Эти обновления не приводят к созданию версии. После внесения изменений щелкните **Опубликовать**, чтобы передать эти изменения оператору.
  
![Снимок экрана: список "Шаблоны устройств" опубликованных шаблонов](./media/tutorial-define-edge-device-type/publishedtemplate.png)

## <a name="next-steps"></a>Дополнительная информация

Из этого руководства вы узнали, как выполнить следующие задачи:

* создание устройства Edge на основе шаблона конечного устройства;
* создание модулей из отправленного манифеста развертывания;
* добавление телеметрии и свойств сложного типа;
* создание свойств облака;
* создание настроек;
* определение визуализации для данных телеметрии устройства;
* публикация шаблона устройства Edge.

Вы узнали, как создать шаблон устройства в приложении Azure IoT Central, а значит вы готовы к следующему шагу:

> [!div class="nextstepaction"]
> [Подключение устройства](./tutorial-connect-pnp-device.md)
