---
title: Определение нового типа устройства Azure IoT Edge в Azure IoT Central | Документация Майкрософт
description: В этом учебнике показано, как сборщики могут создать устройство Azure IoT Edge в приложении Azure IoT Central. Вы определите данные телеметрии, состояние, свойства и команды для своего типа.
author: rangv
ms.author: rangv
ms.date: 10/22/2019
ms.topic: tutorial
ms.service: iot-central
services: iot-central
ms.custom: mvc
manager: peterpr
ms.openlocfilehash: c205b4dd4871ed53e32dce72f12cc2dcfb3baf41
ms.sourcegitcommit: cf36df8406d94c7b7b78a3aabc8c0b163226e1bc
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/09/2019
ms.locfileid: "73892030"
---
# <a name="tutorial-define-a-new-azure-iot-edge-device-type-in-your-azure-iot-central-application-preview-features"></a>Руководство по определению нового типа устройства Azure IoT Edge в приложении Azure IoT Central (предварительная версия функций)

[!INCLUDE [iot-central-pnp-original](../../../includes/iot-central-pnp-original-note.md)]

В этом учебнике показано, как сборщики могут использовать шаблон устройства для определения нового типа устройства Azure IoT Edge в приложении Azure IoT Central. 

Общие сведения об Azure IoT Edge см. в [этой статье](overview-iot-central.md). 

Azure IoT Edge состоит из трех компонентов:
* **Модули IoT Edge** — это контейнеры, в которых выполняются службы Azure, сторонние службы или ваш собственный код. Модули развертываются на устройства IoT Edge и выполняются на них локально.
* **Среда выполнения IoT Edge** запускается на каждом устройстве IoT Edge и позволяет управлять модулями, развернутыми на каждом устройстве.
* С помощью **облачного интерфейса** вы можете осуществлять мониторинг устройств IoT Edge и управлять ими удаленно. Облачным интерфейсом будет выступать IoT Central.

Устройство **Azure IoT Edge** может представлять собой устройство шлюза с подчиненными устройствами, подключенными к устройству Azure IoT Edge. В этом учебнике рассмотрены шаблоны подключения подчиненных устройств.

**Шаблон устройства** определяет возможности устройства и модулей IoT Edge. К возможностям относятся отправляемые модулем данные телеметрии, свойства этого модуля и команды, на которые он реагирует.

В рамках этого руководства вы создадите шаблон устройства **датчика среды**. Устройство датчика среды выполняет следующие функции:

* отправляет данные телеметрии, например температуру;
* реагирует на записываемые свойства при их обновлении в облаке, например интервал отправки телеметрии;
* реагирует на такие команды, как сброс температуры.

В рамках этого учебника вы также создадите шаблон устройства **шлюза среды**. Устройство шлюза среды:

* отправляет данные телеметрии, например температуру;
* реагирует на записываемые свойства при их обновлении в облаке, например интервал отправки телеметрии;
* реагирует на такие команды, как сброс температуры.
* разрешает связи с другими моделями возможностей устройств.


Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * создание шаблона устройства Azure IoT Edge;
> * отправка манифеста развертывания;
> * создание возможностей, включая телеметрию, свойства и команды для каждого модуля;
> * определение визуализации для телеметрии модуля;
> * добавление связей к шаблонам подчиненных устройств;
> * публикация шаблона устройства.

## <a name="prerequisites"></a>Предварительные требования

Для работы с этим руководством вам потребуется приложение Azure IoT Central. Чтобы создать приложение Azure IoT Central, воспользуйтесь сведениями из [этой статьи](quick-deploy-iot-central.md).


## <a name="downstream-device-relationships-with-gateway--modules"></a>Связи подчиненных устройств со шлюзом и модулями

Подчиненные устройства могут подключаться к устройству шлюза Azure IoT Edge через модуль $edgeHub. В данном сценарии это устройство Azure IoT Edge становится прозрачным шлюзом.

![Страница приложения IoT Central](./media/tutorial-define-edge-device-type/gateway-transparent.png)

Подчиненные устройства могут подключаться к устройству шлюза Azure IoT Edge через настраиваемый модуль. В приведенном ниже сценарии подчиненные устройства подключаются через настраиваемый модуль Modbus. Они также могут подключаться к устройству шлюза Azure IoT Edge через модуль $edgeHub.

![Страница приложения IoT Central](./media/tutorial-define-edge-device-type/gateway-module.png)

Подчиненные устройства могут подключаться к устройству шлюза Azure IoT Edge через настраиваемый модуль. В приведенном ниже сценарии подчиненные устройства подключаются через настраиваемый модуль Modbus. 

![Страница приложения IoT Central](./media/tutorial-define-edge-device-type/gateway-module-transparent.png)

Подчиненные устройства могут подключаться к устройству шлюза Azure IoT Edge через несколько настраиваемых модулей. В приведенном ниже сценарии подчиненные устройства подключаются через настраиваемый модуль Modbus и BLE. Они также могут подключаться к устройству шлюза Azure IoT Edge через модуль $edgeHub. 

![Страница приложения IoT Central](./media/tutorial-define-edge-device-type/gateway-module2-transparent.png)


## <a name="create-a-template"></a>Создание шаблона

Вы (как сборщик) можете создавать и редактировать шаблоны устройств Azure IoT Edge в своем приложении. После публикации шаблона устройства вы можете подключить реальные устройства, реализующие этот шаблон устройства.

### <a name="select-device-template-type"></a>Выбор типа шаблона устройства 

Чтобы добавить в приложение новый шаблон устройства, перейдите к странице **Шаблоны устройств**. Для этого выберите вкладку **Шаблоны устройств** на панели слева.

![Страница приложения IoT Central](./media/tutorial-define-edge-device-type/edgedevicetemplate.png)

Щелкните **+ Создать**, чтобы создать шаблон устройства.

![Создание шаблона устройства](./media/tutorial-define-edge-device-type/edgedevicetemplatenew.png)

Вы попадете на страницу выбора типа шаблона устройства. Щелкните плитку **Azure IoT Edge** и нажмите кнопку **Next: Customize** (Далее: настройка) в нижней части экрана.

![Выбор шаблонов устройств — Azure IoT Edge](./media/tutorial-define-edge-device-type/selectiotedge.png)

### <a name="customize-device-template"></a>Настройка шаблона устройства

Azure IoT Edge позволяет развертывать модули бизнес-логики и управлять этими модулями. **Модуль Azure IoT Edge** представляет собой наименьшую единицу вычислительных ресурсов, которыми управляет IoT Edge. Эти модули могут содержать службы Azure (например, Azure Stream Analytics) или пользовательский код для конкретного решения. Чтобы понять, как модули разрабатываются, развертываются и обслуживаются, ознакомьтесь со статьей [Общие сведения о модулях Azure IoT Edge](../../iot-edge/iot-edge-modules.md).

В общих чертах манифест развертывания представляет собой список двойников модулей, для которых настроены требуемые свойства. Манифест развертывания сообщает устройству IoT Edge (или группе устройств), какие модули нужно установить и как их нужно настроить. Манифесты развертывания содержат требуемые свойства для каждого двойника модуля. Устройства IoT Edge передают сообщаемые свойства от каждого модуля.

Используйте Visual Studio Code для создания манифеста развертывания. Следуйте инструкциям по созданию [манифеста развертывания](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-edge).

Вот пример простого манифеста развертывания с одним модулем, который будет использоваться в этом учебнике. Скопируйте приведенный ниже код JSON и сохраните его в формате JSON-файла. 

   ```JSON
   {
     "modulesContent": {
       "$edgeAgent": {
         "properties.desired": {
           "schemaVersion": "1.0",
           "runtime": {
             "type": "docker",
             "settings": {
               "minDockerVersion": "v1.25",
               "loggingOptions": "",
               "registryCredentials": {}
             }
           },
           "systemModules": {
             "edgeAgent": {
               "type": "docker",
               "settings": {
                 "image": "mcr.microsoft.com/azureiotedge-agent:1.0",
                 "createOptions": "{}"
               }
             },
             "edgeHub": {
               "type": "docker",
               "status": "running",
               "restartPolicy": "always",
               "settings": {
                 "image": "mcr.microsoft.com/azureiotedge-hub:1.0",
                 "createOptions": "{}"
               }
             }
           },
           "modules": {
             "SimulatedTemperatureSensor": {
               "version": "1.0",
               "type": "docker",
               "status": "running",
               "restartPolicy": "always",
               "settings": {
                 "image": "mcr.microsoft.com/azureiotedge-simulated-temperature-sensor:1.0",
                 "createOptions": "{}"
               }
             }
           }
         }
       },
       "$edgeHub": {
         "properties.desired": {
           "schemaVersion": "1.0",
           "routes": {
               "route": "FROM /* INTO $upstream"
           },
           "storeAndForwardConfiguration": {
             "timeToLiveSecs": 7200
           }
         }
       },
       "SimulatedTemperatureSensor": {
         "properties.desired": {
              "SendData": true,
              "SendInterval": 10
         }
       }
     }
   }
   ```

**Отправка манифеста развертывания Azure IoT Edge**

Нажмите кнопку **Обзор**. 

![Шаблон устройства — Azure IoT Edge](./media/tutorial-define-edge-device-type/edgedevicetemplateuploadmanifest.png)

Если вы планируете создать шаблон устройства шлюза Azure IoT Edge, установите флажок **Gateway device with downstream devices** (Устройство шлюза с подчиненными устройствами).

![Шаблон устройства — Azure IoT Edge](./media/tutorial-define-edge-device-type/gateway-upload.png)

Откроется диалоговое окно выбора файла. Выберите файл манифеста развертывания и нажмите кнопку **Открыть**.

Файл манифеста развертывания будет проверен на соответствие схеме. После успешной проверки нажмите кнопку **Просмотр**.

![Шаблон устройства — Azure IoT Edge](./media/tutorial-define-edge-device-type/deploymentmanifestvalidate.png)

Ниже приведен поток жизненного цикла манифеста развертывания в IoT Central.

![Шаблон устройства — Azure IoT Edge](./media/tutorial-define-edge-device-type/dmflow.png)

Страница просмотра отображается со сведениями о манифесте развертывания. На этой странице отобразится список модулей из манифеста развертывания. При работе с этим учебником на странице отобразится модуль SimulatedTemperatureSensor. Нажмите кнопку **Создать**.

![Шаблон устройства — Azure IoT Edge](./media/tutorial-define-edge-device-type/edgedevicetemplatereview.png)

Если вы выберете устройство шлюза, вы увидите такую страницу просмотра:

![Шаблон устройства — Azure IoT Edge](./media/tutorial-define-edge-device-type/gateway-review.png)


При создании шаблона устройства будет отображаться счетчик хода создания в IoT Central.

Шаблон устройства создается с моделями возможностей модуля. В этом учебнике вы увидите, как создается модель возможностей модуля SimulatedTemperatureSensor. 

Измените заголовок шаблона устройства на "Шаблон устройства датчика среды".

![Шаблон устройства — Azure IoT Edge](./media/tutorial-define-edge-device-type/edgedevicetemplatelanding.png)

Моделирование настройки устройства Azure IoT Edge Plug and Play выполняется следующим образом.
* Каждый шаблон устройства Azure IoT Edge будет иметь **модель возможностей устройства**.
* Для каждого настраиваемого модуля, указанного в манифесте развертывания, будет создана **модель возможностей модуля**.
* Между каждой моделью возможностей модуля и моделью возможностей устройства будет установлена **связь**.
* Модель возможностей модуля реализует **интерфейсы модуля**.
* Каждый интерфейс модуля содержит:
   - Телеметрия
   - properties
   - Команды

![Шаблон устройства — Azure IoT Edge](./media/tutorial-define-edge-device-type/edgemodelling.png)

**Добавление возможностей к модели возможностей модуля**

Ниже приведен пример выходных данных из модуля SimulatedTemperatureSensor.
```json
{

    "machine": {

        "temperature": 75.0,
        "pressure": 40.2
    },
    "ambient": {
        "temperature": 23.0,
        "humidity": 30.0
    },
    "timeCreated": ""
}
```

Добавьте возможности к модулю SimulatedTemperatureSensor, который будет отражать приведенный выше код JSON. 

* Щелкните команду **Управление** для интерфейса модели возможностей модуля SimulatedTemperatureSensor. Щелкните **Добавить возможность**. 

    ![Шаблон устройства — Azure IoT Edge](./media/tutorial-define-edge-device-type/edgetemplateaddcapability.png)
  
* Добавьте "компьютер" в качестве типа объекта, так как это сложный тип.
  
    ![Шаблон устройства — Azure IoT Edge](./media/tutorial-define-edge-device-type/edgetemplatemachineobject.png)

    Щелкните **Определить**. Во всплывающем модальном меню измените имя объекта на "компьютер", создайте свойства температуры и давления, а затем нажмите кнопку **Применить**.
  
    ![Шаблон устройства — Azure IoT Edge](./media/tutorial-define-edge-device-type/edgetemplatemachineattributes.png)
  
* Добавьте "окружающая среда" как тип объекта, так как это сложный тип.

    Щелкните **Определить**. Во всплывающем модальном меню измените имя объекта на "окружающая среда", создайте свойства температуры и влажности, а затем нажмите кнопку **Применить**.
  
    ![Шаблон устройства — Azure IoT Edge](./media/tutorial-define-edge-device-type/edgetemplateambientattributes.png)

  
* Добавьте timeCreated в качестве типа DateTime и щелкните **Сохранить**.
  
    ![Шаблон устройства — Azure IoT Edge](./media/tutorial-define-edge-device-type/edgetemplateallattributes.png)


### <a name="add-relationships"></a>Добавление связей

Если вы выбрали устройство Azure IoT Edge в качестве устройства шлюза, можно добавить подчиненные связи к моделям возможностей устройств для устройств, которые будут подключены к устройству шлюза.
  
  ![Шаблон устройства — Azure IoT Edge](./media/tutorial-define-edge-device-type/gateway-add-relationship.png)

Связь можно добавить на устройстве или в модуле.
  
  ![Шаблон устройства — Azure IoT Edge](./media/tutorial-define-edge-device-type/gateway-relationship-types.png)


Вы можете выбрать модель возможностей подчиненного устройства или звездочку. 
  
  ![Шаблон устройства — Azure IoT Edge](./media/tutorial-define-edge-device-type/gateway-downstream-rel.png)

  В этом учебнике мы выберем звездочку, что означает, что будут разрешены любые подчиненные связи. Нажмите кнопку **Сохранить**

  ![Шаблон устройства — Azure IoT Edge](./media/tutorial-define-edge-device-type/gateway-add-relationship-asterix.png)


### <a name="add-cloud-properties"></a>Добавление свойств облака

Шаблон устройства может содержать свойства облака. Свойства облака существуют только в приложении IoT Central и никогда не отправляются на устройство и не принимаются с него.

1. Выберите **Свойства облака**, а затем **+ Добавить облачное свойство**. Воспользуйтесь сведениями в следующей таблице, чтобы добавить свойство облака в шаблон устройства.

    | Отображаемое имя      | Семантический тип | Схема |
    | ----------------- | ------------- | ------ |
    | Дата последнего обслуживания | Нет          | Дата   |
    | Имя клиента.     | Нет          | Строка, |

2. Щелкните **Сохранить**, чтобы сохранить изменения.

  
    ![Свойства облака — Azure IoT Edge](./media/tutorial-define-edge-device-type/edgetemplatecloudproperties.png)

### <a name="add-customizations"></a>Добавление настройки

С помощью настроек можно изменить интерфейс или добавить функции IoT Central для возможности, которая не требует создания новой версии модели возможностей устройства. Вы можете изменять поля, когда модель возможностей находится в черновом или опубликованном состоянии. Настраивать можно только те поля, которые не нарушают совместимость интерфейса. Например, вы можете просматривать:

- Настроить отображаемое имя и единицы измерения для возможности.
- Добавить цвет по умолчанию, который используется для значений на диаграмме.
- Указать начальные, минимальные и максимальные значения для свойства.

Вы не сможете изменить имя или тип возможности. Нажмите кнопку **Сохранить**
  
![Настройки — Azure IoT Edge](./media/tutorial-define-edge-device-type/edgetemplatecustomize.png)


### <a name="create-views"></a>Создание представлений

Вы (как разработчик) можете настроить в приложении отображение для оператора сведений о подключенном датчике среды. Ваши настройки позволят оператору управлять устройствами датчиков среды, подключенными к приложению. Вы можете создать два типа представлений, которые позволят оператору взаимодействовать с устройствами.

* Формы для просмотра и редактирования свойств устройства и облака.
* Панели мониторинга для визуализации устройств.

### <a name="configure-a-view-to-visualize-devices"></a>Настройка представления для визуализации устройств

Панель мониторинга устройства позволяет оператору визуализировать устройство с помощью диаграмм и метрик. Как конструктор вы можете определить, какие сведения будут отображаться на панели мониторинга устройства. Вы можете определить для устройства несколько панелей мониторинга. Чтобы создать панель мониторинга для визуализации телеметрии датчика среды, выберите **Представления**, а затем **Визуализация устройства**:

  
![Представления — Azure IoT Edge](./media/tutorial-define-edge-device-type/visualizingthedevice.png)


Телеметрии "Окружающая среда" и "Компьютер" являются сложными объектами. Для создания диаграмм выполните следующие действия.

Перетащите телеметрию "Окружающая среда" и выберите график. 
  
![Представления — Azure IoT Edge](./media/tutorial-define-edge-device-type/sensorambientchart.png)

Щелкните значок настройки и выберите температуру и влажность для визуализации данных и нажмите кнопку **Обновление конфигурации**. 
  
![Представления — Azure IoT Edge](./media/tutorial-define-edge-device-type/sensorambienttelemetrychart.png)

Выберите **Сохранить**, чтобы сохранить представление.

Вы можете добавить дополнительные плитки для других свойств или значений телеметрии. Можно также добавить статический текст, ссылки и (или) изображения. Чтобы переместить плитку на панели мониторинга или изменить ее размер, наведите указатель мыши на плитку, а затем перетащите ее на новое место или перетащите границу.
  
![Представления — Azure IoT Edge](./media/tutorial-define-edge-device-type/viewsdashboard.png)

### <a name="add-a-device-form"></a>Добавление формы устройств

Форма устройства позволяет оператору изменять доступные для записи свойства устройства и свойства облака. Вы (как разработчик) можете определить несколько форм и выбрать, какие свойства устройства и облака будут отображаться в каждой из них. В форме также можно отображать свойства устройства, доступные только для чтения.

Чтобы создать форму для просмотра и редактирования свойств датчика среды, сделайте следующее:

Перейдите к разделу **Представления** в шаблоне **Датчик среды**. Выберите плитку **Изменение устройства и облачных данных**, чтобы добавить новое представление.
  
![Представления — Azure IoT Edge](./media/tutorial-define-edge-device-type/editingdeviceandclouddata.png)

Введите имя формы **Environmental Sensor properties** (Свойства датчика среды).

Перетащите свойства облака **Customer name** (Имя клиента) и **Last service date** (Дата последнего обслуживания) в существующий раздел формы.
  
![Представления — Azure IoT Edge](./media/tutorial-define-edge-device-type/views-properties.png)

Выберите **Сохранить**, чтобы сохранить представление.

### <a name="generate-default-views"></a>Создание представлений по умолчанию

Функция создания представлений по умолчанию не поддерживается для шаблонов Azure IoT Edge. 

## <a name="publish-device-template"></a>Публикация шаблона устройства

Прежде чем создать имитированный датчик среды или подключить реальный датчик, необходимо опубликовать шаблон устройства.

Для публикации шаблона устройства сделайте следующее:

1. Откройте шаблон устройства на странице **Шаблоны устройств**.

2. Нажмите кнопку **Опубликовать**.
  
    ![Представления — публикация](./media/tutorial-define-edge-device-type/edgetemplatepublish.png)

1. В диалоговом окне **Publish a Device Template** (Публикация шаблона устройства) щелкните **Опубликовать**:
  
    ![Представления — публикация](./media/tutorial-define-edge-device-type/edgepublishtemplate.png)

После публикации шаблона устройства он отображается на странице **Устройства** и в представлении для оператора. В опубликованном шаблоне устройства уже нельзя изменить модель возможностей устройства без создания новой версии. Но вы можете вносить изменения в свойства облака, настройки и представления в шаблоне опубликованного устройства, не создавая новых версий. После внесения изменений щелкните **Опубликовать**, чтобы передать эти изменения оператору.
  
![Представления — публикация](./media/tutorial-define-edge-device-type/publishedtemplate.png)

## <a name="next-steps"></a>Дополнительная информация

Из этого руководства вы узнали, как выполнить следующие задачи:

* создание нового устройства Edge на основе шаблона конечного устройства;
* создание модулей из отправленного манифеста развертывания;
* добавление телеметрии и свойств сложного типа;
* создание свойств облака;
* создание настроек;
* определение визуализации для данных телеметрии устройства;
* публикация шаблона устройства Edge.

Итак, вы определили шаблон устройства в приложении Azure IoT Central и можете перейти к следующему этапу:

> [!div class="nextstepaction"]
> [Подключение устройства](./tutorial-connect-pnp-device.md)
