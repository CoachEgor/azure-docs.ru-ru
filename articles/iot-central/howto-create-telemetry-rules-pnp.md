---
title: Создание правил телеметрии и управление ими в приложении Azure IoT Central | Документация Майкрософт
description: Правила телеметрии Azure IoT Central позволяют отслеживать устройства практически в реальном времени и автоматически вызывать действия (например, отправлять сообщение электронной почты) при срабатывании правила.
author: ankitgupta
ms.author: ankitgup
ms.date: 06/09/2019
ms.topic: conceptual
ms.service: iot-central
services: iot-central
manager: peterpr
ms.openlocfilehash: d6deecf558105701be591c1f08923eca2c1e3bbd
ms.sourcegitcommit: b3bad696c2b776d018d9f06b6e27bffaa3c0d9c3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2019
ms.locfileid: "69879946"
---
# <a name="create-a-telemetry-rule-and-set-up-notifications-in-your-azure-iot-central-application-preview-features"></a>Создание правила телеметрии и Настройка уведомлений в приложении IoT Central Azure (Предварительная версия компонентов)

*Эта статья предназначена для операторов, разработчиков и администраторов.*

[!INCLUDE [iot-central-pnp-original](../../includes/iot-central-pnp-original-note.md)]

Вы можете использовать Azure IoT Central для удаленного мониторинга подключенных устройств. Правила Azure IoT Central позволяют вам отслеживать устройства практически в реальном времени и автоматически вызывать действия, например, отправлять сообщение электронной почты или активировать Microsoft Flow. Всего в несколько щелчков вы можете определить условие для отслеживания данных устройства и настроить соответствующее действие. В этой статье объясняется, как создать правила для отслеживания телеметрии, отправляемой устройством.

Устройства могут использовать измерение телеметрии для отправки числовых данных с устройства. Правило телеметрии срабатывает, когда данные телеметрии выбранного устройства превышают указанное пороговое значение.

## <a name="create-a-telemetry-rule"></a>Создание правила телеметрии

Чтобы создать правило телеметрии, в определении устройства должно быть определено по крайней мере одно измерение телеметрии. В этом примере используется охлаждаемый торговый автомат, который отправляет данные телеметрии о температуре и влажности. Правило отслеживает передаваемые устройством данные температуры и отправляет сообщение электронной почты, когда температура превышает 80 градусов.

1. Перейдите на страницу **правила** .

1. Если вы еще не создали правила, отобразится следующий экран:

    ![Правила отсутствуют](media/howto-create-telemetry-rules-pnp/rules-landing-page1.png)

1. Выберите **+ новое правило** , чтобы просмотреть типы правил, которые можно создать.

1. Выберите элемент **телеметрии** , чтобы создать правило для отслеживания телеметрии устройства.

    ![Типы правил](media/howto-create-telemetry-rules-pnp/rule-types1.png)


1. Введите имя, которое поможет вам найти правило и нажать клавишу ВВОД.

1. В разделе области выберите Определение устройства, для которого необходимо задать область действия этого правила. На этом экране также можно отфильтровать устройства, к которым применяется правило, с помощью **+ Filter**. Правило автоматически применяется ко всем устройствам в шаблоне устройств. Чтобы отключить правило, нажмите кнопку **Отключить** в заголовке.

### <a name="configure-the-rule-conditions"></a>Настройка условий правила

Условие определяет критерии, которые отслеживаются этим правилом.

1. Выберите, следует ли **устанавливать статистическое выражение** как on или OFF.

      - Агрегирование не является обязательным. Без агрегирования правило запускается для каждой точки данных телеметрии, которая соответствует условию. Например, если правило настроено для активации, когда температура превышает 80, правило срабатывает почти мгновенно, когда устройство сообщает о температуре > 80.
      - Если выбрана агрегатная функция, например СРЗНАЧ, min, Max, Count, то пользователь должен предоставить временное **окно** , в течение которого должно оцениваться условие. Например, если задать период "5 минут" и правило ищет среднюю температуру выше 80, оно сработает, если средняя температура превышает 80 в течение как минимум 5 минут. Частота оценки правила совпадает с **периодом времени**. Это означает, что в этом примере правило вычисляется каждые 5 минут.

1. Выберите телеметрию, которую нужно отслеживать, в раскрывающемся списке **Измерение**.

1. Затем выберите **оператор** и укажите **значение**.

     ![Условие](media/howto-create-telemetry-rules-pnp/aggregate-condition-filled-out1.png)


>[!NOTE]
>Можно добавить более одного измерения телеметрии, выбрав **+ условие**. Если задано несколько условий, для срабатывания правила необходимо, чтобы были соблюдены все условия. Каждое условие присоединяется с помощью предложения "и" неявно. При использовании агрегирования каждое измерение должно быть агрегировано.

### <a name="configure-actions"></a>Настройка действий

В этом разделе показано, как настроить действия, предпринимаемые при запуске правила. Действия вызываются в том случае, если соблюдаются все условия, указанные в правиле.

1. Щелкните **действие +** в разделах **действие** . Здесь отобразится список доступных действий.  

    ![Добавление действия](media/howto-create-telemetry-rules-pnp/add-action1.png)


1. Выберите действие **Электронная почта** , введите отображаемое имя действия, допустимый адрес электронной почты в поле **Кому** и введите Примечание, которое будет отображаться в тексте сообщения электронной почты при срабатывании правила.

    > [!NOTE]
    > Письма отправляются только пользователям, которые были добавлены в приложение и входили в систему минимум один раз. Узнайте больше об [управлении пользователями](howto-administer-pnp.md?toc=/azure/iot-central-pnp/toc.json&bc=/azure/iot-central-pnp/breadcrumb/toc.json) в Azure IoT Central.

   ![Настройка действия](media/howto-create-telemetry-rules-pnp/configure-action1.png)


1. Чтобы сохранить действие, нажмите кнопку **Готово**.

1. Чтобы сохранить правило, нажмите кнопку **Сохранить**. Правило станет активным в течение нескольких минут и начнет выполнять мониторинг данных телеметрии, отправляемых в приложение. Если указанное в правиле условие соблюдается, правило активирует настроенное действие отправки электронной почты.

## <a name="parameterize-the-rule"></a>Параметризация правила

Для правила можно задать определенные значения **свойств устройства** в качестве параметров. Параметры можно использовать в сценариях, когда пороговые значения телеметрии отличаются для различных устройств. При создании правила выберите свойство устройства, которое указывает пороговое значение, например **Максимальное идеальное**пороговое значение, вместо указания абсолютного значения, например 80 градусов. Когда правило выполняется, оно сопоставляет данные телеметрии устройства с набором значений, указанным в свойстве устройства.

Использование параметров — это эффективный способ сократить количество правил для управления.

Действия также можно настроить, используя **свойство устройства** в качестве параметра. Если адрес электронной почты хранится в виде свойстве, его можно использовать при определении адреса **Кому**.

## <a name="delete-a-rule"></a>Удаление правила

Если вам больше не нужно правило, удалите его. Для этого откройте правило и щелкните **Удалить**. Удаление правила приводит к его удалению из шаблона устройства и всех связанных устройств.

## <a name="enable-or-disable-a-rule"></a>Включение или отключение правила

Выберите правило, которое необходимо включить или отключить. Включите или отключите в правиле кнопку **включить** или **Отключить** , чтобы включить или отключить правило для всех устройств, область действия которых находится в правиле.

## <a name="enable-or-disable-a-rule-for-a-device"></a>Включение или отключение правила для устройства

Выберите правило, которое необходимо включить или отключить. Добавьте фильтр в раздел **области** , чтобы включить или исключить определенное устройство в шаблоне устройства.

## <a name="next-steps"></a>Следующие шаги

Теперь, когда вы узнали, как создавать правила в приложении IoT Central Azure, предлагаем следующий шаг — Узнайте, [как управлять устройствами](howto-manage-devices-pnp.md?toc=/azure/iot-central-pnp/toc.json&bc=/azure/iot-central-pnp/breadcrumb/toc.json) .
