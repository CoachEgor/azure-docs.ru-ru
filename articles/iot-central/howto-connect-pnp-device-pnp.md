---
title: Подключение устройства Plug and Play IoT к IoT Central | Документация Майкрософт
description: Как разработчик устройств вы узнаете, как использовать Visual Studio Code для создания и тестирования устройства IoT Plug and Play, которое подключается к IoT Central.
author: dominicbetts
ms.author: dobett
ms.date: 07/10/2019
ms.topic: conceptual
ms.custom: mvc
ms.service: iot-central
services: iot-central
manager: philmea
ms.openlocfilehash: 6eb73c1c2b768d82143890415702950905f261f6
ms.sourcegitcommit: 4b8a69b920ade815d095236c16175124a6a34996
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/23/2019
ms.locfileid: "69997242"
---
# <a name="use-visual-studio-code-to-create-an-iot-plug-and-play-device-that-connects-to-iot-central"></a>Используйте Visual Studio Code, чтобы создать устройство Plug and Play IoT, которое подключается к IoT Central

В этом пошаговом руководство показано, как:

* Как оператор, чтобы добавить и настроить реальное устройство в приложении IoT Central Azure.

* Чтобы использовать Visual Studio Code для создания устройства [IoT Plug and Play](../iot-pnp/overview-iot-plug-and-play.md) , которое подключается к приложению IOT Central, в качестве разработчика устройства.

[Модель возможностей устройства](./concepts-architecture-pnp.md?toc=/azure/iot-central-pnp/toc.json&bc=/azure/iot-central-pnp/breadcrumb/toc.json) используется для определения устройства, которое подключается к IOT Central. В этом пошаговом окне используется модель, определяющая устройство датчика окружающей среды.

Разработчик устройства использует модель для создания кода клиента устройства, а построитель использует модель для [создания шаблона устройства](./howto-set-up-template-pnp.md?toc=/azure/iot-central-pnp/toc.json&bc=/azure/iot-central-pnp/breadcrumb/toc.json) в IOT Central. Модель выступает в качестве контракта между устройством и IoT Central приложением.

В разделе этого руководства описано, как создать созданный код предполагается, что вы используете Windows.

Из этого руководства вы узнаете, как выполнить следующие задачи:

* Импорт модели возможностей устройства в шаблон устройства в IoT Central
* Добавление панели мониторинга в шаблон, отображающий телеметрию устройства
* Добавление реального устройства из шаблона
* Импорт модели возможностей устройства в Visual Studio Code
* Создание клиентского приложения C на основе модели
* Создайте клиентское приложение для устройства C и подключите его к IoT Central

## <a name="prerequisites"></a>Предварительные требования

Чтобы протестировать код устройства в этом пошаговом окне, вам потребуется приложение IoT Central, созданное из шаблона **предварительной версии** приложения. Если у вас еще нет приложения IoT Central, выполните инструкции из краткого руководства [Создание приложения IOT Central Azure (Предварительная версия компонентов)](./quick-deploy-iot-central-pnp.md?toc=/azure/iot-central-pnp/toc.json&bc=/azure/iot-central-pnp/breadcrumb/toc.json):

Для работы с моделью возможностей устройств в этом руководство вам потребуется:

* [Visual Studio Code](https://code.visualstudio.com/download). Visual Studio Code доступен для нескольких платформ
* Расширение Workbench для устройства Azure IoT для Visual Studio Code. Чтобы установить расширение Workbench для устройства Azure IoT в VS Code, выполните следующие действия.

    1. В VS Code выберите вкладку **расширения** .
    1. Найдите **Azure IOT Device Workbench**.
    1. Щелкните **Установить**.

    > [!NOTE]
    > Текущая версия генератора кода в расширении не поддерживает типы схем географического и **векторного** **координат** , а также типы семантики **ускорения**, **скорости**и **расположения местоположения** . Эти типы схем и семантических типов поддерживаются IoT Central.

    > [!NOTE]
    > Для работы с IoT Central модель возможностей устройства должна иметь все интерфейсы, определенные встроенными в один и тот же файл.

Для сборки созданного кода на языке C в Windows в этом руководство вам потребуется:

* [Visual Studio (Community, Professional или Enterprise)](https://visualstudio.microsoft.com/downloads/) . при установке Visual Studio необходимо включить компонент **диспетчера пакетов NuGet** и **разработку классических приложений с C++**  рабочей нагрузкой.
* [Git](https://git-scm.com/download)
* [CMAK](https://cmake.org/download/) — при установке **CMAK**выберите параметр **Добавить CMAK в системный путь**.
* Локальная копия пакета SDK для Azure IoT C:

    ```cmd
    git clone https://github.com/Azure/azure-iot-sdk-c.git --recursive -b public-preview
    ```

Для выполнения инструкций, посвященных устройствам, в конце этого руководства необходимо установить:

* [Node.js](https://nodejs.org)
* [Средство DPS-Keygen](https://www.npmjs.com/package/dps-keygen):

    ```cmd/sh
    npm i -g dps-keygen
    ```

## <a name="create-device-template"></a>Создание шаблона устройства

Создайте папку с именем **pnp_app** в папке **Azure-IOT-SDK-c** , содержащей клонированный пакет SDK для Azure IOT c. Скачайте модель возможностей устройства [енвиронменталсенсор. капабилитимодел. JSON](https://raw.githubusercontent.com/Azure/IoTPlugandPlay/master/samples/EnvironmentalSensorInline.capabilitymodel.json) из GitHub и сохраните файл в папке **pnp_app** . Замените два экземпляра `<YOUR_COMPANY_NAME_HERE>` на свое имя. Используйте только символы a – z, A – Z, 0-9 и знаки подчеркивания. Запишите полное значение `"@id"` поля, которое однозначно определяет модель возможностей устройства, оно понадобится позже. Эта модель включает два интерфейса:

* Общий интерфейс **девицеманажемент** .
* Пользовательский интерфейс **енвиронменталсенсор** .

Чтобы создать шаблон устройства для устройства датчиков окружающей среды в IoT Central:

1. Перейдите на страницу **шаблоны устройств** и выберите **+ создать**. Затем выберите **Пользовательский**.

1. В качестве имени шаблона устройства введите **датчик окружающей среды** .

1. Выберите **модель возможностей импорта**. Затем найдите созданный **енвиронменталсенсор. капабилитимодел. JSON** и нажмите кнопку **Открыть**. Два интерфейса, **сведения об устройстве** и **датчик окружающей среды**отображаются в **модели возможностей датчика окружающей среды**.

1. Выберите **представления** , а затем **Визуализируйте устройство**.

1. В списке полей, которые можно добавить на панель мониторинга, выберите два значения **телеметрии** , **влажности** и **температуру** , а затем выберите **объединить**. Затем нажмите кнопку **Сохранить**.

Теперь у вас есть шаблон устройства, использующий модель **датчика окружающей среды** и имеющий простую панель мониторинга для показа данных телеметрии с устройства.

## <a name="publish-the-template-and-add-a-real-device"></a>Публикация шаблона и добавление реального устройства

Чтобы опубликовать шаблон и добавить реальное устройство, перейдите на страницу " **шаблоны устройств** " и выберите шаблон устройства " **датчик окружающей среды** ". Выберите **опубликовать**, проверьте сведения и нажмите кнопку **опубликовать**.

Перед подключением клиентского приложения необходимо добавить устройство на странице **устройства** и получить сведения о его подключении:

1. Перейдите на страницу **устройства** и выберите **датчик окружающей среды**. Страница **устройства** позволяет управлять устройствами, которые могут подключаться к приложению.

1. Чтобы добавить реальное устройство, выберите **+ создать**, измените идентификатор устройства на **sensor01**и нажмите кнопку **создать**. Убедитесь, что **имитация** **отключена**.

1. В списке устройств выберите устройство **датчика среды** . Затем выберите **подключить**.

1. Запишите **идентификатор области**, **идентификатор устройства**и **первичный ключ**. Затем нажмите кнопку **Закрыть**.

## <a name="generate-a-device-client-application"></a>Создание клиентского приложения для устройства

Вы используете Visual Studio Code для создания каркаса клиентского приложения устройства из модели возможностей устройства:

1. Запустите Visual Studio Code и откройте папку **pnp_app** .

1. Используйте **сочетание клавиш CTRL + SHIFT + P** , чтобы открыть палитру команд.

1. Введите **Plug and Play** , а затем выберите **создать заглушку кода устройства**.

1. Выберите файл модели возможностей устройства **енвиронменталсенсор. капабилитимодел. JSON** .

1. Введите **sensor_app** в качестве имени проекта.

1. В качестве языка выберите **ANSI C** .

1. Выберите в качестве цели **проект CMAK** .

1. В качестве метода подключения выберите **симметричный ключ Via DP (служба подготовки устройств)** .

Visual Studio Code открывает новое окно с созданным кодом на языке C в папке **sensor_app**

## <a name="add-connection-details-to-the-device-client"></a>Добавление сведений о подключении к клиенту устройства

Чтобы добавить сведения о подключении к клиенту устройства, откройте **Main. c** в папке, содержащей созданный код:

1. Замените `[DPS Id Scope]` на значение **идентификатора области** , которое вы внесли ранее.

1. Замените `[DPS symmetric key]` на значение **первичного ключа** , которое вы записали ранее.

1. Замените `[device registration Id]` на значение **идентификатора устройства** , которое вы внесли ранее.

1. Сохраните изменения.

## <a name="build-and-run-the-client"></a>Сборка и запуск клиента

Чтобы создать и запустить клиент, необходимо настроить сборку для пакета SDK для Azure IoT C:

1. Откройте файл **CMakeLists. txt** в корне папки **Azure-IOT-SDK-c** .

1. Добавьте следующую строку в конец файла, чтобы включить новое клиентское приложение в сборку:

    ```txt
    add_subdirectory(pnp_app/sensor_app)
    ```

1. Сохраните изменения.

1. Откройте командную строку и перейдите в папку **Azure-IOT-SDK-c** .

1. Чтобы выполнить сборку приложения, выполните следующие команды:

    ```cmd
    mkdir cmake
    cd cmake
    cmake .. -Duse_prov_client=ON -Dhsm_type_symm_key:BOOL=ON -Dskip_samples:BOOL=ON
    cmake --build . -- /m /p:Configuration=Release
    ```

1. Чтобы запустить приложение, выполните следующую команду в той же командной строке:

    ```cmd
    pnp_app\sensor_app\Release\sensor_app.exe
    ```

## <a name="view-the-telemetry"></a>Просмотр телеметрии

Через несколько минут вы сможете просмотреть данные телеметрии с устройства на панели мониторинга устройства в приложении IoT Central.

## <a name="connect-device-first"></a>Подключение устройства — сначала

Вы можете подключить устройство Plug and Play IoT через подключение устройства, как описано в разделе [Подключение](concepts-connectivity-pnp.md?toc=/azure/iot-central-pnp/toc.json&bc=/azure/iot-central-pnp/breadcrumb/toc.json). Процесс обнаружения выполняется в следующем порядке:

1. Связывается с шаблоном устройства, если он уже опубликован в IoT Central приложении.

1. Извлекает модель возможностей из общедоступного [репозитория](https://aka.ms/ACFI) опубликованных и сертифицированных моделей возможностей.

С помощью Visual Studio Code и команды **создания заглушки кода устройства** , указанной выше, можно выполнить следующие действия для подключения устройства и автоматического переноса модели возможностей опубликованного устройства из общедоступного репозитория в IOT Central:

1. Используйте существующую модель возможностей устройства, опубликованную в общедоступном репозитории. Необходима полная модель возможностей устройства и запишите URN этой модели.

1. Выполните описанные выше действия, чтобы [создать клиентское приложение устройства](#generate-a-device-client-application) для использования Visual Studio Code и создания кода устройства.

1. В приложении IoT Central перейдите на вкладку **Администрирование** и выберите раздел **Подключение устройства** . Запишите **идентификатор области** и значения первичного **ключа** для приложения.

    > [!NOTE]
    > **Первичный ключ** , показанный на этой странице, является групповой подписью общего доступа, которую можно использовать для создания нескольких ключей устройств для приложения.

1. С помощью средства [Keygen DPS](https://www.npmjs.com/package/dps-keygen) создайте ключ устройства из первичного ключа, который вы записали ранее. Чтобы создать ключ устройства, выполните следующую команду:

    ```cmd/sh
    dps-keygen -mk:<Primary_Key> -di:<device_id>
    ```

1. Выполните действия, описанные в предыдущем разделе [Добавление сведений о подключении к клиенту устройства](#add-connection-details-to-the-device-client) , чтобы добавить **идентификатор области**, **первичный ключ**и **идентификатор устройства**.

1. Выполните действия, описанные в предыдущем разделе, чтобы [создать и запустить клиент](#build-and-run-the-client).

1. Теперь устройство подключается к приложению IoT Central и автоматически переводит модель возможностей устройства из общедоступного репозитория в шаблон устройства.

## <a name="next-steps"></a>Следующие шаги

Теперь, когда вы узнали, как подключить реальное устройство к IoT Central, рекомендуем следующий шаг — получить дополнительные сведения о шаблонах устройств в статье [Настройка шаблона устройства](howto-set-up-template-pnp.md?toc=/azure/iot-central-pnp/toc.json&bc=/azure/iot-central-pnp/breadcrumb/toc.json) .
