---
title: Добавление устройства Azure IoT Edge в Azure IoT Central | Документация Майкрософт
description: Как оператор вы можете добавить устройство Azure IoT Edge в приложение Azure IoT Central
author: rangv
ms.author: rangv
ms.date: 12/09/2019
ms.topic: tutorial
ms.service: iot-central
services: iot-central
ms.custom: mvc
manager: peterpr
ms.openlocfilehash: bf74784998de6bbad6310c48c24d6353512bff13
ms.sourcegitcommit: 21e33a0f3fda25c91e7670666c601ae3d422fb9c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/05/2020
ms.locfileid: "77026397"
---
# <a name="tutorial-add-an-azure-iot-edge-device-to-your-azure-iot-central-application"></a>Руководство. добавлению устройства Azure IoT Edge в приложение Azure IoT Central

В этом учебнике показано, как добавить устройство Azure IoT Edge в приложение Azure IoT Central и настроить его. В этом учебнике для имитации устройства IoT Edge используется виртуальная машина Linux с поддержкой IoT Edge из Azure Marketplace. Устройство IoT Edge использует модуль, который создает смоделированные данные телеметрии окружающей среды. Данные телеметрии можно просмотреть на панели мониторинга в приложении IoT Central.

В этом руководстве описано следующее:

> [!div class="checklist"]
> * создание шаблона для устройства IoT Edge;
> * создание устройства IoT Edge в IoT Central;
> * развертывание имитированного устройства IoT Edge на виртуальной машине Linux.

## <a name="prerequisites"></a>Предварительные требования

Выполните инструкции из краткого руководства [Создание приложения Azure IoT Central](./quick-deploy-iot-central.md), чтобы создать приложение IoT Central с помощью шаблона **Пользовательское приложение > Пользовательское приложение**.

Для работы с этим учебником требуется активная подписка Azure.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

Скачайте файл манифеста IoT Edge на GitHub. Щелкните ссылку ниже правой кнопкой мыши и выберите пункт **Сохранить ссылку как**. [EnvironmentalSensorManifest.json](https://raw.githubusercontent.com/Azure-Samples/iot-central-docs-samples/master/iotedge/EnvironmentalSensorManifest.json)

## <a name="create-device-template"></a>Создание шаблона устройства

В этом разделе вы создадите шаблон для устройства IoT Edge, которое будет подключаться к приложению IoT Central. Для начала импортируйте манифест IoT Edge, а затем измените шаблон, добавив определения телеметрии и представления.

### <a name="import-manifest-to-create-template"></a>Импорт манифеста для создания шаблона

Чтобы создать шаблон устройства на основе манифеста IoT Edge, выполните следующие действия.

1. В приложении IoT Central перейдите в раздел **Шаблоны устройств** и щелкните **+ Создать**.

1. На странице **Select template type** (Выбрать тип шаблона) выберите плитку **Azure IoT Edge**. Затем щелкните **Next: Настройка**.

1. На странице **Upload an Azure IoT Edge deployment manifest** (Отправка манифеста развертывания Azure IoT Edge) щелкните **Обзор**, чтобы загрузить файл **EnvironmentalSensorManifest.json**, скачанный ранее. Затем щелкните **Next: Review** (Далее: проверка).

1. На странице **Отзыв** выберите **Создать**.

1. После создания шаблона измените его имя на *Устройство Edge с датчиком окружающей среды*.

1. Щелкните интерфейс **Управление** в модуле **SimulatedTemperatureSensor**, чтобы просмотреть два свойства, определенные в манифесте:

![Шаблон устройства, созданный на основе манифеста IoT Edge](./media/tutorial-add-edge-as-leaf-device/imported-manifest.png)

### <a name="add-telemetry-to-manifest"></a>Добавление телеметрии в манифест

Манифест IoT Edge не определяет телеметрию, которую отправляет модуль. Необходимо добавить определения телеметрии в шаблон устройства. Модуль **SimulatedTemperatureSensor** отправляет сообщения телеметрии, которые выглядят как следующий код JSON:

```json
{
    "machine": {
        "temperature": 75.0,
        "pressure": 40.2
    },
    "ambient": {
        "temperature": 23.0,
        "humidity": 30.0
    },
    "timeCreated": ""
}
```

Чтобы добавить определения телеметрии в шаблон устройства, выполните шаги ниже:

1. Выберите интерфейс **Управление** в шаблоне **Устройство Edge с датчиком окружающей среды**.

1. Нажмите кнопку **+ Добавить возможность**. Введите *machine* как **отображаемое имя** и убедитесь, что для параметра **Тип возможности** установлено значение **Телеметрия**.

1. Выберите значение **Объект** для параметра типа схемы, а затем щелкните **Определить**. На странице определения объекта добавьте *temperature* и *pressure* как атрибуты типа **Двойной**, а затем щелкните **Применить**.

1. Нажмите кнопку **+ Добавить возможность**. Введите *ambient* как **отображаемое имя** и убедитесь, что для параметра **Тип возможности** установлено значение **Телеметрия**.

1. Выберите значение **Объект** для параметра типа схемы, а затем щелкните **Определить**. На странице определения объекта добавьте *temperature* и *humidity* как атрибуты типа **Двойной**, а затем щелкните **Применить**.

1. Нажмите кнопку **+ Добавить возможность**. Введите *timeCreated* как **отображаемое имя** и убедитесь, что для параметра **Тип возможности** установлено значение **Телеметрия**.

1. Выберите **DateTime** в качестве типа схемы.

1. Щелкните **Сохранить**, чтобы обновить этот шаблон.

Интерфейс **Управление** теперь содержит типы телеметрии **machine**, **ambient** и **timeCreated**.

![Интерфейс с типами телеметрии компьютера и окружающей среды](./media/tutorial-add-edge-as-leaf-device/manage-interface.png)

### <a name="add-views-to-template"></a>Добавление представлений в шаблон

В шаблоне устройства еще нет представления, которое позволяло бы оператору просматривать данные телеметрии с устройства IoT Edge. Чтобы добавить такое представление в шаблон устройства, выполните следующие действия.

1. Выберите раздел **Представления** в шаблоне **Устройство Edge с датчиком окружающей среды**.

1. На странице **Select to add a new view** (Добавление нового представления) щелкните плитку **Визуализация устройства**.

1. Измените имя представления на *Просмотр телеметрии устройства IoT Edge*.

1. Выберите типы телеметрии **ambient** и **machine**. Затем нажмите кнопку **Добавить плитку**.

1. Щелкните **Сохранить**, чтобы сохранить представление **Просмотр телеметрии устройства IoT Edge**.

![Шаблон устройства с представлением телеметрии](./media/tutorial-add-edge-as-leaf-device/template-telemetry-view.png)

### <a name="publish-the-template"></a>Публикация шаблона

Чтобы можно было добавить устройство, которое использует шаблон **Устройство Edge с датчиком окружающей среды**, необходимо опубликовать этот шаблон.

Перейдите к шаблону **Устройство Edge с датчиком окружающей среды** и нажмите значок **Опубликовать**. Затем нажмите кнопку **Опубликовать**, чтобы опубликовать шаблон.

![Публикация шаблона устройства](./media/tutorial-add-edge-as-leaf-device/publish-template.png)

## <a name="add-iot-edge-device"></a>Добавление устройства IoT Edge

После публикации шаблона **Устройство Edge с датчиком окружающей среды** можно добавить устройство в приложение IoT Central:

1. В приложении IoT Central перейдите на страницу **Устройства** и щелкните **Устройство Edge с датчиком окружающей среды** в списке доступных шаблонов.

1. Щелкните значок **+**, чтобы добавить новое устройство из шаблона. На странице **Создание устройства** щелкните **Создать**.

Теперь у вас есть новое устройство с состоянием **Зарегистрировано**:

![Публикация шаблона устройства](./media/tutorial-add-edge-as-leaf-device/new-device.png)

### <a name="get-the-device-credentials"></a>Получение учетных данных устройства

При развертывании устройства IoT Edge далее в этом руководстве необходимы учетные данные, которые позволят устройству подключаться к приложению IoT Central. Чтобы получить учетные данные устройства, выполните шаги ниже:

1. На странице **Устройства** выберите устройство, которое вы только что создали.

1. Выберите **Подключиться**.

1. На странице **Подключение к устройству** запишите значения параметров **Область идентификатора**, **ИД устройства** и **Первичный ключ**. Эти значения понадобятся позже.

1. Выберите **Закрыть**.

Теперь вы настроили в приложении IoT Central возможность подключения устройства IoT Edge.

## <a name="deploy-an-iot-edge-device"></a>Развертывание на устройстве IoT Edge

В этом учебнике вы используете виртуальную машину Linux с поддержкой Azure IoT Edge, созданную в Azure для имитации устройства IoT Edge. Чтобы создать виртуальную машину с поддержкой IoT Edge, выполните следующие действия.

1. В Azure Marketplace выберите [Azure IoT Edge on Ubuntu](https://azuremarketplace.microsoft.com/marketplace/apps/microsoft_iot_edge.iot_edge_vm_ubuntu?tab=Overview) (Azure IoT Edge в Ubuntu). Нажмите кнопку **ПОЛУЧИТЬ**.

1. На странице **Создать это приложение в Azure** нажмите кнопку **Продолжить**. Эта ссылка позволяет перейти на портал Azure, где может потребоваться войти в подписку Azure.

1. На странице **Azure IoT Edge on Ubuntu** (Azure IoT Edge в Ubuntu) на портале Azure щелкните **Создать**.

1. На странице **Создание виртуальной машины > Основные сведения** сделайте следующее.

    - Выберите подписку Azure.
    - Создайте группу ресурсов с именем **iot-edge-devices**.
    - Используйте имя виртуальной машины **iotedgevm**.
    - Выберите ближайший регион.
    - В качестве типа проверки подлинности выберите значение **Пароль**.
    - Задайте имя пользователя и пароль.
    - Для других параметров оставьте значения по умолчанию.
    - Выберите **Review + create** (Просмотреть и создать).

1. После завершения проверки щелкните **Создать**.

Когда через несколько минут развертывание будет завершено, щелкните **Перейти к ресурсу**.

### <a name="provision-vm-as-an-iot-edge-device"></a>Подготовка виртуальной машины как устройства IoT Edge 

Подготовка виртуальной машины как устройства IoT Edge

1. В разделе **Поддержка и устранение неполадок** щелкните **Последовательная консоль**.

1. Нажмите клавишу **ВВОД**, чтобы просмотреть запрос `login:`. Введите имя пользователя и пароль для входа.

1. Выполните следующую команду, чтобы проверить версию среды выполнения IoT Edge. На момент написания статьи это версия 1.0.8.

    ```bash
    sudo iotedge --version
    ```

1. Используйте редактор `nano`, чтобы открыть файл config.yaml IoT Edge.

    ```bash
    sudo nano /etc/iotedge/config.yaml
    ```

1. Прокручивайте код вниз, пока не отобразится `# Manual provisioning configuration`. Закомментируйте следующие три строки, как показано в следующем фрагменте кода:

    ```yaml
    # Manual provisioning configuration
    #provisioning:
    #  source: "manual"
    #  device_connection_string: "<ADD DEVICE CONNECTION STRING HERE>"
    ```

1. Прокручивайте код вниз, пока не отобразится `# DPS symmetric key provisioning configuration`. Раскомментируйте следующие восемь строк, как показано в следующем фрагменте кода:

    ```yaml
    # DPS symmetric key provisioning configuration
    provisioning:
      source: "dps"
      global_endpoint: "https://global.azure-devices-provisioning.net"
      scope_id: "{scope_id}"
      attestation:
        method: "symmetric_key"
        registration_id: "{registration_id}"
        symmetric_key: "{symmetric_key}"
    ```

1. Замените `{scope_id}` значением **области идентификатора**, которое вы записали ранее.

1. Замените `{registration_id}` **идентификатором устройства**, который вы записали ранее.

1. Замените `{symmetric_key}` **первичным ключом**, который вы записали ранее.

1. Сохраните изменения (нажмите клавиши **CTRL+O**) и выйдите из редактора `nano` (**CTRL+X**).

1. Выполните следующую команду, чтобы перезапустить управляющую программу IoT Edge:

    ```bash
    sudo systemctl restart iotedge
    ```

1. Чтобы проверить состояние модулей IoT Edge, выполните следующую команду:

    ```bash
    iotedge list
    ```

    Данные результата выглядят следующим образом:

    ```bash
    NAME                        STATUS           DESCRIPTION      CONFIG
    SimulatedTemperatureSensor  running          Up 20 seconds    mcr.microsoft.com/azureiotedge-simulated-temperature-sensor:1.0
    edgeAgent                   running          Up 27 seconds    mcr.microsoft.com/azureiotedge-agent:1.0
    edgeHub                     running          Up 22 seconds    mcr.microsoft.com/azureiotedge-hub:1.0
    ```

## <a name="view-the-telemetry"></a>Просмотр телеметрии

Имитированное устройство IoT Edge теперь работает в виртуальной машине. В приложении IoT Central на странице **Устройства** теперь отображается состояние устройства **Подготовлено**:

![Подготовленное устройство](./media/tutorial-add-edge-as-leaf-device/provisioned-device.png)

Данные телеметрии можно просмотреть на странице **Просмотр телеметрии устройства IoT Edge**.

![Телеметрия устройства](./media/tutorial-add-edge-as-leaf-device/device-telemetry-view.png)

На странице **Модули** отображается состояние модулей IoT Edge:

![Телеметрия устройства](./media/tutorial-add-edge-as-leaf-device/edge-module-status.png)

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы узнали, как управлять устройствами IoT Edge в IoT Central, перейдите к дальнейшему рекомендуемому шагу:

<!-- Next how-tos in the sequence -->

> [!div class="nextstepaction"]
> [Настройка прозрачного шлюза](../../iot-edge/how-to-create-transparent-gateway.md)
