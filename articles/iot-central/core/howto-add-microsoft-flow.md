---
title: Создание рабочих процессов с помощью соединителя Azure IoT Central в Microsoft Flow | Документация Майкрософт
description: Используйте соединитель IoT Central в Microsoft Flow, чтобы активировать рабочие процессы, а также создавать, получать, обновлять, удалять устройства и выполнять команды в рабочих процессах.
services: iot-central
author: viv-liu
ms.author: viviali
ms.date: 08/26/2019
ms.topic: conceptual
ms.service: iot-central
manager: hegate
ms.openlocfilehash: 258020c8ccd690c524460873387293e73fc89125
ms.sourcegitcommit: 4c3d6c2657ae714f4a042f2c078cf1b0ad20b3a4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/25/2019
ms.locfileid: "72951735"
---
# <a name="build-workflows-with-the-iot-central-connector-in-microsoft-flow"></a>Создание рабочих процессов с помощью соединителя IoT Central в Microsoft Flow

*Этот раздел предназначен для разработчиков и администраторов.*

[!INCLUDE [iot-central-original-pnp](../../../includes/iot-central-original-pnp-note.md)]

Microsoft Flow позволяет автоматизировать рабочие процессы во многих приложениях и службах, которые используют бизнес-пользователи. С помощью соединителя IoT Central в Microsoft Flow можно настроить запуск рабочих процессов при срабатывании правила в IoT Central. В рабочем процессе, запущенном IoT Central или любым другим приложением, вы можете использовать действия в соединителе IoT Central, чтобы:
- Создание устройства
- Получение сведений об устройстве
- Обновление свойств и параметров устройства
- Выполнение команды на устройстве
- Удалить устройство.

Ознакомьтесь с [этими шаблонами Microsoft Flow](https://aka.ms/iotcentralflowtemplates), которые подключают IoT Central к другим службам, таким как мобильные уведомления и Microsoft Teams.

## <a name="prerequisites"></a>Технические условия

- приложение с оплатой по мере использования;
- Личная или рабочая или учебная учетная запись Майкрософт для использования Microsoft Flow (дополнительные[сведения о планах Microsoft Flow](https://aka.ms/microsoftflowplans))
- Рабочая или учебная учетная запись для использования соединителя Azure IoT Central

## <a name="trigger-a-workflow"></a>Активация рабочего процесса

В этом разделе показано, как активировать мобильное уведомление в мобильном приложении Flow, когда правило срабатывает в IoT Central. Вы можете создать весь рабочий процесс в IoT Central приложении с помощью встроенного конструктора Microsoft Flow.

1. Начнем с [создавая правила в IoT Central](howto-create-telemetry-rules.md). После сохранения условий правила выберите **действие Microsoft Flow** в качестве нового действия. Откроется диалоговое окно для настройки рабочего процесса. IoT Central учетная запись пользователя, в которую вы вошли, будет использоваться для входа в Microsoft Flow.

    ![Создание действия Microsoft Flow](media/howto-add-microsoft-flow/createflowaction.png)

1. Вы увидите список рабочих процессов, к которым у вас есть доступ и которые прикрепляются к этому правилу IoT Central. Щелкните **просмотреть шаблоны** или создать **> создать на основе шаблона** . Вы можете выбрать любой из доступных шаблонов. 

    ![Доступные шаблоны Microsoft Flow](media/howto-add-microsoft-flow/flowtemplates1.png)

1. Вам будет предложено войти в соединители в выбранном шаблоне. 

    > [!NOTE]
    > Чтобы использовать соединитель Azure IoT Central, необходимо выполнить вход с помощью учетной записи Azure Active Directory (Рабочая или учебная учетная запись). Соединитель Azure IoT Central не поддерживает личную учетную запись, например abc@outlook.com или abc@live.com.

    После входа в соединители вы научитесь создавать рабочий процесс в конструкторе. Рабочий процесс имеет триггер IoT Central, для которого уже указаны ваше приложение и правило.

1. Вы можете настроить рабочий процесс, настроив сведения, передаваемые в действие, и добавив новые действия. В этом примере действие — **уведомления — отправлять мне мобильное уведомление**. Вы можете добавить *динамическое содержимое* из своего правила IoT Central, передав важные сведения, например имя устройства и метку времени для вашего уведомления.

    > [!NOTE]
    > Чтобы получить значения измерений и свойств, которые активировали правило, выберите в окне динамического содержимого пункт **Показать больше** текста.

    ![Действие редактирования с открытой динамической панелью в приложение Flow](./media/howto-add-microsoft-flow/flowdynamicpane1.png)

1. Завершив изменение действия, нажмите кнопку **сохранить**. Вы будете перенаправлены на страницу обзора рабочего процесса. Здесь вы можете просмотреть журнал выполнения и предоставить к нему доступ коллегам.

    > [!NOTE]
    > Если вы хотите, чтобы другие пользователи в вашем приложении IoT Central имели возможность редактировать это правило, нужно предоставить им доступ к нему в Microsoft Flow. Добавьте их учетные записи Microsoft Flow в качестве владельцев в рабочий процесс.

1. Если вернуться в приложение IoT Central, вы увидите, что это правило содержит действие Microsoft Flow в области действия.

Вы также можете создавать рабочие процессы с помощью соединителя IoT Central непосредственно из Microsoft Flow. Затем можно выбрать, к какому IoT Central приложению подключиться.

## <a name="create-a-device-in-a-workflow"></a>Создание устройства в рабочем процессе

В этом разделе показано, как создать новое устройство в IoT Central с помощью кнопки на мобильном устройстве, используя мобильное приложение Microsoft Flow. Вы можете использовать это действие в Flow для интеграции ERP-систем, таких как Dynamics, с IoT Central путем создания нового устройства, когда устройство добавлено в другое расположение.

1. Начните с создания пустого рабочего процесса в Microsoft Flow.

1. В качестве триггера найдите **кнопку потока для мобильных устройств**.

1. В этом триггере добавьте текстовое поле с именем **Имя устройства**. Измените текст описания на **Введите имя нового устройства**.

1. Добавьте новое действие. Найдите действие **Azure IoT Central - Create a device** (Azure IoT Central — Создать устройство).

1. Выберите приложение и шаблон устройства, чтобы создать устройство в раскрывающихся списках. Развернется действие, в котором будут указаны все свойства и параметры устройства.

1. Выберите поле "Имя устройства". На панели динамического содержимого выберите **Имя устройства**. Это значение передается из входных данных, вводимых пользователем в мобильное приложение, и является именем нового устройства в IoT Central. В этом примере единственным обязательным полем является "Имя устройства", обозначенное красной звездочкой. Другой шаблон устройства может содержать несколько обязательных полей, которые необходимо заполнить для создания нового устройства.

    ![Динамическая панель действия создания устройства в приложении Flow](./media/howto-add-microsoft-flow/flowcreatedevice1.png)

1. (Необязательно.) Заполните другие поля, которые, по вашему мнению, необходимы для создания новых устройств.

1. Наконец, сохраните рабочий процесс.

1. Попробуйте запустить свой рабочий процесс в мобильном приложении Microsoft Flow. Перейдите на вкладку **Кнопки** в приложении. Вы должны увидеть область Button -> Create a new device workflow (Кнопка -> Создать рабочий процесс нового устройства). Введите имя своего нового устройства и проверьте, отображается ли оно в IoT Central.

    ![Снимок экрана создания мобильного устройства в приложении Flow](./media/howto-add-microsoft-flow/flowmobilescreenshot.png)

## <a name="update-a-device-in-a-workflow"></a>Обновление устройства в рабочем процессе

В этом разделе показано, как обновить параметры и свойства устройства в IoT Central с помощью кнопки на мобильном устройстве в мобильном приложении Microsoft Flow.

1. Начните с создания пустого рабочего процесса в Microsoft Flow.

1. В качестве триггера найдите **кнопку потока для мобильных устройств**.

1. В этом триггере добавьте входные данные, например **расположение**, которое соответствует параметру или свойству, которое вы хотите изменить. Измените описание.

1. Добавьте новое действие. Найдите действие **Azure IoT Central - Update a device** (Azure IoT Central — Обновить устройство).

1. Выберите свое приложение из раскрывающегося списка. Теперь вам потребуется идентификатор имеющегося устройства, которое вы хотите обновить. 

    > [!NOTE] 
    > **Необходимо использовать идентификатор, найденный в URL-адресе** на странице сведений об устройстве устройства, которое требуется обновить. ИДЕНТИФИКАТОР устройства, найденный в списке устройств в обозревателе устройств, не подходит для использования в Microsoft Flow.

    ![Идентификатор IoT Central из URL-адреса](./media/howto-add-microsoft-flow/iotcdeviceidurl.png)

1. Вы можете обновить имя устройства. Чтобы обновить любые свойства и параметры устройства, выберите шаблон устройства, которое вы хотите обновить, в раскрывающемся списке **Device Template** (Шаблон устройства). Развернется плитка действия, на которой будут показаны все свойства и параметры, которые вы можете обновить.

    ![Обновление рабочего процесса устройства в Flow](./media/howto-add-microsoft-flow/flowupdatedevice1.png)

1. Выберите свойства и параметры, которые нужно обновить. На панели динамического содержимого выберите соответствующие входные данные из триггера. В этом примере значение "Расположение" перемещено вниз для обновления свойства расположения устройства.

1. Наконец, сохраните рабочий процесс.

1. Попробуйте запустить свой рабочий процесс в мобильном приложении Microsoft Flow. Перейдите на вкладку **Кнопки** в приложении. Вы должны увидеть область Button -> Update a device workflow (Кнопка -> Обновить рабочий процесс устройства). Введите входные данные и посмотрите, как устройство обновляется в IoT Central.

## <a name="get-device-information-in-a-workflow"></a>Получение сведений об устройстве в рабочем процессе

Сведения об устройстве можно получить по ИДЕНТИФИКАТОРу, используя действие **Azure IOT Central — получение устройства** . 
> [!NOTE] 
> **Необходимо использовать идентификатор, найденный в URL-адресе** на странице сведений об устройстве устройства, которое требуется обновить. ИДЕНТИФИКАТОР устройства, найденный в списке устройств в обозревателе устройств, не подходит для использования в Microsoft Flow.

Вы можете получить такие сведения, как имя устройства, имя шаблона устройства, значения свойств и значения параметров, чтобы передать их в последующие действия в рабочем процессе. Ниже приведен пример рабочего процесса, который передает значение свойства Customer Name с устройства в Microsoft Teams.

   ![Поток операций получения устройства](./media/howto-add-microsoft-flow/flowgetdevice1.png)


## <a name="run-a-command-on-a-device-in-a-workflow"></a>Выполнение команды на устройстве в рабочем процессе
Вы можете выполнить команду на устройстве, указанном с помощью идентификатора, используя **IOT Central Azure — выполнить действие команды** . 

> [!NOTE] 
> **Необходимо использовать идентификатор, найденный в URL-адресе** на странице сведений об устройстве устройства, которое требуется обновить. ИДЕНТИФИКАТОР устройства, найденный в списке устройств в обозревателе устройств, не подходит для использования в Microsoft Flow.
    
Вы можете выбрать команду для запуска и передать параметры команды с помощью этого действия. Ниже приведен пример рабочего процесса, который запускает команду перезагрузки устройства из кнопки в мобильном приложении Microsoft Flow.

   ![Поток операций получения устройства](./media/howto-add-microsoft-flow/flowrunacommand1.png)

## <a name="delete-a-device-in-a-workflow"></a>Удаление устройства в рабочем процессе

Вы можете удалить устройство по его ИДЕНТИФИКАТОРу, используя действие **Azure IOT Central — удаление устройства** . 
> [!NOTE] 
> **Необходимо использовать идентификатор, найденный в URL-адресе** на странице сведений об устройстве устройства, которое требуется обновить. ИДЕНТИФИКАТОР устройства, найденный в списке устройств в обозревателе устройств, не подходит для использования в Microsoft Flow.

Ниже приведен пример рабочего процесса, который позволяет удалить устройство с помощью кнопки в мобильном приложении Microsoft Flow.

   ![Удаление рабочего процесса в приложении Flow](./media/howto-add-microsoft-flow/flowdeletedevice.png)

## <a name="troubleshooting"></a>Устранение неисправностей

Ниже приведены несколько советов на случай, если вам не удается подключиться к соединителю Azure IoT Central.

1. Личные учетные записи Майкрософт (например, домены @hotmail.com, @live.com, @outlook.com) в настоящее время не поддерживаются. Необходимо использовать рабочую или учебную учетную запись Azure Active Directory (AD).

2. Чтобы использовать соединитель IoT Central в Microsoft Flow, необходимо по крайней мере один раз войти в приложение IoT Central. В противном случае приложение не будет отображаться в раскрывающихся списках приложения.

3. Если при использовании учетной записи Azure AD возникает ошибка, попробуйте открыть Windows PowerShell и запустите следующую командлеты от имени администратора.

    ``` PowerShell
    Install-Module AzureAD
    Connect-AzureAD
    New-AzureADServicePrincipal -AppId 9edfcdd9-0bc5-4bd4-b287-c3afc716aac7 -DisplayName "Azure IoT Central"
    ```

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы узнали, как использовать Microsoft Flow для создания рабочих процессов, предлагаем следующий шаг — [Управление устройствами](howto-manage-devices.md).

