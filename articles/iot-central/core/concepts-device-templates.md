---
title: Что такое шаблоны устройств в Azure IoT Central | Документация Майкрософт
description: Шаблоны устройств IoT Central Azure позволяют указать поведение устройств, подключенных к приложению. В шаблоне устройства указываются данные телеметрии, свойства и команды, которые должны быть реализованы устройством. Шаблон устройства также определяет пользовательский интерфейс для устройства в IoT Central таких как формы и панели мониторинга, используемые оператором.
author: dominicbetts
ms.author: dobett
ms.date: 05/21/2020
ms.topic: conceptual
ms.service: iot-central
services: iot-central
ms.custom: device-developer
ms.openlocfilehash: 75317b5c6af2d0ce89d2db32f4343d9cc73a1a81
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "91813174"
---
# <a name="what-are-device-templates"></a>Что представляют собой шаблоны устройств?

_Эта статья относится к разработчикам устройств и сборщикам решений._

Шаблон устройства в Azure IoT Central — это схема, которая определяет характеристики и поведение типа устройства, которое подключается к приложению. Например, шаблон устройства определяет данные телеметрии, которые отправляет устройство, чтобы IoT Central могли создавать визуализации, использующие правильные единицы и типы данных.

Построитель решений добавляет шаблоны устройств в приложение IoT Central. Разработчик устройства записывает код устройства, который реализует поведение, определенное в шаблоне устройства.

Шаблон устройства включает в себя следующие разделы:

- _Модель возможностей устройства (DCM)_. Эта часть шаблона устройства определяет, как устройство взаимодействует с вашим приложением. Разработчик устройства реализует поведение, определенное в DCM.
    - _Интерфейсы_. DCM содержит один или несколько интерфейсов, определяющих данные телеметрии, свойств и команд, которые должны быть реализованы устройством.
- _Свойства облака_. Эта часть шаблона устройства позволяет разработчику решения указать метаданные устройства для хранения. Свойства облака никогда не синхронизируются с устройствами и существуют только в приложении. Свойства облака не влияют на код, который разработчик устройства записывает для реализации DCM.
- _Настройки_. Эта часть шаблона устройства позволяет разработчику решения переопределить некоторые определения в DCM. Настройки полезны, если разработчик решения хочет уточнить, как приложение обрабатывает значение, например изменение отображаемого имени свойства или цвета, используемого для отображения значения телеметрии. Настройки не влияют на код, который разработчик устройства записывает для реализации DCM.
- _Представления_. Эта часть шаблона устройства позволяет разработчику решений определять визуализации для просмотра данных с устройства и форм для управления устройством и его контроля. В представлениях используются DCM, облачные свойства и настройки. Представления не влияют на код, который разработчик устройства записывает для реализации DCM.

## <a name="device-capability-models"></a>Модели возможностей устройства

DCM определяет, как устройство взаимодействует с приложением IoT Central. Разработчик устройства должен убедиться, что устройство реализует поведение, определенное в DCM, чтобы IoT Central может отслеживать устройство и управлять им. DCM состоит из одного или нескольких _интерфейсов_, и каждый интерфейс может определять коллекцию типов _телеметрии_ , _свойств устройств_и _команд_. Разработчик решения может импортировать файл JSON, который определяет DCM, в шаблон устройства или использовать веб-интерфейс в IoT Central для создания или изменения DCM. Для изменения DCM, созданной с помощью веб-интерфейса, требуется [Управление версиями шаблона устройства](./howto-version-device-template.md).

Разработчик решения также может экспортировать JSON-файл, содержащий DCM. Разработчик устройства может использовать этот документ JSON, чтобы понять, как устройство должно взаимодействовать с IoT Central приложением.

JSON-файл, определяющий DCM, использует [язык определения цифровых двойника (дтдл) v1](https://github.com/Azure/IoTPlugandPlay/tree/master/DTDL). IoT Central файл JSON должен содержать данные DCM с интерфейсами, определенными встроенными, а не отдельными файлами.

Типичное устройство Интернета вещей состоит из:

- Пользовательские части — это вещи, которые делают устройство уникальным.
- Стандартные части — это вещи, общие для всех устройств.

Эти части называются _интерфейсами_ в DCM. Интерфейсы определяют сведения о каждой части, реализуемой устройством. Интерфейсы можно многократно использовать в Дкмс.

В следующем примере показана структура модели возможностей устройства для датчика окружающей среды с двумя интерфейсами:

```json
{
  "@id": "urn:contoso:sensor_device:1",
  "@type": "CapabilityModel",
  "displayName": "Environment Sensor Capability Model",
  "implements": [
    {
      "@type": "InterfaceInstance",
      "name": "deviceinfo",
      "schema": {
        "@id": "urn:azureiot:DeviceManagement:DeviceInformation:1",
        "@type": "Interface",
        "displayName": "Device Information",
        "@context": "http://azureiot.com/v1/contexts/IoTModel.json",
        "contents": [
          ...
        ]
      }
    },
    {
      "@type": "InterfaceInstance",
      "name": "sensor",
      "schema": {
        "@id": "urn:contoso:EnvironmentalSensor:1",
        "@type": "Interface",
        "displayName": "Environmental Sensor",
        "@context": "http://azureiot.com/v1/contexts/IoTModel.json",
        "contents": [
          ...
        ]
      }
    }
  ],
  "@context": "http://azureiot.com/v1/contexts/IoTModel.json"
}
```

Модель возможностей содержит некоторые обязательные поля:

- `@id`: уникальный идентификатор в виде простого универсального имени ресурса.
- `@type`: объявляет, что этот объект является моделью возможностей.
- `@context`: указывает версию ДТДЛ, используемую для модели возможностей.
- `implements`: перечисляет интерфейсы, реализуемые устройством.

Каждая запись в списке интерфейсов в разделе Implements имеет:

- `name`: Программное имя интерфейса.
- `schema`: интерфейс, реализуемый моделью возможностей.

У интерфейса есть несколько обязательных полей:

- `@id`: уникальный идентификатор в виде простого универсального имени ресурса.
- `@type`: объявляет, что этот объект является интерфейсом.
- `@context`: указывает версию ДТДЛ, используемую для интерфейса.
- `contents`: перечисляет свойства, данные телеметрии и команды, составляющие устройство.

Есть некоторые необязательные поля, которые можно использовать для добавления дополнительных сведений в модель возможностей, например отображаемое имя и описание.

## <a name="interfaces"></a>Интерфейсы

ДТДЛ позволяет описать возможности устройства. Связанные возможности группируются в интерфейсы. Интерфейсы описывают свойства, телеметрию и команды, которые компонент реализует:

- `Properties`. Свойства — это поля данных, которые представляют состояние устройства. Используйте свойства, чтобы представить устойчивое состояние устройства, например состояние кулант насоса. Свойства могут также представлять базовые свойства устройства, такие как версия встроенного по устройства. Свойства можно объявлять как доступные только для чтения или доступные для записи. Только устройства могут обновлять значение свойства, доступного только для чтения. Оператор может установить значение свойства, доступного для записи, для отправки на устройство.
- `Telemetry`. Поля телеметрии представляют измерения датчиков. Когда устройство принимает измерения датчика, оно должно отправить событие телеметрии, содержащее данные датчика.
- `Commands`. Команды представляют методы, которые пользователи устройства могут выполнять на устройстве. Например, команда reset или команда для переключения вентилятора.

В следующем примере показано определение интерфейса датчика среды:

```json
{
  "@type": "Property",
  "displayName": "Device State",
  "description": "The state of the device. Two states online/offline are available.",
  "name": "state",
  "schema": "boolean"
},
{
  "@type": "Property",
  "displayName": "Customer Name",
  "description": "The name of the customer currently operating the device.",
  "name": "name",
  "schema": "string",
  "writable": true
},
{
  "@type": [
    "Telemetry",
    "SemanticType/Temperature"
  ],
  "description": "Current temperature on the device",
  "displayName": "Temperature",
  "name": "temp",
  "schema": "double",
  "unit": "Units/Temperature/fahrenheit"
},
{
  "@type": "Command",
  "name": "turnon",
  "comment": "This Commands will turn-on the LED light on the device.",
  "commandType": "synchronous"
},
{
  "@type": "Command",
  "name": "turnoff",
  "comment": "This Commands will turn-off the LED light on the device.",
  "commandType": "synchronous"
}
```

В этом примере показаны два свойства (один доступ только для чтения и один для записи), тип телеметрии и две команды. Минимальное описание поля имеет:

- `@type` для указания типа возможности: `Telemetry` , `Property` или `Command` .  В некоторых случаях тип включает семантический тип, позволяющий IoT Central сделать некоторые предположения о том, как справиться со значением.
- `name` для значения телеметрии.
- `schema` для указания типа данных телеметрии или свойства. Это значение может быть примитивным типом, например Double, Integer, Boolean или String. Также поддерживаются сложные типы объектов, массивы и карты.
- `commandType` для указания способа обработки команды.

Необязательные поля, такие как отображаемое имя и описание, позволяют добавлять дополнительные сведения в интерфейс и возможности.

## <a name="properties"></a>Свойства

По умолчанию свойства доступны только для чтения. Свойства только для чтения означают, что устройство сообщает значение свойства в приложении IoT Central. Приложение IoT Central не может установить значение свойства, доступного только для чтения.

Можно также пометить свойство как записываемое в интерфейсе. Устройство может получить обновление свойства, доступного для записи, из приложения IoT Central, а также отчеты об обновлениях значений свойств для приложения.

Устройства не нужно подключать для задания значений свойств. Обновленные значения передаются при следующем подключении устройства к приложению. Это поведение применимо как к свойствам только для чтения, так и к записываемым.

Не используйте свойства для отправки данных телеметрии с устройства. Например, свойство ReadOnly, например, `temperatureSetting=80` должно означать, что для температуры устройства установлено значение 80, а устройство пытается получить или остаться в этой температуре.

Для свойств, доступных для записи, приложение устройства возвращает код состояния требуемого состояния, версию и описание, чтобы указать, получил ли он значение свойства и применял его.

## <a name="telemetry"></a>Телеметрия

IoT Central позволяет просматривать данные телеметрии на панелях мониторинга и диаграммах, а также использовать правила для активации действий при достижении пороговых значений. IoT Central использует сведения в DCM, например типы данных, единицы и отображаемые имена, чтобы определить способ отображения значений телеметрии.

Функцию экспорта данных IoT Central можно использовать для потоковой передачи телеметрии в другие назначения, такие как хранилище или концентраторы событий.

## <a name="commands"></a>Команды

Команды синхронные или асинхронные. По умолчанию Синхронная команда должна выполняться в течение 30 секунд, а при получении команды устройство должно быть подключено. Если устройство отвечает вовремя или устройство не подключено, команда завершается ошибкой.

Используйте асинхронные команды для выполнения длительных операций. Устройство отправляет сведения о ходе выполнения с помощью сообщений телеметрии. Эти сообщения о ходе выполнения имеют следующие свойства заголовка:

- `iothub-command-name`— имя команды, например `UpdateFirmware` .
- `iothub-command-request-id`: идентификатор запроса, созданный на стороне сервера и отправленный на устройство при первом вызове.
- `iothub-interface-id`— Идентификатор интерфейса, для которого определена эта команда, например `urn:example:AssetTracker:1` .
 `iothub-interface-name`— имя экземпляра этого интерфейса, например `myAssetTracker` .
- `iothub-command-statuscode`— код состояния, возвращенный с устройства, например `202` .

## <a name="cloud-properties"></a>Свойства облака

Свойства облака являются частью шаблона устройства, но не являются частью DCM. Свойства облака позволяют разработчику решения указать метаданные устройства для хранения в IoT Central приложении. Свойства облака не влияют на код, который разработчик устройства записывает для реализации DCM.

Разработчик решения может добавить свойства облака в панели мониторинга и представления вместе со свойствами устройства, чтобы позволить оператору управлять устройствами, подключенными к приложению. Разработчик решения также может использовать облачные свойства как часть определения правила, чтобы сделать пороговое значение доступным для изменения оператором.

## <a name="customizations"></a>Настройки

Настройки являются частью шаблона устройства, но не являются частью DCM. Настройки позволяют разработчику решения усовершенствовать или переопределить некоторые определения в DCM. Например, разработчик решения может изменить отображаемое имя для типа телеметрии или свойства. Разработчик решения также может использовать настройки для добавления проверки, например минимальной или максимальной длины для свойства устройства строки.

Настройки могут повлиять на код, записываемый разработчиком устройства для реализации DCM. Например, настройка может установить минимальную и максимальную длину строк или минимальное и максимальное числовые значения для телеметрии.

## <a name="views"></a>Представления

Разработчик решения создает представления, которые позволяют операторам отслеживать подключенные устройства и управлять ими. Представления являются частью шаблона устройства, поэтому представление связано с конкретным типом устройства. Представление может включать:

- Диаграммы для построения данных телеметрии.
- Плитки для просмотра свойств устройства, доступного только для чтения.
- Плитки, позволяющие оператору изменять свойства устройства, доступного для записи.
- Плитки, позволяющие оператору изменять свойства облака.
- Плитки, чтобы позволить оператору вызывать команды, включая команды, для которых требуются полезные данные.
- Плитки для вывода меток, изображений или Markdown текста.

Данные телеметрии, свойства и команды, которые можно добавить в представление, определяются DCM, облачными свойствами и настройками в шаблоне устройства.

## <a name="next-steps"></a>Дальнейшие шаги

Теперь, когда разработчик устройства познакомились с шаблонами устройств, мы предлагаем следующие шаги для чтения [полезных данных телеметрии, свойств и команд](./concepts-telemetry-properties-commands.md) для получения дополнительных сведений об обмене данными с IOT Central.

Как разработчик решения, предлагаемый следующий шаг — прочитать [Определение нового типа устройства IOT в приложении Azure IOT Central](./howto-set-up-template.md) , чтобы узнать больше о том, как создать шаблон устройства.
