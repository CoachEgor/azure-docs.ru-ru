---
title: Подключение устройства в Azure IoT Central | Документация Майкрософт
description: В этой статье описаны ключевые понятия, связанные с подключением устройства в Azure IoT Central.
author: dominicbetts
ms.author: dobett
ms.date: 12/09/2019
ms.topic: conceptual
ms.service: iot-central
services: iot-central
manager: philmea
ms.openlocfilehash: 8178e585ecb7b1cdfd5e530f3d3406b7397f0968
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79476055"
---
# <a name="get-connected-to-azure-iot-central"></a>Подключайтесь к Центру Azure IoT

В этой статье описаны варианты подключения устройств к центральному приложению Azure IoT.

Как правило, необходимо зарегистрировать устройство в приложении, прежде чем оно сможет подключиться. Тем не менее, IoT Central поддерживает сценарии, в которых [устройства могут подключаться без предварительной регистрации.](#connect-without-registering-devices)

IoT Central использует [службу обеспечения устройств Концентратора Azure (DPS)](../../iot-dps/about-iot-dps.md) для управления процессом подключения. Устройство сначала подключается к конечному пункту DPS для получения информации, необходимой для подключения к приложению. Внутренне ваше приложение IoT Central использует концентратор IoT для обработки подключения устройств. DPS позволяет следующее:

- Использовать IoT Central для поддержки адаптации и подключения устройств в большом масштабе.
- Создавать учетные данные устройства и настраивать устройства в автономном режиме без необходимости их регистрации в пользовательском интерфейсе IoT Central.
- Использовать собственные идентификаторы устройств для регистрации устройств в IoT Central. Использование собственных идентификаторов устройств упрощает интеграцию с существующими системами операционных отделов организации.
- Использование единой процедуры подключения устройств к IoT Central.

Чтобы обеспечить связь между устройством и приложением, IoT Central поддерживает как общие подписи доступа (SAS), так и сертификаты X.509. Сертификаты X.509 рекомендуются в производственных средах.

В этой статье описаны следующие случаи использования:

- [Подключение одного устройства с помощью SAS](#connect-a-single-device)
- [Подключение устройств в масштабе с помощью SAS](#connect-devices-at-scale-using-sas)
- [Подключите устройства в масштабе с использованием сертификатов X.509](#connect-devices-using-x509-certificates) - рекомендуемый подход для производственных сред.
- [Подключение устройств без их предварительной регистрации](#connect-without-registering-devices)
- [Подключение устройств, которые используют отдельные регистрации DPS](#individual-enrollment-based-device-connectivity)
- [Подключение устройств с использованием функций IoT Plug and Play (предварительный просмотр)](#connect-devices-with-iot-plug-and-play-preview)

## <a name="connect-a-single-device"></a>Подключение одного устройства

Этот подход полезен при экспериментах с IoT Central или тестирующих устройствах. Вы можете использовать подключение к устройству SAS-ключи из приложения IoT Central для подключения устройства к приложению IoT Central. Копирование _ключа SAS устройства_ из информации о подключении к зарегистрированной устройстве:

![Ключи SAS для отдельного устройства](./media/concepts-get-connected/single-device-sas.png)

Чтобы узнать больше, смотрите [создать и подключить клиентское приложение Node.js к учебнику приложения Azure IoT Central.](./tutorial-connect-device.md)

## <a name="connect-devices-at-scale-using-sas"></a>Подключение устройств в масштабе с помощью SAS

Для подключения устройств к IoT Central в масштабе с помощью sAS-ключей необходимо зарегистрироваться, а затем настроить устройства:

### <a name="register-devices-in-bulk"></a>Регистрация устройств оптом

Чтобы зарегистрировать большое количество устройств с помощью приложения IoT Central, используйте файл CSV для [импорта идентификаций и имен устройств.](howto-manage-devices.md#import-devices)

Чтобы получить информацию о подключении к импортируемым устройствам, [вывешите файл CSV из приложения IoT Central.](howto-manage-devices.md#export-devices) Экспортированный файл CSV включает в себя идентиматы устройств и клавиши SAS.

### <a name="set-up-your-devices"></a>Настройка устройств

Используйте информацию о подключении из экспортного файла в коде устройства, чтобы позволить вашим устройствам подключаться и отправлять данные на IoT в ваше приложение IoT Central. Вам также нужна **область DPS ID** для вашего приложения. Это значение можно найти в **административном > устройстве**подключения.

> [!NOTE]
> Чтобы узнать, как можно подключить устройства без предварительной регистрации их в IoT Central, [см. Connect без предварительной регистрации устройств.](#connect-without-registering-devices)

## <a name="connect-devices-using-x509-certificates"></a>Подключение устройств с помощью сертификатов X.509

В производственной среде использование сертификатов X.509 является рекомендуемым механизмом аутентификации устройств для IoT Central. Дополнительные сведения см. в статье [Device Authentication using X.509 CA Certificates](../../iot-hub/iot-hub-x509ca-overview.md) (Аутентификация устройств с помощью сертификатов ЦС X.509).

Перед подключением устройства к сертификату X.509 добавьте и проверьте промежуточный или корневый сертификат X.509 в приложении. Устройства должны использовать сертификаты листа X.509, созданные из корневого или промежуточного сертификата.

### <a name="add-and-verify-a-root-or-intermediate-certificate"></a>Добавление и проверка корневого или промежуточного сертификата

Перейдите к **администрации > подключение к устройству > управление основным сертификатом** и добавить x.509 корневой или промежуточный сертификат, который вы используете для создания сертификатов устройства.

![Параметры подключения](media/concepts-get-connected/manage-x509-certificate.png)

Проверка права собственности на сертификат гарантирует, что лицо, загружающее сертификат, имеет личный ключ сертификата. Для проверки сертификата:

  1. Выберите кнопку рядом с **кодом проверки** для создания кода.
  1. Создайте сертификат проверки X.509 с кодом проверки, созданным на предыдущем этапе. Сохранить сертификат в виде файла .cer.
  1. Загрузите подписанный сертификат проверки и выберите **Verify**. Сертификат помечен как **Проверенный,** когда проверка успешна.

Если у вас есть нарушение безопасности или истекает срок действия основного сертификата, используйте вторичный сертификат для сокращения простоя. Вы можете продолжать предоставлять устройства, используя вторичный сертификат во время обновления основного сертификата.

### <a name="register-and-connect-devices"></a>Регистрация и подключение устройств

Для массового подключения устройств с помощью сертификатов X.509 сначала зарегистрируйте устройства в приложении, используя файл CSV для [импорта идентификаций и идентификаций устройств.](howto-manage-devices.md#import-devices) Иди устройства все должно быть в нижнем случае.

Создайте сертификаты листа X.509 для ваших устройств с помощью загруженного корневого или промежуточного сертификата. Используйте **идентификатор устройства** в `CNAME` качестве значения в сертификатах листа. Код устройства нуждается в значении **области идентификации** для вашего приложения, **идентификатора устройства**и соответствующего сертификата устройства.

### <a name="for-testing-purposes-only"></a>Только для целей тестирования

Для тестирования можно использовать следующие утилиты для генерации корневых, промежуточных и сертификатов устройств:

- [Инструменты для устройства Оснащения устройств Azure IoT SDK:](https://github.com/Azure/azure-iot-sdk-node/blob/master/provisioning/tools/readme.md)коллекция инструментов Node.js, которые можно использовать для создания и проверки сертификатов и ключей X.509.
- Если вы используете устройство DevKit, этот [инструмент командной строки](https://aka.ms/iotcentral-docs-dicetool) генерирует сертификат CA, который можно добавить в приложение IoT Central для проверки сертификатов.
- [Управление тестовыми сертификатами CA для образцов и учебников:](https://github.com/Azure/azure-iot-sdk-c/blob/master/tools/CACertificates/CACertificateOverview.md)коллекция скриптов PowerShell и Bash для:
  - Создайте цепочку сертификатов.
  - Сохраните сертификаты как файлы .cer для загрузки в приложение IoT Central.
  - Используйте код проверки из приложения IoT Central для создания сертификата проверки.
  - Создавайте сертификаты листа для устройств, используя иные данные устройства в качестве параметра для инструмента.

### <a name="further-reference"></a>Дополнительные ссылки

- [Реализация примера для RaspberryPi](https://aka.ms/iotcentral-docs-Raspi-releases)
- [Пример клиента устройства в C](https://github.com/Azure/azure-iot-sdk-c/blob/master/provisioning_client/devdoc/using_provisioning_client.md)

## <a name="connect-without-registering-devices"></a>Подключение без регистрации устройств

Все описанные ранее сценарии требуют регистрации устройств в приложении до их подключения. IoT Central также позволяет производителям масспроизводства устройств массового производства, которые могут подключаться без предварительной регистрации. OEM генерирует подходящие учетные данные устройства и настраивает устройства на заводе. Когда клиент впервые включает устройство, оно подключается к DPS, который автоматически подключает устройство к правильному приложению IoT Central. Центральный оператор IoT должен утвердить устройство до того, как оно начнет отправлять данные в приложение.

Поток немного отличается в зависимости от того, используют ли устройства токены SAS или сертификаты X.509:

### <a name="connect-devices-that-use-sas-tokens-without-registering"></a>Подключите устройства, которые используют токены SAS без регистрации

1. Копирование основного ключевого ключа группы Центрального приложения IoT:

    ![Основной ключ SAS группы приложений](media/concepts-get-connected/group-sas-keys.png)

1. Используйте инструмент [dps-keygen](https://www.npmjs.com/package/dps-keygen) для генерации ключей SAS устройства. Используйте основной ключ группы с предыдущего шага. Иди устройства должен быть ниже регистра:

    ```cmd
    dps-keygen -mk:<group primary key> -di:<device ID>
    ```

1. OEM мигает каждое устройство с идентификатором устройства, сгенерированным ключом SAS устройства и значением **области идентификатора** приложения.

1. При включении устройства оно сначала подключается к DPS, чтобы получить регистрационную информацию IoT Central.

    Первоначально устройство имеет статус **устройства, не связанное** на странице **Устройств,** и не присваивается шаблону устройства. На странице **Устройств** **переместите** устройство в соответствующий шаблон устройства. Подготовка устройств завершена, состояние устройства теперь **подготовлено,** и устройство может начать отправку данных.

    На странице **подключения администрации > устройства** **автоматическое утверждение** элемента управления опцией, нужно ли вручную утвердить устройство, прежде чем он сможет начать отправку данных.

    > [!NOTE]
    > Чтобы узнать, как автоматически связать устройство с шаблоном устройства, [см. Подключите устройства с IoT Plug и Play (предварительный просмотр).](#connect-devices-with-iot-plug-and-play-preview)

### <a name="connect-devices-that-use-x509-certificates-without-registering"></a>Подключите устройства, которые используют сертификаты X.509 без регистрации

1. Добавьте и проверьте в приложение IoT Central [сертификат root или intermediate X.509.](#connect-devices-using-x509-certificates) (#connect-устройства, использующие сертификаты x509)

1. Создайте сертификаты листа для ваших устройств с помощью корневого или промежуточного сертификата, добавленного в приложение IoT Central. Используй нижние иди `CNAME` устройства в качестве сертификатов листа.

1. OEM мигает каждое устройство с идентификатором устройства, сгенерированным левым сертификатом X.509 и значением **области идентификатора** приложения.

1. При включении устройства оно сначала подключается к DPS, чтобы получить регистрационную информацию IoT Central.

    Первоначально устройство имеет статус **устройства, не связанное** на странице **Устройств,** и не присваивается шаблону устройства. На странице **Устройств** **переместите** устройство в соответствующий шаблон устройства. Подготовка устройств завершена, состояние устройства теперь **подготовлено,** и устройство может начать отправку данных.

    На странице **подключения администрации > устройства** **автоматическое утверждение** элемента управления опцией, нужно ли вручную утвердить устройство, прежде чем он сможет начать отправку данных.

    > [!NOTE]
    > Чтобы узнать, как автоматически связать устройство с шаблоном устройства, [см. Подключите устройства с IoT Plug и Play (предварительный просмотр).](#connect-devices-with-iot-plug-and-play-preview)

## <a name="individual-enrollment-based-device-connectivity"></a>Индивидуальное подключение устройства на основе регистрации

Для клиентов, подключающих устройства, каждый из которых имеет свои собственные учетные данные аутентификации, используйте отдельные регистрации. Индивидуальная регистрация — это запись для одного устройства, которое разрешено подключить. Индивидуальные регистрации могут использовать либо сертификаты листа X.509, либо токены SAS (из физического или виртуального модуля доверенной платформы) в качестве механизмов аттестации. Идентификатор устройства (также известный как регистрационный идентификатор) в отдельной регистрации является алфавитным, нижним регистром и может содержать дефисы. Для получения дополнительной информации, [см.](https://docs.microsoft.com/azure/iot-dps/concepts-service#individual-enrollment)

> [!NOTE]
> При создании индивидуальной регистрации для устройства приоритет над опциями регистрации группы по умолчанию в вашем приложении IoT Central имеет приоритет.

### <a name="creating-individual-enrollments"></a>Создание индивидуальных регистраций

IoT Central поддерживает следующие механизмы аттестации для отдельных зачислений:

- **Симметричное подтверждение ключа:** Симметричный ключ подтверждение простого подхода к аутентификации устройства с экземпляром DPS. Чтобы создать индивидуальную регистрацию, используюую симметричные клавиши, откройте страницу **подключения устройств,** выберите **Индивидуальный регистрацию** в качестве метода подключения и **общую подпись доступа (SAS)** в качестве механизма. Введите базовые 64 кодированных первичных и вторичных ключей и сохраните изменения. Используйте **область идентификации,** **идентификатор устройства**и основной или вторичный ключ для подключения устройства.

    > [!TIP]
    > Для тестирования можно использовать **OpenSSL** для создания закодированных ключей base64:`openssl rand -base64 64`

- **Сертификаты X.509:** Чтобы создать индивидуальную регистрацию с сертификатами X.509, откройте страницу **подключения устройств,** выберите **Индивидуальную регистрацию** в качестве метода подключения, а **сертификаты (X.509) —** как механизм. Сертификаты устройства, используемые с индивидуальной записью регистрации, имеют требование о том, чтобы эмитент и субъект CN устанавливались к идентификатору устройства.

    > [!TIP]
    > Для тестирования можно использовать инструменты для устройства [Azure IoT, предохранителя SDK для Node.js](https://github.com/Azure/azure-iot-sdk-node/tree/master/provisioning/tools) для создания сертификата, подписанного самостоятельной подписью:`node create_test_cert.js device "mytestdevice"`

- **Доверенный модуль платформы (TPM) подтверждение:** [TPM](https://docs.microsoft.com/azure/iot-dps/concepts-tpm-attestation) — это тип модуля безопасности оборудования. Использование TPM является одним из наиболее безопасных способов подключения устройства. В этой статье предполагается, что вы используете дискретную, прошивку или интегрированную TPM. Программное обеспечение, эмулированное TPM, хорошо подходит для прототипирования или тестирования, но они не обеспечивают такой же уровень безопасности, как дискретные, прошивки или интегрированные TPMs. Не используйте программное обеспечение TPMs в производстве. Чтобы создать индивидуальную регистрацию, используюую TPM, откройте страницу **подключения устройств,** выберите **Индивидуальный метод регистрации** в качестве метода соединения и **TPM** в качестве механизма. Введите ключ одобрения TPM и сохраните информацию о подключении устройства.

## <a name="connect-devices-with-iot-plug-and-play-preview"></a>Подключение устройств с IoT Plug и Play (предварительный просмотр)

Одной из ключевых особенностей IoT Plug and Play (предварительный просмотр) с IoT Central является возможность автоматического ассоциировать шаблоны устройств в подключении устройства. Наряду с учетными данными устройства, устройства теперь могут отправлять **CapabilityModelId** как часть вызова регистрации устройства. Эта возможность позволяет IoT Central обнаружить и связать шаблон устройства с устройством. Процесс обнаружения работает следующим образом:

1. Свяжетесь с шаблоном устройства, если оно уже опубликовано в приложении IoT Central.
1. Извлечения из публичного хранилища опубликованных и сертифицированных моделей возможностей.

Ниже приведен формат дополнительной полезной нагрузки, который устройство отправит во время регистрационного вызова DPS

```javascript
'__iot:interfaces': {
    CapabilityModelId: <this is the URN for the capability model>
}
```

> [!NOTE]
> Обратите внимание, что **опция Auto утвердить** **на администрирование > подключение устройства** должно быть включено для устройств, чтобы автоматически подключиться, обнаружить шаблон устройства, и начать отправку данных.

## <a name="device-status-values"></a>Значения состояния устройства

Когда реальное устройство подключается к приложению IoT Central, его состояние устройства изменяется следующим образом:

1. Статус устройства сначала **зарегистрирован.** Этот статус означает, что устройство создается в IoT Central и имеет идентификатор устройства. Устройство регистрируется, когда:
    - На странице **Устройств** добавлено новое реальное устройство.
    - Набор устройств добавляется с помощью **импорта** на странице **Устройств.**

1. Статус устройства изменяется в **Provisioned,** когда устройство, подключенное к приложению IoT Central с действительными учетными данными, завершает этап подготовки. На этом этапе устройство использует DPS для автоматического получения строки соединения из концентратора IoT, используемого вашим приложением IoT Central. Теперь устройство может подключиться к IoT Central и начать отправку данных.

1. Оператор может заблокировать устройство. Когда устройство заблокировано, оно не может отправлять данные в ваше центральное приложение IoT. Заблокированные устройства имеют статус **заблокированных.** Оператор должен сбросить устройство, прежде чем он сможет возобновить отправку данных. Когда оператор разблокирует устройство, статус возвращается к его предыдущему значению, **зарегистрированной** или **предусмотрел.**

1. Если статус устройства **ждет утверждения,** это означает, что опция **Автоматического утверждения** отключена. Оператор должен явно утвердить устройство до того, как оно начнет отправлять данные. Устройства, не зарегистрированные вручную на странице **Устройств,** но связанные с действительными учетными данными, будут иметь статус устройства в **ожидании утверждения.** Операторы могут утвердить эти устройства со **страницы Устройств** с помощью кнопки **«Утверждение».**

1. Если статус устройства **не связан,** это означает, что устройство, подключенное к IoT Central, не имеет связанного шаблона устройства. Такая ситуация обычно происходит в следующих сценариях:

    - Набор устройств добавляется с помощью **импорта** на странице **Устройств** без указания шаблона устройства.
    - Устройство было зарегистрировано вручную на странице **Устройств** без указания шаблона устройства. Затем устройство подключено к действительным учетным данным.  

    Оператор может связать устройство с шаблоном устройства со **страницы Устройств** с помощью кнопки **«Мигрион».**

## <a name="best-practices"></a>Рекомендации

Не упорствуйте или кэшируйте строку соединения устройства, которую DPS возвращает при первом подключении устройства. Чтобы подключить устройство, пройдите через стандартный поток регистрации устройства, чтобы получить правильную строку подключения устройства. Если устройство кэширует строку соединения, программное обеспечение устройства рискует иметь устаревшей строки соединения, если IoT Central обновляет основной концентратор Azure IoT, который он использует.

## <a name="sdk-support"></a>Поддержка пакетов SDK

SDK-устройства Azure предлагают самый простой способ реализации кода устройства. Доступны следующие пакеты SDK для устройств:

- [Пакет SDK Azure IoT для C](https://github.com/azure/azure-iot-sdk-c)
- [Пакет SDK Azure IoT для Python](https://github.com/azure/azure-iot-sdk-python)
- [Пакет SDK Azure IoT для Node.js](https://github.com/azure/azure-iot-sdk-node)
- [Пакет SDK Azure IoT для Java](https://github.com/azure/azure-iot-sdk-java)
- [Пакет SDK для Azure IoT для .NET](https://github.com/azure/azure-iot-sdk-csharp).

### <a name="sdk-features-and-iot-hub-connectivity"></a>Функции пакета SDK и возможность подключения Центра Интернета вещей

Для всего обмена данными устройства с Центром Интернета вещей используются следующие варианты подключения Центра Интернета вещей:

- [Передача сообщений с устройства в облако](../../iot-hub/iot-hub-devguide-messages-d2c.md)
- [Близнецы устройств](../../iot-hub/iot-hub-devguide-device-twins.md)

В следующей таблице содержатся сведения о том, каким образом возможности устройства Azure IoT Central сопоставляются с возможностями Центра Интернета вещей.

| Azure IoT Central | Центр Интернета вещей Azure |
| ----------- | ------- |
| Телеметрия | Передача сообщений с устройства в облако |
| Свойство | Сообщаемые свойства двойника устройства |
| Недвижимость (написать) | Требуемые и передаваемые свойства двойника устройства |
| Команда | Прямые методы |

Чтобы узнать больше об использовании SDK-приложений устройств, [см.](howto-connect-devkit.md)

### <a name="protocols"></a>Протоколы

Пакеты SDK для устройства поддерживают следующие сетевые протоколы для подключения к Центру Интернета вещей.

- MQTT
- AMQP
- HTTPS

Дополнительные сведения об этих разных протоколах и рекомендации по их выбору см. в статье [Справочник — выбор протокола связи](../../iot-hub/iot-hub-devguide-protocols.md).

Если ваше устройство не может использовать любой из поддерживаемых протоколов, вы можете использовать Azure IoT Edge для преобразования протокола. IoT Edge поддерживает другие сценарии интеллектуальной обработки на пограничном устройстве, позволяющие снизить нагрузку на пограничное устройство из приложения Azure IoT Central.

## <a name="security"></a>Безопасность

Все данные, передаваемые между устройствами и Azure IoT Central, зашифрованы. Центр Интернета вещей выполняет проверку подлинности каждого запроса с устройства, которое подключается к любой конечной точке Центра Интернета вещей, обращенной к устройству. Чтобы избежать обмена учетными данными по сети, для проверки подлинности устройство использует подписанные маркеры. Для получения дополнительной [Control access to IoT Hub](../../iot-hub/iot-hub-devguide-security.md)информации см.

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы узнали о подключении устройств в Azure IoT Central, вот следующие шаги:

- [Подготовка и подключение устройства DevKit](howto-connect-devkit.md)
- [C SDK: Предоставление устройства Клиент SDK](https://github.com/Azure/azure-iot-sdk-c/blob/master/provisioning_client/devdoc/using_provisioning_client.md)
