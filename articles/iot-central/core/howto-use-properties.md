---
title: Использование свойств в решении Azure IoT Central
description: Узнайте, как использовать свойства только для чтения и доступные для записи в решении Azure IoT Central.
author: dominicbetts
ms.author: dobett
ms.date: 08/12/2020
ms.topic: how-to
ms.service: iot-central
services: iot-central
ms.openlocfilehash: 1cc4f40374fce83589d2dc10a0422b91f5178c0b
ms.sourcegitcommit: 7dacbf3b9ae0652931762bd5c8192a1a3989e701
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/16/2020
ms.locfileid: "92123789"
---
# <a name="use-properties-in-an-azure-iot-central-solution"></a>Использование свойств в решении Azure IoT Central

В этой статье показано, как использовать свойства устройства, определенные в шаблоне устройства в приложении IoT Central Azure.

Свойства представляют собой значения на момент во времени. Например, устройство может использовать свойство для передачи значения целевой температуры, которого пытается достичь устройство. Свойства также позволяют синхронизировать состояние между устройством и приложением IoT Central Azure. Вы можете задать свойства для записи из IoT Central Azure.

Вы также можете определить свойства облака в приложении IoT Central Azure. Значения облачных свойств никогда не передаются с устройства и выходят за рамки этой статьи.

## <a name="define-your-properties"></a>Определение свойств

Свойства — это поля данных, которые представляют состояние устройства. Используйте свойства, чтобы представить устойчивое состояние устройства, например состояние включения или выключения устройства. Свойства могут также представлять базовые свойства устройства, такие как версия программного обеспечения устройства. Свойства можно объявлять как доступные только для чтения или доступные для записи.

На следующем снимке экрана показано определение свойства в приложении IoT Central Azure.

![Снимок экрана, на котором показано определение свойства в приложении IoT Central Azure.](./media/howto-use-properties/property-definition.png)

В следующей таблице показаны параметры конфигурации для возможности свойства.

| Поле           | Описание                                                                                                                                                                                                                        |
|-----------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Отображаемое имя    | Отображаемое имя для значения свойств, используемое на панелях мониторинга и в формах.                                                                                                                                                              |
| Имя            | Имя свойства. IoT Central Azure создает значение для этого поля из отображаемого имени, но при необходимости можно выбрать собственное значение. Это поле должно быть буквенно-цифровым.                                                 |
| Тип возможности | Свойство.                                                                                                                                                                                                                          |
| Семантический тип   | Семантический тип свойства, например температура, состояние или событие. Выбор семантического типа определяет, какие из следующих полей будут доступны.                                                                       |
| схема          | Тип данных свойства, например double, string или vector. Доступные варианты определяются семантическим типом. Для семантических типов событий и состояний схема недоступна.                                               |
| Writeable (Доступно для записи)       | Если свойство недоступно для записи, устройство может передавать значения свойств в IoT Central Azure. Если свойство доступно для записи, устройство может передавать значения свойств в IoT Central Azure. Затем Azure IoT Central может отправить обновления свойств на устройство. |
| Severity        | Доступно только для семантического типа события. Возможны такие степени серьезности: **Ошибка**, **Сведения** или **Предупреждение**.                                                                                                                         |
| Значения состояния    | Доступно только для семантического типа состояния. Определите возможные значения состояния, для каждого из которых есть отображаемое имя, название, тип перечисления и значение.                                                                                   |
| Unit            | Единица измерения для значения свойства, например **миль/ч**, **%** или ** &deg; C**.                                                                                                                                                              |
| Единица дисплея    | Отображаемая единица для использования на панелях мониторинга и в формах.                                                                                                                                                                                    |
| Комментировать         | Любые комментарии о возможности "Свойство".                                                                                                                                                                                        |
| Описание     | Описание возможности "Свойство".                                                                                                                                                                                          |

Свойства также можно определить в интерфейсе в шаблоне устройства, как показано ниже:

``` json
{
  "@type": "Property",
  "displayName": "Device State",
  "description": "The state of the device. Two states online/offline are available.",
  "name": "state",
  "schema": "boolean"
},
{
  "@type": "Property",
  "displayName": "Customer Name",
  "description": "The name of the customer currently operating the device.",
  "name": "name",
  "schema": "string",
  "writable": true
},
{
 "@type": "Property",
 "displayName": "Date ",
 "description": "The date on which the device is currently operating",
 "name": "date",
 "writable": true,
 "schema": "date"
},
{ 
 "@type": "Property",
 "displayName": "Location",
 "description": "The current location of the device",
 "name": "location",
 "writable": true,
 "schema": "geopoint"
},
{
 "@type": "Property",
 "displayName": "Vector Level",
 "description": "The Vector level of the device",
 "name": "vector",
 "writable": true,
 "schema": "vector"
}
```

В этом примере показаны пять свойств. Эти свойства могут быть связаны с определением свойства в пользовательском интерфейсе, как показано ниже:

* `@type` чтобы указать тип возможности, сделайте следующее: `Property`
* `name` для значения свойства.
* `schema` Укажите тип данных для свойства. Это значение может быть примитивным типом, например Double, Integer, Boolean или String. Также поддерживаются сложные типы объектов, массивы и карты.
* `writable` По умолчанию свойства доступны только для чтения. Свойство можно пометить как записываемое с помощью этого поля.

Необязательные поля, такие как отображаемое имя и описание, позволяют добавлять дополнительные сведения в интерфейс и возможности.

При создании свойства можно указать сложные типы **схемы** , такие как Object и Enum.

![Снимок экрана, показывающий, как добавить возможность.](./media/howto-use-properties/property.png)

При выборе сложной **схемы**, такой как **Object**, необходимо также определить объект.

![Снимок экрана, показывающий, как определить объект.](./media/howto-use-properties/object.png)

В следующем коде показано определение типа свойства объекта. Этот объект содержит два поля с типами String и Integer.

``` json
{
  "@id": "<element id>",
  "@type": "Property",
  "displayName": {
    "en": "ObjectProperty"
  },
  "name": "ObjectProperty",
  "schema": {
    "@id": "<element id>",
    "@type": "Object",
    "displayName": {
      "en": "Object"
    },
    "fields": [
      {
        "@id": "<element id>",
        "@type": "SchemaField",
        "displayName": {
          "en": "Field1"
        },
        "name": "Field1",
        "schema": "integer"
      },
      {
        "@id": "<element id>",
        "@type": "SchemaField",
        "displayName": {
          "en": "Field2"
        },
        "name": "Field2",
        "schema": "string"
      }
    ]
  }
}
```

## <a name="implement-read-only-properties"></a>Реализация свойств, которые доступны только для чтения

По умолчанию свойства доступны только для чтения. Свойства только для чтения означают, что устройство передает значение свойства в приложение Azure IoT Central. Приложение IoT Central Azure не может задать значение свойства, доступного только для чтения.

Azure IoT Central использует двойников устройства для синхронизации значений свойств устройства и приложения IoT Central Azure. Для значений свойств устройства используются передаваемые свойства двойника устройства. Дополнительные сведения см. в разделе [Device двойников](../../iot-hub/tutorial-device-twins.md).

В следующем фрагменте кода из модели возможностей устройства показано определение типа свойства, доступного только для чтения.

``` json
{
  "@type": "Property",
  "name": "model",
  "displayName": "Device model",
  "schema": "string",
  "comment": "Device model name or ID. Ex. Surface Book 2."
}
```

Свойства, доступные только для чтения, отправляются устройством в Azure IoT Central. Свойства отправляются как полезные данные JSON. Дополнительные сведения см. в разделе [полезные данные](./concepts-telemetry-properties-commands.md).

С помощью пакета SDK для устройств Azure IoT можно отправить обновление свойства в приложение IoT Central Azure.

Свойства двойникаа устройства можно отправить в приложение IoT Central Azure с помощью следующей функции:

``` javascript
hubClient.getTwin((err, twin) => {
    const properties = {
        model: 'environmentalSensor1.0'
    };
    twin.properties.reported.update(properties, (err) => {
        console.log(err ? `error: ${err.toString()}` : `status: success` )
    });
});
```

В этой статье для простоты используется Node.js. Полные сведения о примерах приложений для устройств см. в следующих учебниках:

* [Создание клиентского приложения и подключение его к приложению IoT Central Azure (Node.js)](tutorial-connect-device-nodejs.md)
* [Создание клиентского приложения и подключение его к приложению IoT Central Azure (Python)](tutorial-connect-device-python.md)

В следующем представлении в приложении IoT Central Azure отображаются свойства, которые вы видите. Представление автоматически делает свойство **модели устройства** _свойством устройства только для чтения_.

![Снимок экрана, на котором показано представление свойства, доступного только для чтения.](./media/howto-use-properties/read-only.png)

## <a name="implement-writable-properties"></a>Реализация свойств, доступных для записи

Свойства, доступные для записи, задаются оператором в приложении IoT Central Azure в форме. Azure IoT Central отправляет свойство на устройство. Azure IoT Central ждет подтверждения от устройства.

В следующем фрагменте кода из модели возможностей устройства показано определение типа свойства, доступного для записи:

``` json
{
  "@type": "Property",
  "displayName": "Brightness Level",
  "description": "The brightness level for the light on the device. Can be specified as 1 (high), 2 (medium), 3 (low)",
  "name": "brightness",
  "writable": true,
  "schema": "long"
}
```

Клиент устройства должен отправить полезные данные JSON, как в следующем примере, как сообщаемое свойство в двойникае устройства:

``` json
{ "Brightness Level": 2 }
```

Чтобы определить и обработать записываемые свойства, на которые реагирует ваше устройство, можно использовать следующий код:

``` javascript
hubClient.getTwin((err, twin) => {
    twin.on('properties.desired.brightness', function(desiredBrightness) {
        console.log( `Received setting: ${desiredBrightness.value}` );
        var patch = {
            brightness: {
                value: desiredBrightness.value,
                ad: 'success',
                ac: 200,
                av: desiredBrightness.$version
            }
        }
        twin.properties.reported.update(patch, (err) => {
            console.log(err ? `error: ${err.toString()}` : `status: success` )
        });
    });
});
```

Ответное сообщение должно включать `ac` поля и `av` . Поле `ad` является необязательным. Примеры см. в следующих фрагментах кода:

* `ac` числовое поле, в котором используются значения из следующей таблицы.
* `av` номер версии, отправляемый на устройство.
* `ad` — Это описание строки параметра.

| Значение | Метка | Описание |
| ----- | ----- | ----------- |
| `'ac': 200` | Завершено | Операция изменения свойства успешно завершена. |
| `'ac': 202` или `'ac': 201` | Pending | Операция изменения свойства находится в состоянии ожидания или выполняется. |
| `'ac': 4xx` | Ошибка | Запрошенное изменение свойства недопустимо или содержит ошибку. |
| `'ac': 5xx` | Ошибка | Произошла непредвиденная ошибка устройства при обработке запрошенного изменения. |


Дополнительные сведения о двойниковах устройств см. в статье [Настройка устройств из серверной службы](../../iot-hub/tutorial-device-twins.md).

Когда оператор задает записываемое свойство в приложении IoT Central Azure, приложение использует требуемое свойство двойникаа устройства для отправки значения на устройство. Затем устройство отвечает с помощью свойства сообщила об двойникае устройства. Когда IoT Central Azure получает значение сообщаемого свойства, оно обновляет представление свойств с состоянием **принято**.

В следующем представлении показаны свойства, доступные для записи. При вводе значения и выборе **сохранить**начальное состояние находится в состоянии **Ожидание**. Когда устройство принимает изменение, состояние изменится на **принято**.

![Снимок экрана, на котором отображается состояние "ожидание".](./media/howto-use-properties/status-pending.png)

![Снимок экрана, на котором показано принятое свойство.](./media/howto-use-properties/accepted.png)

## <a name="next-steps"></a>Дальнейшие шаги

Теперь, когда вы узнали, как использовать свойства в приложении IoT Central Azure, см. следующие статьи:

* [Полезных данных](concepts-telemetry-properties-commands.md)
* [Создание клиентского приложения и подключение его к приложению IoT Central Azure (Node.js)](tutorial-connect-device-nodejs.md)