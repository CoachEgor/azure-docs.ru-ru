---
title: Анализ журналов и метрик в облачном облаке Azure Spring Документы Майкрософт
description: Узнайте, как анализировать данные диагностики в облачности Azure Spring
author: bmitchell287
ms.service: spring-cloud
ms.topic: conceptual
ms.date: 01/06/2020
ms.author: brendm
ms.openlocfilehash: 544de1b4ac46a58d533f71a46266807a3b93820a
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "77920048"
---
# <a name="analyze-logs-and-metrics-with-diagnostics-settings"></a>Анализ журналов и метрик с настройками диагностики

Используя функциональность диагностики облака Azure Spring, вы можете анализировать журналы и метрики с помощью любого из следующих служб:

* Используйте аналитику журналов Azure, где данные записываются в хранилище Azure. Существует задержка при экспорте журналов в журнал Analytics.
* Сохраняй журналы в учетной записи хранилища для аудита или ручного осмотра. Можно указать время удержания (в течение нескольких дней).
* Поток журналов в концентратор событий для приема в эксплуатацию сторонними службами или пользовательским аналитическим решением.

Выберите категорию журнала и метрическую категорию, за которые вы хотите следить.

## <a name="logs"></a>Журналы

|Журнал | Описание |
|----|----|
| **ПриложениеКонсоль** | Консольный журнал всех клиентских приложений. | 
| **Системные журналы** | В настоящее время только [весенний облачный config Server](https://cloud.spring.io/spring-cloud-config/reference/html/#_spring_cloud_config_server) входит в эту категорию. |

## <a name="metrics"></a>Метрики

Полный список метрик можно узнать в весеннем [облаке метрики.](https://docs.microsoft.com/azure/spring-cloud/spring-cloud-concept-metrics#user-metrics-options)

Чтобы начать работу, включите одну из этих служб для получения данных. Чтобы узнать о настройке [Get started with Log Analytics in Azure Monitor](../azure-monitor/log-query/get-started-portal.md)аналитики журналов, см. 

## <a name="configure-diagnostics-settings"></a>Настройка настроек диагностики

1. На портале Azure перейдите в экземпляр Azure Spring Cloud.
1. Выберите **параметр настройки диагностики,** а затем выберите **настройки добавления диагностики.**
1. Введите имя для настройки, а затем выберите, куда вы хотите отправить журналы. Вы можете выбрать любую комбинацию из следующих трех вариантов:
    * **Архив учетной записи хранилища**
    * **Поток в центр событий**
    * **Отправка в Log Analytics**

1. Выберите, какую категорию журнала и метрическую категорию вы хотите контролировать, а затем укажите время удержания (в днях). Время хранения применяется только к учетной записи хранилища.
1. Нажмите кнопку **Сохранить**.

> [!NOTE]
> Между тем, когда излучаются журналы или метрики, и когда они отображаются в учетной записи хранилища, в центре событий или в журнале Analytics, может быть разрыв до 15 минут.

## <a name="view-the-logs-and-metrics"></a>Просмотр журналов и метрик
Существуют различные методы для просмотра журналов и метрик, описанных в следующих заголовках.

### <a name="use-logs-blade"></a>Используйте лезвие журналов

1. На портале Azure перейдите в экземпляр Azure Spring Cloud.
1. Чтобы открыть панель **поиска журнала,** выберите **журналы**.
1. В поле поиска **журнала**
   * Чтобы просмотреть журналы, введите простой запрос, такой как:

    ```sql
    AppPlatformLogsforSpring
    | limit 50
    ```
   * Чтобы просмотреть метрики, введите простой запрос, такой как:

    ```sql
    AzureMetrics
    | limit 50
    ```
1. Для просмотра результата поиска выберите **Выполнить**.

### <a name="use-log-analytics"></a>Использование Log Analytics

1. На портале Azure в левом стеле выберите **Log Analytics.**
1. Выберите выбранное место работы Log Analytics при добавлении настроек диагностики.
1. Чтобы открыть панель **поиска журнала,** выберите **журналы**.
1. В поле поиска **журнала,**
   * для просмотра журналов введите простой запрос, такой как:

    ```sql
    AppPlatformLogsforSpring
    | limit 50
    ```
    * для просмотра метрик введите простой запрос, такой как:

    ```sql
    AzureMetrics
    | limit 50
    ```

1. Для просмотра результата поиска выберите **Выполнить**.
1. Вы можете искать журналы конкретного приложения или экземпляра, установив условие фильтра:

    ```sql
    AppPlatformLogsforSpring
    | where ServiceName == "YourServiceName" and AppName == "YourAppName" and InstanceName == "YourInstanceName"
    | limit 50
    ```
> [!NOTE]  
> `==`является случае чувствительным, но `=~` это не так.

Чтобы узнать больше о языке запросов, который [Azure Monitor log queries](../azure-monitor/log-query/query-language.md)используется в журнале Analytics, см.

### <a name="use-your-storage-account"></a>Используйте свою учетную запись хранения 

1. На портале Azure в левом стеле выберите **учетные записи хранения.**

1. Выберите учетную запись хранения, выбранную при добавлении настроек диагностики.
1. Чтобы открыть панель **контейнера Blob,** выберите **Blobs.**
1. Для просмотра журналов приложений ищите контейнер под названием **insights-logs-applicationconsole.**
1. Чтобы просмотреть метрики приложений, ищите контейнер под названием **insights-metrics-pt1m.**

Чтобы узнать больше об отправке информации о диагностике в учетную запись хранения, [см.](../storage/common/storage-introduction.md)

### <a name="use-your-event-hub"></a>Используйте свой концентратор событий

1. На портале Azure в левом стеле выберите **концентраторы событий.**

1. Поиск и выбор выбранного концентратора событий при добавлении настроек диагностики.
1. Чтобы открыть панель **списка концентраторов событий,** выберите **концентраторы событий.**
1. Для просмотра журналов приложений ищите концентратор событий, называемый **insights-logs-applicationconsole.**
1. Чтобы просмотреть метрики приложений, ищите концентратор событий под названием **insights-metrics-pt1m.**

Чтобы узнать больше об отправке информации о диагностике в концентратор событий, см. [Потоковых данных Azure Diagnostics в горячем пути с помощью концентраторов событий.](https://docs.microsoft.com/azure/azure-monitor/platform/diagnostics-extension-stream-event-hubs)

## <a name="analyze-the-logs"></a>Анализ журналов

Аналитика журналов Azure работает с движком Kusto, чтобы вы могли запросить журналы для анализа. Для быстрого введения в журналы запросов с помощью Kusto, просмотрите [учебник Log Analytics.](../azure-monitor/log-query/get-started-portal.md)

В журналах приложений предоставляется важная информация и многословные журналы о работоспособности, производительности приложения и многом. В следующих разделах есть несколько простых запросов, которые помогут вам понять текущие и прошлые состояния приложения.

### <a name="show-application-logs-from-azure-spring-cloud"></a>Отображдия журналов приложений из облака Azure Spring

Чтобы просмотреть список журналов приложений из облачного облака Azure Spring, отсортированного по времени с последними журналами, показанными первыми, запустите следующий запрос:

```sql
AppPlatformLogsforSpring
| project TimeGenerated , ServiceName , AppName , InstanceName , Log
| sort by TimeGenerated desc
```

### <a name="show-logs-entries-containing-errors-or-exceptions"></a>Отображка записей журналов, содержащих ошибки или исключения

Для просмотра несортированных записей журнала, в которых упоминается ошибка или исключение, запустите следующий запрос:

```sql
AppPlatformLogsforSpring
| project TimeGenerated , ServiceName , AppName , InstanceName , Log
| where Log contains "error" or Log contains "exception"
```

Используйте этот запрос, чтобы найти ошибки или изменить термины запроса, чтобы найти определенные коды ошибок или исключения. 

### <a name="show-the-number-of-errors-and-exceptions-reported-by-your-application-over-the-last-hour"></a>Отображайте количество ошибок и исключений, о которых сообщает приложение за последний час

Чтобы создать круговую диаграмму, отображая количество ошибок и исключений, зарегистрированных приложением в последний час, запустите следующий запрос:

```sql
AppPlatformLogsforSpring
| where TimeGenerated > ago(1h)
| where Log contains "error" or Log contains "exception"
| summarize count_per_app = count() by AppName
| sort by count_per_app desc
| render piechart
```

### <a name="learn-more-about-querying-application-logs"></a>Подробнее о журналах приложений запросов

Azure Monitor обеспечивает широкую поддержку журналов приложений с помощью журналов журналов журналов журналов журналов. Чтобы узнать больше об [Get started with log queries in Azure Monitor](../azure-monitor/log-query/get-started-queries.md)этой службе, см. Для получения дополнительной информации о создании запросов для анализа журналов приложений смотрите [обзор запросов журналов в Azure Monitor.](../azure-monitor/log-query/log-query-overview.md)
