---
title: Настройка сервера конфигурации в Azure Spring Cloud | Документация Майкрософт
description: В этом учебнике описывается настройка сервера конфигурации Spring Cloud для службы Azure Spring Cloud на портале Azure.
services: spring-cloud
ms.service: spring-cloud
ms.topic: tutorial
ms.reviewer: jeconnoc
ms.author: v-vasuke
author: v-vasuke
ms.date: 08/08/2019
ms.openlocfilehash: f959d216859ded54de52de474ee3150f91bcfff1
ms.sourcegitcommit: d773b5743cb54b8cbcfa5c5e4d21d5b45a58b081
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/08/2019
ms.locfileid: "72038656"
---
# <a name="tutorial-set-up-a-spring-cloud-config-server-for-your-service"></a>Руководство по настройке сервера конфигурации Spring Cloud для службы

В этом учебнике описано подключение сервера конфигурации Spring Cloud Config к службе Azure Spring Cloud.

Конфигурация Spring Cloud предоставляет поддержку на стороне сервера и клиента для внешней конфигурации в распределенной системе. Сервер конфигурации обеспечивает централизованное управление внешними свойствами приложений во всех средах. Дополнительные сведения см. в [справочнике по серверу конфигурации Spring Cloud](https://spring.io/projects/spring-cloud-config).

## <a name="prerequisites"></a>Предварительные требования
* Подписка Azure. Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу. 
* Подготовленная и запущенная служба Azure Spring Cloud.  Выполните инструкции, приведенные в [этом кратком руководстве](spring-cloud-quickstart-launch-app-cli.md), чтобы подготовить и запустить службу Azure Spring Cloud.


## <a name="restriction"></a>Ограничение

При использовании __сервера конфигурации__ с репозиторием git существуют некоторые ограничения. Для доступа к __серверу конфигурации__ и __обнаружению служб__ в среду вашего приложения будут автоматически добавлены некоторые свойства. Настроив эти свойства из файлов **сервера конфигурации**, вы можете столкнуться с конфликтами и непредвиденным поведением.  Эти свойства включают в себя следующие: 

```yaml
eureka.client.service-url.defaultZone
eureka.client.tls.keystore
server.port
spring.cloud.config.tls.keystore
spring.application.name
```
> [!CAUTION]
> Настоятельно рекомендуем вам __НЕ__ помещать вышеуказанные свойства в файлы приложения __сервера конфигурации__.

## <a name="create-your-config-server-files"></a>Создание файлов сервера конфигурации

Для хранения файлов сервера конфигурации Azure Spring Cloud поддерживает Azure DevOps, GitHub, GitLab и Bitbucket.  После подготовки репозитория создайте и сохраните файлы конфигурации, выполнив приведенные в этой статье инструкции.

Некоторые настраиваемые свойства доступны лишь для определенных типов репозитория. В следующих подразделах перечислены свойства для каждого типа.


### <a name="public-repository"></a>Общедоступный репозиторий

При использовании общедоступного репозитория настраиваемые свойства будут более ограниченными.

Все настраиваемые свойства, используемые для настройки общедоступного репозитория `Git`, перечислены ниже.

> [!NOTE]
> В настоящее время в соглашении об именовании разделенных слов поддерживается только дефис ("-"). Например, вы можете использовать `default-label`, а не `defaultLabel`.

| Свойство        | Обязательно | Функция                                                      |
| :-------------- | -------- | ------------------------------------------------------------ |
| `uri`           | `yes`    | Свойство `uri` репозитория `Git`, используемое в качестве внутреннего сервера конфигурации; должно начинаться следующим образом: `http://`, `https://`, `git@` или `ssh://`. |
| `default-label` | `no`     | Меткой по умолчанию для репозитория `Git` может быть `branch name`, `tag name` или `commit-id`. |
| `search-paths`  | `no`     | Массив строк, используемых для поиска в подкаталогах репозитория `Git`. |

------

### <a name="private-repository-with-ssh-authentication"></a>Частный репозиторий с проверкой подлинности SSH

Все настраиваемые свойства, используемые для настройки частного репозитория `Git` с `Ssh`, перечислены ниже.

> [!NOTE]
> В настоящее время в соглашении об именовании разделенных слов поддерживается только дефис ("-"). Например, вы можете использовать `default-label`, а не `defaultLabel`.

| Свойство                   | Обязательно | Функция                                                      |
| :------------------------- | -------- | ------------------------------------------------------------ |
| `uri`                      | `yes`    | Свойство `uri` репозитория `Git`, используемое в качестве внутреннего сервера конфигурации; должно начинаться следующим образом: `http://`, `https://`, `git@` или `ssh://`. |
| `default-label`            | `no`     | Меткой по умолчанию для репозитория `Git` может быть `branch name`, `tag name` или `commit-id`. |
| `search-paths`             | `no`     | Массив строк, используемых для поиска в подкаталогах репозитория `Git`. |
| `private-key`              | `no`     | Закрытый ключ `Ssh` для доступа к репозиторию `Git`; __требуется__, когда `uri` начинается следующим образом: `git@` или `ssh://`. |
| `host-key`                 | `no`     | Ключ узла сервера репозитория Git не должен содержать префикс алгоритма, как указано в `host-key-algorithm`. |
| `host-key-algorithm`       | `no`     | Алгоритм ключа узла должен быть одним из `ssh-dss`. `ssh-rsa`, `ecdsa-sha2-nistp256`, `ecdsa-sha2-nistp384` и `ecdsa-sha2-nistp521`. Требуется только при наличии `host-key`. |
| `strict-host-key-checking` | `no`     | Указывает, будет ли сервер конфигурации запускаться при использовании предоставленного ключа `host-key`. Для этого свойства необходимо задать значение `true` (значение по умолчанию) или `false`. |

-----

### <a name="private-repository-with-basic-authentication"></a>Частный репозиторий с обычной проверкой подлинности

Все настраиваемые свойства, используемые для настройки частного репозитория Git с обычной проверкой подлинности, перечислены ниже.

> [!NOTE]
> В настоящее время в соглашении об именовании разделенных слов поддерживается только дефис ("-"). Например, вы можете использовать `default-label`, а не `defaultLabel`.

| Свойство        | Обязательно | Функция                                                      |
| :-------------- | -------- | ------------------------------------------------------------ |
| `uri`           | `yes`    | Свойство `uri` репозитория `Git`, используемое в качестве внутреннего сервера конфигурации; должно начинаться следующим образом: `http://`, `https://`, `git@` или `ssh://`. |
| `default-label` | `no`     | Меткой по умолчанию для репозитория `Git` может быть `branch name`, `tag name` или `commit-id`. |
| `search-paths`  | `no`     | Массив строк, используемых для поиска в подкаталогах репозитория `Git`. |
| `username`      | `no`     | `username` используется для доступа к серверу репозитория `Git`; сервер репозитория `Git` __должен__ поддерживать `Http Basic Authentication`. |
| `password`      | `no`     | Пароль, используемый для доступа к серверу репозитория `Git`; сервер репозитория `Git` __должен__ поддерживать `Http Basic Authentication`. |

> [!NOTE]
> Некоторые серверы репозитория `Git`, такие как GitHub, поддерживают маркер personal-token или access-token в качестве пароля для `HTTP Basic Authentication`. Здесь в качестве пароля также можно использовать маркер такого типа, и срок действия personal-token или access-token не истечет. Однако для серверов репозитория Git, таких как BitBucket и Azure DevOps, срок действия маркера истекает через один или два часа, что делает эту опцию бесполезной для Azure Spring Cloud.

### <a name="git-repositories-with-pattern"></a>Репозитории Git с шаблоном

Все настраиваемые свойства, используемые для настройки репозиториев Git с шаблоном, перечислены ниже.

> [!NOTE]
> В настоящее время в соглашении об именовании разделенных слов поддерживается только дефис ("-"). Например, вы можете использовать `default-label`, а не `defaultLabel`.

| Свойство                           | Обязательно         | Функция                                                      |
| :--------------------------------- | ---------------- | ------------------------------------------------------------ |
| `repos`                            | `no`             | Сопоставление состоит из параметров репозитория `Git` с указанным именем. |
| `repos."uri"`                      | `yes` для `repos` | Свойство `uri` репозитория `Git`, используемое в качестве внутреннего сервера конфигурации; должно начинаться следующим образом: `http://`, `https://`, `git@` или `ssh://`. |
| `repos."name"`                     | `yes` для `repos` | Имя для идентификации одного репозитория `Git`; __требуется__ только при наличии `repos`. Например, сверху `team-A`, `team-B`. |
| `repos."pattern"`                  | `no`             | Массив строки, используемый для сопоставления имени приложения; для каждого шаблона используется формат `{application}/{profile}` с подстановочными знаками. |
| `repos."default-label"`            | `no`             | Меткой по умолчанию для репозитория `Git` может быть `branch name`, `tag name` или `commit-id`. |
| `repos."search-paths`"             | `no`             | Массив строк, используемых для поиска в подкаталогах репозитория `Git`. |
| `repos."username"`                 | `no`             | `username` используется для доступа к серверу репозитория `Git`; сервер репозитория `Git` __должен__ поддерживать `Http Basic Authentication`. |
| `repos."password"`                 | `no`             | Пароль, используемый для доступа к серверу репозитория `Git`; сервер репозитория `Git` __должен__ поддерживать `Http Basic Authentication`. |
| `repos."private-key"`              | `no`             | Закрытый ключ `Ssh` для доступа к репозиторию `Git`; __требуется__, когда `uri` начинается следующим образом: `git@` или `ssh://`. |
| `repos."host-key"`                 | `no`             | Ключ узла сервера репозитория Git не должен содержать префикс алгоритма, как указано в `host-key-algorithm`. |
| `repos."host-key-algorithm"`       | `no`             | Алгоритм ключа узла должен быть одним из `ssh-dss`. `ssh-rsa`, `ecdsa-sha2-nistp256`, `ecdsa-sha2-nistp384` и `ecdsa-sha2-nistp521`. __Требуется__ только при наличии `host-key`. |
| `repos."strict-host-key-checking"` | `no`             | Указывает, будет ли сервер конфигурации запускаться при использовании предоставленного ключа `host-key`. Для этого свойства необходимо задать значение `true` (значение по умолчанию) или `false`. |

### <a name="import-applicationyml-file-from-spring-cloud-config"></a>Импорт файла `application.yml` из Spring Cloud Config

Некоторые параметры сервера конфигурации по умолчанию можно импортировать непосредственно с веб-сайта [Spring Cloud Config](https://spring.io/projects/spring-cloud-config). Это можно сделать на портале Azure, поэтому вам не нужно предпринимать никаких действий для подготовки файлов или репозитория сервера конфигурации.

## <a name="attaching-your-config-server-repository-to-azure-spring-cloud"></a>Подключение репозитория сервера конфигурации к Azure Spring Cloud

После сохранения файлов конфигурации в репозитории необходимо подключить к нему Azure Spring Cloud.

1. Войдите на [портал Azure](https://portal.azure.com).

1. Перейдите на страницу **обзора** Azure Spring Cloud.

1. Перейдите на вкладку **Config Server** (Сервер конфигурации) под заголовком **Параметры** в меню с левой стороны.

### <a name="public-repository"></a>Общедоступный репозиторий

При использовании общедоступного репозитория просто нажмите кнопку **Общедоступный** и вставьте URL-адрес.

### <a name="private-repository"></a>Частный репозиторий

Azure Spring Cloud поддерживает проверку подлинности SSH. Следуйте инструкциям, приведенным на портале Azure, чтобы добавить открытый ключ в репозиторий. Затем обязательно включите закрытый ключ в файл конфигурации.

Щелкните **Применить**, чтобы завершить настройку сервера конфигурации.


## <a name="delete-your-app-configuration"></a>Удаление конфигурации приложения

После сохранения файла конфигурации на вкладке **Конфигурация** отобразится кнопка **Delete app configuration** (Удалить конфигурацию приложения). При нажатии этой кнопки имеющиеся параметры будут полностью удалены. Нажмите ее, если вам нужно подключить сервер конфигурации к другому источнику, например, для перехода с GitHub на Azure DevOps.

## <a name="next-steps"></a>Дополнительная информация

В рамках этого учебника вы узнали, как включить и настроить сервер конфигурации. Чтобы узнать больше об управлении приложением, ознакомьтесь с учебником по масштабированию приложения вручную.

> [!div class="nextstepaction"]
> [Учебник по масштабированию приложения в Azure Spring Cloud](spring-cloud-tutorial-scale-manual.md).

