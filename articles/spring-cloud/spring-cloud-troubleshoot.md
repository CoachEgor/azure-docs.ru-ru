---
title: Руководство по устранению неполадок для Azure Spring Cloud | Документация Майкрософт
description: Руководство по устранению неполадок для Azure Spring Cloud
author: bmitchell287
ms.service: spring-cloud
ms.topic: troubleshooting
ms.date: 11/04/2019
ms.author: brendm
ms.openlocfilehash: 5dcdb03a6d4ec4f448108dbd771a44f362aa7f20
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "76277582"
---
# <a name="troubleshoot-common-azure-spring-cloud-issues"></a>Устранение проблем общие проблемы в облачности Azure Spring

В этой статье содержатся инструкции по устранению проблем разработки облачных технологий Azure Spring. Для получения дополнительной [Azure Spring Cloud FAQ](spring-cloud-faq.md)информации см.

## <a name="availability-performance-and-application-issues"></a>Проблемы с доступностью, производительностью и приложениями

### <a name="my-application-cant-start-for-example-the-endpoint-cant-be-connected-or-it-returns-a-502-after-a-few-retries"></a>Мое приложение не может начаться (например, конечная точка не может быть подключена, или она возвращает 502 после нескольких повторов)

Экспортируйте журналы в Azure Log Analytics. Таблица для журналов приложений Spring называется *AppPlatformLogsforSpring*. Чтобы узнать больше, смотрите [анализ журналов и метрик с настройками диагностики.](diagnostic-services.md)

В журналах может появиться следующее сообщение об ошибке:

> "org.springframework.context.ApplicationКонтекстСа: Невозможно запустить веб-сервер"

Сообщение указывает на одну из двух вероятных проблем: 
* отсутствует один из компонентов или одна из его зависимостей;
* одно из свойств компонента отсутствует или недопустимо. В этом случае, скорее всего, будет отображаться "java.lang.IllegalArgumentException".

Привязки служб также могут привести к сбоям в запуске приложения. Для запроса журналов используйте ключевые слова, связанные с связанными службами. Например, предположим, что ваше приложение имеет привязку к экземпляру MyS'L, установленное на локальное системное время. Если приложение не запустится, в журнале может появиться следующее сообщение об ошибке:

> "java.sql.S'LException: Значение часового пояса сервера 'Координированное универсальное время' непризнано или представляет собой более одного часового пояса."

Чтобы исправить эту ошибку, `server parameters` перейдите в экземпляр MyS'L и измените `time_zone` значение с *SYSTEM* на *0:00*.


### <a name="my-application-crashes-or-throws-an-unexpected-error"></a>В приложении происходит сбой или возникает непредвиденная ошибка

При отладке сбоев приложения начните с проверки состояния работы и состояния обнаружения приложения. Чтобы сделать это, перейдите к _управлению приложениями_ на портале Azure, чтобы убедиться, что статусы всех приложений _являются Running_ и _UP._

* Если статус _запущен,_ но статус обнаружения не _UP,_ перейдите в раздел ["Мое приложение не может быть зарегистрировано".](#my-application-cant-be-registered)

* Если для состояния обнаружения отображается значение _Работает_, перейдите к разделу Метрики и просмотрите работоспособность приложения. Проверьте следующие метрики:


  - `TomcatErrorCount`(_tomcat.global.error_): Все исключения приложений Spring подсчитываются здесь. Если это число большое, перейдите в службу Azure Log Analytics и проверьте журналы приложений.

  - `AppMemoryMax`(_jvm.memory.max_): Максимальное количество памяти, доступное для приложения. Сумма может быть неопределена, или она может измениться с течением времени, если она определена. Если она определена, количество использованной и зафиксированной памяти всегда меньше или равно максимуму. Тем не менее, выделение памяти может выйти из строя с сообщением, `OutOfMemoryError` если распределение пытается увеличить используемую память, которая используется > *зафиксировано,* даже если используется <*макс* по-прежнему верно. В такой ситуации постарайтесь увеличить максимальный размер `-Xmx` кучи, используя параметр.

  - `AppMemoryUsed`(_jvm.memory.used):_ Количество памяти в байтах, которые в настоящее время используются приложением. Для нормального приложения Java- параметрики образует шаблон *пиломатериалов,* где использование памяти постоянно увеличивается и уменьшается небольшими приращениями и внезапно сильно падает, а затем шаблон повторяется. Эта метрическая серия происходит из-за сбора мусора внутри виртуальной машины Java, где действия сбора представляют капли на шаблоне пиломатериалов.
    
    Эта метрика важна для выявления проблем с памятью, таких как:
    * Взрыв памяти в самом начале.
    * Распределение памяти всплеска для определенного логического пути.
    * Постепенная утечка памяти.

  Для получения дополнительной [информации см.](spring-cloud-concept-metrics.md)

Чтобы узнать больше об аналитике журналов Azure, смотрите в [журнале «Начать с помощью аналитики журналов» в Azure Monitor.](https://docs.microsoft.com/azure/azure-monitor/log-query/get-started-portal)

### <a name="my-application-experiences-high-cpu-usage-or-high-memory-usage"></a>В приложении наблюдается высокая загрузка ЦП или интенсивное потребление памяти

Если приложение имеет высокое использование процессора или памяти, верно одно из двух вещей:
* Все экземпляры приложения испытывают высокое использование процессора или памяти.
* В некоторых экземплярах приложения имеется большое использование процессора или памяти.

Чтобы установить, какая ситуация применяется, сделайте следующее:

1. Перейти к **метрике,** а затем выберите либо **Процент использования процессора службы** или **используемую память**службы.
2. Добавьте фильтр **приложения,** чтобы указать, какое приложение вы хотите контролировать.
3. Разделите метрики по **инстанциям.**

Если *все экземпляры* имеют высокий уровень использования процессора или памяти, необходимо либо масштабировать приложение, либо увеличить использование процессора или памяти. Для получения дополнительной информации [см.](spring-cloud-tutorial-scale-manual.md)

Если *в некоторых экземплярах* наблюдается высокое использование процессора или памяти, проверьте состояние экземпляра и состояние его обнаружения.

Для получения дополнительной [информации см.](spring-cloud-concept-metrics.md)

Если все экземпляры запущены и запущены, перейдите в Azure Log Analytics, чтобы заставить журналы приложений заставить их заставить их просмотреть свою логику кода. Это поможет вам увидеть, может ли какой-либо из них повлиять на раздел масштаба. Для получения дополнительной информации [см.](diagnostic-services.md)

Чтобы узнать больше об аналитике журналов Azure, смотрите в [журнале «Начать с помощью аналитики журналов» в Azure Monitor.](https://docs.microsoft.com/azure/azure-monitor/log-query/get-started-portal) Запрос журналов с помощью [языка запроса Kusto](https://docs.microsoft.com/azure/kusto/query/).

### <a name="checklist-for-deploying-your-spring-application-to-azure-spring-cloud"></a>Контрольный список для развертывания приложения Spring в облачность Azure Spring

Перед тем, как вы будете на борту приложения, убедитесь, что она соответствует следующим критериям:

* Приложение можно запустить локально с указанной версией среды выполнения Java.
* Конфигурация среды (ЦП, ОЗУ и экземпляры) соответствует минимальному набору требований поставщика приложений.
* Элементы конфигурации имеют ожидаемые значения. Дополнительные сведения см. в статье [Учебник по настройке сервера конфигурации Spring Cloud для вашей службы](spring-cloud-tutorial-config-server.md).
* Переменные среды имеют ожидаемые значения.
* Параметры JVM имеют ожидаемые значения.
* Мы рекомендовали отключить или удалить встроенные службы _Config Server_ и _Spring Service Registry_ из пакета приложений.
* Если к любым ресурсам Azure нужно применить _привязку службы_, убедитесь, что целевые ресурсы работают.

## <a name="configuration-and-management"></a>Настройка и управление

### <a name="i-encountered-a-problem-with-creating-an-azure-spring-cloud-service-instance"></a>Столкнулась с проблемой при создании экземпляра службы облачных технологий Azure Spring

При настройке экземпляра облачного сервиса Azure Spring с помощью портала Azure облако Azure Spring выполняет проверку для вас.

Но если вы попытаетесь настроить экземпляр облачной службы Azure Spring, используя [CLI Azure](https://docs.microsoft.com/cli/azure/get-started-with-azure-cli) или [шаблон менеджера ресурсов Azure,](https://docs.microsoft.com/azure/azure-resource-manager/)убедитесь:

* подписка активна;
* Местоположение [поддерживается](spring-cloud-faq.md) облачным облаком Azure Spring.
* группа ресурсов для экземпляра уже создана;
* имя ресурса соответствует правилу именования. Он должен содержать только буквы нижнего регистра, цифры и дефисы. Первый символ должен быть буквой. Последний знак должен быть буквой или цифрой. Значение должно содержать от 2 до 32 символов.

Если вы хотите настроить экземпляр облачного отдела Azure Spring с помощью шаблона «Менеджер ресурсов», сначала обратитесь к [«Понять структуру» и синтаксис шаблонов управления ресурсами Azure.](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-authoring-templates)

Имя экземпляра облачных служб Azure Spring будет использоваться для `azureapps.io`запроса имени под домена под запросом, поэтому настройка не сойдется, если имя противоречит существующему. Более подробную информацию можно найти в журналах действий.

### <a name="i-cant-deploy-a-jar-package"></a>Я не могу развернуть пакет JAR

Вы не можете загрузить файл Java Archive (JAR)/исходный пакет с помощью портала Azure или шаблона менеджера ресурсов.

При развертывании пакета приложений с помощью [Azure CLI,](https://docs.microsoft.com/cli/azure/get-started-with-azure-cli)Azure CLI периодически осследует ход развертывания и, в конце концов, отображает результат развертывания.

Если опрос будет прерван, вы сможете выполнить приведенную ниже команду для получения журналов развертывания.

`az spring-cloud app show-deploy-log -n <app-name>`

Убедитесь, что ваше приложение упаковано в правильный [исполняемый формат JAR.](https://docs.spring.io/spring-boot/docs/current/reference/html/executable-jar.html) Если он не упакован правильно, вы получите сообщение об ошибке, аналогичное следующему:

> "Ошибка: Недействительный или коррумпированный кувшин /jar/38bc8ea1-a6bb-4736-8e93-e8f3b52c8714"

### <a name="i-cant-deploy-a-source-package"></a>Я не могу развернуть исходный пакет

Вы не можете загрузить пакет JAR/source с помощью портала Azure или шаблона менеджера ресурсов.

При развертывании пакета приложений с помощью [Azure CLI,](https://docs.microsoft.com/cli/azure/get-started-with-azure-cli)Azure CLI периодически осследует ход развертывания и, в конце концов, отображает результат развертывания.

Если опрос будет прерван, вы сможете выполнить приведенную ниже команду для получения сборки и журналов развертывания.

`az spring-cloud app show-deploy-log -n <app-name>`

Однако обратите внимание, что один экземпляр службы облака Azure Spring может вызвать только одно задание сборки для одного исходного пакета одновременно. Для получения дополнительной информации смотрите [развертывание приложения](spring-cloud-quickstart-launch-app-portal.md) и [настройка среды постановки в облачности Azure Spring.](spring-cloud-howto-staging-environment.md)

### <a name="my-application-cant-be-registered"></a>Мое заявление не может быть зарегистрировано

В большинстве случаев такая ситуация возникает, когда *требуемые зависимости* и *обнаружение службы* не настроены должным образом в файле Project Object Model (POM). После настройки встроенная конечная точка сервера Service Registry вводится в качестве переменной среды с вашим приложением. Затем приложения регистрируются на сервере реестра услуг и обнаруживают другие зависимые микрослужбы.

Подождите, по крайней мере, две минуты, прежде чем вновь зарегистрированный экземпляр начнет получать трафик.

Если вы переносите существующее решение Spring Cloud на основе Azure, убедитесь, что _экземпляры_ ad-hoc Service Registry и _Config Server_ будут удалены (или отключены), чтобы избежать коллизии с управляемыми экземплярами, предоставленными Azure Spring Cloud.

Вы также можете проверить журналы клиентов _реестра служб_ в аналитике журналов azure Log. Для получения дополнительной информации [см.](diagnostic-services.md)

Чтобы узнать больше об аналитике журналов Azure, смотрите в [журнале «Начать с помощью аналитики журналов» в Azure Monitor.](https://docs.microsoft.com/azure/azure-monitor/log-query/get-started-portal) Запрос журналов с помощью [языка запроса Kusto](https://docs.microsoft.com/azure/kusto/query/).

### <a name="i-want-to-inspect-my-applications-environment-variables"></a>Я хочу проверить переменные среды моего приложения

Переменные среды информируют об инфраструктуре облачных технологий Azure Spring, гарантируя, что Azure понимает, где и как настроить службы, входят в состав приложения. Проверка правильности переменных среды является необходимым первым шагом при устранении потенциальных проблем.  Для просмотра переменных среды можно использовать конечную точку Spring Boot Actuator.  

> [!WARNING]
> Эта процедура предоставляет переменные среды с помощью тестовой точки.  Не продолжайте, если тестовая конечная точка является общедоступной или если приложению назначено доменное имя.

1. Перейдите к `https://<your application test endpoint>/actuator/health`.  
    - Ответ, аналогичный `{"status":"UP"}`, указывает, что конечная точка включена.
    - Если ответ отрицательный, включите следующую зависимость в файл *POM.xml:*

        ```xml
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-actuator</artifactId>
            </dependency>
        ```

1. С включенной конечной точкой Spring Boot Actuator перейдите на портал Azure и ищите страницу конфигурации приложения.  Добавьте переменную среды с именем `MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE` и значением. `*` 

1. Перезапустите приложение.

1. Перейти `https://<your application test endpoint>/actuator/env` к и проверить ответ.  Результат будет выглядеть так:

    ```json
    {
        "activeProfiles": [],
        "propertySources": {,
            "name": "server.ports",
            "properties": {
                "local.server.port": {
                    "value": 1025
                }
            }
        }
    }
    ```

Ищите детский `systemEnvironment`узла с именем .  Этот узел содержит переменные среды приложения.

> [!IMPORTANT]
> Не забудьте отменить раскрытие переменных среды перед тем, как сделать приложение общедоступным.  Перейдите на портал Azure, ищите страницу конфигурации приложения `MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE`и удалите эту переменную среды:

### <a name="i-cant-find-metrics-or-logs-for-my-application"></a>Я не могу найти метрики или журналы для моего приложения

Перейдите к **управлению приложением,** чтобы убедиться, что статусы приложения _работают_ и _UP._

Если вы можете видеть метрики от _JVM,_ но нет `spring-boot-actuator` метрик от _Tomcat,_ проверьте, включена ли зависимость в пакете приложений и что она успешно загружается.

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

Если журналы приложений можно архивировать в учетную запись хранения, но не отправлять в Azure Log Analytics, проверьте, правильно ли вы [настроили рабочее пространство.](https://docs.microsoft.com/azure/azure-monitor/learn/quick-create-workspace) Если вы используете бесплатный уровень аналитики журналов Azure, обратите внимание, что [бесплатный уровень не предоставляет соглашения об уровне обслуживания (SLA).](https://azure.microsoft.com/support/legal/sla/log-analytics/v1_3/)
