---
title: Используйте файлы Azure HPC и NetApp Azure
description: Как использовать кэш Azure HPC для улучшения доступа к данным, хранящимся в файлах NetApp Azure
author: ekpgh
ms.service: hpc-cache
ms.topic: conceptual
ms.date: 10/30/2019
ms.author: rohogue
ms.openlocfilehash: 38f9d0338ce4c47024d670e6d3ee89a97faecc91
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80238684"
---
# <a name="use-azure-hpc-cache-with-azure-netapp-files"></a>Используйте кэш Azure HPC с файлами NetApp Azure

Вы можете использовать [файлы Azure NetApp](https://azure.microsoft.com/services/netapp/) в качестве цели хранения для кэша Azure HPC. В этой статье объясняется, как эти две службы могут работать вместе, и дает советы по их настройке.

Файлы Azure NetApp сочетают в себе операционную систему ONTAP с масштабируемостью и скоростью Microsoft Azure. Эта комбинация позволяет пользователям переносить установленные рабочие процессы в облако без переписывания кода.

Добавление компонента Azure HPC Cache может улучшить доступ к файлам, представив несколько томов файлов Azure NetApp в одном агрегированном пространстве имен. Он может обеспечить кэширование кромки для объемов, расположенных в другой области обслуживания. Это также может повысить производительность спроса на объемы, которые были созданы на более низком уровне обслуживания для экономии затрат.

## <a name="overview"></a>Обзор

Чтобы использовать систему Файлов NetApp Azure в качестве резервного хранилища с Кэшем Azure HPC, следуйте этому процессу.

1. Создайте систему и объемы файлов NetApp Azure в соответствии с рекомендациями в [плане вашей системы ниже.](#plan-your-azure-netapp-files-system)
1. Создайте кэш HPC Azure в регионе, где вам нужен доступ к файлам. (Используйте инструкции при [создании кэша azure HPC](hpc-cache-create.md).)
1. [Определите цели хранения](#create-storage-targets-in-the-cache) в кэше, которые указывают на объемы файлов NetApp Azure. Создайте одну цель хранения кэша для каждого уникального IP-адреса, используемого для доступа к объемам.
1. Поимеет клиентов [монтировать кэш HPC Azure](#mount-storage-targets) вместо непосредственного монтажа объемов файлов NetApp Azure NetApp.

## <a name="plan-your-azure-netapp-files-system"></a>Планируйте свою систему файлов NetApp Azure

При планировании системы файлов NetApp Azure обратите внимание на элементы в этом разделе, чтобы убедиться, что вы можете интегрировать ее плавно с Azure HPC Cache.

Также прочитайте [документацию файлов NetApp Azure](../azure-netapp-files/index.yml) перед созданием томов для использования с Azure HPC Cache.

### <a name="nfs-client-access-only"></a>Только доступ к клиенту NFS

В настоящее время Azure HPC Cache поддерживает доступ только к NFS. Он не может быть использован с SMB ACL или POSIX режим бит объемов.

### <a name="exclusive-subnet-for-azure-netapp-files"></a>Эксклюзивная подсеть для файлов NetApp Azure

Для своих томов Azure NetApp Files использует одну делегированную подсеть. Никакие другие ресурсы не могут использовать эту подсеть. Кроме того, только одна подсеть в виртуальной сети может быть использована для файлов Azure NetApp. Узнайте больше в [Руководящих принципах планирования сети Azure NetApp Files.](../azure-netapp-files/azure-netapp-files-network-topologies.md)

### <a name="delegated-subnet-size"></a>Делегированный размер подсети

Используйте минимальный размер для делегированной подсети при создании системы файлов NetApp Azure для использования с Azure HPC Cache.

Минимальный размер, который указан с помощью netmask /28, содержит 16 IP-адресов. На практике Azure NetApp Files использует только три из этих доступных IP-адресов для доступа к объему. Это означает, что для покрытия всех объемов необходимо создать только три цели хранения данных в кэше Azure HPC.

Если делегированная подсеть слишком велика, тома Файлов NetApp Azure может использовать больше IP-адресов, чем один экземпляр Azure HPC Cache. Один кэш может иметь не более десяти целей хранения.

Пример быстрого запуска в документации Azure NetApp Files использует 10.7.0.0/16 для делегированной подсети, что дает слишком большую подсеть.

### <a name="capacity-pool-service-level"></a>Уровень обслуживания пула емкости

При выборе уровня обслуживания для пула емкости учитывайте рабочий процесс. Если вы часто записываете данные обратно в объем Файлов NetApp Azure, производительность кэша может быть ограничена, если время записи медленно. Выберите высокий уровень обслуживания для объемов, которые будут иметь частые записи.

Объемы с низким уровнем обслуживания также могут отображать некоторое отставание в начале задачи, в то время как содержимое кэша предварительно заполняет. После того, как кэш запущен с хорошим рабочим набором файлов, задержка должна стать незаметной.

Важно заранее спланировать уровень обслуживания пула емкости, так как он не может быть изменен после создания. Новый том необходимо будет создать в другом пуле емкости, а данные скопировать.

Обратите внимание, что можно изменить квоту хранения объема и размер пула емкости, не нарушая доступ.

## <a name="create-storage-targets-in-the-cache"></a>Создание целей хранения в кэше

После настройки системы файлов NetApp Azure и создания кэша HPC Azure определите цели хранения в кэше, которые указывают на объемы файловой системы.

Создайте одну цель хранения для каждого IP-адреса, используемого в объемах файлов Сети Азов. IP-адрес указан на странице инструкций по монтажу тома.

Если несколько томов имеют один и тот же IP-адрес, можно использовать одну цель хранения для всех из них.  

Следуйте [инструкциям крепления в документации Azure NetApp Files,](../azure-netapp-files/azure-netapp-files-mount-unmount-volumes-for-virtual-machines.md) чтобы найти IP-адреса для использования.

Вы также можете найти IP-адреса с Azure CLI:

```azurecli
az netappfiles volume list -g ${RESOURCE_GROUP} --account-name ${ANF_ACCOUNT} --pool-name ${POOL} --query "[].mountTargets[].ipAddress" | grep -Ee '[0-9]+[.][0-9]+[.][0-9]+[.][0-9]+' | tr -d '"' | tr -d , | sort | uniq
```

Имена экспортных посыл в системе Azure NetApp Files имеют единый компонент пути. Не пытайтесь создать цель хранения ``/`` для корневого экспорта в файлах NetApp Azure, поскольку этот экспорт не предоставляет доступа к файлам.

Для этих целей хранения нет никаких специальных ограничений на виртуальные пути пространства имен.

## <a name="mount-storage-targets"></a>Цель хранения маунт

Клиентские машины должны устанавливать кэш вместо непосредственного монтажа объемов файлов NetApp Azure. Следуйте инструкциям в [Маунт Azure HPC Кэш](hpc-cache-mount.md).

## <a name="next-steps"></a>Дальнейшие действия

* Подробнее о настройке и [использовании файлов NetApp Azure](../azure-netapp-files/index.yml)
* Для получения справки по планированию и настройке системы Azure HPC Cache для использования файлов Azure NetApp [обратитесь в службу поддержки.](hpc-cache-support-ticket.md)
