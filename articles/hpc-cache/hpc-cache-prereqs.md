---
title: Предпосылки azure HPC Cache
description: Предпосылки для использования кэша HPC Azure
author: ekpgh
ms.service: hpc-cache
ms.topic: conceptual
ms.date: 04/03/2020
ms.author: rohogue
ms.openlocfilehash: 6da35cb60dc5f22be01ae25393bd62327db64867
ms.sourcegitcommit: 62c5557ff3b2247dafc8bb482256fef58ab41c17
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/03/2020
ms.locfileid: "80655663"
---
# <a name="prerequisites-for-azure-hpc-cache"></a>Предпосылки для кэша Высокой азы

Прежде чем использовать портал Azure для создания нового кэша HPC Azure, убедитесь, что среда соответствует этим требованиям.

## <a name="azure-subscription"></a>Подписка Azure.

Рекомендуется платная подписка.

> [!NOTE]
> В течение первых нескольких месяцев выпуска GA команда Azure HPC Cache должна добавить подписку в список доступа, прежде чем она может быть использована для создания экземпляра кэша. Эта процедура помогает гарантировать, что каждый клиент получает высокое качество отзывчивости от своих кэшов. Заполните [эту форму,](https://aka.ms/onboard-hpc-cache) чтобы запросить доступ.

## <a name="network-infrastructure"></a>Сетевая инфраструктура

Перед использованием кэша следует настроить две предпосылки, связанные с сетью:

* Специальная подсеть для экземпляра Кэша высокой выкэша Azure
* Поддержка DNS, чтобы кэш мог получить доступ к хранилищам и другим ресурсам

### <a name="cache-subnet"></a>Подсеть Кэш

Кэш Azure HPC нуждается в специальной подсети с этими качествами:

* Подсеть должна иметь не менее 64 IP-адресов.
* Подсеть не может размещать другие вво-пот, даже для сопутствующих услуг, таких как клиентские машины.
* Если вы используете несколько экземпляров Azure HPC Cache, каждому из них нужна своя подсеть.

Наилучшей практикой является создание новой подсети для каждого кэша. Вы можете создать новую виртуальную сеть и подсеть в рамках создания кэша.

### <a name="dns-access"></a>DNS доступ

Кэшу требуется DNS для доступа к ресурсам за пределами своей виртуальной сети. В зависимости от того, какие ресурсы вы используете, может потребоваться настроить настраиваемый DNS-сервер и настроить переадресировку между этим сервером и DNS-серверами Azure:

* Для доступа к конечным точкам хранения Azure Blob и другим внутренним ресурсам необходим DNS-сервер Azure.
* Чтобы получить доступ к локальному хранению, необходимо настроить пользовательский DNS-сервер, который может решить ваши имена хостов.

Если вам нужен только доступ к хранилищу Blob, вы можете использовать dNS-сервер, предоставленный Azure по умолчанию, для кэша. Однако, если вам нужен доступ к другим ресурсам, необходимо создать пользовательский DNS-сервер и настроить его для переадресов любых запросов разрешения Azure на сервер Azure DNS.

Простой DNS-сервер также может быть использован для загрузки балансовых клиентских соединений между всеми доступными точками крепления кэша.

Узнайте больше о виртуальных сетях Azure и конфигурациях DNS-серверов в [разрешении имен для ресурсов в виртуальных сетях Azure.](https://docs.microsoft.com/azure/virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances)

## <a name="permissions"></a>Разрешения

Проверьте эти предпосылки, связанные с разрешением, прежде чем приначинать создание кэша.

* Экземпляр кэша должен быть в состоянии создавать виртуальные сетевые интерфейсы (NICs). Пользователь, создающий кэш, должен иметь достаточные привилегии в подписке для создания NICs.

* При использовании хранилища Blob Кэш HPC Azure нуждается в авторизации для доступа к учетной записи хранилища. Используйте элемент управления доступом на основе ролей (RBAC), чтобы предоставить доступ к кэшу к хранилищу Blob. Требуются две роли: вкладчик учетной записи хранения данных и вкладчик данных хранилища Blob.

  Следуйте инструкциям в [целях хранения добавления,](hpc-cache-add-storage.md#add-the-access-control-roles-to-your-account) чтобы добавить роли.

## <a name="storage-infrastructure"></a>Инфраструктура хранения

Кэш поддерживает контейнеры Azure Blob или экспорт оборудования NFS. Добавление целей хранения после создания кэша.

Каждый тип хранилища имеет определенные предпосылки.

### <a name="blob-storage-requirements"></a>Требования к хранению blob

Если вы хотите использовать хранилище Azure Blob с кэшем, вам нужна совместимая учетная запись хранения и пустой контейнер Blob или контейнер, который заполняется отформатированными данными Azure HPC Cache, как описано в [данных Move в хранилище Azure Blob.](hpc-cache-ingest.md)

Создайте учетную запись перед попыткой добавить цель хранения. При добавлении цели можно создать новый контейнер.

Для создания совместимой учетной записи хранилища используйте следующие настройки:

* Производительность: **Стандартная**.
* Вид счета: **StorageV2 (общая цель v2)**
* Репликация: **Локально избыточное хранилище (LRS)**.
* Уровень доступа (по умолчанию): **Горячий**

Использование учетной записи хранилища в том же месте, что и кэш.
<!-- clarify location - same region or same resource group or same virtual network? -->

Вы также должны предоставить приложению кэша доступ к учетной записи хранения Azure, как указано в [Разрешении,](#permissions)выше. Следуйте процедуре в [целях хранения добавления,](hpc-cache-add-storage.md#add-the-access-control-roles-to-your-account) чтобы дать кэшу требуемые роли доступа. Если вы не являетесь владельцем учетной записи хранилища, попросите владельца сделать этот шаг.

### <a name="nfs-storage-requirements"></a>Требования к хранению NFS

При использовании системы хранения NFS (например, системы нахидного оборудования НАК) убедитесь, что она отвечает этим требованиям. Возможно, вам придется работать с сетевыми администраторами или менеджерами брандмауэров для вашей системы хранения данных (или центра обработки данных) для проверки этих настроек.

> [!NOTE]
> Создание цели хранения не удастся, если кэш не имеет достаточного доступа к системе хранения NFS.

Более подробная информация включена в [конфигурацию Troubleshoot NAS и целевые проблемы хранения NFS.](troubleshoot-nas.md)

* **Подключение к сети:** Кэш Azure HPC нуждается в доступе к сети с высокой пропускной способностью между подсетью кэша и центром обработки данных системы NFS. [Рекомендуется ExpressRoute](https://docs.microsoft.com/azure/expressroute/) или аналогичный доступ. При использовании VPN, возможно, потребуется настроить его для зажима TCP MSS на 1350, чтобы убедиться, что большие пакеты не заблокированы. Прочитайте [ограничения размера VPN для](troubleshoot-nas.md#adjust-vpn-packet-size-restrictions) дополнительной помощи для устранения настроек VPN.

* **Доступ в порт:** Кэшу необходим доступ к определенным портам TCP/UDP в вашей системе хранения данных. Различные типы хранения имеют различные портовые требования.

  Чтобы проверить настройки системы хранения данных, следуйте этой процедуре.

  * Выдали `rpcinfo` команду в систему хранения для проверки необходимых портов. Команда ниже перечисляет порты и форматы соответствующих результатов в таблице. (Используйте IP-адрес вашей системы вместо *<storage_IP>* термина.)

    Вы можете выдать эту команду любому клиенту Linux, у которого установлена инфраструктура NFS. Если вы используете клиента внутри кластерной подсети, это также может помочь проверить связь между подсетью и системой хранения данных.

    ```bash
    rpcinfo -p <storage_IP> |egrep "100000\s+4\s+tcp|100005\s+3\s+tcp|100003\s+3\s+tcp|100024\s+1\s+tcp|100021\s+4\s+tcp"| awk '{print $4 "/" $3 " " $5}'|column -t
    ```

  Убедитесь, что все порты, возвращенные ``rpcinfo`` запросом, позволяют неограниченный трафик из подсети Azure HPC Cache.

  * Если вы не можете `rpcinfo` использовать команду, убедитесь, что эти широко используемые порты позволяют входящих и исходящих трафика:

    | Протокол | Порт  | Служба  |
    |----------|-------|----------|
    | TCP/UDP  | 111   | rpcbind  |
    | TCP/UDP  | 2049  | NFS      |
    | TCP/UDP  | 4045  | nlockmgr |
    | TCP/UDP  | 4046  | монтируется   |
    | TCP/UDP  | 4047  | status   |

    Некоторые системы используют различные номера портов для этих услуг - обратитесь к документации вашей системы хранения, чтобы быть уверенным.

  * Проверьте настройки брандмауэра, чтобы убедиться, что они позволяют трафик на всех этих необходимых портов. Обязательно проверяйте брандмауэры, используемые в Azure, а также предприимченные брандмауэры в центре обработки данных.

* **Доступ к каталогу:** Включить `showmount` команду в системе хранения. Azure HPC Cache использует эту команду, чтобы проверить, указывает ли целевая конфигурация хранилища на допустимый экспорт, а также убедиться, что несколько креплений не имеют доступа к тем же субдиректорам (риск столкновения файлов).

  > [!NOTE]
  > Если ваша система хранения NFS использует операционную систему NETApp ONTAP 9.2, **не включайте. `showmount` ** Обратитесь за помощью [в службу поддержки корпорации Майкрософт.](hpc-cache-support-ticket.md)

  Подробнее о доступе к каталогу, включенном в статью о целевом [устранении неполадок](troubleshoot-nas.md#enable-export-listing)NFS.

* **Корневой доступ** (читай/написать): Кэш подключается к системе бэк-энда в качестве идентификатора пользователя 0. Проверьте эти настройки в вашей системе хранения данных:
  
  * Включите `no_root_squash`. Эта опция гарантирует, что удаленный корневой пользователь может получить доступ к файлам, принадлежащим root.

  * Проверьте экспортные политики, чтобы убедиться, что они не включают ограничения на корневой доступ из подсети кэша.

  * Если в вашем хранилище есть какие-либо экспортные товары, которые являются субдиректорами другого экспорта, убедитесь, что кэш имеет корневой доступ к самому низкому сегменту пути. Читайте [Root access на пути каталога](troubleshoot-nas.md#allow-root-access-on-directory-paths) в статье NFS target troubleshooting для получения подробной информации.

* Хранение резервного копирования NFS должно быть совместимой аппаратно-программной платформой. Для получения подробной информации обратитесь в группу Azure HPC Cache.

## <a name="next-steps"></a>Дальнейшие действия

* [Создание экземпляра кэша HPC Azure](hpc-cache-create.md) с портала Azure
