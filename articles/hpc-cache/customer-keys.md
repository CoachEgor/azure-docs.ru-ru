---
title: Используйте ключи с клиентом для шифрования данных в кэше Azure HPC
description: Как использовать Azure Key Vault с кэшем Azure HPC для управления доступом к ключам шифрования вместо использования ключей шифрования, управляемых Корпорацией Майкрософт по умолчанию
author: ekpgh
ms.service: hpc-cache
ms.topic: conceptual
ms.date: 04/15/2020
ms.author: v-erkel
ms.openlocfilehash: a31979763dd1ab5d8f289deef0e30cce27bb0df4
ms.sourcegitcommit: 31ef5e4d21aa889756fa72b857ca173db727f2c3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81538873"
---
# <a name="use-customer-managed-encryption-keys-for-azure-hpc-cache"></a>Используйте ключи шифрования, управляемые клиентами, для кэша Azure HPC

Для управления владением ключами, используемыми для шифрования данных в Azure HPC Cache, можно использовать Azure Key Vault. В этой статье объясняется, как использовать управляемые клиентом ключи для шифрования данных кэша.

> [!NOTE]
> Все данные, хранящиеся в Azure, в том числе на дисках кэша, шифруются в состоянии по умолчанию с помощью ключей, управляемых корпорацией Майкрософт. Вам нужно только следовать шагам в этой статье, если вы хотите управлять ключами, используемыми для шифрования данных.

Эта функция доступна только в этих регионах Azure:

* Восточная часть США
* Центрально-южная часть США
* западная часть США 2

Существует три шага для обеспечения шифрования ключей, управляемого клиентом для кэша Azure HPC:

1. Навеяжись в Хранилище ключей Azure для хранения ключей.
1. При создании кэша HPC Azure выберите шифрование ключей, управляемое клиентом, и укажите хранилище ключей и ключ для использования.
1. После создания кэша авторизуем его доступ к хранилищу ключей.

Шифрование не настроено полностью до тех пор, пока вы не авторизуете его из вновь созданного кэша (шаг 3). Это происходит потому, что необходимо передать идентификацию кэша в хранилище ключей, чтобы сделать его авторизованным пользователем. Вы не можете сделать это до создания кэша, потому что инталь не существует до тех пор, пока кэш не будет создан.

После создания кэша нельзя изменяться между ключами, управляемыми клиентом, и ключами, управляемыми корпорацией Майкрософт. Однако, если кэш использует управляемые клиентом ключи, вы можете [изменить](#update-key-settings) ключ шифрования, ключевую версию и хранилище ключей по мере необходимости.

## <a name="understand-key-vault-and-key-requirements"></a>Понимание хранилища ключей и ключевых требований

Ключ и ключ должны соответствовать этим требованиям для работы с Azure HPC Cache.

Ключевые свойства хранилища:

* **Подписка** - Используйте ту же подписку, которая используется для кэша.
* **Регион** - Хранилище ключей должно находиться в том же регионе, что и кэш Azure HPC.
* **Уровень ценообразования** - Стандартный уровень достаточен для использования с Azure HPC Cache.
* **Мягкое удаление** - Azure HPC Cache позволит мягко удалить, если он еще не настроен на хранилище ключей.
* **Защита от очистки** - Защита от очистки должна быть включена.
* **Политика доступа** - параметры по умолчанию достаточны.
* **Подключение к сети** - Кэш hPC Azure должен иметь доступ к хранилищу ключей независимо от параметров конечной точки, которые вы выбираете.

Ключевые свойства:

* **Ключевой тип** - RSA
* **Размер ключа RSA** - 2048
* **Включено** - Да

Разрешения доступа к ключевым хранилищам:

* Пользователь, создающий кэш HPC Azure, должен иметь разрешения, эквивалентные [роли вклада Key Vault.](../role-based-access-control/built-in-roles.md#key-vault-contributor) Для настройки и управления Azure Key Vault требуются те же разрешения.

  Для получения дополнительной информации прочитайте [безопасный доступ к хранилищу ключей.](../key-vault/key-vault-secure-your-key-vault.md)

## <a name="1-set-up-azure-key-vault"></a>1. Настройка Убежища ключей Azure

Перед созданием кэша можно настроить хранилище ключей и ключ или сделать его в рамках создания кэша. Убедитесь, что эти ресурсы отвечают требованиям, изложенным [выше.](#understand-key-vault-and-key-requirements)

Во время создания кэша необходимо указать свод, ключ и ключевую версию для шифрования кэша.

Подробно ознакомьте [документацию Azure Key Vault.](../key-vault/key-vault-overview.md)

> [!NOTE]
> Убежище ключей Azure должно использовать ту же подписку и находиться в том же регионе, что и кэш HPC Azure. Используйте один из поддерживаемых регионов, перечисленных в начале этой статьи.

## <a name="2-create-the-cache-with-customer-managed-keys-enabled"></a>2. Создание кэша с включенными ключами, управляемыми клиентом

При создании кэша Azure HPC необходимо указать источник ключа шифрования. Следуйте инструкциям в [создании кэша HPC Azure](hpc-cache-create.md)и укажите хранилище ключей и ключ на странице **ключей шифрования Disk.** Во время создания кэша можно создать новое хранилище ключей и ключ.

> [!TIP]
> Если страница **ключей шифрования Disk** не отображается, убедитесь, что кэш находится в одном из поддерживаемых регионов.

Пользователь, создающий кэш, должен иметь привилегии, равные [роли вкладчика Key Vault](../role-based-access-control/built-in-roles.md#key-vault-contributor) или выше.

1. Нажмите кнопку, чтобы включить частные клавиши. После изменения этой настройки отображаются настройки хранилища ключей.

1. Нажмите **Выберите хранилище ключей,** чтобы открыть страницу выбора ключей. Выберите или создайте хранилище ключей и ключ для шифрования данных на дисках этого кэша.

   Если хранилище ключей Azure не отображается в списке, проверьте следующие требования:

   * Является ли кэш в той же подписке, что и хранилище ключей?
   * Является ли кэш в том же регионе, что и хранилище ключей?
   * Существует ли подключение к сети между порталом Azure и хранилищем ключей?

1. После выбора хранилища выберите индивидуальный ключ из доступных опций или создайте новый ключ. Ключ должен быть 2048-разрядный ключ RSA.

1. Укажите версию для выбранного ключа. Подробнее о версиях читайте в [документации Azure Key Vault.](../key-vault/about-keys-secrets-and-certificates.md#objects-identifiers-and-versioning)

Продолжить работу с остальными спецификациями и создать кэш, описанный в [Create an Azure HPC Cache.](hpc-cache-create.md)

## <a name="3-authorize-azure-key-vault-encryption-from-the-cache"></a>3. Разрешить шифрование Убежища ключей Azure из кэша
<!-- header is linked from create article, update if changed -->

Через несколько минут новый кэш Azure HPC появляется на портале Azure. Перейдите на страницу **«Обзор»,** чтобы разрешить доступ к вашему Убежище ключей Azure и включить шифрование ключей, управляемое клиентом. (Кэш может отображаться в списке ресурсов до ясности сообщений «развертывание ведется».)

Этот двухэтапный процесс необходим, поскольку экземпляр azure HPC Cache нуждается в идентификационном данныи для получения авторизации в Хранилище ключей Azure. Идентификация кэша не существует до завершения начальных этапов создания.

> [!NOTE]
> Вы должны авторизовать шифрование в течение 90 минут после создания кэша. Если вы не завершите этот шаг, кэш тайм-аут и сбой. Неудавшийся кэш должен быть воссоздан, он не может быть исправлен.

Кэш отображает состояние **Ожидания ключа.** Нажмите кнопку **шифрования Включить** в верхней части страницы, чтобы разрешить кэш для доступа к указанному своду ключей.

![скриншот страницы обзора кэша на портале с выделением кнопки шифрования Enable (верхний ряд) и статуса: Ожидание ключа](media/waiting-for-key.png)

Нажмите **на шифрование включить,** а затем нажмите кнопку **"Да",** чтобы разрешить кэшу использовать ключ шифрования. Это действие также позволяет мягко-удалить и очистить защиту (если еще не включено) на хранилище ключей.

![скриншот страницы обзора кэша на портале, с баннером сообщение в верхней части, которая просит пользователя включить шифрование, нажав да](media/enable-keyvault.png)

После того, как кэш запрашивает доступ к хранилищу ключей, он может создавать и шифровать диски, которые хранят кэшированные данные.

После авторизации шифрования Azure HPC Cache проходит еще несколько минут настройки для создания зашифрованных дисков и соответствующей инфраструктуры.

## <a name="update-key-settings"></a>Настройки ключей обновления

Можно изменить хранилище ключей, ключ или ключевую версию для кэша с портала Azure. Нажмите на ссылку настроек **шифрования** кэша, чтобы открыть страницу **параметров ключей клиента.** (Нельзя изменять кэш между ключами, управляемыми клиентом, и системными ключами.)

![скриншот страницы "Настройки ключей клиента", достигаемый путем нажатия на кнопку "Настройки > шифрование со страницы кэша на портале Azure](media/change-key-click.png)

Нажмите на ссылку **«Изменить»** и нажмите **кнопку «Изменить хранилище ключа, ключ или версию»,** чтобы открыть селектор ключа.

![скриншот страницы «Выбрать ключ из Azure Key Vault» с тремя селекторами для выбора хранилища ключей, ключа и версии](media/select-new-key.png)

В списке отображаются хранилища ключей в той же подписке и в том же регионе, что и этот кэш.

После выбора новых значений ключей шифрования нажмите **«Выберите».** Появляется страница подтверждения с новыми значениями. Нажмите **Сохранить** для завершения выбора.

![скриншот страницы подтверждения с кнопкой Сохранить в верхнем левом верхнем](media/save-key-settings.png)

## <a name="read-more-about-customer-managed-keys-in-azure"></a>Узнайте больше о ключах, управляемых клиентами, в Azure

В этих статьях подробнее объясняется использование Azure Key Vault и управляемых клиентами ключей для шифрования данных в Azure:

* [Обзор шифрования данных Лазурного хранилища](../storage/common/storage-service-encryption.md)
* [Шифрование дисков с ключами, управляемыми клиентом](../virtual-machines/linux/disk-encryption.md#customer-managed-keys) - Документация для использования Azure Key Vault и управляемых дисков, которая аналогична процессу, используемому с Кэшем Высокой Азии

## <a name="next-steps"></a>Следующие шаги

После создания кэша Azure HPC и авторизованного шифрования Key Vault продолжайте настраивать кэш, предоставляя ему доступ к источникам данных.

* [Добавление целевых объектов хранилища](hpc-cache-add-storage.md)
