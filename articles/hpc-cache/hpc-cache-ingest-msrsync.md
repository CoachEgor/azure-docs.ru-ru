---
title: Прием данных кэша HPC Azure — мсрсинк
description: Как использовать мсрсинк для перемещения данных в целевое хранилище BLOB-объектов в кэше HPC Azure
author: ekpgh
ms.service: hpc-cache
ms.topic: conceptual
ms.date: 10/30/2019
ms.author: rohogue
ms.openlocfilehash: 3e5937a036763fab57f9e37494ace33e8452b1f2
ms.sourcegitcommit: f4d8f4e48c49bd3bc15ee7e5a77bee3164a5ae1b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2019
ms.locfileid: "73582272"
---
# <a name="azure-hpc-cache-data-ingest---msrsync-method"></a>Метод приема данных кэша HPC Azure для мсрсинк

В этой статье приводятся подробные инструкции по использованию служебной программы ``msrsync`` для копирования данных в контейнер хранилища BLOB-объектов Azure для использования с кэшем HPC Azure.

Дополнительные сведения о перемещении данных в хранилище BLOB-объектов для кэша HPC Azure см. в статье [Перемещение данных в хранилище BLOB-объектов Azure для кэша HPC Azure](hpc-cache-ingest.md).

Инструмент ``msrsync`` можно использовать для перемещения данных в целевое хранилище серверной части для кэша HPC Azure. Это средство предназначено для оптимизации использования пропускной способности путем запуска нескольких параллельных процессов ``rsync``. Оно доступно на сайте GitHub по адресу https://github.com/jbd/msrsync.

``msrsync`` разбивает исходный каталог на отдельные группы, а затем запускает отдельные процессы ``rsync`` в каждой группе.

Предварительное тестирование с использованием четырех основных виртуальных машин показало наилучшую эффективность при выполнении 64 процессов. Используйте параметр ``msrsync`` в ``-p``, чтобы настроить 64 процесса.

Обратите внимание, что ``msrsync`` может выполнять запись только в локальные тома и из них. Источник и назначение должны быть доступны как локальные подключения на рабочей станции, используемой для выполнения команды.

Выполните приведенные ниже инструкции, чтобы использовать ``msrsync`` для заполнения хранилища больших двоичных объектов Azure с помощью кэша HPC Azure.

1. Установите ``msrsync`` и необходимые компоненты (``rsync`` и Python 2,6 или более поздней версии).
1. Определите общее число копируемых файлов и каталогов.

   Например, используйте служебную программу ``prime.py`` с аргументами ```prime.py --directory /path/to/some/directory``` (доступно путем загрузки <https://github.com/Azure/Avere/blob/master/src/clientapps/dataingestor/prime.py>).

   Если не используется ``prime.py``, можно вычислить количество элементов с помощью средства GNU ``find`` следующим образом:

   ```bash
   find <path> -type f |wc -l         # (counts files)
   find <path> -type d |wc -l         # (counts directories)
   find <path> |wc -l                 # (counts both)
   ```

1. Разделите число элементов на 64, чтобы определить количество элементов для каждого процесса. Используйте это число с параметром ``-f``, чтобы задать размер групп при выполнении команды.

1. Выполните команду ``msrsync``, чтобы скопировать файлы:

   ```bash
   msrsync -P --stats -p64 -f<ITEMS_DIV_64> --rsync "-ahv --inplace" <SOURCE_PATH> <DESTINATION_PATH>
   ```

   Например, эта команда предназначена для перемещения файлов 11 000 в процессах 64 с/тест/саурце-репоситори на/МНТ/хпккаче/репоситори:

   ``mrsync -P --stats -p64 -f170 --rsync "-ahv --inplace" /test/source-repository/ /mnt/hpccache/repository``
