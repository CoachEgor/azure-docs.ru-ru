---
title: Проблемы, связанные с целями хранения Кэша NFS,
description: Советы по предотвращению и исправлению ошибок конфигурации и других проблем, которые могут привести к сбою при создании целевого показателя хранения NFS
author: ekpgh
ms.service: hpc-cache
ms.topic: conceptual
ms.date: 02/20/2020
ms.author: rohogue
ms.openlocfilehash: c88ffb9e87bc0688cc87b816efaa8e101e23407c
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "77652091"
---
# <a name="troubleshoot-nas-configuration-and-nfs-storage-target-issues"></a>Проблемы для устранения проблем NAS конфигурации и nFS целевых проблем хранения

В этой статье приводятся решения для некоторых распространенных ошибок конфигурации и других проблем, которые могут помешать Кэшу HPC Azure добавить систему хранения NFS в качестве цели хранения данных.

Эта статья содержит подробную информацию о том, как проверить порты и как включить корневой доступ к системе NAS. Она также включает подробную информацию о менее распространенных проблемах, которые могут привести к сбою создания целевого уровня хранилища NFS.

> [!TIP]
> Прежде чем использовать это руководство, прочитайте [предпосылки для целей хранения NFS.](hpc-cache-prereqs.md#nfs-storage-requirements)

Если решение вашей проблемы не включено здесь, пожалуйста, [откройте билет поддержки,](hpc-cache-support-ticket.md) чтобы служба и поддержка Майкрософт могли работать с вами для расследования и решения проблемы.

## <a name="check-port-settings"></a>Проверка настроек порта

Кэш Azure HPC нуждается в доступе к нескольким портам UDP/TCP в системе хранения NAS. Убедитесь, что эти порты доступны в системе NAS, а также что трафик разрешен в эти порты через любые брандмауэры между системой хранения и подсетью кэша. Возможно, вам придется работать с брандмауэром и сетевыми администраторами для вашего центра обработки данных для проверки этой конфигурации.

Порты отличаются для систем хранения от разных поставщиков, поэтому проверьте требования системы при настройке цели хранения.

Как правило, кэш нуждается в доступе к этим портам:

| Протокол | Порт  | Служба  |
|----------|-------|----------|
| TCP/UDP  | 111   | rpcbind  |
| TCP/UDP  | 2049  | NFS      |
| TCP/UDP  | 4045  | nlockmgr |
| TCP/UDP  | 4046  | монтируется   |
| TCP/UDP  | 4047  | status   |

Чтобы узнать конкретные порты, необходимые для вашей системы, используйте следующую ``rpcinfo`` команду. В приведенной ниже команде перечислены порты и форматы соответствующих результатов в таблице. (Используйте IP-адрес вашей системы вместо *<storage_IP>* термина.)

Вы можете выдать эту команду любому клиенту Linux, у которого установлена инфраструктура NFS. Если вы используете клиента внутри кластерной подсети, это также может помочь проверить связь между подсетью и системой хранения данных.

```bash
rpcinfo -p <storage_IP> |egrep "100000\s+4\s+tcp|100005\s+3\s+tcp|100003\s+3\s+tcp|100024\s+1\s+tcp|100021\s+4\s+tcp"| awk '{print $4 "/" $3 " " $5}'|column -t
```

Убедитесь, что все порты, возвращенные ``rpcinfo`` запросом, позволяют неограниченный трафик из подсети Azure HPC Cache.

Проверьте эти настройки как на самом NAS, так и на любых брандмауэрах между системой хранения и подсетью кэша.

## <a name="check-root-access"></a>Проверка доступа корней

Кэш HPC Azure нуждается в доступе к экспорту вашей системы хранения для создания цели хранения. В частности, он монтирует экспорт в качестве идентификатора пользователя 0.

Различные системы хранения данных используют различные методы для обеспечения такого доступа:

* Linux-серверы ``no_root_squash`` обычно добавляют к ``/etc/exports``экспортируемому пути в .
* Системы NetApp и EMC обычно контролируют доступ с правилами экспорта, которые привязаны к определенным IP-адресам или сетям.

При использовании правил экспорта помните, что кэш может использовать несколько различных IP-адресов из подсети кэша. Разрешить доступ от полного спектра возможных IP-адресов подсети.

Работайте с поставщиком NAS-хранилища, чтобы обеспечить правильный уровень доступа к кэшу.

### <a name="allow-root-access-on-directory-paths"></a>Разрешить доступ корней на пути каталога
<!-- linked in prereqs article -->

Для систем NAS, экспортирующие иерархические каталоги, Azure HPC Cache нуждается в корневом доступе к каждому уровню экспорта.

Например, система может отображать три таких экспорта:

* ``/ifs``
* ``/ifs/accounting``
* ``/ifs/accounting/payroll``

Экспорт ``/ifs/accounting/payroll`` является ``/ifs/accounting``ребенком, ``/ifs/accounting`` и сам по ``/ifs``себе ребенок .

Если вы ``payroll`` добавляете экспорт в качестве цели хранения кэша ``/ifs/`` HPC, кэш фактически монтируется и получает оттуда доступ к каталогу заработной платы. Поэтому для доступа к экспорту ``/ifs`` ``/ifs/accounting/payroll`` azure HPC Cache необходим корневой доступ.

Это требование связано с тем, как кэш индексирует файлы и избегает столкновений файлов, используя файлоручки, которые предоставляет система хранения.

Система NAS с иерархическим экспортом может давать различные ручки файлов для одного и того же файла, если файл извлекается из различных экспортных товаров. Например, клиент может ``/ifs/accounting`` смонтировать ``payroll/2011.txt``и получить доступ к файлу. Другой клиент ``/ifs/accounting/payroll`` монтирует и ``2011.txt``получает доступ к файлу. В зависимости от того, как система хранения назначает ручки файлов, эти два клиента ``<mount2>/payroll/2011.txt`` могут ``<mount3>/2011.txt``получить один и тот же файл с различными декорами файлов (один для и один для).

Система хранения бэк-энда сохраняет внутренние псевдонимы для ручек файлов, но Кэш HPC Azure не может сказать, какой файл обрабатывает в своей индексной ссылке тот же элемент. Таким образом, возможно, что кэш может иметь различные записи, кэшированные для одного и того же файла, и применять изменения неправильно, потому что он не знает, что они являются тем же файлом.

Чтобы избежать возможного столкновения файлов с файлами в нескольких экспортных, Azure HPC``/ifs`` Cache автоматически устанавливает самый мелкий доступный экспорт в пути (в примере) и использует ручку файла, приведенную из этого экспорта. Если несколько экспортных посевов используют один и тот же базовый путь, Azure HPC Cache нуждается в корневом доступе к этому пути.

## <a name="enable-export-listing"></a>Включить экспортный листинг
<!-- link in prereqs article -->

NAS должен перечислить свой экспорт, когда запрашивает его Azure HPC Cache.

В большинстве систем хранения данных NFS вы можете протестировать это, отправив следующий запрос от клиента Linux:``showmount -e <storage IP address>``

По возможности используйте клиент Linux из той же виртуальной сети, что и кэш.

Если эта команда не перечисляет экспорт, кэш будет иметь проблемы с подключением к вашей системе хранения. Работайте с поставщиком NAS, чтобы включить экспортное объявление.

## <a name="adjust-vpn-packet-size-restrictions"></a>Отрегулируйте ограничения размера VPN-пакетов
<!-- link in prereqs article -->

Если у вас есть VPN между кэшом и устройством NAS, VPN может блокировать полноразмерные пакеты Ethernet объемом 1500 байт. У вас может возникнуть эта проблема, если большие обмены между NAS и экземпляром Azure HPC Cache не завершены, но небольшие обновления работают, как ожидалось.

Существует не простой способ сказать, есть ли у вашей системы эта проблема, если вы не знаете детали вашей конфигурации VPN. Вот несколько методов, которые помогут вам проверить эту проблему.

* Используйте пакетные нюхатели по обе стороны VPN, чтобы определить, какие пакеты успешно передаются.
* Если ваш VPN позволяет пинг-команды, вы можете проверить отправку полноразмерного пакета.

  Выполнить пинг-команды по VPN на NAS с этими опциями. (Используйте IP-адрес вашей системы хранения вместо *<storage_IP>* значение.)

   ```bash
   ping -M do -s 1472 -c 1 <storage_IP>
   ```

  Вот параметры в команде:

  * ``-M do``- Не фрагментация
  * ``-c 1``- Отправить только один пакет
  * ``-s 1472``- Установите размер полезной нагрузки до 1472 байтов. Это максимальная полезная нагрузка размера для пакета объемом 1500 байт после учета накладных расходов Ethernet.

  Успешный ответ выглядит следующим образом.

  ```bash
  PING 10.54.54.11 (10.54.54.11) 1472(1500) bytes of data.
  1480 bytes from 10.54.54.11: icmp_seq=1 ttl=64 time=2.06 ms
  ```

  Если пинг не справляется с 1472 байтами, возможно, потребуется настроить зажим MSS на VPN, чтобы сделать удаленную систему должным образом обнаружить максимальный размер кадра. Чтобы узнать больше, читайте [документацию по параметрам VPN Gateway IPsec/IKE.](../vpn-gateway/vpn-gateway-about-vpn-devices.md#ipsec)

## <a name="check-for-acl-security-style"></a>Проверка стиля безопасности ACL

Некоторые системы NAS используют гибридный стиль безопасности, который сочетает в себе списки управления доступом (ACLs) с традиционными POSIX или UNIX безопасности.

Если ваша система сообщает о своем стиле безопасности как UNIX или POSIX, не включая аббревиатуру "ACL", эта проблема не влияет на вас.

Для систем, которые используют ACLs, Azure HPC Cache необходимо отслеживать дополнительные значения, связанные с пользователем, чтобы контролировать доступ к файлам. Это делается путем включения кэша доступа. Для включения кэша доступа нет элемента управления, но можно открыть билет поддержки, чтобы запросить его включение целевых показателей хранения в системе кэша.

## <a name="next-steps"></a>Дальнейшие действия

Если у вас есть проблема, которая не была решена в этой статье, [откройте билет поддержки,](hpc-cache-support-ticket.md) чтобы получить экспертную помощь.
