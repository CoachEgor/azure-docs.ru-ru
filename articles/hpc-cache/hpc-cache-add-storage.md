---
title: Добавление хранилища в кэш HPC Azure
description: Как определить цели хранения, чтобы кэш Azure HPC можно было использовать припредвенную систему NFS или контейнеры Azure Blob для долгосрочного хранения файлов
author: ekpgh
ms.service: hpc-cache
ms.topic: conceptual
ms.date: 04/03/2020
ms.author: rohogue
ms.openlocfilehash: 3fbc4e683c2b0e72c3a084a59793dbf9eb4b658c
ms.sourcegitcommit: 62c5557ff3b2247dafc8bb482256fef58ab41c17
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/03/2020
ms.locfileid: "80657404"
---
# <a name="add-storage-targets"></a>Добавление целевых объектов хранилища

Цели хранения — это *резервное* хранилище файлов, которые доступны через кэш HPC Azure. Вы можете добавить хранилище NFS (например, локальная аппаратная система) или хранить данные в Azure Blob.

Можно определить до десяти различных целей хранения для одного кэша. Кэш представляет все целевые показатели хранилища в одном агрегированном пространстве имен.

Помните, что экспорт хранилища должен быть доступен из виртуальной сети кэша. Для локального хранения оборудования может потребоваться настроить DNS-сервер, который может решать имена хостов для доступа к памяти NFS. Подробнее в [DNS доступ](hpc-cache-prereqs.md#dns-access).

Добавление целей хранения после создания кэша. Процедура немного отличается в зависимости от того, добавляете ли вы хранилище Azure Blob или экспорт NFS. Подробная информация для каждого из них ниже.

## <a name="open-the-storage-targets-page"></a>Откройте страницу целевых показателей хранения

С портала Azure откройте экземпляр кэша и нажмите **на цели хранения** на левой боковой панели. Страница «Цель хранения» перечисляет все существующие цели и дает ссылку для добавления новой.

![скриншот целей хранения ссылку на боковой панели, под заголовком Настройка, которая находится между категориями заголовки Настройки и мониторинга](media/hpc-cache-storage-targets-sidebar.png)

## <a name="add-a-new-azure-blob-storage-target"></a>Добавьте новую цель хранения Azure Blob

Новой целевой цели хранения Blob необходим пустой контейнер Blob или контейнер, населенный данными в формате облачной файловой системы Azure HPC Cache. Подробнее о предварительной загрузке контейнера Blob читайте в [материале «Перемещение данных в хранилище Azure Blob».](hpc-cache-ingest.md)

Вы можете создать новый контейнер с этой страницы непосредственно перед его добавлением.

![скриншот целевой страницы хранилища добавления, населенной информацией для новой цели хранения Azure Blob](media/hpc-cache-add-blob.png)

Чтобы определить контейнер Azure Blob, введите эту информацию.

* **Целевое имя хранилища** - Установить имя, которое идентифицирует эту цель хранения в кэше HPC Azure.
* **Тип цели** - Выберите **Blob**.
* **Учетная запись хранения** - Выберите учетную запись, которую вы хотите использовать.

  Для доступа к учетной записи хранилища, описанной в [роли доступа,](#add-the-access-control-roles-to-your-account)необходимо авторизовать экземпляр кэша.

  Для получения информации о том, какой счет хранения вы можете использовать, прочитайте [требования к хранению Blob](hpc-cache-prereqs.md#blob-storage-requirements).

* **Контейнер для хранения** - Выберите контейнер Blob для этой цели или нажмите **Создать новый**.

  ![скриншот диалога для указания имени и уровня доступа (частный) для нового контейнера](media/add-blob-new-container.png)

* **Виртуальный путь пространства имен** - Установите путь файла, обращенного к клиенту, для этой цели хранения. Прочитайте [агрегированное пространство имен,](hpc-cache-namespace.md) чтобы узнать больше о виртуальной функции пространства имен.

После завершения, нажмите **OK,** чтобы добавить цель хранения.

> [!NOTE]
> Если брандмауэр учетной записи хранилища будет ограничивать доступ только к "выбранным сетям", используйте временный обходной путь, задокументированный в [настройках брандмауэра учетной](hpc-cache-blob-firewall-fix.md)записи хранилища Blob.

### <a name="add-the-access-control-roles-to-your-account"></a>Добавление ролей управления доступом в учетную запись

Кэш Azure HPC использует [элементы управления доступом на основе ролей (RBAC)](https://docs.microsoft.com/azure/role-based-access-control/index) для авторизации службы кэша для доступа к учетной записи хранения для целей хранения Azure Blob.

Владелец учетной записи хранилища должен явно добавить роли [Вкладчика учетной записи хранения](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#storage-account-contributor) и [вкладчика данных хранилища Blob](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#storage-blob-data-contributor) для пользователя "Поставщик ресурсов HPC Cache".

Вы можете сделать это заранее, или нажав на ссылку на странице, где вы добавляете цель хранения Blob. Имейте в виду, что для распространения параметров ролей в среде Azure может уйти до пяти минут, поэтому следует подождать несколько минут после добавления ролей перед созданием цели хранения.

Шаги для добавления ролей RBAC:

1. Откройте страницу **управления доступом (IAM)** для учетной записи хранилища. (Ссылка на **целевой** странице хранилища Add автоматически открывает эту страницу для выбранной учетной записи.)

1. Нажмите **+** в верхней части страницы и **выберите Добавить назначение роли.**

1. Выберите роль "Вкладчик учетной записи хранения" из списка.

1. В **присваивайте доступ к** поле, оставьте выбранное значение по умолчанию ("пользователь Azure AD, группа или основной сервис").  

1. В поле **Select** ищите "hpc".  Эта строка должна соответствовать принципу одной службы, названной "Поставщик ресурсов HPC Cache". Нажмите, что основной, чтобы выбрать его.

   > [!NOTE]
   > Если поиск "hpc" не работает, попробуйте использовать строку "storagecache" вместо этого. Пользователям, участвовавшим в предварительных просмотрах (до GA), возможно, потребуется использовать старое имя для основного обслуживания.

1. Нажмите кнопку **Сохранить** внизу.

1. Повторите этот процесс, чтобы назначить роль "Вкладчик данных хранения blob".  

![скриншот графического интерфейса назначения роли](media/hpc-cache-add-role.png)

## <a name="add-a-new-nfs-storage-target"></a>Добавление новой цели хранения NFS

Цель хранения NFS имеет больше полей, чем цель хранения Blob. В этих полях указывается, как достичь экспорта хранилища и как эффективно кэшировать свои данные. Кроме того, цель хранения NFS позволяет создавать несколько путей пространства имен, если у хосn NFS имеет более одного экспорта.

![Скриншот целевой страницы хранилища добавления с определенной целью NFS](media/add-nfs-target.png)

> [!NOTE]
> Прежде чем создать цель хранения NFS, убедитесь, что система хранения доступна из кэша Azure HPC и отвечает требованиям разрешения. Создание цели хранения не удастся, если кэш не сможет получить доступ к системе хранения. Прочитайте [требования к хранению NFS](hpc-cache-prereqs.md#nfs-storage-requirements) и [конфигурацию Troubleshoot NAS и целевые проблемы хранения NFS](troubleshoot-nas.md) для получения подробной информации.

Предоставьте эту информацию для целевого показателя хранения, поддерживаемого NFS:

* **Целевое имя хранилища** - Установить имя, которое идентифицирует эту цель хранения в кэше HPC Azure.

* **Тип цели** - Выберите **NFS**.

* **Hostname** - Введите IP-адрес или полностью квалифицированное доменное имя для вашей системы хранения NFS. (Использовать доменное имя только в том случае, если кэш имеет доступ к DNS-серверу, который может решить это имя.)

* **Модель использования** - Выберите один из профилей кэширования данных на основе рабочего процесса, описанного в [модели использования,](#choose-a-usage-model)ниже.

### <a name="nfs-namespace-paths"></a>Пути пространства имен NFS

Цель хранения NFS может иметь несколько виртуальных путей, если каждый путь представляет собой различный экспорт или субдиректорию в одной и той же системе хранения.

Создайте все пути из одной цели хранения.

Вы можете [добавлять и отсеивать пути пространства имен](hpc-cache-edit-storage.md) на цели хранения в любое время.

Заполните эти значения для каждого пути пространства имен:

* **Виртуальный путь пространства имен** - Установите путь файла, обращенного к клиенту, для этой цели хранения. Прочитайте [агрегированное пространство имен,](hpc-cache-namespace.md) чтобы узнать больше о виртуальной функции пространства имен.

<!--  The virtual path should start with a slash ``/``. -->

* **Путь экспорта NFS** - Введите путь к экспорту NFS.

* **Subdirectory путь** - Если вы хотите установить определенную субдиректорию экспорта, введите его здесь. Если нет, оставьте это поле пустым.

После завершения, нажмите **OK,** чтобы добавить цель хранения.

### <a name="choose-a-usage-model"></a>Выберите модель использования
<!-- referenced from GUI - update aka.ms link if you change this heading -->

При создании целевой системы хранения, уотягой на систему хранения NFS, необходимо выбрать модель использования для этой цели. Эта модель определяет, как кэшируется ваши данные.

Доступны три параметра:

* **Прочитайте тяжелые, редкие записи** - Используйте эту опцию, если вы хотите ускорить чтение доступа к файлам, которые статичны или редко меняются.

  Этот параметр кэширования файлов, которые клиенты читают, но проходит записывает через к бэк-энд хранения немедленно. Файлы, хранящиеся в кэше, никогда не сравниваются с файлами, намиваемыми в NFS.

  Не используйте эту опцию, если существует риск того, что файл может быть изменен непосредственно в системе хранения без предварительной записи в кэш. В этом случае кэшированная версия файла никогда не будет обновляться с изменениями из задней части, а набор данных может стать несовместимым.

* **Более 15% пишет** - Этот вариант ускоряет как читать и писать производительность. При использовании этой опции все клиенты должны получать доступ к файлам через кэш Azure HPC вместо непосредственного монтажа хранилища бэк-энда. Кэшированные файлы будут иметь последние изменения, которые не хранятся на задней части.

  В этой модели использования файлы в кэше не проверяются на файлы на бэк-энд-хранилище. Предполагается, что кэшированная версия файла является более актуальной. Измененный файл в кэше записываются в систему хранения бэк-энда после того, как он находился в кэше в течение часа без каких-либо дополнительных изменений.

* **Клиенты пишут в цель NFS, минуя кэш** - Выберите эту опцию, если клиенты в вашем рабочем процессе записывают данные непосредственно в систему хранения данных без предварительной записи в кэш. Файлы, которые запрашиваются клиентами, кэшируются, но любые изменения в этих файлах от клиента передаются обратно в систему хранения бэк-энда немедленно.

  С помощью этой модели использования файлы в кэше часто проверяются на наличие обновлений в бэк-энд-версиях. Эта проверка позволяет изменять файлы вне кэша при сохранении согласованности данных.

В этой таблице кратко излагаются различия в модели использования:

| Модель использования | Режим кэширования | Проверка бэк-энда | Максимальная задержка возврата записи |
| ---- | ---- | ---- | ---- |
| Читать тяжелые, редкие пишет | Чтение | Никогда | Отсутствуют |
| Более 15% пишет | Чтение/запись | Никогда | 1 час |
| Клиенты обходят кэш | Чтение | 30 секунд | Отсутствуют |

## <a name="next-steps"></a>Дальнейшие действия

После создания целей хранения рассмотрим одну из следующих задач:

* [Mount the Azure HPC Cache](hpc-cache-mount.md) (Подключение Azure HPC Cache)
* [Перемещение данных в хранилище Azure Blob](hpc-cache-ingest.md)

Если вам необходимо обновить какие-либо настройки, можно [отсватить таргетинг.](hpc-cache-edit-storage.md)
