---
title: Добавление хранилища в кэш HPC Azure
description: Определение целевых объектов хранилища, чтобы кэш Azure HPC мог использовать локальную систему NFS или контейнеры больших двоичных объектов Azure для долгосрочного хранения файлов.
author: ekpgh
ms.service: hpc-cache
ms.topic: conceptual
ms.date: 12/30/2019
ms.author: rohogue
ms.openlocfilehash: a68bf06bad995f71bedf6a5bdedcb676737a8c61
ms.sourcegitcommit: 4f6a7a2572723b0405a21fea0894d34f9d5b8e12
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/04/2020
ms.locfileid: "76990612"
---
# <a name="add-storage-targets"></a>Добавление целевых объектов хранилища

*Целевые объекты хранилища* — это серверное хранилище для файлов, доступ к которым осуществляется через экземпляр кэша Azure HPC. Вы можете добавить хранилище NFS (например, локальную аппаратную систему) или сохранить данные в большом двоичном объекте Azure.

Можно определить до десяти различных целевых объектов хранилища для одного кэша. Кэш представляет все целевые объекты хранилища в одном объединенном пространстве имен.

Помните, что экспорты хранилища должны быть доступны из виртуальной сети кэша. Для локального хранилища оборудования может потребоваться настроить DNS-сервер, который может разрешать имена узлов для доступа к хранилищу NFS. Дополнительные сведения см. в статье [доступ к DNS](hpc-cache-prereqs.md#dns-access).

Добавьте целевые объекты хранилища после создания кэша. Процедура немного отличается в зависимости от того, добавляется ли хранилище BLOB-объектов Azure или экспорт NFS. Сведения для каждого из них приведены ниже.

## <a name="open-the-storage-targets-page"></a>Открытие страницы "целевые объекты хранилища"

В портал Azure откройте экземпляр кэша и щелкните **целевые объекты хранилища** на левой боковой панели. На странице целевые объекты хранилища перечисляются все существующие целевые объекты и добавляется ссылка для добавления новой.

![снимок экрана: ссылка на целевые объекты хранилища на боковой панели под заголовком Настройка, между параметрами заголовков категорий и мониторингом](media/hpc-cache-storage-targets-sidebar.png)

## <a name="add-a-new-azure-blob-storage-target"></a>Добавление нового целевого объекта хранилища BLOB-объектов Azure

Для нового целевого объекта хранилища BLOB-объектов требуется пустой контейнер больших двоичных объектов или контейнер, заполненный данными в формате облачной файловой системы Azure HPC. Дополнительные сведения о предварительной загрузке контейнера больших двоичных объектов см. в статье [Перемещение данных в хранилище BLOB-объектов Azure](hpc-cache-ingest.md).

Вы можете создать новый контейнер на этой странице непосредственно перед его добавлением.

Чтобы определить контейнер больших двоичных объектов Azure, введите эти сведения.

![снимок экрана: страница "Добавление целевого объекта хранилища", заполненная данными для нового целевого объекта хранилища BLOB-объектов Azure](media/hpc-cache-add-blob.png)

* **Имя целевого объекта хранилища** — задайте имя, идентифицирующее этот целевой объект хранилища в кэше HPC Azure.
* **Тип целевого объекта** — выберите **BLOB-объект**.
* **Учетная запись хранения** . Выберите учетную запись, которую вы хотите использовать.

  Необходимо авторизовать экземпляр кэша для доступа к учетной записи хранения, как описано в разделе [Добавление ролей доступа](#add-the-access-control-roles-to-your-account).

  Сведения о типе учетной записи хранения, которую можно использовать, см. в статье [требования к хранилищу BLOB-объектов](hpc-cache-prereqs.md#blob-storage-requirements).

* **Контейнер хранилища** . Выберите контейнер больших двоичных объектов для этого целевого объекта или нажмите кнопку **создать**.

  ![снимок экрана диалогового окна для указания имени и уровня доступа (частный) для нового контейнера](media/add-blob-new-container.png)

* **Путь к виртуальному пространству имен** — задает путь к файлу для клиента для этого целевого объекта хранилища. Дополнительные сведения о функции виртуального пространства имен см. в статье [Настройка агрегированного пространства имен](hpc-cache-namespace.md) .

По завершении нажмите кнопку **ОК** , чтобы добавить целевой объект хранилища.

> [!NOTE]
> Если брандмауэр учетной записи хранения настроен для ограничения доступа только к выбранным сетям, используйте временное решение, описанное в статье обход [параметров брандмауэра для учетной записи хранения BLOB-объектов](hpc-cache-blob-firewall-fix.md).

### <a name="add-the-access-control-roles-to-your-account"></a>Добавление ролей контроля доступа в учетную запись

Кэш Azure HPC использует [Управление доступом на основе ролей (RBAC)](https://docs.microsoft.com/azure/role-based-access-control/index) для авторизации службы кэша на доступ к учетной записи хранения для целевых объектов хранилища BLOB-объектов Azure.

Владелец учетной записи хранения должен явно добавить роли [участника учетной записи хранения](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#storage-account-contributor) ролей и [участника данных большого двоичного объекта хранилища](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#storage-blob-data-contributor) для пользователя "поставщик ресурсов кэша HPC".

Это можно сделать заранее или щелкнув ссылку на странице, где вы добавите целевой объект хранилища BLOB-объектов. Помните, что для распространения параметров роли в среде Azure может потребоваться до пяти минут, поэтому необходимо подождать несколько минут после добавления ролей перед созданием целевого объекта хранилища.

Шаги для добавления ролей RBAC:

1. Откройте страницу **управления доступом (IAM)** для учетной записи хранения. (Ссылка на странице **Добавление целевого объекта хранилища** автоматически открывает эту страницу для выбранной учетной записи.)

1. Щелкните **+** в верхней части страницы и выберите **добавить назначение роли**.

1. Выберите роль "участник учетной записи хранения" из списка.

1. В поле **назначить доступ к** оставьте значение по умолчанию ("пользователь Azure AD, группа или субъект-служба").  

1. В поле **выбора** выполните поиск по запросу "HPC".  Эта строка должна соответствовать одному субъекту-службе с именем "поставщик ресурсов кэша HPC". Щелкните этот субъект, чтобы выбрать его.

   > [!NOTE]
   > Если Поиск "HPC" не работает, попробуйте использовать строку "сторажекаче". Пользователям, которые присоединились к предварительным версиям (до общедоступной версии), может потребоваться использовать старое имя субъекта-службы.

1. Нажмите кнопку **сохранить** внизу.

1. Повторите эту процедуру, чтобы назначить роль "участник данных BLOB-объекта хранилища".  

![снимок экрана: Добавление графического пользовательского интерфейса назначения ролей](media/hpc-cache-add-role.png)

## <a name="add-a-new-nfs-storage-target"></a>Добавление нового целевого объекта хранилища NFS

В целевом объекте хранилища NFS больше полей, чем у целевого объекта хранилища BLOB-объектов. Эти поля указывают, как достичь экспорта хранилища и как эффективно кэшировать данные. Кроме того, целевой объект хранилища NFS позволяет создать несколько путей к пространству имен, если на узле NFS доступно несколько экспортов.

![Снимок экрана: страница добавления целевого объекта хранилища с определенным целевым объектом NFS](media/hpc-cache-add-nfs-target.png)

Укажите эти сведения для целевого объекта хранилища с поддержкой NFS:

* **Имя целевого объекта хранилища** — задайте имя, идентифицирующее этот целевой объект хранилища в кэше HPC Azure.

* **Тип целевого объекта** — выберите **NFS**.

* **Имя узла** — введите IP-адрес или полное доменное имя для системы хранения NFS. (Используйте доменное имя, только если ваш кэш имеет доступ к DNS-серверу, который может разрешить это имя.)

* **Модель использования** — выберите один из профилей кэширования данных на основе рабочего процесса, описанный в разделе [Выбор модели использования](#choose-a-usage-model)ниже.

### <a name="nfs-namespace-paths"></a>Пути к пространству имен NFS

Целевой объект хранилища NFS может иметь несколько виртуальных путей, если каждый путь представляет отдельный экспорт или подкаталог в одной системе хранения.

Создайте все пути из одного целевого объекта хранилища.

Пути к [пространству имен](hpc-cache-edit-storage.md) в целевом хранилище можно добавлять и изменять в любое время.

Заполните эти значения для каждого пути к пространству имен:

* **Путь к виртуальному пространству имен** — задает путь к файлу для клиента для этого целевого объекта хранилища. Дополнительные сведения о функции виртуального пространства имен см. в статье [Настройка агрегированного пространства имен](hpc-cache-namespace.md) .

<!--  The virtual path should start with a slash ``/``. -->

* **Путь экспорта NFS** — введите путь к экспорту NFS.

* **Путь к подкаталогу** . Если вы хотите подключить конкретный подкаталог экспорта, введите его здесь. Если нет, оставьте это поле пустым.

По завершении нажмите кнопку **ОК** , чтобы добавить целевой объект хранилища.

### <a name="choose-a-usage-model"></a>Выбор модели использования
<!-- referenced from GUI - update aka.ms link if you change this heading -->

При создании целевого объекта хранилища, указывающего на систему хранения NFS, необходимо выбрать *модель использования* для этого целевого объекта. Эта модель определяет, как кэшируются данные.

Доступны три параметра:

* **Частое чтение, редкие операции записи** . Используйте этот параметр, если требуется ускорить доступ на чтение к файлам, которые являются статическими или редко изменяемыми.

  Этот параметр кэширует файлы, которые считываются клиентами, но немедленно передает записи в хранилище серверной части. Файлы, хранящиеся в кэше, никогда не сравниваются с файлами на томе хранилища NFS.

  Не используйте этот параметр, если существует риск, что файл может быть изменен непосредственно в системе хранения без предварительной записи в кэш. В этом случае кэшированная версия файла никогда не будет обновлена с учетом изменений из серверной части, а набор данных может стать несогласованным.

* Более **15% операций записи** . Этот параметр ускоряет скорость чтения и записи. При использовании этого параметра все клиенты должны получить доступ к файлам через кэш HPC Azure, а не подключать серверное хранилище напрямую. В кэшированных файлах будут внесены последние изменения, которые не хранятся в серверной части.

  В этой модели использования файлы в кэше не проверяются по файлам на внутреннем хранилище. Предполагается, что кэшированная версия файла является более актуальной. Измененный файл в кэше записывается только в систему хранения серверной части после того, как он найдет в кэше в течение часа без дополнительных изменений.

* **Клиенты записывают данные в целевой объект NFS, минуя кэш** . Выберите этот параметр, если какие-либо клиенты в рабочем процессе записывают данных непосредственно в систему хранения без предварительной записи в кэш. Файлы, запрашиваемые клиентами, кэшируются, но любые изменения этих файлов, передаваемые из клиента, немедленно передаются обратно в систему хранения в серверной части.

  В этой модели использования файлы в кэше часто проверяются относительно серверных версий для обновлений. Эта проверка позволяет изменять файлы вне кэша, сохраняя согласованность данных.

В этой таблице перечислены различия в модели использования.

| Модель использования | Режим кэширования | Проверка серверной части | Максимальная задержка записи на сервер |
| ---- | ---- | ---- | ---- |
| Частое чтение, редкие операции записи | Чтение | Никогда | Нет |
| Более 15% операций записи | Чтение/запись | Никогда | 1 ч |
| Клиенты обходят кэш | Чтение | 30 секунд | Нет |

## <a name="next-steps"></a>Дальнейшие действия

После создания целевых объектов хранилища рассмотрите одну из следующих задач.

* [Mount the Azure HPC Cache](hpc-cache-mount.md) (Подключение Azure HPC Cache)
* [Перемещение данных в хранилище BLOB-объектов Azure](hpc-cache-ingest.md)

Если необходимо обновить какие-либо параметры, можно [изменить целевой объект хранилища](hpc-cache-edit-storage.md).
