---
title: Восстановление до точки во времени для блочных BLOB-объектов (Предварительная версия)
titleSuffix: Azure Storage
description: Восстановление на момент времени для блочных BLOB-объектов обеспечивает защиту от случайного удаления или повреждения, позволяя восстановить предыдущее состояние учетной записи хранения в определенный момент времени.
services: storage
author: tamram
ms.service: storage
ms.topic: conceptual
ms.date: 06/10/2020
ms.author: tamram
ms.subservice: blobs
ms.custom: references_regions, devx-track-azurecli, devx-track-azurepowershell
ms.openlocfilehash: 2840e82508ee4f4046aec8f23c00a5c275bf5b67
ms.sourcegitcommit: 656c0c38cf550327a9ee10cc936029378bc7b5a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/28/2020
ms.locfileid: "89074463"
---
# <a name="point-in-time-restore-for-block-blobs-preview"></a>Восстановление до точки во времени для блочных BLOB-объектов (Предварительная версия)

Восстановление до точки во времени обеспечивает защиту от случайного удаления или повреждения, позволяя восстановить данные блочного BLOB-объекта в более раннее состояние. Восстановление до точки во времени полезно в сценариях, когда пользователь или приложение случайно удаляет данные или когда ошибка приложения приводит к повреждению данных. Восстановление до точки во времени позволяет выполнять сценарии тестирования, требующие возврата набора данных в известное состояние перед выполнением дальнейших тестов.

Сведения о том, как включить восстановление на момент времени для учетной записи хранения, см. в разделе [Включение и Управление восстановлением на момент времени для блочных BLOB-объектов (Предварительная версия)](point-in-time-restore-manage.md).

## <a name="how-point-in-time-restore-works"></a>Как работает восстановление до точки во времени

Чтобы включить восстановление на момент времени, создайте политику управления для учетной записи хранения и укажите срок хранения. В течение срока хранения можно восстановить блочные BLOB-объекты из текущего состояния в состояние, наступающее на предыдущую точку во времени.

Чтобы запустить восстановление на момент времени, вызовите операцию [восстановить диапазоны BLOB-объектов](/rest/api/storagerp/storageaccounts/restoreblobranges) и укажите точку восстановления в формате UTC. Можно указать лексикографическом диапазоны имен контейнера и BLOB-объектов для восстановления или опустить диапазон для восстановления всех контейнеров в учетной записи хранения. Для каждой операции восстановления поддерживается до 10 диапазонов лексикографическом.

Служба хранилища Azure анализирует все изменения, внесенные в указанные большие двоичные объекты между запрошенной точкой восстановления, заданными в формате UTC, и в настоящее время. Операция восстановления является атомарной, поэтому она либо полностью успешно восстанавливает все изменения, либо завершается сбоем. Если есть большие двоичные объекты, которые невозможно восстановить, операция завершается ошибкой, а операции чтения и записи затронутых контейнеров возобновляются.

Одновременно может выполняться только одна операция восстановления в учетной записи хранения. Операция восстановления не может быть отменена, когда она выполняется, но для отмены первой операции можно выполнить вторую операцию восстановления.

Операция **восстановления диапазонов BLOB-объектов** возвращает идентификатор восстановления, который однозначно идентифицирует операцию. Чтобы проверить состояние восстановления на момент времени, вызовите операцию **Получение состояния восстановления** с ИД восстановления, возвращенным из операции **восстановления диапазонов BLOB-объектов** .

Учитывайте следующие ограничения для операций восстановления.

- Блок, который был передан через [URL-адрес](/rest/api/storageservices/put-block-from-url), но не [зафиксирован через](/rest/api/storageservices/put-block) [List Block](/rest/api/storageservices/put-block-list), не является частью большого двоичного объекта и поэтому не восстанавливается в ходе операции восстановления.
- Невозможно восстановить большой двоичный объект с активной арендой. Если большой двоичный объект с активной арендой включен в диапазон больших двоичных объектов для восстановления, операция восстановления не будет выполнена атомарно.
- Моментальные снимки не создаются и не удаляются в ходе операции восстановления. В предыдущее состояние восстанавливается только базовый большой двоичный объект.
- Если большой двоичный объект перемещается между горячим и замечательным уровнем в период между текущим и точкой восстановления, большой двоичный объект восстанавливается до предыдущего уровня. Однако большой двоичный объект, перемещенный на архивный уровень, не будет восстановлен.

> [!IMPORTANT]
> При выполнении операции восстановления служба хранилища Azure блокирует операции с большими двоичными объектами в восстанавливаемых диапазонах на протяжении операции. Операции чтения, записи и удаления блокируются в основном расположении. По этой причине такие операции, как вывод контейнеров в портал Azure, могут выполняться не так, как ожидалось, во время операции восстановления.
>
> Операции чтения из дополнительного расположения могут продолжаться во время операции восстановления, если учетная запись хранения является геореплицированной.

> [!CAUTION]
> Восстановление до точки во времени поддерживает операции восстановления только для блочных BLOB-объектов. Операции с контейнерами не могут быть восстановлены. Если удалить контейнер из учетной записи хранения, вызвав операцию [удаления контейнера](/rest/api/storageservices/delete-container) во время предварительной версии восстановления на момент времени, этот контейнер нельзя будет восстановить с помощью операции восстановления. При предварительном просмотре вместо удаления контейнера Удалите отдельные большие двоичные объекты, если их потребуется восстановить.

### <a name="prerequisites-for-point-in-time-restore"></a>Предварительные требования для восстановления до точки во времени

Для восстановления до точки во времени необходимо, чтобы были включены следующие функции службы хранилища Azure:

- [Обратимое удаление](soft-delete-overview.md)
- [Веб-канал изменений (Предварительная версия)](storage-blob-change-feed.md)
- [Управление версиями BLOB-объектов (предварительная версия)](versioning-overview.md)

Включите эти функции для учетной записи хранения, прежде чем включать восстановление на момент времени. Прежде чем включать предварительные версии для канала изменений и управления версиями BLOB-объектов, обязательно зарегистрируйтесь.

### <a name="retention-period-for-point-in-time-restore"></a>Срок хранения для восстановления до точки во времени

При включении восстановления на определенный момент времени для учетной записи хранения указывается срок хранения. Блочные BLOB-объекты в учетной записи хранения можно восстановить в течение срока хранения.

Срок хранения начинается при включении восстановления на момент времени. Помните, что вы не можете восстановить большие двоичные объекты в состоянии до начала срока хранения. Например, если вы включили восстановление на момент времени в 1 мая с периодом удержания в 30 дней, то в течение 15 мая можно восстановить до максимального значения, равного большему сроку, установленному в течение не более 15 дней. 1 июня вы можете восстановить данные от 1 до 30 дней.

Срок хранения для восстановления до точки во времени должен быть не менее одного дня, чем срок хранения, указанный для обратимого удаления. Например, если срок хранения обратимого удаления равен 7 дням, срок хранения восстановления на определенный момент времени может составлять от 1 до 6 дней.

### <a name="permissions-for-point-in-time-restore"></a>Разрешения на восстановление до точки во времени

Чтобы инициировать операцию восстановления, клиент должен иметь разрешения на запись для всех контейнеров в учетной записи хранения. Чтобы предоставить разрешения на авторизацию операции восстановления с помощью Azure Active Directory (Azure AD), назначьте роль **участника учетной записи хранения** участнику безопасности на уровне учетной записи хранения, группы ресурсов или подписки.

## <a name="about-the-preview"></a>Сведения о предварительной версии

Восстановление до точки во времени поддерживается только для учетных записей хранения общего назначения версии 2. Восстановление данных на уровне "горячий" и "холодного" уровня доступа можно выполнить с помощью восстановления до точки во времени.

В следующих регионах поддерживается восстановление до точки во времени в предварительной версии:

- Центральная Канада
- Восточная Канада
- Центральная Франция

Предварительная версия включает следующие ограничения.

- Восстановление блочных BLOB-объектов уровня "Премиум" не поддерживается.
- Восстановление BLOB-объектов на архивном уровне не поддерживается. Например, если большой двоичный объект на горячем уровне хранилища был перемещен на архивный уровень два дня назад, а операция восстановления выполняет восстановление до точки три дня назад, большой двоичный объект не восстанавливается на горячий уровень.
- Восстановление Azure Data Lake Storage 2-го поколения плоских и иерархических пространств имен не поддерживается.
- Восстановление учетных записей хранения с помощью предоставленных клиентом ключей не поддерживается.

> [!IMPORTANT]
> Предварительная версия восстановления на момент времени предназначена только для использования в рабочей среде. Соглашения об уровне обслуживания (SLA) для рабочих сред сейчас недоступны.

### <a name="register-for-the-preview"></a>Зарегистрируйтесь для использования предварительной версии

Чтобы зарегистрироваться для просмотра предварительной версии, выполните следующие команды:

# <a name="powershell"></a>[PowerShell](#tab/powershell)

```powershell
# Register for the point-in-time restore preview
Register-AzProviderFeature -FeatureName RestoreBlobRanges -ProviderNamespace Microsoft.Storage

# Register for change feed (preview)
Register-AzProviderFeature -FeatureName Changefeed -ProviderNamespace Microsoft.Storage

# Register for blob versioning (preview)
Register-AzProviderFeature -FeatureName Versioning -ProviderNamespace Microsoft.Storage

# Refresh the Azure Storage provider namespace
Register-AzResourceProvider -ProviderNamespace Microsoft.Storage
```

# <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

```azurecli
az feature register --namespace Microsoft.Storage --name RestoreBlobRanges
az feature register --namespace Microsoft.Storage --name Changefeed
az feature register --namespace Microsoft.Storage --name Versioning
az provider register --namespace 'Microsoft.Storage'
```

---

### <a name="check-registration-status"></a>Проверка состояния регистрации

Регистрация для восстановления на момент времени выполняется автоматически и занимает менее 10 минут. Чтобы проверить состояние регистрации, выполните следующие команды:

# <a name="powershell"></a>[PowerShell](#tab/powershell)

```powershell
Get-AzProviderFeature -ProviderNamespace Microsoft.Storage `
    -FeatureName RestoreBlobRanges

Get-AzProviderFeature -ProviderNamespace Microsoft.Storage `
    -FeatureName Changefeed

Get-AzProviderFeature -ProviderNamespace Microsoft.Storage `
    -FeatureName Versioning
```

# <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

```azurecli
az feature list -o table --query "[?contains(name, 'Microsoft.Storage/RestoreBlobRanges')].{Name:name,State:properties.state}"
az feature list -o table --query "[?contains(name, 'Microsoft.Storage/Changefeed')].{Name:name,State:properties.state}"
az feature list -o table --query "[?contains(name, 'Microsoft.Storage/Versioning')].{Name:name,State:properties.state}"
```

---

## <a name="pricing-and-billing"></a>Цены и выставление счетов

Выставление счетов за восстановление до точки во времени зависит от объема данных, обработанных для выполнения операции восстановления. Объем обработанных данных зависит от количества изменений, произошедших между точкой восстановления и текущим моментом. Например, при относительно постоянной скорости изменения блокировки данных большого двоичного объекта в учетной записи хранения операция восстановления, которая возвращается в течение 1 дня, будет стоить 1/10-й день восстановления, который возвращается в течение 10 дней.

Чтобы оценить стоимость операции восстановления, проверьте журнал веб-канала изменений, чтобы оценить объем данных, измененных в течение периода восстановления. Например, если срок хранения для веб-канала изменений составляет 30 дней, а размер веб-канала изменений составляет 10 МБ, то восстановление до точки на 10 дней раньше будет стоить примерно в одну треть цены, указанной для учетной записи LRS в этом регионе. Восстановление до точки до 27 дней будет стоить примерно девять десятых долей указанной цены.

Дополнительные сведения о ценах на восстановление до точки во времени см. в разделе [цены на блочные BLOB](https://azure.microsoft.com/pricing/details/storage/blobs/)-объекты.

## <a name="ask-questions-or-provide-feedback"></a>Где можно задать вопрос или оставить отзыв?

Чтобы задать вопросы о предварительной версии восстановления на момент времени или оставить отзыв, обратитесь в корпорацию Майкрософт по адресу pitrdiscussion@microsoft.com .

## <a name="next-steps"></a>Дальнейшие действия

- [Включение и Управление восстановлением на момент времени для блочных BLOB-объектов (Предварительная версия)](point-in-time-restore-manage.md)
- [Поддержка канала изменений в хранилище BLOB-объектов Azure (предварительная версия)](storage-blob-change-feed.md)
- [Включение обратимого удаления для больших двоичных объектов](soft-delete-enable.md)
- [Включение управления версиями BLOB-объектов и работа с ним](versioning-enable.md)
