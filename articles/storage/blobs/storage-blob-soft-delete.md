---
title: Обратимое удаление больших двоичных объектов службы хранилища Azure | Документация Майкрософт
description: Служба хранилища Azure теперь предоставляет возможность обратимого удаления больших двоичных объектов. Это упрощает восстановление данных, если они ошибочно изменены или удалены приложением или другим пользователем учетной записи хранения.
services: storage
author: tamram
ms.service: storage
ms.topic: article
ms.date: 04/23/2019
ms.author: tamram
ms.subservice: blobs
ms.openlocfilehash: f1c6f8074dab19b18f695763b160e4aeffe3ac44
ms.sourcegitcommit: b7a44709a0f82974578126f25abee27399f0887f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/18/2019
ms.locfileid: "67204835"
---
# <a name="soft-delete-for-azure-storage-blobs"></a>Обратимое удаление больших двоичных объектов службы хранилища Azure
Служба хранилища Azure теперь предоставляет возможность обратимого удаления больших двоичных объектов. Это упрощает восстановление данных, если они ошибочно изменены или удалены приложением или другим пользователем учетной записи хранения.

## <a name="how-does-it-work"></a>Как это работает?
Если функция обратимого удаления включена, вы можете сохранить и восстановить данные в случае удаления больших двоичных объектов или их моментальных снимков. Такая защита распространяется на данные большого двоичного объекта, удаляемые в результате перезаписи.

При удалении данных они переходят в состояние обратимого удаления, а не стираются без возможности восстановления. Если обратимое удаление включено и вы перезаписываете данные, чтобы сохранить состояние перезаписанных данных, создается моментальный снимок данных обратимого удаления. Обратимо удаленные объекты невидимы, если их явно не перечислить. Можно настроить количество времени, в течение которого обратимо удаленные данные можно восстановить, прежде чем они будут окончательно удалены.

Обратимое удаление обратно совместимо, поэтому вносить какие-либо изменения в приложения, чтобы получить преимущества возможностей защиты, которые предлагает эта функция, не требуется. Тем не менее для [восстановления данных](#recovery) разработан новый API **отмены удаления большого двоичного объекта**.

### <a name="configuration-settings"></a>Параметры конфигурации
При создании новой учетной записи обратимое удаление отключено по умолчанию. Оно также отключено по умолчанию для имеющихся учетных записей хранения. В течение времени существования учетной записи хранения эту функцию можно включить и отключить в любой момент.

Вы по-прежнему сможете получать доступ к обратимо удаленным данным и восстанавливать их, если функция отключена, при условии, что эти данные были сохранены, когда функция была включена. При включении обратимого удаления необходимо также настроить период хранения.

Это количество времени, в течение которого обратимо удаленные данные хранятся и будут доступны для восстановления. Для больших двоичных объектов и их моментальных снимков, которые явно удалены, период хранения начинается с момента удаления данных. Для обратимо удаленных моментальных снимков, созданных функцией обратимого удаления при перезаписи данных, период начинается с момента создания моментального снимка. В настоящее время обратимо удаляемые данные можно хранить в течение периода от 1 до 365 дней.

Период хранения обратимо удаляемых данных можно изменить в любое время. Обновленный период хранения будет применяться только к новым удаляемым данным. Период хранения ранее удаленных данных будет истекать в соответствии с периодом, настроенным при удалении этих данных. Попытка удалить обратимо удаленный объект не повлияет на срок его действия.

### <a name="saving-deleted-data"></a>Сохранение удаленных данных
Функция обратимого удаления сохраняет данные во многих случаях, в которых большие двоичные объекты или их моментальные снимки удаляются или перезаписываются.

Когда большой двоичный объект перезаписывается с помощью операций **Put Blob** (Вставка большого двоичного объекта), **Put Block** (Вставка блокировки), **Put Block List** (Вставка списка блокировки) или **Copy Blob** (Копирование большого двоичного объекта), автоматически создается моментальный снимок состояния большого двоичного объекта до операции. Этот моментальный снимок является обратимо удаляемым. Он невидим, если только обратимо удаляемые объекты не перечислены явно. Чтобы узнать, как получить список обратимо удаляемых объектов, см. раздел [о восстановлении](#recovery).

![](media/storage-blob-soft-delete/storage-blob-soft-delete-overwrite.png)

*Обратимо удаленные данные — серые, а активные данные — синие. Недавно записанные данные размещены под более старыми данными. Когда B0 перезаписывается экземпляром B1, формируется обратимо удаляемый моментальный снимок B0. Когда B1 перезаписывается экземпляром B2, формируется обратимо удаляемый моментальный снимок B1.*

> [!NOTE]  
> Функция обратимого удаления предоставляет защиту от перезаписи для операций копирования, только если она включена в учетной записи большого двоичного объекта назначения.

> [!NOTE]  
> Обратимое удаление не предоставляет защиту от перезаписи для больших двоичных объектов на архивном уровне. Если большой двоичный объект на архивном уровне перезаписывается новым большим двоичным объектом на любом уровне, перезаписанный большой двоичный объект будет удален навсегда.

Если операция **Delete BLOB** (Удаление большого двоичного объекта) вызывается в моментальном снимке, он помечается как обратимо удаленный. Новый моментальный снимок не создается.

![](media/storage-blob-soft-delete/storage-blob-soft-delete-explicit-delete-snapshot.png)

*Обратимо удаленные данные — серые, а активные данные — синие. Недавно записанные данные размещены под более старыми данными. Если вызывается операция **Snapshot Blob** (Создание моментального снимка большого двоичного объекта), B0 становится моментальным снимком, а B1 — активным состоянием большого двоичного объекта. При удалении моментального снимка B0 он помечается как обратимо удаленный.*

Когда вызывается операция **Delete Blob** для основного большого двоичного объекта (который не является моментальным снимком), он помечается как обратимо удаленный. В соответствии с предыдущим поведением, вызов операции **Delete Blob** для большого двоичного объекта с активными моментальными снимками завершается с ошибкой. Если вызвать операцию **Delete Blob** для большого двоичного объекта с обратимо удаленными моментальными снимками, это не приведет к возникновению ошибки. Когда обратимое удаление включено, большой двоичный объект и его моментальные снимки можно по прежнему удалить одной операцией. При этом основной большой двоичный объект и моментальные снимки помечаются как обратимо удаленные.

![](media/storage-blob-soft-delete/storage-blob-soft-delete-explicit-include.png)

*Обратимо удаленные данные — серые, а активные данные — синие. Недавно записанные данные размещены под более старыми данными. Здесь вызов операции **Delete Blob** осуществляется, чтобы удалить В2 и все связанные моментальные снимки. Активный большой двоичный объект В2 и все связанные моментальные снимки помечаются как обратимо удаленные.*

> [!NOTE]  
> При перезаписи обратимо удаленного большого двоичного объекта автоматически создается обратимо удаленный моментальный снимок состояния большого двоичного объекта до операции записи. Новый большой двоичный объект наследует уровень перезаписанного большого двоичного объекта.

Функция обратимого удаления не сохраняет данные в случае удаления контейнера или учетной записи, а также когда метаданные и свойства большого двоичного объекта перезаписываются. Чтобы защитить учетную запись хранения от ошибочного удаления, можно настроить блокировку, используя Azure Resource Manager. Дополнительные сведения см. в статье [Блокировка ресурсов для предотвращения непредвиденных изменений](../../azure-resource-manager/resource-group-lock-resources.md), где рассматривается использование Azure Resource Manager.

В следующей таблице описано ожидаемое поведение, если обратимое удаление включено:

| Операция REST API | Тип ресурса | Описание | Изменение в поведении |
|--------------------|---------------|-------------|--------------------|
| [Удаление](/rest/api/storagerp/StorageAccounts/Delete) | Учетная запись. | Удаляет учетную запись хранения, а также все содержащиеся в ней контейнеры и большие двоичные объекты.                           | Без изменения. Контейнеры и большие двоичные объекты в удаленной учетной записи невозможно восстановить. |
| [Delete Container](/rest/api/storageservices/delete-container) | Контейнер | Удаляет контейнер вместе со всеми большими двоичными объектами, которые в нем содержатся. | Без изменения. Большие двоичные объекты в удаленном контейнере невозможно восстановить. |
| [вставка большого двоичного объекта](/rest/api/storageservices/put-blob); | Блочные, добавочные и страничные BLOB-объекты | Создает новый большой двоичный объект или заменяет имеющийся большой двоичный объект в контейнере. | Если используется для замены имеющегося большого двоичного объекта, автоматически создается моментальный снимок состояния большого двоичного объекта до вызова. Это также применимо к удаленным ранее большим двоичным объектам, только если они заменяются большими двоичными объектами того же типа (блочные, добавочные или страничные). Если они заменяются большими двоичными объектами другого типа, все имеющиеся обратимо удаленные данные будет невозможно восстановить. |
| [Delete Blob](/rest/api/storageservices/delete-blob) | Блочные, добавочные и страничные BLOB-объекты | Отмечает для удаления большой двоичный объект или моментальный снимок большого двоичного объекта. Большой двоичный объект или моментальный снимок удаляется позднее при сборке мусора. | Если используется для удаления моментального снимка, он помечается как обратимо удаленный. Если используется для удаления большого двоичного объекта, он помечается как обратимо удаленный. |
| [Copy Blob](/rest/api/storageservices/copy-blob) | Блочные, добавочные и страничные BLOB-объекты | Копирует исходный большой двоичный объект в большой двоичный объект назначения в той же или в другой учетной записи хранения. | Если используется для замены имеющегося большого двоичного объекта, автоматически создается моментальный снимок состояния большого двоичного объекта до вызова. Это также применимо к удаленным ранее большим двоичным объектам, только если они заменяются большими двоичными объектами того же типа (блочные, добавочные или страничные). Если они заменяются большими двоичными объектами другого типа, все имеющиеся обратимо удаленные данные будет невозможно восстановить. |
| [Put Block](/rest/api/storageservices/put-block) | Блочные BLOB-объекты | Создает новую блокировку, которая фиксируется как часть блочного BLOB-объекта. | Если используется для фиксирования блокировки в активном большом двоичном объекте, изменений не происходит. Если используется для блокировки в обратимо удаленном большом двоичном объекте, создается большой двоичный объект и автоматически создается моментальный снимок для записи состояния обратимо удаленного большого двоичного объекта. |
| [вставка списка блокировки](/rest/api/storageservices/put-block-list); | Блочные BLOB-объекты | Фиксирует большой двоичный объект путем указания набора идентификаторов блокировок, представляющих блочный BLOB-объект. | Если используется для замены имеющегося большого двоичного объекта, автоматически создается моментальный снимок состояния большого двоичного объекта до вызова. Это также применимо к ранее обратимо удаленным большим двоичным объектам только в том случае, если это блочный BLOB-объект. Если они заменяются большими двоичными объектами другого типа, все имеющиеся обратимо удаленные данные будет невозможно восстановить. |
| [Put Page](/rest/api/storageservices/put-page) | Страничные BLOB-объекты | Записывает диапазон страниц в страничный BLOB-объект. | Без изменения. Данные страничного BLOB-объекта, перезаписанные или очищенные с помощью этой операции, не сохраняются и не восстанавливаются. |
| [Append Block](/rest/api/storageservices/append-block) | Добавочные BLOB-объекты | Записывает блок данных в конец добавочного BLOB-объекта. | Без изменения. |
| [задание свойств службы BLOB-объекта](/rest/api/storageservices/set-blob-properties). | Блочные, добавочные и страничные BLOB-объекты | Задает значения для свойств системы, определенных для большого двоичного объекта. | Без изменения. Перезаписанные свойства большого двоичного объекта невозможно восстановить. |
| [Set Blob Metadata](/rest/api/storageservices/set-blob-metadata) | Блочные, добавочные и страничные BLOB-объекты | Задает определяемые пользователем метаданные для определенного большого двоичного объекта в виде одной или нескольких пар "имя — значение". | Без изменения. Метаданные перезаписанного большого двоичного объекта не могут быть восстановлены. |

Важно заметить, что при вызове операции "Put Page" для перезаписи или очищения диапазонов страничного BLOB-объекта моментальные снимки не создаются автоматически. Данные на дисках виртуальной машины хранятся в страничных BLOB-объектах, а для записи данных на диск используется операция **Put Page**.

### <a name="recovery"></a>Восстановление
Чтобы упростить восстановление удаленных данных, был представлен новый API "Undelete Blob" (Отмена удаления большого двоичного объекта). Если вызвать API отмены удаления для обратимо удаленного большого двоичного объекта, он и все связанные обратимо удаленные моментальные снимки восстанавливаются как активные. Если вызвать API отмены удаления для активного большого двоичного объекта, все связанные обратимо удаленные моментальные снимки восстанавливаются как активные. Когда моментальные снимки восстановлены как активные, они выглядят как созданные пользователем моментальные снимки. Они не перезаписывают основной большой двоичный объект.

Чтобы восстановить большой двоичный объект до определенного обратимо удаляемого моментального снимка можно вызвать операцию **отмены удаления** для основного большого двоичного объекта. Затем вы можете скопировать моментальный снимок в активный большой двоичный объект. Его также можно скопировать в новый большой двоичный объект.

![](media/storage-blob-soft-delete/storage-blob-soft-delete-recover.png)

*Обратимо удаленные данные — серые, а активные данные — синие. Недавно записанные данные размещены под более старыми данными. Здесь операция **Undelete Blob** вызывается в большом двоичном объекте В, благодаря чему основной большой двоичный объект В1 и все связанные моментальные снимки (здесь это только В0) восстанавливаются как активные. На втором шаге В0 копируется в основной большой двоичный объект. Эта операция копирования создает обратимо удаленный моментальный снимок В1.*

Чтобы просмотреть обратимо удаленные большие двоичные объекты и моментальные снимки, можно включить удаленные данные в результаты операции **List Blobs** (Вывод списка больших двоичных объектов). Можно просматривать только обратимо удаленные основные большие двоичные объекты или также включить обратимо удаленные моментальные снимки. Для всех обратимо удаленных данных можно просмотреть время, когда были удалены данные, а также число дней, оставшихся до окончательного удаления данных.

### <a name="example"></a>Пример
Ниже приведены выходные данные скрипта .NET, который отправляет, перезаписывает большой двоичный объект, создает его моментальные снимки, а также удаляет и восстанавливает большой двоичный объект под названием HelloWorld, если включено обратимое удаление:

```bash
Upload:
- HelloWorld (is soft deleted: False, is snapshot: False)

Overwrite:
- HelloWorld (is soft deleted: True, is snapshot: True)
- HelloWorld (is soft deleted: False, is snapshot: False)

Snapshot:
- HelloWorld (is soft deleted: True, is snapshot: True)
- HelloWorld (is soft deleted: False, is snapshot: True)
- HelloWorld (is soft deleted: False, is snapshot: False)

Delete (including snapshots):
- HelloWorld (is soft deleted: True, is snapshot: True)
- HelloWorld (is soft deleted: True, is snapshot: True)
- HelloWorld (is soft deleted: True, is snapshot: False)

Undelete:
- HelloWorld (is soft deleted: False, is snapshot: True)
- HelloWorld (is soft deleted: False, is snapshot: True)
- HelloWorld (is soft deleted: False, is snapshot: False)

Copy a snapshot over the base blob:
- HelloWorld (is soft deleted: False, is snapshot: True)
- HelloWorld (is soft deleted: False, is snapshot: True)
- HelloWorld (is soft deleted: True, is snapshot: True)
- HelloWorld (is soft deleted: False, is snapshot: False)
```

Чтобы получить сведения о приложении, которое создало эти выходные данные, см. раздел [Следующие шаги](#next-steps).

## <a name="pricing-and-billing"></a>Цены и выставление счетов
Все обратимо удаленные данные оплачиваются по той же ставке, что и активные данные. Плата не взимается за данные, которые были окончательно удалены по окончании заданного периода хранения. Чтобы подробнее изучить моментальные снимки и узнать подробности начисления платы, ознакомьтесь со статьей [Создание моментального снимка BLOB-объекта](storage-blob-snapshots.md).

За транзакции, связанные с автоматическим созданием моментальных снимков, счет не выставляется. Вам будет выставлен счет за транзакции **отмены удаления большого двоичного объекта** по тарифу "Операции записи".

Дополнительные сведения о ценах на хранилище BLOB-объектов Azure см. на [странице цен](https://azure.microsoft.com/pricing/details/storage/blobs/).

При первоначальном включении обратимого удаления рекомендуется использовать небольшой период хранения, чтобы лучше понять, как использование этой функции отразится на счете.

## <a name="quickstart"></a>Краткое руководство
### <a name="azure-portal"></a>Портал Azure
Чтобы включить обратимое удаление, в разделе **Служба BLOB-объектов** выберите пункт **Обратимое удаление**. Затем щелкните **Включено** и введите количество дней, в течение которых необходимо хранить обратимо удаленные данные.

![](media/storage-blob-soft-delete/storage-blob-soft-delete-portal-configuration.png)

Чтобы просмотреть обратимо удаленные большие двоичные объекты, установите флажок **Show deleted blobs** (Показать удаленные большие двоичные объекты).

![](media/storage-blob-soft-delete/storage-blob-soft-delete-portal-view-soft-deleted.png)

Чтобы просмотреть обратимо удаленные моментальные снимки для данного большого двоичного объекта, выберите большой двоичный объект, а затем щелкните **Просмотреть моментальные снимки**.

![](media/storage-blob-soft-delete/storage-blob-soft-delete-portal-view-soft-deleted-snapshots.png)

Установите флажок **Показать удаленные моментальные снимки**.

![](media/storage-blob-soft-delete/storage-blob-soft-delete-portal-view-soft-deleted-snapshots-check.png)

Щелкнув обратимо удаленный большой двоичный объект или моментальный снимок, обратите внимание на новые свойства большого двоичного объекта. Они указывают, когда объект был удален и количество дней, оставшихся до полного удаления большого двоичного объекта или моментального снимка. Если обратимо удаленный объект не является моментальным снимком, его удаление можно отменить.

![](media/storage-blob-soft-delete/storage-blob-soft-delete-portal-properties.png)

Помните, что отмена удаления большого двоичного объекта также отменит удаление всех связанных с ним моментальных снимков. Чтобы обратимо удалить моментальные снимки активного большого двоичного объекта, щелкните его и выберите **Undelete all snapshots** (Отменить удаление всех моментальных снимков).

![](media/storage-blob-soft-delete/storage-blob-soft-delete-portal-undelete-all-snapshots.png)

После отмены удаления моментальных снимков большого двоичного объекта можно щелкнуть **Повысить уровень**, чтобы скопировать моментальный снимок в корневой большой двоичный объект, тем самым восстановив большой двоичный объект в моментальный снимок.

![](media/storage-blob-soft-delete/storage-blob-soft-delete-portal-promote-snapshot.png)

### <a name="powershell"></a>PowerShell

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]

Чтобы включить обратимое удаление, обновите свойства клиентской службы BLOB-объектов. В следующем примере включено обратимое удаление подмножества учетных записей в подписке:

```powershell
Set-AzContext -Subscription "<subscription-name>"
$MatchingAccounts = Get-AzStorageAccount | where-object{$_.StorageAccountName -match "<matching-regex>"}
$MatchingAccounts | Enable-AzStorageDeleteRetentionPolicy -RetentionDays 7
```
Убедиться, что обратимое удаление включено, можно с помощью следующей команды:

```powershell
$MatchingAccounts | Get-AzStorageServiceProperty -ServiceType Blob
```

Чтобы восстановить большие двоичные объекты, которые были случайно удалены, вызовите для них отмену удаления. Помните, что при вызове операции **Undelete Blob** как в активных, так и в обратимо удаленных больших двоичных объектах все связанные обратимо удаленные моментальные снимки будут восстановлены в качестве активных. В следующем примере вызывается отмена удаления всех обратимо удаленных и активных больших двоичных объектов в контейнере:
```powershell
# Create a context by specifying storage account name and key
$ctx = New-AzStorageContext -StorageAccountName $StorageAccountName -StorageAccountKey $StorageAccountKey

# Get the blobs in a given container and show their properties
$Blobs = Get-AzStorageBlob -Container $StorageContainerName -Context $ctx -IncludeDeleted
$Blobs.ICloudBlob.Properties

# Undelete the blobs
$Blobs.ICloudBlob.Undelete()
```
Чтобы найти текущую политику хранения обратимого удаления, используйте следующую команду:

```azurepowershell-interactive
   $account = Get-AzStorageAccount -ResourceGroupName myresourcegroup -Name storageaccount
   Get-AzStorageServiceProperty -ServiceType Blob -Context $account.Context
```

### <a name="azure-cli"></a>Инфраструктура CLI Azure 
Чтобы включить обратимое удаление, обновите свойства клиентской службы BLOB-объектов:

```azurecli-interactive
az storage blob service-properties delete-policy update --days-retained 7  --account-name mystorageaccount --enable true
```

Чтобы проверить, включена ли возможность удаления, используйте следующую команду: 

```azurecli-interactive
az storage blob service-properties delete-policy show --account-name mystorageaccount 
```

### <a name="python-client-library"></a>Клиентская библиотека Python
Чтобы включить обратимое удаление, обновите свойства клиентской службы BLOB-объектов:

```python
# Make the requisite imports
from azure.storage.blob import BlockBlobService
from azure.storage.common.models import DeleteRetentionPolicy

# Initialize a block blob service
block_blob_service = BlockBlobService(account_name='<enter your storage account name>', account_key='<enter your storage account key>')

# Set the blob client's service property settings to enable soft delete
block_blob_service.set_blob_service_properties(delete_retention_policy = DeleteRetentionPolicy(enabled = True, days = 7))
```

### <a name="net-client-library"></a>Клиентская библиотека .NET
Чтобы включить обратимое удаление, обновите свойства клиентской службы BLOB-объектов:

```csharp
// Get the blob client's service property settings
ServiceProperties serviceProperties = blobClient.GetServiceProperties();

// Configure soft delete
serviceProperties.DeleteRetentionPolicy.Enabled = true;
serviceProperties.DeleteRetentionPolicy.RetentionDays = RetentionDays;

// Set the blob client's service property settings
blobClient.SetServiceProperties(serviceProperties);
```

Чтобы восстановить большие двоичные объекты, которые были случайно удалены, вызовите для них отмену удаления. Помните, что при вызове операции **Undelete Blob** как в активных, так и в обратимо удаленных больших двоичных объектах все связанные обратимо удаленные моментальные снимки будут восстановлены в качестве активных. В следующем примере вызывается отмена удаления всех обратимо удаленных и активных больших двоичных объектов в контейнере:

```csharp
// Recover all blobs in a container
foreach (CloudBlob blob in container.ListBlobs(useFlatBlobListing: true, blobListingDetails: BlobListingDetails.Deleted))
{
       await blob.UndeleteAsync();
}
```

Чтобы выполнить восстановление до определенной версии большого двоичного объекта, сначала необходимо вызвать отмену удаления большого двоичного объекта, а затем скопировать требуемый моментальный снимок в большой двоичный объект. В следующем примере блочный BLOB-объект восстанавливается до недавно созданного моментального снимка:

```csharp
// Undelete
await blockBlob.UndeleteAsync();

// List all blobs and snapshots in the container prefixed by the blob name
IEnumerable<IListBlobItem> allBlobVersions = container.ListBlobs(
    prefix: blockBlob.Name, useFlatBlobListing: true, blobListingDetails: BlobListingDetails.Snapshots);

// Restore the most recently generated snapshot to the active blob    
CloudBlockBlob copySource = allBlobVersions.First(version => ((CloudBlockBlob)version).IsSnapshot &&
    ((CloudBlockBlob)version).Name == blockBlob.Name) as CloudBlockBlob;
blockBlob.StartCopy(copySource);
```

## <a name="are-there-any-special-considerations-for-using-soft-delete"></a>Существуют ли какие-либо особенности использования обратимого удаления?
Если есть вероятность, что данные могут быть случайно изменены или удалены приложением или другим пользователем учетной записи хранения, мы рекомендуем включить обратимое удаление. Включение обратимого удаления для часто перезаписанных данных может привести расходов емкости увеличению размера хранилища и увеличение задержки при перечислении больших двоичных объектов. Этого можно избежать, сохраняя часто перезаписанных данных в отдельную учетную запись хранения с обратимое удаление отключено. 

## <a name="faq"></a>Часто задаваемые вопросы
**Для каких типов хранилищ можно использовать обратимое удаление?**  
В настоящее время обратимое удаление доступно только для хранилища BLOB-объектов.

**Доступно ли обратимое удаление для всех типов учетных записей хранения?**  
Да, обратимое удаление доступно для учетных записей больших двоичных объектов, а также для больших двоичных объектов в учетных записях хранения общего назначения (GPv1 и GPv2). Это применимо к учетным записям уровня "Стандарт" и "Премиум". Обратимое удаление недоступно для управляемых дисков.

**Доступно ли обратимое удаление для всех уровней хранилища?**  
Да, обратимое удаление доступно для всех уровней хранилища, включая горячий, холодный и архивный. Однако обратимое удаление не предоставляет защиту от перезаписи для больших двоичных объектов на архивном уровне.

**Можно ли использовать параметр настройки API уровня больших двоичных объектов для многоуровневых больших двоичных объектов с использованием обратимо удаленных моментальных снимков?**  
Да. Обратимо удаленные моментальные снимки останутся на исходном уровне, но базовый BLOB-объект будет перемещен на новый уровень. 

**Учетная запись хранения уровня "Премиум" имеет ограничение на количество моментальных снимков большого двоичного объекта — 100. Учитываются ли в этом ограничении обратимо удаленные моментальные снимки?**  
Нет, обратимо удаленные моментальные снимки не учитываются в этом ограничении.

**Можно ли включить обратимое удаление в имеющихся учетных записях хранения?**  
Да, обратимое удаление можно настроить и для имеющихся, и для новых учетных записей хранения.

**Если удалить всю учетную запись или контейнер с включенным обратимым удалением, будут ли сохранены все связанные большие двоичные объекты?**  
Нет, если удалена вся учетная запись или контейнер, все связанные большие двоичные объекты будут удалены без возможности восстановления. Чтобы узнать, как защитить учетную запись хранения от случайного удаления, ознакомьтесь со статьей [Блокировка ресурсов для предотвращения непредвиденных изменений](../../azure-resource-manager/resource-group-lock-resources.md), где рассматривается использование Azure Resource Manager.

**Можно ли просмотреть метрики емкости для удаленных данных?**  
Обратимо удаленные данные включены как часть общей емкости учетной записи хранения. Дополнительные сведения об отслеживании и мониторинге емкости хранилища см. в статье [Аналитики хранилища](../common/storage-analytics.md).

**Если отключить обратимое удаление, смогу ли я получить доступ к обратимо удаленным данным?**  
Да, вы по-прежнему сможете получать доступ к обратимо удаленным данным, чей период хранения не истек, и восстанавливать их.

**Можно ли читать и копировать обратимо удаленные моментальные снимки моего большого двоичного объекта?**  
Да, но сначала необходимо вызвать отмену удаления большого двоичного объекта.

**Доступно ли обратимое удаление для всех типов больших двоичных объектов?**  
Да, обратимое удаление доступно для блочных, добавочных и страничных BLOB-объектов.

**Доступно ли обратимое удаление для дисков виртуальных машин?**  
Обратимое удаление доступно для неуправляемых дисков класса Standard и Premium. Обратимое удаление позволяет восстановить данные, удаленные только с помощью операций **Delete Blob**, **Put BLOB**, **Put Block List**, **Put Block** и **Copy Blob**. Данные, перезаписанные с помощью вызова операции **Put Page**, невозможно восстановить.

**Нужно ли изменять свои существующие приложения, чтобы использовать обратимое удаление?**  
Воспользоваться преимуществами обратимого удаления можно вне зависимости от используемой версии API. Однако, чтобы перечислить и восстановить обратимо удаленные большие двоичные объекты и моментальные снимки, необходимо использовать версию 2017-07-29 [REST API служб хранилища](https://docs.microsoft.com/rest/api/storageservices/Versioning-for-the-Azure-Storage-Services) или более позднюю. В целом рекомендуется всегда использовать последнюю версию, независимо от того, используете ли вы эту функцию.

## <a name="next-steps"></a>Дальнейшие действия
* [Пример кода .NET](https://github.com/Azure-Samples/storage-dotnet-blob-soft-delete)
* [Blob Service REST API](/rest/api/storageservices/blob-service-rest-api) (API-интерфейс REST службы BLOB-объектов)
* [Репликация хранилища Azure](../common/storage-redundancy.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json)
* [Проектирование высокодоступных приложений с использованием RA-GRS](../common/storage-designing-ha-apps-with-ragrs.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json)
* [Disaster recovery and storage account failover (preview) in Azure Storage](../common/storage-disaster-recovery-guidance.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json) (Аварийное восстановление и отработка отказа учетной записи хранения (предварительная версия) в службе хранилища Azure)
