---
title: Настройка имени личного домена для учетной записи хранения Azure | Документация Майкрософт
description: С помощью портала Azure сопоставьте собственное каноническое имя (CNAME) с хранилищем BLOB-объектов или конечной веб-точкой в учетной записи хранения Azure.
services: storage
author: normesta
ms.service: storage
ms.topic: article
ms.date: 06/26/2018
ms.author: normesta
ms.reviewer: seguler
ms.subservice: blobs
ms.openlocfilehash: 4f6776a5f15cf391f3a65aceb6e9e783d87a2078
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "65148929"
---
# <a name="configure-a-custom-domain-name-for-your-azure-storage-account"></a>Настройка имени личного домена для учетной записи хранения Azure

Можно настроить пользовательский домен для доступа к BLOB-данным в учетной записи хранения Azure. Конечной точкой по умолчанию для хранилища BLOB-объектов является *\<storage-account-name>.blob.core.windows.net*. Можно также использовать сетевой конечной точке, который создается в составе [статических веб-сайтов функция](storage-blob-static-website.md). Если после сопоставления личного домена и поддомена, например *www\.contoso.com*, к конечной точке BLOB-объектов или веб-для вашей учетной записи хранения, пользователи могут использовать этот домен для доступа к данным BLOB-объектов в учетной записи хранения.

> [!IMPORTANT]
> Служба хранилища Azure пока не поддерживает протокол HTTPS для личных доменов. Тем временем вы можете [использовать Azure CDN для доступа к BLOB-объектам с помощью личных доменов по протоколу HTTPS](storage-https-custom-domain-cdn.md).
> 
> 
> [!NOTE]
> В настоящий момент в учетной записи хранения может быть только одно имя личного домена. Имя личного домена нельзя одновременно сопоставить с конечной точкой службы BLOB-объектов и веб-службы.
> 
> [!NOTE]
> Сопоставление работают только для поддоменов (например, www\.contoso.com). Если требуется, чтобы вашей конечной точки web в корневом домене (например, contoso.com), то вам придется [с помощью Azure CDN с помощью личных доменов](storage-https-custom-domain-cdn.md)

В следующей таблице приведено несколько примеров URL-адресов для данных больших двоичных объектов, расположенных в учетной записи хранения с именем *mystorageaccount*. Поддомен, который регистрируется для учетной записи хранения — *www\.contoso.com*:

| Тип ресурса | URL-адрес по умолчанию | URL-адрес личного домена |
| --- | --- | --- |
| Учетная запись хранения | http://mystorageaccount.blob.core.windows.net | http://www.contoso.com |
| BLOB-объект |http://mystorageaccount.blob.core.windows.net/mycontainer/myblob | http://www.contoso.com/mycontainer/myblob |
| Корневой контейнер | http://mystorageaccount.blob.core.windows.net/myblob или http://mystorageaccount.blob.core.windows.net/ $root/myblob| http://www.contoso.com/myblob или http://www.contoso.com/ $root/myblob |
| Интернет |  http://mystorageaccount.[zone].web.core.windows.net/$web/[indexdoc] или http://mystorageaccount.[zone].web.core.windows.net/[indexdoc] или http://mystorageaccount.[zone].web.core.windows.net/$web или http://mystorageaccount.[zone].web.core.windows.net/ | http://www.contoso.com/ $web или http://www.contoso.com/ или http://www.contoso.com/ $web/[indexdoc] или http://www.contoso.com/ [indexdoc] |

> [!NOTE]  
> Как показано в следующих разделах, все примеры для конечной точки службы BLOB-объектов распространяются и на конечную точку веб-службы.

## <a name="direct-vs-intermediary-cname-mapping"></a>Прямое и промежуточное сопоставление CNAME

Можно указать пользовательский домен с префиксом с поддомена (например, www\.contoso.com) к конечной точке BLOB-объектов для вашей учетной записи хранения, одним из двух способов: 
* прямое сопоставление CNAME;
* с помощью промежуточного поддомена *asverify*.

### <a name="direct-cname-mapping"></a>Прямое сопоставление CNAME

Первым и самым простым методом является создание записи канонического имени (CNAME), сопоставляющей личный домен и поддомен непосредственно с конечной точкой больших двоичных объектов. Запись CNAME — это компонент службы доменных имен (DNS), позволяющий сопоставить исходный и конечный домены. В нашем примере исходный домен является собственный домен и поддомен (*www\.contoso.com*, например). Конечный домен является конечной точкой службы BLOB-объектов (например, *mystorageaccount.blob.core.windows.net*).

Прямой метод рассматривается в разделе "Регистрация личного домена".

### <a name="intermediary-mapping-with-asverify"></a>Промежуточное сопоставление с помощью *asverify*

Во втором методе также применяются записи CNAME. Тем не менее сначала используется специальный поддомен *asverify*, распознаваемый Azure, который позволяет избежать простоя.

Сопоставление личного домена с конечной точкой BLOB-объекта приводит к краткому периоду простоя во время регистрации домена на [портале Azure](https://portal.azure.com). Если домен в это время поддерживает приложение с Соглашением об уровне обслуживания (SLA), не допускающим простоя, то в качестве промежуточного этапа регистрации можно использовать поддомен Azure *asverify*. Этот шаг обеспечивает доступ пользователей к вашему домену во время сопоставления DNS.

Промежуточный метод рассматривается в разделе "Регистрация личного домена с помощью поддомена *asverify*".

## <a name="register-a-custom-domain"></a>Регистрация личного домена
Зарегистрируйте домен с помощью процедуры, описанной в этом разделе, если применяются следующие инструкции:
* вы допускаете кратковременную недоступность домена для пользователей;
* на личном домене в данный момент не размещены приложения. 

Службу Azure DNS можно использовать для настройки пользовательского DNS-имени для вашего хранилища BLOB-объектов Azure. Дополнительные сведения см. в статье [Использование Azure DNS для указания параметров личного домена для службы Azure](https://docs.microsoft.com/azure/dns/dns-custom-domain#blob-storage).

Если личный домен поддерживает приложение, не допускающее простоя, то следует использовать процедуру, описанную в разделе "Регистрация личного домена с помощью поддомена *asverify*".

Чтобы настроить имя личного домена, создайте запись CNAME в DNS. Запись CNAME определяет псевдоним для имени домена. В этом примере она сопоставляет адрес личного домена с конечной точкой хранилища BLOB-объектов для учетной записи хранения.

Как правило, параметрами DNS домена можно управлять на веб-сайте регистратора домена. Каждый регистратор имеет похожий, но немного отличный способ указания записи CNAME, хотя используется одна и та же концепция. Некоторые базовые пакеты регистрации домена не предлагают настройки DNS, поэтому может потребоваться обновить пакет регистрации домена, прежде чем создавать запись CNAME.

1. Войдите в свою учетную запись хранения на [портале Azure](https://portal.azure.com).

1. В области меню в разделе **Служба BLOB-объектов** выберите **Личный домен**.  
   Откроется область **Личный домен**.

1. Войдите на веб-сайт своего регистратора и перейдите на страницу управления DNS.  
   Эту страницу можно найти в разделе **Доменное имя**, **DNS** или **Name Server Management** (Управление сервером доменных имен).

1. Найдите раздел управления записями CNAME.  
   Возможно, потребуется перейти на страницу дополнительных параметров и найти пункты **CNAME**, **Псевдоним** или **Поддомены**.

1. Создать новую запись CNAME, введите псевдоним поддомена, например **www** или **фотографии** (поддомен является обязательным, корневые домены не поддерживаются), а затем укажите имя узла.  
   Именем узла является конечная точка службы BLOB-объектов. Его формат — *\<mystorageaccount>.blob.core.windows.net* (где *mystorageaccount* — имя учетной записи хранения). Имя узла отображается в первом элементе области **Личный домен** на [портале Azure](https://portal.azure.com). 

1. В области **Личный домен** в текстовом поле введите имя личного домена, включая поддомен.  
   Например, если используется домен *contoso.com* и ваш псевдоним поддомена — *www*, введите **www\.contoso.com**. Если используется поддомен *photos*, введите **photos.contoso.com**.

1. Чтобы зарегистрировать личный домен, выберите **Сохранить**.  
   Если регистрация прошла успешно, появится уведомление портала о том, что учетная запись хранения успешно обновлена.

Как только новая запись CNAME распространится через DNS, пользователи смогут просматривать данные больших двоичных объектов с помощью личного домена при наличии соответствующих разрешений.

## <a name="register-a-custom-domain-by-using-the-asverify-subdomain"></a>Регистрация личного домена с помощью поддомена *asverify*
Зарегистрируйте личный домен с помощью процедуры, описанной в этом разделе, если он в данное время поддерживает приложения с соглашением об уровне обслуживания, запрещающим простои. Создавая запись CNAME, указывающую из *asverify.\<subdomain>.\<customdomain>* в *asverify.\<storageaccount>.blob.core.windows.net*, можно выполнить предварительную регистрацию домена в Azure. Затем можно создать вторую запись CNAME, указывающую c *\<subdomain>.\<customdomain>* на *\<storageaccount>.blob.core.windows.net*, и с этого момента трафик для личного домена будет направляться в конечную точку BLOB-объекта.

Поддомен *asverify* представляет собой специальный поддомен, распознаваемый Azure. Добавляя *asverify* в свой поддомен, вы разрешаете Azure распознавать ваш личный домен без изменения записи DNS для этого домена. После изменения записи DNS для домена она будет без простоя сопоставлена с конечной точкой большого двоичного объекта.

1. Войдите в свою учетную запись хранения на [портале Azure](https://portal.azure.com).

1. В области меню в разделе **Служба BLOB-объектов** выберите **Личный домен**.  
   Откроется область **Личный домен**.

1. Войдите на веб-сайт своего поставщика DNS и перейдите на страницу управления DNS.  
   Эту страницу можно найти в разделе **Доменное имя**, **DNS** или **Name Server Management** (Управление сервером доменных имен).

1. Найдите раздел управления записями CNAME.  
   Возможно, потребуется перейти на страницу дополнительных параметров и найти пункты **CNAME**, **Псевдоним** или **Поддомены**.

1. Создайте запись CNAME и укажите псевдоним поддомена, содержащий поддомен *asverify*, например **asverify.www** или **asverify.photos**, а затем укажите имя узла.  
   Именем узла является конечная точка службы BLOB-объектов. Его формат — *asverify.\<mystorageaccount>.blob.core.windows.net* (где *mystorageaccount* — имя учетной записи хранения). Имя узла отображается во втором элементе области *Личный домен* на [портале Azure](https://portal.azure.com).

1. В области **Личный домен** в текстовом поле введите имя личного домена, включая поддомен.  
   Не включайте *asverify*. Например, если используется домен *contoso.com* и ваш псевдоним поддомена — *www*, введите **www\.contoso.com**. Если используется поддомен *photos*, введите **photos.contoso.com**.

1. Установите флажок **Использовать непрямую проверку CNAME**.

1. Чтобы зарегистрировать личный домен, выберите **Сохранить**.  
   Если регистрация прошла успешно, появится уведомление портала о том, что учетная запись хранения успешно обновлена. Личный домен был проверен Azure, но трафик, идущий в ваш домен, еще не маршрутизирован в учетную запись хранения.

1. Вернитесь на веб-сайт поставщика DNS и создайте другую запись CNAME, сопоставляющую поддомен с конечной точкой службы BLOB-объектов.  
   Например, можно указать поддомен как *www* или *photos* (без *asverify*), а имя узла как *\<mystorageaccount>.blob.core.windows.net* (где *mystorageaccount* — имя вашей учетной записи хранения). Это действие завершает регистрацию пользовательского домена.

1. Наконец, можно удалить созданную запись CNAME, которая содержит поддомен *asverify*, так как она была необходима только в качестве промежуточного шага.

Как только новая запись CNAME распространится через DNS, пользователи смогут просматривать данные больших двоичных объектов с помощью личного домена при наличии соответствующих разрешений.

## <a name="test-your-custom-domain"></a>Проверка личного домена

Чтобы подтвердить, что личный домен сопоставлен с конечной точкой службы BLOB-объектов, создайте большой двоичный объект в общедоступном контейнере учетной записи хранения. Затем, чтобы получить доступ к этому большому двоичному объекту, используйте в веб-браузере URI следующего формата: `http://<subdomain.customdomain>/<mycontainer>/<myblob>`

Например, можно использовать следующий URI для доступа к веб-форме в контейнере *myforms* на личном поддомене *photos.contoso.com*: `http://photos.contoso.com/myforms/applicationform.htm`

## <a name="deregister-a-custom-domain"></a>Отмена регистрации личного домена

Чтобы отменить регистрацию личного домена для конечной точки хранилища BLOB-объектов, воспользуйтесь одной из следующих процедур.

### <a name="azure-portal"></a>Портал Azure

Чтобы удалить параметр личного домена, выполните приведенные ниже действия.

1. Войдите в свою учетную запись хранения на [портале Azure](https://portal.azure.com).

1. В области меню в разделе **Служба BLOB-объектов** выберите **Личный домен**.  
   Откроется область **Личный домен**.

1. Очистите содержимое текстового поля, в котором указано имя вашего личного домена.

1. Нажмите кнопку **Сохранить**.

После успешного удаления личного домена появится уведомление портала о том, что ваша учетная запись хранения успешно обновлена.

### <a name="azure-cli"></a>Инфраструктура CLI Azure

Воспользуйтесь командой интерфейса командной строки [az storage account update](https://docs.microsoft.com/cli/azure/storage/account) и укажите пустую строку (`""`) в качестве значения аргумента `--custom-domain`, чтобы отменить регистрацию личного домена.

* Формат команды:

  ```azurecli
  az storage account update \
      --name <storage-account-name> \
      --resource-group <resource-group-name> \
      --custom-domain ""
  ```

* Пример команды:

  ```azurecli
  az storage account update \
      --name mystorageaccount \
      --resource-group myresourcegroup \
      --custom-domain ""
  ```

### <a name="powershell"></a>PowerShell

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]

Воспользуйтесь командлетом PowerShell [Set-AzStorageAccount](/powershell/module/az.storage/set-azstorageaccount) и укажите пустую строку (`""`) для значения аргумента `-CustomDomainName`, чтобы отменить регистрацию личного домена.

* Формат команды:

  ```powershell
  Set-AzStorageAccount `
      -ResourceGroupName "<resource-group-name>" `
      -AccountName "<storage-account-name>" `
      -CustomDomainName ""
  ```

* Пример команды:

  ```powershell
  Set-AzStorageAccount `
      -ResourceGroupName "myresourcegroup" `
      -AccountName "mystorageaccount" `
      -CustomDomainName ""
  ```

## <a name="next-steps"></a>Дальнейшие действия
* [Сопоставление содержимого Azure CDN с пользовательским доменом](../../cdn/cdn-map-content-to-custom-domain.md)
* [Использование Azure CDN для доступа к BLOB-объектам с помощью личных доменов по протоколу HTTPS](storage-https-custom-domain-cdn.md)
* [Размещение статических веб-сайтов в службе хранилища Azure](storage-blob-static-website.md)
