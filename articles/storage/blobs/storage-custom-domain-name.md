---
title: Map a custom domain to an Azure Blob Storage endpoint (Сопоставление личного домена с конечной точкой хранилища BLOB-объектов Azure)
titleSuffix: Azure Storage
description: Карта пользовательского домена в хранилище Blob или веб-конечную точку в учетной записи хранения Azure.
author: normesta
ms.service: storage
ms.topic: conceptual
ms.date: 01/23/2020
ms.author: normesta
ms.reviewer: dineshm
ms.subservice: blobs
ms.openlocfilehash: 9d05677ec47851557594ef47499da653accad141
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79370480"
---
# <a name="map-a-custom-domain-to-an-azure-blob-storage-endpoint"></a>Map a custom domain to an Azure Blob Storage endpoint (Сопоставление личного домена с конечной точкой хранилища BLOB-объектов Azure)

Вы можете сопоставить пользовательский домен с конечным пунктом службы blob или статичной конечной точкой [веб-сайта.](storage-blob-static-website.md) 

[!INCLUDE [updated-for-az](../../../includes/storage-data-lake-gen2-support.md)]

> [!NOTE] 
> Это отображение работает только для `www.contoso.com`поддоменов (например: ). Если вы хотите, чтобы ваша конечная точка была `contoso.com`доступна в корневом домене (например: ), то вам придется использовать Azure CDN. Для руководства смотрите [на карте пользовательский домен с разделом этой статьи с включенным httpS.](#enable-https) Поскольку ваш переход в этот раздел этой статьи, чтобы включить корневой домен пользовательского домена, шаг в этом разделе для включения HTTPS является необязательным. 

<a id="enable-http" />

## <a name="map-a-custom-domain-with-only-http-enabled"></a>Карта пользовательского домена с включенным HTTP

Такой подход проще, но позволяет получить доступ только к HTTP. Если учетная запись хранилища настроена [на безопасную передачу](../common/storage-require-secure-transfer.md) по HTTPS, то необходимо включить доступ httpS для пользовательского домена. 

Чтобы включить доступ к HTTPS, см. [Карту пользовательский домен с разделом включенной HTTPS](#enable-https) этой статьи. 

<a id="map-a-domain" />

### <a name="map-a-custom-domain"></a>Карта пользовательского домена

> [!IMPORTANT]
> Пользовательский домен будет недоступен пользователям во время завершения конфигурации. Если ваш домен в настоящее время поддерживает приложение с соглашением на уровне службы (SLA), которое требует нулевого простоя, затем выполните шаги в [карте пользовательского домена с нулевым разбоем](#zero-down-time) раздела этой статьи, чтобы гарантировать, что пользователи могут получить доступ к вашему домену во время отображения DNS.

Если вас не волнует, что домен на короткое время недоступен для пользователей, выполните следующие действия.

:heavy_check_mark: Шаг 1: Получить имя хоста вашей конечной точки хранения.

:heavy_check_mark: Шаг 2: Создайте каноническое имя (CNAME) запись с вашим поставщиком доменов.

:heavy_check_mark: Шаг 3: Зарегистрируйте пользовательский домен с Azure. 

:heavy_check_mark: Шаг 4: Проверьте пользовательский домен.

<a id="endpoint" />

#### <a name="step-1-get-the-host-name-of-your-storage-endpoint"></a>Шаг 1: Получить имя хоста вашей конечной точки хранения 

Имя хоста — это URL-адрес конечных точек хранилища без идентификатора протокола и задней слэйс. 

1. Войдите в свою учетную запись хранения на [портале Azure](https://portal.azure.com).

2. В панели меню, под **настройками,** выберите **Свойства.**  

3. Копируйте значение **конечной точки первичной службы Blob** или **конечной точки веб-сайта Первоначального общества** к текстовому файлу. 

4. Удалите идентификатор протокола *(например,* HTTPS) и отстающую слэш из этой строки. В следующей таблице приведены примеры.

   | Тип конечной точки |  endpoint | имя узла |
   |------------|-----------------|-------------------|
   |услуга blob  | `https://mystorageaccount.blob.core.windows.net/` | `mystorageaccount.blob.core.windows.net` |
   |Статический веб-сайт  | `https://mystorageaccount.z5.web.core.windows.net/` | `mystorageaccount.z5.web.core.windows.net` |
  
   Установите это значение в сторону на более поздний срок.

<a id="create-cname-record" />

#### <a name="step-2-create-a-canonical-name-cname-record-with-your-domain-provider"></a>Шаг 2: Создайте запись канонического имени (CNAME) с поставщиком доменов

Создайте запись CNAME, чтобы указать на имя вашего хоста. Запись CNAME — это тип записи DNS, позволяющий сопоставить имена исходного и конечного доменов.

1. Зайдите на веб-сайт регистратора домена, а затем перейдите на страницу для управления настройками DNS.

   Эту страницу можно найти в разделе **Доменное имя**, **DNS** или **Name Server Management** (Управление сервером доменных имен).

2. Найдите раздел для управления записями CNAME. 

   Возможно, потребуется перейти на страницу дополнительных параметров и найти пункты **CNAME**, **Псевдоним** или **Поддомены**.

3. Создайте запись CNAME. В рамках этой записи предоставьте следующие элементы: 

   - Поддомен alias, `www` `photos`такие как или . Требуется поддомен, корневые домены не поддерживаются. 
      
   - Имя хоста, полученное в [разделе «Получить имя хоста»](#endpoint) в разделе конечной точки хранения ранее в этой статье. 

<a id="register" />

#### <a name="step-3-register-your-custom-domain-with-azure"></a>Шаг 3: Зарегистрируйте свой пользовательский домен в Azure

1. Войдите в свою учетную запись хранения на [портале Azure](https://portal.azure.com).

2. В области меню в разделе **Служба BLOB-объектов** выберите **Личный домен**.  

   ![пользовательский вариант домена](./media/storage-custom-domain-name/custom-domain-button.png "пользовательский домен")

   Откроется область **Личный домен**.

3. В текстовом поле **domain name** введите имя пользовательского домена, включая субдомен  
   
   Например, если ваш домен *contoso.com* и ваш псевдоним `www.contoso.com`поддоменов *www*, введите . Если ваш поддомен `photos.contoso.com`— *это фотографии,* введите.

4. Чтобы зарегистрировать пользовательский домен, выберите кнопку **«Сохранить».**

   После того, как запись CNAME распространяется через серверы доменных имен (DNS), и если у пользователей есть соответствующие разрешения, они могут просматривать данные blob с помощью пользовательского домена.

#### <a name="step-4-test-your-custom-domain"></a>Шаг 4: Проверьте пользовательский домен

Чтобы подтвердить, что личный домен сопоставлен с конечной точкой службы BLOB-объектов, создайте большой двоичный объект в общедоступном контейнере учетной записи хранения. Затем, чтобы получить доступ к этому большому двоичному объекту, используйте в веб-браузере URI следующего формата: `http://<subdomain.customdomain>/<mycontainer>/<myblob>`

Например, можно использовать следующий URI для доступа к веб-форме в контейнере *myforms* на личном поддомене *photos.contoso.com*: `http://photos.contoso.com/myforms/applicationform.htm`

<a id="zero-down-time" />

### <a name="map-a-custom-domain-with-zero-downtime"></a>Карта пользовательского домена с нулевым временем простоя

> [!NOTE]
> Если вас не беспокоит то, что домен ненадолго недоступен для пользователей, то подумайте о том, чтобы вы сойти с помощью последующих шагов на [карте в специальном](#map-a-domain) разделе домена этой статьи. Это более простой подход с меньшим количеством шагов.  

Если ваш домен в настоящее время поддерживает приложение с соглашением на уровне службы (SLA), которое требует нулевого простоя, затем выполните следующие действия, чтобы гарантировать, что пользователи могут получить доступ к вашему домену во время отображения DNS. 

:heavy_check_mark: Шаг 1: Получить имя хоста вашей конечной точки хранения.

:heavy_check_mark: Шаг 2: Создайте промежуточное каноническое имя (CNAME) с вашим поставщиком доменов.

:heavy_check_mark: Шаг 3: Предварительная регистрация пользовательского домена с Azure.

:heavy_check_mark: Шаг 4: Создайте запись CNAME с вашим поставщиком доменов.

:heavy_check_mark: Шаг 5: Проверьте пользовательский домен.

<a id="endpoint-2" />

#### <a name="step-1-get-the-host-name-of-your-storage-endpoint"></a>Шаг 1: Получить имя хоста вашей конечной точки хранения 

Имя хоста — это URL-адрес конечных точек хранилища без идентификатора протокола и задней слэйс. 

1. Войдите в свою учетную запись хранения на [портале Azure](https://portal.azure.com).

2. В панели меню, под **настройками,** выберите **Свойства.**  

3. Копируйте значение **конечной точки первичной службы Blob** или **конечной точки веб-сайта Первоначального общества** к текстовому файлу. 

4. Удалите идентификатор протокола *(например,* HTTPS) и отстающую слэш из этой строки. В следующей таблице приведены примеры.

   | Тип конечной точки |  endpoint | имя узла |
   |------------|-----------------|-------------------|
   |услуга blob  | `https://mystorageaccount.blob.core.windows.net/` | `mystorageaccount.blob.core.windows.net` |
   |Статический веб-сайт  | `https://mystorageaccount.z5.web.core.windows.net/` | `mystorageaccount.z5.web.core.windows.net` |
  
   Установите это значение в сторону на более поздний срок.

#### <a name="step-2-create-a-intermediary-canonical-name-cname-record-with-your-domain-provider"></a>Шаг 2: Создайте промежуточное каноническое имя (CNAME) с вашим поставщиком доменов

Создайте временную запись CNAME, чтобы указать на имя вашего хоста. Запись CNAME — это тип записи DNS, позволяющий сопоставить имена исходного и конечного доменов.

1. Зайдите на веб-сайт регистратора домена, а затем перейдите на страницу для управления настройками DNS.

   Эту страницу можно найти в разделе **Доменное имя**, **DNS** или **Name Server Management** (Управление сервером доменных имен).

2. Найдите раздел для управления записями CNAME. 

   Возможно, потребуется перейти на страницу дополнительных параметров и найти пункты **CNAME**, **Псевдоним** или **Поддомены**.

3. Создайте запись CNAME. В рамках этой записи предоставьте следующие элементы: 

   - Поддомен alias, `www` `photos`такие как или . Требуется поддомен, корневые домены не поддерживаются.

     Добавьте `asverify` поддомен в псевдоним. Пример: `asverify.www` или `asverify.photos`.
       
   - Имя хоста, полученное в [разделе «Получить имя хоста»](#endpoint) в разделе конечной точки хранения ранее в этой статье. 

     Добавьте поддомен `asverify` к имени хоста. Например: `asverify.mystorageaccount.blob.core.windows.net`.

4. Чтобы зарегистрировать пользовательский домен, выберите кнопку **«Сохранить».**

   Если регистрация прошла успешно, появится уведомление портала о том, что учетная запись хранения успешно обновлена. Личный домен был проверен Azure, но трафик, идущий в ваш домен, еще не маршрутизирован в учетную запись хранения.

#### <a name="step-3-pre-register-your-custom-domain-with-azure"></a>Шаг 3: Предварительно зарегистрировать свой пользовательский домен с Azure

При предварительной регистрации пользовательского домена в Azure вы разрешаете Azure распознавать пользовательский домен без изменения записи DNS для домена. Таким образом, когда вы измените запись DNS для домена, она будет отображаться на конечную точку blob без простоев.

1. Войдите в свою учетную запись хранения на [портале Azure](https://portal.azure.com).

2. В области меню в разделе **Служба BLOB-объектов** выберите **Личный домен**.  

   ![пользовательский вариант домена](./media/storage-custom-domain-name/custom-domain-button.png "пользовательский домен")

   Откроется область **Личный домен**.

3. В текстовом поле **domain name** введите имя пользовательского домена, включая субдомен  
   
   Например, если ваш домен *contoso.com* и ваш псевдоним `www.contoso.com`поддоменов *www*, введите . Если ваш поддомен `photos.contoso.com`— *это фотографии,* введите.

4. Установите флажок **Использовать непрямую проверку CNAME**.

5. Чтобы зарегистрировать пользовательский домен, выберите кнопку **«Сохранить».**
  
   После того, как запись CNAME распространяется через серверы доменных имен (DNS), и если у пользователей есть соответствующие разрешения, они могут просматривать данные blob с помощью пользовательского домена.

#### <a name="step-4-create-a-cname-record-with-your-domain-provider"></a>Шаг 4: Создайте запись CNAME с вашим поставщиком доменов

Создайте временную запись CNAME, чтобы указать на имя вашего хоста.

1. Зайдите на веб-сайт регистратора домена, а затем перейдите на страницу для управления настройками DNS.

   Эту страницу можно найти в разделе **Доменное имя**, **DNS** или **Name Server Management** (Управление сервером доменных имен).

2. Найдите раздел для управления записями CNAME. 

   Возможно, потребуется перейти на страницу дополнительных параметров и найти пункты **CNAME**, **Псевдоним** или **Поддомены**.

3. Создайте запись CNAME. В рамках этой записи предоставьте следующие элементы: 

   - Поддомен alias, `www` `photos`такие как или . Требуется поддомен, корневые домены не поддерживаются.
      
   - Имя хоста, полученное в [разделе «Получить имя хоста»](#endpoint-2) в разделе конечной точки хранения ранее в этой статье. 

#### <a name="step-5-test-your-custom-domain"></a>Шаг 5: Проверьте пользовательский домен

Чтобы подтвердить, что личный домен сопоставлен с конечной точкой службы BLOB-объектов, создайте большой двоичный объект в общедоступном контейнере учетной записи хранения. Затем, чтобы получить доступ к этому большому двоичному объекту, используйте в веб-браузере URI следующего формата: `http://<subdomain.customdomain>/<mycontainer>/<myblob>`

Например, можно использовать следующий URI для доступа к веб-форме в контейнере *myforms* на личном поддомене *photos.contoso.com*: `http://photos.contoso.com/myforms/applicationform.htm`

### <a name="remove-a-custom-domain-mapping"></a>Удалить пользовательское отображение домена

Чтобы удалить пользовательское отображение домена, снимите с учета пользовательский домен. Используйте одну из следующих процедур.

#### <a name="portal"></a>[Портал](#tab/azure-portal)

Чтобы удалить параметр личного домена, выполните приведенные ниже действия.

1. Войдите в свою учетную запись хранения на [портале Azure](https://portal.azure.com).

2. В области меню в разделе **Служба BLOB-объектов** выберите **Личный домен**.  
   Откроется область **Личный домен**.

3. Очистите содержимое текстового поля, в котором указано имя вашего личного домена.

4. Нажмите кнопку **Сохранить**.

После успешного удаления пользовательского домена вы увидите уведомление портала об успешном обновлении учетной записи хранилища

#### <a name="azure-cli"></a>[Лазурный CLI](#tab/azure-cli)

Воспользуйтесь командой интерфейса командной строки [az storage account update](https://docs.microsoft.com/cli/azure/storage/account) и укажите пустую строку (`""`) в качестве значения аргумента `--custom-domain`, чтобы отменить регистрацию личного домена.

* Формат команды:

  ```azurecli
  az storage account update \
      --name <storage-account-name> \
      --resource-group <resource-group-name> \
      --custom-domain ""
  ```

* Пример команды:

  ```azurecli
  az storage account update \
      --name mystorageaccount \
      --resource-group myresourcegroup \
      --custom-domain ""
  ```

#### <a name="powershell"></a>[PowerShell](#tab/azure-powershell)

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]

Воспользуйтесь командлетом PowerShell [Set-AzStorageAccount](/powershell/module/az.storage/set-azstorageaccount) и укажите пустую строку (`""`) для значения аргумента `-CustomDomainName`, чтобы отменить регистрацию личного домена.

* Формат команды:

  ```powershell
  Set-AzStorageAccount `
      -ResourceGroupName "<resource-group-name>" `
      -AccountName "<storage-account-name>" `
      -CustomDomainName ""
  ```

* Пример команды:

  ```powershell
  Set-AzStorageAccount `
      -ResourceGroupName "myresourcegroup" `
      -AccountName "mystorageaccount" `
      -CustomDomainName ""
  ```
---

<a id="enable-https" />

## <a name="map-a-custom-domain-with-https-enabled"></a>Карта пользовательского домена с включенным HTTPS

Этот подход включает в себя больше шагов, но он позволяет доступ httpS. 

Если вам не нужны пользователи для доступа к вашему blob или веб-контента с помощью HTTPS, то увидеть [карту пользовательский домен только с включенным разделом этой](#enable-http) статьи. 

Чтобы сопоставить пользовательский домен и включить доступ к HTTPS, сделайте следующее:

1. Включите [Azure CDN](../../cdn/cdn-overview.md) на капле или веб-конечную точку. 

   Для конечных точек хранения Blob [см. Интеграция учетной записи хранения Azure с Azure CDN.](../../cdn/cdn-create-a-storage-account-with-cdn.md) 

   Для статического конечных точек веб-сайта [см.](static-website-content-delivery-network.md)

2. [Сопоставление содержимого Azure CDN с личным доменом](../../cdn/cdn-map-content-to-custom-domain.md).

3. [Включите HTTPS на пользовательском домене Azure CDN.](../../cdn/cdn-custom-ssl.md)

   > [!NOTE] 
   > При обновлении статического веб-сайта убедитесь, что необходимо очистить кэшированное содержимое на серверах края CDN, очистив конечную точку CDN. Дополнительные сведения см. в статье [Очистка конечной точки сети CDN Azure](../../cdn/cdn-purge-endpoint.md).

4. (Необязательно) Просмотрите следующее руководство:

   * [Общие маркеры подписи доступа (SAS) с Azure CDN.](https://docs.microsoft.com/azure/cdn/cdn-storage-custom-domain-https#shared-access-signatures)

   * [HTTP-to-HTTPS перенаправление с Azure CDN](https://docs.microsoft.com/azure/cdn/cdn-storage-custom-domain-https#http-to-https-redirection).

   * [Ценообразование и выставление счетов при использовании Blob Storage с Azure CDN](https://docs.microsoft.com/azure/cdn/cdn-storage-custom-domain-https#http-to-https-redirection).

## <a name="next-steps"></a>Дальнейшие действия

* [Узнайте о статичном хостинге веб-сайтов в хранилище Azure Blob](storage-blob-static-website.md)
