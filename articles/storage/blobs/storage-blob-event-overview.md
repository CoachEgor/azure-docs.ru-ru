---
title: Реагирование на события хранилища BLOB-объектов Azure | Документация Майкрософт
description: Используйте службу "Сетка событий Azure" для подписки на события хранилища BLOB-объектов.
author: normesta
ms.author: normesta
ms.date: 04/06/2020
ms.topic: conceptual
ms.service: storage
ms.subservice: blobs
ms.reviewer: cbrooks
ms.openlocfilehash: e4dd6bab6198546dc5acab78ec59d92387328dbb
ms.sourcegitcommit: 441db70765ff9042db87c60f4aa3c51df2afae2d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2020
ms.locfileid: "80754997"
---
# <a name="reacting-to-blob-storage-events"></a>Реагирование на события хранилища BLOB-объектов

События хранения Azure позволяют приложениям реагировать на события, такие как создание и удаление капли. При этом не требуется сложный код или дорогостоящие и неэффективные службы опроса. Самая лучшая часть вы только оплачиваете для чего вы используете.

События хранения Blob перемещаются с помощью [Azure Event Grid](https://azure.microsoft.com/services/event-grid/) для подписчиков, таких как Azure Functions, Azure Logic Apps или даже для вашего собственного http-слушателя. Event Grid обеспечивает надежную доставку событий для ваших приложений с помощью богатых политик повторений и мертвых букв.

Ознакомьтесь со статьей [схемы схемы хранения памяти Blob,](../../event-grid/event-schema-blob-storage.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json) чтобы просмотреть полный список событий, которые поддерживает хранение Blob.

К распространенным сценариям событий хранилища BLOB-объектов относятся обработка изображений и видео, индексирование поиска и любые рабочие процессы, ориентированные на файлы. Асинхронная передача файлов идеально подходит для событий. Когда изменения вносятся редко, а сценарий требует немедленного реагирования, архитектура на основе событий может быть особенно эффективной.

Если вы хотите попробовать события хранения капли, см.

|Если вы хотите использовать этот инструмент:    |Смотрите эту статью: |
|--|-|
|Портал Azure    |[Быстрый запуск: События хранения Route Blob в конечную точку с помощью портала Azure](https://docs.microsoft.com/azure/event-grid/blob-event-quickstart-portal?toc=%2fazure%2fstorage%2fblobs%2ftoc.json)|
|PowerShell    |[Быстрый запуск: События хранения маршрута в конечную точку с PowerShell](https://docs.microsoft.com/azure/storage/blobs/storage-blob-event-quickstart-powershell?toc=%2fazure%2fstorage%2fblobs%2ftoc.json)|
|Azure CLI    |[Быстрый запуск: События хранения маршрутов в конечную точку С Azure CLI](https://docs.microsoft.com/azure/storage/blobs/storage-blob-event-quickstart?toc=%2fazure%2fstorage%2fblobs%2ftoc.json)|

Для просмотра подробных примеров реагирования на события хранения Blob с помощью функций Azure приведены следующие статьи:

- [Учебник: Используйте события Azure Data Lake Storage Gen2 для обновления таблицы Databricks Delta.](data-lake-storage-events.md)
- [Учебник: Автоматизация повторного размера загруженных изображений с помощью Event Grid](https://docs.microsoft.com/azure/event-grid/resize-images-on-storage-blob-upload-event?tabs=dotnet)

>[!NOTE]
> Только учетные записи хранения рода **StorageV2 (общая цель v2)**, **BlockBlobStorage**, и **BlobStorage** поддержки событий интеграции. **Хранилище (версия 1, общего назначения)***не* поддерживает интеграцию со службой "Сетка событий".

## <a name="the-event-model"></a>Модель мероприятия

Event Grid использует подписку на события для направления сообщений событий подписчикам с [подписчиками.](../../event-grid/concepts.md#event-subscriptions) Это изображение иллюстрирует взаимосвязь между издателями событий, подписками на события и обработчиками событий.

![Модель Сетки событий](./media/storage-blob-event-overview/event-grid-functional-model.png)

Во-первых, подписаться на конечную точку события. Затем, когда событие срабатывает, служба Event Grid отправляет данные об этом событии в конечную точку.

Ознакомьтесь со статьей [схемы хранения событий Blob,](../../event-grid/event-schema-blob-storage.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json) чтобы просмотреть:

> [!div class="checklist"]
> * Полный список событий хранения Blob и способ запуска каждого события.
> * Пример данных, которые Сетка событий отправит для каждого из этих событий.
> * Цель каждой пары ключей значения, которая отображается в данных.

## <a name="filtering-events"></a>Фильтрация событий

События Blob [могут быть отфильтрованы](/cli/azure/eventgrid/event-subscription?view=azure-cli-latest) по типу события, имени контейнера или имени объекта, который был создан/удален. Фильтры в Event Grid соответствуют началу или концу предмета, поэтому события с соответствующей темой переходят к абоненту.

Чтобы узнать больше о том, как применять фильтры, [см.](https://docs.microsoft.com/azure/event-grid/how-to-filter-events)

Тема событий хранилища BLOB-объектов использует следующий формат:

```
/blobServices/default/containers/<containername>/blobs/<blobname>
```

Чтобы сопоставить все события для учетной записи хранения, фильтры темы можно оставить пустыми.

Чтобы сопоставить события из больших двоичных объектов, созданных в наборе контейнеров с общим префиксом, используйте фильтр `subjectBeginsWith`, подобный этому:

```
/blobServices/default/containers/containerprefix
```

Чтобы сопоставить события из больших двоичных объектов, созданных в конкретном контейнере, используйте фильтр `subjectBeginsWith`, подобный этому:

```
/blobServices/default/containers/containername/
```

Чтобы сопоставить события из больших двоичных объектов, созданных в конкретном контейнере с общим префиксом имени большого двоичного объекта, используйте фильтр `subjectBeginsWith`, подобный этому:

```
/blobServices/default/containers/containername/blobs/blobprefix
```

Чтобы сопоставить события из больших двоичных объектов, созданных в конкретном контейнере с общим суффиксом имени большого двоичного объекта, используйте фильтр `subjectEndsWith`, такой как ".log" или ".jpg". Дополнительные сведения см. в статье [Основные понятия в службе "Сетка событий Azure"](../../event-grid/concepts.md#event-subscriptions).

## <a name="practices-for-consuming-events"></a>Рекомендации по потреблению событий

Приложения, которые обрабатывают события хранилища BLOB-объектов, должны следовать нескольким рекомендациям:
> [!div class="checklist"]
> * Так как в один обработчик событий можно настроить маршрутизацию событий из нескольких подписок, не следует предполагать, что события поступают из определенного источника. Но необходимо проверять тему сообщения, чтобы убедиться, что оно поступает из ожидаемой учетной записи хранения.
> * Подобным образом убедитесь, что вы готовы к обработке этого типа событий (eventType), а также не следует предполагать, что все получаемые события будут иметь ожидаемый тип.
> * Поскольку сообщения могут поступать после некоторой задержки, используйте поля etag, чтобы понять, если ваша информация об объектах все еще актуальна. Чтобы узнать, как использовать поле etag, [см.](https://docs.microsoft.com/azure/storage/common/storage-concurrency?toc=%2fazure%2fstorage%2fblobs%2ftoc.json#managing-concurrency-in-blob-storage) 
> * Поскольку сообщения могут поступать не по порядку, используйте поля секвенсоров для понимания порядка событий на каком-либо конкретном объекте. Поле секвенсора представляет собой значение строки, представляющее логическую последовательность событий для какого-либо конкретного имени капли. Можно использовать стандартное сравнение строки, чтобы понять относительную последовательность двух событий на одном и том же названии blob.
> События хранения гарантируют доставку абонентам по крайней мере один раз, что гарантирует вывод всех сообщений. Однако из-за повторного использования или доступности подписок иногда могут возникать дублирующиеся сообщения.
> * Используйте поле blobType чтобы понять, какой тип операций разрешен в большом двоичном объекте и какие типы клиентских библиотек следует использовать для доступа к большому двоичному объекту. Допустимые значения: `BlockBlob` или `PageBlob`. 
> * Для доступа к большому двоичному объекту используйте поле url с конструкторами `CloudBlockBlob` и `CloudAppendBlob`.
> * Игнорируйте поля, которые вам непонятны. Такой подход поможет обеспечить устойчивость к новым функциям, которые могут быть добавлены в будущем.
> * Если вы хотите убедиться, что событие **Microsoft.Storage.BlobCreated** срабатывает только тогда, когда `CopyBlob` `PutBlob`Block `PutBlockList` `FlushWithClose` Blob полностью зафиксирован, отфильтруйте событие для вызовов , или REST API. Эти вызовы API вызывают событие **Microsoft.Storage.BlobCreated** только после того, как данные полностью зафиксированы в Block Blob. Чтобы узнать, как создать фильтр, [см.](https://docs.microsoft.com/azure/event-grid/how-to-filter-events)


## <a name="next-steps"></a>Дальнейшие действия

Ознакомьтесь с дополнительными сведениями о Сетке событий и попробуйте использовать события хранилища BLOB-объектов:

- [An introduction to Azure Event Grid](../../event-grid/overview.md) (Общие сведения о службе "Сетка событий Azure")
- [Схема событий хранения Blob](../../event-grid/event-schema-blob-storage.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json)
- [Маршрут Blob хранения События на пользовательской конечную точку веб](storage-blob-event-quickstart.md)
