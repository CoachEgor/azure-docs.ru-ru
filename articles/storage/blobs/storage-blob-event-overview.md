---
title: Реагирование на события хранилища BLOB-объектов Azure | Документация Майкрософт
description: Используйте службу "Сетка событий Azure" для подписки на события хранилища BLOB-объектов.
services: storage,event-grid
author: cbrooksmsft
ms.author: cbrooks
ms.date: 01/30/2018
ms.topic: article
ms.service: storage
ms.subservice: blobs
ms.openlocfilehash: c0655d02fd5d0d64c22db286236b2a26f9e70619
ms.sourcegitcommit: f56b267b11f23ac8f6284bb662b38c7a8336e99b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/28/2019
ms.locfileid: "67444678"
---
# <a name="reacting-to-blob-storage-events"></a>Реагирование на события хранилища BLOB-объектов

События службы хранилища Azure позволяют приложениям реагировать на события, такие как создание и удаление больших двоичных объектов, с помощью современных бессерверных архитектур. При этом не требуется сложный код или дорогостоящие и неэффективные службы опроса.

Вместо этого события отправляются через службу ["Сетка событий Azure"](https://azure.microsoft.com/services/event-grid/) подписчикам, таких как функции Azure, Azure Logic Apps, или даже пользовательский прослушиватель http и вы платите только за использование.

События хранилища BLOB-объектов надежно отправляются в службу "Сетка событий", которая предоставляет надежную доставку службы для приложений с помощью политики повтора с широкими возможностями и доставки недоставленных.

К распространенным сценариям событий хранилища BLOB-объектов относятся обработка изображений и видео, индексирование поиска и любые рабочие процессы, ориентированные на файлы. Асинхронная передача файлов идеально подходит для событий. Когда изменения вносятся редко, а сценарий требует немедленного реагирования, архитектура на основе событий может быть особенно эффективной.

Если вы хотите выполнить эту процедуру, см. в разделе любого из этих кратких руководств:

|Если вы хотите использовать это средство:    |См. в статье: |
|--|-|
|Портал Azure    |[Краткое руководство Перенаправление событий хранилища BLOB-объектов конечную веб-точку с помощью портала Azure](https://docs.microsoft.com/azure/event-grid/blob-event-quickstart-portal?toc=%2fazure%2fstorage%2fblobs%2ftoc.json)|
|Инфраструктура CLI Azure    |[Краткое руководство Перенаправление событий хранилища конечную веб-точку с помощью PowerShell](https://docs.microsoft.com/azure/storage/blobs/storage-blob-event-quickstart-powershell?toc=%2fazure%2fstorage%2fblobs%2ftoc.json)|
|PowerShell    |[Краткое руководство Перенаправление событий хранилища конечную веб-точку с помощью Azure CLI](https://docs.microsoft.com/azure/storage/blobs/storage-blob-event-quickstart?toc=%2fazure%2fstorage%2fblobs%2ftoc.json)|

## <a name="the-event-model"></a>Модель события

Сетка событий использует [подписки на события](../../event-grid/concepts.md#event-subscriptions) для маршрутизации сообщений о событиях подписчикам. Этот образ показана связь между издателями событий, подписки на события и обработчики событий.

![Модель Сетки событий](./media/storage-blob-event-overview/event-grid-functional-model.png)

Во-первых подписаться на событие конечной точки. Затем при появлении события службы "Сетка событий" будет отправлять данные об этом событии в конечную точку.

См. в разделе [схема событий хранилища BLOB-объектов](../../event-grid/event-schema-blob-storage.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json) статью, чтобы просмотреть:

> [!div class="checklist"]
> * Полный список событий хранилища BLOB-объектов и запуска каждого события.
> * Для каждого из этих событий следует отправить пример данных сетки событий.
> * Цель каждая пара значений ключа, который отображается в данных.

## <a name="filtering-events"></a>Фильтрация событий

Подписки на события больших двоичных объектов можно фильтровать на основе типа события, а также по имени контейнера и имени созданного или удаленного большого двоичного объекта.  Фильтры могут применяться к подпискам на события во время [создания](/cli/azure/eventgrid/event-subscription?view=azure-cli-latest) подписки на событие или [позже](/cli/azure/eventgrid/event-subscription?view=azure-cli-latest). Фильтры темы в службе "Сетка событий" работают на основе совпадений "начинается с" и "заканчивается на", что позволяет доставлять подписчику события с соответствующей темой.

Дополнительные сведения о том, как применять фильтры, см. в разделе [фильтрация событий для события сетки](https://docs.microsoft.com/azure/event-grid/how-to-filter-events).

Тема событий хранилища BLOB-объектов использует следующий формат:

```
/blobServices/default/containers/<containername>/blobs/<blobname>
```

Чтобы сопоставить все события для учетной записи хранения, фильтры темы можно оставить пустыми.

Чтобы сопоставить события из больших двоичных объектов, созданных в наборе контейнеров с общим префиксом, используйте фильтр `subjectBeginsWith`, подобный этому:

```
/blobServices/default/containers/containerprefix
```

Чтобы сопоставить события из больших двоичных объектов, созданных в конкретном контейнере, используйте фильтр `subjectBeginsWith`, подобный этому:

```
/blobServices/default/containers/containername/
```

Чтобы сопоставить события из больших двоичных объектов, созданных в конкретном контейнере с общим префиксом имени большого двоичного объекта, используйте фильтр `subjectBeginsWith`, подобный этому:

```
/blobServices/default/containers/containername/blobs/blobprefix
```

Чтобы сопоставить события из больших двоичных объектов, созданных в конкретном контейнере с общим суффиксом имени большого двоичного объекта, используйте фильтр `subjectEndsWith`, такой как ".log" или ".jpg". Дополнительные сведения см. в статье [Основные понятия в службе "Сетка событий Azure"](../../event-grid/concepts.md#event-subscriptions).

## <a name="practices-for-consuming-events"></a>Рекомендации по потреблению событий

Приложения, которые обрабатывают события хранилища BLOB-объектов, должны следовать нескольким рекомендациям:
> [!div class="checklist"]
> * Так как в один обработчик событий можно настроить маршрутизацию событий из нескольких подписок, не следует предполагать, что события поступают из определенного источника. Но необходимо проверять тему сообщения, чтобы убедиться, что оно поступает из ожидаемой учетной записи хранения.
> * Подобным образом убедитесь, что вы готовы к обработке этого типа событий (eventType), а также не следует предполагать, что все получаемые события будут иметь ожидаемый тип.
> * Так как сообщения могут поступать не по порядку и после некоторой задержки, используйте поля ETag, чтобы понять, являются ли сведения об объектах актуальными.  Используйте поля sequencer для понимания последовательности событий для каждого отдельного объекта.
> * Используйте поле blobType чтобы понять, какой тип операций разрешен в большом двоичном объекте и какие типы клиентских библиотек следует использовать для доступа к большому двоичному объекту. Допустимые значения: `BlockBlob` или `PageBlob`. 
> * Для доступа к большому двоичному объекту используйте поле url с конструкторами `CloudBlockBlob` и `CloudAppendBlob`.
> * Игнорируйте поля, которые вам непонятны. Такой подход поможет обеспечить устойчивость к новым функциям, которые могут быть добавлены в будущем.
> * Если вы хотите убедиться, что **Microsoft.Storage.BlobCreated** событие запускается, только в том случае, когда большой двоичный объект блока прилагает все усилия, фильтрация событий для `CopyBlob`, `PutBlob`, `PutBlockList` или `FlushWithClose` REST Вызовы API. Триггер вызовы этих API **Microsoft.Storage.BlobCreated** событий только в том случае, после данных, полностью зафиксирована блочный большой двоичный объект. Узнайте, как создать фильтр, см. в разделе [фильтрация событий для события сетки](https://docs.microsoft.com/azure/event-grid/how-to-filter-events).


## <a name="next-steps"></a>Дальнейшие действия

Ознакомьтесь с дополнительными сведениями о Сетке событий и попробуйте использовать события хранилища BLOB-объектов:

- [An introduction to Azure Event Grid](../../event-grid/overview.md) (Общие сведения о службе "Сетка событий Azure")
- [Перенаправление событий хранилища BLOB-объектов в пользовательскую конечную веб-точку (предварительная версия)](storage-blob-event-quickstart.md)
