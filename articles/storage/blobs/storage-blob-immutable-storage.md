---
title: Неизменяемое хранилище капли - Хранилище Azure
description: Служба хранилища Azure предлагает поддержку WORM для хранения больших двоичных объектов, что позволяет хранить данные в нестираемом и неизменяемом состоянии на протяжении определенного интервала времени.
services: storage
author: tamram
ms.service: storage
ms.topic: conceptual
ms.date: 11/18/2019
ms.author: tamram
ms.reviewer: hux
ms.subservice: blobs
ms.openlocfilehash: a980c7bd068a463956191eece43ec1be233e7890
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79367624"
---
# <a name="store-business-critical-blob-data-with-immutable-storage"></a>Храните критически важные для бизнеса данные с непреложным хранилищем

Неизменяемое хранилище для хранения Azure Blob позволяет пользователям хранить критически важные для бизнеса объекты данных в состоянии WORM (Write Once, Read Many). Это состояние делает их нестираемыми и неизменяемыми в течение определенного пользователем интервала времени. В течение интервала удержания капли могут быть созданы и прочитаны, но не могут быть изменены или удалены. Неизменяемое хранилище доступно для учетных записей v1 общего назначения, v2 общего назначения, BlobStorage и BlockBlobStorage во всех регионах Azure.

Для получения информации о том, как установить и очистить юридические удержания или создать временную [Set and manage immutability policies for Blob storage](storage-blob-immutability-policies-manage.md)политику удержания с помощью портала Azure, PowerShell или Azure CLI, см.

[!INCLUDE [updated-for-az](../../../includes/storage-data-lake-gen2-support.md)]

## <a name="about-immutable-blob-storage"></a>О непреложном хранении Blob

Неизменяемое хранилище помогает организации здравоохранения, финансовым учреждениям и смежным отраслям,&mdash;в частности организациям брокеров-дилеров,&mdash;безопасно хранить данные. Неизменяемое хранилище также может быть использовано в любом сценарии для защиты критически важных данных от модификации или удаления.

Распространенные приложения включают следующее.

- **Соответствие нормативным требованиям**: хранение данных в неизменяемом виде в хранилище BLOB-объектов Azure помогает организациям соответствовать SEC 17a-4(f), CFTC 1.31(d), FINRA и другим нормам. В техническом документе Cohasset Associates подробно описывается, как Непреложные системы хранения данных можно загрузить через [портал Microsoft Service Trust](https://aka.ms/AzureWormStorage)Portal. [Центр доверия Azure](https://www.microsoft.com/trustcenter/compliance/compliance-overview) содержит подробную информацию о наших сертификатах соответствия.

- **Безопасное хранение документов**: Неизменяемое хранилище для хранения Azure Blob гарантирует, что данные не могут быть изменены или удалены любым пользователем, включая пользователей с административными привилегиями учетной записи.

- **Правовое удержание**: Неизменяемое хранилище для хранения Azure Blob позволяет пользователям хранить конфиденциальную информацию, которая имеет решающее значение для судебного разбирательства или использования бизнеса в состоянии, надежном подзащитном, в течение желаемого периода времени до удаления удержания. Эта функция не ограничивается только случаями юридического использования, но также может рассматриваться как удержание на основе событий или блокировка предприятия, где требуется защита данных на основе триггеров событий или корпоративной политики.

Неизменяемое хранилище поддерживает следующие функции:

- **[Поддержка политики удержания на основе времени:](#time-based-retention-policies)** Пользователи могут устанавливать политики для хранения данных для определенного интервала. При установке политики удержания на основе времени капли могут создаваться и читаться, но не изменяться или удаляться. После истечения срока хранения капли могут быть удалены, но не перезаписаны.

- **[Поддержка политики юридического удержания:](#legal-holds)** Если интервал удержания неизвестен, пользователи могут устанавливать юридические удержания для хранения неизменяемых данных до тех пор, пока юридическое удержание не будет очищено.  При установлении политики юридического удержания капли могут быть созданы и прочитаны, но не изменены или удалены. Каждое юридическое удержание связано с буквенным тегом, определяемым пользователем (например, идентификатором случая, именем события и т.д.), который используется в качестве строки идентификатора. 

- **Поддержка для всех уровней хранилища BLOB-объектов**: политики WORM не зависят от уровня хранилища BLOB-объектов Azure и применяются ко всем уровням: горячим, холодным и архивным. Это позволяет пользователям переносить данные на наиболее оптимизированный по стоимости уровень для своей рабочей нагрузки, сохраняя их неизменность.

- **Настройка уровня контейнера**: на уровне контейнера пользователи могут настроить временные политики периода удержания и теги юридического удержания. Пользователи могут создавать и блокировать временные политики удержания, расширять период хранения, устанавливать и очищать удержания по юридическим причинам и т. д. с помощью простых настроек уровня контейнера. Эти политики применяются для всех имеющихся и новых больших двоичных объектов в контейнере.

- **Поддержка аудита лесозаготовок**: Каждый контейнер включает журнал аудита политики. Он отображает до семи команд удержания на основе времени для заблокированных политик удержания на основе времени и содержит идентификатор пользователя, тип команды, временные отметки и интервал удержания. Для юридического удержания журнал содержит идентификатор пользователя, тип команды, отметки времени и теги юридического удержания. Этот журнал сохраняется в течение всего срока действия политики в соответствии с руководящими принципами регулирования SEC 17a-4(f. [В журнале деятельности Azure](../../azure-monitor/platform/platform-logs-overview.md) показан более полный журнал всех действий диспетчерской; в то время как включение [Azure Diagnostic Logs](../../azure-monitor/platform/platform-logs-overview.md) сохраняет и показывает операции плоскости данных. Пользователь постоянно несет ответственность за хранение этих журналов в соответствии с нормативами или другими требованиями.

## <a name="how-it-works"></a>Принцип работы

Функция хранения данных в неизменяемом виде хранилища BLOB-объектов Azure поддерживает два типа WORM или неизменяемых политик: период удержания на основе времени и юридическое удержание. Когда политика удержания на основе времени или легальный удержание применяется на контейнере, все существующие капли перемещаются в непреложное состояние WORM менее чем за 30 секунд. Все новые капли, загруженные в защищенный от политики контейнер, также будут перемещены в непреложное состояние. После того, как все капли находятся в непреложном состоянии, непреложный полис подтверждается и любые операции перезаписи или удаления в неизменном контейнере не допускаются.

Удаление учетной записи контейнеров и складов также не допускается, если в контейнере есть капли, защищенные юридическим удержанием или заблокированной политикой, основанной на времени. Политика юридического удержания защитит от удаления каблов, контейнеров и учетных записей. Как разблокированные, так и заблокированные политики, основанные на времени, защитят от удаления капли в течение указанного времени. Как разблокированные, так и заблокированные политики, основанные на времени, защитят от удаления контейнеров только в том случае, если в контейнере существует хотя бы одна капля. Только контейнер с *заблокированной* политикой, основанной на времени, защитит от удаления учетной записи хранилища; контейнеры с разблокированными политиками, основанными на времени, не обеспечивают защиту от удаления учетной записи хранилища, а также соответствие требованиям.

Для получения дополнительной информации о том, как настроить [Set and manage immutability policies for Blob storage](storage-blob-immutability-policies-manage.md)и заблокировать временные политики удержания, см.

## <a name="time-based-retention-policies"></a>Политики удержания на основе времени

> [!IMPORTANT]
> Политика удержания на основе времени должна быть *заблокирована,* чтобы капля была в совместимом неизменном состоянии (написать и удалить защищенное) состояние для SEC 17a-4(f) и других нормативных требований. Мы рекомендуем заблокировать политику в разумные сроки, как правило, менее 24 часов. Начальное состояние политики удержания на основе прикладного времени *разблокировано,* что позволяет протестировать функцию и внести изменения в политику, прежде чем заблокировать ее. В то время как *разблокированное* состояние обеспечивает защиту неизменяемости, мы не рекомендуем использовать *разблокированное* состояние для любых целей, кроме краткосрочных испытаний функций. 

Когда политика хранения на основе времени применяется в контейнере, все большие двоичные объекты контейнера остаются в неизменяемом состоянии в течение *действующего* периода удержания. Эффективный период удержания капли равен разнице между **временем создания** капли и интервалом удержания, указанным пользователем. Так как пользователи могут расширять интервал удержания, функция хранения данных в неизменяемом виде будет использовать самое последнее его значение для вычисления периода эффективного удержания.

Например, предположим, что пользователь создает временную политику удержания с интервалом удержания в пять лет. Существующий капля в этом контейнере, _testblob1_, был создан год назад; таким образом, эффективный период удержания _testblob1_ составляет четыре года. Когда новая капля, _testblob2_, загружается в контейнер, эффективный период удержания для _testblob2_ составляет пять лет с момента его создания.

Разблокированная политика удержания на основе времени рекомендуется только для тестирования функций, и политика должна быть заблокирована, чтобы соответствовать SEC 17a-4(f) и другим нормативным требованиям. После блокировки политики удержания на основе времени политика не может быть удалена и допускается увеличение максимум на пять повышений до эффективного периода удержания.

Следующие ограничения применяются к политикам удержания:

- Для учетной записи хранилища максимальное количество контейнеров с заблокированными непреложными политиками на основе времени составляет 10 000.
- Минимальный интервал удержания составляет 1 день. Максимум 146 000 дней (400 лет).
- Для контейнера максимальное количество властных работ для расширения интервала удержания заблокированных непреложных политик на основе времени составляет 5.
- Для контейнера для заблокированной политики сохраняются не более семи журналов аудита политики удержания на основе времени.

### <a name="allow-protected-append-blobs-writes"></a>Разрешить защищенные капли приложения пишет

Капли приложений состоят из блоков данных и оптимизированы для операций приложений данных, необходимых для аудита и сценариев регистрации. По дизайну, приложения капли позволяют только добавление новых блоков в конце капли. Независимо от неизменности, модификация или удаление существующих блоков в приложении капля принципиально не допускается. Чтобы узнать больше о приложения капли, [см.](https://docs.microsoft.com/rest/api/storageservices/understanding-block-blobs--append-blobs--and-page-blobs#about-append-blobs)

Только политики удержания на `allowProtectedAppendWrites` основе времени имеют настройки, позволяющие записывать новые блоки в приложение blob, сохраняя при этом защиту неизменяемости и соответствие требованиям. Если включена, вы можете создать каплю приложения непосредственно в защищенном от политики контейнере и продолжать добавлять новые блоки данных в конце существующих капли приложений с помощью API *AppendBlock.* Можно добавлять только новые блоки и изменять или удалять любые существующие блоки. Защита от удержания времени по-прежнему применяется, предотвращая удаление капли приложения до истечения эффективного периода удержания. Включение этой настройки не влияет на неизменность поведения блок капли или страницы капли.

Поскольку эта настройка является частью политики удержания, основанной на времени, капли приложения по-прежнему остаются в неизменном состоянии в течение *всего периода эффективного* удержания. Поскольку новые данные могут быть приложены за пределы первоначального создания капли приложения, существует небольшая разница в том, как определяется период хранения. Эффективное удержание — это разница между **последним временем модификации** приложения и интервалом удержания, указанным пользователем. Аналогичным образом при интервале удержания неизменяемое хранилище использует последнее значение пользовательского интервала удержания для расчета эффективного периода удержания.

Например, предположим, что пользователь создает временную политику удержания с `allowProtectedAppendWrites` включенным интервалом в 90 дней. Приложение blob, _logblob1_, создается в контейнере сегодня, новые журналы продолжают добавляться в капло приложения в течение следующих 10 дней; Таким образом, эффективный период удержания для _logblob1_ составляет 100 дней с сегодняшнего дня (время его последнего приложения 90 дней).

Разблокированные политики удержания `allowProtectedAppendWrites` на основе времени позволяют в любое время быть включены и отключены. После блокировки политики удержания `allowProtectedAppendWrites` на основе времени параметр не может быть изменен.

Правовые политики `allowProtectedAppendWrites` удержания не могут позволить и любые юридические удержания сведут на нет свойство 'allowProtectedAppendWrites'. Если юридическое удержание применяется к временной политике удержания с `allowProtectedAppendWrites` включенным, API *AppendBlock* не сработает до тех пор, пока юридическое удержание не будет отменено.

## <a name="legal-holds"></a>Юридические удержания

Правовые удержания являются временными трюмами, которые могут быть использованы для целей судебного расследования или общей политики защиты. Каждая политика юридического удержания должна быть связана с одним или несколько тегами. Теги используются в качестве идентификатора, например идентификатора или события, для классификации и описания цели удержания.

Контейнер может иметь одновременно и юридическое удержание, и политику хранения на основе времени. Все большие двоичные объекты в этом контейнере остаются в неизменяемом состоянии, пока все юридические удержания не будут сняты, даже если период эффективного хранения истек. И наоборот, большой двоичный объект остается в неизменяемом состоянии до тех пор, пока не истечет период эффективного хранения, хотя все юридические удержания сняты.

Следующие ограничения применяются к юридическим трюмам:

- Для учетной записи хранилища максимальное количество контейнеров с юридическим параметром удержания составляет 10 000.
- Для контейнера максимальное количество тегов юридического удержания составляет 10.
- Минимальная длина юридического тега удержания составляет три буквеннумерских символа. Максимальная длина составляет 23 буквенно-цифровых символа.
- Для контейнера на время действия политики сохраняются не более 10 журналов аудита политики удержания юридических удержаний.

## <a name="scenarios"></a>Сценарии
В следующей таблице показаны типы операций хранения Blob, которые отключены для различных непреложных сценариев. Для получения дополнительной информации ознакомьтесь с документацией [API API API службы Azure Blob SERVICE.](https://docs.microsoft.com/rest/api/storageservices/blob-service-rest-api)

|Сценарий  |Состояние больших двоичных объектов  |Blob операций отказано  |Защита контейнеров и счетов
|---------|---------|---------|---------|
|Эффективный интервал удержания большого двоичного объекта еще не истек, и (или) установлено юридическое удержание     |Неизменяемость: защита от удаления и от записи         | Положите Blob<sup>1</sup>, Положить блок<sup>1</sup>, Положить блок Список<sup>1</sup>, Удалить контейнер, Удалить Blob, Установить Blob Метаданные, Положить страницу, Установить Blob Свойства, снимок Blob, Инкрементный Копия Blob, Приложение Блок<sup>2</sup>         |Удаление контейнера отклонено; Удаление учетной записи хранилища отклонено         |
|Эффективный интервал удержания на капле истек, и никаких юридических удержаний не установлено    |Защита только от записи (разрешены операции удаления)         |Положите Blob<sup>1</sup>, Положить блок<sup>1</sup>, Положить блок Список<sup>1</sup>, Установить Blob Метаданные, Положите страницу, Установить Blob Свойства, снимок Blob, Инкрементные Копия Blob, Приложение Блок<sup>2</sup>         |Удаление контейнера отказано, если по крайней мере 1 капля существует в защищенном контейнере; Удаление учетной записи хранилища отказано только для *заблокированных* политик, основанных на времени         |
|Нет worm политики применяется (без времени на основе удержания и не правовой тег удержания)     |Изменяемый         |None         |None         |

<sup>1</sup> Услуга blob позволяет этим операциям создать новую каплю один раз. Все последующие операции перезаписи на существующем пути капля в неизменяемом контейнере не допускаются.

<sup>2</sup> Блок приложения допускается только для политик удержания на основе времени с включенным свойством. `allowProtectedAppendWrites` Для получения дополнительной информации, [см.](#allow-protected-append-blobs-writes)

## <a name="pricing"></a>Цены

За использование этой функции не взимается дополнительная плата. Неизменяемые данные оцениваются так же, как и изменяемые данные. Подробную информацию о ценах на хранилище Azure Blob можно узнать на [странице ценообразования Azure Storage.](https://azure.microsoft.com/pricing/details/storage/blobs/)

## <a name="faq"></a>часто задаваемые вопросы

**Можете ли вы предоставить документацию о соответствии WORM?**

Да. Для документирования соответствия требованиям, Microsoft сохранила ведущую независимую оценочную фирму, которая специализируется на управлении записями и управлении информацией, Cohasset Associates, для оценки непреложного хранилища Blob и его соответствия требованиям, характерным для индустрии финансовых услуг. Cohasset подтвердил, что неизменяемое хранилище Blob, при использовании для хранения временных Blobs в состоянии WORM, отвечает соответствующим требованиям хранения правила CFTC 1.31(c)-d), правила FINRA 4511 и правила SEC 17a-4. Корпорация Майкрософт нацелила этот набор правил, поскольку они представляют собой наиболее предписывающее во всем мире руководство по хранению записей для финансовых учреждений. Отчет Cohasset доступен в [Центре доверия служб ы Майкрософт.](https://aka.ms/AzureWormStorage) Чтобы запросить у корпорации Майкрософт письмо с подтверждением соответствия неизменяемости WORM, пожалуйста, обратитесь в службу поддержки Azure.

**Имеет ли эта функция применяться только к блоку капли и приложения капли, или страницы капли, а?**

Неизменяемое хранилище можно использовать с любым типом капли, поскольку он установлен на уровне контейнеров, но мы рекомендуем использовать WORM для контейнеров, которые в основном хранят блок капли и капли приложения. Существующие капли в контейнере будут защищены недавно установленной политикой WORM. Но любые новые капли страницы должны быть созданы за пределами контейнера WORM, а затем скопированы дюйма После копирования в контейнерWORM, никаких дальнейших изменений в кабро страницы не допускается. Установка политики WORM на контейнере, который хранит VHDs (страницы blobs) для любых активных виртуальных машин не рекомендуется, поскольку он будет блокировать диск VM. Мы рекомендуем тщательно просмотреть документацию и проверить сценарии, прежде чем блокировать любые политики, основанные на времени.

**Нужно ли создавать новую учетную запись для хранения данных?**

Нет, вы можете использовать неизменяемое хранилище с любыми существующими или недавно созданными учетными записями v1 общего назначения, v2 общего назначения, BlobStorage или BlockBlobStorage. Учетные записи хранения v1 общего назначения поддерживаются, но мы рекомендуем перейти на общецелевой v2, чтобы вы могли воспользоваться преимуществами большего количества функций. Для получения информации об обновлении существующего общего назначения учетной записи хранения v1, [см.](../common/storage-account-upgrade.md)

**Могу ли я применить как юридическую политику удержания, так и временную политику удержания?**

Да, контейнер может иметь как легальный удержание, так и временную политику удержания в одно и то же время; однако параметр 'allowProtectedAppendWrites' не будет применяться до тех пор, пока юридический удержание не будет очищено. Все большие двоичные объекты в этом контейнере остаются в неизменяемом состоянии, пока все юридические удержания не будут сняты, даже если период эффективного хранения истек. И наоборот, большой двоичный объект остается в неизменяемом состоянии до тех пор, пока не истечет период эффективного хранения, хотя все юридические удержания сняты. 

**Являются ли правовые политики удержания только для судебного разбирательства или есть другие сценарии использования?**

Нет, Legal Hold — это просто общий термин, используемый для политики удержания, не основанной на времени. Он не должен использоваться только для судебных разбирательств. Политики legal Hold полезны для отключения перезаписи и удалены для защиты важных данных WORM предприятия, где период хранения неизвестен. Вы можете использовать его в качестве корпоративной политики для защиты критических рабочих нагрузок WORM или использовать его в качестве постановочной политики до того, как пользовательский триггер события требует использования политики удержания на основе времени. 

**Могу ли я удалить _заблокированную_ политику удержания или легальную удерживаемую часть на основе времени?**

Из контейнера можно удалить только разблокированные политики удержания на основе времени. После блокировки политики удержания на основе времени она не может быть удалена; допускаются только эффективные продления периода удержания. Теги правового удержания могут быть удалены. Когда все юридические теги удаляются, юридическое удержание удаляется.

**Что произойдет, если я попытаюсь удалить контейнер с политикой удержания или законным удержанием на основе времени?**

Операция Delete Container не сработает, если в контейнере существует хотя бы одна капля с заблокированной или разблокированной политикой удержания на основе времени или если контейнер имеет легальный удержание. Операция Delete Container будет успешной только в том случае, если в контейнере не существует капли и нет юридических удержаний. 

**Что произойдет, если я попытаюсь удалить учетную запись хранения с контейнером, который имеет временную политику удержания или законное удержание?**

Удаление учетной записи хранилища не удастся, если есть по крайней мере один контейнер с юридическим набором удержания или **заблокированной** политикой, основанной на времени. Контейнер с разблокированной временной политикой не защищает от удаления учетной записи хранилища. Вы должны удалить все законные удержания и удалить все **заблокированные** контейнеры, прежде чем вы сможете удалить учетную запись хранения. Сведения об удалении контейнера см. в предыдущем вопросе. Вы также можете применить дополнительные средства защиты от удаления для учетной записи хранения с [блокировками Azure Resource Manager.](../../azure-resource-manager/management/lock-resources.md)

**Могу ли я перемещать данные по разным уровням капли (горячий, прохладный, архив), когда капля находится в непреложном состоянии?**

Да, вы можете использовать команду Set Blob Tier для перемещения данных по уровням капли, сохраняя при этом данные в совместимом неизменном состоянии. Функция хранения данных в неизменяемом виде в хранилище поддерживается на горячем, холодном и архивном уровнях хранения больших двоичных объектов.

**Что произойдет, если не внести оплату, при том что срок интервала периода удержания еще не истек?**

В случае неоплаты будут применяться обычные правила хранения данных в соответствии с условиями, указанными в условиях вашего контракта с корпорацией Майкрософт. Для получения общей информации [см.](https://www.microsoft.com/en-us/trust-center/privacy/data-management) 

**Предлагаете ли вы пробный или льготный период, чтобы просто попробовать эту функцию?**

Да. При создании политики удержания на основе времени, она находится в *незаблокированном* состоянии. В этом состоянии можно вносить любые нужные изменения, например увеличение или уменьшение, и даже удаление политики. После блокировки политика остается заблокированной до истечения периода удержания. Эта заблокированная политика предотвращает удаление и изменение интервала удержания. Мы настоятельно рекомендуем использовать *разблокированное* состояние только для пробных целей и заблокировать политику в течение 24 часов, чтобы не подвергать риску соответствие требованиям SEC 17a-4(f) и другим нормам.

**Могу ли я использовать мягкое удаление наряду с политиками Immutable blob?**

Да, если ваши требования соответствия позволяют удалить мягкое удаление. [Мягкое удаление для хранения Azure Blob](storage-blob-soft-delete.md) применяется для всех контейнеров в учетной записи хранения, независимо от легальной политики удержания или времени хранения. Мы рекомендуем включить мягкое удаление для дополнительной защиты, прежде чем будут применены и подтверждены какие-либо непреложные политики WORM.

## <a name="next-steps"></a>Дальнейшие действия

- [Установка и управление политиками неизменяемости для хранения Blob](storage-blob-immutability-policies-manage.md)
- [Установите правила для автоматического уровня и удаления данных капли с управлением жизненным циклом](storage-lifecycle-management-concepts.md)
- [Soft delete for Azure Storage blobs](../blobs/storage-blob-soft-delete.md) (Обратимое удаление больших двоичных объектов службы хранилища Azure)
- [Защита подписок, групп ресурсов и ресурсов с блокировками azure Resource Manager.](../../azure-resource-manager/management/lock-resources.md)
