---
title: Настройка анонимного общего доступа на чтение для контейнеров и больших двоичных объектов
titleSuffix: Azure Storage
description: Узнайте, как включить или отключить анонимный доступ к данным большого двоичного объекта для учетной записи хранения. Установите параметр общего доступа к контейнеру, чтобы сделать контейнеры и большие двоичные объекты доступными для анонимного доступа.
services: storage
author: tamram
ms.service: storage
ms.topic: how-to
ms.date: 06/29/2020
ms.author: tamram
ms.reviewer: fryu
ms.openlocfilehash: af589874021baaf04a423b7bbaa0e36528eda93c
ms.sourcegitcommit: 3541c9cae8a12bdf457f1383e3557eb85a9b3187
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/09/2020
ms.locfileid: "86209938"
---
# <a name="configure-anonymous-public-read-access-for-containers-and-blobs"></a>Настройка анонимного общего доступа на чтение для контейнеров и больших двоичных объектов

Служба хранилища Azure поддерживает анонимный открытый доступ на чтение для контейнеров и больших двоичных объектов. По умолчанию все запросы к контейнеру и его BLOB-объектам должны быть авторизованы с помощью Azure Active Directory (Azure AD) или авторизации общего ключа. При настройке параметра общего уровня доступа контейнера для разрешения анонимного доступа клиенты могут считывать данные в этом контейнере без авторизации запроса.

> [!WARNING]
> Если контейнер настроен для общего доступа, любой клиент может считывать данные в этом контейнере. Общий доступ представляет потенциальную угрозу безопасности, поэтому если ваш сценарий не требует его, корпорация Майкрософт рекомендует отключить ее для учетной записи хранения. Дополнительные сведения см. [в разделе Предотвращение анонимного общего доступа на чтение к контейнерам и BLOB-объектам](anonymous-read-access-prevent.md).

Чтобы настроить общий доступ для контейнера, необходимо выполнить два действия.

1. Включение общего доступа для учетной записи хранения
1. Настройка параметра общего доступа контейнера

В этой статье описывается, как настроить анонимный открытый доступ на чтение для контейнера и его больших двоичных объектов. Сведения о анонимном доступе к данным большого двоичного объекта из клиентского приложения см. в статье [доступ к открытым контейнерам и BLOB-объектам анонимно с помощью .NET](anonymous-read-access-client.md).

## <a name="enable-or-disable-public-read-access-for-a-storage-account"></a>Включение или отключение общего доступа на чтение для учетной записи хранения

По умолчанию общий доступ включен для учетной записи хранения. Отключение общего доступа предотвращает анонимный доступ к контейнерам и BLOB-объектам в этой учетной записи. Для повышения безопасности корпорация Майкрософт рекомендует отключить общий доступ к учетным записям хранения, если для вашего сценария требуется анонимный доступ пользователей к ресурсам большого двоичного объекта.

> [!WARNING]
> Отключение общего доступа для учетной записи хранения переопределяет параметры общего доступа для всех контейнеров в этой учетной записи хранения. Если для учетной записи хранения отключен общий доступ, все будущие анонимные запросы к этой учетной записи завершатся ошибкой.

Чтобы включить или отключить общий доступ для учетной записи хранения, используйте портал Azure или Azure CLI, чтобы настроить свойство **блобпубликакцесс** учетной записи. Это свойство доступно для всех учетных записей хранения, созданных с помощью модели развертывания Azure Resource Manager. Дополнительные сведения см. в разделе [Общие сведения об учетной записи хранения](../common/storage-account-overview.md).

# <a name="azure-portal"></a>[Портал Azure](#tab/portal)

Чтобы включить или отключить общий доступ для учетной записи хранения в портал Azure, выполните следующие действия.

1. Войдите в свою учетную запись хранения на портале Azure.
1. Выберите параметр **конфигурации** в разделе **Параметры**.
1. Установите для **общего доступа к BLOB-объекту** значение **отключено** или **включено**.

    :::image type="content" source="media/anonymous-read-access-configure/blob-public-access-portal.png" alt-text="Снимок экрана, показывающий, как включить или отключить общий доступ к BLOB для учетной записи":::

# <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

Чтобы включить или отключить общий доступ к учетной записи хранения с Azure CLI, сначала получите идентификатор ресурса для своей учетной записи хранения, вызвав команду [AZ Resource-шоу](/cli/azure/resource#az-resource-show) . Затем вызовите команду [AZ Resource Update](/cli/azure/resource#az-resource-update) , чтобы задать свойство **алловблобпубликакцесс** для учетной записи хранения. Чтобы включить общий доступ, присвойте свойству **алловблобпубликакцесс** значение true. Чтобы отключить, присвойте ему значение **false**.

В следующем примере отключается открытый доступ к большому двоичному объекту для учетной записи хранения. Не забудьте заменить значения заполнителей в квадратных скобках собственными значениями:

```azurecli-interactive
storage_account_id=$(az resource show \
    --name anonpublicaccess \
    --resource-group storagesamples-rg \
    --resource-type Microsoft.Storage/storageAccounts \
    --query id \
    --output tsv)

az resource update \
    --ids $storage_account_id \
    --set properties.allowBlobPublicAccess=false
    ```
```

Чтобы проверить, включен ли общий доступ с Azure CLI, вызовите команду [AZ Resource-шоу](/cli/azure/resource#az-resource-show) и выполните запрос для свойства **алловблобпубликакцесс** :

```azurecli-interactive
az resource show \
    --name <storage-account> \
    --resource-group <resource-group> \
    --resource-type Microsoft.Storage/storageAccounts \
    --query properties.allowBlobPublicAccess \
    --output tsv
```

---

> [!NOTE]
> Отключение общего доступа для учетной записи хранения не влияет на статические веб-сайты, размещенные в этой учетной записи хранения. Контейнер **$Web** всегда является общедоступным.

## <a name="check-the-public-access-setting-for-a-storage-account"></a>Проверка параметра общего доступа для учетной записи хранения

Чтобы проверить параметр общего доступа для учетной записи хранения, получите значение свойства **алловблобпубликакцесс** . Чтобы проверить это свойство для большого числа учетных записей хранения одновременно, используйте обозреватель графов ресурсов Azure.

Свойство **алловблобпубликакцесс** не задано по умолчанию и не возвращает значение, пока оно не будет явно задано. Учетная запись хранения по умолчанию позволяет разрешить общий доступ, если свойство имеет значение null.

### <a name="check-the-public-access-setting-for-a-single-storage-account"></a>Проверка параметра общего доступа для одной учетной записи хранения

Чтобы проверить параметр общего доступа для отдельной учетной записи хранения с помощью Azure CLI, вызовите команду [AZ Resource-шоу](/cli/azure/resource#az-resource-show) и выполните запрос для свойства **алловблобпубликакцесс** :

```azurecli-interactive
az resource show \
    --name <storage-account> \
    --resource-group <resource-group> \
    --resource-type Microsoft.Storage/storageAccounts \
    --query properties.allowBlobPublicAccess \
    --output tsv
```

### <a name="check-the-public-access-setting-for-a-set-of-storage-accounts"></a>Проверьте параметр общего доступа для набора учетных записей хранения.

Чтобы проверить настройку общего доступа в наборе учетных записей хранения с оптимальной производительностью, можно использовать обозреватель графа ресурсов Azure в портал Azure. Дополнительные сведения об использовании обозревателя графа ресурсов см. в статье [Краткое руководство. выполнение первого запроса Graph в Azure с помощью обозревателя Graph](/azure/governance/resource-graph/first-query-portal).

При выполнении следующего запроса в обозревателе графа ресурсов возвращается список учетных записей хранения и отображается значение свойства **алловблобпубликакцесс** для каждой учетной записи.

```kusto
resources
| where type =~ 'Microsoft.Storage/storageAccounts'
| extend allowBlobPublicAccess = parse_json(properties).allowBlobPublicAccess
| project subscriptionId, resourceGroup, name, allowBlobPublicAccess
| order by subscriptionId, resourceGroup, name asc
```

## <a name="set-the-public-access-level-for-a-container"></a>Установка общего уровня доступа для контейнера

Чтобы предоставить анонимным пользователям доступ на чтение контейнера и его больших двоичных объектов, сначала включите общий доступ к учетной записи хранения, а затем установите уровень общего доступа контейнера. Если для учетной записи хранения отключен общий доступ, вы не сможете настроить общий доступ для контейнера.

Если для учетной записи хранения включен общий доступ, можно настроить контейнер со следующими разрешениями.

- **Нет общего доступа для чтения:** Доступ к контейнеру и его BLOB-объектам можно получить только с помощью полномочного запроса. Этот параметр используется по умолчанию для всех новых контейнеров.
- **Общий доступ на чтение только для больших двоичных объектов:** Большие двоичные объекты в контейнере могут считываться анонимным запросом, но данные контейнера недоступны анонимно. Анонимные клиенты не могут перечислять большие двоичные объекты внутри контейнера.
- **Общий доступ на чтение для контейнера и его больших двоичных объектов:** Данные контейнера и BLOB-объекта могут считываться анонимным запросом, за исключением параметров разрешений контейнера и метаданных контейнера. Клиенты могут перечислять большие двоичные объекты внутри контейнера с помощью анонимного запроса, но не могут перечислять контейнеры в учетной записи хранения.

Нельзя изменить общий уровень доступа для отдельного большого двоичного объекта. Уровень общего доступа задается только на уровне контейнера.

Чтобы задать общий уровень доступа контейнера, используйте портал Azure или Azure CLI. Можно задать общий уровень доступа контейнера при создании контейнера или обновить этот параметр в существующем контейнере.

# <a name="azure-portal"></a>[Портал Azure](#tab/portal)

Чтобы обновить общий уровень доступа для одного или нескольких существующих контейнеров в портал Azure, выполните следующие действия.

1. Перейдите к обзору учетной записи хранения в портал Azure.
1. В разделе **Служба BLOB-объектов** в колонке меню выберите **контейнеры**.
1. Выберите контейнеры, для которых необходимо задать общий уровень доступа.
1. Используйте кнопку **изменить уровень доступа** , чтобы отобразить параметры общего доступа.
1. Выберите нужный уровень общего доступа в раскрывающемся списке **общедоступный уровень доступа** и нажмите кнопку ОК, чтобы применить изменения к выбранным контейнерам.

    ![Снимок экрана, на котором показано, как настроить уровень общего доступа на портале](./media/anonymous-read-access-configure/configure-public-access-container.png)

Если для учетной записи хранения отключен общий доступ, невозможно установить уровень общего доступа контейнера. Если вы попытаетесь задать общий уровень доступа контейнера, вы увидите, что этот параметр отключен, так как для этой учетной записи запрещен общий доступ.

:::image type="content" source="media/anonymous-read-access-configure/container-public-access-blocked.png" alt-text="Снимок экрана, показывающий, что параметр "общий доступ к контейнеру" заблокирован, если общий доступ отключен":::

# <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

Чтобы обновить общий уровень доступа для одного или нескольких контейнеров с Azure CLI, вызовите команду [AZ Storage Container Set Permission](/cli/azure/storage/container#az-storage-container-set-permission) . Авторизовать эту операцию, передав ключ учетной записи, строку подключения или подписанный URL-адрес (SAS). Операция [Set Container ACL](/rest/api/storageservices/set-container-acl) , которая задает общий уровень доступа контейнера, не поддерживает авторизацию в Azure AD. Дополнительные сведения см. в разделе [разрешения на вызов операций с данными большого двоичного объекта и очереди](/rest/api/storageservices/authorize-with-azure-active-directory#permissions-for-calling-blob-and-queue-data-operations).

В следующем примере задается параметр общего доступа для контейнера, чтобы разрешить анонимный доступ к контейнеру и его BLOB-объектам. Не забудьте заменить значения заполнителей в квадратных скобках собственными значениями:

```azurecli-interactive
az storage container set-permission \
    --name <container-name> \
    --account-name <account-name> \
    --public-access container \
    --account-key <account-key> \
    --auth-mode key
```

Если для учетной записи хранения отключен общий доступ, невозможно установить уровень общего доступа контейнера. При попытке задать общий уровень доступа контейнера возникает ошибка, указывающая, что общий доступ не разрешен для учетной записи хранения.

---

## <a name="check-the-container-public-access-setting"></a>Проверка параметра общего доступа к контейнеру

Чтобы проверить параметр общего доступа для одного или нескольких контейнеров, можно использовать портал Azure, PowerShell, Azure CLI, одну из клиентских библиотек службы хранилища Azure или поставщик ресурсов хранилища Azure. В следующих разделах приведено несколько примеров.  

### <a name="check-the-public-access-setting-for-a-single-container"></a>Проверка параметра общего доступа для одного контейнера

Чтобы получить общий уровень доступа для одного или нескольких контейнеров с Azure CLI, вызовите команду [AZ Storage Container показывать разрешение](/cli/azure/storage/container#az-storage-container-show-permission) . Авторизовать эту операцию, передав ключ учетной записи, строку подключения или подписанный URL-адрес (SAS). Операция [получения списка ACL контейнера](/rest/api/storageservices/get-container-acl) , возвращающая общий уровень доступа контейнера, не поддерживает авторизацию в Azure AD. Дополнительные сведения см. в разделе [разрешения на вызов операций с данными большого двоичного объекта и очереди](/rest/api/storageservices/authorize-with-azure-active-directory#permissions-for-calling-blob-and-queue-data-operations).

В следующем примере считывается параметр общего доступа для контейнера. Не забудьте заменить значения заполнителей в квадратных скобках собственными значениями:

```azurecli-interactive
az storage container show-permission \
    --name <container-name> \
    --account-name <account-name> \
    --account-key <account-key>
    --auth-mode key
```

### <a name="check-the-public-access-setting-for-a-set-of-containers"></a>Проверьте параметр общего доступа для набора контейнеров.

Можно проверить, какие контейнеры в одной или нескольких учетных записях хранения настроены для общего доступа, выполнив список контейнеров и проверив параметры общего доступа. Этот подход является практичным вариантом, если учетная запись хранения не содержит большое количество контейнеров или при проверке параметра по небольшому числу учетных записей хранения. Однако производительность может снизиться при попытке перечисления большого количества контейнеров.

В следующем примере PowerShell используется для получения параметра общего доступа для всех контейнеров в учетной записи хранения. Не забудьте заменить значения заполнителей в квадратных скобках собственными значениями:

```powershell
$rgName = "<resource-group>"
$accountName = "<storage-account>"

$storageAccount = Get-AzStorageAccount -ResourceGroupName $rgName -Name $accountName
$ctx = $storageAccount.Context

Get-AzStorageContainer -Context $ctx | Select Name, PublicAccess
```

## <a name="next-steps"></a>Дальнейшие действия

- [Запретить анонимный общий доступ на чтение к контейнерам и BLOB-объектам](anonymous-read-access-prevent.md)
- [Анонимный доступ к открытым контейнерам и BLOB-объектам с помощью .NET](anonymous-read-access-client.md)
- [Авторизация доступа к службе хранилища Azure](../common/storage-auth.md)