---
title: Включение открытого доступа на чтение к контейнерам и большим двоичным объектам в хранилище BLOB-объектов Azure | Документация Майкрософт
description: Узнайте, как сделать контейнеры и большие двоичные объекты доступными для анонимного доступа и как осуществлять к ним программный доступ.
services: storage
author: tamram
ms.service: storage
ms.topic: article
ms.date: 04/30/2019
ms.author: tamram
ms.reviewer: cbrooks
ms.openlocfilehash: e0f93b0a95a228b26fae266129aea4b595b05e0f
ms.sourcegitcommit: f6ba5c5a4b1ec4e35c41a4e799fb669ad5099522
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65148358"
---
# <a name="manage-anonymous-read-access-to-containers-and-blobs"></a>Управление анонимным доступом на чтение к контейнерам и большим двоичным объектам

Можно включить анонимный открытый доступ на чтение к контейнеру и его большим двоичным объектам в хранилище BLOB-объектов Azure. Таким образом можно предоставить доступ только для чтения к этим ресурсам, не передавая ключ учетной записи и не требуя подписанного URL-адреса (SAS).

Открытый доступ на чтение лучше всего подходит для сценариев, когда определенные большие двоичные объекты нужно сделать всегда доступными для анонимного доступа на чтение. Для более точного контроля можно создать подписанный URL-адрес. Подписанные URL-адреса позволяют предоставить ограниченный доступ с различными разрешениями на определенный период времени. Дополнительные сведения о создании подписанных URL-адресов см. в статье [Использование подписанных URL-адресов (SAS)](../common/storage-dotnet-shared-access-signature-part-1.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json).

## <a name="grant-anonymous-users-permissions-to-containers-and-blobs"></a>Предоставление анонимным пользователям разрешений для контейнеров и больших двоичных объектов

По умолчанию контейнер и все большие двоичные объекты в ней может осуществляться только пользователем, который соответствующие разрешения. Чтобы предоставить анонимным пользователям доступ для чтения контейнера и его большим двоичным объектам, можно задать уровень общего доступа контейнера. Когда вы предоставляете общий доступ к контейнеру, анонимные пользователи могут считывать большие двоичные объекты в контейнере общедоступной без авторизации запроса.

Можно настроить контейнер со следующими разрешениями:

* **Без общего доступа для чтения.** Контейнер и его большим двоичным объектам может осуществляться только владельцем учетной записи хранения. Это способ доступа по умолчанию для всех новых контейнеров.
* **Общий доступ для чтения только больших двоичных объектов:** Большие двоичные объекты в контейнере могут считываться с помощью анонимного запроса, но данные контейнера недоступны. Анонимные клиенты не могут перечислять большие двоичные объекты внутри контейнера.
* **Общий доступ на чтение для контейнера и его большим двоичным объектам:** Все данные контейнера и BLOB-объектов могут считываться с помощью анонимного запроса. Клиенты могут перечислять большие двоичные объекты внутри контейнера с помощью анонимного запроса, но не могут перечислять контейнеры в учетной записи хранения.

Чтобы установить разрешения для контейнера, можно использовать:

* [портал Azure](https://portal.azure.com)
* [Azure PowerShell](../common/storage-powershell-guide-full.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json)
* [Интерфейс командной строки Azure](../common/storage-azure-cli.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json#create-and-manage-blobs)
* программный метод с помощью одной из клиентских библиотек службы хранилища или REST API.

### <a name="set-container-public-access-level-in-the-azure-portal"></a>Настройка уровня общего доступа контейнера на портале Azure

Из [портала Azure](https://portal.azure.com), вы можете обновить уровень общего доступа для одного или нескольких контейнеров:

1. Войдите в свою учетную запись хранения на портале Azure.
1. В разделе **служба BLOB-объектов** в колонке меню, выберите **большие двоичные объекты**.
1. Выберите контейнеры, для которых вы хотите задать уровень общего доступа.
1. Используйте **изменение уровня доступа** кнопку, чтобы открыть параметры общего доступа.
1. Выберите требуемый общедоступный уровень доступа из **уровня общего доступа** раскрывающегося списка и нажмите кнопку "ОК" для применения изменений в выбранном контейнере.

Снимке экрана ниже показано, как изменить уровень общего доступа для выбранных контейнеров.

![Снимок экрана, показывающий, как задать уровень общего доступа на портале](./media/storage-manage-access-to-resources/storage-manage-access-to-resources-0.png)

> [!NOTE]
> Невозможно изменить уровень общего доступа для отдельных больших двоичных объектов. Уровень общего доступа устанавливается только на уровне контейнера.

### <a name="set-container-public-access-level-with-net"></a>Задать уровня общего доступа контейнера с помощью .NET

Чтобы задать разрешения для контейнера с помощью C# и клиентской библиотеки службы хранилища для .NET, сначала нужно получить существующие разрешения контейнера, вызвав метод **GetPermissions**. Затем задайте свойство **PublicAccess** для объекта **BlobContainerPermissions**, который возвращается методом **GetPermissions**. Наконец, вызовите метод **SetPermissions** с обновленными разрешениями.

В следующем примере задаются разрешения контейнера на полный общий доступ на чтение. Чтобы задать общий доступ на чтение только для BLOB-объектов, задайте для свойства **PublicAccess** значение **BlobContainerPublicAccessType.Blob**. Чтобы удалить все разрешения для анонимных пользователей, задайте для этого свойства значение **BlobContainerPublicAccessType.Off**.

```csharp
public static void SetPublicContainerPermissions(CloudBlobContainer container)
{
    BlobContainerPermissions permissions = container.GetPermissions();
    permissions.PublicAccess = BlobContainerPublicAccessType.Container;
    container.SetPermissions(permissions);
}
```

## <a name="access-containers-and-blobs-anonymously"></a>Анонимный доступ к контейнерам и большим двоичным объектам

Клиент, который обращается к контейнерам и большим двоичным объектам анонимно, может использовать конструкторы, не требующие учетных данных. Ниже приведены примеры несколько разных способов для ссылки на контейнеры и большие двоичные объекты анонимно.

### <a name="create-an-anonymous-client-object"></a>Создание анонимного клиентского объекта

Можно создать новый объект клиента службы для анонимного доступа, предоставляя конечную точку хранилища BLOB-объектов для учетной записи. Тем не менее необходимо также знать имя контейнера в этой учетной записи, которая доступна для анонимного доступа.

```csharp
public static void CreateAnonymousBlobClient()
{
    // Create the client object using the Blob storage endpoint.
    CloudBlobClient blobClient = new CloudBlobClient(new Uri(@"https://storagesample.blob.core.windows.net"));

    // Get a reference to a container that's available for anonymous access.
    CloudBlobContainer container = blobClient.GetContainerReference("sample-container");

    // Read the container's properties. Note this is only possible when the container supports full public read access.
    container.FetchAttributes();
    Console.WriteLine(container.Properties.LastModified);
    Console.WriteLine(container.Properties.ETag);
}
```

### <a name="reference-a-container-anonymously"></a>Анонимная ссылка на контейнер

При наличии URL-адреса контейнера, который доступен анонимно, можно воспользоваться им для прямой ссылки на контейнер.

```csharp
public static void ListBlobsAnonymously()
{
    // Get a reference to a container that's available for anonymous access.
    CloudBlobContainer container = new CloudBlobContainer(new Uri(@"https://storagesample.blob.core.windows.net/sample-container"));

    // List blobs in the container.
    foreach (IListBlobItem blobItem in container.ListBlobs())
    {
        Console.WriteLine(blobItem.Uri);
    }
}
```

### <a name="reference-a-blob-anonymously"></a>Анонимная ссылка на большой двоичный объект

Если имеется URL-адрес большого двоичного объекта, который доступен для анонимного доступа, можно создать прямую ссылку на этот большой двоичный объект, используя URL-адрес.

```csharp
public static void DownloadBlobAnonymously()
{
    CloudBlockBlob blob = new CloudBlockBlob(new Uri(@"https://storagesample.blob.core.windows.net/sample-container/logfile.txt"));
    blob.DownloadToFile(@"C:\Temp\logfile.txt", System.IO.FileMode.Create);
}
```

## <a name="features-available-to-anonymous-users"></a>Функции, доступные анонимным пользователям

В следующей таблице показано, какие операции могут вызываться анонимно при настройке контейнера для общего доступа.

| Операция REST | Общий доступ на чтение к контейнеру | Общий доступ на чтение только больших двоичных объектов |
| --- | --- | --- |
| Перечисление контейнеров | Только авторизованные запросы | Только авторизованные запросы |
| Create Container (Создание контейнера) | Только авторизованные запросы | Только авторизованные запросы |
| Get Container Properties (Получение свойств контейнера) | Анонимных запросов, разрешенных | Только авторизованные запросы |
| Get Container Metadata (Получение метаданных контейнера) | Анонимных запросов, разрешенных | Только авторизованные запросы |
| Set Container Metadata (Определение метаданных контейнера) | Только авторизованные запросы | Только авторизованные запросы |
| Get Container ACL (Получение списка управления доступом для контейнера) | Только авторизованные запросы | Только авторизованные запросы |
| Set Container ACL (Задание списка управления доступом для контейнера) | Только авторизованные запросы | Только авторизованные запросы |
| Delete Container (Удаление контейнера) | Только авторизованные запросы | Только авторизованные запросы |
| List Blobs (Отображение списка BLOB-объектов) | Анонимных запросов, разрешенных | Только авторизованные запросы |
| Put BLOB (Вставка BLOB-объекта) | Только авторизованные запросы | Только авторизованные запросы |
| Get BLOB (Получение BLOB-объекта) | Анонимных запросов, разрешенных | Анонимных запросов, разрешенных |
| Get BLOB Properties (Получение свойств BLOB-объекта) | Анонимных запросов, разрешенных | Анонимных запросов, разрешенных |
| Set BLOB Properties (Задание свойств службы BLOB-объекта) | Только авторизованные запросы | Только авторизованные запросы |
| Get BLOB Metadata (Получение метаданных BLOB-объекта) | Анонимных запросов, разрешенных | Анонимных запросов, разрешенных |
| Set BLOB Metadata (Задание метаданных BLOB-объекта) | Только авторизованные запросы | Только авторизованные запросы |
| Put Block (Вставка блокировки) | Только авторизованные запросы | Только авторизованные запросы |
| Получение списка блоков (только зафиксированные блоки) | Анонимных запросов, разрешенных | Анонимных запросов, разрешенных |
| Получение списка блоков (только незафиксированные блоки или все блоки) | Только авторизованные запросы | Только авторизованные запросы |
| Put Block List (Вставка списка блокировки) | Только авторизованные запросы | Только авторизованные запросы |
| Delete BLOB (Удаление BLOB-объекта) | Только авторизованные запросы | Только авторизованные запросы |
| Копирование BLOB-объекта | Только авторизованные запросы | Только авторизованные запросы |
| Создание моментального снимка большого двоичного объекта | Только авторизованные запросы | Только авторизованные запросы |
| Lease Blob (Аренда BLOB-объекта) | Только авторизованные запросы | Только авторизованные запросы |
| Put Page (Вставка страницы) | Только авторизованные запросы | Только авторизованные запросы |
| Get Page Ranges (Получение диапазона страницы) | Анонимных запросов, разрешенных | Анонимных запросов, разрешенных |
| Добавление больших двоичных объектов | Только авторизованные запросы | Только авторизованные запросы |

## <a name="next-steps"></a>Дальнейшие действия

* [Авторизация для служб хранилища Azure](https://docs.microsoft.com/rest/api/storageservices/authorization-for-the-azure-storage-services)
* [Использование подписанных URL-адресов (SAS)](../common/storage-dotnet-shared-access-signature-part-1.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json)