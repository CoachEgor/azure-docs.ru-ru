---
title: Общие сведения о страничных BLOB-объектах Azure | Документация Майкрософт
description: Общие сведения о страничных BLOB-объектах Azure и их преимуществах, включая варианты использования с примерами сценариев.
services: storage
author: tamram
ms.service: storage
ms.topic: article
ms.date: 05/13/2019
ms.author: tamram
ms.reviewer: wielriac
ms.subservice: blobs
ms.openlocfilehash: 060e1d01e5f078bad9852ae35d0af9142192a7b6
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "68985623"
---
# <a name="overview-of-azure-page-blobs"></a>Общие сведения о страничных BLOB-объектах Azure

Служба хранилища Azure предлагает три типа хранилища BLOB-объектов: блочные, добавочные и страничные BLOB-объекты. Блочные BLOB-объекты состоят из блоков и идеально подходят для хранения текстовых или двоичных файлов, а также для эффективной передачи больших файлов. Добавочные большие двоичные объекты также состоят из блоков, но они оптимизированы для операций добавления и поэтому полезны для сценариев ведения журнала. Страничные BLOB-объекты состоят из 512-байтовых страниц, общий размер которых не превышает 8 ТБ, и создаются для частых произвольных операций чтения и записи. Страничные BLOB-объекты являются основой дисков IaaS Azure. В этой статье рассматриваются возможности и преимущества страничных BLOB-объектов.

Страничные BLOB-объекты — это коллекция 512-байтовых страниц, которые предоставляют возможность чтения и записи произвольных диапазонов байтов. Таким образом, страничные BLOB-объекты идеально подходят для хранения структур данных на основе индексов и разреженных структур данных, таких как диски ОС и диски данных для виртуальных машин и баз данных. Например, в базе данных SQL Azure страничные BLOB-объекты используются в качестве базового постоянного хранилища для баз данных. Более того, страничные BLOB-объекты также часто используются для файлов с обновлениями на основе диапазонов.  

Основные возможности страничных BLOB-объектов Azure: интерфейс REST, устойчивость базового хранилища и возможности эффективной миграции в Azure. Подробнее эти возможности рассматриваются в следующем разделе. Кроме того, страничные BLOB-объекты Azure сейчас поддерживаются в хранилищах двух типов: класса Premium и Standard. Premium Storage разработан специально для рабочих нагрузок, требующих постоянной высокой производительности и низкой задержки, что делает капли премиум-страниц идеально подходит для сценариев хранения высокой производительности. Стандартные учетные записи хранения являются более рентабельными для выполнения нечувствительных к задержкам рабочих нагрузок.

## <a name="sample-use-cases"></a>Примеры вариантов использования

Рассмотрим несколько вариантов использования страничных BLOB-объектов, начиная с дисков IaaS Azure. Страничные BLOB-объекты Azure — это основа платформы виртуальных дисков IaaS Azure. Диски ОС и диски данных Azure реализуются как виртуальные диски, где данные надежно хранятся на платформе службы хранилища Azure, а затем доставляются на виртуальные машины для достижения максимальной производительности. Диски Azure хранятся в [формате VHD](https://technet.microsoft.com/library/dd979539.aspx) Hyper-V и в виде [страничного BLOB-объекта](/rest/api/storageservices/Understanding-Block-Blobs--Append-Blobs--and-Page-Blobs#about-page-blobs) в службе хранилища Azure. Помимо использования виртуальных дисков для виртуальных машин IaaS Azure, страничные BLOB-объекты также поддерживают сценарии PaaS и DBaaS, например службу базы данных SQL Azure, в которой сейчас эти объекты используются для хранения данных SQL, обеспечивая выполнение произвольных операций чтения и записи для базы данных. Еще один пример: при использовании службы PaaS для общего доступа к мультимедиа для приложений совместного редактирования видео страничные BLOB-объекты обеспечивают быстрый доступ к произвольным расположениям в мультимедиа. Они также предоставляют возможность нескольким пользователям быстро и эффективно редактировать и объединять одно и то же мультимедиа. 

Корпорация Майкрософт в своих основных службах, таких как Azure Site Recovery и Azure Backup, а также многие сторонние разработчики реализовали ведущие в отрасли инновационные возможности с помощью интерфейса REST страничного BLOB-объекта. Ниже приведены уникальные сценарии, реализованные в Azure. 

* Управление добавочными моментальными снимками, направляемыми приложением. С помощью моментальных снимков страничного BLOB-объекта и интерфейсов REST API приложения могут сохранять контрольные точки приложения без дорогостоящего дублирования данных. Служба хранилища Azure поддерживает локальные моментальные снимки для страничных BLOB-объектов, для которых не требуется копирование всего BLOB-объекта. Общедоступные API-интерфейсы этих моментальных снимков также обеспечивают доступ к разностным данным между моментальными снимками и их копирование.
* Прямая миграция приложений и данных из помещений в облако: Копировать данные о помещениях и использовать АДИ REST для записи непосредственно на кабро страницы Azure, в то время как в помещениях VM продолжает работать. После этого вы можете быстро выполнить отработку отказа на виртуальную машину Azure с использованием этих данных. Таким образом, вы можете перенести свои виртуальные визы и виртуальные диски из помещений в облако с минимальным временем простоя, так как миграция данных происходит в фоновом режиме, в то время как вы продолжаете использовать VM, и время простоя, необходимое для сбоя, будет коротким (в минутах).
* Общий доступ [на основе SAS](../common/storage-sas-overview.md), который позволяет выполнять сценарии, такие как несколько читателей и один писатель с поддержкой управления параллелизмом.

## <a name="page-blob-features"></a>Возможности страничных BLOB-объектов

### <a name="rest-api"></a>REST API

Чтобы приступить к разработке с использованием страничных BLOB-объектов, см. статью [Краткое руководство по передаче, скачиванию и составлению списка больших двоичных объектов с помощью .NET](storage-dotnet-how-to-use-blobs.md). Например, рассмотрим получение доступа к страничным BLOB-объектам с помощью клиентской библиотеки хранилища для .NET. 

На следующей схеме изображены общие связи между учетной записью, контейнерами и страничными BLOB-объектами.

![Скриншот, показывающий отношения между учетной записью, контейнерами и каплями страниц](./media/storage-blob-pageblob-overview/storage-blob-pageblob-overview-figure1.png)

#### <a name="creating-an-empty-page-blob-of-a-specified-size"></a>Создание пустого страничного BLOB-объекта указанного размера

Для создания страничного BLOB-объекта сначала создается объект **CloudBlobClient** с базовым URI доступа к хранилищу BLOB-объектов для вашей учетной записи хранения (*pbaccount* на рис. 1) и объектом **StorageCredentialsAccountAndKey**, как показано в приведенном ниже примере. В примере демонстрируется создание ссылки на объект **CloudBlobContainer**, а затем создание контейнера (*testvhds*), если он еще не существует. После этого с помощью объекта **CloudBlobContainer** следует создать ссылку на объект **CloudPageBlob**, указав имя страничного BLOB-объекта (os4.vhd), к которому необходимо получить доступ. Чтобы создать каплю страницы, позвоните [в CloudPageBlob.Create](/dotnet/api/microsoft.azure.storage.blob.cloudpageblob.create), пройдя в максимальном размере для создания капли. Этот размер (*blobSize*) должен быть кратен 512 байтам.

```csharp
using Microsoft.Azure;
using Microsoft.Azure.Storage;
using Microsoft.Azure.Storage.Blob;

long OneGigabyteAsBytes = 1024 * 1024 * 1024;
// Retrieve storage account from connection string.
CloudStorageAccount storageAccount = CloudStorageAccount.Parse(
    CloudConfigurationManager.GetSetting("StorageConnectionString"));

// Create the blob client.
CloudBlobClient blobClient = storageAccount.CreateCloudBlobClient();

// Retrieve a reference to a container.
CloudBlobContainer container = blobClient.GetContainerReference("testvhds");

// Create the container if it doesn't already exist.
container.CreateIfNotExists();

CloudPageBlob pageBlob = container.GetPageBlobReference("os4.vhd");
pageBlob.Create(16 * OneGigabyteAsBytes);
```

#### <a name="resizing-a-page-blob"></a>Изменение размера страничного BLOB-объекта

Чтобы изменить размер капли страницы после создания, используйте метод [Resize.](/dotnet/api/microsoft.azure.storage.blob.cloudpageblob.resize) Запрошенный размер должен быть кратен 512 байтам.

```csharp
pageBlob.Resize(32 * OneGigabyteAsBytes);
```

#### <a name="writing-pages-to-a-page-blob"></a>Запись страниц в страничный BLOB-объект

Для записи страниц используйте метод [CloudPageBlob.WritePages](/dotnet/api/microsoft.azure.storage.blob.cloudpageblob.beginwritepages).  Это позволит записать последовательный набор страниц размером до 4 МБ. Записываемое смещение должно начинаться на границе 512 байт (startingOffset % 512 == 0), а заканчиваться на границе 512 — 1.  В следующем примере кода показано, как вызвать метод **WritePages** для большого двоичного объекта:

```csharp
pageBlob.WritePages(dataStream, startingOffset); 
```

Как только запрос на запись последовательного набора страниц успешно выполняется в службе BLOB-объектов и реплицируется для обеспечения устойчивости, запись фиксируется и клиенту отправляется уведомление о том, что запись завершена успешно.  

На схеме ниже показано 2 отдельных операции записи:

![](./media/storage-blob-pageblob-overview/storage-blob-pageblob-overview-figure2.png)

1.  Операция записи, начинающаяся со смещения 0 длиной 1024 байт 
2.  Операция записи, начинающаяся со смещения 4096 длиной 1024 байт 

#### <a name="reading-pages-from-a-page-blob"></a>Чтение страниц из страничного BLOB-объекта

Для чтения страниц используйте метод [CloudPageBlob.DownloadRangeToByteArray](/dotnet/api/microsoft.azure.storage.blob.icloudblob.downloadrangetobytearray), чтобы считать диапазон байтов из страничного BLOB-объекта. Это даст возможность загрузить весь большой двоичный объект или диапазон байтов, начиная со смещения в большом двоичном объекте. При чтении смещение не должно начинаться с величины, кратной 512. При чтении байтов со страницы NUL служба возвращает нулевые байты.

```csharp
byte[] buffer = new byte[rangeSize];
pageBlob.DownloadRangeToByteArray(buffer, bufferOffset, pageBlobOffset, rangeSize); 
```

На следующем рисунке показана операция Read с смещением 256 и размером диапазона 4352. Возвратные данные выделены оранжевым цветом. Нулевые возвращаются для страниц NUL.

![](./media/storage-blob-pageblob-overview/storage-blob-pageblob-overview-figure3.png)

Если большой двоичный объект является фрагментарным, возможно, потребуется загружать только значимые области страницы. Это позволит не оплачивать передачу нулевых байтов и сократить задержку при загрузке.  Чтобы определить, какие страницы поддерживаются данными, используйте метод [CloudPageBlob.GetPageRanges](/dotnet/api/microsoft.azure.storage.blob.cloudpageblob.getpageranges). Вы можете перечислить возвращаемые диапазоны и загрузить данные в каждом диапазоне. 

```csharp
IEnumerable<PageRange> pageRanges = pageBlob.GetPageRanges();

foreach (PageRange range in pageRanges)
{
    // Calculate the range size
    int rangeSize = (int)(range.EndOffset + 1 - range.StartOffset);

    byte[] buffer = new byte[rangeSize];

    // Read from the correct starting offset in the page blob and
    // place the data in the bufferOffset of the buffer byte array
    pageBlob.DownloadRangeToByteArray(buffer, bufferOffset, range.StartOffset, rangeSize); 

    // Then use the buffer for the page range just read
}
```

#### <a name="leasing-a-page-blob"></a>Сдача страничного BLOB-объекта в аренду

Операция сдачи большого двоичного объекта в аренду устанавливает блокировку на большом двоичном объекте для операций записи и удаления, а также управляет ею. Эта операция полезна, если к страничному BLOB-объекту осуществляется доступ из нескольких клиентов. При ее применении запись в большой двоичный объект в текущий момент может осуществляться только одним клиентом. К примеру, в дисках Azure этот механизм сдачи в аренду используется, чтобы управление диском осуществлялось только с одной виртуальной машины. Длительность блокировки может составлять 15–60 секунд либо быть бесконечной. Дополнительные сведения см. в [этой документации](/rest/api/storageservices/lease-blob).

В дополнение к богатым АДИ-ади, капли страниц также обеспечивают общий доступ, долговечность и повышенную безопасность. Далее мы рассмотрим эти преимущества подробнее. 

### <a name="concurrent-access"></a>Одновременный доступ

REST API страничного BLOB-объекта и его механизм сдачи в аренду позволяет приложениям получать доступ к страничному BLOB-объекту из нескольких клиентов. Например, предположим, что нужно создать распределенную облачную службу, которая использует объекты хранилища совместно с несколькими пользователями. Это может быть веб-приложение, обслуживающее большую коллекцию изображений для нескольких пользователей. Один из вариантов для реализации — использование виртуальной машины с подключенными дисками. К недостаткам этого относится (а) ограничение подключения диска только к одной виртуальной машине, что уменьшает масштабируемость, гибкость и повышает риски. Если возникла проблема с виртуальной машиной или службой, запущенной на виртуальной машине, по истечении срока действия аренды или ее разрыва образ будет недоступен. Кроме того, требуются дополнительные затраты на виртуальную машину IaaS. 

Альтернативным вариантом является использование страничных BLOB-объектов напрямую через интерфейсы REST API службы хранилища Azure. Этот вариант не требует использования дорогостоящих виртуальных машин IaaS, предоставляет гибкие возможности прямого доступа из нескольких клиентов, упрощает классическую модель развертывания (так как не нужно подключать и отключать диски) и исключает риски возникновения проблем на виртуальной машине. И обеспечивается тот же уровень производительности для произвольных операций чтения и записи, что и на диске.

### <a name="durability-and-high-availability"></a>Высокая доступность и устойчивость

Хранилища класса Standard и Premium — это надежные хранилища, в которых данные страничных BLOB-объектов всегда реплицируются для обеспечения устойчивости и высокого уровня доступности. Дополнительные сведения об избыточности службы хранилища Azure см. в этой [документации](../common/storage-redundancy.md). Azure постоянно поставляла долговечность корпоративного класса для дисков IaaS и каплястраниц, с ведущим в отрасли нулевым процентным [коэффициентом отказов.](https://en.wikipedia.org/wiki/Annualized_failure_rate)

### <a name="seamless-migration-to-azure"></a>Бесшовная миграция в Azure

Для клиентов и разработчиков, заинтересованных в реализации своего собственного пользовательского решения резервного копирования, Azure также предлагает добавочные моментальные снимки, которые содержат только разностные данные. Эта возможность позволяет избежать затрат на начальную полную копию, что значительно снижает расходы на резервное копирование. Помимо возможности эффективно считывать и копировать разностные данные есть другая эффективная возможность, которая помогает внедрить еще больше инноваций от разработчиков, обеспечивая лучшие в своем классе резервное копирование и аварийное восстановление. Вы можете настроить свое собственное решение резервного копирования или аварийного восстановления для виртуальных машин в Azure, используя [моментальные снимки больших двоичных объектов](/rest/api/storageservices/snapshot-blob), интерфейс API [Get Page Ranges](/rest/api/storageservices/get-page-ranges) и интерфейс API [Incremental Copy Blob](/rest/api/storageservices/incremental-copy-blob), с помощью которого можно легко копировать добавочные данные для аварийного восстановления. 

Кроме того, во многих предприятиях важные рабочие нагрузки уже запущены в центрах обработки данных в локальной среде. При переносе рабочей нагрузки в облако одной из основных проблем является время простоя, необходимое для копирования данных, и риск возникновения других непредвиденных проблем после переключения. Во многих случаях простой может быть препятствием для миграции в облако. Используя REST API страничных BLOB-объектов, Azure устраняет эту проблему, обеспечивая перенос в облако с минимальными нарушениями работы важных рабочих нагрузок. 

Примеры создания моментального снимка и восстановления страничного BLOB-объекта из моментального снимка см. в статье о [настройке процесса резервного копирования с помощью добавочных моментальных снимков](../../virtual-machines/windows/incremental-snapshots.md).
