---
title: Управление версиями BLOB-объектов (предварительная версия)
titleSuffix: Azure Storage
description: Управление версиями хранилища BLOB-объектов (Предварительная версия) автоматически сохраняет предыдущие версии объекта и определяет их с помощью меток времени. Вы можете восстановить предыдущие версии большого двоичного объекта, чтобы восстановить данные, если они были ошибочно изменены или удалены.
services: storage
author: tamram
ms.service: storage
ms.topic: conceptual
ms.date: 05/05/2020
ms.author: tamram
ms.subservice: blobs
ms.openlocfilehash: 89d69547d793599fc669927b1a500716a858cc89
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "84433588"
---
# <a name="blob-versioning-preview"></a>Управление версиями BLOB-объектов (предварительная версия)

Вы можете включить управление версиями хранилища BLOB-объектов (Предварительная версия) для автоматического обслуживания предыдущих версий объекта.  Если управление версиями BLOB-объектов включено, можно восстановить более раннюю версию большого двоичного объекта, чтобы восстановить данные, если они ошибочно изменены или удалены.

Управление версиями BLOB-объектов включено в учетной записи хранения и применяется ко всем большим двоичным объектам в учетной записи хранения. После включения управления версиями BLOB-объектов для учетной записи хранения служба хранилища Azure автоматически сохраняет версии для каждого большого двоичного объекта в учетной записи хранения.

Корпорация Майкрософт рекомендует использовать управление версиями BLOB-объектов для поддержки более ранних версий большого двоичного объекта для обеспечения высокой защиты данных. По возможности используйте управление версиями больших двоичных объектов вместо моментальных снимков BLOB-объектов для поддержки предыдущих версий. Моментальные снимки больших двоичных объектов предоставляют аналогичные функциональные возможности в том, что они поддерживают более ранние версии большого двоичного объекта, но моментальные снимки должны поддерживаться приложением вручную.

> [!IMPORTANT]
> Управление версиями BLOB-объектов не может помочь в восстановлении после случайного удаления учетной записи хранения или контейнера. Чтобы предотвратить случайное удаление учетной записи хранения, Настройте блокировку **CannotDelete** для ресурса учетной записи хранения. Дополнительные сведения о блокировке ресурсов Azure см. [в разделе Блокировка ресурсов для предотвращения непредвиденных изменений](../../azure-resource-manager/management/lock-resources.md).

## <a name="how-blob-versioning-works"></a>Как работает управление версиями BLOB-объектов

Версия фиксирует состояние большого двоичного объекта в определенный момент времени. Если для учетной записи хранения включено управление версиями BLOB-объектов, служба хранилища Azure автоматически создает новую версию большого двоичного объекта каждый раз при изменении или удалении большого двоичного объекта.

При создании большого двоичного объекта с включенным управлением версиями новый большой двоичный объект является текущей версией большого двоичного объекта (или базового большого двоичного объекта). При последующем изменении этого большого двоичного объекта Служба хранилища Azure создает версию, которая фиксирует состояние большого двоичного объекта перед его изменением. Измененный большой двоичный объект станет новой текущей версией. Новая версия создается каждый раз при изменении большого двоичного объекта.

При удалении большого двоичного объекта с включенным управлением версиями служба хранилища Azure создает версию, которая фиксирует состояние большого двоичного объекта перед его удалением. Текущая версия большого двоичного объекта удаляется, но версии больших двоичных объектов сохраняются, поэтому при необходимости ее можно создать заново. 

Версии больших двоичных объектов являются неизменяемыми. Нельзя изменять содержимое или метаданные существующей версии большого двоичного объекта.

### <a name="version-id"></a>Идентификатор версии

Каждая версия большого двоичного объекта определяется по ИДЕНТИФИКАТОРу версии. Значение идентификатора версии — это метка времени, когда большой двоичный объект был записан или обновлен. Идентификатор версии назначается во время создания версии.

Вы можете выполнять операции чтения или удаления для определенной версии большого двоичного объекта, указав его идентификатор версии. Если идентификатор версии не указан, операция выполняется с текущей версией (базовый большой двоичный объект).

При вызове операции записи для создания или изменения большого двоичного объекта Служба хранилища Azure возвращает в ответе заголовок *x-MS-Version-ID* . Этот заголовок содержит идентификатор версии для текущей версии большого двоичного объекта, созданного операцией записи.

Идентификатор версии остается неизменным в течение времени существования версии.

### <a name="versioning-on-write-operations"></a>Управление версиями при операциях записи

При включении управления версиями BLOB-объектов каждая операция записи в большой двоичный объект создает новую версию. Операции записи включают в себя [размещение большого двоичного объекта](/rest/api/storageservices/put-blob), [Размещение списка блокировок](/rest/api/storageservices/put-block-list), [копирование большого двоичного объекта](/rest/api/storageservices/copy-blob)и [Задание метаданных BLOB-объекта](/rest/api/storageservices/set-blob-metadata).

Если операция записи создает новый большой двоичный объект, полученный BLOB-объект будет являться текущей версией большого двоичного объекта. Если операция записи изменяет существующий большой двоичный объект, новые данные фиксируются в обновленном большом двоичном объекте, который является текущей версией, а служба хранилища Azure создает версию, сохраняющую предыдущее состояние BLOB-объекта.

Для простоты схемы, приведенные в этой статье, отображают идентификатор версии как простое целочисленное значение. В действительности ИДЕНТИФИКАТОРом версии является метка времени. Текущая версия показана синим цветом, а предыдущие версии показаны серым.

На следующей схеме показано, как операции записи влияют на версии BLOB-объектов. При создании большого двоичного объекта этот большой двоичный объект является текущей версией. При изменении того же большого двоичного объекта создается новая версия для сохранения предыдущего состояния BLOB-объекта, а обновленный большой двоичный объект становится текущей версией.

:::image type="content" source="media/versioning-overview/write-operations-blob-versions.png" alt-text="Диаграмма, показывающая, как операции записи влияют на двоичные объекты с версиями":::

> [!NOTE]
> BLOB-объект, созданный до включения управления версиями для учетной записи хранения, не имеет идентификатора версии. При изменении этого большого двоичного объекта измененный большой двоичный объект становится текущей версией, и создается версия для сохранения состояния большого двоичного объекта перед обновлением. Версии назначается идентификатор версии, который является ее временем создания.

### <a name="versioning-on-delete-operations"></a>Управление версиями при операциях удаления

При удалении большого двоичного объекта Текущая версия большого двоичного объекта становится предыдущей версией, а базовый большой двоичный объект удаляется. Все существующие предыдущие версии большого двоичного объекта сохраняются при удалении большого двоичного объекта.

При вызове операции [удаления большого двоичного объекта](/rest/api/storageservices/delete-blob) без идентификатора версии базовый большой двоичный объект удаляется. Чтобы удалить определенную версию, укажите идентификатор этой версии в операции удаления.

На следующей схеме показан результат операции удаления для большого двоичного объекта с управлением версиями.

:::image type="content" source="media/versioning-overview/delete-versioned-base-blob.png" alt-text="Диаграмма, показывающая удаление BLOB-объекта с управлением версиями":::

При записи новых данных в большой двоичный объект создается новая версия большого двоичного объекта. Все существующие версии не затрагиваются, как показано на следующей схеме.

:::image type="content" source="media/versioning-overview/recreate-deleted-base-blob.png" alt-text="Схема, демонстрирующая повторное создание двоичного объекта с управлением версиями после удаления":::

### <a name="blob-types"></a>Типы BLOB-объектов

Если для учетной записи хранения включена поддержка управления версиями BLOB-объектов, все операции записи и удаления для блочных больших двоичных объектов активируют создание новой версии, за исключением операции [размещения блока](/rest/api/storageservices/put-block) .

Для страничных BLOB-объектов и добавления больших двоичных объектов только подмножество операций записи и удаления вызывают создание версии. например:

- [Put BLOB (Вставка BLOB-объекта)](/rest/api/storageservices/put-blob)
- [Put Block List (Вставка списка блокировки)](/rest/api/storageservices/put-block-list)
- [Delete BLOB (Удаление BLOB-объекта)](/rest/api/storageservices/delete-blob)
- [Set BLOB Metadata (Задание метаданных BLOB-объекта)](/rest/api/storageservices/set-blob-metadata)
- [Копирование BLOB-объекта](/rest/api/storageservices/copy-blob)

Следующие операции не активируют создание новой версии. Чтобы записать изменения из этих операций, Создайте моментальный снимок вручную:

- [Страница размещения](/rest/api/storageservices/put-page) (страничный BLOB-объект)
- [Блок добавления](/rest/api/storageservices/append-block) (добавочный BLOB-объект)

Все версии большого двоичного объекта должны иметь один и тот же тип большого двоичного объекта. Если у большого двоичного объекта есть предыдущие версии, нельзя перезаписать большой двоичный объект одного типа другим типом, если только вы не удалите большой двоичный объект и все его версии.

### <a name="access-tiers"></a>Уровни доступа

Вы можете переместить любую версию блочного BLOB-объекта, включая текущую версию, в другой уровень доступа к большому двоичному объекту, вызвав операцию [задания уровня большого двоичного объекта](/rest/api/storageservices/set-blob-tier) . Вы можете воспользоваться преимуществами цен меньшей емкости, перемещая старые версии большого двоичного объекта на стильный или архивный уровень. Дополнительные сведения см. в статье [хранилище BLOB-объектов Azure: горячий, стильный и архивный уровни доступа](storage-blob-storage-tiers.md).

Чтобы автоматизировать процесс перемещения блочных BLOB-объектов на соответствующий уровень, используйте управление жизненным циклом больших двоичных объектов. Дополнительные сведения об управлении жизненным циклом см. в статье [Управление жизненным циклом хранилища BLOB-объектов Azure](storage-lifecycle-management-concepts.md).

## <a name="enable-or-disable-blob-versioning"></a>Включение или отключение управления версиями BLOB-объектов

Сведения о включении и отключении управления версиями BLOB-объектов см. в разделе [Включение или отключение управления версиями BLOB](versioning-enable.md)-объектов.

Отключение управления версиями BLOB-объектов не приводит к удалению существующих больших двоичных объектов, версий или моментальных снимков. При отключении управления версиями BLOB-объектов все существующие версии остаются доступными в вашей учетной записи хранения. Новые версии не создаются впоследствии.

Если большой двоичный объект был создан или изменен после отключения управления версиями в учетной записи хранения, при перезаписи большого двоичного объекта создается новая версия. Обновленный большой двоичный объект больше не является текущей версией и не имеет идентификатора версии. Все последующие обновления для большого двоичного объекта будут перезаписывать данные без сохранения предыдущего состояния.

Вы можете читать или удалять версии с помощью идентификатора версии после отключения управления версиями. Вы также можете вывести список версий больших двоичных объектов после отключения управления версиями.

На следующей схеме показано, как изменение большого двоичного объекта после отключения управления версиями создает большой двоичный объект, для которого не установлен контроль версий. Все существующие версии, связанные с большим двоичным объектом, сохраняются.

:::image type="content" source="media/versioning-overview/modify-base-blob-versioning-disabled.png" alt-text="Схема, на которой показано изменение базового большого двоичного объекта после отключения управления версиями":::

## <a name="blob-versioning-and-soft-delete"></a>Управление версиями BLOB-объектов и обратимое удаление

Управление версиями BLOB-объектов и обратимое удаление BLOB-объектов обеспечивает оптимальную защиту данных. При включении обратимого удаления вы указываете, как долго служба хранилища Azure должна хранить обратимо удаленные большие двоичные объекты. Любая обратимо удаленная версия BLOB-объекта остается в системе и может быть отменена в течение срока хранения с обратимым удалением. Дополнительные сведения об обратимом удалении BLOB-объектов см. в статье [обратимое удаление для больших двоичных объектов службы хранилища Azure](storage-blob-soft-delete.md).

### <a name="deleting-a-blob-or-version"></a>Удаление большого двоичного объекта или версии

Обратимое удаление обеспечивает дополнительную защиту для удаления версий BLOB-объектов. Если в учетной записи хранения включены как управление версиями, так и обратимое удаление, то при удалении большого двоичного объекта Служба хранилища Azure создает новую версию для сохранения состояния большого двоичного объекта непосредственно перед удалением и удаляет текущую версию. Новая версия не удаляется без обратимого удаления и не будет удалена после истечения срока хранения обратимого удаления.

При удалении предыдущей версии большого двоичного объекта Эта версия обратимо удалена. Версия с обратимым удалением сохраняется в течение срока хранения, указанного в параметрах обратимого удаления для учетной записи хранения, и окончательно удаляется после истечения срока хранения обратимого удаления.

Чтобы удалить предыдущую версию большого двоичного объекта, явно удалите его, указав идентификатор версии.

На следующей схеме показано, что происходит при удалении большого двоичного объекта или версии большого двоичного объекта.

:::image type="content" source="media/versioning-overview/soft-delete-historical-version.png" alt-text="Диаграмма, показывающая удаление версии с включенным обратимым удалением":::

Если в учетной записи хранения включены как управление версиями, так и обратимое удаление, то при изменении или удалении версии BLOB-объекта или большого двоичного объекта моментальный снимок не создается.

### <a name="restoring-a-soft-deleted-version"></a>Восстановление обратимо удаленных версий

Можно восстановить обратимо удаленную версию большого двоичного объекта, вызвав операцию [отмены удаления больших двоичных объектов](/rest/api/storageservices/undelete-blob) в версии, пока действует срок хранения обратимого удаления. Операция **отмены удаления большого двоичного объекта** восстанавливает все обратимо удаленные версии большого двоичного объекта.

Восстановление необратимо удаленных версий с помощью операции **отмены удаления BLOB-объектов** не повышает уровень текущей версии. Чтобы восстановить текущую версию, сначала восстановите все версии с обратимым удалением, а затем используйте операцию [копирования BLOB-объектов](/rest/api/storageservices/copy-blob) , чтобы скопировать предыдущую версию для восстановления большого двоичного объекта.

На следующей схеме показано, как восстановить обратимо удаленные версии BLOB-объектов с помощью операции **отмены удаления больших двоичных объектов** , а также как восстановить текущую версию большого двоичного объекта с помощью операции **копирования BLOB-объектов** .

:::image type="content" source="media/versioning-overview/undelete-version.png" alt-text="Диаграмма, показывающая, как восстановить обратимо удаленные версии":::

После истечения срока хранения обратимого удаления все обратимо удаленные версии больших двоичных объектов удаляются без возможности восстановления.

## <a name="blob-versioning-and-blob-snapshots"></a>Управление версиями BLOB-объектов и моментальные снимки больших двоичных объектов

Моментальный снимок большого двоичного объекта — это доступная только для чтения копия большого двоичного объекта, выполняемая в конкретный момент времени. Моментальные снимки больших двоичных объектов и версии BLOB-объектов похожи, но моментальный снимок создается вручную или приложением, а версия большого двоичного объекта создается автоматически при операции записи или удаления, если для вашей учетной записи хранения включена поддержка управления версиями BLOB-объектов.

> [!IMPORTANT]
> Корпорация Майкрософт рекомендует после включения управления версиями BLOB-объектов обновить приложение, чтобы прекратить создание моментальных снимков блочных BLOB-объектов. Если для вашей учетной записи хранения включена поддержка управления версиями, все обновления и удаления блочных BLOB-объектов фиксируются и сохраняются в версиях. Создание моментальных снимков не предоставляет никаких дополнительных средств защиты данных блочного BLOB-объекта, если включено управление версиями больших двоичных объектов и может привести к увеличению затрат и сложности приложений.

### <a name="snapshot-a-blob-when-versioning-is-enabled"></a>Моментальный снимок большого двоичного объекта при включении управления версиями

Хотя это не рекомендуется, можно создать моментальный снимок большого двоичного объекта, который также имеет версию. Если не удается обновить приложение, чтобы прекратить создание моментальных снимков больших двоичных объектов при включении управления версиями, приложение может поддерживать как моментальные снимки, так и версии.

При создании моментального снимка двоичного объекта с управлением версиями создается новая версия одновременно с созданием моментального снимка. Новая текущая версия также создается при создании моментального снимка.

На следующей схеме показано, что происходит при создании моментального снимка BLOB-объекта с версией. На схеме версии BLOB-объектов и моментальные снимки с ИДЕНТИФИКАТОРами версии 2 и 3 содержат идентичные данные.

:::image type="content" source="media/versioning-overview/snapshot-versioned-blob.png" alt-text="Схема, показывающая моментальные снимки BLOB-объекта с версией":::

## <a name="authorize-operations-on-blob-versions"></a>Авторизовать операции в версиях BLOB-объектов

Вы можете авторизовать доступ к версиям BLOB-объектов, используя один из следующих подходов:

- С помощью управления доступом на основе ролей (RBAC) предоставьте разрешения для субъекта безопасности Azure Active Directory (Azure AD). Корпорация Майкрософт рекомендует использовать Azure AD для обеспечения более высокого уровня безопасности и простоты в использовании. Дополнительные сведения об использовании Azure AD с операциями BLOB-объектов см. в разделе [авторизация доступа к BLOB-объектам и очередям с помощью Azure Active Directory](../common/storage-auth-aad.md).
- С помощью подписанного URL-адрес (SAS) для делегирования доступа к версиям большого двоичного объекта. Укажите идентификатор версии для подписанного типа ресурса `bv` , представляющий версию BLOB-объекта, чтобы создать маркер SAS для операций в определенной версии. Дополнительные сведения о подписанных URL-адресах см. в статье об [использование подписанных URL-адресов SAS в службе хранилища Azure](../common/storage-sas-overview.md).
- С помощью ключей доступа к учетной записи для авторизации операций с версиями BLOB-объектов с общим ключом. Дополнительные сведения см. в статье [Авторизация с помощью общего ключа](/rest/api/storageservices/authorize-with-shared-key).

Управление версиями BLOB-объектов предназначено для защиты данных от случайного или вредоносного удаления. Для повышения уровня защиты при удалении версии большого двоичного объекта требуются специальные разрешения. В следующих разделах описываются разрешения, необходимые для удаления версии BLOB-объекта.

### <a name="rbac-action-to-delete-a-blob-version"></a>Действие RBAC для удаления версии BLOB-объекта

В следующей таблице показано, какие действия RBAC поддерживают удаление большого двоичного объекта или версии большого двоичного объекта.

| Описание: | Операция службы BLOB-объектов | Требуется действие данных RBAC | Поддержка встроенной роли RBAC |
|----------------------------------------------|------------------------|---------------------------------------------------------------------------------------|-------------------------------|
| Удаление текущей версии большого двоичного объекта | Delete BLOB (Удаление BLOB-объекта) | **Microsoft.Storage/storageAccounts/blobServices/containers/blobs/delete** | Участник данных BLOB-объектов хранилища |
| Удаление версии | Delete BLOB (Удаление BLOB-объекта) | **Microsoft. Storage/storageAccounts/Блобсервицес/Containers/blobs/Делетеблобверсион/Action** | Владелец данных BLOB-объектов хранилища |

### <a name="shared-access-signature-sas-parameters"></a>Параметры подписи общего доступа (SAS)

Подписанный ресурс для версии BLOB-объекта — `bv` . Дополнительные сведения см. в статьях [Создание SAS службы](/rest/api/storageservices/create-service-sas) или [Создание SAS для делегирования пользователей](/rest/api/storageservices/create-user-delegation-sas).

В следующей таблице показано разрешение, необходимое для удаления версии BLOB-объекта на SAS.

| **Разрешение** | **Символ URI** | **Разрешенные операции** |
|----------------|----------------|------------------------|
| Удалить         | x              | Удаление версии большого двоичного объекта. |

## <a name="about-the-preview"></a>Сведения о предварительной версии

Управление версиями BLOB-объектов доступно в предварительной версии в следующих регионах:

- Центральная Франция
- Восточная Канада
- Центральная Канада

Эта предварительная версия не предназначена для использования в рабочей среде.

Версия 2019-10-10 и более поздние версии REST API службы хранилища Azure поддерживают управление версиями BLOB-объектов.

### <a name="storage-account-support"></a>Поддержка учетных записей хранения

Управление версиями BLOB-объектов доступно для следующих типов учетных записей хранения:

- Учетные записи хранения общего назначения версии 2
- Блокировать учетные записи хранения BLOB-объектов
- Учетные записи хранения BLOB-объектов

Если ваша учетная запись хранения является учетной записью общего назначения v1, используйте портал Azure для обновления до учетной записи общего назначения версии 2. Дополнительные сведения об учетных записях хранения см. в статье [Общие сведения об учетной записи хранения](../common/storage-account-overview.md).

Учетные записи хранения с иерархическим пространством имен, доступные для использования с Azure Data Lake Storage 2-го поколения, в настоящее время не поддерживаются.

### <a name="register-for-the-preview"></a>Зарегистрируйтесь для использования предварительной версии

Чтобы зарегистрироваться в предварительной версии для управления версиями BLOB-объектов, используйте PowerShell или Azure CLI, чтобы отправить запрос на регистрацию функции в подписке. После утверждения запроса можно включить управление версиями BLOB-объектов с помощью любого нового или существующего общего назначения, хранилища BLOB-объектов или учетных записей хранения блочных BLOB-объектов уровня "Премиум".

# <a name="powershell"></a>[PowerShell](#tab/powershell)

Чтобы зарегистрироваться в PowerShell, вызовите команду [Get-азпровидерфеатуре](/powershell/module/az.resources/get-azproviderfeature) .

```powershell
# Register for blob versioning (preview)
Register-AzProviderFeature -ProviderNamespace Microsoft.Storage `
    -FeatureName Versioning

# Refresh the Azure Storage provider namespace
Register-AzResourceProvider -ProviderNamespace Microsoft.Storage
```

# <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

Чтобы зарегистрироваться в Azure CLI, вызовите команду [AZ Feature Register](/cli/azure/feature#az-feature-register) .

```azurecli
az feature register --namespace Microsoft.Storage \
    --name Versioning
```

---

### <a name="check-the-status-of-your-registration"></a>Проверка состояния регистрации

Чтобы проверить состояние регистрации, используйте PowerShell или Azure CLI.

# <a name="powershell"></a>[PowerShell](#tab/powershell)

Чтобы проверить состояние регистрации с помощью PowerShell, вызовите команду [Get-азпровидерфеатуре](/powershell/module/az.resources/get-azproviderfeature) .

```powershell
Get-AzProviderFeature -ProviderNamespace Microsoft.Storage `
    -FeatureName Versioning
```

# <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

Чтобы проверить состояние регистрации с помощью Azure CLI, вызовите команду [AZ Feature](/cli/azure/feature#az-feature-show) .

```azurecli
az feature show --namespace Microsoft.Storage \
    --name Versioning
```

---

## <a name="pricing-and-billing"></a>Цены и выставление счетов

Включение управления версиями BLOB-объектов может привести к дополнительным затратам на хранение данных в вашей учетной записи. При проектировании приложения важно учитывать, как эта плата может накапливаться, чтобы минимизировать затраты.

Счета за версии больших двоичных объектов, например моментальные снимки BLOB-объектов, выставляются по той же ставке, что и активные данные. Если версия использует общие папки или страницы с базовым BLOB-объектом, вы платите только за дополнительные блоки или страницы, которые не являются общими для версии и базового большого двоичного объекта.

> [!NOTE]
> Включение управления версиями для часто перезаписанных данных может привести к увеличению затрат на емкость хранилища и увеличению задержки при выполнении операций перечисления. Чтобы устранить эти проблемы, храните часто перезаписанные данные в отдельной учетной записи хранения с отключенной системой управления версиями.

### <a name="important-billing-considerations"></a>Важные вопросы о выставлении счетов

При включении управления версиями BLOB-объектов необходимо учитывать следующие моменты.

- В вашей учетной записи хранения взимается плата за уникальные блоки или страницы, будь то они находятся в большом двоичном объекте или в предыдущей версии большого двоичного объекта. В вашей учетной записи не взимается дополнительная плата за версии, связанные с большим двоичным объектом, пока не будет обновлен большой двоичный объект, на котором они основаны. После обновления большого двоичного объекта он отличается от предыдущих версий. В этом случае вы платите за уникальные блоки или страницы в каждом большом двоичном объекте или версии.
- Когда вы заменяете блок в блочном большом двоичном объекте, за этот блок начинает взиматься плата как за уникальный. Это справедливо, даже если блок имеет тот же идентификатор блока и те же данные, что и в версии. После того, как блок будет зафиксирован снова, он рассходится от его аналога в любой версии, и вам будет выполнена начисляться за его данные. Это же происходит и для страницы в страничном BLOB-объекте, обновляемом идентичными данными.
- В хранилище BLOB-объектов нет средств для определения того, содержат ли два блока одинаковые данные. Каждый блок, который был загружен и зафиксирован, обрабатывается как уникальный, даже если он содержит те же данные и имеет тот же идентификатор блока. Поскольку расходы начисляются для уникальных блоков, важно учитывать, что обновление большого двоичного объекта при включении управления версиями приведет к появлению дополнительных уникальных блоков и дополнительной оплаты.
- Если управление версиями BLOB-объектов включено, разработайте операции обновления блочных BLOB-объектов таким образом, чтобы они могли обновить минимальное возможное число блоков. Операции записи, позволяющие детально управлять блоками, являются [блоками помещает](/rest/api/storageservices/put-block) блоки и [помещают их в список блокировок](/rest/api/storageservices/put-block-list). С другой стороны, операция [размещения большого двоичного объекта](/rest/api/storageservices/put-blob) заменяет все содержимое большого двоичного объекта, что может привести к дополнительным затратам.

### <a name="versioning-billing-scenarios"></a>Сценарии выставления счетов за управление версиями

В следующих сценариях показано, как начисляются расходы на блочный BLOB-объект и его версии.

#### <a name="scenario-1"></a>Сценарий 1

В сценарии 1 большой двоичный объект имеет более раннюю версию. Большой двоичный объект не был обновлен с момента создания версии, поэтому плата взимается только за уникальные блоки 1, 2 и 3.

![Ресурсы хранилища Azure](./media/versioning-overview/versions-billing-scenario-1.png)

#### <a name="scenario-2"></a>Сценарий 2

В сценарии 2 был обновлен один блок (блок 3 на схеме) в большом двоичном объекте. Несмотря на то что обновленный блок содержит одни и те же данные и один и тот же идентификатор, он не совпадает с блоком 3 в предыдущей версии. В результате плата в учетной записи взимается за четыре блока.

![Ресурсы хранилища Azure](./media/versioning-overview/versions-billing-scenario-2.png)

#### <a name="scenario-3"></a>Сценарий 3

В сценарии 3 большой двоичный объект был обновлен, но не имеет версии. Блок 3 был заменен блоком 4 в базовом большом двоичном объекте, но предыдущая версия по-прежнему соответствует блоку 3. В результате плата в учетной записи взимается за четыре блока.

![Ресурсы хранилища Azure](./media/versioning-overview/versions-billing-scenario-3.png)

#### <a name="scenario-4"></a>Сценарий 4

В сценарии 4 базовый большой двоичный объект был полностью обновлен и не содержит никаких первоначальных блоков. В результате учетной записи выставляются счета за все восемь уникальных блоков &mdash; , четыре в базовом большом двоичном объекте, и четыре в предыдущей версии. Этот сценарий может возникнуть при записи в большой двоичный объект с помощью операции размещения большого двоичного объекта, так как он заменяет все содержимое базового большого двоичного объекта.

![Ресурсы хранилища Azure](./media/versioning-overview/versions-billing-scenario-4.png)

## <a name="see-also"></a>См. также

- [Включение управления версиями BLOB-объектов](versioning-enable.md)
- [Создание моментального снимка большого двоичного объекта](/rest/api/storageservices/creating-a-snapshot-of-a-blob)
- [Обратимое удаление для больших двоичных объектов службы хранилища Azure](storage-blob-soft-delete.md)
