---
title: Обновление до учетной записи хранения общего назначения версии 2 - хранилища Azure | Документация Майкрософт
description: Обновление до учетных записей хранения общего назначения версии 2.
services: storage
author: tamram
ms.service: storage
ms.topic: article
ms.date: 03/26/2019
ms.author: tamram
ms.openlocfilehash: 2d6a5c96bf99439520e26fc905668835944cee29
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "66115625"
---
# <a name="upgrade-to-a-general-purpose-v2-storage-account"></a>Обновить до учетной записи хранения общего назначения версии 2

Учетные записи хранения общего назначения версии 2 поддержки последних функций службы хранилища Azure и включить все функции общего назначения версии 1 и учетных записей хранения BLOB-объектов. В большинстве сценариев хранения рекомендуется использовать учетные записи общего назначения версии 2. Учетные записи общего назначения версии 2 отличаются наименьшей ориентировочной платой за каждый гигабайт для службы хранилища Azure, а также конкурентоспособными в отрасли ценами на транзакции.

Обновление учетной записи хранения общего назначения версии 2 из вашего общего назначения версии 1 или учетные записи хранения BLOB-объектов является простой. Обновление можно выполнить через портал Azure, PowerShell или Azure CLI.

> [!IMPORTANT]
> Обновление до общего назначения версии 2 общего назначения версии 1 или учетной записи хранения BLOB-объектов является окончательным и не может быть отменена.

## <a name="upgrade-using-the-azure-portal"></a>Обновление с помощью портала Azure

1. Войдите на [портале Azure](https://portal.azure.com).
2. Войдите в свою учетную запись хранения.
3. В разделе **Параметры** щелкните **Конфигурация**.
4. В разделе **Тип учетной записи** щелкните **Обновить**.
5. В разделе **Подтвердить обновление** введите имя учетной записи.
6. Щелкните **Обновить** в нижней части колонки.

    ![Обновление типа учетной записи](../blobs/media/storage-blob-account-upgrade/upgrade-to-gpv2-account.png)

## <a name="upgrade-with-powershell"></a>Обновление с помощью PowerShell

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]

Чтобы обновить учетную запись общего назначения версии 1 до учетной записи общего назначения версии 2, с помощью PowerShell, сначала обновите PowerShell, чтобы использовать последнюю версию **Az.Storage** модуля. Дополнительные сведения об установке PowerShell см. [здесь](https://docs.microsoft.com/powershell/azure/install-Az-ps).

Затем, чтобы обновить учетную запись, выполните следующую команду, заменив имя вашей группы ресурсов и учетной записи хранения:

```powershell
Set-AzStorageAccount -ResourceGroupName <resource-group> -AccountName <storage-account> -UpgradeToStorageV2
```

## <a name="upgrade-with-azure-cli"></a>Обновление с помощью Azure CLI

Чтобы обновить учетную запись общего назначения версии 1 до учетной записи общего назначения версии 2, с помощью Azure CLI, сначала необходимо установите последнюю версию Azure CLI. Сведения об установке Azure CLI см. [здесь](https://docs.microsoft.com/cli/azure/install-azure-cli?view=azure-cli-latest).

Затем, чтобы обновить учетную запись, выполните следующую команду, заменив имя вашей группы ресурсов и учетной записи хранения:

```cli
az storage account update -g <resource-group> -n <storage-account> --set kind=StorageV2
```

## <a name="specify-an-access-tier-for-blob-data"></a>Указание уровня доступа для данных больших двоичных объектов

Учетные записи общего назначения версии 2 поддерживают все службы хранилища Azure и объекты данных, но уровни доступа предусмотрены только для блочных BLOB-объектов в хранилище BLOB-объектов. При обновлении до учетной записи хранения общего назначения версии 2, можно указать уровень доступа для данных больших двоичных объектов.

Уровни доступа позволяют выбрать наиболее экономичное хранилище на основе ожидаемых схем использования. Блочные BLOB-объекты можно хранить на горячем, холодном и архивном уровнях. Дополнительные сведения об уровнях доступа см. в статье [Хранилище BLOB-объектов Azure. горячий, холодный, архивный уровни хранилища и уровень "Премиум" (предварительная версия)](../blobs/storage-blob-storage-tiers.md).

По умолчанию учетную запись хранения создается на уровне доступа к "Горячий", и учетную запись хранения общего назначения версии 1 обновляется до уровня доступа "Горячий". Чтобы определить, какой уровень доступа нужно использовать для данных после обновления, изучите свой сценарий. Существует два типичных пользовательских сценариях для перехода на учетную запись общего назначения версии 2.

* Есть учетная запись хранения общего назначения версии 1 и требуется только для оценки обновления для учетной записи хранения общего назначения версии 2, с уровнем доступа правой хранилища для данных больших двоичных объектов.
* Вы решили использовать учетную запись хранения общего назначения версии 2 или уже есть и хотите выяснить, следует использовать "Горячий" или "холодный" уровень доступа к хранилищу для данных больших двоичных объектов.

В обоих случаях сначала стоит оценить затраты на хранение и доступ к на данные, хранимые в учетную запись хранения общего назначения версии 2, а затем сравнить эти затраты с текущими.

## <a name="pricing-and-billing"></a>Цены и выставление счетов

Обновление учетной записи хранения v1 в учетную запись общего назначения версии 2 предоставляется бесплатно. Тем не менее изменение уровня доступа хранилища может привести изменения по счету. 

Модель ценообразования во всех учетных записях хранения учитывает уровень хранилища каждого большого двоичного объекта. При использовании учетной записи хранения счета выставляются следующим образом:

* **Затраты на хранение**. Плата за хранение данных зависит не только от их объема, но и от уровня доступа к хранилищу. Чем холоднее уровень хранилища, тем меньше стоит каждый гигабайт.

* **Затраты на доступ к данным**. Чем холоднее уровень хранилища, тем дороже доступ к данным. На холодном и архивном уровнях доступа к хранилищу взимается плата за чтение каждого гигабайта данных.

* **Затраты на транзакции**. Чем холоднее уровень хранилища, тем дороже каждая транзакция для всех уровней.

* **Затраты на передачу данных георепликации**. Эта плата взимается только для тех учетных записей, в которых настроена георепликация, включая GRS и RA-GRS. При передаче данных георепликации взимается плата за гигабайт данных.

* **Затраты на исходящий трафик**. Передача исходящих данных (данные, передаваемые из региона Azure) предусматривает выставление счетов за использование пропускной способности по гигабайтам, согласованные с учетными записями хранения общего назначения.

* **Изменение уровня доступа к хранилищу**. Переход в учетной записи с холодного уровня доступа к хранилищу на горячий оплачивается. Плата за эту услугу равна стоимости операций чтения всех данных в учетной записи хранения. При этом стоимость перехода с горячего уровня доступа к хранилищу на холодный равна стоимости операций записи всех данных на холодный уровень (только для учетных записей GPv2).

> [!NOTE]
> Дополнительные сведения о модели ценообразования для учетных записей хранения см. на странице с [ценами на службу хранилища Azure](https://azure.microsoft.com/pricing/details/storage/). Дополнительные сведения о ценах на исходящий трафик см. на странице с [ценами на передачу данных](https://azure.microsoft.com/pricing/details/data-transfers/).

### <a name="estimate-costs-for-your-current-usage-patterns"></a>Оценка затрат текущих схем использования

Чтобы оценить затраты на хранение и доступ к данным больших двоичных объектов в учетной записи хранения общего назначения версии 2 в нужный уровень, оценить существующую схему использования или приблизительно определить будущую. В общем, необходимо выяснить следующее:

* Использование хранилища BLOB-объектов (в гигабайтах), включая:
    - Какой объем данных хранится в учетной записи хранения?
    - Как изменяется объем данных ежемесячно? Постоянно ли новые данные заменяют старые данные?
* Схема первичного доступа к данным хранилища BLOB-объектов, включая:
    - Какой объем данных считывается и записывается в учетную запись хранения?
    - Сколько операций чтения и записи выполняется над данными в учетной записи хранения?

Чтобы выбрать наилучший уровень доступа в соответствии с потребностями, может быть полезно определить емкость данных больших двоичных объектов и способы использования этих данных. Для этого лучше всего обратиться к метрикам мониторинга для вашей учетной записи.

### <a name="monitoring-existing-storage-accounts"></a>Мониторинг существующих учетных записей хранения

Чтобы отслеживать существующие учетные записи хранения и собирать данные о них, используйте службу "Аналитика Службы хранилища Azure", которая ведет журналы и хранит метрики учетной записи хранения. Служба "Аналитика Службы хранилища" может хранить метрики, включающие сводную статистику по транзакциям и данные о емкости запросов к службе хранилища для следующих типов учетных записей: GPv1, GPv2 и хранилища BLOB-объектов. Эти данные хранятся в общеизвестных таблицах в той же учетной записи хранения.

Дополнительные сведения см. в статьях о [метриках аналитики хранилища](https://msdn.microsoft.com/library/azure/hh343258.aspx) и [схеме таблиц для метрик аналитики хранилища](https://msdn.microsoft.com/library/azure/hh343264.aspx).

> [!NOTE]
> Учетные записи хранилища BLOB-объектов предоставляют конечную точку службы таблиц только для хранения данных метрик для этой учетной записи и доступа к этим данным.

Чтобы отслеживать использование ресурсов хранения в хранилище BLOB-объектов, необходимо включить метрики емкости.
Если эти метрики включены, данные о емкости ежедневно будут записываться для службы учетной записи хранения больших двоичных объектов. Эти данные регистрируются как запись в таблице *$MetricsCapacityBlob* в той же учетной записи хранения.

Чтобы отслеживать схему доступа к данным для хранилища BLOB-объектов, включите почасовые метрики транзакций на уровне API. Если эти метрики включены, транзакции каждого API собираются каждый час. Эти данные регистрируются как запись таблицы, которая записывается в таблицу *$MetricsHourPrimaryTransactionsBlob* в той же учетной записи хранения. Транзакции учетных записей хранения RA-GRS записываются таблицей *$MetricsHourSecondaryTransactionsBlob* на вторую конечную точку.

> [!NOTE]
> Если у вас есть учетную запись хранения общего назначения, в котором хранятся страничных BLOB-объектов и дисков виртуальных машин или очереди, файлы или таблицы вместе с блока или добавить данные больших двоичных объектов, этот процесс оценки не применим. Данные производительности не отличают блочные BLOB-объекты от других типов и не предоставляют сведения для других типов данных. Если вы используете эти типы, то также можете посмотреть на показатели в вашем последнем счете.

Чтобы понять, как используются данные и предоставляется доступ к ним, рекомендуем выбрать период хранения для метрик, отражающий эти закономерности, и экстраполировать полученные данные. Один из вариантов — хранить данные метрик в течение семи дней и собирать данные каждую неделю для анализа в конце месяца. Либо вы можете хранить данные метрик месяц, собирая и анализируя данные в конце 30-дневного периода.

Дополнительные сведения о включении, сборе и просмотре данных метрик см. в разделе [метрики аналитики хранилища](../common/storage-analytics-metrics.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json).

> [!NOTE]
> Хранение и загрузка данных аналитики, а также доступ к ним оплачиваются, как для обычных данных пользователя.

### <a name="utilizing-usage-metrics-to-estimate-costs"></a>Оценка затрат с помощью метрик использования

#### <a name="capacity-costs"></a>Затраты на емкость

Последняя запись в таблице метрик емкости *$MetricsCapacityBlob* с ключом строки *data* показывает емкость хранилища, которую потребляют данные пользователя. Последняя запись в таблице метрик емкости *$MetricsCapacityBlob* с ключом строки *analytics* показывает емкость хранилища, которую потребляют журналы службы аналитики.

Сведения об общей емкости, потребляемой данными пользователя и журналами службы аналитики (если они включены), позволяют оценить затраты на хранение данных в учетной записи хранения. Этот метод можно использовать для оценки затрат на хранение в учетных записях хранения GPv1.

#### <a name="transaction-costs"></a>Плата за транзакции

Сумма значений *TotalBillableRequests*во всех записях для API в таблице метрик транзакций означает общее количество транзакций для этого API. *Например*, общее количество транзакций *GetBlob* в течение указанного периода можно вычислить, просуммировав все оплачиваемые запросы для всех операций с ключом строки *user;GetBlob*.

Чтобы оценить затраты на транзакции для учетных записей хранения BLOB-объектов, разделите транзакции на три группы, так как для них установлены разные цены.

* Транзакции записи: *PutBlob*, *PutBlock*, *PutBlockList*, *AppendBlock*, *ListBlobs*, *ListContainers*, *CreateContainer*, *SnapshotBlob* и *CopyBlob*.
* Транзакции удаления: *DeleteBlob* и *DeleteContainer*.
* Все остальные транзакции.

Чтобы оценить затраты на транзакции для учетных записей хранения GPv1, просуммируйте стоимость всех транзакций независимо от операции или API.

#### <a name="data-access-and-geo-replication-data-transfer-costs"></a>Стоимость передачи данных георепликации и доступа к данным

Служба аналитики службы хранилища не указывает объем данных, которые считываются из учетной записи хранения и записываются в нее. Но этот объем можно приблизительно оценить, просмотрев таблицу метрик транзакций. Сумма значений *TotalIngress* во всех записях для API в таблице метрик транзакций отображает общий объем входящих данных в байтах для этого API. Точно так же сумма значений *TotalEgress* отображает общий объем исходящих данных в байтах.

Чтобы оценить затраты на доступ к данным для учетных записей хранения BLOB-объектов, разделите транзакции на две группы.

* Чтобы оценить объем данных, полученных из учетной записи хранения, вы можете суммировать значения *TotalEgress* в первую очередь для операций *GetBlob* и *CopyBlob*.

* Чтобы оценить объем данных, записанных в учетную запись хранения, вы можете суммировать значения *TotalIngress* в первую очередь для операций *PutBlob*, *PutBlock*, *CopyBlob* и *AppendBlock*.

Расходы на передачу данных георепликации для учетных записей хранения BLOB-объектов также можно рассчитать, оценив объем данных, записанных в учетные записи хранения GRS или RA-GRS.

> [!NOTE]
> Более подробный пример расчета затрат на использование "горячего" или "холодного" уровня доступа к хранилищу см. в ответе на вопрос *Что такое "горячий" и "холодный" уровень доступа и как определить, какой из них следует использовать?* на странице [Цены на хранилища Azure](https://azure.microsoft.com/pricing/details/storage/).

## <a name="next-steps"></a>Дальнейшие действия

- [создать учетную запись хранения;](storage-quickstart-create-account.md)
- [Управление учетными записями хранения Azure](storage-account-manage.md)
