---
title: Обновление до учетной записи хранения общего назначения версии 2
titleSuffix: Azure Storage
description: Сведения об обновлении до учетной записи хранения общего назначения версии 2.
services: storage
author: tamram
ms.service: storage
ms.topic: how-to
ms.date: 02/25/2019
ms.author: tamram
ms.openlocfilehash: 9afbade408d6f95fcd3a61aa1ba65bc09c7a875b
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80067215"
---
# <a name="upgrade-to-a-general-purpose-v2-storage-account"></a>Обновление до учетной записи хранения общего назначения версии 2

Учетные записи хранения общего назначения версии 2 поддерживают последние возможности службы хранилища Azure и содержат все функции учетных записей общего назначения версии 1 и учетных записей хранилища BLOB-объектов. В большинстве сценариев хранения рекомендуется использовать учетные записи общего назначения версии 2. Учетные записи общего назначения версии 2 отличаются наименьшей ориентировочной платой за каждый гигабайт для службы хранилища Azure, а также конкурентоспособными в отрасли ценами на транзакции. Учетные записи v2 общего назначения поддерживают уровни доступа к учетной записи по умолчанию горячего или прохладного уровня уровня каплей между горячим, прохладным или архивным.

Обновление до общего назначения v2 хранения счета от общего назначения v1 или Blob хранения счетов является простым. Обновление можно выполнить через портал Azure, PowerShell или Azure CLI. Нет простоя или риска потери данных, связанных с обновлением до учетной записи хранения v2 общего назначения. Обновление учетной записи происходит с помощью простой операции менеджера ресурсов Azure, которая изменяет тип учетной записи.

> [!IMPORTANT]
> Обновление учетной записи хранения v1 или Blob общего назначения до общецелевого v2 является постоянным и не может быть отменено.

# <a name="portal"></a>[Портал](#tab/azure-portal)

1. Войдите на [портал Azure](https://portal.azure.com).
2. Войдите в свою учетную запись хранения.
3. В разделе **Параметры** щелкните **Конфигурация**.
4. Под **видом счета,** нажмите на **обновление**.
5. При **обновлении Confirm**введите имя вашей учетной записи.
6. Щелкните **Обновить** в нижней части колонки.

    ![Обновление счета Вид](../blobs/media/storage-blob-account-upgrade/upgrade-to-gpv2-account.png)

# <a name="powershell"></a>[PowerShell](#tab/azure-powershell)

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]

Для обновления учетной записи общего назначения версии 1 до учетной записи версии 2 с помощью PowerShell сначала обновите PowerShell, чтобы использовать последнюю версию модуля **Az.Storage**. Дополнительные сведения об установке PowerShell см. [здесь](https://docs.microsoft.com/powershell/azure/install-Az-ps).

Затем позвоните следующей команде для обновления учетной записи, заменив имя группы ресурсов, имя учетной записи хранилища и желаемый уровень доступа к учетной записи.

```powershell
Set-AzStorageAccount -ResourceGroupName <resource-group> -AccountName <storage-account> -UpgradeToStorageV2 -AccessTier <Hot/Cool>
```
# <a name="azure-cli"></a>[Лазурный CLI](#tab/azure-cli)

Чтобы обновить учетную запись общего назначения версии 1 до версии 2 с помощью Azure CLI, сначала установите последнюю версию Azure CLI. Сведения об установке Azure CLI см. [здесь](https://docs.microsoft.com/cli/azure/install-azure-cli?view=azure-cli-latest).

Затем позвоните следующей команде для обновления учетной записи, заменив имя группы ресурсов, имя учетной записи хранилища и желаемый уровень доступа к учетной записи.

```azurecli
az storage account update -g <resource-group> -n <storage-account> --set kind=StorageV2 --access-tier=<Hot/Cool>
```

---

## <a name="specify-an-access-tier-for-blob-data"></a>Указание уровня доступа для данных больших двоичных объектов

Учетные записи v2 общего назначения поддерживают все службы хранения данных Azure и объекты данных, но уровни доступа доступны только для блокировки капли в хранилище Blob. При обновлении до учетной записи хранения v2 общего назначения можно указать уровень доступа к учетной записи по умолчанию горячего или прохладного, что указывает на уровень по умолчанию, который будет загружен по умолчанию, так как отдельный параметр уровня доступа blob не указан.

Уровни доступа Blob позволяют выбрать наиболее экономичное хранилище на основе ожидаемых моделей использования. Блок капли могут храниться в горячем, прохладном или архивном ярусах. Дополнительные сведения об уровнях доступности см. в статье [Хранилище BLOB-объектов Azure: горячий, холодный и архивный уровни](../blobs/storage-blob-storage-tiers.md).

По умолчанию новая учетная запись хранилища создается на уровне горячего доступа, и учетная запись v1 общего назначения может быть обновлена до горячего или холодного уровня учетной записи. Если уровень доступа к учетной записи не указан в обновлении, он будет повышен до горячего по умолчанию. Если вы изучаете, какой уровень доступа использовать для обновления, рассмотрим текущий сценарий использования данных. Существует два типичных пользовательских сценария для перехода на учетную запись общего назначения версии 2.

* У вас есть учетная запись хранения общего назначения версии 1, и вы хотите оценить последствия перехода на учетную запись хранения общего назначения версии 2 с соответствующим уровнем доступа к хранилищу для данных больших двоичных объектов.
* Вы решили использовать учетную запись хранения v2 общего назначения или уже имеете его и хотите оценить, следует ли использовать горячий или прохладный уровень доступа к хранению для данных blob.

В обоих случаях сначала стоит оценить затраты на хранение данных, доступ и работу с хранимыми данными в учетной записи хранения общего назначения версии 2, а затем сравнить эти затраты с текущими.

## <a name="pricing-and-billing"></a>Цены и выставление счетов

Обновление учетной записи хранилища v1 до учетной записи v2 общего назначения бесплатно. Вы можете указать нужный уровень учетной записи в процессе обновления. Если уровень учетной записи не указан в обновлении, `Hot`уровень учетной записи по умолчанию обновленной учетной записи будет . Однако изменение уровня доступа к хранилищу после обновления может привести к изменениям в счете, поэтому рекомендуется указать новый уровень учетной записи во время обновления.

Модель ценообразования во всех учетных записях хранения учитывает уровень хранилища каждого большого двоичного объекта. При использовании учетной записи хранения счета выставляются следующим образом:

* **Затраты на хранение**: В дополнение к объему хранимых данных стоимость хранения данных варьируется в зависимости от уровня доступа к хранилищу. Чем холоднее уровень хранилища, тем меньше стоит каждый гигабайт.

* **Затраты на доступ к данным.** Чем холоднее уровень хранилища, тем дороже доступ к данным. На холодном и архивном уровнях доступа к хранилищу взимается плата за чтение каждого гигабайта данных.

* **Затраты на транзакции.** Чем холоднее уровень хранилища, тем выше стоимость каждой транзакции для всех уровней.

* **Расходы на передачу данных георепликации**. Этот платеж касается только тех учетных записей, в которых настроена георепликация, включая GRS и RA-GRS. При передаче данных георепликации взимается плата за гигабайт данных.

* **Расходы на исходящий трафик.** Передача трафика (из региона Azure) предусматривает выставление счетов за использование пропускной способности по гигабайтам, как и при использовании учетных записей хранения общего назначения.

* **Изменение уровня доступа к хранилищу:** Изменение уровня доступа к хранению учетной записи с прохладной на горячий несет плату, равную чтению всех данных, существующих в учетной записи хранилища. При этом стоимость перехода с горячего уровня доступа к хранилищу на холодный равна стоимости операций записи всех данных на холодный уровень (только для учетных записей GPv2).

> [!NOTE]
> Дополнительные сведения о модели ценообразования для учетных записей хранения см. на странице с [ценами на службу хранилища Azure](https://azure.microsoft.com/pricing/details/storage/). Дополнительные сведения о ценах на исходящий трафик см. на странице с [ценами на передачу данных](https://azure.microsoft.com/pricing/details/data-transfers/).

### <a name="estimate-costs-for-your-current-usage-patterns"></a>Оценка затрат текущих схем использования

Чтобы оценить затраты на хранение данных больших двоичных объектов и доступ к ним в учетной записи хранения общего назначения версии 2 на определенном уровне, необходимо оценить имеющуюся схему использования или приблизительно определить будущую. В общем, необходимо выяснить следующее:

* Использование хранилища BLOB-объектов (в гигабайтах), включая:
  * Какой объем данных хранится в учетной записи хранения?
  * Как изменяется объем данных ежемесячно? Постоянно ли новые данные заменяют старые данные?

* Схема первичного доступа к данным хранилища BLOB-объектов, включая:
  * Какой объем данных считывается и записывается в учетную запись хранения?
  * Сколько операций чтения и записи выполняется над данными в учетной записи хранения?

Чтобы выбрать наилучший уровень доступа в соответствии с потребностями, может быть полезно определить емкость данных больших двоичных объектов и способы использования этих данных. Для этого лучше всего обратиться к метрикам мониторинга для вашей учетной записи.

### <a name="monitoring-existing-storage-accounts"></a>Мониторинг существующих учетных записей хранения

Чтобы отслеживать существующие учетные записи хранения и собирать данные о них, используйте службу "Аналитика Службы хранилища Azure", которая ведет журналы и хранит метрики учетной записи хранения. Служба "Аналитика Службы хранилища" может хранить метрики, включающие сводную статистику по транзакциям и данные о емкости запросов к службе хранилища для следующих типов учетных записей: GPv1, GPv2 и хранилища BLOB-объектов. Эти данные хранятся в общеизвестных таблицах в той же учетной записи хранения.

Дополнительные сведения см. в статьях о [метриках аналитики хранилища](https://msdn.microsoft.com/library/azure/hh343258.aspx) и [схеме таблиц для метрик аналитики хранилища](https://msdn.microsoft.com/library/azure/hh343264.aspx).

> [!NOTE]
> Учетные записи хранилища BLOB-объектов предоставляют конечную точку службы таблиц только для хранения данных метрик для этой учетной записи и доступа к этим данным.

Чтобы отслеживать использование ресурсов хранения в хранилище BLOB-объектов, необходимо включить метрики емкости.
При этом включено, данные емкости регистрируются ежедневно для службы Blob учетной записи хранилища и записываются как запись таблицы, которая записывается в *таблицу $MetricsCapacityBlob* в одной учетной записи хранилища.

Чтобы отслеживать схему доступа к данным для хранилища BLOB-объектов, включите почасовые метрики транзакций на уровне API. Если эти метрики включены, транзакции каждого API собираются каждый час. Эти данные регистрируются как запись таблицы, которая записывается в таблицу *$MetricsHourPrimaryTransactionsBlob* в той же учетной записи хранения. Транзакции учетных записей хранения RA-GRS записываются таблицей *$MetricsHourSecondaryTransactionsBlob* на вторую конечную точку.

> [!NOTE]
> Этот процесс оценки нельзя применить к учетной записи хранения общего назначения, в которой хранятся страничные BLOB-объекты и диски виртуальных машин или очереди, файлы или таблицы вместе с данными блочных или добавочных BLOB-объектов. Данные производительности не отличают блочные BLOB-объекты от других типов и не предоставляют сведения для других типов данных. Если вы используете эти типы, то также можете посмотреть на показатели в вашем последнем счете.

Чтобы понять, как используются данные и предоставляется доступ к ним, рекомендуем выбрать период хранения для метрик, отражающий эти закономерности, и экстраполировать полученные данные. Один из вариантов — хранить данные метрик в течение семи дней и собирать данные каждую неделю для анализа в конце месяца. Либо вы можете хранить данные метрик месяц, собирая и анализируя данные в конце 30-дневного периода.

Для получения подробной информации о включении, сборе и просмотре данных метрик [см.](../common/storage-analytics-metrics.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json)

> [!NOTE]
> Хранение и загрузка данных аналитики, а также доступ к ним оплачиваются, как для обычных данных пользователя.

### <a name="utilizing-usage-metrics-to-estimate-costs"></a>Оценка затрат с помощью метрик использования

#### <a name="capacity-costs"></a>Затраты на емкость

Последняя запись в таблице метрик емкости *$MetricsCapacityBlob* с ключом строки *data* показывает емкость хранилища, которую потребляют данные пользователя. Последняя запись в таблице метрик емкости *$MetricsCapacityBlob* с ключом строки *analytics* показывает емкость хранилища, которую потребляют журналы службы аналитики.

Сведения об общей емкости, потребляемой данными пользователя и журналами службы аналитики (если они включены), позволяют оценить затраты на хранение данных в учетной записи хранения. Этот метод можно использовать для оценки затрат на хранение в учетных записях хранения GPv1.

#### <a name="transaction-costs"></a>Плата за транзакции

Сумма значений *TotalBillableRequests*во всех записях для API в таблице метрик транзакций означает общее количество транзакций для этого API. *Например*, общее количество транзакций *GetBlob* в течение указанного периода можно вычислить, просуммировав все оплачиваемые запросы для всех операций с ключом строки *user;GetBlob*.

Чтобы оценить затраты на транзакции для учетных записей хранения BLOB-объектов, разделите транзакции на три группы, так как для них установлены разные цены.

* Транзакции записи: *PutBlob*, *PutBlock*, *PutBlockList*, *AppendBlock*, *ListBlobs*, *ListContainers*, *CreateContainer*, *SnapshotBlob* и *CopyBlob*.
* Транзакции удаления: *DeleteBlob* и *DeleteContainer*.
* Все остальные транзакции.

Чтобы оценить затраты на транзакции для учетных записей хранения GPv1, просуммируйте стоимость всех транзакций независимо от операции или API.

#### <a name="data-access-and-geo-replication-data-transfer-costs"></a>Стоимость передачи данных георепликации и доступа к данным

Служба аналитики службы хранилища не указывает объем данных, которые считываются из учетной записи хранения и записываются в нее. Но этот объем можно приблизительно оценить, просмотрев таблицу метрик транзакций. Сумма значений *TotalIngress* во всех записях для API в таблице метрик транзакций отображает общий объем входящих данных в байтах для этого API. Точно так же сумма значений *TotalEgress* отображает общий объем исходящих данных в байтах.

Чтобы оценить затраты на доступ к данным для учетных записей хранения BLOB-объектов, разделите транзакции на две группы.

* Чтобы оценить объем данных, полученных из учетной записи хранения, вы можете суммировать значения *TotalEgress* в первую очередь для операций *GetBlob* и *CopyBlob*.

* Чтобы оценить объем данных, записанных в учетную запись хранения, вы можете суммировать значения *TotalIngress* в первую очередь для операций *PutBlob*, *PutBlock*, *CopyBlob* и *AppendBlock*.

Расходы на передачу данных георепликации для учетных записей хранения BLOB-объектов также можно рассчитать, оценив объем данных, записанных в учетные записи хранения GRS или RA-GRS.

> [!NOTE]
> Более подробный пример расчета затрат на использование "горячего" или "холодного" уровня доступа к хранилищу см. в ответе на вопрос *Что такое "горячий" и "холодный" уровень доступа и как определить, какой из них следует использовать?* на странице [Цены на хранилища Azure](https://azure.microsoft.com/pricing/details/storage/).

## <a name="next-steps"></a>Дальнейшие действия

* [Создание учетной записи хранилища](storage-account-create.md)
