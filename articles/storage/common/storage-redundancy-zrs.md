---
title: Создание высокодоступных приложений службы хранилища Azure в хранилище, избыточное между зонами (ZRS) | Документация Майкрософт
description: хранилище, избыточное между зонами (ZRS), предлагает простой способ по созданию высокодоступных приложений. ZRS обеспечивает защиту от сбоев оборудования в центре обработки данных, а также защиту от некоторых региональных сбоев.
services: storage
author: tamram
ms.service: storage
ms.topic: article
ms.date: 10/24/2018
ms.author: tamram
ms.reviewer: artek
ms.subservice: common
ms.openlocfilehash: 111167584fb2e0e2ee5977e0e24b3ebf07b170c1
ms.sourcegitcommit: 509e1583c3a3dde34c8090d2149d255cb92fe991
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/27/2019
ms.locfileid: "66238006"
---
# <a name="zone-redundant-storage-zrs-highly-available-azure-storage-applications"></a>Хранилище, избыточное между зонами (ZRS). Высокодоступные приложения для службы хранилища Azure
[!INCLUDE [storage-common-redundancy-ZRS](../../../includes/storage-common-redundancy-zrs.md)]

## <a name="support-coverage-and-regional-availability"></a>Доступность в регионах и действие поддержки
ZRS в настоящее время поддерживает типы учетных записей общего назначения версии 2. Дополнительные сведения о типах учетных записей хранения см. в статье [Общие сведения об учетной записи хранения](storage-account-overview.md).

ZRS доступно для блочных BLOB-объектов, бездисковых страничных BLOB-объектов, файлов, таблиц и очередей.

ZRS общедоступно в следующих регионах:

- Юго-восточная Азия
- Западная Европа
- Северная Европа
- Центральная Франция
- Восточная часть Японии
- Южная часть Великобритании
- Центральная часть США
- Восточная часть США
- Восточная часть США 2
- Западная часть США 2

Корпорация Майкрософт продолжает запускать ZRS в других регионах Azure. Регулярно проверяйте страницу [обновлений служб Azure](https://azure.microsoft.com/updates/) для получения информации о новых регионах.

## <a name="what-happens-when-a-zone-becomes-unavailable"></a>Что будет, если зона отключена?
Ваши данные будут по-прежнему доступны для чтения и записи, даже если зона становится недоступной. Корпорация Майкрософт рекомендует и дальше следовать рекомендациям по устранению временных сбоев. Эти рекомендации включают в себя внедрение политик повтора с экспоненциальной задержкой.

Если зона отключена, Azure выполняет обновления сети, например перенаправление DNS. Такие обновления могут повлиять на приложение, если вы получаете доступ к своим данным до завершения обновлений.

ZRS не может защитить данные от региональной аварии, где постоянно затрагиваются несколько зон. Вместо этого хранилище ZRS обеспечивает устойчивость для данных, если оно становится временно недоступным. Для защиты от региональных аварий мы советуем использовать геоизбыточное хранилище (GRS). Дополнительные сведения о GRS см. в статье [Геоизбыточное хранилище (GRS). Межрегиональная репликация для службы хранилища Azure](storage-redundancy-grs.md).

## <a name="converting-to-zrs-replication"></a>Преобразование в репликацию ZRS
Выполнить миграцию в LRS, GRS и RA-GRS и из них достаточно просто. Чтобы изменить тип избыточности учетной записи, воспользуйтесь порталом Azure или API поставщика ресурсов хранилища. Azure реплицирует ваши данные соответствующим образом. 

Перенос данных в ZRS требует другую стратегию. Миграция ZRS включает физическое перемещение данных из одной метки хранилища в несколько меток в пределах региона.

Существует два основных варианта для миграции в ZRS. 

- Ручное копирование или перемещение данных в новую учетную запись ZRS из имеющейся.
- Запрос на динамическую миграцию.

Корпорация Майкрософт настоятельно рекомендует выполнять миграцию вручную. Она обеспечивает большую гибкость, чем динамическая. При миграции вручную можно контролировать время миграции.

Существует несколько вариантов выполнения миграции вручную:
- Используйте имеющийся инструментарий, такой как AzCopy, одну из клиентских библиотек службы хранилища Azure или надежные сторонние инструменты.
- Если вы знакомы с HDInsight или Hadoop, подключите исходную и конечную (ZRS) учетную запись к своему кластеру. Затем выполните процесс копирования данных параллельно, используя такой инструмент, как DistCp.
- Разработайте собственный инструмент с помощью одной из клиентских библиотек службы хранилища Azure.

Миграция вручную может вызвать простой приложения. Если приложению требуется высокий уровень доступности, корпорация Майкрософт также предоставляет возможность динамической миграции. Динамическая миграция — это миграция "на месте". 

Во время динамической миграции можно использовать свою учетную запись хранения, пока ваши данные переносятся между метками исходного и целевого хранилищ. Во время процесса миграции у вас есть тот же уровень устойчивости и доступности соглашения об уровне ОБСЛУЖИВАНИЯ, как вы предоставляете.

Учитывайте следующие ограничения на динамическую миграцию:

- Хотя корпорация Майкрософт незамедлительно отреагирует на запрос динамической миграции, нет никакой гарантии относительно времени ее завершения. Если вам нужны данные, перенесенные в ZRS, на определенную дату, корпорация Майкрософт вместо этого рекомендует выполнить миграцию вручную. Как правило, чем больше данных в вашей учетной записи, тем дольше будет выполняться их перенос. 
- Динамическая миграция поддерживается только для учетных записей хранения, использующих репликацию LRS или GRS. Если учетная запись использует RA-GRS, прежде чем продолжить, необходимо изменить тип репликации учетной записи на LRS или GRS. Этот промежуточный шаг удаляет вторичную конечную точку только для чтения, предоставляемую RA-GRS перед миграцией.
- Учетная запись должна содержать данные.
- Данные можно переносить только в рамках одного региона. Если вы хотите перенести данные в учетную запись ZRS, которая находится в регионе, отличном от учетной записи источника, тогда нужно выполнить миграцию вручную.
- Только учетные записи хранения цен. категории "Стандартный" поддерживают динамическую миграцию. Учетные записи хранения цен. категории "Премиум" необходимо переносить вручную.
- Динамическая миграция из ZRS на LRS, GRS или RA-GRS не поддерживается. Необходимо будет вручную переместить данные в новую или существующую учетную запись хранения.
- Управляемые диски доступны только для хранилищ LRS и ZRS невозможно перенести. Для интеграции с доступностью наборов данных см. в разделе [введение в Azure управляемые диски](https://docs.microsoft.com/azure/virtual-machines/windows/managed-disks-overview#integration-with-availability-sets). Можно хранить моментальные снимки и образы для стандартных управляемых дисков SSD на стандартные диски HDD и [выберите один из вариантов LRS и ZRS](https://azure.microsoft.com/pricing/details/managed-disks/). 

Вы можете запросить динамическую миграцию через [портал поддержки Azure](https://ms.portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/overview). Выберите на портале учетную запись хранения, которую вы хотите преобразовать в ZRS.
1. Выберите **Новый запрос в службу поддержки**
2. Заполните раздел **Основные сведения**, основываясь на информации об учетной записи. В разделе **Служба** выберите **Storage Account Management** (Управление учетными записями хранения) и ресурс, который необходимо преобразовать в ZRS. 
3. Щелкните **Далее**. 
4. Укажите следующие значения в разделе **Проблема**: 
    - **Уровень серьезности**. Оставьте значение по умолчанию.
    - **Тип проблемы**. Выберите **Перенос данных**.
    - **Категория**. Выберите **Миграция в ZRS в пределах региона**.
    - **Заголовок**. Введите описательный заголовок, например **Миграция учетной записи ZRS**.
    - **Сведения**. Введите дополнительные сведения в поле **Сведения**, например "нужна миграция из [LRS, GRS] в ZRS в регионе \_\_". 
5. Щелкните **Далее**.
6. Проверьте правильность контактных данных в колонке **Контактные данные**.
7. Нажмите кнопку **Создать**.

Специалист службы поддержки свяжется с вами и предоставит любую необходимую помощь.

## <a name="live-migration-to-zrs-faq"></a>Динамическая миграция на часто задаваемые вопросы ZRS

**Мне действовать, простоев во время миграции?**

Нет без простоев, вызванных миграции. Во время динамической миграции вы можете с помощью учетной записи хранения во время переноса данных между стеками хранилища источника и назначения. Во время процесса миграции у вас есть тот же уровень устойчивости и доступности соглашения об уровне ОБСЛУЖИВАНИЯ, как вы предоставляете.

**Есть ли потери данных, связанных с миграцией?**

Нет потери данных, связанных с миграцией. Во время процесса миграции у вас есть тот же уровень устойчивости и доступности соглашения об уровне ОБСЛУЖИВАНИЯ, как вы предоставляете.

**После завершения миграции, являются любые обновления, необходимые для приложения?**

После завершения миграции типа репликации для учетных записей хранилища изменится на «избыточные в пределах зоны (ZRS)». Конечные точки службы, доступ к ключам, SAS и любых других вариантов конфигурации учетной записи остаются без изменений и неизменными.

**Могу ли я запросить динамическую миграцию мои учетные записи общего назначения версии 1 для ZRS?**

ZRS поддерживает только учетные записи общего назначения версии 2, поэтому перед отправкой запроса для динамической миграции для ZRS убедитесь, что до учетные записи общего назначения версии 2. См. в разделе [Обзор учетной записи хранения Azure](https://docs.microsoft.com/azure/storage/common/storage-account-overview) и [перейти на учетную запись хранения общего назначения версии 2](https://docs.microsoft.com/azure/storage/common/storage-account-upgrade) для получения дополнительных сведений.

**Могу ли я запросить динамическую миграцию Мои счета геоизбыточное хранилище с доступом для чтения (RA-GRS) для ZRS?**

Прежде чем отправить запрос для динамической миграции для ZRS убедитесь, что в том случае, приложений или рабочих нагрузок больше не требуется доступ к вторичной конечной точки только для чтения и изменить тип репликации учетных записях хранения для гео избыточное хранилище (GRS). См. в разделе [изменение стратегии репликации](https://docs.microsoft.com/azure/storage/common/storage-redundancy#changing-replication-strategy) для получения дополнительных сведений.

**Могу ли я запросить динамическую миграцию мои учетные записи хранения ZRS в другой регион**

Если вы хотите перенести данные в учетную запись ZRS, расположенном в регионе, отличается от региона исходной учетной записи, вам потребуется выполнить миграцию вручную.

## <a name="zrs-classic-a-legacy-option-for-block-blobs-redundancy"></a>Классическое хранилище ZRS. Устаревший вариант для обеспечения избыточности блочных BLOB-объектов.
> [!NOTE]
> Корпорация Майкрософт объявит нерекомендуемыми и перенесет классические учетные записи ZRS 31 марта 2021. Перед прекращением поддержки клиентам классического хранилища ZRS будут предоставлены дополнительные сведения. 
>
> Как только станет ZRS [общедоступная](#support-coverage-and-regional-availability) в регионе, пользователи не смогут создавать классические учетные записи ZRS на портале в этом регионе. Использование Microsoft PowerShell и Azure CLI для создания классических учетных записей ZRS является возможным, пока классическое хранилище ZRS не будет объявлено нерекомендуемым.

В классическом хранилище ZRS данные асинхронно реплицируются в центрах обработки данных в пределах одного или двух регионов. Реплицируемые данные недоступны, если корпорация Майкрософт не инициирует отработку отказа в дополнительном регионе. Классическую учетную запись ZRS невозможно преобразовать в учетную запись хранилища LRS, GRS или RA-GRS и наоборот. Кроме того, она не поддерживает использование метрик или ведение журналов.

Классическое хранилище ZRS доступно только для **блочных BLOB-объектов** в учетных записях хранения общего назначения версии 1 (GPv1). Дополнительные сведения об учетных записях хранения см. в статье [Общие сведения об учетной записи хранения](storage-account-overview.md).

Чтобы вручную перенести данные учетной записи ZRS в учетную запись LRS, классическое хранилище ZRS, GRS или RA-GRS и обратно, используйте один из следующих инструментов: AzCopy, Обозреватель службы хранилища Azure, Azure PowerShell или Azure CLI. Можно также создавать собственные решения для миграции с использованием одной из клиентских библиотек службы хранилища Azure.

Можно также обновить учетные записи ZRS классического ZRS на портале или с использованием Azure PowerShell или интерфейса командной строки Azure в регионах, где доступны ZRS.

Обновление до ZRS на портале перейдите к разделу конфигурации учетной записи и выберите обновления:![Обновление классическое ZRS до ZRS на портале](media/storage-redundancy-zrs/portal-zrs-classic-upgrade.jpg)

Обновление до ZRS с помощью PowerShell вызовите команду ниже:
```powershell
Set-AzStorageAccount -ResourceGroupName <resource_group> -AccountName <storage_account> -UpgradeToStorageV2
```

Обновление до ZRS с помощью интерфейса командной строки вызовите следующую команду:
```cli
az storage account update -g <resource_group> -n <storage_account> --set kind=StorageV2
```

## <a name="see-also"></a>См. также
- [Репликация службы хранилища Azure](storage-redundancy.md)
- [Локально избыточное хранилище (LRS). Недорогое средство для обеспечения избыточности данных для службы хранилища Azure](storage-redundancy-lrs.md)
- [Гео-избыточное хранилище (GRS). Межрегиональная репликация для службы хранилища Azure](storage-redundancy-grs.md)
