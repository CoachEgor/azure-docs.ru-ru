---
title: Создание высокодоступных приложений службы хранилища Azure в хранилище, избыточное между зонами (ZRS) | Документация Майкрософт
description: хранилище, избыточное между зонами (ZRS), предлагает простой способ по созданию высокодоступных приложений. ZRS обеспечивает защиту от сбоев оборудования в центре обработки данных, а также защиту от некоторых региональных сбоев.
services: storage
author: tamram
ms.service: storage
ms.topic: conceptual
ms.date: 06/28/2019
ms.author: tamram
ms.reviewer: artek
ms.subservice: common
ms.openlocfilehash: 46975cf7762e2d92e5112911bd491f372cb22a31
ms.sourcegitcommit: a678f00c020f50efa9178392cd0f1ac34a86b767
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/26/2019
ms.locfileid: "74544632"
---
# <a name="zone-redundant-storage-zrs-for-building-highly-available-azure-storage-applications"></a>Хранилище, избыточное в виде зоны (ZRS), для создания высокодоступных приложений службы хранилища Azure

[!INCLUDE [storage-common-redundancy-ZRS](../../../includes/storage-common-redundancy-zrs.md)]

## <a name="support-coverage-and-regional-availability"></a>Доступность в регионах и действие поддержки

В настоящее время ZRS поддерживает стандартные типы учетных записей хранения общего назначения v2 и Филестораже. Дополнительные сведения о типах учетных записей хранения см. в статье [Общие сведения об учетной записи хранения](storage-account-overview.md).

ZRS доступен для блочных BLOB-объектов, не являющихся дисками, стандартных файловых ресурсов, таблиц и очередей.

Для учетных записей общего назначения v2 ZRS общедоступен в следующих регионах:

- Юго-восточная Азия
- Северная Европа
- Западная Европа
- Центральная Франция
- Восточная часть Японии
- Южная часть Великобритании
- Центральная часть США
- Восточная часть США
- Восточная часть США 2
- Западная часть США 2

Для учетных записей Филестораже (файловых ресурсов уровня "Премиум") и учетных записей Блоккблобстораже (блочные BLOB-объекты уровня "Премиум") ZRS общедоступна в следующих регионах:

- Западная Европа
- Восточная часть США

Корпорация Майкрософт продолжает запускать ZRS в других регионах Azure. Регулярно проверяйте страницу [обновлений служб Azure](https://azure.microsoft.com/updates/) для получения информации о новых регионах.

**Известные ограничения**

- В настоящее время архивный уровень не поддерживается в учетных записях ZRS. Дополнительные сведения см. в статье [хранилище BLOB-объектов Azure: горячий, стильный и архивный уровни доступа](https://docs.microsoft.com/azure/storage/blobs/storage-blob-storage-tiers) .
- Управляемые диски не поддерживают ZRS. Вы можете хранить моментальные снимки и образы для SSD (цен. категория "Стандартный") управляемых дисков в хранилище HDD (цен. категория "Стандартный") и [выбирать параметры LRS и ZRS](https://azure.microsoft.com/pricing/details/managed-disks/).

## <a name="what-happens-when-a-zone-becomes-unavailable"></a>Что будет, если зона отключена?

Ваши данные будут по-прежнему доступны для чтения и записи, даже если зона становится недоступной. Корпорация Майкрософт рекомендует и дальше следовать рекомендациям по устранению временных сбоев. Эти рекомендации включают в себя внедрение политик повтора с экспоненциальной задержкой.

Если зона отключена, Azure выполняет обновления сети, например перенаправление DNS. Такие обновления могут повлиять на приложение, если вы получаете доступ к своим данным до завершения обновлений.

ZRS не может защитить данные от региональной аварии, где постоянно затрагиваются несколько зон. Вместо этого хранилище ZRS обеспечивает устойчивость для данных, если оно становится временно недоступным. Для защиты от региональных аварий мы советуем использовать геоизбыточное хранилище (GRS). Дополнительные сведения о GRS см. в статье [Геоизбыточное хранилище (GRS). Межрегиональная репликация для службы хранилища Azure](storage-redundancy-grs.md).

## <a name="converting-to-zrs-replication"></a>Преобразование в репликацию ZRS

Выполнить миграцию в LRS, GRS и RA-GRS и из них достаточно просто. Чтобы изменить тип избыточности учетной записи, воспользуйтесь порталом Azure или API поставщика ресурсов хранилища. Azure реплицирует ваши данные соответствующим образом. 

Для миграции данных в ZRS требуется другая стратегия. Миграция ZRS включает физическое перемещение данных из одной метки хранилища в несколько меток в пределах региона.

Существует два основных варианта миграции на ZRS: 

- Ручное копирование или перемещение данных в новую учетную запись ZRS из имеющейся.
- Запрос на динамическую миграцию.

> [!IMPORTANT]
> Динамическая миграция в настоящее время не поддерживается для файловых ресурсов уровня "Премиум". Сейчас поддерживается только копирование и перемещение данных вручную.

Если вам требуется выполнить миграцию к определенной дате, попробуйте сделать это вручную. Она обеспечивает большую гибкость, чем динамическая. При миграции вручную можно контролировать время миграции.

Существует несколько вариантов выполнения миграции вручную:
- Используйте имеющийся инструментарий, такой как AzCopy, одну из клиентских библиотек службы хранилища Azure или надежные сторонние инструменты.
- Если вы знакомы с HDInsight или Hadoop, подключите исходную и конечную (ZRS) учетную запись к своему кластеру. Затем выполните процесс копирования данных параллельно, используя такой инструмент, как DistCp.
- Разработайте собственный инструмент с помощью одной из клиентских библиотек службы хранилища Azure.

Миграция вручную может вызвать простой приложения. Если приложению требуется высокий уровень доступности, корпорация Майкрософт также предоставляет возможность динамической миграции. Динамическая миграция — это миграция "на месте" без простоев. 

Во время динамической миграции можно использовать свою учетную запись хранения, пока ваши данные переносятся между метками исходного и целевого хранилищ. Во время миграции у вас по-прежнему будет тот же уровень устойчивости и заявленная в Соглашении об уровне обслуживания доступность, что и обычно.

Учитывайте следующие ограничения на динамическую миграцию:

- Хотя корпорация Майкрософт незамедлительно отреагирует на запрос динамической миграции, нет никакой гарантии относительно времени ее завершения. Если вам нужны данные, перенесенные в ZRS, на определенную дату, корпорация Майкрософт вместо этого рекомендует выполнить миграцию вручную. Как правило, чем больше данных в вашей учетной записи, тем дольше будет выполняться их перенос. 
- Динамическая миграция поддерживается только для учетных записей хранения, использующих репликацию LRS или GRS. Если учетная запись использует RA-GRS, прежде чем продолжить, необходимо изменить тип репликации учетной записи на LRS или GRS. Этот промежуточный шаг удаляет вторичную конечную точку только для чтения, предоставляемую RA-GRS перед миграцией.
- Учетная запись должна содержать данные.
- Данные можно переносить только в рамках одного региона. Если вы хотите перенести данные в учетную запись ZRS, которая находится в регионе, отличном от учетной записи источника, тогда нужно выполнить миграцию вручную.
- Только учетные записи хранения цен. категории "Стандартный" поддерживают динамическую миграцию. Учетные записи хранения цен. категории "Премиум" необходимо переносить вручную.
- Динамическая миграция с ZRS на LRS, GRS или RA-GRS не поддерживается. Необходимо вручную переместить данные в новую или существующую учетную запись хранения.
- Управляемые диски доступны только для LRS и не могут быть перенесены в ZRS. Вы можете хранить моментальные снимки и образы для SSD (цен. категория "Стандартный") управляемых дисков в хранилище HDD (цен. категория "Стандартный") и [выбирать параметры LRS и ZRS](https://azure.microsoft.com/pricing/details/managed-disks/). Сведения об интеграции с группами доступности см. [в статье Введение в управляемые диски Azure](https://docs.microsoft.com/azure/virtual-machines/windows/managed-disks-overview#integration-with-availability-sets).
- Учетные записи LRS или GRS с архивными данными нельзя перенести в ZRS.

Вы можете запросить динамическую миграцию через [портал поддержки Azure](https://ms.portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/overview). Выберите на портале учетную запись хранения, которую вы хотите преобразовать в ZRS.
1. Выберите **Новый запрос в службу поддержки**
2. Заполните раздел **Основные сведения**, основываясь на информации об учетной записи. В разделе **Служба** выберите **Storage Account Management** (Управление учетными записями хранения) и ресурс, который необходимо преобразовать в ZRS. 
3. Нажмите кнопку **Далее**. 
4. Укажите следующие значения в разделе **Проблема**: 
    - **Серьезность**. Оставьте значение по умолчанию.
    - **Тип проблемы**. Выберите **Миграция данных**.
    - **Категория**: выберите **Миграция в ZRS**.
    - **Заголовок**. Введите описательный заголовок, например **Миграция учетной записи ZRS**.
    - **Сведения**: введите дополнительные сведения в поле " **сведения** ", например, я хочу перейти на ZRS из [LRS, GRS] в \_\_ регионе. 
5. Нажмите кнопку **Далее**.
6. Проверьте правильность контактных данных в колонке **Контактные данные**.
7. Нажмите кнопку **Создать**.

Специалист службы поддержки свяжется с вами и предоставит любую необходимую помощь.

## <a name="live-migration-to-zrs-faq"></a>Динамическая миграция в ZRS вопросы и ответы

**Следует ли планировать простой во время миграции?**

Нет простоев, вызванных миграцией. Во время динамической миграции можно продолжать использовать учетную запись хранения, пока данные переносятся между штампами исходного и целевого хранилища. Во время миграции у вас по-прежнему будет тот же уровень устойчивости и заявленная в Соглашении об уровне обслуживания доступность, что и обычно.

**Связаны ли какие-либо потери данных с миграцией?**

Нет потерь данных, связанных с миграцией. Во время миграции у вас по-прежнему будет тот же уровень устойчивости и заявленная в Соглашении об уровне обслуживания доступность, что и обычно.

**Какие обновления требуются для приложений после завершения миграции?**

После завершения миграции тип репликации учетных записей изменится на "хранилище, избыточное в виде зоны (ZRS)". Конечные точки служб, ключи доступа, SAS и другие параметры конфигурации учетной записи остаются неизменными и не меняются.

**Можно ли запросить динамическую миграцию учетных записей общего назначения v1 в ZRS?**

ZRS поддерживает только учетные записи общего назначения версии 2, поэтому перед отправкой запроса на динамическую миграцию в ZRS обязательно обновите учетные записи до общего назначения версии 2. Дополнительные сведения см. в статье [Обзор учетной записи хранения Azure](https://docs.microsoft.com/azure/storage/common/storage-account-overview) и [обновление до учетной записи хранения общего назначения версии 2](https://docs.microsoft.com/azure/storage/common/storage-account-upgrade) .

**Можно ли запросить динамическую миграцию учетных записей геоизбыточного хранилища с доступом на чтение (RA-GRS) в ZRS?**

Перед отправкой запроса на динамическую миграцию в ZRS убедитесь, что ваши приложения или рабочие нагрузки больше не нуждаются в доступе к вторичной конечной точке только для чтения, и измените тип репликации учетных записей хранения на геоизбыточное хранилище (GRS). Дополнительные сведения см. в разделе [изменение стратегии репликации](https://docs.microsoft.com/azure/storage/common/storage-redundancy#changing-replication-strategy) .

**Можно ли запросить динамическую миграцию учетных записей хранения в ZRS в другой регион?**

Если вы хотите перенести данные в учетную запись ZRS, расположенную в регионе, отличном от региона исходной учетной записи, необходимо выполнить миграцию вручную.

## <a name="zrs-classic-a-legacy-option-for-block-blobs-redundancy"></a>Классическое хранилище ZRS. Устаревший вариант для обеспечения избыточности блочных BLOB-объектов.
> [!NOTE]
> Корпорация Майкрософт объявит нерекомендуемыми и перенесет классические учетные записи ZRS 31 марта 2021. Перед прекращением поддержки клиентам классического хранилища ZRS будут предоставлены дополнительные сведения. 
>
> После того как ZRS станет [общедоступным](#support-coverage-and-regional-availability) в регионе, клиенты не смогут создавать Классические учетные записи ZRS на портале в этом регионе. Использование Microsoft PowerShell и Azure CLI для создания классических учетных записей ZRS является возможным, пока классическое хранилище ZRS не будет объявлено нерекомендуемым.

В классическом хранилище ZRS данные асинхронно реплицируются в центрах обработки данных в пределах одного или двух регионов. Реплицируемые данные недоступны, если корпорация Майкрософт не инициирует отработку отказа в дополнительном регионе. Классическую учетную запись ZRS невозможно преобразовать в учетную запись хранилища LRS, GRS или RA-GRS и наоборот. Кроме того, она не поддерживает использование метрик или ведение журналов.

Классическое хранилище ZRS доступно только для **блочных BLOB-объектов** в учетных записях хранения общего назначения версии 1 (GPv1). Дополнительные сведения об учетных записях хранения см. в статье [Общие сведения об учетной записи хранения Azure](storage-account-overview.md).

Чтобы вручную перенести данные учетной записи ZRS в или из учетной записи LRS, классического хранилища ZRS, GRS или RA-GRS, используйте один из следующих инструментов: AzCopy, Обозреватель службы хранилища Azure, Azure PowerShell или Azure CLI. Можно также создавать собственные решения для миграции с использованием одной из клиентских библиотек службы хранилища Azure.

Вы также можете обновить Классические учетные записи ZRS до ZRS на портале или с помощью Azure PowerShell или Azure CLI в регионах, где доступна ZRS. Чтобы выполнить обновление до ZRS в портал Azure, перейдите к разделу **конфигурации** учетной записи и выберите **Обновить**.

![Обновление классической версии ZRS до ZRS на портале](media/storage-redundancy-zrs/portal-zrs-classic-upgrade.png)

Чтобы выполнить обновление до ZRS с помощью PowerShell, вызовите следующую команду:
```powershell
Set-AzStorageAccount -ResourceGroupName <resource_group> -AccountName <storage_account> -UpgradeToStorageV2
```

Чтобы выполнить обновление до ZRS с помощью интерфейса командной строки, вызовите следующую команду:
```cli
az storage account update -g <resource_group> -n <storage_account> --set kind=StorageV2
```

## <a name="see-also"></a>См. также
- [Репликация службы хранилища Azure](storage-redundancy.md)
- [Локально избыточное хранилище (LRS). Недорогая избыточность данных для службы хранилища Azure](storage-redundancy-lrs.md)
- [Геоизбыточное хранилище (GRS). Межрегиональная репликация для службы хранилища Azure](storage-redundancy-grs.md)
