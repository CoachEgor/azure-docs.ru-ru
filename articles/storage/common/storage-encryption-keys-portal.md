---
title: Настройка ключей, управляемых клиентом, с помощью портал Azure
titleSuffix: Azure Storage
description: Узнайте, как использовать портал Azure для настройки ключей, управляемых клиентом, с помощью Azure Key Vault для шифрования службы хранилища Azure.
services: storage
author: tamram
ms.service: storage
ms.topic: how-to
ms.date: 03/19/2020
ms.author: tamram
ms.reviewer: cbrooks
ms.subservice: common
ms.openlocfilehash: 192e58b101b824ca0cc0c732e02647838be6dc35
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "81456487"
---
# <a name="configure-customer-managed-keys-with-azure-key-vault-by-using-the-azure-portal"></a>Настройка ключей, управляемых клиентом, с помощью Azure Key Vault портал Azure

[!INCLUDE [storage-encryption-configure-keys-include](../../../includes/storage-encryption-configure-keys-include.md)]

В этой статье показано, как настроить Azure Key Vault с управляемыми клиентом ключами с помощью [портал Azure](https://portal.azure.com/). Сведения о создании хранилища ключей с помощью портал Azure см. в разделе [Краткое руководство. Установка и извлечение секрета из Azure Key Vault с помощью портал Azure](../../key-vault/secrets/quick-create-portal.md).

## <a name="configure-azure-key-vault"></a>Настройка Azure Key Vault

Для использования управляемых клиентом ключей с шифрованием службы хранилища Azure необходимо, чтобы в хранилище ключей были установлены два свойства: **обратимое удаление** и **не очищать**. Эти свойства не включены по умолчанию, но их можно включить с помощью PowerShell или Azure CLI в новом или существующем хранилище ключей.

Сведения о том, как включить эти свойства в существующем хранилище ключей, см. в разделах с названием **Включение обратимого удаления** и **Включение защиты от очистки** в одной из следующих статей:

- [Использование обратимого удаления с помощью PowerShell](../../key-vault/general/soft-delete-powershell.md).
- [Использование обратимого удаления с помощью интерфейса командной строки](../../key-vault/general/soft-delete-cli.md).

С шифрованием службы хранилища Azure поддерживаются только 2048-разрядные ключи RSA и RSA-HSM. Дополнительные сведения о ключах см. в разделе **Key Vault Keys** раздела [о Azure Key Vault ключах, секретах и сертификатах](../../key-vault/about-keys-secrets-and-certificates.md#key-vault-keys).

## <a name="enable-customer-managed-keys"></a>Включить управляемые клиентом ключи

Чтобы включить управляемые клиентом ключи в портал Azure, выполните следующие действия.

1. Войдите в свою учетную запись хранения.
1. В колоне **параметров** для учетной записи хранения выберите **Шифрование**. Выберите параметр **управляемые ключи клиента** , как показано на следующем рисунке.

    ![Снимок экрана портала с параметром шифрования](./media/storage-encryption-keys-portal/portal-configure-encryption-keys.png)

## <a name="specify-a-key"></a>Укажите ключ

После включения ключей, управляемых клиентом, у вас будет возможность указать ключ, связываемый с учетной записью хранения.

### <a name="specify-a-key-as-a-uri"></a>Указание ключа в качестве URI

Чтобы указать ключ в качестве универсального кода ресурса (URI), выполните следующие действия.

1. Чтобы найти URI ключа в портал Azure, перейдите в хранилище ключей и выберите параметр **ключи** . Выберите нужный ключ, а затем щелкните ключ, чтобы просмотреть его версии. Выберите версию ключа, чтобы просмотреть параметры для этой версии.
1. Скопируйте значение поля **идентификатор ключа** , которое предоставляет универсальный код ресурса (URI).

    ![Снимок экрана, показывающий URI ключа хранилища ключей](media/storage-encryption-keys-portal/portal-copy-key-identifier.png)

1. В параметрах **шифрования** для учетной записи хранения выберите параметр **Введите URI ключа** .
1. Вставьте URI, скопированный в поле **ключа URI** .

   ![Снимок экрана, показывающий, как ввести URI ключа](./media/storage-encryption-keys-portal/portal-specify-key-uri.png)

1. Укажите подписку, которая содержит хранилище ключей.
1. Сохраните изменения.

### <a name="specify-a-key-from-a-key-vault"></a>Указание ключа из хранилища ключей

Чтобы указать ключ из хранилища ключей, сначала убедитесь, что у вас есть хранилище ключей, содержащее ключ. Чтобы указать ключ из хранилища ключей, выполните следующие действия.

1. Выберите параметр **Выбрать в Key Vault**.
1. Выберите хранилище ключей, содержащее ключ, который вы хотите использовать.
1. Выберите ключ из хранилища ключей.

   ![Снимок экрана с параметром ключа, управляемого клиентом](./media/storage-encryption-keys-portal/portal-select-key-from-key-vault.png)

1. Сохраните изменения.

## <a name="update-the-key-version"></a>Обновление версии ключа

При создании новой версии ключа Обновите учетную запись хранения, чтобы она использовала новую версию. Выполните следующие действия.

1. Перейдите к своей учетной записи хранения и отобразите параметры **шифрования** .
1. Введите универсальный код ресурса (URI) для новой версии ключа. Кроме того, можно выбрать хранилище ключей и ключ еще раз, чтобы обновить версию.
1. Сохраните изменения.

## <a name="use-a-different-key"></a>Использовать другой ключ

Чтобы изменить ключ, используемый для шифрования службы хранилища Azure, выполните следующие действия.

1. Перейдите к своей учетной записи хранения и отобразите параметры **шифрования** .
1. Введите универсальный код ресурса (URI) для нового ключа. Кроме того, можно выбрать хранилище ключей и выбрать новый ключ.
1. Сохраните изменения.

## <a name="disable-customer-managed-keys"></a>Отключение ключей, управляемых клиентом

При отключении управляемых пользователем ключей учетная запись хранения снова шифруется с помощью ключей, управляемых корпорацией Майкрософт. Чтобы отключить управляемые клиентом ключи, выполните следующие действия.

1. Перейдите к своей учетной записи хранения и отобразите параметры **шифрования** .
1. Снимите флажок рядом с параметром **использовать собственный ключ** .

## <a name="next-steps"></a>Дальнейшие шаги

- [Шифрование неактивных данных в службе хранилища Azure](storage-service-encryption.md)
- [Что такое Azure Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-overview)?
