---
title: Настройка ключей, управляемых клиентом, с помощью портал Azure
titleSuffix: Azure Storage
description: Узнайте, как использовать портал Azure для настройки ключей, управляемых клиентом, с помощью Azure Key Vault для шифрования службы хранилища Azure.
services: storage
author: tamram
ms.service: storage
ms.topic: how-to
ms.date: 07/13/2020
ms.author: tamram
ms.reviewer: ozgun
ms.subservice: common
ms.openlocfilehash: a216714939dc45fd1b220f24414a527969ab7fcb
ms.sourcegitcommit: 3d79f737ff34708b48dd2ae45100e2516af9ed78
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/23/2020
ms.locfileid: "87029598"
---
# <a name="configure-customer-managed-keys-with-azure-key-vault-by-using-the-azure-portal"></a>Настройка ключей, управляемых клиентом, с помощью Azure Key Vault портал Azure

[!INCLUDE [storage-encryption-configure-keys-include](../../../includes/storage-encryption-configure-keys-include.md)]

В этой статье показано, как настроить Azure Key Vault с управляемыми клиентом ключами с помощью [портал Azure](https://portal.azure.com/). Сведения о создании Key Vault с помощью портала Azure см. в статье [Краткое руководство. Настройка и получение секрета из Azure Key Vault с помощью портала Azure](../../key-vault/secrets/quick-create-portal.md).

## <a name="configure-azure-key-vault"></a>Настройка Azure Key Vault

Для использования управляемых клиентом ключей с шифрованием службы хранилища Azure необходимо, чтобы в хранилище ключей были установлены два свойства: **обратимое удаление** и **не очищать**. Эти свойства не включены по умолчанию, но их можно включить с помощью PowerShell или Azure CLI в новом или существующем хранилище ключей.

Чтобы узнать, как включить эти свойства в имеющемся хранилище ключей, см. разделы **Включение обратимого удаления** и **Включение защиты от очистки** в одной из следующих статей:

- [Как использовать обратимое удаление в Key Vault с помощью PowerShell](../../key-vault/general/soft-delete-powershell.md).
- [Как использовать обратимое удаление в Key Vault с помощью интерфейса командной строки](../../key-vault/general/soft-delete-cli.md).

Шифрование службы хранилища Azure поддерживает ключи RSA и RSA-HSM размером 2048, 3072 и 4096. Дополнительные сведения о ключах см. в разделе **Key Vault Keys** раздела [о Azure Key Vault ключах, секретах и сертификатах](../../key-vault/about-keys-secrets-and-certificates.md#key-vault-keys).

## <a name="enable-customer-managed-keys"></a>Активация управляемых клиентом ключей

Чтобы включить управляемый клиентом ключ на портале Azure, выполните следующие действия.

1. Войдите в свою учетную запись хранения.
1. В колоне **параметров** для учетной записи хранения выберите **Шифрование**. Выберите параметр **управляемые ключи клиента** , как показано на следующем рисунке.

    ![Снимок экрана портала с параметром шифрования](./media/storage-encryption-keys-portal/portal-configure-encryption-keys.png)

## <a name="specify-a-key"></a>Укажите ключ

После включения ключей, управляемых клиентом, у вас будет возможность указать ключ, связываемый с учетной записью хранения. Вы также можете указать, должна ли служба хранилища Azure автоматически поворачивать ключ, управляемый клиентом, или нужно ли поворачивать ключ вручную.

### <a name="specify-a-key-from-a-key-vault"></a>Указание ключа из хранилища ключей

При выборе управляемого клиентом ключа из хранилища ключей автоматическое вращение ключа включается автоматически. Чтобы вручную управлять версией ключа, укажите универсальный код ресурса (URI) ключа и включите версию ключа. Дополнительные сведения см. в разделе [Указание ключа в качестве универсального кода ресурса (URI)](#specify-a-key-as-a-uri).

Чтобы указать ключ из хранилища ключей, выполните следующие действия.

1. Выберите параметр **Выбрать в Key Vault**.
1. Выберите **выбрать хранилище ключей и ключ**.
1. Выберите хранилище ключей, содержащее ключ, который вы хотите использовать.
1. Выберите ключ из хранилища ключей.

   ![Снимок экрана, показывающий, как выбрать хранилище ключей и ключ](./media/storage-encryption-keys-portal/portal-select-key-from-key-vault.png)

1. Сохраните изменения.

### <a name="specify-a-key-as-a-uri"></a>Указание ключа в качестве URI

При указании URI ключа не указывайте версию ключа, чтобы включить автоматический поворот ключа, управляемого клиентом. Если включить в URI ключа версию ключа, то автоматическое вращение не будет включено и необходимо будет самостоятельно управлять версией ключа. Дополнительные сведения об обновлении версии ключа см. в разделе [Обновление версии ключа вручную](#manually-update-the-key-version).

Чтобы указать ключ в качестве универсального кода ресурса (URI), выполните следующие действия.

1. Чтобы найти URI ключа в портал Azure, перейдите в хранилище ключей и выберите параметр **ключи** . Выберите нужный ключ, а затем щелкните ключ, чтобы просмотреть его версии. Выберите версию ключа, чтобы просмотреть параметры для этой версии.
1. Скопируйте значение поля **идентификатор ключа** , которое предоставляет универсальный код ресурса (URI).

    ![Снимок экрана, показывающий URI ключа хранилища ключей](media/storage-encryption-keys-portal/portal-copy-key-identifier.png)

1. В параметрах **ключа шифрования** для учетной записи хранения выберите параметр **Введите URI ключа** .
1. Вставьте URI, скопированный в поле **ключа URI** . Чтобы включить автоматический поворот, не указывайте версию ключа из универсального кода ресурса (URI).

   ![Снимок экрана, показывающий, как ввести URI ключа](./media/storage-encryption-keys-portal/portal-specify-key-uri.png)

1. Укажите подписку, которая содержит хранилище ключей.
1. Сохраните изменения.

После указания ключа портал Azure указывает, включено ли автоматическое вращение ключей и отображает версию ключа, используемую в данный момент для шифрования.

:::image type="content" source="media/storage-encryption-keys-portal/portal-auto-rotation-enabled.png" alt-text="Снимок экрана с включенным автоматическое вращение ключей, управляемых клиентом":::

## <a name="manually-update-the-key-version"></a>Обновление версии ключа вручную

По умолчанию служба хранилища Azure автоматически поворачивает управляемые клиентом ключи, как описано в предыдущих разделах. Если вы решили самостоятельно управлять версией ключа, необходимо обновить ключ, указанный для учетной записи хранения, каждый раз при создании новой версии ключа.

Чтобы обновить учетную запись хранения для использования новой версии ключа, выполните следующие действия.

1. Перейдите к своей учетной записи хранения и отобразите параметры **шифрования** .
1. Введите универсальный код ресурса (URI) для новой версии ключа. Кроме того, можно выбрать хранилище ключей и ключ еще раз, чтобы обновить версию.
1. Сохраните изменения.

## <a name="switch-to-a-different-key"></a>Переключиться на другой ключ

Чтобы изменить ключ, используемый для шифрования службы хранилища Azure, выполните следующие действия.

1. Перейдите к своей учетной записи хранения и отобразите параметры **шифрования** .
1. Введите универсальный код ресурса (URI) для нового ключа. Кроме того, можно выбрать хранилище ключей и выбрать новый ключ.
1. Сохраните изменения.

## <a name="disable-customer-managed-keys"></a>Отключение ключей, управляемых клиентом

При отключении управляемых пользователем ключей учетная запись хранения снова шифруется с помощью ключей, управляемых корпорацией Майкрософт. Чтобы отключить управляемые клиентом ключи, выполните следующие действия.

1. Перейдите к своей учетной записи хранения и отобразите параметры **шифрования** .
1. Снимите флажок рядом с параметром **использовать собственный ключ** .

## <a name="next-steps"></a>Дальнейшие действия

- [Шифрование службы хранилища Azure для неактивных данных](storage-service-encryption.md)
- [Об Azure Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-overview)
