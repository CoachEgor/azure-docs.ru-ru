---
title: Запуск отработки отказа учетной записи хранения
titleSuffix: Azure Storage
description: Сведения об инициации отработки отказа учетной записи в случае, когда основная конечная точка для вашей учетной записи хранения становится недоступной. Отработка отказа преобразует дополнительный регион в основной регион учетной записи хранения.
services: storage
author: tamram
ms.service: storage
ms.topic: article
ms.date: 05/05/2020
ms.author: tamram
ms.reviewer: cbrooks
ms.subservice: common
ms.openlocfilehash: 8de5290c41e6213e61b7b5b09cffba1f4638df30
ms.sourcegitcommit: c535228f0b77eb7592697556b23c4e436ec29f96
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2020
ms.locfileid: "82857037"
---
# <a name="initiate-a-storage-account-failover"></a>Запуск отработки отказа учетной записи хранения

Если первичная конечная точка геоизбыточной учетной записи хранения становится недоступной по какой-либо причине, можно запустить отработку отказа учетной записи. Отработка отказа преобразует дополнительную конечную точку в основную конечную точку учетной записи хранения. Когда отработка отказа завершится, клиенты смогут записывать данные в новый основной регион. Принудительная отработка отказа позволяет поддерживать высокий уровень доступности для ваших приложений.

В этой статье показано, как запустить отработку отказа учетной записи для учетной записи хранения с помощью портала Azure, PowerShell или интерфейса командной строки Azure. Дополнительные сведения об отработке отказа см. в статье [Аварийное восстановление и отработка отказа учетной записи хранения](storage-disaster-recovery-guidance.md).

> [!WARNING]
> Отработка отказа учетной записи обычно приводит к потере некоторых данных. Чтобы понять влияние данных и последствия отработки отказа учетной записи, обратитесь к статье [Understand the account failover process](storage-disaster-recovery-guidance.md#understand-the-account-failover-process) (Понимание процесса отработки отказа учетной записи).

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]

## <a name="prerequisites"></a>Предварительные требования

Прежде чем можно будет выполнить отработку отказа учетной записи хранения, убедитесь, что ваша учетная запись хранения настроена для георепликации. Ваша учетная запись хранения может использовать любой из следующих вариантов избыточности:

- Геоизбыточное хранилище (GRS) или геоизбыточное хранилище с доступом для чтения (RA-GRS)
- Хранилище, избыточное в геопоясе (ГЗРС) или геоизбыточное хранилище с доступом на чтение (RA-ГЗРС)

Дополнительные сведения о избыточности службы хранилища Azure см. в статье [избыточность службы хранилища Azure](storage-redundancy.md).

## <a name="initiate-the-failover"></a>Запуск отработки отказа

## <a name="portal"></a>[Портал](#tab/azure-portal)

Чтобы начать отработку отказа учетной записи на портале Azure, выполните следующие действия.

1. Войдите в свою учетную запись хранения.
2. В разделе **Параметры** выберите **Георепликация**. На следующем рисунке показано состояние георепликации и отработки отказа учетной записи хранения.

    ![Снимок экрана, отображающий состояние георепликации и отработки отказа](media/storage-initiate-account-failover/portal-failover-prepare.png)

3. Убедитесь, что ваша учетная запись хранения настроена для использования геоизбыточного хранилища (GRS) или геоизбыточного хранилища с доступом для чтения (RA-GRS). Если это не так, то выберите **Конфигурация** под разделом **Параметры**, чтобы обновить учетную запись до геоизбыточной. 
4. Свойство **Время последней синхронизации** указывает на расстояние между дополнительным и основным регионами. **Время последней синхронизации** дает возможность оценить объем потери данных после завершения отработки отказа.
5. Выберите **Подготовка к отработке отказа**.
6. Просмотрите диалоговое окно подтверждения. Когда будете готовы, введите **Да**, чтобы подтвердить и запустить отработку отказа.

    ![Снимок экрана, отображающий диалоговое окно подтверждения в случае отработки отказа учетной записи](media/storage-initiate-account-failover/portal-failover-confirm.png)

## <a name="powershell"></a>[PowerShell](#tab/azure-powershell)

Функция отработки отказа учетной записи общедоступна, но по-прежнему использует модуль предварительной версии для PowerShell. Чтобы запустить отработку отказа учетной записи с помощью PowerShell, сначала необходимо установить модуль AZ. Storage [1.1.1-Preview](https://www.powershellgallery.com/packages/Az.Storage/1.1.1-preview) . Чтобы установить модуль, выполните следующие действия.

1. Удалите все ранее установленные версии Azure PowerShell.

    - Удалите все предыдущие установки Azure PowerShell из Windows с помощью параметра **Apps & features** (Приложения и компоненты) в разделе **Параметры**.
    - Удалите все модули **Azure** из `%Program Files%\WindowsPowerShell\Modules`.

1. Убедитесь, что у вас установлена последняя версия PowerShellGet. Откройте окно Windows PowerShell и выполните следующую команду, чтобы установить последнюю версию:

    ```powershell
    Install-Module PowerShellGet –Repository PSGallery –Force
    ```

1. После установки PowerShellGet закройте и снова откройте окно PowerShell.

1. Установите Azure PowerShell последней версии:

    ```powershell
    Install-Module Az –Repository PSGallery –AllowClobber
    ```

1. Установите модуль предварительной версии службы хранилища Azure, поддерживающий отработку отказа учетной записи.

    ```powershell
    Install-Module Az.Storage –Repository PSGallery -RequiredVersion 1.1.1-preview –AllowPrerelease –AllowClobber –Force
    ```

Чтобы инициировать отработку отказа учетной записи с помощью PowerShell, выполните следующую команду.

```powershell
Invoke-AzStorageAccountFailover -ResourceGroupName <resource-group-name> -Name <account-name>
```

## <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

Для отработки отказа с помощью интерфейса командной строки Azure выполните следующие команды.

```azurecli
az storage account show \ --name accountName \ --expand geoReplicationStats
az storage account failover \ --name accountName
```

---

## <a name="important-implications-of-account-failover"></a>Важные последствия отработки отказа учетной записи

При запуске отработки отказа учетной записи для вашей учетной записи хранения записи DNS для дополнительной конечной точки обновляются таким образом, чтобы дополнительная конечная точка становилась основной конечной точкой. Убедитесь, что понимаете возможные последствия для вашей учетной записи хранения, прежде чем начать отработку отказа.

Чтобы оценить возможный объем потери данных, прежде чем начать отработку отказа, проверьте свойство **Время последней синхронизации** с помощью командлета PowerShell `Get-AzStorageAccount` и добавьте параметр `-IncludeGeoReplicationStats`. Затем проверьте свойство `GeoReplicationStats` для вашей учетной записи.

После отработки отказа тип вашей учетной записи хранения автоматически преобразуется в локально избыточное хранилище (LRS) в новом основном регионе. Вы можете снова включить геоизбыточное хранилище (GRS) или геоизбыточное хранилище с доступом для чтения (RA-GRS) для вашего аккаунта. Обратите внимание, что преобразование в тип репликации из LRS на GRS или RA-GRS влечет за собой дополнительные затраты. Дополнительные сведения см. на странице [Сведения о стоимости пропускной способности](https://azure.microsoft.com/pricing/details/bandwidth/).

После повторного включения GRS для учетной записи хранения Microsoft начинает репликацию данных в вашей учетной записи в новый вторичный регион. Время репликации зависит от объема реплицируемых данных.  

## <a name="next-steps"></a>Дальнейшие шаги

- [Аварийное восстановление и отработка отказа учетной записи хранения](storage-disaster-recovery-guidance.md)
- [Использование географической избыточности для разработки высокодоступных приложений](geo-redundant-design.md)
- [Руководство. Создание высокодоступного приложения с хранилищем BLOB-объектов](../blobs/storage-create-geo-redundant-storage.md)
