---
title: Инициация отработки отказа учетной записи хранения (предварительная версия) в службе хранилища Azure
description: Сведения об инициации отработки отказа учетной записи в случае, когда основная конечная точка для вашей учетной записи хранения становится недоступной. Отработка отказа преобразует дополнительный регион в основной регион учетной записи хранения.
services: storage
author: tamram
ms.service: storage
ms.topic: article
ms.date: 02/11/2019
ms.author: tamram
ms.subservice: common
ms.openlocfilehash: fd8eecbd20446bfde8d3a7467e2982398c3b8c19
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60320521"
---
# <a name="initiate-a-storage-account-failover-preview"></a>Инициация отработки отказа учетной записи хранения (предварительная версия)

В случае недоступности основной конечной точки учетной записи геоизбыточного хранилища можете начать отработку отказа учетной записи (предварительная версия). Отработка отказа преобразует дополнительную конечную точку в основную конечную точку учетной записи хранения. Когда отработка отказа завершится, клиенты смогут записывать данные в новый основной регион. Принудительная отработка отказа позволяет поддерживать высокий уровень доступности для ваших приложений.

В этой статье показано, как запустить отработку отказа учетной записи для учетной записи хранения с помощью портала Azure, PowerShell или интерфейса командной строки Azure. Дополнительные сведения об отработке отказа учетной записи см. в статье [Disaster recovery and account failover (preview) in Azure Storage](storage-disaster-recovery-guidance.md) (Аварийное восстановление и отработка отказа учетной записи хранения (предварительная версия) в службе хранилища Azure).

> [!WARNING]
> Отработка отказа учетной записи обычно приводит к потере некоторых данных. Чтобы понять влияние данных и последствия отработки отказа учетной записи, обратитесь к статье [Understand the account failover process](storage-disaster-recovery-guidance.md#understand-the-account-failover-process) (Понимание процесса отработки отказа учетной записи).

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]

## <a name="prerequisites"></a>Технические условия

Перед выполнением отработки отказа учетной записи на вашей учетной записи хранения убедитесь, что выполнены следующие действия.

- Зарегистрируйтесь для предварительной версии отработки отказа учетной записи. Сведения о регистрации см. в разделе [Сведения о предварительной версии](storage-disaster-recovery-guidance.md#about-the-preview).
- Убедитесь, что ваша учетная запись хранения настроена для использования геоизбыточного хранилища (GRS) или геоизбыточного хранилища с доступом для чтения (RA-GRS). Дополнительные сведения о GRS см. в статье [Геоизбыточное хранилище (GRS). Межрегиональная репликация для службы хранилища Azure](storage-redundancy-grs.md). 

## <a name="important-implications-of-account-failover"></a>Важные последствия отработки отказа учетной записи

При запуске отработки отказа учетной записи для вашей учетной записи хранения записи DNS для дополнительной конечной точки обновляются таким образом, чтобы дополнительная конечная точка становилась основной конечной точкой. Убедитесь, что понимаете возможные последствия для вашей учетной записи хранения, прежде чем начать отработку отказа.

Чтобы оценить возможный объем потери данных, прежде чем начать отработку отказа, проверьте свойство **Время последней синхронизации** с помощью командлета PowerShell `Get-AzStorageAccount` и добавьте параметр `-IncludeGeoReplicationStats`. Затем проверьте свойство `GeoReplicationStats` для вашей учетной записи. 

После отработки отказа тип вашей учетной записи хранения автоматически преобразуется в локально избыточное хранилище (LRS) в новом основном регионе. Вы можете снова включить геоизбыточное хранилище (GRS) или геоизбыточное хранилище с доступом для чтения (RA-GRS) для вашего аккаунта. Обратите внимание, что преобразование в тип репликации из LRS на GRS или RA-GRS влечет за собой дополнительные затраты. Дополнительные сведения см. на странице [Сведения о стоимости пропускной способности](https://azure.microsoft.com/pricing/details/bandwidth/). 

После повторного включения GRS для учетной записи хранения Microsoft начинает репликацию данных в вашей учетной записи в новый вторичный регион. Время репликации зависит от объема реплицируемых данных.  

## <a name="azure-portal"></a>Портал Azure

Чтобы начать отработку отказа учетной записи на портале Azure, выполните следующие действия.

1. Войдите в свою учетную запись хранения.
2. В разделе **Параметры** выберите **Георепликация**. На следующем рисунке показано состояние георепликации и отработки отказа учетной записи хранения.

    ![Снимок экрана, отображающий состояние георепликации и отработки отказа](media/storage-initiate-account-failover/portal-failover-prepare.png)

3. Убедитесь, что ваша учетная запись хранения настроена для использования геоизбыточного хранилища (GRS) или геоизбыточного хранилища с доступом для чтения (RA-GRS). Если это не так, то выберите **Конфигурация** под разделом **Параметры**, чтобы обновить учетную запись до геоизбыточной. 
4. Свойство **Время последней синхронизации** указывает на расстояние между дополнительным и основным регионами. **Время последней синхронизации** дает возможность оценить объем потери данных после завершения отработки отказа.
5. Выберите **Подготовка к отработке отказа (предварительная версия)**. 
6. Просмотрите диалоговое окно подтверждения. Когда будете готовы, введите **Да**, чтобы подтвердить и запустить отработку отказа.

    ![Снимок экрана, отображающий диалоговое окно подтверждения в случае отработки отказа учетной записи](media/storage-initiate-account-failover/portal-failover-confirm.png)

## <a name="powershell"></a>PowerShell

Для отработки отказа учетной записи с помощью PowerShell необходимо сначала установить модуль предварительного просмотра 6.0.1. Чтобы установить модуль, выполните следующие действия.

1. Удалите все ранее установленные версии Azure PowerShell.

    - Удалите все предыдущие установки Azure PowerShell из Windows с помощью параметра **Apps & features** (Приложения и компоненты) в разделе **Параметры**.
    - Удалите все модули **Azure*** из `%Program Files%\WindowsPowerShell\Modules`.
    
1. Убедитесь, что у вас установлена последняя версия PowerShellGet. Откройте окно Windows PowerShell и выполните следующую команду, чтобы установить последнюю версию:
 
    ```powershell
    Install-Module PowerShellGet –Repository PSGallery –Force
    ```
1. После установки PowerShellGet закройте и снова откройте окно PowerShell. 

1. Установите Azure PowerShell последней версии:

    ```powershell
    Install-Module Az –Repository PSGallery –AllowClobber
    ```

1. Установите модуль службы хранилища Azure, используемый в режиме предварительной версии, который поддерживает Azure AD.
   
    ```powershell
    Install-Module Az.Storage –Repository PSGallery -RequiredVersion 1.1.1-preview –AllowPrerelease –AllowClobber –Force 
    ```
1. Закройте и снова откройте окно PowerShell.
 

Чтобы инициировать отработку отказа учетной записи с помощью PowerShell, выполните следующую команду.

```powershell
Invoke-AzStorageAccountFailover -ResourceGroupName <resource-group-name> -Name <account-name> 
```

## <a name="azure-cli"></a>Инфраструктура CLI Azure

Для отработки отказа с помощью интерфейса командной строки Azure выполните следующие команды.

```cli
az storage account show \ --name accountName \ --expand geoReplicationStats
az storage account failover \ --name accountName
```

## <a name="next-steps"></a>Дальнейшие действия

- [Disaster recovery and storage account failover (preview) in Azure Storage](storage-disaster-recovery-guidance.md) (Аварийное восстановление и отработка отказа учетной записи хранения (предварительная версия) в службе хранилища Azure)
- [Проектирование высокодоступных приложений с использованием RA-GRS](storage-designing-ha-apps-with-ragrs.md)
- [Руководство Создание высокодоступного приложения с помощью хранилища BLOB-объектов](../blobs/storage-create-geo-redundant-storage.md). 
