---
title: Создание высокодоступных приложений службы хранилища Azure с хранилищем, избыточным в геопоясе (ГЗРС) (Предварительная версия) | Документация Майкрософт
description: Хранилище, избыточное в геопоясе (ГЗРС), сочетает высокий уровень доступности хранилища, избыточного в рамках зоны (ZRS), с защитой от региональных простоев, предоставляемых географически избыточным хранилищем (GRS). Данные в учетной записи хранения ГЗРС реплицируются между зонами доступности Azure в основном регионе, а также реплицируются в дополнительный географический регион для защиты от региональных аварий.
author: tamram
ms.service: storage
ms.topic: conceptual
ms.date: 08/13/2019
ms.author: tamram
ms.reviewer: artek
ms.subservice: common
ms.openlocfilehash: c102941920d2b8746a49be47ef4c5613fa0bc281
ms.sourcegitcommit: f52ce6052c795035763dbba6de0b50ec17d7cd1d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2020
ms.locfileid: "76719081"
---
# <a name="build-highly-available-azure-storage-applications-with-geo-zone-redundant-storage-gzrs-preview"></a>Создание высокодоступных приложений службы хранилища Azure с хранилищем, избыточным в геопоясе (ГЗРС) (Предварительная версия)

Хранилище, избыточное в геопоясе (ГЗРС) (Предварительная версия), сочетает высокий уровень доступности [хранилища, избыточного в рамках зоны (ZRS)](storage-redundancy-zrs.md) , с защитой от региональных простоев, предоставляемых [географически избыточным хранилищем (GRS)](storage-redundancy-grs.md). Данные в учетной записи хранения ГЗРС реплицируются по трем [зонам доступности Azure](../../availability-zones/az-overview.md) в основном регионе, а также реплицируются в дополнительный географический регион для защиты от региональных аварий. Каждый регион Azure образует пару с другим регионом в пределах той же географической территории. Эти два региона формируют пару регионов. Дополнительные сведения и исключения см. в [документации](https://docs.microsoft.com/azure/best-practices-availability-paired-regions).

С помощью учетной записи хранения ГЗРС можно продолжить чтение и запись данных, если зона доступности становится недоступной или невосстанавливаемой. Кроме того, ваши данные также устойчивы в случае полного сбоя в регионе или аварии, в которой основной регион не может быть восстановлен. ГЗРС предназначен для предоставления минимума 99,99999999999999% (16) устойчивости объектов в течение заданного года. ГЗРС также предоставляет те же целевые показатели масштабируемости, что и LRS, ZRS, GRS или RA-GRS. При необходимости можно включить доступ на чтение к данным в дополнительном регионе с хранилищем, избыточным в геозону с доступом на чтение (RA-ГЗРС), если приложения должны иметь возможность считывать данные в случае аварии в основном регионе.

Корпорация Майкрософт рекомендует использовать ГЗРС для приложений, которым требуются согласованность, устойчивость, высокая доступность, отличная производительность и устойчивость к аварийному восстановлению. Для дополнительной защиты доступа на чтение к дополнительному региону в случае региональной аварии включите RA-ГЗРС для вашей учетной записи хранения.

## <a name="about-the-preview"></a>Сведения о предварительной версии

ГЗРС и RA-ГЗРС поддерживают только учетные записи хранения общего назначения версии 2. Дополнительные сведения о типах учетных записей хранения см. в статье [Общие сведения об учетной записи хранения](storage-account-overview.md). ГЗРС и RA-ГЗРС поддерживают блочные и страничные BLOB-объекты (не являющиеся дисками VHD), файлы, таблицы и очереди.

ГЗРС и RA-ГЗРС в настоящее время доступны для предварительного просмотра в следующих регионах:

- Юго-восточная Азия
- Северная Европа
- Западная Европа
- Восточная Япония
- южная часть Соединенного Королевства
- Восточная часть США
- Восточная часть США 2
- Центральная часть США

Корпорация Майкрософт продолжит включать ГЗРС и RA-ГЗРС в дополнительных регионах Azure. Для получения сведений о поддерживаемых регионах регулярно проверяйте страницу [обновлений службы Azure](https://azure.microsoft.com/updates/) .

Сведения о ценах на предварительную версию см. в разделе цены на предварительную версию ГЗРС для [больших двоичных объектов](https://azure.microsoft.com/pricing/details/storage/blobs), [файлов](https://azure.microsoft.com/pricing/details/storage/files/), [очередей](https://azure.microsoft.com/pricing/details/storage/queues/)и [таблиц](https://azure.microsoft.com/pricing/details/storage/tables/).

> [!IMPORTANT]
> Корпорация Майкрософт рекомендует использовать предварительные версии функций для рабочих нагрузок.

## <a name="how-gzrs-and-ra-gzrs-work"></a>Как работают ГЗРС и RA-ГЗРС

При записи данных в учетную запись хранения с включенным ГЗРС или RA-ГЗРС эти данные сначала реплицируются синхронно в основном регионе в трех зонах доступности. Затем данные реплицируются асинхронно во второй регион, который находится в сотнях миль. Когда данные записываются в дополнительный регион, они также реплицируются в три раза в пределах этого региона с помощью [локально избыточного хранилища (LRS)](storage-redundancy-lrs.md).

> [!IMPORTANT]
> Асинхронная репликация включает задержку между моментом, когда данные записываются в основной регион и когда она реплицируется в дополнительный регион. В случае региональной аварии изменения, которые еще не реплицированные в дополнительный регион, могут быть потеряны, если данные будет невозможно восстановить из основного региона.

При создании учетной записи хранения необходимо указать способ репликации данных в этой учетной записи, а также указать основной регион для этой учетной записи. Парный дополнительный регион для геореплицированной учетной записи определяется на основе основного региона и не может быть изменен. Обновленную информацию о регионах, поддерживаемых Azure, см. в статье [Непрерывность бизнес-процессов и аварийное восстановление в службах BizTalk: пары регионов Azure](https://docs.microsoft.com/azure/best-practices-availability-paired-regions). Сведения о создании учетной записи хранения с помощью ГЗРС или RA-ГЗРС см. [в статье Создание учетной записи хранения](storage-account-create.md).

### <a name="use-ra-gzrs-for-high-availability"></a>Использование RA-ГЗРС для обеспечения высокой доступности

При включении RA-ГЗРС для учетной записи хранения данные можно считывать из дополнительной конечной точки, а также из основной конечной точки для учетной записи хранения. Вторичная конечная точка добавляет суффикс *— Secondary* к имени учетной записи. Например, если первичная конечная точка для службы BLOB-объектов — `myaccount.blob.core.windows.net`, то вторичная конечная точка — `myaccount-secondary.blob.core.windows.net`. Ключи доступа для учетной записи хранения одинаковые как для первичной, так и для вторичной конечных точек.

Чтобы воспользоваться преимуществами RA-ГЗРС в случае регионального сбоя, необходимо разработать приложение заранее для обработки этого сценария. Приложение должно выполнять чтение и запись в основную конечную точку, но переключитесь на использование вторичной конечной точки в случае, если основной регион становится недоступным. Рекомендации по проектированию для обеспечения высокой доступности с помощью RA-ГЗРС см. в статье [Разработка высокодоступных приложений с помощью RA-гзрс или RA-GRS](https://docs.microsoft.com/azure/storage/common/storage-designing-ha-apps-with-ragrs).

Так как данные реплицируются в дополнительный регион асинхронно, дополнительный регион часто находится за основным регионом. Чтобы определить, какие операции записи были реплицированы в дополнительный регион, приложение проверяет время последней синхронизации для учетной записи хранения. Все операции записи, записанные в основной регион до последней синхронизации, были успешно реплицированы в дополнительный регион. Это означает, что они доступны для чтения из базы данных-получателя. Любые операции записи, записанные в основной регион после последней синхронизации, могут быть или не реплицированы в дополнительный регион. Это означает, что они могут быть недоступны для операций чтения.

Вы можете запросить значение свойства **время последней синхронизации** с помощью Azure PowerShell, Azure CLI или одной из клиентских библиотек службы хранилища Azure. **Последнее свойство время синхронизации** — это значение даты и времени по Гринвичу.

Дополнительные рекомендации по производительности и масштабируемости с помощью RA-ГЗРС см. в разделе [Служба хранилища Microsoft Azure производительность и контрольный список масштабируемости](storage-performance-checklist.md).

### <a name="availability-zone-outages"></a>Сбои в зонах доступности

В случае сбоя, влияющего на зону доступности в основном регионе, ваши приложения могут без проблем выполнять чтение и запись в учетную запись хранения, используя другие зоны доступности для этого региона. Корпорация Майкрософт рекомендует следовать рекомендациям по обработке временных сбоев при использовании ГЗРС или ZRS. Эти рекомендации включают в себя внедрение политик повтора с экспоненциальной задержкой.

Когда зона доступности становится недоступной, Azure принимает сетевые обновления, такие как повторное указание DNS. Эти обновления могут повлиять на приложение при доступе к данным до завершения обновления.

### <a name="regional-outages"></a>Региональные сбои

Если сбой влияет на весь основной регион, корпорация Майкрософт сначала попытается восстановить основной регион. Если восстановление невозможно, Майкрософт выполнит отработку отказа в дополнительный регион, чтобы дополнительный регион стал новым основным регионом. Если в учетной записи хранения включено RA-ГЗРС, то приложения, разработанные для этого сценария, могут выполнять чтение из дополнительного региона во время ожидания отработки отказа. Если в учетной записи хранения не включена RA-ГЗРС, то приложения не смогут считывать сведения из базы данных-получателя до завершения отработки отказа.

> [!NOTE]
> ГЗРС и RA-ГЗРС в настоящее время доступны в предварительной версии только в Восточном регионе США. Управляемая клиентом отработка отказа (Предварительная версия) еще недоступна в восточной части США 2, поэтому клиенты не могут управлять событиями отработки отказа учетной записи ГЗРС и RA-ГЗРС. Во время предварительной версии Корпорация Майкрософт будет управлять событиями отработки отказа, затрагивающими учетные записи ГЗРС и RA-ГЗРС.

Так как данные реплицируются в дополнительный регион асинхронно, сбой, влияющий на основной регион, может привести к утере данных, если основной регион восстановить нельзя. Интервал между последними операциями записи в основной регион и последней записью в дополнительный регион называется целевой точкой восстановления (RPO). RPO указывает момент времени, до которого данные могут быть восстановлены. Служба хранилища Azure обычно имеет значение RPO менее чем за 15 минут, хотя в настоящее время нет соглашения об уровне обслуживания относительно того, сколько времени занимает репликация данных в дополнительный регион.

Целевое время восстановления (RTO) — это мера времени, затрачиваемого на выполнение отработки отказа и возврат учетной записи хранения в оперативный режим. Эта мера указывает время, необходимое Azure для выполнения отработки отказа путем изменения основных записей DNS, чтобы они указывали на дополнительное расположение.

## <a name="migrate-a-storage-account-to-gzrs-or-ra-gzrs"></a>Миграция учетной записи хранения в ГЗРС или RA-ГЗРС

Любую существующую учетную запись хранения можно перенести в ГЗРС или RA-ГЗРС. Миграция с существующей учетной записи ZRS на ГЗРС или RA-ГЗРС является простой задачей, а миграция с учетной записи LRS, GRS или RA-GRS является более сложной. В следующих разделах описано, как выполнить миграцию в любом случае.

**Известные ограничения**

- В настоящее время архивный уровень не поддерживается в учетных записях ГЗРС (RA-). Дополнительные сведения см. в статье [хранилище BLOB-объектов Azure: горячий, стильный и архивный уровни доступа](https://docs.microsoft.com/azure/storage/blobs/storage-blob-storage-tiers) .
- Управляемые диски не поддерживают (RA-) ГЗРС. Вы можете хранить моментальные снимки и образы для SSD (цен. категория "Стандартный") управляемых дисков в хранилище HDD (цен. категория "Стандартный") и [выбирать параметры LRS и ZRS](https://azure.microsoft.com/pricing/details/managed-disks/).

### <a name="migrating-from-a-zrs-account"></a>Миграция с учетной записи ZRS

Чтобы преобразовать существующую учетную запись ZRS в RA-ГЗРС, используйте командлет [Set-азсторажеаккаунт](/powershell/module/az.storage/set-azstorageaccount) , чтобы изменить номер SKU для учетной записи. Не забудьте заменить значения заполнителей собственными значениями:

```powershell
Set-AzStorageAccount -ResourceGroupName <resource-group> -AccountName <storage-account> -SkuName "Standard_RAGZRS"
```

### <a name="migrating-from-an-lrs-grs-or-ra-grs-account"></a>Миграция из учетной записи LRS, GRS или RA-GRS

Существует два варианта перехода на ГЗРС или RA-ГЗРС из учетной записи LRS, GRS или RA-GRS:

- Вы можете вручную скопировать или переместить данные в новую учетную запись ГЗРС или RA-ГЗРС из существующей учетной записи.
- Вы можете запросить динамическую миграцию.

#### <a name="perform-a-manual-migration"></a>Выполнение миграции вручную

Если вам требуется выполнение миграции на определенную дату, попробуйте выполнить миграцию вручную. Она обеспечивает большую гибкость, чем динамическая. При миграции вручную можно контролировать время миграции.

Чтобы вручную перенести данные из существующей учетной записи в учетную запись ГЗРС или RA-ГЗРС, используйте средство, позволяющее эффективно копировать данные. Некоторые примеры:

- Используйте такую служебную программу, как AzCopy, или надежное стороннее средство. Дополнительные сведения о AzCopy см. в статье [Приступая к работе с AzCopy](storage-use-azcopy-v10.md).
- Если вы знакомы с Hadoop или HDInsight, подключите их к кластеру как исходную, так и целевую учетную запись хранения. Затем параллелизации процесс копирования данных с помощью такого средства, как DistCp.
- Разработайте собственный инструмент с помощью одной из клиентских библиотек службы хранилища Azure.

#### <a name="perform-a-live-migration"></a>Выполнение динамической миграции

Миграция вручную может вызвать простой приложения. Если приложению требуется высокий уровень доступности, корпорация Майкрософт также предоставляет возможность динамической миграции. Динамическая миграция — это миграция "на месте" без простоев.

Во время динамической миграции вы можете использовать учетную запись хранения во время миграции данных между исходной и целевой учетными записями хранения. В процессе динамической миграции ваша учетная запись будет по своему соглашению соблюдать соглашение об уровне обслуживания для обеспечения устойчивости и доступности. Нет простоев или потерь данных, вызванных динамической миграцией.

Только учетные записи общего назначения v2 поддерживают ГЗРС/RA-ГЗРС, поэтому перед отправкой запроса на динамическую миграцию в ГЗРС/RA-ГЗРС необходимо обновить учетную запись до общего назначения версии 2. Дополнительные сведения см. в статье [Обзор учетной записи хранения Azure](https://docs.microsoft.com/azure/storage/common/storage-account-overview) и [обновление до учетной записи хранения общего назначения версии 2](https://docs.microsoft.com/azure/storage/common/storage-account-upgrade).

После завершения миграции параметр репликации учетной записи хранения будет обновлен до хранилища с избыточной **зоной (гзрс)** или **хранилища с избыточной зоной с доступом на чтение (RA-гзрс)** . Конечные точки служб, ключи доступа, подписанные URL-адрес (SAS) и другие параметры конфигурации учетной записи остаются без изменений.

Учитывайте следующие ограничения на динамическую миграцию:

- Хотя корпорация Майкрософт незамедлительно отреагирует на запрос динамической миграции, нет никакой гарантии относительно времени ее завершения. Если вам нужны данные, перенесенные в ГЗРС или RA-ГЗРС по определенной дате, корпорация Майкрософт рекомендует выполнить миграцию вручную. Как правило, чем больше данных в вашей учетной записи, тем дольше будет выполняться их перенос.
- Динамическая миграция поддерживается только для учетных записей хранения, использующих репликацию GRS или RA-GRS. Если ваша учетная запись использует LRS, необходимо сначала изменить тип репликации учетной записи на GRS или RA-GRS перед продолжением. Этот промежуточный шаг добавляет вторичную конечную точку, предоставляемую GRS/RA-GRS.
- Учетная запись должна содержать данные.
- Данные можно переносить только в рамках одного региона.
- Только учетные записи хранения цен. категории "Стандартный" поддерживают динамическую миграцию. Учетные записи хранения цен. категории "Премиум" необходимо переносить вручную.
- Динамическая миграция из учетной записи ГЗРС или RA-ГЗРС в учетную запись LRS, GRS или RA-GRS не поддерживается. Необходимо вручную переместить данные в новую или существующую учетную запись хранения.
- Вы можете запросить динамическую миграцию из RA-GRS в RA-ГЗРС. Однако миграция из RA-GRS в ГЗРС не поддерживается. В этом случае необходимо запросить динамическую миграцию в RA-ГЗРС, а затем вручную преобразовать учетную запись хранения для использования ГЗРС.
- Управляемые диски поддерживают только LRS и не могут быть перенесены в ГЗРС или RA-ГЗРС. Сведения об интеграции с группами доступности см. [в статье Общие сведения о управляемых дисках Azure](https://docs.microsoft.com/azure/virtual-machines/windows/managed-disks-overview#integration-with-availability-sets).
- Вы можете хранить моментальные снимки и образы для SSD (цен. категория "Стандартный") управляемых дисков в хранилище HDD (цен. категория "Стандартный") и [выбирать параметры LRS, ZRS, гзрс и RA-гзрс](https://azure.microsoft.com/pricing/details/managed-disks/).
- Учетные записи, содержащие большие файловые ресурсы, не поддерживаются для ГЗРС.

Чтобы запросить динамическую миграцию, используйте [портал Azure](https://ms.portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/overview). На портале выберите учетную запись хранения для миграции в ГЗРС или RA-ГЗРС и выполните следующие инструкции:

1. Выберите **новый запрос в службу поддержки**.
2. Заполните раздел **Основные сведения**, основываясь на информации об учетной записи. В разделе **Служба** выберите **Управление учетной записью хранения** и укажите учетную запись для переноса.
3. Выберите **Далее**.
4. Укажите следующие значения в разделе **Проблема**:
    - **Серьезность**. Оставьте значение по умолчанию.
    - **Тип проблемы**. Выберите **Миграция данных**.
    - **Категория**: выберите **Миграция в (RA-) гзрс в пределах региона**.
    - **Title (заголовок**): введите описательное название, например **(RA-) миграция учетной записи гзрс**.
    - **Сведения**: введите дополнительные сведения в поле **сведения** , например "я хочу перейти на гзрс из [LRS, GRS] в \_\_ региона". или "я хочу перейти на RA-ГЗРС из [LRS, RA-GRS] в \_\_ региона".
5. Выберите **Далее**.
6. Проверьте правильность контактных данных в колонке **Контактные данные**.
7. Нажмите кнопку **Создать**.

Специалист службы поддержки свяжется с вами, чтобы предоставить помощь.

## <a name="see-also"></a>См. также раздел

- [Репликация службы хранилища Azure](https://docs.microsoft.com/azure/storage/common/storage-redundancy)
- [Локально избыточное хранилище (LRS). Недорогая избыточность данных для службы хранилища Azure](https://docs.microsoft.com/azure/storage/common/storage-redundancy-lrs)
- [Хранилище, избыточное между зонами (ZRS). Высокодоступные приложения для службы хранилища Azure](https://docs.microsoft.com/azure/storage/common/storage-redundancy-zrs) 
- [Целевые показатели масштабируемости и производительности для учетных записей хранения ценовой категории "Стандартный"](scalability-targets-standard-account.md)
