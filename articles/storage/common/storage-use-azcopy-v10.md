---
title: Копирование или перемещение данных в хранилище Azure с помощью AzCopy v10 Документы Майкрософт
description: AzCopy — это утилита командной строки, которую можно использовать для копирования данных в учетные записи или между ними. Эта статья поможет вам скачать AzCopy, подключиться к учетной записи хранения, а затем передать файлы.
author: normesta
ms.service: storage
ms.topic: conceptual
ms.date: 10/23/2019
ms.author: normesta
ms.subservice: common
ms.openlocfilehash: 90adb3b973b6952d10ef89e4b40d0fc68489e224
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80061107"
---
# <a name="get-started-with-azcopy"></a>Начало работы с AzCopy

AzCopy — это утилита командной строки, которую можно использовать для копирования капли или файлов в учетную запись или из учетной записи хранения. Эта статья поможет вам скачать AzCopy, подключиться к учетной записи хранения, а затем передать файлы.

> [!NOTE]
> AzCopy **V10** является поддерживаемой в настоящее время версией AzCopy.
>
> Если вам нужно использовать AzCopy **v8.1,** [см.](#previous-version)

<a id="download-and-install-azcopy" />

## <a name="download-azcopy"></a>Скачивание AzCopy

Во-первых, загрузите исполняемый файл AzCopy V10 в любой каталог на вашем компьютере. AzCopy V10 является просто исполняемым файлом, так что нет ничего, чтобы установить.

- [Windows 64-битная](https://aka.ms/downloadazcopy-v10-windows) (зип)
- [Windows 32-битный](https://aka.ms/downloadazcopy-v10-windows-32bit) (zip)
- [Linux](https://aka.ms/downloadazcopy-v10-linux) (TAR-файл)
- [MacOS](https://aka.ms/downloadazcopy-v10-mac) (ZIP-файл)

Эти файлы сжимаются как почтовый файл (Windows и Mac) или файл смолы (Linux). Чтобы загрузить и распаковать файл смолы на Linux, смотрите документацию для дистрибутива Linux.

> [!NOTE]
> Если вы хотите скопировать данные в службу [хранения azure Table](https://docs.microsoft.com/azure/storage/tables/table-storage-overview) и из нее, [установите версию AzCopy 7.3.](https://aka.ms/downloadazcopynet)


## <a name="run-azcopy"></a>Выполнить AzCopy

Для удобства рассмотрите возможность добавления расположения каталога AzCopy, исполняемого для простоты использования. Таким образом, `azcopy` вы можете ввести из любого каталога в вашей системе.

Если вы решите не добавлять каталог AzCopy на свой путь, вам придется изменить каталоги на `azcopy` местоположение `.\azcopy` вашей AzCopy исполняемых и типа или в подсказок команды Windows PowerShell.

Чтобы увидеть список команд, `azcopy -h` введите, а затем нажмите на ключ ENTER.

Чтобы узнать о конкретной команде, просто включите `azcopy list -h`название команды (например: ).

![Вливая помощь](media/storage-use-azcopy-v10/azcopy-inline-help.png)

Чтобы найти подробную справочную документацию для каждого параметра команды и команды, [см.](storage-ref-azcopy.md)

> [!NOTE] 
> Как владелец учетной записи хранилища Azure, вы автоматически не получаете разрешения на доступ к данным. Прежде чем вы сможете сделать что-либо значимое с AzCopy, вам нужно решить, как вы будете предоставлять учетные данные авторизации службе хранения. 

## <a name="choose-how-youll-provide-authorization-credentials"></a>Выберите, как вы будете предоставлять учетные данные авторизации

Вы можете предоставить учетные данные авторизации с помощью Active Directory (AD) Azure или с помощью маркера общей подписи доступа (SAS).

Используйте эту таблицу в качестве руководства:

| Тип хранилища | В настоящее время поддерживается метод авторизации |
|--|--|
|**Хранилище BLOB-объектов** | Azure AD & SAS |
|**Хранилище Blob (иерархическое пространство имен)** | Azure AD & SAS |
|**Хранилище файлов** | Только SAS |

### <a name="option-1-use-azure-active-directory"></a>Вариант 1: Используйте активный каталог Azure

Используя Active Directory Azure, вы можете предоставить учетные данные один раз вместо того, чтобы пригонять маркер SAS к каждой команде.  

> [!NOTE]
> В текущем выпуске, если вы планируете копировать капли между учетными записями хранения, вам придется присвоить маркер SAS к каждому URL-адресу источника. Опустить токен SAS можно только из URL-адреса назначения. Например, [см. Copy blobs между учетными записями хранения.](storage-use-azcopy-blobs.md)

Уровень авторизации, который вам нужен, зависит от того, планируете ли вы загружать файлы или просто загружать их.

Если вы просто хотите загрузить файлы, убедитесь, что [Data Reader хранилища](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#storage-blob-data-reader) был назначен вашей личности пользователя, управляемой идентификации или основной службы.

> Идентификаторы пользователей, управляемые идентификаторы и принципы службявляются каждый тип *принципа безопасности,* поэтому мы будем использовать *принцип безопасности* термина для остальной части этой статьи.

Если вы хотите загрузить файлы, убедитесь, что одна из этих ролей была назначена принципу безопасности:

- [участник данных BLOB-объектов хранилища](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#storage-queue-data-contributor);
- [владелец данных BLOB-объектов хранилища](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#storage-blob-data-owner);

Эти роли могут быть назначены директору безопасности в любой из этих областей:

- Контейнер (файловая система)
- Учетная запись хранения
- Группа ресурсов
- Подписка

Чтобы узнать, как проверить и назначить роли, см. [Грант доступ к Azure blob и данные очереди с RBAC на портале Azure.](https://docs.microsoft.com/azure/storage/common/storage-auth-aad-rbac-portal?toc=%2fazure%2fstorage%2fblobs%2ftoc.json)

> [!NOTE]
> Имейте в виду, что распространение ролевых заданий RBAC может занять до пяти минут.

Вам не нужно, чтобы одна из этих ролей была назначена доверительной службе, если ваш принцип безопасности добавлен в список управления доступом (ACL) целевого контейнера или каталога. В ACL принципу безопасности необходимо написать разрешение в целевом каталоге и выполнить разрешение в контейнере и каждом родительском каталоге.

Чтобы узнать больше, смотрите [элемент управления доступом в Azure Data Lake Storage Gen2](https://docs.microsoft.com/azure/storage/blobs/data-lake-storage-access-control).

#### <a name="authenticate-a-user-identity"></a>Authenticate идентификация пользователя

После проверки того, что вашей пользовательской идентификации был задан необходимый уровень авторизации, откройте запрос команды, введите следующую команду, а затем нажмите клавишу ENTER.

```azcopy
azcopy login
```

Если вы принадлежите к более чем одной организации, включите идентификатор клиента организации, к которой принадлежит учетная запись хранилища.

```azcopy
azcopy login --tenant-id=<tenant-id>
```

Замените `<tenant-id>` заполнителя идентификатором арендатора организации, к которой принадлежит счет хранения. Чтобы найти идентификатор клиента, на портале Azure Active Directory > Properties > Идентификатор каталога — выберите **идентификатор Active Directory.**

Эта команда возвращает код проверки подлинности и URL-адрес веб-сайта. Откройте веб-сайт, укажите код и нажмите кнопку **Далее**.

![Создание контейнера](media/storage-use-azcopy-v10/azcopy-login.png)

Откроется окно входа. В этом окне войдите в свою учетную запись Azure с помощью соответствующих данных. Выполнив вход, можно закрыть окно браузера и начать работу с AzCopy.

<a id="service-principal" />

#### <a name="authenticate-a-service-principal"></a>Authenticate директор службы

Это отличный вариант, если вы планируете использовать AzCopy внутри скрипта, который работает без взаимодействия с пользователем, особенно при запуске на месте. Если вы планируете запустить AzCopy на вс-мизансах, которые работают в Azure, можно легко администрировать итог управляемой службы. Чтобы узнать больше, смотрите [раздел «Проверка подлинности управляемого удостоверения»](#managed-identity) этой статьи.

Перед запуском сценария необходимо зарегистрироваться в интерактивном режиме по крайней мере один раз, чтобы предоставить AzCopy учетные данные директора службы.  Эти учетные данные хранятся в защищенном и зашифрованном файле, так что ваш скрипт не должен предоставлять эту конфиденциальную информацию.

Вы можете войти в свой аккаунт, используя секрет клиента или используя пароль сертификата, который связан с регистрацией приложения директора службы.

Чтобы узнать больше о создании основного сервиса, [см. Как: Используйте портал для создания приложения Azure AD и принципа службы, которые могут получить доступ к ресурсам.](https://docs.microsoft.com/azure/active-directory/develop/howto-create-service-principal-portal)

Чтобы узнать больше о принципах службы в целом, смотрите [основные объекты приложений и службы в каталоге Active](https://docs.microsoft.com/azure/active-directory/develop/app-objects-and-service-principals)

##### <a name="using-a-client-secret"></a>Использование секрета клиента

Начните с `AZCOPY_SPA_CLIENT_SECRET` установки переменной среды для секрета клиента регистрации приложения директора службы.

> [!NOTE]
> Убедитесь в том, чтобы установить это значение из вашей команды запрос, а не в среде переменных параметров вашей операционной системы. Таким образом, значение доступно только для текущей сессии.

Этот пример показывает, как это можно сделать в PowerShell.

```azcopy
$env:AZCOPY_SPA_CLIENT_SECRET="$(Read-Host -prompt "Enter key")"
```

> [!NOTE]
> Рассмотрите возможность использования запроса, показанного в этом примере. Таким образом, ваш пароль не будет отображаться в истории команд вашей консоли.  

Затем введите следующую команду, а затем нажмите клавишу ENTER.

```azcopy
azcopy login --service-principal --application-id <application-id> --tenant-id=<tenant-id>
```

Замените `<application-id>` заполнителя идентификатором приложения регистрации приложения директора службы. Замените `<tenant-id>` заполнителя идентификатором арендатора организации, к которой принадлежит счет хранения. Чтобы найти идентификатор клиента, на портале Azure Active Directory > Properties > Идентификатор каталога — выберите **идентификатор Active Directory.** 

##### <a name="using-a-certificate"></a>Использование сертификата

Если вы предпочитаете использовать свои собственные учетные данные для авторизации, вы можете загрузить сертификат на регистрацию приложения, а затем использовать этот сертификат для входа в систему.

В дополнение к загрузке сертификата на регистрацию приложения, вам также необходимо иметь копию сертификата, сохраненного в машине или VM, где будет работать AzCopy. Эта копия сертификата должна быть в . PFX или . формат PEM, и должен включать в себя частный ключ. Частный ключ должен быть защищен паролем. Если вы используете Windows, а сертификат существует только в магазине сертификатов, обязательно экспортируйте этот сертификат в файл PFX (включая закрытый ключ). Для руководства [см. Экспорт-PfxCertificate](https://docs.microsoft.com/powershell/module/pkiclient/export-pfxcertificate?view=win10-ps)

Затем установите `AZCOPY_SPA_CERT_PASSWORD` переменную среды в пароль сертификата.

> [!NOTE]
> Убедитесь в том, чтобы установить это значение из вашей команды запрос, а не в среде переменных параметров вашей операционной системы. Таким образом, значение доступно только для текущей сессии.

Этот пример показывает, как вы могли бы выставить эту задачу в PowerShell.

```azcopy
$env:AZCOPY_SPA_CERT_PASSWORD="$(Read-Host -prompt "Enter key")"
```

Затем введите следующую команду, а затем нажмите клавишу ENTER.

```azcopy
azcopy login --service-principal --certificate-path <path-to-certificate-file> --tenant-id=<tenant-id>
```

Замените `<path-to-certificate-file>` заполнителя относительным или полностью квалифицированным путем к файлу сертификата. AzCopy сохраняет путь к этому сертификату, но не сохраняет копию сертификата, поэтому убедитесь, что этот сертификат сохраняется. Замените `<tenant-id>` заполнителя идентификатором арендатора организации, к которой принадлежит счет хранения. Чтобы найти идентификатор клиента, на портале Azure Active Directory > Properties > Идентификатор каталога — выберите **идентификатор Active Directory.**

> [!NOTE]
> Рассмотрите возможность использования запроса, показанного в этом примере. Таким образом, ваш пароль не будет отображаться в истории команд вашей консоли. 

<a id="managed-identity" />

#### <a name="authenticate-a-managed-identity"></a>Authenticate управляемая личность

Это отличный вариант, если вы планируете использовать AzCopy внутри скрипта, который работает без взаимодействия с пользователем, и скрипт работает с azure Virtual Machine (VM). При использовании этой опции вам не придется хранить учетные данные на VM.

Вы можете войти в свою учетную запись с помощью общесистемной управляемой идентификации, включенной на VM, или с помощью идентификатора клиента, идентификатора объекта или идентификатора ресурсов управляемого удостоверения, назначенного пользователем, назначенного вашему VM.

Чтобы узнать больше о том, как включить общесистемное управляемое удостоверение или создать управляемое удостоверение, назначенное пользователем, см. На портале [Azure на портале Azure можно настроить управляемые идентификаторы для ресурсов Azure.](../../active-directory/managed-identities-azure-resources/qs-configure-portal-windows-vm.md#enable-system-assigned-managed-identity-on-an-existing-vm)

##### <a name="using-a-system-wide-managed-identity"></a>Использование общесистемного управляемого удостоверения

Во-первых, убедитесь, что вы включили общесистемную управляемую идентификацию на вашем VM. Посмотреть [назначенную System управляемую идентификацию.](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/qs-configure-portal-windows-vm#system-assigned-managed-identity)

Затем, в вашей командной консоли, введите следующую команду, а затем нажмите клавишу ENTER.

```azcopy
azcopy login --identity
```

##### <a name="using-a-user-assigned-managed-identity"></a>Использование управляемого удостоверения, назначенного пользователем

Во-первых, убедитесь, что вы включили назначенную пользователем управляемую идентификацию на вашем VM. Посмотреть [назначенные пользователямуправляемые удостоверения.](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/qs-configure-portal-windows-vm#user-assigned-managed-identity)

Затем, в вашей командной консоли, введите любую из следующих команд, а затем нажмите клавишу ENTER.

```azcopy
azcopy login --identity --identity-client-id "<client-id>"
```

Замените `<client-id>` заполнитель идентификатором клиента управляемого удостоверения, назначенного пользователем.

```azcopy
azcopy login --identity --identity-object-id "<object-id>"
```

Замените `<object-id>` заполнитель идентификатором объекта управляемого удостоверения, назначенного пользователем.

```azcopy
azcopy login --identity --identity-resource-id "<resource-id>"
```

Замените `<resource-id>` заполнитель идентификатором ресурса назначенного пользователем управляемого удостоверения личности.

### <a name="option-2-use-a-sas-token"></a>Вариант 2: Используйте токен SAS

Вы можете присвоить токен SAS к каждому источнику или URL-адресу, который используется в командах AzCopy.

Этот пример команды повторяется копирует данные из локального каталога в контейнер капли. К концу URL-адреса контейнера прикладируется фиктивный токен SAS.

```azcopy
azcopy copy "C:\local\path" "https://account.blob.core.windows.net/mycontainer1/?sv=2018-03-28&ss=bjqt&srt=sco&sp=rwddgcup&se=2019-05-01T05:01:17Z&st=2019-04-30T21:01:17Z&spr=https&sig=MGCXiyEzbtttkr3ewJIh2AR8KrghSy1DGM9ovN734bQF4%3D" --recursive=true
```

Чтобы узнать больше о токенах SAS и о том, как их получить, [см.](https://docs.microsoft.com/azure/storage/common/storage-sas-overview)

## <a name="transfer-files"></a>Перенос файлов

После проверки подлинности вашей личности или получения токена SAS можно начать передачу файлов.

Чтобы найти примеры команд, см.

- [Transfer data with AzCopy and blob storage](storage-use-azcopy-blobs.md) (Передача данных с помощью AzCopy и хранилища BLOB-объектов)

- [Transfer data with AzCopy and file storage](storage-use-azcopy-files.md) (Передача данных с помощью AzCopy и хранилища файлов)

- [Передача данных с помощью AzCopy и контейнеров Amazon S3](storage-use-azcopy-s3.md)

- [Передача данных с помощью хранилища AzCopy и Azure Stack](https://docs.microsoft.com/azure-stack/user/azure-stack-storage-transfer#azcopy)

## <a name="use-azcopy-in-a-script"></a>Использование AzCopy в скрипте

### <a name="obtain-a-static-download-link"></a>Получение статической ссылки загрузки

Со временем ссылка на [загрузку](#download-and-install-azcopy) AzCopy будет указывать на новые версии AzCopy. Если ваш скрипт загружает AzCopy, скрипт может перестать работать, если новая версия AzCopy изменяет функции, от которого зависит ваш скрипт.

Чтобы избежать этих проблем, получите статическое (неизменяющее) соединение с текущей версией AzCopy. Таким образом, ваш сценарий загружает одну и ту же самую версию AzCopy каждый раз, когда он работает.

Чтобы получить ссылку, запустите эту команду:

| Операционная система  | Команда |
|--------|-----------|
| **Linux** | `curl -v https://aka.ms/downloadazcopy-v10-linux` |
| **Windows** | `(curl https://aka.ms/downloadazcopy-v10-windows -MaximumRedirection 0 -ErrorAction silentlycontinue).RawContent` |

> [!NOTE]
> Для Linux `--strip-components=1` `tar` в команде удаляется папка верхнего уровня, содержащая имя версии, и вместо этого извлекает двоичный файл непосредственно в текущую папку. Это позволяет обновлять сценарий новой `azcopy` версией, обновляя только `wget` URL-

URL-адрес отображается в выводе этой команды. Затем скрипт можно загрузить AzCopy, используя этот URL.

| Операционная система  | Команда |
|--------|-----------|
| **Linux** | `wget -O azcopy_v10.tar.gz https://aka.ms/downloadazcopy-v10-linux && tar -xf azcopy_v10.tar.gz --strip-components=1` |
| **Windows** | `Invoke-WebRequest https://azcopyvnext.azureedge.net/release20190517/azcopy_windows_amd64_10.1.2.zip -OutFile azcopyv10.zip <<Unzip here>>` |

### <a name="escape-special-characters-in-sas-tokens"></a>Побег специальных символов в токенах SAS

В пакетных файлах с расширением `.cmd` вам `%` придется избежать символов, которые появляются в токенах SAS. Это можно сделать, `%` добавив дополнительный `%` символ рядом с существующими символами в строке маркера SAS.

### <a name="run-scripts-by-using-jenkins"></a>Запуск скриптов с помощью Дженкинса

Если вы планируете использовать [Jenkins](https://jenkins.io/) для выполнения скриптов, обязательно разместите следующую команду в начале скрипта.

```
/usr/bin/keyctl new_session
```

## <a name="use-azcopy-in-azure-storage-explorer"></a>Используйте AzCopy в Azure Storage Explorer

[Storage Explorer](https://azure.microsoft.com/features/storage-explorer/) использует AzCopy для выполнения всех операций по передаче данных. Вы можете использовать [Storage Explorer,](https://azure.microsoft.com/features/storage-explorer/) если вы хотите использовать преимущества производительности AzCopy, но вы предпочитаете использовать графический пользовательский интерфейс, а не командную строку для взаимодействия с файлами.

Storage Explorer использует ключ учетной записи для выполнения операций, поэтому после входной регистрации в Storage Explorer вам не нужно будет предоставлять дополнительные учетные данные авторизации.

<a id="previous-version" />

## <a name="use-the-previous-version-of-azcopy"></a>Используйте предыдущую версию AzCopy

Если вам нужно использовать предыдущую версию AzCopy (AzCopy v8.1), см.

- [AzCopy в Windows (версия 8)](https://docs.microsoft.com/previous-versions/azure/storage/storage-use-azcopy)

- [AzCopy в Linux (версия 8)](https://docs.microsoft.com/previous-versions/azure/storage/storage-use-azcopy-linux)

## <a name="configure-optimize-and-troubleshoot-azcopy"></a>Configure, optimize, and troubleshoot AzCopy (Настройка, оптимизация и устранение неполадок с AzCopy)

Смотрите [Нанастройка, оптимизация и устранение неполадок AzCopy](storage-use-azcopy-configure.md)

## <a name="next-steps"></a>Дальнейшие действия

Если у вас есть вопросы, проблемы или общие отзывы, отправьте их на страницу [GitHub.](https://github.com/Azure/azure-storage-azcopy)
