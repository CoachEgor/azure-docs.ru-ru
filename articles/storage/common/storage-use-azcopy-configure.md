---
title: Настроить, оптимизировать и устранение неполадок с AzCopy со службой хранилища Azure | Документация Майкрософт
description: Настроить, оптимизировать и устранение неполадок с AzCopy.
services: storage
author: normesta
ms.service: storage
ms.topic: article
ms.date: 05/14/2019
ms.author: normesta
ms.subservice: common
ms.openlocfilehash: a160591ef0a47eed097ce8db373878f32965de9b
ms.sourcegitcommit: 509e1583c3a3dde34c8090d2149d255cb92fe991
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/27/2019
ms.locfileid: "66247129"
---
# <a name="configure-optimize-and-troubleshoot-azcopy"></a>Настроить, оптимизировать и устранение неполадок с AzCopy

AzCopy — программа командной строки, который можно использовать для копирования больших двоичных объектов или файлов из учетной записи хранения. В этой статье объясняется, как выполнять задачи расширенной конфигурации и помогает устранять неполадки, которые могут возникнуть при использовании AzCopy.

> [!NOTE]
> Если вы ищете материалы и помочь вам приступить к работе с помощью AzCopy, см. в любой из следующих статей:
> - [Начало работы с AzCopy](storage-use-azcopy-v10.md)
> - [Передача данных с помощью AzCopy и BLOB-хранилища](storage-use-azcopy-blobs.md)
> - [Передача данных с помощью AzCopy и хранилищем файлов](storage-use-azcopy-files.md)
> - [Передача данных с помощью AzCopy и Amazon S3 сегментов](storage-use-azcopy-s3.md)

## <a name="configure-proxy-settings"></a>Настройка параметров прокси

Чтобы настроить параметры прокси-сервера для AzCopy, задать `https_proxy` переменной среды.

| Операционная система | Команда  |
|--------|-----------|
| **Windows** | `set https_proxy=<proxy IP>:<proxy port>` |
| **Linux** | `export https_proxy=<proxy IP>:<proxy port>` |
| **MacOS** | `export https_proxy=<proxy IP>:<proxy port>` |

В настоящее время AzCopy не поддерживает прокси-серверов, требующих проверки подлинности с протоколом NTLM или Kerberos.

## <a name="optimize-throughput"></a>Оптимизация пропускной способности

Задайте `AZCOPY_CONCURRENCY_VALUE` переменной среды для настройки количество одновременных запросов, а также для управления пропускной способности производительность и потребление ресурсов. Если ваш компьютер имеет менее чем 5 ЦП, а затем значение этой переменной присваивается `32`. В противном случае — значение по умолчанию равно 16, умноженное на количество процессоров. По умолчанию максимальное значение этой переменной является `300`, однако можно вручную задать это значение выше или ниже.

| Операционная система | Команда  |
|--------|-----------|
| **Windows** | `set AZCOPY_CONCURRENCY_VALUE=<value>` |
| **Linux** | `export AZCOPY_CONCURRENCY_VALUE=<value>` |
| **MacOS** | `export AZCOPY_CONCURRENCY_VALUE=<value>` |

Используйте `azcopy env` для проверки текущего значения этой переменной.  Если значение пусто, то `AZCOPY_CONCURRENCY_VALUE` переменной присваивается значение по умолчанию `300`.

## <a name="change-the-location-of-the-log-files"></a>Изменение расположения файлов журнала

По умолчанию файлы журналов находятся в `%USERPROFILE\\.azcopy` папки на Windows или в `$HOME\\.azcopy` папку на Mac и Linux. Это расположение можно изменить, если необходимо выполнить с помощью следующих команд.

| Операционная система | Команда  |
|--------|-----------|
| **Windows** | `set AZCOPY_LOG_LOCATION=<value>` |
| **Linux** | `export AZCOPY_LOG_LOCATION=<value>` |
| **MacOS** | `export AZCOPY_LOG_LOCATION=<value>` |

Используйте `azcopy env` для проверки текущего значения этой переменной. Если значение пусто, журналы записываются в расположение по умолчанию.

## <a name="change-the-default-log-level"></a>Изменение уровня ведения журнала по умолчанию

По умолчанию присваивается уровень ведения журнала AzCopy `INFO`. Если вы хотите уменьшить уровень детализации журнала для экономии места на диске, перезаписать этот параметр с помощью ``--log-level`` параметр. 

Уровни журнала доступны: `DEBUG`, `INFO`, `WARNING`, `ERROR`, `PANIC`, и `FATAL`.

## <a name="troubleshoot-issues"></a>Устранение неполадок

AzCopy создает файлы журнала и план для каждого задания. Вы можете использовать журналы для исследования и устранения возможных проблем. 

Журналы будут содержать состояние сбоя (`UPLOADFAILED`, `COPYFAILED`, и `DOWNLOADFAILED`), полный путь, а также причина сбоя.

По умолчанию файлы журнала и план, находятся в `%USERPROFILE\\.azcopy` папку на Windows или `$HOME\\.azcopy` папки в Mac и Linux.

> [!IMPORTANT]
> При отправке запроса поддержки Microsoft (или устранении неполадок, связанных с третьим лицам), совместно использовать исправленная версия версия команды, которую требуется выполнить. Это гарантирует, что подписанный URL-адрес не предоставлен случайно любой пользователь. Вы можете найти исправленную версию в начале файла журнала.

### <a name="review-the-logs-for-errors"></a>Проверка журналов на наличие ошибок

Следующая команда позволит получить все ошибки с `UPLOADFAILED` состояние из `04dc9ca9-158f-7945-5933-564021086c79` журнала:

**Windows**

```
Select-String UPLOADFAILED .\04dc9ca9-158f-7945-5933-564021086c79.log
```

**Linux**

```
grep UPLOADFAILED .\04dc9ca9-158f-7945-5933-564021086c79.log
```

### <a name="view-and-resume-jobs"></a>Просмотр и возобновление задания

В рамках каждой операции передачи будет создано задание AzCopy. Чтобы просмотреть журнал заданий, используйте следующую команду:

```
azcopy jobs list
```

Чтобы просмотреть статистику задания, используйте следующую команду:

```
azcopy jobs show <job-id>
```

Чтобы отфильтровать операции передачи по состоянию, используйте следующую команду:

```
azcopy jobs show <job-id> --with-status=Failed
```

Используйте следующую команду, чтобы возобновить задание сбой или отменено. Эта команда использует свой идентификатор, а также маркер SAS, так как оно не постоянное по соображениям безопасности:

```
azcopy jobs resume <job-id> --source-sas="<sas-token>"
azcopy jobs resume <job-id> --destination-sas="<sas-token>"
```

При возобновлении задания, AzCopy проверяет файл плана задания. В файле плана перечислены все файлы, которые были определены для обработки при первом создании задания. При возобновлении задания AzCopy будет предпринята попытка передачи, все файлы, которые перечислены в файле план, который уже не были перенесены.