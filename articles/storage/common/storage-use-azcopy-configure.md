---
title: Настройка, оптимизация и устранение неполадок AzCopy в службе хранилища Azure | Документация Майкрософт
description: Настройка, оптимизация и устранение неполадок AzCopy.
services: storage
author: normesta
ms.service: storage
ms.topic: article
ms.date: 07/25/2019
ms.author: normesta
ms.subservice: common
ms.openlocfilehash: 3773f9a8464dc94436d6d2503b173d4674033ab1
ms.sourcegitcommit: 7c4de3e22b8e9d71c579f31cbfcea9f22d43721a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/26/2019
ms.locfileid: "68565035"
---
# <a name="configure-optimize-and-troubleshoot-azcopy"></a>Настройка, оптимизация и устранение неполадок AzCopy

AzCopy — это служебная программа командной строки, которую можно использовать для копирования больших двоичных объектов или файлов в учетную запись хранения или из нее. Эта статья поможет вам выполнить дополнительные задачи по настройке и устранить неполадки, которые могут возникнуть при использовании AzCopy.

> [!NOTE]
> Если вы ищете содержимое, которое поможет приступить к работе с AzCopy, ознакомьтесь со следующими статьями:
> - [Get started with AzCopy](storage-use-azcopy-v10.md) (Начало работы с AzCopy)
> - [Transfer data with AzCopy and blob storage](storage-use-azcopy-blobs.md) (Передача данных с помощью AzCopy и хранилища BLOB-объектов)
> - [Transfer data with AzCopy and file storage](storage-use-azcopy-files.md) (Передача данных с помощью AzCopy и хранилища файлов)
> - [Передача данных с помощью AzCopy и контейнеров Amazon S3](storage-use-azcopy-s3.md)

## <a name="configure-proxy-settings"></a>Настройка параметров прокси

Чтобы настроить параметры прокси-сервера для AzCopy, задайте `https_proxy` переменную среды. При запуске AzCopy в Windows AzCopy автоматически определяет параметры прокси-сервера, поэтому вам не нужно использовать этот параметр в Windows. Если вы решили использовать этот параметр в Windows, это приведет к переопределению автоматического обнаружения.

| Операционная система | Command  |
|--------|-----------|
| **Windows** | В командной строке используйте `set https_proxy=<proxy IP>:<proxy port>`.<br> В PowerShell используйте `$env:https_proxy="<proxy IP>:<proxy port>"`.|
| **Linux** | `export https_proxy=<proxy IP>:<proxy port>` |
| **MacOS** | `export https_proxy=<proxy IP>:<proxy port>` |

В настоящее время AzCopy не поддерживает прокси-серверы, для которых требуется проверка подлинности с помощью NTLM или Kerberos.

## <a name="optimize-throughput"></a>Оптимизация пропускной способности

Можно использовать `cap-mbps` флаг, чтобы поместить пороговое значение на скорость передачи данных. Например, следующая команда заменяет пропускную способность до `10` мегабит (МБ) в секунду.

```azcopy
azcopy cap-mbps 10
```

Пропускная способность может уменьшиться при передаче небольших файлов. Можно увеличить пропускную способность, задав `AZCOPY_CONCURRENCY_VALUE` переменную среды. Эта переменная указывает количество одновременных запросов, которые могут быть выполнены.  Если на компьютере установлено менее 5 ЦП, значение этой переменной будет `32`равно. В противном случае значение по умолчанию равно 16, умноженному на число ЦП. Максимальное значение по умолчанию для этой переменной `300`равно, но можно вручную задать это значение выше или ниже.

| Операционная система | Command  |
|--------|-----------|
| **Windows** | `set AZCOPY_CONCURRENCY_VALUE=<value>` |
| **Linux** | `export AZCOPY_CONCURRENCY_VALUE=<value>` |
| **MacOS** | `export AZCOPY_CONCURRENCY_VALUE=<value>` |

`azcopy env` Используйте для проверки текущего значения этой переменной.  Если значение пустое, `AZCOPY_CONCURRENCY_VALUE` для переменной задается `300`значение по умолчанию.

## <a name="change-the-location-of-the-log-files"></a>Изменение расположения файлов журнала

По умолчанию файлы журналов находятся в `%USERPROFILE\\.azcopy` каталоге в Windows или `$HOME\\.azcopy` в каталоге на компьютерах Mac и Linux. При необходимости вы можете изменить это расположение с помощью этих команд.

| Операционная система | Command  |
|--------|-----------|
| **Windows** | `set AZCOPY_LOG_LOCATION=<value>` |
| **Linux** | `export AZCOPY_LOG_LOCATION=<value>` |
| **MacOS** | `export AZCOPY_LOG_LOCATION=<value>` |

`azcopy env` Используйте для проверки текущего значения этой переменной. Если значение пустое, журналы записываются в расположение по умолчанию.

## <a name="change-the-default-log-level"></a>Изменение уровня ведения журнала по умолчанию

По умолчанию для `INFO`уровня ведения журнала AzCopy задано значение. Если вы хотите уменьшить уровень детализации журнала, чтобы сэкономить место на диске, перепишите этот параметр с помощью ``--log-level`` параметра. 

Доступны следующие уровни ведения журнала `DEBUG`: `INFO`, `WARNING`, `ERROR`, `PANIC`, и `FATAL`.

## <a name="troubleshoot-issues"></a>Устранение неполадок

AzCopy создает файлы журналов и планов для каждого задания. Вы можете использовать журналы для исследования и устранения возможных проблем. 

Журналы будут содержать состояние сбой (`UPLOADFAILED`, `COPYFAILED`и `DOWNLOADFAILED`), полный путь и причину сбоя.

По умолчанию файлы журнала и плана находятся в `%USERPROFILE\\.azcopy` каталоге в Windows или `$HOME\\.azcopy` каталоге в Mac и Linux.

> [!IMPORTANT]
> При отправке запроса на служба поддержки Майкрософт (или при устранении неполадки, связанной с третьей стороной), предоставьте общий доступ к показана исправленная версия версии команды, которую нужно выполнить. Это гарантирует, что SAS не будет случайно предоставлен всем. Вы можете найти исправленную версию в начале файла журнала.

### <a name="review-the-logs-for-errors"></a>Проверка журналов на наличие ошибок

Следующая команда получит все ошибки с `UPLOADFAILED` состоянием `04dc9ca9-158f-7945-5933-564021086c79` из журнала:

**Windows (PowerShell)**

```
Select-String UPLOADFAILED .\04dc9ca9-158f-7945-5933-564021086c79.log
```

**Linux**

```
grep UPLOADFAILED .\04dc9ca9-158f-7945-5933-564021086c79.log
```

### <a name="view-and-resume-jobs"></a>Просмотр и возобновление задания

В рамках каждой операции передачи будет создано задание AzCopy. Чтобы просмотреть журнал заданий, используйте следующую команду:

```
azcopy jobs list
```

Чтобы просмотреть статистику задания, используйте следующую команду:

```
azcopy jobs show <job-id>
```

Чтобы отфильтровать операции передачи по состоянию, используйте следующую команду:

```
azcopy jobs show <job-id> --with-status=Failed
```

Используйте следующую команду, чтобы возобновить задание, завершившееся сбоем или отмененным. Эта команда использует свой идентификатор вместе с маркером SAS, так как он не является постоянным в целях безопасности:

```
azcopy jobs resume <job-id> --source-sas="<sas-token>"
azcopy jobs resume <job-id> --destination-sas="<sas-token>"
```

При возобновлении задания AzCopy просматривает файл плана задания. В файле плана перечислены все файлы, обнаруженные для обработки при первом создании задания. При возобновлении задания AzCopy попытается перенести все файлы, перечисленные в файле плана, который еще не был передан.