---
title: Разрешить доступ к каплям и очередям с помощью Active Directory
titleSuffix: Azure Storage
description: Разрешить доступ к каплям и очередям Azure с помощью Active Directory Azure.
services: storage
author: tamram
ms.service: storage
ms.topic: conceptual
ms.date: 2/23/2020
ms.author: tamram
ms.reviewer: cbrooks
ms.subservice: common
ms.openlocfilehash: b8a42723a9b56665160e660c0ea1451253c3d185
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79255370"
---
# <a name="authorize-access-to-blobs-and-queues-using-azure-active-directory"></a>Разрешить доступ к каплям и очередям с помощью active-каталога Azure

Хранение Azure поддерживает использование active-каталога Azure (Azure AD) для авторизации запросов для хранения Blob и Очереди. С Помощью Azure AD можно использовать элементуправления доступа на основе ролей (RBAC) для предоставления разрешений директору службы безопасности, который может быть директором службы безопасности пользователя, группы или приложения. Директор безопасности проверяется Azure AD для возврата токена OAuth 2.0. Затем маркер может быть использован для авторизации запроса в отношении хранилища Blob или Очереди.

Авторизация запросов в отношении Azure Storage с Azure AD обеспечивает превосходную безопасность и простоту использования над общим ключом авторизации. Корпорация Майкрософт рекомендует использовать авторизацию Azure AD с приложениями blob и очереди, когда это возможно, чтобы свести к минимуму потенциальные уязвимости безопасности, присущие общему ключу.

Авторизация с Azure AD доступна для всех учетных записей общего назначения и хранения Blob во всех общедоступных регионах и национальных облаках. Только учетные записи хранения, созданные с помощью модели развертывания ресурсов Azure Manager, поддерживают авторизацию Azure AD.

Хранение Blob дополнительно поддерживает создание общих подписей доступа (SAS), которые подписаны с учетными данными Azure AD. Для получения дополнительной информации см. [Грант ограниченный доступ к данным с общими подписями доступа](storage-sas-overview.md).

Azure Files поддерживает авторизацию с AD (предварительный просмотр) или Azure AD DS (GA) по сравнению с SMB только для конментов, объединенных vMs. Чтобы узнать об использовании AD (предварительного просмотра) или Azure AD [Overview of Azure Files identity-based authentication support for SMB access](../files/storage-files-active-directory-overview.md)DS (GA) по SMB для файлов Azure, см.

Авторизация с Azure AD не поддерживается для хранения таблицы Azure. Используйте общий ключ для авторизации запросов в хранилище таблицы.

## <a name="overview-of-azure-ad-for-blobs-and-queues"></a>Обзор Azure AD для капли и очереди

Когда директор безопасности (пользователь, группа или приложение) пытается получить доступ к ресурсу blob или очереди, запрос должен быть авторизован, если это капля, доступная для анонимного доступа. С Azure AD доступ к ресурсу является двухэтапным процессом. Во-первых, личность директора службы безопасности проверяется, и жетон OAuth 2.0 возвращается. Далее токен передается как часть запроса в службу Blob или Очередь и используется службой для авторизации доступа к указанному ресурсу.

Шаг проверки подлинности требует, чтобы приложение запросило токен доступа OAuth 2.0 во время выполнения. Если приложение работает внутри сущности Azure, такой как Azure VM, виртуальный набор масштабов машины или приложение Azure Functions, оно может использовать [управляемое](../../active-directory/managed-identities-azure-resources/overview.md) удостоверение для доступа к каплям или очередям. Чтобы узнать, как авторизовать запросы, сделанные управляемым удостоверением личности в службе Azure Blob или Queue, [см.](storage-auth-aad-msi.md)

Шаг авторизации требует, чтобы одна или несколько ролей RBAC были назначены директору безопасности. Azure Storage предоставляет роли RBAC, которые охватывают общие наборы разрешений для данных капли и очереди. Роли, назначенные директору безопасности, определяют разрешения, которые будет иметь принцип. Подробнее о назначении ролей RBAC для хранения Azure можно, [см.](storage-auth-aad-rbac.md)

Родные приложения и веб-приложения, которые делают запросы в службу Azure Blob или Очередь, также могут авторизовать доступ с Azure AD. Чтобы узнать, как запросить маркер доступа и использовать его для авторизации запросов данных капли или очереди, [см.](storage-auth-aad-app.md)

## <a name="assign-rbac-roles-for-access-rights"></a>Назначать роли RBAC для прав доступа

Azure Active Directory (Azure AD) разрешает права доступа к защищенным ресурсам с помощью [управления доступом на основе ролей (RBAC)](../../role-based-access-control/overview.md). Azure Storage определяет набор встроенных ролей RBAC, которые охватывают общие наборы разрешений, используемых для доступа к данным blob и очереди. Можно также определить пользовательские роли для доступа к данным о каплях и очередях.

Когда роль RBAC назначается директору безопасности Azure AD, Azure предоставляет доступ к этим ресурсам для этого принципа безопасности. Доступ может ограничиваться уровнем подписки, группой ресурсов, учетной записью хранения или отдельным контейнером или очередью. Директором безопасности Azure AD может быть пользователь, группа, директор службы приложений или [управляемый интимент для ресурсов Azure.](../../active-directory/managed-identities-azure-resources/overview.md)

### <a name="built-in-rbac-roles-for-blobs-and-queues"></a>Встроенные роли RBAC для капли и очереди

[!INCLUDE [storage-auth-rbac-roles-include](../../../includes/storage-auth-rbac-roles-include.md)]

Чтобы узнать, как назначить встроенную роль RBAC директору по безопасности, см.

- [Предоставление доступа к BLOB-объектам Azure и создание очереди данных с использованием RBAC на портале Azure](storage-auth-aad-rbac-portal.md)
- [Предоставление доступа к BLOB-объектам Azure и создание очереди данных с использованием RBAC с помощью Azure CLI](storage-auth-aad-rbac-cli.md)
- [Предоставление доступа к BLOB-объектам Azure и создание очереди данных с использованием RBAC с помощью Powershell](storage-auth-aad-rbac-powershell.md)

Дополнительные сведения о том, как встроенные роли определяются для службы хранилища Azure, см. в статье, посвященной [обзору определений ролей](../../role-based-access-control/role-definitions.md#management-and-data-operations). Для получения информации о создании пользовательских ролей RBAC [см.](../../role-based-access-control/custom-roles.md)

### <a name="access-permissions-for-data-operations"></a>Разрешения доступа для операций с данными

Для получения подробной информации о разрешениях, необходимых для вызова конкретных операций службы Blob или Queue, [см.](https://docs.microsoft.com/rest/api/storageservices/authorize-with-azure-active-directory#permissions-for-calling-blob-and-queue-data-operations)

## <a name="resource-scope"></a>Область ресурсов

[!INCLUDE [storage-auth-resource-scope-include](../../../includes/storage-auth-resource-scope-include.md)]

## <a name="access-data-with-an-azure-ad-account"></a>Доступ к данным с учетной записью Azure AD

Доступ к данным о blob или очереди через портал Azure, PowerShell или Azure CLI можно авторизовать либо с помощью учетной записи Azure AD пользователя, либо с помощью ключей доступа к учетной записи (общая авторизация ключей).

### <a name="data-access-from-the-azure-portal"></a>Доступ к данным с портала Azure

Портал Azure может использовать учетную запись Azure AD или ключи доступа к учетной записи для доступа к данным капли и очереди в учетной записи хранения Azure. Схема авторизации используется порталом Azure, зависит от назначенных вам ролей RBAC.

При попытке получить доступ к данным blob или очереди портал Azure сначала проверяет, была ли назначена роль RBAC с **помощью Microsoft.Storage/storageAccounts/listkeys/action.** Если вам была назначена роль с этим действием, то портал Azure использует ключ учетной записи для доступа к каблии и данным очереди через авторизацию Shared Key. Если вам не была назначена роль в этом действии, портал Azure пытается получить доступ к данным с помощью учетной записи Azure AD.

Для доступа к данным blob или очереди с портала Azure с помощью учетной записи Azure AD необходимо получить доступ к данным blob и очереди, а также для навигации по ресурсам учетной записи хранилища на портале Azure. Встроенные роли, предоставляемые Azure Storage, предоставляют доступ к ресурсам blob и очереди, но они не дают разрешений на ресурсы учетных записей. По этой причине для доступа к порталу также требуется назначение роли менеджера ресурсов Azure, такой как роль [Reader,](../../role-based-access-control/built-in-roles.md#reader) приравненный к уровню учетной записи хранилища или выше. Роль **Читателя** предоставляет наиболее ограниченные разрешения, но также приемлема другая роль менеджера ресурсов Azure, которая предоставляет доступ к ресурсам управления учетными записями. Чтобы узнать больше о том, как назначить разрешения пользователям на доступ к данным [Grant access to Azure blob and queue data with RBAC in the Azure portal](storage-auth-aad-rbac-portal.md)на портале Azure с помощью учетной записи Azure AD, см.

Портал Azure указывает, какая схема авторизации используется при переходе в контейнер или очередь. Для получения дополнительной информации о доступе к данным на портале [см.](storage-access-blobs-queues-portal.md)

### <a name="data-access-from-powershell-or-azure-cli"></a>Доступ к данным от PowerShell или Azure CLI

Azure CLI и PowerShell поддерживают подписание с учетными данными Azure AD. После вступления в систему сеанс проходит под этими учетными данными. Чтобы узнать больше, смотрите [команды Run Azure CLI или PowerShell с учетными данными Azure AD для доступа к данным blob или очереди.](authorize-active-directory-powershell.md)

## <a name="next-steps"></a>Дальнейшие действия

- [Разрешить доступ к каплям и очередям с помощью active-каталога Azure и управляемых идентификаторов для ресурсов Azure](storage-auth-aad-msi.md)
- [Авторизут с Azure Active Directory из приложения для доступа к каплям и очередям](storage-auth-aad-app.md)
- [Поддержка хранения Azure для управления доступом на основе активного каталога Azure, обычно доступна](https://azure.microsoft.com/blog/azure-storage-support-for-azure-ad-based-access-control-now-generally-available/)
