---
title: Авторизация доступа к BLOB-объектам и очередям Azure с помощью Azure Active Directory | Документация Майкрософт
description: Авторизуйте доступ к BLOB-объектам и очередям Azure с помощью Azure Active Directory.
services: storage
author: tamram
ms.service: storage
ms.topic: conceptual
ms.date: 08/02/2019
ms.author: tamram
ms.reviewer: cbrooks
ms.subservice: common
ms.openlocfilehash: caf72d4af390956391fdab133cf0897abbee4633
ms.sourcegitcommit: 2d9a9079dd0a701b4bbe7289e8126a167cfcb450
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/29/2019
ms.locfileid: "71673159"
---
# <a name="authorize-access-to-azure-blobs-and-queues-using-azure-active-directory"></a>Авторизация доступа к BLOB-объектам и очередям Azure с помощью Azure Active Directory

Служба хранилища Azure поддерживает использование Azure Active Directory (AD) для авторизации запросов к хранилищу BLOB-объектов и очередей. С помощью Azure AD можно использовать управление доступом на основе ролей (RBAC) для предоставления разрешений субъекту безопасности, который может быть пользователем, группой или субъектом-службой приложения. Проверка подлинности субъекта безопасности в Azure AD возвращает маркер OAuth 2,0. Токен можно использовать для авторизации запроса на доступ к ресурсу в хранилище BLOB-объектов или очередей.

Авторизация пользователей или приложений с помощью токена OAuth 2,0, возвращенного Azure AD, обеспечивает более высокую безопасность и простоту использования общих ключей авторизации и подписанных URL-адресах (SAS). В Azure AD нет необходимости хранить ключ доступа к учетной записи в коде и угрожать потенциальным уязвимостям безопасности. Хотя вы можете продолжать применять для приложений авторизацию с помощью общего ключа, благодаря использованию Azure AD не нужно хранить ключ доступа к учетной записи с кодом. Вы также можете продолжать использовать подписанные URL-адреса для предоставления доступа с точной настройкой к ресурсам в учетной записи хранения, но Azure AD предлагает аналогичные возможности без необходимости управлять токенами SAS или беспокоиться об отзыве скомпрометированного SAS. Корпорация Майкрософт рекомендует использовать проверку подлинности Azure AD в приложениях службы хранилища Azure, когда это возможно.

Авторизация Azure AD доступна для всех учетных записей общего назначения и хранилища BLOB-объектов во всех общедоступных регионах и национальных облаках. Авторизация Azure AD поддерживается только учетными записями хранения, созданными с помощью модели развертывания Azure Resource Manager. Авторизация с помощью Azure AD не поддерживается для табличного хранилища Azure.

## <a name="overview-of-azure-ad-for-blobs-and-queues"></a>Общие сведения об Azure AD для больших двоичных объектов и очередей

Когда участник безопасности (пользователь, группа или приложение) пытается получить доступ к ресурсу большого двоичного объекта или очереди, запрос должен быть разрешен, если только он не является BLOB-объектом, доступным для анонимного доступа. В Azure AD доступ к ресурсу состоит из двух этапов. Во-первых, удостоверение субъекта безопасности проходит проверку подлинности и возвращается маркер OAuth 2,0. Затем маркер передается как часть запроса в большой двоичный объект или служба очередей и используется службой для авторизации доступа к указанному ресурсу.

Этап проверки подлинности требует, чтобы приложение запрашивало маркер доступа OAuth 2,0 во время выполнения. Если приложение выполняется из сущности Azure, такой как виртуальная машина Azure, масштабируемый набор виртуальных машин или приложение функций Azure, оно может использовать [управляемое удостоверение](../../active-directory/managed-identities-azure-resources/overview.md) для доступа к большим двоичным объектам или очередям. Сведения о том, как авторизовать запросы, выполняемые управляемым удостоверением, в BLOB-объект или служба очередей Azure, см. в разделе [авторизация доступа к BLOB-объектам и очередям с Azure Active Directory и управляемыми удостоверениями для ресурсов Azure](storage-auth-aad-msi.md).

Для шага авторизации необходимо, чтобы один или несколько ролей RBAC были назначены субъекту безопасности. Служба хранилища Azure предоставляет роли RBAC, охватывающие общие наборы разрешений для данных BLOB-объектов и очередей. Роли, назначенные субъекту безопасности, определяют разрешения, которые будут иметь субъекта. Дополнительные сведения о назначении ролей RBAC для службы хранилища Azure см. в статье [Управление правами доступа к данным хранилища с помощью RBAC](storage-auth-aad-rbac.md).

Собственные приложения и веб-приложения, которые делают запросы к большому двоичному объекту Azure или служба очередей могут также авторизовать доступ с помощью Azure AD. Сведения о том, как запросить маркер доступа и использовать его для авторизации запросов на данные BLOB-объектов или очередей, см. в статье [авторизация доступа к службе хранилища Azure с помощью Azure AD из приложения службы хранилища Azure](storage-auth-aad-app.md).

## <a name="assigning-rbac-roles-for-access-rights"></a>Назначение ролей RBAC для прав доступа

Azure Active Directory (Azure AD) разрешает права доступа к защищенным ресурсам с помощью [управления доступом на основе ролей (RBAC)](../../role-based-access-control/overview.md). Служба хранилища Azure определяет набор встроенных ролей RBAC, охватывающих общие наборы разрешений, используемых для доступа к данным BLOB-объектов и очередей. Можно также определить пользовательские роли для доступа к данным большого двоичного объекта и очереди.

Когда роль RBAC назначается субъекту безопасности Azure AD, Azure предоставляет доступ к этим ресурсам для этого субъекта безопасности. Доступ может ограничиваться уровнем подписки, группой ресурсов, учетной записью хранения или отдельным контейнером или очередью. Субъект безопасности Azure AD может быть пользователем, группой, субъектом-службой приложения или [управляемым удостоверением для ресурсов Azure](../../active-directory/managed-identities-azure-resources/overview.md).

### <a name="built-in-rbac-roles-for-blobs-and-queues"></a>Встроенные роли RBAC для больших двоичных объектов и очередей

[!INCLUDE [storage-auth-rbac-roles-include](../../../includes/storage-auth-rbac-roles-include.md)]

Сведения о назначении встроенной роли RBAC субъекту безопасности см. в одной из следующих статей:

- [Предоставление доступа к BLOB-объектам Azure и создание очереди данных с использованием RBAC на портале Azure](storage-auth-aad-rbac-portal.md)
- [Предоставление доступа к BLOB-объектам Azure и создание очереди данных с использованием RBAC с помощью Azure CLI](storage-auth-aad-rbac-cli.md)
- [Предоставление доступа к BLOB-объектам Azure и создание очереди данных с использованием RBAC с помощью Powershell](storage-auth-aad-rbac-powershell.md)

Дополнительные сведения о том, как встроенные роли определяются для службы хранилища Azure, см. в статье, посвященной [обзору определений ролей](../../role-based-access-control/role-definitions.md#management-and-data-operations). Сведения о создании настраиваемых ролей RBAC см. в статье [Создание настраиваемых ролей для управления доступом на основе ролей в Azure](../../role-based-access-control/custom-roles.md).

### <a name="access-permissions-for-data-operations"></a>Разрешения на доступ к операциям с данными

Дополнительные сведения о разрешениях, необходимых для вызова конкретных операций большого двоичного объекта или служба очередей, см. в разделе [разрешения на вызов операций с данными большого двоичного объекта и очереди](https://docs.microsoft.com/rest/api/storageservices/authorize-with-azure-active-directory#permissions-for-calling-blob-and-queue-data-operations).

## <a name="resource-scope"></a>Область действия ресурса

[!INCLUDE [storage-auth-resource-scope-include](../../../includes/storage-auth-resource-scope-include.md)]

## <a name="access-data-with-an-azure-ad-account"></a>Доступ к данным с помощью учетной записи Azure AD

Доступ к данным большого двоичного объекта или очереди через портал Azure, PowerShell или Azure CLI можно авторизовать либо с помощью учетной записи пользователя Azure AD, либо с помощью ключей доступа к учетной записи (авторизация общего ключа).

### <a name="data-access-from-the-azure-portal"></a>Доступ к данным из портал Azure

Портал Azure может использовать учетную запись Azure AD или ключи доступа к учетной записи для доступа к данным BLOB-объектов и очередей в учетной записи хранения Azure. Схема авторизации, используемая портал Azure, зависит от назначенных вам ролей RBAC.

При попытке доступа к данным большого двоичного объекта или очереди портал Azure сначала проверяет, назначена ли роль RBAC с помощью **Microsoft. Storage/storageAccounts/listkeys/Action**. Если вы назначили роль с этим действием, портал Azure использует ключ учетной записи для доступа к данным большого двоичного объекта и очереди через авторизацию с общим ключом. Если вы не назначили роль с этим действием, портал Azure пытается получить доступ к данным с помощью учетной записи Azure AD.

Чтобы получить доступ к данным BLOB-объектов или очередей из портал Azure с помощью учетной записи Azure AD, необходимы разрешения на доступ к данным BLOB-объектов и очередей, а также необходимы разрешения для перемещения по ресурсам учетной записи хранения в портал Azure. Встроенные роли, предоставляемые службой хранилища Azure, предоставляют доступ к ресурсам BLOB-объектов и очередей, но не предоставляют разрешения для ресурсов учетной записи хранения. По этой причине доступ к порталу также требует назначения роли Azure Resource Manager, такой как роль [читателя](../../role-based-access-control/built-in-roles.md#reader) , на уровне учетной записи хранения или выше. Роль **читателя** предоставляет наиболее ограниченные разрешения, но также приемлема другая роль Azure Resource Manager, которая предоставляет доступ к ресурсам управления учетной записью хранения. Дополнительные сведения о назначении пользователям разрешений на доступ к данным в портал Azure с помощью учетной записи Azure AD см. [в разделе Предоставление доступа к данным большого двоичного объекта Azure и очереди с помощью RBAC в портал Azure](storage-auth-aad-rbac-portal.md).

Портал Azure указывает, какая схема авторизации используется при переходе к контейнеру или очереди. Дополнительные сведения о доступе к данным на портале см. в разделе [использование портал Azure для доступа к данным BLOB-объектов или очередей](storage-access-blobs-queues-portal.md).

### <a name="data-access-from-powershell-or-azure-cli"></a>Доступ к данным из PowerShell или Azure CLI

Azure CLI и PowerShell поддерживают вход с использованием учетных данных Azure AD. После входа в систему сеанс выполняется под этими учетными данными. Дополнительные сведения см. в статье [запуск Azure CLI или команд PowerShell с учетными данными Azure AD для доступа к данным BLOB-объектов или очередей](storage-auth-aad-script.md).

## <a name="azure-ad-authorization-over-smb-for-azure-files"></a>Авторизация Azure AD по протоколу SMB для службы файлов Azure

Служба файлов Azure поддерживает авторизацию в Azure AD через SMB только для виртуальных машин, присоединенных к домену (Предварительная версия). Дополнительные сведения об использовании Azure AD через SMB для службы файлов Azure см. в статье [обзор Azure Active Directory авторизации по протоколу SMB для файлов Azure (Предварительная версия)](../files/storage-files-active-directory-overview.md).

## <a name="next-steps"></a>Следующие шаги

- [Авторизация доступа к BLOB-объектам и очередям с Azure Active Directory и управляемыми удостоверениями для ресурсов Azure](storage-auth-aad-msi.md)
- [Авторизация с помощью Azure Active Directory из приложения для доступа к BLOB-объектам и очередям](storage-auth-aad-app.md)
- [Поддержка службы хранилища Azure для управления доступом на основе Azure Active Directory обычно доступна](https://azure.microsoft.com/blog/azure-storage-support-for-azure-ad-based-access-control-now-generally-available/)
