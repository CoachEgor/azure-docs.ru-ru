---
title: Предоставление ключа шифрования при запросе на хранение Blob
titleSuffix: Azure Storage
description: Клиенты, делающие запросы на хранение Azure Blob, имеют возможность предоставить ключ шифрования на основе запроса (предварительный просмотр). Включая ключ шифрования в запросе обеспечивает детальный контроль над настройками шифрования для операций хранения Blob.
services: storage
author: tamram
ms.service: storage
ms.date: 03/12/2020
ms.topic: conceptual
ms.author: tamram
ms.reviewer: cbrooks
ms.subservice: common
ms.openlocfilehash: c8a5555c5c33255fdc5902a115e7e9103a4e936f
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79410068"
---
# <a name="provide-an-encryption-key-on-a-request-to-blob-storage-preview"></a>Предоставление ключа шифрования при запросе на хранение Blob (предварительный просмотр)

Клиенты, делающие запросы на хранение Azure Blob, имеют возможность предоставить ключ шифрования на основе запроса (предварительный просмотр). Включая ключ шифрования в запросе обеспечивает детальный контроль над настройками шифрования для операций хранения Blob. Предоставляемые клиентами ключи могут храниться в Хранилище ключей Azure или в другом ключевом магазине.

## <a name="encrypting-read-and-write-operations"></a>Шифрование операций чтения и записи

Когда клиентское приложение предоставляет ключ шифрования по запросу, Azure Storage выполняет шифрование и расшифровку прозрачно при чтении и записи данных капли. Azure Storage записывает хэш SHA-256 ключа шифрования вместе с содержимым капли. Хэш используется для проверки того, что все последующие операции против капли используют один и тот же ключ шифрования.

Azure Storage не хранит и не управляет ключом шифрования, который клиент отправляет с запросом. Ключ надежно отбрасывается, как только процесс шифрования или расшифровки завершен.

Когда клиент создает или обновляет каплю, используя предоставленный клиентом ключ по запросу, затем последующее чтение и написание запросов на эту каплю также должны предоставить ключ. Если ключ не предоставляется при запросе на капля, который уже был зашифрован с помощью ключа, предоставленного клиентом, то запрос не справляется с кодом ошибки 409 (Конфликт).

Если клиентское приложение отправляет ключ шифрования по запросу, а учетная запись хранилища также шифруется с помощью ключа, управляемого корпорацией Майкрософт, или ключа, управляемого клиентом, azure Storage использует ключ, предусмотренный в запросе на шифрование и расшифровку.

Чтобы отправить ключ шифрования в рамках запроса, клиент должен установить безопасное подключение к хранилищем Azure с помощью HTTPS.

Каждый снимок blob может иметь свой собственный ключ шифрования.

## <a name="request-headers-for-specifying-customer-provided-keys"></a>Заголовки запросов для указания ключей, предоставленных заказчиком

Для звонков REST клиенты могут использовать следующие заголовки для безопасного передачи ключевой информации шифрования в запросе на хранение Blob:

|Заголовок запроса | Описание |
|---------------|-------------|
|`x-ms-encryption-key` |Требуется как для записи, так и для чтения запросов. Базовая 64-кодированная ключевая стоимость шифрования AES-256. |
|`x-ms-encryption-key-sha256`| Требуется как для записи, так и для чтения запросов. Base64-кодированный SHA256 ключа шифрования. |
|`x-ms-encryption-algorithm` | Требуется для записи запросов, необязательный для чтения запросов. Определяет алгоритм для использования при шифровании данных с помощью данного ключа. Должно быть AES256. |

Указание ключей шифрования в запросе является необязательным. Однако, если вы указываете один из заголовков, перечисленных выше для операции записи, то вы должны указать все из них.

## <a name="blob-storage-operations-supporting-customer-provided-keys"></a>Операции по хранению данных Blob, поддерживающие ключи, предоставленные заказчиком

Следующие операции по хранению данных Blob поддерживают отправку предоставленных клиентом ключей шифрования по запросу:

- [вставка большого двоичного объекта](/rest/api/storageservices/put-blob);
- [вставка списка блокировки](/rest/api/storageservices/put-block-list);
- [Put Block](/rest/api/storageservices/put-block)
- [Положите Блок с URL](/rest/api/storageservices/put-block-from-url)
- [Put Page](/rest/api/storageservices/put-page)
- [Поместите страницу с URL](/rest/api/storageservices/put-page-from-url)
- [Append Block](/rest/api/storageservices/append-block)
- [задание свойств службы BLOB-объекта](/rest/api/storageservices/set-blob-properties).
- [Set Blob Metadata](/rest/api/storageservices/set-blob-metadata)
- [Get BLOB (Получение BLOB-объекта)](/rest/api/storageservices/get-blob)
- [Get BLOB Properties (Получение свойств BLOB-объекта)](/rest/api/storageservices/get-blob-properties)
- [Get BLOB Metadata (Получение метаданных BLOB-объекта)](/rest/api/storageservices/get-blob-metadata)
- [Снимок Blob](/rest/api/storageservices/snapshot-blob)

## <a name="rotate-customer-provided-keys"></a>Поверните ключи, предоставленные заказчиком

Чтобы повернуть ключ шифрования, который был использован для шифрования капли, скачать капля, а затем повторно загрузить его с новым ключом шифрования.

> [!IMPORTANT]
> Портал Azure не может использоваться для чтения или записи в контейнер или каплю, которая зашифрована ключом, предоставленным в запросе.
>
> Убедитесь в том, чтобы защитить ключ шифрования, который вы предоставляете при запросе на хранение Blob в защищенном хранилище ключей, таких как Azure Key Vault. Если вы попытаетесь сделать операцию на контейнере или каплей без ключа шифрования, операция выйдет из строя, и вы потеряете доступ к объекту.

## <a name="next-steps"></a>Дальнейшие действия

- [Укажите предоставленный клиентом ключ по запросу на хранение Blob с помощью .NET](../blobs/storage-blob-customer-provided-key.md)
- [Шифрование хранилища Azure для данных в состоянии покоя](storage-service-encryption.md)
