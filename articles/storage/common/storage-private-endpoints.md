---
title: Использование частных конечных точек в службе хранилища Azure | Документация Майкрософт
description: Общие сведения о частных конечных точках для безопасного доступа к учетным записям хранения из виртуальных сетей.
services: storage
author: santoshc
ms.service: storage
ms.topic: article
ms.date: 09/25/2019
ms.author: santoshc
ms.reviewer: santoshc
ms.subservice: common
ms.openlocfilehash: 00de95f3b3e6eddd1f45be830202ba3ec8772bfd
ms.sourcegitcommit: 98ce5583e376943aaa9773bf8efe0b324a55e58c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2019
ms.locfileid: "73176170"
---
# <a name="using-private-endpoints-for-azure-storage-preview"></a>Использование частных конечных точек для службы хранилища Azure (Предварительная версия)

Вы можете использовать [частные конечные точки](../../private-link/private-endpoint-overview.md) для учетных записей хранения Azure, чтобы разрешить клиентам в виртуальной сети (VNet) безопасный доступ к данным по [частной ссылке](../../private-link/private-link-overview.md). Частная конечная точка использует IP-адрес из адресного пространства виртуальной сети для вашей службы учетной записи хранения. Сетевой трафик между клиентами в виртуальной сети и учетной записью хранения проходит по виртуальной сети и частной ссылке на магистральную сеть Майкрософт, что устраняет уязвимость в общедоступном Интернете.

Использование частных конечных точек для учетной записи хранения позволяет выполнять следующие задачи:
- Защитите учетную запись хранения, настроив брандмауэр хранилища для блокировки всех подключений в общедоступной конечной точке для службы хранилища.
- Повышает безопасность виртуальной сети (VNet), позволяя блокировать утечка данных из сети.
- Безопасное подключение к учетным записям хранения из локальных сетей, подключающихся к виртуальной сети с помощью [VPN](../../vpn-gateway/vpn-gateway-about-vpngateways.md) или [которыми](../../expressroute/expressroute-locations.md) с частными пиринга.

## <a name="conceptual-overview"></a>Обзор концепции
![Общие сведения о частных конечных точках для службы хранилища Azure](media/storage-private-endpoints/storage-private-endpoints-overview.jpg)

Частная конечная точка — это специальный сетевой интерфейс для службы Azure в [виртуальной сети](../../virtual-network/virtual-networks-overview.md) (VNet). При создании частной конечной точки для учетной записи хранения обеспечивается безопасное подключение между клиентами в виртуальной сети и хранилищем. Частной конечной точке назначается IP-адрес из диапазона IP-адресов виртуальной сети. Соединение между частной конечной точкой и службой хранилища использует защищенную закрытую ссылку.

Приложения в виртуальной сети могут легко подключаться к службе хранилища через закрытую конечную точку, используя те же строки подключения и механизмы авторизации, которые используются в противном случае. Частные конечные точки можно использовать со всеми протоколами, поддерживаемыми учетной записью хранения, включая остальные и SMB.

При создании частной конечной точки для службы хранилища в виртуальной сети запрос согласия отправляется на утверждение владельцу учетной записи хранения. Если пользователь, запрашивающий создание частной конечной точки, также является владельцем учетной записи хранения, этот запрос на согласие автоматически утверждается.

Владельцы учетных записей хранения могут управлять запросами на согласие и закрытыми конечными точками через вкладку "частные конечные точки" для учетной записи хранения в [портал Azure](https://portal.azure.com).

> [!TIP]
> Если вы хотите ограничить доступ к учетной записи хранения только через закрытую конечную точку, настройте брандмауэр службы хранилища таким образом, чтобы он запретил доступ через общедоступную конечную точку.

Вы можете защитить учетную запись хранения, чтобы принимать подключения только из виртуальной сети, [настроив брандмауэр хранилища](storage-network-security.md#change-the-default-network-access-rule) на запрет доступа через общедоступную конечную точку по умолчанию. Правило брандмауэра не требуется, чтобы разрешить трафик из виртуальной сети, имеющей закрытую конечную точку, так как брандмауэр хранилища управляет доступом только через общедоступную конечную точку. Вместо этого частные конечные точки используют поток согласия для предоставления подсетям доступа к службе хранилища.

### <a name="private-endpoints-for-storage-service"></a>Частные конечные точки для службы хранилища

При создании частной конечной точки необходимо указать учетную запись хранения и службу хранилища, к которой она подключается. Вам потребуется отдельная частная конечная точка для каждой службы хранилища в учетной записи хранения, которой требуется доступ, а именно [большие двоичные объекты](../blobs/storage-blobs-overview.md), [Data Lake Storage 2-го поколения](../blobs/data-lake-storage-introduction.md), [файлы](../files/storage-files-introduction.md), [очереди](../queues/storage-queues-introduction.md), [таблицы](../tables/table-storage-overview.md)или [статические веб-сайты](../blobs/storage-blob-static-website.md).

> [!TIP]
> Создайте отдельную закрытую конечную точку для дополнительного экземпляра службы хранилища, чтобы повысить производительность чтения в учетных записях RA-GRS.

Для доступности чтения в [геоизбыточной учетной записи хранения с доступом на чтение](storage-redundancy-grs.md#read-access-geo-redundant-storage)требуются отдельные частные конечные точки для основного и дополнительного экземпляров службы. Для **отработки отказа**не нужно создавать закрытую конечную точку для вторичного экземпляра. Частная конечная точка будет автоматически подключаться к новому основному экземпляру после отработки отказа. git 

#### <a name="resources"></a>Ресурсы

Более подробные сведения о создании частной конечной точки для учетной записи хранения см. в следующих статьях:

- [Подключайтесь к учетной записи хранения из учетной записи хранения в портал Azure](../../private-link/create-private-endpoint-storage-portal.md)
- [Создание частной конечной точки с помощью частного центра ссылок в портал Azure](../../private-link/create-private-endpoint-portal.md)
- [Создание частной конечной точки с помощью Azure CLI](../../private-link/create-private-endpoint-cli.md)
- [Создание частной конечной точки с помощью Azure PowerShell](../../private-link/create-private-endpoint-powershell.md)

### <a name="dns-changes-for-private-endpoints"></a>Изменения DNS для частных конечных точек

Клиенты в виртуальной сети могут использовать одну и ту же строку подключения для учетной записи хранения даже при использовании частной конечной точки.

При создании частной конечной точки мы обновляем запись ресурса DNS CNAME для этой конечной точки хранилища на псевдоним в поддомене с префиксом "*привателинк*". По умолчанию также создается [Частная зона DNS](../../dns/private-dns-overview.md) , подключенная к виртуальной сети. Эта частная зона DNS соответствует поддомену с префиксом "*привателинк*" и содержит записи ресурсов DNS A для частных конечных точек.

При разрешении URL-адреса конечной точки хранилища извне виртуальной сети с закрытой конечной точкой она разрешается в общедоступную конечную точку службы хранилища. При разрешении из виртуальной сети, в которой размещается частная конечная точка, URL-адрес конечной точки хранилища разрешается в IP-адрес частной конечной точки.

В приведенном выше примере записи ресурсов DNS для учетной записи хранения "Сторажеаккаунта" при разрешении из-за пределов виртуальной сети, в которой размещается частная конечная точка, будут:

| Name                                                  | Тип  | Value                                                 |
| :---------------------------------------------------- | :---: | :---------------------------------------------------- |
| ``StorageAccountA.blob.core.windows.net``             | CNAME | ``StorageAccountA.privatelink.blob.core.windows.net`` |
| ``StorageAccountA.privatelink.blob.core.windows.net`` | CNAME | общедоступная конечная точка службы хранилища \<\>                   |
| общедоступная конечная точка службы хранилища \<\>                   | A     | общедоступный IP-адрес службы хранилища \<\>                 |

Как упоминалось ранее, вы можете запретить доступ через общедоступную конечную точку с помощью брандмауэра хранилища.

Записи ресурсов DNS для Сторажеаккаунта, разрешенные клиентом в виртуальной сети, где размещается частная конечная точка, будут:

| Name                                                  | Тип  | Value                                                 |
| :---------------------------------------------------- | :---: | :---------------------------------------------------- |
| ``StorageAccountA.blob.core.windows.net``             | CNAME | ``StorageAccountA.privatelink.blob.core.windows.net`` |
| ``StorageAccountA.privatelink.blob.core.windows.net`` | A     | 10.1.1.5                                              |

Такой подход обеспечивает доступ к учетной записи хранения, используя ту же строку подключения из виртуальной сети, в которой размещаются частные конечные точки, а также клиенты за пределами виртуальной сети. Вы можете использовать брандмауэр службы хранилища, чтобы запретить доступ ко всем клиентам за пределами виртуальной сети.

> [!TIP]
> Если вы используете пользовательский или локальный DNS-сервер, для настройки записей ресурсов DNS для частных конечных точек следует использовать поддомен "привателинк" службы хранилища.

Рекомендуемые имена зон DNS для частных конечных точек служб хранилища:

| Служба хранилища        | Имя зоны                            |
| :--------------------- | :----------------------------------- |
| Служба BLOB-объектов           | `privatelink.blob.core.windows.net`  |
| Data Lake Storage 2-го поколения | `privatelink.dfs.core.windows.net`   |
| Служба файлов           | `privatelink.file.core.windows.net`  |
| служба очередей          | `privatelink.queue.core.windows.net` |
| Служба таблиц          | `privatelink.table.core.windows.net` |
| Статические веб-сайты        | `privatelink.web.core.windows.net`   |

## <a name="pricing"></a>Стоимость

Дополнительные сведения о ценах см. на [странице цен на службу "Приватный канал" Azure](https://azure.microsoft.com/pricing/details/private-link).

## <a name="known-issues"></a>Известные проблемы

### <a name="copy-blob-failures"></a>Копирование сбоев BLOB-объектов

В настоящее время [копирование команд больших двоичных объектов](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) , выданных учетным записям хранения, доступ к которым осуществляется через частные конечные точки, завершается сбоем, если учетная запись хранения в

### <a name="subnets-with-service-endpoints"></a>Подсети с конечными точками служб
Во время предварительной версии нельзя создать частную конечную точку в подсети с конечными точками службы. Вы можете создавать отдельные подсети в одной виртуальной сети для конечных точек служб и частных конечных точек.

### <a name="storage-access-constraints-for-clients-in-vnets-with-private-endpoints"></a>Ограничения доступа к хранилищу для клиентов в виртуальных сетей с частными конечными точками

При доступе к другим учетным записям хранения, имеющим частные конечные точки, клиенты в виртуальных сетей с существующими закрытыми конечными точками имеют ограничения. Например, предположим, что виртуальная сеть N1 имеет закрытую конечную точку для учетной записи хранения a1 для, например, службы BLOB-объектов. Если у учетной записи хранения a2 есть частная конечная точка в виртуальной сети N2 для службы BLOB-объектов, клиенты в виртуальной сети N1 также должны получить доступ к службе BLOB-объектов учетной записи a2 с помощью частной конечной точки. Если у учетной записи хранения a2 нет закрытых конечных точек для службы BLOB-объектов, клиенты в виртуальной сети N1 могут получить доступ к своей службе больших двоичных объектов без закрытой конечной точки.

Это ограничение является результатом изменений DNS, внесенных при создании частной конечной точки учетной записью a2.

### <a name="network-security-group-rules-for-subnets-with-private-endpoints"></a>Правила группы безопасности сети для подсетей с частными конечными точками

Сейчас невозможно настроить правила [группы безопасности сети](../../virtual-network/security-overview.md) (NSG) для подсетей с частными конечными точками. Для этой проблемы ограниченный обходной путь заключается в реализации правил доступа для частных конечных точек в исходных подсетях, хотя этот подход может потребовать более высоких затрат на управление.
