---
title: Использование частных конечных точек в службе хранилища Azure | Документация Майкрософт
description: Общие сведения о частных конечных точках для безопасного доступа к учетным записям хранения из виртуальных сетей.
services: storage
author: santoshc
ms.service: storage
ms.topic: article
ms.date: 09/25/2019
ms.author: santoshc
ms.reviewer: santoshc
ms.subservice: common
ms.openlocfilehash: aec12cee7466e59389b28742bf66247751a0d22b
ms.sourcegitcommit: 4c3d6c2657ae714f4a042f2c078cf1b0ad20b3a4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/25/2019
ms.locfileid: "72949473"
---
# <a name="using-private-endpoints-for-azure-storage-preview"></a>Использование частных конечных точек для службы хранилища Azure (Предварительная версия)

Служба хранилища Azure позволяет использовать [частные конечные точки](../../private-link/private-endpoint-overview.md) для клиентов в виртуальной сети (VNet) для безопасного доступа к данным в учетной записи хранения по [частной ссылке](../../private-link/private-link-overview.md). Частная конечная точка использует IP-адрес из адресного пространства виртуальной сети для вашей службы учетной записи хранения. Сетевой трафик между клиентами в виртуальной сети и учетной записью хранения проходит по виртуальной сети и частной ссылке на магистральную сеть Майкрософт, что устраняет уязвимость в общедоступном Интернете.

Использование частных конечных точек для учетной записи хранения позволяет выполнять следующие задачи:
- Защитите учетную запись хранения, настроив брандмауэр хранилища для блокировки всех подключений в общедоступной конечной точке для службы хранилища.
- Повышает безопасность виртуальной сети (VNet), позволяя блокировать утечка данных из сети.
- Безопасное подключение к учетным записям хранения из локальных сетей, подключающихся к виртуальной сети с помощью [VPN](../../vpn-gateway/vpn-gateway-about-vpngateways.md) или [которыми](../../expressroute/expressroute-locations.md) с частными пиринга.

## <a name="conceptual-overview"></a>Обзор концепции
![Общие сведения о частных конечных точках для службы хранилища Azure](media/storage-private-endpoints/storage-private-endpoints-overview.jpg)

Частная конечная точка — это специальный сетевой интерфейс в [виртуальной сети](../../virtual-network/virtual-networks-overview.md) (VNet) для службы Azure. Он обеспечивает безопасное подключение между клиентами в виртуальной сети и учетной записи хранения. Частной конечной точке назначается IP-адрес из диапазона IP-адресов виртуальной сети. Соединение между частной конечной точкой и службой хранилища использует защищенную закрытую ссылку.

Приложения в виртуальной сети могут легко подключаться к службе хранилища через закрытую конечную точку, используя те же строки подключения и механизмы авторизации, которые используются в противном случае. Частные конечные точки можно использовать со всеми протоколами, поддерживаемыми учетной записью хранения, включая остальные и SMB.

При создании частной конечной точки для службы хранилища в виртуальной сети запрос согласия отправляется на утверждение владельцу учетной записи хранения. Если пользователь, запрашивающий создание частной конечной точки, также является владельцем учетной записи хранения, этот запрос на согласие автоматически утверждается.

Владельцы учетных записей хранения могут утверждать или отклонять запросы на согласие, а также просматривать частные конечные точки и управлять ими с помощью вкладки "частные конечные точки" для учетной записи хранения в [портал Azure](https://portal.azure.com).

Вы можете защитить учетную запись хранения, чтобы принимать подключения только из виртуальной сети, [настроив брандмауэр хранилища](storage-network-security.md#change-the-default-network-access-rule) на запрет доступа через общедоступную конечную точку по умолчанию. Правило брандмауэра хранилища не требуется, чтобы разрешить трафик из виртуальной сети, имеющей закрытую конечную точку, так как правила брандмауэра хранилища применяются только к его общедоступной конечной точке. Вместо этого частные конечные точки используют поток согласия для предоставления подсетям доступа к службе хранилища.

### <a name="private-endpoints-for-storage-service"></a>Частные конечные точки для службы хранилища

При создании частной конечной точки необходимо указать учетную запись хранения и службу хранилища, к которой она подключается. Вам потребуется частная конечная точка для каждой службы хранилища в учетной записи хранения, к которой требуется доступ, а именно [большие двоичные объекты](../blobs/storage-blobs-overview.md), [Data Lake Storage 2-го поколения](../blobs/data-lake-storage-introduction.md), [файлы](../files/storage-files-introduction.md), [очереди](../queues/storage-queues-introduction.md), [таблицы](../tables/table-storage-overview.md)или [статические веб-сайты](../blobs/storage-blob-static-website.md).

Чтобы обеспечить доступность для чтения [геоизбыточной учетной записи хранения с доступом на чтение](storage-redundancy-grs.md#read-access-geo-redundant-storage), вам потребуется отдельная частная конечная точка для основного и дополнительного экземпляров службы.

#### <a name="resources"></a>Ресурсы

Более подробные сведения о создании частной конечной точки для учетной записи хранения см. в следующих статьях:

- [Подключайтесь к учетной записи хранения из учетной записи хранения в портал Azure](../../private-link/create-private-endpoint-storage-portal.md)
- [Создание частной конечной точки с помощью частного центра ссылок в портал Azure](../../private-link/create-private-endpoint-portal.md)
- [Создание частной конечной точки с помощью Azure CLI](../../private-link/create-private-endpoint-cli.md)
- [Создание частной конечной точки с помощью Azure PowerShell](../../private-link/create-private-endpoint-powershell.md)

### <a name="dns-changes-for-private-endpoints"></a>Изменения DNS для частных конечных точек

При создании частной конечной точки для службы хранилища мы обновляем запись ресурса DNS CNAME для этой конечной точки хранилища на псевдоним в поддомене с префиксом "*привателинк*". По умолчанию также создается [Частная зона DNS](../../dns/private-dns-overview.md) , подключенная к виртуальной сети. Эта частная зона DNS соответствует поддомену с префиксом "*привателинк*" и содержит записи ресурсов DNS A для частных конечных точек.

При разрешении URL-адреса конечной точки хранилища извне виртуальной сети, в которой создана частная конечная точка, она по-прежнему разрешается в общедоступную конечную точку службы хранилища. При разрешении из виртуальной сети, в которой размещается частная конечная точка, URL-адрес конечной точки хранилища разрешается в IP-адрес частной конечной точки.

В приведенном выше примере записи ресурсов DNS для учетной записи хранения "Сторажеаккаунта" при разрешении из-за пределов виртуальной сети, в которой размещается частная конечная точка, будут:

| Name                                                  | Тип  | Value                                                 |
| :---------------------------------------------------- | :---: | :---------------------------------------------------- |
| ``StorageAccountA.blob.core.windows.net``             | CNAME | ``StorageAccountA.privatelink.blob.core.windows.net`` |
| ``StorageAccountA.privatelink.blob.core.windows.net`` | CNAME | общедоступная конечная точка \<\>                                   |
| общедоступная конечная точка \<\>                                   | A     | общедоступный IP-адрес службы хранилища \<\>                 |

Как упоминалось ранее, вы можете запретить доступ через общедоступную конечную точку с помощью брандмауэра хранилища.

Записи ресурсов DNS для Сторажеаккаунта, разрешенные клиентом в виртуальной сети, где размещается частная конечная точка, будут:

| Name                                                  | Тип  | Value                                                 |
| :---------------------------------------------------- | :---: | :---------------------------------------------------- |
| ``StorageAccountA.blob.core.windows.net``             | CNAME | ``StorageAccountA.privatelink.blob.core.windows.net`` |
| ``StorageAccountA.privatelink.blob.core.windows.net`` | A     | 10.1.1.5                                              |

Такой подход обеспечивает доступ к учетной записи хранения, используя ту же строку подключения из виртуальной сети, в которой размещаются частные конечные точки, а также клиенты за пределами виртуальной сети. Вы можете использовать брандмауэр службы хранилища, чтобы запретить доступ ко всем клиентам за пределами виртуальной сети.

## <a name="pricing"></a>Стоимость

Дополнительные сведения о ценах см. на [странице цен на службу "Приватный канал" Azure](https://azure.microsoft.com/pricing/details/private-link).

## <a name="known-issues"></a>Известные проблемы

### <a name="copy-blob-failures"></a>Копирование сбоев BLOB-объектов

В настоящее время [копирование команд больших двоичных объектов](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) , выданных учетным записям хранения, доступ к которым осуществляется через частные конечные точки, завершается сбоем, если учетная запись хранения в

### <a name="storage-access-constraints-for-clients-in-vnets-with-private-endpoints"></a>Ограничения доступа к хранилищу для клиентов в виртуальных сетей с частными конечными точками

Клиенты в виртуальных сетей с существующими ограничениями для частных конечных точек хранилища при доступе к другим учетным записям хранения с закрытыми конечными точками. Например, предположим, что виртуальная сеть N1 имеет закрытую конечную точку для учетной записи хранения a1 для, например, службы BLOB-объектов. Если у учетной записи хранения a2 есть частная конечная точка в виртуальной сети N2 для службы BLOB-объектов, клиенты в виртуальной сети N1 также должны получить доступ к службе BLOB-объектов в учетной записи a2 с помощью частной конечной точки. Если у учетной записи хранения a2 нет закрытых конечных точек для службы BLOB-объектов, клиенты в виртуальной сети N1 могут получить доступ к своей службе больших двоичных объектов без закрытой конечной точки.

Это ограничение является результатом изменений DNS, внесенных при создании частной конечной точки учетной записью a2.

### <a name="nsg-rules-on-subnets-with-private-endpoints"></a>Правила NSG для подсетей с частными конечными точками

В настоящее время правила [группы безопасности сети](../../virtual-network/security-overview.md) (NSG) не могут быть настроены для подсетей с частными конечными точками. Для этой проблемы ограниченный обходной путь заключается в реализации правил доступа для частных конечных точек в исходных подсетях, хотя этот подход может потребовать более высоких затрат на управление.
