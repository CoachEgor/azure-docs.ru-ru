---
title: Использование частных конечных точек
titleSuffix: Azure Storage
description: Обзор частных конечных точек для безопасного доступа к учетным записям хранения данных из виртуальных сетей.
services: storage
author: santoshc
ms.service: storage
ms.topic: article
ms.date: 03/12/2020
ms.author: santoshc
ms.reviewer: santoshc
ms.subservice: common
ms.openlocfilehash: c51f2db698f30368c9d4090d3d571fa0c131178a
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79299062"
---
# <a name="use-private-endpoints-for-azure-storage"></a>Используйте частные конечные точки для хранения Azure

Вы можете использовать [частные конечные точки](../../private-link/private-endpoint-overview.md) для своих учетных записей Azure Storage, чтобы клиенты виртуальной сети (VNet) могли безопасно получить доступ к данным по [частной ссылке.](../../private-link/private-link-overview.md) Частная конечная точка использует IP-адрес из адресного пространства VNet для службы учетной записи хранилища. Сетевой трафик между клиентами на VNet и учетной записи хранилища пересекает VNet и частную ссылку на магистральную сеть Microsoft, устраняя воздействие из публичного интернета.

Использование частных конечных точек для вашей учетной записи хранилища позволяет:

- Защищайте учетную запись хранилища, настраивая брандмауэр для блокировки всех подключений на общедоступной конечной точке для службы хранения.
- Увеличьте безопасность виртуальной сети (VNet), позволяя блокировать эксфильтрацию данных из VNet.
- Безопасное подключение к учетным записям хранения из закрытых сетей, которые подключаются к VNet с помощью [VPN](../../vpn-gateway/vpn-gateway-about-vpngateways.md) или [ExpressRoutes](../../expressroute/expressroute-locations.md) с частными пирингами.

## <a name="conceptual-overview"></a>Общие сведения

![Обзор частных конечных точек для хранения Azure](media/storage-private-endpoints/storage-private-endpoints-overview.jpg)

Частная конечная точка — это специальный сетевой интерфейс для службы Azure в вашей [виртуальной сети](../../virtual-network/virtual-networks-overview.md) (VNet). При создании частной конечной точки для вашей учетной записи хранилища обеспечивается безопасное подключение между клиентами в вашем VNet и вашим хранилищем. Частной конечной точке присваивается IP-адрес из диапазона IP-адресов вашего VNet. Соединение между частной конечной точкой и службой хранения использует безопасную частную ссылку.

Приложения в VNet могут легко подключаться к службе хранения через частную конечную точку, **используя те же строки соединения и механизмы авторизации, которые они использовали бы в противном случае.** Частные конечные точки могут использоваться со всеми протоколами, поддерживаемыми учетной записью хранилища, включая REST и SMB.

Частные конечные точки могут быть созданы в подсетах, которые используют [конечные точки службы.](../../virtual-network/virtual-network-service-endpoints-overview.md) Таким образом, клиенты в подсети могут подключиться к одной учетной записи хранилища с помощью частной конечных точек, используя конечные точки обслуживания для доступа к другим.

Когда вы создаете в виртуальной сети частную конечную точку для службы хранилища, соответствующий запрос на предоставление согласия отправляется владельцу учетной записи хранения. Если пользователь, запрашивающий создание частной конечной точки, также является владельцем учетной записи хранилища, этот запрос на согласие автоматически утверждается.

Владельцы учетных записей хранилища могут управлять запросами на согласие и частными конечными точками через вкладку *«Частные конечные точки»* для учетной записи хранилища на [портале Azure.](https://portal.azure.com)

> [!TIP]
> Если вы хотите ограничить доступ к учетной записи хранилища только через частную конечную точку, назначьте брандмауэр для отказа или контроля доступа через общедоступную точку.

Вы можете обезопасить свою учетную запись хранилища, чтобы принимать соединения только из ВСети, [настраивая брандмауэр для](storage-network-security.md#change-the-default-network-access-rule) отказа в доступе через общедоступную точку по умолчанию. Вам не нужно правило брандмауэра, чтобы разрешить трафик из VNet, который имеет частную конечную точку, так как брандмауэр хранилища контролирует доступ только через общедоступную точку. Вместо этого частные конечные точки полагаются на поток согласия для предоставления подсетям доступа к службе хранения данных.

### <a name="private-endpoints-for-azure-storage"></a>Частные конечные точки для хранения Azure

При создании частной конечной точки необходимо указать учетную запись хранения и службу хранения, к которой она подключается. Вам нужна отдельная частная конечная точка для каждой службы хранения в учетной записи хранения, что вам нужно получить доступ, а именно [Blobs](../blobs/storage-blobs-overview.md), [Data Lake Storage Gen2](../blobs/data-lake-storage-introduction.md), [Файлы](../files/storage-files-introduction.md), [Очереди](../queues/storage-queues-introduction.md), [Таблицы](../tables/table-storage-overview.md), или [Статические веб-сайты](../blobs/storage-blob-static-website.md).

> [!TIP]
> Создайте отдельную частную конечную точку для вторичного экземпляра службы хранения для более высокой производительности чтения на учетных записях RA-GRS.

Для чтения доступа к вторичному региону с учетной записью хранения, настроенной для геоизованной памяти, необходимы отдельные частные конечные точки как для первичных, так и для вторичных экземпляров службы. Вам не нужно создавать частную конечную точку для вторичного экземпляра для **неудачи.** Частная конечная точка автоматически подключается к новому первичному экземпляру после сбоя. Для получения дополнительной информации о [Azure Storage redundancy](storage-redundancy.md)вариантах избыточности хранилища см.

Для получения более подробной информации о создании частной конечной точки для вашей учетной записи хранения, обратитесь к следующим статьям:

- [Подключение к учетной записи хранилища из учетной записи хранения на портале Azure](../../private-link/create-private-endpoint-storage-portal.md)
- [Создание частной конечной точки с помощью центра частной ссылки на портале Azure](../../private-link/create-private-endpoint-portal.md)
- [Создание частной конечной точки с помощью Azure CLI](../../private-link/create-private-endpoint-cli.md)
- [Создание частной конечной точки с помощью Azure PowerShell](../../private-link/create-private-endpoint-powershell.md)

### <a name="connecting-to-private-endpoints"></a>Подключение к частным конечным точкам

Клиенты на VNet, использующие частную конечную точку, должны использовать ту же строку подключения для учетной записи хранилища, как и клиенты, подключающиеся к публичной конечной точке. Мы полагаемся на разрешение DNS для автоматического направления подключений из VNet на учетную запись хранилища по частной ссылке.

> [!IMPORTANT]
> Используйте ту же строку подключения к учетной записи хранилища с помощью частных конечных точек, так как вы бы использовали иначе. Пожалуйста, не подключайтесь к учетной записи хранилища, используя URL-адрес*поддомена privatelink.*

Мы создаем [частную зону DNS,](../../dns/private-dns-overview.md) присоединенную к VNet с необходимыми обновлениями для частных конечных точек, по умолчанию. Однако, если вы используете свой собственный DNS-сервер, возможно, потребуется внести дополнительные изменения в конфигурацию DNS. В разделе [об изменениях DNS](#dns-changes-for-private-endpoints) ниже описаны обновления, необходимые для частных конечных точек.

## <a name="dns-changes-for-private-endpoints"></a>Изменения DNS для частных конечных точек

При создании частной конечной точки запись ресурсов DNS CNAME для учетной записи хранилища обновляется до псевдонима в поддомене с приставкой *'privatelink'.* По умолчанию мы также создаем [частную зону DNS,](../../dns/private-dns-overview.md)соответствующую поддомену '*privatelink',* с записями ресурсов DNS A для частных конечных точек.

При устранении URL-адреса конечной точки хранилища за пределами VNet с помощью частной конечной точки он разрешается общедоступной конечной точке службы хранения. При разрешении с VNet, где размещается частная конечная точка, URL-адрес точки хранения разрешается с IP-адресом частной конечной точки.

Для приведенного выше примера записи ресурсов DNS для учетной записи хранилища 'StorageAccountA', при ее разрешении из-за пределов VNet, размещающей частную конечную точку, будут:

| name                                                  | Тип  | Значение                                                 |
| :---------------------------------------------------- | :---: | :---------------------------------------------------- |
| ``StorageAccountA.blob.core.windows.net``             | CNAME | ``StorageAccountA.privatelink.blob.core.windows.net`` |
| ``StorageAccountA.privatelink.blob.core.windows.net`` | CNAME | \<служба хранения общественной конечная точка\>                   |
| \<служба хранения общественной конечная точка\>                   | Объект     | \<служба хранения общественного IP-адреса\>                 |

Как упоминалось ранее, вы можете отказать или контролировать доступ для клиентов за пределами VNet через публичную конечную точку с помощью брандмауэра для хранения.

Записи ресурсов DNS для StorageAccountA, при ее разрешении клиентом в VNet, принимающей частную конечную точку, будут:

| name                                                  | Тип  | Значение                                                 |
| :---------------------------------------------------- | :---: | :---------------------------------------------------- |
| ``StorageAccountA.blob.core.windows.net``             | CNAME | ``StorageAccountA.privatelink.blob.core.windows.net`` |
| ``StorageAccountA.privatelink.blob.core.windows.net`` | Объект     | 10.1.1.5                                              |

Такой подход позволяет получить доступ к учетной записи **хранилища, используя ту же строку подключения** для клиентов в VNet, принимающих частные конечные точки, а также клиентов за пределами VNet.

Если вы используете пользовательский DNS-сервер в вашей сети, клиенты должны быть в состоянии решить F-DN для точки хранения учетной записи на частный IP-адрес конечных точек. Вы должны настроить свой DNS-сервер, чтобы делегировать свой частный поддомен в частную зону DNS для VNet, или настроить записи A для '*StorageAccountA.privatelink.blob.core.windows.net'* с частным IP-адресом endpoint.

> [!TIP]
> При использовании пользовательского или локального DNS-сервера следует настроить DNS-сервер для решения проблемы учетной записи хранилища в поддомене "Privatelink" на частный IP-адрес. Вы можете сделать это, делегируя поддомен 'privatelink' в частную зону DNS VNet, или настраивая зону DNS на вашем dNS-сервере и добавляя записи DNS A.

Рекомендуемые названия зон DNS для частных конечных точек для служб хранения:

| Служба хранения данных        | Название зоны                            |
| :--------------------- | :----------------------------------- |
| Служба больших двоичных объектов           | `privatelink.blob.core.windows.net`  |
| Data Lake Storage 2-го поколения | `privatelink.dfs.core.windows.net`   |
| Служба файлов           | `privatelink.file.core.windows.net`  |
| Обслуживание в очереди          | `privatelink.queue.core.windows.net` |
| Обслуживание таблицы          | `privatelink.table.core.windows.net` |
| Статические веб-сайты        | `privatelink.web.core.windows.net`   |

Для получения дополнительной информации о настройке собственного DNS-сервера для поддержки частных конечных точек, обратитесь к следующим статьям:

- [Разрешение имен ресурсов в виртуальных сетях Azure | Документация Майкрософт](/azure/virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances#name-resolution-that-uses-your-own-dns-server)
- [Конфигурация DNS для частных конечных точек](/azure/private-link/private-endpoint-overview#dns-configuration)

## <a name="pricing"></a>Цены

Дополнительные сведения о ценах см. на [странице цен на службу "Приватный канал" Azure](https://azure.microsoft.com/pricing/details/private-link).

## <a name="known-issues"></a>Известные проблемы

Имейте в виду следующие известные проблемы о частных конечных точках для хранения Azure.

### <a name="copy-blob-support"></a>Копия поддержки Blob

Если учетная запись хранилища защищена брандмауэром и доступ к учетной записи осуществляется через частные конечные точки, то эта учетная запись не может служить источником операции [Copy Blob.](/rest/api/storageservices/copy-blob)

### <a name="storage-access-constraints-for-clients-in-vnets-with-private-endpoints"></a>Ограничения доступа к хранению для клиентов в VNets с частными конечными точками

Клиенты в VNets с существующими частными конечными точками сталкиваются с ограничениями при доступе к другим учетным записям хранения, имеющим частные конечные точки. Например, предположим, что VNet N1 имеет частную конечную точку для учетной записи хранения A1 для хранения Blob. Если учетная запись хранения A2 имеет частную конечную точку в VNet N2 для хранения Blob, то клиенты в VNet N1 должны также получить доступ к хранилищу Blob в учетной записи A2 с помощью частной конечной точки. Если учетная запись хранения A2 не имеет каких-либо частных конечных точек для хранения Blob, то клиенты в VNet N1 могут получить доступ к хранилищу Blob в этой учетной записи без частной конечный точки.

Это ограничение является результатом dNS-изменений, внесенных при созданиеучетная учетная запись A2.

### <a name="network-security-group-rules-for-subnets-with-private-endpoints"></a>Правила групп безопасности сети для сетей с частными конечными точками

В настоящее время нельзя настроить правила [Network Security Group](../../virtual-network/security-overview.md) (NSG) и маршруты, определяемые пользователем, для частных конечных точек. Правила NSG, применяемые к подсети, принимающей частную конечную точку, применяются к частной конечной точке. Ограниченное решение этой проблемы заключается в реализации правил доступа для частных конечных точек на исходных подсетях, хотя этот подход может потребовать более высоких накладных расходов на управление.

## <a name="next-steps"></a>Дальнейшие действия

- [Настройка брандмауэров и виртуальных сетей Azure Storage](storage-network-security.md)
- [Рекомендации по безопасности для хранения Blob](../blobs/security-recommendations.md)
