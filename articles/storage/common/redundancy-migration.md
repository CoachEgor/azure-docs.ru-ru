---
title: Измените способ воспроизведения учетной записи хранилища
titleSuffix: Azure Storage
description: Узнайте, как изменять способ реплицирования данных в существующей учетной записи хранилища.
services: storage
author: tamram
ms.service: storage
ms.topic: how-to
ms.date: 02/10/2020
ms.author: tamram
ms.reviewer: artek
ms.subservice: common
ms.openlocfilehash: 5c37dbdc34138faab8adae6ad18252c18a75cad4
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80337076"
---
# <a name="change-how-a-storage-account-is-replicated"></a>Измените способ воспроизведения учетной записи хранилища

Azure Storage всегда хранит несколько копий данных, чтобы они были защищены от запланированных и незапланированных событий, включая временные сбои оборудования, перебои в работе сети или подачи электроэнергии, а также массовые стихийные бедствия. Избыточность гарантирует, что ваша учетная запись хранилища соответствует соглашению об уровне [обслуживания (SLA) для хранения Azure](https://azure.microsoft.com/support/legal/sla/storage/) даже перед лицом сбоев.

Azure Storage предлагает следующие типы репликации:

- Локально избыточное хранилище (LRS)
- Хранилище, избыточное между зонами (ZRS)
- Гео-избыточное хранилище (GRS) или гео-избыточное хранилище (RA-GRS)
- Гео-зонно-излишним хранилищем (ГЗРС) или считывающим доступом гео-зонно-излишним хранилищем (RA-G'S) (предварительный просмотр)

Для обзора каждого из этих вариантов [см.](storage-redundancy.md)

## <a name="switch-between-types-of-replication"></a>Переключение между типами репликации

Вы можете переключить учетную запись хранилища с одного типа репликации на любой другой тип, но некоторые сценарии более просты, чем другие. Если вы хотите добавить или удалить георепликацию или прочитать доступ к вторичной области, вы можете использовать портал Azure, PowerShell или Azure CLI для обновления настройки репликации. Однако, если вы хотите изменить способ реплицирования данных в основной области, перейдя из LRS в ЗРС или наоборот, необходимо выполнить ручную миграцию.

В следующей таблице приведен обзор того, как переключаться с каждого типа репликации на другой:

| Переключение | ... в LRS | ... grS/RA-GRS | ... в ЗРС | ... гЗРС/РА-ГЗРС |
|--------------------|----------------------------------------------------|---------------------------------------------------------------------|----------------------------------------------------|---------------------------------------------------------------------|
| <b>... от LRS</b> | Недоступно | Используйте портал Azure, PowerShell или CLI для изменения параметра репликации<sup>1</sup> | Выполнение ручной миграции <br /><br />Запрос на миграцию в реальном времени | Выполнение ручной миграции <br /><br /> OR <br /><br /> Сначала переключитесь на GRS/RA-GRS, а затем запросите живую миграцию<sup>1</sup> |
| <b>... от GRS/RA-GRS</b> | Для изменения настройки репликации используйте портал Azure, PowerShell или CLI | Недоступно | Выполнение ручной миграции <br /><br /> OR <br /><br /> Сначала переключитесь на LRS, а затем запросите живую миграцию | Выполнение ручной миграции <br /><br /> Запрос на миграцию в реальном времени |
| <b>... от ЗРС</b> | Выполнение ручной миграции | Выполнение ручной миграции | Недоступно | Используйте портал Azure, PowerShell или CLI для изменения параметра репликации<sup>1</sup> |
| <b>... от ГЗРС/РА-ГЗРС</b> | Выполнение ручной миграции | Выполнение ручной миграции | Для изменения настройки репликации используйте портал Azure, PowerShell или CLI | Недоступно |

<sup>1</sup> Взимает одноразовый заряд на выход.

> [!CAUTION]
> Если вы выполнили [сбой учетной записи](https://docs.microsoft.com/azure/storage/common/storage-disaster-recovery-guidance) для вашей учетной записи (RA-)GRS или (RA-)G'S, она настроена на локальное излишнее в новом первичном регионе. Для таких учетных записей LRS не поддерживается живая миграция в ЗрС или ГЗРС. Вам нужно будет выполнить [ручную миграцию.](https://docs.microsoft.com/azure/storage/common/redundancy-migration#perform-a-manual-migration-to-zrs)

## <a name="change-the-replication-setting"></a>Изменение настройки репликации

Для изменения настройки репликации для учетной записи хранилища можно использовать портал Azure, PowerShell или Azure CLI, если вы не измените способ реплицирования данных в основной области. Если вы мигрируете из LRS в основной области в ЗРС в первичном регионе или наоборот, то вы должны выполнить либо [ручную миграцию,](#perform-a-manual-migration-to-zrs) либо [живую миграцию.](#request-a-live-migration-to-zrs)

Изменение способов воспроизведения учетной записи хранилища не приводит к простою приложений.

# <a name="portal"></a>[Портал](#tab/portal)

Чтобы изменить опцию избыточности для учетной записи хранилища на портале Azure, выполните следующие действия:

1. Войдите в свою учетную запись хранения на портале Azure.
1. Выберите настройку **конфигурации.**
1. Обновление настройки **репликации.**

![Скриншот, показывающий, как изменить опцию репликации на портале](media/redundancy-migration/change-replication-option.png)

# <a name="powershell"></a>[PowerShell](#tab/powershell)

Чтобы изменить опцию избыточности для учетной записи хранилища с помощью PowerShell, позвоните `-SkuName` в команду [Set-AzStorageAccount](/powershell/module/az.storage/set-azstorageaccount) и укажите параметр:

```powershell
Set-AzStorageAccount -ResourceGroupName <resource_group> `
    -AccountName <storage_account> `
    -SkuName <sku>
```

# <a name="azure-cli"></a>[Лазурный CLI](#tab/azure-cli)

Чтобы изменить опцию избыточности для учетной записи хранилища с помощью Azure `--sku` CLI, позвоните в команду [обновления учетной записи аз](/cli/azure/storage/account#az-storage-account-update) и укажите параметр:

```azurecli-interactive
az storage account update \
    --name <storage-account>
    --resource-group <resource_group> \
    --sku <sku>
```

---

## <a name="perform-a-manual-migration-to-zrs"></a>Выполните ручную миграцию в ЗРС

Если вы хотите изменить способ реплицирования данных в учетной записи хранилища в основной области, перейдя от LRS к RRS или наоборот, вы можете выполнить ручную миграцию. Она обеспечивает большую гибкость, чем динамическая. Вы контролируете время ручной миграции, поэтому используйте эту опцию, если вам нужно, чтобы миграция была завершена к определенной дате.

При выполнении ручной миграции из LRS в ЗРС в основном регионе или наоборот учетная запись хранения назначения может быть геоизмоткой, а также может быть настроена для чтения доступа к вторичной области. Например, можно перенести учетную запись LRS на учетную запись G'S или RA-G'S за один шаг.

Миграция вручную может вызвать простой приложения. Если приложению требуется высокий уровень доступности, корпорация Майкрософт также предоставляет возможность динамической миграции. Динамическая миграция — это миграция "на месте" без простоев.

При ручном переносе данные из существующей учетной записи хранилища копируется на новую учетную запись хранения, используюую ЗРС в основном регионе. Для выполнения ручной миграции можно использовать один из следующих вариантов:

- Копирование данных с помощью существующего инструмента, такого как AzCopy, одной из клиентских библиотек Хранилища Azure или надежного стороннего инструмента.
- Если вы знакомы с Hadoop или HDInsight, вы можете прикрепить к кластеру как учетную запись хранения исходного хранилища, так и учетную запись хранения назначения. Затем выполните процесс копирования данных параллельно, используя такой инструмент, как DistCp.

## <a name="request-a-live-migration-to-zrs"></a>Запрос на миграцию в ЗРС

Если необходимо перенести учетную запись хранилища из LRS или GRS в зрС в основной области без простоя приложения, вы можете запросить миграцию в реальном времени от корпорации Майкрософт. Во время живой миграции вы можете получить доступ к данным в учетной записи хранилища без потери прочности или доступности. SLA Хранилища Azure поддерживается во время процесса миграции. Потеря данных не связана с живой миграцией. Конечные точки службы, ключи доступа, общие подписи доступа и другие параметры учетной записи остаются неизменными после миграции.

RS поддерживает только учетные записи v2 общего назначения, поэтому не забудьте обновить учетную запись хранения, прежде чем отправлять запрос на миграцию в реальном времени в зрЗ. Для получения дополнительной информации [см.](storage-account-upgrade.md) Учетная запись хранилища должна содержать данные, которые должны быть перенесены через живую миграцию.

Динамическая миграция поддерживается только для учетных записей хранения, использующих репликацию LRS или GRS. Если учетная запись использует RA-GRS, прежде чем продолжить, необходимо изменить тип репликации учетной записи на LRS или GRS. Этот промежуточный шаг удаляет вторичную конечную точку только для чтения, предоставляемую RA-GRS перед миграцией.

Хотя корпорация Майкрософт незамедлительно отреагирует на запрос динамической миграции, нет никакой гарантии относительно времени ее завершения. Если вам нужны данные, перенесенные в ZRS, на определенную дату, корпорация Майкрософт вместо этого рекомендует выполнить миграцию вручную. Как правило, чем больше данных в вашей учетной записи, тем дольше будет выполняться их перенос.

Необходимо выполнить ручную миграцию, если:

- Необходимо перенести данные в учетную запись хранения данных, расположенную в регионе, отличаемом от исходной учетной записи.
- Ваша учетная запись хранения является премиум-страницы капли или блокировать blob счета.
- Необходимо перенести данные из ZRS в LRS, GRS или RA-GRS.
- Ваша учетная запись хранения включает данные в уровне архива.

Вы можете запросить динамическую миграцию через [портал поддержки Azure](https://ms.portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/overview). Выберите на портале учетную запись хранения, которую вы хотите преобразовать в ZRS.

1. Выберите **новый запрос на поддержку**
2. Заполните раздел **Основные сведения**, основываясь на информации об учетной записи. В разделе **Служба** выберите **Storage Account Management** (Управление учетными записями хранения) и ресурс, который необходимо преобразовать в ZRS.
3. Нажмите кнопку **Далее**.
4. Укажите следующие значения в разделе **Проблема**:
    - **Серьезность**. Оставьте значение по умолчанию.
    - **Тип проблемы**. Выберите **Миграция данных**.
    - **Категория**: Выберите **Мигрировать в ЗРС**.
    - **Заголовок**. Введите описательный заголовок, например **Миграция учетной записи ZRS**.
    - **Подробная информация**: Введите дополнительные сведения в поле **Детали,** например, я хотел бы \_ \_ перейти на ЗРС из "LRS, GRS" в регионе.
5. Нажмите кнопку **Далее**.
6. Проверьте правильность контактных данных в колонке **Контактные данные**.
7. Выберите **Создать**.

Специалист службы поддержки свяжется с вами и предоставит любую необходимую помощь.

> [!NOTE]
> В настоящее время миграция в реальном времени не поддерживается для премиум-файлов. В настоящее время поддерживается только ручное копирование или перемещение данных.
>
> Учетные записи хранения данных G'S в настоящее время не поддерживают уровень архива. Для получения более подробной информации смотрите [данные о хранении Azure Blob: горячие, прохладные и архивные уровни доступа.](https://docs.microsoft.com/azure/storage/blobs/storage-blob-storage-tiers)
>
> Управляемые диски доступны только для LRS и не могут быть перенесены в ЗРС. Вы можете хранить снимки и изображения для стандартных дисков, управляемых SSD, на стандартном хранении HDD и [выбирать между вариантами LRS и ЗРС.](https://azure.microsoft.com/pricing/details/managed-disks/) Для получения информации об интеграции с наборами доступности [см.](https://docs.microsoft.com/azure/virtual-machines/windows/managed-disks-overview#integration-with-availability-sets)

## <a name="switch-from-zrs-classic"></a>Переключатель от классики ЗРС

> [!IMPORTANT]
> Корпорация Майкрософт объявит нерекомендуемыми и перенесет классические учетные записи ZRS 31 марта 2021. Перед прекращением поддержки клиентам классического хранилища ZRS будут предоставлены дополнительные сведения.
>
> После того, как в данном регионе пользователи станут доступными, клиенты больше не смогут создавать учетные записи на портале Azure в этом регионе. Использование Microsoft PowerShell и Azure CLI для создания классических учетных записей ZRS является возможным, пока классическое хранилище ZRS не будет объявлено нерекомендуемым. Для получения информации о том, где доступна [система](storage-redundancy.md)хранения данных, см.

В классическом хранилище ZRS данные асинхронно реплицируются в центрах обработки данных в пределах одного или двух регионов. Реплицируемые данные недоступны, если корпорация Майкрософт не инициирует отработку отказа в дополнительном регионе. Классическую учетную запись ZRS невозможно преобразовать в учетную запись хранилища LRS, GRS или RA-GRS и наоборот. Кроме того, она не поддерживает использование метрик или ведение журналов.

Классическое хранилище ZRS доступно только для **блочных BLOB-объектов** в учетных записях хранения общего назначения версии 1 (GPv1). Дополнительные сведения об учетных записях хранения см. в статье [Общие сведения об учетной записи хранения](storage-account-overview.md).

Для ручной миграции данных об учетной записи в или из учетной записи LRS, GRS, RA-GRS или s.S. Classic используйте один из следующих инструментов: AzCopy, Azure Storage Explorer, PowerShell или Azure CLI. Можно также создавать собственные решения для миграции с использованием одной из клиентских библиотек службы хранилища Azure.

Вы также можете обновить свою учетную запись хранения данных в классическом хранилище с помощью портала Azure, PowerShell или Azure CLI в регионах, где доступна учетная запись для хранения данных.

# <a name="portal"></a>[Портал](#tab/portal)

Для обновления до портала Azure перейдите к настройкам **конфигурации** учетной записи и выберите **обновление:**

![Обновление классики до ЗРС на портале](media/redundancy-migration/portal-zrs-classic-upgrade.png)

# <a name="powershell"></a>[PowerShell](#tab/powershell)

Чтобы перейти на систему с помощью PowerShell, позвоните по следующей команде:

```powershell
Set-AzStorageAccount -ResourceGroupName <resource_group> -AccountName <storage_account> -UpgradeToStorageV2
```

# <a name="azure-cli"></a>[Лазурный CLI](#tab/azure-cli)

Чтобы обновиться до zrS с помощью Azure CLI, позвоните в следующую команду:

```cli
az storage account update -g <resource_group> -n <storage_account> --set kind=StorageV2
```

---

## <a name="costs-associated-with-changing-how-data-is-replicated"></a>Затраты, связанные с изменением способа реплицирования данных

Затраты, связанные с изменением способа реплицирования данных, зависят от пути преобразования. Заказы от наименее до самых дорогих, предложения по избыточности хранилища Azure включают LRS, ЗРС, GRS, RA-GRS, G'S и RA-G'S.

Например, переход *от* LRS к любому другому типу репликации понесет дополнительные расходы, поскольку вы переходите на более сложный уровень избыточности. Миграция *в* GRS или RA-GRS понесет плату за пропускную способность, поскольку ваши данные (в основном регионе) реплицируются в удаленный вторичный регион. Эта плата является одноразовой стоимостью при начальной настройке. После копирования данных дополнительные расходы на миграцию не взимаются. Сведения о стоимости пропускной способности см. на странице [цен на хранение блочных BLOB-объектов](https://azure.microsoft.com/pricing/details/storage/blobs/).

Если вы мигрируете учетную запись хранения из GRS в LRS, дополнительные расходы не повлекли, но реплицированные данные удаляются из вторичного местоположения.

> [!IMPORTANT]
> Если вы переносите учетную запись хранилища из RA-GRS в GRS или LRS, эта учетная запись выставляется как RA-GRS в течение дополнительных 30 дней после даты ее преобразования.

## <a name="see-also"></a>См. также

- [Избыточность хранилища Azure](storage-redundancy.md)
- [Проверьте свойство «Последнее время синхронизации» для учетной записи хранилища](last-sync-time-get.md)
- [Проектирование высокодоступных приложений с использованием геоизущегося хранилища для чтения доступа](storage-designing-ha-apps-with-ragrs.md)
