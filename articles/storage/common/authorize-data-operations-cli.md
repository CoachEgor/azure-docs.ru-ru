---
title: Разрешить доступ к данным о каплях или очередях с помощью Azure CLI
titleSuffix: Azure Storage
description: Укажите, как авторизовать операции данных с данными blob или очереди с помощью Azure CLI. Вы можете авторизовать операции данных с помощью учетных данных Azure AD, с ключом доступа к учетной записи или с помощью маркера общей подписи доступа (SAS).
services: storage
author: tamram
ms.service: storage
ms.topic: how-to
ms.date: 02/26/2020
ms.author: tamram
ms.reviewer: cbrooks
ms.subservice: common
ms.openlocfilehash: c7091592f8806b6f6655315ae1faace286c2c1f5
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "78207697"
---
# <a name="authorize-access-to-blob-or-queue-data-with-azure-cli"></a>Разрешить доступ к данным о каплях или очередях с помощью Azure CLI

Azure Storage предоставляет расширения для Azure CLI, которые позволяют указать, как вы хотите разрешить операции на кабеле или данных очереди. Вы можете санкционировать операции с данными следующим образом:

- С принципом безопасности Active Directory (Azure AD). Корпорация Майкрософт рекомендует использовать учетные данные Azure AD для обеспечения повышенной безопасности и простоты использования.
- С ключом доступа к учетной записи или маркером общей подписи доступа (SAS).

## <a name="specify-how-data-operations-are-authorized"></a>Укажите, как авторизованы операции данных

Команды Azure CLI для чтения и записи данных о каплях и очередях включают дополнительный `--auth-mode` параметр. Укажите этот параметр, чтобы указать, как должна быть разрешена операция данных:

- Установите `--auth-mode` параметр для `login` вху-на-ам-эн-эн с помощью принципа безопасности Azure AD (рекомендуется).
- Установите `--auth-mode` параметр `key` к устаревшему значению, чтобы попытаться получить ключ доступа к учетной записи для использования для авторизации. Если вы не `--auth-mode` упускаете параметр, то Azure CLI также пытается получить ключ доступа.

Чтобы использовать `--auth-mode` параметр, убедитесь, что вы установили версию Azure CLI 2.0.46 или позже. Выполните команду `az --version`, чтобы узнать установленную версию.

> [!IMPORTANT]
> Если вы опустите `--auth-mode` параметр или установите `key`его, то Azure CLI пытается использовать ключ доступа к учетной записи для авторизации. В этом случае корпорация Майкрософт рекомендует предоставить ключ доступа либо по команде, либо в переменной **среды AZURE_STORAGE_KEY.** Для получения дополнительной информации о переменных среды см. [Set environment variables for authorization parameters](#set-environment-variables-for-authorization-parameters)
>
> Если ключ доступа не предоставляется, то ClI Azure пытается вызвать поставщика ресурсов ресурсов Azure Storage, чтобы получить его для каждой операции. Выполнение многих операций данных, требующих вызова поставщику ресурсов, может привести к задушению. Для получения дополнительной информации об ограничениях поставщика ресурсов см. [Цели масштабируемости и производительности для поставщика ресурсов Ресурсов Ресурсов Azure Storage.](scalability-targets-resource-provider.md)

## <a name="authorize-with-azure-ad-credentials"></a>Авторизация с учетными данными Azure AD

При вхобьем в Azure CLI с учетными данными Azure AD возвращается токен доступа OAuth 2.0. Этот маркер автоматически используется Azure CLI для авторизации последующих операций данных в отношении хранилища Blob или Очереди. Для поддерживаемых операций больше не требуется передавать ключ учетной записи или маркер SAS с помощью команды.

Можно присвоить разрешения данным blob и очереди директору безопасности Azure AD с помощью элемента управления доступом на основе ролей (RBAC). Для получения дополнительной информации о роли RBAC в хранилище Azure [см. Управление правами доступа к данным хранения Azure с помощью RBAC.](storage-auth-aad-rbac.md)

### <a name="permissions-for-calling-data-operations"></a>Разрешения на вызов операций данных

Расширения хранилища Azure поддерживаются для операций с данными капли и очереди. Какие операции вы можете вызвать, зависит от разрешений, выданных директору безопасности Azure AD, с которым вы впишетесь в Azure CLI. Разрешения на контейнеры или очереди хранилища Azure назначаются через RBAC. Например, если вам назначена роль **читателя данных Blob,** можно запустить команды по сценарию, которые считывают данные из контейнера или очереди. Если вам назначена роль **вкладчика данных Blob,** вы можете запускать команды по сценарию, которые читают, пишут или удаляют контейнер или очередь или содержащиеся в них данные.

Для получения подробной информации о разрешениях, необходимых для [Call storage operations with OAuth tokens](/rest/api/storageservices/authorize-with-azure-active-directory#call-storage-operations-with-oauth-tokens)каждой операции хранения Azure в контейнере или очереди, см.  

### <a name="example-authorize-an-operation-to-create-a-container-with-azure-ad-credentials"></a>Пример: Разрешить операцию по созданию контейнера с учетными данными Azure AD

В следующем примере показано, как создать контейнер из Azure CLI с помощью учетных данных Azure AD. Для создания контейнера необходимо войти в CLI Azure, а также создать группу ресурсов и учетную запись. Чтобы узнать, как создать эти ресурсы, [см.](../blobs/storage-quickstart-blobs-cli.md)

1. Перед созданием контейнера присвоите себе роль [вкладчика хранилища данных Blob.](../../role-based-access-control/built-in-roles.md#storage-blob-data-contributor) Даже если вы являетесь владельцем учетной записи, вам нужны четкие разрешения для выполнения операций данных в отношении учетной записи хранилища. Для получения дополнительной информации о назначении ролей RBAC см. [Грант доступ к каплям Azure и данным очереди с RBAC на портале Azure.](storage-auth-aad-rbac.md)

    > [!IMPORTANT]
    > Распространение ролевых заданий RBAC может занять несколько минут.

1. [Вызовите контейнер хранения](/cli/azure/storage/container#az-storage-container-create) az `--auth-mode` создать `login` команду с набором параметров для создания контейнера с помощью учетных данных Azure AD. Не забудьте заменить значения заполнителей в угловых скобках собственными значениями.

    ```azurecli
    az storage container create \
        --account-name <storage-account> \
        --name sample-container \
        --auth-mode login
    ```

## <a name="authorize-with-the-account-access-key"></a>Авторизация с ключом доступа к учетной записи

Если у вас есть ключ учетной записи, вы можете вызвать любую операцию данных хранилища Azure. Как правило, использование ключа учетной записи является менее безопасным. Если ключ учетной записи скомпрометирован, все данные в вашей учетной записи могут быть скомпрометированы.

В следующем примере показано, как создать контейнер с помощью ключа доступа к учетной записи. Укажите ключ учетной `--auth-mode` записи `key` и предоставьте параметр значению:

```azurecli
az storage container create \
    --account-name <storage-account> \
    --name sample-container \
    --account-key <key>
    --auth-mode key
```

## <a name="authorize-with-a-sas-token"></a>Авторизут с токеном SAS

Если у вас есть токен SAS, можно вызвать операции данных, разрешенные SAS. В следующем примере показано, как создать контейнер с помощью маркера SAS:

```azurecli
az storage container create \
    --account-name <storage-account> \
    --name sample-container \
    --sas-token <token>
```

## <a name="set-environment-variables-for-authorization-parameters"></a>Установка переменных среды для параметров авторизации

Можно указать параметры авторизации в переменных среды, чтобы избежать их включения в каждый вызов в операцию данных данных хранения azure. В следующей таблице описаны доступные переменные среды.

| Переменная среды                  | Описание                                                                                                                                                                                                                                                                                                                                                                     |
|---------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|    AZURE_STORAGE_ACCOUNT              |    имя учетной записи хранения. Эта переменная должна использоваться в сочетании с ключом учетной записи хранилища или токеном SAS. Если ни один из них не присутствует, Azure CLI пытается получить ключ доступа к учетной записи хранилища с помощью аутентифицированной учетной записи Azure AD. Если большое количество команд выполняется одновременно, может быть достигнут предел регулирования ресурсов ресурсов ресурсов Azure Storage. Для получения дополнительной информации об ограничениях поставщика ресурсов см. [Цели масштабируемости и производительности для поставщика ресурсов Ресурсов Ресурсов Azure Storage.](scalability-targets-resource-provider.md)             |
|    AZURE_STORAGE_KEY                  |    Ключ учетной записи хранения. Эта переменная должна использоваться в сочетании с именем учетной записи хранилища.                                                                                                                                                                                                                                                                          |
|    AZURE_STORAGE_CONNECTION_STRING    |    Строка соединения, которая включает ключ учетной записи хранилища или токен SAS. Эта переменная должна использоваться в сочетании с именем учетной записи хранилища.                                                                                                                                                                                                                       |
|    AZURE_STORAGE_SAS_TOKEN            |    Токен общей подписи доступа (SAS). Эта переменная должна использоваться в сочетании с именем учетной записи хранилища.                                                                                                                                                                                                                                                            |
|    AZURE_STORAGE_AUTH_MODE            |    Режим авторизации, с помощью которого можно запустить команду. Разрешенные значения `login` (рекомендуется) `key`или . Если вы `login`укажете, что Azure CLI использует ваши учетные данные Azure AD для авторизации операции данных. Если вы указываете устаревший `key` режим, Azure CLI пытается запросить ключ доступа к учетной записи и авторизовать команду с ключом.    |

## <a name="next-steps"></a>Дальнейшие действия

- [Используйте Azure CLI для присвоения роли RBAC для доступа к данным о каплях и очередях](storage-auth-aad-rbac-cli.md)
- [Разрешить доступ к данным о каплях и очередях с управляемыми идентификаторами для ресурсов Azure](storage-auth-aad-msi.md)
