---
title: Руководство по устранению неполадок в обозревателе хранилищ Azure | Документы Майкрософт
description: Общие сведения о методах отладки обозреватель службы хранилища Azure
services: virtual-machines
author: Deland-Han
ms.service: virtual-machines
ms.topic: troubleshooting
ms.date: 06/15/2018
ms.author: delhan
ms.openlocfilehash: 3e26365c4273611c81682a760695522575f3875d
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61483380"
---
# <a name="azure-storage-explorer-troubleshooting-guide"></a>Руководство по устранению неполадок обозреватель службы хранилища Azure

Обозреватель службы хранилища Microsoft Azure — это автономное приложение, которое упрощает работу с данными из службы хранилища Azure на платформе Windows, macOS и Linux. Приложение может подключаться к учетным записям хранения, размещенным в Azure, National Clouds и Azure Stack.

В этом руководстве приведены решения для распространенных проблем, возникающих с обозревателем хранилищ.

## <a name="role-based-access-control-permission-issues"></a>Проблем с разрешениями управления доступом на основе ролей

[Управление доступом на основе ролей (RBAC)](https://docs.microsoft.com/azure/role-based-access-control/overview) обеспечивает точное управление доступом для ресурсов Azure, объединив наборы разрешений в _ролей_. Вот несколько советов, которые помогут вам получить RBAC, работа в обозревателе службы хранилища.

### <a name="what-do-i-need-to-see-my-resources-in-storage-explorer"></a>Что мне нужно просмотреть мои ресурсы в обозревателе службы хранилища?

Если у вас возникли проблемы, доступа к ресурсам хранилища с помощью RBAC, возможно, так как не были назначены соответствующие роли. Разрешения, обозреватель службы хранилища в настоящее время требуется для доступа к ресурсам хранилища в следующих разделах.

Если вы не уверены, что у вас есть соответствующие роли или разрешения, обратитесь к администратору учетной записи Azure.

#### <a name="read-listget-storage-accounts"></a>Чтение. Перечислить или получить учетные записи хранения

Необходимо иметь разрешение на перечисление учетных записей хранения. Это разрешение можно получить, если назначена роль «Читатель».

#### <a name="list-storage-account-keys"></a>Перечислить ключи учетной записи хранения

Обозреватель службы хранилища можно также использовать ключи учетной записи для проверки подлинности запросов. Вы можете получить доступ к ключам с более мощные ролей, таких как роли «Участник».

> [!NOTE]
> Ключи доступа предоставляют неограниченные разрешения всем, кто их содержит. Таким образом обычно не рекомендуется они передаются за пределы для учетной записи пользователей. Если вам нужно отозвать ключи доступа, можно создать повторно их из [портал Azure](https://portal.azure.com/).

#### <a name="data-roles"></a>Роли данных

Вам должна быть назначена хотя бы одну роль, которая предоставляет доступ чтение данных из ресурсов. Например если требуется перечислить или скачивать большие двоичные объекты, необходимо по крайней мере роль «Читатель данных хранилища BLOB-объектов».

### <a name="why-do-i-need-a-management-layer-role-to-see-my-resources-in-storage-explorer"></a>Зачем мне роли слой управления см. в разделе Мои ресурсы в обозревателе службы хранилища?

Служба хранилища Azure имеет два уровня доступа: _управления_ и _данных_. Подписки и учетные записи хранения осуществляется через уровень управления. Контейнеры, большие двоичные объекты и другие ресурсы данных осуществляется через уровень данных. Например если вы хотите получить список учетных записей хранения из Azure, отправьте запрос к конечной точке управления. Если требуется список контейнеров BLOB-объектов в учетной записи, отправке запроса к соответствующей конечной точке службы.

Роли RBAC может содержать разрешения для управления или данных уровня доступа. Роль «Читатель», например, предоставляет ресурсами уровня управления доступом только для чтения.

Строго говоря роль «Читатель» предоставляет никаких разрешений уровня данных и не является необходимым для доступа на уровне данных.

Обозреватель службы хранилища упрощает доступ к ресурсам, собирая данные, необходимые для подключения к ресурсам Azure для вас. Например для отображения контейнеров больших двоичных объектов, обозревателя службы хранилища отправляет запрос контейнеры списка к конечной точке службы BLOB-объектов. Чтобы получить эту конечную точку, обозреватель хранилищ осуществляет список подписок и учетных записей хранения у вас есть доступ к. Но, чтобы найти подписки и учетные записи хранения, обозреватель хранилищ также необходим доступ к уровень управления.

Если у вас нет роли, разрешения уровня ресурсами, обозреватель службы хранилища не удается получить сведения, необходимые для подключения к уровню данных.

### <a name="what-if-i-cant-get-the-management-layer-permissions-i-need-from-my-administrator"></a>Что делать, если не удается получить управление уровень разрешений требуется от администратора?

Это решение, связанные с RBAC еще нет в данный момент. Чтобы избежать этого, вы можете запросить URI SAS для [присоединить к ресурсу](https://docs.microsoft.com/azure/vs-azure-tools-storage-manage-with-storage-explorer?tabs=linux#attach-a-service-by-using-a-shared-access-signature-sas).

## <a name="error-self-signed-certificate-in-certificate-chain-and-similar-errors"></a>Ошибка: "Самозаверяющий сертификат в цепочке сертификатов" (и подобные ей ошибки)

Ошибки сертификата вызваны одной из двух следующих ситуаций:

1. Приложение подключается с помощью "прозрачного прокси-сервера". Это означает, что сервер (например, сервер вашей компании) перехватывает трафик HTTPS, расшифровывает его, а затем шифрует с помощью самозаверяющего сертификата.
2. Работающее приложение внедряет самозаверяющий сертификат SSL в получаемые сообщения HTTPS. К примерам приложений, которые внедряют сертификаты, относятся антивирусные программы и программное обеспечение для проверки трафика.

Когда Обозреватель службы хранилища обнаруживает самозаверяющий или недоверенный сертификат, он уже не может определить, было ли изменено принятое сообщение HTTPS. Если у вас есть копия самозаверяющего сертификата, вы можете настроить доверие к нему в Обозревателе службы хранилища, выполнив следующее.

1. Получите копию сертификата X.509 (.cer) в кодировке Base-64.
2. Щелкните **Изменить** > **SSL-сертификаты** > **Импорт сертификатов**, а затем с помощью средства выбора файлов найдите, выберите и откройте CER-файл.

Эта проблема также может быть результатом наличия нескольких сертификатов (корневого и промежуточного). Для устранения ошибки необходимо добавить оба сертификата.

Если вы не уверены в том, откуда получен сертификат, вы можете попробовать выполнить следующие действия:

1. Установите Open SSL.
    * [Windows](https://slproweb.com/products/Win32OpenSSL.html) (любой из облегченных версий должно быть достаточно)
    * MAC и Linux: этот компонент должен быть включен в операционную систему
2. Запустите Open SSL.
    * Windows: откройте каталог установки, щелкните **/bin/**, а затем дважды щелкните **openssl.exe**.
    * MAC и Linux: запустите **openssl** из терминала.
3. Выполните команду `s_client -showcerts -connect microsoft.com:443`.
4. Найдите самозаверяющие сертификаты. Если вы не знаете сертификатов являются самозаверяющими, найдите сертификаты, субъект `("s:")` и издателя `("i:")` одинаковы.
5. Когда вы найдете самозаверяющие сертификаты, для каждого из них скопируйте и вставьте все содержимое от **---BEGIN CERTIFICATE---** до **---END CERTIFICATE---** включительно в новый CER-файл.
6. Откройте обозреватель хранилищ, щелкните **Изменить** > **SSL-сертификаты** > **Импорт сертификатов**, а затем с помощью средства выбора файлов найдите, выберите и откройте созданные CER-файлы.

Если вам не удалось найти самозаверяющие сертификаты, используя приведенные выше инструкции, свяжитесь с нами при помощи средства обратной связи, чтобы получить дополнительные сведения. Кроме того, вы можете запустить Обозреватель службы хранилища из командной строки с флагом `--ignore-certificate-errors`. При запуске с этим флагом Обозреватель службы хранилища будет игнорировать ошибки сертификата.

## <a name="sign-in-issues"></a>Проблемы при входе

### <a name="blank-sign-in-dialog"></a>Пустое окно регистрации

Пустой диалоговые окна входа в систему чаще всего вызваны ADFS запросом обозреватель службы хранилища для выполнения перенаправления, который не поддерживается программой Electron. Чтобы решить эту проблему вы можете попытаться использовать для входа поток кода устройства. Для этого выполните следующие действия:

1. «Перейти к предварительной версии» -> «Использовать вход устройств кода».
2. Откройте диалоговое окно "Подключить" (либо с помощью значка подключения в левом вертикальном меню, либо используя "Добавить учетную запись" на панели учетной записи).
3. Выберите какое окружение вы хотите войти.
4. Нажмите кнопку "Войти".
5. Следуйте инструкциям на следующей панели.

Если вы находитесь возникли проблемы при входе в учетной записи, которую вы хотите использовать, так как браузер по умолчанию уже осуществил вход в другую учетную запись, вы можете либо:

1. Вручную скопировать ссылку и код в закрытом режиме вашего браузера.
2. Вручную скопировать ссылку и код в другой браузер.

### <a name="reauthentication-loop-or-upn-change"></a>Цикл повторной аутентификации или изменение имени участника-пользователя

Если вы находитесь в цикле повторной аутентификации или изменили имя участника-пользователя одной из своих учетных записей, попробуйте выполнить следующее:

1. Удалите все учетные записи, а затем закройте Обозреватель службы хранилища.
2. Удалите папку .IdentityService с компьютера. В Windows папка находится в расположении `C:\users\<username>\AppData\Local`. Для Mac и Linux вы можете найти папку в корневой папке каталога пользователя.
3. Если вы используете Mac или Linux, вам также потребуется удалить запись Microsoft.Developer.IdentityService из хранилища ключей вашей ОС. В Mac хранилище ключей — это приложение Gnome Keychain. Для Linux приложение обычно называется Keyring, но имя может отличаться в зависимости от вашего дистрибутива.

### <a name="conditional-access"></a>условный доступ;

Когда обозреватель службы хранилища используется в ОС Windows 10, Linux или macOS, то условный доступ не поддерживается. Это происходит из-за ограничения в библиотеке AAD, используемой обозревателем службы хранилища.

## <a name="mac-keychain-errors"></a>Ошибки цепочки ключей Mac

Иногда цепочка ключей MacOS может перейти в состояние, которое вызывает проблемы с библиотекой аутентификации Обозревателя службы хранилища. Чтобы извлечь цепочку ключей это состояние, выполните следующие действия:

1. Закройте Обозреватель службы хранилища.
2. Откройте цепочку (нажмите клавиши **CMD+ПРОБЕЛ**, введите цепочку ключей и нажмите клавишу "ВВОД").
3. Выберите цепочку ключей login.
4. Щелкните значок замка, чтобы заблокировать цепочку ключей (по завершении замок на значке закроется, на что может потребоваться несколько секунд в зависимости от открытых приложений).

    ![image](./media/storage-explorer-troubleshooting/unlockingkeychain.png)

5. Запустите Обозреватель службы хранилища.
6. Откроется всплывающее окно с сообщением примерно такого содержания: "Центр обслуживания хочет получить доступ к цепочке ключей". Когда оно откроется, введите пароль учетной записи администратора Mac и щелкните **Всегда разрешать** (или **Разрешить**, если **Всегда разрешать** недоступно).
7. Попробуйте выполнить вход.

### <a name="general-sign-in-troubleshooting-steps"></a>Общие действия по устранению неполадок входа

* Если в macOS, и никогда не отображается окно входа в систему через «ожидание проверки подлинности...» диалоговое окно, затем повторите [следующие действия](#mac-keychain-errors)
* Перезапуск Обозревателя службы хранилища
* Если диалоговое окно проверки подлинности пустое, подождите не менее одной минуты, прежде чем его закрыть.
* Убедитесь, что параметры прокси-сервера и сертификата правильно настроены как для вашего компьютера, так и для Обозревателя службы хранилища.
* Если вы используете Windows и иметь доступ к Visual Studio 2017 на одном компьютере и войдите, попробуйте войти в Visual Studio 2017. После успешного входа в Visual Studio 2017 вы сможете открыть обозреватель хранилища и просмотреть свою учетную запись на панели учетных записей.

Если ни один из этих методов не работает, [начните обсуждение проблемы на сайте GitHub](https://github.com/Microsoft/AzureStorageExplorer/issues).

### <a name="missing-subscriptions-and-broken-tenants"></a>Отсутствие подписки и неисправные клиенты

Если не удается получить подписки после успешного входа, выполните следующие методы для устранения этой проблемы.

* Убедитесь, что учетная запись имеет доступ к необходимым подпискам. Вы можете проверить ваш доступ, войдя на портал для среды Azure, которую вы пытаетесь использовать.
* Убедитесь, что вы выполнили вход в правильную среду Azure (Azure, Azure для Китая через 21Vianet, Azure для Германии, Azure для государственных организаций США или пользовательскую среду).
* При подключении через прокси-сервер убедитесь, что прокси-сервер обозревателя хранилищ настроен правильно.
* Попробуйте удалить и снова добавить учетную запись.
* Если имеется ссылка "Дополнительные сведения", просмотрите, какие сообщения об ошибках появляются для неисправных клиентов. Если вы не знаете, что делать с сообщениями об ошибках, отправьте [проблему в репозиторий GitHub](https://github.com/Microsoft/AzureStorageExplorer/issues).

## <a name="cannot-remove-attached-account-or-storage-resource"></a>Не удается удалить подключенную учетную запись или ресурс хранилища

Если вы не можете удалить подключенную учетную запись или ресурс хранилища через пользовательский интерфейс, вы можете вручную удалить все подключенные ресурсы, удалив следующие папки:

* Windows: `%AppData%/StorageExplorer`
* macOS: `/Users/<your_name>/Library/Application Support/StorageExplorer`
* Linux: `~/.config/StorageExplorer`

> [!NOTE]
> Перед удалением вышеуказанных папок закройте Обозреватель службы хранилища.

> [!NOTE]
> Если вы когда-либо импортировали SSL-сертификаты, то создайте резервную копию содержимого каталога `certs`. Позже вы сможете использовать резервную копию, чтобы повторно импортировать сертификаты SSL.

## <a name="proxy-issues"></a>Проблемы с прокси-сервером

Во-первых, убедитесь, что вы правильно указали следующие сведения:

* URL-адрес прокси-сервера и номер порта;
* имя пользователя и пароль, если этого требует прокси-сервер.

> [!NOTE]
> Обозреватель службы хранилища не поддерживает файлы автоматической настройки прокси-сервер для настройки параметров прокси-сервера.

### <a name="common-solutions"></a>Распространенные решения

Если у вас по-прежнему возникают проблемы, попробуйте следующие методы устранения неполадок:

* Если можно подключиться к Интернету без использования прокси-сервера, проверьте, будет ли обозреватель хранилищ работать с отключенными параметрами прокси-сервера. Если это так, возможно, проблема связана с параметрами прокси-сервера. Обратитесь к администратору прокси-сервера, чтобы определить проблему.
* Убедитесь, что другие приложения, использующие прокси-сервер, работают корректно.
* Убедитесь, что вы можете подключиться к порталу для среды Azure, которую вы пытаетесь использовать.
* Убедитесь, что вы можете получать ответы от конечных точек службы. Введите один из URL-адресов конечной точки в браузере. Если вам удается подключиться, вы должны получить ответ InvalidQueryParameterValue или аналогичный XML-ответ.
* Если другие пользователи также используют обозреватель хранилищ с вашим прокси-сервером, проверьте, могут ли они подключаться. Если у них не возникает проблем с подключением, возможно, вам потребуется обратиться к администратору прокси-сервера.

### <a name="tools-for-diagnosing-issues"></a>Инструменты для выявления проблем

Если вы используете средства работы с сетью, такие как Fiddler для Windows, можно попробовать диагностировать проблемы следующим образом.

* Если вам необходимо подключаться через прокси-сервер, может потребоваться настроить сетевые средства для подключения через прокси-сервер.
* Проверьте номер порта, используемый средством для работы с сетью.
* Введите URL-адрес локального узла и номер порта сетевого средства как параметры прокси-сервера в обозревателе хранилищ. Если выполнить эту процедуру правильно, средство для работы с сетью начнет регистрировать сетевые запросы, отправляемые Обозревателем службы хранилища в конечные точки управления и служб. Например, введите адрес https://cawablobgrs.blob.core.windows.net/ для конечной точки хранилища BLOB-объектов в браузере и вы получите примерно следующий ответ, который предполагает, что ресурс существует, несмотря на то, что к нему нет доступа.

![пример кода](./media/storage-explorer-troubleshooting/4022502_en_2.png)

### <a name="contact-proxy-server-admin"></a>Обратитесь к администратору прокси-сервера

Если параметры прокси-сервера настроены правильно, обратитесь к администратору прокси-сервера и

* убедитесь, что прокси-сервер не блокирует трафик к конечным точкам управления или ресурсов Azure.
* Проверьте протокол аутентификации, используемый прокси-сервером. Обозреватель хранилищ пока не поддерживает прокси-серверы NTLM.

## <a name="unable-to-retrieve-children-error-message"></a>Сообщение об ошибке "Не удается получить дочерние элементы"

Если вы подключаетесь к Azure через прокси-сервер, убедитесь, что его параметры настроены правильно. Если вам предоставляется доступ к ресурсу от владельца подписки или учетной записи, убедиться, что прочитали или список разрешений для этого ресурса.

## <a name="connection-string-does-not-have-complete-configuration-settings"></a>Строка подключения не содержит всех параметров конфигурации

Появление этого сообщения об ошибке может означать, что вы не обладаете достаточными правами для получения ключей учетной записи хранения. Чтобы в этом убедится, перейдите на портал и найдите учетную запись хранения. Быстро, это можно сделать, щелкнув правой кнопкой мыши на узле для вашей учетной записи хранения и выбрав «В открытых в портал». После этого перейдите к колонке "Ключи доступа". Если у вас нет разрешений на просмотр ключи, вы увидите страницу с сообщением «У вас нет доступа». Чтобы обойти эту проблему, вы можете получить ключ учетной записи от кого-нибудь и подключение с именем и ключом, или можно попросить кого-нибудь для SAS учетной записи хранения и использовать для присоединения учетной записи хранения.

Если вы видите ключи учетной записи, сообщите о проблеме на GitHub, мы можем помочь вам устранить проблему.

## <a name="issues-with-sas-url"></a>Проблемы с URL-адресом SAS

Если вы подключаетесь к службе с помощью URL-адреса SAS и возникает эта ошибка:

* убедитесь, что URL-адрес предоставляет необходимые разрешения на чтение или перечисление ресурсов.
* Убедитесь, что срок действия URL-адреса не истек.
* Если URL-адрес основан на политике доступа, убедитесь, что политика доступа не была отозвана.

Если вы случайно подключились с помощью недопустимого URL-адреса SAS и отключиться не удается, выполните следующие действия:

1. Если запущен обозреватель хранилища, нажмите клавишу F12, чтобы открыть окно средств для разработчиков.
2. Щелкните вкладку "Приложение" и выберите "Локальное хранилище > file://" в дереве слева.
3. Найти ключ, связанный с типом службы для проблемного URI SAS. Например, если неверный URI SAS относится к контейнеру больших двоичных объектов, найдите ключ с именем `StorageExplorer_AddStorageServiceSAS_v1_blob`.
4. Значение ключа должно быть массивом JSON. Найдите объект, связанный с неправильным URI, и удалите его.
5. Нажмите клавиши CTRL+R, чтобы перезагрузить обозреватель хранилища.

## <a name="linux-dependencies"></a>Зависимости Linux

В общем случае обозреватель службы хранилища под управлением Linux требуются следующие пакеты:

* [Среда выполнения .NET core 2.0](https://docs.microsoft.com/dotnet/core/linux-prerequisites?tabs=netcore2x)
* `libgnome-keyring-common` и `libgnome-keyring-dev`
* `libgconf-2-4`

В зависимости от вашего дистрибутива, могут существовать разные или дополнительные пакеты необходимо установить.

Обозреватель хранилищ официально поддерживается на 18.04 для Ubuntu 16.04 и 14.04. Далее приведены действия по установке для чистого машин.

# <a name="ubuntu-1804tab1804"></a>[Ubuntu 18.04](#tab/1804)

1. Скачивание обозревателя службы хранилища
2. Установить среду выполнения .NET Core, самой последней версии проверенных: [2.0.8](https://dotnet.microsoft.com/download/linux-package-manager/ubuntu18-04/runtime-2.0.8) (Если вы уже установили более новой версии, может потребоваться исправление обозревателя службы хранилища, см. ниже)
3. Выполнить `sudo apt-get install libgconf-2-4`
4. Выполнить `sudo apt install libgnome-keyring-common libgnome-keyring-dev`

# <a name="ubuntu-1604tab1604"></a>[Ubuntu 16.04](#tab/1604)

1. Скачивание обозревателя службы хранилища
2. Установить среду выполнения .NET Core, самой последней версии проверенных: [2.0.8](https://dotnet.microsoft.com/download/linux-package-manager/ubuntu16-04/runtime-2.0.8) (Если вы уже установили более новой версии, может потребоваться исправление обозревателя службы хранилища, см. ниже)
3. Выполнить `sudo apt install libgnome-keyring-dev`

# <a name="ubuntu-1404tab1404"></a>[Ubuntu 14.04](#tab/1404)

1. Скачивание обозревателя службы хранилища
2. Установить среду выполнения .NET Core, самой последней версии проверенных: [2.0.8](https://dotnet.microsoft.com/download/linux-package-manager/ubuntu14-04/runtime-2.0.8) (Если вы уже установили более новой версии, может потребоваться исправление обозревателя службы хранилища, см. ниже)
3. Выполнить `sudo apt install libgnome-keyring-dev`

---

### <a name="patching-storage-explorer-for-newer-versions-of-net-core"></a>Исправление обозревателя службы хранилища для более новых версиях .NET Core 
При наличии версии .NET Core больше 2.0 установлена и обозреватель хранилищ версии 1.7.0 или более ранней версии, вы наверняка потребуются на исправление обозреватель хранилищ, выполнив следующие действия:
1. Загрузить версию 1.5.43 StreamJsonRpc [из nuget](https://www.nuget.org/packages/StreamJsonRpc/1.5.43). Найдите ссылку «Загрузить пакет» в правой части страницы.
2. После загрузки пакета, измените расширение файла из `.nupkg` для `.zip`
3. Распакуйте пакет
4. Перейдите на сайт `streamjsonrpc.1.5.43/lib/netstandard1.1/`.
5. Копировать `StreamJsonRpc.dll` в следующие расположения в папке обозреватель службы хранилища:
    1. `StorageExplorer/resources/app/ServiceHub/Services/Microsoft.Developer.IdentityService/`
    2. `StorageExplorer/resources/app/ServiceHub/Hosts/ServiceHub.Host.Core.CLR.x64/`

## <a name="open-in-explorer-from-azure-portal-doesnt-work"></a>Откройте в обозревателе из портала Azure не работает

Если не работает кнопка «Открыть в Explorer,» на портале Azure, убедитесь, что вы используете совместимый обозреватель. Следующие браузеры были протестированы на совместимость.
* Microsoft Edge
* Mozilla Firefox
* Google Chrome
* Microsoft Internet Explorer

## <a name="next-steps"></a>Дальнейшие действия

Если ни одно из решений не работает, [начните обсуждение проблемы на сайте GitHub](https://github.com/Microsoft/AzureStorageExplorer/issues). Вы также можете быстро перейти на сайт GitHub с помощью кнопки "Report issue to GitHub" (Сообщить о проблеме на GitHub) в нижнем левом углу.

![Отзыв](./media/storage-explorer-troubleshooting/feedback-button.PNG)
