---
title: Часто задаваемые вопросы о службе файлов Azure | Документация Майкрософт
description: Получите ответы на некоторые часто задаваемые вопросы о службе "Файлы Azure".
author: roygara
ms.service: storage
ms.date: 02/23/2020
ms.author: rogarana
ms.subservice: files
ms.topic: conceptual
ms.openlocfilehash: 01b5f87c2557e2195573b90766ee45e001798cca
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "81537701"
---
# <a name="frequently-asked-questions-faq-about-azure-files"></a>Часто задаваемые вопросы о службе файлов Azure
[Служба файлов Azure](storage-files-introduction.md) предоставляет полностью управляемые общие файловые ресурсы в облаке, доступ к которым можно получить с помощью стандартного отраслевого [протокола SMB](https://msdn.microsoft.com/library/windows/desktop/aa365233.aspx). Общие ресурсы службы файлов Azure можно одновременно подключить к облачным или локальным развертываниям Windows, Linux и macOS. Вы также можете кэшировать общие файловые ресурсы Azure на компьютерах под управлением Windows Server с помощью функции "Синхронизация файлов Azure", чтобы получить быстрый доступ из расположения, где используются данные.

В этой статье приведены ответы на часто задаваемые вопросы о возможностях и функциях службы файлов Azure, включая использование синхронизации файлов Azure в отношении этой службы. Если вы не нашли ответ на свой вопрос, свяжитесь с нами, используя следующие каналы (в порядке эскалации):

1. Раздел комментариев этой статьи.
2. [Форум по службе хранилища Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=windowsazuredata).
3. [UserVoice службы файлов Azure](https://feedback.azure.com/forums/217298-storage/category/180670-files). 
4. Служба поддержки Майкрософт. Чтобы создать запрос на поддержку на портале Azure, на вкладке **Справка** нажмите кнопку **Справка и поддержка**, а затем выберите **Новый запрос на поддержку**.

## <a name="general"></a>Общие
* <a id="why-files-useful"></a>
  **Чем полезна служба файлов Azure?**  
   Вы можете использовать эту службу, чтобы создавать общие файловые ресурсы в облаке без необходимости управления дополнительными нагрузками физического сервера, устройства или модуля. Всю эту монотонную работу мы делаем за вас, включая обновления ОС и замену неработоспособных дисков. Дополнительные сведения о сценариях, для работы с которыми будет полезна служба файлов Azure, см. в разделе [Зачем нужна служба файлов Azure](storage-files-introduction.md#why-azure-files-is-useful).

* <a id="file-access-options"></a>
  **Какие имеются способы доступа к файлам в службе файлов Azure?**  
    Вы можете подключить общую папку на локальном компьютере с помощью протокола SMB 3.0 или использовать такие средства, как [обозреватель службы хранилища](https://storageexplorer.com/), для доступа к файлам в общей папке. Для доступа к файлам в общем файловом ресурсе Azure из приложения можно использовать клиентские библиотеки хранилища, REST API, PowerShell или Azure CLI.

* <a id="what-is-afs"></a>
  **Что такое служба "Синхронизация файлов Azure"?**  
    Вы можете использовать службу синхронизации файлов Azure, чтобы централизованно хранить файловые ресурсы организации в службе файлов Azure, обеспечивая гибкость, производительность и совместимость локального файлового сервера. Это достигается путем преобразования компьютеров Windows Server в быстрый кэш общего файлового ресурса Azure. Для локального доступа к данным вы можете использовать любой протокол, в том числе SMB, NFS и FTPS, доступный в Windows Server. Кроме того, вы можете создать любое количество кэшей в любом регионе.

* <a id="files-versus-blobs"></a>
  **Почему для хранения данных предпочтительнее использовать файловый ресурс Azure, а не хранилище BLOB-объектов Azure?**  
    Эти службы позволяют хранить большой объем данных в облаке, но их предназначение несколько различно. 
    
    Хранилище BLOB-объектов Azure можно использовать для облачных приложений с широкими возможностями масштабирования для хранения неструктурированных данных. Чтобы добиться максимальной производительности и масштабируемости, лучше не использовать хранилище BLOB-объектов Azure, так как в сравнении с реальной файловой системой оно представляет собой упрощенный вариант хранения. Доступ к хранилищу BLOB-объектов Azure можно получить только с помощью клиентских библиотек на основе REST (или напрямую через протокол REST).

    Служба файлов Azure главным образом представляет собой файловую систему. Служба "Файлы Azure" содержит все известные вам абстракции, связанные с файлами, с которыми вы знакомы в течение длительного времени использования локальных операционных систем. Как и хранилище BLOB-объектов Azure, служба "Файлы Azure" предлагает интерфейс REST и клиентские библиотеки на основе REST. Разница состоит в том, что служба "Файлы Azure" также предлагает доступ к файловым ресурсам Azure по SMB. Используя протокол SMB, можно напрямую подключить файловый ресурс Azure в Windows, Linux, macOS, локально или на виртуальных машинах в облаке без необходимости написания кода или подключения каких-либо специальных драйверов к файловой системе. Вы также можете кэшировать общие файловые ресурсы Azure на локальных файловых серверах с помощью службы "Синхронизация файлов Azure", чтобы получить быстрый доступ из расположения, где используются данные. 
   
    Более подробное описание различий между файлами Azure и хранилищем BLOB-объектов Azure см. в статье [Общие сведения о базовых службах хранилища Azure](../common/storage-introduction.md). Дополнительные сведения о хранилище BLOB-объектов Azure см. в статье [Общие сведения о хранилище BLOB-объектов](../blobs/storage-blobs-introduction.md).

* <a id="files-versus-disks"></a>**Почему предпочтительнее использовать файловый ресурс Azure, а не диски Azure?**  
    Диски Azure — это обычные диски. Чтобы диск Azure стал полезен, его необходимо подключить к виртуальной машине, работающей в Azure. С дисками Azure можно работать во всех случаях, когда их использование на локальном сервере практично. Диск Azure можно использовать как системный диск ОС, область буфера ОС или выделенное хранилище приложения. Интересный способ использования дисков Azure — это создание файлового сервера в облаке для использования в тех же расположениях, в которых используется файловый ресурс Azure. Развертывание файлового сервера на виртуальных машинах Azure — это эффективный способ получить файловое хранилище в Azure, когда вам требуются параметры развертывания, не поддерживаемые службой "Файлы Azure" по состоянию на текущий момент (например, поддержка протокола NFS или хранилища класса Premium). 

    Тем не менее запуск файлового сервера с помощью дисков Azure, используемых в качестве серверного хранилища, обойдется гораздо дороже, чем использование файлового ресурса Azure. Причины следующие. Первая. Кроме оплаты использования дискового хранилища вам также необходимо будет оплатить стоимость работы одной или нескольких виртуальных машин Azure. Вторая. Вам также придется управлять виртуальными машинами, используемыми для запуска файлового сервера, например обновлять ОС. И третья. Если в конечном счете вам потребуется локальное кэширование данных, то для реализации такого кэширования вы сами должны будете настроить технологии репликации, например репликацию распределенной файловой системы (DFSR), а также управлять ими.

    Один из способов, который вы можете применить (кроме использования дисков Azure в качестве серверного хранилища), чтобы по максимуму использовать возможности службы "Файлы Azure" и файлового сервера, размещенного на виртуальных машинах Azure, — установить службу синхронизации файлов Azure на этом файловом сервере, размещенном на виртуальной машине в облаке. Если файловый ресурс Azure находится в том же регионе, что и файловый сервер, можно включить распределение по уровням облака и задать максимальный процент (99 %) свободного пространства на диске. Это обеспечит минимальное дублирование данных, а вы сможете использовать любые необходимые вам приложения на файловых серверах, например, которым нужно поддерживать протокол NFS.

    Дополнительные сведения о способе настройки высокопроизводительного и высокодоступного файлового сервера в Azure см. в записи блога о [развертывании гостевых кластеров виртуальной машины IaaS в Microsoft Azure](https://blogs.msdn.microsoft.com/clustering/2017/02/14/deploying-an-iaas-vm-guest-clusters-in-microsoft-azure/). Более подробное описание различий между файлами Azure и дисками Azure см. в статье [Общие сведения о базовых службах хранилища Azure](../common/storage-introduction.md). Дополнительные сведения о дисках Azure см. в статье [Обзор компонента "Управляемые диски" Azure](../../virtual-machines/windows/managed-disks-overview.md).

* <a id="get-started"></a>
  **Как начать работу со службой файлов Azure?**  
   Это очень легко. Сначала необходимо создать [файловый ресурс](storage-how-to-create-file-share.md) и подключить его к операционной системе по своему усмотрению: 

  * [Windows](storage-how-to-use-files-windows.md)
  * [Linux](storage-how-to-use-files-linux.md)
  * [macOS](storage-how-to-use-files-mac.md)

    Более подробные сведения по развертыванию общего файлового ресурса Azure для замены рабочих файловых ресурсов в вашей организации см. в статье [Планирование развертывания службы файлов Azure](storage-files-planning.md).

* <a id="redundancy-options"></a>
  **Какие параметры избыточности хранилища поддерживаются в службе "Файлы Azure"?**  
    Сейчас служба файлов Azure поддерживает локально избыточное хранилище (LRS), хранилище, избыточное в виде зоны (ZRS), геоизбыточное хранилище (GRS) и хранилище, избыточное в геопоясе (ГЗРС) (Предварительная версия). В будущем мы планируем включить поддержку геоизбыточного хранилища с доступом на чтение (RA-GRS), но о конкретных сроках пока говорить рано.

* <a id="tier-options"></a>
  **Какие уровни хранилища поддерживаются службой файлов Azure?**  
    Служба файлов Azure поддерживает два уровня хранилища: "Премиум" и "Стандартный". Стандартные общие файловые ресурсы создаются в учетных записях хранения общего назначения (GPv1 или GPv2), а общие файловые ресурсы Premium создаются в учетных записях хранения Филестораже. Узнайте больше о том, как создавать [стандартные общие файловые ресурсы](storage-how-to-create-file-share.md) и [Общие файловые ресурсы](storage-how-to-create-premium-fileshare.md)уровня "Премиум". 
    
    > [!NOTE]
    > Вы не можете создавать файловые ресурсы Azure из учетных записей хранения BLOB-объектов или учетных записей хранения *класса Premium* общего назначения (GPv1 или GPv2). Стандартные общие папки Azure должны создаваться только в *стандартных* учетных записях, а общие файловые ресурсы Azure Premium — только в учетных записях хранения филестораже. Учетные записи хранения *Premium* общего назначения (GPv1 и GPv2) предназначены только для страничных BLOB-объектов класса Premium. 

* <a id="give-us-feedback"></a>
  **Я очень хочу увидеть, какой компонент добавлен в службу файлов Azure. Можно ли добавить его?**  
    Рабочая группа службы файлов Azure готова рассмотреть все предложения и отзывы в отношении своей работы. Проголосуйте за вариант, который вам понравился, на странице, посвященной [оптимизации службы хранилища Azure](https://feedback.azure.com/forums/217298-storage/category/180670-files). Мы заинтересованы в разработке новых полезных функций.

  **Поддерживает ли служба "файлы Azure" блокировку файлов?**  
    Да, служба файлов Azure полностью поддерживает блокировку файлов в формате SMB/Windows. Дополнительные [сведения см](https://docs.microsoft.com/rest/api/storageservices/managing-file-locks). в этой статье. 
    
## <a name="azure-file-sync"></a>Служба синхронизации файлов Azure

* <a id="afs-region-availability"></a>
  **В каких регионах поддерживается функция "Синхронизация файлов Azure"?**  
    Список доступных регионов можно найти в [этом разделе](storage-sync-files-planning.md#azure-file-sync-region-availability) руководства по планированию развертывания функции "Синхронизация файлов Azure". Мы планируем постоянно добавлять дополнительные регионы, в том числе регионы, не являющиеся общедоступными.

* <a id="cross-domain-sync"></a>
  **Могут ли в одной группе синхронизации находиться серверы, присоединенные к домену, и серверы, независимые от него?**  
    Да. Группа синхронизации может содержать конечные точки сервера, которые могут принадлежать к разным группам Active Directory, даже если они независимы от домена. Хотя технически такая конфигурация работает, мы не рекомендуем ее использовать как стандартную, так как списки ACL, определенные для файлов и папок на одном сервере, могут не учитываться другими серверами в этой же группе синхронизации. Чтобы получить оптимальные результаты, мы рекомендуем выполнить синхронизацию между серверами в одном лесу Active Directory, серверами в разных лесах Active Directory с установленными отношениями доверия или между серверами, независимыми от домена, а не использовать все варианты сразу.

* <a id="afs-change-detection"></a>
  **Файл создан непосредственно в файловом ресурсе Azure с помощью SMB или на портале. Сколько времени требуется для синхронизации файла с серверами в группе синхронизации?**  
    [!INCLUDE [storage-sync-files-change-detection](../../../includes/storage-sync-files-change-detection.md)]

* <a id="afs-conflict-resolution"></a>**Что произойдет, если один и тот же файл изменяется на двух серверах примерно в одно и то же время?**  
    Служба синхронизации файлов Azure использует простую стратегию разрешения конфликта — будут выполнены все изменения. Сохранится имя того файла, который был изменен последним. Файл с более ранними изменениями будет содержать имя исходного компьютера и номер конфликта, добавленный к этому имени на основе таксономии ниже: 
   
    \<имя_файла_без_разрешения\>-\<имя_компьютера\>\[-#\].\<ext\>  

    Например, файл CompanyReport.docx при первом конфликте станет CompanyReport-CentralServer.docx, где CentralServer является расположением, в котором запись изменений произошла раньше. Для второго конфликта соответственно будет использоваться имя CompanyReport-CentralServer-1.docx. Синхронизация файлов Azure поддерживает файлы конфликтов 100 для каждого файла. После достижения максимального количества конфликтующих файлов файл не будет синхронизироваться, пока число конфликтующих файлов не будет меньше 100.

* <a id="afs-storage-redundancy"></a>
  **Поддерживает ли служба "Синхронизация файлов Azure" геоизбыточное хранилище?**  
    Да, служба файлов Azure поддерживает локально избыточное хранилище (LRS) и геоизбыточное хранилище (GRS). Если отработка отказа учетной записи хранения запускается между связанными регионами из учетной записи, настроенной для GRS, корпорация Майкрософт рекомендует рассматривать новую область только как резервную копию данных. Служба синхронизации файлов Azure не запустит автоматическую синхронизацию с новым основным регионом. 

* <a id="sizeondisk-versus-size"></a>
  **Почему свойство Size *на диске* файла не соответствует свойству *size* после использования Синхронизация файлов Azure?**  
  См. в разделе статьи [Общие сведения о распределении по уровням в облаке](storage-sync-cloud-tiering.md#sizeondisk-versus-size).

* <a id="is-my-file-tiered"></a>
  **Как определить, был ли файл многоуровневый?**  
  См. в разделе статьи [Общие сведения о распределении по уровням в облаке](storage-sync-cloud-tiering.md#is-my-file-tiered).

* <a id="afs-recall-file"></a>**Файл, который я хочу использовать, был многоуровневый. Как можно отозвать файл на диск, чтобы использовать его локально?**  
  См. в разделе статьи [Общие сведения о распределении по уровням в облаке](storage-sync-cloud-tiering.md#afs-recall-file).

* <a id="afs-force-tiering"></a>
  **Разделы справки настроить многоуровневый файл или каталог?**  
  См. в разделе статьи [Общие сведения о распределении по уровням в облаке](storage-sync-cloud-tiering.md#afs-force-tiering).

* <a id="afs-effective-vfs"></a>
  **Как определяется *свободное место в томе*, если в нем используется несколько конечных точек сервера?**  
  См. в разделе статьи [Общие сведения о распределении по уровням в облаке](storage-sync-cloud-tiering.md#afs-effective-vfs).

* <a id="afs-files-excluded"></a>
  **Какие файлы или папки автоматически исключены в службе "Синхронизация файлов Azure"?**  
  См. раздел [пропущенные файлы](storage-sync-files-planning.md#files-skipped).

* <a id="afs-os-support"></a>
  **Могу ли я использовать службу "Синхронизация файлов Azure" с Windows Server 2008 R2, Linux или своим запоминающим устройством, подключаемым к сети (NAS)?**  
    В настоящее время Синхронизация файлов Azure поддерживает только Windows Server 2019, Windows Server 2016 и Windows Server 2012 R2. В данный момент мы ничего не планируем, но мы с радостью рассмотрим предложения по поводу поддержки дополнительных платформ, проанализировав потребности клиентов. Сообщите нам о платформах, для которых нужно реализовать поддержку, на портале [UserVoice службы файлов Azure](https://feedback.azure.com/forums/217298-storage/category/180670-files).

* <a id="afs-tiered-files-out-of-endpoint"></a>
  **Почему многоуровневые файлы существуют вне пространства имен конечной точки сервера?**  
    До выпуска агента службы "Синхронизация файлов Azure" версии 3 эта служба блокировала перемещение многоуровневых файлов за пределы конечной точки сервера, но на тот же том, на котором размещена эта конечная точка сервера. Это не затрагивало операции копирования, перемещение файлов без уровней и перемещение многоуровневых файлов на другие тома. Причиной такого поведения было неявное предположение о том, что проводник и другие интерфейсы API Windows обрабатывают эти операции перемещения на тот же том, что и (практически) мгновенные операции переименования. Это означает, что после перемещения с помощью проводника или других методов перемещения (например, командной строки или PowerShell) будет невозможно отозвать данные из облака с помощью службы "Синхронизация файлов Azure". Начиная с [агента службы "Синхронизация файлов Azure" версии 3.0.12.0](storage-files-release-notes.md#supported-versions) эта служба позволяет переместить многоуровневый файл за пределы конечной точки сервера. Мы избегаем упомянутых выше проблем, позволяя многоуровневому файлу существовать в виде многоуровневого файла за пределами конечной точки сервера, а затем отзывая этот файл в фоновом режиме. Это означает, что перемещение в пределах тома выполняется мгновенно, и мы выполняем все действия для отзыва файла на диск после завершения перемещения. 

* <a id="afs-do-not-delete-server-endpoint"></a>
  **Возникла неполадка с Синхронизация файлов Azure на моем сервере (синхронизация, распределение по уровням облака и т. д.). Следует ли удалить и повторно создать конечную точку сервера?**  
    [!INCLUDE [storage-sync-files-remove-server-endpoint](../../../includes/storage-sync-files-remove-server-endpoint.md)]
    
* <a id="afs-resource-move"></a>
  **Можно ли переместить службу синхронизации хранилища и/или учетную запись хранения в другую группу ресурсов или подписку?**  
   Да, службу синхронизации хранилища и/или учетную запись хранения можно переместить в другую группу ресурсов или подписку в рамках существующего клиента Azure AD. Если учетная запись хранения перемещена, необходимо предоставить службе Hybrid File Sync доступ к учетной записи хранилища (см. в разделе [Убедитесь, что служба "Синхронизация файлов Azure" имеет доступ к учетной записи хранения](https://docs.microsoft.com/azure/storage/files/storage-sync-files-troubleshoot?tabs=portal1%2Cportal#troubleshoot-rbac)).

    > [!Note]  
    > Служба "Синхронизация файлов Azure" не поддерживает перемещение подписки в другой клиент Azure AD.
    
* <a id="afs-ntfs-acls"></a>
  **Сохраняет ли служба синхронизации файлов Azure наряду с данными, хранящимися в службе файлов Azure, списки управления доступом NTFS для каталогов или файлов?**

    По состоянию на Февраль 24 2020, новые и существующие списки ACL, сгруппированные с помощью службы синхронизации файлов Azure, сохраняются в формате NTFS, а изменения ACL, вносимые непосредственно в общую папку Azure, будут синхронизироваться со всеми серверами в группе синхронизации. Все изменения в ТУД, внесенные в службы файлов Azure, будут синхронизироваться через службу синхронизации файлов Azure. При копировании данных в службу файлов Azure убедитесь, что вы используете SMB для доступа к общей папке и сохранения списков ACL. Существующие средства на основе RESTFUL, такие как AzCopy или Обозреватель службы хранилища, не сохраняют списки управления доступом.

    Если вы включили Azure Backup в управляемых файловых ресурсах синхронизации файлов, списки управления доступом к файлам можно будет по-прежнему восстанавливать в рамках рабочего процесса восстановления резервной копии. Это работает либо для всей общей папки, либо для отдельных файлов и каталогов.

    Если вы используете моментальные снимки как часть решения для самостоятельного управления резервным копированием для файловых ресурсов, управляемых с помощью синхронизации файлов, списки ACL могут быть неправильно восстановлены в ACL NTFS, если моментальные снимки были сделаны до февраля 24, 2020. В этом случае рассмотрите возможность обращения в службу поддержки Azure.
    
## <a name="security-authentication-and-access-control"></a>Безопасность, проверка подлинности и управление доступом
* <a id="ad-support"></a>
**Поддерживает ли служба "файлы Azure" проверку подлинности и управление доступом на основе удостоверений?**  
    
    Да, служба файлов Azure поддерживает проверку подлинности и контроль доступа на основе удостоверений. Вы можете выбрать один из двух способов использования управления доступом на основе удостоверений: локальные службы домен Active Directory (Предварительная версия) или доменные службы Azure Active Directory (AD DS Azure). Локальные службы домен Active Directory (AD DS) поддерживают проверку подлинности с помощью AD DS присоединенных к домену компьютеров (локально или в Azure) для доступа к файловым ресурсам Azure через SMB. Azure AD DS проверку подлинности по SMB для файлов Azure AD DS позволяет виртуальным машинам Windows, присоединенным к домену, присоединяться к ресурсам, каталогам и файлам с помощью учетных данных Azure AD Дополнительные сведения см. в статье [Поддержка проверки подлинности на основе удостоверений в службе файлов Azure для доступа по протоколу SMB](storage-files-active-directory-overview.md). 

    В службе файлов Azure предусмотрено два дополнительных способа управления доступом:

    - Вы можете использовать подписанные URL-адреса (SAS), чтобы создать маркеры со специальными разрешениями, которые будут допустимы для использования в течение определенного интервала времени. Например, вы можете создать маркер с доступом только для чтения для одного конкретного файла со сроком действия 10 минут. Любой пользователь, обладающий этим маркером, пока он действует, получит доступ только для чтения к этому файлу на 10 минут. Ключи подписания общего доступа поддерживаются только с помощью REST API или в клиентских библиотеках. Вам необходимо подключить файловый ресурс Azure через протокол SMB с помощью ключей учетной записи хранения.

    - Служба синхронизации файлов Azure сохранит все дискреционные списки ACL или DACL и выполнит их репликацию (на основе Active Directory или локально) для всех конечных точек сервера, с которыми она синхронизируется. Так как Windows Server уже может пройти аутентификацию с помощью Active Directory, служба синхронизации файлов Azure может предоставить эффективную временную меру до реализации полной поддержки аутентификации на основе Active Directory и ACL.
    
    Для получения исчерпывающего представления всех протоколов, поддерживаемых в службах хранилища Azure, можно обратиться к разделу [авторизация доступа к службе хранилища Azure](https://docs.microsoft.com/azure/storage/common/storage-auth?toc=%2fazure%2fstorage%2fblobs%2ftoc.json) . 

* <a id="ad-support-devices"></a>
**Поддерживает ли служба "файлы Azure" Azure Active Directory проверки подлинности службы доменов (Azure AD DS) доступ к SMB с использованием учетных данных Azure AD с устройств, присоединенных к Azure AD или зарегистрированных в ней?**

    Нет, этот сценарий не поддерживается.

* <a id="ad-support-rest-apis"></a>
**Существуют ли API REST, которые поддерживают получение, настройку или копирование списков управления доступом NTFS для каталогов или файлов?**

    Да, мы поддерживаем интерфейсы API RESTFUL, которые получают, устанавливают или копируют списки ACL NTFS для каталогов или файлов при использовании [2019-07-07](https://docs.microsoft.com/rest/api/storageservices/versioning-for-the-azure-storage-services#version-2019-07-07) (или более поздней версии) REST API.

* <a id="ad-vm-subscription"></a>
**Можно ли получить доступ к общим файловым ресурсам Azure с помощью учетных данных Azure AD из виртуальной машины в другой подписке?**

    Если подписка, в которой развернут файловый ресурс, связана с тем же клиентом Azure AD, что и развертывание AD DS Azure, к которому присоединена виртуальная машина, вы можете получить доступ к общим файловым ресурсам Azure, используя те же учетные данные Azure AD. Это ограничение накладывается не на подписку, а на связанный клиент Azure AD.
    
* <a id="ad-support-subscription"></a>
**Можно ли включить AD DS Azure или локальную проверку подлинности AD DS для файловых ресурсов Azure с помощью клиента Azure AD, отличного от основного клиента файлового ресурса Azure?**

    Нет, служба "файлы Azure" поддерживает только AD DS Azure или локальную AD DS интеграцию с клиентом Azure AD, который находится в той же подписке, что и файловый ресурс. С клиентом Azure AD может быть связана только одна подписка. Это ограничение относится как к AD DS Azure, так и к локальным AD DS методам проверки подлинности. При использовании локальной AD DS для проверки подлинности [учетные данные AD DS должны быть синхронизированы с Azure AD](../../active-directory/hybrid/how-to-connect-install-roadmap.md) , с которой связана учетная запись хранения.

* <a id="ad-linux-vms"></a>
**Поддерживает ли Azure AD DS или локальную проверку подлинности AD DS для файловых ресурсов Azure, поддерживают ли виртуальные машины Linux?**

    Нет, проверка подлинности с виртуальных машин Linux не поддерживается.

* <a id="ad-aad-smb-afs"></a>
**Поддерживает ли файловые ресурсы, управляемые Синхронизация файлов Azure, поддержку проверки подлинности Azure AD DS или локальной AD DS (Предварительная версия)?**

    Да, вы можете включить AD DS Azure или локальную проверку подлинности AD DS для файлового ресурса, управляемого Синхронизация файлов Azure. Изменения в ACL каталога или файла для локальных файловых серверов будут распределены по уровням в службе файлов Azure и наоборот.

* <a id="ad-aad-smb-files"></a>
**Как проверить, включена ли проверка подлинности AD DS в учетной записи хранения, и получить сведения о домене?**

    Инструкции см. [здесь](https://docs.microsoft.com/azure/storage/files/storage-files-identity-auth-active-directory-enable#1-enable-ad-authentication-for-your-account).
    
* <a id="encryption-at-rest"></a>
**Как обеспечить шифрование неактивных данных файлового ресурса Azure?**  

    Да. Дополнительные сведения см. в статье [Шифрование службы хранилища Azure](../common/storage-service-encryption.md?toc=%2fazure%2fstorage%2ffiles%2ftoc.json).

* <a id="access-via-browser"></a>
**Как предоставить доступ к определенному файлу через браузер?**  

    Вы можете использовать подписанные URL-адреса, чтобы создать маркеры со специальными разрешениями, которые будут допустимы для использования в течение определенного интервала времени. Например, вы можете создать маркер с доступом только для чтения к конкретному файлу и задать определенный интервал его действия. Пока маркер действителен, любой пользователь, у которого есть этот URL-адрес, сможет обращаться к файлу непосредственно из любого браузера. Вы можете легко создать ключ подписанного URL-адреса из пользовательского интерфейса, например обозревателя службы хранилища Azure.

* <a id="file-level-permissions"></a>
**Можно ли указать разрешения только на чтение или только на запись для папок в общей папке?**  

    При подключении общей папки по протоколу SMB такой уровень контроля над разрешениями недоступен. Тем не менее при создании подписанного URL-адреса с помощью API-интерфейса REST или клиентских библиотек для папок в общем ресурсе можно указать разрешения только для чтения или записи.

* <a id="ip-restrictions"></a>
**Можно ли внедрить ограничения IP-адресов для файлового ресурса Azure?**  

    Да. Доступ к общему файловому ресурсу Azure можно ограничить на уровне учетной записи хранения. Дополнительные сведения см. в статье [Настройка брандмауэров службы хранилища Azure и виртуальных сетей](../common/storage-network-security.md?toc=%2fazure%2fstorage%2ffiles%2ftoc.json).

* <a id="data-compliance-policies"></a>
**Какие политики соответствия данных поддерживаются службой файлов Azure?**  

   В основе работы службы файлов Azure лежит та же архитектура хранилища, которая используется и для других служб хранилища в службе хранилища Azure. К этой службе применяются те же политики соответствия данных. Дополнительные сведения о соответствии данных в службе хранилища Azure см. в разделах [Предложения для соответствия требованиям в службе хранилища Azure](https://docs.microsoft.com/azure/storage/common/storage-compliance-offerings) и [Центр управления безопасностью Майкрософт](https://microsoft.com/trustcenter/default.aspx).
   
### <a name="ad-authentication"></a>Проверка подлинности AD
* <a id=""></a>
**Поддерживает ли Azure AD проверку подлинности Azure Active Directory виртуальные машины Linux?**

    Нет, проверка подлинности с виртуальных машин Linux не поддерживается.

* <a id="ad-multiple-forest"></a>
**Поддерживает ли локальную проверку подлинности AD DS для файловых ресурсов Azure интеграцию с AD DSной средой, использующей несколько лесов?**    

    Локальная проверка подлинности AD DS файлов Azure интегрируется только с лесом доменной службы, в которую зарегистрирована учетная запись хранения. Для поддержки проверки подлинности из другого леса в среде должно быть настроено доверие леса правильно. Способ регистрации файлов Azure в AD DS почти так же, как обычный файловый сервер, где в AD DS для проверки подлинности создается удостоверение (учетная запись компьютера или службы). Единственное отличие заключается в том, что зарегистрированное имя участника-службы учетной записи хранения заканчивается на "file.core.windows.net", который не соответствует суффиксу домена. Обратитесь к администратору домена, чтобы узнать, требуется ли обновление политики маршрутизации DNS для включения проверки подлинности нескольких лесов из-за другого суффикса домена.

* <a id=""></a>
**Какие регионы доступны для службы файлов Azure AD DS проверки подлинности (Предварительная версия)?**

    Дополнительные сведения см. в [AD DS о доступности в регионе](storage-files-identity-auth-active-directory-enable.md#regional-availability) .
    
* <a id="ad-aad-smb-afs"></a>
**Можно ли использовать службу "файлы Azure" Active Directory (Предварительная версия) для файловых ресурсов, управляемых Синхронизация файлов Azure?**

    Да, вы можете включить проверку подлинности Active Directory для файлового ресурса, управляемого службой синхронизации файлов Azure. Изменения в ACL каталога или файла для локальных файловых серверов будут распределены по уровням в службе файлов Azure и наоборот.

* <a id="ad-aad-smb-files"></a>
**Как проверить, включена ли проверка подлинности AD для учетной записи хранения и сведений о домене AD?**

    Чтобы проверить, включена ли проверка подлинности AD для файлов Azure в учетной записи хранения, и получить сведения о домене Active Directory, см. инструкции в этой [статье](https://docs.microsoft.com/azure/storage/files/storage-files-identity-auth-active-directory-enable#enable-ad-authentication-for-your-account) .

* <a id="ad-aad-smb-files"></a>
**Есть ли какие-либо различия в создании учетной записи компьютера или учетной записи входа службы для представления моей учетной записи хранения в AD?**

    Создание [учетной записи компьютера](https://docs.microsoft.com/windows/security/identity-protection/access-control/active-directory-accounts#manage-default-local-accounts-in-active-directory) (по умолчанию) или [учетной записи для входа в службу](https://docs.microsoft.com/windows/win32/ad/about-service-logon-accounts) не влияет на то, как проверка подлинности будет работать с файлами Azure. Вы можете выбрать способ представления учетной записи хранения в качестве удостоверения в среде AD. Домаинаккаунттипе по умолчанию в командлете Join-Азсторажеаккаунтфораус является учетной записью компьютера. Тем не менее срок действия пароля, настроенный в среде AD, может отличаться для учетной записи компьютера или службы, и необходимо учитывать необходимость [обновления пароля удостоверения учетной записи хранения в AD](https://docs.microsoft.com/azure/storage/files/storage-files-identity-auth-active-directory-enable#5-update-ad-account-password).

## <a name="on-premises-access"></a>Локальный доступ

* <a id="port-445-blocked"></a>
**Мой поставщик услуг Интернета или блокирует порт 445, что отдает сбой при подключении файлов Azure. Что мне делать?**

    Вы можете узнать о [различных способах решения заблокированного порта 445 здесь](https://docs.microsoft.com/azure/storage/files/storage-troubleshoot-windows-file-connection-problems#cause-1-port-445-is-blocked). Служба файлов Azure разрешает подключения только с помощью SMB 3,0 (с поддержкой шифрования) извне региона или центра обработки данных. Протокол SMB 3,0 предлагает множество функций безопасности, включая шифрование каналов, которое очень безопасно для использования через Интернет. Однако возможно, что порт 445 заблокирован из-за исторических причин уязвимостей в более ранних версиях SMB. В идеале порт должен быть заблокирован только для трафика SMB 1,0, а SMB 1,0 должен быть отключен на всех клиентах.

* <a id="expressroute-not-required"></a>
**Нужно ли использовать Azure ExpressRoute для подключения к службе файлов Azure или использования службы "Синхронизация файлов Azure" локально?**  

    Нет. ExpressRoute не требуется для доступа к общему файловому ресурсу Azure. Если файловый ресурс Azure подключается локально, нужен всего лишь открытый порт 445 (исходящий TCP-порт) для доступа к Интернету (это порт, к которому обращается SMB). При использовании службы синхронизации файлов Azure требуется всего лишь порт 443 (исходящий TCP-порт) для доступа к HTTPS (SMB не требуется). Тем не менее для ExpressRoute вы *можете* использовать любой из этих параметров доступа.

* <a id="mount-locally"></a>
**Как можно подключить файловый ресурс Azure на локальном компьютере?**  

    Если разрешен исходящий TCP-трафик через порт 445 и клиент (например, Windows 10 или Windows Server 2016) поддерживает протокол SMB 3.0, то подключение к общему файловому ресурсу осуществляется по протоколу SMB. Если порт 445 заблокирован политикой организации или поставщиком услуг Интернета, для доступа к общему файловому ресурсу Azure можно использовать службу синхронизации файлов Azure.

## <a name="backup"></a>Резервное копирование
* <a id="backup-share"></a>
**Как создать резервную копию файлового ресурса Azure?**  
    Вы можете использовать периодически [создаваемые моментальные снимки общих ресурсов](storage-snapshots-files.md) для защиты от случайного удаления. Вы можете воспользоваться AzCopy, RoboCopy или сторонним средством архивации, с помощью которого можно создать резервную копию подключенной общей папки. Служба Azure Backup позволяет создавать резервные копии файлов Azure. Ознакомьтесь с дополнительными сведениями о [резервном копировании файловых ресурсов Azure службой Azure Backup](https://docs.microsoft.com/azure/backup/backup-azure-files).

## <a name="share-snapshots"></a>Моментальные снимки общих ресурсов

### <a name="share-snapshots-general"></a>Общие сведения о моментальных снимках общих ресурсов
* <a id="what-are-snaphots"></a>
**Что представляют собой моментальные снимки файловых ресурсов?**  
    Моментальные снимки общих файловых ресурсов Azure позволяют создавать версии общих файловых ресурсов только для чтения. Вы также можете использовать службу файлов Azure, чтобы копировать более старую версию содержимого в тот же общий ресурс, альтернативное расположение в Azure или в локальную среду для дальнейших изменений. Дополнительные сведения о моментальных снимках общего ресурса см. в статье [Обзор моментальных снимков для службы файлов Azure (предварительная версия)](storage-snapshots-files.md).

* <a id="where-are-snapshots-stored"></a>
**Где хранятся мои моментальные снимки общих ресурсов?**  
    Моментальные снимки общего ресурса и сам общий файловый ресурс хранятся в одной и той же учетной записи хранения.

* <a id="snapshot-consistency"></a>
**Согласованы ли моментальные снимки общих ресурсов в разных приложениях?**  
    Нет, моментальные снимки общих ресурсов не согласованы между приложениями. Перед созданием моментального снимка общего ресурса пользователю понадобится очистить операции записи из приложения и перенести их в общий ресурс.

* <a id="snapshot-limits"></a>
**Есть ли ограничения на число моментальных снимков общего ресурса?**  
    Да. Служба файлов Azure позволяет сохранять максимум 200 моментальных снимков общих ресурсов. Моментальные снимки общих ресурсов не учитываются в квоте общих ресурсов, так что общее пространство, занимаемое всеми моментальными снимками общих ресурсов, неограниченно. Ограничения учетной записи хранения по-прежнему применяются. После достижения ограничения в 200 моментальных снимков общих ресурсов вам необходимо удалить старые моментальные снимки, чтобы создать новые.

* <a id="snapshot-cost"></a>
**Сколько нужно платить за моментальные снимки общего ресурса?**  
    Для моментальных снимков действуют стандартные тарифы на транзакции и хранилище. По своей природе моментальные снимки являются добавочными. Базовый моментальный снимок — это сам общий ресурс. Последующие моментальные снимки — добавочные. В них хранятся только отличия от предыдущего моментального снимка. Это означает, что разница в счетах будет минимальной при минимальной обработке рабочей нагрузки. Сведения о тарифах на использование функции "Файлы Azure" уровня "Стандартный" см. на [странице с ценами](https://azure.microsoft.com/pricing/details/storage/files/). Сейчас можно узнать объем пространства, используемый моментальным снимком общего ресурса, сравнив оплачиваемую емкость с используемой. Мы работаем над инструментарием для усовершенствования функции отчетов.

* <a id="ntfs-acls-snaphsots"></a>
**Сохраняются ли списки управления доступом NTFS для каталогов и файлов в моментальных снимках общих ресурсов?**  
    Списки управления доступом NTFS для каталогов и файлов сохраняются в моментальных снимках общих ресурсов.

### <a name="create-share-snapshots"></a>Создание моментальных снимков общих ресурсов
* <a id="file-snaphsots"></a>
**Можно ли создать моментальный снимок общего ресурса для отдельных файлов?**  
    Моментальные снимки общих ресурсов создаются на уровне общего файлового ресурса. Вы можете восстановить отдельные файлы из моментальных снимков общего файлового ресурса, но нельзя создать моментальные снимки общего ресурса на уровне файлов. Тем не менее, если вы создали моментальный снимок общих ресурсов на уровне общего ресурса и требуется перечислить моментальные снимки общих ресурсов, в которых изменился конкретный файл, это можно сделать с помощью компонента **Предыдущие версии** на подключенном общем ресурсе Windows. 
    
    Если вам нужна функция моментального снимка файла, сообщите нам об этом на форуме [UserVoice службы файлов Azure](https://feedback.azure.com/forums/217298-storage/category/180670-files).

* <a id="encrypted-snapshots"></a>
**Можно ли создать моментальные снимки зашифрованного файлового ресурса?**  
    Вы можете сделать моментальный снимок общего ресурса общих файловых ресурсов Azure с включенным шифрованием неактивных данных. Вы можете восстановить файлы из моментального снимка общего ресурса в зашифрованном общем файловом ресурсе. Если общий ресурс зашифрован, его моментальный снимок также будет зашифрован.

* <a id="geo-redundant-snaphsots"></a>
**Являются ли мои моментальные снимки общего ресурса геоизбыточными?**  
    Моментальные снимки общего ресурса имеют ту же избыточность, что и соответствующий общий файловый ресурс Azure. При выборе геоизбыточного хранилища для своей учетной записи данные моментального снимка общего ресурса также будут храниться отдельно в парном регионе.

### <a name="manage-share-snapshots"></a>Управление моментальными снимками общих ресурсов
* <a id="browse-snapshots-linux"></a>
**Можно просмотреть мои моментальные снимки общих ресурсов на компьютере Linux?**  
    Azure CLI позволяет создавать, перечислять, просматривать и восстанавливать моментальные снимки общих ресурсов в Linux.

* <a id="copy-snapshots-to-other-storage-account"></a>
**Можно ли скопировать моментальные снимки общедоступного ресурса в другую учетную запись хранения?**  
    Вы можете скопировать файлы из моментальных снимков общего ресурса в другое расположение, но не сами моментальные снимки общего ресурса.

### <a name="restore-data-from-share-snapshots"></a>Восстановление данных из моментальных снимков общих ресурсов
* <a id="promote-share-snapshot"></a>
**Можно ли повысить уровень моментального снимка общедоступного ресурса до базового общедоступного ресурса?**  
    Вы можете скопировать данные из моментального снимка общего ресурса в любое другое место назначения. Вы не можете повысить уровень моментального снимка общего ресурса до базового общего ресурса.

* <a id="restore-snapshotted-file-to-other-share"></a>
**Можно ли восстановить данные из моментального снимка общего ресурса в другую учетную запись хранения?**  
    Да. Вы можете скопировать файлы из моментального снимка общего ресурса в исходное или альтернативное расположение, включающее ту же или другую учетную запись хранения в том же или другом регионе. Можно также скопировать файлы в локальное расположение или любую другую облачную среду.    
  
### <a name="clean-up-share-snapshots"></a>Удаление моментальных снимков общих ресурсов
* <a id="delete-share-keep-snapshots"></a>
**Можно ли удалить общий ресурс, не удаляя его моментальные снимки?**  
    Вам не удастся удалить общий ресурс, если в нем имеются активные моментальные снимки общего ресурса. Вы можете использовать API для удаления моментальных снимков общего ресурса вместе с ресурсом. Вы также можете удалить моментальные снимки общего ресурса и сам ресурс на портале Azure.

* <a id="delete-share-with-snapshots"></a>
**Что случится с моими моментальными снимками общедоступного ресурса при удалении учетной записи хранения?**  
    При удалении учетной записи хранения также удаляются и моментальные снимки общего ресурса.

## <a name="billing-and-pricing"></a>Выставление счетов и цены
* <a id="vm-file-share-network-traffic"></a>
**Включается ли сетевой трафик между виртуальной машиной и файловыми ресурсами Azure в тарифицируемый трафик подписки?**  
    Если общий файловый ресурс и виртуальная машина находятся в одном регионе Azure, дополнительная оплата за трафик между этим ресурсом и виртуальной машиной отсутствует. Если общий файловый ресурс и виртуальная машина находятся в разных регионах, трафик между ними будет тарифицирован как внешний трафик.

* <a id="share-snapshot-price"></a>
**Сколько нужно платить за моментальные снимки общего ресурса?**  
     При использовании предварительной версии плата за моментальные снимки общего ресурса не взимается. Однако применяется стандартная плата за транзакции и исходящий трафик. После выпуска общедоступной версии для подписок будет взиматься плата за ресурсы и транзакции моментальных снимков общих ресурсов.
     
     По своей природе моментальные снимки общих ресурсов являются добавочными. Базовый моментальный снимок общего ресурса — это сам общий ресурс. Последующие моментальные снимки общего ресурса — добавочные. Они хранят только отличия от предыдущего моментального снимка общего ресурса. Тарифицируется только измененное содержимое. Если общий ресурс содержит 100 ГиБ данных, из которых с момента создания последнего моментального снимка общего ресурса изменилось всего лишь 5 ГиБ, моментальный снимок общего ресурса использует только 5 ГиБ дополнительно, и счет будет выставлен только за 105 ГиБ. Дополнительные сведения о стандартных расходах на транзакции и исходящие данные см. на [странице цен](https://azure.microsoft.com/pricing/details/storage/files/).

## <a name="scale-and-performance"></a>Масштаб и производительность
* <a id="files-scale-limits"></a>
**Каковы ограничения на масштабирование службы файлов Azure?**  
    Дополнительные сведения о целевых показателях масштабируемости и производительности службы файлов Azure см. в статье [Целевые показатели масштабируемости и производительности службы файлов Azure](storage-files-scale-targets.md).

* <a id="need-larger-share"></a>
**Какие размеры доступны для файловых ресурсов Azure?**  
    Размеры файловых ресурсов Azure (Premium и Standard) можно масштабировать до 100 тиб. Инструкции по адаптации к большим файловым ресурсам для уровня "Стандартный" см. в разделе подключение [к более крупным файловым ресурсам (уровень Standard)](storage-files-planning.md#enable-standard-file-shares-to-span-up-to-100-tib) раздела руководств по планированию.

* <a id="lfs-performance-impact"></a>
**Влияет ли расширение квоты на общую папку на мои рабочие нагрузки или Синхронизация файлов Azure?**
    
    Нет. Расширение квоты не влияет на рабочие нагрузки и Синхронизация файлов Azure.

* <a id="open-handles-quota"></a>
**Сколько клиентов могут одновременно получить доступ к одному файлу?**   
    Установлена квота в 2000 открытых дескрипторов на один файл. По достижении этого ограничения вы увидите соответствующую ошибку.

* <a id="zip-slow-performance"></a>
**При распаковке файлов в службе файлов Azure производительность снижается. Что мне делать?**  
    Для передачи большого числа файлов в службу файлов Azure мы рекомендуем использовать AzCopy (для Windows, предварительную версию для Linux и UNIX) или Azure PowerShell, так как эти средства оптимизированы для сетевой передачи файлов.

* <a id="slow-perf-windows-81-2012r2"></a>
**Почему после подключения файлового ресурса Azure в Windows Server 2012 R2 или Windows 8.1 снижается производительность?**  
    Имеется известная проблема при подключении файлового ресурса Azure в Windows Server 2012 R2 и Windows 8.1 с накопительным обновлением за апрель 2014 г. для Windows 8.1 и Windows Server 2012 R2. Для достижения оптимальной производительности убедитесь, что на всех экземплярах Windows Server 2012 R2 и Windows 8.1 есть это исправление. (Вы всегда получаете исправления Windows с помощью Центр обновления Windows.) Дополнительные сведения см. в связанной статье базы знаний Майкрософт [снижение производительности при доступе к файлам Azure с Windows 8.1 или сервера 2012 R2](https://support.microsoft.com/kb/3114025).

## <a name="features-and-interoperability-with-other-services"></a>Функции и совместимость с другими службами
* <a id="cluster-witness"></a>
**Можно ли использовать файловый ресурс Azure в качестве *файлового ресурса-свидетеля* для отказоустойчивого кластера Windows Server?**  
    Сейчас такая конфигурация не поддерживается для общего файлового ресурса Azure. Дополнительные сведения о способах настройки этой возможности для хранилища BLOB-объектов Azure см. в статье [Deploy a Cloud Witness for a Failover Cluster](https://docs.microsoft.com/windows-server/failover-clustering/deploy-cloud-witness) (Развертывание облака-свидетеля для отказоустойчивого кластера).

* <a id="containers"></a>
**Можно ли подключить файловый ресурс Azure на экземпляре контейнера Azure?**  
    Да, файловые ресурсы Azure оптимальны для сохранения сведений после истечения времени существования экземпляра контейнера. Дополнительные сведения см. в статье [Подключение файлового ресурса Azure с помощью Экземпляров контейнеров Azure](../../container-instances/container-instances-mounting-azure-files-volume.md).

* <a id="rest-rename"></a>
**Есть ли в REST API операция переименования?**  
    На данный момент нет.

* <a id="nested-shares"></a>
**Можно ли настроить вложенные общие папки? Иными словами, Общая папка в общей папке?**  
    Нет. Общий файловый ресурс *—* это виртуальный драйвер, который можно подключить, поэтому вложенные общие папки не поддерживаются.

* <a id="ibm-mq"></a>
**Как использовать службу файлов Azure с IBM MQ?**  
    Компания IBM выпустила руководство по настройке службы файлов Azure в службе, которую используют пользователи IBM MQ. Дополнительные сведения см. в статье [How to setup IBM MQ Multi instance queue manager with Microsoft Azure File Service](https://github.com/ibm-messaging/mq-azure/wiki/How-to-setup-IBM-MQ-Multi-instance-queue-manager-with-Microsoft-Azure-File-Service) (Настройка службы файлов Microsoft Azure в многоэкземплярном диспетчере очередей IBM MQ).

## <a name="see-also"></a>См. также
* [Устранение неполадок службы файлов Azure в Windows](storage-troubleshoot-windows-file-connection-problems.md)
* [Устранение неполадок службы файлов Azure в Linux](storage-troubleshoot-linux-file-connection-problems.md)
* [Устранение неполадок службы "Синхронизация файлов Azure"](storage-sync-files-troubleshoot.md)
