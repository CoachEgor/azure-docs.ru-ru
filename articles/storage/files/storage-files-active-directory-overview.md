---
title: 'Обзор: авторизация на основе удостоверений в службе файлов Azure'
description: Служба файлов Azure поддерживает проверку подлинности на основе удостоверений через SMB (блок сообщений сервера) через Azure Active Directory доменные службы (AD DS) и Active Directory. В результате присоединенные к домену виртуальные машины Windows будут иметь доступ к файловым ресурсам Azure с помощью учетных данных Azure AD.
author: roygara
ms.service: storage
ms.subservice: files
ms.topic: conceptual
ms.date: 04/15/2020
ms.author: rogarana
ms.openlocfilehash: 7d9f8ccb4273d1378c4826dea420c4edca2f8ac3
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "81536592"
---
# <a name="overview-of-azure-files-identity-based-authentication-support-for-smb-access"></a>Обзор поддержки проверки подлинности на основе удостоверений в службе файлов Azure для доступа по протоколу SMB
[!INCLUDE [storage-files-aad-auth-include](../../../includes/storage-files-aad-auth-include.md)]

Сведения о том, как включить проверку подлинности локальных служб домен Active Directory Services для файловых ресурсов Azure (Предварительная версия), см. в статье [Включение проверки подлинности локальных домен Active Directory служб по протоколу SMB для файловых ресурсов Azure](storage-files-identity-auth-active-directory-enable.md).

Сведения о том, как включить аутентификацию Azure AD DS для файловых ресурсов Azure, см. в статье [Включение проверки подлинности доменных служб Azure Active Directory в службе файлов Azure](storage-files-identity-auth-active-directory-domain-service-enable.md).

## <a name="glossary"></a>Глоссарий 
Полезно понимать некоторые ключевые термины, связанные с проверкой подлинности службы домена Azure AD по протоколу SMB для файловых ресурсов Azure:

-   **Проверка подлинности Kerberos**

    Kerberos — это протокол проверки подлинности, который используется для проверки удостоверения пользователя или узла. Дополнительные сведения о протоколе Kerberos см. в разделе [Обзор проверки подлинности Kerberos](https://docs.microsoft.com/windows-server/security/kerberos/kerberos-authentication-overview).

-  **Протокол SMB (Server Message Block)**

    SMB — это стандартный протокол обмена файлами по сети. SMB также называется Common Internet File System, или CIFS. Дополнительные сведения о SMB см. в разделе [Протокол SMB Майкрософт и обзор протокола CIFS](https://docs.microsoft.com/windows/desktop/FileIO/microsoft-smb-protocol-and-cifs-protocol-overview).

-   **Azure Active Directory (Azure AD)**

    Azure Active Directory (Azure AD) — это облачный каталог и служба управления удостоверениями Майкрософт, основанная на нескольких клиентах. Azure AD объединяет в себе базовые службы каталогов, функции управления доступом к приложениям и защиту удостоверений. Виртуальные машины Windows, присоединенные к Azure AD, могут получить доступ к файловым ресурсам Azure с помощью учетных данных Azure AD. Дополнительные сведения см. в разделе [что такое Azure Active Directory?](../../active-directory/fundamentals/active-directory-whatis.md)

-   **доменные службы Azure Active Directory (Azure AD DS);**

    Azure AD DS предоставляет управляемые доменные службы, такие как присоединение к домену, групповые политики, LDAP и проверка подлинности Kerberos/NTLM. Эти службы полностью совместимы со службами домен Active Directory. Дополнительные сведения см. в разделе [Azure Active Directory доменных служб](../../active-directory-domain-services/overview.md).

- **Локальные службы домен Active Directory (AD DS)**

    Интеграция локальных домен Active Directory служб (AD DS) с файлами Azure (Предварительная версия) предоставляет методы для хранения данных каталога, делая их доступными для пользователей и администраторов сети. Безопасность интегрирована с AD DS путем проверки подлинности входа и управления доступом к объектам в каталоге. С одним сетевым входом администраторы могут управлять данными каталога и Организацией по всей сети, а полномочные пользователи сети могут получать доступ к ресурсам в любой точке сети. AD DS обычно применяются предприятиями в локальных средах, а AD DS учетные данные используются в качестве удостоверения для контроля доступа. Дополнительные сведения см. в разделе [Обзор служб домен Active Directory](https://docs.microsoft.com/windows-server/identity/ad-ds/get-started/virtual-dc/active-directory-domain-services-overview).

-   **Управление доступом на основе ролей (RBAC) в Azure**

    Контроль доступа на основе ролей (RBAC) Azure обеспечивает точное управление доступом для Azure. С помощью RBAC можно управлять доступом к ресурсам, предоставляя пользователям минимальные разрешения, необходимые для выполнения поставленных задач. Дополнительные сведения о RBAC см. [в статье что такое управление доступом на основе ролей (RBAC) в Azure?](../../role-based-access-control/overview.md).

## <a name="common-use-cases"></a>Распространенные варианты использования

Проверка подлинности на основе удостоверений и поддержка списков управления доступом Windows в службе файлов Azure лучше использовать в следующих случаях:

### <a name="replace-on-premises-file-servers"></a>Замена локальных файловых серверов

Нерекомендуемая и замена разбросанных локальных файловых серверов — это распространенная проблема, с которой каждое предприятие сталкивается в своем модернизациие ИТ. Файловые ресурсы Azure с локальной аутентификацией AD DS (Предварительная версия) лучше подходят для переноса данных в службу файлов Azure. Полная миграция позволит вам воспользоваться преимуществами высокой доступности и масштабируемости, а также свести к минимуму изменения на стороне клиента. Он обеспечивает простую миграцию для конечных пользователей, поэтому они могут продолжать обращаться к своим данным с теми же учетными данными, используя существующие компьютеры, присоединенные к домену.

### <a name="lift-and-shift-applications-to-azure"></a>Перенос приложений в Azure

При переносе приложений в облако необходимо использовать ту же модель проверки подлинности для данных. Так как мы расширяем возможности управления доступом на основе удостоверений в файловые ресурсы Azure, это исключает необходимость изменения приложения на современные методы проверки подлинности и ускорения внедрения в облако. Файловые ресурсы Azure предоставляют возможность интеграции с AD DS Azure или локальным AD DS (Предварительная версия) для проверки подлинности. Если ваш план должен быть 100% машинного облака и максимально упростить управление облачными инфраструктурами, AD DS Azure лучше подходит как полностью управляемая служба домена. Если вам необходима полная совместимость с возможностями AD DS, вам может потребоваться расширить среду AD DS в облако, используя контроллеры домена с самостоятельным размещением на виртуальных машинах. В любом случае мы предоставляем гибкость для выбора доменных служб, отвечающих потребностям вашего бизнеса.

### <a name="backup-and-disaster-recovery-dr"></a>Резервное копирование и аварийное восстановление (DR)

При хранении первичного хранилища файлов в локальной среде файловые ресурсы Azure могут служить идеальным хранилищем для резервного копирования или аварийного восстановления, чтобы повысить непрерывность бизнес-процессов. Файловые ресурсы Azure можно использовать для резервного копирования данных с существующих файловых серверов, сохраняя списки DACL Windows. В сценариях аварийного восстановления можно настроить параметр проверки подлинности для поддержки надлежащего применения контроля доступа при отработке отказа.

## <a name="supported-scenarios"></a>Поддерживаемые сценарии

В следующей таблице перечислены поддерживаемые сценарии проверки подлинности общих файловых ресурсов Azure для Azure AD DS и локальной AD DS (Предварительная версия). Мы рекомендуем выбрать службу домена, которую вы приняли в клиентской среде для интеграции с файлами Azure. Если у вас AD DS (Предварительная версия) уже настроена локально или в Azure, где устройства присоединены к домену AD, следует выбрать использование AD DS (Предварительная версия) для проверки подлинности файловых ресурсов Azure. Аналогично, если вы уже приняли Azure AD DS (общедоступная версия), вы должны использовать его для проверки подлинности файловых ресурсов Azure.


|Проверка подлинности AD DS Azure  | Локальная проверка подлинности AD DS (Предварительная версия)  |
|---------|---------|
|Компьютеры Windows, присоединенные к AD DS Azure, могут получать доступ к файловым ресурсам Azure с помощью учетных данных Azure AD через SMB.     |Локальные AD DS компьютеры Windows могут получать доступ к файловым ресурсам Azure с помощью локальных Active Directory учетных данных, синхронизированных с Azure AD через SMB.         |

### <a name="unsupported-scenarios"></a>Неподдерживаемые сценарии

- AD DS Azure и локальная проверка подлинности AD DS не поддерживают проверку подлинности для учетных записей компьютеров. Вместо этого можно использовать учетную запись входа в службу.
- Проверка подлинности Azure AD DS не поддерживает аутентификацию на устройствах, присоединенных к Azure AD.

## <a name="advantages-of-identity-based-authentication"></a>Преимущества проверки подлинности на основе удостоверений
Проверка подлинности на основе удостоверений для файлов Azure обеспечивает несколько преимуществ при использовании проверки подлинности с использованием общего ключа:

-   **Расширьте традиционные возможности доступа к общей папке на основе удостоверений в облако с помощью локальных AD DS и Azure AD DS**  
    Если вы планируете переносить приложение в облако и заменили традиционные файловые серверы с помощью файловых ресурсов Azure, вам может потребоваться проверка подлинности приложения с помощью локальных AD DS или учетных данных Azure AD DS для доступа к данным файлов. Служба файлов Azure поддерживает использование локальных AD DS или учетных данных AD DS Azure для доступа к файловым ресурсам Azure через SMB из локальных AD DS или виртуальных машин Azure AD DS, присоединенных к домену.

-   **Принудительное применение детального контроля доступа для файловых ресурсов Azure**  
    Можно предоставить разрешения на доступ к определенному удостоверению на уровне общего ресурса, каталога или файла. Предположим, у вас есть несколько команд, использующих один файловый ресурс Azure для совместной работы над проектом. Вы можете предоставить всем командам доступ к каталогам с общедоступными данными, а доступ к каталогам с конфиденциальными финансовыми данными предоставить только финансовой группе. 

-   **Резервное копирование списков управления доступом Windows (также известных как NTFS) вместе с данными**  
    Вы можете использовать файловые ресурсы Azure для резервного копирования существующих локальных файловых ресурсов. Служба файлов Azure сохраняет списки ACL вместе с данными при резервном копировании общей папки в файловые ресурсы Azure через SMB.

## <a name="how-it-works"></a>Принцип работы

Файловые ресурсы Azure поддерживают проверку подлинности Kerberos для интеграции с AD DS Azure или локальным AD DS (Предварительная версия). Перед включением проверки подлинности в файловых ресурсах Azure сначала необходимо настроить среду домена. Для проверки подлинности Azure AD DS необходимо включить доменные службы Azure AD и присоединить к домену виртуальные машины, из которых планируется получать доступ к данным файлов. Виртуальная машина, присоединенная к домену, должна находиться в той же виртуальной сети, что и AD DS Azure. Аналогичным образом для локальной аутентификации AD DS (Предварительная версия) необходимо настроить контроллер домена и домен, присоединяемые к компьютерам или виртуальным машинам.

Когда удостоверение, связанное с приложением, работающим на виртуальной машине, пытается получить доступ к данным в общих файловых ресурсах Azure, запрос отправляется в AD DS Azure для проверки подлинности удостоверения. Если проверка подлинности прошла успешно, Azure AD DS Возвращает токен Kerberos. Приложение отправляет запрос, включающий маркер Kerberos, а файловые ресурсы Azure используют этот маркер для авторизации запроса. Файловые ресурсы Azure получают только маркер и не сохраняют учетные данные AD DS Azure. Локальная проверка подлинности AD DS работает аналогичным образом, где AD DS предоставляет маркер Kerberos.

![Снимок экрана: схема проверки подлинности Azure AD по протоколу SMB](media/storage-files-active-directory-overview/azure-active-directory-over-smb-for-files-overview.png)

### <a name="enable-identity-based-authentication"></a>Включить проверку подлинности на основе удостоверений

Вы можете включить проверку подлинности на основе удостоверений с помощью AD DS Azure или локального AD DS (Предварительная версия) для файловых ресурсов Azure в новых и существующих учетных записях хранения. Для проверки подлинности доступа к файлам в учетной записи хранения можно использовать только одну службу домена, которая применяется ко всем файловым ресурсам в учетной записи. Подробное руководство по настройке файловых ресурсов для проверки подлинности с помощью Azure AD DS в нашей статье [Azure Active Directory включение проверки подлинности доменных служб в файлах Azure](storage-files-identity-auth-active-directory-domain-service-enable.md) и рекомендации для локальной AD DS (Предварительная версия) в нашей статье. [включите проверку подлинности локальных домен Active Directory служб по протоколу SMB для файловых ресурсов Azure](storage-files-identity-auth-active-directory-enable.md).

### <a name="configure-share-level-permissions-for-azure-files"></a>Настройка разрешений на уровне общего ресурса для файлов Azure

После включения проверки подлинности Azure AD DS или локальной AD DS (Предварительная версия) можно использовать встроенные роли RBAC или настроить пользовательские роли для удостоверений Azure AD и назначить права доступа для всех файловых ресурсов в учетных записях хранения. Назначенное разрешение позволяет предоставленному удостоверению получить доступ только к общей папке, но не к корневому каталогу. Вам по-прежнему необходимо отдельно настроить разрешения на уровне каталога или файла для файловых ресурсов Azure.

### <a name="configure-directory-or-file-level-permissions-for-azure-files"></a>Настройка разрешений на уровне каталога или файлов для файлов Azure

Файловые ресурсы Azure обеспечивают стандартные разрешения для файлов Windows на уровне каталога и файлов, включая корневой каталог. Настройка разрешений на уровне каталогов или файлов поддерживается как для SMB, так и для остальных. Подключите целевой файловый ресурс из виртуальной машины и настройте разрешения с помощью проводника Windows File Explorer, Windows [icacls](https://docs.microsoft.com/windows-server/administration/windows-commands/icacls)или команды [Set-ACL](https://docs.microsoft.com/powershell/module/microsoft.powershell.security/get-acl?view=powershell-6) .

### <a name="use-the-storage-account-key-for-superuser-permissions"></a>Использование ключа учетной записи хранения для разрешений суперпользователя

Пользователь с ключом учетной записи хранения может получить доступ к файловым ресурсам Azure с разрешениями суперпользователя. Разрешения суперпользователя обходят все ограничения управления доступом.

> [!IMPORTANT]
> Рекомендуемый подход к безопасности заключается в предотвращении совместного использования ключей учетной записи хранения и использовании проверки подлинности на основе удостоверений, когда это возможно.

### <a name="preserve-directory-and-file-acls-when-importing-data-to-azure-file-shares"></a>Сохранять списки ACL для каталогов и файлов при импорте данных в файловые ресурсы Azure

Служба "файлы Azure" поддерживает сохранение ACL на уровне каталогов или файлов при копировании данных в файловые ресурсы Azure. Списки ACL для каталога или файла можно скопировать в файловые ресурсы Azure с помощью Синхронизация файлов Azure или общих наборов средств перемещения файлов. Например, можно использовать [Robocopy](https://docs.microsoft.com/windows-server/administration/windows-commands/robocopy) с `/copy:s` флагом для копирования данных, а также списков ACL в файловый ресурс Azure. Списки ACL сохраняются по умолчанию, поэтому не требуется включать проверку подлинности на основе удостоверений в учетной записи хранения для сохранения списков управления доступом.

## <a name="pricing"></a>Цены
Для включения проверки подлинности на основе удостоверений через SMB в вашей учетной записи хранения дополнительная плата за обслуживание не взимается. Дополнительные сведения о ценах см. в статье цены на службу [файлов Azure](https://azure.microsoft.com/pricing/details/storage/files/) и [цены на доменные службы Azure AD](https://azure.microsoft.com/pricing/details/active-directory-ds/).

## <a name="next-steps"></a>Дальнейшие шаги
Дополнительные сведения о службе файлов Azure и аутентификации на основе удостоверений по протоколу SMB см. в следующих ресурсах:

- [Планирование развертывания службы файлов Azure](storage-files-planning.md)
- [Включение проверки подлинности локальных служб домен Active Directory Services по протоколу SMB для файловых ресурсов Azure](storage-files-identity-auth-active-directory-enable.md)
- [Включение проверки подлинности доменных служб Azure Active Directory в службе файлов Azure](storage-files-identity-auth-active-directory-domain-service-enable.md)
- [Вопросы и ответы](storage-files-faq.md)
