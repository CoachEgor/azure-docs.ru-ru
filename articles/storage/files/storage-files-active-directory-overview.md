---
title: 'Обзор: авторизация доменных служб Azure AD в службе файлов Azure'
description: Служба файлов Azure поддерживает проверку подлинности на основе удостоверений через SMB (блок сообщений сервера) через доменные службы Azure Active Directory (Azure AD). В результате присоединенные к домену виртуальные машины Windows будут иметь доступ к файловым ресурсам Azure с помощью учетных данных Azure AD.
author: roygara
ms.service: storage
ms.topic: article
ms.date: 08/07/2019
ms.author: rogarana
ms.openlocfilehash: 93db726a2cac14109e542972ce851943b290962f
ms.sourcegitcommit: f4f626d6e92174086c530ed9bf3ccbe058639081
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/25/2019
ms.locfileid: "75460286"
---
# <a name="overview-of-azure-files-azure-active-directory-domain-service-azure-ad-ds-authentication-support-for-smb-access"></a>Обзор поддержки проверки подлинности в службе "службы файлов Azure" Azure Active Directory (Azure AD DS) для доступа по протоколу SMB
[!INCLUDE [storage-files-aad-auth-include](../../../includes/storage-files-aad-auth-include.md)]

Сведения о том, как включить проверку подлинности Azure AD DS для файлов Azure, см. в статье [Включение проверки подлинности для службы файлов Azure в службе домена Azure Active Directory](storage-files-active-directory-enable.md).

## <a name="glossary"></a>Глоссарий 
Полезно понимать некоторые ключевые термины, связанные с проверкой подлинности службы домена Azure AD по протоколу SMB для файлов Azure:

-   **Azure Active Directory (Azure AD).**  
    Azure Active Directory (Azure AD) — это мультитенантный облачный каталог и служба управления удостоверениями корпорации Майкрософт. Azure AD объединяет в себе базовые службы каталогов, функции управления доступом к приложениям и защиту удостоверений. Дополнительные сведения см. в статье [Что такое Azure Active Directory](../../active-directory/fundamentals/active-directory-whatis.md).

-   **Доменные службы Azure AD**  
    Доменные службы Azure AD предоставляют управляемые доменные службы (отвечающие за присоединение к домену, применение групповой политики, использование протокола LDAP, выполнение проверки подлинности методом Kerberos или NTLM). Эти службы полностью совместимы с Windows Server Active Directory. Дополнительные сведения см. в статье [Доменные службы Azure Active Directory (AD)](../../active-directory-domain-services/overview.md).

-   **Управление доступом на основе ролей (RBAC) в Azure**  
    Контроль доступа на основе ролей (RBAC) Azure обеспечивает точное управление доступом для Azure. С помощью RBAC можно управлять доступом к ресурсам, предоставляя пользователям минимальные разрешения, необходимые для выполнения поставленных задач. Дополнительные сведения о RBAC см. в статье [Что такое управление доступом на основе ролей (RBAC) в Azure](../../role-based-access-control/overview.md).

-   **Проверка подлинности Kerberos**

    Kerberos — это протокол проверки подлинности, который используется для проверки удостоверения пользователя или узла. Дополнительные сведения о протоколе Kerberos см. в разделе [Обзор проверки подлинности Kerberos](https://docs.microsoft.com/windows-server/security/kerberos/kerberos-authentication-overview).

-  **Протокол SMB (Server Message Block)**  
    SMB — это стандартный протокол обмена файлами по сети. SMB также называется Common Internet File System, или CIFS. Дополнительные сведения о SMB см. в разделе [Протокол SMB Майкрософт и обзор протокола CIFS](https://docs.microsoft.com/windows/desktop/FileIO/microsoft-smb-protocol-and-cifs-protocol-overview).

## <a name="advantages-of-azure-ad-domain-service-authentication"></a>Преимущества проверки подлинности доменной службы Azure AD
Проверка подлинности службы домена Azure AD для файлов Azure обеспечивает несколько преимуществ при использовании проверки подлинности с использованием общего ключа:

-   **Расширение традиционных возможностей доступа к общей папке на основе удостоверений в облако с помощью Azure AD и доменной службы Azure AD**  
    Если вы планируете перенести приложение в облако, заменив традиционные файловые серверы файлами Azure, вам может потребоваться проверка подлинности приложения с помощью учетных данных Azure AD для доступа к данным файлов. Служба файлов Azure поддерживает использование учетных данных Azure AD для доступа к файлам Azure через SMB из Azure AD DS присоединенных к домену виртуальных машин Windows. Также можно синхронизировать все локальные объекты Active Directory с Azure AD, чтобы сохранять имена пользователей, пароли и другие назначения групп.

-   **Принудительное применение детального контроля доступа для файловых ресурсов Azure**  
    Можно предоставить разрешения на доступ к определенному удостоверению на уровне общего ресурса, каталога или файла. Предположим, у вас есть несколько команд, использующих один файловый ресурс Azure для совместной работы над проектом. Вы можете предоставить всем командам доступ к каталогам с общедоступными данными, а доступ к каталогам с конфиденциальными финансовыми данными предоставить только финансовой группе. 

-   **Резервное копирование списков управления доступом вместе с данными**  
    Файлы Azure можно использовать для резервного копирования существующих локальных файловых ресурсов. Файлы Azure сохраняют ваши списки управления доступом вместе с данными во время резервного копирования файлового ресурса в файлы Azure по протоколу SMB.

## <a name="how-it-works"></a>Принципы работы
Файлы Azure используют доменные службы Azure AD для поддержки проверки подлинности Kerberos с учетными данными Azure AD виртуальных машин, присоединенных к домену. Прежде чем использовать Azure AD с файлами Azure, необходимо включить доменные службы Azure AD и присоединить домен из виртуальных машин, с которых вы планируете получать доступ к данным файлов. Виртуальная машина, присоединенная к домену, должна находиться в той же виртуальной сети (VNET), что и доменные службы Azure AD. 

Когда удостоверение, связанное с приложением, работающим на виртуальной машине, пытается получить доступ к данным в файлах Azure, запрос отправляется в доменные службы Azure AD для проверки подлинности удостоверения. Если проверка подлинности выполнена, доменные службы Azure AD возвращают токен Kerberos. Приложение отправляет запрос, который включает в себя токен Kerberos, и файлы Azure используют этот токен для авторизации запроса. Служба файлов Azure получает только токен и не сохраняет учетные данные Azure AD.

![Снимок экрана: схема проверки подлинности Azure AD по протоколу SMB](media/storage-files-active-directory-overview/azure-active-directory-over-smb-for-files-overview.png)

### <a name="enable-azure-ad-domain-service-authentication-for-smb-access"></a>Включение проверки подлинности доменных служб Azure AD для доступа по протоколу SMB
Вы можете включить проверку подлинности службы домена Azure AD для файлов Azure в новых и существующих учетных записях хранения, созданных после 24 сентября 2018 г. 

Перед включением этой функции убедитесь, что доменные службы Azure AD развернуты для основного клиента Azure AD, с которым связана ваша учетная запись хранения. Если вы еще не настроили доменные службы Azure AD, следуйте пошаговым инструкциям, предоставленным в статье [Включение доменных служб Azure Active Directory на портале Azure](../../active-directory-domain-services/tutorial-create-instance.md).

Развертывание доменных служб AD Azure обычно занимает 10–15 минут. После развертывания доменных служб Azure AD вы можете включить проверку подлинности Azure AD по протоколу SMB для файлов Azure. Дополнительные сведения см. в статье [Включение проверки подлинности Azure Active Directory службы домена в SMB для файлов Azure](storage-files-active-directory-enable.md). 

### <a name="configure-share-level-permissions-for-azure-files"></a>Настройка разрешений на уровне общего ресурса для файлов Azure
После включения проверки подлинности доменной службы Azure AD можно настроить пользовательские роли RBAC для удостоверений Azure AD и назначить права доступа для всех файловых ресурсов в учетной записи хранения.

Когда приложение, запущенное на виртуальной машине, присоединенной к домену, пытается подключить файловый ресурс Azure или получить доступ к каталогу или файлу, проверяются учетные данные Azure AD приложения, чтобы предоставить соответствующие разрешения на уровне общего ресурса и разрешения NTFS. Сведения о настройке разрешений на уровне общего ресурса см. в разделе [Включение проверки подлинности службы домена Azure Active Directory по протоколу SMB](storage-files-active-directory-enable.md).

### <a name="configure-directory--or-file-level-permissions-for-azure-files"></a>Настройка разрешений на уровне каталога или файла для файлов Azure 
Файлы Azure применяют стандартные разрешения NTFS на уровне каталогов и файлов, включая корневой каталог. Настройка разрешений на уровне каталога или файла поддерживается только по протоколу SMB. Подключите целевой файловый ресурс из виртуальной машины и настройте разрешения с помощью проводника Windows, команды [icacls](https://docs.microsoft.com/windows-server/administration/windows-commands/icacls) или [Set-ACL](https://docs.microsoft.com/powershell/module/microsoft.powershell.security/get-acl) . 

### <a name="use-the-storage-account-key-for-superuser-permissions"></a>Использование ключа учетной записи хранения для разрешений суперпользователя 
Пользователь, имеющий ключ учетной записи хранения, может получить доступ к файлам Azure с разрешениями суперпользователя. Разрешения суперпользователя обходят все ограничения управления доступом, настроенные на уровне общей папки с помощью RBAC и предписанные Azure AD. Чтобы подключить файловый ресурс Azure, требуются разрешения суперпользователя. 

> [!IMPORTANT]
> Для обеспечения безопасности рекомендуется не предоставлять доступ к ключам учетной записи хранения и использовать разрешения Azure AD, когда это возможно.

### <a name="preserve-directory-and-file-acls-for-data-import-to-azure-file-shares"></a>Сохранение списков управления доступом к каталогам и файлам для импорта данных в файловые ресурсы Azure
Служба файлов Azure теперь поддерживает сохранение ACL каталога или файлов при копировании данных в файловые ресурсы Azure. Списки управления доступом можно скопировать в каталог или файл в службу файлов Azure. Например, можно использовать [robocopy](https://docs.microsoft.com/windows-server/administration/windows-commands/robocopy) с флагом `/copy:s` для копирования данных и списков управления доступом в файловый ресурс Azure. Сохранение ACL включено по умолчанию, и вам не нужно явно включать функцию проверки подлинности службы домена Azure AD в учетной записи хранения. 

## <a name="pricing"></a>Стоимость
Включить проверку подлинности Azure AD по протоколу SMB для учетной записи хранения можно бесплатно. Дополнительные сведения о ценах см. в разделах [Цены на файлы Azure](https://azure.microsoft.com/pricing/details/storage/files/) и [Цены на доменные службы Azure AD](https://azure.microsoft.com/pricing/details/active-directory-ds/).

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о файлах Azure и проверке подлинности Azure AD по протоколу SMB см. в следующих ресурсах:

- [Общие сведения о службе файлов Azure](storage-files-introduction.md)
- [Включение проверки подлинности Azure Active Directory в SMB для файлов Azure](storage-files-active-directory-enable.md)
- [Часто задаваемые вопросы](storage-files-faq.md)
