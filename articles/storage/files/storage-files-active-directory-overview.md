---
title: Обзор - Авторизация на основе идентификационных данных Azure Files
description: Azure Files поддерживает аутентификацию на основе идентификации по сравнению с SMB (Блок сообщений сервера) через службы домена Active Directory Domain Services (AD DS) и Active Directory. В результате присоединенные к домену виртуальные машины Windows будут иметь доступ к файловым ресурсам Azure с помощью учетных данных Azure AD.
author: roygara
ms.service: storage
ms.subservice: files
ms.topic: conceptual
ms.date: 04/15/2020
ms.author: rogarana
ms.openlocfilehash: 7d9f8ccb4273d1378c4826dea420c4edca2f8ac3
ms.sourcegitcommit: 31ef5e4d21aa889756fa72b857ca173db727f2c3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81536592"
---
# <a name="overview-of-azure-files-identity-based-authentication-support-for-smb-access"></a>Обзор поддержки аутентификации на основе файлов Azure на основе SMB для доступа к SMB
[!INCLUDE [storage-files-aad-auth-include](../../../includes/storage-files-aad-auth-include.md)]

Чтобы узнать, как включить в непредпомшную систему проверки [Enable on-premises Active Directory Domain Services authentication over SMB for Azure file shares](storage-files-identity-auth-active-directory-enable.md)подлинности активных доменных служб Active Directory Domain Services для акций файлов Azure (предварительный просмотр), см.

Чтобы узнать, как включить аутентацию Azure AD DS для файлов Azure, смотрите в файлах [Azure Active Directory Domain Services проверки подлинности файлов Azure.](storage-files-identity-auth-active-directory-domain-service-enable.md)

## <a name="glossary"></a>Глоссарий 
Полезно понять некоторые ключевые термины, связанные с аутентификацией службы домена Azure AD по сравнению с SMB для файлов azure:

-   **Проверка подлинности Kerberos**

    Kerberos — это протокол проверки подлинности, который используется для проверки удостоверения пользователя или узла. Дополнительные сведения о протоколе Kerberos см. в разделе [Обзор проверки подлинности Kerberos](https://docs.microsoft.com/windows-server/security/kerberos/kerberos-authentication-overview).

-  **Протокол SMB (Server Message Block)**

    SMB — это стандартный протокол обмена файлами по сети. SMB также называется Common Internet File System, или CIFS. Дополнительные сведения о SMB см. в разделе [Протокол SMB Майкрософт и обзор протокола CIFS](https://docs.microsoft.com/windows/desktop/FileIO/microsoft-smb-protocol-and-cifs-protocol-overview).

-   **Активный каталог Azure (Azure AD)**

    Active Directory Azure (Azure AD) — служба управления и идентификационными данными microsoft с несколькими тентиями на основе облачных и удостоверений данных. Azure AD объединяет в себе базовые службы каталогов, функции управления доступом к приложениям и защиту удостоверений. Виртуальные машины СУ СWindows, присоединенные к AD, могут получать доступ к файлам Azure с учетными данными Azure AD. Для получения дополнительной информации [смотрите, что такое активный каталог Azure?](../../active-directory/fundamentals/active-directory-whatis.md)

-   **доменные службы Azure Active Directory (Azure AD DS);**

    Azure AD DS предоставляет управляемые доменные службы, такие как соединение доменов, групповые политики, LDAP и проверка подлинности Kerberos/NTLM. Эти службы полностью совместимы с службами домена Active Directory. Для получения дополнительной [Azure Active Directory Domain Services](../../active-directory-domain-services/overview.md)информации см.

- **Службы домена на территории помещений Active Directory Domain Services (AD DS)**

    Интеграция on-premises Active Directory Domain Services (AD DS) с Azure Files (предварительный просмотр) предоставляет методы хранения данных каталогов, делая их доступными для сетевых пользователей и администраторов. Безопасность интегрируется с AD DS через проверку подлинности входа и контроль доступа к объектам в каталоге. С помощью единого сетевого логона администраторы могут управлять данными каталогов и организацией по всей сети, а авторизованные пользователи сети могут получить доступ к ресурсам в любом месте сети. AD DS обычно используется предприятиями в условиях, в нее, а учетные данные AD DS используются в качестве удостоверения для контроля доступа. Для получения дополнительной [информации см.](https://docs.microsoft.com/windows-server/identity/ad-ds/get-started/virtual-dc/active-directory-domain-services-overview)

-   **Управление доступом на основе ролей (RBAC) в Azure**

    Контроль доступа на основе ролей (RBAC) Azure обеспечивает точное управление доступом для Azure. С помощью RBAC можно управлять доступом к ресурсам, предоставляя пользователям минимальные разрешения, необходимые для выполнения поставленных задач. Для получения дополнительной информации [What is role-based access control (RBAC) in Azure?](../../role-based-access-control/overview.md)о RBAC см.

## <a name="common-use-cases"></a>Распространенные варианты использования

Аутентификация на основе идентификации и поддержка АКЛ Windows в файлах Azure лучше всего использовать для следующих случаев использования:

### <a name="replace-on-premises-file-servers"></a>Замена предприимных файловых серверов

Упрахивать и заменять разрозненные файловые серверы является общей проблемой, с которой сталкивается каждое предприятие в своем путешествии по модернизации ИТ. Файл Azure, который делится с предварительной аутентификацией AD DS (предварительный просмотр), лучше всего подходит для переноса данных в Azure Files. Полная миграция позволит вам воспользоваться преимуществами высокой доступности и масштабируемости, а также минимизировать изменения на стороне клиента. Он обеспечивает беспрепятственный опыт миграции конечным пользователям, чтобы они могли продолжать получать доступ к своим данным с теми же учетными данными, используя существующие компьютеры, объединенные доменом.

### <a name="lift-and-shift-applications-to-azure"></a>Лифт и сдвиг приложений в Azure

При подъеме и переносе приложений в облако необходимо сохранить ту же модель проверки подлинности для данных. По мере расширения опыта управления доступом на основе идентификационных данных до файлов Azure следует, что это устраняет необходимость изменения приложения на современные методы auth и ускорения внедрения облачных технологий. Акции файлов Azure предоставляют возможность интеграции с Azure AD DS или на месте AD DS (предварительный просмотр) для проверки подлинности. Если ваш план должен быть на 100% облачным и минимизированным усилием управления облачными инфраструктурами, Azure AD DS будет лучше подходить как полностью управляемый доменный сервис. Если вам нужна полная совместимость с возможностями AD DS, вы можете рассмотреть возможность расширения среды AD DS в облако с помощью контроллеров доменов самостоятельного хостинга на VMs. В любом случае, мы предоставляем гибкость в выборе доменных услуг, которые удовлетворяют вашим потребностям в бизнесе.

### <a name="backup-and-disaster-recovery-dr"></a>Резервное копирование и аварийное восстановление (DR)

Если вы храните основное хранилище файлов на местах, акции файлов Azure могут служить идеальным хранилищем для резервного копирования или DR, чтобы улучшить непрерывность бизнеса. Для резервного копирования данных с существующих файловых серверов можно использовать файлы Azure для резервного копирования данных, сохраняя при этом DACL Сн.К. В сценариях DR можно настроить опцию проверки подлинности для поддержки надлежащего обеспечения контроля доступа при сбое.

## <a name="supported-scenarios"></a>Поддерживаемые сценарии

В следующей таблице кратко излагается доля поддерживаемых файлов Azure сценариев аутентификации для Azure AD DS и предпосылок AD DS (предварительный просмотр). Рекомендуем выбрать служба домена, которую вы приняли для среды клиента для интеграции с Azure Files. Если у вас есть AD DS (предварительный просмотр) уже настроены на месте или в Azure, где ваши устройства являются доменом, объединенным к вашему AD, вы должны выбрать использовать AD DS (предварительный просмотр) для проверки подлинности файлов Azure. Аналогичным образом, если вы уже приняли Azure AD DS (GA), следует использовать его для проверки подлинности файлов Azure.


|Аутентификация Azure AD DS  | на территории AD DS (предварительный просмотр) аутентификация  |
|---------|---------|
|Связанные с Azure AD DS windows машины могут получать доступ к файловым долям Azure с учетными данными Azure AD по сравнению с SMB.     |На базе присоединенных к AD DS windows машин можно получить доступ к файловым долям Azure с учетными данными Active Directory, которые синхронизированы с Azure AD по сравнению с SMB.         |

### <a name="unsupported-scenarios"></a>Неподдерживаемые сценарии

- Azure AD DS и предприимчная аутентификация AD DS не поддерживают аутентификацию в отношении учетных записей компьютеров. Вместо этого можно рассмотреть возможность использования учетной записи логона службы.
- Проверка подлинности Azure AD DS не поддерживает аутентификацию на устройствах, связанных с AD, присоединенными к AD.

## <a name="advantages-of-identity-based-authentication"></a>Преимущества аутентификации на основе идентификации
Проверка подлинности на основе идентификации для Файлов Azure предоставляет несколько преимуществ по сравнению с использованием общей аутентификации ключей:

-   **Расширить традиционный интерфейс обмена файлами на основе идентификационных данных в облаке с помощью on-premises AD DS и Azure AD DS**  
    Если вы планируете поднять и перевести приложение в облако, заменив традиционные файловых серверов на акции файлов Azure, то вы можете захотеть, чтобы ваше приложение было проверено с помощью как на местах AD DS, так и учетных данных Azure AD DD для доступа к файловым данным. Azure Files поддерживает использование как на территории AD DS, так и учетных данных Azure AD DS для доступа к файловым долям Azure через SMB либо из местных AD DS, либо из доменных VMs, присоединенных к домену Azure AD DS.

-   **Принудительное применение детального контроля доступа для файловых ресурсов Azure**  
    Вы можете предоставить разрешения определенной идентификации на уровне доли, каталога или файла. Предположим, у вас есть несколько команд, использующих один файловый ресурс Azure для совместной работы над проектом. Вы можете предоставить всем командам доступ к каталогам с общедоступными данными, а доступ к каталогам с конфиденциальными финансовыми данными предоставить только финансовой группе. 

-   **Резервное копирование АКЛ Windows (также известный как NTFS) вместе с данными**  
    Для резервного копирования существующих файловых акций Внепредь можно использовать акции файлов Azure. Файлы Azure сохраняют ваши AcLs вместе с данными при резервном копировании доли файлов в файлах Azure, а также на SMB.

## <a name="how-it-works"></a>Принцип работы

Акции файлов Azure поддерживают аутентификацию Kerberos для интеграции с Azure AD DS или на территории AD DS (предварительный просмотр). Прежде чем включить аутентификацию в файлах Azure, необходимо сначала настроить среду домена. Для проверки подлинности Azure AD DS следует включить службы домена Azure AD и домены, чтобы присоединиться к вс-минам, с которых вы планируете получить доступ к файловым данным. Ввашем домена, объединенном VM, должен находиться в той же виртуальной сети (VNET), что и Ваш Azure AD DS. Аналогичным образом, для предварительной проверки подлинности AD DS (предварительного просмотра) необходимо настроить контроллер домена и домен, присоединяющийся к вашим машинам или vMs.

Когда ипоним, связанный с приложением, работающим на VM, пытается получить доступ к данным в файлах Azure, запрос отправляется в DS Azure AD для проверки подлинности идентификации. Если аутентификация успешна, Azure AD DS возвращает токен Kerberos. Приложение отправляет запрос, включающий токен Kerberos, и акции файлов Azure используют этот маркер для авторизации запроса. Файлы Azure получают только токен и не упорствуют учетными данными Azure AD DS. На территории AD DS аутентификация работает аналогичным образом, где ваш AD DS предоставляет токен Kerberos.

![Снимок экрана: схема проверки подлинности Azure AD по протоколу SMB](media/storage-files-active-directory-overview/azure-active-directory-over-smb-for-files-overview.png)

### <a name="enable-identity-based-authentication"></a>Включить проверку подлинности на основе идентификации

Вы можете включить аутентификацию на основе идентификации с помощью DS Azure AD или предварительного aD DS (предварительный просмотр) для файлов Azure в новых и существующих учетных записях хранения. Только одна служба домена может быть использована для проверки подлинности доступа к файлам на учетной записи хранилища, которая применяется ко всем файловым долям в учетной записи. Подробное руководство по настройке ваших файлов для проверки подлинности с Azure AD DS в нашей статье [Включить Azure Active Directory Domain Domain Services аутентификации на Azure файлов](storage-files-identity-auth-active-directory-domain-service-enable.md) и руководство для находящихся в помещениях AD DS (предварительный просмотр) в нашей другой статье, [Включить на месте Active Directory Domain Services аутентификации по сравнению с SMB для акций azure файл.](storage-files-identity-auth-active-directory-enable.md)

### <a name="configure-share-level-permissions-for-azure-files"></a>Настройка разрешений на уровне общего ресурса для файлов Azure

После включения aD-dS Azure AD или предварительной проверки подлинности AD DS (предварительного просмотра) можно использовать встроенные роли RBAC или настроить пользовательские роли для идентификаторов Azure AD и назначить права доступа к любым файловым долям в учетных записях хранилища. Назначенное разрешение позволяет предоставленному удостоверению получить доступ только к акции, ничего больше, даже корневому каталогу. Для раздельных файлов Azure по-прежнему необходимо отдельно настроить каталог или разрешения на уровне файлов файлов.

### <a name="configure-directory-or-file-level-permissions-for-azure-files"></a>Настройка каталога или разрешений уровня файлов для файлов Azure

Файлы Azure обеспечивают соблюдение стандартных разрешений файлов Windows как на уровне каталога, так и на уровне файлов, включая корневой каталог. Конфигурация разрешений каталога или уровня файлов поддерживается как по SMB, так и по REST. Смонтируйте целевой файл с вашего VM и назначьте разрешения с помощью Windows File Explorer, Windows [icacls](https://docs.microsoft.com/windows-server/administration/windows-commands/icacls)или команды [Set-ACL.](https://docs.microsoft.com/powershell/module/microsoft.powershell.security/get-acl?view=powershell-6)

### <a name="use-the-storage-account-key-for-superuser-permissions"></a>Использование ключа учетной записи хранения для разрешений суперпользователя

Пользователь с ключом учетной записи хранилища может получить доступ к файлам Azure с разрешениями суперпользователя. Разрешения суперпользователя обходят все ограничения управления доступом.

> [!IMPORTANT]
> Рекомендуемая наша рекомендация по обеспечению безопасности заключается в том, чтобы избежать обмена ключами учетной записи хранилища и по возможности использовать аутентификацию на основе личных данных.

### <a name="preserve-directory-and-file-acls-when-importing-data-to-azure-file-shares"></a>Сохранение каталога и файловых АКЛ при импорте данных в файлы Azure

Azure Files поддерживает сохранение акпла уровня каталогов или файлов при копировании данных в файлы Azure. Вы можете копировать ACLs в каталоге или файл для акций файлов Azure, используя либо Azure File Sync, либо общие наборы инструментов движения файлов. Например, можно использовать [робокопию](https://docs.microsoft.com/windows-server/administration/windows-commands/robocopy) с флагом `/copy:s` для копирования данных, а также АКЛ в файле Azure. AcLs сохраняются по умолчанию, вы не обязаны включать проверку подлинности на основе идентификации в учетной записи хранения для сохранения АПл.

## <a name="pricing"></a>Цены
Дополнительная плата за обслуживание не взимается с системы проверки подлинности на основе идентификации по сравнению с SMB в вашей учетной записи хранения. Для получения дополнительной информации о ценах [см.](https://azure.microsoft.com/pricing/details/storage/files/) [Azure AD Domain Services pricing](https://azure.microsoft.com/pricing/details/active-directory-ds/)

## <a name="next-steps"></a>Следующие шаги
Для получения дополнительной информации о Файлах Azure и аутентификации на основе идентификации по сравнению с SMB см.

- [Планирование развертывания службы файлов Azure](storage-files-planning.md)
- [Включить проверку подлинности доменных служб Active Directory Domain Services по сравнению с SMB для файлов Azure](storage-files-identity-auth-active-directory-enable.md)
- [Включить проверку функциональности домена службы активного каталога Azure в файлах Azure](storage-files-identity-auth-active-directory-domain-service-enable.md)
- [Вопросы и ответы](storage-files-faq.md)
