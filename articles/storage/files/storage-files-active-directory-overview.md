---
title: 'Обзор: авторизация на основе удостоверений в службе файлов Azure'
description: Служба файлов Azure поддерживает проверку подлинности на основе удостоверений через SMB (блок сообщений сервера) через Azure Active Directory доменные службы (AD DS) и Active Directory. В результате присоединенные к домену виртуальные машины Windows будут иметь доступ к файловым ресурсам Azure с помощью учетных данных Azure AD.
author: roygara
ms.service: storage
ms.topic: article
ms.date: 02/21/2020
ms.author: rogarana
ms.openlocfilehash: 3a9a2a903bd9979cd0f9a09b7589edc6d4fd8962
ms.sourcegitcommit: f27b045f7425d1d639cf0ff4bcf4752bf4d962d2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/23/2020
ms.locfileid: "77565096"
---
# <a name="overview-of-azure-files-identity-based-authentication-support-for-smb-access"></a>Обзор поддержки проверки подлинности на основе удостоверений в службе файлов Azure для доступа по протоколу SMB
[!INCLUDE [storage-files-aad-auth-include](../../../includes/storage-files-aad-auth-include.md)]

Сведения о включении проверки подлинности AD для файловых ресурсов Azure см. в статье [Включение проверки подлинности Active Directory для файловых ресурсов](storage-files-active-directory-domain-services-enable.md)Azure.

Сведения о том, как включить проверку подлинности Azure AD DS для файловых ресурсов Azure, см. в статье [Включение проверки подлинности службы домена Azure Active Directory для файлов Azure](storage-files-active-directory-enable.md).

## <a name="glossary"></a>Глоссарий 
Полезно понимать некоторые ключевые термины, связанные с проверкой подлинности службы домена Azure AD по протоколу SMB для файловых ресурсов Azure:

-   **Проверка подлинности Kerberos**

    Kerberos — это протокол проверки подлинности, который используется для проверки удостоверения пользователя или узла. Дополнительные сведения о протоколе Kerberos см. в разделе [Обзор проверки подлинности Kerberos](https://docs.microsoft.com/windows-server/security/kerberos/kerberos-authentication-overview).

-  **Протокол SMB (Server Message Block)**

    SMB — это стандартный протокол обмена файлами по сети. SMB также называется Common Internet File System, или CIFS. Дополнительные сведения о SMB см. в разделе [Протокол SMB Майкрософт и обзор протокола CIFS](https://docs.microsoft.com/windows/desktop/FileIO/microsoft-smb-protocol-and-cifs-protocol-overview).

-   **Azure Active Directory (Azure AD).**

    Azure Active Directory (Azure AD) — это мультитенантный облачный каталог и служба управления удостоверениями корпорации Майкрософт. Azure AD объединяет в себе базовые службы каталогов, функции управления доступом к приложениям и защиту удостоверений. Azure AD позволяет виртуальным машинам Windows, присоединенным к домену, получать доступ к файловым ресурсам Azure с помощью учетных данных Azure AD. Дополнительные сведения см. в статье [Что такое Azure Active Directory](../../active-directory/fundamentals/active-directory-whatis.md).

-   **Доменные службы Azure AD (AD DS Azure)**

    Доменные службы Azure AD (GA) предоставляют управляемые доменные службы, такие как присоединение к домену, групповые политики, LDAP и проверка подлинности Kerberos/NTLM. Эти службы полностью совместимы с Windows Server Active Directory. Дополнительные сведения см. в статье [Доменные службы Azure Active Directory (AD)](../../active-directory-domain-services/overview.md).

- **Службы домен Active Directory Services (AD DS, также называемые AD)**

    Active Directory (AD) (Предварительная версия) предоставляет методы для хранения данных каталога, делая их доступными для пользователей и администраторов сети. Безопасность интегрирована с Active Directory путем проверки подлинности входа и управления доступом к объектам в каталоге. С одним сетевым входом администраторы могут управлять данными каталога и Организацией по всей сети, а полномочные пользователи сети могут получать доступ к ресурсам в любой точке сети. AD обычно используются предприятиями в локальной среде и используют учетные данные AD в качестве удостоверения для контроля доступа. Дополнительные сведения см. в разделе [Обзор служб домен Active Directory](https://docs.microsoft.com/windows-server/identity/ad-ds/get-started/virtual-dc/active-directory-domain-services-overview).

-   **Управление доступом на основе ролей (RBAC) в Azure**

    Контроль доступа на основе ролей (RBAC) Azure обеспечивает точное управление доступом для Azure. С помощью RBAC можно управлять доступом к ресурсам, предоставляя пользователям минимальные разрешения, необходимые для выполнения поставленных задач. Дополнительные сведения о RBAC см. [в статье что такое управление доступом на основе ролей (RBAC) в Azure?](../../role-based-access-control/overview.md).

## <a name="common-use-cases"></a>Распространенные варианты использования

Проверка подлинности на основе удостоверений и поддержка списков управления доступом Windows в службе файлов Azure лучше использовать в следующих случаях:

### <a name="replace-on-premises-file-servers"></a>Замена локальных файловых серверов

Нерекомендуемая и замена разбросанных локальных файловых серверов — это распространенная проблема, с которой каждое предприятие сталкивается в своем модернизациие ИТ. Общие файловые ресурсы Azure с проверкой подлинности AD (Предварительная версия) лучше подходят для переноса данных в службу файлов Azure. Полная миграция позволит вам воспользоваться преимуществами высокой доступности и масштабируемости, а также свести к минимуму изменения на стороне клиента, особенно сложную инфраструктуру доменов AD. Он обеспечивает простую миграцию для конечных пользователей, поэтому они могут продолжать обращаться к своим данным с теми же учетными данными, используя существующие компьютеры, присоединенные к домену.

### <a name="lift-and-shift-applications-to-azure"></a>Перенос приложений в Azure

При переносе приложений в облако вы хотите использовать ту же модель проверки подлинности для данных. Так как мы расширяем возможности управления доступом на основе удостоверений в файловые ресурсы Azure, это исключает необходимость изменения приложения на современные методы проверки подлинности и ускорения внедрения в облако. Файловые ресурсы Azure предоставляют возможность интеграции с Azure AD DS (общедоступной версии) или AD (Предварительная версия) для проверки подлинности. Если ваш план должен быть 100% машинного облака и максимально упростить управление облачными инфраструктурами, AD DS Azure лучше подходит как полностью управляемая служба домена. Если вам необходима полная совместимость с возможностями AD DS (GA), вам может потребоваться расширить среду AD до облака, используя контроллеры домена для размещения на виртуальных машинах. В любом случае мы предоставляем гибкость для выбора доменных служб, отвечающих потребностям вашего бизнеса.

### <a name="backup-and-disaster-recovery-dr"></a>Резервное копирование и аварийное восстановление (DR)

При хранении первичного хранилища файлов в локальной среде файловые ресурсы Azure могут служить идеальным хранилищем для резервного копирования или аварийного восстановления, чтобы повысить непрерывность бизнес-процессов. Файловые ресурсы Azure можно использовать для резервного копирования данных с существующих файловых серверов, сохраняя списки DACL Windows. В сценариях аварийного восстановления можно настроить параметр проверки подлинности для поддержки надлежащего применения контроля доступа при отработке отказа.

## <a name="supported-scenarios"></a>Поддерживаемые сценарии

В следующей таблице перечислены поддерживаемые сценарии проверки подлинности файловых ресурсов Azure для Azure AD DS (GA) и AD (Предварительная версия). Мы рекомендуем выбрать службу домена, которую вы приняли в клиентской среде для интеграции с файлами Azure. Если служба AD (Предварительная версия) уже настроена локально или в Azure, где устройства присоединены к AD, следует выбрать использование AD (Предварительная версия) для проверки подлинности файловых ресурсов Azure. Аналогично, если вы уже приняли Azure AD DS (общедоступная версия), вы должны использовать его для проверки подлинности файловых ресурсов Azure.


|Аутентификация Azure AD DS (GA)  |Проверка подлинности Active Directory (Предварительная версия)  |
|---------|---------|
|Присоединенные к домену Azure AD DS компьютеры Windows могут получать доступ к файловым ресурсам Azure с помощью учетных данных Azure AD через SMB.     |Присоединенные к домену Active Directory компьютеры Windows могут получить доступ к общим файловым ресурсам Azure с учетными данными AD, которые синхронизируются с Azure AD через SMB.         |

### <a name="unsupported-scenarios"></a>Неподдерживаемые сценарии

- Проверка подлинности Azure AD DS (GA) и AD (Предварительная версия) не поддерживает проверку подлинности для учетных записей компьютеров. Вместо этого можно использовать учетную запись входа в службу.
- Проверка подлинности Azure AD DS (GA) не поддерживает аутентификацию для устройств, присоединенных к облаку Azure AD.

## <a name="advantages-of-identity-based-authentication"></a>Преимущества проверки подлинности на основе удостоверений
Проверка подлинности на основе удостоверений для файлов Azure обеспечивает несколько преимуществ при использовании проверки подлинности с использованием общего ключа:

-   **Расширение традиционных возможностей доступа к общей папке на основе удостоверений в облако с помощью AD и Azure AD DS**  
    Если вы планируете выполнить перенос приложения в облако, заменив традиционные файловые серверы общими файловыми ресурсами Azure, вам может потребоваться выполнить проверку подлинности приложения с помощью учетных данных AD или Azure AD для доступа к данным файлов. Служба файлов Azure поддерживает использование учетных данных AD или Azure AD для доступа к файловым ресурсам Azure через SMB из виртуальных машин, присоединенных к домену AD или Azure AD DS.

-   **Принудительное применение детального контроля доступа для файловых ресурсов Azure**  
    Можно предоставить разрешения на доступ к определенному удостоверению на уровне общего ресурса, каталога или файла. Предположим, у вас есть несколько команд, использующих один файловый ресурс Azure для совместной работы над проектом. Вы можете предоставить всем командам доступ к каталогам с общедоступными данными, а доступ к каталогам с конфиденциальными финансовыми данными предоставить только финансовой группе. 

-   **Резервное копирование списков управления доступом Windows (также известных как NTFS) вместе с данными**  
    Вы можете использовать файловые ресурсы Azure для резервного копирования существующих локальных файловых ресурсов. Служба файлов Azure сохраняет списки ACL вместе с данными при резервном копировании общей папки в файловые ресурсы Azure через SMB.

## <a name="how-it-works"></a>Принцип работы
Файловые ресурсы Azure поддерживают проверку подлинности Kerberos для интеграции с Azure AD DS (GA) или AD (Предварительная версия). Перед включением проверки подлинности в файловых ресурсах Azure сначала необходимо настроить среду домена. Для проверки подлинности Azure AD DS (общедоступная версия) необходимо включить доменные службы Azure AD и присоединить к домену виртуальные машины, из которых планируется получать доступ к данным файлов. Виртуальная машина, присоединенная к домену, должна находиться в той же виртуальной сети, что и доменные службы Azure AD. Аналогичным образом, для проверки подлинности Active Directory (Предварительная версия) необходимо настроить контроллер домена Active Directory и домен, присоединяемый к компьютерам или виртуальным машинам.

Когда удостоверение, связанное с приложением, работающим на виртуальной машине, пытается получить доступ к данным в общих файловых ресурсах Azure, запрос отправляется в доменные службы Azure AD для проверки подлинности удостоверения. Если проверка подлинности выполнена, доменные службы Azure AD возвращают токен Kerberos. Приложение отправляет запрос, включающий маркер Kerberos, а файловые ресурсы Azure используют этот маркер для авторизации запроса. Файловые ресурсы Azure получают только маркер и не сохраняют учетные данные Azure AD. Проверка подлинности Active Directory работает аналогичным образом, где AD предоставляет маркер Kerberos.

![Снимок экрана: схема проверки подлинности Azure AD по протоколу SMB](media/storage-files-active-directory-overview/azure-active-directory-over-smb-for-files-overview.png)

### <a name="enable-identity-based-authentication"></a>Включить проверку подлинности на основе удостоверений

Вы можете включить проверку подлинности на основе удостоверений с помощью Azure AD DS (общедоступной версии) или AD (Предварительная версия) для файловых ресурсов Azure в новых и существующих учетных записях хранения. Для проверки подлинности доступа к файлам в учетной записи хранения можно использовать только одну службу домена, которая применяется ко всем файловым ресурсам в учетной записи. Подробное пошаговое руководство по настройке файловых ресурсов для проверки подлинности с помощью Azure AD DS (общедоступная версия) в статье [Azure Active Directory включение проверки подлинности доменных служб для службы файлов Azure](storage-files-active-directory-enable.md) и руководство по AD (Preview) см. в этой статье. [включите Active Directory по протоколу SMB для файловых ресурсов Azure](storage-files-active-directory-domain-services-enable.md).

### <a name="configure-share-level-permissions-for-azure-files"></a>Настройка разрешений на уровне общего ресурса для файлов Azure

После включения проверки подлинности Azure AD DS (GA) или AD (Предварительная версия) можно использовать встроенные роли RBAC или настроить пользовательские роли для удостоверений Azure AD и назначить права доступа для всех файловых ресурсов в учетных записях хранения. назначенное разрешение позволяет предоставленному удостоверению получить доступ только к общей папке, но не к корневому каталогу. Вам по-прежнему необходимо отдельно настроить разрешения на уровне каталога или файла для файловых ресурсов Azure.

### <a name="configure-directory-or-file-level-permissions-for-azure-files"></a>Настройка разрешений на уровне каталога или файлов для файлов Azure

Файловые ресурсы Azure обеспечивают стандартные разрешения для файлов Windows в каталоге и на уровне файлов, включая корневой каталог. Настройка разрешений на уровне каталогов или файлов поддерживается как для SMB, так и для остальных. Подключите целевой файловый ресурс из виртуальной машины и настройте разрешения с помощью проводника Windows File Explorer, Windows [icacls](https://docs.microsoft.com/windows-server/administration/windows-commands/icacls)или команды [Set-ACL](https://docs.microsoft.com/powershell/module/microsoft.powershell.security/get-acl?view=powershell-6) .

### <a name="use-the-storage-account-key-for-superuser-permissions"></a>Использование ключа учетной записи хранения для разрешений суперпользователя

Пользователь, обладающий ключом учетной записи хранения, может получить доступ к файловым ресурсам Azure с разрешениями суперпользователя. Разрешения суперпользователя обходят все ограничения управления доступом.

> [!IMPORTANT]
> Рекомендуемый подход к безопасности заключается в том, чтобы избежать совместного использования ключей учетной записи хранения и использовать проверку подлинности на основе удостоверений, когда это возможно.

### <a name="preserve-directory-and-file-acls-when-importing-data-to-azure-file-shares"></a>Сохранять списки ACL для каталогов и файлов при импорте данных в файловые ресурсы Azure

Служба "файлы Azure" поддерживает сохранение ACL на уровне каталогов или файлов при копировании данных в файловые ресурсы Azure. Списки ACL для каталога или файла можно скопировать в файловые ресурсы Azure с помощью Синхронизация файлов Azure или общих наборов средств перемещения файлов. Например, можно использовать [Robocopy](https://docs.microsoft.com/windows-server/administration/windows-commands/robocopy) с флагом `/copy:s` для копирования данных, а также списков ACL в файловый ресурс Azure. Списки ACL сохраняются по умолчанию, поэтому не требуется включать проверку подлинности на основе удостоверений в учетной записи хранения для сохранения списков управления доступом.

## <a name="pricing"></a>Цены
Для включения проверки подлинности на основе удостоверений через SMB в вашей учетной записи хранения дополнительная плата за обслуживание не взимается. Дополнительные сведения о ценах см. в статье цены на службы [файлов Azure](https://azure.microsoft.com/pricing/details/storage/files/) и [цены доменных служб Azure AD](https://azure.microsoft.com/pricing/details/active-directory-ds/) , если вы ищете сведения о службах домена AAD.

## <a name="next-steps"></a>Следующие шаги
Дополнительные сведения о службе файлов Azure и аутентификации на основе удостоверений по протоколу SMB см. в следующих ресурсах:

- [Планирование развертывания службы файлов Azure](storage-files-planning.md)
- [Включение проверки подлинности Active Directory в SMB для файловых ресурсов Azure](storage-files-active-directory-domain-services-enable.md)
- [Включение проверки подлинности доменных служб Azure Active Directory в службе файлов Azure](storage-files-active-directory-enable.md)
- [Часто задаваемые вопросы](storage-files-faq.md)
