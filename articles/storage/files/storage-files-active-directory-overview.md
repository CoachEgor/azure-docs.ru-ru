---
title: Обзор - Авторизация на основе идентификационных данных Azure Files
description: Azure Files поддерживает аутентификацию на основе идентификации по сравнению с SMB (Блок сообщений сервера) через службы домена Active Directory Domain Services (AD DS) и Active Directory. В результате присоединенные к домену виртуальные машины Windows будут иметь доступ к файловым ресурсам Azure с помощью учетных данных Azure AD.
author: roygara
ms.service: storage
ms.subservice: files
ms.topic: conceptual
ms.date: 02/21/2020
ms.author: rogarana
ms.openlocfilehash: 737cdfaddca3a5f7532620bdafd86149e4d61f9f
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80061074"
---
# <a name="overview-of-azure-files-identity-based-authentication-support-for-smb-access"></a>Обзор поддержки аутентификации на основе файлов Azure на основе SMB для доступа к SMB
[!INCLUDE [storage-files-aad-auth-include](../../../includes/storage-files-aad-auth-include.md)]

Чтобы узнать, как включить аутентификацию [Enable Active Directory authentication over SMB for Azure file shares](storage-files-identity-auth-active-directory-enable.md)AD для файлов Azure, см.

Чтобы узнать, как включить аутентацию Azure AD DS для файлов Azure, смотрите в файлах [Azure Active Directory Domain Services проверки подлинности файлов Azure.](storage-files-identity-auth-active-directory-domain-service-enable.md)

## <a name="glossary"></a>Глоссарий 
Полезно понять некоторые ключевые термины, связанные с аутентификацией службы домена Azure AD по сравнению с SMB для файлов azure:

-   **Проверка подлинности Кербероса**

    Kerberos — это протокол проверки подлинности, который используется для проверки удостоверения пользователя или узла. Дополнительные сведения о протоколе Kerberos см. в разделе [Обзор проверки подлинности Kerberos](https://docs.microsoft.com/windows-server/security/kerberos/kerberos-authentication-overview).

-  **Протокол SMB (Server Message Block)**

    SMB — это стандартный протокол обмена файлами по сети. SMB также называется Common Internet File System, или CIFS. Дополнительные сведения о SMB см. в разделе [Протокол SMB Майкрософт и обзор протокола CIFS](https://docs.microsoft.com/windows/desktop/FileIO/microsoft-smb-protocol-and-cifs-protocol-overview).

-   **Активный каталог Azure (Azure AD)**

    Active Directory Azure (Azure AD) — служба управления и идентификационными данными microsoft с несколькими тентиями на основе облачных и удостоверений данных. Azure AD объединяет в себе базовые службы каталогов, функции управления доступом к приложениям и защиту удостоверений. Azure AD позволяет конторным устройствами Windows( МиС) получать доступ к файлам Azure с учетными данными Azure AD. Дополнительные сведения см. в статье [Что такое Azure Active Directory](../../active-directory/fundamentals/active-directory-whatis.md).

-   **Службы домена Azure (Azure Ad DS)**

    Службы домена Azure AD Domain Services (GA) предоставляют управляемые доменные службы, такие как соединение доменов, групповые политики, LDAP и аутентификация Kerberos/NTLM. Эти службы полностью совместимы с Windows Server Active Directory. Дополнительные сведения см. в статье [Доменные службы Azure Active Directory (AD)](../../active-directory-domain-services/overview.md).

- **Активные службы домена каталога (AD DS, также называемый AD)**

    Active directory (AD) (предварительный просмотр) предоставляет методы хранения данных каталога, делая их доступными для пользователей сети и администраторов. Безопасность интегрируется с Active Directory через проверку подлинности входа и управления доступом к объектам в каталоге. С помощью единого сетевого логона администраторы могут управлять данными каталогов и организацией по всей сети, а авторизованные пользователи сети могут получить доступ к ресурсам в любом месте сети. AD обычно используется предприятиями в на месте и использовать AD учетных данных в качестве удостоверения для контроля доступа. Для получения дополнительной [информации см.](https://docs.microsoft.com/windows-server/identity/ad-ds/get-started/virtual-dc/active-directory-domain-services-overview)

-   **Управление доступом на основе ролей (RBAC) в Azure**

    Контроль доступа на основе ролей (RBAC) Azure обеспечивает точное управление доступом для Azure. С помощью RBAC можно управлять доступом к ресурсам, предоставляя пользователям минимальные разрешения, необходимые для выполнения поставленных задач. Для получения дополнительной информации [What is role-based access control (RBAC) in Azure?](../../role-based-access-control/overview.md)о RBAC см.

## <a name="common-use-cases"></a>Распространенные варианты использования

Аутентификация на основе идентификации и поддержка АКЛ Windows в файлах Azure лучше всего использовать для следующих случаев использования:

### <a name="replace-on-premises-file-servers"></a>Замена предприимных файловых серверов

Упрахивать и заменять разрозненные файловые серверы является общей проблемой, с которой сталкивается каждое предприятие в своем путешествии по модернизации ИТ. Доля файлов Azure с aD (предварительный просмотр) аутентификации лучше всего подходит здесь, когда вы можете перенести данные в Azure Files. Полная миграция позволит вам воспользоваться преимуществами высокой доступности и масштабируемости, а также минимизировать изменения стороны клиента, особенно сложную инфраструктуру домена AD. Он обеспечивает беспрепятственный опыт миграции конечным пользователям, чтобы они могли продолжать получать доступ к своим данным с теми же учетными данными, используя существующие компьютеры, объединенные доменом.

### <a name="lift-and-shift-applications-to-azure"></a>Лифт и сдвиг приложений в Azure

При "подъеме и переносе" приложений в облако необходимо сохранить ту же модель проверки подлинности для данных. По мере расширения опыта управления доступом на основе идентификационных данных до файлов Azure следует, что это устраняет необходимость изменения приложения на современные методы auth и ускорения внедрения облачных технологий. Акции файлов Azure предоставляют возможность интеграции с Azure AD DS (GA) или AD (предварительный просмотр) для проверки подлинности. Если ваш план должен быть на 100% облачным и минимизированным усилием управления облачными инфраструктурами, Azure AD DS будет лучше подходить как полностью управляемый доменный сервис. Если вам нужна полная совместимость с возможностями AD DS (GA), вы можете рассмотреть возможность расширения среды AD в облако путем самостоятельного хостинга доменных контроллеров на VMs. В любом случае, мы предоставляем гибкость в выборе доменных услуг, которые удовлетворяют вашим потребностям в бизнесе.

### <a name="backup-and-disaster-recovery-dr"></a>Резервное копирование и аварийное восстановление (DR)

Если вы храните основное хранилище файлов на местах, акции файлов Azure могут служить идеальным хранилищем для резервного копирования или DR, чтобы улучшить непрерывность бизнеса. Для резервного копирования данных с существующих файловых серверов можно использовать файлы Azure для резервного копирования данных, сохраняя при этом DACL Сн.К. В сценариях DR можно настроить опцию проверки подлинности для поддержки надлежащего обеспечения контроля доступа при сбое.

## <a name="supported-scenarios"></a>Поддерживаемые сценарии

В следующей таблице кратко излагается доля поддерживаемых файлов Azure сценариев аутентификации для Azure AD DS (GA) и AD (предварительный просмотр). Рекомендуем выбрать служба домена, которую вы приняли для среды клиента для интеграции с Azure Files. Если у вас есть AD (предварительный просмотр) уже настроены на месте или в Azure, где ваши устройства являются доменом, объединенными в AD, вы должны выбрать использование AD (предварительный просмотр) для проверки подлинности файлов Azure. Аналогичным образом, если вы уже приняли Azure AD DS (GA), следует использовать его для проверки подлинности файлов Azure.


|Проверка подлинности Azure AD DS (GA)  |AD (предварительный просмотр) аутентификация  |
|---------|---------|
|Домен Azure AD DS, объединенный с windows-машинами, может получить доступ к файловым долям Azure aD с учетными данными Azure AD по сравнению с SMB.     |Домен Ад,5, объединенный с windows-машинами, может получать доступ к файловым долям Azure с учетными данными AD, которые синхронизированы с Azure AD по сравнению с SMB.         |

### <a name="unsupported-scenarios"></a>Неподдерживаемые сценарии

- Проверка подлинности Azure AD DS (GA) и AD (предварительный просмотр) не поддерживают аутентификацию в отношении учетных записей компьютеров. Вместо этого можно рассмотреть возможность использования учетной записи логона службы.
- Проверка подлинности Azure AD DS (GA) не поддерживает аутентификацию на устройствах, связанных с облаком Azure AD.

## <a name="advantages-of-identity-based-authentication"></a>Преимущества аутентификации на основе идентификации
Проверка подлинности на основе идентификации для Файлов Azure предоставляет несколько преимуществ по сравнению с использованием общей аутентификации ключей:

-   **Расширить традиционный интерфейс совместного доступа файлов на основе идентификационных данных в облако с помощью AD и Azure AD DS**  
    Если вы планируете «поднять и перевести» приложение в облако, заменив традиционные файловых серверов на акции файлов Azure, то вы можете захотеть, чтобы ваше приложение подлинности с помощью учетных данных AD или Azure AD для доступа к файловым данным. Azure Files поддерживает использование как AD, так и Azure AD для доступа к файловым долям Azure через SMB с доменов, объединенных AD или Azure AD DS.

-   **Принудительное применение детального контроля доступа для файловых ресурсов Azure**  
    Вы можете предоставить разрешения определенной идентификации на уровне доли, каталога или файла. Предположим, у вас есть несколько команд, использующих один файловый ресурс Azure для совместной работы над проектом. Вы можете предоставить всем командам доступ к каталогам с общедоступными данными, а доступ к каталогам с конфиденциальными финансовыми данными предоставить только финансовой группе. 

-   **Резервное копирование АКЛ Windows (также известный как NTFS) вместе с данными**  
    Для резервного копирования существующих файловых акций Внепредь можно использовать акции файлов Azure. Файлы Azure сохраняют ваши AcLs вместе с данными при резервном копировании доли файлов в файлах Azure, а также на SMB.

## <a name="how-it-works"></a>Принцип работы
Акции файлов Azure поддерживают проверку подлинности kerberos для интеграции либо с Azure AD DS (GA) или AD (предварительный просмотр). Прежде чем включить аутентификацию в файлах Azure, необходимо сначала настроить среду домена. Для проверки подлинности Azure AD DS (GA) следует включить службы домена Azure AD и домен, чтобы получить доступ к файловым данным. Ввашем домена, объединенном VM, должен находиться в той же виртуальной сети (VNET), что и службы домена Azure AD. Аналогичным образом, для проверки подлинности AD (предварительного просмотра) необходимо настроить контроллер домена Active Directory и квам Active Directory, и к домену присоединиться к вашим машинам или vMs.

Когда ипоним, связанный с приложением, работающим на VM, пытается получить доступ к данным в файлах Azure, запрос отправляется в службу домена Azure AD для проверки подлинности идентификации. Если проверка подлинности выполнена, доменные службы Azure AD возвращают токен Kerberos. Приложение отправляет запрос, включающий токен Kerberos, и акции файлов Azure используют этот маркер для авторизации запроса. Акции файлов Azure получают только токен и не упорствуют в учетных данных Azure AD. Аутентификация AD работает аналогичным образом, где AD предоставляет токен Kerberos.

![Снимок экрана: схема проверки подлинности Azure AD по протоколу SMB](media/storage-files-active-directory-overview/azure-active-directory-over-smb-for-files-overview.png)

### <a name="enable-identity-based-authentication"></a>Включить проверку подлинности на основе идентификации

Вы можете включить аутентификацию на основе идентификации с помощью либо Azure AD DS (GA), либо AD (предварительный просмотр) для файлов Azure в новых и существующих учетных записях хранения. Только одна служба домена может быть использована для проверки подлинности доступа к файлам на учетной записи хранилища, которая применяется ко всем файловым долям в учетной записи. Подробное шаг за шагом руководство по настройке ваших файлов для проверки подлинности с Azure AD DS (GA) в нашей статье [Включить Azure Active Directory Domain Domain Services аутентификации на Azure файлов](storage-files-identity-auth-active-directory-domain-service-enable.md) и руководство для AD (предварительный просмотр) в нашей другой статье, [Включить активную проверку каталога над SMB для акций файлов Azure.](storage-files-identity-auth-active-directory-enable.md)

### <a name="configure-share-level-permissions-for-azure-files"></a>Настройка разрешений на уровне общего ресурса для файлов Azure

После включения аутентификации Azure AD DD (GA) или AD (preview) можно использовать встроенные роли RBAC или настроить пользовательские роли для идентификационных данных Azure AD и назначить права доступа к любым файловым долям в учетных записях хранилища. назначенное разрешение позволяет предоставленному удостоверению получить доступ только к акции, ничего больше, даже корневому каталогу. Для раздельных файлов Azure по-прежнему необходимо отдельно настроить каталог или разрешения на уровне файлов файлов.

### <a name="configure-directory-or-file-level-permissions-for-azure-files"></a>Настройка каталога или разрешений уровня файлов для файлов Azure

Акции файлов Azure обеспечивают соблюдение стандартных разрешений файлов Windows как на уровне каталога, так и на уровне файлов, включая корневой каталог. Конфигурация разрешений каталога или уровня файлов поддерживается как по SMB, так и по REST. Смонтируйте целевой файл с вашего VM и назначьте разрешения с помощью Windows File Explorer, Windows [icacls](https://docs.microsoft.com/windows-server/administration/windows-commands/icacls)или команды [Set-ACL.](https://docs.microsoft.com/powershell/module/microsoft.powershell.security/get-acl?view=powershell-6)

### <a name="use-the-storage-account-key-for-superuser-permissions"></a>Использование ключа учетной записи хранения для разрешений суперпользователя

Пользователь, обладающий ключом учетной записи хранилища, может получить доступ к файлам Azure с разрешениями суперпользователя. Разрешения суперпользователя обходят все ограничения управления доступом.

> [!IMPORTANT]
> Рекомендуемая наша рекомендация по обеспечению безопасности заключается в том, чтобы избежать обмена ключами учетной записи хранилища и по возможности использовать аутентификацию на основе идентификации.

### <a name="preserve-directory-and-file-acls-when-importing-data-to-azure-file-shares"></a>Сохранение каталога и файловых АКЛ при импорте данных в файлы Azure

Azure Files поддерживает сохранение акпла уровня каталогов или файлов при копировании данных в файлы Azure. Вы можете копировать ACLs в каталоге или файл для акций файлов Azure, используя либо Azure File Sync, либо общие наборы инструментов движения файлов. Например, можно использовать [робокопию](https://docs.microsoft.com/windows-server/administration/windows-commands/robocopy) с флагом `/copy:s` для копирования данных, а также АКЛ в файле Azure. AcLs сохраняются по умолчанию, вы не обязаны включать проверку подлинности на основе идентификации в учетной записи хранения для сохранения АПл.

## <a name="pricing"></a>Цены
Дополнительная плата за обслуживание не взимается с системы проверки подлинности на основе идентификации по сравнению с SMB в вашей учетной записи хранения. Для получения дополнительной информации о ценах смотрите [цены на цены Azure Files](https://azure.microsoft.com/pricing/details/storage/files/) и страницы [ценообразования на aure AD Domain Services,](https://azure.microsoft.com/pricing/details/active-directory-ds/) если вы ищете информацию AAD DS.

## <a name="next-steps"></a>Дальнейшие действия
Для получения дополнительной информации о Файлах Azure и аутентификации на основе идентификации по сравнению с SMB см.

- [Планирование развертывания службы файлов Azure](storage-files-planning.md)
- [Включить активную проверку подлинности каталога по сравнению с SMB для файлов Azure](storage-files-identity-auth-active-directory-enable.md)
- [Включить проверку функциональности домена службы активного каталога Azure в файлах Azure](storage-files-identity-auth-active-directory-domain-service-enable.md)
- [Вопросы и ответы](storage-files-faq.md)
