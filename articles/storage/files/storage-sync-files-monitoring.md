---
title: Мониторинг Синхронизации файлов Azure | Документация Майкрософт
description: Узнайте, как выполнять мониторинг Синхронизации файлов Azure.
author: roygara
ms.service: storage
ms.topic: how-to
ms.date: 06/28/2019
ms.author: rogarana
ms.subservice: files
ms.openlocfilehash: 0232a0c6526d6dcdfec86dedec437c71e7e21080
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "85515201"
---
# <a name="monitor-azure-file-sync"></a>Мониторинг службы "Синхронизация файлов Azure"

Используйте службу "Синхронизация файлов Azure", чтобы централизованно хранить файловые ресурсы организации в службе файлов Azure, обеспечивая гибкость, производительность и совместимость локального файлового сервера. Это достигается путем преобразования Windows Server в быстрый кэш общего файлового ресурса Azure. Для локального доступа к данным вы можете использовать любой протокол, доступный в Windows Server, в том числе SMB, NFS и FTPS. Кроме того, вы можете создать любое количество кэшей в любом регионе.

В этой статье описывается, как отслеживать развертывание Синхронизация файлов Azure с помощью Azure Monitor, службы синхронизации хранилища и Windows Server.

В настоящее время доступны следующие параметры мониторинга.

## <a name="azure-monitor"></a>Azure Monitor

Используйте [Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/overview) для просмотра метрик и настройки оповещений для синхронизации, распределения по уровням облака и подключения к серверу.  

### <a name="metrics"></a>Метрики

Метрики для Синхронизации файлов Azure включены по умолчанию и отправляются в Azure Monitor каждые 15 минут.

Чтобы просмотреть метрики Синхронизация файлов Azure в Azure Monitor, выберите тип ресурса **службы синхронизации хранилища** .

В Azure Monitor используются следующие метрики для Синхронизации файлов Azure:

| Имя метрики | Описание: |
|-|-|
| Синхронизировано байт | Размер переданных данных (отправка и скачивание).<br><br>Единица измерения: Байты<br>Тип статистической обработки: Sum<br>Применимые измерения: имя конечной точки сервера, направление синхронизации, имя группы синхронизации |
| Отзыв уровней в облаке | Размер отозванных данных.<br><br>**Примечание**. Эта метрика будет удалена в будущем. Используйте метрику размера отзыва "распределение по уровням облака" для отслеживания размера отозванных данных.<br><br>Единица измерения: Байты<br>Тип статистической обработки: Sum<br>Применимое измерение: имя сервера |
| Размер отзыва уровней в облаке | Размер отозванных данных.<br><br>Единица измерения: Байты<br>Тип статистической обработки: Sum<br>Применимое измерение: имя сервера, имя группы синхронизации |
| Размер отзыва уровней в облаке по приложениям | Размер данных, отозванных приложением.<br><br>Единица измерения: Байты<br>Тип статистической обработки: Sum<br>Применимое измерение: имя приложения, имя сервера, имя группы синхронизации |
| Пропускная способность отзыва уровней в облаке | Размер пропускной способности отзыва данных.<br><br>Единица измерения: Байты<br>Тип статистической обработки: Sum<br>Применимое измерение: имя сервера, имя группы синхронизации |
| Несинхронизирующиеся файлы | Число файлов, которые не удалось синхронизировать.<br><br>Единица измерения: Count<br>Тип статистической обработки: Sum<br>Применимые измерения: имя конечной точки сервера, направление синхронизации, имя группы синхронизации |
| Синхронизировано файлов | Число переданных файлов (отправка и скачивание).<br><br>Единица измерения: Count<br>Тип статистической обработки: Sum<br>Применимые измерения: имя конечной точки сервера, направление синхронизации, имя группы синхронизации |
| Сетевой статус сервера | Число пульсов, полученных от сервера.<br><br>Единица измерения: Count<br>Тип агрегирования: Максимальная<br>Применимое измерение: имя сервера |
| Результат сеанса синхронизации | Результат сеанса синхронизации (1 — успешный сеанс синхронизации; 0 — сбой синхронизации).<br><br>Единица измерения: Count<br>Типы агрегатов: максимум<br>Применимые измерения: имя конечной точки сервера, направление синхронизации, имя группы синхронизации |

### <a name="alerts"></a>Предупреждения

Чтобы настроить оповещения в Azure Monitor, выберите службу синхронизации хранилища, а затем выберите [метрику синхронизация файлов Azure](https://docs.microsoft.com/azure/storage/files/storage-sync-files-monitoring#metrics) , которая будет использоваться для оповещения.  

В следующей таблице перечислены некоторые примеры сценариев для мониторинга и правильная метрика, используемая для оповещения.

| Сценарий | Метрика, используемая для оповещения |
|-|-|
| Работоспособность конечной точки сервера на портале = ошибка | Результат сеанса синхронизации |
| Не удается синхронизировать файлы с сервером или облачной конечной точкой | Несинхронизирующиеся файлы |
| Зарегистрированному серверу не удается связаться со службой синхронизации хранилища | Сетевой статус сервера |
| Размер отзыва при уровне облака превысил 500GiB в день  | Размер отзыва уровней в облаке |

Дополнительные сведения о настройке оповещений в Azure Monitor см. в разделе [Обзор оповещений в Microsoft Azure]( https://docs.microsoft.com/azure/azure-monitor/platform/alerts-overview).

## <a name="storage-sync-service"></a>Служба синхронизации хранилища

Чтобы просмотреть состояние зарегистрированного сервера, работоспособность конечной точки сервера и метрики, перейдите к службе синхронизации хранилища в портал Azure. Состояние зарегистрированного сервера можно просмотреть в колонке **Зарегистрированные серверы** и работоспособность конечной точки сервера в колонке **группы синхронизации** .

### <a name="registered-server-health"></a>Работоспособность зарегистрированного сервера

- Если **зарегистрированное состояние сервера** находится в режиме «в **сети**», сервер успешно взаимодействует со службой.
- Если состояние **зарегистрированного сервера** **отображается в автономном режиме**, убедитесь, что на сервере работает процесс монитора синхронизации хранилища (AzureStorageSyncMonitor.exe). Если сервер находится за брандмауэром или прокси-сервером, см. [статью](https://docs.microsoft.com/azure/storage/files/storage-sync-files-firewall-and-proxy) Настройка брандмауэра и прокси-сервера.

### <a name="server-endpoint-health"></a>Работоспособность конечной точки сервера

- Состояние работоспособности конечной точки сервера на портале основано на событиях синхронизации, регистрируемых в журнале событий телеметрии на сервере (с идентификатором 9102 и 9302). Если сеанс синхронизации завершается сбоем из-за временной ошибки, такой как ошибка, синхронизация может по-прежнему отображаться на портале при условии, что текущий сеанс синхронизации выполняется. Для определения того, применяются ли файлы, используется событие с ИДЕНТИФИКАТОРом 9302. Дополнительные сведения см. в статье о [синхронизации работоспособности](https://docs.microsoft.com/azure/storage/files/storage-sync-files-troubleshoot?tabs=server%2Cazure-portal#broken-sync) и [синхронизации](https://docs.microsoft.com/azure/storage/files/storage-sync-files-troubleshoot?tabs=server%2Cazure-portal#how-do-i-monitor-the-progress-of-a-current-sync-session).
- Если на портале отображается ошибка синхронизации, так как синхронизация не выполняется, см. инструкции в [документации по устранению неполадок](https://docs.microsoft.com/azure/storage/files/storage-sync-files-troubleshoot?tabs=portal1%2Cazure-portal#common-sync-errors) .

### <a name="metric-charts"></a>Диаграммы метрик

- Следующие диаграммы метрик доступны для просмотра на портале службы синхронизации хранилища:

  | Имя метрики | Описание: | Имя колонки |
  |-|-|-|
  | Синхронизировано байт | Размер переданных данных (отправка и скачивание) | Группа синхронизации, конечная точка сервера |
  | Отзыв уровней в облаке | размер отозванных данных; | Зарегистрированные серверы |
  | Несинхронизирующиеся файлы | Число файлов, которые не удалось синхронизировать | Конечная точка сервера |
  | Синхронизировано файлов | Число переданных файлов (отправка и скачивание) | Группа синхронизации, конечная точка сервера |
  | Сетевой статус сервера | Число пульсов, полученных от сервера | Зарегистрированные серверы |

- Дополнительные сведения см. в разделе [Azure Monitor](https://docs.microsoft.com/azure/storage/files/storage-sync-files-monitoring#azure-monitor).

  > [!Note]  
  > Диапазон времени для диаграммы на портале службы синхронизации хранилища составляет 24 часа. Чтобы просмотреть различные периоды времени или измерения, используйте Azure Monitor.

## <a name="windows-server"></a>Windows Server

В Windows Server можно просматривать распределение по уровням облака, зарегистрированному серверу и работоспособности синхронизации.

### <a name="event-logs"></a>Журналы событий

Используйте журнал событий телеметрии на сервере, чтобы отслеживать работоспособность зарегистрированного сервера, синхронизации и распределения по уровням в облаке. Журнал событий телеметрии находится в Просмотр событий в разделе *Applications and сервицес\микрософт\филесинк\ажент*.

Работоспособность синхронизации:

- Событие с ИДЕНТИФИКАТОРом 9102 регистрируется после завершения сеанса синхронизации. Это событие используется для определения успешности сеансов синхронизации (**HRESULT = 0**) и наличия ошибок синхронизации для каждого элемента. Дополнительные сведения см. в документации по [ошибкам](https://docs.microsoft.com/azure/storage/files/storage-sync-files-troubleshoot?tabs=server%2Cazure-portal#how-do-i-see-if-there-are-specific-files-or-folders-that-are-not-syncing) и [работоспособности синхронизации](https://docs.microsoft.com/azure/storage/files/storage-sync-files-troubleshoot?tabs=server%2Cazure-portal#broken-sync) и по элементам.

  > [!Note]  
  > Иногда сеансы синхронизации не завершаются или имеют ненулевой Перитемерроркаунт. Однако они по-прежнему выполняют накат, а некоторые файлы успешно синхронизируются. Это можно увидеть в примененных полях, таких как Апплиедфилекаунт, Апплиеддиркаунт, Апплиедтомбстонекаунт и Апплиедсизебитес. Эти поля показывают, сколько сеансов прошло успех. Если в строке отображается несколько сеансов синхронизации и в них увеличено количество примененных счетчиков, предоставьте время синхронизации, чтобы повторить попытку, прежде чем открыть запрос в службу поддержки.

- Идентификатор события 9302 регистрируется каждые 5–10 минут при активном сеансе синхронизации. Используйте это событие, чтобы определить, выполняется ли текущий сеанс синхронизации (**апплиедитемкаунт > 0**). Если синхронизация не выполняется, то сеанс синхронизации в конечном итоге завершится сбоем, а событие с ИДЕНТИФИКАТОРом 9102 будет зарегистрировано с ошибкой. Дополнительные сведения см. в [документации по ходу выполнения синхронизации](https://docs.microsoft.com/azure/storage/files/storage-sync-files-troubleshoot?tabs=server%2Cazure-portal#how-do-i-monitor-the-progress-of-a-current-sync-session).

Работоспособность зарегистрированного сервера:

- Если сервер отправляет службе запросы, связанные с выполнением заданий, идентификатор события 9301 регистрируется каждые 30 секунд. Если Жетнекстжоб завершается с **состоянием 0**, сервер может взаимодействовать со службой. Если Жетнекстжоб завершается с ошибкой, см. инструкции в [документации по устранению неполадок](https://docs.microsoft.com/azure/storage/files/storage-sync-files-troubleshoot?tabs=portal1%2Cazure-portal#common-sync-errors) .

Работоспособность уровня облака:

- Чтобы отслеживать действия по распределению по уровням на сервере, используйте события с ИДЕНТИФИКАТОРами 9003, 9016 и 9029 в журнале событий телеметрии, который находится в Просмотр событий в разделе *Applications and сервицес\микрософт\филесинк\ажент*.

  - Идентификатор события 9003 обеспечивает распределение ошибок для конечной точки сервера. Например: общее число ошибок и код ошибки. В журнал заносится одно событие для каждого кода ошибки.
  - Идентификатор события 9016 предоставляет результаты копий для тома. Например: процент свободного места —, число файлов, фантомных в сеансе, и количество файлов, которые не удалось выполнить фантом.
  - Идентификатор события 9029 предоставляет сведения о сеансе копирования для конечной точки сервера. Например: число попыток использования файлов в сеансе, число файлов, многоуровневых в сеансе, и количество файлов, которые уже были распределены по уровням.
  
- Чтобы отслеживать действия отзыва на сервере, используйте события с ИДЕНТИФИКАТОРами 9005, 9006, 9009 и 9059 в журнале событий телеметрии, который находится в Просмотр событий в разделе *Applications and сервицес\микрософт\филесинк\ажент*.

  - Идентификатор события 9005 обеспечивает надежность отзыва для конечной точки сервера. Например: общее число уникальных файлов, к которым осуществляется доступ, и общее число уникальных файлов с неудачным доступом.
  - Идентификатор события 9006 обеспечивает распределение ошибок отзыва для конечной точки сервера. Например: общее количество неудачных запросов и код ошибки. В журнал заносится одно событие для каждого кода ошибки.
  - Идентификатор события 9009 предоставляет сведения о сеансе отзыва для конечной точки сервера. Например: Дуратионсекондс, Каунтфилесрекаллсукцеедед и Каунтфилесрекаллфаилед.
  - Идентификатор события 9059 предоставляет сведения об отзыве приложения для конечной точки сервера. Например: Шареид, имя приложения и Тоталегресснетворкбитес.

### <a name="performance-counters"></a>Счетчики производительности

Воспользуйтесь счетчиками производительности Синхронизации файлов Azure на сервере для отслеживания действия синхронизации.

Чтобы просмотреть счетчики производительности Синхронизация файлов Azure на сервере, откройте системный монитор (Perfmon.exe). Счетчики можно найти в **передаваемых байтах AFS** и объектах **синхронизации AFS** .

В системном мониторе можно просмотреть следующие счетчики производительности Синхронизации файлов Azure:

| Объект \ Имя счетчика производительности | Описание: |
|-|-|
| AFS Bytes Transferred \ Downloaded Bytes/sec (Число переданных байт AFS \ Число байт, скачиваемых в секунду) | Число байт, скачиваемых в секунду. |
| AFS Bytes Transferred \ Uploaded Bytes/sec (Количество переданных байт AFS \ Число байт, отправляемых в секунду) | Число байт, отправляемых в секунду. |
| AFS Bytes Transferred \ Total Bytes/sec (Число переданных байт AFS \ Общее число байт в секунду) | Общее число байт в секунду (отправка и скачивание). |
| AFS Sync Operations \ Downloaded Sync Files/sec (Операции синхронизации AFS \ Число файлов, скачиваемых в секунду) | Число файлов, скачиваемых в секунду. |
| AFS Sync Operations \ Uploaded Sync Files/sec (Операции синхронизации AFS \ Число файлов, отправляемых в секунду) | Число файлов, отправляемых в секунду. |
| AFS Sync Operations \ Total Sync File Operations/sec (Операции синхронизации AFS \ Общее число операций синхронизации файлов в секунду) | Общее число синхронизируемых файлов (отправка и скачивание). |

## <a name="next-steps"></a>Дальнейшие шаги
- [Планирование развертывания службы синхронизации файлов Azure (предварительная версия)](storage-sync-files-planning.md)
- [Параметры брандмауэра и прокси-сервера Синхронизации файлов Azure](storage-sync-files-firewall-and-proxy.md)
- [Как развернуть службу синхронизации файлов Azure (предварительная версия)](storage-sync-files-deployment-guide.md)
- [Устранение неполадок службы "Синхронизация файлов Azure"](storage-sync-files-troubleshoot.md)
- [Часто задаваемые вопросы о службе "Файлы Azure"](storage-files-faq.md)
