---
title: Мониторинг Синхронизации файлов Azure | Документация Майкрософт
description: Узнайте, как выполнять мониторинг Синхронизации файлов Azure.
author: roygara
ms.service: storage
ms.topic: conceptual
ms.date: 06/28/2019
ms.author: rogarana
ms.subservice: files
ms.openlocfilehash: ac09f9b59bc6f47adc9311cc910352c1a0d73b5d
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "68699289"
---
# <a name="monitor-azure-file-sync"></a>Мониторинг службы "Синхронизация файлов Azure"

Используйте службу "Синхронизация файлов Azure", чтобы централизованно хранить файловые ресурсы организации в службе файлов Azure, обеспечивая гибкость, производительность и совместимость локального файлового сервера. Это достигается путем преобразования Windows Server в быстрый кэш общего файлового ресурса Azure. Для локального доступа к данным вы можете использовать любой протокол, доступный в Windows Server, в том числе SMB, NFS и FTPS. Кроме того, вы можете создать любое количество кэшей в любом регионе.

В этой статье описывается, как контролировать развертывание Azure File Sync с помощью Azure Monitor, службы синхронизации хранения данных и Windows Server.

В настоящее время доступны следующие варианты мониторинга.

## <a name="azure-monitor"></a>Azure Monitor

Используйте [Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/overview) для просмотра метрик и настройки оповещений для синхронизации, многоуровневого уровня облаков и подключения к серверу.  

### <a name="metrics"></a>Метрики

Метрики для Синхронизации файлов Azure включены по умолчанию и отправляются в Azure Monitor каждые 15 минут.

Чтобы просмотреть метрики azure File Sync в Azure Monitor, выберите тип ресурса **Службы синхронизации хранения.**

В Azure Monitor используются следующие метрики для Синхронизации файлов Azure:

| Имя метрики | Описание |
|-|-|
| Синхронизировано байт | Размер переданных данных (отправка и скачивание).<br><br>Единица измерения: байт<br>Тип агрегации: Сумма<br>Применимые размеры: Имя конечных точек сервера, Направление синхронизации, название группы синхронизации |
| Отзыв уровней в облаке | Размер отозванных данных.<br><br>**Примечание**: Эта метрика будет удалена в будущем. Используйте метрику размера отзыва уровня облака для мониторинга размера отозванных данных.<br><br>Единица измерения: байт<br>Тип агрегации: Сумма<br>Применимое измерение: Имя сервера |
| Размер облачного уровня отзыва | Размер отозванных данных.<br><br>Единица измерения: байт<br>Тип агрегации: Сумма<br>Применимое измерение: Имя сервера, название группы синхронизации |
| Размер облачного уровня отзыва по приложению | Размер данных, отозванных приложением.<br><br>Единица измерения: байт<br>Тип агрегации: Сумма<br>Применимое измерение: Имя приложения, имя сервера, название группы синхронизации |
| Пропускная пропускная часть облачного уровня отзыва | Размер пропускной вывехивания данных.<br><br>Единица измерения: байт<br>Тип агрегации: Сумма<br>Применимое измерение: Имя сервера, название группы синхронизации |
| Несинхронизирующиеся файлы | Число файлов, которые не удалось синхронизировать.<br><br>Единица измерения: число<br>Тип агрегации: Сумма<br>Применимые размеры: Имя конечных точек сервера, Направление синхронизации, название группы синхронизации |
| Синхронизировано файлов | Число переданных файлов (отправка и скачивание).<br><br>Единица измерения: число<br>Тип агрегации: Сумма<br>Применимые размеры: Имя конечных точек сервера, Направление синхронизации, название группы синхронизации |
| Сетевой статус сервера | Число пульсов, полученных от сервера.<br><br>Единица измерения: число<br>Тип агрегирования: максимальное значение.<br>Применимое измерение: Имя сервера |
| Результат сеанса синхронизации | Результат сеанса синхронизации (1 — успешный сеанс синхронизации; 0 — сбой синхронизации).<br><br>Единица измерения: число<br>Типы агрегирования: Максимальные<br>Применимые размеры: Имя конечных точек сервера, Направление синхронизации, название группы синхронизации |

### <a name="alerts"></a>видны узлы

Чтобы настроить оповещения в Azure Monitor, выберите службу синхронизации хранения, а затем выберите [метрику Azure File Sync](https://docs.microsoft.com/azure/storage/files/storage-sync-files-monitoring#metrics) для использования для оповещения.  

В следующей таблице перечислены некоторые примеры сценариев мониторинга и надлежащей метрики для использования для оповещения:

| Сценарий | Метрика для использования для оповещения |
|-|-|
| Здоровье конечных точек сервера на портале - Ошибка | Результат сеанса синхронизации |
| Файлы не синхронизируются с сервером или конечным пунктом облака | Несинхронизирующиеся файлы |
| Зарегистрированный сервер не может связаться с службой синхронизации хранилища | Сетевой статус сервера |
| Размер облачного уровня отзыва превысил 500 GiB в день  | Размер облачного уровня отзыва |

Чтобы узнать больше о настройке оповещений в Azure Monitor, [см.]( https://docs.microsoft.com/azure/azure-monitor/platform/alerts-overview)

## <a name="storage-sync-service"></a>Служба синхронизации хранилища

Для просмотра работоспособности зарегистрированного сервера, работоспособности конечных точек сервера и метрик и метрик— перейдите на службу синхронизации данных на портале Azure. Вы можете просматривать зарегистрированное состояние работоспособности сервера в лезвии **зарегистрированных серверов** и в конечном поле в группах **синхронизации.**

### <a name="registered-server-health"></a>Зарегистрированное состояние сервера

- Если состояние **зарегистрированного сервера** находится **в режиме онлайн,** сервер успешно общается с службой.
- Если **состояние зарегистрированного сервера** отображается в **автономном режиме,** убедитесь, что процесс синхронизации хранения данных (AzureStorageSyncMonitor.exe) работает. Если сервер находится за брандмауэром или прокси, см. [эту статью,](https://docs.microsoft.com/azure/storage/files/storage-sync-files-firewall-and-proxy) чтобы настроить брандмауэр и прокси.

### <a name="server-endpoint-health"></a>Здоровье конечных точек сервера

- Состояние работоспособности конечной точки сервера на портале основано на событиях синхронизации, регистрируемых в журнале событий телеметрии на сервере (с идентификатором 9102 и 9302). Если сеанс синхронизации завершается неудачей из-за переходной ошибки, такой как отмена ошибки, синхронизация может отображаться на портале неработоспособно до тех пор, пока выполняется текущая сессия синхронизации. Идентификатор события 9302 используется для определения того, применяются ли файлы. Для получения дополнительной информации [sync progress](https://docs.microsoft.com/azure/storage/files/storage-sync-files-troubleshoot?tabs=server%2Cazure-portal#how-do-i-monitor-the-progress-of-a-current-sync-session) [см.](https://docs.microsoft.com/azure/storage/files/storage-sync-files-troubleshoot?tabs=server%2Cazure-portal#broken-sync)
- Если на портале отображается ошибка синхронизации, поскольку синхронизация не выполняется, обратитесь в документацию по [устранению неполадок](https://docs.microsoft.com/azure/storage/files/storage-sync-files-troubleshoot?tabs=portal1%2Cazure-portal#common-sync-errors) для руководства.

### <a name="metric-charts"></a>Метрические диаграммы

- Следующие метрические диаграммы можно увидеть на портале службы синхронизации хранения:

  | Имя метрики | Описание | Имя лезвия |
  |-|-|-|
  | Синхронизировано байт | Размер переданных данных (отправка и скачивание) | Группа синхронизации, конечная точка сервера |
  | Отзыв уровней в облаке | размер отозванных данных; | Зарегистрированные серверы |
  | Несинхронизирующиеся файлы | Число файлов, которые не удалось синхронизировать | Конечная точка сервера |
  | Синхронизировано файлов | Число переданных файлов (отправка и скачивание) | Группа синхронизации, конечная точка сервера |
  | Сетевой статус сервера | Число пульсов, полученных от сервера | Зарегистрированные серверы |

- Чтобы узнать больше, смотрите [Azure Monitor](https://docs.microsoft.com/azure/storage/files/storage-sync-files-monitoring#azure-monitor).

  > [!Note]  
  > Диапазон времени для диаграммы на портале службы синхронизации хранилища составляет 24 часа. Чтобы просмотреть различные периоды времени или измерения, используйте Azure Monitor.

## <a name="windows-server"></a>Windows Server

На Сервере Windows можно просматривать многоуровневые уровни облаков, зарегистрированный сервер и синхронизацию работоспособности.

### <a name="event-logs"></a>Журналы событий

Используйте журнал событий телеметрии на сервере, чтобы отслеживать работоспособность зарегистрированного сервера, синхронизации и распределения по уровням в облаке. Данный журнал событий Телеметрия находится в Viewer событий под *приложениями и службами (Microsoft-FileSync)Agent*.

Работоспособность синхронизации:

- Id Event 9102 регистрируется после завершения сеанса синхронизации. Используйте это событие, чтобы определить, являются ли сеансы синхронизации успешными **(HResult 0)** и есть ли ошибки синхронизации по элементу. Для получения дополнительной информации ознакомьтесь с документацией по [ошибкам синхронизации](https://docs.microsoft.com/azure/storage/files/storage-sync-files-troubleshoot?tabs=server%2Cazure-portal#broken-sync) и [ошибок по по детали.](https://docs.microsoft.com/azure/storage/files/storage-sync-files-troubleshoot?tabs=server%2Cazure-portal#how-do-i-see-if-there-are-specific-files-or-folders-that-are-not-syncing)

  > [!Note]  
  > Иногда сеансы синхронизации выбывают в общем объеме или имеют ненулевой PerItemErrorCount. Тем не менее, они по-прежнему добиться прогресса, и некоторые файлы синхронизируются успешно. Вы можете увидеть это в прикладных областях, таких как AppliedFileCount, AppliedDirCount, AppliedTombstoneCount и AppliedSizeBytes. Эти поля говорят вам, сколько сессии удалось. Если несколько сеансов синхронизации сбой в строке, и они имеют увеличение Прикладного количества, дать синхронизации время, чтобы попробовать еще раз, прежде чем открыть билет поддержки.

- Идентификатор события 9302 регистрируется каждые 5–10 минут при активном сеансе синхронизации. Используйте это событие, чтобы определить, прогрессирует ли текущая сессия синхронизации **(AppliedItemCount > 0**). Если синхронизация не выполняется, сеанс синхронизации в конечном итоге должен выйти из строя, и событие ID 9102 будет зарегистрировано с ошибкой. Для получения дополнительной информации ознакомьтесь с [документацией о ходе синхронизации.](https://docs.microsoft.com/azure/storage/files/storage-sync-files-troubleshoot?tabs=server%2Cazure-portal#how-do-i-monitor-the-progress-of-a-current-sync-session)

Зарегистрированное состояние сервера:

- Если сервер отправляет службе запросы, связанные с выполнением заданий, идентификатор события 9301 регистрируется каждые 30 секунд. Если GetNextJob завершает сяпой **со статусом 0,** сервер может общаться с службой. Если GetNextJob завершает ошибку, проверьте документацию по [устранению неполадок](https://docs.microsoft.com/azure/storage/files/storage-sync-files-troubleshoot?tabs=portal1%2Cazure-portal#common-sync-errors) для руководства.

Здоровье облачного уровня:

- Для мониторинга многоуровневой активности на сервере используйте Event ID 9003, 9016 и 9029 в журнале событий Telemetry, который находится в журнале Событий под *приложениями и службами ..*

  - Идентификатор события 9003 обеспечивает распределение ошибок для конечной точки сервера. Например: Общее количество ошибок и код ошибки. Одно событие регистрируется в коде ошибки.
  - Идентификатор события 9016 предоставляет результаты копий для тома. Например: Свободное пространство процентов, Количество файлов призрак в сеансе, и количество файлов не удалось призрак.
  - Идентификатор события 9029 предоставляет сведения о сеансе копирования для конечной точки сервера. Например: количество файлов, попытанных в сеансе, количество файлов, многоуровневых в сеансе, и количество файлов, уже многоуровневых.
  
- Для мониторинга активности отзыва на сервере используйте Event ID 9005, 9006, 9009 и 9059 в журнале событий Telemetry, который находится в журнале событий Event Viewer под *приложениями и службами (Microsoft-FileSync.)*

  - Идентификатор события 9005 обеспечивает надежность отзыва для конечной точки сервера. Например: Доступ к уникальным файлам и уникальные файлы Total с неудавшимся доступом.
  - Идентификатор события 9006 обеспечивает распределение ошибок отзыва для конечной точки сервера. Например: Всего невыполненных запросов и Ошибка Кода. Одно событие регистрируется в коде ошибки.
  - Идентификатор события 9009 предоставляет сведения о сеансе отзыва для конечной точки сервера. Например: DurationSeconds, CountFilesRecallSucceeded и CountFilesRecallFailed.
  - Идентификатор события 9059 предоставляет сведения об отзыве приложения для конечной точки сервера. Например: ShareId, название приложения и TotalEgressNetworkBytes.

### <a name="performance-counters"></a>Счетчики производительности

Воспользуйтесь счетчиками производительности Синхронизации файлов Azure на сервере для отслеживания действия синхронизации.

Для просмотра счетчиков производительности Azure File Sync на сервере откройте монитор производительности (Perfmon.exe). Вы можете найти счетчики под **AFS Байтс Перенесенные** и **AFS Sync операций** объектов.

В системном мониторе можно просмотреть следующие счетчики производительности Синхронизации файлов Azure:

| Объект \ Имя счетчика производительности | Описание |
|-|-|
| AFS Bytes Transferred \ Downloaded Bytes/sec (Число переданных байт AFS \ Число байт, скачиваемых в секунду) | Число байт, скачиваемых в секунду. |
| AFS Bytes Transferred \ Uploaded Bytes/sec (Количество переданных байт AFS \ Число байт, отправляемых в секунду) | Число байт, отправляемых в секунду. |
| AFS Bytes Transferred \ Total Bytes/sec (Число переданных байт AFS \ Общее число байт в секунду) | Общее число байт в секунду (отправка и скачивание). |
| AFS Sync Operations \ Downloaded Sync Files/sec (Операции синхронизации AFS \ Число файлов, скачиваемых в секунду) | Число файлов, скачиваемых в секунду. |
| AFS Sync Operations \ Uploaded Sync Files/sec (Операции синхронизации AFS \ Число файлов, отправляемых в секунду) | Число файлов, отправляемых в секунду. |
| AFS Sync Operations \ Total Sync File Operations/sec (Операции синхронизации AFS \ Общее число операций синхронизации файлов в секунду) | Общее число синхронизируемых файлов (отправка и скачивание). |

## <a name="next-steps"></a>Дальнейшие действия
- [Планирование развертывания синхронизации файлов Azure](storage-sync-files-planning.md)
- [Параметры брандмауэра и прокси-сервера Синхронизации файлов Azure](storage-sync-files-firewall-and-proxy.md)
- [Развертывание Синхронизации файлов Azure](storage-sync-files-deployment-guide.md)
- [Устранение неполадок службы "Синхронизация файлов Azure"](storage-sync-files-troubleshoot.md)
- [Часто задаваемые вопросы о службе "Файлы Azure"](storage-files-faq.md)
