---
title: StorSimple 1200 миграция в Azure File Sync
description: Узнайте, как перенести виртуальный прибор серии StorSimple 1200 в синхронизацию файлов Azure.
author: fauhse
ms.service: storage
ms.topic: conceptual
ms.date: 03/09/2020
ms.author: fauhse
ms.subservice: files
ms.openlocfilehash: 69225da1506ced879363b10b098d939df93cbfba
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79502376"
---
# <a name="storsimple-1200-migration-to-azure-file-sync"></a>StorSimple 1200 миграция в Azure File Sync

Серия StorSimple 1200 представляет собой виртуальный прибор, который работает в центре обработки данных. Можно перенести данные из этого прибора в среду синхронизации файлов Azure. Azure File Sync — это служба по умолчанию и стратегическое долгосрочное обслуживание Azure, в которую можно перенести устройства StorSimple.

Серия StorSimple 1200 достигнет [своего конца жизни](https://support.microsoft.com/en-us/lifecycle/search?alpha=StorSimple%201200%20Series) в декабре 2022 года.  Важно как можно скорее приступить к планированию миграции. В этой статье представлены необходимые справочные знания и шаги миграции для успешной миграции в Azure File Sync. 

## <a name="azure-file-sync"></a>Служба синхронизации файлов Azure

> [!IMPORTANT]
> Корпорация Майкрософт обязуется помогать клиентам в их миграции. Email AzureFilesMigration@microsoft .com для индивидуального плана миграции, а также помощь во время миграции.

Azure File Sync — это облачный сервис Майкрософт, основанный на двух основных компонентах:

* Синхронизация файлов и многоуровневое обработка.
* Файлы как нативная хранилище в Azure, к которым можно получить доступ по нескольким протоколам, таким как SMB и файл REST. Доля файлов Azure сопоставима с долей файлов на сервере Windows, которую можно смонтировать в качестве сетевого диска. Он поддерживает важные аспекты точности файлов, такие как атрибуты, разрешения и метки времени. В отличие от StorSimple, для интерпретации файлов и папок, хранящихся в облаке, не требуется никаких приложений/услуг. Идеальный и наиболее гибкий подход к хранению данных файловых серверов общего назначения, а также некоторых данных приложения в облаке.

В этой статье основное внимание уделяется шагам миграции. Если перед миграцией вы хотите узнать больше о Azure File Sync, мы рекомендуем следующие статьи:

* [Синхронизация файлов Azure - обзор](https://aka.ms/AFS "Обзор")
* [Синхронизация файлов Azure - руководство по развертыванию](storage-sync-files-deployment-guide.md)

## <a name="migration-goals"></a>Цели миграции

Цель состоит в том, чтобы гарантировать целостность производственных данных, а также гарантировать доступность. Последнее требует сохранения времени простоя до минимума, так что он может вписаться в или лишь незначительно превысить обычные окна обслуживания.

## <a name="storsimple-1200-migration-path-to-azure-file-sync"></a>StorSimple 1200 путь миграции к синхронизации файлов Azure

Для запуска агента Azure File Sync требуется локальный Windows Server. Сервер Windows может быть как минимум 2012R2 сервера, но в идеале это Windows Server 2019.

Существует множество альтернативных путей миграции, и это создаст слишком длинную статью, чтобы задокументировать все из них и проиллюстрировать, почему они несут риск или недостатки по сравнению с маршрутом, который мы рекомендуем в качестве наилучшей практики в этой статье.

:::image type="content" source="media/storage-files-migration-storsimple-shared/storsimple-1200-migration-overview.png" alt-text="Обзор маршрутов миграции о шагах ниже в этой статье.":::

На предыдущем изображении изображены шаги, соответствующие разделам в этой статье.

### <a name="step-1-provision-your-on-premises-windows-server-and-storage"></a>Шаг 1: Предоставление вашего внутреннего Windows Server и хранения

1. Создайте Windows Server 2019 - как минимум 2012R2 - в качестве виртуальной машины или физического сервера. Кластер сбоя Windows Server также поддерживается.
2. Предоставление или добавление прямого прикрепленного хранилища (DAS по сравнению с NAS, которое не поддерживается). Размер хранилища Windows Server должен быть равен или больше, чем размер доступной емкости вашего виртуального устройства StorSimple 1200.

### <a name="step-2-configure-your-windows-server-storage"></a>Шаг 2: Настройка хранилища Сервера Windows

На этом этапе вы отображаете структуру хранения данных StorSimple (объемы и акции) в структуру хранения данных Windows Server.
Если вы планируете внести изменения в структуру хранилища, то есть количество томов, связь папок данных с объемами или структуру subfolder выше или ниже текущих акций SMB/NFS, то сейчас самое время принять эти изменения во внимание.
Изменение структуры файла и папки после настройки синхронизации файлов Azure является громоздким и следует избегать.
Эта статья предполагает, что вы отображаете 1:1, поэтому вы должны принять во внимание изменения отображения при следовании за шагами в этой статье.

* Ни одна из производственных данных не должна находиться в объеме системы Windows Server. Облачные многоуровневые прояснения не поддерживаются в объемах системы. Тем не менее, эта функция необходима для миграции, а также непрерывных операций в качестве замены StorSimple.
* Предоставить такое же количество томов на вашем сервере Windows, как и на вашем виртуальном приборе StorSimple 1200.
* Настройте любые необходимые роли, функции и настройки Windows Server. Мы рекомендуем вам использовать обновления Windows Server, чтобы сохранить вашу ОС в безопасности и актуальности. Аналогичным образом, мы рекомендуем включить обновление Майкрософт, чтобы не допустить обновления приложений Майкрософт, включая агент Azure File Sync.
* Не настраивайте папки или акции перед чтением следующих шагов.

### <a name="step-3-deploy-the-first-azure-file-sync-cloud-resource"></a>Шаг 3: Развертывание первого облачного ресурса Azure File Sync

[!INCLUDE [storage-files-migration-deploy-afs-sss](../../../includes/storage-files-migration-deploy-azure-file-sync-storage-sync-service.md)]

### <a name="step-4-match-your-local-volume-and-folder-structure-to-azure-file-sync-and-azure-file-share-resources"></a>Шаг 4: Сопоставить локальную структуру объема и папок к ресурсам совместного обмена файлов Azure и Azure

[!INCLUDE [storage-files-migration-namespace-mapping](../../../includes/storage-files-migration-namespace-mapping.md)]

### <a name="step-5-provision-azure-file-shares"></a>Шаг 5: Акции файлов provision Azure

[!INCLUDE [storage-files-migration-provision-azfs](../../../includes/storage-files-migration-provision-azure-file-share.md)]

### <a name="step-6-configure-windows-server-target-folders"></a>Шаг 6: Настройка целевых папок Windows Server

В предыдущих шагах вы рассмотрели все аспекты, которые определят компоненты синхронизации топологий. Настало время подготовить сервер для получения файлов для загрузки.

Создайте **все** папки, которые будут синхронизировать каждую с его собственным файлом Azure.
Важно следовать структуре папок, которую вы задокументировали ранее. Например, вы решили синхронизировать несколько локальных долей SMB вместе в единую общую часть файлов Azure, то вам нужно поместить их под общую корневую папку на томе. Создайте эту папку корня цели на томе сейчас.

Количество подготовленных вами файлов Azure должно соответствовать количеству папок, созданных на этом этапе, и количеству томов, которые вы синхронизируете на корневом уровне.

### <a name="step-7-deploy-the-azure-file-sync-agent"></a>Шаг 7: Развертывание агента синхронизации файлов Azure

[!INCLUDE [storage-files-migration-deploy-afs-agent](../../../includes/storage-files-migration-deploy-azure-file-sync-agent.md)]

### <a name="step-8-configure-sync"></a>Шаг 8: Настройка синхронизации

[!INCLUDE [storage-files-migration-configure-sync](../../../includes/storage-files-migration-configure-sync.md)]

> [!WARNING]
> **Обязательно включите многоуровневое облако!** Это необходимо, если на локальном сервере не хватает места для хранения общего размера данных в облачном хранилище StorSimple. Временно установите политику многоуровневого уровня для миграции до 99% свободного пространства.

Повторите шаги создания группы синхронизации и добавления соответствующей папки сервера в качестве конечной точки сервера для всех файлов Azure/ местоположений серверов, которые должны быть настроены для синхронизации.

### <a name="step-9-copy-your-files"></a>Шаг 9: Копирование файлов

Основным подходом к миграции является RoboCopy с виртуального устройства StorSimple на сервер Windows Server и Azure File Sync для файлов Azure.

Запустите первую локальную копию в папку с целевым сервером Windows Server:

* Определите первое местоположение на вашем виртуальном приборе StorSimple.
* Определите соответствующую папку на сервере Windows, на ней уже настроена синхронизация файлов Azure.
* Запуск копии с помощью RoboCopy

Следующая команда RoboCopy отзовет файлы из хранилища StorSimple Azure в локальное хранилище StorSimple, а затем передаст их в папку с целью Windows Server. Сервер Windows будет синхронизировать его с разделом файлов Azure(ы). По мере того, как локальный объем Windows Server будет заполнен, многоуровневые облачные серверы будут использоваться и использовать уже успешно синхронизированные файлы. Облачные многоуровневые будет генерировать достаточно места, чтобы продолжить копию из виртуального устройства StorSimple. Облачные многоуровневые проверки один раз в час, чтобы увидеть, что синхронизировалось и освободить дисковое пространство для достижения 99% объема свободного пространства.

```console
Robocopy /MT:32 /UNILOG:<file name> /TEE /B /MIR /COPYALL /DCOPY:DAT <SourcePath> <Dest.Path>
```

Фон:

:::row:::
   :::column span="1":::
      /MT
   :::column-end:::
   :::column span="1":::
      Позволяет RoboCopy работать многопоните. По умолчанию 8, макс 128.
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /ВЕДОМОСТИ:<file name>
   :::column-end:::
   :::column span="1":::
      Состояние выводов в файл LOG как UNICODE (перезаписывает существующий журнал).
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /TEE
   :::column-end:::
   :::column span="1":::
      Выходы на консоль окна. Используется в сочетании с выводом в файл журнала.
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /B
   :::column-end:::
   :::column span="1":::
      Запускает RoboCopy в том же режиме, что и резервное приложение. Это позволяет RoboCopy перемещать файлы, на которые у текущего пользователя нет разрешений.
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /МИР
   :::column-end:::
   :::column span="1":::
      Позволяет запустить эту команду RoboCopy несколько раз, последовательно на той же цели / назначения. Он определяет то, что было скопировано ранее, и опускает его. Будут обработаны только изменения, дополнения и *"удаления",* которые произошли с момента последнего запуска. Если команда не была запущена раньше, ничего не опущено. Это отличный вариант для исходных мест, которые по-прежнему активно используются и меняются.
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /COPY:copyflag's
   :::column-end:::
   :::column span="1":::
      верность копии файла (по умолчанию /COPY:DAT), флаги копирования: D'Data, Атрибуты, T'Timestamps, S'Security-NTFS ACLs, Информация о владельце, информация о U'aUditing
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /КОПИАЛ
   :::column-end:::
   :::column span="1":::
      COPY ALL файл информация (эквивалент /COPY:DATSOU)
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /DCOPY:copyflag
   :::column-end:::
   :::column span="1":::
      верность копии каталогов (по умолчанию /DCOPY:DA), флаги копирования: D'Data, A'Attributes, T'Timestamps
   :::column-end:::
:::row-end:::

При первом запуске команды RoboCopy пользователи и приложения по-прежнему получают доступ к файлам и папкам StorSimple и потенциально меняют ее. Вполне возможно, что RoboCopy обработал каталог, переходит к следующему, а затем пользователь на месте источника (StorSimple) добавляет, изменяет или удаляет файл, который теперь не будет обработан в этом текущем запуске RoboCopy. Это нормально.

Первый запуск заключается в перемещении основной части данных обратно в помещение, на windows Server и резервное копирование в облако через Azure File Sync. Это может занять много времени, в зависимости от:

* пропускная способность загрузки
* скорость отзыва облачного сервиса StorSimple
* пропускная способность загрузки
* количество элементов (файлов и папок), которые должны быть обработаны любой службой

После завершения первоначального запуска выполнить команду снова.

Во второй раз он закончит быстрее, потому что ему нужно только транспортировать изменения, которые произошли с момента последнего запуска. Эти изменения, вероятно, локальные для StorSimple уже, потому что они являются недавними. Это еще больше сокращает время, поскольку потребность в отзыве из облака уменьшается. Во время этого второго запуска, по-прежнему, новые изменения могут накапливаться.

Повторяйте этот процесс до тех пор, пока вы не убедитесь, что время, необходимое для завершения, является приемлемым временем простоя.

Если вы считаете время простоя приемлемым, и вы готовы принять расположение StorSimple в автономном режиме, а затем сделать это сейчас: Например, удалить долю SMB так, что пользователь не может получить доступ к папке или принять любой другой соответствующий шаг, который предотвращает содержание изменить в этом папка на StorSimple.

Выполнить один последний раунд RoboCopy. Это позволит забрать любые изменения, которые, возможно, были пропущены.
Как долго этот последний шаг принимает, зависит от скорости сканирования RoboCopy. Вы можете оценить время (что равно вашему времени простоя) путем измерения продолжительности предыдущего запуска.

Создайте общую часть в папке Windows Server и, возможно, отрегулируйте развертывание DFS-N, чтобы указать на нее. Обязательно установите те же разрешения на уровне общего участия, что и на вашей акции StorSimple SMB.

Вы закончили миграцию акции / группы акций в общий корень или объем. (В зависимости от того, что вы нанесли на карту и решили, что необходимо ввести тот же общий файл Azure.)

Вы можете попробовать запустить несколько из этих копий параллельно. Рекомендуем обрабатывать область действия одной совместной части файла Azure одновременно.

> [!WARNING]
> После того как вы перевели все данные из вас StorSimple на Windows Server, и ваша миграция завершена: Возвращение ***ко всем*** группам синхронизации в портале Azure и настроить значение свободного пространства, многоуровневого облачного, чтобы изменить значение свободного пространства для чего-то лучше подходит для использования кэша, скажем, 20%. 

Политика многоуровневого объема облачных вычислений действует на уровне громкости с потенциально несколькими конечными точками сервера, синхронизированными с ним. Если вы забудете настроить свободное пространство даже на одном сервере, синхронизация будет продолжать применять наиболее ограничительное правило и пытаться сохранить 99% свободного дискового пространства, что делает локальный кэш не работает, как вы могли бы ожидать. Если только ваша цель состоит в томе, чтобы иметь пространство имен для тома, который содержит только редко доступные архивные данные.

## <a name="troubleshoot"></a>Устранение неполадок

Наиболее вероятной проблемой, с накоторпомощью может столкнуться, является то, что команда RoboCopy выходит из строя с *"Объемом полного"* на стороне Windows Server. Если это так, то скорость загрузки, скорее всего, лучше, чем скорость загрузки. Облачные многоуровневые действия один раз в час для эвакуации содержимого с локального диска Windows Server, который синхронизирован.

Позволяет синхронизировать прогресс и многоуровневое облако освободить дисковое пространство. Вы можете заметить, что в файл explorer на вашем Сервере Windows.

Когда ваш Windows Server имеет достаточную доступную емкость, повторное запуск команды решит проблему. Ничто не ломается, когда вы попадаете в эту ситуацию, и вы можете двигаться вперед с уверенностью. Неудобство выполнения команды снова является единственным следствием.

Вы также можете столкнуться с другими проблемами синхронизации файлов Azure.
Как бы маловероятно это ни было, если это произойдет, взгляните на **руководство по устранению неполадок LINK Azure File Sync.**

## <a name="relevant-links"></a>Соответствующие ссылки

Содержимое миграции:

* [StorSimple 8000 серии миграции руководство](storage-files-migration-storsimple-8000.md)

Содержимое синхронизации файлов Azure:

* [Обзор AFS](https://aka.ms/AFS)
* [Руководство по развертыванию AFS](storage-files-deployment-guide.md)
* [Устранение неполадок AFS](storage-sync-files-troubleshoot.md)
