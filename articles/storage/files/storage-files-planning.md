---
title: Планирование развертывания службы файлов Azure | Документы Майкрософт
description: Узнайте, что необходимо учесть при планировании развертывания службы "Файлы Azure".
author: roygara
ms.service: storage
ms.topic: conceptual
ms.date: 1/3/2020
ms.author: rogarana
ms.subservice: files
ms.openlocfilehash: d5bf3a6df9d7292c18a93737fb7dea5d8c91f984
ms.sourcegitcommit: 31ef5e4d21aa889756fa72b857ca173db727f2c3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81536505"
---
# <a name="planning-for-an-azure-files-deployment"></a>Планирование развертывания службы файлов Azure
[Файлы Azure](storage-files-introduction.md) могут быть развернуты двумя основными способами: путем прямого монтажа бессерверных файлов Azure или путем кэширования акций файлов Azure на месте с помощью Azure File Sync. Какой вариант развертывания вы выберете, изменяет то, что необходимо учитывать при планировании развертывания. 

- **Прямое крепление доли файлов Azure:** Поскольку Azure Files предоставляет доступ к SMB, вы можете смонтировать акции файлов Azure на местах или в облаке, используя стандартный клиент SMB, доступный в Windows, macOS и Linux. Поскольку доли файлов Azure не серверны, развертывание для производственных сценариев не требует управления файловым сервером или NAS-устройством. Это означает, что вам не придется применять программные патчи или менять физические диски. 

- **Доля файлов Cache Azure в предварительном**доступе с Azure File Sync: Azure File Sync позволяет централизовать файлы организации в файлах Azure Files, сохраняя при этом гибкость, производительность и совместимость сервера файлов. Azure File Sync преобразует предприимчивый (или облачный) Windows Server в быстрый кэш общего файла Azure. 

В этой статье в первую очередь рассматриваются соображения развертывания совместного файла Azure, который будет непосредственно установлен на месте или в облаке клиента. Чтобы спланировать развертывание azure File Sync, см. [Планирование развертывания Azure File Sync.](storage-sync-files-planning.md)

## <a name="management-concepts"></a>Основные принципы управления
[!INCLUDE [storage-files-file-share-management-concepts](../../../includes/storage-files-file-share-management-concepts.md)]

При развертывании акций файлов Azure в учетные записи хранения мы рекомендуем:

- Развертывание файлов Azure в учетные записи хранилища с другими файлами Azure. Хотя учетные записи хранения GPv2 позволяют иметь смешанные учетные записи хранения, поскольку ресурсы хранения, такие как файлы Azure и контейнеры с каплями, разделяют пределы учетной записи хранилища, смешивание ресурсов может затруднить устранение неполадок в дальнейшем. 

- Обращая внимание на ограничения IOPS учетной записи хранилища при развертывании файлов Azure. В идеале можно сопоставить акции файлов 1:1 со счетами хранения, однако это не всегда возможно из-за различных ограничений и ограничений, как со стороны вашей организации, так и от Azure. Когда невозможно развернуть только одну копию файла в одном хранилище, подумайте, какие акции будут очень активны, а какие — менее активны, чтобы гарантировать, что самые горячие файлы не будут помещены в один и тот же счет хранения вместе.

- Развертывайте учетные записи GPv2 и FileStorage и обновляйте учетные записи GPv1 и классические учетные записи хранения данных, когда находите их в своей среде. 

## <a name="identity"></a>Идентификация
Чтобы получить доступ к доле файла Azure, пользователь файла должен быть проверен и иметь разрешение на доступ к этой акции. Это делается на основе идентификации пользователя, доступ к файлу общего доступа. Azure Files интегрируется с тремя основными поставщиками идентификационных данных:
- **Службы домена Active Directory Domain Services (AD DS, или предварительное просмотр):** учетные записи хранения данных Azure могут быть соединены с сервером Active Directory Domain Services, как и файловой сервер Windows Server или NAS-устройство. Можно развернуть контроллер домена на месте, в VM Azure или даже в качестве VM в другом поставщике облачных технологий; Лазурные файлы агностик, где ваш контроллер домена размещается. После того, как учетная запись хранилища будет соединена с доменом, конечный пользователь может смонтировать общую часть файлов с учетной записью пользователя, с которой он подписался на свой компьютер. Аутентификация на основе АД использует протокол проверки подлинности Kerberos.
- **Службы активных доменов Azure Active Directory (Azure AD DS)**: Azure AD DS предоставляет контроллер домена, управляемый корпорацией Майкрософт, который можно использовать для ресурсов Azure. Домен, присоединяющийся к учетной записи хранилища в Azure AD DS, предоставляет аналогичные преимущества домену, присоединению к нему в принадлежащий клиенту Active Directory. Этот вариант развертывания наиболее полезен для сценариев подъема и смены приложений, требующих разрешений на основе АД. Поскольку Azure AD DS обеспечивает аутентификацию на основе АД, эта опция также использует протокол проверки подлинности Kerberos.
- **Ключ учетной записи хранилища Azure:** акции файлов Azure также могут быть установлены с ключом учетной записи хранилища Azure. Чтобы смонтировать общий доступ файла таким образом, имя учетной записи хранилища используется в качестве имени пользователя, а ключ учетной записи хранилища — в качестве пароля. Использование ключа учетной записи хранилища для установки доли файла Azure фактически является операцией администратора, так как установленная доля файлов будет иметь полные разрешения на все файлы и папки на доле, даже если у них есть ACL. При использовании ключа учетной записи хранилища для установки на SMB используется протокол проверки подлинности NTLMv2.

Для клиентов, мигрирующих с предприимчивых файловых серверов, или создающих новые файлы в Azure Files, предназначенные для работы в таких как файловые серверы Windows или устройства NAS, домен, присоединяющийся к вашей учетной записи хранения данных, **является** рекомендуемой опцией. Чтобы узнать больше о присоединении учетной записи хранилища к принадлежащему клиенту Active Directory, смотрите [обзор Active Directory Azure Files.](storage-files-active-directory-overview.md)

Если вы собираетесь использовать ключ учетной записи хранилища для доступа к файлам Azure, мы рекомендуем использовать конечные точки службы, описанные в разделе [Сеть.](#networking)

## <a name="networking"></a>Сеть
Доли файлов Azure доступны из любой точки доступа через общедоступную точку хранения. Это означает, что аутентифицированные запросы, такие как запросы, авторизованные на иноеудостоверения пользователя, могут возникать надежно из Azure или за его пределами. Во многих средах клиента начальное изображение доли файла Azure на рабочей станции в ней не будет завершено, даже если крепления с Azure VMs увенчаются успехом. Причина этого заключается в том, что многие организации и интернет-провайдеры (провайдеры) блокируют порт, который SMB использует для связи, порт 445. Чтобы просмотреть сведения о поставщиках услуг Интернета, поддерживающих (или не поддерживающих) подключение через порт 445, перейдите на сайт [TechNet](https://social.technet.microsoft.com/wiki/contents/articles/32346.azure-summary-of-isps-that-allow-disallow-access-from-port-445.aspx).

Чтобы разблокировать доступ к файлу Azure, у вас есть два основных варианта:

- Разблокировать порт 445 для сети вашей организации. Акции файлов Azure могут быть доступны только через публичную конечную точку, используя интернет-протоколы, такие как SMB 3.0 и FileREST API. Это самый простой способ получить доступ к вашей совместной части файла Azure из предварительного помещения, так как он не требует расширенной конфигурации сетей, кроме изменения правил исходящего порта организации, однако, мы рекомендуем вам удалить устаревшие и устаревшие версии протокола SMB, а именно SMB 1.0. Чтобы узнать, как это сделать, смотрите [Обеспечение Windows / Windows Server](storage-how-to-use-files-windows.md#securing-windowswindows-server) и [безопасности Linux](storage-how-to-use-files-linux.md#securing-linux).

- Доступ к файлам Azure через соединение ExpressRoute или VPN. При доступе к разделу файла Azure через сетевой туннель можно смонтировать свою долю файлов Azure как локонную долю файлов, так как трафик SMB не пересекает вашу организационную границу.   

Хотя с технической точки зрения значительно проще монтировать ваши файлы Azure через публичную конечную точку, мы ожидаем, что большинство клиентов предпочтут монтировать свои файлы Azure через соединение ExpressRoute или VPN. Для этого необходимо настроить следующую среду:  

- **Сетевой туннель с помощью ExpressRoute, Site-to-Site или Point-to-Site VPN:** Tunneling into a virtual network позволяет получить доступ к файловым долям Azure из закрытых помещений, даже если порт 445 заблокирован.
- **Частные конечные точки**: Частные конечные точки дают вашей учетной записи хранения выделенный IP-адрес из адресного пространства виртуальной сети. Это позволяет осуществлять туннельы сети без необходимости открывать открытые сети до всех диапазонов IP-адресов, принадлежащих кластерам хранения Azure. 
- **Перекачка DNS:** Нанастройка локального DNS для решения проблемы `storageaccount.file.core.windows.net` учетной записи хранилища (т.е. для общедоступных областей облачных технологий) для решения ip-адреса ваших частных конечных точек.

Для планирования сетей, связанных с развертыванием [Azure Files networking considerations](storage-files-networking-overview.md)совместного файла Azure, см.

## <a name="encryption"></a>Шифрование
Azure Files поддерживает два различных типа шифрования: шифрование в пути, которое относится к шифрованию, используемому при монтаже/доступе к доле файла Azure, и шифрованию в состоянии покоя, которое относится к тому, как данные шифруются при хранении на диске. 

### <a name="encryption-in-transit"></a>Шифрование при передаче
По умолчанию для всех учетных записей хранения Azure включено шифрование при передаче. Это означает, что при подключении общей папки по протоколу SMB или доступе к ней по протоколу FileREST (например, с помощью портала Azure, PowerShell, CLI или пакетов SDK Azure) служба "Файлы Azure" разрешит подключение, только если оно установлено по протоколу SMB версии 3.0 или более поздней с шифрованием или по HTTPS. Клиенты, не поддерживающие SMB 3.0, или клиенты, поддерживающие SMB 3.0, но без шифрования SMB, не смогут подключать общую папку Azure, если включено шифрование при передаче. Дополнительные сведения о том, какие операционные системы поддерживают SMB 3.0 с шифрованием, см. в подробной документации по [Windows](storage-how-to-use-files-windows.md), [macOS](storage-how-to-use-files-mac.md) и [Linux](storage-how-to-use-files-linux.md). Все текущие версии PowerShell, CLI и пакетов SDK поддерживают протокол HTTPS.  

В учетной записи хранения Azure шифрование при передаче можно отключить. Когда шифрование отключено, Azure Files также позволит SMB 2.1, SMB 3.0 без шифрования, и незашифрованные FileREST API звонки через HTTP. Основная причина отключения шифрования при передаче заключается в поддержке устаревшего приложения, которое должно выполняться в более старой версии операционной системы, например Windows Server 2008 R2 или более старой версии Linux. Служба "Файлы Azure" разрешает только подключения по протоколу SMB 2.1 в том же регионе Azure, что и общая папка Azure. Клиент SMB 2.1 за пределами региона Azure общей папки Azure, например в локальной среде или в другом регионе Azure, не сможет получить доступ к общей папке.

Мы настоятельно рекомендуем обеспечить шифрование данных в пути включен.

Дополнительные сведения о шифровании при передаче см. в статье [Require secure transfer in Azure Storage](../common/storage-require-secure-transfer.md?toc=%2fazure%2fstorage%2ffiles%2ftoc.json) (Требование безопасной передачи в службе хранилища Azure).

### <a name="encryption-at-rest"></a>Шифрование при хранении
[!INCLUDE [storage-files-encryption-at-rest](../../../includes/storage-files-encryption-at-rest.md)]

## <a name="storage-tiers"></a>Уровни хранилища
[!INCLUDE [storage-files-tiers-overview](../../../includes/storage-files-tiers-overview.md)]

Как правило, функции Azure Files и совместимость с другими службами одинаковы между премиум-файлами и стандартными файлами, однако есть несколько важных отличий:
- **Модель выставления счетов**
    - Премиум-файлы выставляются с помощью подготовленной модели выставления счетов, что означает, что вы платите за то, сколько хранения вы предоставляете, а не сколько хранения вы на самом деле просите. 
    - Стандартные файлы выставляются с помощью модели с оплатой по мере использования, которая включает базовую стоимость хранения того, сколько хранилища вы на самом деле потребляете, а затем дополнительные транзакционные затраты в зависимости от того, как вы используете долю. С помощью стандартных файлов ваш счет увеличится, если вы будете использовать (читать/писать/монтировать) файл Azure будет делиться больше.
- **Варианты избыточности**
    - Премиум-файлы доступны только для локально избыточного (LRS) и зоны избыточного (ЗРС) хранения. 
    - Стандартные файлы доступны для локально избыточного, излишнее зоны, геоизмового (GRS) и геозоны избыточного (G'S) хранения.
- **Максимальный размер доли файла**
    - Премиум-файлы могут быть подготовлены для до 100 TiB без каких-либо дополнительных работ.
    - По умолчанию стандартные файловые акции могут охватывать только до 5 TiB, хотя лимит доли может быть увеличен до 100 TiB, выбрав в большой флаг функции хранения *файла.* Стандартные файлы могут охватывать до 100 TiB для локально избыточных или зонных избыточных учетных записей хранения. Для получения дополнительной информации об увеличении размеров файловых долей [см.](https://docs.microsoft.com/azure/storage/files/storage-files-how-to-create-large-file-share)
- **Доступность по регионам**
    - Премиум-файлы доступны не во всех регионах, а избыточную поддержку зоны доступна в меньшем подмножестве регионов. Чтобы узнать, доступны ли в настоящее время в вашем регионе акции премиум-файлов, ознакомьтесь с [продуктами, доступными по](https://azure.microsoft.com/global-infrastructure/services/?products=storage) странице Azure по регионам. Чтобы узнать, какие регионы [Azure Availability Zone support by region](../../availability-zones/az-overview.md#services-support-by-region)поддерживают ЗРС, см. Чтобы помочь нам определить приоритеты новых регионов и функций премиум-уровня, пожалуйста, заполните этот [опрос.](https://aka.ms/pfsfeedback)
    - Стандартные файлы доступны в каждом регионе Azure.
- Служба Azure Kubernetes (AKS) поддерживает премиум-файлы в версии 1.13 и позже.

После того, как доля файлов создается как премиум или стандартная доля файлов, вы не можете автоматически преобразовать ее в другой уровень. Если вы хотите переключиться на другой уровень, необходимо создать новую долю файлов в этом уровне и вручную скопировать данные из исходной доли на новую созданную акцию. Мы рекомендуем `robocopy` использовать `rsync` для Windows или для macOS и Linux для выполнения этой копии.

### <a name="understanding-provisioning-for-premium-file-shares"></a>Понимание подготовки к премиум-файловых акций
Файловые ресурсы уровня "Премиум" предоставляются на основе зафиксированной пропорции ГиБ/операции ввода-вывода в секунду/пропускная способность. Для каждого подготовленного ГиБ ресурс будет выдаваться на одну пропускную способность операций ввода-вывода в секунду и 0,1 МиБ/с пропускной способности в условиях максимальной нагрузки на ресурс. Минимально допустимый уровень подготовки составляет 100 ГиБ с минимальным числом операций ввода-вывода в секунду и пропускной способностью.

Наилучшим возможным образом все ресурсы могут ограничиваться до трех операций ввода-вывода в секунду на ГиБ подготовленного хранилища в течение 60 минут или дольше в зависимости от размера ресурса. Новые ресурсы начинаются с полного пакетного кредита на основе подготовленной мощности.

Акции должны быть подготовлены с шагом 1 GiB. Минимальный размер 100 GiB, следующий размер 101 GiB и так далее.

> [!TIP]
> Базовый IOPS No 1 - приготовительский GiB. (До максимума 100 000 IOPS).
>
> Лимит взрыва No 3 - Базовый IOPS. (До максимума 100 000 IOPS).
>
> коэффициент на выход из гексса 60 МБ/с 0,06 евро
>
> скорость входа в 40 МБ/с 0,04 евро

Размер доли, предусмотренного, определяется квотой акций. Квота акций может быть увеличена в любое время, но может быть уменьшена только через 24 часа с момента последнего повышения. Прождав 24 часа без увеличения квоты, вы можете уменьшить квоту акций столько раз, сколько захотите, пока не увеличьте ее снова. Изменения шкалы IOPS/Throughput будут эффективны в течение нескольких минут после изменения размера.

Можно уменьшить размер вашей подготовленной доли ниже используемого GiB. Если вы сделаете это, вы не потеряете данные, но, вы все равно будете выставлен счет за размер, используемый и получить производительность (базовый IOPS, пропускная способность, и взрыв IOPS) из подготовленной доли, а не размер используется.

В следующей таблице приведены несколько примеров этих формул для подготовленных размеров акций:

|Емкость (GiB) | Базовые показатели операций ввода-вывода в секунду | Взрыв IOPS | Выход (MiB/s) | Вход (MiB/s) |
|---------|---------|---------|---------|---------|
|100         | 100     | 300     | 66   | 44   |
|500         | 500     | До 1500   | 90   | 60   |
|1024       | 1024   | До 3072   | 122   | 81   |
|5,120       | 5,120   | До 15 360  | 368   | 245   |
|10,240      | 10,240  | До 30 720  | 675 | 450   |
|33,792      | 33,792  | До 100 000 | 2,088 | 1,392   |
|51,200      | 51,200  | До 100 000 | 3132 | 2,088   |
|102,400     | 100 000 | До 100 000 | 6,204 | 4,136   |

> [!NOTE]
> Производительность акций файлов зависит от ограничений сети машин, доступной пропускной способности сети, размеров иотогового вне зависимости от них, параллелизма, среди многих других факторов. Например, на основе внутреннего тестирования с 8 KiB читать / писать IO размеров, одна виртуальная машина Windows, *Стандартный F16s_v2*, подключен к премиум доля файлов над SMB может достичь 20K читать IOPS и 15K написать IOPS. С 512 MiB читать / писать IO размеров, тот же VM может достичь 1,1 GiB / с выходом и 370 MiB / s вход нойели. Для достижения максимальной шкалы производительности распределите нагрузку по нескольким ВМ. Пожалуйста, обратитесь [к руководству по устранению неполадок](storage-troubleshooting-files-performance.md) для некоторых общих проблем с производительностью и обходных пути.

#### <a name="bursting"></a>Разрыва
Премиум-файлы могут лопнуть их IOPS до в три раз. Bursting автоматизирован и работает на основе кредитной системы. Bursting работает на основе лучших усилий и всплеск предел не является гарантией, файл акций может лопнуть *до* предела.

Кредиты накапливаются в ведре, когда трафик для вашей доли файла ниже базового IOPS. Например, доля 100 GiB имеет 100 базовых IOPS. Если фактический трафик на акцию составлял 40 IOPS для определенного 1-секундного интервала, то 60 неиспользованных IOPS зачисляются на ведро с разрывом. Эти кредиты будут использоваться позже, когда операции превысят базовые IOP.

> [!TIP]
> Размер ведра с разрывом - базовый IOPS - 2 и 3600.

Всякий раз, когда доля превышает базовый IOPS и имеет кредиты в ведро взрыва, он лопнет. Акции могут продолжать лопнуть до тех пор, пока остаются кредиты, хотя акции меньше 50 TiB останутся на пределе всплеска только на пределе всплеска до часа. Акции, превышающей 50 TiB, технически могут превышать этот один часовой лимит, до двух часов, но это зависит от количества начисленных кредитов. Каждый IO за пределами базового IOPS потребляет один кредит, и как только все кредиты потребляются доля вернется к базовой IOPS.

Доля кредитов есть три государства:

- Начисление, когда доля файла использует меньше, чем базовый IOPS.
- Снижение, когда доля файла разрывается.
- Оставаясь постоянным, когда нет либо кредитов, либо базовых IOPS используются.

Новые файлы акций начинаются с полного числа кредитов в его ведро всплеск. Заявки на взрывные кредиты не будут начисляться, если доля IOPS упадет ниже базового IOPS из-за регулирования сервером.

### <a name="enable-standard-file-shares-to-span-up-to-100-tib"></a>Включить стандартные файлы до 100 TiB
[!INCLUDE [storage-files-tiers-enable-large-shares](../../../includes/storage-files-tiers-enable-large-shares.md)]

#### <a name="limitations"></a>Ограничения
[!INCLUDE [storage-files-tiers-large-file-share-availability](../../../includes/storage-files-tiers-large-file-share-availability.md)]

## <a name="redundancy"></a>Избыточность
[!INCLUDE [storage-files-redundancy-overview](../../../includes/storage-files-redundancy-overview.md)]

## <a name="migration"></a>Миграция
Во многих случаях вы не будете создавать новую сеть файлов для организации, а вместо этого будете мигрировать с существующей доли файлов с файлового сервера или NAS-устройства в Azure Files. Есть много инструментов, предоставляемых как Microsoft, так и третьей стороной, чтобы сделать миграцию в файл, но они могут быть примерно разделены на две категории:

- **Инструменты, которые поддерживают атрибуты файловой системы, такие как ACLs и метки времени:**
    - **[Синхронизация файлов Azure:](storage-sync-files-planning.md)** Azure File Sync может использоваться в качестве метода поимки данных в общий доступ к файлу Azure, даже если желаемое конечное развертывание не для поддержания присутствия в помещениях. Синхронизация файлов Azure может быть установлена на существующих развертываниях Windows Server 2012 R2, Windows Server 2016 и Windows Server 2019. Преимущество использования Azure File Sync в качестве механизма глотания заключается в том, что конечные пользователи могут продолжать использовать существующую долю файлов; сокращение доли файла Azure может произойти после завершения загрузки всех данных в фоновом режиме.
    - **[Robocopy](https://technet.microsoft.com/library/cc733145.aspx)**: Robocopy является известным инструментом копирования, который поставляется с Windows и Windows Server. Robocopy можно применять для передачи данных в службу файлов Azure путем локального подключения файлового ресурса и последующего использования подключенного расположения в качестве назначения в команде Robocopy.

- **Инструменты, которые не поддерживают атрибуты файловой системы:**
    - **Data Box**: Data Box предоставляет автономный механизм передачи данных физическим данным в Azure. Этот метод предназначен для увеличения пропускной способности и сохранения пропускной способности, но в настоящее время не поддерживает атрибуты файловой системы, такие как метки времени и ACL.
    - **[AzCopy](../common/storage-use-azcopy-v10.md?toc=%2fazure%2fstorage%2ffiles%2ftoc.json)** — это служебная программа командной строки. Она предназначена для копирования данных из службы файлов Azure, хранилища BLOB-объектов Azure и обратно с помощью простых команд, обеспечивающих оптимальную производительность.

## <a name="next-steps"></a>Следующие шаги
* [Планирование развертывания синхронизации файлов Azure](storage-sync-files-planning.md)
* [How to deploy Azure Files](storage-files-deployment-guide.md) (Развертывание службы "Файлы Azure")
* [Развертывание службы синхронизации файлов Azure (предварительная версия)](storage-sync-files-deployment-guide.md)
