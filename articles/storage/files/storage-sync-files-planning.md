---
title: Планирование развертывания службы "Синхронизация файлов Azure" | Документация Майкрософт
description: Узнайте, что необходимо учесть при планировании развертывания службы "Файлы Azure".
author: roygara
ms.service: storage
ms.topic: conceptual
ms.date: 01/15/2020
ms.author: rogarana
ms.subservice: files
ms.openlocfilehash: 0684f626553946619a0db2cd895df39576bd17b9
ms.sourcegitcommit: 509b39e73b5cbf670c8d231b4af1e6cfafa82e5a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2020
ms.locfileid: "78362418"
---
# <a name="planning-for-an-azure-file-sync-deployment"></a>Планирование развертывания службы синхронизации файлов Azure
Служба [файлов Azure](storage-files-introduction.md) может быть развернута двумя основными способами: путем прямого подключения файловых ресурсов Azure без сервера или путем кэширования файловых ресурсов Azure локально с помощью синхронизация файлов Azure. Выбор варианта развертывания изменяет те вещи, которые необходимо учитывать при планировании развертывания. 

- **Прямое подключение к файловому ресурсу Azure**. так как служба файлов Azure предоставляет доступ к SMB, вы можете подключать файловые ресурсы Azure локально или в облаке с помощью стандартного клиента SMB, доступного в Windows, MacOS и Linux. Так как файловые ресурсы Azure являются бессерверными, развертывание для рабочих сценариев не требует управления файловым сервером или устройством NAS. Это означает, что вам не нужно применять исправления программного обеспечения или подключать физические диски. 

- **Кэширование файлового ресурса Azure локально с помощью синхронизация файлов Azure**: Синхронизация файлов Azure позволяет централизовать общие файловые ресурсы Организации в службе файлов Azure, сохраняя гибкость, производительность и совместимость локального файлового сервера. Синхронизация файлов Azure преобразует локальный (или облачный) сервер Windows Server в быстрый кэш файлового ресурса Azure. 

В этой статье в первую очередь рассматриваются вопросы развертывания для развертывания Синхронизация файлов Azure. Сведения о планировании развертывания файловых ресурсов Azure для непосредственного подключения к локальному или облачному клиенту см. в статье [Планирование развертывания службы файлов Azure](storage-files-planning.md).

## <a name="management-concepts"></a>Основные принципы управления
Развертывание Синхронизация файлов Azure имеет три фундаментальных управляющих объекта:

- **Файловый ресурс Azure**. файловый ресурс Azure — это общесерверный облачный файловый ресурс, предоставляющий *облачную конечную точку* отношения синхронизации синхронизация файлов Azure. Доступ к файлам в общей папке Azure можно получить напрямую по протоколу SMB или Филерест, хотя мы рекомендуем в основном обращаться к файлам через кэш Windows Server, когда файловый ресурс Azure используется с Синхронизация файлов Azure. Это связано с тем, что на сегодняшний день в службе "файлы Azure" отсутствует эффективный механизм обнаружения изменений, например Windows Server, поэтому изменения в общем файловом ресурсе Azure будут распространяться обратно на конечные точки сервера.
- **Конечная точка сервера**: путь на сервере Windows, который синхронизируется с общим файловым ресурсом Azure. Это может быть конкретная папка на томе или в корне тома. В том же томе могут находиться несколько конечных точек сервера, если их пространства имен не пересекаются.
- **Группа синхронизации**: объект, определяющий отношение синхронизации между **облачной конечной точкой**, общей папкой Azure и конечной точкой сервера. Конечные точки в группе синхронизации синхронизируются. Например, если у вас есть два отдельных набора файлов, которыми необходимо управлять с помощью Синхронизация файлов Azure, создайте две группы синхронизации и добавьте разные конечные точки в каждую группу синхронизации.

### <a name="azure-file-share-management-concepts"></a>Основные понятия управления общей папкой Azure
[!INCLUDE [storage-files-file-share-management-concepts](../../../includes/storage-files-file-share-management-concepts.md)]

### <a name="azure-file-sync-management-concepts"></a>Основные понятия управления Синхронизация файлов Azure
Группы синхронизации развертываются в **службах синхронизации хранилища**, которые являются объектами верхнего уровня, которые регистрируют серверы для использования с Синхронизация файлов Azure и содержат связи группы синхронизации. Ресурс службы синхронизации хранилища является одноранговым в отношении ресурса учетной записи хранения, поэтому его можно развернуть в группах ресурсов Azure. Служба синхронизации хранилища может создавать группы синхронизации, содержащие файловые ресурсы Azure в нескольких учетных записях хранения и нескольких зарегистрированных серверах Windows.

Прежде чем можно будет создать группу синхронизации в службе синхронизации хранилища, необходимо сначала зарегистрировать Windows Server в службе синхронизации хранилища. При этом будет создан объект **зарегистрированного сервера** , который представляет отношение доверия между сервером или кластером и службой синхронизации хранилища. Чтобы зарегистрировать службу синхронизации хранилища, необходимо сначала установить агент Синхронизация файлов Azure на сервере. Отдельный сервер или кластер могут быть зарегистрированы одновременно только с одной службой синхронизации хранилища.

Группа синхронизации содержит одну облачную конечную точку, общую папку Azure и хотя бы одну конечную точку сервера. Объект конечной точки сервера содержит параметры, которые настраивают возможности распределения по **уровням облака** , обеспечивающие возможность кэширования синхронизация файлов Azure. Для синхронизации с общим файловым ресурсом Azure учетная запись хранения, содержащая файловый ресурс Azure, должна находиться в том же регионе Azure, что и служба синхронизации хранилища.

### <a name="management-guidance"></a>Руководство по управлению
При развертывании Синхронизация файлов Azure рекомендуется:

- Развертывание файловых ресурсов Azure 1:1 с помощью файловых ресурсов Windows. Объект конечной точки сервера обеспечивает высокую степень гибкости настройки топологии синхронизации на стороне сервера отношения синхронизации. Чтобы упростить управление, необходимо, чтобы путь к конечной точке сервера совпадал с путем к общей папке Windows. 

- Используйте как можно меньше служб синхронизации хранилища. Это упростит управление при наличии групп синхронизации, содержащих несколько конечных точек сервера, так как Windows Server может быть зарегистрирована только в одной службе синхронизации хранилища за раз. 

- Обратите внимание на ограничения операций ввода-вывода в учетной записи хранения при развертывании файловых ресурсов Azure. В идеале следует сопоставлять файловые ресурсы 1:1 с учетными записями хранения, однако это может быть не всегда возможно благодаря различным ограничениям и ограничениям как в Организации, так и в Azure. Если невозможно развернуть только одну общую папку в одной учетной записи хранения, определите, какие общие ресурсы будут высоко активными и какие общие папки будут менее активными, чтобы не допустить одновременного размещения файловых ресурсов активные в одной и той же учетной записи хранения.

## <a name="windows-file-server-considerations"></a>Рекомендации по файловым серверам Windows
Чтобы включить функцию синхронизации в Windows Server, необходимо установить загружаемый Синхронизация файлов Azure агент. Агент Синхронизация файлов Azure предоставляет два основных компонента: `FileSyncSvc.exe`, фоновую службу Windows, которая отвечает за наблюдение за изменениями в конечных точках сервера и инициирует сеансы синхронизации, а также `StorageSync.sys`, фильтр файловой системы, который включает распределение по уровням облака и быстрое аварийное восстановление.  

### <a name="operating-system-requirements"></a>Требования к операционной системе
Синхронизация файлов Azure поддерживается в следующих версиях Windows Server:

| Версия | Поддерживаемые номера SKU | Поддерживаемые варианты развертывания |
|---------|----------------|------------------------------|
| Windows Server 2019 | Datacenter, Standard и IoT | Полная и базовая |
| Windows Server 2016 | Datacenter, Standard и Storage Server | Полная и базовая |
| Windows Server 2012 R2 | Datacenter, Standard и Storage Server | Полная и базовая |

Новые версии Windows Server будут добавляться по мере их выпуска.

> [!Important]  
> Мы рекомендуем постоянно обновлять серверы, используемые со службой синхронизации файлов Azure, с помощью последних обновлений из Центра обновления Windows. 

### <a name="minimum-system-resources"></a>Минимальные системные ресурсы
Для Синхронизация файлов Azure требуется сервер, физический или виртуальный, по крайней мере один ЦП и минимум 2 гиб памяти.

> [!Important]  
> Если сервер работает на виртуальной машине с включенной динамической памятью, для виртуальной машины необходимо настроить не менее 2048 MiB памяти.

Для большинства рабочих нагрузок не рекомендуется настраивать сервер Синхронизация файлов Azure Sync с минимальными требованиями. Дополнительные сведения см. в разделе [Рекомендуемые системные ресурсы](#recommended-system-resources) .

### <a name="recommended-system-resources"></a>Рекомендуемые системные ресурсы
Как и любой серверный компонент или приложение, требования к системным ресурсам для Синхронизация файлов Azure определяются масштабом развертывания. для более крупных развертываний на сервере требуются большие системные ресурсы. Для Синхронизация файлов Azure масштаб определяется количеством объектов в конечных точках сервера и обновлением набора данных. Один сервер может иметь конечные точки сервера в нескольких группах синхронизации и количество объектов, перечисленных в следующих учетных записях, для полного пространства имен, к которому подключен сервер. 

Например, конечная точка сервера A с 10 000 000 объектами + Server Endpoint B с 10 000 000 объектами = 20 000 000 Objects. Для этого примера развертывания мы рекомендуем 8 ЦП, 16 гиб памяти для стабильного состояния и (если возможно) 48 гиб памяти для первоначальной миграции.
 
Данные пространства имен хранятся в памяти в целях повышения производительности. Из-за этого большие пространства имен требуют больше памяти для поддержания хорошей производительности, а для большего количества обновлений требуется больше ресурсов ЦП. 
 
В следующей таблице мы предоставили как размер пространства имен, так и преобразование в емкость для типичных общих файловых ресурсов общего назначения, где средний размер файла — 512 КИБ. Если размер файлов меньше, рекомендуется добавить дополнительную память для того же объема емкости. Настройка конфигурации памяти на основе размера пространства имен.

| Размер пространства имен — файлы & каталоги (миллионы)  | Типичная емкость (тиб)  | Ядра ЦП  | Рекомендуемая память (гиб) |
|---------|---------|---------|---------|
| 3        | 1.4     | 2        | 8 (начальная синхронизация)/2 (типичное обновление)      |
| 5        | 2.3     | 2        | 16 (начальная синхронизация)/4 (типичное обновление)    |
| 10       | 4,7     | 4        | 32 (начальная синхронизация)/8 (типичное обновление)   |
| 30       | 14,0    | 8        | 48 (начальная синхронизация)/16 (типичное обновление)   |
| 50       | 23,3    | 16       | 64 (начальная синхронизация)/32 (типичное обновление)  |
| 100*     | 46,6    | 32       | 128 (начальная синхронизация)/32 (типичное обновление)  |

\*в настоящее время не рекомендуется выполнять синхронизацию более 100 000 000 файлов & каталогов. Это мягкое ограничение, основанное на наших проверенных пороговых значениях. Дополнительные сведения см. в статье [целевые показатели масштабируемости и производительности службы файлов Azure](storage-files-scale-targets.md#azure-file-sync-scale-targets).

> [!TIP]
> Начальная синхронизация пространства имен является трудоемкой операцией, поэтому рекомендуется выделить больше памяти до завершения начальной синхронизации. Это не обязательно, но может ускорить начальную синхронизацию. 
> 
> Обычное обновление составляет 0,5% от изменения пространства имен в день. Для более высоких уровней обновления рассмотрите возможность добавления ЦП. 

- Локально подключенный том, отформатированный с помощью файловой системы NTFS.

### <a name="evaluation-cmdlet"></a>Командлет оценки
Перед развертыванием Синхронизация файлов Azure следует оценить, совместим ли он с системой, с помощью командлета оценки Синхронизация файлов Azure. Этот командлет проверяет наличие потенциальных проблем с файловой системой и набором данных, например неподдерживаемыми символами или неподдерживаемой версией операционной системы. Его проверки охватывают большинство, но не все перечисленные ниже функции. Мы рекомендуем внимательно ознакомиться с остальной частью этого раздела, чтобы убедиться, что развертывание выполняется беспрепятственно. 

Командлет Evaluation можно установить, установив модуль AZ PowerShell, который можно установить, выполнив приведенные здесь инструкции. [установите и настройте Azure PowerShell](https://docs.microsoft.com/powershell/azure/install-Az-ps).

#### <a name="usage"></a>Использование  
Средство оценки можно вызывать несколькими способами: можно выполнять системные проверки, проверки набора данных или и то, и другое. Выполнение проверки системы и набора данных: 

```powershell
Invoke-AzStorageSyncCompatibilityCheck -Path <path>
```

Проверка только набора данных:
```powershell
Invoke-AzStorageSyncCompatibilityCheck -Path <path> -SkipSystemChecks
```
 
Проверка только системных требований:
```powershell
Invoke-AzStorageSyncCompatibilityCheck -ComputerName <computer name>
```
 
Отображение результатов в CSV-файле:
```powershell
$errors = Invoke-AzStorageSyncCompatibilityCheck […]
$errors | Select-Object -Property Type, Path, Level, Description | Export-Csv -Path <csv path>
```

### <a name="file-system-compatibility"></a>Совместимость файловых систем
Синхронизация файлов Azure поддерживается только для непосредственно подключенных томов NTFS. Непосредственно подключенное хранилище (DAS) в Windows Server означает, что эта файловая система принадлежит операционной системе Windows Server. DAS можно предоставить с помощью физического подключения дисков к файловому серверу, присоединив виртуальные диски к виртуальной машине файлового сервера (например, к виртуальной машине, размещенной на Hyper-V) или даже через ISCSI.

Поддерживаются только тома NTFS; ReFS, FAT, FAT32 и другие файловые системы не поддерживаются.

В следующей таблице показано состояние взаимодействия функций файловой системы NTFS. 

| Компонент | Состояние поддержки | Примечания |
|---------|----------------|-------|
| Списки управления доступом (ACL) | Поддерживается полностью | Списки управления доступом в стиле Windows сохраняются с помощью Синхронизация файлов Azure и принудительно применяются Windows Server на конечных точках сервера. Списки управления доступом также можно применять при непосредственном подключении файлового ресурса Azure, однако для этого требуется дополнительная настройка. Дополнительные сведения см. в [разделе удостоверение](#identity) . |
| Жесткие связи. | Пропущено | |
| Символические связи | Пропущено | |
| Точки подключения | Поддерживается частично | Точки подключения могут располагаться в корне конечной точки сервера, но они пропускаются, если содержатся в пространстве имен конечной точки сервера. |
| Соединения | Пропущено | Например, папки DfrsrPrivate и DFSRoots распределенной файловой системы. |
| Точки повторного анализа | Пропущено | |
| Сжатие NTFS | Поддерживается полностью | |
| Разреженные файлы | Поддерживается полностью | Разреженные файлы синхронизируются (не блокируются) в облако в качестве полного файла. При изменении содержимого файла в облаке (или на другом сервере) он перестанет быть разреженным, когда скачана измененная версия. |
| Альтернативные потоки данных (ADS) | Сохраняются, но не синхронизируются | Например, теги классификации, созданные инфраструктурой классификации файлов, не синхронизируются. Имеющиеся теги классификации для файлов в каждой из конечных точек сервера использоваться не будут. |

<a id="files-skipped"></a>Синхронизация файлов Azure также будет пропускать некоторые временные файлы и системные папки:

| Файл или папка | Примечание. |
|-|-|
| pagefile.sys | Системный файл |
| Desktop.ini | Системный файл |
| thumbs.db; | Временный файл для эскизов |
| ehthumbs.db; | Временный файл для эскизов мультимедиа |
| ~$\*.\*; | Временный файл Office |
| \*.tmp; | Временный файл |
| \*.laccdb; | Файл блокировки базы данных Access|
| 635D02A9D91C401B97884B82B3BCDAEA.* | Внутренний файл синхронизации|
| \\System Volume Information | Папка для тома |
| $RECYCLE.BIN| Папка |
| \\SyncShareState | Папка для синхронизации |

### <a name="failover-clustering"></a>Отказоустойчивая кластеризация
Служба синхронизации файлов Azure поддерживает отказоустойчивую кластеризацию Windows Server для варианта развертывания "Файловый сервер общего использования". Отказоустойчивая кластеризация не поддерживается в вариантах "Масштабируемый файловый сервер для данных приложения" (SOFS) или в общих томах кластеров (CSV).

> [!Note]  
> Агент службы синхронизации файлов Azure должен быть установлен на каждом узле отказоустойчивого кластера для правильной работы синхронизации.

### <a name="data-deduplication"></a>Дедупликация данных
**Windows server 2016 и Windows server 2019**   
Дедупликация данных поддерживается в томах с включенным распределением по уровням в облаке в Windows Server 2016 и Windows Server 2019. Включение дедупликации данных на томе с включенным распределением по уровням облака позволяет кэшировать больше файлов в локальной среде без подготовки к большему объему хранилища. 

Если дедупликация данных включена на томе с включенным распределением по уровням облака, оптимизированные файлы дедупликации в расположении конечной точки сервера будут распределены по аналогии с обычным файлом на основе параметров политики уровня облака. После того как оптимизированные для дедупликации файлы были распределены по уровням, задание сбора мусора для дедупликации данных автоматически запустится, чтобы освободить место на диске, удалив ненужные блоки, на которые больше не ссылаются другие файлы в томе.

Обратите внимание, что экономия громкости применяется только к серверу; данные в файловом ресурсе Azure не будут отменяться.

> [!Note]  
> Для поддержки дедупликации данных на томах с включенным распределением по уровням облака в Windows Server 2019 необходимо установить Windows Update [KB4520062](https://support.microsoft.com/help/4520062) , а синхронизация файлов Azure Agent 9.0.0.0 или более поздней версии.

**Windows Server 2012 R2**  
Синхронизация файлов Azure не поддерживает дедупликацию данных и распределение по уровням облака на одном томе в Windows Server 2012 R2. Если дедупликация данных включена на томе, необходимо отключить распределение по уровням облака. 

**Примечания**
- Если дедупликация данных установлена до установки агента Синхронизация файлов Azure, для поддержки дедупликации данных и распределения по уровням облака на том же томе требуется перезагрузка.
- Если дедупликация данных включена на томе после включения распределения по уровням облака, начальное задание оптимизации дедупликации оптимизирует файлы на томе, который еще не является многоуровневым, и будет иметь следующее влияние на распределение по уровням облака:
    - Политика свободного места будет по-прежнему распределять файлы по уровням в соответствии с объемом свободного пространства на томе с помощью тепловой карты.
    - Политика "Дата" пропускает распределение по уровням файлов, которые могли бы быть не подходящими для многоуровневого распределения из-за того, что задание оптимизации дедупликации получает доступ к файлам.
- Для текущих заданий оптимизации дедупликации распределение по уровням облака с политикой дат будет отложено параметром [минимумфилеажедайс](https://docs.microsoft.com/powershell/module/deduplication/set-dedupvolume?view=win10-ps) дедупликации данных, если этот файл еще не является многоуровневый. 
    - Пример. Если значение параметра Минимумфилеажедайс составляет семь дней, а политика даты облачного распределения — 30 дней, политика дат будет распределять файлы по прошествии 37 дней.
    - Примечание. когда файл передается по уровням Синхронизация файлов Azure, задание оптимизации дедупликации пропустит этот файл.
- Если сервер под Windows Server 2012 R2 с установленным агентом Синхронизация файлов Azure обновляется до Windows Server 2016 или Windows Server 2019, для поддержки дедупликации данных и распределения по уровням облака на одном томе необходимо выполнить следующие действия.  
    - Удалите агент Синхронизация файлов Azure для Windows Server 2012 R2 и перезапустите сервер.
    - Скачайте агент Синхронизация файлов Azure для новой версии операционной системы сервера (Windows Server 2016 или Windows Server 2019).
    - Установите агент Синхронизация файлов Azure и перезапустите сервер.  
    
    Примечание. параметры конфигурации Синхронизация файлов Azure на сервере сохраняются при удалении и повторной установке агента.

### <a name="distributed-file-system-dfs"></a>Распределенная файловая система (DFS)
Служба "Синхронизация файлов Azure" поддерживает взаимодействие с пространствами имен DFS (DFS-N) и репликацией DFS (DFS-R).

**Пространства имен DFS (DFS-N).** Служба "Синхронизация файлов Azure" полностью поддерживается для серверов DFS-N. Вы можете установить агент службы "Синхронизация файлов Azure" на один или несколько членов DFS-N, чтобы синхронизировать данные между конечными точками сервера и облачными конечными точками. Дополнительные сведения см. в статье [Обзор пространств имен DFS](https://docs.microsoft.com/windows-server/storage/dfs-namespaces/dfs-overview).
 
**Репликация DFS (DFS-r)** . Поскольку DFS-r и синхронизация файлов Azure являются решениями репликации, в большинстве случаев рекомендуется заменить DFS-r на Синхронизация файлов Azure. Существует несколько сценариев, в которых вы хотите использовать DFS-R и Синхронизация файлов Azure вместе:

- Если выполняется миграция с развернутой службы DFS-R в развернутую службу "Синхронизация файлов Azure". Дополнительные сведения см. в статье [Развертывание службы синхронизации файлов Azure (предварительная версия)](storage-sync-files-deployment-guide.md#migrate-a-dfs-replication-dfs-r-deployment-to-azure-file-sync).
- Не каждый локальный сервер, которому требуется копия данных файла, может быть подключен непосредственно к Интернету.
- Если серверы подразделений консолидируют данные на одном сервере-концентраторе, для которого вы намерены использовать службу "Синхронизация файлов Azure".

Для параллельной работы Синхронизация файлов Azure и DFS-R:

1. В службе "Синхронизация файлов Azure" нужно отключить распределение по уровням облака для томов, на которых есть реплицируемые DFS-R папки.
2. Не следует настраивать конечные точки сервера для папок репликации DFS-R с доступом только для чтения.

Дополнительные сведения см. в статье [Обзор пространств имен DFS и репликации DFS](https://technet.microsoft.com/library/jj127250).

### <a name="sysprep"></a>Средство Sysprep
Использование Sysprep на сервере с установленным агентом Синхронизация файлов Azure не поддерживается и может привести к непредвиденным результатам. Устанавливать агент и регистрировать сервер нужно после развертывания образа сервера и завершения мини-установки sysprep.

### <a name="windows-search"></a>Поиск Windows
Если на конечной точке сервера включено распределение по уровням облака, распределяемые по уровням файлы пропускаются и не индексируются службой Windows Search. Файлы, не распределяемые по уровням, индексируются должным образом.

### <a name="other-hierarchical-storage-management-hsm-solutions"></a>Другие решения по управлению иерархическим хранением (HSM)
Другие решения HSM не нужно использовать со службой синхронизации файлов Azure.

## <a name="identity"></a>Тождество
Синхронизация файлов Azure работает со стандартным удостоверением на основе AD без специальной настройки, помимо настройки синхронизации. При использовании Синхронизация файлов Azure общий ожидание заключается в том, что большинство обращений проходят через серверы кэширования Синхронизация файлов Azure, а не через файловый ресурс Azure. Так как конечные точки сервера находятся в Windows Server, а Windows Server поддерживает списки ACL в стиле AD и Windows в течение очень долгого времени, не требуется никаких действий, кроме обеспечения того, что файловые серверы Windows, зарегистрированные в службе синхронизации хранилища, присоединены к домену. Синхронизация файлов Azure сохранит списки управления доступом для файлов в общем файловом ресурсе Azure и будет реплицировать их во все конечные точки сервера.

Несмотря на то, что изменения, внесенные непосредственно в файловый ресурс Azure, синхронизируются с конечными точками сервера в группе синхронизации. также может потребоваться обеспечить возможность принудительного применения разрешений AD в общей папке непосредственно в облаке. Для этого необходимо присоединить учетную запись хранения к локальной службе AD, точно так же, как файловые серверы Windows присоединены к домену. Дополнительные сведения о домене присоединения учетной записи хранения к Active Directory, принадлежащему клиенту, см. в статье [Общие сведения о службе файлов Azure Active Directory](storage-files-active-directory-overview.md).

> [!Important]  
> Домен, присоединяемый к учетной записи хранения для Active Directory, не требуется для успешного развертывания Синхронизация файлов Azure. Это строго необязательный шаг, который позволяет файловому ресурсу Azure применять локальные списки управления доступом, когда пользователи напрямую подключаются к файловому ресурсу Azure.

## <a name="networking"></a>Сеть
Агент Синхронизация файлов Azure взаимодействует с вашей службой синхронизации хранилища и файловым ресурсом Azure с помощью протокола Синхронизация файлов Azure RESTFUL и протокола Филерест, оба из которых всегда используют HTTPS через порт 443. SMB никогда не используется для отправки или загрузки данных между сервером Windows Server и общим файловым ресурсом Azure. Так как большинство организаций разрешают трафик по протоколу HTTPS через порт 443, в качестве требования для посещения большинства веб-сайтов специальная настройка сети обычно не требуется для развертывания Синхронизация файлов Azure.

В зависимости от политики Организации или уникальных нормативных требований вам может потребоваться более строгая связь с Azure, поэтому Синхронизация файлов Azure предоставляет несколько механизмов настройки сети. В зависимости от ваших требований вы можете:

- Синхронизация туннеля и передача файлов и загрузка трафика через сеть ExpressRoute или Azure VPN. 
- Используйте службы файлов Azure и сетевые функции Azure, такие как конечные точки служб и частные конечные точки.
- Настройте Синхронизация файлов Azure для поддержки прокси-сервера в вашей среде.
- Регулирование сетевой активности от Синхронизация файлов Azure.

Дополнительные сведения о настройке сетевых функций Синхронизация файлов Azure см. в следующих статьях:
- [Параметры брандмауэра и прокси-сервера для компонента "Синхронизация файлов Azure"](storage-sync-files-firewall-and-proxy.md)
- [Обеспечение того, Синхронизация файлов Azure является хорошим соседем в центре обработки данных](storage-sync-files-server-registration.md)

## <a name="encryption"></a>Шифрование
При использовании Синхронизация файлов Azure существует три разных уровня шифрования, которые следует учитывать: шифрование при хранении в Windows Server, шифрование при передаче между агентом Синхронизация файлов Azure и Azure и шифрование неактивных данных в файловом ресурсе Azure. 

### <a name="windows-server-encryption-at-rest"></a>Шифрование неактивных компонентов Windows Server 
Существует две стратегии шифрования данных на сервере Windows Server, которые обычно работают с Синхронизация файлов Azure: шифрование под файловой системой, так что файловая система и все данные, записанные в нее, шифруются, а шифрование выполняется в самом формате файла. Эти методы не являются взаимоисключающими. При необходимости их можно использовать совместно, так как назначение шифрования отличается.

Чтобы обеспечить шифрование под файловой системой, Windows Server предоставляет папку "Входящие" BitLocker. BitLocker полностью прозрачен для Синхронизация файлов Azure. Основная причина использования механизма шифрования, такого как BitLocker, заключается в предотвращении физического утечка данных из локального центра, путем кражи дисков и отказа от неавторизованных ОС для выполнения несанкционированного чтения и записи данных. Дополнительные сведения о BitLocker см. в разделе [Общие сведения о BitLocker](https://docs.microsoft.com/windows/security/information-protection/bitlocker/bitlocker-overview).

Сторонние продукты, которые работают аналогично BitLocker, в том, что они располагаются под томом NTFS, должны также полностью прозрачно работать с Синхронизация файлов Azure. 

Другим основным методом шифрования данных является шифрование потока данных файла, когда приложение сохраняет файл. Некоторые приложения могут делать это изначально, но обычно это не так. Примером метода шифрования потока данных файла является Azure Information Protection (точка административной установки)/Азуре Rights Management Services (Azure RMS)/активе Directory RMS. Основная причина использования механизма шифрования, такого как точка управления (административная или RMS), заключается в предотвращении утечка данных из файлового ресурса пользователями, которые их копируют в альтернативные расположения, например на флэш-накопитель, или по электронной почте неавторизованному человеку. Когда поток данных файла шифруется как часть формата файла, этот файл будет по-прежнему зашифрован в общем файловом ресурсе Azure. 

Синхронизация файлов Azure не взаимодействуют с шифрованной файловой системой NTFS (NTFS EFS) или сторонними решениями шифрования, расположенными выше файловой системы, но под потоком данных файла. 

### <a name="encryption-in-transit"></a>Шифрование при передаче
Синхронизация файлов Azure агент взаимодействует с вашей службой синхронизации хранилища и файловым ресурсом Azure с помощью протокола Синхронизация файлов Azure RESTFUL и протокола Филерест, оба из которых всегда используют HTTPS через порт 443. Синхронизация файлов Azure не отправляет незашифрованные запросы по протоколу HTTP. 

Учетные записи хранения Azure содержат параметр для обязательного шифрования при передаче, который включен по умолчанию. Даже если коммутатор на уровне учетной записи хранения отключен, то есть возможна незашифрованная связь с файловыми ресурсами Azure, Синхронизация файлов Azure будет по-прежнему использовать зашифрованные каналы для доступа к общей папке.

Основная причина отключения шифрования при передаче для учетной записи хранения — Поддержка устаревшего приложения, которое должно выполняться в более старой версии операционной системы, например Windows Server 2008 R2 или более старой версии Linux, непосредственное обращение в файловый ресурс Azure. Если устаревшее приложение обращается к кэшу Windows Server общей папки, переключение этого параметра не будет действовать. 

Настоятельно рекомендуется обеспечить включение шифрования транзитных данных.

Дополнительные сведения о шифровании при передаче см. в статье [Require secure transfer in Azure Storage](../common/storage-require-secure-transfer.md?toc=%2fazure%2fstorage%2ffiles%2ftoc.json) (Требование безопасной передачи в службе хранилища Azure).

### <a name="azure-file-share-encryption-at-rest"></a>Шифрование неактивных файлов в общей папке Azure
[!INCLUDE [storage-files-encryption-at-rest](../../../includes/storage-files-encryption-at-rest.md)]

## <a name="storage-tiers"></a>Уровни хранилища
[!INCLUDE [storage-files-tiers-overview](../../../includes/storage-files-tiers-overview.md)]

### <a name="enable-standard-file-shares-to-span-up-to-100-tib"></a>Включение стандартных файловых ресурсов для использования до 100 тиб
[!INCLUDE [storage-files-tiers-enable-large-shares](../../../includes/storage-files-tiers-enable-large-shares.md)]

#### <a name="regional-availability"></a>Доступность по регионам
[!INCLUDE [storage-files-tiers-large-file-share-availability](../../../includes/storage-files-tiers-large-file-share-availability.md)]

## <a name="azure-file-sync-region-availability"></a>Доступность региона службы синхронизации файлов Azure
Синхронизация файлов Azure доступен в следующих регионах:

| Облако Azure | Географический регион | Регион Azure | Код региона |
|-------------|-------------------|--------------|-------------|
| Открытый | Азия | Восточная Азия | `eastasia` |
| Открытый | Азия | Юго-Восточная Азия | `southeastasia` |
| Открытый | Австралия | Восточная Австралия | `australiaeast` |
| Открытый | Австралия | Юго-Восточная часть Австралии | `australiasoutheast` |
| Открытый | Бразилия | Южная Бразилия | `brazilsouth` |
| Открытый | Канада | Центральная Канада | `canadacentral` |
| Открытый | Канада | Восточная Канада | `canadaeast` |
| Открытый | Европа | Северная Европа | `northeurope` |
| Открытый | Европа | Западная Европа | `westeurope` |
| Открытый | France | Центральная Франция | `francecentral` |
| Открытый | France | Южная Франция * | `francesouth` |
| Открытый | Индия | Центральная Индия | `centralindia` |
| Открытый | Индия | Южная Индия | `southindia` |
| Открытый | Япония | Восточная Япония | `japaneast` |
| Открытый | Япония | Западная Япония | `japanwest` |
| Открытый | Korea | Республика Корея, центральный регион | `koreacentral` |
| Открытый | Korea | Республика Корея, южный регион | `koreasouth` |
| Открытый | Южная Африка | Северная часть ЮАР; | `southafricanorth` |
| Открытый | Южная Африка | Западная Южная Африка * | `southafricawest` |
| Открытый | ОАЭ | Центральная часть ОАЭ * | `uaecentral` |
| Открытый | ОАЭ | Северная часть ОАЭ; | `uaenorth` |
| Открытый | Великобритания | южная часть Соединенного Королевства | `uksouth` |
| Открытый | Великобритания | западная часть Соединенного Королевства | `ukwest` |
| Открытый | US | Центральная часть США | `centralus` |
| Открытый | US | Восток США | `eastus` |
| Открытый | US | восточная часть США 2 | `eastus2` |
| Открытый | US | Центрально-северная часть США | `northcentralus` |
| Открытый | US | Центрально-южная часть США | `southcentralus` |
| Открытый | US | центрально-западная часть США | `westcentralus` |
| Открытый | US | Запад США | `westus` |
| Открытый | US | западная часть США 2 | `westus2` |
| US Gov | US | US Gov (Аризона) | `usgovarizona` |
| US Gov | US | US Gov (Техас) | `usgovtexas` |
| US Gov | US | US Gov (Вирджиния) | `usgovvirginia` |

Синхронизация файлов Azure поддерживает только синхронизацию с файловым ресурсом Azure в том же регионе, что и служба синхронизации хранилища.

Для регионов, помеченных звездочками, необходимо обратиться в службу поддержки Azure, чтобы запросить доступ к службе хранилища Azure в этих регионах. Этот процесс описан в [этом документе](https://azure.microsoft.com/global-infrastructure/geographies/).

## <a name="redundancy"></a>Избыточность
[!INCLUDE [storage-files-redundancy-overview](../../../includes/storage-files-redundancy-overview.md)]

> [!Important]  
> Геоизбыточное хранилище и географическая зона имеют возможность вручную отработки отказа хранилища в дополнительный регион. Не рекомендуется делать это за пределами аварии при использовании Синхронизация файлов Azure из-за повышенной вероятности потери данных. В случае аварии, когда вы хотите инициировать отработку отказа хранилища вручную, необходимо открыть обращение в службу поддержки Майкрософт, чтобы получить Синхронизация файлов Azure возобновить синхронизацию с дополнительной конечной точкой.

## <a name="migration"></a>Миграция
При наличии существующего файлового сервера Windows Синхронизация файлов Azure можно установить непосредственно на месте без необходимости перемещения данных на новый сервер. Если вы планируете выполнить миграцию на новый файловый сервер Windows в рамках внедрения Синхронизация файлов Azure, существует несколько возможных подходов к перемещению данных:

- Создайте конечные точки сервера для старой общей папки и новой общей папки и позвольте Синхронизация файлов Azure синхронизировать данные между конечными точками сервера. Преимущество этого подхода заключается в том, что это позволяет очень легко переписывать хранилище на новом файловом сервере, так как Синхронизация файлов Azure поддерживает распределение по уровням облака. Когда вы будете готовы, вы сможете вырезать конечных пользователей в общую папку на новом сервере и удалить старую конечную точку сервера файлового ресурса.

- Создайте конечную точку сервера только на новом файловом сервере и скопируйте данные из старого файлового ресурса с помощью `robocopy`. В зависимости от топологии файловых ресурсов на новом сервере (количество общих папок на каждом томе и т. д.), может потребоваться временно подготавливать дополнительное хранилище, так как ожидается, что `robocopy` от старого сервера к новому серверу в локальном центре обработки данных будет выполняться быстрее, чем Синхронизация файлов Azure переместит данные в Azure.

Можно также использовать Data Box для переноса данных в Синхронизация файлов Azureное развертывание. В большинстве случаев, когда клиенты хотят использовать Data Box для приема данных, они делают это, поскольку они считают, что они увеличивают скорость развертывания, или потому, что они могут помочь в сценариях с ограниченной пропускной способностью. Несмотря на то, что использование Data Box для приема данных в развертывании Синхронизация файлов Azure снизит использование пропускной способности, скорее всего, в большинстве случаев будет быстрее загружать данные через один из описанных выше методов. Дополнительные сведения об использовании Data Box для приема данных в развертывании Синхронизация файлов Azure см. в статье [Перенос данных в Синхронизация файлов Azure с помощью Azure Data Box](storage-sync-offline-data-transfer.md).

Распространенные ошибки, которые делают пользователи при переносе данных в новое развертывание Синхронизация файлов Azure, — это копирование данных непосредственно в файловый ресурс Azure, а не на файловые серверы Windows. Хотя Синхронизация файлов Azure определит все новые файлы в общей папке Azure и синхронизирует их с файловыми ресурсами Windows, обычно это значительно медленнее, чем загрузка данных через файловый сервер Windows. Многие средства копирования Azure, такие как AzCopy, имеют дополнительные недостатки не копирования всех важных метаданных файла, таких как метки времени и ACL.

## <a name="antivirus"></a>использование антивирусных программ;
Антивирусные программы работают путем сканирования файлов на наличие известного вредоносного кода, поэтому они могут вызвать отзыв файлов, распределенных по уровням. В агенте синхронизации файлов Azure начиная с версии 4.0 файлам, распределенным по уровням, задан атрибут безопасности Windows FILE_ATTRIBUTE_RECALL_ON_DATA_ACCESS. Рекомендуется обратиться к поставщику программного обеспечения за информацией о том, как настроить решение, чтобы пропускать чтение файлов с таким атрибутом (многие программы делают это автоматически). 

Антивирусные решения Майкрософт — Защитник Windows и служба регистрации сертификатов для сетевых устройств (SCEP) автоматически пропускают чтение файлов с таким атрибутом. В ходе их тестирования обнаружилась небольшая проблема — при добавлении сервера в существующую группу синхронизации файлы размером меньше 800 байт отзываются (скачиваются) на новый сервер. Эти файлы останутся на новом сервере и не будут передаваться, так как они не соответствуют требованиям к размерам для уровней (более 64 КБ).

> [!Note]  
> Поставщики антивирусных программ могут проверить совместимость своих продуктов и Синхронизация файлов Azure с помощью [Синхронизация файлов Azure набора тестов с антивирусной совместимостью](https://www.microsoft.com/download/details.aspx?id=58322), который доступен для загрузки в центре загрузки Майкрософт.

## <a name="backup"></a>Резервное копирование 
Как и антивирусные решения, решения для архивации могут привести к отзыву многоуровневых файлов. Для архивации файловых ресурсов Azure мы рекомендуем использовать облачное решение для архивации вместо локального.

Если используется локальное решение резервного копирования, резервное копирование должно выполняться на сервере в группе синхронизации, для которой отключено распределение по уровням облака. При восстановлении используйте параметры восстановления на уровне тома или файла. Файлы, восстановленные с помощью функции восстановления на уровне файлов, будут синхронизированы со всеми конечными точками в группе синхронизации, а существующие файлы — заменены версией, восстановленной из резервной копии.  При восстановлении на уровне тома новые версии файлов в файловом ресурсе Azure или других конечных точках сервера не заменяются.

> [!Note]  
> Восстановление исходного состояния системы (BMR) может привести к непредвиденным результатам и сейчас не поддерживается.

> [!Note]  
> В версии 9 агента Синхронизация файлов Azure теперь поддерживаются моментальные снимки VSS (включая предыдущие версии) на томах с включенным распределением по уровням облака. Однако необходимо включить совместимость предыдущих версий с помощью PowerShell. [Подробнее](storage-files-deployment-guide.md).

## <a name="azure-file-sync-agent-update-policy"></a>Политика обновления агента службы синхронизации файлов Azure
[!INCLUDE [storage-sync-files-agent-update-policy](../../../includes/storage-sync-files-agent-update-policy.md)]

## <a name="next-steps"></a>Следующие шаги
* [Параметры брандмауэра и прокси-сервера Синхронизации файлов Azure](storage-sync-files-firewall-and-proxy.md)
* [Планирование развертывания службы файлов Azure](storage-files-planning.md)
* [Как развернуть службу файлов Azure](storage-files-deployment-guide.md)
* [Как развернуть службу синхронизации файлов Azure (предварительная версия)](storage-sync-files-deployment-guide.md)
* [Мониторинг Синхронизации файлов Azure](storage-sync-files-monitoring.md)