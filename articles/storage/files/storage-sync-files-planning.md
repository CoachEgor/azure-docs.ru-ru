---
title: Планирование развертывания службы "Синхронизация файлов Azure" | Документация Майкрософт
description: Узнайте, что необходимо учесть при планировании развертывания службы "Файлы Azure".
author: roygara
ms.service: storage
ms.topic: conceptual
ms.date: 01/15/2020
ms.author: rogarana
ms.subservice: files
ms.openlocfilehash: 8666f51b88d2a70a2cb27e3606f24010771c8017
ms.sourcegitcommit: b55d7c87dc645d8e5eb1e8f05f5afa38d7574846
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81460717"
---
# <a name="planning-for-an-azure-file-sync-deployment"></a>Планирование развертывания службы синхронизации файлов Azure

:::row:::
    :::column:::
        [![Интервью и демо введение Azure Файл синхронизации - нажмите, чтобы играть!](./media/storage-sync-files-planning/azure-file-sync-interview-video-snapshot.png)](https://www.youtube.com/watch?v=nfWLO7F52-s)
    :::column-end:::
    :::column:::
        Azure File Sync — это служба, которая позволяет кэшировать несколько файлов Azure на предприимчивом Windows Server или облачном VM. 
        
        В этой статье вы знакомите вас с концепциями и функциями Azure File Sync. После того, как вы знакомы с azure File Sync, подумайте о том, чтобы ознакомиться с руководством по [развертыванию файлов Azure File Sync,](storage-sync-files-deployment-guide.md) чтобы опробовать эту службу.        
    :::column-end:::
:::row-end:::

Файлы будут храниться в облаке в [файлах Azure.](storage-files-introduction.md) Доли файлов Azure можно использовать двумя способами: путем прямого монтажа этих бессерверных файлов Azure (SMB) или путем кэширования акций файлов Azure на месте с помощью Azure File Sync. Какой вариант развертывания вы выберете, изменяет аспекты, которые необходимо учитывать при планировании развертывания. 

- **Прямое крепление доли файлов Azure:** Поскольку Azure Files предоставляет доступ к SMB, вы можете смонтировать акции файлов Azure на местах или в облаке, используя стандартный клиент SMB, доступный в Windows, macOS и Linux. Поскольку доли файлов Azure не серверны, развертывание для производственных сценариев не требует управления файловым сервером или NAS-устройством. Это означает, что вам не придется применять программные патчи или менять физические диски. 

- **Доля файлов Cache Azure в предварительном**доступе с Azure File Sync: Azure File Sync позволяет централизовать файлы организации в файлах Azure Files, сохраняя при этом гибкость, производительность и совместимость сервера файлов. Azure File Sync преобразует предприимчивый (или облачный) Windows Server в быстрый кэш общего файла Azure. 

## <a name="management-concepts"></a>Основные принципы управления
Развертывание Azure File Sync имеет три основных объекта управления:

- **Доля файлов Azure:** доля файлов Azure — это безсерверная доля облачных файлов, которая обеспечивает *конечную точку облачности* синхронизации синхронизации файлов Azure. Файлы в файле Azure можно получить непосредственно с помощью SMB или протокола FileREST, хотя мы рекомендуем вам в первую очередь получить доступ к файлам через кэш Windows Server, когда доля файлов Azure используется с помощью Azure File Sync. Это связано с тем, что сегодня в Azure Files отсутствует эффективный механизм обнаружения изменений, как у Windows Server, поэтому для непосредственного распространения на конечные точки сервера потребуется время для распространения на конечные точки сервера.
- **Конечная точка сервера:** Путь на сервере Windows, который синхронизируется с доской файла Azure. Это может быть определенная папка на томе или корне тома. Несколько конечных точек сервера могут существовать в одном и томе, если их области имен не перекрываются.
- **Группа синхронизации:** объект, определяющий связь синхронизации между **конечней точкой облака**или совместной частью файла Azure и конечная точка сервера. Конечные точки в группе синхронизации синхронизируются. Если, например, у вас есть два различных набора файлов, которыми вы хотите управлять с помощью Azure File Sync, вы создадите две группы синхронизации и добавите разные конечные точки для каждой группы синхронизации.

### <a name="azure-file-share-management-concepts"></a>Концепции управления файлами Azure
[!INCLUDE [storage-files-file-share-management-concepts](../../../includes/storage-files-file-share-management-concepts.md)]

### <a name="azure-file-sync-management-concepts"></a>Концепции управления системой управления файлами Azure
Группы синхронизации развертываются в **службах синхронизации хранения**данных, которые являются объектами верхнего уровня, которые регистрируют серверы для использования в Azure File Sync и содержат групповые отношения синхронизации. Ресурс службы синхронизации хранилища является одноранговым в отношении ресурса учетной записи хранения, поэтому его можно развернуть в группах ресурсов Azure. Служба синхронизации хранилища может создавать группы синхронизации, содержащие файлы Azure, в нескольких учетных записях и нескольких зарегистрированных серверах Windows.

Прежде чем создать группу синхронизации в службе синхронизации хранения, необходимо сначала зарегистрировать сервер Windows в службе синхронизации. Это создает **зарегистрированный объект сервера,** который представляет доверительные отношения между сервером или кластером и службой синхронизации хранилища. Чтобы зарегистрировать службу синхронизации хранилища, необходимо сначала установить на сервере агент Azure File Sync. Отдельный сервер или кластер могут быть зарегистрированы только в одной службе синхронизации хранилища одновременно.

Группа синхронизации содержит одну конечную точку облака или общую часть файлов Azure и, по крайней мере, одну конечную точку сервера. Объект конечной точки сервера содержит параметры, настраивающие возможность **многоуровневого облака,** что обеспечивает возможность кэширования синхронизации файлов Azure. Для синхронизации с разделом файла Azure учетная запись, содержащая общую часть файла Azure, должна находиться в том же регионе Azure, что и служба синхронизации хранения.

### <a name="management-guidance"></a>Руководство по управлению
При развертывании синхронизации файлов Azure мы рекомендуем:

- Развертывание файлов Azure делится 1:1 с акциями файлов Windows. Объект конечной точки сервера обеспечивает большую степень гибкости в настройке топологии синхронизации на стороне сервера отношений синхронизации. Чтобы упростить управление, сделайте путь конечной точки сервера сопоставлению с траекторией совместного файла Windows. 

- Используйте как можно меньше служб синхронизации хранилища. Это упростит управление, когда у вас есть группы синхронизации, которые содержат несколько конечных точек сервера, так как Windows Server может быть зарегистрирован только в одной службе синхронизации хранения одновременно. 

- Обращая внимание на ограничения IOPS учетной записи хранилища при развертывании файлов Azure. В идеале можно сопоставить акции файлов 1:1 со счетами хранения, однако это не всегда возможно из-за различных ограничений и ограничений, как со стороны вашей организации, так и от Azure. Когда невозможно развернуть только одну копию файла в одном хранилище, подумайте, какие акции будут очень активны, а какие — менее активны, чтобы гарантировать, что самые горячие файлы не будут помещены в один и тот же счет хранения вместе.

## <a name="windows-file-server-considerations"></a>Соображения файлового сервера Windows
Чтобы включить возможность синхронизации на Windows Server, необходимо установить загружаемый агент Azure File Sync. Агент Azure File Sync предоставляет `FileSyncSvc.exe`два основных компонента: фоновую службу Windows, которая отвечает за мониторинг `StorageSync.sys`изменений на конечных точках сервера и начало сеансов синхронизации, а также фильтр файловой системы, который позволяет многоуровневое облако и быстрое восстановление аварийности.  

### <a name="operating-system-requirements"></a>Требования к операционной системе
Синхронизация файлов Azure поддерживается следующими версиями Windows Server:

| Версия | Поддерживаемые номера SKU | Поддерживаемые варианты развертывания |
|---------|----------------|------------------------------|
| Windows Server 2019 | Центр обработки данных, стандарт и IoT | Полный и основной |
| Windows Server 2016 | Центр обработки данных, стандартный и складский сервер | Полный и основной |
| Windows Server 2012 R2 | Центр обработки данных, стандартный и складский сервер | Полный и основной |

Новые версии Windows Server будут добавляться по мере их выпуска.

> [!Important]  
> Мы рекомендуем постоянно обновлять серверы, используемые со службой синхронизации файлов Azure, с помощью последних обновлений из Центра обновления Windows. 

### <a name="minimum-system-resources"></a>Минимальные системные ресурсы
Azure File Sync требует сервера, физического или виртуального, с по крайней мере одним процессором и минимум 2 GiB памяти.

> [!Important]  
> Если сервер работает в виртуальной машине с включенной динамической памятью, VM должен быть настроен с минимум 2048 MiB памяти.

Для большинства рабочих нагрузок мы не рекомендуем настраивать сервер синхронизации файлов Azure с минимальными требованиями. Для получения дополнительной информации можно ознакомиться с [рекомендуемыми системными ресурсами.](#recommended-system-resources)

### <a name="recommended-system-resources"></a>Рекомендуемые системные ресурсы
Как и любой функции сервера или приложения, требования к системным ресурсам для Azure File Sync определяются масштабом развертывания; более крупные развертывания на сервере требуют больших системных ресурсов. Для Azure File Sync масштаб определяется количеством объектов в конечных точках сервера и оттоком в наборе данных. Один сервер может иметь конечные точки сервера в нескольких группах синхронизации, а количество объектов, перечисленных в следующей таблице, учитывает полное пространство имен, к которое присоединен сервер. 

Например, конечная точка А с 10 миллионами объектов и конечная точка B сервера с 10 миллионами объектов и 20 миллионами объектов. Для этого примера развертывания, мы бы рекомендовали 8 процессоров, 16 GiB памяти для устойчивого состояния, и (если возможно) 48 GiB памяти для первоначальной миграции.
 
Данные пространства имен хранятся в памяти по причинам производительности. Из-за этого большие пространства имен требуют больше памяти для поддержания хорошей производительности, а для увеличения оттока требуется больше процессора для обработки. 
 
В следующей таблице мы предоставили как размер пространства имен, так и преобразование в емкость для типичных общих файлов общего назначения, где средний размер файла составляет 512 киБ. Если размеры файла меньше, подумайте о добавлении дополнительной памяти на ту же емкость. Основывайте конфигурацию памяти на размере пространства имен.

| Размер пространства имен - файлы & каталогах (млн.)  | Типичная емкость (TiB)  | Ядра ЦП  | Рекомендуемая память (GiB) |
|---------|---------|---------|---------|
| 3        | 1.4     | 2        | 8 (первоначальная синхронизация)/ 2 (типичный отток)      |
| 5        | 2.3     | 2        | 16 (первоначальная синхронизация)/ 4 (типичный отток)    |
| 10       | 4,7     | 4        | 32 (первоначальная синхронизация)/ 8 (типичный отток)   |
| 30       | 14,0    | 8        | 48 (первоначальная синхронизация)/ 16 (типичный отток)   |
| 50       | 23.3    | 16       | 64 (первоначальная синхронизация)/ 32 (типичный отток)  |
| 100*     | 46.6    | 32       | 128 (первоначальная синхронизация)/ 32 (типичный отток)  |

\*Синхронизация более 100 миллионов файлов & каталоги не рекомендуется в настоящее время. Это мягкий предел, основанный на наших проверенных пороговых значениях. Для получения дополнительной информации смотрите [цели масштабируемости и производительности файлов Azure Files.](storage-files-scale-targets.md#azure-file-sync-scale-targets)

> [!TIP]
> Первоначальная синхронизация пространства имен является интенсивной операцией, и мы рекомендуем выделять больше памяти до завершения первоначальной синхронизации. Это не требуется, но, может ускорить начальную синхронизацию. 
> 
> Типичный отток составляет 0,5% от изменения пространства имен в день. Для более высоких уровней оттока, рассмотреть вопрос о добавлении большего процессора. 

- Локально подключенный том, отформатированный с помощью файловой системы NTFS.

### <a name="evaluation-cmdlet"></a>Оценка cmdlet
Перед развертыванием синхронизации файлов Azure следует оценить, совместима ли она с системой с помощью cmdlet оценки azure File Sync. Это cmdlet проверяет потенциальные проблемы с файловой системой и набором данных, такие как неподдерживаемые символы или неподдерживаемая версия операционной системы. Его проверки охватывают большинство, но не все функции, упомянутые ниже; мы рекомендуем вам внимательно ознакомиться с остальной частью этого раздела, чтобы обеспечить бесперебойное развертывание. 

Оценка cmdlet может быть установлена путем установки модуля Az PowerShell, который может быть установлен, следуя инструкциям здесь: [Установка и настройка Azure PowerShell](https://docs.microsoft.com/powershell/azure/install-Az-ps).

#### <a name="usage"></a>Использование  
Средство оценки можно вызывать несколькими способами: можно выполнять системные проверки, проверки набора данных или и то, и другое. Выполнение проверки системы и набора данных: 

```powershell
Invoke-AzStorageSyncCompatibilityCheck -Path <path>
```

Проверка только набора данных:
```powershell
Invoke-AzStorageSyncCompatibilityCheck -Path <path> -SkipSystemChecks
```
 
Проверка только системных требований:
```powershell
Invoke-AzStorageSyncCompatibilityCheck -ComputerName <computer name>
```
 
Отображение результатов в CSV-файле:
```powershell
$errors = Invoke-AzStorageSyncCompatibilityCheck […]
$errors | Select-Object -Property Type, Path, Level, Description | Export-Csv -Path <csv path>
```

### <a name="file-system-compatibility"></a>Совместимость файловой системы
Azure File Sync поддерживается только при непосредственном подключенном объеме NTFS. Прямое прилагаемые хранилища, или DAS, на Windows Server означает, что операционная система Windows Server владеет файловой системой. DAS может быть предоставлен через физические крепления дисков к файловому серверу, присоединение виртуальных дисков к файловому серверу VM (например, VM, размещенный Hyper-V), или даже через ISCSI.

Поддерживаются только объемы NTFS; ReFS, FAT, FAT32 и другие файловые системы не поддерживаются.

В следующей таблице показано состояние функций файловой системы NTFS: 

| Компонент | Состояние поддержки | Примечания |
|---------|----------------|-------|
| Списки управления доступом (ACL) | полностью поддерживается. | Дискреционные списки управления доступом в стиле Windows сохраняются системой Azure File Sync и применяются Сервером Windows Server на конечных точках сервера. AcLs также могут быть приведены в исполнение при непосредственном монтаже общего файла Azure, однако для этого требуется дополнительная конфигурация. Дополнительную информацию можно узнать в [разделе «Идентификация».](#identity) |
| Жесткие связи. | Пропущено | |
| Символические связи | Пропущено | |
| Точки подключения | Поддерживается частично | Точки подключения могут располагаться в корне конечной точки сервера, но они пропускаются, если содержатся в пространстве имен конечной точки сервера. |
| Соединения | Пропущено | Например, папки DfrsrPrivate и DFSRoots распределенной файловой системы. |
| Точки повторного анализа | Пропущено | |
| Сжатие NTFS | полностью поддерживается. | |
| Разреженные файлы | полностью поддерживается. | Разреженные файлы синхронизируются (не блокируются) в облако в качестве полного файла. При изменении содержимого файла в облаке (или на другом сервере) он перестанет быть разреженным, когда скачана измененная версия. |
| Альтернативные потоки данных (ADS) | Сохраняются, но не синхронизируются | Например, теги классификации, созданные инфраструктурой классификации файлов, не синхронизируются. Имеющиеся теги классификации для файлов в каждой из конечных точек сервера использоваться не будут. |

<a id="files-skipped"></a>Azure File Sync также пропустит некоторые временные файлы и системные папки:

| Файл или папка | Примечание |
|-|-|
| pagefile.sys | Системный файл |
| Desktop.ini | Системный файл |
| thumbs.db; | Временный файл для эскизов |
| ehthumbs.db; | Временный файл для эскизов носителей |
| ~$\*.\* | Временный файл Office |
| \*.tmp; | Временный файл |
| \*.laccdb; | Файл блокировки базы данных Access|
| 635D02A9D91C401B97884B82B3BCDAEA.* | Внутренний файл синхронизации|
| \\System Volume Information | Папка для тома |
| $RECYCLE.BIN| Папка |
| \\SyncShareState | Папка для синхронизации |

### <a name="failover-clustering"></a>Отказоустойчивая кластеризация
Служба синхронизации файлов Azure поддерживает отказоустойчивую кластеризацию Windows Server для варианта развертывания "Файловый сервер общего использования". Отказоустойчивая кластеризация не поддерживается в вариантах "Масштабируемый файловый сервер для данных приложения" (SOFS) или в общих томах кластеров (CSV).

> [!Note]  
> Агент службы синхронизации файлов Azure должен быть установлен на каждом узле отказоустойчивого кластера для правильной работы синхронизации.

### <a name="data-deduplication"></a>Дедупликация данных
**Windows Server 2016 и Windows Server 2019**   
Дедупликация данных поддерживается в томах с включенным распределением по уровням в облаке в Windows Server 2016 и Windows Server 2019. Включение Deduplication данных в объем с включенным облачным уровнем позволяет кэшировать больше файлов на местах без предоставления большего объема хранилища. 

Когда Deduplication данных включен на томе с включенным уровнем облака, оптимизированные файлы Dedup в месте конечных точек сервера будут многоуровневыми, аналогичными обычному файлу, основанному на настройках политики многоуровневого облака. После того, как оптимизированные файлы Dedup будут многоуровневыми, задание по сбору мусора Data Deduplication будет автоматически работать для восстановления дискового пространства путем удаления ненужных фрагментов, на которые больше не ссылаются другие файлы в томе.

Обратите внимание, что экономия громкости применяется только к серверу; ваши данные в капоте файла Azure не будут сгнаны в неделю.

> [!Note]  
> Для поддержки deduplication data на томах с включенным облачным уровнем на Windows Server 2019 необходимо установить обновление Windows [KB4520062](https://support.microsoft.com/help/4520062) и версию агента Azure File Sync 9.0.0.0 или более новую.

**Windows Server 2012 R2**  
Azure File Sync не поддерживает дедоверирование данных и многоуровневое облако на том же томе на Windows Server 2012 R2. Если deduplication данных включен на томе, уровень облачности должен быть отключен. 

**Примечания**
- Если deduplication Data установлен до установки агента Azure File Sync, для поддержки deduplication данных и многоуровневого уровня облаков на том же томе требуется перезагрузка.
- Если deduplication Data включен на томе после включения уровня облака, начальное задание по оптимизации Deduplication оптимизирует файлы на томе, который еще не многоуровнев и будет иметь следующее влияние на многоуровневое облако:
    - Политика свободного пространства будет продолжать использовать файлы уровня в зависимости от свободного пространства на громкости с помощью тепловой карты.
    - Политика даты пропустит многоуровневое использование файлов, которые в противном случае могли иметь право на многоуровневое из-за задания оптимизации Deduplication, доступ к файлам.
- Для текущих заданий оптимизации деделирования, уровень облачности с политикой даты будет задерживаться из-за настройки Data Deduplication [MinimumFileAgeDays,](https://docs.microsoft.com/powershell/module/deduplication/set-dedupvolume?view=win10-ps) если файл еще не многоуровнев. 
    - Пример: Если параметр MinimumFileAgeDays составляет семь дней, а политика даты многоуровневой облачности — 30 дней, политика даты будет использовать файлы через 37 дней.
    - Примечание: После того, как файл будет многоуровневым с помощью Azure File Sync, задание оптимизации Deduplication пропустит файл.
- Если сервер под управлением Windows Server 2012 R2 с установленным агентом Azure File Sync обновлен до Windows Server 2016 или Windows Server 2019, необходимо выполнить следующие шаги для поддержки дедоплетирования данных и многоуровнения облаков в том же объеме:  
    - Удалите агент Azure File Sync для Windows Server 2012 R2 и перезапустите сервер.
    - Загрузите агент Azure File Sync для новой версии операционной системы сервера (Windows Server 2016 или Windows Server 2019).
    - Установите агент Azure File Sync и перезапустите сервер.  
    
    Примечание: Настройки конфигурации Azure File Sync на сервере сохраняются при неустановлении и переустановке агента.

### <a name="distributed-file-system-dfs"></a>Распределенная файловая система (DFS)
Служба "Синхронизация файлов Azure" поддерживает взаимодействие с пространствами имен DFS (DFS-N) и репликацией DFS (DFS-R).

**Пространства имен DFS (DFS-N).** Служба "Синхронизация файлов Azure" полностью поддерживается для серверов DFS-N. Вы можете установить агент службы "Синхронизация файлов Azure" на один или несколько членов DFS-N, чтобы синхронизировать данные между конечными точками сервера и облачными конечными точками. Дополнительные сведения см. в статье [Обзор пространств имен DFS](https://docs.microsoft.com/windows-server/storage/dfs-namespaces/dfs-overview).
 
**Репликация DFS (DFS-R):** Поскольку DFS-R и Azure File Sync являются решениями репликации, в большинстве случаев мы рекомендуем заменить DFS-R на Azure File Sync. Однако существует несколько сценариев, в которых необходимо использовать синхронизацию файлов DFS-R и Azure File Sync вместе:

- Если выполняется миграция с развернутой службы DFS-R в развернутую службу "Синхронизация файлов Azure". Дополнительные сведения см. в статье [Развертывание службы синхронизации файлов Azure (предварительная версия)](storage-sync-files-deployment-guide.md#migrate-a-dfs-replication-dfs-r-deployment-to-azure-file-sync).
- Не каждый на территории сервера, который нуждается в копии ваших файлов, может быть подключен непосредственно к Интернету.
- Если серверы подразделений консолидируют данные на одном сервере-концентраторе, для которого вы намерены использовать службу "Синхронизация файлов Azure".

Для того, чтобы Azure File Sync и DFS-R работали бок о бок:

1. В службе "Синхронизация файлов Azure" нужно отключить распределение по уровням облака для томов, на которых есть реплицируемые DFS-R папки.
2. Не следует настраивать конечные точки сервера для папок репликации DFS-R с доступом только для чтения.

Дополнительные сведения см. в статье [Обзор пространств имен DFS и репликации DFS](https://technet.microsoft.com/library/jj127250).

### <a name="sysprep"></a>Средство Sysprep
Использование sysprep на сервере с установленным агентом Azure File Sync не поддерживается и может привести к неожиданным результатам. Устанавливать агент и регистрировать сервер нужно после развертывания образа сервера и завершения мини-установки sysprep.

### <a name="windows-search"></a>Windows Search
Если на конечной точке сервера включено распределение по уровням облака, распределяемые по уровням файлы пропускаются и не индексируются службой Windows Search. Файлы, не распределяемые по уровням, индексируются должным образом.

### <a name="other-hierarchical-storage-management-hsm-solutions"></a>Другие решения по управлению иерархическим хранением (HSM)
Другие решения HSM не нужно использовать со службой синхронизации файлов Azure.

## <a name="identity"></a>Идентификация
Azure File Sync работает со стандартной идентификацией на основе AD без какой-либо специальной настройки, кроме настройки синхронизации. При использовании Azure File Sync общее ожидание состоит в том, что большинство доступных доступов будут проходить через серверы кэширования файлов Azure, а не через раздел файлов Azure. Поскольку конечные точки сервера расположены на Windows Server, а Windows Server поддерживает AD и AcLs в стиле Windows в течение очень долгого времени, ничего не нужно, кроме обеспечения присоединения серверов файлов Windows, зарегистрированных службой синхронизации хранилища. Azure File Sync будет хранить АКЛ в файлах в файле Azure и будет воспроизводить их на всех конечных точках сервера.

Даже если изменения, внесенные непосредственно в общую кадовозможность Azure, займут больше времени для синхронизации с конечными точками сервера в группе синхронизации, также можно убедиться, что вы можете обеспечить выполнение разрешений AD на вашей совместной сечек файла прямо в облаке. Для этого необходимо присоединиться к учетной записи хранилища в вашем предварительном AD, точно так же, как ваши серверы файлов Windows являются доменом. Чтобы узнать больше о присоединении учетной записи хранилища к принадлежащему клиенту Active Directory, смотрите [обзор Active Directory Azure Files.](storage-files-active-directory-overview.md)

> [!Important]  
> Домен, соединяющий учетную запись хранения в Active Directory, не требуется для успешного развертывания синхронизации файлов Azure. Это строго необязательный шаг, который позволяет совместной теме файлов Azure обеспечивать соблюдение локтевых АКЛ при непосредственном сходе файла Azure.

## <a name="networking"></a>Сеть
Агент Azure File Sync общается с службой синхронизации хранения данных, а файл Azure делится с помощью протокола Azure File Sync REST и протокола FileREST, оба из которых всегда используют HTTPS над портом 443. SMB никогда не используется для загрузки или загрузки данных между вашим сервером Windows и совместной частью файлов Azure. Поскольку большинство организаций разрешают трафик HTTPS через порт 443 в качестве требования для посещения большинства веб-сайтов, конфигурация специальных сетей обычно не требуется для развертывания синхронизации файлов Azure.

Основываясь на политике организации или уникальных нормативных требованиях, может потребоваться более ограничительная связь с Azure, и поэтому Azure File Sync предоставляет несколько механизмов настройки сетей. В соответствии с вашими требованиями, вы можете:

- Синхронизация и загрузка/загрузка файлов через ваш VPN ExpressRoute или Azure. 
- Используйте функции Azure Files и Azure Networking, такие как конечные точки обслуживания и частные конечные точки.
- Нанастройка синхронизации файлов Azure для поддержки прокси в среде.
- Активность сети throttle от синхронизации файлов Azure.

Подробнее о настройке функциональности сетевой системы Azure File Sync можно узнать:
- [Параметры брандмауэра и прокси-сервера службы "Синхронизация файлов Azure"](storage-sync-files-firewall-and-proxy.md)
- [Соблюдение правил поведения службы "Синхронизация файлов Azure" в центре обработки данных](storage-sync-files-server-registration.md)

## <a name="encryption"></a>Шифрование
При использовании Azure File Sync необходимо учитывать три различных уровня шифрования: шифрование на окоте хранения Windows Server, шифрование в транзите между агентом Azure File Sync и Azure и шифрование в остальной части ваших данных в файле Azure. 

### <a name="windows-server-encryption-at-rest"></a>Шифрование Windows Server в состоянии покоя 
Существует две стратегии шифрования данных на Windows Server, которые обычно работают с Azure File Sync: шифрование под файловой системой, так что файловая система и все записанные на нее данные зашифрованы, и шифрование в самом формате файла. Эти методы не являются взаимоисключающими; они могут быть использованы вместе при желании, так как цель шифрования отличается.

Чтобы обеспечить шифрование под файловой системой, Windows Server предоставляет почтовый ящик BitLocker. BitLocker полностью прозрачен для синхронизации файлов Azure. Основная причина использования механизма шифрования, как BitLocker, заключается в предотвращении физического эксфильтрации данных из вашего центра обработки данных кем-то кражем дисков и предотвращения боковой загрузки несанкционированной ОС для выполнения несанкционированных считывания/записей на ваши данные. Чтобы узнать больше о BitLocker, [см.](https://docs.microsoft.com/windows/security/information-protection/bitlocker/bitlocker-overview)

Сторонние продукты, которые работают так же, как BitLocker, в том, что они находятся под объемом NTFS, должны также работать полностью прозрачно с Azure File Sync. 

Другим основным методом шифрования данных является шифрование потока данных файла, когда приложение сохраняет файл. Некоторые приложения могут делать это нативно, однако это, как правило, не так. Примером метода шифрования потока данных файла является Служба защиты информации Azure (AIP)/Azure Rights Management Services (Azure RMS)/Active Directory RMS. Основная причина использования механизма шифрования, такого как AIP/RMS, заключается в предотвращении выделения данных из вашей доли файла людьми, копируяих их в альтернативные места, например, на флэш-накопитель, или отправляя их по электронной почте неавторизованному лицу. Когда поток данных файла зашифрован как часть формата файла, этот файл будет продолжать шифроваться в доле файла Azure. 

Azure File Sync не взаимодействует с NTFS Encrypted File System (NTFS EFS) или сторонними решениями шифрования, которые находятся над файловой системой, но ниже потока данных файла. 

### <a name="encryption-in-transit"></a>Шифрование при передаче
Агент Azure File Sync общается с службой синхронизации хранения и совместной копией файлов Azure, используя протокол Azure File Sync REST и протокол FileREST, оба из которых всегда используют HTTPS над портом 443. Azure File Sync не отправляет незашифрованные запросы через HTTP. 

Учетные записи хранения Azure содержат переключатель для необходимости шифрования в транзите, который включен по умолчанию. Даже если коммутатор на уровне учетной записи хранилища отключен, что означает, что незашифрованные подключения к вашим файлам Azure возможны, Azure File Sync будет использовать только зашифрованные каналы для доступа к вашей доле файла.

Основная причина отключить шифрование при переходе учетной записи хранилища заключается в поддержке устаревшего приложения, которое должно быть запущено на старой операционной системе, такой как Windows Server 2008 R2 или более старое распространение Linux, напрямую говоря с файлом Azure. Если устаревающее приложение разговаривает с кэшем Windows Server, который должен быть файлом, то обработка этой настройки не будет иметь никакого эффекта. 

Мы настоятельно рекомендуем обеспечить шифрование данных в пути включен.

Дополнительные сведения о шифровании при передаче см. в статье [Require secure transfer in Azure Storage](../common/storage-require-secure-transfer.md?toc=%2fazure%2fstorage%2ffiles%2ftoc.json) (Требование безопасной передачи в службе хранилища Azure).

### <a name="azure-file-share-encryption-at-rest"></a>Шифрование совместного файла Azure в состоянии покоя
[!INCLUDE [storage-files-encryption-at-rest](../../../includes/storage-files-encryption-at-rest.md)]

## <a name="storage-tiers"></a>Уровни хранилища
[!INCLUDE [storage-files-tiers-overview](../../../includes/storage-files-tiers-overview.md)]

### <a name="enable-standard-file-shares-to-span-up-to-100-tib"></a>Включить стандартные файлы до 100 TiB
[!INCLUDE [storage-files-tiers-enable-large-shares](../../../includes/storage-files-tiers-enable-large-shares.md)]

#### <a name="regional-availability"></a>Доступность по регионам
[!INCLUDE [storage-files-tiers-large-file-share-availability](../../../includes/storage-files-tiers-large-file-share-availability.md)]

## <a name="azure-file-sync-region-availability"></a>Доступность региона синхронизации файлов Azure
Синхронизация файлов Azure доступна в следующих регионах:

| Облако Azure | Географический регион | Регион Azure | Код региона |
|-------------|-------------------|--------------|-------------|
| Public | Азия | Восточная Азия | `eastasia` |
| Public | Азия | Юго-Восточная Азия | `southeastasia` |
| Public | Австралия | Восточная Австралия | `australiaeast` |
| Public | Австралия | Юго-Восточная часть Австралии | `australiasoutheast` |
| Public | Бразилия | Южная Бразилия | `brazilsouth` |
| Public | Canada | Центральная Канада | `canadacentral` |
| Public | Canada | Восточная Канада | `canadaeast` |
| Public | Европа | Северная Европа | `northeurope` |
| Public | Европа | Западная Европа | `westeurope` |
| Public | Франция | Центральная Франция | `francecentral` |
| Public | Франция | Франция на юге | `francesouth` |
| Public | Индия | Центральная Индия | `centralindia` |
| Public | Индия | Южная Индия | `southindia` |
| Public | Япония | Восточная Япония | `japaneast` |
| Public | Япония | Западная Япония | `japanwest` |
| Public | Корея | Республика Корея, центральный регион | `koreacentral` |
| Public | Корея | Республика Корея, южный регион | `koreasouth` |
| Public | ЮАР | Северная часть ЮАР; | `southafricanorth` |
| Public | ЮАР | Западная часть Африки | `southafricawest` |
| Public | ОАЭ | Центральный район ОАЭ | `uaecentral` |
| Public | ОАЭ | Северная часть ОАЭ; | `uaenorth` |
| Public | Соединенное Королевство | южная часть Соединенного Королевства | `uksouth` |
| Public | Соединенное Королевство | западная часть Соединенного Королевства | `ukwest` |
| Public | США | Центральная часть США | `centralus` |
| Public | США | Восточная часть США | `eastus` |
| Public | США | восточная часть США 2 | `eastus2` |
| Public | США | Центрально-северная часть США | `northcentralus` |
| Public | США | Центрально-южная часть США | `southcentralus` |
| Public | США | центрально-западная часть США | `westcentralus` |
| Public | США | западная часть США | `westus` |
| Public | США | западная часть США 2 | `westus2` |
| US Gov | США | US Gov (Аризона) | `usgovarizona` |
| US Gov | США | US Gov (Техас) | `usgovtexas` |
| US Gov | США | US Gov (Вирджиния) | `usgovvirginia` |

Синхронизация файлов Azure поддерживает только синхронизацию с файловым ресурсом Azure в том же регионе, что и служба синхронизации хранилища.

Для регионов, отмеченных звездочками, необходимо связаться с службой поддержки Azure, чтобы запросить доступ к хранилищам Azure в этих регионах. Процесс изложен в [этом документе.](https://azure.microsoft.com/global-infrastructure/geographies/)

## <a name="redundancy"></a>Избыточность
[!INCLUDE [storage-files-redundancy-overview](../../../includes/storage-files-redundancy-overview.md)]

> [!Important]  
> Гео-излишнее и геозоны избыточного хранения имеют возможность вручную сбой хранения во вторичном регионе. Мы рекомендуем не делать этого за пределами сбоя при использовании Azure File Sync из-за повышенной вероятности потери данных. В случае аварии, когда вы хотите инициировать ручной сбой в хранении, необходимо открыть дело поддержки с корпорацией Майкрософт, чтобы получить синхронизацию файлов Azure для возобновления синхронизации со вторичной конечной точкой.

## <a name="migration"></a>Миграция
Если у вас есть существующий файловый сервер Windows, Azure File Sync может быть установлена непосредственно на месте, без необходимости перемещения данных на новый сервер. Если вы планируете перейти на новый файловый сервер Windows в рамках внедрения синхронизации файлов Azure, существует несколько возможных подходов к перемещению данных:

- Создайте конечные точки сервера для старого файла и новой доли файла и позвольте синхронизации файлов Azure File Sync между конечными точками сервера. Преимущество этого подхода заключается в том, что он позволяет очень легко переподписывать хранилище на новом файловом сервере, так как Azure File Sync является облачным уровнем известно. Когда вы будете готовы, вы можете сократить конечных пользователей до раздела файлов на новом сервере и удалить конечную точку сервера старого файла.

- Создайте конечную точку сервера только на новом файловом сервере и копируйте данные из старого общего файла с помощью. `robocopy` В зависимости от топологии файловых акций на новом сервере (сколько акций у вас есть на каждом томе, насколько свободен каждый том и т.д.), возможно, потребуется временно предоставить дополнительное хранилище, поскольку ожидается, что `robocopy` от вашего старого сервера до нового сервера в вашем центре обработки данных будет завершено быстрее, чем Azure File Sync переведет данные в Azure.

Также можно использовать data Box для переноса данных в развертывание Azure File Sync. В большинстве случаев, когда клиенты хотят использовать Data Box для употребления данных, они делают это, потому что они думают, что это увеличит скорость их развертывания или потому, что это поможет с ограниченной пропускной способностью сценариев. Хотя это правда, что использование box данных для поглаживания данных в развертывании Azure File Sync уменьшит использование пропускной способности, это, вероятно, будет быстрее для большинства сценариев, чтобы продолжить онлайн загрузку данных с помощью одного из методов, описанных выше. Чтобы узнать больше о том, как использовать data Box для [Migrate data into Azure File Sync with Azure Data Box](storage-sync-offline-data-transfer.md)поимки данных в развертывание Azure File Sync, см.

Распространенной ошибкой, которую клиенты совершают при переносе данных в новое развертывание Azure File Sync, является копирование данных непосредственно в общий доступ к файлам Azure, а не на серверах файлов Windows. Хотя Azure File Sync идентифицирует все новые файлы в файле Azure и синхронизирует их обратно в свои файлы Windows, это, как правило, значительно медленнее, чем загрузка данных через файловый сервер Windows. Многие инструменты копирования Azure, такие как AzCopy, имеют дополнительный недостаток, не копируя все важные метаданные файла, такие как метки времени и ACL.

## <a name="antivirus"></a>использование антивирусных программ;
Антивирусные программы работают путем сканирования файлов на наличие известного вредоносного кода, поэтому они могут вызвать отзыв файлов, распределенных по уровням. В агенте синхронизации файлов Azure начиная с версии 4.0 файлам, распределенным по уровням, задан атрибут безопасности Windows FILE_ATTRIBUTE_RECALL_ON_DATA_ACCESS. Рекомендуется обратиться к поставщику программного обеспечения за информацией о том, как настроить решение, чтобы пропускать чтение файлов с таким атрибутом (многие программы делают это автоматически). 

Антивирусные решения Майкрософт — Защитник Windows и служба регистрации сертификатов для сетевых устройств (SCEP) автоматически пропускают чтение файлов с таким атрибутом. В ходе их тестирования обнаружилась небольшая проблема — при добавлении сервера в существующую группу синхронизации файлы размером меньше 800 байт отзываются (скачиваются) на новый сервер. Эти файлы останутся на новом сервере и не будут передаваться, так как они не соответствуют требованиям к размерам для уровней (более 64 КБ).

> [!Note]  
> Поставщики антивирусов могут проверить совместимость между своим продуктом и синхронизацией файлов Azure, используя [набор тестов для антивирусной совместимости Azure File Sync,](https://www.microsoft.com/download/details.aspx?id=58322)который доступен для скачивания в Центре загрузки Майкрософт.

## <a name="backup"></a>Резервное копирование 
Как и антивирусные решения, решения для архивации могут привести к отзыву многоуровневых файлов. Для архивации файловых ресурсов Azure мы рекомендуем использовать облачное решение для архивации вместо локального.

При использовании решения резервного копирования в помещении резервное копирование следует выполнять резервные отпоры на сервере в группе синхронизации с отключенным уровнем облака. При восстановлении используйте параметры восстановления на уровне тома или файла. Файлы, восстановленные с помощью функции восстановления на уровне файлов, будут синхронизированы со всеми конечными точками в группе синхронизации, а существующие файлы — заменены версией, восстановленной из резервной копии.  При восстановлении на уровне тома новые версии файлов в файловом ресурсе Azure или других конечных точках сервера не заменяются.

> [!Note]  
> Восстановление исходного состояния системы (BMR) может привести к непредвиденным результатам и сейчас не поддерживается.

> [!Note]  
> С версией 9 агента Azure File Sync снимки VSS (включая вкладку Предыдущие версии) теперь поддерживаются на томах, которые имеют возможность многоуровневых облаков. Тем не менее, вы должны включить совместимость предыдущей версии через PowerShell. [Подробнее](storage-files-deployment-guide.md).

## <a name="azure-file-sync-agent-update-policy"></a>Политика обновления агента службы синхронизации файлов Azure
[!INCLUDE [storage-sync-files-agent-update-policy](../../../includes/storage-sync-files-agent-update-policy.md)]

## <a name="next-steps"></a>Следующие шаги
* [Параметры брандмауэра и прокси-сервера Синхронизации файлов Azure](storage-sync-files-firewall-and-proxy.md)
* [Планирование развертывания службы файлов Azure](storage-files-planning.md)
* [Развертывание Файлов Azure](storage-files-deployment-guide.md)
* [Развертывание Синхронизации файлов Azure](storage-sync-files-deployment-guide.md)
* [Мониторинг службы "Синхронизация файлов Azure"](storage-sync-files-monitoring.md)