---
title: Перемотка серии StorSimple 8000 в синхронизацию файлов Azure
description: Узнайте, как перенести прибор StorSimple 8100 или 8600 в синхронизацию файлов Azure.
author: fauhse
ms.service: storage
ms.topic: conceptual
ms.date: 03/09/2020
ms.author: fauhse
ms.subservice: files
ms.openlocfilehash: 7f0c4da7caf71670746e84d5cfaa457ebae57156
ms.sourcegitcommit: 441db70765ff9042db87c60f4aa3c51df2afae2d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2020
ms.locfileid: "80755046"
---
# <a name="storsimple-8100-and-8600-migration-to-azure-file-sync"></a>StorSimple 8100 и 8600 миграция в Azure File Sync

Серия StorSimple 8000 представлена либо 8100, либо 8600 физическими, предприимчивыми приборами и компонентами облачных сервисов. Можно перенести данные из любого из этих приборов в среду синхронизации файлов Azure. Azure File Sync — это служба по умолчанию и стратегическое долгосрочное обслуживание Azure, в которую можно перенести устройства StorSimple.

Серия StorSimple 8000 достигнет [своего конца жизни](https://support.microsoft.com/en-us/lifecycle/search?alpha=StorSimple%208000%20Series) в декабре 2022 года. Важно как можно скорее приступить к планированию миграции. В этой статье представлены необходимые справочные знания и шаги миграции для успешной миграции в Azure File Sync. 

## <a name="azure-file-sync"></a>Служба синхронизации файлов Azure

> [!IMPORTANT]
> Корпорация Майкрософт обязуется помогать клиентам в их миграции. Email AzureFilesMigration@microsoft .com для индивидуального плана миграции, а также помощь во время миграции.

Azure File Sync — это облачный сервис Майкрософт, основанный на двух основных компонентах:

* Синхронизация файлов и многоуровневое обработка.
* Файлы как нативная хранилище в Azure, к которым можно получить доступ по нескольким протоколам, таким как SMB и файл REST. Доля файлов Azure сопоставима с долей файлов на сервере Windows, которую можно смонтировать в качестве сетевого диска. Он поддерживает важные аспекты точности файлов, такие как атрибуты, разрешения и метки времени. С помощью акций файлов Azure больше нет необходимости в приложении или службе для интерпретации файлов и папок, хранящихся в облаке. Вы можете получить к ним доступ по сравнению с знакомыми протоколами и клиентами, такими как Windows File Explorer. Это делает доступ к файлу Azure идеальным и наиболее гибким подходом к хранению данных файлового сервера общего назначения, а также некоторых данных приложения в облаке.

В этой статье основное внимание уделяется шагам миграции. Если перед миграцией вы хотите узнать больше о Azure File Sync, мы рекомендуем следующие статьи:

* [Синхронизация файлов Azure - обзор](https://aka.ms/AFS "Обзор")
* [Синхронизация файлов Azure - руководство по развертыванию](storage-sync-files-deployment-guide.md)

## <a name="migration-goals"></a>Цели миграции

Цель состоит в том, чтобы гарантировать целостность производственных данных, а также гарантировать доступность. Последнее требует сохранения времени простоя до минимума, так что он может вписаться в или лишь незначительно превысить обычные окна обслуживания.

## <a name="storsimple-8000-series-migration-path-to-azure-file-sync"></a>Путь миграции серии StorSimple 8000 в синхронизацию файлов Azure

Для запуска агента Azure File Sync требуется локальный Windows Server. Сервер Windows может быть как минимум 2012R2 сервера, но в идеале это Windows Server 2019.

Существует множество альтернативных путей миграции, и это создаст слишком длинную статью, чтобы задокументировать все из них и проиллюстрировать, почему они несут риск или недостатки по сравнению с маршрутом, который мы рекомендуем в качестве наилучшей практики в этой статье.

![Обзор фаз миграции серии StorSimple 8000](media/storage-files-migration-storsimple-shared/storsimple-8000-migration-overview.png "Обзор маршрутов миграции серии StorSimple 8000 далее ниже в этой статье.")

На предыдущем изображении показаны фазы, соответствующие разделам в этой статье.
Мы используем миграцию в облачную сторону, чтобы избежать ненужного отзыва файлов на локальном приборе StorSimple. Этот подход позволяет избежать влияния на поведение локального кэширования или использование пропускной способности сети, любой из которых может повлиять на производственные нагрузки.
Миграция в облачной стороне работает на моментальном снимке (клоне громкости) ваших данных. Таким образом, ваши производственные данные изолированы от этого процесса - до перерезания в конце миграции. Отработка того, что по существу является резервной, делает миграцию безопасной и легко повторяемой, если вы столкнетесь с какими-либо трудностями.

## <a name="considerations-around-existing-storsimple-backups"></a>Рассмотрение существующих резервных отсутсвий StorSimple

StorSimple позволяет принимать резервные копирования в виде объемных клонов. В этой статье используется новый томный клон для переноса живых файлов.
Если вам необходимо перенести резервные отстаи в дополнение к вашим живым данным, то все рекомендации в этой статье по-прежнему применяются. Разница лишь в том, что вместо того, чтобы начинать с нового тома клона, вы начнете с самого старого резервного объема клона вам нужно мигрировать.

Последовательность выглядит так:

* Определите минимальный набор объемных клонов, которые необходимо мигрировать. По возможности мы рекомендуем свести этот список к минимуму, поскольку чем больше резервных служб будет переноситься, тем дольше займет общий процесс миграции.
* При прохождении процесса миграции начните с самого старого тома-клона, который вы собираетесь мигрировать, и при каждой последующей миграции используйте следующий старейший.
* Когда каждая миграция клона тома завершается, необходимо сделать снимок совместного файла Azure. [Снимки совместного файла Azure](storage-snapshots-files.md) — это то, как вы храните резервные копирования файлов и структуры папок Для разделов файлов Azure. Эти снимки понадобятся после завершения миграции, чтобы убедиться, что вы сохранили версии каждого из ваших клонов тома по мере прохождения миграции.
* Убедитесь, что вы берете снимки совместного файла Azure для всех файлов Azure, которые обслуживаются тем же объемом StorSimple. Клоны объемов находятся на уровне объема, снимки совместного файла Azure — на уровне общего. После завершения миграции клона громкости необходимо сделать снимок общего обмена (на каждой совместной части файла Azure).
* Повторите процесс миграции для томного клона и снимая снимки общего объема после каждого клона тома, пока не увязнете с моментальным снимком живых данных. Процесс миграции громкого клона описан на этапах ниже. 

Если вам вообще не нужно перемещать резервные отжимы и вы можете запустить новую цепочку резервных отсталок на стороне совместного использования файла Azure после переноса только живых данных, то это выгодно для уменьшения сложности миграции и времени, которое займет миграция. Вы можете принять решение о том, следует ли перемещать резервные копирования и сколько для каждого тома (не каждая акция) у вас есть в StorSimple.

## <a name="phase-1-get-ready"></a>Фаза 1: Приготовьтесь

:::row:::
    :::column:::
        ![Изображение, иллюстрирующее часть более раннего обзора изображения, которое помогает сфокусировать этот подраздел статьи.](media/storage-files-migration-storsimple-shared/storsimple-8000-migration-phase-1.png)
    :::column-end:::
    :::column:::
        Основой миграции является объемклона и виртуального облачного прибора под названием StorSimple 8020.
На этом этапе основное внимание уделяется развертыванию этих ресурсов в Azure.
    :::column-end:::
:::row-end:::

### <a name="deploy-a-storsimple-8020-virtual-appliance"></a>Развертывание виртуального устройства StorSimple 8020

Развертывание облачного прибора — это процесс, требующий безопасности, сетей и некоторых других соображений.

> [!IMPORTANT]
> Следующее руководство содержит некоторые ненужные разделы. Читайте и следуйте статье от начала до "Шаг 3". Затем вернитесь к этой статье. Вам не нужно, чтобы завершить "Шаг 3" или что-нибудь за его пределами в этом руководстве, в это время.

[Развертывание виртуального устройства StorSimple 8020](../../storsimple/storsimple-8000-cloud-appliance-u2.md)

### <a name="determine-a-volume-clone-to-use"></a>Определение громкого клона для использования

Когда вы будете готовы начать миграцию, первым шагом будет новый объем клона - так же, как вы бы для резервного копирования - что отражает текущее состояние вашего sorSimple облачного хранилища. Возьмите клон для каждого из объемов StorSimple у вас есть.
Если вы нуждаетесь в перемещении резервных upups, то первый объем клона вы используете не вновь созданный клон, но старейший объем клона (старейшее резервное копирование) вам нужно мигрировать.
Обратитесь к разделу ["Рассмотрение существующих резервных копирований StorSimple"](#considerations-around-existing-storsimple-backups) для получения подробных рекомендаций.

> [!IMPORTANT]
> Следующее руководство содержит некоторые ненужные разделы. Прочитайте и следуйте только шагам, изложенным в связанном с разделом разделе. Затем вернитесь к этой статье. Вам не нужно следовать разделу "Следующие шаги".

[Создание клона тома](../../storsimple/storsimple-8000-clone-volume-u2.md#create-a-clone-of-a-volume)

### <a name="use-the-volume-clone"></a>Использование громкого клона

Последняя фаза 1 заключается в том, чтобы сделать выбранный вами объем клоном доступным на виртуальном приборе 8020 в Azure.

> [!IMPORTANT]
> Следующее руководство содержит необходимые шаги, но также - в конце - инструкция по форматированию тома. **НЕ ФОРМАТИРЯ ТОМА** Читайте и следуйте связаны с "раздел 7" от начала до инструкции: "10. Для формата простого тома, ..."  Остановитесь перед этим шагом и вернитесь к этой статье.

[Установите объемклона на виртуальном приборе 8020 в Azure](../../storsimple/storsimple-8000-deployment-walkthrough-u2.md#step-7-mount-initialize-and-format-a-volume)

### <a name="phase-1-summary"></a>Резюме фазы 1

Теперь, когда вы завершили этап 1, вы сделаете следующее:

* Развернута виртуальная приборка StorSimple 8020 в Azure.
* Определяется, с какого объема вы начнете миграцию.
* Устанавливается ваш объем клона (ы) (по одному для каждого живого тома) в виртуальном приборе StorSimple в Azure, с его данными, доступными для дальнейшего использования.

## <a name="phase-2-cloud-vm"></a>Фаза 2: Облако VM

:::row:::
    :::column:::
        ![Изображение, иллюстрирующее часть более раннего обзора изображения, которое помогает сфокусировать этот подраздел статьи.](media/storage-files-migration-storsimple-shared/storsimple-8000-migration-phase-2.png)
    :::column-end:::
    :::column:::
        После того, как ваш первоначальный клон доступен на виртуальном приборе StorSimple 8020 в Azure, пришло время предоставить VM и разоблачить клон тома (или несколько) к тому VM над iSCSI.
    :::column-end:::
:::row-end:::

### <a name="deploy-an-azure-vm"></a>Развертывание Azure VM

Виртуальная машина Windows Server в Azure похожа на StorSimple 8020, временную часть инфраструктуры, которая необходима только во время миграции.
Конфигурация развертываемого VM в основном зависит от количества элементов (файлов и папок), которые вы будете синхронизировать. Мы рекомендуем идти с более высокой конфигурацией производительности, если у вас есть какие-либо проблемы.

Один Windows Server может синхронизировать до 30 файлов Azure.
Спецификации, которые вы решаете о необходимости охватить каждую акцию / путь или корень громкости StorSimple и рассчитывать элементы (файлы и папки).

Общий размер данных меньше узкое место - это количество элементов, вам нужно адаптировать спецификации машины.

* [Узнайте, как размер сервера Windows на основе количества элементов (файлов и папок), которые необходимо синхронизировать.](storage-sync-files-planning.md#recommended-system-resources)

    **Пожалуйста, обратите внимание:** В ранее связанной статье представлена таблица с диапазоном памяти сервера (RAM). Ориентируйся на большое количество для Azure VM. Вы можете сориентироваться на меньшее число для вашей предприимчивой машины.

* [Узнайте, как развернуть Windows Sever VM.](../../virtual-machines/windows/quick-create-portal.md)

> [!IMPORTANT]
> Убедитесь, что VM развернут в том же регионе Azure, что и виртуальный прибор StorSimple 8020. Если в рамках этой миграции необходимо также изменить область облачных данных из области, в котором они хранятся сегодня, вы можете сделать это на более позднем этапе, когда вы предоставляете акции файлов Azure.

> [!IMPORTANT]
> Часто, на переднем Windows Server используется для передней передней передней передней StorSimple устройства. В такой конфигурации можно включить функцию[«Дедолляция данных»](https://docs.microsoft.com/windows-server/storage/data-deduplication/install-enable)на этом Сервере Windows. **Если вы использовали Deduplication данных с данными StorSimple, убедитесь, что вы включить Deduplication данных на этом Azure VM, а также.** Не путайте эту dedupliclication уровня файлов со встроенным блок-уровня deduplication, для которого никаких действий не требуется.

> [!IMPORTANT]
> Чтобы оптимизировать производительность, разместите **быстрый диск ОС** для вашего облачного VM. Вы будете хранить базу данных синхронизации на диске ОС для всех объемов данных. Кроме того, убедитесь, что вы создаете **большой диск ОС**. В зависимости от количества элементов (файлов и папок) в объемах StorSimple, диску ОС может потребоваться **несколько сотен GiB** пространства для размещения базы данных синхронизации.

### <a name="expose-the-storsimple-8020-volumes-to-the-azure-vm"></a>Выставляем тома StorSimple 8020 на Azure VM

На этом этапе вы подключаете один или несколько томов StorSimple от виртуального устройства 8020 по iSCSI к подготовленного вами Windows Server VM.

> [!IMPORTANT]
> Для следующих статей, полный только **Получить частный IP для облачных приборов** и **подключиться к разделам iSCSI** и вернуться к этой статье.

1. [Получение частного IP-адреса для облачного устройства](../../storsimple/storsimple-8000-cloud-appliance-u2.md#get-private-ip-for-the-cloud-appliance)
2. [Подключение через iSCSI](../../storsimple/storsimple-8000-deployment-walkthrough-u2.md#step-7-mount-initialize-and-format-a-volume)

### <a name="phase-2-summary"></a>Резюме фазы 2

Теперь, когда вы завершили фазу 2, у вас есть: 

* Подготовлен Оси-сервер VM в том же регионе, что и виртуальный прибор StorSimple 8020
* Раскрыты все применимые тома от 8020 до Windows Server VM над iSCSI.
* Теперь вы должны видеть содержимое файла и папки, когда вы используете File Explorer на сервере VM на установленных томах.

Переходите к фазе 3, когда вы завершили эти шаги для всех томов, которые нуждаются в миграции.

## <a name="phase-3-set-up-azure-file-shares-and-get-ready-for-azure-file-sync"></a>Фаза 3: Настройка акций файлов Azure и подготовка к синхронизации файлов Azure

:::row:::
    :::column:::
        ![Изображение, иллюстрирующее часть более раннего обзора изображения, которое помогает сфокусировать этот подраздел статьи.](media/storage-files-migration-storsimple-shared/storsimple-8000-migration-phase-3.png)
    :::column-end:::
    :::column:::
        На этом этапе вы будете определять и создавать несколько файлов Azure, создавая Windows Server в качестве замены устройства StorSimple и настраивая этот сервер для синхронизации файлов Azure. 
    :::column-end:::
:::row-end:::

### <a name="map-your-existing-namespaces-to-azure-file-shares"></a>Отобразите существующие области имен в файлы Azure

[!INCLUDE [storage-files-migration-namespace-mapping](../../../includes/storage-files-migration-namespace-mapping.md)]

### <a name="deploy-azure-file-shares"></a>Развертывание акций файлов Azure

[!INCLUDE [storage-files-migration-provision-azfs](../../../includes/storage-files-migration-provision-azure-file-share.md)]

> [!TIP]
> Если необходимо изменить область Azure из текущего региона, в котором находится данные StorSimple, довествуйте до акций файлов Azure в новом регионе, который вы хотите использовать. Регион определяется, выбирая его при предоставлении учетных записей хранения, в которых хранятся ваши доли файлов Azure. Убедитесь, что ресурс Azure File Sync, который вы предоставите ниже, находится в том же новом регионе.

### <a name="deploy-the-azure-file-sync-cloud-resource"></a>Развертывание облачного ресурса Azure File Sync

[!INCLUDE [storage-files-migration-deploy-afs-sss](../../../includes/storage-files-migration-deploy-azure-file-sync-storage-sync-service.md)]

> [!TIP]
> Если вам необходимо изменить область Azure из текущего региона, в котором находится данные StorSimple, вы создали учетные записи хранилища для ваших файлов Azure в новом регионе. Убедитесь, что вы выбрали тот же регион при развертывании службы синхронизации данных.

### <a name="deploy-an-on-premises-windows-server"></a>Развертывание внутреннего Windows-сервера

* Создайте Windows Server 2019 - как минимум 2012R2 - в качестве виртуальной машины или физического сервера. Кластер сбоя Windows Server также поддерживается. Не повторно использовать сервер, который вы, возможно, фасадом StorSimple 8100 или 8600.
* Предоставление или добавление прямого прикрепленного хранилища (DAS по сравнению с NAS, которое не поддерживается).

Лучше всего предоставить вашему новому Windows Server равное или большее количество памяти, чем ваш прибор StorSimple 8100 или 8600, доступный локально для кэширования. Вы будете использовать Windows Server так же, как вы использовали прибор StorSimple, если он имеет такое же количество памяти, как прибор, то опыт кэширования должен быть аналогичным, если не то же самое.
Вы можете добавить или удалить хранилище с Windows Server по своему усмотрению. Это позволяет масштабировать локальный размер объема и объем локального хранилища, доступного для кэширования.

### <a name="prepare-the-windows-server-for-file-sync"></a>Подготовка Windows Server к синхронизации файлов

[!INCLUDE [storage-files-migration-deploy-afs-agent](../../../includes/storage-files-migration-deploy-azure-file-sync-agent.md)]

### <a name="configure-azure-file-sync-on-the-windows-server"></a>Настройка синхронизации файлов Azure на сервере Windows

Ваш зарегистрированный на территории Windows Server должен быть готов и подключен к Интернету для этого процесса.

[!INCLUDE [storage-files-migration-configure-sync](../../../includes/storage-files-migration-configure-sync.md)]

> [!WARNING]
> **Обязательно включите многоуровневое облако!** Облачное многоуровневое является функцией AFS, которая позволяет локальному серверу иметь меньше емкости для хранения, чем хранится в облаке, но при этом имеет полное пространство имен. Локально интересные данные также кэшируется локально для быстрой, локальной производительности доступа. Еще одна причина, по которой на этом этапе включить многоуровневое облако заключается в том, что мы не хотим синхронизировать содержимое файлов на данном этапе, только пространство имен должно двигаться в это время.

## <a name="phase-4-configure-the-azure-vm-for-sync"></a>Фаза 4: Настройка Azure VM для синхронизации

:::row:::
    :::column:::
        ![Изображение, иллюстрирующее часть более раннего обзора изображения, которое помогает сфокусировать этот подраздел статьи.](media/storage-files-migration-storsimple-shared/storsimple-8000-migration-phase-4.png)
    :::column-end:::
    :::column:::
        Эта фаза касается вашего Azure VM с установленным iSCSI, клоном первого тома (ы). На этом этапе вы получите VM подключен через Azure File Sync и начать первый раунд перемещения файлов из громкости StorSimple клон (ы).
        
    :::column-end:::
:::row-end:::

Вы уже настроили свой штатный сервер, который заменит ваш прибор StorSimple 8100 или 8600 для синхронизации файлов Azure. 

Настройка Azure VM является практически идентичным процессом с одним дополнительным шагом. Следующие шаги помогут вам пройти через этот процесс.

> [!IMPORTANT]
> Важно, чтобы Azure VM **не был настроен с включенным облачным уровнем!** Объем этого сервера будет обмениваться новыми клонами громкости на протяжении всей миграции. Облачное многоуровневое не имеет преимуществ и накладных расходов на использование процессора, который следует избегать.

1. [Развертывание агента AFS. (см. предыдущий раздел)](#prepare-the-windows-server-for-file-sync)
2. [Подготовка VM для синхронизации файлов Azure.](#get-the-vm-ready-for-azure-file-sync)
3. [Синхронизация настройки](#configure-azure-file-sync-on-the-azure-vm)

### <a name="get-the-vm-ready-for-azure-file-sync"></a>Приготовьтесь к синхронизации файлов Azure

Azure File Sync используется для перемещения файлов из установленных объемов iSCSI StorSimple в целевые доли файлов Azure.
Во время этого процесса миграции, вы установите несколько клонов тома к вашему VM, под таким же письмом привода. Синхронизация файлов Azure должна быть настроена таким образом, чтобы увидеть следующий томный клон, который вы установили в качестве новой версии файлов и папок, и обновить доли файлов Azure, подключенные через Azure File Sync. 

> [!IMPORTANT]
> Для того чтобы это сработало, ключ реестра должен быть установлен на сервере до настройки синхронизации файлов Azure.

1. Создайте новый каталог на системном диске VM. Информация Azure File Sync должна сохраняться там, а не на установленных клонах громкости. Например: `"C:\syncmetadata"`
2. Открыть regedit и найти следующий улей реестра:`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Azure\StorageSync`
3. Создайте новый ключ строки типа, названный: ***MetadataRootPath***
4. Установите полный путь к каталогу, созданного в объеме системы, например:`C:\syncmetadata"`

### <a name="configure-azure-file-sync-on-the-azure-vm"></a>Настройка синхронизации файлов Azure на Azure VM

Этот шаг аналогичен предыдущему разделу, в который обсуждается, как настроить AFS на предприимчивом сервере.

Разница в том, что вы не должны включать многоуровневое облако на этом сервере и что вам нужно убедиться, что правильные папки подключены к правильным долям файлов Azure. В противном случае ваше наименование акций файлов Azure и содержимого данных не будет совпадать, и без перенастройки синхронизации невозможно переименовать облачные ресурсы или локальные папки.

Обратитесь к [предыдущему разделу о том, как настроить синхронизацию файлов Azure на сервере Windows.](#configure-azure-file-sync-on-the-windows-server)

### <a name="step-4-summary"></a>Шаг 4 резюме

На этом этапе вы успешно настроите синхронизацию файлов Azure на Azure VM, который вы установили на своем томном клоне StorSimple (ы) через iSCSI.
Данные теперь перетекают из Azure VM в различные файлы Azure, а оттуда на вашем предприимчивом Сервере Windows появляется полностью усталое пространство имен.

> [!IMPORTANT]
> Убедитесь, что в настоящее время на сервере Windows Server не вносятся изменения или доступ пользователей.

Первоначальные данные о томе клона, перемещаемые через Azure VM в файлы Azure, могут занять много времени, возможно недель. Оценка времени это займет сложно и зависит от многих факторов. В частности, скорость, с которой Azure VM может получить доступ к файлам на томах StorSimple и как быстрая синхронизация файлов Azure Может обрабатывать файлы и папки, которые нуждаются в синхронизации. 

Из опыта можно предположить, что пропускная способность - следовательно, фактический размер данных - играет подчиненную роль. Время, которое займет этот или любой последующий раунд миграции, в основном зависит от количества элементов, которые могут быть обработаны в секунду. Так, например, 1 TiB с 100000 файлов и папок, скорее всего, закончить медленнее, чем 1 TiB только с 50000 файлов и папок.

## <a name="phase-5-iterate-through-multiple-volume-clones"></a>Фаза 5: Итерировать через несколько клонов тома

:::row:::
    :::column:::
        ![Изображение, иллюстрирующее часть более раннего обзора изображения, которое помогает сфокусировать этот подраздел статьи.](media/storage-files-migration-storsimple-shared/storsimple-8000-migration-phase-5.png)
    :::column-end:::
    :::column:::
        Как обсуждалось на предыдущем этапе, начальная синхронизация может занять много времени. Ваши пользователи и приложения по-прежнему получают доступ к припредствок StorSimple 8100 или 8600. Это означает, что изменения накапливаются, и с каждым днем образуется большая дельта между живыми данными и исходным клоном громкости, который в настоящее время миграция. В этом разделе вы узнаете, как свести к минимуму время простоя, используя несколько клонов тома и сообщая, когда синхронизация сделана.
    :::column-end:::
:::row-end:::

К сожалению, миграционный процесс не является мгновенным. Это означает, что вышеупомянутая дельта к живым данным является неизбежным следствием. Хорошей новостью является то, что вы можете повторить процесс монтажа новых клонов тома. Дельта каждого тома клона будет постепенно меньше. Таким образом, в конечном итоге синхронизация завершится в течение времени, которое вы считаете приемлемым для принятия пользователей и приложений в автономном режиме, чтобы сократить до вашего внутреннего сервера Windows.

Повторите следующие шаги до тех пор, пока синхронизация не завершится достаточно быстро, что вы чувствуете себя комфортно принимая пользователей и приложений в автономном режиме:

1. [Определение синхронизации завершено для заданного объема клона.](#determine-when-sync-is-done)
2. [Возьмите новый объем клона (ы) и смонтировать его на 8020 виртуальный прибор.](#the-next-volume-clones)
3. [Определите, когда синхронизация сделана.](#determine-when-sync-is-done)
4. [Стратегия сокращения](#cut-over-strategy)

### <a name="the-next-volume-clones"></a>Клон следующего тома (ы)

Мы обсудили принятие объем клона (ы) ранее в этой статье.
Этот этап имеет два действия:

1. [Возьмите объем клона](../../storsimple/storsimple-8000-clone-volume-u2.md#create-a-clone-of-a-volume)
2. [Гора, что объем клона (см. выше)](#use-the-volume-clone)

### <a name="determine-when-sync-is-done"></a>Определение того, когда синхронизация сделана

Когда синхронизация будет сделана, вы можете остановить измерение времени и определить, если вам нужно повторить процесс принятия клона громкости и монтажа его или если время синхронизации с последним клоном тома было достаточно небольшим.

Для определения синхронизации является полным:

1. Откройте viewer события и перейдите к **приложениям и службам**
2. Навигация и открытие **Microsoft-FileSync/Агент/Телеметрия**
3. Ищите последнее **событие 9102**, которое соответствует завершенной сессии синхронизации
4. Выберите **подробную информацию** и подтвердите, что значение **SyncDirection** **загружено**
5. Проверьте **HResult** и подтвердить, что он показывает **0**. Это означает, что сеанс синхронизации был успешным. Если HResult является ненулевым значением, то при синхронизации произошла ошибка. Если **PerItemErrorCount** больше, чем 0, то некоторые файлы или папки не синхронизированы должным образом. Результат HResult может быть равен 0, а результат PerItemErrorCount при этом — больше 0. На данный момент вам не нужно беспокоиться о PerItemErrorCount. Мы поймаем эти файлы позже. Если количество ошибок является значительным, тысячи элементов, обратитесь в службу поддержки и попросите подключиться к группе продуктов Azure File Sync для прямого руководства по лучшим и следующим этапам.
6. Проверьте, чтобы увидеть несколько событий 9102 с HResult 0 в строке. Это означает, что синхронизация завершена для этого объема клона.

### <a name="cut-over-strategy"></a>Стратегия сокращения

1. Определите, достаточно ли быстро синхронизация от громкого клона. (Дельта достаточно мала.)
2. Переважи прибор StorSimple в автономный режим.
3. Окончательный RoboCopy.

Измерьте время и определите, может ли синхронизация с недавнего тофа может закончиться в течение временного окна достаточно мал, что вы можете позволить себе как простои в вашей системе.

Настало время отключить доступ пользователей к прибору StorSimple. Больше никаких изменений. Время простоя началось.
Вы должны оставить прибор в Интернете и подключены, но теперь должны предотвратить изменения на нем.

На шестой стадии вы догоните любую дельту в живых данных с момента последнего клона тома.

## <a name="phase-6-a-final-robocopy"></a>Фаза 6: Окончательный RoboCopy

На данный момент, Есть два различия между вашим на-предах Windows Server и StorSimple 8100 или 8600 прибор:

1. Могут быть файлы, которые не синхронизированы (см. **PerItemErrors** из журнала событий выше)
2. Прибор StorSimple имеет населенный кэш против Windows Server просто пространство имен без содержимого файла, хранящегося локально в это время.

![Изображение, иллюстрирующее часть более раннего обзора изображения, которое помогает сфокусировать этот подраздел статьи.](media/storage-files-migration-storsimple-shared/storsimple-8000-migration-phase-6.png)

Мы можем довести кэш Windows Server до состояния устройства и гарантировать, что ни один файл не остался с окончательным RoboCopy.

> [!CAUTION]
> Крайне важно, чтобы команда RoboCopy, за которым вы следуете, точно так же, как описано ниже. Мы хотим копировать только локальные файлы и файлы, которые ранее не перемещались по подходу к тому клонов синхронизации. Мы можем решить проблемы, почему они не синхронизированы позже, после завершения миграции. [(См. устранение неполадок Azure File Sync.](storage-sync-files-troubleshoot.md#how-do-i-see-if-there-are-specific-files-or-folders-that-are-not-syncing) Это, скорее всего, непечатные символы в именах файлов, которые вы не пропустите, когда они будут удалены.)

Команда RoboCopy:

```console
Robocopy /MT:32 /UNILOG:<file name> /TEE /B /MIR /COPYALL /DCOPY:DAT <SourcePath> <Dest.Path>
```

Фон:

:::row:::
   :::column span="1":::
      /MT
   :::column-end:::
   :::column span="1":::
      Позволяет RoboCopy работать многопоните. По умолчанию 8, макс 128.
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /ВЕДОМОСТИ:<file name>
   :::column-end:::
   :::column span="1":::
      Состояние выводов в файл LOG как UNICODE (перезаписывает существующий журнал).
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /TEE
   :::column-end:::
   :::column span="1":::
      Выходы на консоль окна. Используется в сочетании с выводом в файл журнала.
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /B
   :::column-end:::
   :::column span="1":::
      Запускает RoboCopy в том же режиме, что и резервное приложение. Это позволяет RoboCopy перемещать файлы, на которые у текущего пользователя нет разрешений.
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /МИР
   :::column-end:::
   :::column span="1":::
      Позволяет RoboCopy рассматривать только дельты между источником (прибор StorSimple) и целевым (каталог Windows Server).
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /COPY:copyflag's
   :::column-end:::
   :::column span="1":::
      верность копии файла (по умолчанию /COPY:DAT), флаги копирования: D'Data, Атрибуты, T'Timestamps, S'Security-NTFS ACLs, Информация о владельце, информация о U'aUditing
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /КОПИАЛ
   :::column-end:::
   :::column span="1":::
      COPY ALL файл информация (эквивалент /COPY:DATSOU)
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /DCOPY:copyflag
   :::column-end:::
   :::column span="1":::
      верность копии каталогов (по умолчанию /DCOPY:DA), флаги копирования: D'Data, A'Attributes, T'Timestamps
   :::column-end:::
:::row-end:::

Вы должны запустить эту команду RoboCopy для каждого из каталогов на сервере Windows в качестве цели, которую вы настроили с синхронизацией файлов в файл Azure.

Вы можете запускать несколько этих команд параллельно.
После завершения этого шага RoboCopy вы можете разрешить пользователям и приложениям доступ к Windows Server, как это было раньше с прибором StorSimple.

Проконсультируйтесь с файлом журнала robocopy (ы), чтобы увидеть, если файлы были оставлены позади. Если проблемы должны существовать, в большинстве случаев их можно решить после завершения миграции и повторного вхостачии пользователей и приложений на ваш Windows Server. Если вам нужно устранить какие-либо проблемы, сделайте это до этапа 7.

Скорее всего, необходимо создать sMB-акции на Сервере Windows, которые были у вас на данных StorSimple раньше. Вы можете загрузить этот шаг и сделать это раньше, чтобы не терять время здесь, но вы должны убедиться, что до этого момента, никаких изменений в файлах происходят на сервере Windows.

Если у вас есть развертывание DFS-N, вы можете указать DFN-Namespaces на новые места папки сервера. Если у вас нет развертывания DFS-N, и вы перед вашим 8100 8600 устройства локально с Windows Server, вы можете принять этот сервер от домена, и домен присоединиться к вашему новому серверу Windows Server с AFS в домен, дать ему то же имя сервера, как старый сервер, и те же имена акций, то сокращение на новый сервер остается прозрачным для пользователей остается прозрачным для пользователей , групповая политика или сценарии.

## <a name="phase-7-deprovision"></a>Фаза 7: Деобеспечение

На последнем этапе вы итерировали через несколько клонов тома, и в конечном итоге смогли сократить доступ пользователей к новому Windows Server после принятия вас StorSimple устройства в автономном режиме.

Теперь вы можете начать дезавуировать ненужные ресурсы.
Перед началом — нанекоторое время наблюдать за новым развертыванием Azure File Sync в производственной области. Это дает вам возможность исправить любые проблемы, с которыми вы можете столкнуться.

После того как вы удовлетворены и наблюдали за развертыванием AFS, по крайней мере, несколько дней, вы можете начать дезавуировать ресурсы в этом порядке:

1. Выключите VM Azure, который мы использовали для перемещения данных из потоковых клонов в файлы Azure через синхронизацию файлов.
2. Перейдите на ресурс службы синхронизации хранения в Azure и отменить регистрацию VM Azure. Это удаляет его из всех групп синхронизации.

    > [!WARNING]
    > **ENSURE вы выбираете правильную машину.** Вы выключили облако VM, это означает, что он должен отображаться как единственный автономный сервер в списке зарегистрированных серверов. Вы не должны выбирать на этом этапе windows Server, что приведет к его отмене.

3. Удалите Azure VM и его ресурсы.
4. Отключить 8020 виртуальный прибор StorSimple.
5. Дезаубиризить все ресурсы StorSimple в Azure.
6. Отключите физический прибор StorSimple из центра обработки данных.

Миграция завершена.

## <a name="next-steps"></a>Дальнейшие действия

Узнать больше о синхронизации файлов Azure. Особенно с гибкостью политик и многоуровневых облаков.

Если вы видите на портале Azure или из предыдущих событий, что некоторые файлы постоянно не синхронизируются, просмотрите руководство по устранению неполадок для шагов по устранению этих проблем.

* [Обзор синхронизации файлов Azure: aka.ms/AFS](https://aka.ms/AFS)
* [Облачные многоуровневые](storage-sync-cloud-tiering.md) 
* [Руководство по устранению неполадок Azure File Sync](storage-sync-files-troubleshoot.md)
