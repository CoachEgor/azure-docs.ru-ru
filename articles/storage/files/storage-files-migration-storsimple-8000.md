---
title: Миграция рядов StorSimple 8000 в Синхронизация файлов Azure
description: Узнайте, как перенести устройство StorSimple 8100 или 8600 в Синхронизация файлов Azure.
author: fauhse
ms.service: storage
ms.topic: conceptual
ms.date: 03/02/2020
ms.author: fauhse
ms.subservice: files
ms.openlocfilehash: 78100a5dd38b211f6b0241d5a0bac10cf86b09f6
ms.sourcegitcommit: e4c33439642cf05682af7f28db1dbdb5cf273cc6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2020
ms.locfileid: "78250946"
---
# <a name="storsimple-8100-and-8600-migration-to-azure-file-sync"></a>Миграция StorSimple 8100 и 8600 на Синхронизация файлов Azure

Серия StorSimple 8000 представляет два отдельных номера SKU, и их можно перенести из одного из этих SKU в Синхронизация файлов Azureную среду. В этой статье рассматривается миграция обоих устройств в Синхронизация файлов Azure и приводятся необходимые шаги для фонового набора знаний и миграции, позволяющие выполнить миграцию для Синхронизация файлов Azure успеха.

## <a name="azure-file-sync"></a>Служба синхронизации файлов Azure

Синхронизация файлов Azure — это облачная служба Майкрософт, основанная на двух основных компонентах:

* Синхронизация файлов и распределение по уровням облака.
* Общие файловые ресурсы как собственные хранилища в Azure, к которым можно получить доступ по нескольким протоколам, таким как SMB и File RESTFUL. Общая папка Azure сравнима с общей папкой на сервере Windows Server, которую можно подключить как сетевой диск. Он поддерживает важные аспекты качества файла, такие как атрибуты, разрешения и метки времени. При использовании файловых ресурсов Azure больше не требуется, чтобы приложение или служба считали файлы и папки, хранящиеся в облаке. К ним можно обращаться по привычным протоколам и клиентам, например проводнику Windows. Это делает файловый ресурс Azure идеальным и наиболее гибким подходом к хранению данных файлового сервера общего назначения, а также к некоторым данным приложений в облаке.

В этой статье рассматриваются этапы миграции. Если перед миграцией вы хотите узнать больше о Синхронизация файлов Azure, мы рекомендуем использовать следующие статьи:

* [Общие сведения о Синхронизация файлов Azure](https://aka.ms/AFS "Обзор")
* [Рекомендации по развертыванию Синхронизация файлов Azure](storage-sync-files-deployment-guide.md)

## <a name="migration-goals"></a>Цели миграции

Цель заключается в том, чтобы гарантировать целостность производственных данных, а также обеспечить доступность. Последний требует, чтобы время простоя не превышало минимального, так что оно может поместиться в или только немного больше, чем обычные периоды обслуживания.

## <a name="storsimple-8000-series-migration-path-to-azure-file-sync"></a>Путь миграции серии StorSimple 8000 к Синхронизация файлов Azure

Для запуска агента Синхронизация файлов Azure требуется локальный сервер Windows Server. Windows Server может быть как минимум сервером 2012 R2, но в идеале это Windows Server 2019.

Существует множество альтернативных путей перехода, и они могут создать слишком длинную статью, чтобы задокументировать все эти данные и продемонстрировать, почему в этой статье мы рекомендуем использовать для этого маршрута риск или недостатки.

![Обзор этапов миграции для серии StorSimple 8000](media/storage-files-migration-storsimple-shared/storsimple-8000-migration-overview.png "Маршрут миграции StorSimple 8000. Общие сведения о стадиях ниже в этой статье.")

На предыдущем рисунке показаны этапы, соответствующие разделам в этой статье.
Мы используем миграцию на стороне облака, чтобы избежать ненужного отзыва файлов на локальном устройстве StorSimple. Такой подход позволяет избежать влияния локального кэширования или использования пропускной способности сети, которые могут повлиять на рабочие нагрузки.
Облачная миграция работает на моментальном снимке (клоне тома) данных. Так что рабочие данные изолированы от этого процесса, пока не будет выполнена отработка отказа в конце миграции. Работа с тем, что фактически является резервной копией, делает миграцию надежной и легко повторяемой, если у вас возникнут проблемы.

## <a name="considerations-around-existing-storsimple-backups"></a>Рекомендации по существующим резервным копиям StorSimple

StorSimple позволяет создавать резервные копии в виде клонов томов. В этой статье для переноса динамических файлов используется новый клон тома.
Если вам нужно перенести резервные копии вместе с динамическими данными, все рекомендации, описанные в этой статье, будут по-прежнему применяться. Единственное отличие состоит в том, что вместо того, чтобы начинать с нового клона тома, вы начнете с самого старого клона резервного копирования, который необходимо перенести.

Последовательность выглядит так:

* Определите минимальный набор клонов томов, которые необходимо перенести. Рекомендуется по возможности сохранить этот список как минимум, так как в этом случае будет выполнено большее количество резервных копий, чем более длительный процесс миграции.
* При выполнении процесса миграции Начните с самого старого клонирования тома, который планируется перенести, и при каждом последующем переносе используйте следующий самый старый.
* При завершении миграции клонов томов необходимо создать моментальный снимок файлового ресурса Azure. [Моментальные снимки файловых ресурсов Azure](storage-snapshots-files.md) — это то, как вы сохраняете резервные копии файлов и папок в файловых ресурсах Azure на момент времени. Эти моментальные снимки понадобятся после завершения миграции, чтобы гарантировать сохранение версий каждого клона тома по мере выполнения миграции.
* Убедитесь, что вы принимаете моментальные снимки общего файлового ресурса Azure для всех файловых ресурсов Azure, обслуживаемых одним томом StorSimple. Клоны томов находятся на уровне тома, моментальные снимки общего файлового ресурса Azure находятся на уровне общего ресурса. После завершения миграции клона тома необходимо создать моментальный снимок общего ресурса (в каждом файловом ресурсе Azure).
* Повторите процесс миграции для клона тома и создайте моментальные снимки общего ресурса после каждого клонирования тома, пока не будет перехвачен моментальный снимок динамических данных. Процесс миграции клона тома описан на следующих этапах. 

Если вам не нужно перемещать резервные копии вообще и запускать новую цепочку резервных копий на стороне файлового ресурса Azure после переноса только динамических данных, это полезно для уменьшения сложности миграции и времени, которое займет миграция. Вы можете принять решение, следует ли перемещать резервные копии и сколько для каждого тома (а не для каждого общего ресурса) в StorSimple.

## <a name="phase-1-get-ready"></a>Этап 1. Подготовка

:::row:::
    :::column:::
        ![Изображение, иллюстрирующие часть более раннего, обзорного изображения, которое помогает сосредоточиться на этом подразделе статьи.](media/storage-files-migration-storsimple-shared/storsimple-8000-migration-phase-1.png)
    :::column-end:::
    :::column:::
        Основанием для миграции является клонирование тома и виртуальное облачное устройство, именуемое StorSimple 8020.
Этот этап посвящен развертыванию этих ресурсов в Azure.
    :::column-end:::
:::row-end:::

### <a name="deploy-a-storsimple-8020-virtual-appliance"></a>Развертывание виртуального устройства StorSimple 8020

Развертывание облачного устройства — это процесс, требующий безопасности, сети и некоторые другие соображения.

> [!IMPORTANT]
> Следующее краткое содержание содержит некоторые ненужные разделы. Прочтите статью и следуйте указаниям, начиная с начала до шага 3. Затем вернитесь к этой статье. В настоящее время не требуется выполнять шаг 3 или что-либо за пределами этого раздела.

[Развертывание виртуального устройства StorSimple 8020](../../storsimple/storsimple-8000-cloud-appliance-u2.md)

### <a name="determine-a-volume-clone-to-use"></a>Определение клона тома для использования

Когда вы будете готовы начать миграцию, первым делом нужно создать новый клон тома — так же, как и для резервного копирования, который фиксирует текущее состояние облачного хранилища StorSimple. Создайте клон для каждого из томов StorSimple.
Если вам требуется перемещение резервных копий, первый клон тома, который вы используете, не является вновь созданным клоном, но с самым старым клоном тома (самой старой резервной копией), который необходимо перенести.
Подробные инструкции см. в разделе ["рекомендации по существующим резервным копиям StorSimple"](#considerations-around-existing-storsimple-backups) .

> [!IMPORTANT]
> Следующее краткое содержание содержит некоторые ненужные разделы. Прочтите и выполните только действия, описанные в разделе "связанная Секция". Затем вернитесь к этой статье. Вам не нужно следовать разделу "дальнейшие действия".

[Создание клона тома](../../storsimple/storsimple-8000-clone-volume-u2.md#create-a-clone-of-a-volume)

### <a name="use-the-volume-clone"></a>Использование клона тома

Последний этап фазы 1 — сделать выбранный клон тома доступным на виртуальном устройстве 8020 в Azure.

> [!IMPORTANT]
> Следующее руководство содержит необходимые шаги, а также инструкции по отформатированию тома в конце. **не ФОРМАТИРОВАТЬ том** Прочтите и подпишитесь на «Section 7» из раздела начало до следующей команды: «10. Форматирование простого тома,...»  Прежде чем выполнять этот шаг, вернитесь к этой статье.

[Подключение клона тома к виртуальному устройству 8020 в Azure](../../storsimple/storsimple-8000-deployment-walkthrough-u2.md#step-7-mount-initialize-and-format-a-volume)

### <a name="phase-1-summary"></a>Сводка по этапу 1

Теперь, когда вы завершили этап 1, вы выполнили следующие действия:

* Развертывание виртуального устройства StorSimple 8020 в Azure.
* Определяет, с каким клоном тома начнется миграция.
* Вы подключили свои клоны томов (по одному для каждого динамического тома) к виртуальному устройству StorSimple в Azure, где доступны данные для дальнейшего использования.

## <a name="phase-2-cloud-vm"></a>Этап 2. облачная виртуальная машина

:::row:::
    :::column:::
        ![Изображение, иллюстрирующие часть более раннего, обзорного изображения, которое помогает сосредоточиться на этом подразделе статьи.](media/storage-files-migration-storsimple-shared/storsimple-8000-migration-phase-2.png)
    :::column-end:::
    :::column:::
        После того как исходный клон будет доступен на виртуальном устройстве StorSimple 8020 в Azure, теперь пришло время подготавливать виртуальную машину и предоставлять к ней клонирование тома (или несколько) для виртуальной машины через iSCSI.
    :::column-end:::
:::row-end:::

### <a name="deploy-an-azure-vm"></a>Развертывание виртуальной машины Azure

Виртуальная машина Windows Server в Azure выглядит так же, как и StorSimple 8020, а также за временную часть инфраструктуры, которая необходима только во время миграции.
Конфигурация развертываемой виртуальной машины зависит главным образом от количества элементов (файлов и папок), которые будут синхронизироваться. При наличии каких-либо проблем рекомендуется использовать более высокую конфигурацию производительности.

Один сервер Windows Server может синхронизировать до 30 файловых ресурсов Azure.
Спецификации, которые вы решили включить, должны охватывать каждый общий ресурс, путь или корень тома StorSimple и подсчитать элементы (файлы и папки).

Общий размер данных меньше узкого места — это количество элементов, которые необходимо адаптировать к спецификациям компьютера.

* [Узнайте, как масштабировать Windows Server на основе количества элементов (файлов и папок), которые необходимо синхронизировать.](storage-sync-files-planning.md#recommended-system-resources)
* [Узнайте, как развернуть виртуальную машину Windows Sever.](../../virtual-machines/windows/quick-create-portal.md)

> [!IMPORTANT]
> Убедитесь, что виртуальная машина развернута в том же регионе Azure, что и виртуальное устройство StorSimple 8020. В рамках этой миграции также необходимо изменить регион облачных данных из региона, который хранится на сегодняшний день. это можно сделать на более позднем этапе при подготовке файловых ресурсов Azure.

### <a name="expose-the-storsimple-8020-volumes-to-the-vm"></a>Предоставьте виртуальным машинам тома StorSimple 8020.

На этом этапе вы подключаете один или несколько томов StorSimple с виртуального устройства 8020 по сравнению с iSCSI к подготовленной виртуальной машине Windows Server.

> [!IMPORTANT]
> В следующих статьях заполните только **частный IP-адрес облачного устройства** и **подключитесь** к разделам iSCSI и вернитесь к этой статье.

1. [Получение частного IP-адреса для облачного устройства](../../storsimple/storsimple-8000-cloud-appliance-u2.md#get-private-ip-for-the-cloud-appliance)
2. [Подключение через iSCSI](../../storsimple/storsimple-8000-deployment-walkthrough-u2.md#step-7-mount-initialize-and-format-a-volume)

### <a name="phase-2-summary"></a>Сводка по этапу 2

Теперь, когда вы завершили этап 2, у вас есть: 

* Подготовлена виртуальная машина Windows Server в том же регионе, что и виртуальное устройство StorSimple 8020.
* Доступ ко всем применимым томам с 8020 к виртуальной машине Windows Server через iSCSI.
* Теперь при использовании проводника на виртуальной машине сервера на подключенных томах отображается содержимое файлов и папок.

Перейдите к этапу 3 только после выполнения этих действий для всех томов, требующих миграции.

## <a name="phase-3-set-up-azure-file-shares-and-get-ready-for-azure-file-sync"></a>Этап 3. Настройка файловых ресурсов Azure и подготовка к работе с Синхронизация файлов Azure

:::row:::
    :::column:::
        ![Изображение, иллюстрирующие часть более раннего, обзорного изображения, которое помогает сосредоточиться на этом подразделе статьи.](media/storage-files-migration-storsimple-shared/storsimple-8000-migration-phase-3.png)
    :::column-end:::
    :::column:::
        На этом этапе вы будете определять и подготавливать несколько файловых ресурсов Azure, создавать локальные Windows Server в качестве замены устройств StorSimple и настраивать этот сервер для Синхронизация файлов Azure. 
    :::column-end:::
:::row-end:::

### <a name="map-your-existing-namespaces-to-azure-file-shares"></a>Сопоставьте существующие пространства имен с файловыми ресурсами Azure

[!INCLUDE [storage-files-migration-namespace-mapping](../../../includes/storage-files-migration-namespace-mapping.md)]

### <a name="deploy-azure-file-shares"></a>Развертывание файловых ресурсов Azure

[!INCLUDE [storage-files-migration-provision-azfs](../../../includes/storage-files-migration-provision-azure-file-share.md)]

> [!TIP]
> Если вам нужно изменить регион Azure из текущего региона, в котором находятся данные StorSimple, создайте файловые ресурсы Azure в новом регионе, который вы хотите использовать. Чтобы определить регион, выберите его при подготовке учетных записей хранения, содержащих общие файловые ресурсы Azure. Убедитесь, что также Синхронизация файлов Azure ресурс, который вы будете подготавливать ниже, находится в том же новом регионе.

### <a name="deploy-the-azure-file-sync-cloud-resource"></a>Развертывание облачного ресурса Синхронизация файлов Azure

[!INCLUDE [storage-files-migration-deploy-afs-sss](../../../includes/storage-files-migration-deploy-azure-file-sync-storage-sync-service.md)]

> [!TIP]
> Если вам нужно изменить регион Azure из текущего региона, в котором находятся данные StorSimple, вы подготовили учетные записи хранения для файловых ресурсов Azure в новом регионе. Убедитесь, что вы выбрали этот же регион при развертывании этой службы синхронизации хранилища.

### <a name="deploy-an-on-premises-windows-server"></a>Развертывание локального сервера Windows Server

* Создайте Windows Server 2019 — как минимум 2012 R2 — как виртуальную машину или физический сервер. Также поддерживается кластер с отработкой отказа Windows Server. Не используйте сервер, на котором вы могли поначалу StorSimple 8100 или 8600.
* Подготавливаете или добавляйте непосредственно подключенное хранилище (DAS по сравнению с NAS, которое не поддерживается).

Рекомендуется, чтобы новый сервер Windows Server был больше или равен объему хранилища, чем устройство StorSimple 8100 или 8600 локально доступно для кэширования. Вы будете использовать Windows Server точно так же, как и устройство StorSimple, если оно имеет тот же объем хранилища, что и устройство, тогда кэширование должно быть похоже, если оно не совпадает.
Вы можете добавить или удалить хранилище из Windows Server. Это позволяет масштабировать локальный размер тома и объем локального хранилища, доступного для кэширования.

### <a name="prepare-the-windows-server-for-file-sync"></a>Подготовка Windows Server к синхронизации файлов

[!INCLUDE [storage-files-migration-deploy-afs-agent](../../../includes/storage-files-migration-deploy-azure-file-sync-agent.md)]

### <a name="configure-azure-file-sync-on-the-windows-server"></a>Настройка Синхронизация файлов Azure в Windows Server

Зарегистрированный локальный сервер Windows должен быть готов к работе и подключен к Интернету для этого процесса.

[!INCLUDE [storage-files-migration-configure-sync](../../../includes/storage-files-migration-configure-sync.md)]

> [!WARNING]
> **Не забудьте включить распределение по уровням облака.** Распределение по уровням в облаке — это функция AFS, которая позволяет локальному серверу иметь меньше ресурсов хранилища, чем хранится в облаке, но имеет доступное полное пространство имен. Локально интересные данные также кэшируются локально для быстрой и локальной производительности доступа. Другой причиной включения уровня облака на этом этапе является то, что мы не хотим синхронизировать содержимое файлов на этом этапе, в данный момент только пространство имен должно быть перемещено.

## <a name="phase-4-configure-the-azure-vm-for-sync"></a>Этап 4. Настройка синхронизации виртуальной машины Azure

:::row:::
    :::column:::
        ![Изображение, иллюстрирующие часть более раннего, обзорного изображения, которое помогает сосредоточиться на этом подразделе статьи.](media/storage-files-migration-storsimple-shared/storsimple-8000-migration-phase-4.png)
    :::column-end:::
    :::column:::
        Этот этап относится к виртуальной машине Azure с подключенной iSCSI, первыми клонированными копиями томов. На этом этапе вы получите виртуальную машину, подключенную через Синхронизация файлов Azure, и начнете первый цикл перемещения файлов из клонов тома StorSimple.
        
    :::column-end:::
:::row-end:::

Вы уже настроили локальный сервер, который заменит устройство StorSimple 8100 или 8600, для Синхронизация файлов Azure. 

Настройка виртуальной машины Azure выполняется практически аналогичным процессом, за одним дополнительным шагом. Приведенные ниже инструкции помогут вам выполнить действия по процессу.

> [!IMPORTANT]
> Важно, чтобы виртуальная машина Azure **не была настроена с включенным распределением по уровням облака.** Вы будете обмениваться томом этого сервера с новыми клонами томов во время миграции. Распределение по уровням облака не имеет смысла и накладных расходов на использование ЦП следует избегать.

1. [Разверните агент AFS. (см. предыдущий раздел)](#prepare-the-windows-server-for-file-sync)
2. [Подготовка виртуальной машины для Синхронизация файлов Azure.](#get-the-vm-ready-for-azure-file-sync)
3. [Настройка синхронизации](#configure-azure-file-sync-on-the-azure-vm)

### <a name="get-the-vm-ready-for-azure-file-sync"></a>Подготовить виртуальную машину для Синхронизация файлов Azure

Синхронизация файлов Azure используется для перемещения файлов с подключенных томов iSCSI StorSimple в целевые общие файловые ресурсы Azure.
В ходе этого процесса миграции вы подключаете несколько клонов томов к виртуальной машине с той же буквой диска. Синхронизация файлов Azure должны быть настроены для просмотра следующего клонированного тома в качестве более новой версии файлов и папок и обновления файловых ресурсов Azure, подключенных с помощью Синхронизация файлов Azure. 

> [!IMPORTANT]
> Чтобы это работало, перед настройкой Синхронизация файлов Azure необходимо задать раздел реестра на сервере.

1. Создайте новый каталог на системном диске виртуальной машины. Синхронизация файлов Azure сведения должны храниться там, а не на клонах подключенного тома. Например: `“C:\syncmetadata”`
2. Откройте программу regedit и перейдите к следующему кусту реестра: `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Azure\StorageSync`
3. Создайте новый ключ типа String с именем: ***метадатарутпас*** .
4. Задайте полный путь к каталогу, созданному на системном томе, например: `C:\syncmetadata”`

### <a name="configure-azure-file-sync-on-the-azure-vm"></a>Настройка Синхронизация файлов Azure на виртуальной машине Azure

Этот шаг аналогичен предыдущему разделу, в котором обсуждается настройка AFS на локальном сервере.

Разница заключается в том, что на этом сервере не следует включать распределение по уровням облака и необходимо убедиться, что необходимые папки подключены к нужным общим файловым ресурсам Azure. В противном случае имя файловых ресурсов Azure и содержимое данных не будет совпадать, и вы не сможете переименовать облачные ресурсы или локальные папки без повторной настройки синхронизации.

См. [предыдущий раздел о настройке синхронизация файлов Azure на сервере Windows](#configure-azure-file-sync-on-the-windows-server).

### <a name="step-4-summary"></a>Сводка по этапу 4

На этом этапе вы успешно настроили Синхронизация файлов Azure на виртуальной машине Azure, которая подключила клонирование тома StorSimple с помощью iSCSI.
Теперь данные передаются из виртуальной машины Azure в различные общие файловые ресурсы Azure. в этом случае на локальном сервере Windows Server появляется полностью списанное пространство имен.

> [!IMPORTANT]
> Убедитесь, что в настоящее время в Windows Server не были внесены изменения или пользователь не предоставил доступ.

Исходные данные клонирования тома, перемещаемые через виртуальную машину Azure в файловые ресурсы Azure, могут занять длительное время, в течение нескольких недель. Оценка времени, которое займет это, очень сложно и зависит от многих факторов. В частности, это скорость, с которой виртуальная машина Azure может получить доступ к файлам на томах StorSimple и как быстро Синхронизация файлов Azure может обрабатывать файлы и папки, требующие синхронизации. 

В результате мы можем предположить, что пропускная способность, таким образом, фактический размер данных, играет подчиненную роль. Время выполнения этого или любого последующего цикла миграции в основном зависит от количества элементов, которые могут быть обработаны в секунду. Например, 1 Тиб с файлами и папками 100 000, скорее всего, закончится медленнее, чем 1 Тиб с 50 000 файлами и папками.

## <a name="phase-5-iterate-through-multiple-volume-clones"></a>Этап 5. перебор нескольких клонов томов

:::row:::
    :::column:::
        ![Изображение, иллюстрирующие часть более раннего, обзорного изображения, которое помогает сосредоточиться на этом подразделе статьи.](media/storage-files-migration-storsimple-shared/storsimple-8000-migration-phase-5.png)
    :::column-end:::
    :::column:::
        Как обсуждалось на предыдущем этапе, начальная синхронизация может занять много времени. Пользователи и приложения по-прежнему обращаются к локальному устройству StorSimple 8100 или 8600. Это означает, что изменения суммируются, а каждый день — более крупная дельта между динамическими данными и начальным клоном тома, в настоящее время выполняется миграция, формы. В этом разделе вы узнаете, как сократить время простоя, используя несколько клонов тома и указав время завершения синхронизации.
    :::column-end:::
:::row-end:::

К сожалению, процесс миграции не является мгновенным. Это означает, что вышеупомянутый Дельта по отношению к данным в реальном времени является неизбежным следствием. Хорошая новость состоит в том, что можно повторить процесс подключения новых клонов томов. Разностность каждого клона тома будет уменьшена. В конечном итоге синхронизация будет завершена в течение определенного времени, что позволит отключать пользователей и приложения от сети к локальному серверу Windows Server.

Повторяйте следующие шаги до тех пор, пока синхронизация не завершится достаточно быстро, и вы сможете отключить пользователей и приложения в автономном режиме:

1. [Определение завершения синхронизации для заданного клона тома.](#determine-when-sync-is-done)
2. [Создайте новые клоны томов и подключите их к виртуальному устройству 8020.](#the-next-volume-clones)
3. [Определите, когда выполняется синхронизация.](#determine-when-sync-is-done)
4. [Стратегия сокращенного копирования](#cut-over-strategy)

### <a name="the-next-volume-clones"></a>Следующие клоны томов

Мы обсуждали создание клонов томов ранее в этой статье.
На этом этапе выполняются два действия.

1. [Создание клона тома](../../storsimple/storsimple-8000-clone-volume-u2.md#create-a-clone-of-a-volume)
2. [Подключить этот клон тома (см. выше)](#use-the-volume-clone)

### <a name="determine-when-sync-is-done"></a>Определение времени завершения синхронизации

По завершении синхронизации можно прекратить измерение времени и определить, нужно ли повторять процесс создания клона тома и его подключения или если время синхронизации последнего клонированного тома было достаточно малым.

Чтобы определить синхронизацию, выполните следующие действия.

1. Откройте Просмотр событий и перейдите к разделу **приложения и службы** .
2. Навигация и открытие **микрософт\филесинк\ажент\телеметри**
3. Поиск последнего **события 9102**, соответствующего завершенному сеансу синхронизации
4. Выберите **сведения** и убедитесь, что значение **синкдиректион** — **upload** .
5. Проверьте **значение HRESULT** и убедитесь, что отображается **0**. Это означает, что сеанс синхронизации был успешным. Если HResult имеет ненулевое значение, то во время синхронизации произошла ошибка. Если **перитемерроркаунт** больше 0, то некоторые файлы или папки не были синхронизированы должным образом. Результат HResult может быть равен 0, а результат PerItemErrorCount при этом — больше 0. На этом этапе вам не нужно беспокоиться о Перитемерроркаунт. Эти файлы будут перехватываться позже. Если количество ошибок велико, тысячи элементов, обратитесь в службу поддержки пользователей и попросите подключиться к Синхронизация файлов Azure группе продуктов для получения прямых руководств по лучшим, следующим этапам.
6. Установите флажок, чтобы увидеть несколько событий 9102 с HResult 0 в строке. Это означает, что синхронизация для этого клона тома завершена.

### <a name="cut-over-strategy"></a>Стратегия сокращенного копирования

1. Определите, достаточно ли быстро синхронизироваться с клоном тома. (Дельта достаточно мала.)
2. Возьмите устройство StorSimple в автономный режим.
3. Окончательное средство Robocopy.

Измерьте время и определите, может ли синхронизация из последнего клона тома завершиться в течение временного интервала, достаточного, чтобы можно было позволить себе просто в системе.

Теперь это время отключает доступ пользователей к устройству StorSimple. Больше нет изменений. Время простоя было начато.
Необходимо перевести устройство в оперативный режим и подключиться к нему, но теперь оно должно предотвращать изменения.

На этапе 6 вы сможете отслеживать любые изменения в динамических данных с момента создания последнего клонированного тома.

## <a name="phase-6-a-final-robocopy"></a>Этап 6. окончательный элемент Robocopy

На этом этапе существует два различия между локальным сервером Windows Server и устройством StorSimple 8100 или 8600:

1. Возможно, имеются файлы, которые не синхронизированы (см. **перитемеррорс** из журнала событий выше).
2. В настоящее время устройство StorSimple имеет заполненный кэш и Windows Server. это пространство имен, в котором не хранится содержимое файлов локально.

![Изображение, иллюстрирующие часть более раннего, обзорного изображения, которое помогает сосредоточиться на этом подразделе статьи.](media/storage-files-migration-storsimple-shared/storsimple-8000-migration-phase-6.png)

Можно перенести кэш Windows Server вплоть до состояния устройства и убедиться, что файл не остался после окончательного средства Robocopy.

> [!CAUTION]
> Крайне важно, чтобы команда Robocopy была приведена в точности, как описано ниже. Мы хотим скопировать только локальные файлы и файлы, которые не были перемещены с помощью подхода клонирования и синхронизации томов. Мы можем решить проблемы, почему они не были синхронизированы позже, после завершения миграции. (См. [Синхронизация файлов Azure устранение неполадок](storage-sync-files-troubleshoot.md#how-do-i-see-if-there-are-specific-files-or-folders-that-are-not-syncing). Скорее всего, непечатаемые символы в именах файлов не будут пропускаться при их удалении.)

Команда Robocopy:

```console
Robocopy /MT:32 /UNILOG:<file name> /TEE /MIR /COPYALL /DCOPY:DAT <SourcePath> <Dest.Path>
```

Фон:

:::row:::
   :::column span="1":::
      /MT
   :::column-end:::
   :::column span="1":::
      Позволяет использовать средство Robocopy для работы с многопоточными потоками. Значение по умолчанию — 8, максимальное — 128.
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /УНИЛОГ:<file name>
   :::column-end:::
   :::column span="1":::
      Выводит состояние в файл журнала как Юникод (перезаписывает существующий журнал).
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /ти
   :::column-end:::
   :::column span="1":::
      Вывод в окно консоли. Используется в сочетании с выходными данными в файл журнала.
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /мир
   :::column-end:::
   :::column span="1":::
      Позволяет Robocopy расдумать только о различиях между источником (устройством StorSimple) и целевым объектом (каталог Windows Server).
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /COPY: копифлаг [s]
   :::column-end:::
   :::column span="1":::
      достоверность копии файла (по умолчанию —/COPY: DAT), флаги копирования: D = данные, A = атрибуты, T = метки времени, S = безопасность = NTFS ACL, O = сведения о владельце, U = сведения аудита
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /копялл
   :::column-end:::
   :::column span="1":::
      Копировать все сведения о файле (эквивалентно/COPY: ДАТСАУ)
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /ДКОПИ: копифлаг [s]
   :::column-end:::
   :::column span="1":::
      точность для копии каталогов (по умолчанию/ДКОПИ: DA), флаги копирования: D = данные, A = Attributes, T = метки времени
   :::column-end:::
:::row-end:::

Эту команду Robocopy следует выполнять для каждого каталога на сервере Windows Server в качестве целевого объекта, для которого вы настроили синхронизацию файлов в файл Azure.

Несколько этих команд можно выполнять параллельно.
После завершения этого шага Robocopy можно разрешить пользователям и приложениям получать доступ к серверу Windows Server, как это делало устройство StorSimple.

Просмотрите файлы журнала Robocopy, чтобы узнать, остались ли они. Если проблемы должны существовать, в большинстве случаев их можно устранить после завершения миграции, после чего ваши пользователи и приложения будут перезагружены на сервер Windows. Если необходимо устранить проблемы, сделайте это до этапа 7.

Скорее всего, потребуется создать общие ресурсы SMB на сервере Windows, который использовался ранее для данных StorSimple. Вы можете загрузить этот шаг и сделать его более ранним, чтобы не потерять время, но необходимо убедиться, что до этого момента изменения в файлах не происходят в Windows Server.

При наличии развертывания DFS-N можно указать пространства имен ДФН-Namespace для новых расположений папок сервера. Если у вас нет развертывания DFS-N и вы построили устройство 8100 8600 локально с помощью Windows Server, вы можете отключить этот сервер от домена и присоединить к домену новый сервер Windows Server с помощью AFS, присвоить ему имя сервера, совпадающее с именем старого сервера. и одни и те же имена общих папок, то переход на новый сервер остается непрозрачным для пользователей, групповых политик или сценариев.

## <a name="phase-7-deprovision"></a>Этап 7. отзовите отмену

На последнем этапе вы выполнили итерацию по нескольким клонам томов, и со временем смогли сократить доступ пользователей к новому серверу Windows Server после перевода устройства StorSimple в автономный режим.

Теперь можно приступить к отмене распространения ненужных ресурсов.
Прежде чем начать, рекомендуется наблюдать за новым Синхронизация файлов Azureным развертыванием в рабочей среде. Это позволяет устранить возникающие проблемы.

Когда вы удовлетворены и Просмотрели развертывание AFS по крайней мере через несколько дней, можно приступить к отмене подготовки ресурсов в следующем порядке:

1. Отключите виртуальную машину Azure, которую мы использовали для перемещения данных из клонов тома в файловые ресурсы Azure через синхронизацию файлов.
2. Перейдите к ресурсу службы синхронизации хранилища в Azure и отмените регистрацию виртуальной машины Azure. Это приведет к удалению из всех групп синхронизации.

    > [!WARNING]
    > **Убедитесь, что выбран правильный компьютер.** Вы отключили облачную виртуальную машину, это означает, что она должна отображаться в списке зарегистрированных серверов в качестве единственного сервера вне сети. На этом этапе не следует выбирать локальный сервер Windows. это приведет к отмене регистрации.

3. Удалите виртуальную машину Azure и ее ресурсы.
4. Отключите виртуальное устройство StorSimple 8020.
5. Отмените инициализацию всех ресурсов StorSimple в Azure.
6. Отсоедините физическое устройство StorSimple от центра обработки данных.

Миграция завершена.

## <a name="next-steps"></a>Дальнейшие действия

Узнайте больше о Синхронизация файлов Azure. Особенно с гибкостью политик распределения по уровням облака.

Если вы видите в портал Azure или из предыдущих событий, что некоторые файлы навсегда не синхронизируются, просмотрите инструкции по устранению неполадок, чтобы устранить эти проблемы.

* [Обзор Синхронизация файлов Azure: aka.ms/AFS](https://aka.ms/AFS)
* [Распределение по уровням облака](storage-sync-cloud-tiering.md) 
* [Руководство по устранению неполадок Синхронизация файлов Azure](storage-sync-files-troubleshoot.md)
