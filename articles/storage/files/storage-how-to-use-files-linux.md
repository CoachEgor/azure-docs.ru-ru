---
title: Использование файлов Azure в Linux | Документы Майкрософт
description: Узнайте, как подключить файловый ресурс Azure через протокол SMB в Linux.
author: roygara
ms.service: storage
ms.topic: conceptual
ms.date: 03/29/2018
ms.author: rogarana
ms.subservice: files
ms.openlocfilehash: 8d0de6c68800b1a37e57aa259fd6884ee91752b5
ms.sourcegitcommit: 800f961318021ce920ecd423ff427e69cbe43a54
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/31/2019
ms.locfileid: "68699556"
---
# <a name="use-azure-files-with-linux"></a>Использование Файлов Azure в Linux

[Файлы Azure](storage-files-introduction.md) — это простая в использовании облачная файловая система от Майкрософт. Файловые ресурсы Azure можно подключить в дистрибутивах Linux с помощью [SMB-клиента в ядре](https://wiki.samba.org/index.php/LinuxCIFS). В этой статье описаны два способа подключения файлового ресурса Azure: по запросу с помощью команды `mount` и при загрузке путем создания записи в `/etc/fstab`.

> [!NOTE]  
> Чтобы подключить файловый ресурс Azure за пределами региона Azure, в котором она размещается, например локально или в другом регионе Azure, операционная система должна поддерживать функции шифрования SMB 3.0.

## <a name="prerequisites-for-mounting-an-azure-file-share-with-linux-and-the-cifs-utils-package"></a>Предварительные требования для подключения файлового ресурса Azure с помощью Linux и пакета cifs-utils
<a id="smb-client-reqs"></a>

* **Существующая учетная запись хранения Azure и общая папка**: Для выполнения этой статьи необходимо иметь учетную запись хранения и общую папку. Если вы еще не создали его, ознакомьтесь с одним из наших кратких руководств по этой теме: [Создайте общие файловые ресурсы — CLI](storage-how-to-use-files-cli.md).

* **Имя и ключ учетной записи хранения** Для выполнения этой статьи потребуется имя и ключ учетной записи хранения. Если вы создали его с помощью краткого руководства по интерфейсу командной строки, то, в противном случае, обратитесь к краткому руководству по CLI, который был связан ранее, чтобы узнать, как получить ключ учетной записи хранения.

* **Выберите дистрибутив Linux, соответствующий вашим требованиям к подключению.**  
      Службу файлов Azure можно подключить с помощью SMB 2.1 или SMB 3.0. Для подключений, поступающих от клиентов в локальной среде или в других регионах Azure необходимо использовать SM 3.0. Служба файлов Azure отклонит SMB 2.1 (или SMB 3.0 без шифрования). Если вы обращаетесь к общей папке Azure c виртуальной машины в том же регионе Azure, вы можете получить доступ по протоколу SMB 2.1, только если отключен параметр *Требуется безопасная передача данных* для учетной записи хранения общей папки Azure. Мы рекомендуем всегда требовать защищенную передачу и использовать только SMB 3.0 с шифрованием.

    Поддержка шифрования SMB 3.0 появилась в версии ядра Linux 4.11 и была добавлена в предшествующие версии ядер для популярных дистрибутивов Linux. На момент публикации этого документа функцию подключения, указанную в заголовках таблиц, поддерживают представленные ниже дистрибутивы из коллекции Azure. 

### <a name="minimum-recommended-versions-with-corresponding-mount-capabilities-smb-version-21-vs-smb-version-30"></a>Минимальная рекомендуемая версия с соответствующими возможностями подключения (SMB версии 2,1 vs SMB версии 3,0)

|   | SMB 2.1 <br>(подключение к виртуальным машинам в одном регионе) | SMB 3.0 <br>(подключение из локальной среды и между регионами) |
| --- | :---: | :---: |
| Сервер Ubuntu | 14.04 или более поздней версии | 16.04 или выше |
| RHEL | 7 или выше | 7.5+ |
| CentOS | 7 или выше |  7.5+ |
| Debian | 8+ |   |
| openSUSE | 13.2 или выше | 42.3+ |
| SUSE Linux Enterprise Server | 12 | 12 SP3 или выше |

Если ваш дистрибутив Linux отсутствует в списке, можно проверить версию ядра Linux с помощью следующей команды.

```bash
uname -r
```

* <a id="install-cifs-utils"></a>**Установите пакет cifs-utils.**  
    Пакет cifs-utils можно установить с помощью диспетчера пакетов в дистрибутиве Linux по своему усмотрению. 

    В дистрибутивах **Ubuntu** и **на основе Debian** используйте диспетчер пакетов `apt-get`:

    ```bash
    sudo apt-get update
    sudo apt-get install cifs-utils
    ```

    В **RHEL** и **CentOS** используйте диспетчер пакетов `yum`:

    ```bash
    sudo yum install cifs-utils
    ```

    В **openSUSE** используйте диспетчер пакетов `zypper`:

    ```bash
    sudo zypper install cifs-utils
    ```

    В других дистрибутивах используйте соответствующий диспетчер пакетов или выполните [компиляцию из источника](https://wiki.samba.org/index.php/LinuxCIFS_utils#Download).

* **Выберите разрешения для каталога и файлов подключаемого общедоступного ресурса**. В приведенных ниже примерах используется разрешение `0777`, чтобы все пользователи имели разрешения на чтение, запись и выполнение файлов. При необходимости его можно заменить другими [разрешениями chmod](https://en.wikipedia.org/wiki/Chmod) , хотя это означает, что доступ будет запрещен. Если вы используете другие разрешения, следует также использовать идентификаторы UID и GID, чтобы хранить доступ для локальных пользователей и групп по своему усмотрению.

> [!NOTE]
> Если не назначить явно разрешения Directory и File с помощью dir_mode и file_mode, по умолчанию будет 0755.

* **Открытый порт 445**. Взаимодействие SMB выполняется через TCP-порт 445. Проверьте, чтобы брандмауэр не блокировал TCP-порты 445 с клиентского компьютера.

## <a name="mount-the-azure-file-share-on-demand-with-mount"></a>Подключение файлового ресурса Azure по запросу с помощью `mount`

1. **[Установите пакет cifs-utils для вашего дистрибутива Linux](#install-cifs-utils)** .

1. **Создайте папку для точки подключения**. Папка для точки подключения может быть создана в любом месте файловой системы, но она обычно создается в новой папке. Например, следующая команда создает новый каталог, заменяет **< storage_account_name >** и **< file_share_name >** соответствующими данными для вашей среды:

    ```bash
    mkdir -p <storage_account_name>/<file_share_name>
    ```

1. **Используйте следующую команду, чтобы подключить общую папку Azure**. Не забудьте заменить **< storage_account_name >** , **< имя_общего_ресурса >** , **< smb_version >** , **< storage_account_key >** и **< mount_point >** соответствующими сведениями для PXE. Если дистрибутив Linux поддерживает SMB 3,0 с шифрованием (Дополнительные сведения см. в статье [требования к клиенту SMB](#smb-client-reqs) ), используйте **3,0** для **< smb_version >** . Для дистрибутивов Linux, которые не поддерживают SMB 3,0 с шифрованием, используйте **2,1** для **< smb_version >** . Файловый ресурс Azure можно подключить только за пределами региона Azure (включая локальную среду или в другом регионе Azure) с SMB 3,0. При желании можно изменить разрешения для каталога и файлов в подключенном общем ресурсе, но это означает, что доступ будет запрещен.

    ```bash
    sudo mount -t cifs //<storage_account_name>.file.core.windows.net/<share_name> <mount_point> -o vers=<smb_version>,username=<storage_account_name>,password=<storage_account_key>,dir_mode=0777,file_mode=0777,serverino
    ```

> [!Note]  
> Завершив работу с файловым ресурсом Azure, вы можете отключить его, выполнив команду `sudo umount <mount_point>`.

## <a name="create-a-persistent-mount-point-for-the-azure-file-share-with-etcfstab"></a>Создание постоянной точки подключения для файлового ресурса Azure с помощью `/etc/fstab`

1. **[Установите пакет cifs-utils для вашего дистрибутива Linux](#install-cifs-utils)** .

1. **Создайте папку для точки подключения**. Папка для точки подключения может быть создана в любом месте файловой системы, но она обычно создается в новой папке. Где бы вы ни создали ее, запишите абсолютный путь к этой папке. Например, следующая команда создает новый каталог, заменяет **< storage_account_name >** и **< file_share_name >** соответствующими сведениями о среде.

    ```bash
    sudo mkdir -p <storage_account_name>/<file_share_name>
    ```

1. **Создайте файл учетных данных, в котором будет храниться имя пользователя (имя учетной записи хранения) и пароль (ключ учетной записи хранения) для имени файлового ресурса.** Замените **< storage_account_name >** и **< storage_account_key >** соответствующими сведениями о вашей среде.

    ```bash
    if [ ! -d "/etc/smbcredentials" ]; then
    sudo mkdir /etc/smbcredentials
    fi
    if [ ! -f "/etc/smbcredentials/<STORAGE ACCOUNT NAME>.cred" ]; then
    sudo bash -c 'echo "username=<STORAGE ACCOUNT NAME>" >> /etc/smbcredentials/<STORAGE ACCOUNT NAME>.cred'
    sudo bash -c 'echo "password=7wRbLU5ea4mgc<DRIVE LETTER>PIpUCNcuG9gk2W4S2tv7p0cTm62wXTK<DRIVE LETTER>CgJlBJPKYc4VMnwhyQd<DRIVE LETTER>UT<DRIVE LETTER>yR5/RtEHyT/EHtg2Q==" >> /etc/smbcredentials/<STORAGE ACCOUNT NAME>.cred'
    fi
    ```

1. **Измените разрешения для файла учетных данных таким образом, чтобы только пользователь с правами root мог читать или изменять файл пароля.** Поскольку ключ учетной записи хранения является паролем управляющего администратора учетной записи хранения, необходимо установить разрешения для файла, чтобы только у пользователя с правами root был доступ к файлу, а пользователи с более низким статусом прав не могли получить ключ учетной записи хранения.   

    ```bash
    sudo chmod 600 /etc/smbcredentials/<storage_account_name>.cred
    ```

1. **Используйте следующую команду, чтобы добавить следующую строку в `/etc/fstab`** : Не забудьте заменить **< storage_account_name >** , **< имя_общего_ресурса >** , **< smb_version >** и **< mount_point >** соответствующими сведениями о вашей среде. Если дистрибутив Linux поддерживает SMB 3,0 с шифрованием (Дополнительные сведения см. в статье [требования к клиенту SMB](#smb-client-reqs) ), используйте **3,0** для **< smb_version >** . Для дистрибутивов Linux, которые не поддерживают SMB 3,0 с шифрованием, используйте **2,1** для **< smb_version >** . Файловый ресурс Azure можно подключить только за пределами региона Azure (включая локальную среду или в другом регионе Azure) с SMB 3,0.

    ```bash
    sudo bash -c 'echo "//<STORAGE ACCOUNT NAME>.file.core.windows.net/<FILE SHARE NAME> /mount/<STORAGE ACCOUNT NAME>/<FILE SHARE NAME> cifs _netdev,nofail,vers=3.0,credentials=/etc/smbcredentials/<STORAGE ACCOUNT NAME>.cred,dir_mode=0777,file_mode=0777,serverino" >> /etc/fstab'

    sudo mount /mount/<STORAGE ACCOUNT NAME>/<FILE SHARE NAME>
    ```

> [!Note]  
> Вместо перезагрузки можно использовать `sudo mount -a`, чтобы подключить файловый ресурс после изменения `/etc/fstab`.

## <a name="feedback"></a>Отзывы

Пользователи Linux, нам очень интересно ваше мнение!

Файлы Azure для группы пользователей Linux включают форум, на котором можно поделиться своим мнением и опытом адаптации хранилища файлов в Linux. Чтобы вступить в группу пользователей, отправьте электронное письмо в группу [Пользователи файлов Azure в Linux](mailto:azurefileslinuxusers@microsoft.com).

## <a name="next-steps"></a>Следующие шаги

Дополнительные сведения о службе файлов Azure см. по следующим ссылкам.

* [Планирование развертывания службы файлов Azure](storage-files-planning.md)
* [Часто задаваемые вопросы](../storage-files-faq.md)
* [Устранение неполадок](storage-troubleshoot-linux-file-connection-problems.md)
