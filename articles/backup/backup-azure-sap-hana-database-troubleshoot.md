---
title: Устранение проблем SAP HANA с ошибками резервного копирования
description: Описывает, как устранить распространенные ошибки, которые могут возникнуть при использовании резервного копирования Azure для резервного копирования баз данных SAP HANA.
ms.topic: troubleshooting
ms.date: 11/7/2019
ms.openlocfilehash: 6520f106011b632da2725f456aeb278c7748ddc9
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79459316"
---
# <a name="troubleshoot-backup-of-sap-hana-databases-on-azure"></a>Резервное копирование баз данных SAP HANA на Azure

В этой статье содержится информация об устранении неполадок для резервного копирования баз данных SAP HANA на виртуальных машинах Azure. Для получения дополнительной информации о сценариях резервного [Scenario support](sap-hana-backup-support-matrix.md#scenario-support)копирования SAP HANA, которые мы в настоящее время поддерживаем, см.

## <a name="prerequisites-and-permissions"></a>Предпосылки и разрешения

Ссылайтесь на [предпосылки](tutorial-backup-sap-hana-db.md#prerequisites) и [что делает сценарий предварительной регистрации](tutorial-backup-sap-hana-db.md#what-the-pre-registration-script-does) перед настройкой резервных данных.

## <a name="common-user-errors"></a>Общие ошибки пользователя

### <a name="usererrorhanainternalrolenotpresent"></a>UserErrorHANAInternalRoleNotPresent

| **Сообщение об ошибке**      | <span style="font-weight:normal">Резервное копирование Azure не имеет требуемых привилегий для выполнения резервного копирования</span>    |
| ---------------------- | ------------------------------------------------------------ |
| **Возможные причины**    | Роль, возможно, была перезаписана.                          |
| **Рекомендуемое действие** | Чтобы решить проблему, запустите скрипт из панели **Discover DB** или загрузите его [здесь.](https://aka.ms/scriptforpermsonhana) Кроме того, добавьте роль «SAP_INTERNAL_HANA_SUPPORT» пользователю резервного копирования рабочей нагрузки (АЗUREWLBACKUPHANAUSER). |

### <a name="usererrorinopeninghanaodbcconnection"></a>UserErrorInOpeningHanaOdbcConnection

| Сообщение об ошибке      | <span style="font-weight:normal">Не удалось подключиться к системе HANA</span>                        |
| ------------------ | ------------------------------------------------------------ |
| **Возможные причины**    | Экземпляр SAP HANA может быть недоиму.<br/>Необходимые разрешения для резервного копирования Azure для взаимодействия с базой данных HANA не установлены. |
| **Рекомендуемое действие** | Проверьте, работает ли база данных SAP HANA. Если база данных запущена и запущена, проверьте, установлены ли все необходимые разрешения. Если какое-либо из разрешений отсутствует, [запустите сценарий предварительной регистрации,](https://aka.ms/scriptforpermsonhana) чтобы добавить недостающие разрешения. |

### <a name="usererrorhanainstancenameinvalid"></a>UserErrorHanaInstanceNameНедействительно

| Сообщение об ошибке      | <span style="font-weight:normal">Указанный экземпляр SAP HANA либо недействителен, либо не может быть найден</span>  |
| ------------------ | ------------------------------------------------------------ |
| **Возможные причины**    | Несколько экземпляров SAP HANA на одном Azure VM не могут быть подкреплены. |
| **Рекомендуемое действие** | Запустите [сценарий предварительной регистрации](https://aka.ms/scriptforpermsonhana) на экземпляре SAP HANA, который требуется для резервного копирования. Если проблема сохраняется, обратитесь в службу поддержки майкрософт. |

### <a name="usererrorhanaunsupportedoperation"></a>UserErrorHanaUnsupportedOperation

| Сообщение об ошибке      | <span style="font-weight:normal">Указанная операция SAP HANA не поддерживается</span>              |
| ------------------ | ------------------------------------------------------------ |
| **Возможные причины**    | Резервное копирование Azure для SAP HANA не поддерживает постепенное резервное копирование и действия, выполняемые на нативных клиентах SAP HANA (Studio/ Cockpit/ DBA Cockpit) |
| **Рекомендуемое действие** | Для получения дополнительной информации, обратитесь [здесь](https://docs.microsoft.com/azure/backup/sap-hana-backup-support-matrix#scenario-support). |

### <a name="usererrorhanapodoesnotsupportbackuptype"></a>UserErrorHANAPODoesNotSupportBackupUpType

| Сообщение об ошибке      | <span style="font-weight:normal">Эта база данных SAP HANA не поддерживает запрашиваемый тип резервного копирования</span>  |
| ------------------ | ------------------------------------------------------------ |
| **Возможные причины**    | Резервное копирование Azure не поддерживает постепенное резервное копирование и резервное копирование с помощью моментальных снимков |
| **Рекомендуемое действие** | Для получения дополнительной информации, обратитесь [здесь](https://docs.microsoft.com/azure/backup/sap-hana-backup-support-matrix#scenario-support). |

### <a name="usererrorhanalsnvalidationfailure"></a>UserErrorHANALSNValidationfailure

| Сообщение об ошибке      | <span style="font-weight:normal">Цепочка резервного копирования взломана</span>                                    |
| ------------------ | ------------------------------------------------------------ |
| **Возможные причины**    | Назначение резервного копирования журнала может быть обновлено с backint в файловую систему или бэкинт исполняемый может быть изменен |
| **Рекомендуемое действие** | Триггер полного резервного копирования для решения проблемы                   |

### <a name="usererrorincomaptiblesrctargetsystsemsforrestore"></a>UserErrorОшибкаНекомаптивныйСркTargetSystsemsForRestore

| Сообщение об ошибке      | <span style="font-weight:normal">Источник и целевые системы для восстановления несовместимы</span>    |
| ------------------ | ------------------------------------------------------------ |
| **Возможные причины**    | Целевая система восстановления несовместима с источником |
| **Рекомендуемое действие** | Обратитесь к SAP Note [1642148,](https://launchpad.support.sap.com/#/notes/1642148) чтобы узнать о поддерживаемых сегодня типах восстановления |

### <a name="usererrorsdctomdcupgradedetected"></a>UserErrorSDCtoMDCUpgradeОбнаружено

| Сообщение об ошибке      | <span style="font-weight:normal">Обнаружено sDC к обновлению MDC</span>                                   |
| ------------------ | ------------------------------------------------------------ |
| **Возможные причины**    | Экземпляр SAP HANA был повышен с SDC до MDC. Резервное копирование завершится после обновления. |
| **Рекомендуемое действие** | Следуйте шагам, перечисленным в [разделе Обновление с раздела SAP HANA 1.0 до 2.0,](https://docs.microsoft.com/azure/backup/backup-azure-sap-hana-database-troubleshoot#upgrading-from-sap-hana-10-to-20) чтобы решить проблему |

### <a name="usererrorinvalidbackintconfiguration"></a>UserErrorInvalidBackintConfiguration

| Сообщение об ошибке      | <span style="font-weight:normal">Обнаруженная недействительная конфигурация бэкинта</span>                       |
| ------------------ | ------------------------------------------------------------ |
| **Возможные причины**    | Параметры резервного копирования неправильно указаны для резервного копирования Azure |
| **Рекомендуемое действие** | Проверьте, установлены ли следующие параметры (backint):<br/>\*(catalog_backup_using_backint:true)<br/>\*(enable_accumulated_catalog_backup:ложный)<br/>\*(parallel_data_backup_backint_channels:1)<br/>\*(log_backup_timeout_s:900))<br/>\*(backint_response_timeout:7200)<br/>Если параметры на основе бэкинта присутствуют в HOST, удалите их. Если параметры не присутствуют на уровне HOST, но были изменены вручную на уровне базы данных, отвратите их к соответствующим значениям, описанным ранее. Или запустите [защиту стоп-стоп и сохраните данные резервного копирования](https://docs.microsoft.com/azure/backup/sap-hana-db-manage#stop-protection-for-an-sap-hana-database) с портала Azure, а затем выберите **резервное копирование резюме.** |

## <a name="restore-checks"></a>Восстановление проверок

### <a name="single-container-database-sdc-restore"></a>Восстановление единой базы данных контейнеров (SDC)

Позаботьтесь о входных данных при восстановлении единой базы данных контейнеров (SDC) для HANA на другую машину SDC. Название базы данных должно быть приведено с нижним регистром и с "sdc" придативается в скобках. Экземпляр HANA будет отображаться в столицах.

Предположим, что экземпляр SDC HANA "H21" резервное копирование. Страница элементов резервного копирования будет отображать имя элемента резервного копирования как **"h21(sdc)".** Если вы попытаетесь восстановить эту базу данных в другой целевой SDC, скажем, H11, то следующие входы должны быть предоставлены.

![Восстановленное имя базы данных SDC](media/backup-azure-sap-hana-database/hana-sdc-restore.png)

Обратите внимание на следующие моменты.

- По умолчанию восстановленное имя db будет заполнено именем элемента резервного копирования. В этом случае, h21 (sdc).
- Выбор цели как H11 не изменит восстановленное имя db автоматически. **Она должна быть отредактирована до h11 (sdc)**. Что касается SDC, восстановленное имя db будет идентификатором экземпляра с буквами нижнего регистра и 'sdc' приложено в скобках.
- Поскольку SDC может иметь только единую базу данных, необходимо также нажать на флажок, чтобы переопределить существующие данные базы данных с данными точки восстановления.
- Linux является чувствительным к случаям. Так что будьте осторожны, чтобы сохранить дело.

### <a name="multiple-container-database-mdc-restore"></a>Восстановление базы данных нескольких контейнеров (MDC)

В нескольких контейнерных базах данных для HANA стандартная конфигурация SYSTEMDB No 1 или более Tenant DBs. Восстановление всего экземпляра SAP HANA означает восстановление как SYSTEMDB, так и Тентант DBs. Сначала восстанавливается SYSTEMDB, а затем переходит для Tenant DB. Система DB по существу означает переопределить системную информацию о выбранной цели. Это восстановление также перекрывает информацию, связанную с BackInt в целевом экземпляре. Поэтому после того, как система DB будет восстановлена в целевом экземпляре, запустите сценарий предварительной регистрации снова. Только тогда последующий dB-восстановления арендатора удастся.

## <a name="upgrading-from-sap-hana-10-to-20"></a>Обновление от SAP HANA 1.0 до 2.0

Если вы защищаете базы данных SAP HANA 1.0 и хотите обновиться до 2.0, выполните следующие действия:

- [Остановить защиту](sap-hana-db-manage.md#stop-protection-for-an-sap-hana-database) с сохранением данных для старой базы данных SDC.
- Выполните обновление. После завершения, HANA теперь MDC с системой DB и арендаторd DB (ы)
- Повторное [провоцировать сценарий предварительной регистрации](https://aka.ms/scriptforpermsonhana) с правильными деталями (sid и mdc).
- Расширение перерегистрации для той же машины на портале Azure (Backup -> сведения о просмотре - > Выберите соответствующую перерегистрацию Azure VM - > re-register).
- Нажмите Rediscover DBs для того же VM. Это действие должно отображать новые DB в шаге 2 с правильными деталями (SYSTEMDB и Tenant DB, а не SDC).
- Наймите резервную базу данных для этих новых баз данных.

## <a name="upgrading-without-an-sid-change"></a>Обновление без изменения SID

Обновления до ОС или SAP HANA, которые не вызывают изменения SID, могут быть обработаны в описании ниже:

- [Остановить защиту](sap-hana-db-manage.md#stop-protection-for-an-sap-hana-database) с сохранением данных для базы данных
- Выполните обновление.
- Повторное запуск [сценария предварительной регистрации](https://aka.ms/scriptforpermsonhana). Обычно мы видели, как процесс обновления удаляет необходимые роли. Запуск сценария предварительной регистрации поможет проверить все необходимые роли.
- [Возобновление защиты](sap-hana-db-manage.md#resume-protection-for-an-sap-hana-database) базы данных снова

## <a name="re-registration-failures"></a>Сбои перерегистрации

Проверьте один или несколько из следующих симптомов, прежде чем вы запустите операцию перерегистрации:

- Все операции (например, резервное копирование, восстановление и настройка резервного копирования) не удается на VM с одним из следующих кодов ошибок: **WorkloadExtensionNotReachable, UserErrorWorkExtensionNotInstalled, WorkloadExtensionNotPresent, WorkloadExtensionNotPresent, WorkloadExtensionAndDeMsg.**
- Если область **состояния резервного копирования** для элемента резервного копирования отображается **недостижимой,** исключите все другие причины, которые могут привести к тому же статусу:

  - Отсутствие разрешения на выполнение операций, связанных с резервной копированием на VM
  - VM выключен, поэтому резервные копирования не могут иметь место
  - Проблемы сети

Эти симптомы могут возникнуть по одной или более из следующих причин:

- Расширение было удалено или удалено с портала.
- VM был восстановлен во времени через восстановление диска на месте.
- VM был закрыт в течение длительного периода времени, поэтому срок действия конфигурации расширения на нем истек.
- VM был удален, а другой VM был создан с тем же именем и в той же группе ресурсов, что и удаленный VM.

В предыдущих сценариях мы рекомендуем вызвать операцию перерегистрации на VM.

## <a name="next-steps"></a>Дальнейшие действия

- Просмотрите [часто задаваемые вопросы](https://docs.microsoft.com/azure/backup/sap-hana-faq-backup-azure-vm) о резервном копировании баз данных SAP HANA на MMs Azure.
