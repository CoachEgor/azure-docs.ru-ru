---
title: Устранение ошибок резервного копирования SAP HANA баз данных — Azure Backup
description: Описание способов устранения распространенных ошибок, которые могут возникнуть при использовании Azure Backup для резервного копирования SAP HANA баз данных.
ms.reviewer: pullabhk
author: dcurwin
manager: carmonm
ms.service: backup
ms.topic: conceptual
ms.date: 08/03/2019
ms.author: dacurwin
ms.openlocfilehash: 004d10b794c6eca2e078e437880f44d91ca30acb
ms.sourcegitcommit: b1c94635078a53eb558d0eb276a5faca1020f835
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/27/2019
ms.locfileid: "72968450"
---
# <a name="troubleshoot-backup-of-sap-hana-databases-on-azure"></a>Устранение неполадок резервного копирования баз данных SAP HANA в Azure

В этой статье содержатся сведения об устранении неполадок при резервном копировании баз данных SAP HANA на виртуальных машинах Azure. В следующем разделе описываются важные концептуальные данные, необходимые для диагностики распространенной ошибки в SAP HANA Backup.

## <a name="prerequisites"></a>Технические условия

В рамках необходимых условий убедитесь, что сценарий [предварительной](backup-azure-sap-hana-database.md#prerequisites)регистрации был запущен на виртуальной машине, где установлен Hana.

### <a name="setting-up-permissions"></a>Настройка разрешений

Действия, выполняемые сценарием предрегистрации:

1. Создает АЗУРЕВЛБАККУФАНАУСЕР в системе HANA и добавляет следующие необходимые роли и разрешения:
    - Администратор базы данных: для создания нового баз данных во время восстановления.
    - ЧТЕНИЕ каталога: чтение каталога резервного копирования.
    - SAP_INTERNAL_HANA_SUPPORT: для доступа к некоторым частным таблицам.
2. Добавляет ключ в Hdbuserstore для подключаемого модуля HANA, чтобы выполнять все операции (запросы к базе данных, операции восстановления, Настройка и выполнение резервного копирования).

   Чтобы подтвердить создание ключа, выполните команду HDBSQL на компьютере HANA с учетными данными SIDADM:

    ``` hdbsql
    hdbuserstore list
    ```

    В выходных данных команды должен отобразиться ключ {SID} {DBNAME}, а пользователь, показанный как АЗУРЕВЛБАККУФАНАУСЕР.

> [!NOTE]
> Убедитесь, что у вас есть уникальный набор файлов ССФС в разделе **/УСР/САП/{СИД}/Хоме/.хдб/** . В этом пути должна быть только одна папка.

### <a name="setting-up-backint-parameters"></a>Настройка параметров Backint) создание

После выбора базы данных для резервного копирования служба Azure Backup настраивает параметры Backint) создание на уровне базы данных:

- [catalog_backup_using_backint: true]
- [enable_accumulated_catalog_backup: false]
- [parallel_data_backup_backint_channels: 1]
- [log_backup_timeout_s: 900)]
- [backint_response_timeout: 7200]

> [!NOTE]
> Убедитесь, что эти параметры *отсутствуют* на уровне узла. Параметры уровня узла будут переопределять эти параметры и могут вызвать непредвиденное поведение.

## <a name="restore-checks"></a>Проверки восстановления

### <a name="single-container-database-sdc-restore"></a>Восстановление базы данных одного контейнера (SDC)

Следите за входными данными при восстановлении одной базы данных контейнера (SDC) для HANA на другой компьютер SDC. Имя базы данных должно быть указано в нижнем регистре, а в скобках — "SDC". Экземпляр HANA будет отображаться прописными буквами.

Предположим, что создается резервная копия экземпляра SDC HANA "H21". На странице архивные элементы отобразится имя элемента резервного копирования **"H21 (SDC)"** . При попытке восстановления этой базы данных на другой целевой SDC, скажем H11, необходимо предоставить следующие входные данные.

![Входные данные для восстановления SDC](media/backup-azure-sap-hana-database/hana-sdc-restore.png)

Обратите внимание на следующие моменты.

- По умолчанию восстановленное имя базы данных будет заполнено именем элемента резервного копирования, т. е., H21 (SDC).
- Выбор целевого объекта в качестве H11 не приведет к автоматическому изменению имени восстановленной базы данных. **Его следует изменить на H11 (SDC)** . В случае с SDC восстановленное имя базы данных будет ИДЕНТИФИКАТОРом целевого экземпляра с строчными буквами, а "SDC" — в квадратных скобках.
- Поскольку SDC может иметь только одну базу данных, необходимо также установить флажок, чтобы разрешить переопределение существующих данных базы данных с данными точек восстановления.
- В Linux учитывается регистр, поэтому сохраните регистр.

### <a name="multiple-container-database-mdc-restore"></a>Восстановление базы данных нескольких контейнеров (MDC)

В нескольких базах данных контейнеров для HANA Стандартная конфигурация — СИСТЕМДБ + 1 или более баз данных клиента. Восстановление всего экземпляра SAP HANA означает восстановление как СИСТЕМДБ, так и баз данных клиента. Сначала восстанавливается СИСТЕМДБ, а затем продолжается для базы данных клиента. По сути, системная база данных переопределяет сведения о системе для выбранного целевого объекта. Это также переопределяет сведения, связанные с Backint) создание, в целевом экземпляре. Поэтому после восстановления системной базы данных на целевом экземпляре необходимо повторно запустить сценарий предварительной регистрации. Только последующие восстановления базы данных клиента будут выполнены.

## <a name="common-user-errors"></a>Распространенные ошибки пользователей

### <a name="usererrorinopeninghanaodbcconnection"></a>усерерроринопенингханаодбкконнектион

data| Сообщение об ошибке | Возможные причины | Рекомендуемое действие |
|---|---|---|
| Не удалось подключиться к системе HANA. Убедитесь, что система работает.| Службе Azure Backup не удается подключиться к HANA, так как база данных HANA не работает. Или HANA работает, но не допускает подключения к службе Azure Backup. | Проверьте, не отключена ли база данных HANA или служба. Если база данных или служба HANA работает и запущена, проверьте, [установлены ли все разрешения](#setting-up-permissions). Если ключ отсутствует, повторно запустите сценарий перед регистрацией, чтобы создать новый ключ. |

### <a name="usererrorinvalidbackintconfiguration"></a>усерерроринвалидбаккинтконфигуратион

| Сообщение об ошибке | Возможные причины | Рекомендуемое действие |
|---|---|---|
| Обнаружена недопустимая конфигурация Backint) создание. Отключите защиту и перенастройте базу данных.| Параметры Backint) создание неправильно указаны для Azure Backup. | Проверьте, [заданы ли параметры](#setting-up-backint-parameters). Если в узле имеются параметры на основе Backint) создание, удалите их. Если параметры отсутствуют на уровне узла, но были изменены вручную на уровне базы данных, верните их к соответствующим значениям, как описано выше. Или запустите команду " **Отключить защиту" и сохраните данные резервных копий** из портал Azure, а затем выберите **возобновить резервное копирование**.|
