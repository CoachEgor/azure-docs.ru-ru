---
title: О резервной базе данных SAP HANA в Azure VMs
description: В этой статье узнайте о резервном копировании баз данных SAP HANA, работающих на виртуальных машинах Azure.
ms.topic: conceptual
ms.date: 12/11/2019
ms.openlocfilehash: 52c235c95cea73a0c51c62fcb55f7f711d2eff21
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79476463"
---
# <a name="about-sap-hana-database-backup-in-azure-vms"></a>О резервной базе данных SAP HANA в Azure VMs

Базы данных SAP HANA являются критически важными рабочими нагрузками, требующими цели низкой точки восстановления (RPO) и цели быстрого времени восстановления (RTO). Теперь можно [создать резервную связь с базами данных SAP HANA, работающими на MMs Azure,](https://docs.microsoft.com/azure/backup/tutorial-backup-sap-hana-db) с помощью [резервного копирования Azure.](https://docs.microsoft.com/azure/backup/backup-overview)

Резервное копирование Azure [сертифицировано](https://www.sap.com/dmc/exp/2013_09_adpd/enEN/#/d/solutions?id=8f3fd455-a2d7-4086-aa28-51d8870acaa5) SAP для обеспечения поддержки нативной резервной поддержки за счет использования нативных AAP HANA. Это предложение из резервного копирования Azure согласуется с мантрой **резервного** копирования Azure backtra, в ключающей к развертыванию и управлению инфраструктурой резервного копирования. Теперь можно беспрепятственно резервное копирование и восстановление баз данных SAP HANA, работающих на M-м ими Azure[(M серии VMs](../virtual-machines/m-series.md) также поддерживается сейчас!) и использовать возможности управления предприятием, которые предоставляет Azure Backup.

## <a name="added-value"></a>Добавленная стоимость

Использование резервного копирования Azure для резервного копирования и восстановления баз данных SAP HANA дает следующие преимущества:

* **15-минутная цель точки восстановления (RPO)**: Восстановление критических данных до 15 минут теперь возможно.
* **Один клик, точка в времени восстанавливает**: Восстановление производственных данных для альтернативных серверов HANA упрощается. Цепочка резервных ups и каталогов для выполнения восстановления выполняется Azure за кулисами.
* **Долгосрочное удержание**: Для строгого соблюдения и аудита потребностей. Сохраняйте резервные копии в течение многих лет, основываясь на продолжительности удержания, за которой точки восстановления будут автоматически обложены встроенной возможностью управления жизненным циклом.
* **Управление резервным копированием от Azure:** Используйте возможности управления и мониторинга резервного копирования Azure для улучшения управления. Поддерживается также Azure CLI.

Для просмотра резервного копирования и восстановления сценариев, которые мы поддерживаем сегодня, обратитесь к [матрице поддержки сценария SAP HANA.](https://docs.microsoft.com/azure/backup/sap-hana-backup-support-matrix#scenario-support)

## <a name="backup-architecture"></a>Архитектура службы Backup

![Диаграмма архитектуры резервного копирования](./media/sap-hana-db-about/backup-architecture.png)

* Процесс резервного копирования начинается с [создания хранилища служб восстановления](https://docs.microsoft.com/azure/backup/tutorial-backup-sap-hana-db#create-a-recovery-service-vault) в Azure. Это хранилище будет использоваться для хранения резервных и точек восстановления, созданных с течением времени.
* Сервер Azure VM под управлением SAP HANA зарегистрирован в хранилище, и обнаружены базы данных, которые будут [резервироваться.](https://docs.microsoft.com/azure/backup/tutorial-backup-sap-hana-db#discover-the-databases) Чтобы служба резервного копирования Azure могла обнаружить базы данных, на сервере HANA должен быть запущен [сценарий предварительной регистрации](https://aka.ms/scriptforpermsonhana) в качестве корневого пользователя.
* Этот скрипт создает пользователя **AzUREWLUPHANAUSER** DB и соответствующий ключ с тем же именем в **hdbuserstore**. Обратитесь к [разделу «Что делает сценарий предварительной регистрации»,](tutorial-backup-sap-hana-db.md#what-the-pre-registration-script-does) чтобы узнать больше о том, что делает скрипт.
* Служба резервного копирования Azure теперь устанавливает **плагин резервного копирования Azure для HANA** на зарегистрированном сервере SAP HANA.
* Пользователь **AZUREWLUPHANAUSER** DB, созданный по сценарию предварительной регистрации, используется **плагином резервного копирования Azure для HANA для** выполнения всех операций резервного копирования и восстановления. Если вы попытаетесь настроить резервную копию для DB SAP HANA без запуска этого скрипта, вы можете получить следующую ошибку: **UserErrorAScriptNotRun.**
* Для [настройки резервного копирования](https://docs.microsoft.com/azure/backup/tutorial-backup-sap-hana-db#configure-backup) на обнаруженных базах данных выберите требуемую политику резервного копирования и включите резервные копирования.

* После настройки резервного копирования служба резервного копирования Azure настраивает следующие параметры Backint на уровне DATABASE на защищенном сервере SAP HANA:
  * (catalog_backup_using_backint:true)
  * (enable_accumulated_catalog_backup:ложный)
  * (parallel_data_backup_backint_channels:1)
  * (log_backup_timeout_s:900))
  * (backint_response_timeout:7200)

>[!NOTE]
>Убедитесь, что эти параметры *не* присутствуют на уровне HOST. Параметры уровня хоста переопределяют эти параметры и могут привести к неожиданному поведению.
>

* **Плагин резервного копирования Azure для HANA** поддерживает все графики резервного копирования и детали политики. Он запускает запланированные резервные копирования и общается с **движком резервного копирования HANA** через APIs Backint.
* **Двигатель резервного копирования HANA** возвращает поток Backint с данными для резервного копирования.
* Все запланированные резервные и резервные копирования по требованию (спусковые с портала Azure), которые являются полными или дифференциальными, инициируются **плагином резервного копирования Azure для HANA.** Тем не менее, резервное копирование журнала управляется и запускается самим **двигателем резервного копирования HANA.**
* Резервное копирование Azure для SAP HANA, являясь сертифицированным решением BackInt, не зависит от базовых типов диска или VM. Резервное копирование выполняется потоками, генерируемыми HANA.

## <a name="using-azure-vm-backup-with-azure-sap-hana-backup"></a>Использование резервного копирования Azure VM с резервным копированием Azure SAP HANA

Помимо использования резервного копирования SAP HANA в Azure, обеспечивающего резервное копирование и восстановление уровня базы данных, можно использовать резервное решение Azure VM для резервного копирования ОС и дисков без базы данных.

[Сертифицированное Backint решение резервного копирования Azure SAP HANA](#backup-architecture) может быть использовано для резервного копирования и восстановления базы данных.

[Резервное копирование Azure VM](backup-azure-vms-introduction.md) может использоваться для резервного копирования ОС и других дисков, не связанных с базой данных. Резервное копирование VM принимается один раз в день, и это резервное копирование всех дисков (за исключением **Написать ускоритель (WA) диски** и **UltraDisks**). Поскольку база данных резервируется с помощью резервного решения Azure SAP HANA, можно использовать файло-согласованное резервное копирование только ОС и дисков, не относящихся к базе данных, используя возможность исключения диска, которая в настоящее время находится в предварительном просмотре.

>[!NOTE]
> Использование скриптов предварительного поста с резервным копированием Azure VM позволит обеспечить согласованное резервное копирование объемов данных. Однако, если область журнала находится на дисках WA, снимок этих дисков не может гарантировать согласованность области журнала. HANA имеет явный способ генерации резервных копий журнала по этой точной причине. Включите то же самое в SAP HANA, и они могут быть подкреплены с помощью резервного копирования Azure SAP HANA.

Чтобы восстановить VM под управлением SAP HANA, выполните следующие действия:

* [Восстановить новый VM из резервного копирования Azure VM](backup-azure-arm-restore-vms.md) из последней точки восстановления. Или создайте новый пустой VM и прикрепите диски из последней точки восстановления.
* Поскольку диски WA не резервируются, они не восстанавливаются. Создавайте пустые диски WA и область журнала.
* После установки всех других конфигураций (таких как IP, имя системы и так далее) VM будет получать данные DB из резервного копирования Azure.
* Теперь восстановите DB в VM из [резервного копирования Azure SAP HANA DB](sap-hana-db-restore.md#restore-to-a-point-in-time-or-to-a-recovery-point) в нужную точку времени.

## <a name="next-steps"></a>Дальнейшие действия

* Узнайте, как [восстановить базу данных SAP HANA, работаемую на Azure VM](https://docs.microsoft.com/azure/backup/sap-hana-db-restore)
* Узнайте, как [управлять базами данных SAP HANA, резервное копирование которых выполняется с помощью Azure Backup](https://docs.microsoft.com/azure/backup/sap-hana-db-manage).
