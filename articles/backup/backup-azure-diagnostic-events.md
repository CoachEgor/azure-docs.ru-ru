---
title: Использование настроек диагностики для хранилищ служб восстановления
description: Статья, описывающая, как использовать старые и новые диагностические события для резервного копирования Azure
ms.topic: conceptual
ms.date: 10/30/2019
ms.openlocfilehash: e3919d120e5f741af6cd30dd27e5a1dfa2b06cf2
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79136945"
---
# <a name="using-diagnostics-settings-for-recovery-services-vaults"></a>Использование параметров диагностики для хранилищ Службы восстановления

Резервное копирование Azure отправляет диагностические события, которые могут быть собраны и использованы для целей анализа, оповещения и отчетности. 

Настройки диагностических параметров для Убежища служб восстановления можно настроить через портал Azure, отправившись в хранилище и нажав на элемент меню **диагностических настроек.** Нажатие на **кнопку «Дополнительная настройка» («Добавить диагностическую настройку»** позволяет отправлять одно или несколько диагностических событий в учетную запись хранилища, концентратор событий или рабочую среду для анализа журналов (LA).

![Диагностика Настройки Клинок](./media/backup-azure-diagnostics-events/diagnostics-settings-blade.png)

## <a name="diagnostics-events-available-for-azure-backup-users"></a>Диагностические события, доступные для пользователей резервного копирования Azure

Резервное копирование Azure предоставляет следующие диагностические события, каждое из которых содержит подробные данные о определенном наборе артефактов, связанных с резервным копированием:

* CoreAzureBackup
* АддоназуреРепаупОконс
* АддоназурЕБэкапЗащищенныйInstance
* АддоназурЕБэкапДжобс
* АддоназурЕБэкПолитики
* АддоназуреРеАусХранение

[Модель данных для событий диагностики резервного копирования Azure](https://docs.microsoft.com/azure/backup/backup-azure-reports-data-model)

Данные для этих событий могут быть отправлены либо в учетную запись хранения, рабочую область Лос-Анджелеса, либо в концентратор событий. Если вы отправляете эти данные в рабочее пространство Лос-Анджелеса, необходимо выбрать **переключение ресурса на** экране **настройки диагностики** (подробнее см. разделы ниже).

## <a name="using-diagnostics-settings-with-log-analytics-la"></a>Использование диагностических настроек с помощью аналитики журналов (LA)

В соответствии с дорожной картой Azure Log Analytics резервное копирование Azure теперь позволяет отправлять данные диагностики хранилища в выделенные таблицы LA для резервного копирования. Они называются [таблицами для конкретных ресурсов.](https://docs.microsoft.com/azure/azure-monitor/platform/resource-logs-collect-workspace#resource-specific)

Чтобы отправить данные о диагностике хранилища в Лос-Анджелес:

1.  Перейдите к хранилищу и нажмите на **диагностические настройки.** Нажмите **и добавьте диагностическую настройку**.
2.  Назовите настройки Диагностики.
3.  Проверьте поле **Отправить в журнал Analytics** и выберите журнал Analytics Рабочее пространство.
4.  Выберите **Ресурс Конкретные** в переключении и проверить следующие шесть событий - **CoreAzureBackup**, **AddonAzureBackupAlerts**, **AddonAzureBackupProtectedInstance**, **AddonAzureBackupJobs**, **AddonAzureBackupPolicy**, и **AddonAzureBackupStorage**.
5.  Нажмите на **Сохранить**.

![Режим «Конкретный ресурс»](./media/backup-azure-diagnostics-events/resource-specific-blade.png)

Как только данные поступают в рабочее пространство Лос-Анджелеса, в рабочей области создаются специальные таблицы для каждого из этих событий. Вы можете задать вопрос любой из этих таблиц напрямую, а также выполнить соединения или соединения между этими таблицами, если это необходимо.

> [!IMPORTANT]
> Вышеупомянутые шесть событий, а именно: CoreAzureBackup, AddonAzureBackupAlerts, AddonAzureBackupProtectedInstance, AddonAzureBackUpJobs, AddonAzureBackupPolicy и AddonAzureBackupStorage, поддерживаются **только** в режиме ресурса. **Обратите внимание, что если вы попытаетесь отправить данные для этих шести событий в режиме Azure Diagnostics, никакие данные не будут поступать в рабочее пространство Лос-Анджелеса.**

## <a name="legacy-event"></a>Наследие событие

Традиционно все данные диагностики, связанные с резервным копированием для хранилища, содержатся в одном событии под названием «AzureBackupReport». Шесть описанных выше событий, по сути, являются разложением всех данных, содержащихся в AzureBackupReport. 

В настоящее время мы продолжаем поддерживать событие AzureBackupReport для обратной совместимости, в тех случаях, когда пользователи имеют существующие пользовательские запросы на этом событии, например, пользовательские оповещения журнала, пользовательские визуализации и т.д. Тем не менее, **мы рекомендуем перейти к новым событиям как можно раньше,** так как это значительно упрощает работу с данными в запросах журнала, обеспечивает лучшую обнаруживаемость схем и их структуры, повышает производительность как во время задержки приема, так и во время запроса. **Поддержка использования режима Azure Diagnostics в конечном итоге будет постепенно прекращена, и поэтому выбор новых событий может помочь вам избежать сложных миграций на более поздний срок.**

Используйте встроенную политику Резервного копирования Azure, чтобы добавить новую настройку диагностики с 6 новыми событиями для всех хранилищ в определенной области: [Настройте настройки диагностики Vault в масштабе](https://docs.microsoft.com/azure/backup/azure-policy-configure-diagnostics)

Вы можете создать отдельные настройки диагностики для AzureBackupReport и шести новых событий, пока не перейдете все пользовательские запросы для использования данных из новых таблиц. На рисунке ниже показан пример хранилища с двумя диагностическими настройками. Первая настройка под названием **Setting1** отправляет данные события AzureBackupReport в рабочее пространство LA в режиме AzureDiagnostics. Второй параметр под названием **Setting2** отправляет данные о шести новых событиях резервного копирования Azure в рабочее пространство LA в режиме «Конкретные ресурсы».

![Две настройки](./media/backup-azure-diagnostics-events/two-settings-example.png)

> [!IMPORTANT]
> Событие AzureBackupReport поддерживается **только** в режиме диагностики Azure. **Обратите внимание, что если вы попытаетесь отправить данные для этого события в режиме конкретного ресурса, никакие данные не будут поступать в рабочее пространство Лос-Анджелеса.**

> [!NOTE]
> Переключатель для Azure Diagnostics / Resource Specific появляется только в том случае, если пользователь проверяет **Отправку в Log Analytics.** Чтобы отправить данные в учетную запись хранения или в концентратор событий, пользователь может просто выбрать требуемый пункт назначения и проверить любое из желаемых событий, без каких-либо дополнительных входов. Опять же, рекомендуется не выбирать устаревшем событии AzureBackupReport, идущее вперед.

## <a name="users-sending-azure-site-recovery-events-to-log-analytics-la"></a>Пользователи, отправляя события восстановления сайта Azure в журнал Analytics (LA)

События восстановления резервного копирования Azure и сайта Azure отправляются из одного и того же Хранилища служб восстановления. Поскольку восстановление сайта Azure в настоящее время не находится на борту таблиц для конкретных ресурсов, пользователям, желающим отправить события восстановления сайта Azure в Лос-Анджелес, предписано использовать **только** режим azure Diagnostics (см. изображение ниже). **Выбор конкретного способа поиска ресурсов для событий восстановления сайта Azure предотвратит отправку необходимых данных в рабочее пространство LA.**

![События восстановления сайта](./media/backup-azure-diagnostics-events/site-recovery-settings.png)

Подводя итоги вышеуказанных нюансов:

* Если у вас уже есть диагностика LA, настроенная с azure Diagnostics, и у вас есть письменные пользовательские запросы поверх нее, держите эту настройку **нетронутой**до тех пор, пока вы не перейдьте свои запросы, чтобы использовать данные из новых событий.
* Если вы также хотите, чтобы на борту новых таблиц (как рекомендуется), создать **новую** настройку диагностики, выберите **ресурс конкретных** и выбрать шесть новых событий, как указано выше.
* Если в настоящее время вы отправляете события восстановления сайта Azure в Лос-Анджелес, **не** выбирайте для этих событий режим «Конкретный ресурс», в противном случае данные для этих событий не будут поступать в рабочее пространство Лос-Анджелеса. Вместо этого создайте **дополнительную диагностическую настройку,** выберите **Azure Diagnostics**и выберите соответствующие события восстановления сайта Azure.

На рисунке ниже показан пример пользователя, имеющего три диагностических настройки для хранилища. Первая настройка под названием **Setting1** отправляет данные из события AzureBackupReport в рабочее пространство LA в режиме AzureDiagnostics. Второй параметр под названием **Setting2** отправляет данные из шести новых событий резервного копирования Azure в рабочее пространство LA в режиме «Конкретные ресурсы». Третья параметр, названная **Setting3,** отправляет данные из событий восстановления сайта Azure в рабочее пространство LA в режиме диагностики Azure.

![Три настройки](./media/backup-azure-diagnostics-events/three-settings-example.png)

## <a name="next-steps"></a>Дальнейшие действия

[Изучите модель данных анализа журналов для диагностических событий](https://docs.microsoft.com/azure/backup/backup-azure-reports-data-model)
