---
title: Устранение неполадок при архивации состояния системы с помощью Azure Backup
description: Устранение неполадок в резервной копии состояния системы.
services: backup
author: srinathvasireddy
manager: sivan
keywords: как создать резервную копию; состояние системы резервного копирования
ms.service: backup
ms.topic: conceptual
ms.date: 05/09/2019
ms.author: srinathv
ms.openlocfilehash: 87b5fff58ecf9e89bc94f31a0bc3a591c146c88f
ms.sourcegitcommit: c105ccb7cfae6ee87f50f099a1c035623a2e239b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/09/2019
ms.locfileid: "67704999"
---
# <a name="troubleshoot-system-state-backup"></a>Устранение неполадок при архивации состояния системы

В этой статье описывается устранение проблем, которые могут возникнуть при использовании резервного копирования состояния системы.

## <a name="basic-troubleshooting"></a>Базовое устранение неполадок
Рекомендуется выполнить ниже проверки, прежде чем начать устранение неполадок резервного копирования состояния системы:

- [Убедитесь, что агент служб восстановления Microsoft Azure (MARS) в актуальном состоянии](https://go.microsoft.com/fwlink/?linkid=229525&clcid=0x409)
- [Убедитесь, что между агентом служб восстановления Microsoft Azure и Azure установлено сетевое подключение](https://aka.ms/AB-A4dp50)
- Убедитесь, что службы восстановления Microsoft Azure запущены (на сервисной консоли). Если необходимо, выполните перезагрузку и повторите операцию.
- [Убедитесь, что в расположении временной папки доступно 5–10 % свободного места](https://aka.ms/AB-AA4dwtt).
- [Проверьте, не влияет ли на работу службы Azure Backup другой процесс или антивирусная программа](https://aka.ms/AB-AA4dwtk).
- [Запланированное резервное копирование завершается сбоем, но резервное копирование вручную работает](https://aka.ms/ScheduledBackupFailManualWorks).
- Убедитесь, что в вашей операционной системе установлены последние обновления.
- [Убедитесь, неподдерживаемые диски и файлы с неподдерживаемые атрибуты исключены из резервной копии](backup-support-matrix-mars-agent.md#supported-drives-or-volumes-for-backup)
- Убедитесь, что на **системных часах** в защищенной системе правильно настроен часовой пояс. <br>
- [Убедитесь, что на сервере используется версия .Net Framework не ниже 4.5.2.](https://www.microsoft.com/download/details.aspx?id=30653)<br>
- Если вы пытаетесь **повторно зарегистрировать сервер** в хранилище, <br>
  - убедитесь, что агент удален с сервера и с портала. <br>
  - Используйте ту же парольную фразу, которая изначально использовалась для регистрации сервера. <br>
- В случае автономного резервного копирования убедитесь, что Azure PowerShell версии 3.7.0 установлен на компьютере источника и копии, перед началом операции резервного копирования в автономном режиме
- [Следует учитывать, когда агент службы архивации запущен на виртуальной машине Azure](https://aka.ms/AB-AA4dwtr)

### <a name="limitation"></a>Ограничение
- Корпорация Майкрософт не рекомендует выполнять восстановление на другое оборудование с помощью функции восстановления состояния системы.
- Резервное копирование состояния системы в настоящее время поддерживает «локально» серверы Windows, эта функция недоступна для виртуальных машин Azure.

## <a name="pre-requisite"></a>Предварительные требования

Прежде чем мы Устранение неполадок резервного копирования состояния системы с помощью Azure Backup, убедитесь, вы выполнение ниже предварительные проверки.  

### <a name="verify-windows-server-backup-is-installed"></a>Убедитесь, что установлена система архивации данных Windows Server

Убедитесь, архивации данных Windows Server установлена и включена на сервере. Чтобы проверить состояние установки, выполните указанную ниже команду PowerShell:

 ```
 PS C:\> Get-WindowsFeature Windows-Server-Backup
 ```
Если в выходных данных отображаются **состояние установки** как **доступных**, это означает, что функция резервного копирования Windows Server, доступные для установки, но не установлена на сервере. Тем не менее если архивации данных Windows Server не установлен, выполните одно из указанных ниже методов, чтобы установить его.

**Метод 1. Установка архивации данных Windows Server, с помощью PowerShell**

Чтобы установить архивации данных Windows Server, с помощью PowerShell, выполните следующую команду:

  ```
  PS C:\> Install-WindowsFeature -Name Windows-Server-Backup
  ```

**Метод 2. Установка с помощью диспетчера сервера архивации данных Windows Server**

Чтобы установить архивации данных Windows Server, с помощью диспетчера сервера, выполните ниже:

1. В **Sever Manger** и нажмите кнопку **Добавить роли и компоненты**. **Мастера добавления ролей и компонентов** отображается.

    ![панель мониторинга](./media/backup-azure-system-state-troubleshoot/server_management.jpg)

2. Выберите **тип установки** и нажмите кнопку **Далее**.

    ![Тип установки](./media/backup-azure-system-state-troubleshoot/install_type.jpg)

3. Выберите сервер из пула серверов и нажмите кнопку **Далее**. В роли сервера, не изменяя заданные по умолчанию и нажмите кнопку **Далее**.
4. Выберите **архивации данных Windows Server** в **функции** вкладку и нажмите кнопку **Далее**.

    ![features](./media/backup-azure-system-state-troubleshoot/features.png)

5. В **Подтверждение** щелкните **установить** для запуска процесса установки.
6. В **результаты** вкладке будет отображаться архивации данных Windows Server, компонент успешно установлен на сервере Windows Server.

    ![result](./media/backup-azure-system-state-troubleshoot/results.jpg)


### <a name="system-volume-information-permission"></a>Разрешение сведения системы тома

Убедитесь, что локальная система имеет полный доступ **System Volume Information** папка находится на томе, где установлена ОС windows. Обычно это **C:\System Volume Information**. Резервное копирование Windows Server может завершиться ошибкой, если эти разрешения не заданы правильно

### <a name="dependent-services"></a>Зависимые службы

Убедитесь, ниже службы находятся в рабочем состоянии:

**Имя службы** | **Тип запуска**
--- | ---
Call(RPC) удаленных процедур | Автоматический
System(EventSystem) событий COM + | Автоматический
Система событий уведомления Service(SENS) | Автоматический
Запуск тени тома | Руководство
Программное обеспечение Майкрософт теневого копирования Provider(SWPRV) | Руководство

### <a name="validate-windows-server-backup-status"></a>Проверить состояние архивации данных Windows Server

Чтобы проверить состояние архивации данных Windows Server, выполните ниже:

  * Проверьте, запущен WSB PowerShell

    -   Запустите `Get-WBJob` из PowerShell с повышенными привилегиями и убедитесь, что он не возвращает следующую ошибку:

    > [!WARNING]
    > Get-WBJob: Термин «Get-WBJob» не распознан как имя командлета, функции, файла скрипта или действующей программы. Проверьте правильность написания имени, а также наличие и правильность пути, после чего повторите попытку.

    -   Если он завершается с ошибкой этой ошибки повторно установите средство архивации данных Windows Server на компьютере-сервере как уже упоминалось в предварительных требованиях шаг 1.

  * Убедитесь, резервной копии WSB работает правильно, выполнив следующую команду из командной строки с повышенными правами:

      `wbadmin start systemstatebackup -backuptarget:X: -quiet`

      > [!NOTE]
      >Замените X буквой диска тома, где вы хотите сохранить состояние системы резервного копирования образа.

    - Периодически проверять состояние задания, выполнив `Get-WBJob` команду PowerShell с повышенными        
    - После завершения задания резервного копирования проверьте конечное состояние задания, выполнив `Get-WBJob -Previous 1` команды

В случае сбоя, он указывает на неполадку WSB, что привело бы к агента MARS сбоя резервные копии состояния системы.

## <a name="common-errors"></a>Распространенные ошибки

### <a name="vss-writer-timeout-error"></a>Ошибка времени ожидания модуля записи VSS

| Симптом | Причина: | Способы устранения:
| -- | -- | --
| -Агент MARS завершается сбоем с сообщением об ошибке: «Задание WSB завершилась с ошибками VSS. Проверьте журналы событий VSS, чтобы устранить ошибку»<br/><br/> -Следующую ошибку журнала присутствует в журналы событий приложений VSS: «Модуль записи VSS отклонил событие с ошибкой 0x800423f2, истекло время ожидания для автора между событиями закрепить» и «Разморозить».| Модуль записи VSS не удалось выполнить времени из-за нехватки ресурсов ЦП и памяти на компьютере <br/><br/> Другой программы резервного копирования уже использует модуль записи VSS, поэтому не удалось завершить операцию моментального снимка для этой резервной копии | Ожидания ЦП и памяти освободить в системе или прервать процессы, используя слишком много памяти или ресурсов ЦП и повторите попытку <br/><br/>  Ожидания для текущего резервного копирования для завершения и повторите операцию позднее, при выполнении на компьютере нет резервных копий


### <a name="insufficient-disk-space-to-grow-shadow-copies"></a>Недостаточно дискового пространства для роста теневых копий

| Симптом | Способы устранения:
| -- | --
| -Агент MARS завершается сбоем с сообщением об ошибке: Произошел сбой при архивации, так как том теневых копий не может увеличиваться из-за нехватки места на диске для томов, содержащих системные файлы <br/><br/> — После ошибки или предупреждения журнала присутствует в журналы событий системы volsnap: «Возникла недостаточно места на диске в томе C: для увеличения хранилища теневых копий для теневых копий C: из-за этого сбоя все теневые копии тома C:, подвержены риску удаления» | -Освобождения выделенного тома в журнале событий, чтобы достаточно места для теневых копий расти, пока выполняется операция резервного копирования <br/><br/> — При настройке места теневых копий, мы можете ограничить объем пространства, используемого для теневого копирования, Дополнительные сведения см. в этом [статьи](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/cc788050(v=ws.11)#syntax)


### <a name="efi-partition-locked"></a>Системный раздел EFI заблокирован

| Симптом | Способы устранения:
| -- | --
| Агент служб восстановления Microsoft AZURE завершается сбоем с сообщением об ошибке: «Состояние системы обратно до произошел сбой, системный раздел EFI заблокирован. Это может быть из-за доступ к системе секции по безопасности сторонних или резервную копию программного обеспечения» | — Если проблема не возникает из-за независимых поставщиков программного обеспечения, следует обратиться к поставщику защиты от вирусов, таким образом, чтобы они допускают агента MARS <br/><br/> — Если запущена стороннего программного обеспечения резервного копирования, дождитесь завершения и повторите попытку резервного копирования


## <a name="next-steps"></a>Следующие шаги

- Дополнительные сведения о состоянии системы Windows в развертывании Resource Manager, см. в разделе [резервного копирования состояния системы Windows Server](backup-azure-system-state.md)
