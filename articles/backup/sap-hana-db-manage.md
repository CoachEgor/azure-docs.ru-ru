---
title: Управление резервными копиями баз данных SAP HANA на виртуальных машинах Azure
description: Из этой статьи вы узнаете о стандартных задачах по управлению и мониторингу SAP HANA баз данных, работающих на виртуальных машинах Azure.
ms.topic: conceptual
ms.date: 11/12/2019
ms.openlocfilehash: 89fd7f23163d301817e767771257d9bc6f4ed526
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "79480068"
---
# <a name="manage-and-monitor-backed-up-sap-hana-databases"></a>Мониторинг резервных копий баз данных SAP HANA и управление ими

В этой статье описываются распространенные задачи по управлению и мониторингу SAP HANA баз данных, работающих на виртуальной машине Azure, и резервное копирование в хранилище служб восстановления Azure Backup с помощью службы [Azure Backup](https://docs.microsoft.com/azure/backup/backup-overview) . Вы узнаете, как отслеживать задания и оповещения, запускать резервное копирование по запросу, изменять политики, прекращать и возобновлять защиту базы данных и отменять регистрацию виртуальной машины из резервных копий.

Если вы еще не настроили резервные копии для баз данных SAP HANA, см. статью [резервное копирование SAP HANA баз данных на виртуальных машинах Azure](https://docs.microsoft.com/azure/backup/backup-azure-sap-hana-database).

## <a name="monitor-manual-backup-jobs-in-the-portal"></a>Мониторинг заданий резервного копирования вручную на портале

Azure Backup отображаются все задания, активированные вручную в разделе **задания резервного копирования** на портал Azure.

![Раздел заданий резервного копирования](./media/sap-hana-db-manage/backup-jobs.png)

Задания, отображаемые на этом портале, включают в себя обнаружение и регистрацию базы данных, а также операции резервного копирования и восстановления. Запланированные задания, включая резервные копии журналов, не показаны в этом разделе. Запуск резервного копирования вручную из SAP HANA собственных клиентов (панель «Studio/панель» или «DBA») также не отображается здесь.

![Список заданий резервного копирования](./media/sap-hana-db-manage/backup-jobs-list.png)

Чтобы узнать больше о мониторинге, перейдите к разделу [мониторинг в портал Azure](https://docs.microsoft.com/azure/backup/backup-azure-monitoring-built-in-monitor) и [мониторинг с помощью Azure Monitor](https://docs.microsoft.com/azure/backup/backup-azure-monitoring-use-azuremonitor).

## <a name="view-backup-alerts"></a>Просмотр оповещений о резервном копировании

Оповещения — это простой способ наблюдения за резервными копиями баз данных SAP HANA. Оповещения позволяют сосредоточиться на наиболее важных событиях без потери данных в множестве событий, создаваемых резервной копией. Azure Backup позволяет настроить оповещения, которые можно отслеживать следующим образом.

* Войдите на [портал Azure](https://portal.azure.com/).
* На панели мониторинга хранилища выберите **оповещения архивации**.

  ![Оповещения архивации на панели мониторинга хранилища](./media/sap-hana-db-manage/backup-alerts-dashboard.png)

* Вы увидите оповещения:

  ![Список оповещений резервного копирования](./media/sap-hana-db-manage/backup-alerts-list.png)

* Щелкните оповещения, чтобы просмотреть дополнительные сведения:

  ![Сведения об оповещении](./media/sap-hana-db-manage/alert-details.png)

В настоящее время Azure Backup позволяет отправлять оповещения по электронной почте. Эти оповещения:

* Активируется для всех сбоев резервного копирования.
* Консолидация на уровне базы данных по коду ошибки.
* Отправляется только для первого сбоя резервного копирования базы данных.

Ограниченные дополнительные сведения о мониторинге, перейдите к разделу [мониторинг в портал Azure](https://docs.microsoft.com/azure/backup/backup-azure-monitoring-built-in-monitor) и [мониторинг с помощью Azure Monitor](https://docs.microsoft.com/azure/backup/backup-azure-monitoring-use-azuremonitor).

## <a name="management-operations"></a>Операции управления

Azure Backup упрощает управление резервной базой данных SAP HANA с помощью множество операций управления, которые она поддерживает. Эти операции подробно обсуждаются в следующих разделах.

### <a name="run-an-on-demand-backup"></a>Выполнение резервного копирования по запросу

Резервные копии выполняются в соответствии с расписанием политики. Резервное копирование по запросу можно выполнить следующим образом:

1. В меню хранилища щелкните **Элементы архивации**.
2. В поле **архивные элементы**выберите виртуальную машину, на которой выполняется SAP HANAная база данных, а затем щелкните **Архивация сейчас**.
3. В поле **создать резервную копию**используйте элемент управления Calendar, чтобы выбрать последний день, в который должна храниться точка восстановления. После этого щелкните **OK**.
4. Отслеживайте уведомления на портале. Ход > **выполнения задания**можно отслеживать на панели мониторинга хранилища > **задания резервного копирования**. В зависимости от размера базы данных создание начальной резервной копии может занять некоторое время.

### <a name="hana-native-client-integration"></a>Интеграция собственного клиента HANA

Теперь все резервные копии по требованию, активируемые любыми собственными клиентами HANA, будут отображаться как полные резервные копии на странице **архивные элементы** .

![Последнее выполнение резервного копирования](./media/sap-hana-db-manage/last-backups.png)

Эти специальные полные резервные копии также будут отображаться в списке точек восстановления для восстановления.

![Список точек восстановления](./media/sap-hana-db-manage/list-restore-points.png)

### <a name="run-sap-hana-native-client-backup-on-a-database-with-azure-backup-enabled"></a>Запуск SAP HANA резервного копирования собственного клиента в базе данных с включенной службой архивации Azure

Если вы хотите создать локальную резервную копию (с помощью HANA Studio или панели) базы данных, для которой создается резервная копия Azure Backup, выполните следующие действия.

1. Дождитесь завершения всех полных или резервных копий журналов для базы данных. Проверьте состояние в SAP HANA Studio или панели.
2. Отключите резервное копирование журналов и задайте в качестве каталога резервного копирования файловую систему для соответствующей базы данных.
3. Для этого дважды щелкните**Конфигурация** >  **системдб** > ,**выберите фильтр базы данных** > **(журнал)**.
4. Задайте для параметра **enable_auto_log_backup** значение **нет**.
5. Задайте **log_backup_using_backint** для Log_backup_using_backint **значение false**.
6. Создайте полную резервную копию базы данных по требованию.
7. Дождитесь завершения полного резервного копирования и резервного копирования каталога.
8. Верните предыдущие параметры в Azure.
   * Задайте для параметра **enable_auto_log_backup** значение **Да**.
   * Задайте **log_backup_using_backint** для Log_backup_using_backint **значение true**.

### <a name="change-policy"></a>Изменение политики

Можно изменить базовую политику для SAP HANA элемента резервного копирования.

* На панели мониторинга хранилища выберите **пункт архивные элементы**.

  ![Выбор элементов архивации](./media/sap-hana-db-manage/backup-items.png)

* Выбор **SAP HANA в виртуальной машине Azure**

  ![Выбор SAP HANA в виртуальной машине Azure](./media/sap-hana-db-manage/sap-hana-in-azure-vm.png)

* Выберите элемент архивации, базовую политику которого необходимо изменить.
* Щелкните существующую политику архивации.

  ![Выберите существующую политику архивации](./media/sap-hana-db-manage/existing-backup-policy.png)

* Измените политику, выбрав ее из списка. При необходимости [Создайте новую политику архивации](https://docs.microsoft.com/azure/backup/backup-azure-sap-hana-database#create-a-backup-policy) .

  ![Выберите политику из раскрывающегося списка](./media/sap-hana-db-manage/choose-backup-policy.png)

* Сохраните изменения

  ![Сохраните изменения](./media/sap-hana-db-manage/save-changes.png)

* Изменение политики повлияет на все связанные элементы резервного копирования и триггер, соответствующие **настройкам заданий защиты** .

>[!NOTE]
> Любые изменения в сроке хранения будут применены ретроспективели ко всем старым точкам восстановления, кроме новых.
>
> Политики добавочного резервного копирования нельзя использовать для баз данных SAP HANA. Добавочная архивация в настоящее время не поддерживается для этих баз данных.

### <a name="modify-policy"></a>Изменение политики

Измените политику, чтобы изменить типы резервных копий, частоты и диапазон хранения.

>[!NOTE]
>Любые изменения в сроке хранения будут применены задним числом ко всем старым точкам восстановления в дополнение к новым.

1. На панели мониторинга хранилища перейдите в раздел **управление > политики резервного копирования** и выберите политику, которую нужно изменить.

   ![Выберите политику для изменения](./media/sap-hana-db-manage/manage-backup-policies.png)

1. Нажмите кнопку **Изменить**.

   ![Выберите Изменить.](./media/sap-hana-db-manage/modify-policy.png)

1. Выберите частоту для типов резервных копий.

   ![Выберите периодичность резервного копирования](./media/sap-hana-db-manage/choose-frequency.png)

Изменение политики повлияет на все связанные элементы резервного копирования и триггер, соответствующие **настройкам заданий защиты** .

### <a name="inconsistent-policy"></a>Несовместимая политика

Иногда операция изменения политики может привести к **несовместимости** версии политики для некоторых элементов резервного копирования. Это происходит, если соответствующее задание **настройки защиты** для элемента резервного копирования завершается сбоем после запуска операции изменения политики. В представлении элемента резервного копирования он выглядит следующим образом:

![Несовместимая политика](./media/sap-hana-db-manage/inconsistent-policy.png)

Вы можете исправить версию политики для всех затронутых элементов одним щелчком мыши:

![Исправление версии политики](./media/sap-hana-db-manage/fix-policy-version.png)

### <a name="stop-protection-for-an-sap-hana-database"></a>Остановка защиты для базы данных SAP HANA

Вы можете остановить создание резервных копий базы данных SQL Server несколькими способами:

* можно остановить все будущие задания резервного копирования и удалить все точки восстановления;
* остановить все будущие задания резервного копирования, но сохранить точки восстановления без изменений.

Если вы решили сохранить точки восстановления, учитывайте следующие факторы:

* все точки восстановления навсегда остаются неизменными, любая очистка прекращается одновременно с отключением защиты;
* Вы получите оплату за защищенный экземпляр и используемое хранилище. Дополнительные сведения см. в разделе [цены на Azure Backup](https://azure.microsoft.com/pricing/details/backup/).
* если вы удалите источник данных без остановки резервного копирования, новые операции резервного копирования будут завершаться сбоем.

Чтобы остановить защиту базы данных, выполните следующие действия.

* На панели мониторинга хранилища выберите пункт **архивные элементы**.
* В разделе **тип управления архивацией**выберите **SAP HANA на виртуальной машине Azure** .

  ![Выбор SAP HANA на виртуальной машине Azure](./media/sap-hana-db-manage/sap-hana-azure-vm.png)

* Выберите базу данных, для которой требуется отключить защиту:

  ![Выбор базы данных для отключения защиты](./media/sap-hana-db-manage/select-database.png)

* В меню базы данных выберите **Остановить архивацию**.

  ![Выбор прерывать архивацию](./media/sap-hana-db-manage/stop-backup.png)

* В меню " **Отменить архивацию** " выберите, следует ли хранить или удалять данные. При необходимости укажите причину и комментарий.

  ![Выберите "хранить или удалить данные"](./media/sap-hana-db-manage/retain-backup-data.png)

* Выберите пункт **прерывать архивацию**.

### <a name="resume-protection-for-an-sap-hana-database"></a>Возобновление защиты для базы данных SAP HANA

При отключении защиты для базы данных SAP HANA, если выбран параметр **хранить данные резервной копии** , можно позднее возобновить защиту. Если не хранить резервные данные, вы не сможете возобновить защиту.

Чтобы возобновить защиту базы данных SAP HANA:

* Откройте элемент архивации и выберите **возобновить резервное копирование**.

   ![Выбор возобновления резервного копирования](./media/sap-hana-db-manage/resume-backup.png)

* В меню **Политика архивации** выберите политику и нажмите кнопку **Сохранить**.

### <a name="upgrading-from-sap-hana-10-to-20"></a>Обновление с SAP HANA 1,0 до 2,0

Узнайте, как продолжить резервное копирование для SAP HANA базы данных [после обновления с SAP HANA 1,0 до 2,0](backup-azure-sap-hana-database-troubleshoot.md#upgrading-from-sap-hana-10-to-20).

### <a name="upgrading-without-a-sid-change"></a>Обновление без изменения SID

Узнайте, как продолжить резервное копирование базы данных SAP HANA, [идентификатор безопасности которой не изменился после обновления](backup-azure-sap-hana-database-troubleshoot.md#upgrading-without-an-sid-change).

### <a name="unregister-an-sap-hana-instance"></a>Отмена регистрации экземпляра SAP HANA

Отмените регистрацию экземпляра SAP HANA после отключения защиты, но перед удалением хранилища выполните следующие действия.

* На панели мониторинга хранилища в разделе **Управление**выберите **инфраструктура резервного копирования**.

   ![Выбор "Инфраструктура резервного копирования"](./media/sap-hana-db-manage/backup-infrastructure.png)

* Выбор **типа управления архивацией** **в качестве рабочей нагрузки на виртуальной машине Azure**

   ![Выбор типа управления архивацией в качестве рабочей нагрузки на виртуальной машине Azure](./media/sap-hana-db-manage/backup-management-type.png)

* В списке **защищенные серверы**выберите экземпляр для отмены регистрации. Чтобы удалить хранилище, необходимо отменить регистрацию всех серверов и экземпляров.

* Щелкните правой кнопкой мыши защищенный экземпляр и выберите отменить **регистрацию**.

   ![Выбрать отмену регистрации](./media/sap-hana-db-manage/unregister.png)

### <a name="re-register-extension-on-the-sap-hana-server-vm"></a>Повторно зарегистрируйте расширение на виртуальной машине сервера SAP HANA

Иногда расширение рабочей нагрузки на виртуальной машине может затронуть одну причину или другую. В таких случаях все операции, запущенные на виртуальной машине, начнут завершаться сбоем. Вам может потребоваться повторно зарегистрировать расширение на виртуальной машине. Операция повторной регистрации переустанавливает модуль резервного копирования рабочей нагрузки на виртуальной машине для продолжения операций.

Используйте этот параметр с осторожностью: при активации на виртуальной машине с уже работоспособным расширением эта операция приведет к перезапуску расширения. Это может привести к сбою всех выполняемых заданий. Проверьте наличие одной или нескольких [симптомов](backup-azure-sap-hana-database-troubleshoot.md#re-registration-failures) перед активацией операции повторной регистрации.

## <a name="next-steps"></a>Дальнейшие шаги

* Узнайте, как [устранять распространенные проблемы при резервном копировании баз данных SAP HANA.](https://docs.microsoft.com/azure/backup/backup-azure-sap-hana-database-troubleshoot)
