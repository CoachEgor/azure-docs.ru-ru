---
title: Управление резервными копиями баз данных SAP HANA на виртуальных машинах Azure
description: Из этой статьи вы узнаете о стандартных задачах по управлению и мониторингу баз данных SAP HANA, работающих на виртуальных машинах Azure.
ms.topic: conceptual
ms.date: 11/12/2019
ms.openlocfilehash: e3705750e32b8b34ed397b8f68f22b0728129266
ms.sourcegitcommit: 595cde417684e3672e36f09fd4691fb6aa739733
ms.contentlocale: ru-RU
ms.lasthandoff: 05/20/2020
ms.locfileid: "83701118"
---
# <a name="manage-and-monitor-backed-up-sap-hana-databases"></a>Мониторинг резервных копий баз данных SAP HANA и управление ими

В этой статье описываются распространенные задачи по управлению и мониторингу баз данных SAP HANA, работающих на виртуальной машине Azure, и резервное копирование которых выполняется в хранилище Служб восстановления Azure Backup с помощью службы [Azure Backup](https://docs.microsoft.com/azure/backup/backup-overview). Вы узнаете, как отслеживать задания и оповещения, запускать резервное копирование по запросу, изменять политики, останавливать и возобновлять защиту базы данных и отменять регистрацию виртуальной машины из резервных копий.

Если вы еще не настроили резервное копирование баз данных SAP HANA, см. статью [Резервное копирование баз данных SAP HANA на виртуальных машинах Azure](https://docs.microsoft.com/azure/backup/backup-azure-sap-hana-database).

## <a name="monitor-manual-backup-jobs-in-the-portal"></a>Мониторинг на портале заданий резервного копирования, запущенных вручную

Azure Backup отображает все запущенные вручную задания на портале Azure в разделе **Задания резервного копирования**.

![Раздел "Задания резервного копирования"](./media/sap-hana-db-manage/backup-jobs.png)

Задания, отображаемые на этом портале, включают в себя операции обнаружения и регистрации базы данных, а также резервного копирования и восстановления. Запланированные задания, включая резервные копии журналов, не отображаются в этом разделе. Ручное резервное копирование, запущенное из собственных клиентов SAP HANA (Studio, Cockpit или DBA Cockpit), также не отображается здесь.

![Список заданий резервного копирования](./media/sap-hana-db-manage/backup-jobs-list.png)

Дополнительные сведения о мониторинге см. в разделах [Мониторинг на портале Azure](https://docs.microsoft.com/azure/backup/backup-azure-monitoring-built-in-monitor) и [Мониторинг с помощью Azure Monitor](https://docs.microsoft.com/azure/backup/backup-azure-monitoring-use-azuremonitor).

## <a name="view-backup-alerts"></a>Просмотр оповещений о резервном копировании

Оповещения — это простой способ наблюдения за резервными копиями баз данных SAP HANA. Оповещения позволяют сосредоточиться на наиболее важных событиях и не потеряться во множестве событий, создаваемых резервным копированием. Azure Backup позволяет настроить оповещения, которые можно отслеживать следующим образом.

* Войдите на [портал Azure](https://portal.azure.com/).
* На панели мониторинга хранилища выберите **Оповещения резервного копирования**.

  ![Оповещения резервного копирования на панели мониторинга хранилища](./media/sap-hana-db-manage/backup-alerts-dashboard.png)

* Вы увидите оповещения.

  ![Список оповещений резервного копирования](./media/sap-hana-db-manage/backup-alerts-list.png)

* Щелкните оповещения, чтобы просмотреть дополнительные сведения.

  ![Сведения об оповещении](./media/sap-hana-db-manage/alert-details.png)

В настоящее время Azure Backup позволяет отправлять оповещения по электронной почте. Эти оповещения приведены ниже.

* Оповещения о любых сбоях резервного копирования.
* Оповещения, объединенные на уровне базы данных по коду ошибки.
* Оповещения, отправляемые только для первого сбоя резервного копирования базы данных.

Дополнительные сведения о мониторинге см. в разделах [Мониторинг на портале Azure](https://docs.microsoft.com/azure/backup/backup-azure-monitoring-built-in-monitor) и [Мониторинг с помощью Azure Monitor](https://docs.microsoft.com/azure/backup/backup-azure-monitoring-use-azuremonitor).

## <a name="management-operations"></a>Операции управления

Azure Backup упрощает управление резервной копией базы данных SAP HANA благодаря поддержке множества операций управления. Эти операции подробно обсуждаются в следующих разделах.

### <a name="run-an-on-demand-backup"></a>Выполнение резервного копирования по запросу

Резервное копирование выполняется в соответствии с расписанием политики. Резервное копирование по запросу можно выполнить следующим образом.

1. В меню хранилища щелкните **Элементы архивации**.
2. В **элементах архивации** выберите виртуальную машину, на которой запущена база данных SAP HANA, а затем щелкните **Создать резервную копию**.
3. В окне **Создать резервную копию** используйте элементы управления "Календарь", чтобы выбрать последний день, до которого должна храниться точка восстановления. Нажмите кнопку **ОК**.
4. Отслеживайте уведомления на портале. Вы можете отслеживать ход выполнения задания на панели мониторинга хранилища в разделе **Задания резервного копирования** > **Выполняется**. В зависимости от размера базы данных создание начального архива может занять некоторое время.

### <a name="hana-native-client-integration"></a>Интеграция собственного клиента HANA

#### <a name="backup"></a>Резервное копирование

Резервные копии по запросу, активируемые из любых собственных клиентов HANA (в **Backint**), будут отображаться в списке резервных копий на странице **Элементы архивации**.

![Последнее резервное копирование](./media/sap-hana-db-manage/last-backups.png)

Кроме того, можно [отслеживать эти резервные копии](https://docs.microsoft.com/azure/backup/sap-hana-db-manage#monitor-manual-backup-jobs-in-the-portal) на странице **Задания резервного копирования**.

Эти резервные копии, созданные по запросу, также будут отображаться в списке точек восстановления для восстановления.

![Список точек восстановления](./media/sap-hana-db-manage/list-restore-points.png)

#### <a name="restore"></a>Восстановить

Восстановление, запущенное из собственных клиентов HANA (с использованием **Backint**) для восстановления на тот же компьютер, можно [отслеживать](https://docs.microsoft.com/azure/backup/sap-hana-db-manage#monitor-manual-backup-jobs-in-the-portal) на странице **Задания резервного копирования**.

### <a name="run-sap-hana-native-client-backup-on-a-database-with-azure-backup-enabled"></a>Запуск резервного копирования SAP HANA из собственного клиента в базе данных с включенной службой Azure Backup

Если вы хотите создать локальную резервную копию (с помощью HANA Studio или Cockpit) базы данных, для которой создается резервная копия с помощью Azure Backup, выполните следующие действия.

1. Дождитесь завершения всех полных резервных копий или резервных копий журналов для базы данных. Проверьте состояние в SAP HANA Studio или Cockpit.
2. Отключите для соответствующей базы данных резервное копирование журналов и задайте в качестве каталога резервного копирования файловую систему.
3. Для этого дважды щелкните **systemdb** > **Конфигурация** > **Выбрать базу данных** > **Фильтр (журнал)** .
4. Установите параметр **enable_auto_log_backup** в значение **No**.
5. Установите параметр **log_backup_using_backint** в значение **False**.
6. Создайте полную резервную копию базы данных по запросу.
7. Дождитесь завершения полного резервного копирования и резервного копирования каталога.
8. Верните предыдущие значения параметров в Azure.
   * Установите параметр **enable_auto_log_backup** в значение **Yes**.
   * Установите параметр **log_backup_using_backint** в значение **True**.

### <a name="change-policy"></a>Изменение политики

Можно изменить базовую политику для элемента резервного копирования SAP HANA.

* На панели мониторинга хранилища перейдите к разделу **Элементы архивации**:

  ![Выбор пункта "Элементы архивации"](./media/sap-hana-db-manage/backup-items.png)

* Выберите **SAP HANA в виртуальной машине Azure**

  ![Выбор пункта "SAP HANA в виртуальной машине Azure"](./media/sap-hana-db-manage/sap-hana-in-azure-vm.png)

* Выберите элемент архивации, базовую политику которого необходимо изменить.
* Щелкните существующую политику архивации.

  ![Выбор существующей политики архивации](./media/sap-hana-db-manage/existing-backup-policy.png)

* Измените политику, выбрав ее из списка. При необходимости [создайте новую политику резервного копирования](https://docs.microsoft.com/azure/backup/backup-azure-sap-hana-database#create-a-backup-policy).

  ![Выбор политики из раскрывающегося списка](./media/sap-hana-db-manage/choose-backup-policy.png)

* Сохраните изменения

  ![Сохранение изменений](./media/sap-hana-db-manage/save-changes.png)

* Изменение политики повлияет на все связанные элементы архивации и вызовет соответствующие задания **настройки защиты**.

>[!NOTE]
> Все изменения периода хранения будут применены не только к новым точкам восстановления, но и ретроспективно ко всем старым точкам восстановления.
>
> Политики добавочного резервного копирования не могут быть использованы для баз данных SAP HANA. В настоящее время добавочная архивация не поддерживается для этих баз данных.

### <a name="modify-policy"></a>Изменение политики

Измените политику, чтобы изменить типы резервных копий, частоту выполнения и период хранения.

>[!NOTE]
>Все изменения периода хранения будут применены не только к новым точкам восстановления, но и ретроспективно ко всем старым точкам восстановления.

1. На панели мониторинга хранилища перейдите в раздел **Управление > Политики архивации** и выберите политику, которую нужно изменить.

   ![Выбор политики для изменения](./media/sap-hana-db-manage/manage-backup-policies.png)

1. Выберите **Изменить**.

   ![Выбор раздела "Изменить"](./media/sap-hana-db-manage/modify-policy.png)

1. Выберите частоту выполнения для типов резервных копий.

   ![Выбор частоты выполнения резервного копирования](./media/sap-hana-db-manage/choose-frequency.png)

Изменение политики повлияет на все связанные элементы архивации и вызовет соответствующие задания **настройки защиты**.

### <a name="inconsistent-policy"></a>Несогласованная политика

Иногда операция изменения политики может привести к **несогласованности** версии политики для некоторых элементов архивации. Это происходит, когда после запуска операции изменения политики соответствующее задание **настройки защиты** для элемента архивации выполняется со сбоем. В представлении элемента архивации он выглядит следующим образом.

![Несогласованная политика](./media/sap-hana-db-manage/inconsistent-policy.png)

Можно исправить версию политики для всех затронутых элементов одним щелчком мыши.

![Исправление версии политики](./media/sap-hana-db-manage/fix-policy-version.png)

### <a name="stop-protection-for-an-sap-hana-database"></a>Остановка защиты для базы данных SAP HANA

Вы можете остановить создание резервных копий базы данных SQL Server несколькими способами:

* можно остановить все будущие задания резервного копирования и удалить все точки восстановления;
* остановить все будущие задания резервного копирования, но сохранить точки восстановления без изменений.

Если вы решили сохранить точки восстановления, учитывайте следующие факторы:

* все точки восстановления навсегда остаются неизменными, любая очистка прекращается одновременно с отключением защиты;
* вы будете оплачивать работу защищенного экземпляра и используемый объем хранилища. Дополнительные сведения см. на странице [Цены на Azure Backup](https://azure.microsoft.com/pricing/details/backup/).
* если вы удалите источник данных без остановки резервного копирования, новые операции резервного копирования будут завершаться сбоем.

Чтобы остановить защиту базы данных, выполните следующие действия.

* На панели мониторинга хранилища выберите **Элементы архивации**.
* В разделе **Тип управления резервным копированием** выберите **SAP HANA в виртуальной машине Azure**.

  ![Выбор пункта "SAP HANA в виртуальной машине Azure"](./media/sap-hana-db-manage/sap-hana-azure-vm.png)

* Выберите базу данных, для которой нужно остановить защиту.

  ![Выбор базы данных для остановки защиты](./media/sap-hana-db-manage/select-database.png)

* В меню базы данных выберите **Остановить архивацию**.

  ![Выбор пункта "Остановить архивацию"](./media/sap-hana-db-manage/stop-backup.png)

* В меню **Остановить архивацию** выберите, следует ли сохранить или удалить данные. При желании можно указать причину или комментарий.

  ![Выбор сохранения или удаления данные](./media/sap-hana-db-manage/retain-backup-data.png)

* Выберите **Остановить архивацию**.

### <a name="resume-protection-for-an-sap-hana-database"></a>Возобновление защиты для базы данных SAP HANA

Если вы отключите защиту для базы данных SAP HANA с **сохранением данных резервной копии**, позднее можно будет возобновить защиту. Если вы не сохраните существующие данные, защиту возобновить не удастся.

Для возобновления защиты для базы данных SAP HANA выполните следующие действия.

* Откройте элемент архивации и выберите **Возобновить резервное копирование**.

   ![Выбор возобновления резервного копирования](./media/sap-hana-db-manage/resume-backup.png)

* В меню **Политика архивации** выберите политику и нажмите кнопку **Сохранить**.

### <a name="upgrading-from-sdc-to-mdc"></a>Обновление с SDC до MDC

Узнайте, как продолжить резервное копирование базы данных SAP HANA [после обновления с SDC до MDC](backup-azure-sap-hana-database-troubleshoot.md#sdc-to-mdc-upgrade-with-a-change-in-sid).

### <a name="upgrading-from-sdc-to-mdc-without-a-sid-change"></a>Обновление с SDC на MDC без изменения SID

Узнайте, как продолжить резервное копирование базы данных SAP HANA, у которой [не изменился SID после обновления с SDC до MDC](backup-azure-sap-hana-database-troubleshoot.md#sdc-to-mdc-upgrade-with-no-change-in-sid).

### <a name="unregister-an-sap-hana-instance"></a>Отмена регистрации экземпляра SAP HANA

Отменяйте регистрацию экземпляра SAP HANA после отключения защиты, но перед удалением хранилища.

* На панели мониторинга хранилища в разделе **Управление** выберите **Инфраструктура резервного копирования**.

   ![Выбор "Инфраструктура резервного копирования"](./media/sap-hana-db-manage/backup-infrastructure.png)

* Выберите в качестве **Типа управления резервным копированием** значение **Рабочая нагрузка на виртуальной машине Azure**.

   ![Выбор в качестве типа управления резервным копированием значение "Рабочая нагрузка на виртуальной машине Azure"](./media/sap-hana-db-manage/backup-management-type.png)

* В разделе **Защищенные серверы** выберите экземпляр, для которого необходимо отменить регистрацию. Чтобы удалить хранилище, необходимо отменить регистрацию всех серверов и экземпляров.

* Щелкните правой кнопкой мыши защищенный экземпляр и выберите **Отменить регистрацию**.

   ![Выбор отмены регистрации](./media/sap-hana-db-manage/unregister.png)

### <a name="re-register-extension-on-the-sap-hana-server-vm"></a>Повторная регистрация расширения на виртуальной машине сервера SAP HANA

Иногда на работоспособность расширения рабочей нагрузки на виртуальной машине могут повлиять те или иные причины. В таких случаях все операции, запущенные на этой виртуальной машине, начнут давать сбой. Может потребоваться повторная регистрация расширения на виртуальной машине. Операция повторной регистрации переустанавливает на виртуальной машине расширение резервного копирования рабочей нагрузки для продолжения работы.

Используйте эту процедуру с осторожностью: при активации на виртуальной машине с нормально работающим расширением эта операция приведет к перезапуску расширения. Это может привести к сбою всех выполняемых заданий. Перед активацией операции повторной регистрации проверьте наличие одного или нескольких [симптомов](backup-azure-sap-hana-database-troubleshoot.md#re-registration-failures).

## <a name="next-steps"></a>Дальнейшие действия

* Узнайте, как [устранять распространенные проблемы при резервном копировании баз данных SAP HANA](https://docs.microsoft.com/azure/backup/backup-azure-sap-hana-database-troubleshoot).
