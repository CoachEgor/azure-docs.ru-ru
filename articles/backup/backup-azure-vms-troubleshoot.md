---
title: Ошибки резервного копирования с Помощью Пазур VMs
description: В этой статье узнайте, как устранить ошибки, возникающие при резервном копировании и восстановлении виртуальных машин Azure.
ms.reviewer: srinathv
ms.topic: troubleshooting
ms.date: 08/30/2019
ms.openlocfilehash: 15e4b4c8850798fd2386cd2874b6ab58a18d5406
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79297396"
---
# <a name="troubleshooting-backup-failures-on-azure-virtual-machines"></a>Сбои резервного копирования на виртуальных машинах Azure

Ошибки устранения неполадок, возникающие при использовании резервного копирования Azure, с информацией, указанной ниже:

## <a name="backup"></a>Резервное копирование

Этот раздел охватывает сбой работы резервного копирования виртуальной машины Azure.

### <a name="basic-troubleshooting"></a>Базовое устранение неполадок

* Убедитесь, что VM Agent (WA Agent) является [последней версией.](https://docs.microsoft.com/azure/backup/backup-azure-arm-vms-prepare#install-the-vm-agent)
* Убедитесь, что версия Windows или Linux VM OS поддерживается, обратитесь к [матрице резервной поддержки IaaS VM.](https://docs.microsoft.com/azure/backup/backup-support-matrix-iaas)
* Убедитесь, что другой службы резервного копирования не работает.
  * Чтобы убедиться, что нет проблем с расширением моментального снимка, [удалите расширения, чтобы заставить перезагрузиться, а затем повторить резервную попытку.](https://docs.microsoft.com/azure/backup/backup-azure-troubleshoot-vm-backup-fails-snapshot-timeout)
* Убедитесь, что VM имеет подключение к Интернету.
  * Убедитесь, что другой службы резервного копирования не работает.
* От, `Services.msc`обеспечить **службу агента для гостей Windows Azure** **работает.** Если служба **гостевого агента Windows Azure** отсутствует, установите ее из [резервных вывизов Azure в хранилище служб восстановления.](https://docs.microsoft.com/azure/backup/backup-azure-arm-vms-prepare#install-the-vm-agent)
* **В журнале событий** могут отображаться сбои резервного копирования, которые относятся к другим продуктам резервного копирования, например, резервному копированию Windows Server, и не связаны с резервным копированием Azure. Используйте следующие шаги, чтобы определить, связана ли проблема с резервным копированием Azure:
  * При возникновении ошибки с **резервным копированием** записи в источнике или сообщении события проверьте, были ли успешными резервные копии Azure IaaS VM И.
  * Если резервное копирование Azure работает, то проблема, скорее всего, с другим решением резервного копирования.
  * Вот пример ошибки просмотра событий 517, когда резервное копирование Azure работало нормально, но "Резервное копирование Windows Server" не удается:<br>
    ![Сбой резервного копирования Windows Server](media/backup-azure-vms-troubleshoot/windows-server-backup-failing.png)
  * Если резервное копирование Azure не работает, ищите соответствующий Код ошибки в разделе Общие ошибки резервного копирования VM в этой статье.

## <a name="common-issues"></a>Распространенные проблемы

Ниже приведены общие проблемы с сбоями резервного копирования на виртуальных машинах Azure.

## <a name="copyingvhdsfrombackupvaulttakinglongtime---copying-backed-up-data-from-vault-timed-out"></a>КопированиеVHDsFromBackUpUpVaultTakingLongTime - Копирование резервных данных из хранилища приурочен

Код ошибки: КопированиеVHDsFromBackUpVaultTakingTakingLongTime <br/>
Сообщение об ошибке: Копирование резервных данных из хранилища приурочено

Это может произойти из-за временных ошибок хранения или недостаточного объема ioPS учетной записи хранилища для резервного копирования для передачи данных в хранилище в течение периода тайм-аута. Настройте резервное копирование виртуальных машин, используя эти [рекомендации](backup-azure-vms-introduction.md#best-practices), и повторите операцию резервного копирования.

## <a name="usererrorvmnotindesirablestate---vm-is-not-in-a-state-that-allows-backups"></a>UserErrorMMNotDesirableState - VM не находится в состоянии, которое позволяет резервное копирование

Код ошибки: UserErrorVmNotInDesirableState <br/>
Сообщение об ошибке: VM не находится в состоянии, позволяющем резервное копирование.<br/>

Операция резервного копирования не удалась, так как VM находится в недействительном состоянии. Для успешной операции резервного копирования виртуальная машина должна быть в состоянии "Выполняется", "Остановлено" или "Остановлено (освобождено)".

* Если виртуальная машина находится в состоянии перехода из **рабочего** в состояние **завершения работы**, дождитесь изменения состояния. Затем запустите задание резервного копирования.
* Если это виртуальная машина Linux, которая использует модуль ядра Security Enhanced Linux, то необходимо исключить путь агента Linux для Azure **/var/lib/waagent** из политики безопасности, чтобы обеспечить установку расширения резервного копирования.

## <a name="usererrorfsfreezefailed---failed-to-freeze-one-or-more-mount-points-of-the-vm-to-take-a-file-system-consistent-snapshot"></a>UserErrorFsFreezeFailed - Не удалось заморозить один или несколько точек крепления VM, чтобы сделать последовательный снимок файловой системы

Код ошибки: UserErrorFsFreezeFailed <br/>
Сообщение об ошибке: Не удалось заморозить одну или несколько точек установки VM, чтобы сделать последовательный снимок файловой системы.

* Открепите устройства, для которых состояние файловой системы не было очищено, используя команду **umount.**
* Выполнить проверку согласованности файловой системы на этих устройствах с помощью команды **fsck.**
* Установите устройства снова и повторите операцию резервного копирования.</ol>

## <a name="extensionsnapshotfailedcom--extensioninstallationfailedcom--extensioninstallationfailedmdtc---extension-installationoperation-failed-due-to-a-com-error"></a>ExtensionSnapshotFailedCOM / ExtensionInstallationFailedCOM / ExtensionInstallationFailedMDTC - Установка/эксплуатация расширения не удалась из-за ошибки КОМЗ

Код ошибки: ExtensionSnapshotFailedCOM <br/>
Сообщение об ошибке: Операция «Моментальный снимок» сработала из-за ошибки КОМЗ

Код ошибки: ExtensionInstallationFailedCOM  <br/>
Сообщение об ошибке: Установка/операция расширения не удалась из-за ошибки КОМЗ

Код ошибки: ExtensionInstallationFailedMDTC <br/>
Сообщение об ошибке: Установка расширения не сработала из-за ошибки "КОМ" не смогла поговорить с координатором распределенных транзакций Майкрософт <br/>

Операция резервного копирования сработала из-за проблемы с приложением системы службы Windows **COM.**  Проблему можно устранить следующим способом.

* Попробуйте запустить/перезапустить сервис Windows **COM» System Application (с** повышенной командной подсказкой **- чистый старт COMSysApp).**
* Убедитесь, что служба **координатора распределенных транзакций** работает как учетная запись **сетевой службы.** В противом случае измените его для выполнения учетной записи **сетевого сервиса** и перезапустите **приложение системы КОМЗ.**
* Если не удалось перезапустить службу, переустановите службу **Координатор распределенных транзакций,** выдыхая ниже следующие действия:
  * Остановите работу службы MSDTC.
  * Откройте окно командной строки (cmd).
  * Выполнить команду "msdtc-удалить"
  * Выполнить команду "msdtc-установка"
  * Запустите службу MSDTC.
* Запустите службу Windows **Системное приложение COM+**. После запуска службы **Системное приложение COM+** активируйте задание резервного копирования на портале Azure.</ol>

## <a name="extensionfailedvsswriterinbadstate---snapshot-operation-failed-because-vss-writers-were-in-a-bad-state"></a>ExtensionFailedVssWriterInBadState - Операция snapshot failed потому что сочинители VSS находились в плохом положении

Код ошибки: ExtensionFailedVssWriterInBadState <br/>
Сообщение об ошибке: Операция «Моментальный снимок» не сработала, поскольку писатели VSS находились в плохом состоянии.

Перезапустите модули записи VSS, которые находятся в неисправном состоянии. В командной строке с повышенными привилегиями выполните команду ```vssadmin list writers```. В выходных данных содержатся все модули записи VSS и их состояние. Перезапустите каждый модуль записи VSS, состояние которого отличается от **[1] Стабильный**, выполнив следующие команды из командной строки с повышенными привилегиями.

* ```net stop serviceName```
* ```net start serviceName```

## <a name="extensionconfigparsingfailure--failure-in-parsing-the-config-for-the-backup-extension"></a>ExtensionConfigParsingFailure - Отказ в разборе конфигурации для расширения резервного копирования

Код ошибки: ExtensionConfigParsingFailure<br/>
Сообщение об ошибке: Сбой в разборе конфигурации для расширения резервного копирования.

Эта ошибка возникает из-за изменения разрешений в каталоге **MachineKeys**: **%systemdrive%\programdata\microsoft\crypto\rsa\machinekeys**.
Выполнить следующую команду и проверить, что разрешения в каталоге **MachineKeys** являются по умолчанию:**icacls %systemdrive%**

Разрешения по умолчанию:

* Все: (R,W)
* Администраторы ВИДЕН-Администраторы: (F)

Если для каталога **MachineKeys** назначены другие разрешения, выполните следующие действия, чтобы изменить разрешения, удалить сертификат и активировать архивацию.

1. Исправьте разрешения для каталога **MachineKeys**. С помощью свойств безопасности обозревателя и дополнительных параметров безопасности в каталоге сбросьте разрешения к значениям по умолчанию. Удалите дополнительные пользовательские объекты, отличные от объектов по умолчанию, из каталога и убедитесь, что у **всех** есть доступ к таким операциям:

   * – вывод списка папок, чтение данных;
   * – чтение атрибутов;
   * – чтение дополнительных атрибутов;
   * – создание файлов, запись данных;
   * – создание папок, добавление данных;
   * – запись атрибутов;
   * – запись дополнительных атрибутов;
   * – разрешения на чтение.
2. Удалите все сертификаты, в которых **выдается** классическая модель развертывания или **генератор сертификатов Windows Azure CRP:**

   * [Практическое руководство. Просмотр сертификатов с помощью оснастки консоли MMC](https://docs.microsoft.com/dotnet/framework/wcf/feature-details/how-to-view-certificates-with-the-mmc-snap-in).
   * Под **персональными** > **сертификатами**удалите все сертификаты, в которых **выдается** классическая модель развертывания или генератор **сертификатов Windows Azure CRP.**
3. Активируйте задание архивации виртуальной машины.

## <a name="extensionstuckindeletionstate---extension-state-is-not-supportive-to-backup-operation"></a>ExtensionStuckInDeletionStateState - Состояние расширения не поддерживает операцию резервного копирования

Код ошибки: ExtensionStuckInDeletionStateState <br/>
Сообщение об ошибке: Состояние расширения не поддерживает операцию резервного копирования

Операция резервного копирования не сработала из-за несогласованного состояния расширения резервного копирования. Проблему можно устранить следующим способом.

* Убедитесь, что гостевой агент установлен и отвечает на запросы.
* С портала Azure перейдите на расширения **виртуальных** > **машин для всех настроек** > **Extensions**
* Выберите расширение резервного копирования VmSnapshot или VmSnapshotLinux и щелкните **Удалить**.
* После удаляния расширения резервного копирования повторная попытка операции резервного копирования
* При выполнении последующей операции резервного копирования будет установлено новое расширение в требуемом состоянии.

## <a name="extensionfailedsnapshotlimitreachederror---snapshot-operation-failed-as-snapshot-limit-is-exceeded-for-some-of-the-disks-attached"></a>ExtensionFailedSnapshotLimitReachedError - Операция моментального снимка не удалось, как снимок предел превышен для некоторых дисков прилагается

Код ошибки: РасширениеFailedSnapshotLimitReachedError <br/>
Сообщение об ошибке: Операция моментального снимка не удалась, так как предел моментального снимка превышен для некоторых прикрепленных дисков

Операция моментального снимка не удалась, так как предел снимка превышен для некоторых прикрепленных дисков. Выполните ниже шаги устранения неполадок, а затем повторить операцию.

* Удалите диск капли-снимки, которые не требуются. Будьте осторожны, чтобы не удалять диск капли, только снимок капли должны быть удалены.
* Если Soft-delete включен на VM-диске Хранения-счета, настроить мягкого удаления хранения так, что существующие снимки меньше, чем максимально допустимые в любой момент времени.
* Если восстановление сайта Azure включено в резервном vM, выполните ниже приведенные ниже действия:

  * Убедитесь, что значение **isanysnapshotfailed** устанавливается как ложное в /etc/azure/vmbackup.conf
  * Расписание восстановления сайта Azure в другое время, чтобы это не противоречили работе резервного копирования.

## <a name="extensionfailedtimeoutvmnetworkunresponsive---snapshot-operation-failed-due-to-inadequate-vm-resources"></a>ExtensionFailedTimeoutVMNetworkUnresponsive - Операция моментального снимка не сработала из-за недостаточного ресурса VM

Код ошибки: РасширениеFailedTimeoutVMNetworkНеответ<br/>
Сообщение об ошибке: операция snapshot сработала из-за недостаточного объема ресурсов VM.

Операция резервного копирования на VM сработала из-за задержки сетевых вызовов при выполнении операции моментального снимка. Чтобы устранить эту проблему, выполните шаг 1. Если проблема повторится, попробуйте выполнить шаги 2 и 3.

**Шаг 1**: Создание снимка через хост

В командной строке с повышенными правами (администратора) выполните следующую команду:

```text
REG ADD "HKLM\SOFTWARE\Microsoft\BcdrAgentPersistentKeys" /v SnapshotMethod /t REG_SZ /d firstHostThenGuest /f
REG ADD "HKLM\SOFTWARE\Microsoft\BcdrAgentPersistentKeys" /v CalculateSnapshotTimeFromHost /t REG_SZ /d True /f
```

Это позволит обеспечить создание моментальных снимков через ОС узла, а не гостевую ОС. Повторите резервное копирование.

**Шаг 2**: Попробуйте изменить график резервного копирования на время, когда VM находится под меньшей нагрузкой (меньше процессора / IOps и т.д.)

**Шаг 3**: Попробуйте [увеличить размер VM](https://azure.microsoft.com/blog/resize-virtual-machines/) и повторить операцию

## <a name="common-vm-backup-errors"></a>Распространенные ошибки резервного копирования виртуальных машин

| Сведения об ошибке | Обходной путь |
| ------ | --- |
| **Код ошибки**: 320001, ResourceNotFound <br/> **Сообщение об ошибке**: Не удалось выполнить операцию, поскольку VM больше не существует. <br/> <br/> **Код ошибки**: 400094, BCMV2VMNotFound <br/> **Сообщение об ошибке**: Виртуальная машина не существует <br/> <br/>  Виртуальная машина Azure не найдена.  |Эта ошибка возникает, когда основная виртуальная машина удалена, но политика резервного копирования продолжает ее поиск, чтобы выполнить резервное копирование. Чтобы исправить эту ошибку, выполните следующие действия. <ol><li> Повторное создание виртуальной машины с тем же именем и тем же названием группы ресурсов, **названием облачной службы,**<br>**Или**</li><li> Отключите защиту виртуальной машины, удаляя или не удаляя данные резервного копирования. Дополнительные сведения см. в разделе [Отключение защиты виртуальных машин](backup-azure-manage-vms.md#stop-protecting-a-vm).</li></ol>|
|**Код ошибки**: UserErrorBCMPremiumStorageОшибкаОшибкаОшибка<br/> **Сообщение об ошибке**: Не удалось скопировать снимок виртуальной машины из-за недостаточного свободного места в учетной записи хранилища | Для резервного копирования виртуальных машин уровня "Премиум" в стеке резервных копий виртуальных машин версии 1 мы копируем моментальный снимок в учетную запись хранения. Это гарантирует, что трафик управления резервным копированием, который возникает при работе с моментальным снимком, не ограничивает число операций ввода-вывода, доступных для приложения, использующего диски уровня "Премиум". <br><br>Корпорация Майкрософт рекомендует выделять только 50 %, 17,5 ТБ, от общего объема хранилища учетной записи хранения. Затем служба Azure Backup может скопировать моментальный снимок в учетную запись хранения и перенести данные из этого скопированного расположения в учетной записи хранения в хранилище. |
| **Код ошибки**: 380008, AzureVmOffline <br/> **Сообщение об ошибке**: Не удалось установить расширение служб восстановления Майкрософт, так как виртуальная машина не работает | Необходимым условием для расширения служб восстановления Azure является наличие агента виртуальной машины. Установите агент виртуальной машины Azure и перезапустите операцию регистрации. <br> <ol> <li>Убедитесь, что агент виртуальной машины установлен правильно. <li>Убедитесь, что флажок в конфигурации виртуальной машины установлен на правильное значение.</ol> Ознакомьтесь со сведениями об установке агента виртуальной машины и проверке правильности ее выполнения. |
| **Код ошибки**: РасширениеСнимокОшибкаОшибка <br/> **Сообщение об ошибке**: Операция моментального снимка не сработала с ошибкой операции Volume Shadow Copy Service (VSS) **Этот диск заблокирован шифрованием Drive BitLocker. Вы должны разблокировать этот диск от панели управления.** |Отключите BitLocker для всех дисков на виртуальной машине и проверьте, устранена ли проблема с VSS. |
| **Код ошибки**: VmNotInDesirableState <br/> **Сообщение об ошибке**: VM не в состоянии, которое позволяет резервное копирование. |<ul><li>Если виртуальная машина находится в состоянии перехода из **рабочего** в состояние **завершения работы**, дождитесь изменения состояния. Затем запустите задание резервного копирования. <li> Если это виртуальная машина Linux, которая использует модуль ядра Security Enhanced Linux, то необходимо исключить путь агента Linux для Azure **/var/lib/waagent** из политики безопасности, чтобы обеспечить установку расширения резервного копирования.  |
| На виртуальной машине отсутствует агент виртуальной машины. <br>Установите необходимые компоненты и агент виртуальной машины. Затем перезапустите операцию. |Дополнительные сведения об [установке агента виртуальной машины и проверке установки агента виртуальной машины](#vm-agent). |
| **Код ошибки**: РасширениеСнимокНеБезопасностьСеть <br/> **Сообщение об ошибке**: Операция моментального снимка не сработала из-за сбоя в создании безопасного сетевого канала связи. | <ol><li> Откройте редактор реестра, запустив файл **regedit.exe** в режиме с повышенными правами. <li> Определите все версии платформы .NET Framework, установленные в системе. Они находятся в иерархии раздела реестра **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft**. <li> Для каждой платформы .NET Framework в этом разделе реестра добавьте следующий раздел: <br> **SchUseStrongCrypto" 'dword:000000001**. </ol>|
| **Код ошибки**: РасширениеVCRedistInstallationFailure <br/> **Сообщение об ошибке**: Операция моментального снимка не удалась из-за неспособности установить Visual C' Redistributable для Visual Studio 2012. | Перейдите на C: «Пакеты»Плагины»-Microsoft.Azure.RecoveryServices.VMSnapshot-agentVersion и установите vcredist2013_x64.<br/>Убедитесь, что значение ключа реестра, позволяющее установку службы, настроено на правильное значение. То есть, установить значение **пуска** в **HKEY_LOCAL_MACHINE »SYSTEM»CurrentControlSet»Services-Msiserver** до **3,** а не **4**. <br><br>Если проблемы с установкой не исчезли, перезапустите службу установки, последовательно выполнив команды **MSIEXEC /UNREGISTER** и **MSIEXEC /REGISTER** в командной строке с повышенными привилегиями.  |
| **Код ошибки**: UserErrorЗапросDisallowedByPolicy <BR> **Сообщение об ошибке**: Недействительная политика настроена на VM, который предотвращает работу snapshot. | Если у вас есть политика Azure, [которая регулирует теги в вашей среде,](https://docs.microsoft.com/azure/governance/policy/tutorials/govern-tags)либо рассмотрите возможность изменения политики от [эффекта Отрица](https://docs.microsoft.com/azure/governance/policy/concepts/effects#deny) на эффект [модификации,](https://docs.microsoft.com/azure/governance/policy/concepts/effects#modify)либо создайте группу ресурсов вручную в соответствии со [схемой именования, требуемой резервным копированием Azure.](https://docs.microsoft.com/azure/backup/backup-during-vm-creation#azure-backup-resource-group-for-virtual-machines)
## <a name="jobs"></a>Задания

| Сведения об ошибке | Обходной путь |
| --- | --- |
| Отмена не поддерживается в этом типе задания. <br>Дождитесь завершения задания. |None |
| Задание не находится в состоянии отмены. <br>Дождитесь завершения задания. <br>**Или**<br> Выбранное задание не находится в состоянии отмены. <br>Дождитесь остановки задания. |Скорее всего, задание почти выполнено. Дождитесь завершения задания.|
| Резервное копирование не может отменить задание, так как оно не выполняется. <br>Отмена поддерживается только для выполняющихся заданий. Попытайтесь отменить выполняющееся задание. |Эта ошибка возникает из-за переходного состояния. Подождите минуту и повторите отмену. |
| При резервном копировании не удалось отменить задание. <br>Дождитесь завершения задания. |None |

## <a name="restore"></a>Восстановить

| Сведения об ошибке | Обходной путь |
| --- | --- |
| Сбой восстановления из-за внутренней ошибки облака. |<ol><li>В облачной службе, в которую вы пытаетесь выполнить восстановление, настроены параметры DNS. Проверьте параметр <br>**$deployment - Get-AzureDeployment -ServiceName "ServiceName" -Слот "Производство" Get-AzureDns -DnsSettings $deployment. DnsSettings**.<br>Если настроен **адрес**, это означает, что настроены и параметры DNS.<br> <li>В облачной службе, в которую вы пытаетесь выполнить восстановление, настроен параметр **ReservedIP**, а существующие в ней виртуальные машины находятся в остановленном состоянии. Вы можете проверить, что облачная служба зарезервировала IP-адрес, используя следующие командлеты PowerShell: **$deploy = Get-AzureDeployment -ServiceName "servicename" -Slot "Production" $dep.ReservedIPName**. <br><li>Вы пытаетесь восстановить виртуальную машину в ту же облачную службу со следующими специальными конфигурациями сети: <ul><li>– виртуальные машины во внутренней и внешней конфигурации балансировщика нагрузки;<li>– виртуальные машины с несколькими зарезервированными IP-адресами; <li>– виртуальные машины с несколькими сетевыми адаптерами. </ul><li>Выберите новую облачную службу в пользовательском интерфейсе или просмотрите [рекомендации по восстановлению](backup-azure-arm-restore-vms.md#restore-vms-with-special-configurations) для виртуальных машин со специальными конфигурациями сети.</ol> |
| Выбранное DNS-имя уже занято. <br>Укажите другое DNS-имя и повторите попытку. |Указанное здесь DNS-имя ссылается на имя облачной службы обычно с расширением **.cloudapp.net**. Это имя должно быть уникальным. Если возникает эта ошибка, во время восстановления необходимо выбрать другое имя виртуальной машины. <br><br>  Эта ошибка отображается только для пользователей портала Azure. Восстановление с помощью PowerShell выполняется успешно, так как восстанавливаются только диски, а виртуальная машина не создается. Ошибка возникнет, если вы явно создадите виртуальную машину после восстановления дисков. |
| Указана неправильная конфигурация виртуальной сети. <br>Укажите другую конфигурацию виртуальной сети и повторите попытку. |None |
| Указанная облачная служба использует зарезервированный IP-адрес, который не соответствует конфигурации восстанавливаемой виртуальной машины. <br>Укажите другую облачную службу, которая не использует зарезервированный IP-адрес. Или выберите другую точку восстановления. |None |
| Облачная служба достигла ограничения на количество входных конечных точек. <br>Повторите операцию, указав другую облачную службу или используя существующую конечную точку. |None |
| Хранилище Служб восстановления и целевая учетная запись хранения находятся в двух разных регионах. <br>Убедитесь, что указанная в операции восстановления учетная запись хранения находится в том же регионе Azure, что и хранилище Служб восстановления. |None |
| Учетная запись хранения, указанная для операции восстановления, не поддерживается. <br>Поддерживаются только базовые или стандартные учетные записи хранения с локально избыточными или геоизбыточными параметрами репликации. Выберите поддерживаемую учетную запись хранения. |None |
| Тип учетной записи хранения, указанной для операции восстановления, не подключен к сети. <br>Убедитесь, что учетная записи хранения, указанная в операции восстановления, подключена к сети. |Эта ошибка может возникать из-за временной ошибки в службе хранилища Azure или из-за сбоя. Выберите другую учетную запись хранения. |
| Достигнут предел квоты группы ресурсов. <br>Удалите некоторые группы ресурсов с портала Azure или обратитесь в службу поддержки Azure, чтобы увеличить границы. |None |
| Выбранная подсеть не существует. <br>Выберите подсеть для проверки. |None |
| У службы Backup нет разрешения на доступ к ресурсам в вашей подписке. |Чтобы устранить эту ошибку, сначала восстановите диски, выполнив шаги, описанные в разделе [Восстановление резервных копий дисков](backup-azure-arm-restore-vms.md#restore-disks). Затем выполните команды PowerShell, описанные в разделе [Создание виртуальной машины с восстановленного диска](backup-azure-vms-automation.md#restore-an-azure-vm). |

## <a name="backup-or-restore-takes-time"></a>Резервное копирование или восстановление занимает время

Если резервное копирование занимает более 12 часов или восстановление занимает более 6 часов, просмотрите [рекомендации](backup-azure-vms-introduction.md#best-practices)и [соображения производительности](backup-azure-vms-introduction.md#backup-performance)

## <a name="vm-agent"></a>Агент виртуальной машины

### <a name="set-up-the-vm-agent"></a>Настройка агента виртуальной машины

Как правило, агент виртуальной машины уже имеется на виртуальных машинах, которые созданы с помощью коллекции Azure. Но на виртуальных машинах, которые переносятся из локальных центров обработки данных, агента виртуальной машины не будет. Для таких виртуальных машин агент ВМ необходимо установить явным образом.

#### <a name="windows-vms"></a>Виртуальные машины Windows

* Скачайте и установите [MSI-файл агента](https://go.microsoft.com/fwlink/?LinkID=394789&clcid=0x409). Чтобы выполнить установку, необходимо иметь права администратора.
* Для виртуальных машин, созданных с использованием классической модели развертывания, [обновите свойство классических виртуальных машин](https://blogs.msdn.com/b/mast/archive/2014/04/08/install-the-vm-agent-on-an-existing-azure-vm.aspx), чтобы указать, что агент установлен. Этот шаг является необязательным для виртуальных машин Azure Resource Manager.

#### <a name="linux-vms"></a>Виртуальные машины Linux

* Установите последнюю версию агента из репозитория дистрибутива. Подробную информацию о названии пакета можно узнать в [репозитории Linux Agent.](https://github.com/Azure/WALinuxAgent)
* Для виртуальных машин, созданных с использованием классической модели развертывания, [используйте этот блог](https://blogs.msdn.com/b/mast/archive/2014/04/08/install-the-vm-agent-on-an-existing-azure-vm.aspx), чтобы обновить свойство виртуальных машин и указать, что агент установлен. Этот шаг не является обязательным для виртуальных машин Resource Manager.

### <a name="update-the-vm-agent"></a>Обновление агента виртуальной машины

#### <a name="windows-vms"></a>Виртуальные машины Windows

* Чтобы обновить агент виртуальной машины, переустановите [его двоичные файлы](https://go.microsoft.com/fwlink/?LinkID=394789&clcid=0x409). Прежде чем обновлять агент, убедитесь, что не выполняются никакие операции резервного копирования.

#### <a name="linux-vms"></a>Виртуальные машины Linux

* Чтобы обновить Linux VM Agent, следуйте инструкциям в статье [Обновление Linux VM Agent](../virtual-machines/linux/update-agent.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).

    > [!NOTE]
    > Рекомендуется обновлять агент только через репозиторий дистрибутива.

    Не рекомендуется скачивать код агента с портала GitHub. Если последняя версия агента не доступна для дистрибутива, обратитесь в службу поддержки дистрибутива, чтобы получить инструкции по получению последней версии агента. Последние сведения об [агенте Windows Azure Linux](https://github.com/Azure/WALinuxAgent/releases) см. в репозитории GitHub.

### <a name="validate-vm-agent-installation"></a>Проверка установки агента виртуальной машины

Для проверки версии агента виртуальной машины на виртуальных машинах Windows выполните следующие действия.

1. Войдите в систему виртуальной машины Azure и перейдите в папку **C:\WindowsAzure\Packages**. В ней должен находиться файл **WaAppAgent.exe**.
2. Щелкните правой кнопкой мыши файл и выберите **Свойства**. Затем выберите вкладку **«Подробности».** Поле **Product Version** должно быть 2.6.1198.718 или выше.

## <a name="troubleshoot-vm-snapshot-issues"></a>Решение проблем со снимками виртуальных машин

Архивация виртуальных машин зависит от команды моментального снимка в базовом хранилище. Отсутствие доступа к хранилищу или задержка в выполнении задачи создания моментального снимка может привести к неудачному завершению задания резервного копирования. Сбой задачи создания снимка может быть вызван следующими условиями.

* **VMs с настройкой резервного копирования сервера S'L Server может привести к задержке задач моментального снимка.** По умолчанию при архивации виртуальной машины создается полная резервная копия VSS на виртуальных машинах Windows. На виртуальных машинах, где выполняется SQL Server и настроена архивация SQL Server, это может привести к задержке создания моментального снимка. Если эти задержки приводят к ошибкам резервного копирования, установите следующий ключ реестра.

   ```text
   [HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\BCDRAGENT]
   "USEVSSCOPYBACKUP"="TRUE"
   ```

* **Состояние виртуальной машины отображается неправильно из-за того, что работа виртуальной машины была завершена в сеансе удаленного рабочего стола**. При использовании удаленного рабочего стола для завершении работы виртуальной машины проверьте, правильно ли отображается на портале состояние виртуальной машины. Если это не так, завершите работу виртуальной машины на портале с помощью команды **Завершение работы** на панели мониторинга виртуальной машины.
* **Если более четырех вМ имеют один и тот же облачный сервис, распределите виз по нескольким политикам резервного копирования.** Задайте время резервного копирования таким образом, чтобы оно выполнялось не более, чем на четырех виртуальных машинах одновременно. Задайте время начала архивации в разных политиках так, чтобы между ними был один час разницы.
* **Виртуальная машина использует большие ресурсы процессора или памяти**. Если виртуальная машина работает при большой загрузке памяти или процессора (более 90 %), задача создания моментального снимка помещается в очередь, задерживается. В конце концов это время. Если эта проблема возникает, попробуйте резервную по требованию резервную.

## <a name="networking"></a>Сети

Для работы резервного копирования службы архивации на виртуальной машине IaaS DHCP должна быть включена для учетной записи гостя. Если вам нужен статический частный IP-адрес, настройте его с помощью портала Azure или PowerShell. Убедитесь, что параметр DHCP для виртуальной машины включен.
Дополнительные сведения о том, как настроить статический IP-адрес с помощью PowerShell см. раздели:

* [Добавление статического внутреннего IP-адреса для существующей виртуальной машины](https://docs.microsoft.com/powershell/module/az.network/set-aznetworkinterfaceipconfig?view=azps-3.5.0#description)
* [Изменение метода распределения для частного IP-адреса, назначенного сетевому интерфейсу](../virtual-network/virtual-networks-static-private-ip-arm-ps.md#change-the-allocation-method-for-a-private-ip-address-assigned-to-a-network-interface)

