---
title: Резервное копирование базы данных SAP HANA в Azure с помощью Azure Backup | Документация Майкрософт
description: В этом учебнике объясняется, как выполнить резервное копирование базы данных SAP HANA в Azure с помощью службы Azure Backup.
author: rayne-wiselman
manager: carmonm
ms.service: backup
ms.topic: conceptual
ms.date: 05/06/2019
ms.author: raynew
ms.openlocfilehash: 6ac686484ddafc47410cddebea3f789332f9286a
ms.sourcegitcommit: c72ddb56b5657b2adeb3c4608c3d4c56e3421f2c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/24/2019
ms.locfileid: "68465457"
---
# <a name="back-up-an-sap-hana-database"></a>Резервное копирование базы данных SAP HANA

[Azure Backup](backup-overview.md) поддерживает резервное копирование баз данных SAP HANA в Azure.

> [!NOTE]
> Эта функция сейчас доступна в виде общедоступной предварительной версии. Сейчас он не готов к работе и не имеет гарантированного соглашения об уровне обслуживания. 

## <a name="scenario-support"></a>Поддержка сценария

**Поддержка** | **Сведения**
--- | ---
**Поддерживаемые географические регионы** | Юго-Восточная Австралия, Восточная Австралия <br> Южная Бразилия <br> Центральная Канада, Восточная Канада <br> Южный Восточная Азия, Восточная Азия <br> Восточная часть США, Восточная часть США 2, Юго-Центральный регион (Запад США), Запад US 2, Северо-центральный регион США, Центральная часть US, Центрально-Центральный регион США<br> Центральная Индия, Южная Индия <br> Восточная Япония, Западная Япония<br> Центральная Корея, Южная Корея <br> Северная Европа, Западная Европа <br> Южная часть Соединенного Королевства, западная часть Соединенного Королевства
**Поддерживаемые операционные системы виртуальных машин** | SLES 12 с пакетом обновления 2 (SP2) или SP3.
**Поддерживаемые версии HANA** | SDC для HANA 1. x, MDC в HANA 2. x < = SPS03

### <a name="current-limitations"></a>Текущие ограничения

- Вы можете выполнять резервное копирование только SAP HANA баз данных, работающих на виртуальных машинах Azure.
- SAP HANA резервную копию можно настроить только в портал Azure. Эта функция не может быть настроена с помощью PowerShell, CLI или REST API.
- Резервное копирование баз данных можно выполнять только в режиме масштабирования.
- Журналы базы данных можно архивировать каждые 15 минут. Резервные копии журналов начинают работать только после успешного полного резервного копирования базы данных.
- Можно создавать полные и разностные резервные копии. Добавочная архивация сейчас не поддерживается.
- Политику резервного копирования нельзя изменить после ее применения для резервного копирования SAP HANA. Если вы хотите создать резервную копию с другими параметрами, создайте новую политику или назначьте другую политику.
  - Чтобы создать политику, в хранилище щелкните **политики** > **Архивация политики** >  **+ Добавить** > **SAP HANA на виртуальной машине Azure**и укажите параметры политики.
  - Чтобы назначить другую политику, в свойствах виртуальной машины, на которой выполняется база данных, щелкните имя текущей политики. Затем на странице **политика резервного копирования** можно выбрать другую политику, которая будет использоваться для резервного копирования.

## <a name="prerequisites"></a>предварительные требования

Перед настройкой резервных копий убедитесь, что вы выполняете следующие действия:

1. На виртуальной машине, где запущена база данных SAP HANA, установите официальный пакет [среды выполнения Microsoft .NET Core 2,1](https://dotnet.microsoft.com/download/linux-package-manager/sles/runtime-current) . Обратите внимание на следующее.
    - Требуется только пакет **DotNet-Runtime-2,1** . **Aspnetcore-Runtime-2,1**не требуется.
    - Если виртуальная машина не имеет доступа к Интернету, то зеркальное отображение или предоставление автономного кэша для DotNet-Runtime-2,1 (и всех зависимых RPMs) из канала пакета Майкрософт, указанного на странице.
    - Во время установки пакета может быть предложено указать параметр. Если это так, укажите **решение 2**.

        ![Параметр установки пакета](./media/backup-azure-sap-hana-database/hana-package.png)

2. На виртуальной машине установите и включите пакеты драйверов ODBC из официального пакета или носителя SLES с помощью zypper, как показано ниже.

    ```unix
    sudo zypper update
    sudo zypper install unixODBC
    ```

3. Разрешите подключение с виртуальной машины к Интернету, чтобы она могла получить доступ к Azure, как описано в процедуре [ниже](#set-up-network-connectivity).

4. Запустите сценарий предварительной регистрации на виртуальной машине, где HANA устанавливается как привилегированный пользователь. Сценарий предоставляется [на портале](#discover-the-databases) в последовательности и необходим для настройки нужных [разрешений](backup-azure-sap-hana-database-troubleshoot.md#setting-up-permissions).

### <a name="set-up-network-connectivity"></a>Настройка сетевого подключения

Для всех операций SAP HANA виртуальной машине требуется подключение к общедоступным IP-адресам Azure. Операции виртуальной машины (обнаружение базы данных, Настройка резервного копирования, планирование резервного копирования, восстановление точек восстановления и т. д.) не могут работать без подключения. Установите подключение, предоставив доступ к диапазонам IP-адресов центра обработки данных Azure: 

- Вы можете скачать [диапазоны IP-адресов](https://www.microsoft.com/download/details.aspx?id=41653) для центров обработки данных Azure, а затем разрешить доступ к этим IP-адресам.
- Если вы используете группы безопасности сети (группы безопасности сети), вы можете использовать [тег службы](https://docs.microsoft.com/azure/virtual-network/security-overview#service-tags) AzureCloud, чтобы разрешить все общедоступные IP-адреса Azure. Для изменения правил NSG можно использовать [командлет Set-азуренетворксекуритируле](https://docs.microsoft.com/powershell/module/servicemanagement/azure/set-azurenetworksecurityrule?view=azuresmps-4.0.0) .

## <a name="onboard-to-the-public-preview"></a>Подключение к общедоступной предварительной версии

Подключитесь к общедоступной предварительной версии, как показано ниже.

- На портале Зарегистрируйте идентификатор подписки для поставщика служб восстановления, [следуя этой статье](https://docs.microsoft.com/azure/azure-resource-manager/resource-manager-register-provider-errors#solution-3---azure-portal). 
- Для PowerShell выполните этот командлет. Она должна быть выполнена как зарегистрированная.

    ```powershell
    PS C:>  Register-AzProviderFeature -FeatureName "HanaBackup" –ProviderNamespace Microsoft.RecoveryServices
    ```



[!INCLUDE [How to create a Recovery Services vault](../../includes/backup-create-rs-vault.md)]

## <a name="discover-the-databases"></a>Обнаружение баз данных

1. В хранилище в **Начало работы**щелкните **резервное копирование**. В разделе **где выполняется рабочая нагрузка?** выберите **SAP HANA на виртуальной машине Azure**.
2. Нажмите кнопку **начать обнаружение**. Это инициирует обнаружение незащищенных виртуальных машин Linux в регионе хранилища.

   - После обнаружения на портале отображаются незащищенные виртуальные машины, перечисленные по имени и группе ресурсов.
   - Если виртуальная машина не указана ожидаемым образом, проверьте, не была ли она создана в хранилище.
   - Несколько виртуальных машин могут иметь одно и то же имя, но они принадлежат разным группам ресурсов.

3. В окне **Выбор виртуальных машин**щелкните ссылку, чтобы скачать скрипт, предоставляющий разрешения для службы Azure Backup, чтобы получить доступ к SAP HANAным виртуальным машинам для обнаружения базы данных.
4. Запустите сценарий на каждой виртуальной машине, где размещаются SAP HANA базы данных, для которых требуется создать резервную копию.
5. После выполнения скрипта на виртуальных машинах в области **Выбор виртуальных машин**выберите виртуальные машины. Затем нажмите кнопку **обнаружить баз данных**.
6. Azure Backup обнаруживает все базы данных SAP HANA на виртуальной машине. Во время обнаружения Azure Backup регистрирует виртуальную машину в хранилище и устанавливает расширение на виртуальной машине. Агент не установлен в базе данных.

    ![Обнаружение баз данных SAP HANA](./media/backup-azure-sap-hana-database/hana-discover.png)

## <a name="configure-backup"></a>Настройка резервного копирования  

Теперь включите резервное копирование.

1. На шаге 2 Нажмите кнопку **Настройка резервного копирования**.
2. В поле **выберите элементы для резервного копирования**выберите все базы данных, которые необходимо защитить > **ОК**.
3. В разделе **Политика** > резервного копирования**выберите Политика архивации**, создайте новую политику резервного копирования для баз данных в соответствии с приведенными ниже инструкциями.
4. После создания политики в меню резервного **копирования** выберите **включить резервное копирование**.
5. Отслеживать ход настройки архивации в области **уведомлений** на портале.

### <a name="create-a-backup-policy"></a>создание политики архивации;

Политика архивации определяет время создания резервных копий и время их хранения.

- Политика создается на уровне хранилища.
- Несколько хранилищ могут использовать одну и ту же политику резервного копирования, но тогда необходимо применить эту политику резервного копирования к каждому хранилищу.

Укажите параметры политики следующим образом.

1. Введите имя новой политики в поле **Имя политики**.
2. В меню **Full Backup policy** (Политика полного резервного копирования) для параметра **Частота архивации** выберите **Ежедневно** или **Еженедельно**.
   - **Ежедневно.** Выберите час и часовой пояс, в котором начинается задание резервного копирования.
   
       - Необходимо запустить полную резервную копию. Этот параметр нельзя отключить.
       - Щелкните **Полная резервная копия**, чтобы просмотреть политику.
       - При ежедневном создании полных резервных копий невозможно создавать разностные резервные копии.
       
   - **Еженедельно**: Выберите день недели, часа и часовой пояс, в котором будет выполняться задание резервного копирования.
3. В поле **диапазон хранения**настройте параметры хранения для полной резервной копии.
    - По умолчанию выбраны все параметры. Удалите все ограничения диапазона хранения, которые вы не хотите использовать, и настройте их.
    - Минимальный срок хранения для любого типа резервной копии (полная/разностная/log) составляет семь дней.
    - Точки восстановления отмечены для хранения исходя из их диапазона хранения. Например, если выбран параметр "Ежедневно", то каждый день активируется создание только одной полной резервной копии.
    - Резервная копия за конкретный день помечается и сохраняется в зависимости от еженедельного диапазона хранения и параметра.
    - Месячный и годовой диапазоны хранения действуют аналогичным образом.

4. В меню **Политика полного резервного копирования** нажмите кнопку **ОК** , чтобы принять параметры.
5. Выберите **разностное резервное копирование** , чтобы добавить политику разностного копирования.
6. В меню **Differential Backup policy** (Политика разностной резервной копии) выберите **Включить** для открытия элементов управления периодичностью и хранением.
    - Максимально в день можно активировать одну разностную резервную копию.
    - Максимальный срок хранения разностных резервных копий составляет 180 дней. Если требуется более длительное хранение, необходимо использовать полные резервные копии.

    > [!NOTE]
    > Добавочные резервные копии в настоящее время не поддерживаются. 

7. Нажмите кнопку **ОК** , чтобы сохранить политику и вернуться в главное меню **политики резервного копирования** .
8. Выберите **резервная копия журнала** , чтобы добавить политику резервного копирования журналов транзакций.
    - В **резервной копии журнала**выберите **включить**.
    - Задайте частоту и элементы управления удержания.

    > [!NOTE]
    > Резервные копии журналов начинают работать только после успешного завершения полного резервного копирования.

9. Нажмите кнопку **ОК** , чтобы сохранить политику и вернуться в главное меню **политики резервного копирования** .
10. После завершения определения политики архивации нажмите кнопку **ОК**.


## <a name="run-an-on-demand-backup"></a>Выполнение резервного копирования по требованию

Резервные копии выполняются в соответствии с расписанием политики. Резервное копирование по запросу можно выполнить следующим образом:


1. В меню хранилища щелкните **Элементы архивации**.
2. В поле **архивные элементы**выберите виртуальную машину, на которой выполняется SAP HANAная база данных, а затем щелкните **Архивация сейчас**.
3. В поле **создать резервную копию**используйте элемент управления Calendar, чтобы выбрать последний день, в который должна храниться точка восстановления. Затем нажмите кнопку **ОК**.
4. Отслеживайте уведомления на портале. Ход выполнения задания можно отслеживать на панели мониторинга хранилища > **задания резервного копирования** > выполняется. В зависимости от размера базы данных создание начальной резервной копии может занять некоторое время.

## <a name="run-sap-hana-studio-backup-on-a-database-with-azure-backup-enabled"></a>Выполнение резервного копирования SAP HANA Studio в базе данных с включенным Azure Backup

Если вы хотите создать локальную резервную копию (с помощью HANA Studio) базы данных, для которой выполняется резервное копирование Azure Backup, выполните следующие действия.

1. Дождитесь завершения всех полных или резервных копий журналов для базы данных. Проверьте состояние в SAP HANA Studio.
2. Отключите резервное копирование журналов и задайте в качестве каталога резервного копирования файловую систему для соответствующей базы данных.
3. Для этого дважды щелкните**Конфигурация** >  **системдб** > ,**выберите фильтр базы данных** >  **(журнал)** .
4. Задайте для **enable_auto_log_backup** значение **нет**.
5. Задайте  для Log_backup_using_backint **значение false**.
6. Создайте прямое полное резервное копирование базы данных.
7. Дождитесь завершения полного резервного копирования и резервного копирования каталога.
8. Верните предыдущие параметры в Azure.
    - Задайте для параметра **enable_auto_log_backup** значение **Да**.
    - Задайте  для Log_backup_using_backint **значение true**.



## <a name="next-steps"></a>Следующие шаги

[Узнайте](backup-azure-sap-hana-database-troubleshoot.md) , как устранять распространенные ошибки при использовании SAP HANA резервного копирования на виртуальных машинах Azure.
[Сведения о](backup-azure-arm-vms-prepare.md) резервном копировании виртуальных машин Azure.
