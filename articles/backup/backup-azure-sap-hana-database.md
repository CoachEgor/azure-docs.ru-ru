---
title: Резервное копирование базы данных SAP HANA в Azure с помощью службы архивации Azure | Документация Майкрософт
description: Этом руководстве объясняется, как для резервного копирования базы данных SAP HANA в Azure с помощью службы архивации Azure.
services: backup
author: rayne-wiselman
manager: carmonm
ms.service: backup
ms.topic: conceptual
ms.date: 05/06/2019
ms.author: raynew
ms.openlocfilehash: a16ed7134fc9f3c159715f58f116de3fb30e8aca
ms.sourcegitcommit: 9b80d1e560b02f74d2237489fa1c6eb7eca5ee10
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/01/2019
ms.locfileid: "67481141"
---
# <a name="back-up-an-sap-hana-database"></a>Резервную копию базы данных SAP HANA

[Служба архивации Azure](backup-overview.md) поддерживает эту резервную копию баз данных SAP HANA в Azure.

> [!NOTE]
> Эта функция сейчас доступна в виде общедоступной предварительной версии. Сейчас не готовы для рабочей среды и отсутствует гарантированную соглашение об уровне ОБСЛУЖИВАНИЯ. 

## <a name="scenario-support"></a>Поддержка сценария

**Поддержка** | **Сведения**
--- | ---
**Поддерживаемые географические регионы** | Юго-Восточная Австралия Восточная Австралия <br> Южная часть Бразилии <br> Восточная Канада Central, Канада <br> Юго-Восточная Азия, Восточная Азия <br> Восточная часть США, восточная часть США 2, западно-Центральная часть США, Западная часть США, Западная часть США 2, северо-центральный регион США, Центральная часть США, Юго-центральный регион США<br> Центральная Индия, Южная Индия <br> Восточная Япония, Западная Япония<br> Центральная Корея, Южная Корея <br> Северная Европа, Западная Европа <br> Южная часть соединенного Королевства, Западная часть соединенного Королевства
**Поддерживаемые операционные системы для виртуальной Машины** | SLES 12 SP2 или SP3.
**Поддерживаемые версии HANA** | SDC на HANA 1.x, MDC в HANA 2.x < = SPS03

### <a name="current-limitations"></a>Текущие ограничения

- Вы можете только резервное копирование баз данных SAP HANA на виртуальных машинах Azure.
- Резервное копирование SAP HANA можно настроить только на портале Azure. Функцию нельзя настроить с помощью PowerShell, CLI или REST API.
- Вы можете только резервное копирование баз данных в режиме масштабирования.
- Можно выполнять архивацию журналов базы данных каждые 15 минут. Резервные копии журналов только начать поток после завершения успешной полной резервной копии для базы данных.
- Полные и разностные резервные копии могут быть. Добавочное резервное копирование сейчас не поддерживается.
- Политика резервного копирования нельзя изменять после применения резервных копий SAP HANA. Если вы хотите архивировать с различными параметрами, создайте новую политику или назначить другую политику.
  - Чтобы создать новую политику, в хранилище щелкните **политики** > **политики резервного копирования** >  **+ добавить** > **SAP HANA в Виртуальная машина Azure**и укажите параметры политики.
  - Чтобы назначить другую политику, в свойствах виртуальной машины, где базы данных, щелкните имя текущей политики. Затем на **политики резервного копирования** страницы, можно выбрать другую политику для резервного копирования.

## <a name="prerequisites"></a>Технические условия

Убедитесь, что перед настройкой резервного копирования, сделайте следующее:

1. На виртуальной Машине под управлением базы данных SAP HANA, установите официальный Microsoft [2.1 среды выполнения .NET Core](https://dotnet.microsoft.com/download/linux-package-manager/sles/runtime-current) пакета. Обратите внимание на следующее.
    - Требуется только **2.1 для среды выполнения dotnet** пакета. Не требуется **aspnetcore-среды выполнения — 2.1**.
    - Если виртуальная машина не подключена веб-доступ, зеркальное отображение и обеспечения автономного кэша dotnet-среды выполнения — 2.1 (с указанием всех зависимых пакетов RPM) из веб-канал пакетов Microsoft на странице.
    - Во время установки пакета может быть предложено указать параметр. Если Да, укажите **решение 2**.

        ![Вариант установки пакета](./media/backup-azure-sap-hana-database/hana-package.png)

2. На виртуальной Машине установить и включить пакеты драйверов ODBC с официальной SLES пакета/носителя с помощью zypper, следующим образом:

    ```unix
    sudo zypper update
    sudo zypper install unixODBC
    ```

3. Разрешить подключение из виртуальной Машины к Интернету, таким образом, чтобы он достигнет Azure, как описано в процедуре [ниже](#set-up-network-connectivity).

4. Запустите скрипт предварительной регистрации на виртуальной машине, где HANA устанавливается как привилегированный пользователь. Предоставляется скрипт [на портале](#discover-the-databases) в потоке и необходимые для настройки [правой кнопкой мыши разрешения](backup-azure-sap-hana-database-troubleshoot.md#setting-up-permissions).

### <a name="set-up-network-connectivity"></a>Настройте сетевое соединение

Для всех операций SAP HANA на виртуальной Машине требуется подключение к Azure общедоступных IP-адресов. Операции с виртуальной Машины (обнаружение баз данных, настройка резервных копий, запланировать резервное копирование, восстановить точки восстановления и так далее) не может работать без подключения. Установите соединение с предоставлением доступа к IP-адресов центра обработки данных Azure: 

- Вы можете скачать [диапазоны IP-адресов](https://www.microsoft.com/download/details.aspx?id=41653) центрам обработки данных Azure, а затем разрешить доступ к этим IP-адресов.
- Если вы используете группы безопасности сети (Nsg), можно использовать AzureCloud [тег службы](https://docs.microsoft.com/azure/virtual-network/security-overview#service-tags) разрешить все Azure общедоступный IP-адресов. Можно использовать [командлет Set-AzureNetworkSecurityRule](https://docs.microsoft.com/powershell/module/servicemanagement/azure/set-azurenetworksecurityrule?view=azuresmps-4.0.0) изменение правил группы безопасности сети.

## <a name="onboard-to-the-public-preview"></a>Подключение к общедоступной предварительной версии

Подключение к общедоступной предварительной версии, как показано ниже:

- На портале регистрации своим Идентификатором подписки, поставщику услуг служб восстановления, [следующей статьи](https://docs.microsoft.com/azure/azure-resource-manager/resource-manager-register-provider-errors#solution-3---azure-portal). 
- Для PowerShell используйте этот командлет. Оно должно завершиться как «Зарегистрировано».

    ```powershell
    PS C:>  Register-AzProviderFeature -FeatureName "HanaBackup" –ProviderNamespace Microsoft.RecoveryServices
    ```



[!INCLUDE [How to create a Recovery Services vault](../../includes/backup-create-rs-vault.md)]

## <a name="discover-the-databases"></a>Обнаружение баз данных

1. В хранилище в **Приступая к работе**, нажмите кнопку **резервного копирования**. В **где выполняется рабочая нагрузка?** выберите **SAP HANA на виртуальной Машине Azure**.
2. Нажмите кнопку **начать обнаружение**. Это инициирует обнаружения незащищенных виртуальных машин Linux в регионе хранилища.

   - После обнаружения, незащищенные виртуальные машины отображаются на портале, упорядоченные по имени и группы ресурсов.
   - Если виртуальной Машины нет в списке должным образом, проверьте ли уже резервного копирования в хранилище.
   - Несколько виртуальных машин может иметь то же имя, но они принадлежат к разным группам ресурсов.

3. В **выбор виртуальных машин**, щелкните ссылку, чтобы загрузить скрипт, обеспечивающая разрешения для службы архивации Azure для доступа к виртуальных машин SAP HANA для обнаружения базы данных
4. Запустите сценарий на каждую виртуальную Машину, на котором размещены базы данных SAP HANA, которые вы хотите создать резервную копию.
5. После выполнения сценария на виртуальных машинах, в **выбор виртуальных машин**, выберите виртуальные машины. Нажмите кнопку **обнаружение баз данных SQL**.
6. Служба архивации Azure находит все базы данных SAP HANA на виртуальной Машине. Во время обнаружения службы архивации Azure регистрирует виртуальную Машину с хранилищем и устанавливает расширение на виртуальной Машине. Агент не установлен в базе данных.

    ![Обнаружение баз данных SAP HANA](./media/backup-azure-sap-hana-database/hana-discover.png)

## <a name="configure-backup"></a>Настройка резервного копирования  

Теперь можно включите резервное копирование.

1. На шаге 2 выберите **Настройка резервного копирования**.
2. В **выберите элементы для резервного копирования**, выбрать все базы данных, необходимо обеспечить защиту > **ОК**.
3. В **политики резервного копирования** > **Выбор политики архивации**, создать политику резервного копирования для баз данных в соответствии с приведенным ниже инструкциям.
4. После создания политики, на **резервного копирования** меню, щелкните **включить резервное копирование**.
5. Отслеживать конфигурации резервного копирования в **уведомления** области портала.

### <a name="create-a-backup-policy"></a>создание политики архивации;

Политику резервного копирования определяет, когда резервные копии создаются и как долго они хранятся.

- Политика создается на уровне хранилища.
- Несколько хранилищ могут использовать одну и ту же политику резервного копирования, но тогда необходимо применить эту политику резервного копирования к каждому хранилищу.

Укажите параметры политики, следующим образом:

1. Введите имя новой политики в поле **Имя политики**.
2. В меню **Full Backup policy** (Политика полного резервного копирования) для параметра **Частота архивации** выберите **Ежедневно** или **Еженедельно**.
   - **Ежедневно.** Выберите часы и часовой пояс, в котором начинается задание резервного копирования.
   
       - Необходимо выполнить полное резервное копирование. Этот параметр нельзя отключить.
       - Щелкните **Полная резервная копия**, чтобы просмотреть политику.
       - При ежедневном создании полных резервных копий невозможно создавать разностные резервные копии.
       
   - **Еженедельное**: Выберите день недели, час и часовой пояс, в котором выполняется задание резервного копирования.
3. В **диапазон хранения**, настройте параметры хранения для создания полной резервной копии.
    - По умолчанию выбраны все параметры. Снимите ограничения диапазона хранения, вы не хотите использовать и те, которые необходимо задать.
    - Минимальный срок хранения для любого типа резервной копии (полной или разностной резервной копии/log) составляет семь дней.
    - Точки восстановления отмечены для хранения исходя из их диапазона хранения. Например, если выбран параметр "Ежедневно", то каждый день активируется создание только одной полной резервной копии.
    - Резервное копирование для определенного дня с тегами и сохраняются на основе еженедельно диапазон хранения и параметр.
    - Месячный и годовой диапазоны хранения действуют аналогичным образом.

4. В **политики полной резервной копии** меню, щелкните **ОК** принимать параметры.
5. Выберите **разностной резервной копии** Добавление разностного политики.
6. В меню **Differential Backup policy** (Политика разностной резервной копии) выберите **Включить** для открытия элементов управления периодичностью и хранением.
    - Максимально в день можно активировать одну разностную резервную копию.
    - Максимальный срок хранения разностных резервных копий составляет 180 дней. Если требуется более длительное хранение, необходимо использовать полные резервные копии.

    > [!NOTE]
    > Сейчас не поддерживаются добавочные резервные копии. 

7. Нажмите кнопку **ОК** чтобы сохранить политику и вернуться к основной **политика архивации** меню.
8. Выберите **резервного копирования журнала** добавить политику резервного копирования журнала транзакций
    - В **резервной копии журнала**выберите **включить**.
    - Настройка частоты и периода удержания элементов управления.

    > [!NOTE]
    > Резервные копии журналов только начать поток после успешного полного резервного копирования.

9. Нажмите кнопку **ОК** чтобы сохранить политику и вернуться к основной **политика архивации** меню.
10. Завершив Определение политики резервного копирования, нажмите кнопку **ОК**.


## <a name="run-an-on-demand-backup"></a>Выполнение резервного копирования по требованию

Резервные копии создаются в соответствии с расписанием политики. Архивация по запросу можно выполнить следующим образом:


1. В меню хранилища щелкните **Элементы архивации**.
2. В **архивные элементы**, выберите виртуальную Машину под управлением базы данных SAP HANA и нажмите кнопку **резервную**.
3. В **моментальная Архивация**, использование элементов управления календарем выберите последний день, следует ли хранить точки восстановления. Нажмите кнопку **ОК**.
4. Отслеживайте уведомления на портале. Можно отслеживать ход выполнения задания на панели мониторинга хранилища > **задания резервного копирования** > в процессе выполнения. В зависимости от размера базы данных создание начального архива может занять некоторое время.

## <a name="run-sap-hana-studio-backup-on-a-database-with-azure-backup-enabled"></a>Выполнять резервное копирование SAP HANA Studio на базу данных с помощью службы архивации Azure включено

Если вы хотите воспользоваться локальной резервной копии (с помощью HANA Studio) базы данных, которая выполняется резервное копирование с помощью службы архивации Azure, сделайте следующее:

1. Ожидания для любой полной или резервные копии журналов для базы данных до конца. Проверьте состояние в SAP HANA Studio.
2. Отключить резервные копии журналов и задайте каталог резервных копий в файловой системе для соответствующей базы данных.
3. Чтобы сделать это, дважды щелкните **systemdb** > **конфигурации** > **Выбор базы данных** > **фильтра (журнал)** .
4. Задайте **enable_auto_log_backup** для **нет**.
5. Задайте **log_backup_using_backint** для **False**.
6. Создание резервной копии базы данных ad-hoc full.
7. Дождитесь полной резервной копии и резервной копии каталога до конца.
8. Восстановить предыдущие параметры обратно в их для Azure:
    - Задайте **enable_auto_log_backup** для **Да**.
    - Задайте **log_backup_using_backint** для **True**.



## <a name="next-steps"></a>Дальнейшие действия

[Дополнительные сведения о](backup-azure-sap-hana-database-troubleshoot.md) способы устранения распространенных ошибок при использовании резервного копирования SAP HANA на виртуальных машинах Azure.
[Дополнительные сведения о](backup-azure-arm-vms-prepare.md) резервное копирование виртуальных машин Azure.
