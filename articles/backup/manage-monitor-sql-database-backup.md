---
title: Управление и мониторинг DB сервера S'L на Azure VM
description: В этой статье описывается, как управлять базами данных сервера S'L Server, работающими на VM Azure.
ms.topic: conceptual
ms.date: 09/11/2019
ms.openlocfilehash: 14e3a4797fe60a3d1857f1e6d947fa0c669bdcfe
ms.sourcegitcommit: 31ef5e4d21aa889756fa72b857ca173db727f2c3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81537310"
---
# <a name="manage-and-monitor-backed-up-sql-server-databases"></a>Мониторинг резервных копий баз данных SQL Server и управление ими

В этой статье описаны общие задачи для управления и мониторинга баз данных сервера S'L Server, которые работают на виртуальном компьютере Azure (VM) и которые резервируются в хранилище службы резервного копирования Azure Backup службой резервного [копирования.](backup-overview.md) Вы узнаете, как контролировать задания и оповещения, останавливать и возобновлять защиту базы данных, запускать резервные задания и отстранять VM от резервных ups.

Если вы еще не настроили резервные ожидания для баз данных сервера S'L, см. [Резервное копирование баз данных сервера S'L на Azure VMs](backup-azure-sql-database.md)

## <a name="monitor-manual-backup-jobs-in-the-portal"></a>Мониторинг заданий ручного резервного копирования на портале

Резервное копирование Azure отображает все задания с вручную на портале **заданий резервного копирования.** Задания, которые вы видите на этом портале, включают обнаружение и регистрацию базы данных, а также резервное копирование и восстановление операций.

![Портал вакансий резервного копирования](./media/backup-azure-sql-database/jobs-list.png)

> [!NOTE]
> Портал **заданий резервного копирования** не показывает запланированные задания резервного копирования. Используйте SQL Server Management Studio для отслеживания запланированных заданий резервного копирования, как описано в следующем разделе.
>

Для получения подробной информации о сценариях мониторинга перейдите на [портал Azure](backup-azure-monitoring-built-in-monitor.md) и [мониторинг с помощью Azure Monitor.](backup-azure-monitoring-use-azuremonitor.md)  

## <a name="view-backup-alerts"></a>Просмотр оповещений о резервном копировании

Так как резервные копии журналов создаются каждые 15 минут, мониторинг заданий резервного копирования может быть утомительным. Резервное копирование Azure облегчает мониторинг, отправляя оповещения по электронной почте. Оповещения по электронной почте:

- Срабатывает для всех сбоев резервного копирования.
- Консолидированна на уровне базы данных по коду ошибки.
- Отправлено только для первого сбоя резервного копирования базы данных.

Для мониторинга резервных оповещений о резервной базе данных:

1. Войдите на [портал Azure](https://portal.azure.com).

2. На панели мониторинга хранилища выберите **Предупреждения и события**.

   ![Выбор "Alerts and Events" (Оповещения и события)](./media/backup-azure-sql-database/vault-menu-alerts-events.png)

3. В области **Предупреждения и события** выберите **Оповещения, связанные с архивацией**.

   ![Выбор "Оповещения, связанные с архивацией"](./media/backup-azure-sql-database/backup-alerts-dashboard.png)

## <a name="stop-protection-for-a-sql-server-database"></a>Остановка защиты базы данных SQL Server

Вы можете остановить создание резервных копий базы данных SQL Server двумя способами:

- остановить все будущие задания резервного копирования и удалить все точки восстановления;
- Остановите все будущие задания резервного копирования и оставьте точки восстановления нетронутыми.

Если вы решили сохранить точки восстановления, учитывайте следующие факторы:

- все точки восстановления навсегда остаются неизменными, любая очистка прекращается одновременно с отключением защиты;
- С вас будет взиматься плата за защищенный экземпляр и потребленохранилище. Для получения дополнительной [Azure Backup pricing](https://azure.microsoft.com/pricing/details/backup/)информации см.
- если вы удалите источник данных без остановки резервного копирования, новые операции резервного копирования будут завершаться сбоем. Старые точки восстановления истекают в соответствии с политикой, но последняя точка восстановления всегда будет сохранена до тех пор, пока вы не остановите резервные копирования и не удалите данные.

Чтобы остановить защиту базы данных, выполните следующие действия.

1. На панели мониторинга хранилища выберите **элементы резервного копирования.**

2. В **рамках типа управления резервным копированием**выберите **S'L в Azure VM.**

    ![Выбор "SQL in Azure VM" (SQL на виртуальной машине Azure)](./media/backup-azure-sql-database/sql-restore-backup-items.png)

3. Выберите базу данных, для которой нужно остановить защиту.

    ![Выбор базы данных для остановки защиты](./media/backup-azure-sql-database/sql-restore-sql-in-vm.png)

4. В меню базы данных выберите **Остановить архивацию**.

    ![Выбор "Остановить архивацию"](./media/backup-azure-sql-database/stop-db-button.png)

5. В меню **Stop Backup** выберите, следует ли сохранять или удалять данные. Если вы хотите, предоставьте причину и комментарий.

    ![Сохранение или удаление данных в меню stop Backup](./media/backup-azure-sql-database/stop-backup-button.png)

6. Выберите **остановить резервное копирование.**

> [!NOTE]
>
>Для получения дополнительной информации о опции данных об удалении смотрите вопросы часто задаваемые вопросы ниже:
>
>- [Если я удалю базу данных из авторидарного экземпляра, что произойдет с резервными ожиданиями?](faq-backup-sql-server.md#if-i-delete-a-database-from-an-autoprotected-instance-what-will-happen-to-the-backups)
>- [Если я остановиоперацию резервной системой автоматической базы данных, каково будет ее поведение?](faq-backup-sql-server.md#if-i-change-the-name-of-the-database-after-it-has-been-protected-what-will-be-the-behavior)
>
>

## <a name="resume-protection-for-a-sql-database"></a>возобновление защиты базы данных SQL;

При остановке защиты базы данных S'L, если вы выберете опцию **Сохранить резервные данные,** вы можете возобновить защиту. Если вы не сохраняете данные резервного копирования, вы не можете возобновить защиту.

Для возобновления защиты базы данных S'L:

1. Откройте элемент резервного копирования и выберите **резервное копирование резюме.**

    ![Выбор "Возобновить резервное копирование" для возобновления защиты базы данных](./media/backup-azure-sql-database/resume-backup-button.png)

2. В меню **Политика архивации** выберите политику и нажмите кнопку **Сохранить**.

## <a name="run-an-on-demand-backup"></a>Выполнение резервного копирования по запросу

Вы можете выполнить различные типы резервного копирования по требованию:

- Полное резервное копирование
- полная резервная копия (только копирование);
- Разностное резервное копирование
- Резервное копирование журналов

В то время как необходимо указать продолжительность хранения только для копирования только полное резервное копирование, диапазон удержания для по требованию полного резервного копирования будет автоматически установлен до 45 дней с текущего времени.

Для получения дополнительной информации ознакомьтесь с [типами резервного копирования сервера S'L Server.](backup-architecture.md#sql-server-backup-types)

## <a name="unregister-a-sql-server-instance"></a>Отмена регистрации экземпляра SQL Server

Отменить регистрацию экземпляра сервера S'L после того, как вы отключаете защиту, но прежде чем удалить хранилище:

1. На панели мониторинга хранилища, под **управлением,** выберите **инфраструктуру резервного копирования.**  

   ![Выбор "Инфраструктура резервного копирования"](./media/backup-azure-sql-database/backup-infrastructure-button.png)

2. В разделе **Серверы управления** выберите **Защищенные серверы**.

   ![Выбор "Защищенные серверы"](./media/backup-azure-sql-database/protected-servers.png)

3. В меню **Защищенные серверы** выберите сервер, для которого необходимо отменить регистрацию. Чтобы удалить хранилище, необходимо отменить регистрацию всех серверов.

4. Нажмите правой кнопкой мыши на защищенном сервере и выберите **Unregister.**

   ![Выбор "Удалить"](./media/backup-azure-sql-database/delete-protected-server.jpg)

## <a name="modify-policy"></a>Изменение политики

Измените политику для изменения частоты или диапазона хранения резервного копирования.

> [!NOTE]
> Любое изменение периода удержания будет ретроспективно применено ко всем старым точкам восстановления, кроме новых.

В панели мониторинга хранилища перейдите **на** > управление**политиками резервного копирования** и выберите политику, которая требуется отсылку отсватива.

  ![Управление политикой резервного копирования](./media/backup-azure-sql-database/modify-backup-policy.png)

  ![Изменение политики резервного копирования](./media/backup-azure-sql-database/modify-backup-policy-impact.png)

Изменение политики повлияет на все связанные элементы резервного копирования и запустит соответствующие задания **защиты настройки.**

### <a name="inconsistent-policy"></a>Непоследовательная политика

Иногда изменение операции политики может привести к **несогласованной** версии политики для некоторых элементов резервного копирования. Это происходит, когда соответствующее задание **защиты настройки** выходит из строя для элемента резервного копирования после запуска операции изменения политики. В представлении элемента резервного копирования отображается следующее:

  ![Непоследовательная политика](./media/backup-azure-sql-database/inconsistent-policy.png)

Вы можете исправить версию политики для всех затронутых элементов одним щелчком мыши:

  ![Исправление непоследовательной политики](./media/backup-azure-sql-database/fix-inconsistent-policy.png)

## <a name="re-register-extension-on-the-sql-server-vm"></a>Расширение перерегистрации на VM сервера S'L

Иногда расширение рабочей нагрузки на VM может быть затронуто по той или иной причине. В таких случаях все операции, срабатывающие на ВМ, начнут сбой. Возможно, вам потребуется перерегистрировать расширение на VM. **Операция перерегистрации** переустанавливает расширение резервного копирования рабочей нагрузки на VM для продолжения операций.

Используйте эту опцию с осторожностью; при срабатывании на VM с уже здоровым расширением эта операция приведет к перезапуску расширения. Это может привести к тому, что все незавершенные задания потерпят неудачу. Доброспектируйте для одного или нескольких [из симптомов](backup-sql-server-azure-troubleshoot.md#re-registration-failures) перед вызывать операцию перерегистрирования.

## <a name="next-steps"></a>Следующие шаги

Для получения дополнительной информации смотрите [резервные ожидания Troubleshoot в базе данных сервера S'L Server.](backup-sql-server-azure-troubleshoot.md)
