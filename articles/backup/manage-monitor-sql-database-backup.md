---
title: Мониторинг SQL Server баз данных на виртуальной машине Azure и управление ими — Azure Backup
description: В этой статье описывается, как управлять и отслеживать SQL Server базы данных, работающие на виртуальной машине Azure.
author: dcurwin
manager: carmonm
ms.service: backup
ms.topic: conceptual
ms.date: 09/11/2019
ms.author: dacurwin
ms.openlocfilehash: b9a292d06ce68d211b5c758e287f2935411c6f12
ms.sourcegitcommit: a107430549622028fcd7730db84f61b0064bf52f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/14/2019
ms.locfileid: "74074778"
---
# <a name="manage-and-monitor-backed-up-sql-server-databases"></a>Мониторинг резервных копий баз данных SQL Server и управление ими

В этой статье описываются распространенные задачи по управлению и мониторингу SQL Server баз данных, работающих на виртуальной машине Azure, и резервное копирование в хранилище служб восстановления Azure Backup с помощью службы [Azure Backup](backup-overview.md) . Вы узнаете, как отслеживать задания и оповещения, прекращать и возобновлять защиту базы данных, выполнять задания резервного копирования и отменять регистрацию виртуальной машины из резервных копий.

Если вы еще не настроили резервные копии для баз данных SQL Server, см. статью [резервное копирование SQL Server баз данных на виртуальных машинах Azure](backup-azure-sql-database.md) .

## <a name="monitor-manual-backup-jobs-in-the-portal"></a>Мониторинг заданий резервного копирования вручную на портале

Azure Backup отображаются все задания, активированные вручную на портале **задания резервного копирования** . Задания, отображаемые на этом портале, включают в себя обнаружение и регистрацию базы данных, а также операции резервного копирования и восстановления.

![Портал заданий резервного копирования](./media/backup-azure-sql-database/jobs-list.png)

> [!NOTE]
> На портале **задания резервного копирования** не отображаются запланированные задания архивации. Используйте SQL Server Management Studio для отслеживания запланированных заданий резервного копирования, как описано в следующем разделе.
>

Для получения дополнительных сведений о сценариях мониторинга перейдите к разделу [мониторинг в портал Azure](backup-azure-monitoring-built-in-monitor.md) и [мониторинг с помощью Azure Monitor](backup-azure-monitoring-use-azuremonitor.md).  

## <a name="view-backup-alerts"></a>Просмотр оповещений о резервном копировании

Так как резервные копии журналов создаются каждые 15 минут, мониторинг заданий резервного копирования может быть утомительным. Azure Backup упрощает мониторинг, отправляя оповещения по электронной почте. Оповещения по электронной почте:

- Активируется для всех сбоев резервного копирования.
- Консолидация на уровне базы данных по коду ошибки.
- Отправляется только для первого сбоя резервного копирования базы данных.

Для мониторинга предупреждений резервного копирования базы данных выполните следующие действия.

1. Войдите на [портале Azure](https://portal.azure.com).

2. На панели мониторинга хранилища выберите **Предупреждения и события**.

   ![Выбор "Alerts and Events" (Оповещения и события)](./media/backup-azure-sql-database/vault-menu-alerts-events.png)

3. В области **Предупреждения и события** выберите **Оповещения, связанные с архивацией**.

   ![Выбор "Оповещения, связанные с архивацией"](./media/backup-azure-sql-database/backup-alerts-dashboard.png)

## <a name="stop-protection-for-a-sql-server-database"></a>Остановка защиты базы данных SQL Server

Вы можете остановить создание резервных копий базы данных SQL Server двумя способами:

- остановить все будущие задания резервного копирования и удалить все точки восстановления;
- Завершите все будущие задания резервного копирования и оставьте точки восстановления без изменений.

Если вы решили оставить точки восстановления, учитывайте следующие сведения:

- Все точки восстановления остаются неизменными, все очистки будут прекращаться в случае отключения защиты с сохранением данных.
- Вы получите оплату за защищенный экземпляр и используемое хранилище. Дополнительные сведения см. в разделе [цены на Azure Backup](https://azure.microsoft.com/pricing/details/backup/).
- При удалении источника данных без остановки резервного копирования происходит сбой новых операций резервного копирования.

Чтобы остановить защиту базы данных, выполните следующие действия.

1. На панели мониторинга хранилища выберите пункт **архивные элементы**.

2. В разделе **тип управления архивацией**выберите **SQL на виртуальной машине Azure**.

    ![Выбор "SQL in Azure VM" (SQL на виртуальной машине Azure)](./media/backup-azure-sql-database/sql-restore-backup-items.png)

3. Выберите базу данных, для которой нужно остановить защиту.

    ![Выбор базы данных для остановки защиты](./media/backup-azure-sql-database/sql-restore-sql-in-vm.png)

4. В меню базы данных выберите **Остановить архивацию**.

    ![Выбор "Остановить архивацию"](./media/backup-azure-sql-database/stop-db-button.png)

5. В меню " **Отменить архивацию** " выберите, следует ли хранить или удалять данные. При необходимости укажите причину и комментарий.

    ![Сохраняйте или удаляйте данные в меню "Отмена архивации"](./media/backup-azure-sql-database/stop-backup-button.png)

6. Выберите пункт **прерывать архивацию**.

> [!NOTE]
>
>Дополнительные сведения о параметре Delete Data см. в разделе часто задаваемые вопросы ниже:
>
>- [Что произойдет с резервным копированием, если удалить базу данных из автозащищаемого экземпляра?](faq-backup-sql-server.md#if-i-delete-a-database-from-an-autoprotected-instance-what-will-happen-to-the-backups)
>- [Что будет поведению при выполнении резервного копирования базы данных с автозащитой?](faq-backup-sql-server.md#if-i-change-the-name-of-the-database-after-it-has-been-protected-what-will-be-the-behavior)
>
>

## <a name="resume-protection-for-a-sql-database"></a>возобновление защиты базы данных SQL;

При отключении защиты для базы данных SQL при выборе варианта " **хранить данные резервной копии** " можно возобновить защиту. Если вы не храните данные резервной копии, вы не сможете возобновить защиту.

Чтобы возобновить защиту базы данных SQL, выполните следующие действия.

1. Откройте элемент архивации и выберите **возобновить резервное копирование**.

    ![Выбор "Возобновить резервное копирование" для возобновления защиты базы данных](./media/backup-azure-sql-database/resume-backup-button.png)

2. В меню **Политика архивации** выберите политику и нажмите кнопку **Сохранить**.

## <a name="run-an-on-demand-backup"></a>Выполнение резервного копирования по требованию

Вы можете выполнить различные типы резервного копирования по требованию:

- Полная резервная копия
- полная резервная копия (только копирование);
- разностная резервная копия;
- Резервное копирование журналов

Хотя необходимо указать продолжительность хранения для полной резервной копии только для копирования, диапазон хранения для полной резервной копии по запросу будет автоматически установлен в 45 дней с текущего времени.

Дополнительные сведения см. в статье [SQL Server типы резервных копий](backup-architecture.md#sql-server-backup-types).

## <a name="unregister-a-sql-server-instance"></a>Отмена регистрации экземпляра SQL Server

Отмените регистрацию экземпляра SQL Server после отключения защиты, но перед удалением хранилища выполните следующие действия.

1. На панели мониторинга хранилища в разделе **Управление**выберите **инфраструктура резервного копирования**.  

   ![Выбор "Инфраструктура резервного копирования"](./media/backup-azure-sql-database/backup-infrastructure-button.png)

2. В разделе **Серверы управления** выберите **Защищенные серверы**.

   ![Выбор "Защищенные серверы"](./media/backup-azure-sql-database/protected-servers.png)

3. В меню **Защищенные серверы** выберите сервер, для которого необходимо отменить регистрацию. Чтобы удалить хранилище, необходимо отменить регистрацию всех серверов.

4. Щелкните правой кнопкой мыши защищенный сервер и выберите отменить **регистрацию**.

   ![Выбор "Удалить"](./media/backup-azure-sql-database/delete-protected-server.jpg)

## <a name="modify-policy"></a>Изменение политики

Измените политику, чтобы изменить периодичность резервного копирования или диапазон хранения.

> [!NOTE]
> Любые изменения в сроке хранения будут применены ретроспективели ко всем старым точкам восстановления, кроме новых.

На панели мониторинга хранилища перейдите в раздел **управление** > **политики резервного копирования** и выберите политику, которую нужно изменить.

  ![Управление политикой архивации](./media/backup-azure-sql-database/modify-backup-policy.png)

  ![Изменение политики архивации](./media/backup-azure-sql-database/modify-backup-policy-impact.png)

Изменение политики повлияет на все связанные элементы резервного копирования и триггер, соответствующие **настройкам заданий защиты** .

### <a name="inconsistent-policy"></a>Несовместимая политика

В некоторых случаях операция изменения политики может привести к **несовместимости** версии политики для некоторых элементов резервного копирования. Это происходит, если соответствующее задание **настройки защиты** для элемента резервного копирования завершается сбоем после запуска операции изменения политики. В представлении элемента резервного копирования он выглядит следующим образом:

  ![Несовместимая политика](./media/backup-azure-sql-database/inconsistent-policy.png)

Вы можете исправить версию политики для всех затронутых элементов одним щелчком мыши:

  ![Исправление несоответствия политики](./media/backup-azure-sql-database/fix-inconsistent-policy.png)

## <a name="re-register-extension-on-the-sql-server-vm"></a>Повторно зарегистрируйте расширение на виртуальной машине SQL Server

Иногда расширение рабочей нагрузки на виртуальной машине может затронуть одну причину или другую. В таких случаях все операции, запущенные на виртуальной машине, начнут завершаться сбоем. Вам может потребоваться повторно зарегистрировать расширение на виртуальной машине. Операция **повторной регистрации** переустанавливает модуль резервного копирования рабочей нагрузки на виртуальной машине для продолжения операций.

Используйте этот параметр с осторожностью. При запуске на виртуальной машине с уже работоспособным расширением эта операция приведет к перезапуску расширения. Это может привести к сбою всех выполняемых заданий. Проверьте наличие одной или нескольких [симптомов](backup-sql-server-azure-troubleshoot.md#re-registration-failures) перед активацией операции повторной регистрации.

## <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения см. в статье [Устранение неполадок резервного копирования в SQL Server базе данных](backup-sql-server-azure-troubleshoot.md).
