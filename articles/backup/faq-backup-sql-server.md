---
title: Часто задаваемые вопросы о резервном копировании баз данных SQL Server на виртуальных машинах Azure с помощью Azure Backup
description: Ответы на часто задаваемые вопросы о резервном копировании баз данных SQL Server на виртуальных машинах Azure с помощью службы архивации Azure.
services: backup
author: sachdevaswati
manager: vijayts
ms.service: backup
ms.topic: conceptual
ms.date: 04/23/2019
ms.author: sachdevaswati
ms.openlocfilehash: 649e50634d901ab48f1cb36c39d7331401c0cc51
ms.sourcegitcommit: 44a85a2ed288f484cc3cdf71d9b51bc0be64cc33
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "64700171"
---
# <a name="faq-about-sql-server-databases-that-are-running-on-an-azure-vm-backup"></a>Часто задаваемые вопросы о базах данных SQL Server, работающих под управлением на резервную копию виртуальной Машины Azure

В этой статье содержатся ответы на часто задаваемые вопросы о резервном копировании баз данных SQL Server, работающие на виртуальных машинах (ВМ) и, в которых используется [Azure Backup](backup-overview.md) службы.

## <a name="can-i-use-azure-backup-for-iaas-vm-as-well-as-sql-server-on-the-same-machine"></a>Можно ли использовать Azure backup для виртуальных Машин IaaS, а также SQL Server на одном компьютере?
Да, можно иметь резервного копирования виртуальных Машин и резервного копирования SQL на той же виртуальной Машине. В этом случае мы внутренне активировать только полной резервной копии на виртуальную Машину, чтобы не выполнять усечение журналов.


## <a name="does-the-solution-retry-or-auto-heal-the-backups"></a>Решение повторите или автоматическое восстановление резервных копий?

В некоторых случаях служба архивации Azure запускает корректирующие резервных копий. Автоматическое восстановление может произойти по любой из шести условия, приведенные ниже:

  - Если журнала или разностной резервной копии не удается из-за ошибки проверки номера LSN, далее журнала или разностной резервной копии вместо преобразуется в полной резервной копии.
  - Если полное резервное копирование не произошло перед журнала или разностной резервной копии, журнала или разностной резервной копии вместо преобразуется в полной резервной копии.
  - Если последней полной резервной в определенный момент времени старше 15 дней, далее журнала или разностной резервной копии вместо преобразуется в полной резервной копии.
  - Все задания резервного копирования, получите отменено из-за обновления расширения повторно активируются, после завершения обновления и расширения запускается.
  - При выборе перезаписывания базы данных во время восстановления, далее журнал или разностную резервную копию завершается ошибкой, и вместо этого запускается полной резервной копии.
  - В случаях, где требуется сбросить цепочки журналов, из-за изменение в модели восстановления базы данных полное резервное копирование полной получает активироваться автоматически по расписанию Далее.

Автоматическое восстановление возможность для всех пользователей включено по умолчанию. Тем не менее в случае, если вы решили отказаться от его, затем выполните ниже:

  * На экземпляре SQL Server в *C:\Program Files\Azure рабочей нагрузки Backup\bin* папки, создание или изменение **ExtensionSettingsOverrides.json** файла.
  * В **ExtensionSettingsOverrides.json**, задайте *{«EnableAutoHealer»: false}*.
  * Сохраните изменения и закройте файл.
  * На экземпляре SQL Server, откройте **задач управления** , а затем перезапустите **AzureWLBackupCoordinatorSvc** службы.  

## <a name="can-i-control-as-to-how-many-concurrent-backups-run-on-the-sql-server"></a>Могу ли я контролировать количество параллельных операций резервного копирования, выполнение на SQL server?

Да. Вы можете регулировать частоту, с которой выполняется политика резервного копирования, чтобы свести к минимуму влияние на экземпляр SQL Server. Чтобы изменить этот параметр:
1. На экземпляре SQL Server в *C:\Program Files\Azure рабочей нагрузки Backup\bin* папке создайте *ExtensionSettingsOverrides.json* файла.
2. В *ExtensionSettingsOverrides.json* измените **DefaultBackupTasksThreshold** параметр меньшее значение (например, 5). <br>
  `{"DefaultBackupTasksThreshold": 5}`

3. Сохраните изменения и закройте файл.
4. На экземпляре SQL Server откройте **диспетчер задач**. Перезагрузите службу **AzureWLBackupCoordinatorSvc**.<br/> <br/>
 Хотя этот метод помогает, если приложение резервного копирования потребляет много ресурсов, SQL Server [регулятора ресурсов](https://docs.microsoft.com/sql/relational-databases/resource-governor/resource-governor?view=sql-server-2017) — это более общий способ задать ограничения на объем ЦП, физических операций ввода-ВЫВОДА и памяти, который можно входящих запросов приложений используете.

> [!NOTE]
> UX по-прежнему можно пойти дальше и запланировать столько резервных копий в любой момент времени Однако они будут обрабатываться в скользящее окно, скажем, 5, для примера выше.

## <a name="can-i-run-a-full-backup-from-a-secondary-replica"></a>Можно ли запустить полное резервное копирование из вторичной реплики?
В соответствии с ограничениями SQL можно запустить копирование только полной резервной копии на вторичной реплике; Однако полное резервное копирование не допускается.

## <a name="can-i-protect-availability-groups-on-premises"></a>Защитить доступности группами локально?
№ Служба архивации Azure обеспечивает защиту баз данных SQL Server, работающих в Azure. Если группы доступности (AG) распределяется между Azure и локальными компьютерами, группы Доступности могут быть защищены только в том случае, если первичная реплика работает в Azure. Кроме того Azure Backup защищает только узлы, которые выполняются в том же регионе Azure, что и хранилище служб восстановления.

## <a name="can-i-protect-availability-groups-across-regions"></a>Может защищать группы доступности в нескольких регионах?
Хранилище служб восстановления Azure Backup можно обнаруживать и защищать все узлы, расположенные в том же регионе, что и хранилище. Если группы доступности SQL Server Always On охватывает несколько регионов Azure, настройте функцию архивирования из региона с основного узла. Azure Backup может обнаруживать и защищать все базы данных в группе доступности в соответствии с установленным параметром резервного копирования. Когда настроек резервного копирования не соблюдается, резервное копирование завершается сбоем, и вы получаете оповещение о сбое.

## <a name="do-successful-backup-jobs-create-alerts"></a>Отправляются ли оповещения об успешно выполненных заданиях резервного копирования?
Нет. Для успешно выполненных заданий резервного копирования не создаются оповещения. Оповещения отправляются только в случае сбоя. Описан подробно описывающие поведение для оповещений портала [здесь](backup-azure-monitoring-built-in-monitor.md). Тем не менее, если вы заинтересованы у оповещения даже для успешно выполненных заданий можно использовать [мониторинг с помощью Azure Monitor](backup-azure-monitoring-use-azuremonitor.md).

## <a name="can-i-see-scheduled-backup-jobs-in-the-backup-jobs-menu"></a>Можно просмотреть запланированные задания резервного копирования, в меню "задания резервного копирования"?
**Задание резервного копирования** меню будут отображаться только ad-hoc заданий резервного копирования. Для запланированного задания используйте [мониторинг с помощью Azure Monitor](backup-azure-monitoring-use-azuremonitor.md).

## <a name="are-future-databases-automatically-added-for-backup"></a>Добавляются ли автоматически будущие базы данных в резервное копирование?
Да, можно добиться эту возможность с помощью [автоматической защиты](backup-sql-server-database-azure-vms.md#enable-auto-protection).  

## <a name="if-i-delete-a-database-from-an-autoprotected-instance-what-will-happen-to-the-backups"></a>Если удалить базу данных из экземпляра autoprotected, что произойдет с резервные копии?
Если базы данных удаляется из экземпляра autoprotected, по-прежнему применяются резервные копии базы данных. Это означает, что удаленную базу данных начинается отображение неработоспособности в разделе **архивные элементы** и по-прежнему защищено.

Правильный способ остановить защиту этой базы данных — сделать **остановить архивацию** с **удаления данных** в этой базе данных.  

## <a name="if-i-do-stop-backup-operation-of-an-autoprotected-database-what-will-be-its-behavior"></a>Когда я останавливаю операции резервного копирования базы данных autoprotected каким будет ее поведение?
В этом случае **прекращение архивации с хранить данные**, дальнейшем архивные копии не будет выполняться, и существующие точки восстановления не будут затронуты. Базы данных по-прежнему рассматриваются как защищенный и отображается в поле **архивные элементы**.

В этом случае **прекращение архивации с удалением данных**, дальнейшем архивные копии не будет выполняться, и также будут удалены существующие точки восстановления. Базы данных будут считаться не защищенный и будут отображаться в экземпляре в Настройка резервного копирования. Тем не менее в отличие от других защищенных вверх баз данных, могут быть выбраны вручную или, можно получить autoprotected, эта база данных недоступен для выбора и не могут быть выбраны. Чтобы отключить автоматическую защиту на экземпляре является единственным способом заново защиту этой базы данных. Теперь можно выбрать эту базу данных и настроить защиту для его или включить автоматическую защиту в экземпляре.

## <a name="if-i-change-the-name-of-the-database-after-it-has-been-protected-what-will-be-the-behavior"></a>Если изменить имя базы данных после он был защищен, какими будут поведение?
Новое имя базы данных рассматривается как новую базу данных. Таким образом служба будет считать это база данных не найдены и не проходят резервные копии.

Вы можете выбрать базе, которая теперь будет переименован и настроить защиту на нем. В случае, если на экземпляре включена автоматическая защита, переименование базы данных будет автоматически обнаруживаются и защищены.

##  <a name="why-cant-i-see-an-added-database-for-an-autoprotected-instance"></a>Почему не дополнительной базы данных для экземпляра autoprotected?
Объект базы данных, которые [добавить в экземпляр autoprotected](backup-sql-server-database-azure-vms.md#enable-auto-protection) может не сразу появится в группе защищенных элементов. Это обусловлено тем, что обнаружение обычно выполняется раз в 8 часов. Тем не менее, можно обнаружить и защитить новые базы данных сразу же в том случае, если вы вручную запустить обнаружение, выбрав **восстановление баз данных SQL**, как показано на следующем рисунке.

  ![Обнаружить новые базы данных вручную](./media/backup-azure-sql-database/view-newly-added-database.png)


## <a name="next-steps"></a>Дальнейшие действия

Узнайте, как [резервное копирование базы данных SQL Server](backup-azure-sql-database.md) , на котором выполняется на виртуальной Машине Azure.
