---
title: Распространенные вопросы при резервном копировании файлов и папок с помощью Azure Backup
description: Здесь рассматриваются распространенные вопросы о резервном копировании файлов и папок с помощью Azure Backup.
author: dcurwin
manager: carmonm
ms.service: backup
ms.topic: conceptual
ms.date: 07/29/2019
ms.author: dacurwin
ms.openlocfilehash: 99f14b14e9149f79ae992834ae75bcb8fdc3c74b
ms.sourcegitcommit: 15f7b641a67f3d6cf4fb4b4c11eaee18cf335923
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/29/2019
ms.locfileid: "68601984"
---
# <a name="common-questions-about-backing-up-files-and-folders"></a>Распространенные вопросы о резервном копировании файлов и папок

Эта статья содержит ответы на часто задаваемые вопросы, SPFE резервное копирование файлов и папок с помощью агента Службы восстановления Microsoft Azure (MARS) в службе [Azure Backup](backup-overview.md) .

## <a name="general"></a>Общее

## <a name="configure-backups"></a>Настройка резервного копирования

### <a name="where-can-i-download-the-latest-version-of-the-mars-agent"></a>Где можно загрузить последнюю версию агента MARS?
Последний агент MARS, используемый при резервном копировании компьютеров Windows Server, System Center DPM и Microsoft Azure Backup Server, доступен для [загрузки](https://aka.ms/azurebackup_agent).

### <a name="how-long-are-vault-credentials-valid"></a>Как долго учетные данные хранилища действительны?
Учетные данные хранилища действительны в течение 48 часов. Если срок действия файла учетных данных истек, скачайте его еще раз из портал Azure.

### <a name="from-what-drives-can-i-back-up-files-and-folders"></a>С каких дисков можно создавать резервные копии файлов и папок?

Вы не можете создавать резервные копии дисков и томов следующих типов:

* Съемный носитель: Все источники для резервного копирования должны быть фиксированными.
* Тома только для чтения: Том должен быть доступным для записи, иначе служба теневого копирования томов (VSS) не будет работать.
* Автономные тома: Том должен быть доступным в сети, иначе служба VSS не будет работать.
* Общие сетевые папки: Том должен быть локальным томом сервера, иначе оперативное резервное копирование не будет выполняться.
* Тома, зашифрованные с помощью технологии Bitlocker: Для создания резервной копии том должен быть разблокирован.
* Идентификация файловой системы. Эта служба поддерживает только файловую систему NTFS.

### <a name="what-file-and-folder-types-are-supported"></a>Какие типы файлов и папок поддерживаются?

Дополнительные [сведения](backup-support-matrix-mars-agent.md#supported-file-types-for-backup) о типах файлов и папок, поддерживаемых для резервного копирования.

### <a name="can-i-use-the-mars-agent-to-back-up-files-and-folders-on-an-azure-vm"></a>Можно ли использовать агент MARS для резервного копирования файлов и папок на виртуальной машине Azure?  
Да. Azure Backup предоставляет резервное копирование на уровне ВИРТУАЛЬНОЙ машины для виртуальных машин Azure с помощью расширения виртуальной машины для агента виртуальной машины Azure. Если вы хотите создавать резервные копии файлов и папок в гостевой операционной системе Windows на виртуальной машине, можно установить агент MARS.

### <a name="can-i-use-the-mars-agent-to-back-up-files-and-folders-on-temporary-storage-for-the-azure-vm"></a>Можно ли использовать агент MARS для резервного копирования файлов и папок во временном хранилище для виртуальной машины Azure?
Да. Установите агент MARS и создайте резервные копии файлов и папок в гостевой операционной системе Windows во временном хранилище.

- Задания резервного копирования завершаются сбоем, когда данные временного хранилища очищаются.
- Если временные данные хранилища удалены, вы можете восстановить их только в энергонезависимом хранилище.

### <a name="how-do-i-register-a-server-to-another-region"></a>Разделы справки зарегистрировать сервер в другом регионе?

Данные резервного копирования отправляются в центр обработки данных хранилища, в котором зарегистрирован сервер. Самый простой способ изменить центр обработки данных — это удалить и переустановить агент, а затем зарегистрировать компьютер в новом хранилище в нужном регионе.

### <a name="does-the-mars-agent-support-windows-server-2012-deduplication"></a>Поддерживает ли агент MARS дедупликацию Windows Server 2012?
Да. Агент MARS преобразует дедупликацию данных в обычные данные при подготовке операции резервного копирования. Затем он оптимизирует данные для резервного копирования, шифрует данные, а затем отправляет зашифрованные данные в хранилище.

## <a name="manage-backups"></a>Управление резервными копиями

### <a name="what-happens-if-i-rename-a-windows-machine-configured-for-backup"></a>Что произойдет, если переименовать компьютер Windows, настроенный для архивации?

При переименовании компьютера Windows все настроенные в данный момент резервные копии останавливаются.

- Необходимо зарегистрировать новое имя компьютера в хранилище службы архивации.
- При регистрации нового имени в хранилище первая операция является *полной* резервной копией.
- Если необходимо восстановить данные из резервной копии в хранилище с прежним именем сервера, используйте параметр для восстановления в альтернативное расположение в мастере восстановления данных. [Узнайте больше](backup-azure-restore-windows-server.md#use-instant-restore-to-restore-data-to-an-alternate-machine).

### <a name="what-is-the-maximum-file-path-length-for-backup"></a>Какова максимальная длина пути к файлу для резервного копирования?
Агент MARS опирается на NTFS и использует спецификацию длины FilePath, ограниченную [API Windows](/windows/desktop/FileIO/naming-a-file#fully-qualified-vs-relative-paths). Если файлы, которые требуется защитить, длиннее допустимого значения, создайте резервную копию родительской папки или диска.  

### <a name="what-characters-are-allowed-in-file-paths"></a>Какие символы разрешены в путях к файлам?

Агент MARS использует NTFS и [поддерживает символы](/windows/desktop/FileIO/naming-a-file#naming-conventions) в именах и путях файлов.

### <a name="the-warning-azure-backups-have-not-been-configured-for-this-server-appears"></a>Появится предупреждение "служба архивации Azure не настроена для этого сервера".
Это предупреждение может появиться даже в том случае, если вы настроили политику архивации, если параметры расписания резервного копирования, хранящиеся на локальном сервере, не совпадают с параметрами, хранящимися в хранилище службы архивации.
- Если сервер или параметры восстановлены до известного состояния работоспособности, расписания резервного копирования могут стать несинхронизированными.
- Если вы получаете это предупреждение, [Настройте](backup-azure-manage-windows-server.md) политику архивации еще раз, а затем выполните резервное копирование по запросу, чтобы повторно синхронизировать локальный сервер с Azure.


## <a name="manage-the-backup-cache-folder"></a>Управление папкой кэша резервного копирования

### <a name="whats-the-minimum-size-requirement-for-the-cache-folder"></a>Каков минимальный необходимый размер папки кэша?
Размер папки кэша определяет объем данных, для которых выполняется резервное копирование.
- Тома в папке кэша должны иметь свободное место, равное по крайней мере 5-10% общего размера данных резервной копии.
- Если объем свободного места на томе меньше 5%, увеличьте размер тома или переместите папку кэша на том, где достаточно места.
- При резервном копировании состояния системы Windows потребуется дополнительно 30-35 ГБ свободного места в томе, содержащем папку кэша.

### <a name="how-to-check-if-scratch-folder-is-valid-and-accessible"></a>Как проверить, является ли папка временных файлов допустимой и доступной?

1. По умолчанию вспомогательная папка находится в папке`\Program Files\Microsoft Azure Recovery Services Agent\Scratch`
2. Убедитесь, что путь к расположению временной папки совпадает со значениями разделов реестра, показанными ниже:

  | Путь к элементу реестра | Ключ реестра | Значение |
  | --- | --- | --- |
  | `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\Config` |ScratchLocation |*Новое расположение папки кэша* |
  | `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\Config\CloudBackupProvider` |ScratchLocation |*Новое расположение папки кэша* |

### <a name="how-do-i-change-the-cache-location-for-the-mars-agent"></a>Разделы справки изменить расположение кэша для агента MARS?

1. Выполните эту команду в командной строке с повышенными привилегиями, чтобы отключить модуль резервного копирования:

    ```PS C:\> Net stop obengine```

2. Если вы настроили резервное копирование состояния системы, откройте оснастку "Управление дисками" и отключите диски с именами `"CBSSBVol_<ID>"`в формате.
3. Не переносите файлы. Вместо этого скопируйте папку пространства кэша на другой диск с достаточным объемом свободного места.
4. Обновите следующие записи реестра, указав путь к новой папке кэша.<br/>

    | Путь к элементу реестра | Ключ реестра | Значение |
    | --- | --- | --- |
    | `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\Config` |ScratchLocation |*Новое расположение папки кэша* |
    | `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\Config\CloudBackupProvider` |ScratchLocation |*Новое расположение папки кэша* |

5. Перезапустите модуль резервного копирования в командной строке с повышенными привилегиями:

    ```PS C:\> Net stop obengine```

    ```PS C:\> Net start obengine```

6. выполнение нерегламентированного резервного копирования. После успешного завершения резервного копирования в новом расположении можно удалить исходную папку кэша.


### <a name="where-should-the-cache-folder-be-located"></a>Где следует разместить папку кэша?

Для папки кэша не рекомендуется использовать следующие расположения:

* Сетевая папка или съемный носитель: Папка кэша должна быть локальной по отношению к серверу, для которого нужно выполнить резервное копирование с помощью оперативного резервного копирования. Сетевые расположения и съемные носители (например, USB-накопители) не поддерживаются.
* Автономные тома: Если планируется резервное копирование с помощью агента службы Azure Backup, папку кэша нужно подключить к сети.

### <a name="are-there-any-attributes-of-the-cache-folder-that-arent-supported"></a>Существуют ли какие либо атрибуты папки кэша, которые не поддерживаются?
Для папки кэша не поддерживаются следующие атрибуты и их комбинации:

* Зашифровано
* дедупликация;
* сжатые;
* Разреженный
* точка повторного анализа.

Папка кэша и метаданные виртуального жесткого диска не содержат нужных атрибутов для агента службы архивации Azure.

### <a name="is-there-a-way-to-adjust-the-amount-of-bandwidth-used-for-backup"></a>Существует ли способ настройки объема пропускной способности, используемой для резервного копирования?

Да, можно использовать параметр **изменить свойства** в АГЕНТе Mars, чтобы настроить пропускную способность и время. [Узнайте больше](backup-configure-vault.md#enable-network-throttling).

## <a name="restore"></a>Восстановление

### <a name="what-happens-if-i-cancel-an-ongoing-restore-job"></a>Что произойдет, если отменить выполняемое задание восстановления?

Если текущее задание восстановления отменяется, процесс восстановления останавливается. Все файлы, восстановленные до отмены, остаются в настроенном месте (исходное или альтернативное расположение) без каких-либо откатов.


## <a name="next-steps"></a>Следующие шаги

[Узнайте](tutorial-backup-windows-server-to-azure.md) , как создать резервную копию компьютера Windows.
