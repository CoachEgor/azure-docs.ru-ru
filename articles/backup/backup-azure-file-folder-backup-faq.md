---
title: Резервное копирование файлов и папок - общие вопросы
description: Ответы на распространенные вопросы о резервном копировании файлов и папок с помощью резервного копирования Azure.
ms.topic: conceptual
ms.date: 07/29/2019
ms.openlocfilehash: 55819ce7ec5196812d935a21c096c132144d78af
ms.sourcegitcommit: 7581df526837b1484de136cf6ae1560c21bf7e73
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/31/2020
ms.locfileid: "80421308"
---
# <a name="common-questions-about-backing-up-files-and-folders"></a>Общие вопросы о резервном копировании файлов и папок

В этой статье ответы на общие вопросы в изобилуют резервным копированием файлов и папок с агентом службы восстановления Microsoft Azure (MARS) в службе [резервного копирования Azure.](backup-overview.md)

## <a name="configure-backups"></a>Настройка резервного копирования.

### <a name="where-can-i-download-the-latest-version-of-the-mars-agent"></a>Где я могу скачать последнюю версию агента MARS?

Последний агент MARS, используемый при резервном копировании компьютеров Windows Server, System Center DPM и сервер резервного копирования Microsoft Azure, доступен для [скачивания.](https://aka.ms/azurebackup_agent)

### <a name="how-long-are-vault-credentials-valid"></a>Как долго действительны учетные данные хранилища?

Учетные данные хранилища действительны в течение 48 часов. Если срок действия файла учетных данных истекает, загрузите файл снова с портала Azure.

### <a name="from-what-drives-can-i-back-up-files-and-folders"></a>С каких дисков можно создать резервное копирование файлов и папок?

Вы не можете создать резервную копию следующих типов дисков и объемов:

* Съемные носители: Все источники резервного элемента должны сообщать как фиксированные.
* Только для чтения тома: Объем должен быть отwrable для службы копирования теней объема (VSS) для работы.
* Оффлайн объемы: Объем должен быть онлайн для VSS функционировать.
* Доли сети: Объем должен быть локальным для сервера, чтобы быть резервным с помощью онлайн резервного копирования.
* BitLocker защищенных томов: объем должен быть разблокирован до резервного копирования может произойти.
* Идентификация файловой системы. Эта служба поддерживает только файловую систему NTFS.

### <a name="what-file-and-folder-types-are-supported"></a>Какие типы файлов и папок поддерживаются?

[Узнайте больше](backup-support-matrix-mars-agent.md#supported-file-types-for-backup) о типах файлов и папок, поддерживаемых для резервного копирования.

### <a name="can-i-use-the-mars-agent-to-back-up-files-and-folders-on-an-azure-vm"></a>Могу ли я использовать агент MARS для резервного копирования файлов и папок на Azure VM?  

Да. Резервное копирование Azure обеспечивает резервное копирование VM-уровня для VMs Azure с использованием расширения VM для агента Azure VM. Если вы хотите создать резервную папку и папки на гостевой операционной системе Windows на VM, вы можете установить для этого агент MARS.

### <a name="can-i-use-the-mars-agent-to-back-up-files-and-folders-on-temporary-storage-for-the-azure-vm"></a>Могу ли я использовать агент MARS для резервного копирования файлов и папок на временном хранении для Azure VM?

Да. Установите агент MARS и резервное копирование файлов и папок на гостевой операционной системе Windows во временное хранилище.

* Задания резервного копирования выводятся из строя при уничтожении данных временного хранилища.
* Если данные временного хранилища удалены, можно восстановить их только в нелетучие хранилища.

### <a name="how-do-i-register-a-server-to-another-region"></a>Как зарегистрировать сервер в другом регионе?

Данные резервного копирования отправляются в центр обработки данных хранилища, в котором зарегистрирован сервер. Самый простой способ изменить центр обработки данных — удалить и переустановить агент, а затем зарегистрировать машину в новом хранилище в необходимом регионе.

### <a name="does-the-mars-agent-support-windows-server-2012-deduplication"></a>Поддерживает ли агент MARS dedupliclication Windows Server 2012?

Да. Агент MARS преобразует дубликатные данные в обычные данные при подготовке операции резервного копирования. Затем он оптимизирует данные для резервного копирования, шифрует данные, а затем отправляет зашифрованные данные в хранилище.

### <a name="do-i-need-administrator-permissions-to-install-and-configure-the-mars-agent"></a>Нужны ли разрешения администратора для установки и настройки агента MARS?

Да, установка агента MARS и конфигурация резервных данных с помощью консоли MARS должны быть локальным администратором на защищенном сервере.

## <a name="manage-backups"></a>Управление резервными копиями

### <a name="what-happens-if-i-rename-a-windows-machine-configured-for-backup"></a>Что произойдет, если я переименую машину Windows, настроенную для резервного копирования?

При переименовании машины Windows все настроенные резервные отстаи в настоящее время прекращаются.

* Необходимо зарегистрировать новое имя машины в хранилище резервного копирования.
* При регистрации нового имени в хранилище первой операцией является *полное* резервное копирование.
* Если необходимо восстановить данные, резервные в хранилище со старым именем сервера, используйте опцию для восстановления в альтернативном местоположении в мастере данных восстановления. [Подробнее](backup-azure-restore-windows-server.md#use-instant-restore-to-restore-data-to-an-alternate-machine).

### <a name="what-is-the-maximum-file-path-length-for-backup"></a>Какова максимальная длина длины длины файла для резервного копирования?

Агент MARS полагается на NTFS и использует спецификацию длины файла, ограниченную [API Windows.](/windows/desktop/FileIO/naming-a-file#fully-qualified-vs-relative-paths) Если файлы, которые вы хотите защитить, длиннее разрешенного значения, резервное копирование родительской папки или диска.  

### <a name="what-characters-are-allowed-in-file-paths"></a>Какие символы разрешены в файловых путях?

Агент MARS полагается на NTFS и позволяет [поддерживать символы](/windows/desktop/FileIO/naming-a-file#naming-conventions) в именах/путях файлов.

### <a name="the-warning-azure-backups-have-not-been-configured-for-this-server-appears"></a>Появляется предупреждение "Резервное копирование Azure не настроено для этого сервера"

Это предупреждение может отображаться даже при настройке политики резервного копирования, когда параметры резервного расписания, хранящиеся на локальном сервере, не совпадают с настройками, хранящимися в хранилище резервного копирования.

* Когда сервер или настройки были восстановлены в известном хорошем состоянии, графики резервного копирования могут стать несинхронизированными.
* Если вы получили это предупреждение, [наверсните](backup-azure-manage-windows-server.md) политику резервного копирования снова, а затем запустите резервную по требованию резервную систему для ресинхронизации локального сервера с Azure.

## <a name="manage-the-backup-cache-folder"></a>Управление папкой кэша резервного копирования

### <a name="whats-the-minimum-size-requirement-for-the-cache-folder"></a>Каков минимальный необходимый размер папки кэша?

Размер папки кэша определяет объем данных, для которых выполняется резервное копирование.

* Объемы папки кэша должны иметь свободное пространство, равное не менее 5-10% от общего размера данных резервного копирования.
* Если объем имеет менее 5% свободного пространства, либо увеличить размер громкости, или переместить папку кэша в объем с достаточным пространством, выследуя [эти шаги.](#how-do-i-change-the-cache-location-for-the-mars-agent)
* При резервном копировании windows System State вам потребуется дополнительно 30-35 ГБ свободного пространства в томе, содержащем папку кэша.

### <a name="how-to-check-if-scratch-folder-is-valid-and-accessible"></a>Как проверить, действительна ли и доступна папка «Скретч»?

1. По умолчанию папка царапина находится на`\Program Files\Microsoft Azure Recovery Services Agent\Scratch`
2. Убедитесь, что путь вашей папки царапин совпадает со значениями ключевых записей реестра, показанных ниже:

    | Путь к элементу реестра | Ключ реестра | Значение |
    | --- | --- | --- |
    | `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\Config` |ScratchLocation |*Новое расположение папки кэша* |
    | `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\Config\CloudBackupProvider` |ScratchLocation |*Новое расположение папки кэша* |

### <a name="how-do-i-change-the-cache-location-for-the-mars-agent"></a>Как изменить местоположение кэша для агента MARS?

1. Запустите эту команду в поднятом запросе команды, чтобы остановить движок резервного копирования:

    ```Net stop obengine```
2. Если вы настроили резервное копирование системного состояния, откройте управление диском и отразите диск (ы) с именами в формате. `"CBSSBVol_<ID>"`
3. По умолчанию папка с нуля расположена по адресу`\Program Files\Microsoft Azure Recovery Services Agent\Scratch`
4. Копируйте `\Scratch` всю папку на другой диск, в которых достаточно места. Убедитесь, что содержимое скопировано, а не перемещено.
5. Обновление следующих записей реестра с пути вновь переехал нуля папки.

    | Путь к элементу реестра | Ключ реестра | Значение |
    | --- | --- | --- |
    | `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\Config` |ScratchLocation |*Местоположение новой папки царапин* |
    | `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\Config\CloudBackupProvider` |ScratchLocation |*Местоположение новой папки царапин* |

6. Перезапустите движок резервного копирования с повышенной командой:

    ```command
    Net stop obengine

    Net start obengine
    ```

7. выполнение резервного копирования по требованию. После успешного завершения резервной копирования с новым местоположением можно удалить исходную папку кэша.

### <a name="where-should-the-cache-folder-be-located"></a>Где должна быть размещена папка кэша?

Следующие местоположения папки кэша не рекомендуется:

* Доля сети/съемные носители: папка кэша должна быть локальной для сервера, который нуждается в резервном копировании с помощью резервного копирования в Режиме онлайн. Места расположения сети или съемные носители, такие как USB-накопители, не поддерживаются.
* Объемы в автономном режиме: папка кэша должна быть в режиме онлайн для ожидаемого резервного копирования с помощью резервного агента Azure

### <a name="are-there-any-attributes-of-the-cache-folder-that-arent-supported"></a>Существуют ли атрибуты папки кэша, которые не поддерживаются?

Для папки кэша не поддерживаются следующие атрибуты и их комбинации:

* зашифрованные;
* дедупликация;
* Compressed
* разреженные;
* точка повторного анализа.

Папка кэша и метаданные VHD не имеют необходимых атрибутов для агента резервного копирования Azure.

### <a name="is-there-a-way-to-adjust-the-amount-of-bandwidth-used-for-backup"></a>Есть ли способ скорректировать объем пропускной способности, используемой для резервного копирования?

Да, вы можете использовать опцию **Change Properties** в агенте MARS для настройки пропускной способности и времени. [Подробнее](backup-windows-with-mars-agent.md#enable-network-throttling).

## <a name="restore"></a>Восстановить

### <a name="manage"></a>Управление

**Могу ли я восстановиться, если забыл пароль?**
Агент урезервного копирования Azure требует парольную фразу (предоставленную во время регистрации) для расшифровки резервных данных во время восстановления. Просмотрите сценарии ниже, чтобы понять ваши варианты обработки потерянной фразы:

| Оригинальная машина <br> *(источник машины, где были приняты резервные копирования)* | Парольная фраза | Доступные параметры |
| --- | --- | --- |
| Доступно |Lost |Если ваша оригинальная машина (где были приняты резервные копирования) доступна и по-прежнему зарегистрирована в том же хранилище служб восстановления, то вы можете регенерировать пароль, выполнив следующие [следующие шаги.](https://docs.microsoft.com/azure/backup/backup-azure-manage-mars#re-generate-passphrase)  |
| Lost |Lost |Невозможно восстановить данные или данные недоступны |

Проверьте следующее:

* Если вы удалите и перерегистрируете агента на той же оригинальной машине с
  * *Та же фраза,* то вы сможете восстановить ваши резервные данные.
  * *Различные пароли,* то вы не сможете восстановить резервные данные.
* Если вы установите агент на *другой машине* с
  * *Та же фраза* (используется в оригинальной машине), то вы сможете восстановить ваши резервные данные.
  * *Различные пароли,* вы не сможете восстановить резервные данные.
* Если исходная машина повреждена (не позволяет восстановить пароль через консоль MARS), но вы можете восстановить или получить доступ к исходной папке царапин, используемой агентом MARS, то вы можете восстановить (если вы забыли пароль). Для получения дополнительной помощи обратитесь в службу поддержки клиентов.

**Как восстановиться, если я потерял исходную машину (где были взяты резервные копирования)?**

Если у вас есть та же фраза (которую вы предоставили во время регистрации) оригинальной машины, то вы можете восстановить резервные данные на альтернативную машину. Просмотрите сценарии ниже, чтобы понять параметры восстановления.

| Оригинальная машина | Парольная фраза | Доступные параметры |
| --- | --- | --- |
| Lost |Доступно |Вы можете установить и зарегистрировать агент MARS на другой машине с той же фразой, которую вы предоставили во время регистрации оригинальной машины. Выберите **вариант** > восстановления**Другое место** для выполнения восстановления. Для получения дополнительной информации смотрите эту [статью](https://docs.microsoft.com/azure/backup/backup-azure-restore-windows-server#use-instant-restore-to-restore-data-to-an-alternate-machine).
| Lost |Lost |Невозможно восстановить данные или данные недоступны |


### <a name="what-happens-if-i-cancel-an-ongoing-restore-job"></a>Что произойдет, если отменить выполняемое задание восстановления?

Если работа восстановления отменяется, процесс восстановления прекращается. Все файлы, восстановленные до отмены, остаются в настроенном пункте назначения (первоначальное или альтернативное местоположение) без откатов.

### <a name="does-the-mars-agent-back-up-and-restore-acls-set-on-files-folders-and-volumes"></a>Ли агент MARS резервное копирование и восстановление ACLs, установленных на файлах, папках и объемах?

* Агент MARS резервное копирование ACLs, установленных на файлах, папках и объемах
* Для опции восстановления восстановления объема агент MARS предоставляет возможность пропуска восстановления разрешений ACL в восстановленном файле или папке
* Для опции восстановления отдельных файлов и папок агент MARS восстановит с разрешениями ACL (нет возможности пропустить восстановление ACL).

## <a name="next-steps"></a>Следующие шаги

[Узнайте,](tutorial-backup-windows-server-to-azure.md) как создать резервную настройку компьютера Windows.
