---
title: Архивация SQL Server в Azure с помощью рабочей нагрузки DPM
description: Введение в резервное копирование баз данных сервера S'L с помощью службы резервного копирования Azure
ms.topic: conceptual
ms.date: 01/30/2019
ms.openlocfilehash: 8cbb8c833bc2933afac300bcc848fd50861011d0
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "77505934"
---
# <a name="back-up-sql-server-to-azure-as-a-dpm-workload"></a>Архивация SQL Server в Azure с помощью рабочей нагрузки DPM

Эта статья позволяет вам пройти через шаги конфигурации для резервного копирования баз данных сервера СЗЛ с помощью резервного копирования Azure.

Чтобы создать резервные копии баз данных SQL Server в Azure, необходима учетная запись Azure. Если у вас его нет, вы можете создать бесплатную учетную запись всего за несколько минут. Для получения дополнительной информации [см.](https://azure.microsoft.com/pricing/free-trial/)

Для резервного копирования базы данных сервера S'L в Azure и ее восстановления из Azure:

1. Создайте политику резервного копирования для защиты баз данных серверов S'L В Azure.
1. Создавайте резервные копии по требованию в Azure.
1. Восстановление базы данных из Azure.

## <a name="before-you-start"></a>Перед началом работы

Перед началом работы убедитесь, что вы [выполнили предпосылок](backup-azure-dpm-introduction.md#prerequisites-and-limitations) для использования резервного копирования Azure для защиты рабочих нагрузок. Вот некоторые из предварительных задач: 
* Создайте резервное хранилище.
* Скачать учетные данные хранилища. 
* Установите резервный агент Azure.
* Зарегистрируйте сервер с хранилищем.

## <a name="create-a-backup-policy"></a>создание политики архивации; 

Для защиты баз данных сервера S'L в Azure сначала создайте политику резервного копирования:

1. На сервере Manager Protection Manager (DPM) выберите рабочее пространство **защиты.**
1. Выберите **новый** для создания группы защиты.

    ![Создайте группу защиты](./media/backup-azure-backup-sql/protection-group.png)
1. На начальной странице просмотрите рекомендации о создании группы защиты. Затем выберите **Следующий**.
1. Выберите **Серверы**.

    ![Выберите тип группы защиты серверов](./media/backup-azure-backup-sql/pg-servers.png)
1. Расширьте машину сервера S'L, где находятся базы данных, которые вы хотите создать резервную базу. Вы видите источники данных, которые могут быть резервируются с этого сервера. Расширяйте **все акции S'L,** а затем выберите базы данных, которые вы хотите создать резервную базу данных. В этом примере мы выбираем ReportServer$MSDPM2012 и ReportServer$MSDPM2012TempDB. Затем выберите **Следующий**.

    ![Выберите базу данных сервера S'L](./media/backup-azure-backup-sql/pg-databases.png)
1. Назовите группу защиты, а затем выберите **Я хочу онлайн-защиты**.

    ![Выберите метод защиты данных - краткосрочная защита диска или онлайн-защита Azure](./media/backup-azure-backup-sql/pg-name.png)
1. На странице **«Указанные краткосрочные цели»** включите необходимые входные данные для создания резервных точек на диске.

    В этом примере **диапазон удержания** установлен до *5 дней.* **Частота синхронизации** резервного копирования устанавливается один раз в *15 минут.* **Экспресс Полное резервное копирование** установлен на *8:00 вечера*.

    ![Настройка краткосрочных целей для защиты резервного копирования](./media/backup-azure-backup-sql/pg-shortterm.png)

   > [!NOTE]
   > В этом примере точка резервного копирования создается в 8:00 вечера каждый день. Данные, которые были изменены с момента резервной точки предыдущего дня в 8:00 вечера, передаются. Этот процесс называется **быстрой полной архивацией**. Хотя журналы транзакций синхронизируются каждые 15 минут, если нам нужно восстановить базу данных в 21:00, то точка создается путем воспроизведения журналов из последней точки полного резервного копирования, которая в данном примере составляет 8:00 вечера.
   >
   >

1. Нажмите кнопку **Далее**. DPM показывает общее доступное пространство для хранения. Он также показывает потенциальное использование дискового пространства.

    ![Настройка распределения дисков](./media/backup-azure-backup-sql/pg-storage.png)

    По умолчанию DPM создает один том на источник данных (база данных Сервера S'L). Объем используется для первоначальной резервной копии. В этой конфигурации Logical Disk Manager (LDM) ограничивает защиту DPM 300 источниками данных (базы данных сервера S'L). Чтобы обойти это ограничение, выберите **Выравнивать данные в пуле носителей DPM**. При использовании этой опции DPM использует один том для нескольких источников данных. Эта настройка позволяет DPM защищать до 2000 баз данных сервера S'L.

    Если вы **выберете Автоматически увеличить объемы,** то DPM может учитывать увеличенный объем резервного копирования по мере роста производственных данных. Если вы не выберете **автоматически увеличить объемы,** то DPM ограничивает хранение резервного копирования для источников данных в группе защиты.

1. Если вы администратор, вы можете автоматически перенести эту резервную перепорку **по сети** и выбрать время передачи. Или выберите **вручную** передать резервную. Затем выберите **Следующий**.

    ![Выберите метод создания реплики](./media/backup-azure-backup-sql/pg-manual.png)

    Первоначальная копия резервного копирования требует передачи всего источника данных (база данных сервера S'L). Данные резервного копирования перемещаются с производственного сервера (машина сервера S'L) на сервер DPM. Если это резервное копирование является большим, то передача данных по сети может привести к перегрузке пропускной способности. По этой причине администраторы могут использовать съемные носители для передачи исходного резервного копирования **вручную.** Или они могут передавать данные **автоматически по сети** в указанное время.

    После завершения первоначальной резервной копии резервные копии продолжаются постепенно на исходной копии резервного копирования. Обычно добавочные резервные копии имеют небольшой размер и могут быть легко переданы по сети.
    
1. Выберите, когда для запуска проверки согласованности. Затем выберите **Следующий**.

    ![Выберите, когда для проверки согласованности](./media/backup-azure-backup-sql/pg-consistent.png)

    DPM может выполнить проверку согласованности целостности точки резервного копирования. Он вычисляет чековую копию файла на производственном сервере (машина сервера s'L в данном примере) и резервные данные для этого файла в DPM. Если проверка обнаруживает конфликт, то резервный файл в DPM считается поврежденным. DPM фиксирует резервные данные, отправляя блоки, соответствующие несоответствию чексуму. Поскольку проверка согласованности является операцией, интенсивной для выполнения, администраторы могут запланировать проверку согласованности или запустить ее автоматически.

1. Выберите источники данных для защиты в Azure. Затем выберите **Следующий**.

    ![Выберите источники данных для защиты в Azure](./media/backup-azure-backup-sql/pg-sqldatabases.png)
1. Если вы администратор, вы можете выбрать графики резервного копирования и политики удержания, которые соответствуют политикам вашей организации.

    ![Выберите графики и политики удержания](./media/backup-azure-backup-sql/pg-schedule.png)

    В этом примере резервные копирования принимаются ежедневно в 12:00 и 20:00.

    > [!TIP]
    > Для быстрого восстановления держите несколько краткосрочных точек восстановления на диске. Эти точки восстановления используются для оперативного восстановления. Azure служит хорошим расположением на месте, обеспечивая более высокие SLAs и гарантированную доступность.
    >
    > Используйте DPM для планирования резервных upups Azure после завершения локального резервного копирования диска. При следовании этой практике последняя резервная копия диска копируется в Azure.
    >

1. Выберите расписание для политики хранения. Для получения дополнительной информации о том, как работает политика удержания, [см.](backup-azure-backup-cloud-as-tape.md)

    ![Выберите политику удержания](./media/backup-azure-backup-sql/pg-retentionschedule.png)

    В этом примере:

    * Резервное копирование принимается ежедневно в 12:00 и 20:00. Они прохранятся 180 дней.
    * Резервное копирование в субботу в 12:00 вечера хранится в течение 104 недель.
    * Резервное копирование с последней субботы месяца в 12:00 вечера хранится в течение 60 месяцев.
    * Резервное копирование с последней субботы марта в 12:00 вечера сохраняется в течение 10 лет.
    
    После выбора политики удержания выберите **следующий**.

1. Выберите, как перенести начальную копию резервного копирования в Azure.

    * **Опция Автоматически по сети** следует графику резервного копирования для передачи данных в Azure.
    * Для получения дополнительной информации о **автономном резервном копировании**см. [Overview of Offline Backup](offline-backup-overview.md)

    После выбора механизма передачи выберите **Следующий**.

1. На странице **Резюме** просмотрите сведения о политике. Затем выберите **Группу Создания**. Вы можете выбрать **Close** и наблюдать за ходом выполнения заданий в рабочей области **мониторинга.**

    ![Прогресс создания группы защиты](./media/backup-azure-backup-sql/pg-summary.png)

## <a name="create-on-demand-backup-copies-of-a-sql-server-database"></a>Создание резервных копий базы данных сервера по требованию

Точка восстановления создается при возникновении первого резервного копирования. Вместо того, чтобы ждать выполнения расписания, можно вручную запустить точку восстановления:

1. В группе защиты убедитесь, что статус базы данных **в порядке.**

    ![Группа защиты, показывающая состояние базы данных](./media/backup-azure-backup-sql/sqlbackup-recoverypoint.png)
1. Нажмите правой кнопкой мыши на базу данных, а затем выберите **Создать точку восстановления.**

    ![Выберите для создания точки восстановления онлайн](./media/backup-azure-backup-sql/sqlbackup-createrp.png)
1. В выпадающем меню выберите **защиту в Интернете.** Затем выберите **OK,** чтобы начать создание точки восстановления в Azure.

    ![Начать создание точки восстановления в Azure](./media/backup-azure-backup-sql/sqlbackup-azure.png)
1. Можно просмотреть ход выполнения заданий в рабочей области **мониторинга.**

    ![Просмотр выполнения работ в консоли мониторинга](./media/backup-azure-backup-sql/sqlbackup-monitoring.png)

## <a name="recover-a-sql-server-database-from-azure"></a>Восстановление базы данных SQL Server из Azure

Для восстановления защищенной сущности, например базы данных сервера S'L, из Azure:

1. Откройте консоль управления сервером DPM. Перейдите в рабочее пространство **восстановления,** чтобы увидеть серверы, которые DPM резервное копирование. Выберите базу данных (в этом примере ReportServer$MSDPM2012). Выберите **время восстановления,** которое заканчивается **онлайн**.

    ![выбора точки восстановления](./media/backup-azure-backup-sql/sqlbackup-restorepoint.png)
1. Нажмите правой кнопкой мыши на имя базы данных и выберите **Восстановление**.

    ![Восстановление базы данных из Azure](./media/backup-azure-backup-sql/sqlbackup-recover.png)
1. DPM отобразит сведения о точке восстановления. Нажмите кнопку **Далее**. Чтобы перезаписать базу данных, выберите тип восстановления **Восстановить в исходном экземпляре SQL Server**. Затем выберите **Следующий**.

    ![Восстановление базы данных в исходное местоположение](./media/backup-azure-backup-sql/sqlbackup-recoveroriginal.png)

    В этом примере DPM позволяет восстановить базу данных в другой экземпляр S'L Server или в автономную сетевую папку.
1. На странице **«Параметры восстановления уточнения»** можно выбрать параметры восстановления. Например, можно выбрать **регулирование пропускной способности сети,** чтобы задушить пропускную способность, которую использует восстановление. Затем выберите **Следующий**.
1. На странице **Резюме** вы видите текущую конфигурацию восстановления. Выберите **Восстановление**.

    Состояние восстановления показывает восстановление базы данных. Можно выбрать **Close,** чтобы закрыть мастера и просмотреть ход работы в рабочей области **мониторинга.**

    ![Начало процесса восстановления](./media/backup-azure-backup-sql/sqlbackup-recoverying.png)

    По завершении восстановления восстановленная база данных согласуется с приложением.

## <a name="next-steps"></a>Дальнейшие действия

Для получения дополнительной [Azure Backup FAQ](backup-azure-backup-faq.md)информации см.
