---
title: Переход на управление доступом на основе ролей в Azure | Документация Майкрософт
description: Узнайте, как выполнять миграцию из политик доступа к хранилищу в роли Azure.
services: key-vault
author: msmbaldwin
manager: rkarlin
ms.service: key-vault
ms.subservice: general
ms.topic: how-to
ms.date: 8/30/2020
ms.author: mbaldwin
ms.openlocfilehash: e06a7a759c712b47f3a725a3c49a660226da6a09
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "90064197"
---
# <a name="migrate-from-vault-access-policy-to-an-azure-role-based-access-control-preview-permission-model"></a>Миграция из политики доступа к хранилищу в модель разрешения управления доступом на основе ролей Azure (Предварительная версия)

Модель политики доступа к хранилищу — это существующая система авторизации, встроенная в Key Vault для предоставления доступа к ключам, секретам и сертификатам. Вы можете управлять доступом, назначив отдельные разрешения участнику безопасности (пользователю, группе, субъекту-службе, управляемому удостоверению) в области Key Vault. 

Управление доступом на основе ролей в Azure (Azure RBAC) — это система авторизации, основанная на [Azure Resource Manager](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-overview) , которая обеспечивает детальное управление доступом к ресурсам Azure. Azure RBAC для Key Vault ключей, секретов и управления доступом к сертификатам в настоящее время находится в общедоступной предварительной версии. С помощью Azure RBAC вы управляете доступом к ресурсам, создавая назначения ролей, которые состоят из трех элементов: субъект безопасности, определение роли (предопределенный набор разрешений) и область (Группа ресурсов или отдельного ресурса). Дополнительные сведения см. в статье [Управление доступом на основе ролей в Azure (Azure RBAC)](https://docs.microsoft.com/azure/role-based-access-control/overview).

Прежде чем переходить на Azure RBAC, важно понимать его преимущества и ограничения.

Преимущества ключей Azure RBAC при работе с политиками доступа к хранилищу:
- Предоставляет унифицированную модель управления доступом для ресурсов Azure — один API для разных служб Azure.
- Централизованное управление доступом для администраторов — управление всеми ресурсами Azure в одном представлении
- Интеграция с [Управление привилегированными пользователями](../../active-directory/privileged-identity-management/pim-configure.md) для контроля доступа на основе времени
- Запрет назначений — возможность исключения субъекта безопасности в определенной области. Дополнительные сведения см. в статье о [назначении Deny в Azure](https://docs.microsoft.com/azure/role-based-access-control/deny-assignments) .

Недостатки Azure RBAC:
- Задержка для назначений ролей — для применения назначения ролей может потребоваться несколько минут. Политики доступа к хранилищу назначаются мгновенно.
- Ограниченное число назначений ролей — 2000. назначения ролей для подписки и 1024 политики доступа на Key Vault

## <a name="access-policies-to-azure-roles-mapping"></a>Доступ к политикам для сопоставления ролей Azure

В Azure RBAC есть несколько встроенных ролей Azure, которые можно назначить пользователям, группам, субъектам-службам и управляемым удостоверениям. Если встроенные роли не соответствуют потребностям вашей организации, вы можете создать собственные [настраиваемые роли Azure](https://docs.microsoft.com/azure/role-based-access-control/custom-roles).

Key Vault встроенные роли для управления доступом к ключам, сертификатам и секретам:
- Администратор Key Vault (Предварительная версия)
- Читатель Key Vault (Предварительная версия)
- Директор по сертификатам Key Vault (Предварительная версия)
- Key Vaultный директор по шифрованию (Предварительная версия)
- Пользователь Key Vault шифрования (Предварительная версия)
- Директор Key Vault секреты (Предварительная версия)
- Key Vault секреты пользователя (Предварительная версия)

Дополнительные сведения о существующих встроенных ролях см. в статье [встроенные роли Azure](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles) .

Политики доступа к хранилищу можно назначать с помощью отдельных выбранных разрешений или с предопределенными шаблонами разрешений.

Стандартные шаблоны разрешений для политик доступа:
- Ключ, секрет, Управление сертификатами
- Управление секретами с ключом &
- Управление сертификатами секрета &
- Управление ключами
- Управление секретами
- Управление сертификатами
- Соединитель SQL Server
- Azure Data Lake Storage или служба хранилища Azure
- Azure Backup
- Ключ клиента Exchange Online
- Ключ клиента SharePoint Online
- Azure Information BYOK

### <a name="access-policies-templates-to-azure-roles-mapping"></a>Доступ к шаблонам политик для сопоставления ролей Azure
| Шаблон политики доступа | Операции | Роль Azure |
| --- | --- | --- |
| Ключ, секрет, Управление сертификатами | Ключи: все операции <br>Сертификаты: все операции<br>Секреты: все операции | Администратор Key Vault (Предварительная версия) |
| Управление секретами с ключом & | Ключи: все операции <br>Секреты: все операции| Key Vaultный директор по шифрованию (Предварительная версия)<br> Директор Key Vault секреты (Предварительная версия)|
| Управление сертификатами секрета & | Сертификаты: все операции <br>Секреты: все операции| Директор Key Vault Certificates (Предварительная версия)<br> Директор Key Vault секреты (Предварительная версия)|
| Управление ключами | Ключи: все операции| Key Vaultный директор по шифрованию (Предварительная версия)|
| Управление секретами | Секреты: все операции| Директор Key Vault секреты (Предварительная версия)|
| Управление сертификатами | Сертификаты: все операции | Директор Key Vault Certificates (Предварительная версия)|
| Соединитель SQL Server | Ключи: получение, перечисление, ключ переноса, ключ распаковки | Шифрование службы шифрования Key Vault (Предварительная версия)|
| Azure Data Lake Storage или служба хранилища Azure | Ключи: получение, перечисление, распаковка ключа | Недоступно<br> Требуется настраиваемая роль|
| Azure Backup | Ключи: получение, перечисление, резервное копирование<br> Сертификат: получение, перечисление, резервное копирование | Недоступно<br> Требуется настраиваемая роль|
| Ключ клиента Exchange Online | Ключи: получение, перечисление, ключ переноса, ключ распаковки | Шифрование службы шифрования Key Vault (Предварительная версия)|
| Ключ клиента Exchange Online | Ключи: получение, перечисление, ключ переноса, ключ распаковки | Шифрование службы шифрования Key Vault (Предварительная версия)|
| Azure Information BYOK | Ключи: получение, расшифровка, подпись | Недоступно<br>Требуется настраиваемая роль|


## <a name="assignment-scopes-mapping"></a>Сопоставление областей назначения  

Azure RBAC для Key Vault позволяет назначать роли в следующих областях:
- группа управления;
- Подписка
- Группа ресурсов
- Ресурс Key Vault
- Индивидуальный ключ, секрет и сертификат

Модель разрешений политики доступа к хранилищу ограничена присваиванием политики только на уровне ресурсов Key Vault. 

Как правило, рекомендуется использовать одно хранилище ключей на каждое приложение и управлять доступом на уровне хранилища ключей. Существуют сценарии, при которых Управление доступом в других областях может упростить управление доступом.

- * * Инфраструктура, администраторы безопасности и операторы: Управление группой хранилищ ключей на уровне группы управления, подписки или группы ресурсов с политиками доступа к хранилищу требует поддержки политик для каждого хранилища ключей. Azure RBAC позволяет создавать одно назначение ролей в группе управления, подписке или группе ресурсов. Это назначение будет применяться ко всем новым хранилищам ключей, созданным в той же области. В этом сценарии рекомендуется использовать управление привилегированными пользователями с JIT-доступом по обеспечению постоянного доступа.
 
- * * Приложения. Существуют сценарии, когда приложению требуется поделиться секретом с другим приложением. Чтобы избежать предоставления доступа ко всем секретам, необходимо создать хранилище ключей с помощью политик доступа к хранилищу. Azure RBAC позволяет назначать роли с областью действия для отдельного секрета с помощью одного хранилища ключей.

## <a name="vault-access-policy-to-azure-rbac-migration-steps"></a>Действия по миграции политик доступа к хранилищу для Azure RBAC
Между Azure RBAC и моделью разрешений политики доступа к хранилищу существует много различий. Чтобы избежать сбоев во время миграции, рекомендуется выполнить указанные ниже действия.
 
1. **Выявление и назначение ролей**. Укажите встроенные роли на основе таблицы сопоставления выше и при необходимости создайте пользовательские роли. Назначение ролей в областях на основе руководства по сопоставлению областей. Дополнительные сведения о назначении ролей для хранилища ключей см. в статье [предоставление доступа к Key Vault с помощью управления доступом на основе ролей Azure (Предварительная версия)](rbac-guide.md) .
1. **Проверка назначения ролей**. распространение ролей в Azure RBAC может занять несколько минут. Инструкции по проверке назначений ролей см. в разделе [список назначений ролей в области](https://docs.microsoft.com/azure/role-based-access-control/role-assignments-list-portal#list-role-assignments-for-a-user-at-a-scope) .
1. **Настройка мониторинга и оповещений в хранилище ключей**. важно включить ведение журнала и настройку оповещений для исключений, запрещенных в доступе. Дополнительные сведения см. в разделе [мониторинг и оповещения для Azure Key Vault](https://docs.microsoft.com/azure/key-vault/general/alert)
1. **Настройка модели разрешений управления доступом на основе ролей Azure на Key Vault**. Включение модели разрешений Azure RBAC сделает недействительными все существующие политики доступа. При возникновении ошибки модель разрешений можно переключить обратно, при этом все существующие политики доступа остаются нетронутыми.

> [!NOTE]
> Если включена модель разрешений Azure RBAC, все скрипты, которые пытаются обновить политики доступа, завершатся ошибкой. Важно обновить эти скрипты, чтобы использовать Azure RBAC.

## <a name="troubleshooting"></a>Устранение неполадок
-  Назначение ролей не работает через несколько минут. Существуют ситуации, когда назначение ролей может занять больше времени. Важно написать логику повторных попыток в коде, чтобы охватить эти случаи.
- Назначения ролей исчезают, когда Key Vault были удалены (обратимое удаление) и восстановлены. сейчас это ограничение функции обратимого удаления во всех службах Azure. После восстановления необходимо повторно создать все назначения ролей.    

## <a name="learn-more"></a>Дополнительные сведения

- [Обзор Azure RBAC](https://docs.microsoft.com/azure/role-based-access-control/overview)
- [Учебник по настраиваемым ролям](https://docs.microsoft.com/azure/role-based-access-control/tutorial-custom-role-cli)
- [Управление привилегированными пользователями](../../active-directory/privileged-identity-management/pim-configure.md)
