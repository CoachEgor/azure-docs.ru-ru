---
title: Мониторинг и оповещение ОПовании ключей Azure Vault Документы Майкрософт
description: Создайте панель мониторинга работоспособности хранилища ключей и настройки оповещений.
services: key-vault
author: ShaneBala-keyvault
manager: ravijan
tags: azure-resource-manager
ms.service: key-vault
ms.subservice: general
ms.topic: conceptual
ms.date: 04/06/2020
ms.author: sudbalas
Customer intent: As a key vault administrator, I want to learn the options available to monitor the health of my vaults
ms.openlocfilehash: cc0d969ff6eb76732768dfed2826762920ae9e62
ms.sourcegitcommit: acb82fc770128234f2e9222939826e3ade3a2a28
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81726947"
---
# <a name="monitoring-and-alerting-for-azure-key-vault"></a>Мониторинг и оповещение для Убежища ключей Azure

## <a name="overview"></a>Обзор

После того как вы начали использовать хранилище ключей для хранения ваших производственных секретов, важно следить за работоспособностью вашего хранилища ключей, чтобы убедиться, что ваш сервис работает по назначению. По мере того как вы начинаете масштабировать службу, количество запросов, отправленных в хранилище ключей, будет расти. Это может увеличить задержку ваших запросов и в крайних случаях привести к тому, что ваши запросы будут задушены, что повлияет на производительность вашего сервиса. Вы также должны быть предупреждены, если хранилище ключей отправляет необычное количество кодов ошибок, так что вы можете быть быстро уведомлены о каких-либо политики доступа или проблемы конфигурации брандмауэра. Этот документ будет охватывать следующие темы:

+ Основные показатели Key Vault для мониторинга
+ Как настроить метрики и создать панель мониторинга 
+ Как создавать оповещения на определенных пороговых значениях 

## <a name="basic-key-vault-metrics-to-monitor"></a>Основные показатели Key Vault для мониторинга

+ Доступность убежища  
+ Насыщенность Убежища 
+ Задержка API обслуживания 
+ Общее количество хитов API обслуживания (фильтр по типу активности) 
+ Коды ошибок (Фильтр по коду статуса) 

**Доступность Vault** - Эта метрика всегда должна быть на 100%, это важная метрика для мониторинга, так как она может быстро показать вам, если ваш ключ хранилище испытало простоя. 

**Насыщенность Vault** - Количество запросов в секунду, что хранилище ключей может служить зависит от типа выполняемой операции. Некоторые операции хранилища имеют более низкий порог запросов в секунду. Эта метрика агрегирует общее использование хранилища ключей во всех типах операций, чтобы придумать процентное значение, которое указывает на текущее использование хранилища ключей. Полный список лимитов службы хранилища ключей приведен ниже. [Ограничения службы для хранилища ключей Azure](service-limits.md)

**Задержка API** - Эта метрика показывает среднюю задержку вызова в хранилище ключей. Хотя хранилище ключей может находиться в пределах службы, высокое использование хранилища ключей может привести к задержке, которая приводит к сбою приложений ниже по течению. 

**Всего API Hits** - Эта метрика показывает все вызовы, сделанные в хранилище ключей. Это поможет вам определить, какие приложения вызывают хранилище ключей. 

**Коды ошибок** - Эта метрика покажет вам, если ваш ключ хранилище испытывает необычное количество ошибок. Полный список кодов ошибок и рекомендаций по устранению неполадок можно найти в следующем документе. [Коды aPI API API Azure Key Vault REST](rest-error-codes.md)

## <a name="how-to-configure-metrics-and-create-a-dashboard"></a>Как настроить метрики и создать панель мониторинга

1. Войдите на портал Azure.
2. Перейдите к своему ключевому Убежищем
3. Выберите **метрики** под **мониторингом** 

> [!div class="mx-imgBorder"]
> ![Скриншот портала Azure](../media/alert-1.png)

4. Обновите название диаграммы до того, что вы хотите увидеть на панели мониторинга. 
5. Выберите область охвата. В этом примере мы выберем единое хранилище ключей. 
6. Выберите метрическую **общую доступность убежища** и агрегацию **Avg** 
7. Обновите временной диапазон до последних 24 часов и обновите детализацию времени до 1 минуты. 

> [!div class="mx-imgBorder"]
> ![Скриншот портала Azure](../media/alert-2.png)

8. Повторите приведенные выше действия для метрик API-апиков Vault. Выберите **пин-код для панели мониторинга,** чтобы сохранить метрики в панели мониторинга. 

> [!IMPORTANT]
> Выберите "Pin to Dashboard" и сохраните все настраиваемые метрики. Если вы покинете страницу и вернетесь к ней без сохранения, изменения конфигурации будут потеряны. 

9. Чтобы отслеживать все типы операций на хранилище ключей, используйте **API Total Service Hits** Metric и выберите **Расщепление по типу активности**

> [!div class="mx-imgBorder"]
> ![Скриншот портала Azure](../media/alert-3.png)

10. Для мониторинга кодов ошибок в хранилище ключей используйте метрику **результатов API Total Service API** и выберите **Расщепление по типу активности**

> [!div class="mx-imgBorder"]
> ![Скриншот портала Azure](../media/alert-4.png)

Теперь у вас будет приборная панель, которая выглядит следующим образом. Вы можете нажать 3 точки в правом верхнем виде каждой плитки, и вы можете переставить и изменить размер плитки, как вам нужно. 

После сохранения и публикации панели мониторинга создается новый ресурс в подписке Azure. Вы сможете увидеть его в любое время, ища "общий приборной панели". 

> [!div class="mx-imgBorder"]
> ![Скриншот портала Azure](../media/alert-5.png)

## <a name="how-to-configure-alerts-on-your-key-vault"></a>Как настроить оповещения на вашем ключе Vault 

В этом разделе будет показан способ настройки оповещений на хранилище ключей, чтобы вы могли предупредить свою команду о необходимости немедленно принять меры, если хранилище ключей находится в неработоспособном состоянии. Вы можете настроить оповещения, которые отправляют электронное письмо, предпочтительно команде DL, уволить уведомление о сетке событий, или позвонить или отправить текстового номера телефона. Вы также можете выбрать статические оповещения на основе фиксированного значения или динамического оповещения, которое предупредит вас, если отслеживаемая метрика превышает средний предел хранилища ключей определенное количество раз в пределах определенного диапазона времени. 

> [!IMPORTANT]
> Обратите внимание, что для начала отправки уведомлений может уйти до 10 минут. 

### <a name="configure-an-action-group"></a>Настройка группы действий 

Группа действий представляет собой настраиваемый список уведомлений и свойств.

1. Войдите на портал Azure.
2. Поиск **оповещений** в поле поиска
3. Выберите **действия управления**

> [!div class="mx-imgBorder"]
> ![Скриншот портала Azure](../media/alert-6.png)

4. Выберите **группу действий**

> [!div class="mx-imgBorder"]
> ![Скриншот портала Azure](../media/alert-7.png)

5. Выберите **тип действия** для группы действий. В этом примере мы создадим оповещение по электронной почте.

> [!div class="mx-imgBorder"]
> ![Скриншот портала Azure](../media/alert-8.png)

> [!div class="mx-imgBorder"]
> ![Скриншот портала Azure](../media/alert-9.png)

6. В нижней части страницы щелкните **ОК**. Вы успешно создали группу действий. 

Теперь, когда вы настроили группу действий, мы наберем пороги предупреждения хранилища ключей. 

### <a name="configure-alert-thresholds"></a>Настройка пороговых значений оповещения 

1. Выберите ресурс хранилища ключей на портале Azure и выберите **оповещения** под **мониторингом**

> [!div class="mx-imgBorder"]
> ![Скриншот портала Azure](../media/alert-10.png)

2. Выберите **новое правило оповещения**

> [!div class="mx-imgBorder"]
> ![Скриншот портала Azure](../media/alert-11.png)

3. Выберите область действия правила оповещения. Вы можете выбрать один свод или несколько. 

> [!IMPORTANT]
> Обратите внимание, что при выборе нескольких хранилищ для области оповещений все выбранные хранилища должны находиться в одном регионе. Вам придется настроить отдельные правила оповещения для хранилищ в разных регионах. 

> [!div class="mx-imgBorder"]
> ![Скриншот портала Azure](../media/alert-12.png)

4. Выберите условия для ваших предупреждений. Вы можете выбрать любой из следующих сигналов и определить свою логику для оповещения. Команда Key Vault рекомендует настроить следующие пороги оповещения. 

    + Доступность ключей Vault падает ниже 100% (Статический порог)
    + Задержка ключей Убежища превышает 500 мс (статический порог) 
    + Общее насыщение Убежища превышает 75% (статический порог) 
    + Общее насыщение Убежища превышает средний (динамический порог)
    + Общие коды ошибок выше среднего (динамический порог) 

> [!div class="mx-imgBorder"]
> ![Скриншот портала Azure](../media/alert-13.png)

### <a name="example-1-configuring-a-static-alert-threshold-for-latency"></a>Пример 1: Настройка порога статического оповещения для задержки

Выберите **общую задержку API в** качестве имени сигнала
> [!div class="mx-imgBorder"]
> ![Скриншот портала Azure](../media/alert-14.png)

Пожалуйста, ознакомьтесь со следующими параметрами конфигурации.

+ Установить порог на **статический** 
+ Установить оператора **больше, чем**
+ Установите тип агрегации в **средний**
+ Установить пороговое значение до **500**
+ Установить период агрегации до **5 минут**
+ Установите частоту оценки до **1 минуты**
+ Щелкните **Готово**.  

> [!div class="mx-imgBorder"]
> ![Скриншот портала Azure](../media/alert-15.png)

### <a name="example-2-configuring-a-dynamic-alert-threshold-for-vault-saturation"></a>Пример 2: Настройка динамического порога оповещения для насыщения хранилища 

При использовании динамического оповещения вы сможете увидеть исторические данные выбранного хранилища ключей. Синяя область представляет собой среднее использование хранилища ключей. Красная область показывает шипы, которые вызвали бы оповещение при условии, что другие критерии в конфигурации оповещения будут выполнены. Красные точки показывают случаи нарушений, когда критерии оповещения были выполнены в течение агрегированного временного окна. Вы можете настроить оповещение о пожаре после определенного количества нарушений в течение установленного времени. Если вы не хотите включать прошлые данные, есть возможность исключить старые данные ниже в продвинутых настройках. 

> [!div class="mx-imgBorder"]
> ![Скриншот портала Azure](../media/alert-16.png)

Пожалуйста, ознакомьтесь со следующими параметрами конфигурации.

+ Установить порог на **динамический** 
+ Установить оператора **больше, чем**
+ Установите тип агрегации в **средний**
+ Установите чувствительность порога к **средней**
+ Установить период агрегации до **5 минут**
+ Установите частоту оценки до **1 минуты**
+ **Необязательно** Настройка расширенных настроек 
+ Щелкните **Готово**.

> [!div class="mx-imgBorder"]
> ![Скриншот портала Azure](../media/alert-17.png)

5. Добавьте группу действий, настроенную

> [!div class="mx-imgBorder"]
> ![Скриншот портала Azure](../media/alert-18.png)

6. Включить оповещение и назначить серьезность

> [!div class="mx-imgBorder"]
> ![Скриншот портала Azure](../media/alert-19.png)

7. Создание оповещения 


## <a name="next-steps"></a>Следующие шаги

Поздравляем, теперь вы успешно создали панель мониторинга и настроенные оповещения для вашего хранилища ключей! После того как вы выполнили все вышеперечисленные шаги, вы должны получать оповещения по электронной почте, когда хранилище ключей отвечает критериям оповещения, которые вы настроили. Ниже приведен пример такого файла. Используйте инструменты, которые вы создали в этой статье, чтобы активно следить за работоспособностью хранилища ключей. 

### <a name="example-email-alert"></a>Пример оповещение по электронной почте 

> [!div class="mx-imgBorder"]
> ![Скриншот портала Azure](../media/alert-20.png)
