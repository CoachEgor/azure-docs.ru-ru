---
title: Руководство. Изменение частоты автоматической смены сертификата в Key Vault | Документация Майкрософт
description: Это руководство содержит сведения о том, как изменить частоту автоматической смены сертификата в Azure Key Vault с помощью портала Azure
services: key-vault
author: msmbaldwin
manager: rkarlin
tags: azure-resource-manager
ms.service: key-vault
ms.subservice: certificates
ms.topic: tutorial
ms.custom: mvc
ms.date: 04/16/2020
ms.author: sebansal
ms.openlocfilehash: 2e6c250a0bcb9d73e7c572dfe8138c31269993e8
ms.sourcegitcommit: 58faa9fcbd62f3ac37ff0a65ab9357a01051a64f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/29/2020
ms.locfileid: "82107561"
---
# <a name="tutorial-configuring-certificates-auto-rotation-in-key-vault"></a>Руководство по Настройка автоматической смены сертификата в Key Vault

Azure Key Vault позволяет легко подготавливать и развертывать цифровые сертификаты, а также управлять ими. Это могут быть общедоступные или частные сертификаты SSL/TLS, подписанные центром сертификации, а также самозаверяющие сертификаты. Key Vault также позволяет запрашивать и обновлять сертификаты через отношения партнерства с центрами сертификации, предоставляя надежное решение для управления жизненным циклом сертификатов. С помощью этого руководства вы измените атрибуты сертификата, в частности срок действия, частоту автоматической смены и центр сертификации. См. дополнительные сведения о [Key Vault](../general/overview.md).

В этом руководстве описаны следующие процедуры.

> [!div class="checklist"]
> * Управление сертификатом с помощью портала Azure
> * Добавление учетной записи центра сертификации
> * Изменение срока действия сертификата
> * Изменение частоты автоматической смены сертификата
> * Обновление атрибутов сертификата с помощью Azure PowerShell


Перед началом работы ознакомьтесь c [основными понятиями службы Key Vault](../general/basic-concepts.md). 

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на портал Azure по адресу https://portal.azure.com.

## <a name="create-a-vault"></a>Создание хранилища

Создайте новое хранилище Key Vault или выберите существующее для выполнения операций. [(Процедура создания Key Vault.)](../quick-create-portal.md) В нашем примере используется хранилище с именем **Example-Vault**. 

![Выходные данные после создания Key Vault](../media/certificates/tutorial-import-cert/vault-properties.png)

## <a name="create-a-certificate-in-key-vault"></a>Создайте сертификат в Key Vault

Создайте или импортируйте сертификат в хранилище. [(Процедура создания сертификата в Key Vault.)](../quick-create-portal.md) В нашем примере для работы используется сертификат с именем **ExampleCertificate**.

> [!NOTE]
> В Azure Key Vault атрибуты жизненного цикла сертификата можно обновлять как во время создания сертификата, так и после этого. 
## <a name="updating-certificates-life-cycle-attributes"></a>Обновление атрибутов жизненного цикла сертификата

В Key Vault можно создавать следующие виды сертификатов: 
- самозаверяющий сертификат;
- сертификат, созданный в центре сертификации, который является партнером Key Vault;
- сертификат, созданный в центре сертификации, который не является партнером Key Vault.

Партнерскими поставщиками Key Vault сейчас являются следующие центры сертификации:
- DigiCert, из которого Key Vault предоставляет сертификаты OV TLS/SSL;
- GlobalSign, из которого Key Vault предоставляет сертификаты OV TLS/SSL.

Azure Key Vault выполняет автоматическую смену сертификатов, используя партнерские отношения с центрами сертификации. Через установленные партнерские отношения Key Vault автоматически запрашивает и обновляет сертификаты. Поэтому **функция автоматической смены неприменима для сертификатов, созданных в тех центрах сертификации, которые не имеют партнерских отношений с Key Vault.** 

> [!NOTE]
> Администратор учетной записи создает для поставщика центра сертификации учетные данные, которые Key Vault будет использовать для создания, обновления и применения TLS/SSL-сертификатов через Key Vault.
![Центр сертификации](../media/certificates/tutorial-rotate-cert/cert-authority-create.png)
> 


### <a name="updating-certificates-life-cycle-attributes-at-the-time-of-certificate-creation"></a>Изменение атрибутов жизненного цикла сертификата во время создания сертификата

1. На странице свойств Key Vault выберите **Сертификаты**.
2. Щелкните **Generate/Import** (Создать или импортировать).
3. На экране **Создание сертификата** измените следующие значения:
    

    - **Срок действия**. Введите значение, обозначающее количество месяцев. Для повышения безопасности рекомендуется создавать сертификаты с коротким сроком действия. По умолчанию для созданного сертификата устанавливается срок действия в 12 месяцев.
    - **Тип действия времени существования**. Выберите действие автоматического продления и оповещения. Укажите процент от времени существования или число дней до истечения срока действия. По умолчанию устанавливается автоматическое продление сертификата по истечении 80 % от его времени существования.<br> В раскрывающемся меню выберите один из следующих вариантов:

    |  Автоматически продлевать в указанное время| Отправлять электронное письмо всем контактам в указанное время |
    |-----------|------|
    |При выборе этого параметра ВКЛЮЧАЕТСЯ автоматическая смена | При выборе этого параметра НЕ используется автоматическая смена, а только отправляется оповещение выбранным контактам.|
        


4. Нажмите кнопку **Создать**.

![Жизненный цикл сертификата](../media/certificates/tutorial-rotate-cert/create-cert-lifecycle.png)

### <a name="updating-life-cycle-attributes-of-stored-certificate"></a>Изменение атрибутов жизненного цикла для хранимого сертификата

1. Выберите Key Vault.
2. На странице свойств Key Vault выберите **Сертификаты**.
3. Выберите сертификат, который вы хотите обновить. В нашем примере для работы используется сертификат с именем **ExampleCertificate**.
4. В строке меню сверху выберите **Политика выдачи**.

![Свойства сертификатов](../media/certificates/tutorial-rotate-cert/cert-issuance-policy.png)
5. На экране **Создание политики** измените следующие значения:
- **Срок действия**. Измените значение, обозначающее число месяцев.
- **Тип действия времени существования**. Выберите действие автоматического продления и оповещения. Укажите процент от времени существования или число дней до истечения срока действия. 

![Свойства сертификатов](../media/certificates/tutorial-rotate-cert/cert-policy-change.png)
6. Щелкните **Save**(Сохранить).

> [!IMPORTANT]
> Изменение типа действия времени существования для сертификата немедленно изменит это значение для существующих сертификатов.


### <a name="updating-certificates-attributes-using-powershell"></a>Изменение атрибутов сертификата с помощью PowerShell

```azurepowershell


Set-AzureKeyVaultCertificatePolicy -VaultName $vaultName 
                                   -Name $certificateName 
                                   -RenewAtNumberOfDaysBeforeExpiry [276 or appropriate calculated value]
```

> [!TIP]
> Чтобы изменить политику продления для нескольких сертификатов, заполните файл File.csv со значениями VaultName,CertName. <br/>
>  vault1,Cert1 <br/>
>  vault2,Cert2
>
>  ```azurepowershell
>  $file = Import-CSV C:\Users\myfolder\ReadCSVUsingPowershell\File.csv 
> foreach($line in $file)
> {
> Set-AzureKeyVaultCertificatePolicy -VaultName $vaultName -Name $certificateName -RenewAtNumberOfDaysBeforeExpiry [276 or appropriate calculated value]
> }
>  ```
> 
Дополнительные сведения о параметрах [здесь](https://docs.microsoft.com/cli/azure/keyvault/certificate?view=azure-cli-latest#az-keyvault-certificate-set-attributes)

## <a name="clean-up-resources"></a>Очистка ресурсов

Другие руководства о Key Vault созданы на основе этого документа. Если вы планируете продолжить работу с последующими краткими руководствами и статьями, эти ресурсы можно не удалять.
Удалите ненужную группу ресурсов. Key Vault и связанные ресурсы будут также удалены. Чтобы удалить группу ресурсов на портале, сделайте следующее:

1. В поле поиска в верхней части портала введите имя группы ресурсов. Если в результатах поиска отображается группа ресурсов, используемая в этом кратком руководстве, выберите ее.
2. Выберите **Удалить группу ресурсов**.
3. В поле **Введите имя группы ресурсов:** введите имя группы ресурсов и выберите **Удалить**.


## <a name="next-steps"></a>Дальнейшие действия

С помощью этого руководства вы изменили жизненный цикл сертификата. Дополнительные сведения о Key Vault и его интеграции в приложения см. в следующих статьях.

Узнайте больше об [управлении созданием сертификатов в Azure Key Vault](https://docs.microsoft.com/azure/key-vault/certificates/create-certificate-scenarios).
- См. общие сведения о [Key Vault](../general/overview.md).