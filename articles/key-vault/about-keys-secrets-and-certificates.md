---
title: Сведения о ключах, секретах и сертификатах Azure Key Vault — Azure Key Vault
description: Общие сведения об интерфейсе Azure Key Vault REST и подробные сведения о ключах, секретах и сертификатах.
services: key-vault
author: msmbaldwin
manager: rkarlin
tags: azure-resource-manager
ms.service: key-vault
ms.subservice: general
ms.topic: conceptual
ms.date: 09/04/2019
ms.author: mbaldwin
ms.openlocfilehash: dd8be482009e067bf9016cc8e351fc42a2db39c7
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79271737"
---
# <a name="about-keys-secrets-and-certificates"></a>Сведения о ключах, секретах и сертификатах

Azure Key Vault позволяет пользователям и приложениям Microsoft Azure хранить и использовать несколько типов данных ключей или секретов:

- Криптографические ключи. Решение поддерживает несколько типов ключей и алгоритмов и позволяет использовать аппаратные модули безопасности (HSM) для важных ключей. 
- Секреты. Обеспечивается безопасное хранение секретов, таких как пароли и строки подключения к базам данных.
- Сертификаты. Поддерживаются сертификаты, которые создаются поверх ключей и секретов и добавляют функцию автоматического обновления.
- Служба хранилища Azure. Может управлять ключами учетной записи хранения Azure. На внутреннем уровне Key Vault может перечислять (синхронизировать) ключи с учетными записями хранения Azure и периодически повторно создавать (заменять) ключи. 

Дополнительные сведения об Azure Key Vault см. в [этой статье](/azure/key-vault/key-vault-overview).

## <a name="azure-key-vault"></a>Azure Key Vault

В следующих разделах представлены общие сведения, применимые к реализации службы Key Vault.

### <a name="supporting-standards"></a>Поддерживаемые стандарты

Спецификации JSON (нотация объектов JavaScript) и JOSE (подпись и шифрование объектов JavaScript) являются важной справочной информацией.  

-   [Веб-ключ JSON (JWK)](https://tools.ietf.org/html/draft-ietf-jose-json-web-key-41)  
-   [Веб-шифрование JSON (JWE)](https://tools.ietf.org/html/draft-ietf-jose-json-web-encryption-40)  
-   [Веб-алгоритмы JSON (JWA)](https://tools.ietf.org/html/draft-ietf-jose-json-web-algorithms-40)  
-   [Веб-подпись JSON (JWS)](https://tools.ietf.org/html/draft-ietf-jose-json-web-signature-41)  

### <a name="data-types"></a>Типы данных

Обратитесь к спецификациям JOSE для соответствующих типов данных ключей, шифрования и подписей.  

-   **algorithm** — поддерживаемый алгоритм для операции ключа, например RSA1_5.  
-   **ciphertext-value** — октеты зашифрованного текста, закодированные с помощью Base64URL.  
-   **digest-value** — выходные данные хэш-алгоритма, зашифрованные с помощью Base64URL.  
-   **key-type** — один из поддерживаемых типов ключей, например RSA (Rivest-Shamir-Adleman).  
-   **plaintext-value** — октеты открытого текста, закодированные с помощью Base64URL.  
-   **signature-value** — выходные данные алгоритма подписи, закодированные с помощью Base64URL.  
-   **base64URL** — двоичное значение в кодировке Base64URL [RFC4648].  
-   **boolean** — значение true или false.  
-   **Identity** — удостоверение из Azure Active Directory (AAD).  
-   **IntDate** — десятичное значение JSON, представляющее число секунд, начиная с 1970-01-01T0:0:0Z UTC до указанной даты или времени в формате UTC. Дополнительные сведения о дате и времени в общем формате и в UTC в частности см. в [RFC3339].  

### <a name="objects-identifiers-and-versioning"></a>Объекты, идентификаторы и управление версиями

Объекты, хранящиеся в Azure Key Vault, сохраняют версии всякий раз, когда создается экземпляр объекта. Каждая версия имеет уникальный идентификатор и URL-адрес. Когда объект создается впервые, ему присваивается уникальный идентификатор версии, а также метка с текущей версией. При создании экземпляра с тем же именем объекта новому объекту присваивается уникальный идентификатор версии и эта версия становится текущей.  

К объектам в Key Vault можно получить доступ с использованием текущего идентификатора или идентификатора версии. Например, если ключ с именем `MasterKey` выполняет операции с текущим идентификатором, система будет использовать последнюю доступную версию. В случае выполнения операций с идентификатором, зависящим от версии, система использует эту конкретную версию объекта.  

В Key Vault объекты уникально идентифицированы с использованием URL-адреса. Так что два объекта в системе, независимо от географического местоположения, не могут иметь один и тот же URL-адрес. Полный URL-адрес к объекту называется идентификатором объекта. Он состоит из части префикса, которая идентифицирует Key Vault, типа объекта, указанного пользователем имени объекта и версии объекта. Имя объекта не учитывает регистр и является неизменяемым. Идентификаторы, которые не включают версию объекта, называются базовыми.  

Дополнительные сведения см. в статье [Authentication, requests and responses](authentication-requests-and-responses.md) (Проверка подлинности, запросы и ответы).

Идентификатор объекта имеет следующий общий формат:  

`https://{keyvault-name}.vault.azure.net/{object-type}/{object-name}/{object-version}`  

Где:  

|||  
|-|-|  
|`keyvault-name`|Имя хранилища ключей в службе Microsoft Azure Key Vault.<br /><br /> Имена хранилищ ключей выбираются пользователем и являются глобально уникальными.<br /><br /> Имя Key Vault должно быть строкой длиной от 3 до 24 знаков, содержащей только цифры (0–9), буквы (a–z, A–Z) и знак "-".|  
|`object-type`|Тип объекта: "keys" либо "secrets".|  
|`object-name`|`object-name` — предоставленное пользователем имя, которое должно быть уникальным в Key Vault. Имя должно быть строкой длиной от 1 до 127 знаков, содержащей только цифры (0–9), буквы (a–z, A–Z) и знак "-".|  
|`object-version`|`object-version` — созданный системой 32-знаковый идентификатор строки, который при необходимости используется для обозначения уникальной версии объекта.|  

## <a name="key-vault-keys"></a>Ключи Key Vault

### <a name="keys-and-key-types"></a>Ключи и их типы

Ключи шифрования в Key Vault представлены объектами веб-ключей JSON (JWK). Базовые спецификации JWK и JWA также расширены, чтобы включать типы ключей, уникальные для реализации Key Vault. Например, импорт ключей с использованием упаковки конкретного поставщика HSM, обеспечивающей безопасную транспортировку ключей, что позволяет использовать их только в HSM Key Vault.  

- **"Программные" ключи** обрабатываются в программном обеспечении с помощью Key Vault, но шифруются при хранении с использованием системного ключа в HSM. Клиенты могут импортировать имеющийся ключ RSA или EC (эллиптическая кривая) либо запросить создание ключа в Key Vault.
- **"Аппаратные" ключи** обрабатываются в HSM (аппаратный модуль безопасности). Такие ключи защищены одной из систем безопасности HSM Key Vault (в каждом регионе есть системы безопасности для обеспечения изоляции). Клиенты могут импортировать ключ RSA или EC (программными средствами либо путем экспорта с совместимого устройства HSM). Клиенты могут также запросить создание ключа в Key Vault. Этот ключевой тип добавляет key_hsm атрибут jWK получить для перевозки hSM ключевой материал.

     Дополнительные сведения о географических ограничениях см. в [центре управления безопасностью Microsoft Azure](https://azure.microsoft.com/support/trust-center/privacy/).  

Key Vault поддерживает только ключи RSA и EC. 

-   **EC** — "программный" ключ эллиптической кривой.
-   **EC-HSM** — "аппаратный" ключ эллиптической кривой.
-   **RSA** — "программный" ключ RSA.
-   **RSA-HSM** — "аппаратный" ключ RSA.

Key Vault поддерживает ключи RSA таких размеров: 2048, 3072 и 4096. Кроме того, поддерживаются типы ключей EC P-256, P-384, P-521, и P-256K (SECP256K1).

### <a name="cryptographic-protection"></a>Криптографическая защита

Криптографические модули, используемые Key Vault, будь то HSM или программные модули, соответствуют стандартам FIPS. Для выполнения в режиме FIPS не требуется каких-либо дополнительных действий. Все ключи, которые **создаются** или **импортируются** с защитой HSM, обрабатываются в HSM, соответствующих требованиям FIPS 140-2 уровня 2 или более высокого. Все ключи, которые **создаются** или **импортируются** с программной защитой, обрабатываются в криптографических модулях, соответствующих требованиям FIPS 140-2 уровня 1. Дополнительные сведения см. в разделе [Ключи и их типы](#keys-and-key-types).

###  <a name="ec-algorithms"></a>Алгоритмы EC
 Ниже приведены идентификаторы алгоритмов, которые поддерживаются ключами EC и EC-HSM в Key Vault. 

#### <a name="curve-types"></a>Типы кривых

-   **P-256** — кривая NIST P-256, определенная в документе [DSS FIPS PUB 186-4](https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.186-4.pdf).
-   **P-256K** — кривая SEC SECP256K1, определенная в документе [SEC 2: Recommended Elliptic Curve Domain Parameters](https://www.secg.org/sec2-v2.pdf) (SEC 2: рекомендованные параметры домена эллиптической кривой).
-   **P-384** — кривая NIST P-384, определенная в документе [DSS FIPS PUB 186-4](https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.186-4.pdf).
-   **P-521** — кривая NIST P-521, определенная в документе [DSS FIPS PUB 186-4](https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.186-4.pdf).

#### <a name="signverify"></a>SIGN/VERIFY

-   **ES256** — ECDSA для хэшей SHA-256 и ключей, созданных на основе кривой P-256. Этот алгоритм описан на [RFC7518](https://tools.ietf.org/html/rfc7518).
-   **ES256K** — ECDSA для хэшей SHA-256 и ключей, созданных на основе кривой P-256K. Этот алгоритм находится на этапе ожидания стандартизации.
-   **ES384** — ECDSA для хэшей SHA-384 и ключей, созданных на основе кривой P-384. Этот алгоритм описан на [RFC7518](https://tools.ietf.org/html/rfc7518).
-   **ES512** — ECDSA для хэшей SHA-512 и ключей, созданных на основе кривой P-521. Этот алгоритм описан на [RFC7518](https://tools.ietf.org/html/rfc7518).


###  <a name="rsa-algorithms"></a>Алгоритмы RSA  
 Ниже приведены идентификаторы алгоритмов, которые поддерживаются ключами RSA и RSA-HSM в Key Vault.  

#### <a name="wrapkeyunwrapkey-encryptdecrypt"></a>WRAPKEY/UNWRAPKEY, ENCRYPT/DECRYPT

-   **RSA1_5** - шифрование ключей RSAES-PKCS1-V1_5 (RFC3447)  
-   **RSA-OAEP** — алгоритм RSAES, использующий оптимальное асимметричное шифрование с дополнением (OAEP) [RFC3447], с параметрами по умолчанию, указанными в RFC 3447 в разделе A.2.1. В этих параметрах по умолчанию используется хэш-функция SHA-1 и функция генерации маски MGF1 с помощью SHA-1.  

#### <a name="signverify"></a>SIGN/VERIFY

-   **PS256** - RSASSA-PSS с использованием SHA-256 и MGF1 с SHA-256, как описано в [RFC7518](https://tools.ietf.org/html/rfc7518).
-   **PS384** - RSASSA-PSS с использованием SHA-384 и MGF1 с SHA-384, как описано в [RFC7518](https://tools.ietf.org/html/rfc7518).
-   **PS512** - RSASSA-PSS с использованием SHA-512 и MGF1 с SHA-512, как описано в [RFC7518](https://tools.ietf.org/html/rfc7518).
-   **RS256** — RSASSA-PKCS-v1_5, использующий SHA-256. Предоставленное приложением значение хэш-кода должно быть вычислено с помощью SHA-256 и иметь длину в 32 байта.  
-   **RS384** — RSASSA-PKCS-v1_5, использующий SHA-384. Предоставленное приложением значение хэш-кода должно быть вычислено с помощью SHA-384 и иметь длину в 48 байтов.  
-   **RS512** — RSASSA-PKCS-v1_5, использующий SHA-512. Предоставленное приложением значение хэш-кода должно быть вычислено с помощью SHA-512 и иметь длину в 64 байта.  
-   **RSNULL** — специализированный вариант использования для реализации определенных сценариев TLS (см. [RFC2437]).  

###  <a name="key-operations"></a>Операции с ключами

Key Vault поддерживает следующие операции с объектами ключей:  

-   **Создание**. Клиенты могут создавать ключи в Key Vault. Значение ключа создается в Key Vault и хранится в нем. Оно не выдается клиенту. В Key Vault можно создать асимметричные ключи.  
-   **Импорт**. Клиенты могут импортировать имеющиеся ключи в Key Vault. В Key Vault можно импортировать асимметричные ключи с помощью нескольких различных способов упаковки внутри конструкции JWK. 
-   **Обновление**. Клиенты с достаточными разрешениями могут изменять метаданные (атрибуты ключей), связанные с ключами, ранее сохраненными в Key Vault.  
-   **Удаление**. Клиенты с достаточными разрешениями могут удалять ключи из Key Vault.  
-   **Вывод списка**. Клиенты могут вывести список всех ключей в данном Key Vault.  
-   **Вывод списка версий**. Клиенты могут вывести список всех версий данного ключа в данном Key Vault.  
-   **Получение**. Клиенты могут извлечь открытые части данного ключа в Key Vault.  
-   **Резервное копирование**. Экспорт ключей в защищенной форме.  
-   **Восстановление**. Импорт ранее заархивированного ключа.  

Дополнительные сведения о работе с ключами см. в [справочнике по работе с Azure Key Vault с помощью REST API](/rest/api/keyvault).  

После создания ключа в Key Vault с его использованием можно выполнять следующие криптографические операции:  

-   **Подпись и проверка**. Строго говоря, эта операция является подписью или проверкой хэша, так как Key Vault не поддерживает хэширование содержимого в рамках создания подписи. Приложения должны хэшировать данные для подписи локально, а затем запрашивать подпись хэша в Key Vault. Проверка подписанных хэшей поддерживается в качестве удобного механизма для приложений, у которых нет доступа к материалам открытого ключа. Для оптимизации производительности приложений рекомендуется выполнять операции проверки локально.  
-   **Шифрование и упаковка ключа**. Ключ, хранимый в Key Vault, можно использовать для защиты другого ключа, как правило, симметричного ключа шифрования содержимого (CEK). Если ключ в Azure Key Vault асимметричен, используется шифрование ключа. Например RSA-OAEP, а операции WRAPKEY/UNWRAPKEY эквивалентны операциям ENCRYPT/DECRYPT. Если ключ в Azure Key Vault симметричен, применяется упаковка ключа. Например, AES-KW. Операция WRAPKEY поддерживается в качестве удобного механизма для приложений, у которых нет доступа к материалам открытого ключа. Для оптимизации производительности приложений рекомендуется выполнять операции WRAPKEY локально.  
-   **Шифрование и расшифровка**. Ключ, хранимый в Azure Key Vault, можно использовать для шифрования или расшифровки одного блока данных, размер которого определяется типом ключа и выбранным алгоритмом шифрования. Операция шифрования предоставляется в качестве удобного механизма для приложений, у которых нет доступа к материалам открытого ключа. Для оптимизации производительности приложений рекомендуется выполнять операции шифрования локально.  

Хотя операции WRAPKEY и UNWRAPKEY с использованием асимметричных ключей могут показаться излишними (так как они эквивалентны операции ENCRYPT и DECRYPT), важно использовать различные операции. Это обеспечивает разделение семантики и авторизации этих операций, а также целостность в случаях, когда служба поддерживает другие типы ключей.  

Azure Key Vault не поддерживает операции EXPORT. Как только ключ подготовлен в системе, нельзя извлечь его или изменить его материал. Однако пользователям Key Vault ключ может потребоваться для других вариантов использования, например при его удалении. В этом случае они могут использовать операции BACKUP и RESTORE для экспорта или импорта ключей в защищенной форме. Ключи, созданные в ходе операции BACKUP, не могут использоваться за пределами Key Vault. Кроме того, в различных экземплярах Key Vault также можно использовать операцию IMPORT.  

Пользователи могут ограничивать любую из криптографических операций, поддерживаемых Key Vault, для каждого ключа с помощью свойства key_ops объекта JWK.  

Дополнительные сведения об объектах JWK см. в статье о [веб-ключе JSON (JWK)](https://tools.ietf.org/html/draft-ietf-jose-json-web-key-41).  

###  <a name="key-attributes"></a>Атрибуты ключей

В дополнение к материалу ключа можно указать следующие атрибуты. В запросе JSON ключевое слово атрибутов и кавычки ‘{‘ ‘}’ необходимы, даже если атрибуты не указаны.  

- *enabled*. Необязательный атрибут с логическим значением, по умолчанию — **true**. Указывает, является ли ключ активным и подходит ли для операций шифрования. *Включенный* атрибут используется в сочетании с *nbf* и *exp.* Когда операция происходит между *nbf* и *exp,* она будет разрешена только в том случае, если *включена* установлена **на истину.** Операции за пределами окна *nbf* / *exp* автоматически отменяются, за исключением определенных типов операций при [определенных условиях.](#date-time-controlled-operations)
- *nbf*: IntDate, необязательно, по умолчанию в настоящее время. Атрибут *nbf* (не ранее) определяет время, до которого ключ не должен использоваться для криптографических операций, за исключением определенных типов операций в разделе [определенных условий.](#date-time-controlled-operations) Обработка атрибута *nbf* требует, чтобы текущая дата и время наступали позже или соответствовали дате и времени, перечисленным в атрибуте *nbf*. Key Vault может предоставить кратковременную отсрочку, обычно не более чем несколько минут, чтобы учесть разницу в показаниях часов. Нужно указать число, содержащее значение IntDate.  
- *exp*: IntDate, необязательный, по умолчанию "навсегда". Атрибут *exp* (время окончания срока действия) определяет время, до которого или после которого ключ не должен использоваться для криптографических операций, за исключением определенных типов операций в разделе [определенных условий](#date-time-controlled-operations). Обработка атрибута *exp* требует, чтобы текущая дата и время наступали раньше или соответствовали дате и времени, перечисленным в атрибуте *exp*. Key Vault может предоставить кратковременную отсрочку, обычно не более чем несколько минут, чтобы учесть разницу в показаниях часов. Нужно указать число, содержащее значение IntDate.  

Есть дополнительные атрибуты только для чтения, которые включены в любой ответ, содержащий атрибуты ключей:  

- *created*. Необязательный атрибут со значением в формате IntDate. Атрибут *created* указывает, когда была создана эта версия ключа. Это значение равно NULL для ключей, созданных перед добавлением данного атрибута. Нужно указать число, содержащее значение IntDate.  
- *updated*. Необязательный атрибут со значением в формате IntDate. Атрибут *updated* указывает, когда была обновлена эта версия ключа. Это значение равно NULL для ключей, которые в последний раз обновлялись перед добавлением данного атрибута. Нужно указать число, содержащее значение IntDate.  

Дополнительные сведения об IntDate и других типах данных см. в разделе о [типах данных](#data-types).  

#### <a name="date-time-controlled-operations"></a>Операции, зависящие от даты и времени

Не-еще действительные и просроченные ключи, за окном *nbf* / *exp,* будут работать для **расшифровки,** **разворачивания**и **проверки** операций (не вернет 403, Запрещено). Основной причиной использования ключа в состоянии "еще не проверено" является возможность проверить ключ перед использованием в рабочей среде. Основная причина использования ключа в состоянии "истекший срок действия" — возможность выполнения операций восстановления в данных, которые были созданы, когда ключ был допустим. Кроме того, можно отключить доступ к ключу с помощью политик Key Vault или изменения значения атрибута ключа *enabled* на **false**.

Для получения дополнительной информации [Data types](#data-types)о типах данных см.

Дополнительные сведения о других возможных атрибутах см. в разделе о [веб-ключе JSON (JWK)](https://tools.ietf.org/html/draft-ietf-jose-json-web-key-41).

### <a name="key-tags"></a>Теги ключей

В форме тегов можно указать дополнительные метаданные для конкретного приложения. Key Vault поддерживает до 15 тегов, каждый из которых может иметь имя и значение длиной 256 знаков.  

>[!Note]
>Теги читаемы абонентом, если у него есть *список* или *разрешение* на этот тип объекта (ключи, секреты или сертификаты).

###  <a name="key-access-control"></a>Контроль доступа к ключам

Контроль доступа к ключам, управляемым Key Vault, предоставляется на уровне хранилища ключей, которое выступает в роли контейнера ключей. Политика управления доступом для ключей отличается от политики управления доступом для секретов в том же Ключе Vault. Пользователи могут создать одно или несколько хранилищ для хранения ключей и должны поддерживать соответствующую сценарию сегментацию и управление ключами. Контроль доступа к ключам не зависит от контроля доступа к секретам.  

Следующие разрешения могут быть предоставлены на каждого пользователя или субъект-службу в записи управления доступом к ключам в хранилище. Эти разрешения тесно отражают операции, разрешенные на ключевом объекте.  Предоставление доступа к принципу службы в хранилище ключей является одноразовой операцией, и она останется прежней для всех подписок Azure. Вы можете использовать его для развертывания столько сертификатов, сколько захотите. 

- Разрешения для операций управления ключами
  - *get*. Чтение открытой части ключа и его атрибутов.
  - *list*. Вывод списка ключей или версий ключа, хранимых в хранилище ключей.
  - *update*. Обновление атрибутов ключей.
  - *create*. Создание ключей.
  - *import*. Импорт ключа в хранилище ключей.
  - *delete*. Удаление объектов ключей.
  - *recover*. Восстановление удаленного ключа.
  - *backup*. Архивация ключа в хранилище ключей.
  - *restore*. Восстановление заархивированного ключа в хранилище ключей.

- Разрешения для криптографических операций
  - *decrypt*. Использование ключа для снятия защиты с последовательности байтов.
  - *encrypt*. Использование ключа для защиты произвольной последовательности байтов.
  - *unwrapKey*. Использование ключа для снятия защиты с упакованных симметричных ключей.
  - *wrapKey*. Использование ключа для защиты симметричного ключа.
  - *verify*. Использование ключа для проверки хэш-кодов.  
  - *sign*. Использование ключа для подписи хэш-кодов.
    
- Разрешения для привилегированных операций
  - *purge*. Очистка (удаление без возможности восстановления) удаленных ключей.

Дополнительные сведения о работе с ключами см. в статье [Azure Key Vault REST API reference](/rest/api/keyvault) (Справочник по REST API для Azure Key Vault). Сведения об установке разрешений см. в статьях [Vaults — Create Or Update](/rest/api/keyvault/vaults/createorupdate) (Хранилища. Создание или обновление) и [Vaults — Update Access Policy](/rest/api/keyvault/vaults/updateaccesspolicy) (Хранилища. Обновление политики доступа). 

## <a name="key-vault-secrets"></a>Секреты Key Vault 

### <a name="working-with-secrets"></a>Работа с секретами

С точки зрения разработчика API-интерфейсы Key Vault принимают и возвращают значения секретов в виде строк. На внутреннем уровне Key Vault хранит секреты и управляет ими в виде последовательности октетов (8 бит) максимальным объемом 25 килобайтов каждый. Служба Key Vault не предоставляет никакой семантики для секретов. Она просто принимает данные, шифрует и сохраняет их, возвращая идентификатор секрета — "id". Идентификатор может использоваться, чтобы получить секрет позже.  

Клиентам следует рассмотреть дополнительные уровни защиты конфиденциальных данных. Шифрование данных с помощью отдельного ключа защиты перед помещением в хранилище в Key Vault является одним из примеров.  

Key Vault также поддерживает поле contentType для секретов. Клиенты могут указать тип содержимого секрета, чтобы помочь в интерпретации данных секрета при извлечении. Максимальная длина этого поля — 255 символов. Предварительно определенные значения отсутствуют. Предлагаемое использование — это подсказка для интерпретации данных секрета. Например, реализация может сохранить пароли и сертификаты как секреты, а затем использовать это поле для их распознания. Предварительно определенные значения отсутствуют.  

### <a name="secret-attributes"></a>Атрибуты секретов

В дополнение к секретным данным можно указать следующие атрибуты:  

- *exp*. Необязательный атрибут со значением в формате IntDate, значение по умолчанию — **forever**. Атрибут *exp* (время окончания срока действия) определяет срок действия, в течение или после которого данные секрета НЕ ДОЛЖНЫ быть получены, за исключением [определенных ситуаций](#date-time-controlled-operations). Это поле предназначено для **информационных** целей только потому, что оно информирует пользователей службы хранилища ключей, что конкретный секрет не может использоваться. Нужно указать число, содержащее значение IntDate.   
- *nbf*. Необязательный атрибут со значением в формате IntDate, значение по умолчанию — **now**. Атрибут *nbf* (не ранее) определяет время, до которого данные секрета НЕ ДОЛЖНЫ быть получены, за исключением [определенных ситуаций](#date-time-controlled-operations). Это поле предназначено только для **информационных** целей. Нужно указать число, содержащее значение IntDate. 
- *enabled*. Необязательный атрибут с логическим значением, по умолчанию — **true**. Этот атрибут указывает, можно ли извлечь данные секрета. Атрибут enabled используется совместно с *nbf* и *exp* при выполнении операции между *nbf* и *exp*. Она будет разрешена, только если атрибут enabled имеет значение **true**. Операции вне окон *nbf* и *exp* автоматически запрещаются, за исключением [определенных ситуаций](#date-time-controlled-operations).  

Есть дополнительные атрибуты только для чтения, которые включены в любой ответ, который содержит атрибуты секрета:  

- *created*. Необязательный атрибут со значением в формате IntDate. Атрибут created указывает, когда была создана эта версия секрета. Это значение равно NULL для секретов, созданных перед добавлением данного атрибута. Нужно указать число, содержащее значение IntDate.  
- *updated*. Необязательный атрибут со значением в формате IntDate. Атрибут updated указывает, когда была обновлена эта версия секрета. Это значение равно NULL для секретов, которые в последний раз обновлялись перед добавлением данного атрибута. Нужно указать число, содержащее значение IntDate.

#### <a name="date-time-controlled-operations"></a>Операции, зависящие от даты и времени

Операцию **получения** секрета можно применять для еще не проверенных секретов и просроченных секретов за пределами окна *nbf* / *exp*. Вызов операции секрета **get** для еще не проверенных секретов может использоваться для тестирования. Извлечение (**получение**) просроченного секрета может использоваться в операциях восстановления.

Для получения дополнительной информации [Data types](#data-types)о типах данных см.  

### <a name="secret-access-control"></a>Контроль доступа к секретам

Контроль доступа к секретам, управляемым в Key Vault, предоставляется на уровне Key Vault, который содержит эти секреты. Существует политика управления доступом к секретам, отличная от политики управления доступом к секретам в том же Key Vault. Пользователи могут создать одно или несколько хранилищ для хранения секретов и должны поддерживать соответствующую сценарию сегментацию и управление секретами.   

Следующие разрешения могут использоваться на уровне субъекта в записи управления доступом к секретам в хранилище. Они практически точно отражают операции, разрешенные в объекте секрета.  

- Разрешения для операций управления секретами
  - *get*. Чтение секрета.  
  - *list*. Вывод списка секретов или их версий, хранимых в Key Vault.  
  - *set*. Создание секрета.  
  - *delete*. Удаление секрета.  
  - *recover*. Восстановление удаленного секрета.
  - *backup*. Архивация секрета в хранилище ключей.
  - *restore*. Восстановление заархивированного секрета в хранилище ключей.

- Разрешения для привилегированных операций
  - *purge*. Очистка (удаление без возможности восстановления) удаленных секретов.

Дополнительные сведения о работе с секретами см. в [справочнике по работе с Azure Key Vault с помощью REST API](/rest/api/keyvault). Сведения об установке разрешений см. в статьях [Vaults — Create Or Update](/rest/api/keyvault/vaults/createorupdate) (Хранилища. Создание или обновление) и [Vaults — Update Access Policy](/rest/api/keyvault/vaults/updateaccesspolicy) (Хранилища. Обновление политики доступа). 

### <a name="secret-tags"></a>Теги секретов  
В форме тегов можно указать дополнительные метаданные для конкретного приложения. Key Vault поддерживает до 15 тегов, каждый из которых может иметь имя и значение длиной 256 знаков.  

>[!Note]
>Теги читаемы абонентом, если у него есть *список* или *разрешение* на этот тип объекта (ключи, секреты или сертификаты).

## <a name="key-vault-certificates"></a>Сертификаты Key Vault

Поддержка сертификатов хранилища ключей не только позволяет управлять сертификатами x509, но и предоставляет следующие возможности.  

-   Владелец сертификата может создать сертификат при создании хранилища ключей или импорте существующего сертификата. Это применимо как для самозаверяющих сертификатов, так и для сертификатов, созданных центром сертификации.
-   Владелец сертификата хранилища ключей может безопасно хранить сертификаты X509 и управлять ими без необходимости использовать закрытый ключ.  
-   Владелец сертификата может создать политику, которая определяет для хранилища ключей параметры управления жизненным циклом сертификата.  
-   Владелец сертификата может предоставить контактные данные для получения уведомлений о таких событиях жизненного цикла, как истечение срока действия и обновление сертификата.  
-   Автоматическое обновление с возможностью выбора издателей сертификатов хранилища ключей — партнерских поставщиков сертификатов X509 и центров сертификации.

>[!Note]
>Также разрешено использовать сертификаты, которые предоставляют поставщики и центры, не являющиеся партнерами. Но в таком случае функция автоматического обновления недоступна.

### <a name="composition-of-a-certificate"></a>Создание сертификатов

Когда создается сертификат Key Vault, адресуемые ключ и секрет также создаются с тем же именем. Ключ Key Vault разрешает операции с ключами, а секрет Key Vault позволяет извлечь значение сертификата в виде секрета. Сертификат Key Vault также содержит открытые метаданные сертификата x509.  

Идентификатор и версия сертификатов аналогичны этим объектам у ключей и секретов. Определенная версия адресуемого ключа и секрета, созданная с помощью версии сертификата Key Vault, доступна в ответе сертификата Key Vault.
 
![Сертификаты — составные объекты](media/azure-key-vault.png)

### <a name="exportable-or-non-exportable-key"></a>Доступный или недоступный для экспорта ключ

Созданный сертификат Key Vault можно извлечь из адресуемого секрета с помощью закрытого ключа в формате PFX или PEM. Политика, используемая для создания сертификата, указывает, что ключ доступен для экспорта. Если политика указывает, что ключ недоступен для экспорта, тогда закрытый ключ не будет частью значения при извлечении в качестве секрета.  

Адресуемый ключ становится более релевантным с недоступными для экспорта сертификатами Key Vault. Операции с адресуемыми ключами Key Vault сопоставляются из поля *keyusage* политики сертификата Key Vault, используемой для его создания.  

С сертификатом поддерживается два типа ключей: *RSA* или *RSA HSM*. Для экспорта доступен только ключ RSA, но не RSA HSM.  

### <a name="certificate-attributes-and-tags"></a>Атрибуты и теги сертификата

Помимо метаданных сертификата, адресуемых ключа и секрета, сертификат Key Vault также содержит атрибуты и теги.  

#### <a name="attributes"></a>Атрибуты

Атрибуты сертификатов зеркально отражают атрибуты адресуемых ключей и секретов, созданные вместе с сертификатом Key Vault.  

Сертификат Key Vault имеет следующие атрибуты:  

-   *enabled*. Необязательный атрибут с логическим значением, по умолчанию — **true**. Этот атрибут можно задать для указания возможности извлекать данные сертификата в виде секрета или использовать их в качестве ключа. Он используется совместно с *nbf* и *exp* при возникновении операции между *nbf* и *exp*. Она будет разрешена, только если атрибут enabled имеет значение true. Операции вне окна *nbf* и *exp* автоматически запрещаются.  

Есть дополнительные атрибуты только для чтения, которые включены в ответ:

-   *created*. Указывает, когда была создана эта версия сертификата. Значение в формате IntDate.  
-   *updated*. Указывает, когда была обновлена эта версия сертификата. Значение в формате IntDate.  
-   *exp*. Содержит значение даты истечения срока действия сертификата x509. Значение в формате IntDate.  
-   *nbf*. Содержит значение даты сертификата x509. Значение в формате IntDate.  

> [!Note] 
> Если срок действия сертификата в Key Vault истекает, адресуемый ключ и секрет становятся неработоспособными.  

#### <a name="tags"></a>Теги

 Клиент указал словарь пар значений и ключей, аналогичный тегам в ключах и секретах.  

 > [!Note]
> Теги читаемы абонентом, если у него есть *список* или *разрешение* на этот тип объекта (ключи, секреты или сертификаты).

### <a name="certificate-policy"></a>Политика сертификата

Политика сертификата содержит сведения о способах создания сертификатов Key Vault и об управлении их жизненным циклом. При импорте сертификата с закрытым ключом в хранилище ключей создается политика по умолчанию путем чтения сертификата x509.  

При создании сертификата Key Vault с нуля необходимо предоставить политику для Key Vault. Политика указывает, как создать эту или следующую версию сертификата Key Vault. После создания политики при последующих операциях создания не требуется создавать следующие версии сертификатов. Есть только один экземпляр политики для всех версий сертификата Key Vault.  

На высоком уровне политика сертификата содержит следующие элементы:  

-   Свойства сертификата X509. Это имя субъекта, альтернативные имена субъекта и другие свойства, используемые для создания запроса на сертификат X509.  
-   Свойства ключей. Это поля типа ключа, длины ключа, доступности для экспорта и повторного использования ключа. Эти поля инструктируют хранилище ключей о том, как создать ключ.  
-   Свойства секрета. Это такие свойства, как тип содержимого адресуемого секрета для создания значения секрета, а также для извлечения сертификата в качестве секрета.  
-   Действия на протяжении времени существования. Это соответствующие действия для сертификата Key Vault. Каждое такое действие содержит:  

     - Триггер. Указывается с помощью дней до истечения срока действия или процента времени существования.  

     - Действие. Указывается тип действия: *emailContacts* или *autoRenew*.  

-   Издатель. Параметры, касающиеся издателя сертификата, который выдает сертификаты x509.  
-   Атрибуты политики. Атрибуты, связанные с политикой.  

#### <a name="x509-to-key-vault-usage-mapping"></a>Сопоставление использования параметров X509 и операций Key Vault

В следующей таблице представлено сопоставление политики использования ключа x509 с эффективными операциями с ключами, созданными как часть создания сертификата Key Vault.

|**Параметры использования ключей X509**|**Операции с ключами Key Vault**|**Поведение по умолчанию**|
|----------|--------|--------|
|DataEncipherment|шифрование, расшифровка| Недоступно |
|DecipherOnly|расшифровка| Недоступно  |
|DigitalSignature|подпись, проверка| Key Vault по умолчанию не имеет определения использования при создании сертификата | 
|EncipherOnly|encrypt| Недоступно |
|KeyCertSign|подпись, проверка|Недоступно|
|KeyEncipherment|упаковка и разворачивание ключа| Key Vault по умолчанию не имеет определения использования при создании сертификата | 
|NonRepudiation|подпись, проверка| Недоступно |
|crlsign|подпись, проверка| Недоступно |

### <a name="certificate-issuer"></a>Издатель сертификата

Объект сертификата Key Vault содержит конфигурацию, используемую для обмена данными с выбранным поставщиком издателей сертификатов для заказа сертификатов x509.  

-   Key Vault сотрудничает со следующими поставщиками сертификатов для сертификатов TLS/SSL

|**Имя поставщика**|**Местах**|
|----------|--------|
|DigiCert;|Поддерживается во всех расположениях службы хранилища ключей в общедоступном облаке и в Azure для государственных организаций|
|GlobalSign;|Поддерживается во всех расположениях службы хранилища ключей в общедоступном облаке и в Azure для государственных организаций|

Перед созданием издателя сертификата в Key Vault необходимо выполнить приведенные ниже обязательные шаги 1 и 2.  

1. Подключение к поставщикам центра сертификации (ЦС).  

    -   Администратор организации должен подключить свою компанию (например, Contoso) хотя бы к одному поставщику ЦС.  

2. Админ создает учетные данные запроса для Key Vault для регистрации (и обновления) сертификатов TLS/SSL  

    -   Предоставляет конфигурацию, используемую для создания объекта издателя поставщика в хранилище ключей.  

Дополнительные сведения о создании объектов издателя на портале сертификатов см. в [записи блога по сертификатам Key Vault](https://aka.ms/kvcertsblog).  

Key Vault позволяет создать несколько объектов издателей с различной конфигурацией поставщиков издателей. После создания объекта издателя на его имя можно ссылаться в одной или нескольких политиках сертификата. Ссылка на объект издателя указывает, чтобы Key Vault использовал указанную в этом объекте конфигурацию при запросе сертификата x509 из поставщика ЦС во время создания или обновления сертификата.  

Объекты издателя создаются в хранилище и могут использоваться только с сертификатами в том же хранилище.  

### <a name="certificate-contacts"></a>Контакты сертификатов

Контакты сертификатов содержат контактную информацию для отправки уведомлений, активируемых событиями времени существования сертификата. Информация о контактах совместно используется всеми сертификатами в хранилище ключей. Уведомление отправляется всем контактам, указанным для события, связанного с любым сертификатом в хранилище ключей.  

Если в политике сертификата настроено автоматическое продление, уведомление отправляется для следующих событий.  

- Перед продлением сертификата.
- После продления сертификата. Указывает, был ли сертификат успешно продлен или произошла ошибка, требующая продления сертификата вручную.  

  Если для политики сертификата настроено продление вручную (только по электронной почте), тогда уведомление отправляется, когда пришло время продлить сертификат.  

### <a name="certificate-access-control"></a>Контроль доступа к сертификату

 Контролем доступа к сертификатам управляет Key Vault. Его предоставляет Key Vault, которое выступает в роли контейнера для этих сертификатов. Существует политика управления доступом к сертификатам, отличная от политики управления доступом к ключам и секретам в том же Key Vault. Пользователи могут создать одно или несколько хранилищ для хранения сертификатов и должны поддерживать соответствующую сценарию сегментацию и управление сертификатами.  

 Следующие разрешения могут использоваться на уровне субъекта в записи управления доступом к секретам в хранилище ключей. Они точно отражают операции, разрешенные в объекте секрета:  

- Разрешения для операций управления сертификатами
  - *get*. Получение текущей или любой версии сертификата. 
  - *list*. Перечисление текущих сертификатов или версий сертификатов.  
  - *update*. Обновление сертификата.
  - *create*. Создание сертификата Key Vault.
  - *import*. Импорт материала сертификата в сертификат Key Vault.
  - *delete*. Удаление сертификата, его политики и всех его версий.  
  - *recover*. Восстановление удаленного сертификата.
  - *backup*. Архивация сертификата в хранилище ключей.
  - *restore*. Восстановление заархивированного сертификата в хранилище ключей.
  - *managecontacts*. Управление контактами сертификата Key Vault.  
  - *manageissuers*. Управление ЦС и издателями сертификатов Key Vault.
  - *getissuers*. Получение сведений о ЦС и издателях сертификатов.
  - *listissuers*. Вывод списка ЦС и издателей сертификатов.  
  - *setissuers*. Создание и обновление издателей сертификатов и ЦС Key Vault.  
  - *deleteissuers*. Удаление издателей сертификатов и ЦС Key Vault.  
 
- Разрешения для привилегированных операций
  - *purge*. Очистка (удаление без возможности восстановления) удаленных сертификатов.

Дополнительные сведения о работе с сертификатами см. в [справочнике по работе с Azure Key Vault с помощью REST API](/rest/api/keyvault). Сведения об установке разрешений см. в статьях [Vaults — Create Or Update](/rest/api/keyvault/vaults/createorupdate) (Хранилища. Создание или обновление) и [Vaults — Update Access Policy](/rest/api/keyvault/vaults/updateaccesspolicy) (Хранилища. Обновление политики доступа).

## <a name="azure-storage-account-key-management"></a>Управление ключами учетных записей хранения Azure

Key Vault может управлять ключами учетных записей хранения Azure:

- На внутреннем уровне Key Vault может выводить список ключей (синхронизировать их) с помощью учетной записи хранения Azure. 
- Key Vault периодически повторно создает (сменяет) ключи.
- Значения ключей никогда не возвращаются в ответе вызывающему объекту.
- Azure Key Vault управляет ключами как учетных записей хранения, так и классических учетных записей хранения.

Дополнительные сведения см. в статье [Ключи учетной записи хранения Azure Key Vaults](key-vault-ovw-storage-keys.md).

### <a name="storage-account-access-control"></a>Управление доступом к учетной записи хранения

Следующие разрешения можно использовать при авторизации пользователя или субъекта приложения для выполнения операций с управляемой учетной записью хранения:  

- Разрешения для управляемой учетной записи хранения и операции определения SaS
  - *get*. Получение сведений об учетной записи хранения. 
  - *list*. Список учетных записей хранения, управляемых Key Vault.
  - *update*. Обновление учетной записи хранения.
  - *delete*. Удаление учетной записи хранения.  
  - *recover*. Восстановление удаленной учетной записи хранения.
  - *backup*. Резервное копирование учетной записи хранения.
  - *restore*. Восстановление заархивированной учетной записи хранения в Key Vault.
  - *set*. Обновление или создание учетной записи хранения.
  - *regeneratekey*. Повторное создание заданного значения ключа для учетной записи хранения.
  - *getsas*. Получение сведений об определении SAS для учетной записи хранения.
  - *listsas*. Вывод списка определений SAS хранилища для учетной записи хранения.
  - *deletesas*. Удаление определения SAS из учетной записи хранения.
  - *setsas*. Создание или обновление нового определения или атрибутов SAS для учетной записи хранения.

- Разрешения для привилегированных операций
  - *purge*. Очистка (удаление без возможности восстановления) управляемой учетной записи хранения.

Дополнительные сведения о работе с сертификатами см. в статье [Azure Key Vault REST API reference](/rest/api/keyvault) (Справочник по REST API для Azure Key Vault). Сведения об установке разрешений см. в статьях [Vaults — Create Or Update](/rest/api/keyvault/vaults/createorupdate) (Хранилища. Создание или обновление) и [Vaults — Update Access Policy](/rest/api/keyvault/vaults/updateaccesspolicy) (Хранилища. Обновление политики доступа).

## <a name="see-also"></a>См. также

- [Аутентификация, запросы и ответы](authentication-requests-and-responses.md)
- [Руководство разработчика Key Vault](/azure/key-vault/key-vault-developers-guide)
