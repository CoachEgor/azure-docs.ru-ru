---
title: Мониторинг целостности файлов в центре безопасности Azure | Документы Майкрософт
description: В этом руководстве объясняется, как настроить мониторинг целостности файлов в центре безопасности Azure.
services: security-center
documentationcenter: na
author: memildin
manager: rkarlin
ms.assetid: 411d7bae-c9d4-4e83-be63-9f2f2312b075
ms.service: security-center
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/22/2020
ms.author: memildin
ms.openlocfilehash: ff408b8c8111eeb9c5b112a430858811276572c3
ms.sourcegitcommit: 32c521a2ef396d121e71ba682e098092ac673b30
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/25/2020
ms.locfileid: "91323788"
---
# <a name="file-integrity-monitoring-in-azure-security-center"></a>Мониторинг целостности файлов в центре безопасности Azure
В этом руководстве объясняется, как настроить мониторинг целостности файлов в центре безопасности Azure.


## <a name="availability"></a>Доступность

|Аспект|Подробности|
|----|:----|
|Состояние выпуска:|Общедоступная версия (GA)|
|Цены|Требуется [защитник Azure для серверов](defender-for-servers-introduction.md)|
|Необходимые роли и разрешения:|**Владелец рабочей области** может включать и отключать FIM (Дополнительные сведения см. в статье [роли Azure для log Analytics](https://docs.microsoft.com/services-hub/health/azure-roles#azure-roles)).<br>**Читатель** может просматривать результаты.|
|Облако.|![Да](./media/icons/yes-icon.png) Коммерческие облака<br>![Да](./media/icons/yes-icon.png) US Gov<br>![Нет](./media/icons/no-icon.png) Gov Китая, другое gov|
|||





## <a name="what-is-fim-in-security-center"></a>Что такое FIM в центре безопасности?
Функция мониторинга целостности файлов (FIM), также называется мониторингом изменений, анализирует файлы и реестры в операционной системе, приложениях и других компонентах, чтобы обнаруживать потенциальные атаки. Метод сравнения позволяет определить, отличается ли текущее состояние файла от состояния на момент последней проверки. Такое сравнение позволяет узнать, вносились ли в файлы допустимые или подозрительные изменения.

Функция мониторинга целостности файлов в центре безопасности проверяет целостность файлов Windows, реестра Windows и файлов Linux. Вы можете самостоятельно выбрать, какие файлы будет отслеживать FIM. Центр обеспечения безопасности отслеживает следующие действия для всех файлов, для которых активирован FIM:

- создание и удаление файлов и разделов реестра;
- изменение файлов (изменения размера файла, списков управления доступом или хэша содержимого);
- изменение реестра (изменения размера, списков управления доступом, типа или содержимого).

Центр безопасности Майкрософт предоставляет рекомендации о том, для каких сущностей вы можете легко включить FIM. Вы всегда можете определить собственные политики FIM и выбрать сущности для мониторинга. В этом пошаговом руководстве объясняется, как это сделать.

> [!NOTE]
> Функция мониторинга целостности файлов (FIM) работает для компьютеров и виртуальных машин Windows и Linux и доступна только при включенном **защитнике Azure для серверов** . Дополнительные сведения см. в разделе [цены](security-center-pricing.md) . FIM передает данные в рабочую область Log Analytics. За эту операцию взимается плата, размер которой зависит от объема передаваемых данных. Дополнительные сведения см. на [странице цен на Log Analytics](https://azure.microsoft.com/pricing/details/log-analytics/).

FIM использует решение "Отслеживание изменений" Azure, чтобы отслеживать и обнаруживать изменения в среде. При включенном мониторинге целостности файлов имеется **Отслеживание изменений** ресурс типа **решение**. Сведения о частоте сбора данных см. в разделе [Сведения о сборе данных отслеживания изменений](https://docs.microsoft.com/azure/automation/automation-change-tracking#change-tracking-data-collection-details) статьи об отслеживании изменений в Azure.

> [!NOTE]
> При удалении **Отслеживание изменений** ресурса также будет отключена функция мониторинга целостности файлов в центре безопасности.

## <a name="which-files-should-i-monitor"></a>Для каких файлов нужно применять мониторинг?
В первую очередь для мониторинга следует выбирать файлы, которые критически важны для системы и приложений. Обратите внимание на те файлы, которые не должны меняться без предварительного планирования. Если вы выберете такие файлы, которые часто изменяются приложениями или операционной системой (например, файлы журналов и текстовые файлы), большой объем лишней информации усложнит выявление атак.

Центр безопасности предоставляет следующий список рекомендуемых элементов для мониторинга на основе известных шаблонов атак. К ним относятся файлы и разделы реестра Windows. Все ключи находятся в разделе HKEY_LOCAL_MACHINE ("HKLM" в таблице).

|**Файлы Linux**|**Файлы Windows**|**разделы реестра Windows;**|
|:----|:----|:----|
|/бин/логин|C:\autoexec.bat|Хклм\софтваре\микрософт\криптографи\оид\енкодингтипе 0 \ Криптсипдллремовесигнеддатамсг \{ C689AAB8-8E78-11D0-8C47-00C04FC295EE}|
|/бин/пассвд|C:\boot.ini|Хклм\софтваре\микрософт\криптографи\оид\енкодингтипе 0 \ Криптсипдллремовесигнеддатамсг \{ 603BCC1F-4B59-4E08-B724-D2C6297EF351}|
|/etc/*. conf|C:\config.sys|HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\IniFileMapping\SYSTEM.ini Boot дистрибутивного|
|/уср/бин|C:\Windows\system.ini|HKLM\SOFTWARE\Microsoft\Windows Нт\куррентверсион\виндовс|
|/уср/сбин|C:\Windows\win.ini|HKLM\SOFTWARE\Microsoft\Windows Нт\куррентверсион\винлогон|
|/bin|C:\Windows\regedit.exe|Папки Хклм\софтваре\микрософт\виндовс\куррентверсион\експлорер\шелл|
|/сбин|C:\Windows\System32\userinit.exe|Папки оболочки Хклм\софтваре\микрософт\виндовс\куррентверсион\експлорер\усер|
|/Boot|C:\Windows\explorer.exe|хклм\софтваре\микрософт\виндовс\куррентверсион\рун|
|/usr/local/bin|C:\Program Files\Microsoft Security Client\msseces.exe|хклм\софтваре\микрософт\виндовс\куррентверсион\рунонце|
|/уср/локал/сбин||хклм\софтваре\микрософт\виндовс\куррентверсион\рунонцеекс|
|/опт/бин||хклм\софтваре\микрософт\виндовс\куррентверсион\рунсервицес|
|/опт/сбин||хклм\софтваре\микрософт\виндовс\куррентверсион\рунсервицесонце|
|/etc/crontab.||HKLM\SOFTWARE\WOW6432Node\Microsoft\Cryptography\OID\EncodingType 0 \ Криптсипдллремовесигнеддатамсг \{ C689AAB8-8E78-11D0-8C47-00C04FC295EE}|
|/etc/init.d||HKLM\SOFTWARE\WOW6432Node\Microsoft\Cryptography\OID\EncodingType 0 \ Криптсипдллремовесигнеддатамсг \{ 603BCC1F-4B59-4E08-B724-D2C6297EF351}|
|/етк/крон.хаурли||HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows NT\CurrentVersion\IniFileMapping\system.ini Boot дистрибутивного|
|/етк/крон.даили||HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows Нт\куррентверсион\виндовс|
|/етк/крон.викли||HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows Нт\куррентверсион\винлогон|
|/етк/крон.монсли||Папки HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Explorer\Shell|
|||Папки оболочки HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Explorer\User|
|||HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Run|
|||HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\RunOnce|
|||HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\RunOnceEx|
|||HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\RunServices|
|||HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\RunServicesOnce|
|||хклм\систем\куррентконтролсет\контрол\хивелист|
|||HKLM\SYSTEM\CurrentControlSet\Control\Session Манажер\кновндллс|
|||хклм\систем\куррентконтролсет\сервицес\шаредакцесс\параметерс\фиреваллполици\домаинпрофиле|
|||хклм\систем\куррентконтролсет\сервицес\шаредакцесс\параметерс\фиреваллполици\публикпрофиле|
|||хклм\систем\куррентконтролсет\сервицес\шаредакцесс\параметерс\фиреваллполици\стандардпрофиле|


## <a name="using-file-integrity-monitoring"></a>Использование мониторинга целостности файлов

1. Откройте панель мониторинга **защитника Azure** .

1. В области **Расширенная защита** выберите **мониторинг целостности файлов**.

    :::image type="content" source="./media/security-center-file-integrity-monitoring/open-file-integrity-monitoring.png" alt-text="Запуск FIM" lightbox="./media/security-center-file-integrity-monitoring/open-file-integrity-monitoring.png":::


    Откроется панель **Мониторинг целостности файлов**.
    ![Панель мониторинга центра безопасности][2]

Для каждой рабочей области предоставляется следующая информация:

- общее число изменений за последнюю неделю (символ дефиса "-" означает, что FIM не включен для этой рабочей области);
- общее число компьютеров и виртуальных машин, передающих сведения в эту рабочую область;
- географическое расположение рабочей области;
- подписка Azure, к которой относится рабочая область.

Также для рабочей области могут отображаться следующие кнопки:

- ![Значок включения][3] Указывает, что FIM не включен для этой рабочей области. Выбрав рабочую область, вы можете включить FIM для всех компьютеров в ней.
- ![Значок плана обновления][4] Указывает, что Рабочая область или подписка не защищены защитником Azure. Чтобы использовать компонент FIM, ваша подписка должна быть защищена защитником Azure.  Выбор рабочей области позволяет выполнить обновление.
- Отсутствие кнопок означает, что функция FIM уже включена для этой рабочей области.

В разделе **мониторинг целостности файлов**можно выбрать рабочую область, чтобы включить FIM для этой рабочей области, просмотреть панель мониторинга "контроль целостности файлов" для этой рабочей области или [Обновить](security-center-pricing.md) рабочую область, чтобы использовать защитник Azure.

## <a name="enable-fim"></a>Включение FIM
Чтобы включить FIM для рабочей области, выполните следующие действия:

1. В разделе **Мониторинг целостности файлов** выберите рабочую область, нажав кнопку **Включить**.

1. Откроется страница **Включить мониторинг целостности файлов**, где указано также число компьютеров Windows и Linux в этой рабочей области.

   ![Включение мониторинга целостности файлов][5]

   Также здесь приводятся рекомендуемые параметры для Windows и Linux.  Разверните узлы **Файлы Windows**, **Реестр** и **Файлы Linux**, чтобы просмотреть полный список рекомендаций.

1. Снимите флажки для всех сущностей из списка рекомендованных, для которых вы не намерены применять FIM.

1. Выберите **Применение мониторинга целостности файлов**, чтобы включить FIM.

> [!NOTE]
> Эти параметры вы можете изменить в любое время. Дополнительные сведения см. в разделе [Изменение списка отслеживаемых сущностей](#edit-monitored-entities) далее в этой статье.


## <a name="view-the-fim-dashboard"></a>Просмотр панели мониторинга FIM
Панель **мониторинга целостности файлов** отображается для рабочих областей с включенной функцией FIM. Панель мониторинга FIM открывается, когда вы включаете FIM для рабочей области или выбираете в окне **Мониторинг целостности файла** рабочую область, для которого уже включен FIM.

![Панель мониторинга целостности файлов][6]

На панели мониторинга FIM для рабочей области отображаются следующие сведения.

- общее число компьютеров, подключенных к рабочей области;
- общее число изменений, произошедших за выбранный период времени;
- разбивка изменений по типам (файлы, реестр);
- разбивка изменений по категориям (изменение, добавление, удаление).

Выбрав "Фильтр" в верхней части панели мониторинга, вы можете настроить период времени, за который отображаются изменения.

![Фильтр по периоду времени][7]

Вкладка **Компьютеры** (представлена выше) содержит полный список компьютеров, передающих сведения в эту рабочую область. Для каждого компьютера на панели мониторинга предоставляются такие сведения:

- число изменений, произошедших за выбранный период времени;
- разбивка изменений на изменения файлов и реестра.

**Поиск по журналам** открывается при вводе имени компьютера в поле поиска или выборе компьютера, указанного на вкладке "компьютеры". в разделе "Поиск по журналам" отображаются все изменения, внесенные в выбранный период времени для компьютера. Вы можете развернуть любое изменение, чтобы получить дополнительную информацию.

![Поиск по журналам][8]

Вкладка **Изменения** (см. ниже) содержит список всех изменений в рабочей области за выбранный период времени. Для каждой сущности, в которой произошли изменения, на панели мониторинга отображается следующее:

- идентификатор компьютера, на котором произошло изменение;
- тип изменения (реестр или файл);
- категория изменения (изменено, добавлено, удалено);
- дата и время изменения.

![Изменения для рабочей области][9]

Страница **Сведения об изменении** открывается, когда вы вводите изменение в поле поиска или выбираете сущность из списка на вкладке **Изменения**.

![Сведения об изменении][10]

## <a name="edit-monitored-entities"></a>Изменение списка отслеживаемых сущностей

1. Вернитесь к **панели мониторинга целостности файлов** и выберите **Параметры**.

   ![Параметры][11]

   Откроется страница **Конфигурация рабочей области** с тремя вкладками: **Реестр Windows**, **Файлы Windows** и **Файлы Linux**. На каждой вкладке перечислены сущности, которые можно изменять для этой категории. Для каждой сущности центр безопасности предоставляет информацию о том, включена ли для нее функция FIM (true или false).  Редактирование сущности позволяет включить или отключить для нее функцию FIM.

   ![Конфигурация рабочей области][12]

2. Выберите защиту идентификации. В этом примере мы выбрали элемент из вкладки "Реестр Windows". Открывается окно **Изменение реестра Windows для отслеживания изменений**.

   ![Изменение реестра Windows для отслеживания изменений][13]

В окне **Изменение реестра Windows для отслеживания изменений** вы можете сделать следующее:

- включить (True) или отключить (False) мониторинг целостности файлов;
- назначить или изменить имя сущности;
- указать или изменить значение или путь;
- удалить сущность, отменить изменения или сохранить изменения.

## <a name="add-a-new-entity-to-monitor"></a>Добавление новой сущности для мониторинга
1. Вернитесь к **панели мониторинга целостности файлов** и выберите **Параметры** в верхней части страницы. Откроется страница **Конфигурация рабочей области**.
2. На странице **Конфигурация рабочей области** перейдите на вкладку, соответствующую типу добавляемой сущности: реестр Windows, файлы Windows или файлы Linux. В нашем примере выбран вариант **Файлы Linux**.

   ![Добавление нового элемента для мониторинга][14]

3. Выберите **Добавить**. Открывается окно **Добавление файла Linux для отслеживания изменений**.

   ![Ввод требуемых сведений][15]

4. На странице **добавления** введите требуемую информацию и выберите **Сохранить**.

## <a name="disable-monitored-entities"></a>Отключение отслеживаемых сущностей
1. Вернитесь на **панель мониторинга целостности файлов**.
2. Выберите рабочую область, для которой включена функция FIM. Рабочие области, для которых включена эта функция, можно определить по отсутствию кнопок включения и обновления плана.

   ![Выбор рабочей области, для которой включен FIM][16]

3. На странице мониторинга целостности файлов выберите **Параметры**.

   ![Выбор элемента "Параметры"][17]

4. На странице **Конфигурация рабочей области** выберите группу, для которой в столбце **Включено** отображается значение True.

   ![Конфигурация рабочей области][18]

5. В окне **Изменение файла Windows для отслеживания изменений** измените параметр **Включено**, установив значение False.

   ![Присвоение значения False параметру "Включено"][19]

6. Щелкните **Сохранить**.

## <a name="folder-and-path-monitoring-using-wildcards"></a>Мониторинг папки и пути мониторинга с использованием подстановочных знаков

Используйте подстановочные знаки для упрощения отслеживания в каталогах. При настройке мониторинга папки с использованием подстановочных знаков применяются следующие правила:
-   Для отслеживания нескольких файлов необходимы подстановочные знаки.
-   Подстановочные знаки можно использовать только в последнем сегменте пути, например C:\folder\file или /etc/*.conf.
-   Если у переменной среды недопустимый путь, проверка будет успешной, но запуск ресурса по этому пути завершится сбоем.
-   При настройке пути избегайте общих путей, таких как c:\*.*, так как это приведет к переходу к большому количеству папок.

## <a name="disable-fim"></a>Отключение FIM
Вы всегда можете отключить FIM. FIM использует решение "Отслеживание изменений" Azure, чтобы отслеживать и обнаруживать изменения в среде. После отключения FIM решение для отслеживания изменений будет удалено из выбранной рабочей области.

1. Чтобы отключить FIM, вернитесь на **панель мониторинга целостности файлов**.
2. Выберите рабочую область.
3. В разделе **Мониторинг целостности файлов** выберите **Отключить**.

   ![Отключение FIM][20]

4. Выберите **Удалить** для отключения.

## <a name="next-steps"></a>Дальнейшие действия
В этой статье вы узнали, как использовать мониторинг целостности файлов (FIM) в центре безопасности. Дополнительные сведения о Центре безопасности см. в следующих статьях:

* [Настройка политик безопасности](tutorial-security-policy.md) . Узнайте, как настроить политики безопасности для подписок и групп ресурсов Azure.
* [Рекомендации по управлению безопасностью](security-center-recommendations.md) — сведения об использовании рекомендаций для защиты ресурсов Azure.
* [Блог по безопасности Azure](https://docs.microsoft.com/archive/blogs/azuresecurity/)— последние новости и информация об обеспечении безопасности в Azure.

<!--Image references-->
[1]: ./media/security-center-file-integrity-monitoring/security-center-dashboard.png
[2]: ./media/security-center-file-integrity-monitoring/file-integrity-monitoring.png
[3]: ./media/security-center-file-integrity-monitoring/enable.png
[4]: ./media/security-center-file-integrity-monitoring/upgrade-plan.png
[5]: ./media/security-center-file-integrity-monitoring/enable-fim.png
[6]: ./media/security-center-file-integrity-monitoring/fim-dashboard.png
[7]: ./media/security-center-file-integrity-monitoring/filter.png
[8]: ./media/security-center-file-integrity-monitoring/log-search.png
[9]: ./media/security-center-file-integrity-monitoring/changes-tab.png
[10]: ./media/security-center-file-integrity-monitoring/change-details.png
[11]: ./media/security-center-file-integrity-monitoring/fim-dashboard-settings.png
[12]: ./media/security-center-file-integrity-monitoring/workspace-config.png
[13]: ./media/security-center-file-integrity-monitoring/edit.png
[14]: ./media/security-center-file-integrity-monitoring/add.png
[15]: ./media/security-center-file-integrity-monitoring/add-item.png
[16]: ./media/security-center-file-integrity-monitoring/fim-dashboard-disable.png
[17]: ./media/security-center-file-integrity-monitoring/fim-dashboard-settings-disabled.png
[18]: ./media/security-center-file-integrity-monitoring/workspace-config-disable.png
[19]: ./media/security-center-file-integrity-monitoring/edit-disable.png
[20]: ./media/security-center-file-integrity-monitoring/disable-fim.png