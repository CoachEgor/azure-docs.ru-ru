---
title: Устранение неполадок в Azure FarmBeats
description: В этой статье описывается, как устранять неполадки Azure Фармбеатс.
author: uhabiba04
ms.topic: article
ms.date: 11/04/2019
ms.author: v-umha
ms.openlocfilehash: a40c64910260a2d63a529d25e1089fb618fcec1b
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "81113493"
---
# <a name="troubleshoot"></a>Устранение неполадок

В этой статье приводятся решения распространенных проблем Azure Фармбеатс. Для получения дополнительной помощи обратитесь к нашему [форуму службы поддержки](https://social.msdn.microsoft.com/Forums/home?forum=ProjectFarmBeats) или farmbeatssupport@microsoft.comотправьте нам письмо по адресу.

> [!NOTE]
  > Если вы установили Фармбеатс в течение апреля, а задания завершаются неудачно с пустым сообщением об ошибке, возможно, установка не выделила квоту пакетной службы для определения приоритетной поддержки для важных организаций, исправных и безопасных. Дополнительные сведения см. [здесь](https://azure.microsoft.com/blog/update-2-on-microsoft-cloud-services-continuity/) . Для успешного выполнения заданий необходимо будет запросить выделение виртуальных машин для учетной записи пакетной службы.

## <a name="install-issues"></a>Проблемы установки

  > [!NOTE]
  > Если вы перезапустите установку из-за ошибки, обязательно удалите **группу ресурсов** или удалите все ресурсы из группы ресурсов, прежде чем повторно запустить установку.

### <a name="invalid-sentinel-credentials"></a>Недопустимые учетные данные Sentinel

В процессе установки указаны неправильные учетные данные Sentinel. Перезапустите установку с правильными учетными данными.

### <a name="the-regional-account-quota-of-batch-accounts-for-the-specified-subscription-has-been-reached"></a>Достигнута квота на региональные учетные записи пакетной службы для указанной подписки

Увеличьте квоту или удалите неиспользуемые учетные записи пакетной службы и перезапустите установку.

### <a name="invalid-resource-group-location"></a>Недопустимое расположение группы ресурсов

Убедитесь, что **Группа ресурсов** находится в том же расположении, что и **регион** , указанный во время установки.

### <a name="other-install-issues"></a>Другие проблемы с установкой

Обратитесь к нам со следующими сведениями:

- Идентификатор подписки
- Имя группы ресурсов
- Чтобы присоединить файл журнала к сбою развертывания, выполните следующие действия.

    1. Перейдите к **группе ресурсов** в портал Azure.

    2. Выберите **развертывания** в разделе **Параметры** в левой части.

    3. Для каждого развертывания, которое **не удалось**показать, выберите Дополнительные сведения и скачайте сведения о развертывании. Прикрепите этот файл к почте.

## <a name="sensor-telemetry"></a>Телеметрии датчика

### <a name="cant-view-telemetry-data"></a>Не удается просмотреть данные телеметрии

**Симптом**: устройства или датчики развернуты и вы связали фармбеатс с партнером по устройствам, но вы не можете получать или просматривать данные телеметрии в фармбеатс.

**Действие по исправлению**

1. Перейдите в группу ресурсов Фармбеатс Датахуб.
2. Выберите **концентратор событий** (датафидевенсубнамеспаце), а затем проверьте количество входящих сообщений.
3. Выполните одно из приведенных ниже действий.

   - Если *Входящие сообщения*отсутствуют, обратитесь к партнеру по устройствам.  
   - Если у вас есть *Входящие сообщения*, свяжитесь с нами с помощью своих журналов Датахуб и ускорителей и захваченных данных телеметрии.

Чтобы узнать, как скачать журналы, перейдите к разделу ["получение журналов вручную"](#collect-logs-manually) .  

### <a name="cant-view-telemetry-data-after-ingesting-historicalstreaming-data-from-your-sensors"></a>Не удается просмотреть данные телеметрии после приема исторических и потоковых данных от датчиков

**Симптом**: устройства или датчики развернуты, и вы создали устройства и датчики в фармбеатс и принимали данные телеметрии в EventHub, но вы не сможете получать или просматривать телеметрические данных на фармбеатс.

**Действие по исправлению**

1. Убедитесь, что вы правильно выполнили регистрацию партнера. это можно сделать, перейдя в датахуб Swagger, перейдите к/партнер API, выполните Get и проверьте, зарегистрирован ли партнер. В противном случае выполните следующие [действия](get-sensor-data-from-sensor-partner.md#enable-device-integration-with-farmbeats) , чтобы добавить партнера.

2. Убедитесь, что вы использовали правильный формат сообщений телеметрии:

```json
{
"deviceid": "<id of the Device created>",
"timestamp": "<timestamp in ISO 8601 format>",
"version" : "1",
"sensors": [
    {
      "id": "<id of the sensor created>",
      "sensordata": [
        {
          "timestamp": "< timestamp in ISO 8601 format >",
          "<sensor measure name (as defined in the Sensor Model)>":"<value>"
        },
        {
          "timestamp": "<timestamp in ISO 8601 format>",
          "<sensor measure name (as defined in the Sensor Model)>": "<value>"
        }
      ]
    }
 ]
}
```

### <a name="dont-have-the-azure-event-hubs-connection-string"></a>Нет строки подключения концентраторов событий Azure

**Действие по исправлению**

1. В Датахуб Swagger перейдите к API партнера.
2. Выберите **получить** > **попробовать** > **выполнить**.

> [!NOTE]
> ИДЕНТИФИКАТОР партнера вашего партнера датчика, который вас интересует.

3. Вернитесь к API-партнеру и выберите **Get/\<ID>**.
4. Укажите идентификатор партнера из шага 3, а затем нажмите кнопку **выполнить**.

   Ответ API должен иметь строку подключения концентраторов событий.

### <a name="device-appears-offline"></a>Устройство отображается в автономном режиме

**Симптомы**: устройства установлены и вы связали фармбеатс с вашим партнером по устройствам. Устройства находятся в сети и отправляют данные телеметрии, но отображаются в автономном режиме.

**Корректирующее действие** Интервал отчетов не настроен для этого устройства. Чтобы задать интервал отчетов, обратитесь к изготовителю устройства. 

### <a name="error-deleting-a-device"></a>Ошибка при удалении устройства

При удалении устройства может возникнуть одна из следующих распространенных ситуаций:  

**Сообщение**: "на устройстве имеются ссылки в датчиках: имеется один или несколько датчиков, связанных с устройством. Удалите датчики, а затем удалите устройство. "  

**Это означает**, что устройство связано с несколькими датчиками, развернутыми в ферме.

**Действие по исправлению**  

1. Удалите датчики, связанные с устройством с помощью ускорителя.  
2. Если вы хотите связать датчики с другим устройством, попросите партнера устройства сделать то же самое.  
3. Удалите устройство с помощью `DELETE API` вызова и присвойте параметру Force *значение true*.  

**Сообщение**: "на устройстве имеется ссылка на устройство как парентдевицеид: в качестве дочерних устройств есть одно или несколько устройств, связанных с этим устройством. Удалите их, а затем удалите это устройство ".  

**Это означает**: устройство имеет связанные с ним другие устройства.  

**Действие по исправлению**

1. Удалите устройства, связанные с этим устройством.  
2. Удаление конкретного устройства.  

    > [!NOTE]
    > Вы не можете удалить устройство, если с ним связаны датчики. Дополнительные сведения о том, как удалить связанные датчики, см. в разделе " **датчик удаления** " статьи [Получение данных датчика от партнеров датчиков](get-sensor-data-from-sensor-partner.md).
    > У партнеров нет разрешения на удаление устройства или датчика. Только администраторы имеют разрешение на удаление.

## <a name="issues-with-jobs"></a>Проблемы с заданиями

### <a name="farmbeats-internal-error"></a>Внутренняя ошибка Фармбеатс

**Сообщение**: "Внутренняя ошибка фармбеатс. Дополнительные сведения см. в разделе" Руководство по устранению неполадок ".

**Корректирующее действие** Эта проблема может возникать из-за временного сбоя в конвейере данных. Создайте задание еще раз. Если ошибка повторится, свяжитесь с нами, указав сообщение об ошибке или журналы.

## <a name="accelerator-troubleshooting"></a>Устранение неполадок ускорителя

### <a name="access-control"></a>Управление доступом

**Причина**. при добавлении назначения ролей появляется сообщение об ошибке.

**Сообщение**: "не найдены соответствующие пользователи".

**Корректирующее действие** Проверьте идентификатор электронной почты, для которого вы пытаетесь добавить назначение ролей. Идентификатор электронной почты должен быть точным совпадением с ИДЕНТИФИКАТОРом, зарегистрированным для этого пользователя в Active Directory. Если ошибка повторится, свяжитесь с нами, указав сообщение об ошибке или журналы.

### <a name="unable-to-log-in-to-accelerator"></a>Не удается войти в ускоритель

**Сообщение**: "ошибка: у вас нет права на вызов службы. Обратитесь к администратору для авторизации.

**Корректирующее действие** Попросите администратора авторизовать вас для доступа к развертыванию Фармбеатс. Это можно сделать, выполнив POST of API RoleAssignment или с помощью элемента управления доступом на панели **параметров** в ускорителе.  

Если вы уже предоставили доступ и столкнулись с этой ошибкой, повторите попытку, обновив страницу. Если ошибка повторится, свяжитесь с нами, указав сообщение об ошибке или журналы.

![Проект Фармбеатс](./media/troubleshoot-azure-farmbeats/accelerator-troubleshooting-1.png)

### <a name="accelerator-issues"></a>Проблемы ускорителя  

Причина **. Вы**получили сообщение об ошибке ускорителя неопределенной причины.

**Сообщение**: "ошибка: произошла неизвестная ошибка".

**Корректирующее действие** Эта ошибка возникает, если вы оставляете время бездействия страницы слишком долго. Обновите страницу. Если ошибка повторится, свяжитесь с нами, указав сообщение об ошибке или журналы.

**Причина**: ускоритель фармбеатс не отображает последнюю версию, даже после обновления фармбеатсдеплоймент.

**Корректирующее действие** Эта ошибка возникает из-за сохраняемости рабочего процесса службы в браузере. Выполните следующие действия.

1. Закройте все вкладки браузера, в которых открыт ускоритель, и закройте окно браузера.
2. Запустите новый экземпляр браузера и перезагрузите URI ускорителя. Это действие загружает новую версию ускорителя.

## <a name="sentinel-imagery-related-issues"></a>Sentinel: проблемы, связанные с изображениями

### <a name="wrong-username-or-password"></a>Неправильное имя пользователя или пароль

**Сообщение об ошибке задания**: "для доступа к этому ресурсу требуется полная проверка подлинности".

**Корректирующее действие**: выполните одно из следующих действий.

- Обновите Фармбеатс, указав правильное имя пользователя и пароль, выполнив приведенные ниже действия, и повторите задание.

  **Обновление имени пользователя Sentinel**

    1. Войдите на [портал Azure](https://portal.azure.com).
    2. В поле **поиска** найдите группу ресурсов фармбеатс датахуб.
    3. Выбор хранилища учетных записей хранения * * * * * > **контейнеры** > **пакетной службы — подготовка файлов** > **to_vm** > **config. ini**
    4. Выберите **изменить** .
    5. Обновление имени пользователя в разделе sentinel_account

  **Обновить пароль Sentinel**

    1. Войдите на [портал Azure](https://portal.azure.com).
    2. В поле **поиска** найдите группу ресурсов фармбеатс датахуб.
    3. Выберите keyvault-* * * * *.
    4. Выберите политики доступа в разделе Параметры.
    5. Выберите **Добавить политику доступа** .
    6. Использование **управления секретами** для настройки из шаблона и добавления себя к участнику
    7. Нажмите кнопку **Добавить**, а затем выберите **сохранить** на странице **политики доступа** .
    8. Выберите **секреты** в разделе **Параметры** .
    9. Выбор **Sentinel-Password**
    10. Создайте новую версию значения и включите ее.

- Перезапустите невыполненное задание или выполните задание вспомогательных индексов для диапазона дат от 5 до 7 дней, а затем проверьте, успешно ли задано это задание.

### <a name="sentinel-hub-wrongurlor-site-not-accessible"></a>Концентратор Sentinel: неправильный URL-адрес или сайт недоступен

**Сообщение об ошибке задания**: "Ой, что-то пошло не так. Страница, к которой вы пытаетесь получить доступ, является (временно) недоступна ".

**Корректирующее действие**:

1. Откройте [метку](https://scihub.copernicus.eu/dhus/) в браузере, чтобы узнать, доступен ли веб-сайт.
2. Если веб-сайт недоступен, проверьте, не блокирует ли брандмауэр, сеть компании или другое программное обеспечение доступ к веб-сайту, а затем выполните необходимые действия, чтобы разрешить URL-адрес Sentinel. 
3. Повторно запустите невыполненное задание или выполните задание вспомогательных индексов для диапазона дат от 5 до 7 дней, а затем проверьте успешность задания.  

### <a name="sentinel-server-down-for-maintenance"></a>Сервер Sentinel: отключено для обслуживания

**Сообщение об ошибке задания**: "в ближайшее время откроется центр Коперникус Open Access! К сожалению, в данный момент выполняется некоторое обслуживание. Вскоре мы вернемся к сети. 

**Корректирующее действие**:

Эта проблема может возникать, если на сервере Sentinel выполняются какие бы то ни было действия по обслуживанию.

1. Если выполнение какого-либо задания или конвейера завершится сбоем, так как выполняется обслуживание, повторно отправьте задание через некоторое время. 

   Сведения о плановых или незапланированных действиях по обслуживанию Sentinel см. на веб-сайте [Коперникус Open Access](https://scihub.copernicus.eu/news/) .  

2. Повторно запустите невыполненное задание или выполните задание вспомогательных индексов для диапазона дат от 5 до 7 дней, а затем проверьте успешность задания.

### <a name="sentinel-maximum-number-of-connections-reached"></a>Sentinel: достигнуто максимальное число подключений

**Сообщение об ошибке задания**: "максимальное число одновременных потоков, достигнутых пользователем\<" username> ".

**Значение**. Если задание завершается сбоем из-за достижения максимального количества подключений, то одна и та же учетная запись-метка используется в нескольких заданиях.

**Корректирующее действие**: выполните одно из следующих действий.

* Дождитесь завершения других заданий, прежде чем повторно запустить задание, завершившееся сбоем.
* Создайте новую учетную запись-метку, а затем обновите имя пользователя и пароль Sentinel в Фармбеатс.

### <a name="sentinel-server-refused-connection"></a>Сервер Sentinel: отклоненное подключение

**Сообщение об ошибке задания**: "Сервер отклонил подключение http://172.30.175.69:8983/solr/dhusв:"

**Корректирующее действие**. Эта проблема может возникать, если на сервере Sentinel выполняются какие бы то ни было действия по обслуживанию.

1. Если выполнение какого-либо задания или конвейера завершится сбоем, так как выполняется обслуживание, повторно отправьте задание через некоторое время.

   Сведения о плановых или незапланированных действиях по обслуживанию Sentinel см. на веб-сайте [Коперникус Open Access](https://scihub.copernicus.eu/news/) .  

2. Повторно запустите невыполненное задание или выполните задание вспомогательных индексов для диапазона дат от 5 до 7 дней, а затем проверьте успешность задания.

### <a name="soil-moisture-map-has-white-areas"></a>Почвы влажность Map содержит белые области

**Ошибка**. **схема почвы влажность** создана, но на карте есть в основном белые области.

**Корректирующее действие**. Эта проблема может возникать, если вспомогательные индексы, формируемые для времени, для которого была запрошена схема, имеют значения ндви меньше 0,3. Дополнительные сведения см. [в техническом руководству от Sentinel](https://earth.esa.int/web/sentinel/technical-guides/sentinel-2-msi/level-2a/algorithm).

1. Повторно запустите задание для другого диапазона дат и проверьте, не превышает ли значение НДВИ в вспомогательных индексах более 0,3.

## <a name="collect-logs-manually"></a>Собирайте журналы вручную

[Установите и разверните обозреватель службы хранилища Azure]( https://docs.microsoft.com/azure/vs-azure-tools-storage-manage-with-storage-explorer?tabs=windows).

### <a name="collect-azure-data-factory-job-logs-or-app-service-logs-in-datahub"></a>Получение журналов заданий фабрики данных Azure или журналов службы приложений в Датахуб

1. Войдите на [портал Azure](https://portal.azure.com).
2. В поле **поиска** найдите группу ресурсов фармбеатс датахуб.
3. На панели мониторинга **группы ресурсов** найдите учетную запись *хранения\* датахублогс* . Например, *датахублогсмвксмк*.  
4. В столбце **имя** выберите учетную запись хранения, чтобы просмотреть панель мониторинга **учетной записи хранения** .
5. В области **датахубблогс\* ** выберите **Открыть в обозревателе** , чтобы просмотреть **открытое приложение обозреватель службы хранилища Azure** .
6. В левой области выберите **контейнеры больших двоичных объектов**, а затем щелкните **журналы заданий** для журналов фабрики данных Azure или **Appinsights-logs** для журналов службы приложений.
7. Выберите **скачать** и скачайте журналы в локальную папку на компьютере.

    ![Проект Фармбеатс](./media/troubleshoot-azure-farmbeats/collecting-logs-manually-1.png)

### <a name="collect-azure-data-factory-job-logs-or-app-service-logs-for-accelerator"></a>Получить журналы заданий фабрики данных Azure или журналы службы приложений для ускорителя

1. Войдите на [портал Azure](https://portal.azure.com).
2. В поле **поиска** найдите группу ресурсов ускорителя фармбеатс.
3. На панели мониторинга **группы ресурсов** найдите учетную запись *хранения\* хранилища* . Например, *storagedop4k\**.
4. Выберите учетную запись хранения в столбце **имя** , чтобы просмотреть панель мониторинга **учетной записи хранения** .
5. В области **хранилище\* ** выберите **Открыть в проводнике** , чтобы открыть приложение обозреватель службы хранилища Azure.
6. В левой области выберите **контейнеры больших двоичных объектов**, а затем щелкните **журналы заданий** для журналов фабрики данных Azure или **Appinsights-logs** для журналов службы приложений.
7. Выберите **скачать** и скачайте журналы в локальную папку на компьютере.

## <a name="high-cpu-usage"></a>Высокая загрузка ЦП

**Ошибка**. Вы получаете оповещение по электронной почте, которое ссылается на **оповещение о высокой загрузке ЦП**.

**Корректирующее действие**:

1. Перейдите в группу ресурсов Фармбеатс Датахуб.
2. Выберите **службу приложений**.  
3. Перейдите на [страницу цен масштабирования службы приложений](https://azure.microsoft.com/pricing/details/app-service/windows/)и выберите соответствующую ценовую категорию.
