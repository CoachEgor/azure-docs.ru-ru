---
title: Развертывание Фармбеатс Azure
description: В этой статье описывается, как развернуть Azure Фармбеатс.
author: uhabiba04
ms.topic: article
ms.date: 11/04/2019
ms.author: v-umha
ms.openlocfilehash: c29bba81132df15fcea9ff0df7be6a8cea94c9a0
ms.sourcegitcommit: c38a1f55bed721aea4355a6d9289897a4ac769d2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/05/2019
ms.locfileid: "74851134"
---
# <a name="deploy-azure-farmbeats"></a>Развертывание Фармбеатс Azure

В этой статье описывается, как настроить Azure Фармбеатс.

Azure Фармбеатс — это комплексное, расширяемое решение для управляемых данными хозяйства, которое обеспечивает бесперебойную подготовку и подключение устройств датчиков к облаку Azure, сбору данных телеметрии и агрегированию. Azure Фармбеатс включает различные датчики, такие как камеры, дроны и датчики почвы. С помощью Azure Фармбеатс вы можете управлять устройствами из облака, в том числе управлять инфраструктурой и службами в Azure для устройств IoT, а также использовать расширяемое веб-приложение и мобильные приложения для предоставления визуализации, оповещений и аналитических сведений.

> [!NOTE]
> Azure Фармбеатс поддерживается только в общедоступных облачных средах. Дополнительные сведения см. [в разделе что такое общедоступное облако?](https://azure.microsoft.com/overview/what-is-a-public-cloud/).

В Azure Фармбеатс есть два следующих компонента:

- **Датахуб**: уровень платформы Azure фармбеатс, который позволяет создавать, хранить, обрабатывать данные и вырисовывать ценные сведения из существующих или новых конвейеров данных. Этот уровень платформы полезен для запуска и создания конвейеров и моделей данных сельское хозяйство.

- **Ускоритель**: уровень решения Azure фармбеатс, который имеет встроенное приложение для демонстрации возможностей Azure фармбеатс с использованием предварительно созданных моделей сельское хозяйство. Этот уровень решения позволяет создавать границы фермы и вырисовывать аналитические данные из данных сельское хозяйство в контексте границы фермы.

Быстрое развертывание Azure Фармбеатс займет меньше часа. Затраты на Датахуб и ускорители различаются в зависимости от использования.

## <a name="deployed-resources"></a>Развернутые ресурсы

Развертывание Фармбеатс Azure создает следующие ресурсы в вашей подписке:

| S. номер  | Имя ресурса  | Компонент Фармбеатс  |
|---------|---------|---------|
|1  |       Azure Cosmos DB;   |  датахуб       |
|2  |    Application Insights      |     Датахуб/ускоритель     |
|3  |Кэш Redis для Azure   |датахуб   |
|4  |       Azure Key Vault.    |  Датахуб/ускоритель        |
|5  |    Аналитика временных рядов Azure       |     датахуб      |
|6 |      Пространство имен концентратора событий Azure    |  датахуб       |
|7  |    Фабрика данных Azure версии 2       |     Датахуб/ускоритель      |
|8  |Учетная запись Пакетной службы    |датахуб   |
|9  |       Учетная запись хранения     |  Датахуб/ускоритель        |
|10  |    Приложение логики        |     датахуб      |
|11  |    Подключение API        |     датахуб      |
|12|      Служба приложений Azure      |  Датахуб/ускоритель       |
|13 |    План службы приложений        |     Датахуб/ускоритель      |
|14 |Учетная запись Azure Maps     |Accelerator    |
|15 |       Аналитика временных рядов Azure      |  датахуб     |

Azure Фармбеатс доступен для скачивания в Azure Marketplace, доступ к которому можно получить непосредственно из портал Azure.  

## <a name="create-an-azure-farmbeats-offer-in-azure-marketplace"></a>Создание предложения Azure Фармбеатс в Azure Marketplace

Чтобы создать предложение Azure Фармбеатс в Azure Marketplace, выполните следующие действия.

1. Войдите в портал Azure, выберите свою учетную запись в правом верхнем углу, а затем перейдите в клиент Azure Active Directory (Azure AD), в котором вы хотите развернуть Azure Фармбеатс.
1. Azure Фармбеатс доступен в Azure Marketplace. На странице **Azure Marketplace** выберите **получить сейчас**.
1. Нажмите кнопку **Создать**.

> [!NOTE]
> Завершение предложения в Azure Marketplace является частью установки. Чтобы завершить развертывание Azure Фармбеатс в подписке Azure, следуйте инструкциям в следующих разделах.

## <a name="prepare"></a>Подготовка.

Для развертывания Azure Фармбеатс вам потребуются следующие разрешения.

- **Клиент**: доступ для чтения
- **Подписка**: участник или владелец
- **Группа ресурсов**: владелец

## <a name="before-you-begin"></a>Перед началом работы

Перед началом развертывания убедитесь, что выполнены следующие необходимые условия.

- Учетная запись Sentinel
- Регистрация приложения Azure AD

## <a name="create-a-sentinel-account"></a>Создание учетной записи-метки    

Учетная запись с метками помогает скачать вспомогательные изображения Sentinel с своего официального веб-сайта на устройство. Чтобы создать бесплатную учетную запись, выполните следующие действия.

1. Перейдите на [страницу регистрации учетной записи Sentinel](https://scihub.copernicus.eu/dhus/#/self-registration). 
1. В регистрационной форме укажите свое имя, фамилию, имя пользователя, пароль и адрес электронной почты.

На зарегистрированный адрес электронной почты будет отправлено проверочное письмо с подтверждением. Щелкните ссылку, чтобы подтвердить свой адрес электронной почты. Процесс регистрации завершен.

## <a name="create-an-azure-ad-app-registration"></a>Создание регистрации приложения Azure AD

Для проверки подлинности и авторизации в Azure Фармбеатс необходимо зарегистрировать приложение Azure AD. Его можно создать одним из двух способов:

* **Вариант 1**. установщик может автоматически создать регистрацию при условии, что у вас есть необходимые разрешения на доступ к клиентам, подпискам и группам ресурсов. Если эти разрешения существуют, перейдите к разделу ["Подготовка входного файла. JSON"](#prepare-the-inputjson-file) .

* **Вариант 2**. регистрацию можно создать и настроить вручную перед развертыванием Azure фармбеатс. Мы советуем использовать этот метод, если у вас нет необходимых разрешений для создания и настройки регистрации приложения Azure AD в вашей подписке. Попросите администратора использовать [настраиваемый сценарий](https://aka.ms/FarmBeatsAADScript), который поможет ИТ – администратору автоматически создать и настроить регистрацию приложения Azure AD на портал Azure. В качестве выходных данных для выполнения этого пользовательского сценария с помощью среды PowerShell ИТ Admin должен предоставить вам идентификатор клиента приложения Azure AD и секрет пароля. Запишите эти значения:

    Чтобы запустить сценарий регистрации приложения Azure AD, выполните следующие действия.

    1. Скачайте [Скрипт](https://aka.ms/FarmBeatsAADScript).
    1. Войдите в портал Azure и выберите свою подписку и клиент Azure AD.
    1. Запустите Cloud Shell на панели инструментов в верхней части портал Azure.

        ![Проект Фармбеатс](./media/prepare-for-deployment/navigation-bar-1.png)

    1. Если вы являетесь первым пользователем, вам будет предложено выбрать подписку для создания учетной записи хранения и Microsoft Azure общего доступа к файлам. Щелкните **Создать хранилище**.
    1. В первую очередь пользователям предлагается выбрать оболочку, bash или PowerShell. Выберите PowerShell.
    1. Передайте сценарий (из шага 1) в Cloud Shell и запишите расположение отправленного файла.

        > [!NOTE]
        > По умолчанию файл отправляется в домашний каталог.

        Используйте следующий скрипт:

        ```azurepowershell-interactive
        ./create_aad_script.ps1
        ```
    1. Запишите идентификатор приложения Azure AD и секрет клиента, чтобы поделиться им с пользователем, который развертывает Azure Фармбеатс.

### <a name="prepare-the-inputjson-file"></a>Подготовка файла input. JSON

В процессе установки создайте файл *input. JSON* , как показано ниже:

```json
{  
    "sku":"both",
    "subscriptionId":"da9xxxec-dxxf-4xxc-xxx21-xxx3ee7xxxxx",
    "datahubResourceGroup":"dummy-test-dh1",
    "location":"westus2",
    "datahubWebsiteName":"dummy-test-dh1",
    "acceleratorResourceGroup":" dummy-test-acc1",
    "acceleratorWebsiteName":" dummy-test-acc1",
    "sentinelUsername":"dummy-dev",
    "notificationEmailAddress":"dummy@yourorg.com",
    "updateIfExists":true
}
```

Этот файл является входным файлом для Azure Cloud Shell. Он содержит параметры, значения которых используются во время установки. Все параметры в файле JSON должны быть заменены соответствующими значениями или удалены. Они удаляются, установщик выводит запрос во время установки.

Перед подготовкой файла проверьте параметры, приведенные в следующей таблице.

|Команда | Описание|
|--- | ---|
|sku  | Предоставляет возможность загрузить один или оба компонента Azure Фармбеатс. Он указывает компоненты для загрузки. Чтобы установить только Датахуб, используйте "онлидатабхуб". Чтобы установить Датахуб и ускоритель, используйте "both".|
|subscriptionId | Указывает подписку для установки Azure Фармбеатс.|
|датахубресаурцеграуп| Имя группы ресурсов для ресурсов Датахуб.|
|location |Расположение, в котором нужно создать ресурсы.|
|акцелераторвебситенаме |Уникальный префикс URL-адреса для имени экземпляра Датахуб.|
|акцелераторресаурцеграуп  | Уникальный префикс URL-адреса для имени сайта ускорителя.|
|датахубвебситенаме  | Уникальный URL-префикс для имени веб-сайта Датахуб. |
|сентинелусернаме | Имя пользователя для входа (например, `https://scihub.copernicus.eu/dhus/#/self-registration`).|
|нотификатионемаиладдресс  | Адрес электронной почты для получения уведомлений обо всех оповещениях, настроенных в экземпляре Датахуб.|
|упдатеифексистс| Используемых Параметр, включаемый в файл *input. JSON* , только если требуется обновить существующий экземпляр Azure фармбеатс. Для обновления другие сведения, такие как имена и расположения групп ресурсов, должны быть одинаковыми.|
|аадаппклиентид | Используемых Параметр, включаемый в файл *input. JSON* , только если приложение Azure AD уже существует.  |
|аадаппклиентсекрет  | Используемых Параметр, включаемый в файл *input. JSON* , только если приложение Azure AD уже существует.|

## <a name="deploy-the-app-within-cloud-shell"></a>Развертывание приложения в Cloud Shell

В рамках ранее рассмотренного рабочего процесса Marketplace необходимо создать одну группу ресурсов и подписать соглашение "условия лицензии", которое можно проанализировать в рамках фактического развертывания. Приложение можно развернуть с помощью Cloud Shell интерфейса командной строки на основе браузера, используя среду bash. Чтобы выполнить развертывание с помощью Cloud Shell, перейдите к следующим разделам.

> [!NOTE]
> Срок действия неактивных сеансов Cloud Shell истекает через 20 минут. Попробуйте завершить развертывание в течение этого времени.

1. Войдите в портал Azure и выберите подписку и клиент Azure, которые вы хотите использовать.
1. Запустите Cloud Shell на панели инструментов в верхней части портал Azure.
1. Если вы используете Cloud Shell в первый раз, вам будет предложено выбрать подписку для создания учетной записи хранения и общей папки службы файлов Azure.
1. Выберите **создать хранилище**.  
1. Для среды выберите **Bash** (не PowerShell).

## <a name="deployment-scenario-1"></a>Сценарий развертывания 1

В этом сценарии, описанном ранее в "варианте 1", установщик автоматически создает регистрацию приложения Azure AD. Для развертывания Фармбеатс выполните следующие действия.

1. Скопируйте следующий образец шаблона JSON и сохраните его как *input. JSON*. Не забудьте запишите путь к файлу на локальном компьютере.

    ```json
    {  
       "sku":"both", 
       "subscriptionId":"da9xxxec-dxxf-4xxc-xxx21-xxx3ee7xxxxx", 
       "datahubResourceGroup":"dummy-test-dh1", 
       "location":"eastus2", 
       "datahubWebsiteName":"dummy-test-dh1", 
       "acceleratorResourceGroup":" dummy-test-acc1",   
       "acceleratorWebsiteName":" dummy-test-acc1", 
       "sentinelUsername":"dummy-dev", 
       "notificationEmailAddress":" dummy@microsoft.com", 
       "updateIfExists":true 
    }
    ```

1. Откройте Azure Cloud Shell. После успешной проверки подлинности нажмите кнопку **Отправить** (выделено на следующем рисунке), а затем отправьте *входной файл. json* в хранилище Cloud Shell.  

    ![Проект Фармбеатс](./media/prepare-for-deployment/bash-2-1.png)

1. Перейдите к домашнему каталогу в Cloud Shell. По умолчанию имя каталога — */хоме/\<имя пользователя >* .
1. В Cloud Shell введите следующую команду. Обязательно измените путь к файлу *input. JSON* , а затем нажмите клавишу ВВОД.

   ```bash
      wget -O farmbeats-installer.sh https://aka.ms/AzureFarmbeatsInstallerScript && bash farmbeats-installer.sh /home/<username>/input.json
    ```
     Установщик автоматически скачивает все зависимости и создает средство развертывания. Вам будет предложено согласиться с условиями лицензии Azure Фармбеатс.

     - Если вы согласны, введите **Y** , чтобы перейти к следующему шагу.
     - Если вы не согласны, введите **N**, и развертывание будет завершено.

1. В командной строке введите маркер доступа для развертывания. Скопируйте созданный код и войдите на [страницу входа в устройство](https://microsoft.com/devicelogin) с помощью учетных данных Azure.

    > [!NOTE]
    > Срок действия маркера истекает через 60 минут. По истечении срока действия можно перезапустить, повторно введя команду развертывания.

1. В командной строке введите пароль для учетной записи Sentinel.
   
   Установщик проверяет и запускает развертывание, что может занять около 20 минут.

   После успешного завершения развертывания вы получите следующие выходные ссылки:

    - **URL-адрес датахуб**: ссылка на Swagger для попыток API-интерфейсов Azure фармбеатс.
    - **URL-адрес ускорителя**: Пользовательский интерфейс для изучения ускорителя Smart ферма Azure фармбеатс.
    - **Файл журнала развертывания**: файл журнала, созданный во время развертывания. При необходимости его можно использовать для устранения неполадок.

## <a name="deployment-scenario-2"></a>Сценарий развертывания 2

В этом сценарии, описанном выше в разделе "вариант 2", используйте существующую регистрацию Azure Active Directory приложения для развертывания Фармбеатс, выполнив следующие действия.

1. Скопируйте следующий файл JSON, который содержит идентификатор клиента приложения Azure и пароль в файле *input. JSON* , и сохраните его. Не забудьте запишите путь к файлу на локальном компьютере.

    ```json
   {

   "sku":"both",
   "subscriptionId":"daxx9xxx-d18f-4xxc-9c21-5xx3exxxxx45",
   "datahubResourceGroup":"dummy-test-dh1",   
   "location":"westus2",   
   "datahubWebsiteName":"dummy-test-dh1",   
   "acceleratorResourceGroup":"dummy-test-acc1",   
   "acceleratorWebsiteName":"dummy-test-acc1",   
   "sentinelUsername":"dummy-dev",
   "notificationEmailAddress":"dummyuser@org1.com",
   "updateIfExists": true,
   "aadAppClientId": "lmtlemlemylmylkmerkywmkm823",
   "aadAppClientSecret": "Kxxxqxxxxu*kxcxxx3Yxxu5xx/db[xxx"

   }
   ```

1. Снова перейдите в Azure Cloud Shell, и вы успешно прошли проверку подлинности.
1. Нажмите кнопку **Отправить** (выделено на следующем рисунке), а затем отправьте *входной файл. json* в хранилище Cloud Shell.

    ![Проект Фармбеатс](./media/prepare-for-deployment/bash-2-1.png)

1. Перейдите к домашнему каталогу в Cloud Shell. По умолчанию имя каталога — */хоме/\<имя пользователя >* .
1. В Cloud Shell введите следующую команду. Обязательно измените путь к файлу *input. JSON* , а затем нажмите клавишу ВВОД.

    ```bash
    wget -O farmbeats-installer.sh https://aka.ms/AzureFarmbeatsInstallerScript && bash farmbeats-installer.sh /home/<username>/input.json
    ```

     Установщик автоматически скачивает все зависимости и создает средство развертывания. Вам будет предложено согласиться с условиями лицензии Azure Фармбеатс.

     - Если вы согласны, введите **Y** , чтобы перейти к следующему шагу.
     - Если вы не согласны, введите **N**, и развертывание будет завершено.

1. В командной строке введите маркер доступа для развертывания. Скопируйте созданный код и войдите на [страницу входа в устройство](https://microsoft.com/devicelogin) с помощью учетных данных Azure.

   Установщик проверяет и запускает развертывание, что может занять около 20 минут.

   После успешного завершения развертывания вы получите следующие выходные ссылки:

    - **URL-адрес датахуб**: ссылка на Swagger для попыток API-интерфейсов Azure фармбеатс.
    - **URL-адрес ускорителя**: Пользовательский интерфейс для изучения ускорителя Smart ферма Azure фармбеатс.
    - **Файл журнала развертывания**: файл журнала, созданный во время развертывания. При необходимости его можно использовать для устранения неполадок.

Если возникнут проблемы, ознакомьтесь с [разрешениями по устранению неполадок](troubleshoot-project-farmbeats.md).


## <a name="validate-the-deployment"></a>Проверка развертывания

### <a name="datahub"></a>датахуб

После завершения установки Датахуб вы получите URL-адрес для доступа к интерфейсам API Фармбеатс Azure через интерфейс Swagger в формате https://\<йоурдатахуб-website-name >. azurewebsites. NET/Swagger.

1. Чтобы войти через Swagger, скопируйте и вставьте URL-адрес в браузере.
1. Выполните вход с использованием учетных данных портал Azure.
1. Используемых Попробуйте выполнить эту команду "работоспособности Test": 

     - Войдите на портал Swagger, используя ссылку Датахуб, полученную в качестве выходных данных для успешного развертывания.
     - Расширенные типы Get API — выберите команду "попробовать"/Execute ".
     - Вы должны получить код ответа сервера 200, а не исключение, например "403 неавторизованный пользователь".

### <a name="accelerator"></a>Accelerator

После завершения установки ускорителя вы получите URL-адрес для доступа к пользовательскому интерфейсу Azure Фармбеатс в формате https://\<Accelerator-website-name >. azurewebsites. NET.

1. Чтобы войти из ускорителя, скопируйте и вставьте URL-адрес в браузере.
1. Выполните вход с использованием учетных данных портал Azure.

## <a name="upgrade"></a>Обновление

Инструкции по обновлению аналогичны инструкциям для первого выполнения установки. Выполните следующее:

1. Войдите в портал Azure, а затем выберите нужную подписку и клиент Azure.
1. Откройте Cloud Shell в верхней области навигации портал Azure.

   ![Проект Фармбеатс](./media/prepare-for-deployment/navigation-bar-1.png)

1. В раскрывающемся списке **Среда** слева выберите **Bash**.
1. При необходимости внесите изменения в файл *input. JSON* , а затем отправьте его в Cloud Shell. Например, можно обновить адрес электронной почты для уведомления, которое вы хотите получить.
1. Введите или вставьте следующие две команды в Cloud Shell. Не забудьте изменить путь к файлу *input. JSON* , а затем нажмите клавишу ВВОД.

    ```bash
    wget -O farmbeats-installer.sh https://aka.ms/AzureFarmbeatsInstallerScript && bash farmbeats-installer.sh /home/<username>/input.json
    ```

   Установщик автоматически выводит запрос на ввод необходимых входных данных во время выполнения.

1. Введите маркер доступа для развертывания. Скопируйте созданный код и войдите на [страницу входа в устройство](https://microsoft.com/devicelogin) с помощью учетных данных Azure.
1. Введите пароль для Sentinel.

   Теперь установщик проверяет и запускает создание ресурсов, что может занять около 20 минут.

   После успешного завершения развертывания вы получите следующие выходные ссылки:
    - **URL-адрес датахуб**: ссылка на Swagger для попыток API-интерфейсов Azure фармбеатс.
    - **URL-адрес ускорителя**: Пользовательский интерфейс для изучения ускорителя Smart ферма Azure фармбеатс.
    - **Файл журнала развертывания**: файл журнала, созданный во время развертывания. При необходимости его можно использовать для устранения неполадок.

> [!NOTE]
> Запишите предшествующие значения для использования в будущем.


## <a name="uninstall"></a>Удаление

Сейчас мы не поддерживаем автоматическое удаление Azure Фармбеатс с помощью установщика. Чтобы удалить Датахуб или ускоритель, в портал Azure удалите группу ресурсов, в которой установлены эти компоненты, или удалите ресурсы вручную.

Например, если вы развернули Датахуб и Accelerator в двух разных группах ресурсов, эти группы ресурсов можно удалить следующим образом:

1. Войдите на портал Azure.
1. Выберите свою учетную запись в правом верхнем углу и перейдите к клиенту Azure AD, в котором вы хотите развернуть Azure Фармбеатс.

   > [!NOTE]
   > Датахуб необходим для правильной работы ускорителя. Не рекомендуется удалять Датахуб без удаления ускорителя.

1. Выберите **группы ресурсов**, а затем введите имя группы ресурсов Датахуб или ускорителя, которую требуется удалить.
1. Выберите имя группы ресурсов. Введите имя повторно, чтобы подтвердить его, а затем выберите **Удалить** , чтобы удалить группу ресурсов и все ее базовые ресурсы.
   Кроме того, можно удалить каждый ресурс вручную, метод, который мы не советуем использовать.
1. Для удаления или удаления Датахуб перейдите в группу ресурсов непосредственно в Azure, а затем удалите группу ресурсов.

## <a name="next-steps"></a>Дальнейшие действия

Вы узнали, как развертывать Azure Фармбеатс. Далее вы узнаете, как [создавать фермы фармбеатс](manage-farms.md#create-farms).
