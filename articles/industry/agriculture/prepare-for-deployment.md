---
title: Развертывание Фармбеатс Azure
description: Описывает развертывание Фармбеатс
author: uhabiba04
ms.topic: article
ms.date: 11/04/2019
ms.author: v-umha
ms.openlocfilehash: 0fc7eb6c3b582c4fc95d78397c4cb2820ebb4ea8
ms.sourcegitcommit: 85e7fccf814269c9816b540e4539645ddc153e6e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/26/2019
ms.locfileid: "74534244"
---
# <a name="deploy-farmbeats"></a>Развертывание FarmBeats

В этой статье описывается, как настроить Azure Фармбеатс.

Azure Фармбеатс — это комплексное, расширяемое решение для управляемых данными хозяйства, которое позволяет легко подключаться к облаку Azure, сбору данных телеметрии и агрегированию с помощью устройств с датчиками. В Azure Фармбеатс есть различные датчики, такие как камеры, дроны, датчики почвы и управление устройствами из облака, в том числе инфраструктура и службы в Azure для устройств IoT ("Интернет вещей"), предназначенных для мобильных и веб-приложений расширяемыми. Визуализация, оповещения и аналитика.

> [!NOTE]
> Azure Фармбеатс поддерживается только в общедоступных облачных средах. Дополнительные сведения о облачной среде см. в статье [Azure](https://azure.microsoft.com/overview/what-is-a-public-cloud/).

В Azure Фармбеатс есть два следующих компонента:

- **Концентратор** данных — это уровень платформы Azure фармбеатс, который позволяет создавать, хранить, обрабатывать данные и вырисовывать ценные сведения из существующих или новых конвейеров данных. Этот уровень платформы полезен для запуска и создания конвейеров и моделей данных сельское хозяйство.

- **Ускоритель** — это уровень решения Azure фармбеатс, который содержит встроенное приложение для демонстрации возможностей Azure фармбеатс с использованием предварительно созданных моделей сельское хозяйство. Этот уровень решения позволяет создавать границы фермы и вырисовывать аналитические данные из данных сельское хозяйство в контексте границы фермы.

Быстрое развертывание Azure Фармбеатс займет меньше часа. Затраты для концентратора данных и ускорителя зависят от их использования.

## <a name="deployed-resources"></a>Развернутые ресурсы

Развертывание Фармбеатс Azure создает перечисленные ниже ресурсы в вашей подписке.

|Серийный номер  |Имя ресурса  |Компонент Azure Фармбеатс  |
|---------|---------|---------|
|1  |       Azure Cosmos DB   |  Центр данных       |
|2  |    Application Insights      |     Концентратор данных или ускоритель     |
|3  |Кэш Azure для Redis   |Центр данных   |
|4  |       Azure KeyVault    |  Концентратор данных или ускоритель        |
|5  |    Time Series Insights       |     Центр данных      |
|6 |      Пространство имен EventHub    |  Центр данных       |
|7  |    Фабрика данных Azure версии 2       |     Концентратор данных или ускоритель      |
|8  |Учетная запись Пакетной службы    |Центр данных   |
|9  |       Учетная запись хранения     |  Концентратор данных или ускоритель        |
|10  |    приложение логики;        |     Центр данных      |
|11  |    Подключение API        |     Центр данных      |
|12|      Служба приложений      |  Концентратор данных или ускоритель       |
|13. |    План службы приложений        |     Концентратор данных или ускоритель      |
|14 |Учетная запись Azure Maps     |Accelerator    |
|15 |       Time Series Insights      |  Центр данных     |

Azure Фармбеатс доступен для скачивания из Azure Marketplace. Доступ к нему можно получить непосредственно из портал Azure.  

## <a name="create-azure-farmbeats-offer-on-marketplace"></a>Создание предложения Azure Фармбеатс в Marketplace

Чтобы создать предложение Azure Фармбеатс в Marketplace, выполните следующие действия:

1. Войдите в портал Azure и выберите свою учетную запись в правом верхнем углу и перейдите в клиент Azure AD, где требуется развернуть Microsoft Azure Фармбеатс.
2. Azure Фармбеатс доступен в Azure Marketplace. На странице Marketplace выберите "получить сейчас".
3. Выберите Создать и введите следующие сведения.
    - имя подписки.
    - имя существующей группы ресурсов (только пустая группа ресурсов) или создайте новую группу ресурсов для развертывания Azure Фармбеатс. Запишите эту группу ресурсов в последующих разделах.
4. Регион, в котором вы хотите установить Azure Фармбеатс. Сейчас Azure Фармбеатс поддерживается в следующих регионах: Центральная часть США, Западная Европа, Восточная часть США 2, Северная Европа, Западная часть США, Юго-Восточная Азия, Восточная часть США, Восточная Австралия, Западная часть США 2.
5. Нажмите кнопку **ОК**.
Откроется страница Условия использования. Проверьте стандартные термины Marketplace или щелкните гиперссылку, чтобы ознакомиться с условиями использования.
6. Нажмите кнопку **Закрыть**, установите флажок "я принимаю" и нажмите кнопку **создать**.
7. Вы успешно подписаны лицензионным соглашением с конечным пользователем Azure Фармбеатс в Marketplace.  
7. Чтобы продолжить развертывание, выполните следующие действия в этом руководстве.

> [!NOTE]
> Завершение предложения в Azure Marketplace завершается только частью настройки. Следуйте приведенным ниже инструкциям, чтобы завершить развертывание Azure Фармбеатс в подписке Azure.

## <a name="prepare"></a>Подготовка

Для развертывания Azure Фармбеатс вам потребуются следующие разрешения:

- Клиент: доступ для чтения
- Подписка: участник или владелец
- Группа ресурсов: владелец

## <a name="before-you-begin"></a>Перед началом работы

Перед запуском развертывания убедитесь, что вы сделали следующее:

- Учетная запись Sentinel
- Регистрация приложения Azure Active Directory (AD)

## <a name="create-a-sentinel-account"></a>Создание учетной записи-метки    

Учетная запись с метками помогает скачать вспомогательные изображения Sentinel с своего официального веб-сайта на устройство. Чтобы создать бесплатную учетную запись, выполните следующие действия.

Перейдите на сайт https://scihub.copernicus.eu/dhus/#/self-registration. На странице Регистрация укажите имя, фамилию, имя пользователя, пароль и адрес электронной почты.
На зарегистрированный адрес электронной почты будет отправлено проверочное письмо с подтверждением. Выберите ссылку и подтвердите ее. Процесс регистрации завершен.

## <a name="create-azure-ad-app-registration"></a>Создание регистрации приложения Azure AD

Для проверки подлинности и авторизации в Azure Фармбеатс необходимо зарегистрировать приложение Azure Active Directory, которое:

- Вариант 1. установщик может создавать автоматически (при условии, что у вас есть необходимые разрешения на доступ к клиентам, подпискам и группам ресурсов).
- Вариант 2. перед развертыванием Azure Фармбеатс можно создать и настроить (требуются ручные действия).

**Вариант 1**:: если у вас есть доступ для создания регистрации приложения AAD, вы можете пропустить этот шаг и позволить установщику создать регистрацию приложения. Перейдите к следующему разделу: [Подготовка файла input. JSON](#prepare-input-json-file)

Если у вас уже есть подписка, можно напрямую переместиться к следующей процедуре.

**Вариант 2**. Этот метод является предпочтительным, если у вас недостаточно прав для создания и настройки регистрации приложения Azure AD в вашей подписке. Запросите администратора использовать [настраиваемый скрипт](https://aka.ms/FarmBeatsAADScript), который поможет ИТ Admin автоматически создать и настроить регистрацию приложения Azure AD на портал Azure. В качестве выходных данных для выполнения этого пользовательского сценария с помощью среды PowerShell ИТ Admin должен предоставить вам идентификатор клиента приложения Azure Active Directory и секрет пароля. Запишите эти значения:

Выполните следующие действия, чтобы запустить сценарий регистрации приложения Azure AD.

1. Скачать [Скрипт](https://aka.ms/FarmBeatsAADScript).
2. Войдите в портал Azure и выберите свою подписку и клиент AD.
3. Запустите Cloud Shell с верхней панели навигации портала Azure.

    ![Перебивает ферму проекта](./media/prepare-for-deployment/navigation-bar-1.png)


4. Пользователям в первый раз будет предложено выбрать подписку для создания учетной записи хранения и Microsoft Azure общего доступа к файлам. Щелкните **Создать хранилище**.
5. В первый раз пользователям будет предложено выбрать предпочтительный интерфейс оболочки — bash или PowerShell. Выберите PowerShell.
6. Отправьте скрипт (из шага 1) в Cloud Shell и запишите расположение отправленного файла.

    > [!NOTE]
    > По умолчанию он отправляется в домашний каталог.

    Используйте следующий скрипт:

    ```azurepowershell-interactive
    ./create_aad_script.ps1
    ```
7. Запишите идентификатор приложения Azure AD и секрет клиента, чтобы поделиться им с пользователем, который развертывает Azure Фармбеатс.

### <a name="prepare-input-json-file"></a>Подготовка входного JSON файла

В процессе установки создайте файл Input. JSON следующим образом:

```json
    {  
       "sku":"both",
       "subscriptionId":"da9xxxec-dxxf-4xxc-xxx21-xxx3ee7xxxxx",
       "datahubResourceGroup":"dummy-test-dh1",
       "location":"westus2",
       "datahubWebsiteName":"dummy-test-dh1",
       "acceleratorResourceGroup":" dummy-test-acc1",
       "acceleratorWebsiteName":" dummy-test-acc1",
       "sentinelUsername":"dummy-dev",
       "notificationEmailAddress":"dummy@yourorg.com",
       "updateIfExists":true
    }
```

Этот файл является входным файлом для Azure Cloud Shell и параметров, значения которых используются во время установки. Все параметры в JSON должны быть заменены соответствующими значениями или удалены; в случае удаления программа установки выводит запрос во время установки.


Перед началом подготовки файла проверьте параметры.

|Command | Описание|
|--- | ---|
|sku  | Предоставляет возможность загрузить либо компоненты Azure Фармбеатс, либо оба компонента. Указывает компоненты для загрузки. Чтобы установить только концентратор данных, используйте "онлидатабхуб". Чтобы установить концентратор данных и ускоритель, используйте "both".|
|subscriptionId | Указывает подписку для установки Azure Фармбеатс|
|датахубресаурцеграуп| Имя группы ресурсов для ресурсов концентратора данных|
|location |Расположение, в котором вы хотите создать ресурсы|
|акцелераторвебситенаме |Уникальный префикс URL-адреса для имени концентратора данных|
|акцелераторресаурцеграуп  | Уникальный URL-префикс для имени веб-сайта ускорителя.|
|датахубвебситенаме  | Ууникуе URL-префикс для имени веб-сайта концентратора данных. |
|сентинелусернаме | имя пользователя для входа: https://scihub.copernicus.eu/dhus/#/self-registration.|
|нотификатионемаиладдресс  | Адрес электронной почты для получения уведомлений обо всех оповещениях, настроенных в центре данных.|
|упдатеифексистс|Используемых Параметр, включаемый в входной. JSON, только если требуется обновить существующий экземпляр Azure Фармбеатс. Для обновления — другие сведения, например. имена групп ресурсов, расположений и т. д. должны быть одинаковыми.|
|аадаппклиентид | [**Необязательно**] Параметр, включаемый в входной. JSON, только если приложение Azure AD уже существует.  |
|аадаппклиентсекрет  | [**Необязательно**] Параметр, включаемый в входной. JSON, только если приложение Azure AD уже существует.|

## <a name="deploy-within-cloud-shell-browser-based-command-line"></a>Развертывание в Cloud Shell командной строке на основе браузера

В рамках рабочего процесса Marketplace необходимо создать одну группу ресурсов и подписать лицензионное соглашение, которое можно проверить снова в рамках фактического развертывания. Развертывание можно выполнить с помощью Azure Cloud Shell (Командная строка на основе браузера), используя среду bash. Перейдите к следующим разделам, чтобы выполнить развертывание с помощью Cloud Shell.

> [!NOTE]
> Срок действия неактивных сеансов Cloud Shell истекает через 20 минут. Попробуйте завершить развертывание в течение этого времени.

1. Войдите в портал Azure и выберите нужную подписку и клиент AD.
2. Запустите Cloud Shell с верхней панели навигации портала Azure.
3. Если вы используете Cloud Shell в первый раз, вам будет предложено выбрать подписку для создания учетной записи хранения и общей папки Microsoft Azure файлов.
4. Выберите **создать хранилище**.  

Выберите среду как bash (а не PowerShell).

## <a name="deployment-scenario-1"></a>Сценарий развертывания 1

Программа установки создает Azure AD App регистрацию (вариант 1 выше).

1. Скопируйте следующий шаблон и присвойте ему имя input. JSON.  
Пример входного JSON:

    ```json
    {  
       "sku":"both", 
       "subscriptionId":"da9xxxec-dxxf-4xxc-xxx21-xxx3ee7xxxxx", 
       "datahubResourceGroup":"dummy-test-dh1", 
       "location":"eastus2", 
       "datahubWebsiteName":"dummy-test-dh1", 
       "acceleratorResourceGroup":" dummy-test-acc1",   
       "acceleratorWebsiteName":" dummy-test-acc1", 
       "sentinelUsername":"dummy-dev", 
       "notificationEmailAddress":" dummy@microsoft.com", 
       "updateIfExists":true 
    }
    ```

2. Сохраните файл и запишите путь (на локальном компьютере).
3. Перейдите в Azure Cloud Shell и после успешной проверки подлинности выберите передачу (см. рисунок, выделенный ниже) и отправьте входной JSON-файл в хранилище Cloud Shell.  

    ![Перебивает ферму проекта](./media/prepare-for-deployment/bash-2-1.png)

4. Перейдите к домашнему каталогу в Cloud Shell. По умолчанию это/Хоме/<username>
5. Введите или вставьте следующую команду в Cloud Shell. Не забудьте изменить путь на входные данные. Файл JSON и нажмите клавишу ВВОД.

   ```bash
      wget -O farmbeats-installer.sh https://aka.ms/AzureFarmbeatsInstallerScript && bash farmbeats-installer.sh /home/<username>/input.json
    ```
     Установщик автоматически скачивает все зависимости и создает средство развертывания. Вам будет предложено согласиться с условиями лицензионного соглашения Azure Фармбеатс.

     - Если вы согласны, введите "Y", и вы переходите к следующему шагу.
     - Введите "N", если вы не согласны с условиями, а развертывание завершится.

6. Затем вам будет предложено ввести маркер доступа для развертывания. Скопируйте созданный код и войдите в https://microsoft.com/devicelogin с учетными данными Azure.

    > [!NOTE]
    > Срок действия маркера истекает через 60 минут. По истечении срока действия можно перезапустить, введя команду развертывания еще раз.

7. При появлении запроса введите пароль для учетной записи Sentinel.
8. Теперь установщик проверяет и запускает развертывание, что может занять около 20 минут.
9. После успешного развертывания вы получите следующие выходные ссылки:

 - **URL-адрес концентратора данных**: Swagger — ссылка для пробных API Azure фармбеатс.
 - **URL-адрес ускорителя**: Пользовательский интерфейс для изучения ускорителя Smart ферма Azure фармбеатс.
 - Файл журнала **развертывания**— файл журнала, созданный во время развертывания. При необходимости его можно использовать для устранения неполадок.

## <a name="deployment-scenario-2"></a>Сценарий развертывания 2

Для развертывания используется существующая Azure Active Directory регистрация приложения (вариант 2 выше).

1. Скопируйте приведенный ниже файл JSON, который содержит идентификатор клиента приложения Azure и пароль в файле input. JSON, и сохраните его.

    ```json
   {

   "sku":"both",
   "subscriptionId":"daxx9xxx-d18f-4xxc-9c21-5xx3exxxxx45",
   "datahubResourceGroup":"dummy-test-dh1",   
   "location":"westus2",   
   "datahubWebsiteName":"dummy-test-dh1",   
   "acceleratorResourceGroup":"dummy-test-acc1",   
   "acceleratorWebsiteName":"dummy-test-acc1",   
   "sentinelUsername":"dummy-dev",
   "notificationEmailAddress":"dummyuser@org1.com",
   "updateIfExists": true,
   "aadAppClientId": "lmtlemlemylmylkmerkywmkm823",
   "aadAppClientSecret": "Kxxxqxxxxu*kxcxxx3Yxxu5xx/db[xxx"

   }
   ```

Выполните остальные шаги.

2. Запишите путь к файлу input. JSON (на локальном компьютере).
3. Перейдите в Azure Cloud Shell снова и пройдите проверку подлинности, нажмите кнопку отправки (см. значок выделенного значка ниже изображения) и передайте входной файл. JSON в хранилище Cloud Shell.

    ![Перебивает ферму проекта](./media/prepare-for-deployment/bash-2-1.png)

4. Перейдите к домашнему каталогу в Cloud Shell. По умолчанию это/Хоме/<username>
5. Введите или вставьте следующую команду в Cloud Shell. Не забудьте изменить путь на входные данные. Файл JSON и нажмите клавишу ВВОД.

    ```bash
    wget -O farmbeats-installer.sh https://aka.ms/AzureFarmbeatsInstallerScript && bash farmbeats-installer.sh /home/<username>/input.json
    ```

Следуйте инструкциям на экране.

6. Скрипт автоматически скачивает все зависимости и создает средство развертывания.
7. Вам будет предложено прочитать и принять условия лицензионного соглашения Azure Фармбеатс (EULA).

    - Если вы согласны, введите "Y", и вы продолжите переход к следующему шагу.
    - Введите "N", если вы не согласны с условиями, и развертывание будет прекращено.

8. Вам будет предложено ввести маркер доступа для развертывания. Скопируйте созданный код и войдите в https://microsoft.com/devicelogin с учетными данными Azure.
9. Теперь установщик будет проверять и приступить к созданию ресурсов, что может занять около 20 минут. В течение этого времени сеанс будет активным на Cloud Shell.
10. После успешного развертывания вы получите следующие выходные ссылки:

 - **URL-адрес концентратора данных**: Swagger — ссылка для пробных API Azure фармбеатс.
 - **URL-адрес ускорителя**: Пользовательский интерфейс для изучения ускорителя Azure фармбеатс.
 - **Файл журнала развертывания**: файл журнала, созданный во время развертывания. При необходимости его можно использовать для устранения неполадок.

Если возникнут проблемы, ознакомьтесь с [разрешениями по устранению неполадок](troubleshoot-project-farmbeats.md).


## <a name="validate-deployment"></a>Проверка развертывания

### <a name="data-hub"></a>Центр данных

После завершения установки концентратора данных вы получите URL-адрес для доступа к API Azure Фармбеатс через интерфейс Swagger в формате: https://\<йоурдатахуб-website-name >. azurewebsites. NET/Swagger.

1. Чтобы войти через Swagger, скопируйте и вставьте URL-адрес в браузере.
2. Войдите, используя учетные данные портал Azure.
3. Работоспособности тест (необязательно)

     - Возможность успешного входа на портал Swagger с помощью ссылки на концентратор данных, полученной в качестве выходных данных для успешного развертывания.
     - Расширенные типы Get API — выберите команду "попробовать"/Execute ".
     - Вы должны получить код ответа сервера 200, а не исключение, например 403 "неавторизованный пользователь".

### <a name="accelerator"></a>Accelerator

После завершения установки ускорителя вы получите URL-адрес для доступа к пользовательскому интерфейсу Azure Фармбеатс в формате: https://\<Accelerator-website-name >. azurewebsites. NET.

1. Чтобы войти из ускорителя, скопируйте и вставьте URL-адрес в браузере.
2. Войдите, используя учетные данные портал Azure.

## <a name="upgrade"></a>Обновление

Шаги для обновления аналогичны этапам установки в первый раз. Выполните следующие действия.

1. Войдите в портал Azure и выберите нужную подписку и клиент AD.
2. Запустите Cloud Shell с верхней панели навигации портала Azure.

   ![Перебивает ферму проекта](./media/prepare-for-deployment/navigation-bar-1.png)

3. Выберите среду с именем Bash в раскрывающемся списке слева от оболочки.
4. Внесите изменения в файл Input. JSON, только если это необходимо, и отправьте его в Azure Cloud Shell. Например, можно обновить адрес электронной почты для уведомления, которое вы хотите получить.
5. Отправьте входной файл. JSON в Azure Cloud Shell.
6. Введите или вставьте следующие две команды в Cloud Shell. Обязательно измените путь к файлу input. JSON и нажмите клавишу ВВОД.

    ```bash
    wget -O farmbeats-installer.sh https://aka.ms/AzureFarmbeatsInstallerScript && bash farmbeats-installer.sh /home/<username>/input.json
    ```
Следуйте инструкциям на экране:

7. Установщик автоматически запрашивает требуемые входные данные во время выполнения:
8. Введите маркер доступа для развертывания. Скопируйте созданный код и войдите в https://microsoft.com/devicelogin с учетными данными Azure.
9. Пароль Sentinel
10. Теперь установщик проверяет и запускает создание ресурсов, что может занять около 20 минут.
11. После успешного развертывания вы получите следующие выходные ссылки:
 - **URL-адрес концентратора данных**: Swagger — ссылка для пробных API Azure фармбеатс.
 - **URL-адрес ускорителя**: Пользовательский интерфейс для изучения ускорителя Azure фармбеатс.
 - **Файл журнала развертывания**: сохраняет журналы во время развертывания. Его можно использовать для устранения неполадок.

> [!NOTE]
> Запишите приведенные выше значения для использования в будущем.


## <a name="uninstall"></a>Удаление

Сейчас мы не поддерживаем автоматическое удаление Azure Фармбеатс с помощью установщика. Чтобы удалить концентратор данных или ускоритель, в портал Azure удалите группу ресурсов, в которой установлены эти компоненты, или удалите ресурсы вручную.

Например, если вы развернули концентратор данных и ускоритель в двух разных группах ресурсов, удалите эти группы ресурсов следующим образом:

1. Войдите на портал Azure.
2. Выберите свою учетную запись в правом верхнем углу и перейдите к нужному клиенту Azure AD, где вы хотите развернуть Azure Фармбеатс.

   > [!NOTE]
   > Для правильной работы ускорителя требуется концентратор данных. Не рекомендуется удалять концентратор данных без удаления ускорителя.

3. Выберите группы ресурсов и введите имя концентратора данных или группы ресурсов ускорителя, которые необходимо удалить.
4. Выберите имя группы ресурсов. Введите имя еще раз, чтобы выполнить двойной контроль, и выберите Удалить, чтобы удалить группу ресурсов и все ее базовые ресурсы.
5. Кроме того, можно удалить каждый ресурс вручную, что не рекомендуется.
7. Для удаления или удаления концентратора данных перейдите в группу ресурсов непосредственно в Azure и удалите группу ресурсов.

## <a name="next-steps"></a>Следующие шаги

Вы развернули Azure Фармбеатс. Теперь научитесь [создавать фермы](manage-farms.md#create-farms).
