---
title: Ссылки для Фармбеатс
description: ''
author: uhabiba04
ms.topic: article
ms.date: 11/04/2019
ms.author: v-umha
ms.openlocfilehash: efd294910531509d736dbda274406bd7c801c124
ms.sourcegitcommit: a10074461cf112a00fec7e14ba700435173cd3ef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/12/2019
ms.locfileid: "73931201"
---
# <a name="references"></a>Справочники

Ниже приведена Коллекция заметок и инструкций, которые описывают интерфейсы API Фармбеатс для Azure.

## <a name="rest-api"></a>Интерфейс REST API

Интерфейсы API Фармбеатс для Azure предоставляют сельскохозяйственное бизнес с стандартизированным интерфейсом RESTFUL с ответами на основе JSON, и это поможет вам использовать возможности Фармбеатс Azure:

- API для получения датчиков, камер, помощью Дронов, погоды, вспомогательных и проверенных данных заземления.
- Нормализация/контекстуальность данных в общих поставщиках данных.
- Схематизированных доступ и возможность запросов для всех полученных данных.
- Автоматическое создание метаданных, которые можно запрашивать на основе функций агрономик.  
- Автоматически созданные статистические выражения последовательности времени для быстрого создания модели.
- Интегрированный механизм фабрики данных Azure (ADF), позволяющий легко создавать пользовательские конвейеры обработки данных.

## <a name="application-development"></a>Разработка приложений

API-интерфейсы содержат техническую документацию по Swagger. Сведения обо всех API и соответствующих запросах и ответах см. в разделе [Swagger](https://aka.ms/FarmBeatsDatahubSwagger) .

Сводка по всем объектам и ресурсам в центре данных Фармбеатс:

Хозяйств | Ферма соответствует физическому расположению, представляющему интерес в системе Фармбеатс. Каждая ферма имеет имя фермы и уникальный идентификатор фермы.
--- | ---|
Устройство  | Устройство соответствует физическому устройству, присутствующему в ферме. Каждое устройство имеет уникальный идентификатор устройства. Устройство обычно подготавливается к ферме с ИДЕНТИФИКАТОРом фермы.
DeviceModel  | DeviceModel соответствует метаданным устройства, например изготовителю, тип устройства — шлюз или узел.
Датчик  | Датчик соответствует физическому датчику, записывающему значения. Датчик обычно подключается к устройству с ИДЕНТИФИКАТОРом устройства.
сенсормодел  | Сенсормодел соответствует метаданным датчика, таким как производитель, тип датчика: аналоговая или цифровая, мера датчика, например внешняя температура, давление и т. д.
Телеметрия  | Данные телеметрии позволяют читать сообщения телеметрии для определенного датчика и диапазона времени.
Job  | Задание соответствует любому рабочему процессу действий, которые выполняются в системе Фармбеатс для получения нужных выходных данных. Каждое задание связано с ИДЕНТИФИКАТОРом задания и типом задания.
JobType  | JobType соответствует различным типам заданий, поддерживаемым системой. К ним относятся определенные системой & определяемые пользователем типы заданий.
ExtendedType  | ExtendedType соответствует списку системных & определяемых пользователем типов в системе. Это помогает настроить новый датчик или сцену или тип Сценефиле в системе Фармбеатс.
Партнер  | Партнер соответствует партнеру по интеграции датчиков и образов для Фармбеатс
Сцены  | Сцена соответствует всем созданным выходным данным в контексте фермы. У каждой сцены есть идентификатор сцены, источник сцены, тип сцены и идентификатор фермы, связанные с ней. С каждым ИДЕНТИФИКАТОРом сцены может быть связано несколько файлов сцены.
сценефиле |Сценефиле соответствует всем файлам, созданным для одной сцены. С одним ИДЕНТИФИКАТОРом сцены может быть связано несколько идентификаторов Сценефиле.
Правило  |Правило соответствует условию для данных, связанных с фермой, для активации предупреждения. Каждое правило будет находиться в контексте данных фермы.
Предупреждение  | Предупреждение соответствует уведомлению, которое создается при выполнении условия правила. Каждое предупреждение будет находиться в контексте правила.
RoleDefinition  | Определения роли определяет разрешенные и запрещенные действия для роли.
RoleAssignment  |RoleAssignment соответствует назначению роли пользователю или субъекту-службе.

**Формат данных**

JSON (нотация объектов JavaScript) — это распространенный, не зависящий от языка формат данных, предоставляющий простое текстовое представление произвольных структур данных. Дополнительные сведения см. в разделе json.org.

## <a name="authentication-and-authorization"></a>Аутентификация и авторизация

HTTP-запросы к REST API защищены с помощью Azure Active Directory (Azure AD).
Чтобы выполнить запрос, прошедший проверку подлинности в API-интерфейсах, клиентский код требует проверки подлинности с действительными учетными данными перед вызовом API. Проверка подлинности согласовывается между различными субъектами Azure AD и предоставляет клиенту маркер доступа в качестве подтверждения проверки подлинности. Затем маркер отправляется в заголовке авторизации HTTP запросов REST API. Дополнительные сведения о проверке подлинности Azure AD см. в статье [Azure Active Directory](https://portal.azure.com) для разработчиков.

Маркер доступа должен быть отправлен в последующих запросах API в разделе заголовка следующим образом:

```
headers = {"Authorization": "Bearer " + **access_token**}
```

**Заголовки HTTP-запросов**

Ниже приведены наиболее распространенные заголовки запросов, которые необходимо указать при вызове API в концентратор данных Azure Фармбеатс.


**Верхняя часть** | **Описание и пример**
--- | ---
Content-Type  | Формат запроса (Content-Type: Application/<format>) для API-интерфейсов центра данных Azure Фармбеатс — это JSON. Тип содержимого: Application/JSON
Авторизация  | Указывает маркер доступа, необходимый для выполнения вызова API. **Авторизация: носитель < доступ — токен >**
Принять | Формат ответа. Для интерфейсов API концентратора данных Azure Фармбеатс используется формат JSON **Accept: Application/JSON.**

**Запросы API**

Чтобы выполнить запрос REST API, необходимо объединить метод HTTP (GET, POST, WHERE или DELETE), URL-адрес службы API, URI для запроса, отправки данных в, обновления или удаления, а также один или несколько заголовков HTTP-запроса.

URL-адрес службы API — это URL-адрес концентратора данных https://\<йоурдатахуб-website-name >. azurewebsites. NET. при необходимости можно включить параметры запроса на вызов GET для фильтрации, ограничить размер и отсортировать данные в ответах.

Ниже приведен пример запроса для получения списка устройств:

```bash
curl -X GET "https://microsoft-farmbeats.azurewebsites.net/Device" -H "Content-Type: application/json" -H "Authorization: Bearer <Access-Token>”
```

Для большинства вызовов GET, POST и постановки требуется текст запроса JSON.

Приведенный ниже пример запроса заключается в создании устройства (у него есть входные данные JSON с текстом запроса).

```bash
curl -X POST "https://microsoft-farmbeats.azurewebsites.net/Device" -H  "accept: application/json" -H  "Content-Type: application/json" -H "Authorization: Bearer <Access-Token>" -d "{  \"deviceModelId\": \"ID123\",  \"hardwareId\": \"MHDN123\",  \"reportingInterval\": 900,  \"name\": \"Device123\",  \"description\": \"Test Device 123\",}"
```

**параметры запроса**.

Для вызовов **Get** RESTful можно фильтровать, ограничивать размер и отсортировать данные в ответе API, включив один или несколько параметров запроса в URI запроса. Сведения о параметрах запроса см. в документации по API и просмотре отдельных вызовов GET.
Например, при запросе списка устройств (GET call on/девице) можно указать следующие параметры запроса:  

![Перебивает ферму проекта](./media/for-references/query-parameters-device-1.png)

**Обработка ошибок**

API концентратора данных Azure Фармбеатс возвращает стандартные ошибки HTTP. Ниже приведены наиболее распространенные коды ошибок.

 |Код ошибки             | ОПИСАНИЕ |
 |---                    | --- |
 |200                    | Успешно |
 |201                    | Создание (POST) успешно завершено |
 |400                    | Недопустимый запрос. Ошибка в запросе |
 |401                    | Не авторизовано. Вызывающий интерфейс API не имеет прав доступа к ресурсу |
 |404                    | Ресурс не найден |
 |5XX                    | Внутренняя ошибка сервера. Коды ошибок, начинающиеся с 5XX, означают наличие ошибки на сервере. Дополнительные сведения см. в журналах сервера и в следующем разделе. |


Помимо стандартных ошибок HTTP, API концентратора данных Azure Фармбеатс также возвращают внутренние ошибки в следующем формате:

```json
    {
      "message": "<More information on the error>",
      "status": "<error code>”,
      "code": "<InternalErrorCode>",
      "moreInfo": "<Details of the error>"
    }
```

Пример. при создании фермы обязательное поле "имя" не было указано во входных данных. Полученное сообщение об ошибке будет выглядеть следующим образом:

 ```json    
    {
      "message": "Model validation failed",
      "status": 400,
      "code": "ModelValidationFailed",
      "moreInfo": "[\"The Name field is required.\"]"
    }
  ```

## <a name="adding-users-or-app-registrations-to-azure-active-directory"></a>Добавление пользователей или регистраций приложений в Azure Active Directory

Доступ к интерфейсам API Фармбеатс для Azure можно получить у пользователя или регистрации приложения в Azure Active Directory. Чтобы создать регистрацию приложения на Azure Active Directory, выполните следующие действия.  

1. Перейдите в [портал Azure](https://portal.azure.com) **Azure Active Directory, регистрация приложений**> **новую регистрацию**. Кроме того, можно использовать существующую учетную запись.
2. Для новой учетной записи обязательно выполните следующие действия.

    - Введите имя.
    - Выбрать **учетные записи только в этом каталоге организации (один клиент)**
    - Значения по умолчанию в остальных полях
    - Выбор **регистра**

3. В разделе **Общие сведения о**регистрации нового или существующего приложения выполните следующие действия.

    - Запишите **идентификатор клиента** и **идентификатор**клиента.
    - Перейдите к разделу **Сертификаты и секреты** , чтобы создать новый секрет клиента и записать **секрет клиента**.
    - Вернитесь к обзору и щелкните ссылку рядом с пунктом **Управление приложением в локальном каталоге** .
    - Перейдите к **свойствам** для записи **идентификатора объекта**

4. Перейдите к [Swagger в центре данных](https://<yourdatahub>.azurewebsites.net/swagger/index.html) и выполните следующие действия.
    - Перейдите к **API RoleAssignment**
    - Выполните **запись** , чтобы создать RoleAssignment для только что созданного **идентификатора объекта** . — Входной JSON:

  > [!NOTE]
  > Дополнительные сведения о добавлении пользователей и регистрации AD см. в разделе [Azure Active Directory](https://docs.microsoft.com/azure/active-directory/develop/howto-create-service-principal-portal) .

После выполнения описанных выше действий регистрация приложения (клиент) может вызывать API-интерфейсы Фармбеатс для Azure с помощью маркера доступа через проверку подлинности носителя.  

Используйте маркер доступа, чтобы отправить его в последующих запросах API в разделе заголовка следующим образом:

```
headers = {"Authorization": "Bearer " + **access_token**, "Content-Type" : "application/json" }
```
