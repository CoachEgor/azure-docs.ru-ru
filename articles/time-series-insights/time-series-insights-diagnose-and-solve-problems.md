---
title: Диагностика, устранение неполадок и устранение неполадок — служба "аналитика временных рядов Azure"
description: В этой статье описывается диагностика, устранение неполадок и решение распространенных проблем в среде службы "аналитика временных рядов Azure".
ms.service: time-series-insights
services: time-series-insights
author: deepakpalled
ms.author: dpalled
manager: cshankar
ms.reviewer: v-mamcge
ms.workload: big-data
ms.topic: troubleshooting
ms.date: 02/04/2020
ms.custom: seodec18
ms.openlocfilehash: 4d9efa1ebf1a3e3b146c4f45b0e84047562141cd
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "82192720"
---
# <a name="diagnose-and-solve-issues-in-your-time-series-insights-environment"></a>Диагностика и устранение неполадок в среде "Аналитика временных рядов Azure"

В этой статье описываются проблемы, которые могут возникнуть в среде службы "аналитика временных рядов Azure". В статье перечислены возможные причины проблем и способы их устранения.

## <a name="video"></a>Видеоролик

### <a name="learn-about-common-time-series-insights-challenges-and-mitigationsbr"></a>Дополнительные сведения о проблемах и предотвращении анализа временных рядов</br>

> [!VIDEO https://www.youtube.com/embed/7U0SwxAVSKw]

## <a name="problem-no-data-is-shown"></a>Проблема. данные не отображаются

Если в обозревателе службы " [аналитика временных рядов Azure](https://insights.timeseries.azure.com)" не отображаются данные, следует рассмотреть следующие распространенные причины.

### <a name="cause-a-event-source-data-isnt-in-json-format"></a>Причина: данные источника события не находятся в формате JSON

Среда службы "Аналитика временных рядов Azure" поддерживает только данные в формате JSON. Примеры JSON см. в разделе [Поддерживаемые формы JSON](./how-to-shape-query-json.md).

### <a name="cause-b-the-event-source-key-is-missing-a-required-permission"></a>Причина б. у ключа источника события отсутствует требуемое разрешение

* Для центра Интернета вещей в центре Интернета вещей Azure необходимо указать ключ, имеющий разрешения на подключение к службе. Выберите **iothubowner** или политику **службы** . Оба имеют разрешения на подключение к службе.

   [![Разрешение на подключение службы Центра Интернета вещей](media/diagnose-and-solve-problems/iothub-serviceconnect-permissions.png)](media/diagnose-and-solve-problems/iothub-serviceconnect-permissions.png#lightbox)

* Для концентратора событий в концентраторах событий Azure необходимо указать ключ, имеющий разрешения на прослушивание. Политики **чтения** и **управления** будут работать, так как они оба имеют разрешения на прослушивание.

   [![Разрешение на прослушивание для концентратора событий](media/diagnose-and-solve-problems/eventhub-listen-permissions.png)](media/diagnose-and-solve-problems/eventhub-listen-permissions.png#lightbox)

### <a name="cause-c-the-provided-consumer-group-isnt-exclusive-to-time-series-insights"></a>Причина C. Указанная группа потребителей не является монопольной для аналитики временных рядов

При регистрации Центра Интернета вещей или концентратора событий важно задать группу потребителей, которая будет использоваться для чтения данных. Эта группа потребителей *не может использоваться совместно*. В противном случае базовый центр Интернета вещей или концентратор событий автоматически отключит один из модулей чтения в случайном порядке. Укажите уникальную группу получателей, из которой должна считывать данные среда службы "Аналитика временных рядов".

### <a name="cause-d-the-environment-has-just-been-provisioned"></a>Причина D: только что подготовлено окружение

Данные будут отображаться в обозревателе "аналитика временных рядов" в течение нескольких минут после создания среды и ее данных.

## <a name="problem-some-data-is-shown-but-data-is-missing"></a>Проблема. отображаются некоторые данные, но отсутствуют данные

Если данные появляются только частично и кажется, что данные задержкой, следует учесть эти возможные проблемы.

### <a name="cause-a-your-environment-is-being-throttled"></a>Причина: ваша среда регулируется

[Регулирование](time-series-insights-environment-mitigate-latency.md) является распространенной проблемой при подготовке сред после создания источника событий, который содержит данные. Центр Интернета вещей Azure и концентраторы событий Azure хранят данные до семи дней. Аналитика временных рядов всегда начинается с самого раннего события в источнике событий («первым поступил», «первым вышел» или « *FIFO*»).

Например, если у вас есть 5 миллионов событий в источник событий при подключении к S1, одномерная среда аналитики временных рядов, "Аналитика временных рядов" будет считывать примерно 1 млн событий в день. Может показаться, что "Аналитика временных рядов" будет отставать на пять дней. Но что происходит в том, что среда регулируется.

Если у вас есть старые события в источнике событий, можно использовать один из двух способов, описанных ниже.

- Измените ограничения периода хранения источника событий, чтобы избавиться от старых событий, которые не должны быть в среде "Аналитика временных рядов".
- Подготовьте среду большего размера (с большим количеством единиц), чтобы увеличить пропускную способность старых событий. В предыдущем примере, если вы увеличиваете ту же среду S1 до пяти единиц в течение одного дня, среда должна находиться в течение дня. Если событие стабильного состояния составляет 1 000 000 или меньше событий в день, можно уменьшить емкость события до одной единицы после того, как аналитика временных рядов будет перехватываться.

Принудительное ограничение регулирования основано на типе и емкости SKU среды. Все источники событий в среде совместно используют емкость. Если источник событий для центра Интернета вещей или концентратора событий отправляет данные сверх установленных ограничений, вы будете регулировать регулирование и задержку.

На рисунке ниже показана среда "Аналитика временных рядов" с номером SKU S1 и емкостью 3. Она может принимать 3 миллиона событий в день.

[![Емкость среды](media/diagnose-and-solve-problems/environment-sku-current-capacity.png)](media/diagnose-and-solve-problems/environment-sku-current-capacity.png#lightbox)

Представьте себе среду, принимающую сообщения из концентратора событий. Он имеет дневную частоту входящих сообщений о 67 000 сообщениях. Такая скорость соответствует примерно 46 сообщениям каждую минуту.

* Если все сообщения концентратора событий свести к одному событию "Аналитика временных рядов", станет понятно, что здесь регулирование не применяется.
* Если все сообщения концентратора событий свести к 100 событиям службы "Аналитика временных рядов", каждую минуту будет передаваться по 4600 событий.

Среда с номером SKU S1 и емкостью 3 может принимать только 2100 событий в минуту (1 миллион событий в день = 700 событий в минуту на 3 единицы = 2100 событий в минуту).

Чтобы получить общее представление о принципах работы логики обработки, см. раздел [поддерживаемые фигуры JSON](./how-to-shape-query-json.md).

#### <a name="recommended-resolutions-for-excessive-throttling"></a>Рекомендуемые действия по устранению проблемы чрезмерного регулирования

Чтобы устранить задержку, увеличьте емкость номера SKU среды. Дополнительные сведения см. [в статье масштабирование среды "аналитика временных рядов](time-series-insights-how-to-scale-your-environment.md)".

### <a name="cause-b-initial-ingestion-of-historical-data-slows-ingress"></a>Причина б. при первом приеме исторических данных происходит медленный входящий трафик

При подключении существующего источника событий вполне вероятно, что центр Интернета вещей или концентратор событий уже содержит данные. Среда начинает извлекать данные, как только сообщения источника событий начинают сохраняться. Эта обработка по умолчанию не может быть переопределена. Вы можете включить регулирование. Регулирование может занять некоторое время, пока будет отслеживаться прием хронологических данных.

#### <a name="recommended-resolutions-for-large-initial-ingestion"></a>Рекомендуемые решения для большого начального объема принимаемых данных

Устранение задержки.

1. Увеличьте емкость номера SKU до максимально допустимого значения (в этом случае — 10). После увеличения емкости принимаемые данные начнут обрабатываться значительно быстрее. Плата будет оплачена за счет увеличения емкости. Степень ускорения можно увидеть в таблице доступности в [обозревателе службы "Аналитика временных рядов"](https://insights.timeseries.azure.com).

2. Устранив задержку, уменьшите емкость номера SKU до обычного уровня приема.

## <a name="problem-data-was-showing-previously-but-is-no-longer-showing"></a>Проблема. данные были показаны ранее, но больше не отображаются

Если служба "аналитика временных рядов" больше не принимает данные, но события по-прежнему передаются в центр Интернета вещей или концентратор событий, рассмотрим эту потенциальную причину.

### <a name="cause-a-your-hub-access-key-was-regenerated-and-your-environment-needs-to-be-updated"></a>Причина: ключ доступа к концентратору был создан повторно, и необходимо обновить среду.

Эта проблема возникает, когда ключ, указанный при создании источника события, больше не является допустимым. В концентраторе будут отображаться данные телеметрии, но не входящие сообщения, полученные в ходе анализа временных рядов. Если нет уверенности в том, что ключ был создан повторно, можно выполнить поиск в журнале действий для "Создание или обновление правил авторизации пространства имен". В центре Интернета вещей выполните поиск по запросу "Создание или обновление ресурса IotHub".

Чтобы обновить среду "аналитика временных рядов" с помощью нового ключа, откройте ресурс-концентратор в портал Azure и скопируйте новый ключ. Перейдите к ресурсу "аналитика временных рядов" и выберите **источники событий**:

   [![Выбор источников событий](media/diagnose-and-solve-problems/update-hub-key-step-1.png)](media/diagnose-and-solve-problems/update-hub-key-step-1.png#lightbox)

Выберите источник или источники событий, из которых остановлен прием, вставьте новый ключ и нажмите кнопку **сохранить**:

   [![Вставить новый ключ](media/diagnose-and-solve-problems/update-hub-key-step-2.png)](media/diagnose-and-solve-problems/update-hub-key-step-2.png#lightbox)

## <a name="problem-the-event-sources-timestamp-property-name-setting-doesnt-work"></a>Проблема. параметр имени свойства метки времени источника событий не работает

Убедитесь, что значение свойства timestamp, которое берется из источника события в виде строки JSON, имеет формат _гггг-мм-ddTHH: mm: SS. FFFFFFFK_. Вот пример: **2008-04-12T12:53Z**.

Помните, что в имени свойства метки времени учитывается регистр.

Самый простой способ убедиться, что имя свойства метки времени зафиксировано и работает правильно, — использовать обозреватель службы "Аналитика временных рядов". В обозревателе службы "Аналитика временных рядов" с помощью диаграммы выберите время, прошедшее после ввода имени свойства метки времени. Щелкните выделенный фрагмент правой кнопкой мыши и выберите пункт **Просмотр событий**.

Заголовок первого столбца — это имя вашего свойства метки времени. Рядом с словом **timestamp** **($TS)** будет отображаться.

Следующие значения не будут отображаться:

- *(ABC)*: указывает, что аналитика временных рядов считывает значения данных в виде строк.
- *Значок календаря*: указывает, что аналитика временных рядов считывает значения данных в виде значений DateTime.
- *#*: Указывает, что аналитика временных рядов считывает значения данных как целые числа.

## <a name="next-steps"></a>Следующие шаги

- Узнайте [, как устранить задержку в службе "аналитика временных рядов Azure](time-series-insights-environment-mitigate-latency.md)".

- Узнайте [, как масштабировать среду "аналитика временных рядов](time-series-insights-how-to-scale-your-environment.md)".
