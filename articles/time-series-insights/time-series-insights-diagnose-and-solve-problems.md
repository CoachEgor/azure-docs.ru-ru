---
title: Диагностика, устранение неполадок и решение проблем - Azure Time Series Исследования (ru) Документы Майкрософт
description: В этой статье описывается, как диагностировать, устранить неполадки и решить общие проблемы в среде Исследования времени Azure.
ms.service: time-series-insights
services: time-series-insights
author: deepakpalled
ms.author: dpalled
manager: cshankar
ms.reviewer: v-mamcge, jasonh, kfile
ms.workload: big-data
ms.topic: troubleshooting
ms.date: 02/04/2020
ms.custom: seodec18
ms.openlocfilehash: 209df97169c71d910677ffdb2e2b12593882445b
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80152602"
---
# <a name="diagnose-and-solve-issues-in-your-time-series-insights-environment"></a>Диагностика и устранение неполадок в среде "Аналитика временных рядов Azure"

В этой статье описаны некоторые проблемы, которые могут возникнуть в среде "Аналитика временных рядов Azure". В статье перечислены возможные причины проблем и способы их устранения.

## <a name="video"></a>Видеоролик

### <a name="learn-about-common-time-series-insights-customer-challenges-and-mitigationsbr"></a>Узнайте об общих проблемах и проблемах клиентов Time Series Insights.</br>

> [!VIDEO https://www.youtube.com/embed/7U0SwxAVSKw]

## <a name="problem-no-data-is-shown"></a>Проблема: данные не отображаться

Отсутствие данных в [обозревателе службы "Аналитика временных рядов Azure"](https://insights.timeseries.azure.com) может возникнуть из-за нескольких наиболее распространенных причин.

### <a name="cause-a-event-source-data-isnt-in-json-format"></a>Причина A: данные источника событий не в формате JSON

Среда службы "Аналитика временных рядов Azure" поддерживает данные только в формате JSON. Для образцов JSON прочитайте [поддерживаемые формы JSON.](./how-to-shape-query-json.md)

### <a name="cause-b-the-event-source-key-is-missing-a-required-permission"></a>Причина B: ключ источника событий отсутствует требуемое разрешение

* Для Центра Интернета вещей в Центре Интернета вещей Azure необходимо указать ключ с разрешениями на **подключение службы**. Выберите политики **iothubowner** или **службы,** так как оба имеют разрешения **на подключение службы.**

   [![Разрешение на подключение службы Центра Интернета вещей](media/diagnose-and-solve-problems/iothub-serviceconnect-permissions.png)](media/diagnose-and-solve-problems/iothub-serviceconnect-permissions.png#lightbox)

* Для концентратора событий в концентраторах событий Azure необходимо указать ключ с разрешением **listen**. Политики **read** или **manage** будут работать, поскольку у них обеих есть разрешение **listen**.

   [![Разрешение на прослушивание для концентратора событий](media/diagnose-and-solve-problems/eventhub-listen-permissions.png)](media/diagnose-and-solve-problems/eventhub-listen-permissions.png#lightbox)

### <a name="cause-c-the-consumer-group-provided-isnt-exclusive-to-time-series-insights"></a>Причина C: представленная группа потребителей не является исключительной для Time Series Insights

При регистрации Центра Интернета вещей или концентратора событий важно задать группу потребителей, которая будет использоваться для чтения данных. Эта группа потребителей *не может использоваться совместно*. В противном случае базовый центр Интернета вещей или концентратор событий автоматически отключит один из модулей чтения в случайном порядке. Укажите уникальную группу получателей, из которой должна считывать данные среда службы "Аналитика временных рядов".

### <a name="cause-d-the-environment-has-just-been-provisioned"></a>Причина D: окружающая среда только что была подготовлена

Данные появятся в исследователе Time Series Insights в течение нескольких минут после того, как среда и ее данные будут впервые созданы.

## <a name="problem-some-data-is-shown-but-data-is-missing"></a>Проблема: некоторые данные отображаемы, но данные отсутствуют

Если данные отображаются лишь частично и, по-видимому, присутствует задержка в отображении данных, необходимо учитывать несколько возможностей.

### <a name="cause-a-your-environment-is-being-throttled"></a>Причина A: ваша среда задушена

[Регулирование](time-series-insights-environment-mitigate-latency.md) — это распространенная проблема, когда среды подготовлены после создания источника событий с данными. Центр Интернета вещей Azure и концентраторы событий Azure хранят данные до семи дней. Аналитика временных рядов всегда начинается с наиболее старого события в источнике событий (первым пришел — первым ушел, или *FIFO*).

Например, если у вас есть 5 миллионов событий в источник событий при подключении к S1, одномерная среда аналитики временных рядов, "Аналитика временных рядов" будет считывать примерно 1 млн событий в день. Может показаться, что "Аналитика временных рядов" будет отставать на пять дней. На самом же деле происходит регулирование среды.

Если у вас есть старые события в источнике событий, можно использовать один из двух способов, описанных ниже.

- Измените ограничения периода хранения источника событий, чтобы избавиться от старых событий, которые не должны быть в среде "Аналитика временных рядов".
- Подготовьте среду большего размера (с большим количеством единиц), чтобы увеличить пропускную способность старых событий. В рамках предыдущего примера, если вы увеличите среду S1 до пяти единиц за один день, эта среда будет обрабатываться в течение дня. Если у вас стабильно получается 1 млн или меньше событий в день, можно уменьшить емкость события на единицу после его обработки.

Ограничение регулирования применяется на основе типа номера SKU и емкости среды. Все источники событий в среде совместно используют емкость. Если источник событий для концентратора IoT или концентратора событий выдвигает данные за пределы обязательных пределов, вы будете испытывать регулирование и задержку.

На рисунке ниже показана среда "Аналитика временных рядов" с номером SKU S1 и емкостью 3. Она может принимать 3 миллиона событий в день.

[![Текущая емкость номера SKU среды](media/diagnose-and-solve-problems/environment-sku-current-capacity.png)](media/diagnose-and-solve-problems/environment-sku-current-capacity.png#lightbox)

В качестве примера предположим, что среда глотает сообщения из концентратора событий. ежедневная частота приема данных составляет около 67 000 сообщений. Такая скорость соответствует примерно 46 сообщениям каждую минуту. 

* Если все сообщения концентратора событий свести к одному событию "Аналитика временных рядов", станет понятно, что здесь регулирование не применяется. 
* Если все сообщения концентратора событий свести к 100 событиям службы "Аналитика временных рядов", каждую минуту будет передаваться по 4600 событий. 

Среда с номером SKU S1 и емкостью 3 может принимать только 2100 событий в минуту (1 миллион событий в день = 700 событий в минуту на 3 единицы = 2100 событий в минуту). 

Для понимания на высоком уровне того, как работает логика уплощения, прочитайте [поддерживаемые формы JSON.](./how-to-shape-query-json.md)

#### <a name="recommended-resolutions-for-excessive-throttling"></a>Рекомендуемые действия по устранению проблемы чрезмерного регулирования

Чтобы устранить задержку, увеличьте емкость номера SKU среды. Для получения дополнительной информации прочитайте [среду «Масштабирование серии времени».](time-series-insights-how-to-scale-your-environment.md)

### <a name="cause-b-initial-ingestion-of-historical-data-slows-ingress"></a>Причина B: начальное проглатывание исторических данных замедляет проникновение

При подключении существующего источника событий вполне вероятно, что центр Интернета вещей или концентратор событий уже содержит данные. Среда начинает извлекать данные, как только сообщения источника событий начинают сохраняться. Эта обработка по умолчанию не может быть переопределена. Вы можете включить регулирование. Регулирование может занять некоторое время, пока будет отслеживаться прием хронологических данных.

#### <a name="recommended-resolutions-for-large-initial-ingestion"></a>Рекомендуемые решения для большого начального объема принимаемых данных

Устранение задержки.

1. Увеличьте емкость номера SKU до максимально допустимого значения (в этом случае — 10). После увеличения емкости принимаемые данные начнут обрабатываться значительно быстрее. Плата взимается за увеличенную емкость. Степень ускорения можно увидеть в таблице доступности в [обозревателе службы "Аналитика временных рядов"](https://insights.timeseries.azure.com).

2. Устранив задержку, уменьшите емкость номера SKU до обычного уровня приема.

## <a name="problem-data-was-showing-previously-but-is-no-longer-showing"></a>Проблема: данные показывали ранее, но больше не отображали

TSI больше не глотает данные, но события по-прежнему потоковой передачи в Iot hub или Event Hub

### <a name="cause-a-your-hub-access-key-was-regenerated-and-your-environment-needs-updating"></a>Причина A: ключ доступа к концентратору был регенерирован, а среда нуждается в обновлении

Эта проблема возникает, когда ключ, предоставленный при создании источника событий, больше не действителен. Вы увидите телеметрию в вашем концентраторе, но не Ingress получил сообщения в Time Series Исследования. Если вы не уверены, был ли регенерирован ключ, вы можете высмотреть журнал активности концентраторов событий для "Создать или обновить правила авторизации namespace" или найти "Создать или обновить ресурс IotHub" для концентратора IoT.

Обновление среды Time Series Insights с помощью нового ключа открывает ресурс концентратора на портале Azure и копирует новый ключ. Перейдите на ресурс TSI и нажмите на источники событий. 

   [![Обновление ключа.](media/diagnose-and-solve-problems/update-hub-key-step-1.png)](media/diagnose-and-solve-problems/update-hub-key-step-1.png#lightbox)

Выберите источник событий (ы), которые имеют, из которых проглатывание остановилось, вставьте в новый ключ и нажмите Сохранить.

   [![Обновление ключа.](media/diagnose-and-solve-problems/update-hub-key-step-2.png)](media/diagnose-and-solve-problems/update-hub-key-step-2.png#lightbox)

## <a name="problem-my-event-sources-timestamp-property-name-setting-doesnt-work"></a>Проблема: настройка имени источника времени в исходном времени моего источника событий не работает

Убедитесь, что имя и значение свойства метки времени соответствуют следующим правилам.

* В имени свойства метки времени учитывается регистр.
* Так как значение свойства метки времени из источника событий является строкой JSON, оно должно иметь формат _гггг-мм-ддТчч:мм:сс.FFFFFFFK_. Например, **2008-04-12T12:53Z**.

Самый простой способ убедиться, что имя свойства метки времени зафиксировано и работает правильно, — использовать обозреватель службы "Аналитика временных рядов". В обозревателе службы "Аналитика временных рядов" с помощью диаграммы выберите время, прошедшее после ввода имени свойства метки времени. Щелкните выделение правой кнопкой мыши и выберите параметр **Обзор событий**.

Заголовок первого столбца — это имя вашего свойства метки времени. Рядом со словом **Timestamp** **($ts)** будет отображаться.

Следующие значения не отображаются:

- *(abc)*: Указывает на то, что Time Series Insights считывал значения данных в виде строк.
- *Значок календаря*: Указывает, что Time Series Insights считывал значение данных как *время даты.*
- *#*: Указывает на то, что Time Series Insights считывал значения данных как целый ряд.

## <a name="next-steps"></a>Дальнейшие действия

- Читайте о [том, как уменьшить задержку в Azure Time Series Insights](time-series-insights-environment-mitigate-latency.md).

- [Узнайте, как масштабировать среду Time Series Insights.](time-series-insights-how-to-scale-your-environment.md)