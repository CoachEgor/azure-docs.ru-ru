---
title: Диагностика и решение проблем в службе "Аналитика временных рядов Azure" | Документация Майкрософт
description: В этой статье описываются способы диагностики, устранения неполадок и решения распространенных проблем, с которыми вы можете столкнуться в среде службы "Аналитика временных рядов Azure".
ms.service: time-series-insights
services: time-series-insights
author: ashannon7
ms.author: dpalled
manager: cshankar
ms.reviewer: v-mamcge, jasonh, kfile, anshan
ms.workload: big-data
ms.topic: troubleshooting
ms.date: 05/07/2019
ms.custom: seodec18
ms.openlocfilehash: 68d46b54bf066724d8f3474f421d2d1f751b75e3
ms.sourcegitcommit: 509e1583c3a3dde34c8090d2149d255cb92fe991
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/27/2019
ms.locfileid: "66235045"
---
# <a name="diagnose-and-solve-issues-in-your-time-series-insights-environment"></a>Диагностика и устранение неполадок в среде "Аналитика временных рядов Azure"

В этой статье описаны некоторые проблемы, которые могут возникнуть в среде "Аналитика временных рядов Azure". В статье перечислены возможные причины проблем и способы их устранения.

## <a name="video"></a>Видео

### <a name="learn-about-common-time-series-insights-customer-challenges-and-mitigationsbr"></a>Дополнительные сведения о синхронизации времени Series Insights клиента проблемы и способы их устранения.</br>

> [!VIDEO https://www.youtube.com/embed/7U0SwxAVSKw]

## <a name="problem-no-data-is-shown"></a>Проблема: данные не отображаются

Отсутствие данных в [обозревателе службы "Аналитика временных рядов Azure"](https://insights.timeseries.azure.com) может возникнуть из-за нескольких наиболее распространенных причин.

### <a name="cause-a-event-source-data-isnt-in-json-format"></a>Причина ответ событий источника данных не в формате JSON

Среда службы "Аналитика временных рядов Azure" поддерживает данные только в формате JSON. Примеры JSON см. в разделе [Поддерживаемые формы JSON](./how-to-shape-query-json.md).

### <a name="cause-b-the-event-source-key-is-missing-a-required-permission"></a>Причина б: для ключа источника события отсутствует необходимое разрешение

* Для Центра Интернета вещей в Центре Интернета вещей Azure необходимо указать ключ с разрешениями на **подключение службы**. Политики **iothubowner** или **service** будут работать, поскольку у них обеих есть разрешения **service connect**.

   [![Разрешения на подключение службы центра Интернета вещей](media/diagnose-and-solve-problems/iothub-serviceconnect-permissions.png)](media/diagnose-and-solve-problems/iothub-serviceconnect-permissions.png#lightbox)

* Для концентратора событий в концентраторах событий Azure необходимо указать ключ с разрешением **listen**. Политики **read** или **manage** будут работать, поскольку у них обеих есть разрешение **listen**.

   [![Разрешения прослушивание концентратора событий](media/diagnose-and-solve-problems/eventhub-listen-permissions.png)](media/diagnose-and-solve-problems/eventhub-listen-permissions.png#lightbox)

### <a name="cause-c-the-consumer-group-provided-isnt-exclusive-to-time-series-insights"></a>Причина C: указанная группа потребителей не уникальной для Time Series Insights

При регистрации Центра Интернета вещей или концентратора событий важно задать группу потребителей, которая будет использоваться для чтения данных. Эта группа потребителей *не может использоваться совместно*. В противном случае базовый центр Интернета вещей или концентратор событий автоматически отключит один из модулей чтения в случайном порядке. Укажите уникальную группу получателей, из которой должна считывать данные среда службы "Аналитика временных рядов".

## <a name="problem-some-data-is-shown-but-data-is-missing"></a>Проблема: некоторые данные отображаются, но данные отсутствуют

Если данные отображаются лишь частично и, по-видимому, присутствует задержка в отображении данных, необходимо учитывать несколько возможностей.

### <a name="cause-a-your-environment-is-being-throttled"></a>Причина а: среду регулируется

Регулирование — это распространенная проблема, когда среды подготавливаются после создания источника событий с данными. Центр Интернета вещей Azure и концентраторы событий Azure хранят данные до семи дней. Аналитика временных рядов всегда начинается с наиболее старого события в источнике событий (первым пришел — первым ушел, или *FIFO*).

Например, если у вас есть 5 миллионов событий в источник событий при подключении к S1, одномерная среда аналитики временных рядов, "Аналитика временных рядов" будет считывать примерно 1 млн событий в день. Может показаться, что "Аналитика временных рядов" будет отставать на пять дней. На самом же деле происходит регулирование среды.

Если у вас есть старые события в источнике событий, можно использовать один из двух способов, описанных ниже.

- Измените ограничения периода хранения источника событий, чтобы избавиться от старых событий, которые не должны быть в среде "Аналитика временных рядов".
- Подготовьте среду большего размера (с большим количеством единиц), чтобы увеличить пропускную способность старых событий. В рамках предыдущего примера, если вы увеличите среду S1 до пяти единиц за один день, эта среда будет обрабатываться в течение дня. Если у вас стабильно получается 1 млн или меньше событий в день, можно уменьшить емкость события на единицу после его обработки.

Ограничение регулирования применяется на основе типа номера SKU и емкости среды. Все источники событий в среде совместно используют емкость. Если источник событий Центра Интернета вещей или концентратора событий превышает ограничение объема передаваемых данных, наблюдается регулирование и задержка.

На рисунке ниже показана среда "Аналитика временных рядов" с номером SKU S1 и емкостью 3. Она может принимать 3 миллиона событий в день.

![Текущая емкость номера SKU среды](media/diagnose-and-solve-problems/environment-sku-current-capacity.png)](media/diagnose-and-solve-problems/environment-sku-current-capacity.png#lightbox)

Например, предположим, что эта среда принимает сообщения от концентратора событий. На следующем рисунке показана скорость поступления входящих данных:

[![Пример скорости входящих данных для концентратора событий](media/diagnose-and-solve-problems/eventhub-ingress-rate.png)](media/diagnose-and-solve-problems/eventhub-ingress-rate.png#lightbox)

ежедневная частота приема данных составляет около 67 000 сообщений. Такая скорость соответствует примерно 46 сообщениям каждую минуту. Если все сообщения концентратора событий свести к одному событию "Аналитика временных рядов", станет понятно, что здесь регулирование не применяется. Если все сообщения концентратора событий свести к 100 событиям службы "Аналитика временных рядов", каждую минуту будет передаваться по 4600 событий. Среда с номером SKU S1 и емкостью 3 может принимать только 2100 событий в минуту (1 миллион событий в день = 700 событий в минуту на 3 единицы = 2100 событий в минуту). В этой конфигурации из-за регулирования проявится задержка.

Подробные сведения о логике сведения см. в разделе [Поддерживаемые формы JSON](./how-to-shape-query-json.md).

#### <a name="recommended-resolutions-for-excessive-throttling"></a>Рекомендуемые действия по устранению проблемы чрезмерного регулирования

Чтобы устранить задержку, увеличьте емкость номера SKU среды. Дополнительные сведения см. в статье [Как масштабировать среду Azure Time Series Insights](time-series-insights-how-to-scale-your-environment.md).

### <a name="cause-b-initial-ingestion-of-historical-data-slows-ingress"></a>Причина б: начальное получение исторических данных замедляет входящих данных

При подключении существующего источника событий вполне вероятно, что центр Интернета вещей или концентратор событий уже содержит данные. Среда начинает извлекать данные, как только сообщения источника событий начинают сохраняться. Такая обработка по умолчанию не может быть переопределен. Вы можете включить регулирование. Регулирование может занять некоторое время, пока будет отслеживаться прием хронологических данных.

#### <a name="recommended-resolutions-for-large-initial-ingestion"></a>Рекомендуемые решения для большого начального объема принимаемых данных

Устранение задержки.

1. Увеличьте емкость номера SKU до максимально допустимого значения (в этом случае — 10). После увеличения емкости принимаемые данные начнут обрабатываться значительно быстрее. Плата взимается за увеличенную емкость. Степень ускорения можно увидеть в таблице доступности в [обозревателе службы "Аналитика временных рядов"](https://insights.timeseries.azure.com).

2. Устранив задержку, уменьшите емкость номера SKU до обычного уровня приема.

## <a name="problem-my-event-sources-timestamp-property-name-setting-doesnt-work"></a>Проблема: параметр имени свойства метки времени источника события не работает

Убедитесь, что имя и значение свойства метки времени соответствуют следующим правилам.

* В имени свойства метки времени учитывается регистр.
* Так как значение свойства метки времени из источника событий является строкой JSON, оно должно иметь формат _гггг-мм-ддТчч:мм:сс.FFFFFFFK_. Например, **2008-04-12T12:53Z**.

Самый простой способ убедиться, что имя свойства метки времени зафиксировано и работает правильно, — использовать обозреватель службы "Аналитика временных рядов". В обозревателе службы "Аналитика временных рядов" с помощью диаграммы выберите время, прошедшее после ввода имени свойства метки времени. Щелкните выделение правой кнопкой мыши и выберите параметр **Обзор событий**.

Заголовок первого столбца — это имя вашего свойства метки времени. Рядом со словом **Timestamp** (Метка времени), вы должны увидеть **($ts)** .

Вы не должны видеть следующие значения.

- *(abc)* . Указывает на то, что служба "Аналитика временных рядов" считывает значения данных как строки.
- *Значок календаря*. Указывает на то, что служба "Аналитика временных рядов" считывает значения данных как дату/время.
- *#* . Указывает на то, что служба "Аналитика временных рядов" считывает значения данных как целое значение.

## <a name="next-steps"></a>Дальнейшие действия

- Если вам понадобится помощь, начните с [форума MSDN](https://social.msdn.microsoft.com/Forums/home?forum=AzureTimeSeriesInsights) или [Stack Overflow](https://stackoverflow.com/questions/tagged/azure-timeseries-insights).

- Также вы можете получить помощь в службе [поддержки Azure](https://azure.microsoft.com/support/options/).
