---
title: Как контролировать и уменьшить регулирование - Azure Time Series Исследования Документы Майкрософт
description: Узнайте, как отслеживать, диагностировать и устранять проблемы с производительностью, которые вызывают задержку и регулирование в Azure Time Series Insights.
ms.service: time-series-insights
services: time-series-insights
author: deepakpalled
ms.author: dpalled
manager: cshankar
ms.reviewer: v-mamcge, jasonh, kfile
ms.devlang: csharp
ms.workload: big-data
ms.topic: troubleshooting
ms.date: 01/21/2020
ms.custom: seodec18
ms.openlocfilehash: 2812b535c7aef7987db7106bfa6b07e15a1b61c7
ms.sourcegitcommit: 8dc84e8b04390f39a3c11e9b0eaf3264861fcafc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/13/2020
ms.locfileid: "81263392"
---
# <a name="monitor-and-mitigate-throttling-to-reduce-latency-in-azure-time-series-insights"></a>Отслеживание и уменьшение регулирования для сокращения задержек в службе "Аналитика временных рядов Azure"

Если объем входящих данных превышает пределы, установленные в конфигурации вашей среды, в службе "Аналитика временных рядов Azure" могут возникнуть задержки или регулирования.

Чтобы избежать задержки и регулирования, следует правильно настроить среду для того объема данных, который поступает для анализа.

Задержки и регулирования чаще всего возникают в следующих случаях.

- Если вы добавили новый источник событий, содержащий много данных за предыдущие периоды, и скорость передачи этих данных превышает выделенный для среды лимит (службе "Аналитика временных рядов" потребуется некоторое время, чтобы восстановить актуальность).
- Если вы добавили в среду дополнительные источники событий, в результате чего увеличился объем получаемых событий и, возможно, превысил емкость вашей среды.
- Если вы передали в источник событий большой объем архивных данных (службе "Аналитика временных рядов" потребуется некоторое время, чтобы восстановить актуальность).
- Если вы добавили новые сведения о телеметрии, что увеличило размер событий. Максимально допустимый размер пакета составляет 32 кБ; пакеты данных размером более 32 кБ усечены.

## <a name="video"></a>Видеоролик

### <a name="learn-about-time-series-insights-data-ingress-behavior-and-how-to-plan-for-itbr"></a>Узнайте о поведении Time Series Insights в данных и о том, как его спланировать.</br>

> [!VIDEO https://www.youtube.com/embed/npeZLAd9lxo]

## <a name="monitor-latency-and-throttling-with-alerts"></a>Мониторинг задержки и регулирования с помощью оповещений

Оповещения могут помочь вам диагностировать и смягчить проблемы задержки, возникающие в вашей среде.

1. Выберите нужную среду Аналитики временных рядов на портале Azure. Затем выберите **оповещения**.

   [![Добавьте оповещение в среду Исследования временных рядов](media/environment-mitigate-latency/mitigate-latency-add-alert.png)](media/environment-mitigate-latency/mitigate-latency-add-alert.png#lightbox)

1. Выберите **+ Новое правило генерации оповещений**. Затем будет отображаться панель **правил «Создание».** Выберите **Добавить** под **CONDITION**.

   [![Добавить панель оповещения](media/environment-mitigate-latency/mitigate-latency-add-pane.png)](media/environment-mitigate-latency/mitigate-latency-add-pane.png#lightbox)

1. Затем наймите точные условия для логики сигнала.

   [![Настройка логики сигналов](media/environment-mitigate-latency/configure-alert-rule.png)](media/environment-mitigate-latency/configure-alert-rule.png#lightbox)

   Оттуда можно настроить оповещения, используя некоторые из следующих условий:

   |Метрика  |Описание  |
   |---------|---------|
   |**Ingress Received Bytes** (Получено байт входящих данных)     | Количество байтов необработанной информации, полученных от источников событий. Обычно в этот объем включается имя и значение свойства.  |  
   |**Ingress Received Invalid Messages** (Получено недопустимых сообщений во входящих данных)     | Число недопустимых сообщений, полученных от всех источников событий (Центров событий Azure и Центров Интернета вещей Azure).      |
   |**Ingress Received Messages** (Получено сообщений входящих данных)   | Количество сообщений, полученных от всех источников событий (Центров событий Azure и Центров Интернета вещей Azure).        |
   |**Ingress Stored Bytes** (Хранится байтов входящих данных)     | Общий размер сохраненных событий, доступных для запросов. В этот объем включаются только значения свойств.        |
   |**События, хранящиеся в проникновении**    |   Общее количество сведенных и сохраненных событий, доступных для запросов.      |
   |**Ingress Received Message Time Lag**     (Интервал задержки для полученных сообщений входящих данных)|  Разница в секундах между временем, когда сообщение помещается в очередь источника событий, и временем, когда сообщение обрабатывается во входящих сообщениях.      |
   |**Ingress Received Message Count Lag**     (Интервал между номерами полученных сообщений во входящих данных)|  Разница между порядковым номером последнего сообщения в очереди событий источника секции и порядковым номером сообщения, обрабатываемого во входящих сообщениях.      |

   Нажмите кнопку **Готово**.

1. После настройки желаемой логики сигнала внимательно просмотрите выбранное правило оповещения.

   [![Представление задержки и составление графиков](media/environment-mitigate-latency/mitigate-latency-view-and-charting.png)](media/environment-mitigate-latency/mitigate-latency-view-and-charting.png#lightbox)

## <a name="throttling-and-ingress-management"></a>Управление дроссельной заслонкой и проникновением

* Если вас задушат, будет зарегистрировано значение для *Ingress Received Message Time Lag,* информирующее вас о том, сколько секунд отстает от среды TIme Series Insights от фактического времени попадания сообщения в источник событий (за исключением времени индексации приложения. 30–60 секунд).  

  Метрика *Ingress Recieved Message Count Lag* (Интервал между номерами полученных сообщений во входящих данных) также должна иметь значение, которое позволяет определить, на сколько сообщений вы отстали.  Самым простым способом устранить задержку является увеличение емкости среды до размера, который позволит сделать это.  

  Например, если среда S1 демонстрирует отставание в 5 000 000 сообщений, можно увеличить размер среды до шести единиц примерно за день, чтобы увязнуть.  Чтобы устранить задержку еще быстрее, количество единиц можно увеличить еще. Увеличение периода — обычная практика при первоначальной настройке среды, особенно когда вы подключаете ее к источнику событий, в котором уже есть события или когда вы загружаете много исторических данных.

* Кроме того, вы можете установить оповещение, которое сработает, если значение параметра **Ingress Stored Events** (Хранится сообщений входящих данных) в течение 2 часов превышает некоторое пороговое значение, установленное чуть ниже общей емкости вашей среды.  Такое предупреждение позволит понять, что возможности среды постоянно используются полностью, что указывает на высокую вероятность задержки. 

  Например, если вы подготовили три единицы S1 (с общим объемом 2100 входящих запросов в минуту), установите оповещение "**Ingress Stored Events** >= 1900 в течение 2 часов". Если среда регулярно достигает этого предела и активирует это оповещение, то скорее всего вы выделили недостаточно ресурсов.  

* Если вы подозреваете, что вас задушат, вы можете сравнить полученные **сообщения Ingress** с высаженные сообщения источника событий.  Если число сообщений, поступающих в концентратор событий, превышает значение **Ingress Received Messages**, значит Аналитика временных рядов применяет регулирование.

## <a name="improving-performance"></a>Повышение производительности

Если вы хотите уменьшить регулирование или устранить задержки, мы рекомендуем увеличить емкость вашей среды.

Чтобы избежать задержки и регулирования, следует правильно настроить среду для того объема данных, который поступает для анализа. Для получения дополнительной информации о том, как добавить емкость в окружающую среду, прочитайте [Масштабирование среды.](time-series-insights-how-to-scale-your-environment.md)

## <a name="next-steps"></a>Дальнейшие действия

- Читайте о [диагностике и решении проблем в среде Time Series Insights.](time-series-insights-diagnose-and-solve-problems.md)

- [Узнайте, как масштабировать среду Time Series Insights.](time-series-insights-how-to-scale-your-environment.md)