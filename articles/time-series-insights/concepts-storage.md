---
title: Общие сведения о хранилище — служба "аналитика временных рядов Azure" | Документация Майкрософт
description: Сведения о хранении данных в службе "аналитика временных рядов Azure".
author: esung22
ms.author: elsung
manager: diegoviso
ms.workload: big-data
ms.service: time-series-insights
services: time-series-insights
ms.topic: conceptual
ms.date: 06/03/2020
ms.custom: seodec18
ms.openlocfilehash: fc6b6b42293b4f2028f1a12af950e96e28febc87
ms.sourcegitcommit: 124f7f699b6a43314e63af0101cd788db995d1cb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/08/2020
ms.locfileid: "86085571"
---
# <a name="data-storage"></a>Хранилище данных

При создании среды SKU "аналитика временных рядов *" с оплатой по мере* использования (PAYG) вы создадите два ресурса Azure:

* Среда службы "аналитика временных рядов Azure", которую можно настроить для резервного хранения данных.
* Учетная запись хранения Azure для "холодного" хранилища данных.

Данные в горячем хранилище доступны только через [запрос временных рядов](./time-series-insights-update-tsq.md) и обозреватель службы " [аналитика временных рядов Azure](./time-series-insights-update-explorer.md)". Последние данные будут храниться в теплом хранилище в течение [срока хранения](./time-series-insights-update-plan.md#the-preview-environment), выбранного при создании среды Аналитики временных рядов.

Служба "аналитика временных рядов Azure" сохраняет данные холодного магазина в хранилище BLOB-объектов Azure в [формате файла Parquet](#parquet-file-format-and-folder-structure). Аналитика временных рядов управляет только данными этого холодного хранилища, но может быть доступна для чтения непосредственно в виде стандартных файлов Parquet.

> [!WARNING]
> Владелец учетной записи хранения BLOB-объектов Azure, где находятся данные холодного хранилища, имеет полный доступ ко всем данным в учетной записи. В эти права доступа входят разрешения на запись и удаление. Не изменяйте и не удаляйте данные, которые записываются службой "аналитика временных рядов Azure", так как это может привести к потере данных.

## <a name="data-availability"></a>Доступность данных

Секции "аналитика временных рядов Azure" и индексы данных для оптимальной производительности запросов. Данные становятся доступными для запроса из горячего (если включено) и холодного хранилища после индексирования. Доступность данных зависит от объема принимаемых данных.

> [!IMPORTANT]
> До появления данных может произойти период до 60 секунд. Если уровень задержки значительно выше, отправьте запрос в службу поддержки на портале Azure.

## <a name="azure-storage"></a>Хранилище Azure

В этом разделе описываются подробные сведения о службе хранилища Azure, относящиеся к службе "аналитика временных рядов Azure".

Подробное описание хранилища BLOB-объектов Azure см. в статье [Общие сведения о хранилище BLOB-объектов Azure](../storage/blobs/storage-blobs-introduction.md).

### <a name="your-storage-account"></a>Ваша учетная запись хранения

При создании среды PAYG "аналитика временных рядов Azure" в качестве долгосрочного холодного магазина создается учетная запись хранения Azure.  

Служба "аналитика временных рядов Azure" позволяет хранить до двух копий каждого события в учетной записи хранения Azure. Одна копия хранит события, упорядоченные по времени приема, всегда разрешая доступ к событиям в упорядоченной по времени последовательности. Со временем "аналитика временных рядов" также создает повторно секционированную копию данных для оптимизации выполнения запроса "аналитика временных рядов".

Все ваши данные хранятся в учетной записи хранения Azure бессрочно.

#### <a name="writing-and-editing-time-series-insights-blobs"></a>Записывание и изменение больших двоичных объектов Аналитики временных рядов

Чтобы обеспечить производительность запросов и доступность данных, не изменяйте и не удаляйте большие двоичные объекты, создаваемые во время создания аналитики временных рядов.

#### <a name="accessing-time-series-insights-cold-store-data"></a>Доступ к данным для холодного хранения "аналитика временных рядов"

Помимо доступа к данным из [обозревателя "аналитика временных рядов](./time-series-insights-update-explorer.md) " и [запроса временных рядов](./time-series-insights-update-tsq.md), также может потребоваться доступ к данным непосредственно из файлов Parquet, хранящихся в холодном хранилище. Например, можно считывать, преобразовывать и очищать данные в записной книжке Jupyter, а затем использовать их для обучения модели Машинного обучения Azure в том же рабочем процессе Spark.

Для доступа к данным напрямую из учетной записи хранения Azure необходим доступ на чтение к учетной записи, используемой для хранения данных Аналитики временных рядов (предварительная версия). Затем можно считывать выбранные данные на основе времени создания файла Parquet, расположенного в папке `PT=Time`, описанной ниже в разделе [Формат файла Parquet](#parquet-file-format-and-folder-structure).  Дополнительные сведения о включении доступа на чтение для учетной записи хранения см. в статье об [управлении доступом к ресурсам учетной записи хранения](../storage/blobs/storage-manage-access-to-resources.md).

#### <a name="data-deletion"></a>Удаление данных

Не удаляйте файлы службы "аналитика временных рядов Azure". Управление связанными данными только в Azure Time Series Insights.

### <a name="parquet-file-format-and-folder-structure"></a>Формат файла Parquet и структура папок

Parquet — это формат столбца с открытым исходным кодом, предназначенный для эффективного хранения и производительности. Служба "аналитика временных рядов Azure" использует Parquet для включения производительности запросов на основе идентификатора временных рядов в масштабе.  

Дополнительные сведения о типе файла Parquet см. в [документации по Parquet](https://parquet.apache.org/documentation/latest/).

Служба "аналитика временных рядов Azure" хранит копии данных следующим образом:

* Первая начальная копия секционируется по времени приема и сохраняет данные в примерном порядке поступления. Эти данные содержатся в папке `PT=Time`:

  `V=1/PT=Time/Y=<YYYY>/M=<MM>/<YYYYMMDDHHMMSSfff>_<TSI_INTERNAL_SUFFIX>.parquet`

* Вторая повторно секционированная копия группируется по идентификаторам временных рядов и находится в папке `PT=TsId`:

  `V=1/PT=TsId/<TSI_INTERNAL_NAME>.parquet`

Метка времени в именах больших двоичных объектов в `PT=Time` папке соответствует времени прибытия данных в службу "аналитика временных рядов Azure", а не метке времени событий.

С течением времени данные в папке `PT=TsId` будут оптимизированы для запросов и не являются статическими. Во время повторного секционирования некоторые события могут присутствовать в нескольких больших двоичных объектах. Именование больших двоичных объектов в этой папке не обязательно будет оставаться неизменным. 

В общем случае, если требуется доступ к данным напрямую через Parquet файлы, используйте `PT=Time` папку.  Будущие функции будут включать эффективный доступ к `PT=TsId` папке. 

> [!NOTE]
>
> * `<YYYY>` сопоставляется с представлением 4-значного числа года.
> * `<MM>` сопоставляется с представлением 2-значного числа месяца.
> * `<YYYYMMDDHHMMSSfff>` сопоставляется с представлением отметки времени с 4-значным числом года (`YYYY`), 2-значным числом месяца (`MM`), 2-значным числом дня (`DD`), 2-значным числом часа (`HH`), 2-значным числом минуты (`MM`), 2-значным числом секунды (`SS`) и 3-значным числом миллисекунды (`fff`).

События Аналитики временных рядов (предварительная версия) сопоставляются с содержимым файла Parquet следующим образом.

* Каждое событие сопоставляется с отдельной строкой.
* Каждая строка содержит столбец **метки времени** с меткой времени события. Свойство time-stamp никогда не имеет значение NULL. По умолчанию используется **событие, поставленное в очередь** , если свойство метки времени не указано в источнике события. Сохраненная метка времени всегда имеет формат UTC.
* Каждая строка содержит столбцы идентификаторов временных рядов (TSID), как определено при создании среды Аналитики временных рядов. Имя свойства TSID содержит суффикс `_string`.
* Все остальные свойства, отправленные как данные телеметрии, сопоставляются с именами столбцов, заканчивающимися на `_bool` (Boolean), `_datetime` (отметка времени), `_long` (Long), `_double` (Double), `_string` (строка) или `dynamic` (Dynamic), в зависимости от типа свойства.  Дополнительные сведения см. в статье о [поддерживаемых типах данных](./concepts-supported-data-types.md).
* Эта схема сопоставления применяется к первой версии формата файла (**V=1**) и хранится в базовой папке с тем же именем. По мере развития этой функции схема сопоставления может измениться, а номер версии — увеличиться.

## <a name="next-steps"></a>Дальнейшие действия

* Ознакомьтесь со сведениями о [моделировании данных](./time-series-insights-update-tsm.md).

* Спланируйте [среду предварительной версии службы "аналитика временных рядов Azure](./time-series-insights-update-plan.md)".
