---
title: Добавление поддержки для типа данных Long | Документация Майкрософт
description: Поддержка типа данных Long
ms.service: time-series-insights
services: time-series-insights
author: deepakpalled
ms.author: dpalled
manager: cshankar
ms.workload: big-data
ms.topic: conceptual
ms.date: 06/16/2020
ms.custom: dpalled
ms.openlocfilehash: ebb62b67b56134902f2752b43dd25fb0a7c6ccd4
ms.sourcegitcommit: e132633b9c3a53b3ead101ea2711570e60d67b83
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/07/2020
ms.locfileid: "86045779"
---
# <a name="adding-support-for-long-data-type"></a>Добавление поддержки для типа данных Long

Эти изменения будут применены только к средам предварительной версии (PAYG). При наличии стандартной среды TSI SKU вы можете не обращать внимания на эти изменения.

Мы делаем изменения в способах хранения и индексирования числовых данных в предварительной версии службы "аналитика временных рядов Azure", которые могут повлиять на вас. Если вы оказываете влияние в любом из перечисленных ниже случаев, внесите необходимые изменения как можно скорее. Ваши данные будут индексироваться как длинные и Double в диапазоне от 29 июня до 30 июня 2020 в зависимости от вашего региона. Если у вас есть вопросы или проблемы, связанные с этим изменением, отправьте запрос в службу поддержки через портал Azure и упоминание об этом взаимодействии.

Это изменение влияет на работу в следующих случаях:

1. Если в настоящее время используются переменные модели временных рядов и в данных телеметрии посылаются только целочисленные типы данных.
1. Если в настоящее время используются переменные модели временных рядов и в данных телеметрии посылаются как целочисленные, так и Нецелочисленные типы данных.
1. При использовании переменных категории для отображения целочисленных значений по категориям.
1. Если вы используете пакет SDK для JavaScript для создания пользовательского клиентского приложения.
1. Если вы приближаете ограничение имени свойства 1 000 в горячий магазин (WS) и отправляете как целочисленные, так и Нецелочисленные данные, число свойств можно просмотреть как метрику в [портал Azure](https://portal.azure.com/).

Если какой бы то ни было из приведенных выше вариантов к вам, необходимо внести изменения в модель, чтобы удовлетворить это изменение. Обновите выражение временного ряда в определении переменной в TSI Explorer и в любом пользовательском клиенте, используя наши API с рекомендуемыми изменениями. Подробности см. ниже.

В зависимости от решения и ограничений Интернета вещей вы можете не видеть данные, отправляемые в среду TSI PAYG. Если вы не уверены, являются ли данные целыми или как целыми, так и нецелыми, у вас есть несколько вариантов. Можно подождать, пока компонент будет освобожден, а затем исследовать необработанные события в пользовательском интерфейсе обозревателя, чтобы понять, какие свойства были сохранены в двух отдельных столбцах. Вы можете сделать изменения ниже для всех числовых тегов или временно направить подмножество событий в хранилище, чтобы лучше понять и исследовать схему. Чтобы сохранить события, включите [запись событий](https://docs.microsoft.com/azure/event-hubs/event-hubs-capture-overview) для концентраторов событий или [отправьте](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-messages-d2c#azure-storage) их из центра Интернета вещей в хранилище BLOB-объектов Azure. Данные также можно наблюдать в [обозревателе концентратора событий](https://marketplace.visualstudio.com/items?itemName=Summer.azure-event-hub-explorer)или с помощью [узла обработчика событий](https://docs.microsoft.com/azure/event-hubs/event-hubs-dotnet-standard-getstarted-send#receive-events). Если вы используете центр Интернета вещей, ознакомьтесь с [документацией, посвященной](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-messages-read-builtin) доступу к встроенной конечной точке.

Обратите внимание, что если эти изменения зависят от этих изменений и не могут сделать их по указанным выше датам, то может возникнуть сбой, когда затронутые переменные временных рядов, к которым осуществлялся доступ через API запросов или обозреватель аналитики временных рядов, будут возвращать *значение NULL* (т. е. не показывать данные в обозревателе).

## <a name="recommended-changes"></a>Рекомендуемые изменения

Вариант 1 & 2. **Использование переменных модели временных рядов и отправка только целочисленных типов данных или отправка как целочисленных, так и нецелочисленных типов в данных телеметрии.**

Если в настоящее время выполняется отправка целочисленных данных телеметрии, данные будут разделены на два столбца: "propertyValue_double" и "propertyValue_long".

Целочисленные данные будут записаны в "propertyValue_long", когда изменения вступают в действие и ранее принятые (и будущие принятые) числовые данные в "propertyValue_double" не будут скопированы.

Если вы хотите запросить данные в этих двух столбцах для свойства "propertyValue", необходимо использовать скалярную функцию *объединения ()* в целевом компьютере. Функция принимает аргументы одного и того же типа данных и возвращает первое значение, отличное от NULL, в списке аргументов (Подробнее об использовании см. [здесь](https://docs.microsoft.com/rest/api/time-series-insights/preview#other-functions)).

### <a name="variable-definition-in-time-series-explorer---numeric"></a>Определение переменной в обозревателе временных рядов (numeric)

*Предыдущее определение переменной:*

[![Предыдущее определение переменной](media/time-series-insights-long-data-type/var-def-previous.png)](media/time-series-insights-long-data-type/var-def-previous.png#lightbox)

*Новое определение переменной:*

[![Создать определение переменной](media/time-series-insights-long-data-type/var-def.png)](media/time-series-insights-long-data-type/var-def.png#lightbox)

В качестве пользовательского [выражения временных рядов](https://docs.microsoft.com/rest/api/time-series-insights/preview#time-series-expression-and-syntax) также можно использовать *"объединения ($Event. PropertyValue. Double, toDouble ($Event. PropertyValue. Long))"* .

### <a name="inline-variable-definition-using-time-series-query-apis---numeric"></a>Определение встроенных переменных с помощью API запросов временных рядов — числовые значения

*Предыдущее определение переменной:*

    "PropertyValueVariable": {

        "kind": "numeric",

        "value": {

            "tsx": "$event.propertyValue.Double"

        },

        "filter": null,

        "aggregation": {

            "tsx": "avg($value)"

*Новое определение переменной:*

    "PropertyValueVariable ": {

        "kind": "numeric",

        "value": {

            "tsx": "coalesce($event.propertyValue.Long, toLong($event.propertyValue.Double))"

        },

        "filter": null,

        "aggregation": {

            "tsx": "avg($value)"

В качестве пользовательского [выражения временных рядов](https://docs.microsoft.com/rest/api/time-series-insights/preview#time-series-expression-and-syntax) также можно использовать *"объединения ($Event. PropertyValue. Double, toDouble ($Event. PropertyValue. Long))"* .

> [!NOTE]
> Рекомендуется обновлять эти переменные во всех местах, где они могут использоваться (модель временных рядов, сохраненные запросы, Power BI запросы соединителей).

Вариант 3. **Использование переменных категории для отображения целочисленных значений по категориям**

Если в настоящее время используются переменные категории, которые сопоставляют целочисленные значения с категориями, то, скорее всего, вы используете функцию Толонг для преобразования данных из типа Double в тип long. Как и в случае с приведенными выше примерами, необходимо объединить столбцы типа Double и long.

### <a name="variable-definition-in-time-series-explorer---categorical"></a>Определение переменной в обозревателе временных рядов — Категория

*Предыдущее определение переменной:*

[![Предыдущее определение переменной](media/time-series-insights-long-data-type/var-def-cat-previous.png)](media/time-series-insights-long-data-type/var-def-cat-previous.png#lightbox)

*Новое определение переменной:*

[![Создать определение переменной](media/time-series-insights-long-data-type/var-def-cat.png)](media/time-series-insights-long-data-type/var-def-cat.png#lightbox)

В качестве пользовательского [выражения временных рядов](https://docs.microsoft.com/rest/api/time-series-insights/preview#time-series-expression-and-syntax) также можно использовать *"объединения ($Event. PropertyValue. Double, toDouble ($Event. PropertyValue. Long))"* .

Переменная категории по-прежнему требует, чтобы значение было целочисленным типом. Тип данных всех аргументов объединения () должен быть типа long в пользовательском [выражении временных рядов.](https://docs.microsoft.com/rest/api/time-series-insights/preview#time-series-expression-and-syntax)

### <a name="inline-variable-definition-using-time-series-query-apis---categorical"></a>Определение встроенных переменных с помощью API запросов временных рядов — Категория

*Предыдущее определение переменной:*

    "PropertyValueVariable_Long": {

        "kind": "categorical",

        "value": {

            "tsx": "tolong($event.propertyValue.Double)"

        },

        "categories": [

        {
            "label": "Good",

            "values": [0, 1, 2 ]

        },

        {

            "label": "Bad",

            "values": [ 3, 4 ]

        } ],

        "defaultCategory": {

            "label": "Unknown"

        }

    }

*Новое определение переменной:*

    "PropertyValueVariable_Long": {

        "kind": "categorical",

        "value": {

            "tsx": "coalesce($event.propertyValue.Long, tolong($event.propertyValue.Double))"

        },

        "categories": [

        {
            "label": "Good",

            "values": [0, 1, 2 ]

        },

        {

            "label": "Bad",

            "values": [ 3, 4 ]

        } ],

        "defaultCategory": {

            "label": "Unknown"

        }

    }

Переменная категории по-прежнему требует, чтобы значение было целочисленным типом. Тип данных всех аргументов объединения () должен быть типа long в пользовательском [выражении временных рядов.](https://docs.microsoft.com/rest/api/time-series-insights/preview#time-series-expression-and-syntax)

> [!NOTE]
> Рекомендуется обновлять эти переменные во всех местах, где они могут использоваться (модель временных рядов, сохраненные запросы, Power BI запросы соединителей).

Пример 4. **Использование пакета SDK для JavaScript для создания пользовательского клиентского приложения**

Если вы затронули сценарии 1-3 выше и создаете пользовательские приложения, необходимо обновить запросы для использования функции *объединения ()* , как показано в приведенных выше примерах.

Вариант 5. **ближайшее ограничение на свойство для теплого хранилища 1 000**

Если вы являетесь пользователем горячего магазина с большим количеством свойств и считаете, что это изменение приведет к принудительной отправке среды через ограничение имени свойства 1 000 WS, отправьте запрос в службу поддержки через портал Azure и сообщите об этом взаимодействии.

## <a name="next-steps"></a>Дальнейшие шаги

* Полный список поддерживаемых типов данных см. в [этой](concepts-supported-data-types.md) статье.
