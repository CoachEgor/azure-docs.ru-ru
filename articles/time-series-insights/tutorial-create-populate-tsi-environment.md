---
title: Руководство по Создание среды Azure Time Series Insights | Документация Майкрософт
description: Здесь описано, как создать среду службы "Аналитика временных рядов" и заполнить ее данными из имитированных устройств.
services: time-series-insights
author: ashannon7
ms.service: time-series-insights
ms.topic: tutorial
ms.date: 04/26/2019
ms.author: anshan
manager: cshankar
ms.custom: seodec18
ms.openlocfilehash: 42a7ba0c66bd603b19d60c7b3407ae5ca80db28e
ms.sourcegitcommit: 0568c7aefd67185fd8e1400aed84c5af4f1597f9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65209890"
---
# <a name="tutorial-create-an-azure-time-series-insights-environment"></a>Руководство. Создание среды службы "Аналитика временных рядов Azure"

Это руководство поможет вам создать среду "Аналитика временных рядов" (TSI), заполненной данными из имитированных устройств. Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Создание среды TSI 
> * создание решения для имитированных устройств, содержащее Центр Интернета вещей;
> * подключение среды TSI к Центру Интернета вещей;
> * запуск имитации устройств для потоковой передачи данных в среду TSI;
> * проверка имитированных данных телеметрии.

## <a name="video"></a>Видео

### <a name="learn-how-to-use-an-azure-iot-solution-accelerator-to-generate-data-and-get-started-with-time-series-insights-br"></a>Узнайте, как с помощью акселератора решений Интернета вещей Azure создать данные и приступить к работе с Аналитикой временных рядов. </br>

> [!VIDEO https://www.youtube.com/embed/6ehNf6AJkFo]

## <a name="prerequisites"></a>Предварительные требования

* Если у вас еще нет подписки Azure, создайте [бесплатную учетную запись](https://azure.microsoft.com/free/).

* Эта учетная запись Azure должна быть включена в роль **Владелец** для подписки. Дополнительные сведения см. в статье [Управление доступом с помощью RBAC и портала Azure](/azure/role-based-access-control/role-assignments-portal).

## <a name="overview"></a>Обзор

Среда TSI собирает и хранит данные устройств. К данным, сохраненным в среде TSI, можно применять запросы и анализ с помощью [TSI Explorer](time-series-quickstart.md) и [API запросов TSI](/rest/api/time-series-insights/ga-query-api). Центр Интернета вещей представляет собой точку подключения, к которой устройства (имитированные или физические) подключаются для защищенной передачи данных в облако Azure. В [обзоре TSI](time-series-insights-overview.md) указывается, что Центр Интернета вещей также выполняет роль источника событий для потоковой передачи данных в среду TSI. В этом учебнике применяется [акселератор решений Интернета вещей](/azure/iot-accelerators/) для создания и потоковой передачи образца данных телеметрии в Центр Интернета вещей.

>[!TIP]
> Акселераторы решений Интернета вещей предоставляют готовые настроенные решения корпоративного уровня, позволяя ускорить разработку настраиваемых решений Интернета вещей.

## <a name="create-a-tsi-environment"></a>Создание среды TSI

Создайте среду TSI в подписке Azure, сделав следующее:

1. Войдите на [портал Azure](https://portal.azure.com), используя учетную запись подписки Azure.  
1. Щелкните **+Создать ресурс** слева вверху.  
1. Выберите категорию **Интернет вещей**, а затем щелкните **Аналитика временных рядов**.  

   [![Выбор ресурса среды Time Series Insights](media/tutorial-create-populate-tsi-environment/ap-create-resource-tsi.png)](media/tutorial-create-populate-tsi-environment/ap-create-resource-tsi.png#lightbox)

1. На странице **среды службы "Аналитика временных рядов"** введите значения для обязательных параметров.

   Параметр|ОПИСАНИЕ
   ---|---
   **Имя среды** | Выберите уникальное имя для среды TSI. Это имя используется в обозревателе TSI и интерфейсах API запросов.
   **Подписка** | Подписки служат контейнерами для ресурсов Azure. Выберите подписку для создания среды TSI.
   **Группа ресурсов** | Группа ресурсов Azure служит контейнером для ресурсов Azure. Выберите существующую группу ресурсов для ресурса среды TSI или создайте новую.
   **Местоположение.** | Выберите регион для центра обработки данных, в котором будет размещаться среда TSI. Чтобы избежать лишних затрат на передачу данных и ненужных сетевых задержек, лучше всего хранить среду TSI в одном регионе с остальными ресурсами Интернета вещей.
   **Ценовая категория (SKU)** | Выберите необходимую пропускную способность. Для снижения расходов выберите категорию `S1`, которая предоставляет начальную емкость.
   **Производительность** | Производительность обозначает коэффициент, на который умножаются характеристики скорости для поступления данных, емкости хранилища и стоимости выбранной категории SKU.  Вы можете изменить емкость после создания. Чтобы избежать лишних затрат, выберите значение емкости "1".

   Завершив ввод данных, щелкните **Создать решение**, чтобы начать процесс подготовки.

   [![Создание ресурса среды Аналитики временных рядов](media/tutorial-create-populate-tsi-environment/ap-create-resource-tsi-params.png)](media/tutorial-create-populate-tsi-environment/ap-create-resource-tsi-params.png#lightbox)

1. Используйте панель **Уведомления**, чтобы отслеживать выполнение развертывания.  

   [![Успешное развертывание среды Аналитики временных рядов](media/tutorial-create-populate-tsi-environment/ap-create-resource-tsi-deployment-succeeded.png)](media/tutorial-create-populate-tsi-environment/ap-create-resource-tsi-deployment-succeeded.png#lightbox)

## <a name="create-a-device-simulation"></a>Создание имитации устройств

Теперь вам нужно создать решение для имитации устройств, которое будет создавать тестовые данные для заполнения среды TSI.

1. В отдельном окне или вкладке перейдите по адресу [azureiotsolutions.com](https://www.azureiotsolutions.com). Выполните вход с той же учетной записью подписки Azure и выберите акселератор решения **Имитация устройств**.

   [![Запуск акселератора "Имитация устройств"](media/tutorial-create-populate-tsi-environment/sa-main.png)](media/tutorial-create-populate-tsi-environment/sa-main.png#lightbox)

1. Введите необходимые параметры на странице **Create Device Simulation solution** (Создание решения для имитации устройств).

   Параметр|ОПИСАНИЕ
   ---|---
   **Имя решения** | Уникальное значение, которое используется при создании новой группы ресурсов. В эту группу помещаются все выбранные ресурсы Azure после их создания.
   **Подписка** | Укажите ту же подписку, которую вы применяли в предыдущем разделе для создания среды TSI.
   **Регион** | Укажите тот же регион, который вы выбрали в предыдущем разделе для создания среды TSI.
   **Развертывание дополнительных ресурсов Azure** | Сохраните флажок **Центр Интернета вещей**, чтобы имитированное устройству могло подключаться и передавать данные.

   По завершении щелкните **Создать решение**, чтобы подготовить ресурсы Azure для решения. Этот процесс может занять 6–7 минут.

   [![Подготовка решения для имитации устройств](media/tutorial-create-populate-tsi-environment/sa-create-device-sim-solution.png)](media/tutorial-create-populate-tsi-environment/sa-create-device-sim-solution.png#lightbox)

1. Когда подготовка завершится, над новым решением состояние **Подготовка** изменится на **Готово**.

   >[!IMPORTANT]
   > Но не нажимайте пока кнопку **Запуск**! Оставьте эту веб-страницу открытой, так как она вам понадобится позже.

   [![Подготовка решения для имитации устройств завершена](media/tutorial-create-populate-tsi-environment/sa-create-device-sim-solution-dashboard-ready.png)](media/tutorial-create-populate-tsi-environment/sa-create-device-sim-solution-dashboard-ready.png#lightbox)

1. Теперь вернитесь на портал Azure и убедитесь, что новый ресурс появился в вашей подписке. На странице портала **Группы ресурсов** вы увидите новую группу ресурсов с именем, которое совпадает с указанным выше **именем решения**. Также здесь отображаются все ресурсы, созданные для решения имитации устройств:

   [![Ресурсы решения для имитации устройств](media/tutorial-create-populate-tsi-environment/ap-device-sim-solution-resources.png)](media/tutorial-create-populate-tsi-environment/ap-device-sim-solution-resources.png#lightbox)

## <a name="connect-the-tsi-environment-to-the-iot-hub"></a>Подключение среды TSI к Центру Интернета вещей

Итак, вы уже узнали, как создать два набора ресурсов, каждый из которых размещен в собственной группе.

- Пустая среда TSI.
- Ресурсы решения для имитации устройств, включая Центр Интернета вещей, созданные акселератором решений.

Не забывайте, что имитированные устройства должны подключаться к Центру Интернета вещей для потоковой передачи данных. Чтобы передать данные в среду TSI, следует внести изменения в конфигурацию Центра Интернета вещей и среды TSI.

### <a name="iot-hub-configuration-define-a-consumer-group"></a>Настройка Центра Интернета вещей: определение группы потребителей

Центр Интернета вещей предоставляет разные конечные точки, через которые другие субъекты могут использовать его функции. Конечная точка "События" позволяет другим приложениям использовать данные, которые поступают в экземпляр Центра Интернета вещей. В частности, механизм "группы потребителей" позволяет приложениям прослушивать и извлекать данные из Центр Интернета вещей.

Далее в этом руководстве описано, как создать свойство **Группа потребителей** для **конечной точки событий** Центра Интернета вещей в решении для имитации устройств.

1. На портале Azure перейдите к странице **Обзор** созданной ранее группы ресурсов в решении для имитации устройств, а затем выберите ресурс Центра Интернета вещей:

   [![Группа ресурсов в решении для имитации устройств](media/tutorial-create-populate-tsi-environment/ap-add-iot-hub-consumer-group-view-rg.png)](media/tutorial-create-populate-tsi-environment/ap-add-iot-hub-consumer-group-view-rg.png#lightbox)

   Обязательно запишите **Имя** ресурса Центр Интернета вещей, который создан в этом решении. Он понадобится вам позже.

1. Прокрутите экран вниз и выберите страницу **Конечные точки**, а затем выберите конечную точку **События**. На странице **Свойства** для конечной точки введите уникальное имя этой конечной точки в группе потребителей $Default, а затем щелкните **Сохранить**:

   [![Конечные точки Центра Интернета вещей в решении для имитации устройств](media/tutorial-create-populate-tsi-environment/ap-add-iot-hub-consumer-group-create.png)](media/tutorial-create-populate-tsi-environment/ap-add-iot-hub-consumer-group-create.png#lightbox)

### <a name="tsi-configuration-define-an-event-source"></a>Настройка TSI: определение источника событий

Теперь подключите новую конечную точку событий со свойством **Группа потребителей** в Центре Интернета вещей к среде TSI в качестве **источника событий**.

1. Откройте страницу **Обзор** для группы ресурсов, которую вы создали для среды TSI, а затем выберите нужную среду TSI:

   [![Среда TSI и группа ресурсов для этой среды](media/tutorial-create-populate-tsi-environment/ap-add-env-event-source-view-rg.png)](media/tutorial-create-populate-tsi-environment/ap-add-env-event-source-view-rg.png#lightbox)

1. На странице среды TSI выберите **Источники событий** и щелкните **+Добавить**.

   [![Обзор среды TSI](media/tutorial-create-populate-tsi-environment/ap-add-env-event-source-add.png)](media/tutorial-create-populate-tsi-environment/ap-add-env-event-source-add.png#lightbox)

1. Введите необходимые параметры на странице **Новый источник событий**.

   Параметр|ОПИСАНИЕ
   ---|---
   **Имя источника событий** | Здесь нужно указать уникальное значение, которое будет обозначать этот источник событий.
   **Источник** | Выберите **Центр Интернета вещей**.
   **Вариант импорта** | Выберите параметр по умолчанию, `Use IoT hub from available subscriptions`. При этом расположенный ниже раскрывающийся список будет заполнен именами доступных подписок.
   **Подписка** | Выберите ту же подписку, в которой вы создали среду TSI и ресурсы для имитации устройств.
   **Имя Центра Интернета вещей** | Обычно здесь уже будет подставлено имя Центра Интернета вещей, которое вы сохранили ранее. Если это не так, выберите правильный Центр Интернета вещей.
   **Имя политики Центра Интернета вещей** | Выберите **iothubowner**.
   **Группа потребителей Центра Интернета вещей** | Обычно здесь используется стандартное имя группы потребителей Центра Интернета вещей, которую вы создали ранее. В противном случае выберите правильное имя группы потребителей.
   **Формат сериализации событий** | Оставьте значение по умолчанию, `JSON`.
   **Имя свойства для метки времени** | Укажите `timestamp`.

   Завершив ввод данных, щелкните **Создать** для добавления источника событий. Вернувшись на страницу **Обзор** для группы ресурсов, вы увидите рядом с ресурсом среды TSI новый ресурс "Источник событий Аналитики временных рядов".

   [![Новый источник событий в среде TSI](media/tutorial-create-populate-tsi-environment/ap-add-env-event-source-add-event-source.png)](media/tutorial-create-populate-tsi-environment/ap-add-env-event-source-add-event-source.png#lightbox)

## <a name="run-device-simulation-to-stream-data-into-tsi"></a>Выполнение имитации устройства для потоковой передачи данных в TSI

Итак, вы завершили настройку среды. Теперь можно заполнить эту среду TSI тестовыми данными от имитированных устройств.

Как мы уже обсуждали в разделе о [создании имитации устройств](#create-a-device-simulation), акселератор решений автоматически создал несколько ресурсов Azure для поддержки решения. Помимо Центра Интернета вещей, который мы уже описали выше, создано веб-приложение Службы приложений Azure для формирования и передачи данных телеметрии от имитированных устройств.

1. Вернитесь на [панель мониторинга акселератора решений](https://www.azureiotsolutions.com/Accelerators#dashboard). При необходимости войдите в систему с той же учетной записью Azure, которую вы использовали ранее в этом руководстве. Теперь можно нажать кнопку **Запустить** под решением "Имитация устройств".

     [![Панель мониторинга акселераторов решений](media/tutorial-create-populate-tsi-environment/sa-create-device-sim-solution-dashboard.png)](media/tutorial-create-populate-tsi-environment/sa-create-device-sim-solution-dashboard.png#lightbox)

1. Это действие запустит веб-приложение имитации устройств, которому потребуется несколько секунд для начальной загрузки. Затем вам будет предложено подтвердить согласие, чтобы предоставить веб-приложению разрешения на "Вход и чтение своего профиля". Это разрешение позволяет приложению получать сведения о профиле пользователя, требуемые для работы приложения.

     [![Согласие для веб-приложения имитации устройств](media/tutorial-create-populate-tsi-environment/sawa-signin-consent.png)](media/tutorial-create-populate-tsi-environment/sawa-signin-consent.png#lightbox)

1. Когда загрузится страница **Simulation setup** (Настройка имитации), введите обязательные параметры.

   Параметр|ОПИСАНИЕ
   ---|---
   **Целевой Центр Интернета вещей** | Выберите **Use pre-provisioned IoT Hub** (Использовать предварительно подготовленный Центр Интернета вещей).
   **Модель устройства** | Выберите **Chiller**.
   **Количество устройств**  | Введите значение `1000` в поле **Количество**.
   **Частота получения телеметрии** | Введите `10` секунд.
   **Длительность имитации** | Выберите **End in:** (Завершается через) и введите `5` минут.

   Завершив ввод, щелкните **Запустить имитацию**. Процесс имитации будет выполняться в течение 5 минут, создавая каждые 10 секунд набор данных для 1000 имитируемых устройств.  

   [![Настройка имитация устройств](media/tutorial-create-populate-tsi-environment/sawa-simulation-setup.png)](media/tutorial-create-populate-tsi-environment/sawa-simulation-setup.png#lightbox)

1. В процессе имитации вы увидите, что значения в полях **Общее количество сообщений** и **Сообщений в секунду** изменяются примерно каждые 10 секунд. Процесс имитации закончится через 5 минут, и вы вернетесь на страницу **Настройка имитации**.

   [![Выполнение имитации устройств](media/tutorial-create-populate-tsi-environment/sawa-simulation-running.png)](media/tutorial-create-populate-tsi-environment/sawa-simulation-running.png#lightbox)

## <a name="verify-the-telemetry-data"></a>Проверка данных телеметрии

Это последний раздел руководства, в котором вы проверите, что данные телеметрии успешно созданы и сохранены в среде TSI. Чтобы проверить данные, используйте обозреватель службы "Аналитика временных рядов", который позволяет создавать запросы и аналитические отчеты по данным телеметрии.

1. Вернитесь на страницу **Обзор** группы ресурсов среды TSI. Выберите среду TSI.

   [![Среда TSI и группа ресурсов для этой среды](media/tutorial-create-populate-tsi-environment/ap-view-tsi-env-rg.png)](media/tutorial-create-populate-tsi-environment/ap-view-tsi-env-rg.png#lightbox)

1. На странице **Обзор** для среды TSI щелкните **URL-адрес обозревателя Аналитики временных рядов**, чтобы открыть обозреватель TSI.

   [![Обозреватель TSI](media/tutorial-create-populate-tsi-environment/ap-view-tsi-env-explorer-url.png)](media/tutorial-create-populate-tsi-environment/ap-view-tsi-env-explorer-url.png#lightbox)

1. Обозреватель TSI выполнит начальную загрузку, а затем аутентификацию с использованием вашей учетной записи для портала Azure. На начальной странице есть область диаграмм, в которой вы увидите наличие имитированных данных телеметрии в среде TSI. Чтобы отфильтровать данные по сокращенному периоду, выберите раскрывающийся список в левом верхнем углу. Затем укажите период, включающий время выполнения имитации устройств. Затем щелкните значок с изображением лупы.

   [![Фильтр по диапазону времени в обозревателе TSI](media/tutorial-create-populate-tsi-environment/tsie-filter-time-range.png)](media/tutorial-create-populate-tsi-environment/tsie-filter-time-range.png#lightbox)

1. Вы можете сократить период, чтобы подробнее рассмотреть отдельные пакеты передачи данных в Центр Интернета вещей и в среду TSI. Также обратите внимание на текст **Потоковая передача завершена** в правой верхней части экрана, где отображается общее количество обнаруженных событий. Также вы можете перетащить ползунок **Interval size** (Размер интервала), чтобы изменять степень детализации на этой диаграмме.

   [![Отображение с фильтрацией по диапазону времени в обозревателе TSI](media/tutorial-create-populate-tsi-environment/tsie-view-time-range.png)](media/tutorial-create-populate-tsi-environment/tsie-view-time-range.png#lightbox)

1. Наконец, здесь можно выбрать нужный регион обычным щелчком мыши, а затем щелкнуть его правой кнопкой мыши и выбрать действие **Просмотр событий**, чтобы открыть табличное представление **События** с информацией о событиях в этом регионе.

   [![Отображение с фильтрацией по диапазону времени и списком событий в обозревателе TSI](media/tutorial-create-populate-tsi-environment/tsie-view-time-range-events.png)](media/tutorial-create-populate-tsi-environment/tsie-view-time-range-events.png#lightbox)

## <a name="clean-up-resources"></a>Очистка ресурсов

В этом руководстве описано, как создать несколько действующих служб Azure для поддержки среды TSI и решения для имитации устройств. Если вы решите прервать и (или) приостановить работу с этой серией руководств, не забудьте удалить все эти ресурсы, чтобы избежать лишних затрат.

В меню слева на портале Azure сделайте следующее:

1. Щелкните значок **Группы ресурсов** и выберите группу ресурсов, которую вы создали для среды TSI. В верхней части страницы щелкните **Удалить группу ресурсов**, введите имя группы ресурсов и щелкните **Удалить**.

1. Щелкните значок **Группы ресурсов**, затем выберите группу ресурсов, автоматически созданную акселератором решений для имитации устройств. В верхней части страницы щелкните **Удалить группу ресурсов**, введите имя группы ресурсов и щелкните **Удалить**.

## <a name="next-steps"></a>Дополнительная информация

Из этого руководства вы узнали, как выполнить следующие задачи:

> [!div class="checklist"]
> * Создание среды TSI 
> * создание решения для имитированных устройств, содержащее Центр Интернета вещей;
> * подключение среды TSI к Центру Интернета вещей;
> * запуск имитации устройств для потоковой передачи данных в среду TSI;
> * проверка имитированных данных телеметрии.

Теперь, когда вы знаете, как создать среду TSI, перейдите к сведениям о создании веб-приложения, которое использует данные из среды TSI:

> [!div class="nextstepaction"]
> [Создание одностраничного веб-приложения службы "Аналитика временных рядов Azure"](tutorial-create-tsi-sample-spa.md)