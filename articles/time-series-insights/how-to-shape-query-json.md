---
title: Рекомендации по формированию JSON в запросах службы "Аналитика временных рядов Azure" | Документация Майкрософт
description: Сведения о том, как повысить эффективность запросов службы "Аналитика временных рядов Azure".
services: time-series-insights
author: ashannon7
manager: cshankar
ms.service: time-series-insights
ms.topic: article
ms.date: 05/09/2019
ms.author: dpalled
ms.custom: seodec18
ms.openlocfilehash: 089285637bb740fea47f1fd07de0906dfe46662b
ms.sourcegitcommit: 509e1583c3a3dde34c8090d2149d255cb92fe991
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/27/2019
ms.locfileid: "66244464"
---
# <a name="shape-json-to-maximize-query-performance"></a>Фигуры JSON в целях повышения производительности запросов 

Статья содержит рекомендации о том, как фигура JSON для повышения эффективности запросов Azure Time Series Insights.

## <a name="video"></a>Видео

### <a name="learn-best-practices-for-shaping-json-to-meet-your-storage-needsbr"></a>Ознакомьтесь с рекомендациями для формирования JSON, необходимое для хранения.</br>

> [!VIDEO https://www.youtube.com/embed/b2BD5hwbg5I]

## <a name="best-practices"></a>Рекомендации
Подумайте о том, как отправлять события для Time Series Insights. А именно вы всегда:

1. Отправлять данные по сети наиболее эффективным путем.
1. Убедитесь, что данные хранятся в виде, чтобы можно было выполнять агрегаты, подходящий для вашего сценария.
1. Убедитесь, что не достигают ограничения свойства максимума Time Series Insights.
   - 600 свойств (столбцов) для сред S1;
   - 800 свойств (столбцов) для сред S2.

Следующее руководство помогает обеспечить оптимальную производительность запросов можно:

1. Не используйте динамические свойства, например идентификатор тега, как имя свойства. Такое использование помогает в достижении предельного максимального свойства.
1. Не отправляйте необязательные свойства. Если свойство query не требуется, это не рекомендуется отправить его. Таким образом можно избежать ограничения хранилища.
1. Используйте [ссылочные данные](time-series-insights-add-reference-data-set.md) Чтобы избежать отправки статических данных по сети.
1. Совместное использование свойств измерения среди нескольких событий для отправки данных по сети более эффективно.
1. Не применяйте глубокую вложенность массивов. Time Series Insights поддерживает до двух уровней вложенных массивов, содержащих объекты. Time Series Insights объединяет массивы в сообщениях в нескольких событий с помощью пар "свойство-значение".
1. Если для всех или большинства событий существует только несколько мер, лучше отправлять эти меры как отдельные свойства в одном и том же объекте. Отправка их отдельно сокращает число событий и может повысить производительность запросов, поскольку меньше событий должны быть обработаны. При наличии нескольких мер, отправка их в виде значения в одном свойстве сводит к минимуму вероятность достижения ограничения свойства максимума.

## <a name="example-overview"></a>Общие сведения о примере

В следующих двух примерах как отправлять события, чтобы выделить все описанные выше рекомендации. После каждого примера можно увидеть, были Применение рекомендации.

Примеры основаны на сценарии, в котором несколько устройств отправляют измерения или сигналы. Измерения или сигналы можно скорость потока, давление масла ядра, температуры и влажности. В первом примере имеется несколько измерений по всем устройствам. Во втором примере имеет множество устройств, и каждое устройство отправляет множество уникальных измерения.

## <a name="scenario-one-only-a-few-measurements-exist"></a>Сценарий 1: Существует только несколько измерений

> [!TIP]
> Мы рекомендуем отправить каждого измерения или сигнал как отдельные свойства или столбца.

В следующем примере есть одно сообщение центра Интернета вещей Azure, где внешний массив содержит общий раздел общих значений измерений. Внешний массив использует эталонные данные для повышения эффективности сообщения. Ссылочных данных содержит метаданные устройства, который не изменяется для каждого события, но он предоставляет полезные свойства для анализа данных. Пакетная обработка обычные значения измерения и применение ссылки, которую сохраняет данные в байтах, отправленных по сети, который делает сообщения более эффективным.

Пример полезных данных JSON:

```json
[
    {
        "deviceId": "FXXX",
        "timestamp": "2018-01-17T01:17:00Z",
        "series": [
            {
                "Flow Rate ft3/s": 1.0172575712203979,
                "Engine Oil Pressure psi ": 34.7
            },
            {
                "Flow Rate ft3/s": 2.445906400680542,
                "Engine Oil Pressure psi ": 49.2
            }
        ]
    },
    {
        "deviceId": "FYYY",
        "timestamp": "2018-01-17T01:18:00Z",
        "series": [
            {
                "Flow Rate ft3/s": 0.58015072345733643,
                "Engine Oil Pressure psi ": 22.2
            }
        ]
    }
]
```

* Ссылочная таблица данных со свойством ключа **deviceId**:

   | deviceId | messageId | deviceLocation |
   | --- | --- | --- |
   | FXXX | LINE\_DATA | EU |
   | FYYY | LINE\_DATA | США |

* Аналитика рядов событие таблицы времени, после выравнивания:

   | deviceId | messageId | deviceLocation |  timestamp | series.Flow Rate ft3/s | series.Engine Oil Pressure psi |
   | --- | --- | --- | --- | --- | --- |
   | FXXX | LINE\_DATA | EU | 2018-01-17T01:17:00Z | 1.0172575712203979 | 34.7 |
   | FXXX | LINE\_DATA | EU | 2018-01-17T01:17:00Z | 2.445906400680542 | 49.2 |
   | FYYY | LINE\_DATA | США | 2018-01-17T01:18:00Z | 0.58015072345733643 | 22.2 |

Заметки о этих двух таблиц:

- Столбец **deviceId** служит заголовком столбца для различных устройств в парке автомобилей. Собственное имя свойства, сделав его значение deviceId ограничивает всего устройств 595 (для S1 сред) или 795 (для S2 сред) с пятью столбцами.
- Необязательные свойства, удается избежать сведения, например, марки и модели. Так как свойства не будет запрашиваться в будущем, устраняя их позволяет лучше сети и эффективность хранения.
- Эталонные данные используются для сокращения количества байтов, передаваемых по сети. Эти два атрибута **messageId** и **deviceLocation** соединяются с помощью ключевого свойства **deviceId**. Эти данные объединяется с данные телеметрии во время входа и затем сохраняются в Time Series Insights для выполнения запросов.
- Используются два уровня вложенности, которой является максимальным вложенности, поддерживаемых Time Series Insights. Критически важно избегать глубоко вложенных массивов.
- Меры отправляются в виде отдельных свойств в тот же объект, так как существует несколько мер. Здесь **series.Flow Rate psi** и **series.Engine Oil Pressure ft3/s** — уникальные столбцы.

## <a name="scenario-two-several-measures-exist"></a>Сценарий 2: Существует несколько мер

> [!TIP]
> Мы рекомендуем отправить измерения как «type», «единица» и «value» кортежей.

Пример полезных данных JSON:

```json
[
    {
        "deviceId": "FXXX",
        "timestamp": "2018-01-17T01:17:00Z",
        "series": [
            {
                "tagId": "pumpRate",
                "value": 1.0172575712203979
            },
            {
                "tagId": "oilPressure",
                "value": 49.2
            },
            {
                "tagId": "pumpRate",
                "value": 2.445906400680542
            },
            {
                "tagId": "oilPressure",
                "value": 34.7
            }
        ]
    },
    {
        "deviceId": "FYYY",
        "timestamp": "2018-01-17T01:18:00Z",
        "series": [
            {
                "tagId": "pumpRate",
                "value": 0.58015072345733643
            },
            {
                "tagId": "oilPressure",
                "value": 22.2
            }
        ]
    }
]
```

* Ссылочная таблица данных, имеющий ключевые свойства **deviceId** и **series.tagId**:

   | deviceId | series.tagId | messageId | deviceLocation | type | unit |
   | --- | --- | --- | --- | --- | --- |
   | FXXX | pumpRate | LINE\_DATA | EU | Скорость потока | ft3/s |
   | FXXX | oilPressure | LINE\_DATA | EU | Давление масла в двигателе | psi |
   | FYYY | pumpRate | LINE\_DATA | США | Скорость потока | ft3/s |
   | FYYY | oilPressure | LINE\_DATA | США | Давление масла в двигателе | psi |

* Аналитика рядов событие таблицы времени, после выравнивания:

   | deviceId | series.tagId | messageId | deviceLocation | type | unit |  timestamp | series.value |
   | --- | --- | --- | --- | --- | --- | --- | --- |
   | FXXX | pumpRate | LINE\_DATA | EU | Скорость потока | ft3/s | 2018-01-17T01:17:00Z | 1.0172575712203979 | 
   | FXXX | oilPressure | LINE\_DATA | EU | Давление масла в двигателе | psi | 2018-01-17T01:17:00Z | 34.7 |
   | FXXX | pumpRate | LINE\_DATA | EU | Скорость потока | ft3/s | 2018-01-17T01:17:00Z | 2.445906400680542 | 
   | FXXX | oilPressure | LINE\_DATA | EU | Давление масла в двигателе | psi | 2018-01-17T01:17:00Z | 49.2 |
   | FYYY | pumpRate | LINE\_DATA | США | Скорость потока | ft3/s | 2018-01-17T01:18:00Z | 0.58015072345733643 |
   | FYYY | oilPressure | LINE\_DATA | США | Давление масла в двигателе | psi | 2018-01-17T01:18:00Z | 22.2 |

Заметки о этих двух таблиц:

- Столбцы **deviceId** и **series.tagId** служат в качестве заголовков столбцов для различных устройств и тегов в парка. С помощью каждого как свой собственный атрибут ограничивает запрос 594 (для S1 сред) или 794 (для S2 сред) общего числа устройств с шестью столбцами.
- были избежать ненужных свойств, причина состоит в первом примере.
- Ссылочных данных позволяет уменьшить число байтов, передаваемых по сети путем введения **deviceId**, который используется для уникальных пары **messageId** и **deviceLocation**. Составной ключ **series.tagId** используется уникальный пары **тип** и **единицы**. Составной ключ позволяет **deviceId** и **series.tagId** пары, который будет использоваться для ссылки на четыре значения: **messageId, deviceLocation, введите,** и **единицы**. Эти данные объединяется с данные телеметрии во время входа. Он хранится в аналитика временных рядов для выполнения запросов.
- по той причине, указанных в первом примере используются два уровня вложения.

### <a name="for-both-scenarios"></a>Для обоих сценариев

Для свойства с большим числом возможных значений лучше отправлять в качестве уникальных значений в один столбец вместо создания нового столбца для каждого значения. Из предыдущих двух примеров:

  - В первом примере некоторые свойства имеют несколько значений, поэтому их можно выполнить для каждого отдельного свойства.
  - Во втором примере меры не указываются как отдельные свойства. Вместо этого они массив значений или меры в группе общего свойства ряда. Новый ключ **tagId** отправляется, который создает новый столбец **series.tagId** в формат плоской таблицы. Новые свойства **тип** и **единицы** создаются с помощью ссылочных данных, чтобы не достигнуто предельное свойство.

## <a name="next-steps"></a>Дальнейшие действия

- Чтение [синтаксис запроса Azure Time Series Insights](/rest/api/time-series-insights/ga-query-syntax) Дополнительные сведения о синтаксисе запросов для доступа к данным Time Series Insights REST API.
- Узнайте, [как события фигуры](./time-series-insights-send-events.md).
