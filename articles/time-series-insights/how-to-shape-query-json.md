---
title: Рекомендации по формированию JSON в запросах службы "Аналитика временных рядов Azure" | Документация Майкрософт
description: Сведения о том, как повысить эффективность запросов службы "Аналитика временных рядов Azure".
services: time-series-insights
author: ashannon7
manager: cshankar
ms.service: time-series-insights
ms.topic: article
ms.date: 08/09/2019
ms.author: dpalled
ms.custom: seodec18
ms.openlocfilehash: 48e09a64812f7552bd79c529138db693df283790
ms.sourcegitcommit: 124c3112b94c951535e0be20a751150b79289594
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/10/2019
ms.locfileid: "68947146"
---
# <a name="shape-json-to-maximize-query-performance"></a>Формирование JSON для повышения производительности запросов 

В этой статье содержатся рекомендации по формированию JSON для повышения эффективности запросов службы "аналитика временных рядов Azure".

## <a name="video"></a>Видео

### <a name="learn-best-practices-for-shaping-json-to-meet-your-storage-needsbr"></a>Ознакомьтесь с рекомендациями по формированию JSON в соответствии с потребностями хранилища.</br>

> [!VIDEO https://www.youtube.com/embed/b2BD5hwbg5I]

## <a name="best-practices"></a>Рекомендации
Подумайте о том, как вы отправляете события в "аналитика временных рядов". А именно, всегда:

1. Отправлять данные по сети наиболее эффективным путем.
1. Убедитесь, что данные хранятся таким образом, чтобы можно было выполнять агрегаты, подходящие для вашего сценария.
1. Убедитесь, что вы не достигли максимального ограничения для свойств Time Series Insights в:
   - 600 свойств (столбцов) для сред S1;
   - 800 свойств (столбцов) для сред S2.

Следующие рекомендации помогут обеспечить максимально возможную производительность запросов:

1. Не используйте динамические свойства, такие как идентификатор тега, в качестве имени свойства. Эта команда использует Contribute для достижения максимального предела свойств.
1. Не отправляйте необязательные свойства. Если свойство запроса не требуется, не рекомендуется отправлять его. Это позволит избежать ограничений хранилища.
1. Используйте [Ссылочные данные](time-series-insights-add-reference-data-set.md) , чтобы избежать отправки статических данных по сети.
1. Совместное использование свойств измерения несколькими событиями для более эффективной отправки данных по сети.
1. Не применяйте глубокую вложенность массивов. "Аналитика временных рядов" поддерживает до двух уровней вложенных массивов, содержащих объекты. Аналитика временных рядов преобразует массивы в сообщениях в несколько событий с парами значений свойств.
1. Если для всех или большинства событий существует только несколько мер, лучше отправлять эти меры как отдельные свойства в одном и том же объекте. Их отправка отдельно сокращает количество событий и может повысить производительность запросов, так как требуется обработка меньшего количества событий. Если существует несколько мер, отправка их в виде значений в отдельном свойстве снижает вероятность достижения максимального предела свойств.

## <a name="example-overview"></a>Обзор примера

В следующих двух примерах показано, как отправить события, чтобы выделить предыдущие рекомендации. После каждого примера можно увидеть, как были применены рекомендации.

Примеры основаны на сценарии, в котором несколько устройств отправляют измерения или сигналы. Измерения или сигналы могут быть последовательностью потоков, давлением в ядре, температуре и влажности. В первом примере имеется несколько измерений по всем устройствам. Во втором примере имеется много устройств, и каждое устройство отправляет множество уникальных измерений.

## <a name="scenario-one-only-a-few-measurements-exist"></a>Сценарий один: Существует только несколько измерений

> [!TIP]
> Рекомендуется отсылать каждое измерение или сигнал как отдельное свойство или столбец.

В следующем примере имеется одно сообщение центра Интернета вещей Azure, где внешний массив содержит общий раздел общих значений измерений. Внешний массив использует эталонные данные для повышения эффективности сообщения. Ссылочные данные содержат метаданные устройства, которые не меняются при каждом событии, но предоставляют полезные свойства для анализа данных. Пакетирование общих значений измерений и применение ссылочных данных экономится на байтах, отправляемых по каналу передачи, что делает сообщение более эффективным.

Пример полезных данных JSON:

```json
[
    {
        "deviceId": "FXXX",
        "timestamp": "2018-01-17T01:17:00Z",
        "series": [
            {
                "Flow Rate ft3/s": 1.0172575712203979,
                "Engine Oil Pressure psi ": 34.7
            },
            {
                "Flow Rate ft3/s": 2.445906400680542,
                "Engine Oil Pressure psi ": 49.2
            }
        ]
    },
    {
        "deviceId": "FYYY",
        "timestamp": "2018-01-17T01:18:00Z",
        "series": [
            {
                "Flow Rate ft3/s": 0.58015072345733643,
                "Engine Oil Pressure psi ": 22.2
            }
        ]
    }
]
```

* Таблица ссылочных данных, имеющая свойство ключа **deviceId**:

   | deviceId | messageId | deviceLocation |
   | --- | --- | --- |
   | FXXX | LINE\_DATA | EU |
   | FYYY | LINE\_DATA | US |

* Таблица событий "аналитика временных рядов" после спрямления:

   | deviceId | messageId | deviceLocation | timestamp | series.Flow Rate ft3/s | series.Engine Oil Pressure psi |
   | --- | --- | --- | --- | --- | --- |
   | FXXX | LINE\_DATA | EU | 2018-01-17T01:17:00Z | 1.0172575712203979 | 34.7 |
   | FXXX | LINE\_DATA | EU | 2018-01-17T01:17:00Z | 2.445906400680542 | 49.2 |
   | FYYY | LINE\_DATA | US | 2018-01-17T01:18:00Z | 0.58015072345733643 | 22.2 |

Примечания к этим двум таблицам:

- Столбец **deviceId** служит заголовком столбца для различных устройств в парке автомобилей. Если значение deviceId имеет собственное имя свойства, общее число устройств будет ограничено до 595 (для сред S1) или 795 (для сред S2) с другими пятью столбцами.
- Ненужные свойства исключаются, например, сведения о марках и модели. Так как свойства не будут запрашиваться в будущем, их устранение позволит повысить эффективность работы сети и хранилища.
- Эталонные данные используются для сокращения количества байтов, передаваемых по сети. Два атрибута **MessageId** и **девицелокатион** соединяются с помощью свойства ключа **deviceId**. Эти данные соединяются с данными телеметрии во время приема, а затем сохраняются в службе "аналитика временных рядов" для запросов.
- Используется два слоя вложенности, то есть максимальный объем вложенности, поддерживаемый службой "аналитика временных рядов". Критически важно избегать глубоко вложенных массивов.
- Меры отправляются в виде отдельных свойств в одном объекте, так как существует несколько мер. Здесь **series.Flow Rate psi** и **series.Engine Oil Pressure ft3/s** — уникальные столбцы.

## <a name="scenario-two-several-measures-exist"></a>Сценарий 2: Существует несколько мер

> [!TIP]
> Рекомендуется отсылать измерения в виде кортежей "тип", "единица" и "значение".

Пример полезных данных JSON:

```json
[
    {
        "deviceId": "FXXX",
        "timestamp": "2018-01-17T01:17:00Z",
        "series": [
            {
                "tagId": "pumpRate",
                "value": 1.0172575712203979
            },
            {
                "tagId": "oilPressure",
                "value": 49.2
            },
            {
                "tagId": "pumpRate",
                "value": 2.445906400680542
            },
            {
                "tagId": "oilPressure",
                "value": 34.7
            }
        ]
    },
    {
        "deviceId": "FYYY",
        "timestamp": "2018-01-17T01:18:00Z",
        "series": [
            {
                "tagId": "pumpRate",
                "value": 0.58015072345733643
            },
            {
                "tagId": "oilPressure",
                "value": 22.2
            }
        ]
    }
]
```

* Таблица ссылочных данных с ключевыми свойствами **deviceId** и **Series. tagId**:

   | deviceId | series.tagId | messageId | deviceLocation | type | единица измерения |
   | --- | --- | --- | --- | --- | --- |
   | FXXX | pumpRate | LINE\_DATA | EU | Скорость потока | ft3/s |
   | FXXX | oilPressure | LINE\_DATA | EU | Давление масла в двигателе | psi |
   | FYYY | pumpRate | LINE\_DATA | США | Скорость потока | ft3/s |
   | FYYY | oilPressure | LINE\_DATA | США | Давление масла в двигателе | psi |

* Таблица событий "аналитика временных рядов" после спрямления:

   | deviceId | series.tagId | messageId | deviceLocation | type | единица измерения | timestamp | series.value |
   | --- | --- | --- | --- | --- | --- | --- | --- |
   | FXXX | pumpRate | LINE\_DATA | EU | Скорость потока | ft3/s | 2018-01-17T01:17:00Z | 1.0172575712203979 | 
   | FXXX | oilPressure | LINE\_DATA | EU | Давление масла в двигателе | psi | 2018-01-17T01:17:00Z | 34.7 |
   | FXXX | pumpRate | LINE\_DATA | EU | Скорость потока | ft3/s | 2018-01-17T01:17:00Z | 2.445906400680542 | 
   | FXXX | oilPressure | LINE\_DATA | EU | Давление масла в двигателе | psi | 2018-01-17T01:17:00Z | 49.2 |
   | FYYY | pumpRate | LINE\_DATA | США | Скорость потока | ft3/s | 2018-01-17T01:18:00Z | 0.58015072345733643 |
   | FYYY | oilPressure | LINE\_DATA | США | Давление масла в двигателе | psi | 2018-01-17T01:18:00Z | 22.2 |

Примечания к этим двум таблицам:

- Столбцы **deviceId** и **Series. tagId** служат заголовками столбцов для различных устройств и тегов на парке. Использование каждого из них в качестве собственного атрибута ограничивает запрос до 594 (для сред S1) или 794 (для сред S2) на общее количество устройств с шестью столбцами.
- Ненужные свойства были исправлены по причине, упомянутой в первом примере.
- Ссылочные данные используются для сокращения числа байтов, передаваемых по сети, путем введения **deviceId**, который используется для уникальной пары **MessageId** и **девицелокатион**. Составной **ряд ключей. tagId** используется для уникальной пары **типа** и **единицы**. Составной ключ позволяет использовать пару **deviceId** и **Series. tagId** для ссылки на четыре значения: **MessageId, девицелокатион, Type** и **Unit**. Эти данные соединяются с данными телеметрии во время приема. Затем он сохраняется в аналитике временных рядов для запросов.
- Используются два слоя вложенности, по причинам, указанным в первом примере.

### <a name="for-both-scenarios"></a>Для обоих сценариев

Для свойства с большим количеством возможных значений лучше отправить в виде отдельных значений в одном столбце, а не создавать новый столбец для каждого значения. Из предыдущих двух примеров:

  - В первом примере несколько свойств имеют несколько значений, поэтому можно создать каждое отдельное свойство.
  - Во втором примере меры не указываются как отдельные свойства. Вместо этого они представляют собой массив значений или мер в общем свойстве ряда. Будет отправлен новый ключ **tagId** , создающий новый столбец **Series. tagId** в плоской таблице. Новый **тип** и единица свойств создаются с помощью ссылочных данных, поэтому ограничение свойства не достигается.

## <a name="next-steps"></a>Следующие шаги

- Ознакомьтесь с [синтаксисом запроса аналитики временных рядов Azure](https://docs.microsoft.com/rest/api/time-series-insights/ga-query-syntax) , чтобы узнать больше о синтаксисе запроса для REST API доступа к данным службы "аналитика временных рядов".
- Сведения [о формировании событий](./time-series-insights-send-events.md).
