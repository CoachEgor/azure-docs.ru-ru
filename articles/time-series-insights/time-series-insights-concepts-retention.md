---
title: Хранение данных в среде службы "Аналитика временных рядов Azure" | Документация Майкрософт
description: В этой статье описываются две параметра, которые контролируют хранение данных в среде службы "Аналитика временных рядов Azure".
ms.service: time-series-insights
services: time-series-insights
author: ashannon7
ms.author: anshan
manager: cshankar
ms.reviewer: jasonh, kfile, anshan
ms.workload: big-data
ms.topic: conceptual
ms.date: 02/09/2018
ms.custom: seodec18
ms.openlocfilehash: b230ac48cf2ca14c9ed988f869b5abba3e347215
ms.sourcegitcommit: 37343b814fe3c95f8c10defac7b876759d6752c3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/24/2019
ms.locfileid: "63761581"
---
# <a name="understand-data-retention-in-time-series-insights"></a>Хранение данных в службе "Аналитика временных рядов"

В этой статье описываются два параметра, которые контролируют хранение данных в среде "Аналитика временных рядов" (TSI).

## <a name="video"></a>Видео

### <a name="in-this-video-we-cover-time-series-insights-data-retention-and-how-to-plan-for-itbr"></a>В этом видео мы рассмотрим хранение данных Аналитики временных рядов, а также его планирование.</br>

> [!VIDEO https://www.youtube.com/embed/03x6zKDQ6DU]

Для каждой среды TSI существует параметр, который контролирует **время хранения данных**. Значение составляет от 1 до 400 дней. Данные удаляются по емкости хранилища среды или длительности хранения (1–400) в зависимости от того, какое из ограничений будет превышено первым.

Для каждой среды TSI есть дополнительный параметр — **Поведение при превышении размера хранилища**. Этот параметр контролирует реакцию на событие приема и очищения данных при достижении максимальной емкости среды. Доступны 2 реакции на событие.
- **Очистка старых данных** (по умолчанию).  
- **Остановка приема данных**.

> [!NOTE]
> По умолчанию при создании среды для периода удержания настроена **очистка старых данных**. По мере необходимости этот параметр можно изменить после создания с помощью портала Azure на странице **конфигурации** среды TSI.

Дополнительные сведения об изменении поведения хранения см. в статье [Настройка хранения данных в службе "Аналитика временных рядов"](time-series-insights-how-to-configure-retention.md).

Сравнение реакции на событие хранения данных:

## <a name="purge-old-data"></a>Очистка старых данных

- Это реакция на событие по умолчанию для сред TSI. Она похожа на реакцию среды TSI с момента ее запуска в общедоступной предварительной версии.  
- Эта реакция на событие предпочтительнее, если пользователи хотят, чтобы *последние данные* всегда отображались в среде TSI. 
- При достижении пределов среды (времени хранения, размера или количества данных) данные *очищаются*. По умолчанию установлено хранение до 30 дней. 
- Сначала очищаются самые старые принятые данные (подход FIFO).

### <a name="example-one"></a>Первый пример

Обратите внимание на пример среды, в которой настроена реакция на событие хранения **Продолжить прием и очищать старые данные**. В этом примере для **времени хранения данных** установлено значение 400 дней. Значение **емкости** равно единице S1, которая содержит 30 ГБ общей емкости.   Предположим, что входящие данные накапливаются в среднем до 500 МБ каждый день. Эта среда может сохранять данные только 60 дней, учитывая скорость входящих данных, так как максимальная емкость достигается через 60 дней. Входящие данные накапливаются следующим образом: 500 МБ в день x 60 дней = 30 ГБ.

В этом примере на 61-й день среда показывает самые свежие данные, но очищает самые старые (которые хранятся более 60 дней). Очистка позволяет принимать новые потоки данных для изучения. 

Если пользователь хочет сохранить данные дольше, необходимо увеличить размер среды, добавив дополнительные единицы или отправив меньшее количество данных.  

### <a name="example-two"></a>Второй пример

Обратите внимание на то, что в среде также настроена реакция на событие хранения **Продолжить прием и очищать старые данные**. В этом примере для **времени хранения данных** установлено меньшее значение — 180 дней. Значение **емкости** равно единице S1, которая содержит 30 ГБ общей емкости. Чтобы хранить данные в течение 180 дней, ежедневный прием данных не должен превышать 0,166 ГБ (166 МБ).  

Если этот показатель превышен в этой среде, данные не смогут храниться в течение 180 дней, так как некоторые из них будут удалены. Рассмотрим эту же среду в насыщенный интервал времени. Предположим, что скорость приема данных среды может увеличиться до среднего значения — 0,189 ГБ в день. В таком интервале времени сохраняются данные за 158 дней (30 ГБ / 0,189 = 158,73 дней хранения). Это меньше желаемого интервала времени хранения данных.

## <a name="pause-ingress"></a>Остановка приема данных

- При такой реакции на событие очистка данных останавливается, если пределы размера и количества достигаются до истечения периода хранения.  
- При этом у пользователей появляется дополнительное время на увеличение емкости до удаления данных из-за истечения периода хранения.
- Таким образом вы избегаете потери данных, но создается возможность потери последних данных, если прием данных приостановлен за пределами периода хранения источника события.
- Однако как только максимальная емкость среды будет достигнута, она приостанавливает прием данных до тех пор, пока не произойдет следующее. 
   - Вы увеличите максимальную емкость среды. Дополнительные сведения см. в статье [Как масштабировать среду Azure Time Series Insights](time-series-insights-how-to-scale-your-environment.md).
   - Будет достигнут срок хранения данных и они будут удалены. При этом количество ресурсов среде сократится.

### <a name="example-three"></a>Третий пример

Рассмотрим среду с реакцией хранения на событие, настроенную на **остановку приема данных**. В этом примере **срок хранения данных** составляет 60 дней. **Емкость** равна 3 единицам S1. Предположим, что в эту среду ежедневно поступает 2 ГБ данных. Прием данных приостанавливается после достижения максимальной емкости. Сейчас среда показывает один и тот же набор данных до тех пор, пока не возобновится прием данных или пока не будет включен параметр "Продолжить прием данных" (он позволит очистить старые данные и освободить место для новых). 

Когда прием данных возобновляется:

- Данные передаются в том порядке, в котором они были получены источником событий.
- События индексируются на основе метки времени, если политики хранения в источнике событий не превышены. Дополнительные сведения о конфигурации хранения источника событий см. в статье [Часто задаваемые вопросы о Центрах событий](../event-hubs/event-hubs-faq.md)

> [!IMPORTANT]
> Необходимо установить предупреждения во избежание остановки приема данных. Возможна потеря данных, так как для источников событий Azure хранение по умолчанию составляет 1 день. Поэтому как только прием данных приостановится, самые последние данные будут утеряны. Чтобы это не произошло, сделайте следующее. Увеличьте емкость или переключитесь на реакцию на событие **Очистка старых данных**.

Для затронутых концентраторов событий можно настроить свойство **Хранение сообщений**, чтобы минимизировать потерю данных при остановке приема данных в службе "Аналитика временных рядов".

![Хранение сообщений концентратора событий.](media/time-series-insights-contepts-retention/event-hub-retention.png)

Если для источника события (timeStampPropertyName) никакие свойства не настроены, TSI по умолчанию устанавливает отметку времени прибытия в концентратор событий как ось X. Если для timeStampPropertyName настроены другие свойства, среда ищет настроенное значение timeStampPropertyName в пакете данных во время анализа событий. 

Дополнительные сведения о масштабировании среды и продлении срока хранения см. в статье [Как масштабировать среду Azure Time Series Insights ](time-series-insights-how-to-scale-your-environment.md).  

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения об изменении поведения хранения см. в статье [Настройка хранения данных в службе "Аналитика временных рядов"](time-series-insights-how-to-configure-retention.md).
