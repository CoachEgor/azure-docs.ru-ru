---
title: Хранение данных в среде службы "Аналитика временных рядов Azure" | Документация Майкрософт
description: В этой статье описываются две параметра, которые контролируют хранение данных в среде службы "Аналитика временных рядов Azure".
ms.service: time-series-insights
services: time-series-insights
author: ashannon7
ms.author: dpalled
manager: cshankar
ms.reviewer: jasonh, kfile, anshan
ms.workload: big-data
ms.topic: conceptual
ms.date: 04/30/2019
ms.custom: seodec18
ms.openlocfilehash: e3336df30873b40d2b8a464d1f866b524f76776d
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "66236994"
---
# <a name="understand-data-retention-in-azure-time-series-insights"></a>Хранение данных в Azure Time Series Insights

В этой статье описываются два параметра, которые контролируют хранение данных в среду Azure Time Series Insights.

## <a name="video"></a>Видео

### <a name="the-following-video-summarizes-time-series-insights-data-retention-and-how-to-plan-for-itbr"></a>Следующий видеоролик перечислены хранение данных Time Series Insights, а также планирование для него.</br>

> [!VIDEO https://www.youtube.com/embed/03x6zKDQ6DU]

Каждый из среды Azure временных рядов имеет параметр, который управляет **время хранения данных**. Это значение охватывает период от 1 до 400 дней. Данные удаляются на основе емкости хранилища среды или длительности хранения, какое событие произойдет первым.

Кроме того, среда временных рядов Azure включает **поведение при превышении размера хранилища** параметр. Он управляет входящих данных и очистка поведение при достижении максимальной емкости среды. Существует два реакции на событие при его настройке.

- **Очистка старых данных** (по умолчанию).  
- **Остановка приема данных**.

> [!NOTE]
> По умолчанию при создании среды для периода удержания настроена **очистка старых данных**. Этот параметр может переключаться при необходимости после создания с помощью портала Azure, на **Настройка** странице среды аналитики временных рядов.

Дополнительные сведения об изменении поведения хранения см. в статье [Настройка хранения данных в службе "Аналитика временных рядов"](time-series-insights-how-to-configure-retention.md).

Сравнение реакции на событие хранения данных:

## <a name="purge-old-data"></a>Очистка старых данных

- Это поведение по умолчанию для среды Time Series Insights.  
- Такое поведение предпочтительнее, если пользователи хотят всегда видеть их *самыми последними данными* в своей среде Time Series Insights.
- При достижении пределов среды (времени хранения, размера или количества данных) данные *очищаются*. По умолчанию установлено хранение до 30 дней.
- Сначала очищаются самые старые принятые данные (подход FIFO).

### <a name="example-one"></a>Первый пример

Обратите внимание на пример среды, в которой настроена реакция на событие хранения **Продолжить прием и очищать старые данные**.

**Время хранения данных** составляет 400 дней. Значение **емкости** равно единице S1, которая содержит 30 ГБ общей емкости.   Предположим, что входящие данные накапливаются в среднем до 500 МБ каждый день. Эта среда может сохранять данные только 60 дней, учитывая скорость входящих данных, так как максимальная емкость достигается через 60 дней. Входящие данные накапливаются следующим образом: 500 МБ в день x 60 дней = 30 ГБ.

На 61 день среды показывает самые свежие данные, но очищает самые старые данные, более 60 дней. Очистка позволяет принимать новые потоки данных для изучения. Если пользователь хочет сохранить данные дольше, необходимо увеличить размер среды, добавив дополнительные единицы или отправив меньшее количество данных.  

### <a name="example-two"></a>Второй пример

Обратите внимание на то, что в среде также настроена реакция на событие хранения **Продолжить прием и очищать старые данные**. В этом примере для **времени хранения данных** установлено меньшее значение — 180 дней. Значение **емкости** равно единице S1, которая содержит 30 ГБ общей емкости. Чтобы хранить данные в течение 180 дней, ежедневный прием данных не должен превышать 0,166 ГБ (166 МБ).  

Если этот показатель превышен в этой среде, данные не смогут храниться в течение 180 дней, так как некоторые из них будут удалены. Рассмотрим эту же среду в насыщенный интервал времени. Предположим, что скорость приема данных среды может увеличиться до среднего значения — 0,189 ГБ в день. В таком интервале времени сохраняются данные за 158 дней (30 ГБ / 0,189 = 158,73 дней хранения). Это меньше желаемого интервала времени хранения данных.

## <a name="pause-ingress"></a>Остановка приема данных

- **Остановки приема данных** параметр позволяет убедиться, что данные не удаляются, если ограничения размера и количества достигаются до истечения периода хранения.  
- **Остановки приема данных** предоставляет дополнительное время для пользователей для увеличения емкости среды до удаления данных из-за истечения периода хранения
- Он обеспечивает защиту от потери данных, но можно создать возможность потери последних данных, если прием данных приостановлен за пределами срока хранения источника события.
- Тем не менее при достижении максимальной емкости среды приостанавливает прием данных пока не выполняются следующие дополнительные действия:

   - Увеличить максимальную емкость среды для добавления дополнительных единиц масштабирования, как описано в разделе [как масштабировать среду Time Series Insights](time-series-insights-how-to-scale-your-environment.md).
   - Достигнут срок хранения данных и очистка данных, перенос среды ниже максимальной емкости.

### <a name="example-three"></a>Третий пример

Рассмотрим среду с реакцией хранения на событие, настроенную на **остановку приема данных**. В этом примере **срок хранения данных** составляет 60 дней. **Емкость** присваивается три (3) единицы уровня S1. Предположим, что в эту среду ежедневно поступает 2 ГБ данных. Прием данных приостанавливается после достижения максимальной емкости.

В этот момент среда показывает тот же набор данных, пока не возобновится прием данных или до **продолжить прием** включен (которая позволит очистить старые данные, чтобы освободить место для новых данных).

Когда прием данных возобновляется:

- Данные передаются в том порядке, в котором они были получены источником событий.
- События индексируются на основе метки времени, если политики хранения в источнике событий не превышены. Дополнительные сведения о конфигурации хранения источника событий см. в статье [Часто задаваемые вопросы о Центрах событий](../event-hubs/event-hubs-faq.md)

> [!IMPORTANT]
> Необходимо установить предупреждения во избежание остановки приема данных. Возможна потеря данных, так как для источников событий Azure хранение по умолчанию составляет 1 день. Поэтому как только прием данных приостановится, самые последние данные будут утеряны. Чтобы это не произошло, сделайте следующее. Увеличьте емкость или переключитесь на реакцию на событие **Очистка старых данных**.

Для затронутых концентраторов событий можно настроить свойство **Хранение сообщений**, чтобы минимизировать потерю данных при остановке приема данных в службе "Аналитика временных рядов".

[![Хранение сообщений концентратора событий.](media/time-series-insights-contepts-retention/event-hub-retention.png)](media/time-series-insights-contepts-retention/event-hub-retention.png#lightbox)

Если свойства не настроены для источника события (`timeStampPropertyName`), аналитика временных рядов по умолчанию метка времени прибытия в концентратор событий как ось x. Если `timeStampPropertyName` настроено как что-то еще, среда ищет настроенное `timeStampPropertyName` в пакете данных во время анализа событий.

Дополнительные сведения о масштабировании среды и продлении срока хранения см. в статье [Как масштабировать среду Azure Time Series Insights ](time-series-insights-how-to-scale-your-environment.md).  

## <a name="next-steps"></a>Дальнейшие действия

- Сведения о настройке и изменив параметры хранения данных, просмотрите [Настройка хранения данных в Time Series Insights](time-series-insights-how-to-configure-retention.md).
