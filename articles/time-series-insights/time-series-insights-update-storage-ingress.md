---
title: Хранение и входные данные в предварительной версии — служба "аналитика временных рядов Azure" | Документация Майкрософт
description: Сведения о хранении и входе данных в предварительной версии службы "аналитика временных рядов Azure".
author: deepakpalled
ms.author: dpalled
manager: cshankar
ms.workload: big-data
ms.service: time-series-insights
services: time-series-insights
ms.topic: conceptual
ms.date: 11/04/2019
ms.custom: seodec18
ms.openlocfilehash: 62ee248c06d2b26b935f72b3bb73cf708f949c72
ms.sourcegitcommit: ae8b23ab3488a2bbbf4c7ad49e285352f2d67a68
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/13/2019
ms.locfileid: "74014708"
---
# <a name="data-storage-and-ingress-in-azure-time-series-insights-preview"></a>Хранилище данных и входящий трафик в Аналитике временных рядов Azure (предварительная версия)

В этой статье описываются обновления хранилища данных и входящего трафика для предварительной версии службы "аналитика временных рядов Azure". Рассматриваются структура хранилища, формат файла и свойство идентификатора временного ряда. В нем также обсуждается базовый процесс приема, рекомендации и текущие ограничения предварительной версии.

## <a name="data-ingress"></a>Исходящие данные

Среда службы "аналитика временных рядов Azure" содержит подсистему приема для накопления, обработки и хранения данных временных рядов. При планировании среды необходимо учитывать некоторые моменты, чтобы убедиться в том, что все входящие данные обрабатываются, а также для достижения максимального объема входных данных и снижения задержки приема (время, затрачиваемое TSI на чтение и обработку данных события). Источник). В предварительной версии "аналитика временных рядов" политики передачи данных определяют, откуда могут быть источником данных, и какой формат данных должен иметь.

### <a name="ingress-policies"></a>Политики входящих данных

Предварительная версия "аналитика временных рядов" поддерживает следующие источники событий:

- [Центр Интернета вещей Azure](../iot-hub/about-iot-hub.md)
- [Центры событий Azure](../event-hubs/event-hubs-about.md)

Предварительная версия "аналитика временных рядов" поддерживает не более двух источников событий на один экземпляр.
  
Служба "аналитика временных рядов Azure" поддерживает JSON, отправленный через центр Интернета вещей Azure или концентраторы событий Azure.

> [!WARNING] 
> При присоединении нового источника событий к среде предварительного просмотра "аналитика временных рядов" в зависимости от числа событий, находящихся в центре Интернета вещей или в концентраторе событий, может возникнуть высокая начальная задержка приема. По мере приема данных следует рассчитывать на эту высокую задержку, но если вы не хотите, свяжитесь с нами по адресу, отправьте запрос в службу поддержки через портал Azure.

## <a name="ingress-best-practices"></a>Рекомендации по входящим сообщениям

Мы рекомендуем применить следующие рекомендации:

* Настройте аналитику временных рядов и центр Интернета вещей или концентратор событий в одном регионе. Это снизит задержку приема из-за сети.
* Спланируйте требования к масштабированию, вычисляя предполагаемую скорость приема и убедившись, что она попадает в поддерживаемую частоту, указанную ниже.
* Узнайте, как оптимизировать и сформировать данные JSON, а также текущие ограничения в предварительной версии, читая [о том, как СФОРМИРОВАТЬ JSON для](./time-series-insights-update-how-to-shape-events.md)входных данных и запросов.

### <a name="ingress-scale-and-limitations-in-preview"></a>Масштаб входящих данных и ограничения в предварительной версии

По умолчанию Предварительная версия "аналитика временных рядов" поддерживает первоначальный входной масштаб в 1 МБ в секунду на каждую среду. При необходимости доступна пропускная способность до 16 МБ/с. свяжитесь с нами, отправив запрос в службу поддержки в портал Azure, если это необходимо. Кроме того, для каждого раздела существует ограничение в 0,5 МБ/с. Это влияет на клиентов, использующих центр Интернета вещей, учитывая сходство между устройством центра Интернета вещей и разделом. В сценариях, где одно устройство шлюза пересылает сообщения концентратору с помощью идентификатора устройства и строки подключения, существует опасность достижения лимита в 0,5 МБ/с, учитывая, что сообщения будут поступать в одну секцию, даже если полезные данные события указывают разные TS. Кодом. Как правило, скорость входящих данных просматривается как коэффициент числа устройств в Организации, частоты выбросов событий и размера события. При расчете скорости приема пользователи центра Интернета вещей должны использовать количество используемых подключений к концентратору, а не все устройства в Организации. Текущей задачей является расширенная поддержка масштабирования. Эта документация будет обновлена с учетом этих улучшений. 

> [!WARNING]
> Для сред, использующих центр Интернета вещей в качестве источника событий, вычислите скорость приема с помощью числа используемых устройств-концентраторов.

Дополнительные сведения о единицах пропускной способности и секциях см. по следующим ссылкам:

* [Масштаб центра Интернета вещей](https://docs.microsoft.com/azure/iot-hub/iot-hub-scaling)
* [Масштаб концентратора событий](https://docs.microsoft.com/azure/event-hubs/event-hubs-scalability#throughput-units)
* [Разделы концентратора событий](https://docs.microsoft.com/azure/event-hubs/event-hubs-features#partitions)

### <a name="data-storage"></a>Хранилище данных

При создании среды SKU "аналитика временных рядов" с оплатой по мере использования вы создадите два ресурса Azure:

* Среда предварительного просмотра аналитики временных рядов, которая при необходимости может включать возможности горячего хранения.
* Учетная запись большого двоичного объекта хранилища Azure общего назначения версии 1 для холодного хранения данных.

Данные в горячем хранилище доступны только через [запрос временных рядов](./time-series-insights-update-tsq.md) и [Обозреватель предварительной версии службы "аналитика временных рядов Azure](./time-series-insights-update-explorer.md)". 

Предварительная версия службы "аналитика временных рядов" сохраняет данные холодного магазина в хранилище BLOB-объектов Azure в [формате файла Parquet](#parquet-file-format-and-folder-structure). Предварительный просмотр "аналитика временных рядов" управляет только данными этого холодного хранилища, но он доступен для чтения непосредственно в виде стандартных файлов Parquet.

> [!WARNING]
> Как владелец учетной записи хранилища BLOB-объектов Azure, где находятся данные холодного хранения, у вас есть полный доступ ко всем данным в учетной записи. Этот доступ включает разрешения на запись и удаление. Не изменяйте или не удаляйте данные, записываемые в предварительную версию аналитики временных рядов, так как это может привести к потере данных.

### <a name="data-availability"></a>Доступность данных

Аналитика временных рядов Insights (Предварительная версия) и индексы данных для оптимальной производительности запросов. Данные становятся доступными для запроса после индексирования. Объем принимаемых данных может повлиять на эту доступность.

> [!IMPORTANT]
> Предстоящий выпуск общедоступной версии "аналитика временных рядов" сделает данные доступными через 60 секунд после их считывания из источника событий. В течение предварительной версии может произойти более длительный период до того, как данные станут доступны. При значительной задержке свыше 60 секунд отправьте запрос в службу поддержки через портал Azure.

## <a name="azure-storage"></a>Хранилище Azure

В этом разделе описываются подробные сведения о службе хранилища Azure, относящиеся к предварительной версии службы "аналитика временных рядов Azure".

Подробное описание хранилища BLOB [-объектов Azure см. в](../storage/blobs/storage-blobs-introduction.md)этой статье.

### <a name="your-storage-account"></a>Ваша учетная запись хранения

При создании среды "аналитика временных рядов" с оплатой по мере использования в качестве долгосрочного холодного магазина создается учетная запись большого двоичного объекта хранилища Azure общего назначения версии 1.  

Предварительная версия службы "аналитика временных рядов" публикует до двух копий каждого события в учетной записи хранения Azure. Начальная копия содержит события, упорядоченные по времени приема, и всегда сохраняются, поэтому для доступа к ней можно использовать другие службы. Для обработки необработанных файлов Parquet можно использовать Spark, Hadoop и другие знакомые инструменты. 

В предварительной версии "аналитика временных рядов" выполняется повторное секционирование файлов Parquet для оптимизации запроса "аналитика временных рядов". Эта повторно секционированная копия данных также сохраняется.

Во время общедоступной предварительной версии данные хранятся в учетной записи хранения Azure бессрочно.

### <a name="writing-and-editing-time-series-insights-blobs"></a>Записывание и изменение больших двоичных объектов Аналитики временных рядов

Чтобы обеспечить производительность запросов и доступность данных, не изменяйте и не удаляйте большие двоичные объекты, создаваемые в предварительной версии "аналитика временных рядов".

### <a name="accessing-and-exporting-data-from-time-series-insights-preview"></a>Доступ и экспорт данных из Аналитики временных рядов (предварительная версия)

Вы можете получить доступ к данным, просматриваемым в обозревателе предварительного просмотра службы "аналитика временных рядов", для использования в сочетании с другими службами. Например, данные можно использовать для построения отчета в Power BI или для обучения модели машинного обучения с помощью Машинное обучение Azure Studio. Вы также можете использовать данные для преобразования, визуализации и моделирования в записных книжках Jupyter.

Получить доступ к данными можно тремя основными способами:

* из обозревателя Аналитики временных рядов (предварительная версия); Данные можно экспортировать в виде CSV-файла из проводника. Дополнительные сведения см. в статье [Визуализация данных в обозревателе (предварительная версия)](./time-series-insights-update-explorer.md).
* Из API предварительной версии аналитики временных рядов. Можно обратиться к конечной точке API по адресу `/getRecorded`. Дополнительные сведения об этом API см. в статье [Запрашивание данных](./time-series-insights-update-tsq.md).
* непосредственно из учетной записи хранения Azure. Вам нужен доступ на чтение к любой учетной записи, которую вы используете для доступа к данным предварительной версии службы "аналитика временных рядов". Дополнительные сведения см. в статье [Управление анонимным доступом на чтение к контейнерам и большим двоичным объектам](../storage/blobs/storage-manage-access-to-resources.md).

### <a name="data-deletion"></a>Удаление данных

Не удаляйте файлы предварительной версии "аналитика временных рядов". Вы должны управлять связанными данными только в предварительной версии Time Series Insights.

## <a name="parquet-file-format-and-folder-structure"></a>Формат файла Parquet и структура папок

Parquet — это формат файлов столбцов с открытым исходным кодом, предназначенный для эффективного хранения и производительности. В предварительной версии "аналитика временных рядов" по этим причинам используется Parquet. Он разделяет данные по ИДЕНТИФИКАТОРу временного ряда для производительности запросов в масштабе.  

Дополнительные сведения о типе файла Parquet см. в документации по [Parquet](https://parquet.apache.org/documentation/latest/).

В предварительной версии аналитики временных рядов хранятся копии данных следующим образом:

* Первая, начальная копия секционирована по времени приема и сохраняет данные приблизительно в порядке поступления. Данные находятся в папке `PT=Time`:

  `V=1/PT=Time/Y=<YYYY>/M=<MM>/<YYYYMMDDHHMMSSfff>_<TSI_INTERNAL_SUFFIX>.parquet`

* Вторая, секционированная копия секционирована по группе идентификаторов временных рядов и расположению в папке `PT=TsId`:

  `V=1/PT=TsId/Y=<YYYY>/M=<MM>/<YYYYMMDDHHMMSSfff>_<TSI_INTERNAL_SUFFIX>.parquet`

В обоих случаях значения времени соответствуют времени создания большого двоичного объекта. Данные в папке `PT=Time` сохраняются. Данные в папке `PT=TsId` будут оптимизированы для запросов в течение определенного времени и не будут оставаться статическими.

> [!NOTE]
> * `<YYYY>` сопоставляется с представлением года из четырех цифр.
> * `<MM>` сопоставляется с представлением месяца из двух цифр.
> * `<YYYYMMDDHHMMSSfff>` сопоставляется с представлением временной метки с четырехзначным годом (`YYYY`), двузначным месяцем (`MM`), днем, двумя цифрами (`DD`), двузначным числом (`HH`), двумя цифрами (`MM`), двумя цифрами (`SS`) и с тремя цифрами (в миллисекундах) (`fff`).

События предварительной версии аналитики временных рядов сопоставляются с содержимым файла Parquet следующим образом:

* Каждое событие сопоставляется с отдельной строкой.
* Каждая строка содержит столбец **timestamp** с меткой времени события. Свойство временной метки не может иметь значение null. Если свойство временной метки не указано в источнике событий, по умолчанию используется **событие в очереди** . Метка времени всегда находится в формате UTC.
* Каждая строка содержит столбец ИДЕНТИФИКАТОРов временных рядов, как определено при создании среды "аналитика временных рядов". Имя свойства включает суффикс `_string`.
* Все остальные свойства, отправленные как данные телеметрии, сопоставляются с именами столбцов, заканчивающимися `_string` (String), `_bool` (Boolean), `_datetime` (DateTime) или `_double` (Double) в зависимости от типа свойства.
* Эта схема сопоставления применяется к первой версии формата файла, ссылка на которую указана как **V = 1**. По мере развития этой функции имя может увеличиваться.

## <a name="next-steps"></a>Дополнительная информация

- Чтение [хранилища и входных данных службы "аналитика временных рядов Azure](./time-series-insights-update-storage-ingress.md)".

- Ознакомьтесь с новым [моделированием данных](./time-series-insights-update-tsm.md).
