---
title: Хранилище данных и входящий трафик в службе "Аналитике временных рядов Azure" (предварительная версия) | Документация Майкрософт
description: Основные сведения о хранилище данных и входящем трафике в Аналитике временных рядов Azure (предварительная версия).
author: ashannon7
ms.author: dpalled
ms.workload: big-data
manager: cshankar
ms.service: time-series-insights
services: time-series-insights
ms.topic: conceptual
ms.date: 05/20/2019
ms.custom: seodec18
ms.openlocfilehash: 33ca86fc2d13fb7f6e29c43e9a7c1d2dc6ef4169
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "66755233"
---
# <a name="data-storage-and-ingress-in-azure-time-series-insights-preview"></a>Хранилище данных и входящий трафик в Аналитике временных рядов Azure (предварительная версия)

В этой статье описаны изменения в хранилище данных и в входящем трафике из Аналитики временных рядов Azure (предварительная версия). Рассматриваются структура хранилища, формат файла и свойство идентификатора временного ряда. В статье также описывается базовый процесс входящего трафика, пропускная способность и ограничения.

## <a name="data-storage"></a>Хранилище данных

При создании среды с оплатой по мере использования номера SKU Аналитики временных рядов (предварительная версия), вы создаете два ресурса:

* среду службы "Аналитика временных рядов";
* учетную запись службы хранилища Azure общего назначения версии 1 для хранения данных.

Insights Preview ряда времени использует хранилище BLOB-объектов Azure с типом файла Parquet. Аналитика временных рядов управляет всеми операциями данных, включая создание больших двоичных объектов, индексирование и секционирование данных в учетной записи хранения Azure. С помощью учетной записи хранения Azure можно создать эти большие двоичные объекты.

Как и другие большие двоичные объекты службы хранилища Azure, созданные Аналитикой временных рядов, большие двоичные объекты позволяют считывать и записывать их, чтобы поддержать различные сценарии интеграции.

> [!TIP]
> Если считывание или запись больших двоичных объектов происходит слишком часто, производительность Аналитики временных рядов может быть значительно снижена.

Общие сведения о хранилище BLOB-объектов Azure см. в [этой статье](https://docs.microsoft.com/azure/storage/blobs/storage-blobs-introduction).

Дополнительные сведения о типах файлов Parquet см. в статье [Поддерживаемые форматы файлов и кодеки сжатия в фабрике данных Azure](https://docs.microsoft.com/azure/data-factory/supported-file-formats-and-compression-codecs#parquet-format).

## <a name="parquet-file-format"></a>Пример файла Parquet

Parquet – это столбцово-ориентированный формат файла данных предназначенный для:

* Возможность взаимодействия
* Эффективность использования пространства
* Эффективность запроса

Аналитика временных рядов выбрала Parquet, так как он обеспечивает эффективное сжатие данных и кодирование схем, с высоким уровнем производительности, который может обрабатывать сложные данные в массовом режиме.

Для дополнительной информации о формате файла Parquet см. [эту документацию](https://parquet.apache.org/documentation/latest/).

### <a name="event-structure-in-parquet"></a>Структура событий в Parquet

Аналитика временных рядов создает и хранит копии больших двоичных объектов в двух форматах.

1. Во-первых, начальная копия секционируется временем получения.

    * `V=1/PT=Time/Y=<YYYY>/M=<MM>/<YYYYMMDDHHMMSSfff>_<TSI_INTERNAL_SUFFIX>.parquet`
    * Время создания большого двоичного объекта для больших двоичных объектов, секционированных временем получения.

1. Во-вторых, перераспределенные копии секционируются по динамическому группированию идентификатора временного ряда.

    * `V=1/PT=TsId/Y=<YYYY>/M=<MM>/<YYYYMMDDHHMMSSfff>_<TSI_INTERNAL_SUFFIX>.parquet`
    * Минимальная метка времени события в большом двоичном объекте для больших двоичных объектов, секционированных идентификатором временного ряда.

> [!NOTE]
> * `<YYYY>` сопоставляется представлению 4-значного числа года.
> * `<MM>` сопоставляется представлению 2-значного числа месяца.
> * `<YYYYMMDDHHMMSSfff>` сопоставляется представлению метки времени с 4-значным номером года (`YYYY`), 2-значными цифрами номера месяца (`MM`), 2-значными цифрами дня (`DD`), 2-значными цифрами часа (`HH`), 2-значными цифрами минуты (`MM`),2-значными цифрами секунды (`SS`) и 3-значными цифрами миллисекунды (`fff`).

События Аналитики временных рядов сопоставляются с содержимым файла Parquet следующим образом.

* Каждое событие сопоставляется с отдельной строкой.
* Встроенный столбец **Timestamp** с меткой времени события. Свойство метки времени никогда не имеет значение NULL. По умолчанию используется **Время постановки в очередь источника событий**, если свойство Timestamp не указано в источнике событий. Метка времени указывается в формате UTC. 
* Все остальные свойства, которые сопоставлены со столбцами, заканчиваются на `_string` (string), `_bool` (Boolean), `_datetime` (datetime) и `_double` (double) в зависимости от типа свойства.
* Это схема сопоставления для первой версии формата файла, который называется **V=1**. Поскольку эта функция развивается, имя будет изменяться на **V=2**, **V=3**, и т. д.

## <a name="partitions"></a>Разделы

Каждая среда предварительного просмотра во время Series Insights должен иметь **идентификатор ряда времени** свойство и **Timestamp** свойство, которое однозначно идентифицируют его. Идентификатор временного ряда выступает в качестве логической секции для ваших данных и предоставляет среде Аналитики временных рядов (предварительная версия) естественную границу для распределения данных между физическими секциями. Аналитика временных рядов (предварительная версия) управляет физическими секциями в учетной записи хранения Azure.

Аналитика временных рядов использует динамическое секционирование для оптимизации хранения и выполнения запросов, выбрасывая и повторно создавая секции. Алгоритм секционирования Аналитики временных рядов (предварительная версия) пытается предотвратить единичные физические секции от наличия данных для нескольких различных логических секций. Другими словами, алгоритм секционирования сохраняет все конкретные данные на один идентификатор временного ряда, который исключительно содержится в файлах Parquet без чередования с другими идентификаторами временного ряда. Динамический алгоритм секционирования также пытается сохранить исходный порядок событий в пределах одного идентификатора временного ряда.

Изначально, во время входящего трафика, данные секционируются меткой времени, чтобы в едином логическом разделе в заданном диапазоне времени могли распределяться между несколькими физическими секциями. Одна физическая секция также может содержать много или все логические секции. Из-за ограничений размера большого двоичного объекта даже при оптимальном секционировании одна логическая секция может занимать несколько физических секций.

> [!NOTE]
> По умолчанию значением метки времени является сообщение *время поставки в очередь* в вашем настроенном источнике событий.

Загружая данные журналов или пакетные сообщения, присвойте значение, которое необходимо сохранить с данными для свойства метки времени, которое сопоставляется с соответствующей меткой времени. Свойство метки времени учитывает регистр. Дополнительные сведения см. в статье [Модель временных рядов](./time-series-insights-update-tsm.md).

### <a name="physical-partitions"></a>Физические секции

Физическая секция является блочным BLOB-объектом, который хранится в учетной записи хранения. Фактический размер больших двоичных объектов может изменяться, потому что размер зависит от скорости отправки. Тем не менее ожидается, что размер больших двоичных объектов приблизительно от 20 МБ до 50 МБ. Эти ожидания приводят команду Аналитики временных рядов к выбору 20 МБ в качестве размера для оптимизации производительности запросов. Со временем размер может изменятьс в зависимости от размера файла и скорости входящего трафика данных.

> [!NOTE]
> * Размер больших двоичных объектов – 20 МБ.
> * Иногда для повышения производительности большие двоичные объекты Azure будут повторно секционированные путем удаления и повторного создания.
> * Кроме того, те же данные Аналитики временных рядов могут присутствовать в двух или нескольких больших двоичных объектах.

### <a name="logical-partitions"></a>Логические секции

Логическая секция – это секция в пределах физической, которая хранит все данные, связанные со значением ключа одной секции. Insights Preview ряда времени логически секции каждого большого двоичного объекта, на основе двух свойств:

* **Идентификатор временного ряда.** Ключ секции для всех данных Аналитики временных рядов в потоке событий и модели.
* **Метка времени.** Время, что зависит от начального входящего трафика.

Insights Preview ряда времени предоставляет высокопроизводительных запросов, основанных на этих двух свойств. Эти два свойства также предоставляют наиболее эффективный метод для быстрой доставки данных Аналитики временных рядов.

Важно выбрать соответствующий идентификатор временного ряда, так как это неизменяемое свойство. Дополнительные сведения см. в статье [Лучшие методики при выборе идентификатора временного ряда](./time-series-insights-update-how-to-id.md).

## <a name="azure-storage"></a>Хранилище Azure

### <a name="your-storage-account"></a>Учетной записи хранения

При создании среды с оплатой по мере использования Аналитики временных рядов создается два ресурса: среда Аналитики временных рядов и учетная запись службы хранилища Azure общего назначения версии 1 для хранения данных. Из-за взаимодействия, цены и производительности мы решили сделать службу хранилища Azure общего назначения версии 1 ресурсом по умолчанию. 

В вашей учетной записи хранения Azure Аналитика временных рядов публикует до двух копий каждого события. Начальной копии всегда сохраняются так, что позволяет быстро выполнять запросы с помощью других служб. Можно с легкостью использовать Spark, Hadoop и другие знакомые инструменты для идентификаторов временных рядов поверх необработанных файлов Parquet, поскольку эти механизмы поддерживают базовую фильтрацию имен файлов. Группирование больших двоичных объектов по году и месяцу – эффективный метод перечисления больших двоичных объектов в конкретный временной диапазон для пользовательского задания. 

Кроме того, Аналитика временных рядов повторно секционирует файлы Parquet для оптимизации API-интерфейсов Аналитики временных рядов. Также сохраняется файл, который был недавно разделен на секции.

На этапе общедоступной предварительной версии данные хранятся неограниченное время в вашей учетной записи хранилища Azure.

### <a name="writing-and-editing-time-series-insights-blobs"></a>Записывание и изменение больших двоичных объектов Аналитики временных рядов

Чтобы обеспечить производительность и доступность данных, не изменяйте и не удаляйте большие двоичные объекты, созданные с помощью Аналитики временных рядов.

### <a name="accessing-and-exporting-data-from-time-series-insights-preview"></a>Доступ и экспорт данных из Аналитики временных рядов (предварительная версия)

Доступ к данным можно получить в обозревателе Аналитики временных рядов (предварительная версия) для использования в сочетании с другими службами. Например, данные можно использовать для отчета в Power BI, для выполнения машинного обучения с помощью Студии машинного обучения Azure или для использования в приложении с записными книжками Jupyter Notebook.

Получить доступ к данными можно тремя основными способами:

* В обозревателе предварительного просмотра во время ряда Insights: вы можете экспортировать данные в CSV-файл в обозревателе предварительного просмотра во время Series Insights. Дополнительные сведения см. в статье [Визуализация данных в обозревателе (предварительная версия)](./time-series-insights-update-explorer.md).
* Из временных рядов Insights предварительные версии API: конечная точка API можно связаться по адресу `/getRecorded`. Дополнительные сведения об этом API см. в статье [Запрашивание данных](./time-series-insights-update-tsq.md).
* Непосредственно из учетной записи хранения Azure (см. ниже).

#### <a name="from-an-azure-storage-account"></a>Из учетную запись хранения Azure

* Необходим доступ на чтение любой используемой для доступа к данным Аналитики временных рядов учетной записи. Дополнительные сведения см. в статье [Управление анонимным доступом на чтение к контейнерам и большим двоичным объектам](https://docs.microsoft.com/azure/storage/blobs/storage-manage-access-to-resources).
* Дополнительные сведения о прямых способах чтения данных из хранилища BLOB-объектов Azure см. в статье [Перемещение данных в службу хранилища Azure и обратно](https://docs.microsoft.com/azure/storage/common/storage-moving-data?toc=%2fazure%2fstorage%2fblobs%2ftoc.json).
* Для экспорта данных из учетной записи хранения Azure необходимо сделать следующее.
    * Сначала убедитесь, что учетная запись соответствует необходимым требованиям к экспорту данных. Дополнительные сведения см. в статье [Требования к системе для импорта и экспорта Azure](https://docs.microsoft.com/azure/storage/common/storage-import-export-requirements).
    * Дополнительные сведения о способах экспорта данных из вашей учетной записи хранения Azure см. в статье [Использование службы "Импорт и экспорт Azure" для экспорта данных из хранилища BLOB-объектов Azure](https://docs.microsoft.com/azure/storage/common/storage-import-export-data-from-blobs).

### <a name="data-deletion"></a>Удаление данных

Не удаляйте большие двоичные объекты. Не только они полезны для аудита и обслуживания данных записи, предварительного просмотра во время Series Insights поддерживает метаданные большого двоичного объекта в пределах каждого большого двоичного объекта.

## <a name="time-series-insights-data-ingress"></a>Объем входящих данных времени Series Insights

### <a name="ingress-policies"></a>Входящие политики

Предварительная версия Insights ряда времени поддерживает одному источнику события и типы файлов, которые в настоящее время поддерживает Time Series Insights.

Поддерживаемые источники событий включают:

- Центр Интернета вещей Azure
- Центры событий Azure
  
  > [!NOTE]
  > Экземпляры концентратора событий Azure поддерживают Kafka.

Поддерживаемые типы файлов включают:

* JSON. Для дополнительных сведений о поддерживаемых формах JSON см. статью [Отправка событий в среду службы "Аналитика временных рядов" с помощью концентратора событий](./time-series-insights-send-events.md#json).

### <a name="data-availability"></a>Доступность данных

Insights Preview ряда времени индексирует данные с помощью стратегию оптимизации размер большого двоичного объекта. Данные становятся доступными для запроса после индексирования, которое зависит от того, какой объем данных поступает и на какой скорости.

> [!IMPORTANT]
> * Выпуск Аналитики временных рядов (общедоступная версия) сделает данные доступными в течение 60 секунд после попадания в источник события. 
> * На этапе предварительной версии ожидается, что данные станут доступными через более длительный период.
> * Обязательно свяжитесь с нами в случае возникновения значительных задержек.

### <a name="scale"></a>Масштабирование

Предварительная версия Insights ряда времени поддерживает масштабе начальной входящих данных до 1 байта мегабайт в секунду (Мбит/с) каждой среды. Текущей задачей является расширенная поддержка масштабирования. Мы планируем обновить документацию, чтобы показать эти улучшения.

## <a name="next-steps"></a>Дальнейшие действия

- См. статью [Хранилище данных и входящий трафик в Аналитике временных рядов Azure (предварительная версия)](./time-series-insights-update-storage-ingress.md).

- О новой модели данных читайте [здесь](./time-series-insights-update-tsm.md).

<!-- Images -->
[1]: media/v2-update-storage-ingress/storage-architecture.png
[2]: media/v2-update-storage-ingress/parquet-files.png
[3]: media/v2-update-storage-ingress/blob-storage.png
