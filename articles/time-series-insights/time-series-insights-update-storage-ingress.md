---
title: Хранение и входные данные в предварительной версии — служба "аналитика временных рядов Azure" | Документация Майкрософт
description: Сведения о хранении и входе данных в предварительной версии службы "аналитика временных рядов Azure".
author: lyrana
ms.author: lyhughes
manager: cshankar
ms.workload: big-data
ms.service: time-series-insights
services: time-series-insights
ms.topic: conceptual
ms.date: 02/10/2020
ms.custom: seodec18
ms.openlocfilehash: 44c942e43cd4be1d04f56e828e3e17c58713a706
ms.sourcegitcommit: dd3db8d8d31d0ebd3e34c34b4636af2e7540bd20
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/22/2020
ms.locfileid: "77559850"
---
# <a name="data-storage-and-ingress-in-azure-time-series-insights-preview"></a>Хранилище данных и входящий трафик в Аналитике временных рядов Azure (предварительная версия)

В этой статье описываются обновления хранилища данных и входящего трафика для предварительной версии службы "аналитика временных рядов Azure". Он описывает базовую структуру хранилища, формат файла и свойство идентификатора временного ряда. Также описаны базовый процесс приема, рекомендации и текущие ограничения предварительной версии.

## <a name="data-ingress"></a>Исходящие данные

Среда службы "аналитика временных рядов Azure" содержит *подсистему приема* для накопления, обработки и хранения данных временных рядов. 

Существуют некоторые соображения, которые необходимо учитывать, чтобы обеспечить обработку всех входящих данных, достичь высокого масштаба приема и уменьшить *задержку* при приеме (время, затрачиваемое службой "аналитика временных рядов" для чтения и обработки данных из источника событий) при [планировании среды](time-series-insights-update-plan.md).

Временные данные анализа данных временных рядов "предварительный просмотр" определяют, откуда могут быть источником данных, и какой формат данных должен иметь.

### <a name="ingress-policies"></a>Политики входящих данных

Передача данных включает в себя способ *отправки данных в* среду предварительной версии службы "аналитика временных рядов Azure". 

Основные сведения о конфигурации, форматировании и рекомендациях приведены ниже.

#### <a name="event-sources"></a>Источники событий

Предварительная версия службы "аналитика временных рядов Azure" поддерживает следующие источники событий:

- [Центр Интернета вещей Azure](../iot-hub/about-iot-hub.md)
- [Центры событий Azure](../event-hubs/event-hubs-about.md)

Предварительная версия службы "аналитика временных рядов Azure" поддерживает не более двух источников событий на один экземпляр.

> [!IMPORTANT] 
> * При присоединении источника событий к среде предварительного просмотра может возникнуть большая первоначальная задержка. 
> Задержка источника событий зависит от числа событий, находящихся в данный момент в центре Интернета вещей или в концентраторе событий.
> * Большая задержка будет доменяться после первого приема исходных данных события. Отправьте запрос в службу поддержки с помощью портал Azure, если вы хотите столкнуться с высокой задержкой.

#### <a name="supported-data-format-and-types"></a>Поддерживаемые форматы и типы данных

Служба "аналитика временных рядов Azure" поддерживает формат JSON в кодировке UTF-8, отправленный из центра Интернета вещей Azure или концентраторов событий Azure. 

Поддерживаются следующие типы данных:

| Тип данных | Описание |
|---|---|
| **bool**; | Тип данных, имеющий одно из двух состояний: `true` или `false`. |
| **dateTime** | Представляет мгновенное время, обычно выраженное в виде даты и времени суток. Выражается в формате [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html) . |
| **double** | 64-разрядный [стандарт IEEE 754](https://ieeexplore.ieee.org/document/8766229) с двойной точностью. |
| **строка** | Текстовые значения, состоящие из символов Юникода.          |

#### <a name="objects-and-arrays"></a>Объекты и массивы

Сложные типы, такие как объекты и массивы, можно передавать в полезные данные событий, но при хранении данные будут обрабатываться процессом плоской обработки. 

Подробные сведения о формировании событий JSON, отправке сложного типа и преобразовании вложенных объектов доступны в [форме JSON для](./time-series-insights-update-how-to-shape-events.md) входных данных и запросов для помощи с планированием и оптимизацией.

### <a name="ingress-best-practices"></a>Рекомендации по входящим сообщениям

Мы рекомендуем применить следующие рекомендации:

* Настройте службу "аналитика временных рядов Azure" и любой центр Интернета вещей или концентратор событий в том же регионе, чтобы снизить возможную задержку.

* [Спланируйте потребность в масштабировании](time-series-insights-update-plan.md) , вычисляя ожидаемую скорость приема и убедившись, что она попадает в поддерживаемую частоту, указанную ниже.

* Узнайте, как оптимизировать и сформировать данные JSON, а также текущие ограничения в предварительной версии, читая [о том, как СФОРМИРОВАТЬ JSON для](./time-series-insights-update-how-to-shape-events.md)входных данных и запросов.

### <a name="ingress-scale-and-preview-limitations"></a>Ограничения на масштаб и предварительный просмотр входящих данных 

Ограничения на входящие данные предварительной версии службы "аналитика временных рядов Azure" описаны ниже.

> [!TIP]
> Ознакомьтесь с развернутой [средой предварительной](https://docs.microsoft.com/azure/time-series-insights/time-series-insights-update-plan#review-preview-limits) версии, чтобы получить полный список всех ограничений предварительной версии.

#### <a name="per-environment-limitations"></a>Ограничения на среду

Как правило, скорость входящих данных просматривается как коэффициент числа устройств в вашей организации, частоты вывода событий и размера каждого события:

*  **Число устройств** x **частота вывода событий** × **Размер каждого события**.

По умолчанию Предварительная версия "аналитика временных рядов" может принимать входящие данные с частотой **до 1 МБ в секунду (Мбит/с) для среды "аналитика временных рядов"** .

> [!TIP] 
> * По запросу может быть предоставлена поддержка среды для приема скоростей передачи до 16 Мбит/с.
> * Свяжитесь с нами, если требуется более высокая пропускная способность, отправив запрос в службу поддержки через портал Azure.
 
* **Пример 1**.

    В доставке Contoso имеется 100 000 устройств, которые порождают событие три раза в минуту. Размер события составляет 200 байт. Они используют концентратор событий с четырьмя секциями в качестве источника событий "аналитика временных рядов".

    * Скорость приема для среды "аналитика временных рядов": **100 000 устройств * 200 байт/событие * (3/60 событий/с) = 1 Мбит/с**.
    * Скорость приема на секцию составит 0,25 Мбит/с.
    * Ставка приема для доставки Contoso должна быть в пределах ограничения масштаба предварительной версии.

* **Пример 2:**

    Аналитика "contoso" имеет 60 000 устройств, каждый из которых создает событие каждую секунду. В качестве источника событий "аналитика временных рядов" используется число 4 разделов центра Интернета вещей, равное 24. Размер события составляет 200 байт.

    * Скорость приема в окружении: **20 000 устройств * 200 байт/событие * 1 событие/с = 4 Мбит/с**.
    * Скорость каждого раздела составит 1 Мбит/с.
    * Аналитика "Contoso-парк" может отправить запрос к службе "аналитика временных рядов" с помощью портал Azure, чтобы увеличить частоту приема для своей среды.

#### <a name="hub-partitions-and-per-partition-limits"></a>Секции центра и ограничения на секции

При планировании среды "аналитика временных рядов" важно учитывать конфигурацию источников событий, которые будут подключаться к службе "аналитика временных рядов". Центр Интернета вещей Azure и концентраторы событий используют секции, чтобы включить горизонтальное масштабирование для обработки событий. 

*Секция* — это упорядоченная последовательность событий, хранящихся в концентраторе. Число секций задается на этапе создания концентратора и не может быть изменено. 

Ознакомьтесь с рекомендациями по секционированию концентраторов событий, чтобы узнать, [сколько разделов мне нужно?](https://docs.microsoft.com/azure/event-hubs/event-hubs-faq#how-many-partitions-do-i-need)

> [!NOTE]
> Большинству центров Интернета вещей, используемых в службе "аналитика временных рядов Azure", требуется четыре раздела.

Независимо от того, создаете ли вы новый центр для среды "аналитика временных рядов" или используете существующую, вам потребуется рассчитать частоту приема для каждой секции, чтобы определить, находится ли она в пределах предварительной версии. 

В настоящее время предварительная версия службы "аналитика временных рядов Azure" имеет общий **Размер раздела в 0,5 Мбит/** с.

#### <a name="iot-hub-specific-considerations"></a>Вопросы, связанные с центром Интернета вещей

При создании устройства в центре Интернета вещей оно постоянно назначается секции. При этом центр Интернета вещей может гарантировать упорядочение событий (так как назначение никогда не изменится).

Фиксированное назначение секции также влияет на экземпляры Time Series Insights, которые принимают данные, отправляемые из центра Интернета вещей. Когда сообщения от нескольких устройств перенаправляются в концентратор с помощью одного идентификатора устройства шлюза, они могут поступать в один раздел одновременно, что может привести к превышению ограничений на масштаб каждого раздела. 

**Влияние**:

* Если в одном разделе реализована постоянная скорость приема данных по ограничению предварительной версии, то возможно, что служба "аналитика временных рядов" не синхронизирует все данные телеметрии устройств до тех пор, пока не будет превышен срок хранения информации в центре Интернета вещей. В результате отправленные данные могут быть потеряны, если ограничения приема постоянно превышены.

Для устранения этой ситуации рекомендуется выполнить следующие рекомендации:

* Перед развертыванием решения Вычислите частоту приема для каждой среды и каждого раздела.
* Обеспечьте балансировку нагрузки для устройств центра Интернета вещей в кратчайшие области.

> [!IMPORTANT]
> Для сред, использующих центр Интернета вещей в качестве источника событий, вычислите скорость приема с помощью числа используемых устройств-концентраторов, чтобы ставка была меньше 0,5 Мбит/с на раздел в предварительной версии.
> * Даже если несколько событий поступают одновременно, ограничение предварительной версии не будет превышено.

  ![Диаграмма разделов центра Интернета вещей](media/concepts-ingress-overview/iot-hub-partiton-diagram.png)

Дополнительные сведения об оптимизации пропускной способности концентратора и разделах см. в следующих ресурсах:

* [Масштаб центра Интернета вещей](https://docs.microsoft.com/azure/iot-hub/iot-hub-scaling)
* [Масштаб концентратора событий](https://docs.microsoft.com/azure/event-hubs/event-hubs-scalability#throughput-units)
* [Разделы концентратора событий](https://docs.microsoft.com/azure/event-hubs/event-hubs-features#partitions)

### <a name="data-storage"></a>Хранилище данных

При создании среды "аналитика временных рядов" с *оплатой по мере* использования (PAYG) вы создадите два ресурса Azure:

* Среда предварительного просмотра службы "аналитика временных рядов Azure", которая может быть настроена для горячего хранения.
* Учетная запись большого двоичного объекта хранилища Azure общего назначения версии 1 для холодного хранения данных.

Данные в горячем хранилище доступны только через [запрос временных рядов](./time-series-insights-update-tsq.md) и [Обозреватель предварительной версии службы "аналитика временных рядов Azure](./time-series-insights-update-explorer.md)". 

Предварительная версия службы "аналитика временных рядов" сохраняет данные холодного магазина в хранилище BLOB-объектов Azure в [формате файла Parquet](#parquet-file-format-and-folder-structure). Предварительный просмотр "аналитика временных рядов" управляет только данными этого холодного хранилища, но он доступен для чтения непосредственно в виде стандартных файлов Parquet.

> [!WARNING]
> Как владелец учетной записи хранилища BLOB-объектов Azure, где находятся данные холодного хранения, у вас есть полный доступ ко всем данным в учетной записи. Этот доступ включает разрешения на запись и удаление. Не изменяйте или не удаляйте данные, записываемые в предварительную версию аналитики временных рядов, так как это может привести к потере данных.

### <a name="data-availability"></a>Доступность данных

Предварительная версия аналитики временных рядов Azure и индексы данных для оптимальной производительности запросов. Данные становятся доступными для запроса из горячего (если включено) и холодного хранилища после индексирования. Объем принимаемых данных может повлиять на эту доступность.

> [!IMPORTANT]
> В течение предварительной версии может произойти период до 60 секунд, по истечении которого данные становятся доступными. При значительной задержке свыше 60 секунд отправьте запрос в службу поддержки через портал Azure.

## <a name="azure-storage"></a>Хранилище Azure

В этом разделе описываются подробные сведения о службе хранилища Azure, относящиеся к предварительной версии службы "аналитика временных рядов Azure".

Подробное описание хранилища BLOB [-объектов Azure см. в](../storage/blobs/storage-blobs-introduction.md)этой статье.

### <a name="your-storage-account"></a>Ваша учетная запись хранения

При создании среды PAYG "аналитика временных рядов Azure" в качестве долгосрочного холодного хранилища создается учетная запись большого двоичного объекта хранилища Azure общего назначения версии 1.  

Предварительная версия службы "аналитика временных рядов Azure" публикует до двух копий каждого события в учетной записи хранения Azure. Начальная копия содержит события, упорядоченные по времени приема. Этот порядок событий **всегда сохраняется** , поэтому другие службы могут получать доступ к событиям без возникновения проблем с виртуализацией. 

> [!NOTE]
> Вы также можете использовать Spark, Hadoop и другие знакомые инструменты для обработки необработанных файлов Parquet. 

Предварительная версия "аналитика временных рядов" также выполняет повторное секционирование файлов Parquet для оптимизации запроса "аналитика временных рядов". Эта повторно секционированная копия данных также сохраняется. 

Во время общедоступной предварительной версии данные хранятся в учетной записи хранения Azure бессрочно.

#### <a name="writing-and-editing-time-series-insights-blobs"></a>Записывание и изменение больших двоичных объектов Аналитики временных рядов

Чтобы обеспечить производительность запросов и доступность данных, не изменяйте и не удаляйте большие двоичные объекты, создаваемые в предварительной версии "аналитика временных рядов".

#### <a name="accessing-and-exporting-data-from-time-series-insights-preview"></a>Доступ и экспорт данных из Аналитики временных рядов (предварительная версия)

Вы можете получить доступ к данным, просматриваемым в обозревателе предварительного просмотра службы "аналитика временных рядов", для использования в сочетании с другими службами. Например, данные можно использовать для построения отчета в Power BI или для обучения модели машинного обучения с помощью Машинное обучение Azure Studio. Вы также можете использовать данные для преобразования, визуализации и моделирования в записных книжках Jupyter.

Получить доступ к данными можно тремя основными способами:

* из обозревателя Аналитики временных рядов (предварительная версия); Данные можно экспортировать в виде CSV-файла из проводника. Дополнительные сведения см. в [обозревателе предварительного просмотра аналитики временных рядов](./time-series-insights-update-explorer.md).
* Из API предварительной версии аналитики временных рядов с помощью запроса GET Events. Дополнительные сведения об этом API см. в [запросе на чтение временных рядов](./time-series-insights-update-tsq.md).
* Непосредственно из учетной записи хранения Azure. Вам нужен доступ на чтение к любой учетной записи, которую вы используете для доступа к данным предварительной версии службы "аналитика временных рядов". Дополнительные сведения см. [в статье Управление доступом к ресурсам учетной записи хранения](../storage/blobs/storage-manage-access-to-resources.md).

#### <a name="data-deletion"></a>Удаление данных

Не удаляйте файлы предварительной версии "аналитика временных рядов". Управление связанными данными из только в предварительной версии "аналитика временных рядов".

### <a name="parquet-file-format-and-folder-structure"></a>Формат файла Parquet и структура папок

Parquet — это формат файлов столбцов с открытым исходным кодом, предназначенный для эффективного хранения и производительности. В предварительной версии "аналитика временных рядов" по этим причинам используется Parquet. Он разделяет данные по ИДЕНТИФИКАТОРу временного ряда для производительности запросов в масштабе.  

Дополнительные сведения о типе файла Parquet см. в [документации по Parquet](https://parquet.apache.org/documentation/latest/).

В предварительной версии аналитики временных рядов хранятся копии данных следующим образом:

* Первая, начальная копия секционирована по времени приема и сохраняет данные приблизительно в порядке поступления. Данные находятся в папке `PT=Time`:

  `V=1/PT=Time/Y=<YYYY>/M=<MM>/<YYYYMMDDHHMMSSfff>_<TSI_INTERNAL_SUFFIX>.parquet`

* Вторая, секционированная копия секционирована по группе идентификаторов временных рядов и расположению в папке `PT=TsId`:

  `V=1/PT=TsId/Y=<YYYY>/M=<MM>/<YYYYMMDDHHMMSSfff>_<TSI_INTERNAL_SUFFIX>.parquet`

В обоих случаях значения времени соответствуют времени создания большого двоичного объекта. Данные в папке `PT=Time` сохраняются. Данные в папке `PT=TsId` будут оптимизированы для запросов в течение определенного времени и не будут оставаться статическими.

> [!NOTE]
> * `<YYYY>` сопоставляется с представлением года из четырех цифр.
> * `<MM>` сопоставляется с представлением месяца из двух цифр.
> * `<YYYYMMDDHHMMSSfff>` сопоставляется с представлением временной метки с четырехзначным годом (`YYYY`), двузначным месяцем (`MM`), двузначным числом (`DD`), двумя цифрами (`HH`), двумя цифрами (`MM`), двумя цифрами (`SS`) и с тремя цифрами (`fff`).

События предварительной версии аналитики временных рядов сопоставляются с содержимым файла Parquet следующим образом:

* Каждое событие сопоставляется с отдельной строкой.
* Каждая строка содержит столбец **timestamp** с меткой времени события. Свойство временной метки не может иметь значение null. Если свойство временной метки не указано в источнике событий, по умолчанию используется **событие в очереди** . Метка времени всегда находится в формате UTC.
* Каждая строка включает столбцы ИДЕНТИФИКАТОРов временных рядов, как определено при создании среды "аналитика временных рядов". Имя свойства включает суффикс `_string`.
* Все остальные свойства, отправленные как данные телеметрии, сопоставляются с именами столбцов, заканчивающимися `_string` (String), `_bool` (Boolean), `_datetime` (DateTime) или `_double` (Double) в зависимости от типа свойства.
* Эта схема сопоставления применяется к первой версии формата файла, ссылка на которую указана как **V = 1**. По мере развития этой функции имя может увеличиваться.

## <a name="next-steps"></a>Следующие шаги

- Узнайте, [как СФОРМИРОВАТЬ JSON для](./time-series-insights-update-how-to-shape-events.md)входных данных и запросов.

- Ознакомьтесь с новым [моделированием данных](./time-series-insights-update-tsm.md).
