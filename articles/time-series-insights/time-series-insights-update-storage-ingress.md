---
title: Хранение и проникновение данных в Предварительный просмотр - Azure Time Series Исследования (ru) Документы Майкрософт
description: Узнайте о хранении и проникновении данных в Обзор ныхлапов временных обзоров.
author: lyrana
ms.author: lyhughes
manager: cshankar
ms.workload: big-data
ms.service: time-series-insights
services: time-series-insights
ms.topic: conceptual
ms.date: 02/10/2020
ms.custom: seodec18
ms.openlocfilehash: 8987cbe6860422ff92119a9f3b13a0a365e6d1a4
ms.sourcegitcommit: bc738d2986f9d9601921baf9dded778853489b16
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/02/2020
ms.locfileid: "80618323"
---
# <a name="data-storage-and-ingress-in-azure-time-series-insights-preview"></a>Хранилище данных и входящий трафик в Аналитике временных рядов Azure (предварительная версия)

В этой статье описаны обновления для хранения данных и вхотворения для Azure Time Series Insights Preview. Он описывает базовую структуру хранилища, формат файла и свойство Идентификатор АИД Time Series. Также описаны основной процесс входа, рекомендации и текущие ограничения предварительного просмотра.

## <a name="data-ingress"></a>Проникновение данных

Среда Исследования времени Azure содержит *движок приема для* сбора, обработки и хранения данных временных рядов. 

Есть некоторые соображения, которые следует помнить, чтобы обеспечить все входящие данные обрабатываются, для достижения высокой шкалы входа, и свести к минимуму *задержку приема* (время, задействованное Time Series Insights для чтения и обработки данных из источника событий) при [планировании среды.](time-series-insights-update-plan.md)

Политики входа данных Time Series Insights определяют, откуда можно получить данные и какой формат должны иметь данные.

### <a name="ingress-policies"></a>Политика по назнаню

*Проникновение данных* связано с тем, как данные отправляются в среду previews Azure Time Series. 

Ниже приведены ключевые конфигурации, форматирования и рекомендации.

#### <a name="event-sources"></a>Источники событий

Azure Time Series Insights Preview поддерживает следующие источники событий:

- [Центр Интернета вещей Azure](../iot-hub/about-iot-hub.md)
- [Центры событий Azure](../event-hubs/event-hubs-about.md)

Azure Time Series Insights Preview поддерживает максимум два источника событий в экземпляре.

> [!IMPORTANT] 
> * При подключении источника событий к среде Preview может возникнуть высокая начальная задержка. 
> Задержка источника событий зависит от количества событий, в настоящее время в вашем концентраторе IoT или Концентраторе событий.
> * Высокая задержка утихнет после того, как данные источника событий будут впервые просачены. Отправьте билет поддержки через портал Azure, если у вас постоянно йенс той или иной задержки.

#### <a name="supported-data-format-and-types"></a>Поддерживаемый формат и типы данных

Azure Time Series Insights поддерживает закодированный JSON, отправленный из концентратора Azure IoT или Azure Event Hubs. 

Поддерживаемые типы данных:

| Тип данных | Описание |
|---|---|
| **bool** | Тип данных, имеющий `true` одно `false`из двух состояний: или . |
| **Datetime** | Представляет текущее время, обычно выраженное как дата и время суток. Выражено в формате [ISO 8601.](https://www.iso.org/iso-8601-date-and-time-format.html) |
| **Двухместный** | Двухточная 64-разрядная плавающая точка [IEEE 754.](https://ieeexplore.ieee.org/document/8766229) |
| **Строка** | Текстовые значения, состоящие из символов Юникода.          |

#### <a name="objects-and-arrays"></a>Объекты и массивы

Вы можете отправлять сложные типы, такие как объекты и массивы, как часть полезной нагрузки события, но ваши данные будут проходить процесс уплощения при хранении. 

Подробная информация, описывающая, как формировать события JSON, отправлять сложный тип и уплощение вложенных объектов, доступна в [Какой форме JSON для входа и запроса,](./time-series-insights-update-how-to-shape-events.md) чтобы помочь в планировании и оптимизации.

### <a name="ingress-best-practices"></a>Вход передовой практики

Мы рекомендуем использовать следующие рекомендации:

* Нанастройка Azure Time Series Insights и любого концентратора IoT или событий в одном регионе, чтобы уменьшить потенциальную задержку.

* [Планируйте потребности в масштабе,](time-series-insights-update-plan.md) вычисляя ожидаемый уровень приема и проверяя, что он подпадает под указанную ставку, указанную ниже.

* Понять, как оптимизировать и формировать данные JSON, а также текущие ограничения в предварительном просмотре, читая, [как сформировать JSON для входа и запроса.](./time-series-insights-update-how-to-shape-events.md)

### <a name="ingress-scale-and-preview-limitations"></a>Масштаб ingress и ограничения предварительного просмотра 

Ниже описаны ограничения на проникновение Azure Time Series Insights.

> [!TIP]
> Прочитайте [среду предварительного просмотра](https://docs.microsoft.com/azure/time-series-insights/time-series-insights-update-plan#review-preview-limits) для полного списка всех лимитов предварительного просмотра.

#### <a name="per-environment-limitations"></a>Ограничения среды

В целом, коэффициенты входа рассматриваются как фактор количества устройств, накоторыехающих в вашей организации, частоты выбросов событий и размера каждого события:

*  **Количество устройств** - **частота выбросов событий** - **размер каждого события.**

По умолчанию предварительный просмотр Time Series Insights может глотать поступающие данные со скоростью **до 1 мегабайт в секунду (MBps) в среде Time Series Insights.** Существуют дополнительные ограничения [на раздел концентратора.](https://docs.microsoft.com/azure/time-series-insights/time-series-insights-update-storage-ingress#hub-partitions-and-per-partition-limits)

> [!TIP] 
> * Экологическая поддержка для глотания скорости до 16 Мбит/ с есть может быть обеспечена по запросу.
> * Свяжитесь с нами, если вам требуется более высокая пропускная информация, отправив билет поддержки через портал Azure.
 
* **Пример 1.**

    Contoso Shipping имеет 100 000 устройств, которые излучают событие три раза в минуту. Размер события составляет 200 байтов. Они используют концентратор Iot с четырьмя разделами в качестве источника событий Time Series Insights.

    * Коэффициент приема для среды Time Series Insights будет: **100 000 устройств, 200 байтов/событий (3/60 события/сек) - 1 Мбит/с.**
    * Скорость приема на раздел составит 0,25 Мбит/с.
    * Скорость приема Contoso Shipping будет в пределах ограничения шкалы предварительного просмотра.

* **Пример 2:**

    Contoso Fleet Analytics имеет 60 000 устройств, которые излучают событие каждую секунду. Они используют концентратор событий с числом разделов 4 в качестве источника событий Time Series Insights. Размер события составляет 200 байтов.

    * Скорость приема в окружающую среду будет: **60 000 устройств, 200 байтов/событие - 1 событие/сек - 12 Мбит/с.**
    * Коэффициент на перегородку составит 3 Мбит/с.
    * Скорость приема Contoso Fleet Analytics находится в пределах окружающей среды и раздела. Они могут отправить запрос на портал Time Series Insights через портал Azure, чтобы увеличить скорость приема для своей среды, и создать концентратор событий с большим количеством разделов, чтобы быть в пределах предварительного просмотра.

#### <a name="hub-partitions-and-per-partition-limits"></a>Перегородки концентратора и пределы раздела

При планировании среды Time Series Insights важно учитывать конфигурацию источника событий(ы), которую вы будете подключать к Time Series Insights. Концентраторы Azure IoT и Event Hubs используют разделы для горизонтального масштаба для обработки событий. 

*Раздел* — это упорядоченная последовательность событий, проводимых в концентраторе. Количество разделов устанавливается на этапе создания концентратора и не может быть изменено. 

Для раздела лучших практик Event Hubs [просмотрите, сколько разделов мне нужно?](https://docs.microsoft.com/azure/event-hubs/event-hubs-faq#how-many-partitions-do-i-need)

> [!NOTE]
> Большинству концентраторов IoT, используемых в Azure Time Series Insights, требуется всего четыре раздела.

Создаете ли вы новый концентратор для среды Time Series Insights или используете существующий, необходимо рассчитать скорость приема на раздел, чтобы определить, находится ли он в пределах предварительного просмотра. 

Azure Time Series Исследования Предварительный в настоящее время имеет общий **предел раздела 0,5 Мбит / с**.

#### <a name="iot-hub-specific-considerations"></a>Специфические соображения Концентратора IoT

Когда устройство создается в Концентраторе IoT, оно постоянно назначается разделу. При этом IoT Hub может гарантировать заказ событий (так как назначение никогда не меняется).

Назначение фиксированной перегородки также влияет на экземпляры Time Series Insights, которые используют данные, отправленные из КонцентриIo. Когда сообщения с нескольких устройств направляются в концентратор с использованием одного идентификатора устройства шлюза, они могут поступать в один и тот же раздел в то же время, потенциально превышающий пределы шкалы раздела. 

**Воздействие**:

* Если один раздел испытывает устойчивую скорость приема по сравнению с лимитом Preview, возможно, что Time Series Insights не будет синхронизировать всю телеметрию устройства до превышения периода хранения данных Концентратора IoT. В результате, отправленные данные могут быть потеряны, если лимиты приема постоянно превышены.

Чтобы смягчить это обстоятельство, мы рекомендуем следующие рекомендации:

* Рассчитайте скорость приема на одну среду и перегородку перед развертыванием решения.
* Убедитесь, что ваши устройства IoT Hub сбалансированы погрузке в максимально возможной степени.

> [!IMPORTANT]
> Для сред, использующих IoT Hub в качестве источника событий, вычислите скорость приема с использованием количества устройств концентратора, которые используются, чтобы убедиться, что скорость опустится ниже 0,5 Мбит/с на ограничение раздела при предварительном просмотре.
> * Даже если несколько событий приходят одновременно, лимит Preview не будет превышен.

  ![Диаграмма раздела концентратора IoT](media/concepts-ingress-overview/iot-hub-partiton-diagram.png)

Обратитесь к следующим ресурсам, чтобы узнать больше об оптимизации пропускной связи и разделов:

* [Шкала концентратора IoT](https://docs.microsoft.com/azure/iot-hub/iot-hub-scaling)
* [Шкала концентратора событий](https://docs.microsoft.com/azure/event-hubs/event-hubs-scalability#throughput-units)
* [Разделы концентратора событий](https://docs.microsoft.com/azure/event-hubs/event-hubs-features#partitions)

### <a name="data-storage"></a>Хранилище данных

При создании среды SKU Time Series Insights *Preview-as-you-go* (PAYG) создается два ресурса Azure:

* Среда просмотра серии времени Azure, которая может быть настроена для хранения теплой информации.
* Для хранения данных о хладнокровии учетная запись общего назначения V1.

Данные в теплом магазине доступны только через [Запрос Time Series](./time-series-insights-update-tsq.md) и [Azure Time Series Исследования Предварительный исследователь.](./time-series-insights-update-explorer.md) Теплый магазин будет содержать последние данные в [период хранения,](./time-series-insights-update-plan.md#the-preview-environment) выбранный при создании среды Time Series Insights.

Time Series Insights Preview сохраняет данные о хладнокровии для хранения Azure Blob в [формате файла Parquet.](#parquet-file-format-and-folder-structure) Time Series Insights Preview управляет этими данными о хладнокровии исключительно, но он доступен для чтения непосредственно в качестве стандартных файлов паркета.

> [!WARNING]
> Как владелец учетной записи хранения Azure Blob, где хранятся данные охладной хранить, у вас есть полный доступ ко всем данным в учетной записи. Этот доступ включает в себя разрешение на запись и удаление. Не издавайте и не удаляйте данные, которые пишет Time Series Insights Preview, поскольку это может привести к потере данных.

### <a name="data-availability"></a>Доступность данных

Azure Time Series Исследования Предварительный разделов и индексирует данные для оптимальной производительности запроса. Данные становятся доступными для запроса как из теплого (если включен) и холодного магазина после его индексации. Объем данных, посягнув на понизить, может повлиять на эту доступность.

> [!IMPORTANT]
> Во время предварительного просмотра может возникнуть период до 60 секунд до появления данных. Если у вас возникла значительная задержка за 60 секунд, пожалуйста, отправьте билет поддержки через портал Azure.

## <a name="azure-storage"></a>Хранилище Azure

В этом разделе описаны сведения о хранилищах Azure, относящиеся к просмотру обзоров временных обзоров Серии данных Azure.

Подробноое описание хранилища Azure Blob можно узнать [в предисловии к системе хранения.](../storage/blobs/storage-blobs-introduction.md)

### <a name="your-storage-account"></a>Ваша учетная запись хранения

При создании среды Azure Time Series Insights Preview PAYG в качестве долгосрочного холодного магазина создается учетная запись общего назначения V1.  

Обзор анализа времени Azure Сведений сохраняет до двух копий каждого события в учетной записи хранения Azure. Одна копия хранит события, заказанные по времени приема, всегда позволяя получить доступ к событиям в заданном времени последовательности. Со временем Time Series Insights Preview также создает перепартизированную копию данных для оптимизации для выполнения запроса Time Series Insights. 

Во время публичного предварительного просмотра данные хранятся на неопределенный срок в учетной записи хранения Azure.

#### <a name="writing-and-editing-time-series-insights-blobs"></a>Записывание и изменение больших двоичных объектов Аналитики временных рядов

Чтобы обеспечить производительность запроса и доступность данных, не отсеивайте и не удаляйте капли, которые создает Time Series Insights Preview.

#### <a name="accessing-time-series-insights-preview-cold-store-data"></a>Доступ к данным временных рядов Обзор данных холодного хранилища 

В дополнение к доступу к данным из [Time Series Insights Preview Explorer](./time-series-insights-update-explorer.md) и Time Series [Query,](./time-series-insights-update-tsq.md)вы также можете получить доступ к вашим данным непосредственно из файлов Паркета, хранящихся в холодном магазине. Например, вы можете читать, преобразовывать и очищать данные в блокноте Jupyter, а затем использовать его для обучения модели машинного обучения Azure в том же рабочем процессе Spark.

Чтобы получить доступ к данным непосредственно из учетной записи хранилища Azure, необходимо прочитать доступ к учетной записи, используемой для хранения данных Time Series Insights Previews. Затем вы можете прочитать выбранные данные на основе времени `PT=Time` создания файла Паркет, расположенного в папке, описанной ниже в разделе [формата файла Parquet.](#parquet-file-format-and-folder-structure)  Для получения дополнительной информации о включении доступа к учетной записи хранилища можно получить [дополнительную информацию](../storage/blobs/storage-manage-access-to-resources.md)о включении доступа к учетной записи хранилища, см.

#### <a name="data-deletion"></a>Удаление данных

Не удаляйте файлы Time Series Insights Preview. Управляйте связанными данными только из серии Time Insights Preview.

### <a name="parquet-file-format-and-folder-structure"></a>Формат файла паркета и структура папки

Parquet — это формат столбцов с открытым исходным кодом, предназначенный для эффективного хранения и производительности. Time Series Insights Preview использует паркет для включения в масштаб производительности запросов на основе идентификаторов Time Series.  

Для получения дополнительной информации о типе файла паркета, прочитайте [документацию Паркета](https://parquet.apache.org/documentation/latest/).

Time Series Insights Предварительный просмотр хранит копии ваших данных следующим образом:

* Первая, начальная копия разделена временем приема и хранит данные примерно в порядке прибытия. Эти данные находятся в папке: `PT=Time`

  `V=1/PT=Time/Y=<YYYY>/M=<MM>/<YYYYMMDDHHMMSSfff>_<TSI_INTERNAL_SUFFIX>.parquet`

* Вторая, перепристененные копии сгруппирована по идентификациям Time Series и находится в папке: `PT=TsId`

  `V=1/PT=TsId/Y=<YYYY>/M=<MM>/<YYYYMMDDHHMMSSfff>_<TSI_INTERNAL_SUFFIX>.parquet`

В обоих случаях временное свойство файла Паркета соответствует времени создания капли. Данные `PT=Time` в папке сохраняются без изменений после того, как они записаны в файл. Данные `PT=TsId` в папке будут оптимизированы для запроса с течением времени и не являются статичными.

> [!NOTE]
> * `<YYYY>`карты четырехзначного годового представления.
> * `<MM>`карты для двухзначного ежемесячного представления.
> * `<YYYYMMDDHHMMSSfff>`карты на представление временных штампов с`YYYY`четырехзначным годом (), двузначным месяцем (),`MM`двузначным днем`DD`(), двузначным`HH`часом (), двузначной минутой (),`MM`двузначной второй (),`SS`и трехзначной миллисекундой ().`fff`

События Time Series Insights Preview отображаются в содержимом файла Паркет следующим образом:

* Каждое событие сопоставляется с отдельной строкой.
* Каждая строка включает в себя **столбец метки времени** с отметкой времени события. Свойство штамповки времени никогда не является недействительным. Он по умолчанию указывает на **время, указанное в момент,** когда свойство временной отметки не указано в источнике события. Сохраненная отметка времени всегда находится в UTC.
* Каждая строка включает в себя идентификатор Time Series (TSID), как это определено при создании среды Time Series Insights. Название свойства TSID `_string` включает суффикс.
* Все остальные свойства, отправленные в виде телеметрических `_string` данных, `_bool` отображаются на имена хиномах столбцов, которые заканчиваются (строка), (Boolean), `_datetime` (дата) или `_double` (двойной) в зависимости от типа свойства.
* Эта схема отображения применяется к первой версии формата файла, на который ссылаются как **V-1** и хранятся в базовой папке с тем же именем. По мере развития этой функции эта схема отображения может меняться, а эталонное имя будет приравнено.

## <a name="next-steps"></a>Следующие шаги

- [Узнайте, как формировать JSON для входа и запроса.](./time-series-insights-update-how-to-shape-events.md)

- Читайте о новом [моделировании данных](./time-series-insights-update-tsm.md).
