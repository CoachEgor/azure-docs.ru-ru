---
title: Хранилище данных и входящий трафик в службе "Аналитике временных рядов Azure" (предварительная версия) | Документация Майкрософт
description: Основные сведения о хранилище данных и входящем трафике в Аналитике временных рядов Azure (предварительная версия).
author: deepakpalled
ms.author: dpalled
manager: cshankar
ms.workload: big-data
ms.service: time-series-insights
services: time-series-insights
ms.topic: conceptual
ms.date: 10/23/2019
ms.custom: seodec18
ms.openlocfilehash: 0b61e194bdea5fd8272ffc0fc9e16a2d80d3cf60
ms.sourcegitcommit: 92d42c04e0585a353668067910b1a6afaf07c709
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/28/2019
ms.locfileid: "72989707"
---
# <a name="data-storage-and-ingress-in-azure-time-series-insights-preview"></a>Хранилище данных и входящий трафик в Аналитике временных рядов Azure (предварительная версия)

В этой статье описываются обновления хранилища данных и входящего трафика для предварительной версии службы "аналитика временных рядов Azure". Рассматриваются структура хранилища, формат файла и свойство идентификатора временного ряда. В нем также обсуждается базовый процесс приема, пропускная способность и ограничения.

## <a name="data-ingress"></a>Исходящие данные

В предварительной версии "аналитика временных рядов" политики передачи данных определяют, откуда могут быть источником данных, и какой формат данных должен иметь.

[Общие сведения о модели временных рядов![](media/v2-update-storage-ingress/tsi-data-ingress.png)](media/v2-update-storage-ingress/tsi-data-ingress.png#lightbox)

### <a name="ingress-policies"></a>Политики входящих данных

Предварительная версия "аналитика временных рядов" поддерживает те же источники событий, которые в настоящее время поддерживает аналитика временных рядов:

- [Центр Интернета вещей Azure](../iot-hub/about-iot-hub.md)
- [Центры событий Azure](../event-hubs/event-hubs-about.md)

Предварительная версия "аналитика временных рядов" поддерживает не более двух источников событий на один экземпляр.
  
Служба "аналитика временных рядов Azure" поддерживает JSON, отправленный через центр Интернета вещей Azure или концентраторы событий Azure. Сведения об оптимизации данных JSON Интернета вещей см. [в статье как СФОРМИРОВАТЬ JSON](./time-series-insights-send-events.md#supported-json-shapes).

### <a name="data-storage"></a>Хранилище данных

При создании среды SKU "аналитика временных рядов" с оплатой по мере использования вы создадите два ресурса Azure:

* Среда предварительного просмотра аналитики временных рядов, которая при необходимости может включать возможности горячего хранения.
* Учетная запись большого двоичного объекта хранилища Azure общего назначения версии 1 для холодного хранения данных.

Данные в горячем хранилище доступны только через [запрос временных рядов](./time-series-insights-update-tsq.md) и [Обозреватель предварительной версии службы "аналитика временных рядов Azure](./time-series-insights-update-explorer.md)". 

Предварительная версия службы "аналитика временных рядов" сохраняет данные холодного магазина в хранилище BLOB-объектов Azure в [формате файла Parquet](#parquet-file-format-and-folder-structure). Предварительный просмотр "аналитика временных рядов" управляет только данными этого холодного хранилища, но он доступен для чтения непосредственно в виде стандартных файлов Parquet.

> [!WARNING]
> Как владелец учетной записи хранилища BLOB-объектов Azure, где находятся данные холодного хранения, у вас есть полный доступ ко всем данным в учетной записи. Этот доступ включает разрешения на запись и удаление. Не изменяйте или не удаляйте данные, записываемые в предварительную версию аналитики временных рядов, так как это может привести к потере данных.

### <a name="data-availability"></a>Доступность данных
Аналитика временных рядов Insights (Предварительная версия) и индексы данных для оптимальной производительности запросов. Данные становятся доступными для запроса после индексирования. Объем принимаемых данных может повлиять на эту доступность.

> [!IMPORTANT]
> В выпуске общедоступной версии "аналитика временных рядов" данные будут доступны через 60 секунд после их считывания из источника событий. Во время действия предварительной версии может произойти более длительный период, по истечении которого данные становятся доступными. При значительной задержке, превышающей 60 секунд, свяжитесь с нами.

### <a name="scale"></a>Масштабирование

По умолчанию Предварительная версия "аналитика временных рядов" поддерживает первоначальный входной масштаб в 1 МБ в секунду на каждую среду. При необходимости доступна пропускная способность до 16 МБ/с. Если вам нужна Улучшенная поддержка масштабирования, свяжитесь с нами.

Вы можете получить дополнительные возможности приема и масштабирования для источника событий:

* [Центр Интернета вещей](../iot-hub/iot-hub-scaling.md)
* [Центры событий](../event-hubs/event-hubs-scalability.md)

## <a name="azure-storage"></a>Служба хранилища Azure

В этом разделе описываются подробные сведения о службе хранилища Azure, относящиеся к предварительной версии службы "аналитика временных рядов Azure".

Подробное описание хранилища BLOB [-объектов Azure см. в](../storage/blobs/storage-blobs-introduction.md)этой статье.

### <a name="your-storage-account"></a>Ваша учетная запись хранения

При создании среды "аналитика временных рядов" с оплатой по мере использования в качестве долгосрочного холодного магазина создается учетная запись большого двоичного объекта хранилища Azure общего назначения версии 1.  

Предварительная версия службы "аналитика временных рядов" публикует до двух копий каждого события в учетной записи хранения Azure. Начальная копия содержит события, упорядоченные по времени приема, и всегда сохраняются, поэтому для доступа к ней можно использовать другие службы. Для обработки необработанных файлов Parquet можно использовать Spark, Hadoop и другие знакомые инструменты. 

В предварительной версии "аналитика временных рядов" выполняется повторное секционирование файлов Parquet для оптимизации запроса "аналитика временных рядов". Эта повторно секционированная копия данных также сохраняется.

Во время общедоступной предварительной версии данные хранятся в учетной записи хранения Azure бессрочно.

### <a name="writing-and-editing-time-series-insights-blobs"></a>Записывание и изменение больших двоичных объектов Аналитики временных рядов

Чтобы обеспечить производительность запросов и доступность данных, не изменяйте и не удаляйте большие двоичные объекты, создаваемые в предварительной версии "аналитика временных рядов".

### <a name="accessing-and-exporting-data-from-time-series-insights-preview"></a>Доступ и экспорт данных из Аналитики временных рядов (предварительная версия)

Вы можете получить доступ к данным, просматриваемым в обозревателе предварительного просмотра службы "аналитика временных рядов", для использования в сочетании с другими службами. Например, данные можно использовать для построения отчета в Power BI или для обучения модели машинного обучения с помощью Машинное обучение Azure Studio. Вы также можете использовать данные для преобразования, визуализации и моделирования в записных книжках Jupyter.

Получить доступ к данными можно тремя основными способами:

* из обозревателя Аналитики временных рядов (предварительная версия); Данные можно экспортировать в виде CSV-файла из проводника. Дополнительные сведения см. в статье [Визуализация данных в обозревателе (предварительная версия)](./time-series-insights-update-explorer.md).
* Из API предварительной версии аналитики временных рядов. Можно обратиться к конечной точке API по адресу `/getRecorded`. Дополнительные сведения об этом API см. в статье [Запрашивание данных](./time-series-insights-update-tsq.md).
* непосредственно из учетной записи хранения Azure. Вам нужен доступ на чтение к любой учетной записи, которую вы используете для доступа к данным предварительной версии службы "аналитика временных рядов". Дополнительные сведения см. в статье [Управление анонимным доступом на чтение к контейнерам и большим двоичным объектам](../storage/blobs/storage-manage-access-to-resources.md).

### <a name="data-deletion"></a>Удаление данных

Не удаляйте файлы предварительной версии "аналитика временных рядов". Вы должны управлять связанными данными только в предварительной версии Time Series Insights.

## <a name="parquet-file-format-and-folder-structure"></a>Формат файла Parquet и структура папок

Parquet — это формат файлов столбцов с открытым исходным кодом, предназначенный для эффективного хранения и производительности. В предварительной версии "аналитика временных рядов" по этим причинам используется Parquet. Он разделяет данные по ИДЕНТИФИКАТОРу временного ряда для производительности запросов в масштабе.  

Дополнительные сведения о типе файла Parquet см. в документации по [Parquet](https://parquet.apache.org/documentation/latest/).

В предварительной версии аналитики временных рядов хранятся копии данных следующим образом:

* Первая, начальная копия секционирована по времени приема и сохраняет данные приблизительно в порядке поступления. Данные находятся в папке `PT=Time`:

  `V=1/PT=Time/Y=<YYYY>/M=<MM>/<YYYYMMDDHHMMSSfff>_<TSI_INTERNAL_SUFFIX>.parquet`

* Вторая, секционированная копия секционирована по группе идентификаторов временных рядов и расположению в папке `PT=TsId`:

  `V=1/PT=TsId/Y=<YYYY>/M=<MM>/<YYYYMMDDHHMMSSfff>_<TSI_INTERNAL_SUFFIX>.parquet`

В обоих случаях значения времени соответствуют времени создания большого двоичного объекта. Данные в папке `PT=Time` сохраняются. Данные в папке `PT=TsId` будут оптимизированы для запросов в течение определенного времени и не будут оставаться статическими.

> [!NOTE]
> * `<YYYY>` сопоставляется с представлением года из четырех цифр.
> * `<MM>` сопоставляется с представлением месяца из двух цифр.
> * `<YYYYMMDDHHMMSSfff>` сопоставляется с представлением временной метки с четырехзначным годом (`YYYY`), двузначным месяцем (`MM`), днем, двумя цифрами (`DD`), двузначным числом (`HH`), двумя цифрами (`MM`), двумя цифрами (`SS`) и с тремя цифрами (в миллисекундах) (`fff`).

События предварительной версии аналитики временных рядов сопоставляются с содержимым файла Parquet следующим образом:

* Каждое событие сопоставляется с отдельной строкой.
* Каждая строка содержит столбец **timestamp** с меткой времени события. Свойство временной метки не может иметь значение null. Если свойство временной метки не указано в источнике событий, по умолчанию используется **событие в очереди** . Метка времени всегда находится в формате UTC.
* Каждая строка содержит столбец ИДЕНТИФИКАТОРов временных рядов, как определено при создании среды "аналитика временных рядов". Имя свойства включает суффикс `_string`.
* Все остальные свойства, отправленные как данные телеметрии, сопоставляются с именами столбцов, заканчивающимися `_string` (String), `_bool` (Boolean), `_datetime` (DateTime) или `_double` (Double) в зависимости от типа свойства.
* Эта схема сопоставления применяется к первой версии формата файла, ссылка на которую указана как **V = 1**. По мере развития этой функции имя может увеличиваться.

## <a name="next-steps"></a>Дальнейшие действия

- Чтение [хранилища и входных данных службы "аналитика временных рядов Azure](./time-series-insights-update-storage-ingress.md)".

- Ознакомьтесь с новым [моделированием данных](./time-series-insights-update-tsm.md).
