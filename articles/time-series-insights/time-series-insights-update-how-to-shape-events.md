---
title: Формирование событий с помощью службы "Аналитика временных рядов Azure" (предварительная версия) | Документация Майкрософт
description: Сведения о формировании событий с помощью предварительной версии службы "аналитика временных рядов Azure".
author: deepakpalled
ms.author: dpalled
manager: cshankar
ms.workload: big-data
ms.service: time-series-insights
services: time-series-insights
ms.topic: conceptual
ms.date: 10/31/2019
ms.custom: seodec18
ms.openlocfilehash: 8b9dd10a4017d821794af037e502c784b10cd62f
ms.sourcegitcommit: f4d8f4e48c49bd3bc15ee7e5a77bee3164a5ae1b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2019
ms.locfileid: "73585274"
---
# <a name="shape-events-with-azure-time-series-insights-preview"></a>Формирование событий с помощью предварительной версии службы "Аналитика временных рядов Azure"

Эта статья поможет вам сформировать файл JSON для приема и повысить эффективность запросов предварительной версии службы "аналитика временных рядов Azure".

## <a name="best-practices"></a>Рекомендации

Подумайте о том, как вы отправляете события в предварительную версию "аналитика временных рядов". А именно, следует всегда:

* Отправлять данные по сети наиболее эффективным путем.
* Храните свои данные таким образом, чтобы упростить их статистическое вычисление для своего сценария.

Для оптимальной производительности запросов выполните следующие действия.

* Не отправляйте необязательные свойства. Счета за службу "Аналитика временных рядов" (предварительная версия) выставляются на основе использования. Лучше всего хранить и обрабатывать те данные, которые вы будете запрашивать.
* Используйте поля экземпляра для статических данных, чтобы избежать отправки статических данных по сети. Поля экземпляров, компоненты модели временных рядов, работают как ссылочные данные в общедоступной службе службы "аналитика временных рядов". Дополнительные сведения о полях экземпляров см. в разделе [модель временных рядов](./time-series-insights-update-tsm.md).
* Два или несколько событий могут использовать одинаковые свойства измерения. Это позволит более эффективно отправлять данные по сети.
* Не применяйте глубокую вложенность массивов. Предварительная версия "аналитика временных рядов" поддерживает до двух уровней вложенных массивов, содержащих объекты. а также в сообщениях преобразует массивы в плоскую структуру, разбивая на несколько событий с парами "свойство — значение".
* Если для всех или большинства событий существует только несколько мер, лучше отправлять эти меры как отдельные свойства в одном и том же объекте. Их отправка отдельно сокращает количество событий и может повысить производительность запросов, так как требуется обработка меньшего количества событий.

Во время приема полезные данные, содержащие вложение, будут преобразованы в плоские, так что имя столбца представляет собой единственное значение с разделенным именем. В предварительной версии аналитики временных рядов для девстраивания используются символы подчеркивания. Обратите внимание, что это изменение из общедоступной версии продукта, в которой использовались периоды. Во время предварительной версии существует предостережение относительно прозрачности, которая проиллюстрирована во втором примере ниже.

## <a name="examples"></a>Примеры

Пример ниже основан на сценарии, в котором несколько устройств отправляют измерения или сигналы. Измерения или сигналы могут быть *частотой потока*, *давлением*, *температурным*и *влажностью*в ядре.

В этом примере имеется одно сообщение центра Интернета вещей Azure, где внешний массив содержит общий раздел общих значений измерений. Внешний массив использует данные экземпляра временных рядов для повышения эффективности сообщения. 

Экземпляр временных рядов содержит метаданные устройства. Эти метаданные не меняются при каждом событии, но предоставляют полезные свойства для анализа данных. Чтобы сохранить данные в байтах, отправляемых по каналу передачи, и сделать сообщение более эффективным, рассмотрите возможность пакетирования общих значений измерений и использования метаданных экземпляров временных рядов.

### <a name="example-1"></a>Пример 1

```JSON
[
  {
    "deviceId":"FXXX",
    "timestamp":"2018-01-17T01:17:00Z",
    "series":[
      {
        "Flow Rate ft3/s":1.0172575712203979,
        "Engine Oil Pressure psi ":34.7
      },
      {
        "Flow Rate ft3/s":2.445906400680542,
        "Engine Oil Pressure psi ":49.2
      }
    ]
  },
  {
    "deviceId":"FYYY",
    "timestamp":"2018-01-17T01:18:00Z",
    "series":[
      {
        "Flow Rate ft3/s":0.58015072345733643,
        "Engine Oil Pressure psi ":22.2
      }
    ]
  }
]
```

### <a name="time-series-instance"></a>Экземпляр временных рядов 

> [!NOTE]
> Идентификатор временного ряда — *deviceId*.

```JSON
[
  {
    "timeSeriesId":[
      "FXXX"
    ],
    "typeId":"17150182-daf3-449d-adaf-69c5a7517546",
    "hierarchyIds":[
      "b888bb7f-06f0-4bfd-95c3-fac6032fa4da"
    ],
    "description":null,
    "instanceFields":{
      "L1":"REVOLT SIMULATOR",
      "L2":"Battery System"
    }
  },
  {
    "timeSeriesId":[
      "FYYY"
    ],
    "typeId":"17150182-daf3-449d-adaf-69c5a7517546",
    "hierarchyIds":[
      "b888bb7f-06f0-4bfd-95c3-fac6032fa4da"
    ],
    "description":null,
    "instanceFields":{
      "L1":"COMMON SIMULATOR",
      "L2":"Battery System"
    }
  }
]
```

Предварительная версия службы "Аналитика временных рядов" объединяет таблицу (после преобразования в плоскую структуру) во время запроса. В таблице содержатся дополнительные столбцы, такие как **Тип**. В следующем примере показано, как можно [сформировать](./time-series-insights-send-events.md#supported-json-shapes) данные телеметрии.

| deviceId  | Тип | L1 | L2 | Timestamp | series_Flow Rate ft3/с | series_Engineное давление psi |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| `FXXX` | Default_Type | Имитирующее устройство | Система аккумулятора | 2018-01-17T01:17:00Z |   1.0172575712203979 |    34.7 |
| `FXXX` | Default_Type | Имитирующее устройство |   Система аккумулятора |    2018-01-17T01:17:00Z | 2.445906400680542 |  49.2 |
| `FYYY` | LINE_DATA    COMMON | Имитирующее устройство |    Система аккумулятора |    2018-01-17T01:18:00Z | 0.58015072345733643 |    22.2 |

В предыдущем примере следует отметить следующее:

* Статические свойства хранятся в предварительной версии службы "Аналитика временных рядов" для оптимизации данных, передаваемых по сети.
* Данные предварительной версии аналитики временных рядов соединяются во время выполнения запроса с помощью идентификатора временного ряда, определенного в экземпляре.
* Используются два слоя вложенности. Это число, которое поддерживает Предварительная версия "аналитика временных рядов". Критически важно избегать глубоко вложенных массивов.
* Так как у нас есть несколько мер, они передаются в виде отдельных свойств в одном и том же объекте. В этом примере **Series_Flow Rate**, **series_Engineная нагрузка PSI**и **series_Flow Rate ft3/s** являются уникальными столбцами.

>[!IMPORTANT]
> Поля экземпляров не хранятся в телеметрии. Они хранятся с метаданными в модели временных рядов.
> В приведенной выше таблице приводится представление запроса.

### <a name="example-2"></a>Пример 2

Рассмотрим следующий код JSON:

```JSON
{
  "deviceId": "FXXX",
  "timestamp": "2019-01-18T01:17:00Z",
  "data": {
        "flow": 1.0172575712203979,
    },
  "data_flow" : 1.76435072345733643
}
```
В приведенном выше примере плоское свойство `data_flow` представит конфликт имен со свойством `data_flow`. В этом случае *Последнее* значение свойства перезапишет предыдущее. Если это поведение представляет проблему для бизнес-сценариев, обратитесь к группе TSI.

> [!WARNING] 
> В случаях, когда в одной полезной нагрузке события имеются дублирующиеся свойства из-за преобразования или другого механизма, сохраняется последнее значение свойства, овервриттинг все предыдущие значения.


## <a name="next-steps"></a>Дальнейшие действия

- Чтобы применить эти рекомендации на практике, ознакомьтесь со статьей [Запрос данных из среды Azure Time Series Insights с помощью C#](./time-series-insights-query-data-csharp.md). Дополнительные сведения о синтаксисе запросов для предварительной версии "аналитика временных рядов" REST API для доступа к данным.
- Дополнительные сведения о поддерживаемых формах JSON см. в [этом](./time-series-insights-send-events.md#supported-json-shapes) разделе статьи "Отправка событий в среду Time Series Insights через концентратор событий".
