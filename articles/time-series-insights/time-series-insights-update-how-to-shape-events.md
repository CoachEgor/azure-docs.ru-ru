---
title: События фигур — аналитика временных рядов Azure | Документация Майкрософт
description: Узнайте о рекомендациях и способах формирования запросов в предварительной версии Azure Time Insights.
author: deepakpalled
ms.author: dpalled
manager: cshankar
ms.workload: big-data
ms.service: time-series-insights
services: time-series-insights
ms.topic: conceptual
ms.date: 02/24/2020
ms.custom: seodec18
ms.openlocfilehash: 99a2f32c3f76d7fec475c9b299f7208b4db29cfe
ms.sourcegitcommit: 96dc60c7eb4f210cacc78de88c9527f302f141a9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/27/2020
ms.locfileid: "77650929"
---
# <a name="shape-events-with-azure-time-series-insights-preview"></a>Формирование событий с помощью предварительной версии службы "Аналитика временных рядов Azure"

В этой статье описываются рекомендации по формированию полезных данных JSON для приема в службе "аналитика временных рядов Azure" и повышения эффективности предварительных запросов.

## <a name="best-practices"></a>Рекомендации

Лучше тщательно продумать, как вы отправляете события в среду предварительного просмотра аналитики временных рядов. 

Ниже приведены общие рекомендации.

* Отправлять данные по сети наиболее эффективным путем.
* Храните свои данные таким образом, чтобы упростить их статистическое вычисление для своего сценария.

Для оптимальной производительности запросов придерживайтесь следующих правил Thumb:

* Не отправляйте необязательные свойства. Предварительная версия аналитики временных рядов Insights за использование. Рекомендуется хранить и обрабатывать только те данные, которые вы запрашиваете.
* Используйте поля экземпляра для статических данных, Такой подход позволяет избежать отправки статических данных по сети. Поля экземпляров, компоненты модели временных рядов, работают как ссылочные данные в общедоступной службе службы "аналитика временных рядов". Дополнительные сведения о полях экземпляров см. в статье [модель временных рядов](./time-series-insights-update-tsm.md).
* Два или несколько событий могут использовать одинаковые свойства измерения. Это позволит более эффективно отправлять данные по сети.
* Не применяйте глубокую вложенность массивов. Предварительная версия "аналитика временных рядов" поддерживает до двух уровней вложенных массивов, содержащих объекты. а также в сообщениях преобразует массивы в плоскую структуру, разбивая на несколько событий с парами "свойство — значение".
* Если для всех или большинства событий существует только несколько мер, лучше отправлять эти меры как отдельные свойства в одном и том же объекте. Их отправка отдельно сокращает количество событий и может повысить производительность запросов, так как требуется обработка меньшего количества событий.

## <a name="column-flattening"></a>Сведение столбцов

Во время приема полезные данные, содержащие вложенные объекты, будут преобразованы в плоскую структуру, чтобы имя столбца было единственным значением с разделенным именем.

* Например, следующий вложенный код JSON:

   ```JSON
   "data": {
        "flow": 1.0172575712203979,
   },
   ```

   Преобразуются: `data_flow` при плоской.

> [!IMPORTANT]
> * В предварительной версии службы "аналитика временных рядов Azure" используются подчеркивания (`_`) для девстраивания столбцов.
> * Обратите внимание на разницу в общей доступности, в которой используются периоды (`.`).

Ниже показаны более сложные сценарии.

#### <a name="example-1"></a>Пример 1:

Следующий сценарий содержит два (или более) устройства, которые отправляют измерения (сигналы): *скорость потока*, *давление нехватки ядер*, *температуру*и *влажность*.

Существует одно сообщение центра Интернета вещей Azure, где внешний массив содержит общий раздел общих значений измерений (Обратите внимание на две записи устройства, содержащиеся в сообщении).

```JSON
[
  {
    "deviceId":"FXXX",
    "timestamp":"2018-01-17T01:17:00Z",
    "series":[
      {
        "Flow Rate ft3/s":1.0172575712203979,
        "Engine Oil Pressure psi ":34.7
      },
      {
        "Flow Rate ft3/s":2.445906400680542,
        "Engine Oil Pressure psi ":49.2
      }
    ]
  },
  {
    "deviceId":"FYYY",
    "timestamp":"2018-01-17T01:18:00Z",
    "series":[
      {
        "Flow Rate ft3/s":0.58015072345733643,
        "Engine Oil Pressure psi ":22.2
      }
    ]
  }
]
```

**Выводы**

* В примере JSON имеется внешний массив, который использует данные [экземпляра временных рядов](./time-series-insights-update-tsm.md#time-series-model-instances) для повышения эффективности сообщения. Несмотря на то, что экземпляры временных рядов не изменяют метаданные устройства, они часто предоставляют полезные свойства для анализа данных.

* JSON объединяет два или более сообщений (одно из каждого устройства) в единую полезную нагрузку с пропускной способностью с течением времени.

* Отдельные точки данных ряда для каждого устройства объединяются в один **одномерный атрибут** , уменьшая необходимость непрерывного потокового обновления для каждого устройства.

> [!TIP]
> Чтобы уменьшить количество сообщений, необходимых для отправки данных и повышения эффективности телеметрии, рассмотрите возможность пакетной обработки общих значений измерений и метаданных экземпляров временных рядов в одной полезной нагрузке JSON.

#### <a name="time-series-instance"></a>Экземпляр временных рядов 

Давайте подробнее рассмотрим, как использовать [экземпляр временных рядов](./time-series-insights-update-tsm.md#time-series-model-instances) для более оптимального формирования JSON. 

> [!NOTE]
> Ниже приведены [идентификаторы временных рядов](./time-series-insights-update-how-to-id.md) , *девицеидс*.

```JSON
[
  {
    "timeSeriesId":[
      "FXXX"
    ],
    "typeId":"17150182-daf3-449d-adaf-69c5a7517546",
    "hierarchyIds":[
      "b888bb7f-06f0-4bfd-95c3-fac6032fa4da"
    ],
    "description":null,
    "instanceFields":{
      "L1":"REVOLT SIMULATOR",
      "L2":"Battery System"
    }
  },
  {
    "timeSeriesId":[
      "FYYY"
    ],
    "typeId":"17150182-daf3-449d-adaf-69c5a7517546",
    "hierarchyIds":[
      "b888bb7f-06f0-4bfd-95c3-fac6032fa4da"
    ],
    "description":null,
    "instanceFields":{
      "L1":"COMMON SIMULATOR",
      "L2":"Battery System"
    }
  }
]
```

Предварительная версия службы "Аналитика временных рядов" объединяет таблицу (после преобразования в плоскую структуру) во время запроса. В таблице содержатся дополнительные столбцы, такие как **Тип**.

| deviceId  | Тип | L1 | L2 | TIMESTAMP | Частота series_Flow ft3/с | series_Engineная давление psi |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| `FXXX` | Default_Type | Имитирующее устройство | Система аккумулятора | 2018-01-17T01:17:00Z |   1.0172575712203979 |    34.7 |
| `FXXX` | Default_Type | Имитирующее устройство |   Система аккумулятора |    2018-01-17T01:17:00Z | 2.445906400680542 |  49.2 |
| `FYYY` | LINE_DATA    COMMON | Имитирующее устройство |    Система аккумулятора |    2018-01-17T01:18:00Z | 0.58015072345733643 |    22.2 |

> [!NOTE]
>  Приведенная выше таблица представляет представление запроса в [обозревателе предварительного просмотра временных рядов](./time-series-insights-update-explorer.md).

**Выводы**

* В предыдущем примере статические свойства хранятся в предварительной версии Time Series Insights для оптимизации данных, передаваемых по сети.
* Данные предварительной версии аналитики временных рядов соединяются во время выполнения запроса с помощью идентификатора временного ряда, определенного в экземпляре.
* Используются два слоя вложенности. Это число, которое поддерживает Предварительная версия "аналитика временных рядов". Критически важно избегать глубоко вложенных массивов.
* Так как у нас есть несколько мер, они передаются в виде отдельных свойств в одном и том же объекте. В этом примере **Series_Flow Rate**, **series_Engineное давление PSI**и **series_Flow Rate ft3/s** являются уникальными столбцами.

>[!IMPORTANT]
> Поля экземпляров не хранятся в телеметрии. Они хранятся с метаданными в модели временных рядов.

#### <a name="example-2"></a>Пример 2.

Рассмотрим следующий код JSON:

```JSON
{
  "deviceId": "FXXX",
  "timestamp": "2019-01-18T01:17:00Z",
  "data": {
        "flow": 1.0172575712203979,
    },
  "data_flow" : 1.76435072345733643
}
```

В приведенном выше примере плоское свойство `data["flow"]` представит конфликт имен со свойством `data_flow`.

В этом случае *Последнее* значение свойства перезапишет предыдущее. 

> [!TIP]
> Для получения дополнительной помощи обратитесь к группе "аналитика временных рядов".

> [!WARNING] 
> * В случаях, когда дублирующиеся свойства встречаются в одной и той же полезной нагрузке события из-за преобразования или другого механизма, Последнее значение свойства > сохраняется, переписываются все предыдущие значения.
> * Ряды Объединенных событий не будут переопределять друг друга.

## <a name="next-steps"></a>Дальнейшие действия

* Чтобы приложить эти рекомендации, ознакомьтесь с [синтаксисом запроса предварительной версии службы "аналитика временных рядов Azure](./time-series-insights-query-data-csharp.md)". Дополнительные сведения о синтаксисе запросов для [предварительной версии](https://docs.microsoft.com/rest/api/time-series-insights/preview) "аналитика временных рядов" REST API для доступа к данным.

* Объедините рекомендации JSON с [моделью временных рядов](./time-series-insights-update-how-to-tsm.md).
