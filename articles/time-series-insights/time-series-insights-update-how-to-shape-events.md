---
title: Формирование событий с помощью службы "Аналитика временных рядов Azure" (предварительная версия) | Документация Майкрософт
description: Общие сведения о формировании событий в службе "Аналитика временных рядов Azure" (предварительная версия).
author: ashannon7
ms.author: anshan
ms.workload: big-data
manager: cshankar
ms.service: time-series-insights
services: time-series-insights
ms.topic: conceptual
ms.date: 12/03/2018
ms.custom: seodec18
ms.openlocfilehash: 344f3a8b1bdfb789251479baffeb4df15bbf2842
ms.sourcegitcommit: 44a85a2ed288f484cc3cdf71d9b51bc0be64cc33
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "64718363"
---
# <a name="shape-events-with-azure-time-series-insights-preview"></a>Формирование событий с помощью предварительной версии службы "Аналитика временных рядов Azure"

В этой статье показано, как сформировать файл JSON, чтобы максимально повысить эффективность запросов в предварительной версии службы "Аналитика временных рядов Azure".

## <a name="best-practices"></a>Рекомендации

Важно подумать о том, как вы отправляете события в службу "Аналитика временных рядов" (предварительная версия). А именно, следует всегда:

* Отправлять данные по сети наиболее эффективным путем.
* Храните свои данные таким образом, чтобы упростить их статистическое вычисление для своего сценария.

Следующие рекомендации помогут обеспечить оптимальную производительность запросов.

* Не отправляйте необязательные свойства. Счета за службу "Аналитика временных рядов" (предварительная версия) выставляются на основе использования. Лучше всего хранить и обрабатывать те данные, которые вы будете запрашивать.
* Используйте поля экземпляра для статических данных, чтобы избежать отправки статических данных по сети. Поля экземпляра, являющиеся компонентом модели временных рядов, работают как эталонные данные в общедоступной службе "Аналитика временных рядов". Дополнительные сведения о полях экземпляра см. в статье [Time Series Model](./time-series-insights-update-tsm.md) (Модель временных рядов).
* Два или несколько событий могут использовать одинаковые свойства измерения. Это позволит более эффективно отправлять данные по сети.
* Не применяйте глубокую вложенность массивов. Предварительная версия службы "Аналитика временных рядов" поддерживает до двух уровней вложенных массивов с объектами, а также в сообщениях преобразует массивы в плоскую структуру, разбивая на несколько событий с парами "свойство — значение".
* Если для всех или большинства событий существует только несколько мер, лучше отправлять эти меры как отдельные свойства в одном и том же объекте. Отправка их по отдельности уменьшает количество событий, и, так как нужно обрабатывать меньше событий, такой подход может сделать запросы более производительными.

## <a name="example"></a>Пример

Пример ниже основан на сценарии, в котором несколько устройств отправляют измерения или сигналы. Это могут быть такие измерения или сигналы, как *скорость потока*, *давление масла в двигателе*, *температура* и *влажность*.

В следующем примере есть одно сообщение Центра Интернета вещей, в котором внешний массив содержит совместно используемый раздел значений общих измерений. Внешний массив использует данные экземпляра временных рядов для повышения эффективности сообщения. Экземпляр временных рядов содержит метаданные устройства, которые не изменяются при каждом событии, но предоставляют полезные свойства для анализа данных. Чтобы сэкономить на байтах, отправленных по сети, и повысить производительность сообщения, рассмотрите возможность пакетной обработки общих значений измерения и использования метаданных экземпляра временных рядов.

### <a name="example-json-payload"></a>Пример полезных данных JSON

```JSON
[
    {
        "deviceId": "FXXX",
        "timestamp": "2018-01-17T01:17:00Z",
        "series": [
            {
                "Flow Rate ft3/s": 1.0172575712203979,
                "Engine Oil Pressure psi ": 34.7
            },
            {
                "Flow Rate ft3/s": 2.445906400680542,
                "Engine Oil Pressure psi ": 49.2
            }
        ]
    },
    {
        "deviceId": "FYYY",
        "timestamp": "2018-01-17T01:18:00Z",
        "series": [
            {
                "Flow Rate psi": 0.58015072345733643,
                "Engine Oil Pressure psi ": 22.2
            }
        ]
    }
]
```

### <a name="time-series-instance"></a>Экземпляр временных рядов 
> [!NOTE]
> Идентификатор временного ряда — *deviceId*.

```JSON
{
    "timeSeriesId": [
      "FXXX"
    ],
    "typeId": "17150182-daf3-449d-adaf-69c5a7517546",
    "hierarchyIds": [
      "b888bb7f-06f0-4bfd-95c3-fac6032fa4da"
    ],
    "description": null,
    "instanceFields": {
      "L1": "REVOLT SIMULATOR",
      "L2": "Battery System",
    }
  },
  {
    "timeSeriesId": [
      "FYYY"
    ],
    "typeId": "17150182-daf3-449d-adaf-69c5a7517546",
    "hierarchyIds": [
      "b888bb7f-06f0-4bfd-95c3-fac6032fa4da"
    ],
    "description": null,
    "instanceFields": {
      "L1": "COMMON SIMULATOR",
      "L2": "Battery System",
    }
  },
```

Предварительная версия службы "Аналитика временных рядов" объединяет таблицу (после преобразования в плоскую структуру) во время запроса. В таблице содержатся дополнительные столбцы, такие как **Тип**. В следующем примере показано, как можно [сформировать](./time-series-insights-send-events.md#json) данные телеметрии:

| deviceId  | type | L1 | L2 |  timestamp | series.Flow Rate ft3/s | series.Engine Oil Pressure psi |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| `FXXX` | Default_Type | Имитирующее устройство батарейного питания | Система аккумулятора | 2018-01-17T01:17:00Z |    1.0172575712203979 |    34.7 |
| `FXXX` | LINE_DATA    REVOLT | Имитирующее устройство |    Система аккумулятора |    2018-01-17T01:17:00Z | 2.445906400680542 |  49.2 |
| `FYYY` | LINE_DATA    COMMON | Имитирующее устройство |    Система аккумулятора |    2018-01-17T01:18:00Z | 0.58015072345733643 |    22.2 |

В предыдущем примере следует отметить следующее:

* Статические свойства хранятся в предварительной версии службы "Аналитика временных рядов" для оптимизации данных, передаваемых по сети.
* Данные предварительной версии службы "Аналитика временных рядов" объединяются во время выполнения запроса на основе идентификатора *timeSeriesId*, определенного в экземпляре.
* Используются два уровня вложения — максимум, поддерживаемый предварительной версией службы "Аналитика временных рядов". Критически важно избегать глубоко вложенных массивов.
* Так как у нас есть несколько мер, они передаются в виде отдельных свойств в одном и том же объекте. В этом примере **series.Flow Rate psi**, **series.Engine Oil Pressure psi** и **series.Flow Rate ft3/s** — уникальные столбцы.

>[!IMPORTANT]
> Поля экземпляра не хранятся с данными телеметрии. Они хранятся с метаданными в **модели временных рядов**.
> В приведенной выше таблице приводится представление запроса.

## <a name="next-steps"></a>Дальнейшие действия

- Чтобы применить эти рекомендации на практике, ознакомьтесь со статьей [Запрос данных из среды Azure Time Series Insights с помощью C#](./time-series-insights-query-data-csharp.md). Вы узнаете больше о синтаксисе запроса для REST API доступа к данным предварительной версии службы "Аналитика временных рядов".

- Дополнительные сведения о поддерживаемых формах JSON см. в [этом](./time-series-insights-send-events.md#json) разделе статьи "Отправка событий в среду Time Series Insights через концентратор событий".