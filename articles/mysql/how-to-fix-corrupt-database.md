---
title: Устранение повреждений базы данных с базой данных Azure для MySQL
description: Узнайте, как устранить проблемы с повреждением базы данных Azure для MySQL
author: mksuni
ms.author: sumuth
ms.service: mysql
ms.topic: how-to
ms.date: 09/21/2020
ms.openlocfilehash: 815b24d25e674e5460cc50d7eb6871f740994893
ms.sourcegitcommit: 53acd9895a4a395efa6d7cd41d7f78e392b9cfbe
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/22/2020
ms.locfileid: "90938938"
---
# <a name="troubleshoot-database-corruption-on-azure-database-for-mysql"></a>Устранение неполадок с повреждением базы данных Azure для MySQL
[!INCLUDE[applies-to-single-flexible-server](includes/applies-to-single-flexible-server.md)]

Повреждение базы данных может привести к простою приложения, а также крайне важно устранить проблему во времени, чтобы избежать потери данных. Когда происходит повреждение базы данных, вы увидите, что на сервере регистрируется эта ошибка **InnoDB: повреждение страницы базы данных на диске или сбой**.

В этом руководство вы узнаете, как исправить, если база данных или таблица повреждены. База данных Azure для MySQL использует подсистему InnoDB Engine и включает в себя автоматическое выполнение операций по проверке повреждений и восстановлению. InnoDB проверяет наличие поврежденных страниц, выполняя контрольные суммы на каждой прочитанной странице, и при обнаружении несоответствия контрольной суммы она автоматически останавливает сервер MySQL.

Воспользуйтесь любым из приведенных ниже вариантов, чтобы быстро устранить проблемы, связанные с повреждением базы данных.

## <a name="restart-your-mysql-server"></a>Перезапуск сервера MySQL

Как правило, при доступе приложения к таблице ro база данных или таблица повреждена. Так как InnoDB содержит механизм восстановления после сбоя, который может решить большинство проблем при перезапуске сервера. Таким образом, перезапуск сервера должен помочь серверу восстановиться после сбоя, из-за которого база данных находится в неисправном состоянии.

##  <a name="resolve-data-corruption-with-dump-and-restore-method"></a>Устранение повреждений данных с помощью метода dump и восстановления

Рекомендуется устранить проблему повреждения с помощью **метода дампа и восстановления**. Это включает получение доступа к поврежденной таблице с помощью служебной программы **mysqldump** для создания логической резервной копии таблицы, которая будет хранить структуру таблицы и данные внутри нее, а затем снова загрузить таблицу в базу данных.

### <a name="backup-your-database-or-tables"></a>Резервное копирование базы данных или таблиц

> [!Important]
> - Настройте правило брандмауэра, чтобы получить доступ к серверу с клиентского компьютера. См. раздел Настройка [правила брандмауэра на отдельном сервере](howto-manage-firewall-using-portal.md) и [правило брандмауэра на гибком сервере](flexible-server/how-to-connect-tls-ssl.md).
> - Использовать параметр SSL ```--ssl-cert``` для **mysqldump** , если включен протокол SSL

Создание файла резервной копии из командной строки с помощью mysqldump с помощью этой команды

```
$ mysqldump [--ssl-cert=/path/to/pem] -h [host] -u [uname] -p[pass] [dbname] > [backupfile.sql]
```

Необходимо указать следующие параметры:
- [SSL-CERT =/Пас/то/пем] Скачайте SSL-сертификат на клиентском компьютере и задайте путь в команде. НЕ используйте этот протокол — SSL отключен.
- [узел] — это сервер базы данных Azure для MySQL.
- [uname] — имя пользователя администратора сервера
- [Pass] — пароль администратора.
- [dbname] — имя базы данных.
- [backupfile. SQL] Если имя файла для резервной копии базы данных

> [!Important]
> - Для одного сервера используйте формат ```admin-user@servername``` для замены в приведенных ```myserveradmin``` ниже командах.
> - Для гибкого сервера используйте формат ```admin-user``` для замены ```myserveradmin``` в приведенных ниже командах.

Если определенная таблица повреждена, выберите определенные таблицы в базе данных для резервного копирования с помощью этого примера.
```
$ mysqldump --ssl-cert=</path/to/pem> -h mydemoserver.mysql.database.azure.com -u myserveradmin -p testdb table1 table2 > testdb_tables_backup.sql
```

Чтобы создать резервную копию одной или нескольких баз данных, используйте параметр--Database и перечислите имена баз данных, разделенные пробелами.

```
$ mysqldump --ssl-cert=</path/to/pem>  -h mydemoserver.mysql.database.azure.com -u myserveradmin -p --databases testdb1 testdb3 testdb5 > testdb135_backup.sql
```

###  <a name="restore-your-database-or-tables"></a>Восстановление базы данных или таблиц

Ниже описано, как TP восстанавливает базу данных или таблицы. После создания файла резервной копии можно восстановить таблицу или базы данных с помощью программы ***MySQL** . Выполните команду, как показано ниже.

```
mysql  --ssl-cert=</path/to/pem> -h [hostname] -u [uname] -p[pass] [db_to_restore] < [backupfile.sql]
```
Ниже приведен пример восстановления ```testdb``` из файла резервной копии, созданного с помощью **mysqldump**. 

> [!Important]
> - Для одного сервера используйте формат ```admin-user@servername``` для замены ```myserveradmin``` в приведенной ниже команде.
> - Для гибкого сервера используйте формат ```admin-user``` для замены ```myserveradmin``` в приведенной ниже команде. 

```
$ mysql --ssl-cert=</path/to/pem> -h mydemoserver.mysql.database.azure.com -u myserveradmin -p testdb < testdb_backup.sql
```

## <a name="next-steps"></a>Next Steps
Если описанные выше действия не помогли устранить проблему, всегда можно восстановить весь сервер.
- [Восстановление одного сервера базы данных Azure для MySQL](howto-restore-server-portal.md)
- [Восстановление базы данных Azure для гибкого сервера MySQL](flexible-server/how-to-restore-server-portal.md)



