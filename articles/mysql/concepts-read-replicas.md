---
title: Прочитайте реплики - База данных Azure для MyS'L.
description: "Узнайте о рекреациях в базе данных Azure для MyS'L: выбор регионов, создание реплик, подключение к репликациям, мониторинг репликации и остановка репликации."
author: ajlam
ms.author: andrela
ms.service: mysql
ms.topic: conceptual
ms.date: 04/21/2020
ms.openlocfilehash: 47f686f810f62fe03a9b0217677c436f3b91782b
ms.sourcegitcommit: d57d2be09e67d7afed4b7565f9e3effdcc4a55bf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/22/2020
ms.locfileid: "81767889"
---
# <a name="read-replicas-in-azure-database-for-mysql"></a>Реплики чтения в базе данных Azure для MySQL

Компонент "Реплика чтения" позволяет реплицировать данные с сервера службы "База данных Azure для MySQL" на сервер только для чтения. Вы можете реплицировать данные с главного сервера на несколько реплик (до пяти). Реплики чтения асинхронно обновляются с помощью технологии репликации на основе позиции файла собственного двоичного журнала (binlog) ядра MySQL. Дополнительные сведения о репликации binlog MySQL см. в [этой статье](https://dev.mysql.com/doc/refman/5.7/en/binlog-replication-configuration-overview.html).

Реплики – это новые серверы, которыми вы управляете, похожими на обычные базы данных Azure для серверов MyS'L. За каждую реплику чтения выставляется счет с учетом подготовленных вычислительных ресурсов (количество виртуальных ядер) и хранилища (ГБ/месяц).

Чтобы узнать больше об особенностях и проблемах репликации [MyS'L,](https://dev.mysql.com/doc/refman/5.7/en/replication-features.html)см.

## <a name="when-to-use-a-read-replica"></a>Использование реплик чтения

Компонент "Реплика чтения" помогает повысить производительность и масштабируемость рабочих нагрузок с высокой интенсивностью чтения. Рабочие нагрузки чтения можно изолировать в реплики, направив рабочие нагрузки записи на главный сервер.

К типичным сценариям относится ситуация, когда рабочие нагрузки бизнес-аналитики и анализа используют реплику чтения в качестве источника данных для отчетов.

Так как реплики доступны только для чтения, они не снимают с главного сервера нагрузку, связанную с записью. Этот компонент не предназначен для рабочих нагрузок с интенсивной записью.

Функция прочитана реплика с надписью myS'L использует асинхронную репликацию MyS'L. Этот компонент также не предназначен для сценариев синхронной репликации. Между поступлением данных на главный сервер и на реплики будет существенная задержка. Данные на реплике и на главном узле согласованы в конечном счете. Используйте этот компонент только для таких рабочих нагрузок, которым не страшна такая задержка.

## <a name="cross-region-replication"></a>Кросс-регион репликации
Вы можете создать реплику чтения в другой области с вашего главного сервера. Кросс-регион репликации может быть полезным для таких сценариев, как планирование аварийного восстановления или сближение данных с пользователями.

У вас может быть мастер-сервер в любой [базе данных Azure для региона MyS'L.](https://azure.microsoft.com/global-infrastructure/services/?products=mysql)  Мастер-сервер может иметь реплику в парной области или универсальных регионах реплики. На рисунке ниже показано, какие области реплик доступны в зависимости от основной области.

[![Читать регионы реплик](media/concepts-read-replica/read-replica-regions.png)](media/concepts-read-replica/read-replica-regions.png#lightbox)

### <a name="universal-replica-regions"></a>Универсальные регионы реплики
Вы можете создать реплету чтения в любом из следующих регионов, независимо от того, где находится ваш основной сервер. Поддерживаемые универсальные регионы реплики включают в себя:

Австралия Восток, Австралия юго-восток, Центральная часть США, Восточная Азия, Восточная ЧАСТЬ США, Восток США 2, Япония Восток, Япония Запад, Корея Центральной, Корея, Северная Центральная США, южная центральная часть США, юго-восточная Азия, Великобритания на юге, Запад Великобритании, Западная Европа, Западная США.

«West US 2 временно недоступен в качестве расположения реплики поперечного региона.

### <a name="paired-regions"></a>Пары регионов
В дополнение к универсальным регионам реплики можно создать считываемую реплику в парной области Azure на вашем главном сервере. Если вы не знаете пару вашего региона, вы можете узнать больше из [статьи Azure Paired Regions.](../best-practices-availability-paired-regions.md)

Если вы используете кросс-региональные реплики для планирования аварийного восстановления, мы рекомендуем создать реплику в парном регионе вместо одного из других регионов. Парные регионы избегают одновременных обновлений и приоритизируют физическую изоляцию и местожительство данных.  

Однако существуют ограничения для рассмотрения: 

* Региональная доступность: База данных Azure для MyS'L доступна в West US 2, France Central, ОАЭ North и Germany Central. Однако их парные регионы недоступны.
    
* Однонаправленные пары: Некоторые области Azure спарены только в одном направлении. Эти регионы включают Западную Индию, Бразилию на юге и губернатор сша Вирджинию. 
   Это означает, что мастер-сервер в Западной Индии может создать реплику в южной Индии. Тем не менее, мастер-сервер в южной Индии не может создать реплику в Западной Индии. Это потому, что второстепенный регион Западной Индии является южная Индия, но вторичный регион южной Индии не Западная Индия.


## <a name="create-a-replica"></a>Создание реплики

Если у сервера master Server нет существующих серверов реплик, мастер сначала перезапустится, чтобы подготовиться к репликации.

При запуске рабочего процесса реплики создается пустая база данных Azure для сервера MyS'L. Этот сервер заполняется данными, которые были на главном сервере. Время создания зависит от объема данных на главном сервере и времени, прошедшего с момента последнего еженедельного полного резервного копирования. Время может варьироваться от нескольких минут до нескольких часов.

Каждая реплика включена для [автоматического роста](concepts-pricing-tiers.md#storage-auto-grow)хранилища. Функция автоматического роста позволяет реплике идти в ногу с реплицированными к ней данными и предотвращать прерывание репликации, вызванное ошибками вне хранилища.

Дополнительные сведения о создании реплики чтения на портале Azure см. [здесь](howto-read-replicas-portal.md).

## <a name="connect-to-a-replica"></a>Подключение к реплике

При создании реплики наследуются правила брандмауэра главного сервера. После этого эти правила независимы от главного сервера.

Реплика наследует от главного сервера учетную запись администратора. Также на реплики чтения копируются все учетные записи пользователей с главного сервера. К реплике чтения можно подключиться только с помощью учетных записей пользователей, доступных на главном сервере.

Вы можете подключиться к реплике, используя ее хост-имя и действительную учетную запись пользователя, как это было бы в обычной базе данных Azure для сервера MyS'L. Для сервера под названием **myreplica** с именем пользователя администратора **myadmin**, вы можете подключиться к реплике с помощью mysql CLI:

```bash
mysql -h myreplica.mysql.database.azure.com -u myadmin@myreplica -p
```

При появлении запроса введите пароль для учетной записи пользователя.

## <a name="monitor-replication"></a>Мониторинг репликации

База данных Azure для MyS'L обеспечивает **отставание репликации в** метрике секунд в Azure Monitor. Эта метрика доступна только для реплик.

Эта метрика рассчитывается с использованием метрики, `seconds_behind_master` доступной `SHOW SLAVE STATUS` в команде MyS'L.

Установите оповещение, чтобы сообщить вам, когда отставание репликации достигает значения, которое неприемлемо для рабочей нагрузки.

## <a name="stop-replication"></a>Остановка репликации

Вы можете остановить репликацию между главным сервером и репликой. После остановки репликации между главным сервером и репликой чтения реплика становится отдельным сервером. На отдельном сервере сохраняются все данные, которые существовали на нем на момент запуска команды "Остановить репликацию". Данные на изолированном сервере не синхронизируются с главным сервером.

Когда вы выбираете, чтобы остановить репликацию реплики, он теряет все ссылки на свой предыдущий мастер и другие реплики. Автоматического сбоя между мастером и его репликой нет.

> [!IMPORTANT]
> Это сервер нельзя снова преобразовать в реплику.
> Прежде, чем останавливать репликацию в реплике чтения убедитесь, что реплика содержит все необходимые данные.

Процесс остановки репликации описан в [этой статье](howto-read-replicas-portal.md).

## <a name="considerations-and-limitations"></a>Рекомендации и ограничения

### <a name="pricing-tiers"></a>Ценовые категории

Реплики чтения сейчас доступны только в ценовых категориях "Общее назначение" и "Оптимизировано для памяти".

### <a name="master-server-restart"></a>Перезапуск главного сервера

При создании реплики для мастера, у которого нет существующих реплик, мастер сначала перезапустится, чтобы подготовиться к репликации. Примите это во внимание и выполняйте эти операции в непиковый период.

### <a name="new-replicas"></a>Новые реплики

Реплика чтения создается в качестве новой базы данных Azure для сервера MyS'L. Существующий сервер нельзя снова преобразовать в реплику. Невозможно создать реплику другой реплики чтения.

### <a name="replica-configuration"></a>Конфигурация реплики

Реплика создается с той же конфигурацией сервера, что и у главного сервера. После создания реплики вы можете независимо от главного сервера изменять следующие ее параметры: поколение вычислительных ресурсов, число виртуальных ядер, объем хранилища и период хранения резервных копий. Изменить также можно ценовую категорию (за исключением уровня "Базовый").

> [!IMPORTANT]
> Прежде чем изменить параметры конфигурации на главном сервере, установите на каждой реплике такие же или более высокие значения. Это позволит реплике справляться с нагрузкой, соответствующей новым параметрам главного сервера.

Правила брандмауэра и параметры параметров наследуются от главного сервера к реплике при создании реплики. После этого правила реплики являются независимыми.

### <a name="stopped-replicas"></a>Остановленные реплики

Если вы прекратите репликацию между мастер-сервером и ремиссией чтения, остановленная реплика становится автономным сервером, который принимает и читает, и записывает. Это сервер нельзя снова преобразовать в реплику.

### <a name="deleted-master-and-standalone-servers"></a>Удаленные главного и отдельного серверов

При удалении главного сервера репликация останавливается для всех реплик чтения. Эти реплики автоматически становятся автономными серверами и могут принимать как читает, так и записывает. Удаляется сам главный сервер.

### <a name="user-accounts"></a>Учетные записи пользователей

Пользователи на главном сервере реплицируются в реплики чтения. К реплике чтения можно подключиться только с помощью учетных записей пользователей, доступных на главном сервере.

### <a name="server-parameters"></a>Параметры сервера

Чтобы предотвратить синхронизацию данных и избежать их возможной потери, при использовании реплики чтения некоторые параметры сервера блокируются.

Следующие параметры сервера заблокированы как на серверах мастер, так и на серверах реплики:
- [`innodb_file_per_table`](https://dev.mysql.com/doc/refman/5.7/en/innodb-multiple-tablespaces.html) 
- [`log_bin_trust_function_creators`](https://dev.mysql.com/doc/refman/5.7/en/replication-options-binary-log.html#sysvar_log_bin_trust_function_creators)

Параметр [`event_scheduler`](https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_event_scheduler) заблокирован на серверах реплики. 

### <a name="other"></a>Другой

- Идентификаторы глобальных транзакций (GTID) не поддерживаются.
- Создание реплики реплики не поддерживается.
- Таблицы памяти могут привести к тому, что реплики не синхронизируются. Это ограничение технологии репликации MyS'L. Дополнительные сведения см. в [справочной документации по MySQL](https://dev.mysql.com/doc/refman/5.7/en/replication-features-memory.html).
- Убедитесь, что у таблиц главного сервера есть первичные ключи. Отсутствие первичных ключей может привести к задержке репликации между главным сервером и репликами.
- Полный список ограничений репликации MySQL см. в [документации по MySQL](https://dev.mysql.com/doc/refman/5.7/en/replication-features.html).

## <a name="next-steps"></a>Следующие шаги

- Узнайте, как [создавать реплики чтения и управлять ими с помощью портала Azure](howto-read-replicas-portal.md).
- Узнайте, как [создавать и управлять речированными репликами чтения с помощью Azure CLI и REST API](howto-read-replicas-cli.md)
