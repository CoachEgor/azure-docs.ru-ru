---
title: Чтение реплик в базе данных Azure для MySQL.
description: 'Сведения о репликах чтения в базе данных Azure для MySQL: выбор регионов, создание реплик, подключение к репликам, мониторинг репликации и остановка репликации.'
author: ajlam
ms.author: andrela
ms.service: mysql
ms.topic: conceptual
ms.date: 04/21/2020
ms.openlocfilehash: 47f686f810f62fe03a9b0217677c436f3b91782b
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "81767889"
---
# <a name="read-replicas-in-azure-database-for-mysql"></a>Реплики чтения в базе данных Azure для MySQL

Компонент "Реплика чтения" позволяет реплицировать данные с сервера службы "База данных Azure для MySQL" на сервер только для чтения. Вы можете реплицировать данные с главного сервера на несколько реплик (до пяти). Реплики чтения асинхронно обновляются с помощью технологии репликации на основе позиции файла собственного двоичного журнала (binlog) ядра MySQL. Дополнительные сведения о репликации binlog MySQL см. в [этой статье](https://dev.mysql.com/doc/refman/5.7/en/binlog-replication-configuration-overview.html).

Реплики — это новые серверы, управление которыми осуществляется аналогично обычным серверам базы данных Azure для MySQL. За каждую реплику чтения выставляется счет с учетом подготовленных вычислительных ресурсов (количество виртуальных ядер) и хранилища (ГБ/месяц).

Дополнительные сведения о возможностях и проблемах репликации MySQL см. в [документации по репликации MySQL](https://dev.mysql.com/doc/refman/5.7/en/replication-features.html).

## <a name="when-to-use-a-read-replica"></a>Использование реплик чтения

Компонент "Реплика чтения" помогает повысить производительность и масштабируемость рабочих нагрузок с высокой интенсивностью чтения. Рабочие нагрузки чтения можно изолировать в реплики, направив рабочие нагрузки записи на главный сервер.

К типичным сценариям относится ситуация, когда рабочие нагрузки бизнес-аналитики и анализа используют реплику чтения в качестве источника данных для отчетов.

Так как реплики доступны только для чтения, они не снимают с главного сервера нагрузку, связанную с записью. Этот компонент не предназначен для рабочих нагрузок с интенсивной записью.

Функция чтения реплики использует асинхронную репликацию MySQL. Этот компонент также не предназначен для сценариев синхронной репликации. Между поступлением данных на главный сервер и на реплики будет существенная задержка. Данные на реплике и на главном узле согласованы в конечном счете. Используйте этот компонент только для таких рабочих нагрузок, которым не страшна такая задержка.

## <a name="cross-region-replication"></a>Репликация между регионами
Вы можете создать реплику чтения в другом регионе на главном сервере. Репликация между регионами может быть полезной для таких сценариев, как планирование аварийного восстановления или передача данных ближе к пользователям.

Главный сервер может находиться в любом [регионе базы данных Azure для MySQL](https://azure.microsoft.com/global-infrastructure/services/?products=mysql).  Главный сервер может иметь реплику в связанном регионе или в регионах универсальной реплики. На рисунке ниже показано, какие регионы реплик доступны в зависимости от главного региона.

[![Чтение регионов реплики](media/concepts-read-replica/read-replica-regions.png)](media/concepts-read-replica/read-replica-regions.png#lightbox)

### <a name="universal-replica-regions"></a>Регионы универсальной реплики
Реплику чтения можно создать в любом из следующих регионов, независимо от того, где находится главный сервер. В число поддерживаемых регионов универсальной реплики входят:

Восточная Австралия, Юго-Восточная Австралия, Центральная часть США, Восточная Азия, Восточная часть США, Восточная часть США 2, Восточная Япония, Западная Япония, Центральная Корея, Южная Корея, Юго-Центральная часть США, Северная Европа, Юго-Центральная часть США, Юго-Восточная Азия, южная часть Соединенного Королевства, западная часть Соединенного Королевства, Западная Европа, Западная часть США.

* Западная часть США 2 временно недоступна в качестве расположения реплики в разных регионах.

### <a name="paired-regions"></a>Пары регионов
В дополнение к регионам универсальной реплики вы можете создать реплику чтения в парном регионе Azure главного сервера. Если вы не знакомы с парой регионов, дополнительные сведения см. в статье о [парных регионах Azure](../best-practices-availability-paired-regions.md).

Если для планирования аварийного восстановления используются межрегиональные реплики, рекомендуется создать реплику в парном регионе, а не в одном из других регионов. Парные регионы не допускают одновременного обновления и определения приоритетов физической изоляции и местонахождение данных.  

Однако существуют ограничения, которые следует учитывать: 

* Доступность по регионам. база данных Azure для MySQL доступна в западной части США 2, центральном Франции, Северной и Германии. Однако их парные регионы недоступны.
    
* Однонаправленные пары: некоторые регионы Azure связаны только в одном направлении. К этим регионам относятся "Западная Индия", "Южная Бразилия" и "US Gov (Вирджиния)". 
   Это означает, что главный сервер в Западной Индии может создать реплику в Южной Индии. Однако главный сервер в Южной Индии не может создать реплику в Западной Индии. Это связано с тем, что дополнительный регион "Западная Индия" — Южно-Индия, а дополнительный регион Южной Индии — не "Западная Индия".


## <a name="create-a-replica"></a>Создание реплики

Если у главного сервера нет серверов реплики, главный сервер сначала перезапустится, чтобы подготовиться к репликации.

При запуске рабочего процесса создания реплики будет создан пустой сервер базы данных Azure для MySQL. Этот сервер заполняется данными, которые были на главном сервере. Время создания зависит от объема данных на главном сервере и времени, прошедшего с момента последнего еженедельного полного резервного копирования. Время может варьироваться от нескольких минут до нескольких часов.

Для каждой реплики включено [Автоматическое увеличение](concepts-pricing-tiers.md#storage-auto-grow)хранилища. Функция автоматического увеличения позволяет реплике синхронизировать данные с реплицируемыми данными и предотвращать прерывание репликации, вызванные ошибками нехватки памяти.

Дополнительные сведения о создании реплики чтения на портале Azure см. [здесь](howto-read-replicas-portal.md).

## <a name="connect-to-a-replica"></a>Подключение к реплике

При создании реплика наследует правила брандмауэра главного сервера. Затем эти правила не зависят от главного сервера.

Реплика наследует от главного сервера учетную запись администратора. Также на реплики чтения копируются все учетные записи пользователей с главного сервера. К реплике чтения можно подключиться только с помощью учетных записей пользователей, доступных на главном сервере.

Вы можете подключиться к реплике, используя ее имя узла и допустимую учетную запись пользователя, как и на обычной базе данных Azure для сервера MySQL. Для сервера с именем **MyReplica»** и именем администратора **MyAdmin**можно подключиться к реплике с помощью MySQL CLI:

```bash
mysql -h myreplica.mysql.database.azure.com -u myadmin@myreplica -p
```

При появлении запроса введите пароль для учетной записи пользователя.

## <a name="monitor-replication"></a>Мониторинг репликации

Служба "база данных Azure для MySQL" предоставляет время **задержки репликации в секундах** в Azure Monitor. Эта метрика доступна только для реплик.

Эта метрика вычисляется с `seconds_behind_master` помощью метрики, доступной `SHOW SLAVE STATUS` в команде MySQL.

Настройте оповещение, чтобы сообщить вам, когда задержка репликации достигнет значения, неприемлемого для вашей рабочей нагрузки.

## <a name="stop-replication"></a>Остановка репликации

Вы можете остановить репликацию между главным сервером и репликой. После остановки репликации между главным сервером и репликой чтения реплика становится отдельным сервером. На отдельном сервере сохраняются все данные, которые существовали на нем на момент запуска команды "Остановить репликацию". Данные на изолированном сервере не синхронизируются с главным сервером.

Если вы решили отключить репликацию в реплике, она теряет все ссылки на предыдущие главные и другие реплики. Автоматическая отработка отказа между главным и ее репликами отсутствует.

> [!IMPORTANT]
> Это сервер нельзя снова преобразовать в реплику.
> Прежде, чем останавливать репликацию в реплике чтения убедитесь, что реплика содержит все необходимые данные.

Процесс остановки репликации описан в [этой статье](howto-read-replicas-portal.md).

## <a name="considerations-and-limitations"></a>Рекомендации и ограничения

### <a name="pricing-tiers"></a>Ценовые категории

Реплики чтения сейчас доступны только в ценовых категориях "Общее назначение" и "Оптимизировано для памяти".

### <a name="master-server-restart"></a>Перезапуск главного сервера

При создании реплики для главного сервера, не имеющего существующих реплик, сначала выполняется перезапуск, чтобы подготовиться к репликации. Примите это в виду и выполните эти операции в течение непикового периода.

### <a name="new-replicas"></a>Новые реплики

Реплика чтения создается как новый сервер базы данных Azure для MySQL. Существующий сервер нельзя снова преобразовать в реплику. Невозможно создать реплику другой реплики чтения.

### <a name="replica-configuration"></a>Конфигурация реплики

Реплика создается с той же конфигурацией сервера, что и у главного сервера. После создания реплики вы можете независимо от главного сервера изменять следующие ее параметры: поколение вычислительных ресурсов, число виртуальных ядер, объем хранилища и период хранения резервных копий. Изменить также можно ценовую категорию (за исключением уровня "Базовый").

> [!IMPORTANT]
> Прежде чем изменить параметры конфигурации на главном сервере, установите на каждой реплике такие же или более высокие значения. Это позволит реплике справляться с нагрузкой, соответствующей новым параметрам главного сервера.

Правила брандмауэра и параметры параметров наследуются от главного сервера реплике при создании реплики. После этого правила реплики будут независимыми.

### <a name="stopped-replicas"></a>Остановленные реплики

Если остановить репликацию между главным сервером и репликой чтения, то остановленная реплика станет автономным сервером, принимающим операции чтения и записи. Это сервер нельзя снова преобразовать в реплику.

### <a name="deleted-master-and-standalone-servers"></a>Удаленные главного и отдельного серверов

При удалении главного сервера репликация останавливается для всех реплик чтения. Эти реплики автоматически становятся автономными серверами и могут принимать операции чтения и записи. Удаляется сам главный сервер.

### <a name="user-accounts"></a>Учетные записи пользователей

Пользователи на главном сервере реплицируются в реплики чтения. К реплике чтения можно подключиться только с помощью учетных записей пользователей, доступных на главном сервере.

### <a name="server-parameters"></a>Параметры сервера

Чтобы предотвратить синхронизацию данных и избежать их возможной потери, при использовании реплики чтения некоторые параметры сервера блокируются.

На серверах главной и реплики заблокированы следующие параметры сервера:
- [`innodb_file_per_table`](https://dev.mysql.com/doc/refman/5.7/en/innodb-multiple-tablespaces.html) 
- [`log_bin_trust_function_creators`](https://dev.mysql.com/doc/refman/5.7/en/replication-options-binary-log.html#sysvar_log_bin_trust_function_creators)

[`event_scheduler`](https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_event_scheduler) Параметр заблокирован на серверах реплик. 

### <a name="other"></a>Другой

- Идентификаторы глобальных транзакций (GTID) не поддерживаются.
- Создание реплики реплики не поддерживается.
- Таблицы в памяти могут привести к тому, что реплики не будут синхронизированы. Это ограничение технологии репликации MySQL. Дополнительные сведения см. в [справочной документации по MySQL](https://dev.mysql.com/doc/refman/5.7/en/replication-features-memory.html).
- Убедитесь, что у таблиц главного сервера есть первичные ключи. Отсутствие первичных ключей может привести к задержке репликации между главным сервером и репликами.
- Полный список ограничений репликации MySQL см. в [документации по MySQL](https://dev.mysql.com/doc/refman/5.7/en/replication-features.html).

## <a name="next-steps"></a>Дальнейшие шаги

- Узнайте, как [создавать реплики чтения и управлять ими с помощью портала Azure](howto-read-replicas-portal.md).
- Узнайте, как [создавать реплики чтения и управлять ими с помощью Azure CLI и REST API](howto-read-replicas-cli.md)
