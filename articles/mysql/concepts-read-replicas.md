---
title: Реплики чтения в базе данных Azure для MySQL.
description: В этой статье описывается настройка реплик чтения для базы данных Azure для MySQL.
author: ajlam
ms.author: andrela
ms.service: mysql
ms.topic: conceptual
ms.date: 04/30/2019
ms.openlocfilehash: be592cb6bb7c041fab0a2f96a338f4f4bb0ff00a
ms.sourcegitcommit: 8fc5f676285020379304e3869f01de0653e39466
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/09/2019
ms.locfileid: "65510921"
---
# <a name="read-replicas-in-azure-database-for-mysql"></a>Реплики чтения в базе данных Azure для MySQL

Средство чтения реплик позволяет реплицировать данные из базы данных Azure для сервера MySQL на сервер только для чтения. Можно реплицировать с главного сервера до пяти реплик. Реплики обновляются асинхронно с помощью механизма MySQL собственный журнал событий двоичных файлов (binlog) файл на основании его позиции технологии репликации. Дополнительные сведения о репликации binlog MySQL см. в [этой статье](https://dev.mysql.com/doc/refman/5.7/en/binlog-replication-configuration-overview.html).

> [!IMPORTANT]
> Можно создать чтения реплики, в том же регионе, что главный сервер, или в любом другом регионе Azure по своему усмотрению. Репликация между регионами в настоящее время находится в общедоступной предварительной версии.

Реплики находятся новые серверы, которые управляются аналогичную регулярных база данных Azure для серверов MySQL. За каждую реплику чтения выставляется счет с учетом подготовленных вычислительных ресурсов (количество виртуальных ядер) и хранилища (ГБ/месяц).

Дополнительные сведения о функциях и проблемах репликации MySQL см. в [документации по репликации MySQL](https://dev.mysql.com/doc/refman/5.7/en/replication-features.html).

## <a name="when-to-use-a-read-replica"></a>Использование реплик чтения

Компонент "Реплика чтения" помогает повысить производительность и масштабируемость рабочих нагрузок с высокой интенсивностью чтения. Рабочие нагрузки чтения можно изолировать в реплики, направив рабочие нагрузки записи на главный сервер.

К типичным сценариям относится ситуация, когда рабочие нагрузки бизнес-аналитики и анализа используют реплику чтения в качестве источника данных для отчетов.

Так как реплики доступны только для чтения, они не снимают с главного сервера нагрузку, связанную с записью. Этот компонент не предназначен для рабочих нагрузок с интенсивной записью.

Компонент чтения реплика использует асинхронную репликацию MySQL. Этот компонент также не предназначен для сценариев синхронной репликации. Между поступлением данных на главный сервер и на реплики будет существенная задержка. Данные на реплике и на главном узле согласованы в конечном счете. Используйте этот компонент только для таких рабочих нагрузок, которым не страшна такая задержка.

Чтение реплик может повысить свой план аварийного восстановления. Если имеется региональной аварии и главный сервер недоступен, можно направить рабочей нагрузки на реплику в другом регионе. Чтобы сделать это, сначала позвольте реплика принимать операции записи с помощью функции репликации stop. Затем вы можете перенаправлять приложения, обновив строку подключения. Дополнительные сведения см. в [остановить репликацию](#stop-replication) раздел.

## <a name="create-a-replica"></a>Создание реплики

Если главный сервер не существующие серверы-реплики, образце сначала будет перезапущен, чтобы подготовить сам репликации.

При запуске рабочего процесса создания реплики, создается пустой базы данных Azure для сервера MySQL. Этот сервер заполняется данными, которые были на главном сервере. Время создания зависит от объема данных на главном сервере и времени, прошедшего с момента последнего еженедельного полного резервного копирования. Время может варьироваться от нескольких минут до нескольких часов.

> [!NOTE]
> Если вы еще не настроили оповещения хранилища на серверах, рекомендуем сделать это сейчас. Это позволит получать сведения о приближении к заполнению хранилища на сервере, которое влияет на эффективность репликации.

Дополнительные сведения о создании реплики чтения на портале Azure см. [здесь](howto-read-replicas-portal.md).

## <a name="connect-to-a-replica"></a>Подключение к реплике

Создаваемая реплика не наследует от главного сервера правила брандмауэра или конечную точку службы виртуальной сети. Эти правила следует настроить для каждой реплики отдельно.

Реплика наследует от главного сервера учетную запись администратора. Также на реплики чтения копируются все учетные записи пользователей с главного сервера. К реплике чтения можно подключиться только с помощью учетных записей пользователей, доступных на главном сервере.

Подключаются к реплике, используя его имя узла и является допустимой учетной записью, как в обычной базой данных Azure для сервера MySQL. Для сервера с именем **myreplica** с именем пользователя администратора **myadmin**, можно подключиться к реплике с помощью интерфейса командной строки mysql:

```bash
mysql -h myreplica.mysql.database.azure.com -u myadmin@myreplica -p
```

При появлении запроса введите пароль для учетной записи пользователя.

## <a name="monitor-replication"></a>Мониторинг репликации

База данных Azure для MySQL предоставляет **задержка репликации в секундах** метрик в Azure Monitor. Эта метрика доступна только для реплик.

Эта метрика вычисляется с помощью `seconds_behind_master` метрики, доступные в MySQL `SHOW SLAVE STATUS` команды.

Настройка оповещений о том, когда задержка репликации достигает значения, не подходят для вашей рабочей нагрузки.

## <a name="stop-replication"></a>Остановить репликацию

Вы можете остановить репликацию между главным сервером и репликой. После остановки репликации между главным сервером и репликой чтения реплика становится отдельным сервером. На отдельном сервере сохраняются все данные, которые существовали на нем на момент запуска команды "Остановить репликацию". Данные на изолированном сервере не синхронизируются с главным сервером.

Когда вы решили остановить репликацию для реплики, он теряет все ссылки его предыдущий шаблон и других реплик. Нет без автоматической отработки отказа между главным и его репликой.

> [!IMPORTANT]
> Это сервер нельзя снова преобразовать в реплику.
> Прежде, чем останавливать репликацию в реплике чтения убедитесь, что реплика содержит все необходимые данные.

Процесс остановки репликации описан в [этой статье](howto-read-replicas-portal.md).

## <a name="considerations-and-limitations"></a>Ограничения и рекомендации

### <a name="pricing-tiers"></a>Ценовые категории

Реплики чтения сейчас доступны только в ценовых категориях "Общее назначение" и "Оптимизировано для памяти".

### <a name="master-server-restart"></a>Перезапуск главного сервера

При создании реплики для базы данных master, отсутствуют существующие реплики, образце сначала будет перезапущен, чтобы подготовить сам репликации. Следует это учитывать и выполнять такие операции в период низкой нагрузки.

### <a name="new-replicas"></a>Новые реплики

Реплика чтения создается как новую базу данных Azure для сервера MySQL. Существующий сервер нельзя снова преобразовать в реплику. Невозможно создать реплику другой реплики чтения.

### <a name="replica-configuration"></a>Конфигурация реплики

Реплика создается с той же конфигурацией сервера, что и у главного сервера. После создания реплики, некоторые параметры можно изменить независимо друг от друга с главного сервера: вычислений, поколение, виртуальных ядер, хранилища, срок хранения резервных копий и MySQL версии подсистемы. Изменить также можно ценовую категорию (за исключением уровня "Базовый").

> [!IMPORTANT]
> Прежде чем изменить параметры конфигурации на главном сервере, установите на каждой реплике такие же или более высокие значения. Это позволит реплике справляться с нагрузкой, соответствующей новым параметрам главного сервера.

### <a name="stopped-replicas"></a>Остановленные реплики

При остановке репликации между главным и чтения реплик остановлена реплика становится изолированного сервера, который принимает операций чтения и записи. Это сервер нельзя снова преобразовать в реплику.

### <a name="deleted-master-and-standalone-servers"></a>Удаленные главного и отдельного серверов

При удалении главного сервера репликация останавливается для всех реплик чтения. Эти реплики становятся изолированными серверами. Удаляется сам главный сервер.

### <a name="user-accounts"></a>Учетные записи пользователей

Пользователи на главном сервере реплицируются в реплики чтения. К реплике чтения можно подключиться только с помощью учетных записей пользователей, доступных на главном сервере.

### <a name="server-parameters"></a>Параметры сервера

Для предотвращения данных синхронизированы и избежать потенциальной потери или повреждения данных, не будет обновляться при с помощью чтения реплик блокируются некоторых параметров сервера.

Следующие параметры server заблокированы на серверах и главный и реплика:
- [`innodb_file_per_table`](https://dev.mysql.com/doc/refman/5.7/en/innodb-multiple-tablespaces.html) 
- [`log_bin_trust_function_creators`](https://dev.mysql.com/doc/refman/5.7/en/replication-options-binary-log.html#sysvar_log_bin_trust_function_creators)

[ `event_scheduler` ](https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_event_scheduler) Параметр заблокирован на серверах-репликах. 

### <a name="other"></a>Другие

- Идентификаторы глобальных транзакций (GTID) не поддерживаются.
- Создание реплики реплики не поддерживается.
- Таблицы в памяти могут вызывать рассинхронизацию реплик. Это ограничение технологии репликации MySQL. Дополнительные сведения см. в [справочной документации по MySQL](https://dev.mysql.com/doc/refman/5.7/en/replication-features-memory.html).
- Убедитесь, что у таблиц главного сервера есть первичные ключи. Отсутствие первичных ключей может привести к задержке репликации между главным сервером и репликами.
- Полный список ограничений репликации MySQL см. в [документации по MySQL](https://dev.mysql.com/doc/refman/5.7/en/replication-features.html).

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте, как [создавать реплики чтения и управлять ими с помощью портала Azure](howto-read-replicas-portal.md).
- Узнайте, как [создавать реплики чтения и управлять ими с помощью Azure CLI](howto-read-replicas-cli.md).
