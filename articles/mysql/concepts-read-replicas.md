---
title: Реплики чтения (База данных Azure для MySQL)
description: 'Сведения о репликах чтения в Базе данных Azure для MySQL: выбор регионов, создание реплик, подключение к репликам, мониторинг репликации и остановка репликации.'
author: ajlam
ms.author: andrela
ms.service: mysql
ms.topic: conceptual
ms.date: 7/7/2020
ms.openlocfilehash: a30f2b2fcefcc944db35271bd75b6467f7590a2c
ms.sourcegitcommit: 53acd9895a4a395efa6d7cd41d7f78e392b9cfbe
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/22/2020
ms.locfileid: "90902894"
---
# <a name="read-replicas-in-azure-database-for-mysql"></a>Реплики чтения в базе данных Azure для MySQL

Компонент "Реплика чтения" позволяет реплицировать данные с сервера службы "База данных Azure для MySQL" на сервер только для чтения. Вы можете реплицировать данные с главного сервера на несколько реплик (до пяти). Реплики чтения асинхронно обновляются с помощью технологии репликации на основе позиции файла собственного двоичного журнала (binlog) ядра MySQL. Дополнительные сведения о репликации binlog MySQL см. в [этой статье](https://dev.mysql.com/doc/refman/5.7/en/binlog-replication-configuration-overview.html).

Реплики — это новые серверы, которыми вы управляете как обычными серверами службы "База данных Azure для MySQL". За каждую реплику чтения выставляется счет с учетом подготовленных вычислительных ресурсов (количество виртуальных ядер) и хранилища (ГБ/месяц).

Дополнительные сведения о функциях и проблемах репликации MySQL см. в [документации по репликации MySQL](https://dev.mysql.com/doc/refman/5.7/en/replication-features.html).

> [!NOTE]
> Обмен данными без смещения
>
> Корпорация Майкрософт поддерживает различные и включенные среды. Эта статья содержит ссылки на слово _Slave_. В соответствии с [руководством по стилю Майкрософт для обмена данными без](https://github.com/MicrosoftDocs/microsoft-style-guide/blob/master/styleguide/bias-free-communication.md) пересчета этот термин распознается как исключение. Это слово используется в этой статье для обеспечения согласованности, так как в настоящее время это слово, которое отображается в программном обеспечении. При обновлении программного обеспечения для удаления слова эта статья будет обновлена для выравнивания.
>

## <a name="when-to-use-a-read-replica"></a>Использование реплик чтения

Компонент "Реплика чтения" помогает повысить производительность и масштабируемость рабочих нагрузок с высокой интенсивностью чтения. Рабочие нагрузки чтения можно изолировать в реплики, направив рабочие нагрузки записи на главный сервер.

К типичным сценариям относится ситуация, когда рабочие нагрузки бизнес-аналитики и анализа используют реплику чтения в качестве источника данных для отчетов.

Так как реплики доступны только для чтения, они не снимают с главного сервера нагрузку, связанную с записью. Этот компонент не предназначен для рабочих нагрузок с интенсивной записью.

В реплике чтения используется асинхронная репликация MySQL. Этот компонент также не предназначен для сценариев синхронной репликации. Между поступлением данных на главный сервер и на реплики будет существенная задержка. Данные на реплике и на главном узле согласованы в конечном счете. Используйте этот компонент только для таких рабочих нагрузок, которым не страшна такая задержка.

## <a name="cross-region-replication"></a>Репликация между регионами
Регион размещения реплики чтения может отличаться от региона для главного сервера. Репликация между регионами полезна для таких сценариев, как планирование аварийного восстановления или перенос данных ближе к пользователям.

Главный сервер может размещаться в любом регионе [Базы данных Azure для MySQL](https://azure.microsoft.com/global-infrastructure/services/?products=mysql).  Главный сервер может иметь реплику в парном регионе или в универсальных регионах реплики. На изображении ниже представлена доступность регионов реплики в зависимости от региона главного сервера.

[:::image type="content" source="media/concepts-read-replica/read-replica-regions.png" alt-text="Чтение регионов реплики":::](media/concepts-read-replica/read-replica-regions.png#lightbox)

### <a name="universal-replica-regions"></a>Универсальные регионы реплики
Реплику чтения можно создать в любом из следующих регионов при любом расположении главного сервера. Поддерживаются следующие универсальные регионы реплики:

Восточная Австралия, Юго-Восточная Австралия, Центральная часть США, Восточная Азия, Восточная часть США, Восточная часть США 2, Восточная Япония, Западная Япония, Центральная Корея, Юго-Запад, северо-центральная часть США, Северная Европа, Юго-Центральная часть США, Юго-Восточная Азия, южная часть Соединенного Королевства, западная часть Соединенного Королевства, Западная Европа, Западная часть США, Западная часть США 2, Западная Центральная часть США.

### <a name="paired-regions"></a>Пары регионов
В дополнение к универсальным регионам реплики поддерживается создание реплики чтения в парном регионе Azure для региона главного сервера. Если вы не знаете, какой регион является парным, изучите [эту статью](../best-practices-availability-paired-regions.md).

Если вы настраиваете репликацию между регионами в рамках планирования аварийного восстановления, мы рекомендуем создавать реплику именно в парном регионе, а не в одном из других. Для парных регионов не допускаются одновременные обновления, отслеживаются приоритеты по физической изоляции и месту расположения данных.  

Но есть и некоторые ограничения: 

* Доступность по регионам. база данных Azure для MySQL доступна в центральном центре Франции, Северной и Германии. Но недоступны регионы, которые являются для них парными.
    
* Однонаправленные пары. Некоторые регионы Azure считаются парными только в одном направлении. К ним относятся: "Западная Индия", "Южная Бразилия" и US Gov (Вирджиния). 
   Это означает, что для размещенного в Западной Индии главного сервера можно создать реплику в Южной Индии, но для размещенного в Южной Индии главного сервера нельзя создать реплику в Западной Индии. Это связано с тем, что для региона "Западная Индия" дополнительным регионом является "Южная Индия", но для региона "Южная Индия" дополнительный регион отличается от региона "Западная Индия".

## <a name="create-a-replica"></a>Создание реплики

> [!IMPORTANT]
> Функция создания реплики чтения доступна только для серверов базы данных Azure для MySQL в ценовой категории "Общее назначение" или "Оптимизированная для операций в памяти". Убедитесь, что главный сервер находится в одной из этих ценовых категорий.

Если для главного сервера не существует серверов реплики, главный сервер выполнит перезапуск для подготовки к репликации.

При запуске рабочего процесса создания реплики создается пустой сервер службы "База данных Azure для MySQL". Этот сервер заполняется данными, которые были на главном сервере. Время создания зависит от объема данных на главном сервере и времени, прошедшего с момента последнего еженедельного полного резервного копирования. Время может варьироваться от нескольких минут до нескольких часов. Сервер реплики всегда создается в той же группе ресурсов и в той же подписке, что и главный сервер. Если вы хотите создать сервер реплики в другой группе ресурсов или другой подписке, можно [переместить сервер реплики](https://docs.microsoft.com/azure/azure-resource-manager/management/move-resource-group-and-subscription) после его создания.

Для каждой реплики включается [автоматическое увеличение](concepts-pricing-tiers.md#storage-auto-grow) хранилища. Возможность автоматического увеличения позволяет реплике без сбоев обрабатывать реплицируемые данные и не прерывать репликацию даже в тех случаях, когда не хватает объема хранилища.

Дополнительные сведения о создании реплики чтения на портале Azure см. [здесь](howto-read-replicas-portal.md).

## <a name="connect-to-a-replica"></a>Подключение к реплике

При создании реплика наследует правила брандмауэра от главного сервера. Но с этого момента правила считаются независимыми от главного сервера.

Реплика наследует от главного сервера учетную запись администратора. Также на реплики чтения копируются все учетные записи пользователей с главного сервера. К реплике чтения можно подключиться только с помощью учетных записей пользователей, доступных на главном сервере.

Вы можете подключиться к реплике, используя имя узла и действительную учетную запись, как к обычному серверу службы "База данных Azure для MySQL". Например, для сервера с именем **myreplica** и именем пользователя с правами администратора **myadmin** подключение будет выполняться с помощью CLI mysql:

```bash
mysql -h myreplica.mysql.database.azure.com -u myadmin@myreplica -p
```

При появлении запроса введите пароль для учетной записи пользователя.

## <a name="monitor-replication"></a>Мониторинг репликации

Служба "База данных Azure для MySQL" также предоставляет для Azure Monitor метрику **Replication lag in seconds** (Задержка репликации в секундах). Эта метрика доступна только для реплик.

Эта метрика вычисляется на основе метрики `seconds_behind_master`, которую можно получить с помощью команды MySQL `SHOW SLAVE STATUS`.

Настройте отправку предупреждений о достижении недопустимого для вашей рабочей нагрузки значения задержки репликации.

## <a name="stop-replication"></a>Остановка репликации

Вы можете остановить репликацию между главным сервером и репликой. После остановки репликации между главным сервером и репликой чтения реплика становится отдельным сервером. На отдельном сервере сохраняются все данные, которые существовали на нем на момент запуска команды "Остановить репликацию". Данные на изолированном сервере не синхронизируются с главным сервером.

Когда вы прекратите репликацию в определенную реплику, она потеряет все ссылки на главный сервер и другие реплики, настроенные ранее. Автоматическая отработка отказа между главным сервером и репликами не выполняется.

> [!IMPORTANT]
> Это сервер нельзя снова преобразовать в реплику.
> Прежде, чем останавливать репликацию в реплике чтения убедитесь, что реплика содержит все необходимые данные.

Процесс остановки репликации описан в [этой статье](howto-read-replicas-portal.md).

## <a name="failover"></a>Отработка отказа

Автоматическая отработка отказа между главным сервером и серверами реплики отсутствует. 

Поскольку репликация является асинхронной, между главной и репликой возникает задержка. На количество запаздывания может влиять ряд факторов, таких как интенсивность рабочей нагрузки главного сервера и задержка между центрами обработки данных. В большинстве случаев задержка реплики составляет от нескольких секунд до пары минут. Вы можете отвести фактическую задержку репликации с помощью *задержки реплики*метрики, доступной для каждой реплики. Эта метрика показывает время, прошедшее с момента последнего воспроизведения транзакции. Рекомендуется определить среднюю задержку, просматривая запаздывание реплики в течение определенного периода времени. Вы можете настроить оповещение о задержке реплики, чтобы, если она выходит за пределы ожидаемого диапазона, можно предпринять действия.

> [!Tip]
> Если выполняется отработка отказа в реплике, задержка во время десвязи реплики с главным будет указывать на количество потерянных данных.

После того как вы решили выполнить отработку отказа в реплику, 

1. Останавливает репликацию в реплику<br/>
   Этот шаг необходим для того, чтобы сервер реплики мог принимать операции записи. В рамках этого процесса сервер реплики будет десвязываться с главным сервером. После инициации процесса репликации серверный процесс обычно занимает около 2 минут. Сведения о влиянии этого действия см. в разделе " [Завершение репликации](#stop-replication) " этой статьи.
    
2. Наведите приложение на реплику (бывшая)<br/>
   Каждый сервер имеет уникальную строку подключения. Обновите приложение так, чтобы оно указывало на (бывшая) реплику, а не на главную.
    
После успешной обработки операций чтения и записи приложение отработки отказа завершено. Время простоя, которое будет зависеть от работы приложения, зависит от того, обнаруживается ошибка и выполняются шаги 1 и 2, описанные выше.

## <a name="considerations-and-limitations"></a>Рекомендации и ограничения

### <a name="pricing-tiers"></a>Ценовые категории

Реплики чтения сейчас доступны только в ценовых категориях "Общее назначение" и "Оптимизировано для памяти".

> [!NOTE]
> Стоимость работы сервера реплики зависит от региона, в котором работает сервер реплики.

### <a name="master-server-restart"></a>Перезапуск главного сервера

При создании реплики для главного сервера, у которого отсутствуют реплики, этот сервер сначала перезапускается для подготовки к репликации. Это необходимо учесть, то есть выполнять такие операции в период низкой нагрузки.

### <a name="new-replicas"></a>Новые реплики

Реплики чтения создаются как новые серверы службы "База данных Azure для MySQL". Существующий сервер нельзя снова преобразовать в реплику. Невозможно создать реплику другой реплики чтения.

### <a name="replica-configuration"></a>Конфигурация реплики

Реплика создается с той же конфигурацией сервера, что и у главного сервера. После создания реплики вы можете независимо от главного сервера изменять следующие ее параметры: поколение вычислительных ресурсов, число виртуальных ядер, объем хранилища и период хранения резервных копий. Изменить также можно ценовую категорию (за исключением уровня "Базовый").

> [!IMPORTANT]
> Прежде чем изменить параметры конфигурации на главном сервере, установите на каждой реплике такие же или более высокие значения. Это позволит реплике справляться с нагрузкой, соответствующей новым параметрам главного сервера.

Правила брандмауэра и параметры конфигурации реплика наследует от главного сервера при создании реплики. После этого правила реплики будут независимыми.

### <a name="stopped-replicas"></a>Остановленные реплики

Если вы прекратите репликацию между главным сервером и репликой чтения, такая реплика становится автономным сервером и начинает выполнять операции чтения и записи. Это сервер нельзя снова преобразовать в реплику.

### <a name="deleted-master-and-standalone-servers"></a>Удаленные главного и отдельного серверов

При удалении главного сервера репликация останавливается для всех реплик чтения. Реплики чтения автоматически становятся автономными серверами и могут выполнять операции чтения и записи. Удаляется сам главный сервер.

### <a name="user-accounts"></a>Учетные записи пользователей

Пользователи на главном сервере реплицируются в реплики чтения. К реплике чтения можно подключиться только с помощью учетных записей пользователей, доступных на главном сервере.

### <a name="server-parameters"></a>Параметры сервера

Чтобы предотвратить синхронизацию данных и избежать их возможной потери, при использовании реплики чтения некоторые параметры сервера блокируются.

На главном сервере и сервере реплики блокируются следующие параметры сервера.
- [`innodb_file_per_table`](https://dev.mysql.com/doc/refman/5.7/en/innodb-multiple-tablespaces.html) 
- [`log_bin_trust_function_creators`](https://dev.mysql.com/doc/refman/5.7/en/replication-options-binary-log.html#sysvar_log_bin_trust_function_creators)

Параметр [`event_scheduler`](https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_event_scheduler) заблокирован на серверах реплик. 

Чтобы обновить один из указанных выше параметров на главном сервере, удалите серверы-реплики, обновите значение параметра на главном сервере и повторно создайте реплики.

### <a name="other"></a>Другие

- Идентификаторы глобальных транзакций (GTID) не поддерживаются.
- Создание реплики реплики не поддерживается.
- Таблицы в памяти могут вызывать рассинхронизацию реплик. Это ограничение технологии репликации MySQL. Дополнительные сведения см. в [справочной документации по MySQL](https://dev.mysql.com/doc/refman/5.7/en/replication-features-memory.html).
- Убедитесь, что у таблиц главного сервера есть первичные ключи. Отсутствие первичных ключей может привести к задержке репликации между главным сервером и репликами.
- Полный список ограничений репликации MySQL см. в [документации по MySQL](https://dev.mysql.com/doc/refman/5.7/en/replication-features.html).

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте, как [создавать реплики чтения и управлять ими с помощью портала Azure](howto-read-replicas-portal.md).
- Узнайте, как [создавать реплики чтения и управлять ими с помощью Azure CLI и REST API](howto-read-replicas-cli.md).
