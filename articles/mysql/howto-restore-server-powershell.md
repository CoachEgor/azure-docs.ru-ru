---
title: Резервное копирование и восстановление — Azure PowerShell — база данных Azure для MySQL
description: Узнайте, как выполнить резервное копирование и восстановление сервера в базе данных Azure для MySQL с помощью Azure PowerShell.
author: ajlam
ms.author: andrela
ms.service: mysql
ms.devlang: azurepowershel
ms.topic: conceptual
ms.date: 4/28/2020
ms.openlocfilehash: 1e63a6e57e1dc929c78e5278df6ef0e4ab2a17d7
ms.sourcegitcommit: 58faa9fcbd62f3ac37ff0a65ab9357a01051a64f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "82230851"
---
# <a name="how-to-back-up-and-restore-a-server-in-azure-database-for-mysql-using-powershell"></a>Как создать резервную копию и восстановить сервер в базе данных Azure для MySQL с помощью PowerShell

Для серверов базы данных Azure для MySQL периодически создается резервная копия, чтобы включить функции восстановления. С помощью этой функции можно восстановить сервер и все его базы данных до более ранней точки во времени на новом сервере.

## <a name="prerequisites"></a>Предварительные условия

Вот что вам нужно, чтобы выполнить инструкции, приведенные в этом руководстве:

- [Модуль AZ PowerShell](/powershell/azure/install-az-ps) , установленный локально или [Azure Cloud Shell](https://shell.azure.com/) в браузере
- [Сервер базы данных Azure для MySQL](quickstart-create-mysql-server-database-using-azure-powershell.md)

> [!IMPORTANT]
> Пока модуль PowerShell AZ. MySql находится на этапе предварительной версии, его необходимо установить отдельно от модуля AZ PowerShell с помощью следующей команды: `Install-Module -Name Az.MySql -AllowPrerelease`.
> Как только модуль PowerShell AZ. MySql станет общедоступным, он становится частью будущих выпусков AZ PowerShell и доступен с помощью встроенных в Azure Cloud Shell.

Если вы решили использовать PowerShell локально, подключитесь к учетной записи Azure с помощью командлета [Connect-азаккаунт](/powershell/module/az.accounts/Connect-AzAccount) .

[!INCLUDE [cloud-shell-try-it.md](../../includes/cloud-shell-try-it.md)]

## <a name="set-backup-configuration"></a>Настройка конфигурации резервного копирования

При создании сервера можно выбрать между настройками сервера для локально избыточных или географически избыточных резервных копий.

> [!NOTE]
> После создания сервера тип избыточности, географически избыточный и локально избыточный, нельзя изменить.

При создании сервера с помощью `New-AzMySqlServer` команды параметр **жеоредундантбаккуп** определяет параметр избыточности резервной копии. Если этот **флажок установлен**, выполняются геоизбыточные резервные копии. Или, если **отключено**, будут выполняться локально избыточные резервные копии.

Срок хранения резервной копии задается параметром **баккупретентиондай** .

Дополнительные сведения об установке этих значений во время создания сервера см. в статье [Создание сервера базы данных Azure для MySQL с помощью PowerShell](quickstart-create-mysql-server-database-using-azure-powershell.md).

Вот как можно изменить срок хранения резервной копии сервера.

```azurepowershell-interactive
Update-AzMySqlServer -Name mydemoserver -ResourceGroupName myresourcegroup -BackupRetentionDay 10
```

В указанном выше примере период хранения резервных копий mydemoserver изменен на 10 дней.

Срок хранения резервной копии зависит от того, насколько может быть получено восстановление на момент времени, так как оно основано на доступных резервных копиях. Восстановление до точки во времени описано в следующем разделе.

## <a name="server-point-in-time-restore"></a>Восстановление сервера до точки во времени

Можно восстановить сервер до предыдущей точки во времени. Восстановленные данные копируются на новый сервер, а существующий сервер остается без изменений. Например, если таблица случайно удалена, можно выполнить восстановление до момента, когда произошло только удаление. Затем вы можете извлечь отсутствующие таблицы и данные из восстановленной копии сервера.

Чтобы восстановить сервер, используйте командлет `Restore-AzMySqlServer` PowerShell.

### <a name="run-the-restore-command"></a>Выполнение команды restore

Чтобы восстановить сервер, выполните следующий пример из PowerShell.

```azurepowershell-interactive
$restorePointInTime = (Get-Date).AddMinutes(-10)
Get-AzMySqlServer -Name mydemoserver -ResourceGroupName myresourcegroup |
  Restore-AzMySqlServer -Name mydemoserver-restored -ResourceGroupName myresourcegroup -RestorePointInTime $restorePointInTime -UsePointInTimeRestore
```

Набор параметров **поинтинтимересторе** `Restore-AzMySqlServer` командлета требует наличия следующих параметров:

| Параметр | Рекомендуемое значение | Описание  |
| --- | --- | --- |
| ResourceGroupName |  myresourcegroup |  Группа ресурсов, в которой находится исходный сервер.  |
| Имя | mydemoserver-restored | Имя нового сервера, созданного командой restore. |
| ресторепоинтинтиме | 2020-03-13T13:59:00Z | Выберите точку во времени для восстановления. Значения даты и времени должны находиться в пределах срока хранения резервной копии исходного сервера. Используйте формат даты и времени ISO8601. Например, можно использовать собственный местный часовой пояс, например **2020-03-13T05:59:00-08:00**. Можно также использовать формат UTC Zulu, например **2018-03-13T13:59:00Z**. |
| усепоинтинтимересторе | `<SwitchParameter>` | Используйте режим "на момент времени" для восстановления. |

При восстановлении сервера до более ранней точки во времени создается новый сервер. Исходный сервер и его базы данных из указанного момента времени копируются на новый сервер.

Значения расположения и ценовой категории для восстановленного сервера совпадают со значениями исходного сервера.

После завершения восстановления найдите новый сервер, чтобы убедиться, что данные были восстановлены, как и ожидалось. Новый сервер имеет то же имя для входа администратора сервера и пароль, который был действителен для существующего сервера на момент запуска восстановления. Пароль можно изменить на странице **Обзор** для нового сервера.

На новом сервере, созданном во время восстановления, отсутствуют конечные точки службы виртуальной сети, существовавшие на исходном сервере. Эти правила должны быть настроены отдельно для нового сервера. Восстанавливаются правила брандмауэра с исходного сервера.

## <a name="geo-restore"></a>Геовосстановление

Если вы настроили сервер для географически избыточных резервных копий, можно создать новый сервер из резервной копии существующего сервера. Его можно создать в любом регионе, где доступна служба "База данных Azure для MySQL".

Чтобы создать сервер с помощью геоизбыточной резервной копии, `Restore-AzMySqlServer` используйте команду с параметром **усежеоресторе** .

> [!NOTE]
> Сразу после создания сервер может быть еще не готов к географическому восстановлению. Заполнение метаданных может занять несколько часов.

Чтобы выполнить геовосстановление сервера, выполните следующий пример из PowerShell:

```azurepowershell-interactive
Get-AzMySqlServer -Name mydemoserver -ResourceGroupName myresourcegroup |
  Restore-AzMySqlServer -Name mydemoserver-georestored -ResourceGroupName myresourcegroup -Location eastus -Sku GP_Gen5_8 -UseGeoRestore
```

В этом примере создается новый сервер с именем **mydemoserver-геовосстановление** в регионе Восточная часть США, принадлежащий **myresourcegroup**. Это сервер общего назначения 5-го поколения с 8 виртуальными ядрами. Сервер создается из геоизбыточной резервной копии **mydemoserver**, также в группе ресурсов **myresourcegroup**.

Чтобы создать новый сервер в другой группе ресурсов с существующего сервера, укажите имя новой группы ресурсов с помощью параметра **ResourceGroupName** , как показано в следующем примере:

```azurepowershell-interactive
Get-AzMySqlServer -Name mydemoserver -ResourceGroupName myresourcegroup |
  Restore-AzMySqlServer -Name mydemoserver-georestored -ResourceGroupName newresourcegroup -Location eastus -Sku GP_Gen5_8 -UseGeoRestore
```

Набор параметров **геовосстановления** для `Restore-AzMySqlServer` командлета требует наличия следующих параметров:

| Параметр | Рекомендуемое значение | Описание  |
| --- | --- | --- |
|ResourceGroupName | myresourcegroup | Имя группы ресурсов, к которой принадлежит новый сервер.|
|Имя | mydemoserver-georestored | Имя нового сервера. |
|Расположение | eastus | Расположение нового сервера. |
|усежеоресторе | `<SwitchParameter>` | Используйте географический режим для восстановления. |

При создании нового сервера с помощью географического восстановления он наследует тот же размер хранилища и ценовую категорию, что и исходный сервер, если не указан параметр **SKU** .

После завершения восстановления найдите новый сервер, чтобы убедиться, что данные были восстановлены, как и ожидалось. Новый сервер имеет то же имя для входа администратора сервера и пароль, который был действителен для существующего сервера на момент запуска восстановления. Пароль можно изменить на странице **Обзор** для нового сервера.

На новом сервере, созданном во время восстановления, отсутствуют конечные точки службы виртуальной сети, существовавшие на исходном сервере. Эти правила должны быть настроены отдельно для этого нового сервера. Восстанавливаются правила брандмауэра с исходного сервера.

## <a name="next-steps"></a>Следующие шаги

- Дополнительные сведения о [резервных копиях](concepts-backup.md) службы
- Дополнительные сведения о [репликах](concepts-read-replicas.md)
- Дополнительные сведения о возможностях обеспечения [непрерывности бизнес-процессов](concepts-business-continuity.md)
