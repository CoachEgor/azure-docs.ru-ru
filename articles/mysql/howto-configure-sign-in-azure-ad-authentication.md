---
title: Используйте активный каталог Azure - База данных Azure для MyS'L
description: Узнайте о том, как настроить активный каталог Azure (Azure AD) для проверки подлинности с помощью базы данных Azure для MyS'L
author: lfittl-msft
ms.author: lufittl
ms.service: mysql
ms.topic: conceptual
ms.date: 01/22/2019
ms.openlocfilehash: 0403edadd491609c2c88d5b5ac6980d97163f8d6
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79299011"
---
# <a name="use-azure-active-directory-for-authenticating-with-mysql"></a>Используйте активный каталог Azure для проверки подлинности с помощью MyS'L

В этой статье будут выработана работа по настройке доступа active Directory Azure с базой данных Azure для MyS'L и как подключиться с помощью маркера Azure AD.

> [!IMPORTANT]
> Проверка аутентификации Azure AD для базы данных Azure для MyS'L в настоящее время находится в открытом доступе.
> Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены.
> Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

## <a name="setting-the-azure-ad-admin-user"></a>Настройка пользователя AD Adin Azure

Только пользователь Azure Admin может создавать/включать пользователей для проверки подлинности на основе Azure AD. Для создания и пользователя Azure AdA Adin, пожалуйста, выполните следующие действия

1. На портале Azure выберите экземпляр базы данных Azure для MyS'L, который требуется включить для Azure AD.
2. В настройках выберите Active Directory Admin:

![набор лазурного администратора рекламы][2]

3. Выберите действительного пользователя Azure AD в клиенте-клиенте администратором Azure AD.

> [!IMPORTANT]
> При настройке администратора новый пользователь добавляется в базу данных Azure для сервера MyS'L с полными разрешениями администратора.

Только один администратор Azure AD может быть создан на сервере MyS'L, а выбор другого будет перезаписывать существующий админ Azure Ad, настроенный на сервер.

В будущем выпуске мы поддержим указание группы Azure AD вместо отдельного пользователя, чтобы иметь несколько администраторов, однако в настоящее время это еще не поддерживается.

После настройки администратора теперь можно войти в систему:

## <a name="connecting-to-azure-database-for-mysql-using-azure-ad"></a>Подключение к базе данных Azure для MyS'L с помощью Azure AD

Следующая диаграмма высокого уровня обобщает рабочий процесс использования аутентификации Azure AD с базой данных Azure для MyS'L:

![поток аутентификации][1]

Мы разработали интеграцию Azure AD для работы с общими инструментами MyS'L, такими как mysql CLI, которые не знают Об Azure AD и поддерживают только указание имени пользователя и пароля при подключении к MyS'L. Мы передаем токен Azure AD в качестве пароля, показанного на рисунке выше.

В настоящее время мы протестировали следующих клиентов:

- MyS'LWorkbench 
- Mysql CLI

Мы также протестировали наиболее распространенные драйверы приложений, вы можете увидеть детали в конце этой страницы.

Вот те шаги, которые пользователю/приложению необходимо будет сделать для проверки подлинности с помощью Azure AD, описанного ниже:

### <a name="step-1-authenticate-with-azure-ad"></a>Шаг 1: Проверка подлинности с помощью Azure AD

Убедитесь, что у вас [установлен Azure CLI.](/cli/azure/install-azure-cli)

Вызвать инструмент Azure CLI для проверки подлинности с помощью Azure AD. Он требует, чтобы вы дали свой идентификатор пользователя Azure AD и пароль.

```
az login
```

Эта команда запустит окно браузера на страницу аутентификации Azure AD.

> [!NOTE]
> Для выполнения этих шагов можно также использовать Azure Cloud Shell.
> Пожалуйста, имейте в виду, что при получении токена доступа Azure AD в оболочке Azure Cloud Shell вам необходимо будет явно позвонить `az login` и войти снова (в отдельном окне с кодом). После этого знака `get-access-token` в команде будет работать, как ожидалось.

### <a name="step-2-retrieve-azure-ad-access-token"></a>Шаг 2: Извлечения токен доступа Azure AD

Вызвать инструмент Azure CLI для получения токена доступа для аутентифицированного пользователя Azure AD со ступени 1 для доступа к базе данных Azure для MyS'L.

Пример (для общедоступного облака):

```shell
az account get-access-token --resource https://ossrdbms-aad.database.windows.net
```

Вышеупомянутая стоимость ресурса должна быть указана точно так, как показано на рисунке. Для других облаков значение ресурса можно искать с помощью:

```shell
az cloud show
```

Для версии Azure CLI 2.0.71 и более поздней, команда может быть указана в следующей более удобной версии для всех облаков:

```shell
az account get-access-token --resource-type oss-rdbms
```

После успешной проверки подлинности Azure AD возвращает токен доступа:

```json
{
  "accessToken": "TOKEN",
  "expiresOn": "...",
  "subscription": "...",
  "tenant": "...",
  "tokenType": "Bearer"
}
```

Токен — строка Base 64, которая кодирует всю информацию о подлинном пользователе и предназначена для базы данных Azure для службы MyS'L.

> [!NOTE]
> Срок действия маркера доступа составляет от 5 минут до 60 минут. Мы рекомендуем вам получить токен доступа непосредственно перед началом входа в базу данных Azure для MyS'L.

### <a name="step-3-use-token-as-password-for-logging-in-with-mysql"></a>Шаг 3: Используйте токен в качестве пароля для входа в систему с MyS'L

При подключении необходимо использовать токен доступа в качестве пароля пользователя MyS'L. При использовании GUI-клиентов, таких как MyS'LWorkbench, вы можете использовать приведенный выше метод для получения токена. 

При использовании CLI, вы можете использовать эту короткую руку для подключения: 

**Пример (Linux/macOS):**
```
mysql -h mydb.mysql.database.azure.com \ 
  --user user@tenant.onmicrosoft.com@mydb \ 
  --enable-cleartext-plugin \ 
  --password=`az account get-access-token --resource-type oss-rdbms --output tsv --query accessToken`
```

Обратите внимание на настройки "включить-cleartext-plugin" - вам нужно использовать аналогичную конфигурацию с другими клиентами, чтобы убедиться, что маркер отправляется на сервер без хэшена.

Теперь вы проходят аутентификацию на сервере MyS'L с помощью аутентификации Azure AD.

## <a name="creating-azure-ad-users-in-azure-database-for-mysql"></a>Создание пользователей Azure AD в базе данных Azure для MyS'L

Чтобы добавить пользователя Azure AD в базу данных Azure для базы данных MyS'L, выполните следующие шаги после подключения (см. более поздний раздел о том, как подключиться):

1. Сначала убедитесь, что пользователь `<user>@yourtenant.onmicrosoft.com` Azure AD является действительным пользователем в нанимательazадных AD.
2. Подпишитесь на базу данных Azure для экземпляра MyS'L в качестве пользователя Azure ADA.
3. Создание `<user>@yourtenant.onmicrosoft.com` пользователя в базе данных Azure для MyS'L.

**Примере:**

```sql
CREATE AADUSER 'user1@yourtenant.onmicrosoft.com';
```

Для имен пользователей, превышающих 32 символы, рекомендуется использовать псевдоним вместо этого, который будет использоваться при подключении: 

Пример

```sql
CREATE AADUSER 'userWithLongName@yourtenant.onmicrosoft.com' as 'userDefinedShortName'; 
```

> [!NOTE]
> Проверка подлинности пользователя через Azure AD не дает пользователю никаких разрешений на доступ к объектам в базе данных Azure для базы данных MyS'L. Вы должны предоставить пользователю необходимые разрешения вручную.

## <a name="creating-azure-ad-groups-in-azure-database-for-mysql"></a>Создание групп Azure AD в базе данных Azure для MyS'L

Чтобы включить группу Azure AD для доступа к базе данных, используйте тот же механизм, что и для пользователей, но вместо этого укажите имя группы:

**Примере:**

```sql
CREATE AADUSER 'Prod_DB_Readonly';
```

При входе в систему члены группы будут использовать свои токены личного доступа, но подписываются с именем группы, указанным как имя пользователя.

## <a name="token-validation"></a>Проверка токенов

Аутентификация Azure AD в базе данных Azure для MyS'L гарантирует наличие пользователя на сервере MyS'L и проверяет действительность токена, проверяя содержимое токена. Выполняются следующие шаги проверки токенов:

-   Токен подписан Azure AD и не был подделан
-   Токен был выпущен Azure AD для клиента, связанного с сервером
-   Срок действия токена не истек
-   Токен предназначен для базы данных Azure для ресурса MyS'L (а не другого ресурса Azure)

## <a name="compatibility-with-application-drivers"></a>Совместимость с драйверами приложений

Большинство драйверов поддерживаются, однако убедитесь, что использовать настройки для отправки пароля в ясном тексте, так что маркер отправляется без изменений.

* C/C++
  * libmysqlclient: Поддерживается
  * mysql-разъем-кз: Поддерживается
* Java
  * Соединитель/J (mysql-разъем-java): `useSSL` Поддерживается, должен использовать настройки
* Python
  * Соединитель/Python: Поддерживается
* Ruby
  * mysql2: Поддерживается
* .NET
  * mysql-разъем-сеть: Поддерживается, нужно добавить плагин для mysql_clear_password
  * mysql-net/MySqlConnector: Поддерживается
* Node.js
  * mysqljs: Не поддерживается (не отправляет токен в cleartext без патча)
  * узл-mysql2: Поддерживается
* Perl;
  * DBD::mysql: Поддерживается
  * Нетта::MyS'L: Не поддерживается
* Go
  * go-sql-драйвер: Поддерживается, добавляйте `?tls=true&allowCleartextPasswords=true` строку соединения

## <a name="next-steps"></a>Дальнейшие действия

* Просмотрите общие концепции [для проверки подлинности активных каталогов Azure с помощью базы данных Azure для MyS'L](concepts-azure-ad-authentication.md)

<!--Image references-->

[1]: ./media/concepts-azure-ad-authentication/authentication-flow.png
[2]: ./media/concepts-azure-ad-authentication/set-azure-ad-admin.png
