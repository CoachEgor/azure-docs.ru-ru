---
title: Использование sys_schema — база данных Azure для MySQL
description: Узнайте, как использовать sys_schema для поиска проблем с производительностью и обслуживания базы данных в базе данных Azure для MySQL.
author: ajlam
ms.author: andrela
ms.service: mysql
ms.topic: troubleshooting
ms.date: 3/30/2020
ms.openlocfilehash: 59b8753007c3b9130c397dda30c571580cbb5326
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "80411090"
---
# <a name="how-to-use-sys_schema-for-performance-tuning-and-database-maintenance-in-azure-database-for-mysql"></a>Как использовать sys_schema для настройки производительности и обслуживания базы данных в службе "База данных Azure для MySQL"

Performance_schema MySQL, впервые доступная в MySQL 5,5, предоставляет инструментирование для многих важных серверных ресурсов, таких как выделение памяти, хранимые программы, блокировка метаданных и т. д. Однако performance_schema содержит более 80 таблиц, и для получения необходимой информации часто требуется соединение таблиц в performance_schema, а также таблицы из information_schema. Созданная на основе performance_schema и information_schema схема sys_schema предоставляет большую коллекцию [понятных представлений](https://dev.mysql.com/doc/refman/5.7/en/sys-schema-views.html) в базе данных только для чтения и полностью поддерживается в службе "База данных Azure для MySQL" версии 5.7.

![Представления sys_schema](./media/howto-troubleshoot-sys-schema/sys-schema-views.png)

В sys_schema есть 52 представления, каждое из которых имеет один из следующих префиксов:

- Host_summary или IO. Задержки, связанные с операциями ввода и вывода.
- InnoDB. Состояние и блокировки буфера InnoDB.
- Memory. Использование памяти узлом и пользователями.
- Schema. Информация, связанная со схемой, такая как автоматическое увеличение, индексы и т. д.
- Statement. Информация об инструкциях SQL. Это может быть инструкция, выполнение которой привело к полному сканированию таблицы или длительному времени запроса.
- User. Потребляемые ресурсы, сгруппированные по пользователям. Примерами являются операции ввода-вывода файлов, подключения и память.
- Wait. События ожидания, сгруппированные по узлу или пользователю.

Теперь рассмотрим некоторые распространенные шаблоны использования sys_schema. Для начала мы будем группировать шаблоны использования в две категории: **Настройка производительности** и **обслуживание базы данных**.

## <a name="performance-tuning"></a>Настройка производительности

### <a name="sysuser_summary_by_file_io"></a>*sys.user_summary_by_file_io*

Операции ввода-вывода являются наиболее ресурсоемкими операциями в базе данных. Мы можем узнать среднюю задержку операций ввода-вывода, запросив представление *sys.user_summary_by_file_io*. При использовании подготовленного хранилища по умолчанию размером 125 ГБ задержка ввода-вывода составляет около 15 секунд.

![Задержка ввода-вывода при размере 125 ГБ](./media/howto-troubleshoot-sys-schema/io-latency-125GB.png)

Так как База данных Azure для MySQL масштабирует операции ввода-вывода в соответствии с хранилищем, после увеличения объема подготовленного хранилища до 1 ТБ задержка операций ввода-вывода уменьшается до 571 мс.

![Задержка ввода-вывода при размере 1 ТБ](./media/howto-troubleshoot-sys-schema/io-latency-1TB.png)

### <a name="sysschema_tables_with_full_table_scans"></a>*sys.schema_tables_with_full_table_scans*

Несмотря на тщательное планирование, многие запросы могут по-прежнему привести к сканированию всей таблицы. Дополнительные сведения о типах индексов и способах их оптимизации см. в статье об [устранении проблем с производительностью запросов](./howto-troubleshoot-query-performance.md). Полное сканирование таблиц является ресурсоемким и снижает производительность вашей базы данных. Самый быстрый способ поиска таблиц с полным сканированием — запросить представление *sys.schema_tables_with_full_table_scans*.

![Сканирование всей таблицы](./media/howto-troubleshoot-sys-schema/full-table-scans.png)

### <a name="sysuser_summary_by_statement_type"></a>*sys.user_summary_by_statement_type*

Чтобы устранить проблемы с производительностью базы данных, может быть полезно просто выявить события, происходящие внутри базы данных, а представление *sys.user_summary_by_statement_type* выведет необходимые сведения по типу инструкций.

![Сводка по инструкциям](./media/howto-troubleshoot-sys-schema/summary-by-statement.png)

В этом примере База данных Azure для MySQL потратила 53 минуты на сканирование журнала подробных поисковых запросов 44 579 раз. Это много времени и много операций ввода-вывода. Вы можете уменьшить эту активность, отключив журнал медленных запросов либо уменьшив частоту внесения в него записей на портале Azure.

## <a name="database-maintenance"></a>Обслуживание базы данных

### <a name="sysinnodb_buffer_stats_by_table"></a>*sys.innodb_buffer_stats_by_table*

[!IMPORTANT]
> Запрос этого представления может повлиять на производительность. Рекомендуется выполнять эту устранение неполадок в нерабочее время.

Буферный пул InnoDB находится в памяти и является основным механизмом кэширования между СУБД и хранилищем. Размер буферного пула привязан к уровню производительности. Его можно изменить, только выбрав другой номер SKU продукта. Как и с памятью в операционной системе, старые страницы выгружаются, чтобы освободить место для новых данных. Чтобы узнать, какие таблицы используют больше всего памяти буферного пула InnoDB, можно запросить представление *sys.innodb_buffer_stats_by_table*.

![Состояние буфера InnoDB](./media/howto-troubleshoot-sys-schema/innodb-buffer-status.png)

На рисунке выше видно, что, за исключением системных таблиц и представлений, каждая таблица базы данных mysqldatabase033, которая размещает один из сайтов WordPress, занимает 16 КБ или 1 страницу данных в памяти.

### <a name="sysschema_unused_indexes--sysschema_redundant_indexes"></a>*sys.schema_unused_indexes* & *sys.schema_redundant_indexes*

Индексы являются эффективным инструментом повышения производительности чтения, однако они влекут дополнительные затраты, связанные с операциями вставки и хранением. *sys.schema_unused_indexes* и *sys.schema_redundant_indexes* предоставляют сведения об неиспользуемых или повторяющихся индексах.

![Неиспользуемые индексы](./media/howto-troubleshoot-sys-schema/unused-indexes.png)

![Избыточные индексы](./media/howto-troubleshoot-sys-schema/redundant-indexes.png)

## <a name="conclusion"></a>Заключение

Таким образом, sys_schema является мощным инструментом, который подходит и для настройки производительности, и для обслуживания базы данных. Обязательно воспользуйтесь этой функцией в Базе данных Azure для MySQL. 

## <a name="next-steps"></a>Дальнейшие шаги
- Чтобы найти ответы на наиболее важные вопросы либо опубликовать новый вопрос или ответ, посетите [Форум MSDN](https://social.msdn.microsoft.com/forums/security/en-US/home?forum=AzureDatabaseforMySQL) или [Stack Overflow](https://stackoverflow.com/questions/tagged/azure-database-mysql).
