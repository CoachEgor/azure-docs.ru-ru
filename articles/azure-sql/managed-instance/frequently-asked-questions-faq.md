---
title: Вопросы и ответы
titleSuffix: Azure SQL Managed Instance
description: SQL Azure Управляемый экземпляр часто задаваемые вопросы
services: sql-database
ms.service: sql-managed-instance
ms.subservice: operations
ms.custom: sqldbrb=1
ms.devlang: ''
ms.topic: conceptual
author: jovanpop-msft
ms.author: jovanpop
ms.reviewer: sstein, carlrab
ms.date: 03/17/2020
ms.openlocfilehash: 9295c6e1daaad6346581b959a9b94a7ab74da44c
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "84708864"
---
# <a name="azure-sql-managed-instance-frequently-asked-questions-faq"></a>SQL Azure Управляемый экземпляр часто задаваемые вопросы
[!INCLUDE[appliesto-sqlmi](../includes/appliesto-sqlmi.md)]

Эта статья содержит наиболее распространенные вопросы о [управляемый экземпляр Azure SQL](sql-managed-instance-paas-overview.md).

## <a name="supported-features"></a>Поддерживаемые функции

**Где можно найти список функций, поддерживаемых в SQL Управляемый экземпляр?**

Список поддерживаемых функций в SQL Управляемый экземпляр см. в статье [функции управляемый экземпляр SQL Azure](../database/features-comparison.md).

Различия в синтаксисе и поведении между Управляемый экземпляр и SQL Server SQL Azure см. [в статье отличия T-SQL от SQL Server](transact-sql-tsql-differences-sql-server.md).


## <a name="tech-spec--resource-limits"></a>Технические спецификации & ограничения ресурсов
 
**Где можно найти технические характеристики и ограничения ресурсов для SQL Управляемый экземпляр?**

Сведения о доступных характеристиках создания оборудования см. [в разделе технические различия в поколениях оборудования](resource-limits.md#hardware-generation-characteristics).
Сведения о доступных уровнях служб и их характеристиках см. в статье [технические различия между уровнями служб](resource-limits.md#service-tier-characteristics).

## <a name="known-issues--bugs"></a>Известные проблемы & ошибках

**Где можно найти известные проблемы и ошибки?**

Сведения об ошибках и известных проблемах см. в разделе [Известные проблемы](../database/doc-changes-updates-release-notes.md#known-issues).

## <a name="new-features"></a>новые функции;

**Где можно найти новейшие функции и функции в общедоступной предварительной версии?**

Новые и предварительные версии функций см. в разделе [заметки о выпуске](../database/doc-changes-updates-release-notes.md?tabs=managed-instance).

## <a name="deployment-times"></a>Время развертывания 

**Сколько времени занимает создание или обновление экземпляра или восстановление базы данных?**

Ожидаемое время создания управляемого экземпляра или изменения уровня служб (виртуальных ядер, хранилище) зависит от нескольких факторов. Ознакомьтесь с [операциями управления](/azure/sql-database/sql-database-managed-instance#managed-instance-management-operations). 

## <a name="naming-conventions"></a>Соглашения об именах

**Может ли управляемый экземпляр иметь то же имя, что и SQL Server локального экземпляра?**

Изменение имени управляемого экземпляра не поддерживается.

Зона DNS по умолчанию *. Database.Windows.NET* для управляемого экземпляра может быть изменена. 

Для использования другой зоны DNS вместо значения по умолчанию, например *. contoso.com*: 
- Используйте Кликонфиг для определения псевдонима. Это средство является просто оболочкой параметров реестра, поэтому ее можно выполнить с помощью групповой политики или скрипта.
- Используйте *CNAME* с параметром *TrustServerCertificate = true* .

## <a name="move-a-database-from-sql-managed-instance"></a>Перемещение базы данных из Управляемый экземпляр SQL 

**Как переместить базу данных из SQL Управляемый экземпляр обратно в SQL Server или базу данных SQL Azure?**

Можно [экспортировать базу данных в BACPAC](../database/database-export.md) , а затем [импортировать BACPAC-файл](../database/database-import.md). Этот подход рекомендуется, если размер базы данных меньше 100 ГБ.

Репликацию транзакций можно использовать, если все таблицы в базе данных имеют первичные ключи.

Собственные `COPY_ONLY` резервные копии, созданные из sql управляемый экземпляр, не могут быть восстановлены в SQL Server, так как SQL управляемый экземпляр имеет более высокую версию базы данных по сравнению с SQL Server.

## <a name="migrate-an-instance-database"></a>Миграция базы данных экземпляра

**Как перенести базу данных экземпляра в базу данных SQL Azure?**

Один из вариантов — [экспортировать базу данных в BACPAC](../database/database-export.md) , а затем [импортировать BACPAC-файл](../database/database-import.md). 

Этот подход рекомендуется, если размер базы данных меньше 100 ГБ. Репликацию транзакций можно использовать, если все таблицы в базе данных имеют первичные ключи.

## <a name="switch-hardware-generation"></a>Переключить создание оборудования 

**Можно ли переключить создание оборудования SQL Управляемый экземпляр между GEN 4 и Gen 5 Online?**

Автоматическое переключение в оперативный режим между поколениями оборудования возможно, если оба поколения оборудования доступны в регионе, где подготовлена Управляемый экземпляр SQL. В этом случае можно проверить [страницу обзора модели Виртуальное ядро](../database/service-tiers-vcore.md), в которой объясняется, как переключаться между поколениями оборудования.

Это длительная операция, так как новый управляемый экземпляр будет подготовлен в фоновом режиме, и базы данных автоматически переносятся между старым и новым экземплярами с быстрой отработкой отказа в конце процесса. 

**Что делать, если оба поколения оборудования не поддерживаются в одном регионе?**

Если оба поколения оборудования не поддерживаются в одном регионе, изменение создания оборудования возможно, но необходимо выполнить вручную. Для этого необходимо подготавливать новый экземпляр в регионе, где доступно необходимое поколение оборудования, и вручную выполнять резервное копирование и восстановление данных между старыми и новыми экземплярами.

**Что делать, если нет достаточного количества IP-адресов для выполнения операции обновления?**

Если в подсети, в которой подготовлен управляемый экземпляр, недостаточно IP-адресов, необходимо создать в нем новую подсеть и новый управляемый экземпляр. Кроме того, мы рекомендуем создать подсеть с дополнительными IP-адресами, чтобы будущие операции обновления не мешали подобным ситуациям. (Чтобы получить правильный размер подсети, проверьте, [как определить размер подсети VNet](vnet-subnet-determine-size.md).) После подготовки нового экземпляра можно вручную создать резервную копию и восстановить данные между старыми и новыми экземплярами или выполнить [восстановление на момент времени](point-in-time-restore.md?tabs=azure-powershell). 


## <a name="tune-performance"></a>Настройка производительности

**Разделы справки настроить производительность SQL Управляемый экземпляр?**

SQL Управляемый экземпляр на уровне общего назначения использует удаленное хранилище, поэтому размер файлов данных и журналов важен для производительности. Дополнительные сведения см. [в разделе влияние размера файла журнала на общего назначения производительность SQL управляемый экземпляр](https://medium.com/azure-sqldb-managed-instance/impact-of-log-file-size-on-general-purpose-managed-instance-performance-21ad170c823e).

Если Рабочая нагрузка состоит из большого количества небольших транзакций, рассмотрите возможность переключения типа подключения с прокси на режим перенаправления.

## <a name="maximum-storage-size"></a>Максимальный размер хранилища

**Каков максимальный размер хранилища для Управляемый экземпляр SQL?**

Размер хранилища для Управляемый экземпляр SQL зависит от выбранного уровня служб (общего назначения или критически важный для бизнеса). Ограничения хранилища этих уровней служб см. в статье [характеристики уровня служб](../database/service-tiers-general-purpose-business-critical.md).

## <a name="backup-storage-cost"></a>Стоимость хранилищ резервных копий 

**Вычитается ли хранилище резервных копий из хранилища Управляемый экземпляр SQL?**

Нет, хранилище резервных копий не вычитается из пространства хранилища SQL Управляемый экземпляр. Хранилище резервных копий не зависит от места хранения экземпляров и не ограничивается размером. Хранилище резервных копий ограничено периодом времени, в течение которого будет храниться резервная копия баз данных экземпляра, настраиваемая с 7 до 35 дней. Дополнительные сведения см. в разделе [Автоматическое резервное копирование](../database/automated-backups-overview.md).

## <a name="track-billing"></a>Мониторинг выставления счетов

**Существует ли способ отслеживанию затрат на выставление счетов за Управляемый экземпляр SQL?**

Это можно сделать с помощью [решения для управления затратами Azure](/azure/cost-management/). Перейдите к разделу **подписки** в [портал Azure](https://portal.azure.com) и выберите **анализ затрат**. 

Используйте параметр **накопленные затраты** , а затем выполните фильтрацию по **типу ресурса** `microsoft.sql/managedinstances` . 
  
## <a name="inbound-nsg-rules"></a>Правила входящих NSG

**Как настроить входящие правила NSG на портах управления?**

Плоскость управления SQL Управляемый экземпляр поддерживает правила NSG, защищающие порты управления.

Для чего используются порты управления:

В инфраструктуре Service Fabric Azure используются порты 9000 и 9003. Основной ролью Service Fabric является обеспечение работоспособности виртуального кластера и сохранение состояния цели с точки зрения количества реплик компонентов.

Порты 1438, 1440 и 1452 используются агентом узла. Агент узла — это приложение, которое выполняется в кластере и используется плоскостью управления для выполнения команд управления.

Помимо правил NSG, встроенный брандмауэр защищает экземпляр на уровне сети. На уровне приложения обмен данными защищается с помощью сертификатов.

Дополнительные сведения и сведения о проверке встроенного брандмауэра см. в статье [встроенные брандмауэры управляемый экземпляр Azure SQL](management-endpoint-verify-built-in-firewall.md).


## <a name="mitigate-data-exfiltration-risks"></a>Устранение рисков утечка данных  

**Как уменьшить риски утечка данных?**

Чтобы уменьшить риски утечка данных, рекомендуется применить набор параметров безопасности и элементов управления.

- Включите [прозрачное шифрование данных (TDE)](https://docs.microsoft.com/azure/sql-database/transparent-data-encryption-azure-sql) во всех базах данных.
- Выключите среду CLR. Это также рекомендуется и в локальной среде.
- Используйте только проверку подлинности Azure Active Directory (Azure AD).
- Получите доступ к экземпляру с учетной записью администратора базы данных с низким уровнем привилегий.
- Настройка доступа к JIT-Jumpbox для учетной записи sysadmin.
- Включите [аудит SQL](https://docs.microsoft.com/sql/relational-databases/security/auditing/sql-server-audit-database-engine)и интегрируйте его с механизмами предупреждений.
- Включите [обнаружение угроз](https://docs.microsoft.com/azure/sql-database/sql-database-threat-detection) в пакете [расширенной защиты данных (ADS)](https://docs.microsoft.com/azure/sql-database/sql-database-advanced-data-security) .


## <a name="cost-saving-use-cases"></a>Варианты использования для экономии затрат

**Где можно найти варианты использования и сократить расходы с помощью SQL Управляемый экземпляр?**

Примеры использования SQL Управляемый экземпляр:

- [коматсу](https://customers.microsoft.com/story/komatsu-australia-manufacturing-azure)
- [кмд](https://customers.microsoft.com/en-ca/story/kmd-professional-services-azure-sql-database)
- [повердетаилс](https://customers.microsoft.com/story/powerdetails-partner-professional-services-azure-sql-database-managed-instance)
- [аллскриптс](https://customers.microsoft.com/story/allscripts-partner-professional-services-azure)

Чтобы получить более полное представление о преимуществах, затратах и рисках, связанных с развертыванием Управляемый экземпляр Azure SQL, также Forrester исследование: [Общее экономическое воздействие База данных SQL Microsoft Azure управляемый экземпляр](https://azure.microsoft.com/resources/forrester-tei-sql-database-managed-instance).


## <a name="dns-refresh"></a>Обновление DNS 

**Можно ли выполнить обновление DNS?**

Сейчас мы не предоставляем компонент для обновления конфигурации DNS-сервера для Управляемый экземпляр SQL.

В конечном итоге обновляется конфигурация DNS:

- По истечении срока аренды DHCP.
- При обновлении платформы.

В качестве обходного решения можно понизить уровень SQL Управляемый экземпляр до 4 виртуальных ядер и снова обновить его. Это оказывает побочный результат обновления конфигурации DNS.


## <a name="ip-address"></a>IP-адрес

**Можно ли подключиться к SQL Управляемый экземпляр с помощью IP-адреса?**

Подключение к SQL Управляемый экземпляр с использованием IP-адреса не поддерживается. Имя узла Управляемый экземпляр SQL сопоставляется с подсистемой балансировки нагрузки перед виртуальным кластером SQL Управляемый экземпляр. Поскольку один виртуальный кластер может содержать несколько управляемых экземпляров, соединения не могут маршрутизироваться к правильному управляемому экземпляру без явного указания имени.

Дополнительные сведения об архитектуре виртуальных кластеров SQL Управляемый экземпляр см. в статье [Архитектура подключения виртуального кластера](connectivity-architecture-overview.md#virtual-cluster-connectivity-architecture).

**Может ли SQL Управляемый экземпляр иметь статический IP-адрес?**

В редких, но необходимых ситуациях может потребоваться выполнить оперативный перенос SQL Управляемый экземпляр в новый виртуальный кластер. При необходимости эта миграция обусловлена изменениями в нашем технологическом стеке, предназначенным для повышения безопасности и надежности службы. Переход на новый виртуальный кластер приводит к изменению IP-адреса, сопоставленного с именем узла Управляемый экземпляр SQL. Служба SQL Управляемый экземпляр не требует поддержки статического IP-адреса и оставляет за собой право изменить ее без уведомления в рамках регулярных циклов обслуживания.

По этой причине мы настоятельно рекомендуем полагаться на неизменность IP-адреса, так как это может привести к ненужному простою.

## <a name="change-time-zone"></a>Изменить часовой пояс

**Можно ли изменить часовой пояс для существующего управляемого экземпляра?**

Настройка часового пояса может быть установлена при первой инициализации управляемого экземпляра. Изменение часового пояса существующего управляемого экземпляра не поддерживается. Дополнительные сведения см. в разделе [ограничения часовых поясов](timezones-overview.md#limitations).

К обходным решениям относятся создание нового управляемого экземпляра с соответствующим часовым поясом, а затем выполнение резервного копирования и восстановления вручную, а также рекомендации по выполнению [восстановления на момент времени между экземплярами](https://blogs.msdn.microsoft.com/sqlserverstorageengine/2018/06/07/cross-instance-point-in-time-restore-in-azure-sql-database-managed-instance/).


## <a name="resolve-performance-issues"></a>Устранение проблем с производительностью

**Разделы справки устранить проблемы с производительностью SQL Управляемый экземпляр?**

Для сравнения производительности SQL Управляемый экземпляр и SQL Server хорошей отправной точкой являются рекомендации [по сравнению производительности между управляемый экземпляр и SQL Server SQL Azure](https://techcommunity.microsoft.com/t5/Azure-SQL-Database/The-best-practices-for-performance-comparison-between-Azure-SQL/ba-p/683210).

Загрузка данных часто выполняется медленнее в Управляемый экземпляр SQL, чем в SQL Server из-за обязательной модели полного восстановления и [ограничений](https://docs.microsoft.com/azure/sql-database/sql-database-managed-instance-resource-limits#service-tier-characteristics) пропускной способности записи в журнал транзакций. Иногда это можно обойти, загружая временные данные в базу данных tempdb, а не пользовательскую, либо используя кластеризованные индексы columnstore или таблицы, оптимизированные для памяти.


## <a name="restore-encrypted-backup"></a>Восстановление зашифрованной резервной копии

**Можно ли восстановить зашифрованную базу данных в SQL Управляемый экземпляр?**

Да, вам не нужно расшифровывать базу данных, чтобы восстановить ее в SQL Управляемый экземпляр. Необходимо предоставить сертификат или ключ, используемый в качестве предохранителя ключа шифрования в исходной системе для SQL Управляемый экземпляр, чтобы иметь возможность считывать данные из зашифрованного файла резервной копии. Это можно осуществить двумя путями:

- *Отправка предохранителя сертификата в управляемый экземпляр SQL*. Это можно сделать только с помощью PowerShell. [Пример скрипта](https://docs.microsoft.com/azure/sql-database/sql-database-managed-instance-migrate-tde-certificate) описывает весь процесс.
- *Отправьте асимметричный ключ-предохранитель в Azure Key Vault и наведите на него управляемый экземпляр SQL*. Этот подход похож на вариант использования, используемый в качестве собственного ключа (BYOK), который также использует интеграцию Key Vault для хранения ключа шифрования. Если вы не хотите использовать ключ в качестве предохранителя ключа шифрования и просто хотите сделать ключ доступным для SQL Управляемый экземпляр для восстановления зашифрованных баз данных, следуйте инструкциям по [настройке BYOK TDE](https://docs.microsoft.com/azure/sql-database/transparent-data-encryption-azure-sql#manage-transparent-data-encryption)и не устанавливайте флажок **сделать выбранный ключ TDE предохранителем по умолчанию**.

После того как средство защиты шифрования будет доступно для Управляемый экземпляр SQL, можно продолжить стандартную процедуру восстановления базы данных.

## <a name="migrate-from-sql-database"></a>Миграция из базы данных SQL 

**Как выполнить миграцию из базы данных SQL Azure в SQL Управляемый экземпляр?**

SQL Управляемый экземпляр предлагает те же уровни производительности для вычислений и размера хранилища, что и база данных SQL Azure. Если вы хотите консолидировать данные в одном экземпляре или вам нужна только функция, которая поддерживается исключительно в SQL Управляемый экземпляр, можно перенести данные с помощью функций экспорта и импорта (BACPAC).

## <a name="password-policy"></a>Политика паролей 

**Какие политики паролей применяются для имен входа SQL Управляемый экземпляр SQL?**

Политика паролей SQL Управляемый экземпляр для имен входа SQL наследует политики платформы Azure, которые применяются к виртуальным машинам, образуя виртуальный кластер, в котором содержится управляемый экземпляр. На данный момент изменить какие-либо из этих параметров невозможно, так как эти параметры определяются в Azure и наследуются управляемым экземпляром.

 > [!IMPORTANT]
 > Платформа Azure может изменять требования политики, не уведомляя службы об этих политиках.

**Каковы текущие политики платформы Azure?**

Каждое имя входа должно устанавливать свой пароль при входе в систему и изменять его пароль после достижения максимального срока.

| **Политика** | **Параметр безопасности** |
| --- | --- |
| Максимальный срок действия пароля. | 42 дней |
| Минимальный срок действия пароля. | 1 день |
| Минимальная длина пароля | 10 символов |
| Пароль должен соответствовать требованиям к сложности | Включено |

**Можно ли отключить сложность и срок действия пароля в SQL Управляемый экземпляр на уровне входа?**

Да, можно управлять CHECK_POLICY и CHECK_EXPIRATION полями на уровне входа. Вы можете проверить текущие параметры, выполнив следующую команду T-SQL:

```sql
SELECT *
FROM sys.sql_logins
```

После этого можно изменить указанные параметры входа, выполнив следующие действия.

```sql
ALTER LOGIN <login_name> WITH CHECK_POLICY = OFF;
ALTER LOGIN <login_name> WITH CHECK_EXPIRATION = OFF;
```

(замените "Test" на требуемое имя для входа и настройте параметры политики и срока действия).
