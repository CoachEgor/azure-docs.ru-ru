---
title: Вопросы и ответы
titleSuffix: Azure SQL Managed Instance
description: SQL Azure Управляемый экземпляр часто задаваемые вопросы
services: sql-database
ms.service: sql-managed-instance
ms.subservice: operations
ms.custom: sqldbrb=1
ms.devlang: ''
ms.topic: conceptual
author: jovanpop-msft
ms.author: jovanpop
ms.reviewer: sstein, carlrab
ms.date: 03/17/2020
ms.openlocfilehash: 5f42079d271a933cb9a722c7e33e6f646f7c4d1b
ms.sourcegitcommit: 4913da04fd0f3cf7710ec08d0c1867b62c2effe7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/14/2020
ms.locfileid: "88210499"
---
# <a name="azure-sql-managed-instance-frequently-asked-questions-faq"></a>SQL Azure Управляемый экземпляр часто задаваемые вопросы
[!INCLUDE[appliesto-sqlmi](../includes/appliesto-sqlmi.md)]

Эта статья содержит наиболее распространенные вопросы о [управляемый экземпляр Azure SQL](sql-managed-instance-paas-overview.md).

## <a name="supported-features"></a>Поддерживаемые функции

**Где можно найти список функций, поддерживаемых в SQL Управляемый экземпляр?**

Список поддерживаемых функций в SQL Управляемый экземпляр см. в статье [функции управляемый экземпляр SQL Azure](../database/features-comparison.md).

Различия в синтаксисе и поведении между Управляемый экземпляр и SQL Server SQL Azure см. [в статье отличия T-SQL от SQL Server](transact-sql-tsql-differences-sql-server.md).


## <a name="technical-specification-resource-limits-and-other-limitations"></a>Техническая спецификация, ограничения ресурсов и другие ограничения
 
**Где можно найти технические характеристики и ограничения ресурсов для SQL Управляемый экземпляр?**

Сведения о доступных характеристиках создания оборудования см. [в разделе технические различия в поколениях оборудования](resource-limits.md#hardware-generation-characteristics).
Сведения о доступных уровнях служб и их характеристиках см. в статье [технические различия между уровнями служб](resource-limits.md#service-tier-characteristics).

**Какой уровень служб мне подходит?**

Любой клиент может использовать любой уровень служб. Однако, если вы хотите обмениваться существующими лицензиями на Управляемый экземпляр Azure SQL с помощью [преимущество гибридного использования Azure](https://azure.microsoft.com/pricing/hybrid-benefit/), имейте в виду, что клиенты SQL Server Enterprise Edition с лицензией Software Assurance подходят для [общего назначения](../database/service-tier-general-purpose.md) или [критически важный для бизнеса](../database/service-tier-business-critical.md) уровней производительности, а клиенты SQL Server Standard Edition — только для общего назначения уровня производительности. Дополнительные сведения см. [в разделе определенные права АХБ](../azure-hybrid-benefit.md?tabs=azure-powershell#what-are-the-specific-rights-of-the-azure-hybrid-benefit-for-sql-server).

**Какие типы подписок поддерживаются для SQL Управляемый экземпляр?**

Список поддерживаемых типов подписок см. в разделе [Поддерживаемые типы подписок](resource-limits.md#supported-subscription-types). 

**Какие регионы Azure поддерживаются?**

Управляемые экземпляры можно создавать в большинстве регионов Azure. см. раздел [Supported regions for SQL управляемый экземпляр](https://azure.microsoft.com/global-infrastructure/services/?products=sql-database&regions=all). Если требуется управляемый экземпляр в регионе, который в настоящее время не поддерживается, [отправьте запрос в службу поддержки через портал Azure](../database/quota-increase-request.md).

**Существуют ли ограничения квоты для развертываний Управляемый экземпляр SQL?**

Для управляемого экземпляра предусмотрено два ограничения по умолчанию: ограничение числа подсетей, которое можно использовать, и ограничения на количество виртуальных ядер, которые можно подготавливать. Ограничения различаются по типам и регионам подписки. Список ограничений региональных ресурсов по типу подписки см. в разделе Таблица из [ограничения региональных ресурсов](resource-limits.md#regional-resource-limitations). Это программные ограничения, которые можно увеличить по запросу. Если вам нужно подготавливать больше управляемых экземпляров в текущих регионах, отправьте запрос в службу поддержки, чтобы увеличить квоту с помощью портал Azure. Дополнительные сведения см. в статье [запрос увеличения квоты для базы данных SQL Azure](../database/quota-increase-request.md).

**Можно ли увеличить предельное число баз данных (100) на управляемом экземпляре по запросу?**

Нет, и в настоящее время нет зафиксированных планов для увеличения количества баз данных в SQL Управляемый экземпляр. 

**Где можно выполнить миграцию, если у меня больше 8 ТБ данных?**
Вы можете выполнить миграцию на другие версии Azure, которые соответствуют вашей рабочей нагрузке: [масштабирование базы данных SQL Azure](../database/service-tier-hyperscale.md) или [SQL Server на виртуальных машинах Azure](../virtual-machines/windows/sql-server-on-azure-vm-iaas-what-is-overview.md).

**Где я могу выполнить миграцию, если у меня есть определенные требования к оборудованию, например объем ОЗУ для Виртуальное ядро или больше процессоров?**
Вы можете рассмотреть переход на [SQL Server на виртуальных машинах Azure или в](../virtual-machines/windows/sql-server-on-azure-vm-iaas-what-is-overview.md) оптимизированной памяти или ЦП [базы данных SQL Azure](../database/sql-database-paas-overview.md) .

## <a name="known-issues-and-defects"></a>Известные проблемы и дефекты

**Где можно найти известные проблемы и дефекты?**

Сведения о дефектах продукта и известных проблемах см. в статье [Известные проблемы](../database/doc-changes-updates-release-notes.md#known-issues).

## <a name="new-features"></a>новые функции;

**Где можно найти новейшие функции и функции в общедоступной предварительной версии?**

Новые и предварительные версии функций см. в разделе [заметки о выпуске](../database/doc-changes-updates-release-notes.md?tabs=managed-instance).

## <a name="create-update-delete-or-move-sql-managed-instance"></a>Создание, обновление, удаление или перемещение Управляемый экземпляр SQL

**Как можно подготавливать SQL Управляемый экземпляр?**

Вы можете подготавливать экземпляр на [портале Azure](instance-create-quickstart.md), [PowerShell](scripts/create-configure-managed-instance-powershell.md), [Azure CLI](https://techcommunity.microsoft.com/t5/azure-sql-database/create-azure-sql-managed-instance-using-azure-cli/ba-p/386281) и [шаблонах ARM](https://docs.microsoft.com/archive/blogs/sqlserverstorageengine/creating-azure-sql-managed-instance-using-arm-templates).

**Можно ли подготавливать управляемые экземпляры в существующей подписке?**

Да, можно подготавливать Управляемый экземпляр в существующей подписке, если эта подписка относится к [поддерживаемым типам подписок](resource-limits.md#supported-subscription-types).

**Почему не удалось подготавливать Управляемый экземпляр в подсети, имя которой начинается с цифры?**

Это текущее ограничение в базовом компоненте, которое проверяет имя подсети на соответствие регулярному выражению ^ [a-ZA-z_] [^ \\ \/ \: \* \? \" \<\> \| \` \' \^ ] * (? <! [ \. \s]) $. В настоящее время поддерживаются все имена, которые передают регулярное выражение и являются допустимыми именами подсетей.

**Как масштабировать управляемый экземпляр?**

Вы можете масштабировать управляемый экземпляр с помощью [портала Azure](../database/service-tiers-vcore.md?tabs=azure-portal#selecting-a-hardware-generation), [PowerShell](https://docs.microsoft.com/archive/blogs/sqlserverstorageengine/change-size-azure-sql-managed-instance-using-powershell), [Azure CLI](https://docs.microsoft.com/cli/azure/sql/mi?view=azure-cli-latest#az-sql-mi-update) или [шаблонов ARM](https://docs.microsoft.com/archive/blogs/sqlserverstorageengine/updating-azure-sql-managed-instance-properties-using-arm-templates).

**Можно ли переместить Управляемый экземпляр из одного региона в другой?**

Да, можно. Инструкции см. в разделе [Перемещение ресурсов между регионами](../database/move-resources-across-regions.md).

**Как удалить Управляемый экземпляр?**

Вы можете удалить управляемые экземпляры с помощью портала Azure, [PowerShell](https://docs.microsoft.com/powershell/module/az.sql/remove-azsqlinstance?view=azps-4.3.0), [Azure CLI](https://docs.microsoft.com/cli/azure/sql/mi?view=azure-cli-latest#az-sql-mi-delete) или [Диспетчер ресурсов интерфейсов API](https://docs.microsoft.com/rest/api/sql/managedinstances/delete).

**Сколько времени занимает создание или обновление экземпляра или восстановление базы данных?**

Ожидаемое время создания нового управляемого экземпляра или изменения уровней служб (виртуальных ядер, хранилище) зависит от нескольких факторов. См. раздел [операции управления](sql-managed-instance-paas-overview.md#management-operations).
 
## <a name="naming-conventions"></a>Соглашения об именах

**Может ли управляемый экземпляр иметь то же имя, что и SQL Server локального экземпляра?**

Изменение имени управляемого экземпляра не поддерживается.

**Можно ли изменить префикс зоны DNS?**

Да, Управляемый экземпляр зону DNS по умолчанию *. Database.Windows.NET* можно изменить. 

Для использования другой зоны DNS вместо значения по умолчанию, например *. contoso.com*: 
- Используйте Кликонфиг для определения псевдонима. Это средство является просто оболочкой параметров реестра, поэтому ее можно выполнить с помощью групповой политики или скрипта.
- Используйте *CNAME* с параметром *TrustServerCertificate = true* .

## <a name="migration-options"></a>Варианты переноса

**Как выполнить миграцию из одного или эластичного пула базы данных SQL Azure в Управляемый экземпляр SQL?**

Управляемый экземпляр предлагает те же уровни производительности для вычислений и размера хранилища, что и другие варианты развертывания базы данных SQL Azure. Если необходимо консолидировать данные в одном экземпляре или требуется только функция, поддерживаемая исключительно в управляемом экземпляре, можно перенести данные с помощью функции экспорта и импорта (BACPAC). Ниже приведены другие способы, которые следует учитывать при переносе базы данных SQL в SQL Управляемый экземпляр. 
- Использование [внешнего источника данных](https://techcommunity.microsoft.com/t5/azure-database-support-blog/lesson-learned-129-using-data-source-external-from-azure-sql/ba-p/1443210)
- Использование [SqlPackage](https://techcommunity.microsoft.com/t5/azure-database-support-blog/how-to-migrate-azure-sql-database-to-azure-sql-managed-instance/ba-p/369182)
- Использование программы [bcp](https://medium.com/azure-sqldb-managed-instance/migrate-from-azure-sql-managed-instance-using-bcp-674c92efdca7)

**Как перенести базу данных экземпляра в отдельную базу данных SQL Azure?**

Один из вариантов — [экспортировать базу данных в BACPAC](../database/database-export.md) , а затем [импортировать BACPAC-файл](../database/database-import.md). Этот подход рекомендуется, если размер базы данных меньше 100 ГБ.

[Репликацию транзакций](replication-two-instances-and-sql-server-configure-tutorial.md?view=sql-server-2017) можно использовать, если все таблицы в базе данных имеют *первичные* ключи и в базе данных нет объектов OLTP в памяти.

Резервные копии машинного COPY_ONLY, созданные из управляемого экземпляра, не могут быть восстановлены в SQL Server, так как для управляемого экземпляра выше по сравнению с SQL Server. Дополнительные сведения см. в разделе [резервное копирование только для копирования](https://docs.microsoft.com/sql/relational-databases/backup-restore/copy-only-backups-sql-server?view=sql-server-ver15).

**Как перенести экземпляр SQL Server в SQL Управляемый экземпляр?**

Сведения о переносе экземпляра SQL Server см. в разделе [Миграция экземпляра SQL Server в управляемый экземпляр Azure SQL](migrate-to-instance-from-sql-server.md).

**Как выполнить миграцию с других платформ на SQL Управляемый экземпляр?**

Сведения о миграции из других платформ см. [здесь](https://datamigration.microsoft.com/).

## <a name="switch-hardware-generation"></a>Переключить создание оборудования 

**Можно ли переключить создание оборудования управляемого экземпляра между GEN 4 и Gen 5 Online?**

Автоматическое переключение через Интернет с го поколения на го поколения возможно, если го поколенияное оборудование доступно в регионе, где подготовлен управляемый экземпляр. В этом случае можно проверить [страницу обзора модели Виртуальное ядро](../database/service-tiers-vcore.md) , объясняющую, как переключаться между поколениями оборудования.

Это длительная операция, так как новый управляемый экземпляр будет подготовлен в фоновом режиме, и базы данных автоматически переносятся между старым и новым экземплярами с помощью быстрой отработки отказа в конце процесса.

Примечание. го поколения оборудование помещается в фазу и больше не доступно для новых развертываний. Все новые базы данных должны быть развернуты на го поколения оборудовании. Переключение с го поколения на го поколения также недоступно.

## <a name="performance"></a>Производительность 

**Как сравнить производительность Управляемый экземпляр с SQL Server производительностью?**

Для сравнения производительности между управляемым экземпляром и SQL Server хорошей отправной точкой являются рекомендации [по сравнению производительности между управляемым экземпляром SQL Azure и SQL Serverной](https://techcommunity.microsoft.com/t5/azure-sql-database/the-best-practices-for-performance-comparison-between-azure-sql/ba-p/683210) статьей.

**Что приводит к различиям в производительности между Управляемый экземпляр и SQL Server?**

Ознакомьтесь [с основными причинами различия производительности между управляемым экземпляром SQL и SQL Server](https://azure.microsoft.com/blog/key-causes-of-performance-differences-between-sql-managed-instance-and-sql-server/). Дополнительные сведения о влиянии размера файла журнала на общего назначения Управляемый экземпляр производительности см. [в разделе влияние размера файла журнала на общего назначения](https://medium.com/azure-sqldb-managed-instance/impact-of-log-file-size-on-general-purpose-managed-instance-performance-21ad170c823e).

**Разделы справки настроить производительность своего управляемого экземпляра?**

Вы можете оптимизировать производительность управляемого экземпляра, выполнив следующие действия.
- [Автоматическая настройка](../database/automatic-tuning-overview.md) , которая обеспечивает пиковую производительность и устойчивые рабочие нагрузки благодаря непрерывной настройке производительности на основе искусственного интеллекта и машинного обучения.
-   Выполняющаяся [в памяти OLTP](../in-memory-oltp-overview.md) , повышающая пропускную способность и задержку в рабочих нагрузках обработки транзакций и обеспечивающих более быстрое бизнес-аналитику. 

Чтобы еще больше настроить производительность, рассмотрите возможность применения некоторых рекомендаций *по* [настройке приложений и баз данных](../database/performance-guidance.md#tune-your-database).
Если Рабочая нагрузка состоит из большого количества небольших транзакций, рассмотрите возможность [переключения типа подключения с прокси на режим перенаправления](connection-types-overview.md#changing-connection-type) для более низкой задержки и более высокой пропускной способности.

## <a name="monitoring-metrics-and-alerts"></a>Мониторинг, метрики и оповещения

**Каковы варианты мониторинга и оповещения для своего управляемого экземпляра?**

Сведения о всех возможных параметрах мониторинга и оповещения о потреблении и производительности SQL Управляемый экземпляр см. в записи [блога о параметрах мониторинга управляемый экземпляр SQL Azure](https://techcommunity.microsoft.com/t5/azure-sql-database/monitoring-options-available-for-azure-sql-managed-instance/ba-p/1065416). Сведения о мониторинге производительности в режиме реального времени для SQL MI см. в статье [мониторинг производительности в режиме реального времени для управляемый экземпляр базы данных SQL Azure](https://docs.microsoft.com/archive/blogs/sqlcat/real-time-performance-monitoring-for-azure-sql-database-managed-instance).

**Можно ли использовать Профайлер SQL для отслеживания производительности?**

Да, SQL Profiler поддерживается или SQL Управляемый экземпляр. Дополнительные сведения см. в разделе [SQL Profiler](https://docs.microsoft.com/sql/tools/sql-server-profiler/sql-server-profiler?view=sql-server-ver15).

**Поддерживаются ли Помощник по базам данных и анализ производительности запросов для баз данных Управляемый экземпляр?**

Нет, они не поддерживаются. Вы можете использовать динамические [административные представления](../database/monitoring-with-dmvs.md) и [хранилище запросов](https://docs.microsoft.com/sql/relational-databases/performance/monitoring-performance-by-using-the-query-store?view=sql-server-ver15) вместе с [SQL Profiler](https://docs.microsoft.com/sql/tools/sql-server-profiler/sql-server-profiler?view=sql-server-ver15) и [XEvents](https://docs.microsoft.com/sql/relational-databases/extended-events/extended-events?view=sql-server-ver15) для мониторинга баз данных.

**Можно ли создавать оповещения метрик в Управляемый экземпляр SQL?**

Да. Инструкции см. в разделе [CREATE Alerts for SQL управляемый экземпляр](alerts-create.md).

**Можно ли создавать оповещения метрик для базы данных в управляемом экземпляре?**

Вы не можете получать предупреждения о метриках, доступных только для управляемого экземпляра. Метрики предупреждений для отдельных баз данных в управляемом экземпляре недоступны.

## <a name="storage-size"></a>Объем памяти

**Каков максимальный размер хранилища для Управляемый экземпляр SQL?**

Размер хранилища для Управляемый экземпляр SQL зависит от выбранного уровня служб (общего назначения или критически важный для бизнеса). Ограничения хранилища этих уровней служб см. в статье [характеристики уровня служб](../database/service-tiers-general-purpose-business-critical.md).

**Каков минимальный размер хранилища, доступный для управляемого экземпляра?**

Минимальный объем хранилища, доступный в экземпляре, составляет 32 ГБ. Хранилище можно добавить с шагом в 32 ГБ вплоть до максимального размера хранилища. Первые 32 ГБ могут бесплатно взиматься.

**Можно ли увеличить дисковое пространство, выделенное экземпляру независимо от вычислительных ресурсов?**

Да, вы можете приобрести дополнительную память, независимо от вычислений, в некоторый экстент. См. раздел *Максимальное зарезервированное хранилище экземпляра* в [таблице](resource-limits.md#hardware-generation-characteristics).

**Как оптимизировать производительность хранилища на уровне служб общего назначения?**

Чтобы оптимизировать производительность хранилища, ознакомьтесь с рекомендациями [по хранению в общего назначения](https://techcommunity.microsoft.com).

## <a name="backup-and-restore"></a>Резервное копирование и восстановление

**Вычитается ли хранилище резервных копий из хранилища управляемых экземпляров?**

Нет, хранилище резервных копий не вычитается из пространства хранилища управляемого экземпляра. Хранилище резервных копий не зависит от места хранения экземпляров и не ограничивается размером. Хранилище резервных копий ограничено периодом времени, в течение которого будет храниться резервная копия баз данных экземпляра, настраиваемая до 35 дней. Дополнительные сведения см. в разделе [Автоматическое резервное копирование](../database/automated-backups-overview.md).

**Как увидеть, когда на управляемом экземпляре выполняются автоматические резервные копии?**
Сведения о том, как выполнять автоматическое резервное копирование на Управляемый экземпляр, см. в разделе [как отвести автоматическое резервное копирование для управляемый экземпляр SQL Azure](https://techcommunity.microsoft.com/t5/azure-database-support-blog/lesson-learned-128-how-to-track-the-automated-backup-for-an/ba-p/1442355).

**Поддерживается ли резервное копирование по запросу?**
Да, можно создать полную резервную копию только для копирования в хранилище BLOB-объектов Azure, но это будет restorable только в Управляемый экземпляр. Дополнительные сведения см. в разделе [резервное копирование только для копирования](https://docs.microsoft.com/sql/relational-databases/backup-restore/copy-only-backups-sql-server?view=sql-server-ver15). Однако резервное копирование только для копирования невозможно, если база данных шифруется с помощью TDE, управляемых службой, так как сертификат, используемый для шифрования, недоступен. В таком случае используйте функцию восстановления до точки во времени, чтобы переместить базу данных в другой Управляемый экземпляр SQL, или переключитесь на ключ, управляемый клиентом.

**Является ли собственное восстановление (из BAK-файлов) Управляемый экземпляр поддерживается?**
Да, оно поддерживается и доступно для SQL Server 2005 и более поздних версий.  Чтобы использовать собственное восстановление, передайте файл BAK в хранилище BLOB-объектов Azure и выполните команды T-SQL. Дополнительные сведения см. [в разделе Native Restore from URL](https://docs.microsoft.com/azure/sql-database/sql-database-managed-instance-migrate#native-restore-from-url).

## <a name="business-continuity"></a>Непрерывность бизнес-процессов

**Реплицируются ли системные базы данных на дополнительный экземпляр в группе отработки отказа?**

Системные базы данных не реплицируются на дополнительный экземпляр в группе отработки отказа. Таким образом, сценарии, зависящие от объектов системных баз данных, будут невозможны на вторичном экземпляре, если только эти объекты не будут созданы вручную на сервере-получателе. Для решения этой проблемы см. раздел [Включение сценариев, зависящих от объекта из системных баз данных](../database/auto-failover-group-overview.md?tabs=azure-powershell#enable-scenarios-dependent-on-objects-from-the-system-databases).
 
## <a name="networking-requirements"></a>Требования к сети 

**Каковы текущие ограничения на входящие и исходящие NSG в подсети Управляемый экземпляр?**

Необходимые правила NSG и UDR описаны [здесь](connectivity-architecture-overview.md#mandatory-inbound-security-rules-with-service-aided-subnet-configuration)и автоматически устанавливаются службой.
Имейте в виду, что эти правила являются лишь теми, которые необходимы для обслуживания службы. Чтобы подключиться к управляемому экземпляру и использовать различные функции, необходимо задать дополнительные правила, относящиеся к функциям, которые необходимо поддерживать.

**Как настроить входящие правила NSG на портах управления?**

SQL Управляемый экземпляр отвечает за настройку правил на портах управления. Это достигается с помощью функций, называемых [конфигурацией подсети](connectivity-architecture-overview.md#service-aided-subnet-configuration)с помощью служб.
Это позволяет обеспечить непрерывный поток трафика управления для выполнения соглашения об уровне обслуживания.

**Можно ли получить диапазоны исходных IP-адресов, используемых для входящего трафика управления?**

Да. Вы можете анализировать трафик, поступающий через группу безопасности сети, [настроив журналы потоков наблюдателя за сетями](https://docs.microsoft.com/azure/network-watcher/network-watcher-monitoring-overview#analyze-traffic-to-or-from-a-network-security-group).

**Можно ли задать NSG для управления доступом к конечной точке данных (порт 1433)?**

Да. После подготовки Управляемый экземпляр можно задать NSG, который управляет входящим доступом к порту 1433. Рекомендуется максимально сократить диапазон IP-адресов.

**Можно ли настроить NVA или локальный брандмауэр для фильтрации исходящего трафика управления на основе полных доменных имен?**

Нет. Это не поддерживается по нескольким причинам.
-   Маршрутизация трафика, представляющего ответ на входящий запрос управления, будет асимметричной и не сможет работать.
-   Маршрутизация трафика, переходящего в хранилище, повлияет на пропускную способность и задержку, поэтому мы не сможем предоставить ожидаемое качество обслуживания и доступность.
-   В зависимости от опыта эти конфигурации подвержены ошибкам и не поддерживаются.

**Можно ли задать NVA или брандмауэр для исходящего трафика без управления?**

Да. Самый простой способ добиться этого — добавить правило 0/0 к UDR, связанному с подсетью управляемых экземпляров, для маршрутизации трафика через NVA.
 
**Сколько IP-адресов требуется для Управляемый экземпляр?**

Подсеть должна иметь достаточное количество доступных [IP-адресов](connectivity-architecture-overview.md#network-requirements). Сведения об определении размера подсети VNet для SQL Управляемый экземпляр см. в разделе [Определение требуемого размера подсети и диапазона для управляемый экземпляр](https://docs.microsoft.com/azure/sql-database/sql-database-managed-instance-determine-size-vnet-subnet). 

**Что делать, если нет достаточного количества IP-адресов для выполнения операции обновления экземпляра?**

Если в подсети, в которой подготовлен управляемый экземпляр, недостаточно [IP-адресов](connectivity-architecture-overview.md#network-requirements) , необходимо создать в нем новую подсеть и новый управляемый экземпляр. Кроме того, мы рекомендуем создать подсеть с дополнительными IP-адресами, чтобы будущие операции обновления не мешали подобным ситуациям. После подготовки нового экземпляра можно вручную создать резервную копию и восстановить данные между старыми и новыми экземплярами или выполнить [восстановление на момент времени](point-in-time-restore.md?tabs=azure-powershell).

**Нужна ли пустая подсеть для создания Управляемый экземпляр?**

Нет. Можно использовать либо пустую подсеть, либо подсеть, которая уже содержит Управляемый экземпляр. 

**Можно ли изменить диапазон адресов подсети?**

Не при наличии управляемых экземпляров внутри. Это ограничение сетевой инфраструктуры Azure. Вы можете [добавить дополнительное адресное пространство только в пустую подсеть](https://docs.microsoft.com/azure/virtual-network/virtual-network-manage-subnet#change-subnet-settings). 

**Можно ли переместить управляемый экземпляр в другую подсеть?**

Нет. Это текущая Управляемый экземпляр ограничений на разработку. Однако можно подготавливать новый экземпляр в другой подсети и вручную выполнять резервное копирование и восстановление данных между старым и новым экземплярами или выполнять [восстановление на момент времени](point-in-time-restore.md?tabs=azure-powershell)между экземплярами.

**Нужна ли пустая виртуальная сеть для создания Управляемый экземпляр?**

Это необязательное значение. Вы можете [создать виртуальную сеть для SQL azure управляемый экземпляр](https://docs.microsoft.com/azure/sql-database/sql-database-managed-instance-create-vnet-subnet) или [настроить существующую виртуальную сеть для управляемый экземпляр SQL Azure](https://docs.microsoft.com/azure/sql-database/sql-database-managed-instance-configure-vnet-subnet).

**Можно ли поместить Управляемый экземпляр с другими службами в подсети?**

Нет. Сейчас мы не поддерживаем размещение Управляемый экземпляр в подсети, которая уже содержит другие типы ресурсов.

## <a name="connectivity"></a>Соединение 

**Можно ли подключиться к управляемому экземпляру по IP-адресу?**

Нет, такая возможность не поддерживается. Имя узла Управляемый экземпляр сопоставляется с подсистемой балансировки нагрузки перед виртуальным кластером Управляемый экземпляр. Так как один виртуальный кластер может содержать несколько управляемых экземпляров, подключение не может маршрутизироваться к правильному Управляемый экземпляр без указания его имени.
Дополнительные сведения об архитектуре виртуальных кластеров SQL Управляемый экземпляр см. в статье [Архитектура подключения виртуального кластера](connectivity-architecture-overview.md#virtual-cluster-connectivity-architecture).

**Может ли мой управляемый экземпляр иметь статический IP-адрес?**

В настоящее время это не поддерживается.

В редких, но необходимых ситуациях может потребоваться выполнить оперативную миграцию управляемого экземпляра в новый виртуальный кластер. При необходимости эта миграция обусловлена изменениями в нашем технологическом стеке, предназначенным для повышения безопасности и надежности службы. Миграция в новый виртуальный кластер приводит к изменению IP-адреса, сопоставленного с именем узла управляемого экземпляра. Служба управляемого экземпляра не требует поддержки статических IP-адресов и оставляет за собой право менять ее без уведомления в рамках регулярных циклов обслуживания.

По этой причине мы настоятельно рекомендуем полагаться на неизменность IP-адреса, так как это может привести к ненужному простою.

**У Управляемый экземпляр есть общедоступная конечная точка?**

Да. Управляемый экземпляр имеет общедоступную конечную точку, которая по умолчанию используется только для управления службами, но клиент может также включить его для доступа к данным. Дополнительные сведения см. в статье [использование управляемый экземпляр SQL с общедоступными конечными точками](https://docs.microsoft.com/azure/sql-database/sql-database-managed-instance-public-endpoint-securely). Чтобы настроить общедоступную конечную точку, перейдите к разделу [Настройка общедоступной конечной точки в управляемый экземпляр SQL](public-endpoint-configure.md).

**Как Управляемый экземпляр управлять доступом к общедоступной конечной точке?**

Управляемый экземпляр управляет доступом к общедоступной конечной точке на уровне сети и приложения.

Службы управления и развертывания подключаются к управляемому экземпляру с помощью [конечной точки управления](https://docs.microsoft.com/azure/sql-database/sql-database-managed-instance-connectivity-architecture#management-endpoint) , сопоставленной с внешней подсистемой балансировки нагрузки. Трафик направляется на узлы, только если он получен на предопределенном наборе портов, используемых только компонентами управления управляемого экземпляра. Встроенный брандмауэр на узлах настроен на разрешение трафика только из диапазонов IP-адресов Майкрософт. Сертификаты взаимно проходят проверку подлинности всего обмена данными между компонентами управления и плоскостью управления. Дополнительные сведения см. в статье [Архитектура подключения для SQL управляемый экземпляр](https://docs.microsoft.com/azure/sql-database/sql-database-managed-instance-connectivity-architecture#virtual-cluster-connectivity-architecture).

**Можно ли использовать общедоступную конечную точку для доступа к данным в Управляемый экземпляр базах данных?**

Да. Клиент должен включить доступ к данным общедоступной конечной точки на [портале Azure](public-endpoint-configure.md#enabling-public-endpoint-for-a-managed-instance-in-the-azure-portal)  /  [PowerShell](public-endpoint-configure.md#enabling-public-endpoint-for-a-managed-instance-using-powershell) /ARM и настроить NSG для блокировки доступа к порту данных (номер порта 3342). Дополнительные сведения см. в статьях [Настройка общедоступной конечной точки в Azure sql управляемый экземпляр](public-endpoint-configure.md) и [Использование управляемый экземпляр SQL Azure безопасно с общедоступной конечной точкой](public-endpoint-overview.md). 

**Можно ли указать пользовательский порт для конечных точек данных SQL?**

Нет, этот параметр недоступен.  Для конечной точки частных данных Управляемый экземпляр использует номер порта 1433 и для общедоступной конечной точки данных, Управляемый экземпляр использует номер порта по умолчанию 3342.

**Каков рекомендуемый способ подключения управляемых экземпляров, размещенных в разных регионах?**

Для этого предпочтительным способом является пиринг контура Express Route. Это не должно быть совместно с пирингом виртуальной сети между регионами, который не поддерживается из-за [ограничения](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview)внутренней подсистемы балансировки нагрузки.

Если пиринг контура Express Route невозможен, единственным другим вариантом является создание VPN-подключения типа "сеть — сеть" ([портал Azure](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal), [PowerShell](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell), [Azure CLI](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-cli)).

## <a name="mitigate-data-exfiltration-risks"></a>Устранение рисков утечка данных  

**Как уменьшить риски утечка данных?**

Чтобы уменьшить риски утечка данных, рекомендуется применить набор параметров безопасности и элементов управления.

- Включите [прозрачное шифрование данных (TDE)](https://docs.microsoft.com/azure/sql-database/transparent-data-encryption-azure-sql) во всех базах данных.
- Выключите среду CLR. Это также рекомендуется и в локальной среде.
- Используйте только проверку подлинности Azure Active Directory (Azure AD).
- Получите доступ к экземпляру с учетной записью администратора базы данных с низким уровнем привилегий.
- Настройка доступа к JIT-Jumpbox для учетной записи sysadmin.
- Включите [аудит SQL](https://docs.microsoft.com/sql/relational-databases/security/auditing/sql-server-audit-database-engine)и интегрируйте его с механизмами предупреждений.
- Включите [обнаружение угроз](https://docs.microsoft.com/azure/sql-database/sql-database-threat-detection) в пакете [расширенной защиты данных (ADS)](https://docs.microsoft.com/azure/sql-database/sql-database-advanced-data-security) .

## <a name="dns"></a>DNS

**Можно ли настроить пользовательский DNS для Управляемый экземпляр SQL?**

Да. См. статью [Настройка настраиваемой службы DNS для управляемый экземпляр Azure SQL](https://docs.microsoft.com/azure/sql-database/sql-database-managed-instance-custom-dns).

**Можно ли выполнить обновление DNS?**

Сейчас мы не предоставляем компонент для обновления конфигурации DNS-сервера для Управляемый экземпляр SQL.

В конечном итоге обновляется конфигурация DNS:

- По истечении срока аренды DHCP.
- При обновлении платформы.

В качестве обходного решения можно понизить уровень SQL Управляемый экземпляр до 4 виртуальных ядер и снова обновить его. Это оказывает побочный результат обновления конфигурации DNS.

## <a name="change-time-zone"></a>Изменить часовой пояс

**Можно ли изменить часовой пояс для существующего управляемого экземпляра?**

Настройка часового пояса может быть установлена при первой инициализации управляемого экземпляра. Изменение часового пояса существующего управляемого экземпляра не поддерживается. Дополнительные сведения см. в разделе [ограничения часовых поясов](timezones-overview.md#limitations).

К обходным решениям относятся создание нового управляемого экземпляра с соответствующим часовым поясом, а затем выполнение резервного копирования и восстановления вручную, а также рекомендации по выполнению [восстановления на момент времени между экземплярами](https://blogs.msdn.microsoft.com/sqlserverstorageengine/2018/06/07/cross-instance-point-in-time-restore-in-azure-sql-database-managed-instance/).


## <a name="security-and-database-encryption"></a>Безопасность и шифрование базы данных

**Доступна ли роль сервера sysadmin для SQL Управляемый экземпляр?**

Да, клиенты могут создавать имена входа, являющиеся членами роли sysadmin.  Клиенты, получившие права sysadmin, также предполагают ответственность за работу экземпляра, что может негативно повлиять на обязательства соглашения об уровне обслуживания. Чтобы добавить имя входа в роль сервера sysadmin, ознакомьтесь с [проверкой подлинности Azure AD](https://docs.microsoft.com/azure/sql-database/sql-database-managed-instance-aad-security-tutorial#azure-ad-authentication).

**Поддерживается ли прозрачное шифрование данных для Управляемый экземпляр SQL?**

Да, прозрачное шифрование данных поддерживается для SQL Управляемый экземпляр. Дополнительные сведения см. в разделе [прозрачное шифрование данных for SQL управляемый экземпляр](https://docs.microsoft.com/azure/sql-database/transparent-data-encryption-azure-sql?tabs=azure-portal).

**Можно ли использовать модель "использование собственного ключа" для TDE?**

Да, Azure Key Vault для сценария BYOK доступен для Управляемый экземпляр SQL Azure. Дополнительные сведения см. [в разделе прозрачное шифрование данных с ключом, управляемым клиентом](https://docs.microsoft.com/azure/sql-database/transparent-data-encryption-azure-sql?view=sql-server-ver15&tabs=azure-portal#customer-managed-transparent-data-encryption---bring-your-own-key).

**Можно ли перенести зашифрованную базу данных SQL Server?**

Да, можно. Чтобы перенести зашифрованную базу данных SQL Server, необходимо экспортировать и импортировать существующие сертификаты в Управляемый экземпляр, а затем создать полную резервную копию базы данных и восстановить ее в Управляемый экземпляр. 

Можно также использовать [Azure Database Migration Service](https://azure.microsoft.com/services/database-migration/) для переноса зашифрованных баз данных TDE.

**Как настроить вращение предохранителя TDE для SQL Управляемый экземпляр?**

Вы можете поворачивать средство защиты TDE для Управляемый экземпляр с помощью Azure Cloud Shell. Инструкции см. [в разделе прозрачное шифрование данных в SQL управляемый экземпляр с помощью собственного ключа из Azure Key Vault](scripts/transparent-data-encryption-byok-powershell.md).

**Можно ли восстановить зашифрованную базу данных в SQL Управляемый экземпляр?**

Да, вам не нужно расшифровывать базу данных, чтобы восстановить ее в SQL Управляемый экземпляр. Необходимо предоставить сертификат или ключ, используемый в качестве предохранителя ключа шифрования в исходной системе для SQL Управляемый экземпляр, чтобы иметь возможность считывать данные из зашифрованного файла резервной копии. Это можно осуществить двумя путями:

- *Отправка предохранителя сертификата в управляемый экземпляр SQL*. Это можно сделать только с помощью PowerShell. [Пример скрипта](https://docs.microsoft.com/azure/sql-database/sql-database-managed-instance-migrate-tde-certificate) описывает весь процесс.
- *Отправьте асимметричный ключ-предохранитель в Azure Key Vault и наведите на него управляемый экземпляр SQL*. Этот подход похож на вариант использования, используемый в качестве собственного ключа (BYOK), который также использует интеграцию Key Vault для хранения ключа шифрования. Если вы не хотите использовать ключ в качестве предохранителя ключа шифрования и просто хотите сделать ключ доступным для SQL Управляемый экземпляр для восстановления зашифрованных баз данных, следуйте инструкциям по [настройке BYOK TDE](https://docs.microsoft.com/azure/sql-database/transparent-data-encryption-azure-sql#manage-transparent-data-encryption)и не устанавливайте флажок **сделать выбранный ключ TDE предохранителем по умолчанию**.

После того как средство защиты шифрования будет доступно для Управляемый экземпляр SQL, можно продолжить стандартную процедуру восстановления базы данных.

## <a name="purchasing-models-and-benefits"></a>Модели приобретения и преимущества

**Какие модели приобретения доступны для Управляемый экземпляр SQL?**

SQL Управляемый экземпляр предлагает [модель приобретения на основе виртуальное ядро](sql-managed-instance-paas-overview.md#vcore-based-purchasing-model).

**Какие преимущества можно использовать для SQL Управляемый экземпляр?**

Вы можете сэкономить затраты с помощью преимуществ SQL Azure следующим образом:
-   Разворачивание существующих инвестиций в локальные лицензии и сэкономьте до 55% на [преимущество гибридного использования Azure](https://docs.microsoft.com/azure/azure-sql/azure-hybrid-benefit?tabs=azure-powershell). 
-   Зафиксируйте резервирование для вычислительных ресурсов и сэкономьте до 33 процентов с помощью [преимущества зарезервированного экземпляра](https://docs.microsoft.com/azure/sql-database/sql-database-reserved-capacity). Объедините это с преимуществом гибридного использования Azure, чтобы сэкономить до 82 процентов. 
-   Сэкономьте до 55 процентов и цены на прейскуранты с помощью преимущества цены на разработку и [тестирование Azure](https://azure.microsoft.com/pricing/dev-test/) , которая предлагает скидки для текущих рабочих нагрузок разработки и тестирования.

**Кто имеет право на преимущество зарезервированного экземпляра?**

Чтобы иметь право на преимущество зарезервированного экземпляра, тип подписки должен быть соглашением Enterprise (номера предложения: MS-AZR-0017P или MS-AZR-0148P) или отдельное соглашение с оплатой по мере использования (номера предложений: MS-AZR-0003P или MS-AZR-0023P). Дополнительные сведения о резервировании см. в разделе [преимущество зарезервированного экземпляра](https://docs.microsoft.com/azure/sql-database/sql-database-reserved-capacity). 

**Можно ли отменять, переводить или отменять резервирование?**

Вы можете отменять, переводить и отменять резервирование с определенными ограничениями. Дополнительные сведения см. в статье [Self-service exchanges and refunds for Azure Reservations](https://docs.microsoft.com/azure/cost-management-billing/reservations/exchange-and-refund-azure-reservations) (Самостоятельное выполнение обмена и возмещения средств для резервирований Azure).

## <a name="billing-for-managed-instance-and-backup-storage"></a>Выставление счетов за Управляемый экземпляр и хранилище резервных копий

**Какие варианты цен на SQL Управляемый экземпляр?**

Сведения о Управляемый экземпляр ценах см. на [странице с ценами](https://azure.microsoft.com/pricing/details/azure-sql/sql-managed-instance/single/).

**Как можно отвести затраты на выставление счетов за управляемый экземпляр?**

Это можно сделать с помощью [решения для управления затратами Azure](https://docs.microsoft.com/azure/cost-management-billing/). Перейдите к разделу **подписки** в [портал Azure](https://portal.azure.com) и выберите **анализ затрат**. 

Используйте параметр **накопленные затраты** , а затем выполните фильтрацию по **типу ресурса** `microsoft.sql/managedinstances` .

**Сколько стоит автоматическая архивация?**

Вы получаете одинаковый объем свободного места в хранилище резервных копий по мере приобретения зарезервированного пространства хранения данных, независимо от установленного срока хранения резервной копии. Если объем используемого хранилища резервных копий находится в пределах выделенного свободного места, то при автоматическом резервном копировании на управляемом экземпляре не будет взиматься дополнительная плата, поэтому она будет бесплатной. Превышение использования хранилища резервных копий, превышающего свободное место, приведет к затратам примерно $0,20-$0,24 за ГБ/месяц в регионах США или на странице с ценами для получения дополнительных сведений о вашем регионе. Дополнительные сведения см. в разделе [Описание использования хранилища резервных копий](https://techcommunity.microsoft.com/t5/azure-sql-database/backup-storage-consumption-on-managed-instance-explained/ba-p/1390923).

**Как можно отслеживать затраты на использование хранилища резервных копий?**

Вы можете отслеживать затраты на хранение резервных копий с помощью портала Azure. Инструкции см. в разделе [мониторинг затрат для автоматически создаваемых резервных копий](https://docs.microsoft.com/azure/azure-sql/database/automated-backups-overview?tabs=managed-instance#monitor-costs). 

**Как оптимизировать затраты на хранение резервных копий на управляемом экземпляре?**

Сведения об оптимизации затрат на хранение резервных копий см. в разделе [Точная настройка резервного копирования в управляемый экземпляр SQL](https://techcommunity.microsoft.com/t5/azure-sql-database/fine-tuning-backup-storage-costs-on-managed-instance/ba-p/1390935).

## <a name="cost-saving-use-cases"></a>Варианты использования для экономии затрат

**Где можно найти варианты использования и сократить расходы с помощью SQL Управляемый экземпляр?**

Примеры использования SQL Управляемый экземпляр:

- [коматсу](https://customers.microsoft.com/story/komatsu-australia-manufacturing-azure)
- [кмд](https://customers.microsoft.com/en-ca/story/kmd-professional-services-azure-sql-database)
- [повердетаилс](https://customers.microsoft.com/story/powerdetails-partner-professional-services-azure-sql-database-managed-instance)
- [аллскриптс](https://customers.microsoft.com/story/allscripts-partner-professional-services-azure)

Чтобы получить более полное представление о преимуществах, затратах и рисках, связанных с развертыванием Управляемый экземпляр Azure SQL, также Forrester исследование: [Общее экономическое воздействие База данных SQL Microsoft Azure управляемый экземпляр](https://azure.microsoft.com/resources/forrester-tei-sql-database-managed-instance).

## <a name="password-policy"></a>Политика паролей 

**Какие политики паролей применяются для имен входа SQL Управляемый экземпляр SQL?**

Политика паролей SQL Управляемый экземпляр для имен входа SQL наследует политики платформы Azure, которые применяются к виртуальным машинам, образуя виртуальный кластер, в котором содержится управляемый экземпляр. На данный момент изменить какие-либо из этих параметров невозможно, так как эти параметры определяются в Azure и наследуются управляемым экземпляром.

 > [!IMPORTANT]
 > Платформа Azure может изменять требования политики, не уведомляя службы об этих политиках.

**Каковы текущие политики платформы Azure?**

Каждое имя входа должно устанавливать свой пароль при входе в систему и изменять его пароль после достижения максимального срока.

| **Политика** | **Параметр безопасности** |
| --- | --- |
| Максимальный срок действия пароля. | 42 дней |
| Минимальный срок действия пароля. | 1 день |
| Минимальная длина пароля | 10 символов |
| Пароль должен соответствовать требованиям к сложности | Активировано |

**Можно ли отключить сложность и срок действия пароля в SQL Управляемый экземпляр на уровне входа?**

Да, можно управлять CHECK_POLICY и CHECK_EXPIRATION полями на уровне входа. Вы можете проверить текущие параметры, выполнив следующую команду T-SQL:

```sql
SELECT *
FROM sys.sql_logins
```

После этого можно изменить указанные параметры входа, выполнив следующие действия.

```sql
ALTER LOGIN <login_name> WITH CHECK_POLICY = OFF;
ALTER LOGIN <login_name> WITH CHECK_EXPIRATION = OFF;
```

(замените "Test" на требуемое имя для входа и настройте параметры политики и срока действия).

## <a name="azure-feedback-and-support"></a>Отзывы и поддержка Azure

**Где я могу оставить мои идеи для улучшения SQL Управляемый экземпляр?**

Вы можете проголосовать за новую функцию Управляемый экземпляр или создать новую идею улучшения для голосования на [форуме по SQL управляемый экземпляр Feedback](https://feedback.azure.com/forums/915676-sql-managed-instance). Таким образом вы можете участвовать в разработке продукта и помочь нам определить приоритеты наших потенциальных улучшений.

**Как можно создать запрос на поддержку Azure?**

Сведения о том, как создать запрос на поддержку Azure, см. в статье [Создание запроса в службу поддержки Azure](https://docs.microsoft.com/azure/azure-supportability/how-to-create-azure-support-request).

