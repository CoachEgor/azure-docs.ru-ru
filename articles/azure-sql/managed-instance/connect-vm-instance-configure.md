---
title: Настройка подключения к виртуальной машине Azure
titleSuffix: Azure SQL Managed Instance
description: Подключение к Azure SQL Управляемый экземпляр с помощью SQL Server Management Studio из виртуальной машины Azure.
services: sql-database
ms.service: sql-managed-instance
ms.subservice: operations
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: jovanpop-msft
ms.author: jovanpop
ms.reviewer: sstein, carlrab, srbozovi, bonova
ms.date: 02/18/2019
ms.openlocfilehash: e3dc2990e810096310617e468a533a65626008ff
ms.sourcegitcommit: 8def3249f2c216d7b9d96b154eb096640221b6b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2020
ms.locfileid: "87542659"
---
# <a name="quickstart-configure-an-azure-vm-to-connect-to-azure-sql-managed-instance"></a>Краткое руководство. Настройка виртуальной машины Azure для подключения к Azure SQL Управляемый экземпляр
[!INCLUDE[appliesto-sqlmi](../includes/appliesto-sqlmi.md)]

В этом кратком руководстве показано, как настроить виртуальную машину Azure для подключения к Azure SQL Управляемый экземпляр с помощью SQL Server Management Studio (SSMS). 


Краткое руководство, в котором показано, как подключиться к локальному клиентскому компьютеру с помощью подключения типа "точка — сеть", см. в разделе [Настройка подключения типа "точка — сеть](point-to-site-p2s-configure.md)".

## <a name="prerequisites"></a>Обязательные условия

В этом кратком руководстве используются ресурсы, созданные в статье [Создание управляемого экземпляра](instance-create-quickstart.md) в качестве отправной точки.

## <a name="sign-in-to-the-azure-portal"></a>Вход на портал Azure

Войдите на [портал Azure](https://portal.azure.com/).

## <a name="create-a-new-subnet-vnet"></a>Создать новую виртуальную сеть подсети

Следующие шаги создают новую подсеть в виртуальной сети SQL Управляемый экземпляр, чтобы виртуальная машина Azure могла подключаться к управляемому экземпляру. Подсеть SQL Управляемый экземпляр выделена для управляемых экземпляров. Вы не сможете создать в ней какие-либо другие ресурсы, например виртуальные машины Azure.

1. Откройте группу ресурсов для управляемого экземпляра, созданного в кратком руководстве [Создание управляемого экземпляра](instance-create-quickstart.md) . Выберите виртуальную сеть для управляемого экземпляра.

   ![Ресурсы Управляемого экземпляра SQL](./media/connect-vm-instance-configure/resources.png)

2. Выберите **Подсети**, а затем щелкните **+ Подсеть**, чтобы создать новую подсеть.

   ![Подсети Управляемый экземпляр SQL](./media/connect-vm-instance-configure/subnets.png)

3. Заполните форму, используя сведения в этой таблице:

   | Параметр| Рекомендуемое значение | Описание |
   | ---------------- | ----------------- | ----------- |
   | **Name** | Любое допустимое имя|Сведения о допустимых именах см. в статье [Соглашения об именовании](/azure/architecture/best-practices/resource-naming).|
   | **Диапазон адресов (блок CIDR)** | Допустимый диапазон значений | Значение по умолчанию подходит для использования в рамках этого краткого руководства.|
   | **Группа безопасности сети** | None | Значение по умолчанию подходит для использования в рамках этого краткого руководства.|
   | **Таблица маршрутов** | None | Значение по умолчанию подходит для использования в рамках этого краткого руководства.|
   | **Конечные точки службы** | Выбрано: 0 | Значение по умолчанию подходит для использования в рамках этого краткого руководства.|
   | **Делегирование подсети** | None | Значение по умолчанию подходит для использования в рамках этого краткого руководства.|

   ![Новая подсеть SQL Управляемый экземпляр для клиентской виртуальной машины](./media/connect-vm-instance-configure/new-subnet.png)

4. Нажмите кнопку **ОК** , чтобы создать дополнительную подсеть в ВИРТУАЛЬНОЙ сети SQL управляемый экземпляр.

## <a name="create-a-vm-in-the-new-subnet"></a>Создание виртуальной машины в новой подсети 

Ниже описано, как создать виртуальную машину в новой подсети для подключения к SQL Управляемый экземпляр.

## <a name="prepare-the-azure-virtual-machine"></a>Подготовка виртуальной машины Azure

Так как Управляемый экземпляр SQL размещается в частной виртуальной сети, необходимо создать виртуальную машину Azure с установленным клиентским средством SQL, например SQL Server Management Studio или Azure Data Studio. Это средство позволяет подключаться к SQL Управляемый экземпляр и выполнять запросы. В этом кратком руководстве используется SQL Server Management Studio.

Самый простой способ создать виртуальную машину клиента со всеми необходимыми инструментами — использовать шаблоны Azure Resource Manager.

1. Убедитесь, что вы вошли в портал Azure на другой вкладке браузера. Затем нажмите следующую кнопку, чтобы создать клиентскую виртуальную машину и установить SQL Server Management Studio:

   [![Изображение, показывающее кнопку "развернуть в Azure".](https://azuredeploy.net/deploybutton.png)](https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fjovanpop-msft%2Fazure-quickstart-templates%2Fsql-win-vm-w-tools%2F201-vm-win-vnet-sql-tools%2Fazuredeploy.json)

2. Заполните форму, используя сведения из следующей таблицы:

   | Параметр| Рекомендуемое значение | Описание |
   | ---------------- | ----------------- | ----------- |
   | **Подписка** | Допустимая подписка | Необходимо использовать подписку, в которой есть разрешение на создание ресурсов. |
   | **Группа ресурсов** |Группа ресурсов, указанная в кратком руководстве по [созданию управляемый экземпляр SQL](instance-create-quickstart.md)|Необходимо использовать группу ресурсов, в которой находится виртуальная сеть.|
   | **Расположение** | Расположение группы ресурсов | Это значение заполняется на основе выбранной группы ресурсов. |
   | **Имя виртуальной машины**  | Любое допустимое имя | Сведения о допустимых именах см. в статье [Соглашения об именовании](/azure/architecture/best-practices/resource-naming).|
   |**Имя пользователя администратора**|Любое допустимое имя пользователя|Сведения о допустимых именах см. в статье [Соглашения об именовании](/azure/architecture/best-practices/resource-naming). Не используйте serveradmin. Это имя зарезервировано для роли уровня сервера.<br>Используйте это имя пользователя каждый раз при [подключении к виртуальной машине](#connect-to-the-virtual-machine).|
   |**Пароль**|Любой допустимый пароль|Пароль должен включать минимум 12 символов и соответствовать [определенным требованиям к сложности](../../virtual-machines/windows/faq.md#what-are-the-password-requirements-when-creating-a-vm).<br>Используйте этот пароль каждый раз при [подключении к виртуальной машине](#connect-to-the-virtual-machine).|
   | **Размер виртуальной машины** | Любой допустимый размер | Размера по умолчанию в этом шаблоне **Standard_B2s** достаточно для работы с этим руководством. |
   | **Расположение**|[resourceGroup().location].| Не меняйте это значение. |
   | **имя виртуальной сети;**|Виртуальная сеть, в которой был создан управляемый экземпляр|
   | **Имя подсети**|Имя подсети, созданной при выполнении предыдущей процедуры| Не выбирайте подсеть, в которой был создан управляемый экземпляр.|
   | **Расположение артефактов** | [deployment().properties.templateLink.uri] | Не меняйте это значение. |
   | **маркер SAS расположения артефактов** | Не указывайте | Не меняйте это значение. |

   ![создание виртуальной машины клиента](./media/connect-vm-instance-configure/create-client-sql-vm.png)

   Если вы использовали предлагаемое имя виртуальной сети и подсеть по умолчанию при [создании управляемый экземпляр SQL](instance-create-quickstart.md), вам не нужно изменять последние два параметра. В противном случае следует заменить эти значения на те, которые вы ввели при настройке сетевой среды.

3. Установите флажок **Я принимаю указанные выше условия**.
4. Выберите **Приобрести**, чтобы развернуть виртуальную машину Azure в вашей сети.
5. Щелкните значок **Уведомления**, чтобы просмотреть состояние развертывания.

> [!IMPORTANT]
> После создания виртуальной машины подождите примерно 15 минут, прежде чем продолжить. Это время требуется, чтобы завершить установку SQL Server Management Studio с помощью скриптов, запускаемых после создания виртуальной машины.

## <a name="connect-to-the-virtual-machine"></a>Подключитесь к виртуальной машине

Ниже описано, как подключиться к созданной виртуальной машине с помощью подключения удаленный рабочий стол.

1. После завершения развертывания перейдите в ресурс виртуальной машины.

    ![ВМ](./media/connect-vm-instance-configure/vm.png)  

2. Нажмите кнопку **Подключиться**.

   Для виртуальной машины отобразится форма файла протокола удаленного рабочего стола (RDP-файл), а также общедоступный IP-адрес и номер порта.

   ![Форма RDP](./media/connect-vm-instance-configure/rdp.png)  

3. Щелкните **Скачать RDP-файл**.

   > [!NOTE]
   > Вы также можете подключаться к виртуальной машине по протоколу SSH.

4. Закройте форму **Connect to virtual machine** (Подключение к виртуальной машине).
5. Чтобы подключиться к виртуальной машине, откройте скачанный RDP-файл.
6. При появлении запроса выберите **Подключиться**. На компьютере Mac необходим клиент RDP, такой как [Удаленный рабочий стол клиент](https://apps.apple.com/app/microsoft-remote-desktop-10/id1295203466?mt=12) из Mac App Store.

7. Введите имя пользователя и пароль, указанные при создании виртуальной машины, а затем нажмите кнопку **ОК**.

8. При входе в систему может появиться предупреждение о сертификате. Чтобы продолжить процесс подключения, выберите **Да** или **Продолжить**.

Вы подключились к виртуальной машине на панели мониторинга диспетчера сервера.

## <a name="connect-to-sql-managed-instance"></a>Подключение к Управляемому экземпляру SQL 

1. На виртуальной машине откройте SQL Server Management Studio.

   Открытие займет несколько секунд, так как оно должно завершить свою конфигурацию, так как это первое время запуска SSMS.
2. В диалоговом окне **соединение с сервером** введите полное **имя узла** для управляемого экземпляра в поле **имя сервера** . Выберите **Проверка подлинности SQL Server**, укажите имя пользователя и пароль, а затем нажмите кнопку **Подключиться**.

    ![Подключение SSMS](./media/connect-vm-instance-configure/ssms-connect.png)  

После подключения можно просмотреть системные и пользовательские базы данных на узле "Базы данных" и различные объекты на узлах "Безопасность", "Объекты сервера", "Репликация", "Управление", "Агент SQL Server" и "Профилировщик XEvent".

## <a name="next-steps"></a>Следующие шаги

- Краткое руководство, в котором показано, как подключиться к локальному клиентскому компьютеру с помощью подключения типа "точка — сеть", см. в разделе [Настройка подключения типа "точка](point-to-site-p2s-configure.md)— сеть".
- Обзор вариантов подключения для приложений см. в статье [Подключение приложений к Управляемому экземпляру SQL](connect-application-instance.md).
- Чтобы восстановить существующую SQL Server базу данных из локальной среды в управляемый экземпляр, можно использовать [Azure Database Migration Service для миграции](../../dms/tutorial-sql-server-to-managed-instance.md) или [команду T-SQL RESTORE](restore-sample-database-quickstart.md) для восстановления из файла резервной копии базы данных.
