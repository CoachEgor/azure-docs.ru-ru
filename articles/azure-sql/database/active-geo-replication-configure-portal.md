---
title: Учебник. Георепликация & отработку отказа на портале
description: Настройте георепликацию для базы данных с помощью портал Azure и инициации отработки отказа.
services: sql-database
ms.service: sql-database
ms.subservice: high-availability
ms.custom: sqldbrb=1
ms.devlang: ''
ms.topic: conceptual
author: anosov1960
ms.author: sashan
ms.reviewer: mathoma, sstein
ms.date: 02/13/2019
ms.openlocfilehash: cf7e4da2051ab84cebff5aae857c02907f7b58e0
ms.sourcegitcommit: 32c521a2ef396d121e71ba682e098092ac673b30
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/25/2020
ms.locfileid: "91263629"
---
# <a name="tutorial-configure-active-geo-replication-and-failover-in-the-azure-portal-azure-sql-database"></a>Руководство. Настройка активной георепликации и отработки отказа в портал Azure (база данных SQL Azure)

[!INCLUDE[appliesto-sqldb](../includes/appliesto-sqldb.md)]

В этой статье показано, как настроить [активную георепликацию для базы данных SQL Azure](active-geo-replication-overview.md#active-geo-replication-terminology-and-capabilities) с помощью [портал Azure](https://portal.azure.com) и инициировать отработку отказа.

Рекомендации по использованию групп автоматической отработки отказов см. в статье рекомендации по работе с [базой данных SQL](auto-failover-group-overview.md#best-practices-for-sql-database) Azure и рекомендации [по использованию управляемый экземпляр Azure SQL](auto-failover-group-overview.md#best-practices-for-sql-managed-instance). 



## <a name="prerequisites"></a>Предварительные требования

Для настройки активной георепликации с помощью портала Azure необходим приведенный ниже ресурс.

* База данных в базе данных SQL Azure: база данных-источник, которую необходимо реплицировать в другой географический регион.

> [!Note]
> При использовании портала Azure можно создать только базу данных-получатель в той же подписке, где и основная база данных. Если база данных-получатель должна находиться в другой подписке, используйте API [создания базы данных REST API](https://docs.microsoft.com/rest/api/sql/databases/createorupdate) или [ALTER DATABASE Transact-SQL](https://docs.microsoft.com/sql/t-sql/statements/alter-database-transact-sql).

## <a name="add-a-secondary-database"></a>Добавление базы данных-получателя

Следующие действия позволяют создать новую базу данных-получателя в связи георепликации.  

Добавить базу данных-получатель может только владелец или совладелец подписки.

Базе данных-получателю присваивается такое же имя, как у базы данных-источника, и по умолчанию тот же уровень служб и объем вычислительных ресурсов. База данных-получатель может быть отдельной базой данных или базой данных в пуле. См. подробнее о моделях приобретения на основе [единиц DTU](service-tiers-dtu.md) и [виртуальных ядер](service-tiers-vcore.md).
После создания и заполнения базы данных-получателя начинается репликация данных из базы данных-источника в новую базу данных-получателя.

> [!NOTE]
> Если база данных-партнер уже создана (например, в результате прекращения предыдущей связи георепликации), выполнение команды завершится сбоем.

1. В [портал Azure](https://portal.azure.com)перейдите к базе данных, которую необходимо настроить для георепликации.
2. На странице База данных SQL выберите **Георепликация**, а затем выберите регион для создания базы данных-получателя. Можно выбрать любой регион, кроме региона, в котором размещена база данных-источник, но рекомендуется выбрать [сопряженный регион](../../best-practices-availability-paired-regions.md).

    ![Настройка георепликации](./media/active-geo-replication-configure-portal/configure-geo-replication.png)
3. Выберите или настройте сервер и ценовую категорию для базы данных-получателя.

    ![создать вторичную форму](./media/active-geo-replication-configure-portal/create-secondary.png)
4. По желанию добавьте базу данных-получатель в пул эластичных баз данных. Чтобы создать базу данных-получатель, щелкните **Пул эластичных БД** и выберите пул на целевом сервере. Пул должен быть создан на целевом сервере заранее. Этот рабочий процесс не создает пул.
5. Щелкните **Создать** , чтобы добавить базу данных-получатель.
6. После создания базы данных-получателя начнется процесс заполнения.

    ![Схема вторичной реплики](./media/active-geo-replication-configure-portal/seeding0.png)
7. Как только процесс заполнения будет закончен, отобразится состояние базы данных-получателя.

    ![Заполнение завершено](./media/active-geo-replication-configure-portal/seeding-complete.png)

## <a name="initiate-a-failover"></a>Запуск отработки отказа

Базу данных-получатель можно сделать источником.  

1. В [портал Azure](https://portal.azure.com)перейдите к базе данных-источнику в партнерстве георепликации.
2. В колонке база данных SQL выберите **все параметры**  >  **Георепликация**.
3. В списке Получатели выберите базу данных, которую необходимо сделать новой первичной **репликой** , и щелкните **Принудительная отработка отказа**.

    ![отработка отказа](./media/active-geo-replication-configure-portal/secondaries.png)
4. Выберите **Да** , чтобы запустить отработку отказа.

Команда немедленно переключит базу данных-получатель на роль базы данных-источника. Обычно этот процесс должен завершаться в течение 30 секунд или менее.

В течение короткого периода (от 0 до 25 секунд), пока переключаются роли, обе базы данных будут недоступны. Если база данных-источник имеет несколько баз данных-получателей, то команда автоматически перенастроит другие базы данных-получатели для подключения к новой базе данных-источнику. Обычно вся операция занимает меньше минуты.

> [!NOTE]
> Эта команда предназначена для быстрого восстановления базы данных в случае сбоя. Она активирует отработку отказа без синхронизации данных (принудительная отработка отказа).  Если при отправке команды источник находится в сети и выполняет транзакции, некоторые данные могут быть утеряны.

## <a name="remove-secondary-database"></a>Удаление базы данных-получателя

Данная операция безвозвратно отменяет репликацию в базу данных-получатель и превращает ее в обычную базу данных для чтения и записи. Если подключение к базе данных-получателю прервется, команда будет выполнена, но после восстановления связи база данных-получатель не станет доступной для чтения и записи.  

1. В [портал Azure](https://portal.azure.com)перейдите к базе данных-источнику в партнерстве георепликации.
2. На странице База данных SQL выберите **Георепликация**.
3. В списке **получатели** выберите базу данных, которую необходимо удалить из партнерства георепликации.
4. Щелкните **Остановить репликацию**.

    ![Удаление базы данных-получателя](./media/active-geo-replication-configure-portal/remove-secondary.png)
5. Откроется окно подтверждения. Нажмите кнопку **Да**, чтобы удалить базу данных из партнерства георепликации (и сделать ее доступной для чтения и записи и не используемой в репликации).

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения об активной георепликации см. в разделе [Активная Георепликация](active-geo-replication-overview.md).
* Сведения о группах автоматической отработки отказа см. в [этой статье](auto-failover-group-overview.md).
* Общие сведения о непрерывности бизнес-процессов и сценарии см. в статье [Обзор непрерывности бизнес-процессов](business-continuity-high-availability-disaster-recover-hadr-overview.md).
