---
title: Разрешение различий T-SQL — миграция
description: Инструкции Transact-SQL, которые меньше, чем полностью поддерживаются в базе данных SQL Azure.
services: sql-database
ms.service: sql-database
ms.subservice: single-database
ms.custom: sqldbrb=1
ms.devlang: ''
ms.topic: reference
author: stevestein
ms.author: sstein
ms.reviewer: ''
ms.date: 12/03/2018
ms.openlocfilehash: 02b589eebb716f5a69b4db9f00faf12401b8de7f
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "91619012"
---
# <a name="resolving-transact-sql-differences-during-migration-to-sql-database"></a>Отличия Transact-SQL базы данных SQL Azure

При [переносе базы данных](migrate-to-database-from-sql-server.md) из SQL Server в базу данных SQL Azure, возможно, вы обнаружите, что перед переносом базы данных SQL Server требуется выполнить определенное повторное проектирование. В этой статье содержатся рекомендации, которые помогут выполнить переработку и понять основные причины ее необходимости. Чтобы обнаружить проблемы с совместимостью, используйте [Data Migration Assistant (DMA)](https://www.microsoft.com/download/details.aspx?id=53595).

## <a name="overview"></a>Обзор

Большинство функций Transact-SQL, используемых приложениями, полностью поддерживаются как в Microsoft SQL Server, так и в Базе данных SQL Azure. Например, основные компоненты SQL, такие как типы данных, операторы, строковые, арифметические, логические и функции работы с курсорами, работают идентично в SQL Server и базе данных SQL. Но существует несколько различий T-SQL между элементами DDL (языка определения данных) и элементами DML (языка манипулирования данными), использование которых приводит к формированию частично поддерживаемых инструкций и запросов T-SQL (будет рассматриваться далее в этой статье).

Кроме того, существуют некоторые функции и синтаксис, которые не поддерживаются, так как база данных SQL Azure разработана для изоляции компонентов от зависимостей в базе данных master и операционной системе. Поэтому многие действия на уровне сервера не подходят для базы данных SQL. Инструкции и параметры T-SQL недоступны, если они позволяют настроить параметры серверного уровня, компоненты операционной системы или указать конфигурацию файловой системы. Если требуются такие возможности, их часто можно заменить соответствующими альтернативами, доступными в базе данных SQL или другой службе (компоненте) Azure.

Например, высокий уровень доступности встроен в Базу данных SQL Azure с помощью технологии, аналогичной [группам доступности AlwaysOn](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/always-on-availability-groups-sql-server). По этой причине в Базе данных SQL не поддерживаются все инструкции T-SQL, связанные с группами доступности, и динамические административные представления, связанные с группами доступности AlwaysOn.

Список поддерживаемых и неподдерживаемых в базе данных SQL функций см. в статье  [Сравнение функций Базы данных SQL Azure и SQL Server](features-comparison.md). Список на этой странице дополняет сведения в статье с рекомендациями и функциями и содержит перечень инструкций Transact-SQL.

## <a name="transact-sql-syntax-statements-with-partial-differences"></a>Инструкции синтаксиса Transact-SQL с частичными различиями

Основные инструкции DDL (язык определения данных) доступны, но некоторые инструкции DDL имеют расширения, связанные с размещением на диске, и неподдерживаемые функции.

- У инструкций CREATE и ALTER DATABASE есть три десятка параметров. Эти инструкции включают параметры размещения файлов, FILESTREAM и компонента Service Broker, которые применяются только к SQL Server. Это может не быть важно, если вы создаете базы данных перед миграцией, но при переносе кода T-SQL, создающего базы данных, необходимо сравнить инструкцию [Create Database (база данных SQL Azure)](https://msdn.microsoft.com/library/dn268335.aspx) с синтаксисом SQL Server в [инструкции create database (SQL Server Transact-SQL)](https://msdn.microsoft.com/library/ms176061.aspx) , чтобы убедиться в том, что все используемые параметры поддерживаются. CREATE DATABASE для Базы данных SQL Azure также располагает параметрами для цели службы и параметрами эластичного масштабирования, которые применяются только к базе данных SQL.
- Инструкции CREATE и ALTER TABLE имеют параметры FileTable, которые нельзя использовать в базе данных SQL, так как FILESTREAM не поддерживается.
- Инструкции CREATE и ALTER LOGIN поддерживаются, но база данных SQL не поддерживает все параметры. Чтобы сделать базу данных более переносимой, база данных SQL рекомендует по возможности вместо имен входа использовать пользователей автономной базы данных. Дополнительные сведения см. в статьях [Создание и изменение имени входа](https://docs.microsoft.com/sql/t-sql/statements/alter-login-transact-sql) и [Управление именами входа и пользователями](logins-create-manage.md).

## <a name="transact-sql-syntax-not-supported-in-azure-sql-database"></a>Синтаксис Transact-SQL, не поддерживаемый в Базе данных SQL Azure

В дополнение к инструкциям Transact-SQL, относящимся к неподдерживаемым функциям, описанным в статье [Сравнение функций базы данных SQL Azure](features-comparison.md), следующие инструкции и группы инструкций не поддерживаются. Таким образом, если база данных, которую нужно перенести, использует любую их следующих функций или компонентов, перестройте T-SQL для исключения этих функций и инструкций T-SQL.

- Параметры сортировки системных объектов
- Связанные с подключением: инструкции ENDPOINT. База данных SQL не поддерживает проверку подлинности Windows, но поддерживает такую же проверку подлинности Azure Active Directory. Для некоторых типов аутентификации требуется последняя версия SSMS. Дополнительные сведения см. в статье [Подключение к базе данных SQL или Azure синапсе Analytics (ранее — хранилище данных SQL) с использованием проверки Подлинности Azure Active Directory](authentication-aad-overview.md).
- Межбазовые запросы с помощью имен из трех или четырех частей. (Межбазовые запросы только для чтения поддерживаются с помощью [запроса к эластичной базе данных](elastic-query-overview.md).)
- Межбазовые цепочки владения, параметр `TRUSTWORTHY`.
- `EXECUTE AS LOGIN` (вместо него следует использовать EXECUTE AS USER).
- Шифрование не поддерживается, за исключением расширенного управления ключами.
- Отправка событий: события, уведомления о событиях, уведомления о запросах.
- Размещение файла : синтаксис, связанный с размещением файла базы данных и его размером, и файлы базы данных, которые автоматически управляются Microsoft Azure.
- Высокая доступность: синтаксис, связанный с обеспечением высокой доступности, для управления которым используется учетная запись Microsoft Azure. Например, синтаксис, используемый для резервного копирования, восстановления, AlwaysOn, зеркального отображения базы данных, доставки журналов и режимов восстановления.
- Читатель журнала: синтаксис, который зависит от средства чтения журнала, недоступного в базе данных SQL: принудительная репликация, отслеживание измененных данных. База данных SQL может выступать подписчиком принудительной репликации.
- Функции: `fn_get_sql`, `fn_virtualfilestats`, `fn_virtualservernodes`.
- Оборудование: синтаксис, относящийся к параметрам сервера, связанного с оборудованием — память, рабочие потоки, фиксирование потоков на ЦП, флаги трассировки и т. д. Вместо этого укажите уровни служб и объемы вычислительных ресурсов.
- `KILL STATS JOB`
- `OPENQUERY`, `OPENROWSET`, `OPENDATASOURCE` и четырехкомпонентные имена.
- .NET Framework: интеграция SQL Server со средой CLR.
- Семантический поиск
- Учетные данные сервера: вместо них используйте [учетные данные для базы данных](https://msdn.microsoft.com/library/mt270260.aspx).
- Элементы серверного уровня: роли сервера, `sys.login_token`. `GRANT``REVOKE` `DENY` разрешения уровня сервера, и не доступны, хотя некоторые из них заменяются разрешениями уровня базы данных. Некоторые полезные динамические административные представления серверного уровня имеют эквивалентные динамические административные представления уровня базы данных.
- `SET REMOTE_PROC_TRANSACTIONS`
- `SHUTDOWN`
- `sp_addmessage`
- Параметры `sp_configure` и инструкция `RECONFIGURE`. Некоторые параметры доступны в инструкции [ALTER DATABASE SCOPED CONFIGURATION](https://msdn.microsoft.com/library/mt629158.aspx).
- `sp_helpuser`
- `sp_migrate_user_to_contained`
- Агент SQL Server: синтаксис, который зависит от агента SQL Server или базы данных MSDB — оповещения, операторы, центральные серверы управления. Вместо этого используйте скрипты, например Azure PowerShell.
- Подсистема аудита SQL Server: вместо нее следует использовать аудит базы данных SQL.
- Трассировка SQL Server
- Флаги трассировки: некоторые элементы флагов трассировки были перемещены в режимы совместимости.
- Отладка Transact-SQL
- Триггеры: уровня сервера или триггеры входа
- Инструкция `USE`. Чтобы изменить контекст базы данных на другую базу данных, необходимо создать подключение к новой базе данных.

## <a name="full-transact-sql-reference"></a>Полный справочник по Transact-SQL

Дополнительные сведения о грамматике, использовании и примерах Transact-SQL см. в разделе [Справочник по Transact-SQL (ядро СУБД)](https://msdn.microsoft.com/library/bb510741.aspx)   в Электронная документация на SQL Server.

### <a name="about-the-applies-to-tags"></a>Сведения о тегах "Относится к"

Справочник по Transact-SQL включает в себя статьи, относящиеся к версиям SQL Server с 2008 по текущую. Под заголовком статьи есть панель значков, в которой перечислены четыре SQL Server платформы и показано, как применимо. Например, группы доступности появились в SQL Server 2012. В статье [Создание группы доступности](https://msdn.microsoft.com/library/ff878399.aspx)   указано, что инструкция применяется к **SQL Server (начиная с 2012)**. Инструкция не применяется к SQL Server 2008, SQL Server 2008 R2, базе данных SQL Azure, Azure синапсе Analytics (ранее — хранилище данных SQL) или Parallel Data Warehouse.

В некоторых случаях в продукте можно использовать общую тему статьи, но существуют небольшие различия между продуктами. Эти различия отмечаются по мере изложения материала. В некоторых случаях в продукте можно использовать общую тему статьи, но существуют небольшие различия между продуктами. Эти различия отмечаются по мере изложения материала. Например, статья создание ТРИГГЕРа доступна в базе данных SQL. Но параметр « **все серверы** » для триггеров уровня сервера указывает, что триггеры уровня сервера нельзя использовать в базе данных SQL. Вместо них следует использовать триггеры уровня базы данных.

## <a name="next-steps"></a>Дальнейшие шаги

Список поддерживаемых и неподдерживаемых в базе данных SQL функций см. в статье  [Сравнение функций Базы данных SQL Azure и SQL Server](features-comparison.md). Список на этой странице дополняет сведения в статье с рекомендациями и функциями и содержит перечень инструкций Transact-SQL.
