---
title: Анализ затрат и бюджет
description: Узнайте, как провести анализ затрат и сформировать бюджет для базовых вычислительных ресурсов и лицензий на программное обеспечение, используемых для запуска рабочих нагрузок пакетной службы.
ms.topic: how-to
ms.date: 07/19/2019
ms.openlocfilehash: 13c8cc508a4940b5e21570104527c40988879919
ms.sourcegitcommit: 6fd8dbeee587fd7633571dfea46424f3c7e65169
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/21/2020
ms.locfileid: "83725777"
---
# <a name="cost-analysis-and-budgets-for-azure-batch"></a>Анализ затрат и бюджеты для пакетной службы Azure

Сама пакетная служба Azure бесплатна. Оплачиваются только базовые вычислительные ресурсы и лицензии на программное обеспечение, используемые для запуска рабочих нагрузок пакетной службы. В целом общая плата складывается из стоимости виртуальных машин в пуле, стоимости передачи данных из виртуальной машины, а также стоимости хранения всех входных или выходных данных в облаке. Давайте рассмотрим некоторые ключевые компоненты пакетной службы, чтобы понять, откуда берутся затраты и как сформировать бюджет для пула или учетной записи. Также рассмотрим ряд способов, которые позволят сделать рабочие нагрузки пакетной службы более экономически эффективными.

## <a name="batch-resources"></a>Ресурсы пакетной службы

Виртуальные машины — наиболее важный ресурс, используемый для пакетной обработки. Стоимость использования виртуальных машин в пакетной службе вычисляется исходя из типа ВМ, их количества и продолжительности использования. Для оплаты виртуальных машин доступны такие варианты, как [оплата по мере использования](https://azure.microsoft.com/offers/ms-azr-0003p/) и [резервирование](../cost-management-billing/reservations/save-compute-costs-reservations.md) (предварительная оплата). Оба варианта оплаты имеют разные преимущества в зависимости от используемой вычислительной рабочей нагрузки и по-разному влияют на сумму счета.

При развертывании приложений на узлах пакетной службы (ВМ) с помощью [пакетов приложений](batch-application-packages.md) также взимается плата за ресурсы службы хранилища Azure, используемые пакетами приложений. Кроме того, взимается плата за хранение всех файлов с входными или выходными данными, например файлов ресурсов и данных журналов. Как правило, стоимость хранения данных, связанных с пакетной службой, значительно ниже, чем стоимость вычислительных ресурсов. У каждой виртуальной машины в пуле, созданной с помощью **VirtualMachineConfiguration**, имеется диск операционной системы, в свою очередь использующий диски, управляемые службой Azure. Диски, управляемые Azure, также оплачиваются, и каждому уровню производительности диска соответствует свой ценовой уровень.

Пулы пакетной службы используют сетевые ресурсы. В частности, для пулов **VirtualMachineConfiguration** используются стандартные подсистемы балансировки нагрузки, для которых требуются статические IP-адреса. Подсистемы балансировки нагрузки, используемые пакетной службой, доступны для учетных записей **пользовательской подписки**, но не доступны для учетных записей **пакетной службы**. При использовании стандартных подсистем балансировки нагрузки плата взимается за все данные, передаваемые в виртуальные машины пула пакетной службы или из них. Кроме того, взимается плата за API пакетной службы, которые получают данные из узлов пула (например, получают файл задачи или узла); взимается плата за пакеты приложений задач, файлы ресурсов и файлы с выходными данными, а также образы контейнеров.

### <a name="additional-services"></a>Дополнительные службы

В ваши затраты на учетную запись пакетной службы также могут добавляться затраты на службы, не связанные с виртуальными машинами и хранением данных.

Другие службы, обычно используемые вместе с пакетной службой:

- Application Insights
- Фабрика данных
- Azure Monitor
- Виртуальная сеть
- Виртуальные машины с графическими приложениями

С вас может взиматься дополнительная плата в зависимости от того, какими службами вы пользуетесь в рамках решения с пакетной службой. Для расчета стоимости каждой дополнительной службы воспользуйтесь [калькулятором цен](https://azure.microsoft.com/pricing/calculator/).

## <a name="cost-analysis-and-budget-for-a-pool"></a>Анализ затрат и бюджет для пула

С помощью портала Azure вы можете формировать бюджеты и создавать оповещения о затратах для пулов или учетной записи пакетной службы. Эти бюджеты и оповещения можно использовать для того, чтобы уведомлять всех заинтересованных лиц о рисках перерасхода средств. Может возникнуть ситуация, когда при отправке оповещения о затратах возникла задержка и из-за этого произошел небольшой выход за рамки бюджета. В следующем примере мы рассмотрим анализ затрат для отдельного пула пакетной службы.

1. На портале Azure выберите **Управление затратами и выставление счетов** на панели навигации слева.
1. Выбор подписки в разделе **Мои подписки**
1. Перейдите в раздел **Анализ затрат** в области **Управление затратами** на панели навигации слева. Отобразится вид, показанный ниже:
1. Выберите **Добавить фильтр**. В первом раскрывающемся списке выберите **Ресурс**. ![Выбор фильтра ресурсов](./media/batch-budget/resource-filter.png)
1. Во втором раскрывающемся списке выберите пул пакетной службы. При выборе пула анализ затрат будет выглядеть примерно так, как показано ниже.
    ![Анализ затрат для пула](./media/batch-budget/pool-cost-analysis.png)

После проведения анализа затрат отображается стоимость пула и список ресурсов, влияющих на эту стоимость. В данном примере виртуальные машины, используемые в пуле, являются наиболее дорогостоящим ресурсом.

Чтобы создать бюджет для пула, выберите **Бюджет: нет**, затем выберите **Создать бюджет >** . Теперь в окне настройте параметры бюджета конкретно для вашего пула.

Дополнительные сведения о настройке параметров бюджета см. в разделе [Создание бюджетов Azure и управление ими](../cost-management-billing/costs/tutorial-acm-create-budgets.md).

> [!NOTE]
> Пакетная служба Azure основана на технологии виртуальных машин Azure и облачных служб Azure. При выборе режима **Конфигурация облачных служб** плата взимается в зависимости от структуры цен на облачные службы. При выборе режима **Конфигурация виртуальной машины** плата взимается в зависимости от структуры цен на виртуальные машины. В примере на этой странице используется режим **Конфигурация виртуальной машины**.

## <a name="minimize-cost"></a>Сокращение затрат

Использование нескольких виртуальных машин и служб Azure в течение продолжительного периода времени может оказаться дорогостоящей процедурой. К счастью, существуют службы, помогающие снизить затраты. Также существуют стратегии, позволяющие увеличить эффективность рабочей нагрузки.

### <a name="low-priority-virtual-machines"></a>Низкоприоритетные виртуальные машины

При использовании низкоприоритетных виртуальных машин снижаются затраты на рабочие нагрузки пакетной службы, так как для ВМ такого типа задействуются избыточные вычислительные ресурсы Azure. Если в пулах вы указали низкоприоритетные виртуальные машины, пакетная служба использует для запуска рабочей нагрузки избыточные вычислительные ресурсы. При использовании низкоприоритетных виртуальных машин вместо выделенных можно значительно сократить расходы.

Дополнительные сведения о настройке низкоприоритетных виртуальных машин для рабочей нагрузки см. в разделе [Использование низкоприоритетных виртуальных машин в пакетной службе](batch-low-pri-vms.md).

### <a name="virtual-machine-os-disk-type"></a>Тип системного диска для виртуальной машины

Есть различные [типы дисков ОС для виртуальных машин](../virtual-machines/windows/disks-types.md). Большинство серий виртуальных машин имеют размеры, позволяющие использовать хранилища категории "Премиум" и "Стандарт". Если для пула выбран размер виртуальной машины типа "s", пакетная служба настраивает для виртуальной машины SSD-диск категории "Премиум" в качестве диска ОС. Если выбирается размер виртуальной машины, отличный от "s", используется более дешевый тип диска (стандартный жесткий диск). Например, SSD-диски ОС категории "Премиум" используются для `Standard_D2s_v3`, а стандартные жесткие диски ОС используются для `Standard_D2_v3`.

SSD-диски ОС ценовой категории "Премиум" более дорогие, но имеют более высокую производительность, и виртуальные машины с дисками этой категории могут запускаться быстрее, чем виртуальные машины со стандартными жесткими дисками ОС. При использовании пакетной службы диск ОС не используется слишком часто, так как приложения и файлы задач расположены на временных SSD-дисках виртуальных машин. Поэтому во многих случаях нет необходимости платить повышенную цену за SSD-диск категории "Премиум", который подготавливается в том случае, когда указан размер виртуальной машины типа "s".

### <a name="reserved-virtual-machine-instances"></a>Зарезервированные экземпляры виртуальной машины

Если вы планируете использовать пакетную службу в течение длительного периода времени, вы можете сэкономить на стоимости виртуальных машин, используя [резервирования Azure](../cost-management-billing/reservations/save-compute-costs-reservations.md) для рабочих нагрузок. Тарифы резервирования значительно ниже, чем тарифы при оплате по мере использования. Экземпляры виртуальных машин, используемые без резервирования, оплачиваются по мере их использования. Если вы приобретаете вариант с резервированием, применяется скидка на резервирование и к вам больше не применяется схема "оплата по мере использования".

### <a name="automatic-scaling"></a>Автоматическое масштабирование

[Автоматическое масштабирование](batch-automatic-scaling.md) позволяет динамически изменять количество виртуальных машин в пуле пакетной службы в зависимости от потребностей текущего задания. Когда масштабирование пула осуществляется исходя из времени существования задания, автоматическое масштабирование гарантирует, что масштаб виртуальных машин будет вертикально увеличен и они будут использоваться только при выполнении задания. Когда задания завершены или отсутствуют, масштаб виртуальных машин будет вертикально уменьшен для сохранения вычислительных ресурсов. Масштабирование позволяет снизить общую стоимость решения пакетной службы за счет использования только необходимых ресурсов.

Подробные сведения об автоматическом масштабировании см. в разделе [Автоматическое масштабирование вычислительных узлов в пуле пакетной службы Azure](batch-automatic-scaling.md).

## <a name="next-steps"></a>Дальнейшие действия

- См. дополнительные сведения об [API-интерфейсах и средствах пакетной службы](batch-apis-tools.md) для сборки и мониторинга решений пакетной службы.  

- Узнайте больше о [низкоприоритетных виртуальных машинах в пакетной службе](batch-low-pri-vms.md).
