---
title: Создание и использование файлов ресурсов - Azure Batch
description: Узнайте, как создавать файлы ресурсов Пакета из различных источников ввода. В этой статье рассматриваются несколько распространенных методов создания и размещения их на VM.
services: batch
author: LauraBrenner
manager: evansma
ms.service: batch
ms.topic: article
ms.date: 03/18/2020
ms.author: labrenne
ms.openlocfilehash: 0fe859ac30e7b8050d1f4688d7cf106a465e7566
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79531147"
---
# <a name="creating-and-using-resource-files"></a>Создание и использование файлов ресурсов

Задача Azure Batch часто требует той или иной формы данных для обработки. Файлы ресурсов — это способ предоставления этих данных виртуальной машине пакета (VM) с помощью задачи. Все типы задач поддерживают файлы ресурсов: задачи, задачи, задачи запуска, задачи по подготовке заданий, задачи по освобождению заданий и т.д. В этой статье рассматриваются несколько распространенных методов создания файлов ресурсов и размещения их на VM.  

Файлы ресурсов помещают данные на VM в пакете, но тип данных и способ их использования гибки. Есть, однако, некоторые распространенные случаи использования:

1. Предоставление общих файлов на каждом VM с использованием файлов ресурсов в задаче запуска
1. Данные ввода положения, обрабатываемые задачами

Общие файлы могут быть, например, файлами на задаче запуска, используемых для установки приложений, которые выполняются задачами. Входные данные могут быть необработанными изображениями или видеоданными или любой информацией, которая будет обработана Batch.

## <a name="types-of-resource-files"></a>Типы файлов ресурсов

Существует несколько различных вариантов для генерации файлов ресурсов. Процесс создания файлов ресурсов варьируется в зависимости от того, где хранятся исходные данные.

Параметры создания файла ресурса:

- [URL-адрес контейнера хранения:](#storage-container-url)Генерирует файл ресурсов из любого контейнера хранения в Azure
- [Имя контейнера хранения:](#storage-container-name)Генерирует файл ресурса из имени контейнера в учетной записи хранения Azure, связанной с Batch
- [Конечная точка Web](#web-endpoint): Генерирует файл ресурса из любого действительного URL HTTP

### <a name="storage-container-url"></a>URL-адрес контейнера для хранения

Использование URL-адреса контейнера хранения с правильными разрешениями позволяет получить доступ к файлам в любом контейнере хранения в Azure. 

В этом примере файлы уже загружены в контейнер для хранения Azure в качестве хранилища кабов. Для доступа к данным, необходимым для создания файла ресурсов, нам сначала необходимо получить доступ к контейнеру для хранения.

Создайте общую подпись доступа (SAS) URI с правильными разрешениями на доступ к контейнеру для хранения. Установите время истечения срока действия и разрешения для SAS. В этом случае время начала не указывается, поэтому SAS становится действительным немедленно и истекает через два часа после его сгенера.

```csharp
SharedAccessBlobPolicy sasConstraints = new SharedAccessBlobPolicy
{
    SharedAccessExpiryTime = DateTime.UtcNow.AddHours(2),
    Permissions = SharedAccessBlobPermissions.Read | SharedAccessBlobPermissions.List
};
```

> [!NOTE]
> Для доступа к контейнерам необходимо иметь как `Read` разрешение, так и разрешения, в `List` то время как при доступе к blob требуется `Read` только разрешение.

После настройки разрешений создайте маркер SAS и отформатите URL SAS для доступа к контейнеру для хранения. Используя отформатированный URL SAS для контейнера [`FromStorageContainerUrl`](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.resourcefile.fromstoragecontainerurl?view=azure-dotnet)для хранения, создайте файл ресурсов с помощью.

```csharp
CloudBlobContainer container = blobClient.GetContainerReference(containerName);

string sasToken = container.GetSharedAccessSignature(sasConstraints);
string containerSasUrl = String.Format("{0}{1}", container.Uri, sasToken);

ResourceFile inputFile = ResourceFile.FromStorageContainerUrl(containerSasUrl);
```

Альтернативой генерации URL-адреса SAS является возможность анонимного публичного доступа к контейнеру и его каплям в хранилище Azure Blob. Поступая таким образом, вы можете предоставить только для чтения доступ к этим ресурсам, не делясь ключом учетной записи и не требуя SAS. Общедоступный доступ к чтению обычно используется для сценариев, где вы хотите, чтобы определенные капли всегда были доступны для анонимного доступа к чтению. Если этот сценарий подходит [вашему](../storage/blobs/storage-manage-access-to-resources.md) решению, см. доступ К статье Anonymous, чтобы узнать больше об управлении доступом к вашим данным blob.

### <a name="storage-container-name"></a>Имя контейнера для хранения

Вместо настройки и создания URL-адреса SAS можно использовать имя контейнера для хранения Azure для доступа к данным капли. Контейнер для хранения, который используется, должен находиться в учетной записи хранения Azure, которая связана с учетной записью Пакета. Эта учетная запись хранилища известна как учетная запись автоматического хранения. Использование контейнера автоматической памяти позволяет обойти настройку и создание URL SAS для доступа к контейнеру для хранения.

В этом примере мы предполагаем, что данные, которые будут использоваться для создания файла ресурса, уже есть в учетной записи Хранилища Azure, связанной с учетной записью Пакета. Если у вас нет учетной записи автоматического хранения, см. [Create a Batch account](batch-account-create-portal.md)

Используя связанную учетную запись хранения, вам не нужно создавать и настраивать URL SAS в контейнер для хранения. Вместо этого укажите имя контейнера для хранения в связанной учетной записи хранения.

```csharp
ResourceFile inputFile = ResourceFile.FromAutoStorageContainer(containerName);
```

### <a name="web-endpoint"></a>Веб-конечная точка

Данные, которые не загружены в Хранилище Azure, по-прежнему можно использовать для создания файлов ресурсов. Можно указать любой действительный URL HTTP, содержащий ваши входные данные. URL-адрес предоставляется API пакета, а затем данные используются для создания файла ресурса.

В следующем примере с C, входные данные размещается на фиктивной конечной точке GitHub. API извлекает файл из действительной конечной точки веб-страницы и генерирует файл ресурса, который будет использоваться вашей задачей. Для этого сценария не требуется учетных данных.

```csharp
ResourceFile inputFile = ResourceFile.FromUrl("https://github.com/foo/file.txt", filePath);
```

## <a name="tips-and-suggestions"></a>Советы и рекомендации

Каждая задача Azure Batch использует файлы по-разному, поэтому пакет имеет варианты, доступные для управления файлами в задачах. Следующие сценарии не должны быть всеобъемлющими, но вместо этого охватывают несколько распространенных ситуаций и дают рекомендации.

### <a name="many-resource-files"></a>Многие файлы ресурсов

Задание пакета может содержать несколько задач, которые используют одни и те же общие файлы. Если общие файлы задач являются общими между многими задачами, лучшим вариантом может быть использование пакета приложений для хранения файлов ресурсов вместо использования файлов ресурсов. Пакеты приложений обеспечивают оптимизацию для скорости загрузки. Кроме того, данные в пакетах приложений кэшируются между задачами, поэтому, если файлы задач не часто меняются, пакеты приложений могут быть подходящими для решения. С пакетами приложений вам не нужно вручную управлять несколькими файлами ресурсов или создавать URL-адреса SAS для доступа к файлам в Хранилище Azure. Пакет работает в фоновом режиме с Azure Storage для хранения и развертывания пакетов приложений для вычисления узлов.

Если каждая задача имеет много файлов, уникальных для этой задачи, файлы ресурсов являются наилучшим вариантом, потому что задачи, которые используют уникальные файлы часто должны быть обновлены или заменены, что не так просто сделать с содержанием пакетов приложений. Файлы ресурсов обеспечивают дополнительную гибкость для обновления, добавления или редактирования отдельных файлов.

### <a name="number-of-resource-files-per-task"></a>Количество файлов ресурсов в задаче

Если в задаче указано несколько сотен файлов ресурсов, пакет может отклонить задачу как слишком большую. Лучше всего держать задачи небольшими, минимизируя количество файлов ресурсов на самой задаче.

Если нет возможности свести к минимуму количество файлов, необходимых для выполнения задач, можно оптимизировать задачу, создав единый файл ресурсов, который ссылается на контейнер хранения файлов ресурсов. Для этого поместите файлы ресурсов в контейнер хранения Azure и используйте различные [методы](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.resourcefile?view=azure-dotnet#methods) "контейнера" для файлов ресурсов. Используйте параметры префикса blob, чтобы указать коллекции файлов, которые будут загружены для ваших задач.

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте о [пакетах приложений](batch-application-packages.md) в качестве альтернативы файлам ресурсов.
- Для получения дополнительной [информации](batch-docker-container-workloads.md)об использовании контейнеров для файлов ресурсов см.
- Чтобы узнать, как собирать и сохранять выходные данные из задач, [см.](batch-task-output.md)
- См. дополнительные сведения об [API-интерфейсах и средствах пакетной службы](batch-apis-tools.md) для сборки решений пакетной службы.
