---
title: Создание и использование файлов ресурсов - пакетной службы Azure | Документация Майкрософт
description: Сведения о создании файлов ресурсов пакетной службы Azure из различных источников входных данных.
services: batch
author: laurenhughes
manager: jeconnoc
ms.service: batch
ms.topic: article
ms.date: 03/14/2019
ms.author: lahugh
ms.openlocfilehash: 113faffb0ebac50a67c96ce21e0ee2c1564bb4fc
ms.sourcegitcommit: 6f043a4da4454d5cb673377bb6c4ddd0ed30672d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/08/2019
ms.locfileid: "65405640"
---
# <a name="creating-and-using-resource-files"></a>Создание и использование файлов ресурсов

Задачи пакетной службы Azure часто требуется определенная данных для обработки. Файлы ресурсов, позволяет предоставить эти данные для виртуальной машины (VM) пакетной службы с помощью задачи. Все типы задач поддерживают файлы ресурсов: задачи, запуск задачи, задачи подготовки, прекращения заданий и т. д. В этой статье описывается несколько распространенных методов, о том, как создавать файлы ресурсов и размещать их на виртуальной Машине.  

Файлы ресурсов — это механизм для размещения данных на виртуальную Машину в пакете, но тип данных и способах ее использования является гибким. Тем не менее, существует несколько распространенных вариантов:

1. Подготовить общие файлы на каждой виртуальной Машине, с помощью файлов ресурсов для задачи запуска
1. Подготовка входных данных для обработки задач

Общие файлы может быть, например, файлы на задачу запуска, используемые для установки приложений, которые запускаются задачами. Входные данные могут быть изображений RAW-формата или видеоданные и любые данные, обрабатываемые пакетной службы.

## <a name="types-of-resource-files"></a>Типы файлов ресурсов

Существует несколько вариантов для создания файлов ресурсов. Процесс создания файлов ресурсов зависит от того, где хранятся исходные данные.

Параметры для создания файла ресурсов:

- [URL-адрес контейнера хранилища](#storage-container-url): Создает файл ресурсов из любого контейнера хранилища в Azure
- [Имя контейнера хранилища](#storage-container-name): Создает файл ресурсов от имени контейнера в учетную запись хранилища Azure, связанные с пакетной службы
- [Веб-точку](#web-endpoint): Создает файл ресурсов из любой допустимый URL-адрес HTTP

### <a name="storage-container-url"></a>URL-адрес контейнера хранилища

С помощью URL-адрес контейнера хранилища означает, что можно обратиться к файлам в любой контейнер хранилища в Azure с нужными разрешениями.

В этом C# примере, уже были загружены файлы в контейнер хранилища Azure как хранилище BLOB-объектов. Для доступа к данными, необходимыми для создания файла ресурсов, необходимо сначала получить доступ к контейнеру службы хранилища.

Создайте подпись общего доступа (SAS) URI и имеются необходимые разрешения для доступа к контейнеру хранилища. Задайте время истечения срока действия и разрешения для SAS. В этом случае не время начала указывается, поэтому подписанный URL-адрес становится действительным немедленно и истекает через два часа после его создания.

```csharp
SharedAccessBlobPolicy sasConstraints = new SharedAccessBlobPolicy
{
    SharedAccessExpiryTime = DateTime.UtcNow.AddHours(2),
    Permissions = SharedAccessBlobPermissions.Read | SharedAccessBlobPermissions.List
};
```

> [!NOTE]
> Для доступа к контейнеру, необходимо иметь `Read` и `List` разрешения, а с доступом к BLOB-объектов, вам потребуется фиксировать только `Read` разрешение.

После настройки разрешений создать маркер SAS и отформатируйте URL-адрес SAS для доступа к контейнеру службы хранилища. С помощью отформатированный URL-адрес SAS для контейнера хранилища, создать файл ресурсов, содержащий [ `FromStorageContainerUrl` ](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.resourcefile.fromstoragecontainerurl?view=azure-dotnet).

```csharp
CloudBlobContainer container = blobClient.GetContainerReference(containerName);

string sasToken = container.GetSharedAccessSignature(sasConstraints);
string containerSasUrl = String.Format("{0}{1}", container.Uri, sasToken);

ResourceFile inputFile = ResourceFile.FromStorageContainerUrl(containerSasUrl);
```

Вместо создания URL-адрес SAS — включить анонимный, открытый доступ на чтение к контейнеру и его большим двоичным объектам в хранилище BLOB-объектов Azure. Таким образом, можно предоставить доступ только для чтения к этим ресурсам без предоставления ключа вашей учетной записи и не требуя подписанного URL-адреса. Общий доступ на чтение обычно используется для сценариев, в место определенные большие двоичные объекты всегда будут доступны для анонимного доступа на чтение. Если в этом случае подходит решение, см. в разделе [анонимный доступ к большим двоичным объектам](../storage/blobs/storage-manage-access-to-resources.md) статью, чтобы узнать больше об управлении доступом к данным BLOB-объектов.

### <a name="storage-container-name"></a>Имя контейнера хранилища

Вместо настройки, а также создания URL-адрес SAS, имя контейнера хранилища Azure можно использовать для доступа к данным больших двоичных объектов. Контейнер хранилища необходимо использовать в учетной записи хранения Azure, которая связана с учетной записью пакетной службы, известный как учетной записи autostorage. Имя контейнера хранилища в учетной записи autostorage позволяет обойти, настройке и создании URL-адрес SAS для доступа к контейнеру хранилища.

В этом примере мы предполагаем, что данные, используемые для создания файла ресурсов уже находится в учетной записи хранения, связанной с учетной записью пакетной службы. Если у вас нет учетной записи autostorage, ознакомьтесь с инструкциями в [создать учетную запись пакетной службы](batch-account-create-portal.md) Дополнительные сведения о том, как создать и связать учетную запись.

С помощью связанной учетной записи хранения, не требуется для создания и настройки URL-адрес SAS для контейнера хранилища. Вместо этого укажите имя контейнера хранилища в учетной записи связанного хранилища.

```csharp
ResourceFile inputFile = ResourceFile.FromAutoStorageContainer(containerName);
```

### <a name="web-endpoint"></a>Конечная веб-точка

Данные, которые не передаются в хранилище Azure по-прежнему может использоваться для создания файлов ресурсов. Можно указать любой допустимый URL-адрес HTTP содержащий входные данные. URL-адрес предоставляется API пакетной службы, а затем данные используется для создания файла ресурсов.

В следующем C# пример входных данных размещается на вымышленной GitHub конечной точки. Извлекает файл из конечной допустимый веб-API и создает файл ресурсов для использования процессом ваша задача. Учетные данные не требуются для этого сценария.

```csharp
ResourceFile inputFile = ResourceFile.FromUrl("https://github.com/foo/file.txt", filePath);
```

## <a name="tips-and-suggestions"></a>Советы и рекомендации

Каждой задачи пакетной службы Azure использует файлы по-разному, поэтому пакет имеет параметры, доступные для управления файлами на задачи. Следующие сценарии не рассчитаны на полноту, но вместо этого охватывают несколько распространенных ситуаций и давать рекомендации.

### <a name="many-resource-files"></a>Многие файлы ресурсов

Задания пакетной службы может содержать несколько задач, что все используют же, общих файлов. Если общие файлы задачи являются общими для многих задач, с помощью пакета приложения для хранения файлов, а не с помощью файлов ресурсов может быть лучшим вариантом. Пакеты приложений обеспечивают оптимизации для скорости загрузки. Кроме того, кэширование данных в пакеты приложений между задачами, поэтому если не изменяйте файлов задач, пакеты приложений может быть хорошо подходит для вашего решения. С помощью пакетов приложений не нужно вручную управлять несколько файлов ресурсов или создать URL-адреса SAS для доступа к файлам в службе хранилища Azure. Пакетная служба работает в фоновом режиме со службой хранилища Azure для хранения и развертывания пакетов приложений на вычислительных узлах.

Если у каждой задачи есть большое количество файлов, уникальные для этой задачи, файлы ресурсов скорее является наилучшим вариантом. Задачи, которые часто используют уникальных файлов необходимо обновить или заменить, который не так же легко сделать с помощью пакетов содержимого приложения. Файлы ресурсов обеспечить дополнительную гибкость для обновления, добавления или редактирования отдельных файлов.

### <a name="number-of-resource-files-per-task"></a>Число файлов ресурсов на задачу

При наличии нескольких сотен ресурсов файлы, указанные на задачу, пакет может отклонять задачи для него слишком велико. Рекомендуется сохранить небольшой задач, сводя к минимуму число файлов ресурсов на саму задачу.

Если не существует способа чтобы свести к минимуму количество файлов, ваша задача, задачи можно оптимизировать, создав файл одного ресурса, который ссылается на контейнер хранилища файлов ресурсов. Чтобы сделать это, размещайте файлы ресурсов в контейнер хранилища Azure и использовать различные режимы «Container» файлы ресурсов. Используйте параметры префикс BLOB-объектов для указания коллекции файлов для загрузки для ваших задач.

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о [пакетов приложений](batch-application-packages.md) в качестве альтернативы в файлы ресурсов.
- Дополнительные сведения об использовании контейнеров для файлов ресурсов см. в разделе [рабочих нагрузок контейнера](batch-docker-container-workloads.md).
- Узнайте, как собрать и сохранить выходные данные из задач, см. в разделе [сохранения выходных данных заданий и задач](batch-task-output.md).
- См. дополнительные сведения об [API-интерфейсах и средствах пакетной службы](batch-apis-tools.md) для сборки решений пакетной службы.
