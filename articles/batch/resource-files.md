---
title: Создание и использование файлов ресурсов в пакетной службе Azure
description: Узнайте, как создавать файлы ресурсов пакетной службы из различных источников входных данных. В этой статье описаны некоторые распространенные методы создания и размещения их на виртуальной машине.
services: batch
author: ju-shim
manager: gwallace
ms.service: batch
ms.topic: article
ms.date: 03/14/2019
ms.author: jushiman
ms.openlocfilehash: 61d4baffe65da52f8ca926bc911b26e3f1c9a79a
ms.sourcegitcommit: dbcc4569fde1bebb9df0a3ab6d4d3ff7f806d486
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/15/2020
ms.locfileid: "76029354"
---
# <a name="creating-and-using-resource-files"></a>Создание и использование файлов ресурсов

Для обработки задач пакетной службы Azure часто требуется определенная форма данных. Файлы ресурсов — это средства для предоставления этих данных виртуальной машине пакетной службы с помощью задачи. Для всех типов задач поддерживаются файлы ресурсов: задачи, задачи запуска, задачи подготовки заданий, задачи выпуска заданий и т. д. В этой статье рассматриваются некоторые распространенные методы создания файлов ресурсов и их размещения на виртуальной машине.  

Файлы ресурсов — это механизм для размещения данных на виртуальной машине в пакетной службе, но тип данных и способ их использования являются гибкими. Однако существуют некоторые распространенные варианты использования:

1. Подготавливайте общие файлы на каждой виртуальной машине с помощью файлов ресурсов в задаче запуска.
1. Подготавливать входные данные для обработки задачами

Распространенными файлами могут быть, например, файлы в задаче запуска, используемые для установки приложений, выполняемых задачами. Входные данные могут представлять собой необработанные изображения или видеоданные, а также любые сведения, которые будут обрабатываться пакетом.

## <a name="types-of-resource-files"></a>Типы файлов ресурсов

Для создания файлов ресурсов можно использовать несколько различных параметров. Процесс создания файлов ресурсов зависит от места хранения исходных данных.

Параметры для создания файла ресурсов.

- [URL-адрес контейнера хранилища](#storage-container-url): создает файл ресурсов из любого контейнера хранилища в Azure.
- [Имя контейнера хранилища](#storage-container-name): создает файл ресурсов из имени контейнера в учетной записи хранения Azure, связанной с пакетной службой.
- [Конечная веб-точка](#web-endpoint): создает файл ресурсов по любому действительному URL-адресу http.

### <a name="storage-container-url"></a>URL-адрес контейнера хранилища

Использование URL-адреса контейнера хранилища означает, что вы можете обращаться к файлам в любом контейнере хранилища в Azure с правильными разрешениями.

В этом C# примере файлы уже были переданы в контейнер службы хранилища Azure в качестве хранилища BLOB-объектов. Чтобы получить доступ к данным, необходимым для создания файла ресурсов, сначала необходимо получить доступ к контейнеру хранилища.

Создайте URI подписи общего доступа (SAS) с правильными разрешениями для доступа к контейнеру хранилища. Задайте срок действия и разрешения для SAS. В этом случае время начала не указано, поэтому SAS становится действительным немедленно и срок ее действия истекает через два часа после создания.

```csharp
SharedAccessBlobPolicy sasConstraints = new SharedAccessBlobPolicy
{
    SharedAccessExpiryTime = DateTime.UtcNow.AddHours(2),
    Permissions = SharedAccessBlobPermissions.Read | SharedAccessBlobPermissions.List
};
```

> [!NOTE]
> Для доступа к контейнеру необходимо иметь разрешения `Read` и `List`, в то время как для доступа к BLOB-объектам требуется только `Read` разрешение.

После настройки разрешений создайте маркер SAS и отформатируйте URL-адрес SAS для доступа к контейнеру хранилища. Используя отформатированный URL-адрес SAS для контейнера хранилища, создайте файл ресурсов с [`FromStorageContainerUrl`](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.resourcefile.fromstoragecontainerurl?view=azure-dotnet).

```csharp
CloudBlobContainer container = blobClient.GetContainerReference(containerName);

string sasToken = container.GetSharedAccessSignature(sasConstraints);
string containerSasUrl = String.Format("{0}{1}", container.Uri, sasToken);

ResourceFile inputFile = ResourceFile.FromStorageContainerUrl(containerSasUrl);
```

Альтернативой созданию URL-адреса SAS является включение анонимного общего доступа для чтения в контейнер и его большие двоичные объекты в хранилище BLOB-объектов Azure. Это позволит предоставить доступ только для чтения к этим ресурсам без предоставления общего доступа к ключу учетной записи и без использования SAS. Открытый доступ на чтение обычно используется в сценариях, когда необходимо, чтобы определенные большие двоичные объекты всегда были доступны для анонимного доступа на чтение. Если этот сценарий подходит для вашего решения, см. статью [анонимный доступ к BLOB-объектам](../storage/blobs/storage-manage-access-to-resources.md) для получения дополнительных сведений об управлении доступом к данным большого двоичного объекта.

### <a name="storage-container-name"></a>Имя контейнера хранилища

Вместо настройки и создания URL-адреса SAS можно использовать имя контейнера хранилища Azure для доступа к данным большого двоичного объекта. Используемый контейнер хранилища должен находиться в учетной записи хранения Azure, связанной с учетной записью пакетной службы, называемой учетной записью службы автохранения. Использование имени контейнера хранилища для учетной записи службы автохранения позволяет обходить настройку и создание URL-адреса SAS для доступа к контейнеру хранилища.

В этом примере предполагается, что данные, используемые для создания файлов ресурсов, уже находятся в учетной записи хранения Azure, связанной с учетной записью пакетной службы. Если у вас нет учетной записи автохранения, см. инструкции в разделе [Создание учетной записи пакетной](batch-account-create-portal.md) службы для получения дополнительных сведений о создании и связывании учетной записи.

Используя связанную учетную запись хранения, вам не нужно создавать и настраивать URL-адрес SAS для контейнера хранилища. Вместо этого укажите имя контейнера хранилища в связанной учетной записи хранения.

```csharp
ResourceFile inputFile = ResourceFile.FromAutoStorageContainer(containerName);
```

### <a name="web-endpoint"></a>Конечная веб-точка

Данные, которые не передаются в службу хранилища Azure, по-прежнему можно использовать для создания файлов ресурсов. Можно указать любой допустимый URL-адрес HTTP, содержащий входные данные. URL-адрес предоставляется API пакетной службы, а затем данные используются для создания файла ресурсов.

В следующем C# примере входные данные размещаются на фиктивной конечной точке GitHub. API извлекает файл из допустимой веб-конечной точки и создает файл ресурсов, который будет использоваться задачей. Для этого сценария учетные данные не требуются.

```csharp
ResourceFile inputFile = ResourceFile.FromUrl("https://github.com/foo/file.txt", filePath);
```

## <a name="tips-and-suggestions"></a>Советы и рекомендации

Каждая задача пакетной службы Azure использует файлы по-разному, поэтому Пакетная служба имеет возможности для управления файлами в задачах. Приведенные ниже сценарии не являются исчерпывающими, но они охватывают несколько распространенных ситуаций и предоставляют рекомендации.

### <a name="many-resource-files"></a>Много файлов ресурсов

Пакетное задание может содержать несколько задач, которые используют одни и те же общие файлы. Если общие файлы задач являются общими для нескольких задач, лучшим вариантом будет использование пакета приложения для хранения файлов вместо использования файлов ресурсов. Пакеты приложений обеспечивают оптимизацию скорости загрузки. Кроме того, данные в пакетах приложений кэшируются между задачами, поэтому, если файлы задач не меняются часто, пакеты приложений могут быть хорошо подходят для вашего решения. При использовании пакетов приложений вам не нужно вручную управлять несколькими файлами ресурсов или создавать URL-адреса SAS для доступа к файлам в службе хранилища Azure. Пакетная служба работает в фоновом режиме со службой хранилища Azure для хранения и развертывания пакетов приложений на вычисляются узлы.

Если у каждой задачи есть много файлов, уникальных для этой задачи, то файлы ресурсов обычно являются лучшим вариантом. Задачи, использующие уникальные файлы, часто нуждаются в обновлении или замене, что не так просто делать с содержимым пакетов приложений. Файлы ресурсов обеспечивают дополнительную гибкость при обновлении, добавлении или изменении отдельных файлов.

### <a name="number-of-resource-files-per-task"></a>Число файлов ресурсов на задачу

Если в задаче указано несколько сотен файлов ресурсов, пакетная обработка может отклонять задачу слишком большого размера. Лучше сделать задачи небольшими, уменьшив количество файлов ресурсов в самой задаче.

Если не удается сократить количество файлов, необходимых задаче, можно оптимизировать задачу, создав отдельный файл ресурсов, который ссылается на контейнер хранилища файлов ресурсов. Для этого вставьте файлы ресурсов в контейнер службы хранилища Azure и используйте различные режимы "контейнера" файлов ресурсов. Используйте параметры префикса BLOB-объектов, чтобы указать коллекции файлов, которые будут скачаны для задач.

## <a name="next-steps"></a>Дальнейшие действия

- Сведения о [пакетах приложений](batch-application-packages.md) в качестве альтернативы файлам ресурсов.
- Дополнительные сведения об использовании контейнеров для файлов ресурсов см. в разделе [рабочие нагрузки контейнера](batch-docker-container-workloads.md).
- Чтобы узнать, как собирать и сохранять выходные данные задач, см. раздел [Сохранение выходных данных заданий и задач](batch-task-output.md).
- См. дополнительные сведения об [API-интерфейсах и средствах пакетной службы](batch-apis-tools.md) для сборки решений пакетной службы.
