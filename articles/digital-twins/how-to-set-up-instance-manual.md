---
title: Настройка экземпляра и проверки подлинности (вручную)
titleSuffix: Azure Digital Twins
description: См. статью как настроить экземпляр службы Digital двойников для Azure, включая правильную проверку подлинности. Ручная версия.
author: baanders
ms.author: baanders
ms.date: 7/22/2020
ms.topic: how-to
ms.service: digital-twins
ms.openlocfilehash: 8d0e965360caab704bcf6c8f7d29e7bba421207e
ms.sourcegitcommit: 0e8a4671aa3f5a9a54231fea48bcfb432a1e528c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/24/2020
ms.locfileid: "87125893"
---
# <a name="set-up-an-azure-digital-twins-instance-and-authentication-manual"></a>Настройка экземпляра и проверки подлинности Azure Digital двойников (вручную)

[!INCLUDE [digital-twins-setup-selector.md](../../includes/digital-twins-setup-selector.md)]

В этой статье описаны действия по **настройке нового экземпляра Azure Digital двойников**, включая создание экземпляра и настройку проверки подлинности. По завершении работы с этой статьей у вас будет готовый экземпляр Azure Digital двойников для начала программирования.

Эта версия этой статьи выполняет эти шаги вручную, по одной на одну. Чтобы выполнить автоматическую установку с помощью примера скрипта развертывания, см. статью [*как настроить экземпляр и проверку подлинности (в скрипте)*](how-to-set-up-instance-scripted.md).

[!INCLUDE [digital-twins-setup-starter.md](../../includes/digital-twins-setup-starter.md)]

## <a name="set-up-cloud-shell-session"></a>Создание сеанса Cloud Shell
[!INCLUDE [Cloud Shell for Azure Digital Twins](../../includes/digital-twins-cloud-shell.md)]

## <a name="create-the-azure-digital-twins-instance"></a>Создание экземпляра Digital двойников для Azure

В этом разделе вы **создадите новый экземпляр Azure Digital двойников** с помощью команды Cloud Shell. Необходимо указать:
* Группа ресурсов для развертывания. Если у вас еще нет имеющейся группы ресурсов, вы можете создать ее сейчас с помощью следующей команды:
    ```azurecli
    az group create --location <region> --name <name-for-your-resource-group>
    ```
* Регион для развертывания. Чтобы узнать, какие регионы поддерживают Azure Digital двойников, посетите страницу [*продукты Azure, доступные по регионам*](https://azure.microsoft.com/global-infrastructure/services/?products=digital-twins).
* Имя экземпляра. Имя нового экземпляра должно быть уникальным в пределах региона (т. е. Если другой экземпляр Azure Digital двойников в этом регионе уже использует выбранное имя, вам будет предложено выбрать другое имя).

Используйте следующие значения в следующей команде, чтобы создать экземпляр:

```azurecli
az dt create --dt-name <name-for-your-Azure-Digital-Twins-instance> -g <your-resource-group> -l <region>
```

### <a name="verify-success"></a>Проверка успешного выполнения

Если экземпляр успешно создан, результат в Cloud Shell выглядит примерно так, выводя сведения о созданном ресурсе:

:::image type="content" source="media/how-to-set-up-instance/create-instance.png" alt-text="командное окно с успешным созданием группы ресурсов и экземпляра Azure Digital двойников":::

Обратите внимание на имя *узла*, *имени*и группы Azure Digital *двойников из выходных* данных. Это все важные значения, которые могут потребоваться при продолжении работы с вашим экземпляром Azure Digital двойников для настройки проверки подлинности и связанных ресурсов Azure.

> [!TIP]
> Эти свойства и все свойства экземпляра можно просмотреть в любое время, запустив `az dt show --dt-name <your-Azure-Digital-Twins-instance>` .

Теперь у вас есть экземпляр Azure Digital двойников, готовый к работе. Далее вы получите соответствующие разрешения пользователя Azure для управления им.

## <a name="set-up-your-users-access-permissions"></a>Настройка разрешений доступа пользователя

Azure Digital двойников использует [Azure Active Directory (Azure AD)](../active-directory/fundamentals/active-directory-whatis.md) для управления доступом на основе РОЛЕЙ (RBAC). Это означает, что прежде чем пользователь сможет выполнять вызовы плоскости данных в ваш экземпляр Azure Digital двойников, ему сначала необходимо назначить роль с разрешениями.

Для Azure Digital двойников эта роль является _**владельцем Azure Digital двойников (Предварительная версия)**_. Дополнительные сведения о ролях и безопасности см. в статье [*Security for Azure Digital двойников Solutions*](concepts-security.md).

В этом разделе показано, как создать назначение ролей для пользователя в экземпляре Digital двойников Azure через электронное письмо, связанное с клиентом Azure AD в вашей подписке Azure. В зависимости от роли и разрешений на подписку Azure вы либо настроите ее самостоятельно, либо настроите ее от имени другого пользователя, который будет управлять экземпляром Digital двойников Azure.

### <a name="assign-the-role"></a>Назначение роли

Чтобы предоставить пользователю разрешения на управление экземпляром Digital двойников Azure, необходимо назначить им роль _**владельца Azure Digital двойников (Предварительная версия)**_ в экземпляре. 

Обратите внимание, что эта роль отличается от...
* роль *владельца* для всей подписки Azure. *Владелец Azure Digital двойников (Предварительная версия)* — это роль в Azure Digital двойников. она ограничивается этим отдельным экземпляром Azure Digital двойников.
* роль *владельца* в Azure Digital двойников. Это две отдельные роли управления цифровыми двойников Azure, а *владелец Azure Digital двойников (Предварительная версия)* — это роль, которую следует использовать для управления во время предварительной версии.

Используйте следующую команду, чтобы назначить роль (должна выполняться владельцем подписки Azure):

```azurecli
az dt role-assignment create --dt-name <your-Azure-Digital-Twins-instance> --assignee "<Azure-AD-email-of-user-to-assign>" --role "Azure Digital Twins Owner (Preview)"
```

Результат этой команды выводит сведения о созданном назначении роли.

> [!TIP]
> Если вместо этого возникает ошибка *400: BadRequest* , выполните следующую команду, чтобы получить *ObjectID* для пользователя:
> ```azurecli
> az ad user show --id <Azure-AD-email-of-user-to-assign> --query objectId
> ```
> Затем повторите команду назначения роли, используя *идентификатор объекта* пользователя вместо его электронной почты.

### <a name="verify-success"></a>Проверка успешного выполнения

[!INCLUDE [digital-twins-setup-verify-role-assignment.md](../../includes/digital-twins-setup-verify-role-assignment.md)]

Теперь у вас есть экземпляр Azure Digital двойников, который готов к работе и ему назначены разрешения для управления им. Далее предстоит настроить разрешения для клиентского приложения на доступ к нему.

## <a name="set-up-access-permissions-for-client-applications"></a>Настройка разрешений доступа для клиентских приложений

После настройки экземпляра Azure Digital двойников, как правило, взаимодействие с этим экземпляром осуществляется через создаваемое клиентское приложение. Для этого необходимо убедиться, что клиентское приложение сможет проходить проверку подлинности в Azure Digital двойников. Это делается путем настройки **регистрации приложения** [Azure Active Directory (Azure AD)](../active-directory/fundamentals/active-directory-whatis.md) для использования клиентским приложением.

Регистрация приложения — это место, где вы настраиваете разрешения на доступ к [API-интерфейсам цифровых двойников Azure](how-to-use-apis-sdks.md). Позже клиентское приложение будет проходить проверку подлинности при регистрации приложения, и в результате ему будут предоставлены настроенные разрешения на доступ к API.

>[!TIP]
> Как владелец подписки, вы можете настроить регистрацию нового приложения для каждого нового экземпляра Azure Digital двойников *или* сделать это только один раз и установить единую регистрацию приложения, которая будет совместно использоваться всеми экземплярами Azure Digital двойников в подписке. Вот как это делается в собственном клиенте корпорации Майкрософт.

### <a name="create-the-registration"></a>Создание регистрации

Чтобы создать регистрацию приложения, необходимо указать идентификаторы ресурсов для API цифровых двойников Azure и базовые разрешения для API. В рабочем каталоге откройте новый файл и введите следующий фрагмент JSON, чтобы настроить следующие сведения: 

```json
[{
    "resourceAppId": "0b07f429-9f4b-4714-9392-cc5e8e80c8b0",
    "resourceAccess": [
     {
       "id": "4589bd03-58cb-4e6c-b17f-b580e39652f8",
       "type": "Scope"
     }
    ]
}]
``` 

Сохраните этот файл как *manifest.js*.

> [!NOTE] 
> В некоторых местах `https://digitaltwins.azure.net` для идентификатора приложения Azure Digital двойников вместо GUID можно использовать удобную для восприятия строку `0b07f429-9f4b-4714-9392-cc5e8e80c8b0` . Например, многие примеры по всему этому набору документации используют проверку подлинности с помощью библиотеки MSAL, а для этого можно использовать понятную строку. Однако на этом этапе создания регистрации приложения требуется форма идентификатора GUID, как показано выше. 

В окне Cloud Shell щелкните значок "Отправить/скачать файлы" и выберите "Отправить".

:::image type="content" source="media/how-to-set-up-instance/cloud-shell-upload.png" alt-text="Окно Cloud Shell, в котором отображается выбор параметра отправки":::
Перейдите к только что созданному *manifest.js* и нажмите кнопку "Открыть".

Затем выполните следующую команду, чтобы создать регистрацию приложения (заменяя заполнители по мере необходимости):

```azurecli
az ad app create --display-name <name-for-your-app> --native-app --required-resource-accesses manifest.json --reply-url http://localhost
```

Ниже приведен фрагмент выходных данных этой команды, в котором отображаются сведения о созданной регистрации:

:::image type="content" source="media/how-to-set-up-instance/new-app-registration.png" alt-text="Cloud Shell выходные данные новой регистрации приложения Azure AD":::

### <a name="verify-success"></a>Проверка успешного выполнения

[!INCLUDE [digital-twins-setup-verify-app-registration-1.md](../../includes/digital-twins-setup-verify-app-registration-1.md)]

Сначала убедитесь, что параметры, отправленные с *manifest.js* , были правильно установлены для регистрации. Для этого в строке меню выберите *Манифест* , чтобы просмотреть код манифеста регистрации приложения. Прокрутите окно кода вниз и найдите поля из *manifest.jsв* разделе `requiredResourceAccess` :

[!INCLUDE [digital-twins-setup-verify-app-registration-2.md](../../includes/digital-twins-setup-verify-app-registration-2.md)]

### <a name="collect-important-values"></a>Получение важных значений

Затем в строке меню выберите *Обзор* , чтобы просмотреть сведения о регистрации приложения:

:::image type="content" source="media/how-to-set-up-instance/app-important-values.png" alt-text="Представление портала с важными значениями для регистрации приложения":::

Запишите *идентификатор приложения (клиента)* и *идентификатор каталога (клиента)* , показанные на **странице.** Эти значения потребуются позже для [проверки подлинности клиентского приложения с помощью API цифровых двойников Azure](how-to-authenticate-client.md). Если вы не являетесь пользователем, который будет писать код для таких приложений, вам потребуется поделиться этими значениями с пользователем, который будет иметь значение.

### <a name="other-possible-steps-for-your-organization"></a>Другие возможные действия для вашей организации

[!INCLUDE [digital-twins-setup-additional-requirements.md](../../includes/digital-twins-setup-additional-requirements.md)]

## <a name="next-steps"></a>Дальнейшие действия

См. раздел как подключить клиентское приложение к экземпляру, написав код проверки подлинности клиентского приложения:
* [*Пошаговое руководство. Написание кода проверки подлинности приложения*](how-to-authenticate-client.md)
