---
title: Настройка экземпляра и проверки подлинности (с использованием скрипта)
titleSuffix: Azure Digital Twins
description: Сведения о настройке экземпляра службы Digital двойников см. в разделе Создание сценария автоматического развертывания.
author: baanders
ms.author: baanders
ms.date: 7/23/2020
ms.topic: how-to
ms.service: digital-twins
ms.openlocfilehash: 86597521f762237b5c4bc9a7a5268d7dae1303b4
ms.sourcegitcommit: 02ca0f340a44b7e18acca1351c8e81f3cca4a370
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "88588004"
---
# <a name="set-up-an-azure-digital-twins-instance-and-authentication-scripted"></a>Настройка экземпляра Azure Digital двойников и проверки подлинности (с помощью сценария)

[!INCLUDE [digital-twins-setup-selector.md](../../includes/digital-twins-setup-selector.md)]

В этой статье описаны действия по **настройке нового экземпляра Azure Digital двойников**, включая создание экземпляра и настройку проверки подлинности. По завершении работы с этой статьей у вас будет готовый экземпляр Azure Digital двойников для начала программирования.

Эта версия этой статьи завершает эти действия, запуская [пример **скрипта автоматического развертывания** ](https://docs.microsoft.com/samples/azure-samples/digital-twins-samples/digital-twins-samples/) , который упрощает процесс. 
* Для просмотра действий CLI вручную, выполняемых сценарием в фоновом режиме, см. версию CLI этой статьи: [*инструкции по настройке экземпляра и проверки подлинности (CLI)*](how-to-set-up-instance-cli.md).
* Чтобы просмотреть действия вручную в соответствии с портал Azure, см. версию портала этой статьи: инструкции по [*настройке экземпляра и проверки подлинности (портал)*](how-to-set-up-instance-portal.md).

[!INCLUDE [digital-twins-setup-steps-prereq.md](../../includes/digital-twins-setup-steps-prereq.md)]

[!INCLUDE [cloud-shell-try-it.md](../../includes/cloud-shell-try-it.md)]

## <a name="run-the-deployment-script"></a>Выполнение скрипта развертывания

В этой статье используется пример кода Azure Digital двойников для развертывания экземпляра цифрового двойников Azure и автоматической проверки подлинности. Его также можно использовать в качестве отправной точки для написания собственных взаимодействий со сценариями.

Пример скрипта написан на PowerShell. Она входит в [примеры цифровых двойников Azure](https://docs.microsoft.com/samples/azure-samples/digital-twins-samples/digital-twins-samples/), которые можно загрузить на компьютер, перейдя по этой ссылке и нажав кнопку *скачать ZIP-файл* под заголовком.

В скачанной папке примера скрипт развертывания находится в каталоге _Azure_Digital_Twins_samples.zip > скрипты > **deploy.ps1** _.

Ниже приведены действия по запуску скрипта развертывания в Cloud Shell.
1. Перейдите в окно [Azure Cloud Shell](https://shell.azure.com/) в браузере. Выполните вход с помощью следующей команды:
    ```azurecli-interactive
    az login
    ```
    Если в CLI можно запустить браузер по умолчанию, откроется браузер со страницей входа. В противном случае самостоятельно откройте в браузере страницу *https://aka.ms/devicelogin* и введите код авторизации, отображаемый в терминале.
 
2. После входа Найдите панель значков окна Cloud Shell. Выберите значок "Отправить/скачать файлы" и нажмите кнопку "Отправить".

    :::image type="content" source="media/how-to-set-up-instance/cloud-shell/cloud-shell-upload.png" alt-text="Окно Cloud Shell, в котором отображается выбор параметра отправки":::

    Перейдите к файлу _**deploy.ps1**_ на компьютере и нажмите кнопку "Открыть". Файл будет отправлен в Cloud Shell, чтобы его можно было запустить в окне Cloud Shell.

3. Запустите сценарий, отправив `./deploy.ps1` команду в окне Cloud Shell. Так как сценарий выполняется с помощью действий автоматической установки, вам будет предложено передать следующие значения:
    * Для экземпляра: *идентификатор подписки* Azure для использования.
    * Для экземпляра: *Расположение* , в котором вы хотите развернуть экземпляр. Чтобы узнать, какие регионы поддерживают Azure Digital двойников, посетите страницу [*продукты Azure, доступные по регионам*](https://azure.microsoft.com/global-infrastructure/services/?products=digital-twins).
    * Для экземпляра: имя *группы ресурсов* . Вы можете использовать существующую группу ресурсов или ввести новое имя, чтобы создать его.
    * Для экземпляра: *имя* вашего экземпляра Digital двойников для Azure. Имя нового экземпляра должно быть уникальным в пределах региона для вашей подписки (это означает, что если в вашей подписке есть другой экземпляр Azure Digital двойников в регионе, где уже используется выбранное имя, вам будет предложено выбрать другое имя).
    * Для регистрации приложения: *Отображаемое имя приложения Azure AD* , связываемое с регистрацией. Регистрация приложения — это место, где вы настраиваете разрешения на доступ к [API-интерфейсам цифровых двойников Azure](how-to-use-apis-sdks.md). Позже клиентское приложение будет проходить проверку подлинности при регистрации приложения, и в результате ему будут предоставлены настроенные разрешения на доступ к API.
    * Для регистрации приложения: *URL-адрес ответа приложения Azure AD* для приложения Azure AD. Можно использовать `http://localhost` .

Скрипт создаст экземпляр Azure Digital двойников, назначьте пользователю Azure роль *владельца Azure Digital двойников (Предварительная версия)* на экземпляре и настройте регистрацию приложения Azure AD для использования в клиентском приложении.

Ниже приведен фрагмент журнала вывода из скрипта:

:::image type="content" source="media/how-to-set-up-instance/cloud-shell/deployment-script-output.png" alt-text="Cloud Shell окно, показывающее журнал входных и выходных данных при выполнении скрипта развертывания" lightbox="media/how-to-set-up-instance/cloud-shell/deployment-script-output.png":::

Если сценарий завершается успешно, окончательная печать будет говорить `Deployment completed successfully` . В противном случае выполняйте сообщение об ошибке и повторно запустите скрипт. Он обходит уже выполненные действия и снова запросит входные данные в том месте, где вы остановились.

После завершения скрипта теперь у вас есть экземпляр Azure Digital двойников, готовый к управлению с разрешениями на управление и устанавливающие разрешения на доступ к нему для клиентского приложения.

> [!NOTE]
> В настоящее время сценарий назначает требуемую роль управления в Azure Digital двойников (*Azure Digital двойников Owner (Предварительная версия)*) тому же пользователю, который запускает скрипт из Cloud Shell. Если вам нужно назначить эту роль другому пользователю, который будет управлять экземпляром, это можно сделать сейчас с помощью портал Azure ([инструкции](how-to-set-up-instance-portal.md#set-up-user-access-permissions)) или CLI ([инструкции](how-to-set-up-instance-cli.md#set-up-user-access-permissions)).

## <a name="collect-important-values"></a>Получение важных значений

Существует несколько важных значений ресурсов, настроенных сценарием, которые могут потребоваться при продолжении работы с экземпляром Digital двойников для Azure. В этом разделе для получения этих значений будет использоваться [портал Azure](https://portal.azure.com) . Их следует сохранить в надежном месте или вернуться к этому разделу, чтобы найти их позже по мере необходимости.

Если другие пользователи будут программироваться на экземпляре, эти значения также следует использовать вместе с ними.

### <a name="collect-instance-values"></a>Получение значений экземпляров

В [портал Azure](https://portal.azure.com)найдите экземпляр Azure Digital двойников, выполнив поиск по имени своего экземпляра на панели поиска портала.

При выборе откроется страница *обзора* экземпляра. Запомните его *имя*, *группу ресурсов*и *имя узла*. Эти данные могут потребоваться позже для обнаружения экземпляра и подключения к нему.

:::image type="content" source="media/how-to-set-up-instance/portal/instance-important-values.png" alt-text="Выделение важных значений на странице обзора экземпляра":::

### <a name="collect-app-registration-values"></a>Получение значений регистрации приложения 

Регистрация приложения состоит из двух важных значений, которые потребуются позже для [написания кода проверки подлинности клиентского приложения для API-интерфейсов Azure Digital двойников](how-to-authenticate-client.md). 

Чтобы найти их, перейдите по [этой ссылке](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/RegisteredApps) , чтобы перейти на страницу обзора регистрации приложений Azure AD в портал Azure. На этой странице отображаются все регистрации приложений, созданные в вашей подписке.

Вы должны увидеть только что созданную регистрацию приложения в этом списке. Выберите его, чтобы открыть подробные сведения:

:::image type="content" source="media/how-to-set-up-instance/portal/app-important-values.png" alt-text="Представление портала с важными значениями для регистрации приложения":::

Запишите *идентификатор приложения (клиента)* и *идентификатор каталога (клиента)* , показанные на **странице.** Если вы не являетесь пользователем, который будет писать код для клиентских приложений, вам потребуется поделиться этими значениями с пользователем, который будет иметь значение.

## <a name="verify-success"></a>Проверка успешного выполнения

Если вы хотите проверить создание ресурсов и разрешений, настроенных сценарием, можно просмотреть их в [портал Azure](https://portal.azure.com).

### <a name="verify-instance"></a>Проверить экземпляр

Чтобы проверить, создан ли экземпляр, перейдите на [страницу цифровой двойников Azure](https://ms.portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.DigitalTwins%2FdigitalTwinsInstances) в портал Azure. На этой странице перечислены все экземпляры Azure Digital двойников. Найдите имя созданного экземпляра в списке.

### <a name="verify-user-role-assignment"></a>Проверка назначения роли пользователя

[!INCLUDE [digital-twins-setup-verify-role-assignment.md](../../includes/digital-twins-setup-verify-role-assignment.md)]

> [!NOTE]
> Помните, что сценарий в настоящее время назначает эту требуемую роль тому же пользователю, который запускает скрипт из Cloud Shell. Если вам нужно назначить эту роль другому пользователю, который будет управлять экземпляром, это можно сделать сейчас с помощью портал Azure ([инструкции](how-to-set-up-instance-portal.md#set-up-user-access-permissions)) или CLI ([инструкции](how-to-set-up-instance-cli.md#set-up-user-access-permissions)).
>
> Можно также использовать портал или CLI для повторного назначения ролей, если возникли проблемы с установкой сценариев.

### <a name="verify-app-registration"></a>Проверка регистрации приложения

[!INCLUDE [digital-twins-setup-verify-app-registration-1.md](../../includes/digital-twins-setup-verify-app-registration-1.md)]

Сначала убедитесь, что параметры разрешений Azure Digital двойников были правильно установлены для регистрации. Для этого в строке меню выберите *Манифест* , чтобы просмотреть код манифеста регистрации приложения. Прокрутите окно кода вниз и найдите эти поля в разделе `requiredResourceAccess` . Значения должны соответствовать приведенным на снимке экрана ниже:

[!INCLUDE [digital-twins-setup-verify-app-registration-2.md](../../includes/digital-twins-setup-verify-app-registration-2.md)]

## <a name="other-possible-steps-for-your-organization"></a>Другие возможные действия для вашей организации

[!INCLUDE [digital-twins-setup-additional-requirements.md](../../includes/digital-twins-setup-additional-requirements.md)]

## <a name="next-steps"></a>Дальнейшие действия

См. раздел как подключить клиентское приложение к экземпляру, написав код проверки подлинности клиентского приложения:
* [*Пошаговое руководство. Написание кода проверки подлинности приложения*](how-to-authenticate-client.md)
