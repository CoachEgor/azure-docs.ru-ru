---
title: Управление конечными точками и маршрутами (портал)
titleSuffix: Azure Digital Twins
description: Узнайте, как настроить конечные точки и маршруты событий для данных Azure Digital двойников с помощью портал Azure и управлять ими.
author: v-lakast
ms.author: v-lakast
ms.date: 7/22/2020
ms.topic: how-to
ms.service: digital-twins
ms.openlocfilehash: 7d563c7706529c6f3e280f7d138c0d6ba0dfc849
ms.sourcegitcommit: 4e5560887b8f10539d7564eedaff4316adb27e2c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/06/2020
ms.locfileid: "87902215"
---
# <a name="manage-endpoints-and-routes-in-azure-digital-twins-portal"></a>Управление конечными точками и маршрутами в Azure Digital двойников (портал)

[!INCLUDE [digital-twins-route-selector.md](../../includes/digital-twins-route-selector.md)]

В Azure Digital двойников можно маршрутизировать [уведомления о событиях](how-to-interpret-event-data.md) в подчиненные службы или подключенные ресурсы вычислений. Для этого сначала необходимо настроить **конечные точки** , которые могут принимать события. Затем можно создать [**маршруты событий**](concepts-route-events.md) , указывающие, какие события, создаваемые Azure Digital двойников, доставляются в конечные точки.

В этой статье описывается процесс создания конечных точек и маршрутов с помощью [портал Azure](https://portal.azure.com).

Вы также можете управлять конечными точками и маршрутами с помощью [API евентраутес](how-to-use-apis-sdks.md), [пакета SDK для .NET (C#)](https://github.com/Azure/azure-sdk-for-net/tree/master/sdk/digitaltwins/Azure.DigitalTwins.Core)или [Azure Digital двойников CLI](how-to-use-cli.md). Версию этой статьи, которая использует эти механизмы вместо портала, см. [*в разделе Практические руководства. Управление конечными точками и маршрутами (API и интерфейс командной строки)*](how-to-manage-routes-apis-cli.md).

## <a name="prerequisites"></a>Предварительные условия

* Вам потребуется **учетная запись Azure** (вы можете настроить ее [здесь](https://azure.microsoft.com/free/?WT.mc_id=A261C142F)бесплатно).
* Вам потребуется **экземпляр Azure Digital двойников** в подписке Azure. Если у вас еще нет экземпляра, его можно создать, выполнив действия, описанные в разделе [*инструкции. Настройка экземпляра и проверки подлинности*](how-to-set-up-instance-scripted.md). Используйте следующие значения из программы установки, которые можно использовать далее в этой статье:
    - Имя экземпляра
    - Группа ресурсов

Эти сведения можно найти в [портал Azure](https://portal.azure.com) после настройки экземпляра. Войдите на портал и найдите имя своего экземпляра на панели поиска портала.
 
:::image type="content" source="media/how-to-manage-routes-portal/search-field-portal.png" alt-text="Снимок экрана портал Azure панели поиска.":::

Выберите экземпляр из результатов, чтобы просмотреть страницу сведений для своего экземпляра:

:::image type="content" source="media/how-to-manage-routes-portal/instance-details.png" alt-text="Снимок экрана со сведениями об экземпляре ADT." border="false":::

## <a name="create-an-endpoint-for-azure-digital-twins"></a>Создание конечной точки для Azure Digital двойников

Ниже приведены поддерживаемые типы конечных точек, которые можно создать для экземпляра.
* [Сетка событий](../event-grid/overview.md) 
* [Центры событий](../event-hubs/event-hubs-about.md)
* [Служебная шина](../service-bus-messaging/service-bus-messaging-overview.md)

Дополнительные сведения о различных типах конечных точек см. в статье [*Выбор между службами обмена сообщениями Azure*](../event-grid/compare-messaging-services.md).

Чтобы связать конечную точку с цифровым двойников Azure, необходимо уже существовать раздел "Сетка событий", концентратор событий или служебная шина, которые вы используете для этой конечной точки. 

### <a name="create-an-event-grid-endpoint"></a>Создание конечной точки сетки событий

**Предварительные требования**: Создайте таблицу с сеткой событий, выполнив действия, описанные в [разделе *Создание пользовательского раздела* ](../event-grid/custom-event-quickstart-portal.md#create-a-custom-topic) руководства по *настраиваемым событиям* сетки событий.

После создания раздела его можно связать с Azure Digital двойников на странице экземпляра Azure Digital двойников в [портал Azure](https://portal.azure.com) (можно найти экземпляр, введя его имя на панели поиска портала).

В меню экземпляр выберите пункт _конечные точки_. Затем на следующей странице *конечные точки* выберите *+ создать конечную точку*. 

На открывшейся странице *Создание конечной точки* можно создать конечную точку типа " _Сетка событий_ ", выбрав соответствующий переключатель. Заполните другие сведения: введите имя конечной точки в поле _имя_ , выберите _подписку_ в раскрывающемся списке и выберите в третьем раскрывающемся списке раздел предварительно созданной _сетки событий_ .

Затем создайте конечную точку, нажав _Save_.

:::image type="content" source="media/how-to-manage-routes-portal/create-endpoint-event-grid.png" alt-text="Снимок экрана создания конечной точки сетки событий типа.":::

Чтобы убедиться, что конечная точка создана успешно, проверьте значок уведомления на верхней панели портал Azure: 

:::image type="content" source="media/how-to-manage-routes-portal/create-endpoint-notifications.png" alt-text="Снимок экрана уведомления для проверки создания конечной точки." border="false":::

Вы также можете просмотреть конечную точку, созданную на странице *конечные точки* для своего экземпляра Digital двойников Azure.

Если создание конечной точки завершается сбоем, просмотрите сообщение об ошибке и повторите попытку через несколько минут.

Теперь раздел "Сетка событий" доступен в качестве конечной точки в Azure Digital двойников под именем, указанным в поле _имя_ . Обычно это имя используется в качестве цели для **маршрута события**, который будет создан [Далее в этой статье](#event-routes).

### <a name="create-an-event-hubs-endpoint"></a>Создание конечной точки концентраторов событий

**Предварительные требования**: 
* Вам потребуется _пространство имен концентраторов событий_ и _концентратор событий_. Создайте оба этих объекта, выполнив действия, описанные в разделе [*Создание концентратора*](../event-hubs/event-hubs-create.md) событий с помощью концентраторов событий.
* Вам потребуется _правило авторизации_. Чтобы создать эту статью, обратитесь к концентраторам событий, которые [*обращаются к ресурсам концентраторов событий с помощью подписанных*](../event-hubs/authorize-access-shared-access-signature.md) URL.

Перейдите на страницу сведений об экземпляре Azure Digital двойников в [портал Azure](https://portal.azure.com) (его можно найти, введя его имя на панели поиска портала).

В меню экземпляр выберите пункт _конечные точки_. Затем на следующей странице *конечные точки* выберите *+ создать конечную точку*. 

На открывшейся странице *Создание конечной точки* можно создать конечную точку для типа _концентратора событий_ , выбрав соответствующий переключатель. Введите имя конечной точки в поле _имя_ . Затем выберите _подписку_и предварительно созданное _пространство имен концентратора событий_, _концентратор событий_и _правило авторизации_ из соответствующих раскрывающихся списков.

Затем создайте конечную точку, нажав _Save_.

:::image type="content" source="media/how-to-manage-routes-portal/create-endpoint-event-hub.png" alt-text="Снимок экрана создания конечной точки для типа "концентраторы событий".":::

Чтобы убедиться, что конечная точка создана успешно, проверьте значок уведомления на верхней панели портал Azure. 

Если создание конечной точки завершается сбоем, просмотрите сообщение об ошибке и повторите попытку через несколько минут.

Теперь концентратор событий доступен в качестве конечной точки в Azure Digital двойников под именем, указанным в поле _имя_ . Обычно это имя используется в качестве цели для **маршрута события**, который будет создан [Далее в этой статье](#event-routes).

### <a name="create-a-service-bus-endpoint"></a>Создание конечной точки служебной шины

**Предварительные требования**: 
* Вам потребуется _пространство имен служебной шины_ и _раздел служебной шины_. Создайте оба этих объекта, выполнив действия, описанные в кратком руководстве по [*созданию разделов и подписок*](../service-bus-messaging/service-bus-quickstart-topics-subscriptions-portal.md) служебной шины. Вам не нужно выполнять инструкции [*CREATE Subscriptions в*](../service-bus-messaging/service-bus-quickstart-topics-subscriptions-portal.md#create-subscriptions-to-the-topic) разделе.
* Вам потребуется _правило авторизации_. Чтобы создать это, см. статью [*Проверка подлинности и авторизация*](../service-bus-messaging/service-bus-authentication-and-authorization.md#shared-access-signature) служебной шины.

Перейдите на страницу сведений об экземпляре Azure Digital двойников в [портал Azure](https://portal.azure.com) (его можно найти, введя его имя на панели поиска портала).

В меню экземпляр выберите пункт _конечные точки_. Затем на следующей странице *конечные точки* выберите *+ создать конечную точку*. 

На открывшейся странице *Создание конечной точки* можно создать конечную точку типа " _служебная шина_ ", выбрав соответствующий переключатель. Введите имя конечной точки в поле _имя_ . Затем выберите _подписку_и предварительно созданное _пространство имен служебной шины_, _раздел служебной шины_и _правило авторизации_ из соответствующих раскрывающихся списков.

Затем создайте конечную точку, нажав _Save_.

:::image type="content" source="media/how-to-manage-routes-portal/create-endpoint-service-bus.png" alt-text="Снимок экрана создания конечной точки типа Service Bus.":::

Чтобы убедиться, что конечная точка создана успешно, проверьте значок уведомления на верхней панели портал Azure. 

Если создание конечной точки завершается сбоем, просмотрите сообщение об ошибке и повторите попытку через несколько минут.

Теперь раздел служебной шины доступен в качестве конечной точки в Azure Digital двойников под именем, указанным в поле _имя_ . Обычно это имя используется в качестве цели для **маршрута события**, который будет создан [Далее в этой статье](#event-routes).

## <a name="event-routes"></a>Маршрутизация событий

Чтобы фактически передавать данные из Azure Digital двойников в конечную точку, необходимо определить **маршрут события**. Эти маршруты позволяют разработчикам связывать потоки событий во всей системе и в подчиненных службах. Дополнительные сведения о маршрутах событий см. в статье [*Маршрутизация событий цифровых двойников Azure*](concepts-route-events.md).

**Предварительные требования**. прежде чем можно будет перейти к созданию маршрута, необходимо создать конечные точки, как описано ранее в этой статье. После завершения настройки конечных точек можно перейти к созданию маршрута события.

>[!NOTE]
>Если вы недавно развернули конечные точки, убедитесь, что они завершили развертывание, **прежде чем** пытаться использовать их для нового маршрута событий. Если вы не можете настроить маршрут, так как конечные точки не готовы, подождите несколько минут и повторите попытку.

### <a name="create-an-event-route"></a>Создание маршрута события 

Определение маршрута события содержит следующие элементы:
* Имя маршрута, которое вы хотите использовать
* Имя конечной точки, которую вы хотите использовать.
* Фильтр, который определяет, какие события отправляются в конечную точку
    - Чтобы отключить маршрут таким образом, чтобы события не отправлялись, используйте значение фильтра`false`
    - Чтобы включить маршрут без какой-либо специальной фильтрации, используйте значение фильтра`true`
    - Дополнительные сведения о любом другом типе фильтра см. в разделе [*Фильтрация событий*](#filter-events) ниже.

Один маршрут позволяет выбрать несколько уведомлений и типов событий.

Чтобы создать маршрут событий, перейдите на страницу сведений об экземпляре Azure Digital двойников в [портал Azure](https://portal.azure.com) (вы можете найти его, введя его имя на панели поиска портала).

В меню экземпляр выберите пункт _маршруты событий_. Затем на следующей странице *маршрутов событий* выберите *+ создать маршрут события*. 

На открывшейся странице *Создание маршрута события* выберите минимум:
* Имя маршрута в поле " _имя_ "
* _Конечная точка_ , которую вы хотите использовать для создания маршрута 

Чтобы включить маршрут, необходимо также **Добавить фильтр маршрутов событий** по крайней мере `true` . (Если значение по умолчанию — `false` , будет создан маршрут, но в него не будут отправляться никакие события.) Для этого переключите переключатель в _Расширенный редактор_ , чтобы включить его, и напишите `true` в поле *фильтра* .

:::image type="content" source="media/how-to-manage-routes-portal/create-event-route-no-filter.png" alt-text="Снимок экрана создания маршрута события для экземпляра." lightbox="media/how-to-manage-routes-portal/create-event-route-no-filter.png":::

По завершении нажмите кнопку _Save (сохранить_ ), чтобы создать маршрут события.

### <a name="filter-events"></a>События фильтра

Как описано выше, у маршрутов есть поле **фильтра** . Если значение фильтра для маршрута равно, то `false` никакие события не будут отправляться в конечную точку. 

После включения минимального фильтра `true` конечные точки получат различные события из Azure Digital двойников:
* Данные телеметрии, созданные [цифровым двойников](concepts-twins-graph.md) с помощью API службы Digital двойников
* Двойника уведомления об изменении свойств для любых двойника в экземпляре цифрового двойников Azure
* События жизненного цикла, которые срабатывают при создании или удалении двойников или связей
* События изменения модели, возникающие при добавлении или удалении [моделей](concepts-models.md) , настроенных в экземпляре Azure Digital двойников

Можно ограничить типы отправляемых событий, определив фильтр более конкретного типа.

Чтобы добавить фильтр событий во время создания маршрута событий, используйте раздел _Добавление фильтра маршрутов событий_ страницы *Создание маршрута события* . 

Можно выбрать один из основных общих параметров фильтра или использовать дополнительные параметры фильтра для создания собственных настраиваемых фильтров.

#### <a name="use-the-basic-filters"></a>Использование основных фильтров

Чтобы использовать основные фильтры, разверните параметр _типы событий_ и установите флажки, соответствующие событиям, которые вы хотите отправить в конечную точку. 

:::row:::
    :::column:::
        :::image type="content" source="media/how-to-manage-routes-portal/create-event-route-filter-basic-1.png" alt-text="Снимок экрана создания маршрута события с базовым фильтром. Установка флажков событий.":::
    :::column-end:::
    :::column:::
    :::column-end:::
:::row-end:::

При этом текстовое поле фильтра будет автоматически заполнено текстом выбранного фильтра:

:::row:::
    :::column:::
        :::image type="content" source="media/how-to-manage-routes-portal/create-event-route-filter-basic-2.png" alt-text="Снимок экрана создания маршрута события с базовым фильтром. Отображение автоматически заполняемого текста фильтра после выбора событий.":::
    :::column-end:::
    :::column:::
    :::column-end:::
:::row-end:::

#### <a name="use-the-advanced-filters"></a>Использование расширенных фильтров

Кроме того, можно использовать параметр Расширенный фильтр для создания собственных настраиваемых фильтров.

Чтобы создать маршрут события с дополнительными параметрами фильтра, переключите его в _Расширенный редактор_ , чтобы включить его. Затем можно написать собственные фильтры событий в поле *фильтра* :

:::row:::
    :::column:::
        :::image type="content" source="media/how-to-manage-routes-portal/create-event-route-filter-advanced.png" alt-text="Снимок экрана создания маршрута события с расширенным фильтром.":::
    :::column-end:::
    :::column:::
    :::column-end:::
:::row-end:::

Ниже приведены поддерживаемые фильтры маршрутов. Сведения в столбце *схема текста фильтра* — это текст, который можно указать в поле фильтра.

[!INCLUDE [digital-twins-route-filters](../../includes/digital-twins-route-filters.md)]

[!INCLUDE [digital-twins-route-metrics](../../includes/digital-twins-route-metrics.md)]

## <a name="next-steps"></a>Дальнейшие шаги

Сведения о различных типах сообщений о событиях, которые можно получить:
* [*Пошаговое руководство. анализ данных события*](how-to-interpret-event-data.md)
