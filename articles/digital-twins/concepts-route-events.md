---
title: Маршрутизация событий
titleSuffix: Azure Digital Twins
description: Узнайте, как маршрутизировать события в Azure Digital двойников и в другие службы Azure.
author: baanders
ms.author: baanders
ms.date: 3/12/2020
ms.topic: conceptual
ms.service: digital-twins
ms.openlocfilehash: 7c1f0c18fc8b867e16ce539a24839637e1d14379
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "85390794"
---
# <a name="route-events-within-and-outside-of-azure-digital-twins"></a>Маршрутизация событий внутри и за пределами Azure Digital двойников

Azure Digital двойников использует **маршруты событий** для отправки данных потребителям за пределами службы. 

Во время действия предварительной версии существует два основных варианта отправки данных Azure Digital двойников:
* Отправка данных из одного двойника в графе Azure Digital двойников на другой. Например, при изменении свойства одного цифрового двойника может потребоваться уведомление и обновление другого цифрового двойника соответствующим образом.
* Отправка данных в службы нисходящих данных для дополнительного хранения или обработки (также известной как исходящие *данные*). Например,
  - В больницы может потребоваться отправить данные событий Azure Digital двойников в службу ["аналитика временных рядов" (TSI)](../time-series-insights/time-series-insights-update-overview.md), чтобы записывать данные временных рядов событий, связанных с хандвашинг, для аналитики.
  - Компания, которая уже использует [Azure Maps](../azure-maps/about-azure-maps.md) , может использовать Azure Digital двойников для улучшения своих решений. Они могут быстро включить карту Azure после настройки Azure Digital двойников, перенести сущности в Azure Digital двойников в виде [цифровых двойников](concepts-twins-graph.md) в графе двойника или выполнять эффективные запросы, использующие их Azure Maps и данные Azure Digital двойников.

В обоих сценариях используются маршруты событий.

## <a name="about-event-routes"></a>О маршрутах событий

Маршрут событий позволяет отправить данные событий из Digital двойников в Azure Digital двойников в пользовательские конечные точки в подписках. Сейчас для конечных точек поддерживаются три службы Azure: [концентратор событий](../event-hubs/event-hubs-about.md), служба " [Сетка событий](../event-grid/overview.md)" и [служебная шина](../service-bus-messaging/service-bus-messaging-overview.md). Каждая из этих служб Azure может быть подключена к другим службам и выступает в качестве середины, отправляя данные в конечные назначения, такие как TSI или Azure Maps для любой необходимой обработки.

На следующей схеме показан поток данных событий с помощью более крупного решения Интернета вещей с аспектом Azure Digital двойников:

:::image type="content" source="media/concepts-route-events/routing-workflow.png" alt-text="Данные маршрутизации Azure Digital двойников через конечные точки для нескольких нижестоящих служб" border="false":::

Типичные нисходящие цели для маршрутов событий — это ресурсы, такие как TSI, Azure Maps, хранилища и аналитики.

### <a name="event-routes-for-internal-digital-twin-events"></a>Маршруты событий для внутренних событий Digital двойника

В текущем предварительном выпуске маршруты событий также используются для управления событиями в графе двойника и отправки данных из Digital двойника в Digital двойника. Это делается путем подключения маршрутов событий через службу "Сетка событий" к ресурсам для вычислений, таким как [функции Azure](../azure-functions/functions-overview.md). Затем эти функции определяют, как двойников должна принимать события и реагировать на них. 

Когда ресурсу вычислений требуется изменить граф двойника на основе события, полученного с помощью маршрута событий, полезно, чтобы он знал, какой двойника необходимо изменить заранее. 

Кроме того, сообщение о событии также содержит идентификатор источника двойника, отправившего сообщение, поэтому ресурсы вычислений могут использовать запросы или просматривать связи, чтобы найти целевой двойника для нужной операции. 

Ресурсу вычислений также необходимо установить разрешения безопасности и доступа независимо.

Чтобы проанализировать процесс настройки функции Azure для обработки событий Digital двойника, см. инструкции по [настройке функции Azure для обработки данных](how-to-create-azure-function.md).

## <a name="create-an-endpoint"></a>Создание конечной точки

Чтобы определить маршрут события, разработчики сначала должны определить конечные точки. **Конечная точка** — это назначение за пределами цифрового двойников Azure, которое поддерживает подключение маршрута. В текущем предварительном выпуске поддерживаются следующие назначения:
* Пользовательские разделы сетки событий
* Концентратор событий
* Cлужебная шина

Для установки конечных точек используются API-интерфейсы плоскости управления (поддерживаются интерфейсом [командной строки Azure Digital двойников](how-to-use-cli.md)или с помощью портал Azure. Определение конечной точки предоставляет:
* Имя конечной точки
* Тип конечной точки (сетка событий, концентратор событий или служебная шина)
* Основная строка подключения и вторичная строка подключения для проверки подлинности 
* Путь к разделу конечной точки, например *Your-Topic.westus2.eventgrid.Azure.NET*

Ниже перечислены API-интерфейсы конечных точек, доступные в плоскости управления.
* Создать конечную точку
* Получение списка конечных точек
* Получить конечную точку по имени
* Удалить конечную точку по имени

## <a name="create-an-event-route"></a>Создание маршрута события
 
Маршруты событий создаются в клиентском приложении с помощью следующего вызова [пакета SDK для .NET (C#)](how-to-use-apis-sdks.md) : 

```csharp
await client.EventRoutes.AddAsync("<name-for-the-new-route>", new EventRoute("<endpoint-name>"));
```

* `endpoint-name`Определяет конечную точку, например концентратор событий, службу "Сетка событий" или служебную шину. Эти конечные точки должны быть созданы в подписке и подключены к Azure Digital двойников с помощью API-интерфейсов плоскости управления перед выполнением этого вызова регистрации.

Объект маршрута события, переданный в `EventRoutes.Add` , также принимает [параметр **фильтра** ](./how-to-manage-routes.md#filter-events), который можно использовать для ограничения типов событий, которые следуют за данным маршрутом.

Маршруты также могут создаваться с помощью [интерфейса командной строки Azure Digital двойников](how-to-use-cli.md).

### <a name="types-of-event-messages"></a>Типы сообщений о событиях

Различные типы событий в центре Интернета вещей и Azure Digital двойников создают различные типы сообщений уведомлений, как описано ниже.

[!INCLUDE [digital-twins-notifications.md](../../includes/digital-twins-notifications.md)]

## <a name="next-steps"></a>Дальнейшие шаги

См. статью Настройка маршрута событий и управление им.
* [Руководство. Управление конечными точками и маршрутами](how-to-manage-routes.md)

Или см. статью использование функций Azure для маршрутизации событий в Azure Digital двойников:
* [Пошаговое руководство. Настройка функции Azure для обработки данных](how-to-create-azure-function.md)