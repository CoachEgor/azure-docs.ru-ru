---
title: Переместить экземпляр в другой регион Azure
titleSuffix: Azure Digital Twins
description: См. статью как переместить экземпляр Digital двойников для Azure из одного региона Azure в другой.
author: baanders
ms.author: baanders
ms.date: 08/26/2020
ms.topic: how-to
ms.custom: subject-moving-resources
ms.service: digital-twins
ms.openlocfilehash: 1725c3ff162e4f6b7ac3a5ea1ede6976c827b510
ms.sourcegitcommit: 32c521a2ef396d121e71ba682e098092ac673b30
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/25/2020
ms.locfileid: "91328502"
---
# <a name="move-an-azure-digital-twins-instance-to-a-different-azure-region"></a>Перемещение экземпляра Azure Digital двойников в другой регион Azure

Если вам нужно переместить экземпляр Digital двойников из одного региона в другой, текущий процесс заключается в **повторном создании ресурсов в новом регионе**, а затем удалении исходных ресурсов. В конце этого процесса вы будете работать с новым экземпляром Azure Digital двойников, который идентичен первому, за исключением обновленного расположения.

В этой статье содержатся инструкции по выполнению полного перемещения, копированию всех элементов, необходимых для того, чтобы новый экземпляр совпадал с исходным.

Этот процесс состоит из следующих шагов.
1. Подготовка: Скачайте исходные модели, двойников и Graph.
2. Перемещение. Создайте новый экземпляр Azure Digital двойников в новом регионе.
3. Переместить: повторно заполнить новый экземпляр Azure Digital двойников.
    - Загрузите исходные модели, двойников и Graph.
    - Повторное создание конечных точек и маршрутов.
    - Повторно свяжите подключенные ресурсы.
4. Очистка исходных ресурсов: удаление исходного экземпляра.

## <a name="prerequisites"></a>Предварительные требования

Прежде чем пытаться повторно создать экземпляр двойников для Azure Digital, рекомендуется переключиться на компоненты исходного экземпляра и получить четкое представление о всех фрагментах, которые потребуется создать заново.

Ниже приведены некоторые вопросы, которые следует учитывать.
* Какие **модели** передаются в мой экземпляр? Сколько?
* Что такое **двойников** в моем экземпляре? Сколько?
* Какова общая форма **графа** в своем экземпляре? Сколько связей?
* Какие **конечные точки** имеются в моем экземпляре?
* Какие **маршруты** имеются в моем экземпляре? У них есть фильтры?
* Где мой экземпляр **подключается к другим службам Azure**? Некоторые распространенные точки интеграции включают...
    - Служба "Сетка событий", концентратор событий или служебная шина
    - Функции Azure
    - Logic Apps
    - Аналитика временных рядов
    - Azure Maps
    - Служба подготовки устройств (DPS)
* Какие другие **персональные или корпоративные приложения** имеют подключение к моему экземпляру?

Эти сведения можно получить с помощью [портал Azure](https://portal.azure.com), [интерфейсов API и пакетов SDK](how-to-use-apis-sdks.md)для Azure Digital двойников, [команд интерфейса командной строки Azure Digital двойников](how-to-use-cli.md)или образца [обозревателя Digital двойников (ADT)](https://docs.microsoft.com/samples/azure-samples/digital-twins-explorer/digital-twins-explorer/) .

## <a name="prepare"></a>Подготовка

В этом разделе Вы подготовитесь к повторному созданию экземпляра путем **загрузки исходных моделей, двойников и Graph** из исходного экземпляра. Эта статья делает это с помощью примера [Azure Digital двойников (ADT) Explorer](https://docs.microsoft.com/samples/azure-samples/digital-twins-explorer/digital-twins-explorer/) .

>[!NOTE]
>Возможно, у вас уже есть файлы, содержащие модели и (или) граф в вашем экземпляре. В этом случае вам не нужно загружать все заново — просто отсутствующие элементы или элементы, которые могли быть изменены после первоначальной отправки этих файлов (например, двойников, которые могли быть обновлены новыми данными).

### <a name="limitations-of-adt-explorer"></a>Ограничения обозревателя ADT

[Образец Azure Digital двойников (ADT) Explorer](https://docs.microsoft.com/samples/azure-samples/digital-twins-explorer/digital-twins-explorer/) — это пример клиентского приложения, который поддерживает визуальное представление графа и обеспечивает визуальное взаимодействие с вашим экземпляром. В этой статье показано, как использовать ее для скачивания и последующей повторной отправки, моделей, двойников и графов.

Однако обратите внимание, что это **Пример** и не полный инструмент. Она не была протестирована и не была построена для работы с диаграммами большого размера. Поэтому имейте в виду следующие встроенные ограничения:
* В настоящее время пример был протестирован только на диаграммах размером до 1000 узлов и 2000 связей.
* Пример не поддерживает повторную попытку в случае периодического сбоя.
* Пример не обязательно уведомляет пользователя, если отправленные данные неполны.
* Образец не обрабатывает ошибки, возникающие из очень больших графов, превышающих доступные ресурсы, например память.

Если образец не способен справиться с размером графа, вы можете экспортировать и импортировать граф с помощью других средств разработчика Digital двойников для Azure:
* [Команды интерфейса командной строки Azure Digital двойников](how-to-use-cli.md)
* [Интерфейсы API и пакеты SDK для цифровых двойников Azure](how-to-use-apis-sdks.md)

### <a name="set-up-adt-explorer-application"></a>Настройка приложения ADT Explorer

Чтобы продолжить работу с обозревателем ADT, сначала Скачайте пример кода приложения и настройте его для запуска на вашем компьютере. 

Перейдите к примеру: [Azure Digital двойников (ADT) Explorer](https://docs.microsoft.com/samples/azure-samples/digital-twins-explorer/digital-twins-explorer/). Нажмите кнопку *Download ZIP* (Загрузить ZIP-файл), чтобы загрузить файл *ZIP* этого примера кода на свой компьютер с именем _**ADT_Explorer.zip**_. Распакуйте файл.

Затем настройте разрешения для запуска обозревателя ADT на компьютере. Для этого выполните действия, описанные в разделе " [*Настройка разрешений ОБОЗРЕВАТЕЛЯ ADT*](quickstart-adt-explorer.md#set-adt-explorer-permissions) " руководства по цифровому двойников Azure.

Наконец, запустите и настройте обозреватель ADT для подключения к исходному экземпляру Azure Digital двойников. Выполните действия, описанные в разделе [*Запуск и настройка ОБОЗРЕВАТЕЛЯ ADT*](quickstart-adt-explorer.md#run-and-configure-adt-explorer) в кратком руководстве.

Теперь вы должны запустить пример приложения ADT Explorer в браузере на своем компьютере. Пример должен быть подключен к исходному экземпляру Azure Digital двойников.

:::image type="content" source="media/how-to-move-regions/explorer-blank.png" alt-text="Окно браузера, в котором отображается приложение, запущенное на localhost:3000. Приложение называется ADT Explorer и содержит поля для обозревателя запросов, представления модели, представления графа и обозревателя свойств. Данных на экране пока нет." lightbox="media/how-to-move-regions/explorer-blank.png":::

Чтобы проверить соединение, можно нажать кнопку *выполнить запрос* , чтобы запустить запрос по умолчанию, отображающий все двойников и связи в графе в окне *Обозреватель графов* .

:::image type="content" source="media/how-to-move-regions/run-query.png" alt-text="Выделенная кнопка "Выполнить запрос" рядом с верхней частью окна" lightbox="media/how-to-move-regions/run-query.png":::

Можно оставить обозреватель ADT запущенным, так как он будет использоваться позже в этой статье для повторной отправки этих элементов в новый экземпляр в целевом регионе.

### <a name="download-models-twins-and-graph"></a>Загрузка моделей, двойников и Graph

Затем скачайте модели, двойников и Graph в свое решение на компьютер.

Чтобы загрузить все эти данные одновременно, сначала убедитесь, что в поле *представление графа* отображается полный график (это можно сделать, перезапустив запрос по умолчанию `SELECT * FROM digitaltwins` в окне *Обозреватель запросов* ).
 
Затем нажмите значок " *Экспорт графа* " в поле *представления графа* .

:::image type="content" source="media/how-to-move-regions/export-graph.png" alt-text="В поле представление графа выделяется значок. Отображается стрелка, указывающая за пределы облака." lightbox="media/how-to-move-regions/export-graph.png":::

Это позволит включить ссылку для *скачивания* в *представлении графа*. Выберите его, чтобы скачать представление результатов запроса на основе JSON, включая модели, двойников и связи. Это необходимо для загрузки *JSON* -файла на компьютер.

>[!NOTE]
>Если скачанный файл имеет другое расширение, попробуйте изменить расширение напрямую и измените его на *JSON*.

## <a name="move"></a>Переместить

Далее предстоит выполнить "перемещение" экземпляра, создав новый экземпляр в целевом регионе и заполнив его данными и компонентами из исходного экземпляра.

### <a name="create-a-new-instance"></a>Создание нового экземпляра

Сначала **Создайте новый экземпляр Azure Digital двойников в целевом регионе**. Для этого выполните действия, описанные в разделе [*как настроить экземпляр и проверку подлинности*](how-to-set-up-instance-portal.md), сохранив следующие указатели:
* Вы можете использовать одно и то же имя для нового экземпляра, **Если** он находится в другой группе ресурсов. Если необходимо использовать ту же группу ресурсов, которая содержит исходный экземпляр, то новому экземпляру потребуется собственное уникальное имя.
* Введите целевой новый регион при появлении запроса на расположение.
* Повторное создание регистрации приложения **не требуется** . Новый экземпляр может повторно использовать уже имеющуюся регистрацию приложения.
    - При использовании статьи настройки в [сценарии](how-to-set-up-instance-scripted.md) можно повторно ввести сведения о существующей регистрации приложения вместо ввода нового имени при появлении соответствующего запроса.
    - Если вы используете статьи ручной настройки [портала](how-to-set-up-instance-portal.md) или установки [CLI](how-to-set-up-instance-cli.md) , вы можете прерывать работу после *создания экземпляра Azure Digital двойников* и *настройки прав доступа пользователей* . Не нужно продолжать *настраивать разрешения доступа для клиентских приложений*.

После этого вам потребуется **имя узла** нового экземпляра, чтобы продолжить настройку данных. Если вы не записали это во время установки, можно выполнить следующие [инструкции](how-to-set-up-instance-portal.md#verify-success-and-collect-important-values) , чтобы получить его из портал Azure.

### <a name="repopulate-old-instance"></a>Повторить заполнение старого экземпляра

Далее вы настроите новый экземпляр, чтобы он был копией исходного.

#### <a name="upload-original-models-twins-and-graph-using-adt-explorer"></a>Отправка исходных моделей, двойников и Graph с помощью обозревателя ADT

В этом разделе вы можете повторно загрузить модели, двойников и Graph в новый экземпляр. Если в исходном экземпляре отсутствуют модели, двойников или графики, или вы не хотите перемещать их в новый экземпляр, можно перейти к [следующему разделу](#recreate-endpoints-and-routes).

В противном случае, чтобы продолжить, вернитесь в окно браузера, в котором работает **Обозреватель ADT** , и выполните следующие действия.

##### <a name="connect-to-the-new-instance"></a>Подключиться к новому экземпляру

В настоящее время ADT Explorer подключен к исходному экземпляру Azure Digital двойников. Переключите подключение, чтобы оно указывало на новый экземпляр, нажав кнопку *Вход в* верхней части окна. 

:::image type="content" source="media/how-to-move-regions/sign-in.png" alt-text="ADT Explorer с выделенным значком "Войти" в верхней части окна. На значке изображен простой силуэт человека, перекрытый силуэтом ключа." lightbox="media/how-to-move-regions/sign-in.png":::

Так как вы повторно используете регистрацию приложения, необходимо заменить *URL-адрес ADT*. Измените это значение на "чтение *https://{новое имя узла}*".

Нажмите *подключить*. Возможно, вам будет предложено снова войти в систему с учетными данными Azure и/или предоставить согласие на это приложение для вашего экземпляра.

##### <a name="upload-models-twins-and-graph"></a>Передача моделей, двойников и Graph

Затем передайте компоненты решения, скачанные ранее, в новый экземпляр.

Чтобы передать **модели, двойников и Graph**, нажмите значок *Импорт графа* в поле *представление графа* . Этот параметр отправит все три из этих компонентов одновременно (даже модели, которые в данный момент не используются в графе).

:::image type="content" source="media/how-to-move-regions/import-graph.png" alt-text="В окне "Представление графа" выделен значок. В нем отображается стрелка, указывающая на облако." lightbox="media/how-to-move-regions/import-graph.png":::

В поле выбора файла перейдите к загруженному графу. Выберите файл Graph *. JSON* и нажмите кнопку *Открыть*.

Через несколько секунд ADT Explorer откроет представление *Импорт*, в котором отображается предварительный просмотр загружаемого графа.

Чтобы подтвердить отправку графа, щелкните значок *Сохранить* в правом верхнем углу *ПРЕДСТАВЛЕНИЕ ГРАФА*:

:::row:::
    :::column:::
        :::image type="content" source="media/how-to-move-regions/graph-preview-save.png" alt-text="Выделенный значок "Сохранить" на панели предварительного просмотра графа" lightbox="media/how-to-move-regions/graph-preview-save.png":::
    :::column-end:::
    :::column:::
    :::column-end:::
:::row-end:::

ADT Explorer теперь будет отправлять модели и графы (включая двойников и связи) в новый экземпляр Azure Digital двойников. Вы должны увидеть сообщение об успешном выполнении, указывающее, сколько моделей, двойников и связей было отправлено:

:::row:::
    :::column:::
        :::image type="content" source="media/how-to-move-regions/import-success.png" alt-text="Диалоговое окно, указывающее на успешность импорта графа. Он считывает "Импорт выполнен успешно. 2 импортированные модели. 4 двойников импортированы. два импортированных отношения. "" lightbox="media/how-to-move-regions/import-success.png":::
    :::column-end:::
    :::column:::
    :::column-end:::
    :::column:::
    :::column-end:::
:::row-end:::

Чтобы убедиться, что все отправлено успешно, нажмите кнопку *выполнить запрос* в окне *Graph Explorer* , чтобы запустить запрос по умолчанию, отображающий все двойников и связи в графе. Это также приведет к обновлению списка моделей в *представлении модели*.

:::image type="content" source="media/how-to-move-regions/run-query.png" alt-text="Обратите внимание на ту же кнопку "выполнить запрос", расположенную ранее, в верхней части окна" lightbox="media/how-to-move-regions/run-query.png":::

Вы должны увидеть граф со всеми ее двойниковми и связями, отображаемыми в окне *Обозреватель графов* . Вы также должны увидеть модели, перечисленные в поле *представление модели* .

:::image type="content" source="media/how-to-move-regions/post-upload.png" alt-text="Представление обозревателя ADT, отображающее 2 модели, выделенные в поле "представление модели", и диаграмму, выделенную в поле "Обозреватель диаграмм"" lightbox="media/how-to-move-regions/post-upload.png":::

Это подтверждает, что модели, двойников и Graph были повторно переданы в новый экземпляр в целевом регионе.

#### <a name="recreate-endpoints-and-routes"></a>Повторное создание конечных точек и маршрутов

Если в исходном экземпляре имеются **конечные точки или маршруты** , их необходимо создать заново в новом экземпляре. Если в исходном экземпляре нет конечных точек или маршрутов или вы не хотите перемещать их в новый экземпляр, можно перейти к [следующему разделу](#re-link-connected-resources).

В противном случае продолжайте выполнять действия, описанные в разделе « [*инструкции. Управление конечными точками и маршрутами*](how-to-manage-routes-portal.md) с помощью нового экземпляра», сохраняя следующие указатели: 
* Вам **не нужно** повторно создавать службу "Сетка событий", "концентратор событий" или ресурс служебной шины, которые используются для конечной точки (*необходимые компоненты* в инструкциях конечной точки). Необходимо только повторно создать конечную точку в экземпляре Digital двойников для Azure.
* Можно повторно использовать конечные точки и **имена**маршрутов, так как они находятся в разных экземплярах.
* Не забудьте добавить необходимые **фильтры** к создаваемым маршрутам.

#### <a name="re-link-connected-resources"></a>Повторное связывание подключенных ресурсов

Если у вас есть другие приложения или ресурсы Azure, подключенные к исходному экземпляру Azure Digital двойников, необходимо изменить подключение, чтобы они достигли нового экземпляра. Это могут быть другие службы Azure, персональные или корпоративные приложения, настроенные для работы с Azure Digital двойников.

Если у вас нет других ресурсов, подключенных к исходному экземпляру, или вы не хотите перемещать их на новый экземпляр, можно перейти к [следующему разделу](#verify).

В противном случае для продолжения рассмотрим подключенные ресурсы в вашем сценарии. Нет необходимости удалять и повторно создавать подключенные ресурсы; Вместо этого нужно просто изменить точки, в которых они подключаются к экземпляру Azure Digital двойников через свое **имя узла**, и обновить его, чтобы использовать имя узла нового экземпляра вместо исходного.

Конкретные ресурсы, которые необходимо изменить, зависят от вашего сценария, но вот некоторые распространенные точки интеграции:
* Функции Azure. Если у вас есть функция Azure, код которой включает имя узла исходного экземпляра, следует изменить это значение на имя узла нового экземпляра и повторно опубликовать функцию.
* Сетка событий, концентраторы событий или служебная шина
* Logic Apps
* Аналитика временных рядов
* Azure Maps
* Служба подготовки устройств (DPS)
* Личные или корпоративные приложения за пределами Azure, такие как **клиентское приложение** , созданное в [*руководстве: создание кода клиентского приложения*](tutorial-code.md), которое подключается к экземпляру и вызов интерфейсов API цифровых двойников Azure.

После завершения этого шага новый экземпляр в целевом регионе должен быть копией исходного экземпляра.

## <a name="verify"></a>Проверка

Чтобы убедиться, что новый экземпляр настроен правильно, можно использовать следующие средства:
* [**Портал Azure**](https://portal.azure.com) (хорошо проверять, существует ли новый экземпляр и находится ли он в правильном целевом регионе; также подходит для проверки конечных точек и маршрутов и подключений к другим службам Azure).
* [ **Команды интерфейса командной строки** Azure Digital двойников](how-to-use-cli.md) (позволяют проверить, существует ли новый экземпляр и находится ли он в правильном целевом регионе; также можно использовать для проверки данных экземпляра).
* [**Обозреватель ADT**](https://docs.microsoft.com/samples/azure-samples/digital-twins-explorer/digital-twins-explorer/) (подходит для проверки данных экземпляра, таких как модели, двойников и Graph)
* [Интерфейсы API и пакеты SDK для цифровых двойников Azure](how-to-use-apis-sdks.md) (хорошо для проверки данных экземпляра, таких как модели, двойников и Graph) также хорошо подходят для проверки конечных точек и маршрутов).

Вы также можете попытаться запустить любые пользовательские приложения или сквозные потоки, которые работали с исходным экземпляром, чтобы убедиться, что они правильно работают с новым экземпляром.

## <a name="clean-up-source-resources"></a>Очистка исходных ресурсов

Теперь, когда новый экземпляр настроен в целевом регионе с копией данных и подключений исходного экземпляра, можно **удалить исходный экземпляр**.

Это можно сделать в [портал Azure](https://portal.azure.com), с помощью [интерфейса командной строки](how-to-use-cli.md)или [API-интерфейсов плоскости управления](how-to-use-apis-sdks.md#overview-control-plane-apis).

Чтобы удалить экземпляр с помощью портал Azure, [откройте портал](https://portal.azure.com) в окне браузера и перейдите к исходному экземпляру Azure Digital двойников, выполнив поиск по имени на панели поиска портала.

Нажмите кнопку *Удалить* и следуйте инструкциям на экране, чтобы завершить удаление.

:::image type="content" source="media/how-to-move-regions/delete-instance.png" alt-text="Просмотрите сведения об экземпляре Digital двойников для Azure в портал Azure на вкладке Обзор. Кнопка "Удалить" выделена":::