---
title: Руководство по развертыванию Azure Digital Twins
description: В этом руководстве вы узнаете, как развертывать экземпляр Azure Digital Twins и настроить пространственные ресурсы.
services: digital-twins
ms.author: alinast
author: alinamstanciu
manager: bertvanhoof
ms.custom: seodec18
ms.service: digital-twins
ms.topic: tutorial
ms.date: 11/12/2019
ms.openlocfilehash: 4d4e7e47b82c46cca53fab0540a4867031eaab85
ms.sourcegitcommit: 598c5a280a002036b1a76aa6712f79d30110b98d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/15/2019
ms.locfileid: "74107739"
---
# <a name="tutorial-deploy-azure-digital-twins-preview-and-configure-a-spatial-graph"></a>Руководство по развертыванию Azure Digital Twins (предварительная версия) и настройке пространственного графа

Служба Azure Digital Twins (предварительная версия) позволяет объединять людей, места и устройства в связанной пространственной системе. В руководствах этой серии показано, как с помощью Azure Digital Twins определять степень заполненности помещения, а также оптимальные условия температуры и качества воздуха. 

В этих руководствах рассматривается консольное приложение .NET, которое позволяет реализовать сценарий офисного здания. В здании есть несколько этажей с комнатами на каждом из них. В комнатах есть устройства с прикрепленными датчиками, которые фиксируют движение, температуру окружающей среды и качество воздуха. 

Вы узнаете, как копировать физические области и объекты здания в виде цифровых объектов, используя службу Azure Digital Twins. Вы будете имитировать события устройства, используя другое консольное приложение. Затем вы узнаете, как отслеживать события, происходящие в этих физических областях и объектах, практически в реальном времени. 

Полагаясь на эту информацию, администратор офиса может помочь сотруднику, работающему в этом здании, забронировать конференц-залы с оптимальными условиями. Менеджер офисных помещений может использовать ваш экземпляр настройки для определения тенденций использования помещений, а также для контроля условий работы в целях технического обслуживания.

В первом руководстве этой серии вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Развертывание Digital Twins.
> * Предоставление разрешений приложению.
> * Изменение примера приложения Digital Twins.
> * Подготовка сборки.

В этих руководствах для более детального и глубокого освещения концепций используются и изменяются те же примеры, что и [в руководстве по обнаружению свободных комнат](quickstart-view-occupancy-dotnet.md).

## <a name="prerequisites"></a>Предварительные требования

- Подписка Azure. Если у вас нет учетной записи, вы можете создать [бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).

- Пакет SDK для .NET Core. Примеры Azure Digital Twins, используемые в этих руководствах, написаны на C#. Убедитесь, что установили [пакет SDK для .NET Core версии 2.1.403 или более поздней](https://www.microsoft.com/net/download) на компьютере разработки. Он нужен для выполнения сборки и запуска примера. Проверьте, установлена ​​ли на вашем компьютере правильная версия, запустив `dotnet --version` в окне команд.

- [Visual Studio Code](https://code.visualstudio.com/) для изучения примера кода. 

## <a name="deploy-digital-twins"></a>развертывание Azure Digital Twins;

Используйте шаги в этом разделе, чтобы создать новый экземпляр службы Azure Digital Twins. Можно создать только один экземпляр на подписку. Если у вас уже есть работающий экземпляр, перейдите к следующему разделу. 

[!INCLUDE [create-digital-twins-portal](../../includes/digital-twins-create-portal.md)]

## <a name="grant-permissions-to-your-app"></a>предоставление разрешений приложению;

Служба Digital Twins использует [Azure Active Directory](../active-directory/fundamentals/active-directory-whatis.md) (Azure AD) для управления [доступом на чтение и запись](../active-directory/develop/v1-permissions-and-consent.md) к службе. Любое приложение, которое будет подключаться к вашему экземпляру Digital Twins, должно быть зарегистрировано в Azure AD. В этом разделе показано, как зарегистрировать пример приложения.

Если у вас уже есть зарегистрированное приложение, вы можете повторно использовать его для своего примера. Однако просмотрите этот раздел, чтобы убедиться, что регистрация вашего приложения настроена правильно.

[!INCLUDE [digital-twins-permissions](../../includes/digital-twins-permissions.md)]

## <a name="configure-the-digital-twins-sample"></a>Настройка примера Digital Twins

В этом разделе рассматривается приложение Azure Digital Twins, которое обменивается данными с [REST API Digital Twins](https://docs.westcentralus.azuresmartspaces.net/management/swagger/ui/index). 

### <a name="download-the-sample"></a>Скачивание примера приложения

Если вы уже скачали примеры для руководства [по обнаружению свободных комнат](quickstart-view-occupancy-dotnet.md), то можете пропустить эти шаги.

1. Скачайте [примеры Digital Twins на .NET](https://github.com/Azure-Samples/digital-twins-samples-csharp/archive/master.zip).
2. Извлеките содержимое папки ZIP на свой компьютер.

### <a name="explore-the-sample"></a>Анализ примера

В извлеченной папке с примерами откройте файл **digital-twins-samples-csharp\digital-twins-samples.code-workspace** в Visual Studio Code. Этот файл содержит два проекта:

* Вы можете использовать пример подготовки **occupancy-quickstart** для настройки и подготовки [пространственного интеллектуального графа](concepts-objectmodel-spatialgraph.md#digital-twins-object-models). Этот граф представляет собой цифровое изображение физических пространств и ресурсов в них. В этом примере используется [объектная модель](concepts-objectmodel-spatialgraph.md#digital-twins-object-models), которая определяет объекты для интеллектуального здания. Полный список объектов Digital Twins и интерфейсов REST API см. в [этой документации по REST API](https://docs.westcentralus.azuresmartspaces.net/management/swagger) или по URL-адресу API управления, который был создан для [вашего экземпляра](#deploy-digital-twins).

   Чтобы изучить пример и увидеть, как он связывается с имеющимся экземпляром Digital Twins, можно начать с папки **src\actions**. Файлы в этой папке реализуют команды, которые вы будете использовать в этих руководствах:
    - Файл **provisionSample.cs** показывает, как подготовить пространственный граф.
    - Файл **getSpaces.cs** получает информацию о подготовленных помещениях.
    - Файл **getAvailableAndFreshSpaces.cs** получает результаты пользовательской функции.
    - Файл **createEndpoints.cs** создает конечные точки для взаимодействия с другими службами.

* Пример моделирования **device-connectivity** имитирует данные датчиков и отправляет их в центр Интернета вещей, подготовленный для вашего экземпляра Digital Twins. Вы будете использовать этот пример в [следующем руководстве после подготовки пространственного графа](tutorial-facilities-udf.md#simulate-sensor-data). Идентификаторы датчиков и устройств, используемые для настройки этого примера, должны быть такими же, как и для вашего графа.

### <a name="configure-the-provisioning-sample"></a>Настройка подготовленного примера

1. Откройте окно команд и перейдите к скачанному примеру. Выполните следующую команду:

    ```cmd/sh
    cd occupancy-quickstart/src
    ```

1. Восстановите зависимости в примере проекта, выполнив эту команду:

    ```cmd/sh
    dotnet restore
    ```

1. В Visual Studio Code откройте файл [appSettings.json](https://github.com/Azure-Samples/digital-twins-samples-csharp/blob/master/occupancy-quickstart/src/appSettings.json) в проекте **occupancy-quickstart**. Обновите следующие значения:
   * **ClientId:** введите идентификатор приложения из регистрации приложения Azure AD. Вы записали этот идентификатор в разделе, в котором [устанавливали разрешения приложения](#grant-permissions-to-your-app).
   * **Tenant:** введите идентификатор каталога своего [клиента Azure AD](https://docs.microsoft.com/azure/active-directory/develop/quickstart-create-new-tenant). Вы также записали этот идентификатор в разделе, в котором [устанавливали разрешения приложения](#grant-permissions-to-your-app).
   * **BaseUrl:** введите URL-адрес экземпляра Digital Twins. Чтобы получить этот URL-адрес, замените заполнители в этом URL-адресе значениями для вашего экземпляра: `https://yourDigitalTwinsName.yourLocation.azuresmartspaces.net/management/api/v1.0/`. Вы также можете получить этот URL-адрес, изменив URL-адрес API управления, указанный в [разделе развертывания](#deploy-digital-twins). Замените **swagger/** на **api/v1.0/** .

1. Просмотрите список функций Digital Twins, которые вы можете исследовать с помощью примера. Выполните следующую команду:

    ```cmd/sh
    dotnet run
    ```

## <a name="understand-the-provisioning-process"></a>Сведения о процессе подготовки

В этом разделе показано, как пример положения подготавливает пространственный граф здания.

В Visual Studio Code перейдите в папку **occupancy-quickstart\src\actions** и откройте файл **provisionSample.cs**. Обратите внимание на следующую функцию:

```csharp
public static async Task<IEnumerable<ProvisionResults.Space>> ProvisionSample(HttpClient httpClient, ILogger logger)
{
    IEnumerable<SpaceDescription> spaceCreateDescriptions;
    using (var r = new StreamReader("actions/provisionSample.yaml"))
    {
        spaceCreateDescriptions = await GetProvisionSampleTopology(r);
    }

    var results = await CreateSpaces(httpClient, logger, spaceCreateDescriptions, Guid.Empty);

    Console.WriteLine($"Completed Provisioning: {JsonConvert.SerializeObject(results, Formatting.Indented)}");

    return results;
}

```

Эта функция использует файл [provisionSample.yaml](https://github.com/Azure-Samples/digital-twins-samples-csharp/blob/master/occupancy-quickstart/src/actions/provisionSample.yaml) в той же папке. Откройте этот файл и обратите внимание на иерархию офисного здания: *место проведения*, *этаж*, *область* и *комнаты*. В любой из этих физических областей могут быть *устройства* и *датчики*. Каждая запись содержит предопределенный тип (`type`), например Floor (Этаж), Room (Комната).

В файле **yaml** показан пространственный граф, использующий объектную модель Digital Twins `Default`. Эта модель предоставляет универсальные имена для большинства типов, чего вполне достаточно для здания. Например, Temperature для SensorDataType, Map для SpaceBlobType и Room с подтипами FocusRoom, ConferenceRoom и т. д. для типов пространств. 

Если вам нужно создать пространственный граф для другого типа помещения, например фабрики, вам может потребоваться другая объектная модель. Можно выяснить, какие модели доступны для использования, выполнив команду `dotnet run GetOntologies` в командной строке в примере подготовки. 

Дополнительные сведения о пространственных графах и объектных моделях Digital Twins см. в [этой статье](concepts-objectmodel-spatialgraph.md).

### <a name="modify-the-sample-spatial-graph"></a>Изменение примера пространственного графа

Файл **provisionSample.yaml** содержит следующие узлы:

- **resources:** узел `resources` создает ресурс Центра Интернета вещей для взаимодействия с устройствами в вашем экземпляре настройки. Центр Интернета вещей в корневом узле графа может взаимодействовать со всеми устройствами и датчиками в графе.  

- **spaces:** в объектной модели Digital Twins объект `spaces` представляет физические расположения. Каждое пространство имеет тип (`Type`), например Region (Регион), Venue (Место проведения) или Customer (Клиент), и понятное имя (`Name`). Пространства могут принадлежать другим пространствам, в связи с чем формируется иерархическая структура. Файл provisionSample.yaml имеет пространственный граф воображаемого здания. Обратите внимание на логические вложения пространств типа `Floor` в `Venue`, `Area` на этаже и узлы `Room` в области. 

- **devices:** пространства могут содержать объекты `devices` (устройства), которые являются физическими или виртуальными сущностями, управляющими рядом датчиков. Например, устройством может быть телефон пользователя, датчик Raspberry Pi или шлюз. В воображаемом здании в вашем примере комната с названием **Focus Room** содержит **устройство Raspberry Pi 3 A1**. Каждый узел устройства определяется уникальным идентификатором `hardwareId`, который жестко задан в примере. Чтобы настроить этот пример для фактической рабочей среды, замените их на значения из вашего экземпляра настройки.  

- **sensors:** устройство может содержать несколько датчиков (`sensors`). Они могут обнаруживать и записывать изменения физических показателей, таких как температура, движение, уровень заряда батареи. Каждый узел датчика определяется уникальным идентификатором `hardwareId`, который жестко задан в примере. Для реального приложения замените их уникальными идентификаторами датчиков в вашем экземпляре настройки. Файл provisionSample.yaml содержит два датчика для записи: *Motion* и *CarbonDioxide*. Добавьте еще один датчик для регистрации *Temperature*, добавив следующие строки под строками для датчика CarbonDioxide. Обратите внимание, что они предоставлены в файле provisionSample.yaml в виде закомментированных строк. Чтобы раскомментировать их, удалите символ `#` в начале каждой строки. 

    ```yaml
            - dataType: Temperature
              hardwareId: SAMPLE_SENSOR_TEMPERATURE
    ```
    > [!NOTE]
    > Убедитесь, что ключи `dataType` и `hardwareId` совпадают с инструкциями над этим фрагментом кода. Кроме того, проверьте, что ваш редактор не заменяет пространства символами табуляции. 

Сохраните и закройте файл provisionSample.yaml. В следующем руководстве вы добавите дополнительную информацию в этот файл, а затем подготовите пример здания Azure Digital Twins.

> [!TIP]
> Вы можете просмотреть и изменить пространственный граф с помощью [средства просмотра графов Azure Digital Twins](https://github.com/Azure/azure-digital-twins-graph-viewer).

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы хотите прекратить изучение Azure Digital Twins на этом этапе, можете удалить ресурсы, созданные во время работы с этим руководством:

1. На [портале Azure](https://portal.azure.com) в меню слева щелкните **Все ресурсы**, выберите группу ресурсов Digital Twins, а затем щелкните **Удалить**.

    > [!TIP]
    > Если при удалении экземпляра Digital Twins у вас возникла проблема, запустите обновление службы, в котором эта проблема исправлена. Затем повторите попытку удалить свой экземпляр.

1. При необходимости удалите пример приложения на компьютере.

## <a name="next-steps"></a>Дополнительная информация

Чтобы узнать, как реализовать пользовательскую логику для мониторинга условий в вашем примере здания, перейдите к следующему руководству в серии: 
> [!div class="nextstepaction"]
> [Руководство по подготовке примера здания и мониторинге условий работы с помощью Azure Digital Twins](tutorial-facilities-udf.md)