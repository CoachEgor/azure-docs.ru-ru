---
title: Руководство по Анализ событий в службе "Аналитика временных рядов" — Azure Digital Twins | Документация Майкрософт
description: В этом руководстве вы узнаете, как визуализировать и анализировать события из пространств Azure Digital Twins с помощью Аналитики временных рядов Azure.
services: digital-twins
ms.author: alinast
author: alinamstanciu
manager: bertvanhoof
ms.custom: seodec18
ms.service: digital-twins
ms.topic: tutorial
ms.date: 11/12/2019
ms.openlocfilehash: cab13fd65e9fdbd7179e6ba759b1aa696ef95fa1
ms.sourcegitcommit: 76b48a22257a2244024f05eb9fe8aa6182daf7e2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/03/2019
ms.locfileid: "74790330"
---
# <a name="tutorial-visualize-and-analyze-events-from-azure-digital-twins-by-using-time-series-insights"></a>Руководство по визуализации и анализу событий Azure Digital Twins с помощью Аналитики временных рядов

После развертывания экземпляра Azure Digital Twins, подготовки пространств и реализации пользовательской функции для мониторинга определенных условий вы можете визуализировать события и данные, поступающие из ваших пространств, чтобы найти тенденции и аномалии.

В [первом руководстве](tutorial-facilities-setup.md) вы настроили пространственный граф воображаемого здания с комнатой, где присутствуют датчики движения, углекислого газа и температуры. Во [втором руководстве](tutorial-facilities-udf.md) вы подготовили граф и определяемую пользователем функцию. Функция отслеживает значениях этих датчиков и активирует уведомления для правильных условий, таких как пустое помещение, нормальные уровни температуры и углекислого газа.

В этом руководстве показано, как интегрировать уведомления и данные, поступающие из экземпляра Azure Digital Twins c Аналитикой временных рядов Azure. Затем вы можете визуализировать значения датчиков за период времени и определить такие тенденции: какая комната чаще всего используется, какое время дня самое загруженное. Вы также можете обнаружить аномалии, например какие комнаты кажутся более душными и жаркими или присутствует ли в здании область, которая постоянно отправляет высокие значения температуры, что указывает на неисправное кондиционирование воздуха.

Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Потоковая передача данных с помощью Центров событий Azure.
> * Анализ с помощью Аналитики временных рядов.

## <a name="prerequisites"></a>Предварительные требования

В этом руководстве предполагается, что вы [настроили](tutorial-facilities-setup.md) и [подготовили](tutorial-facilities-udf.md) экземпляр Azure Digital Twins. Прежде чем продолжить, убедитесь, что у вас есть:

- [Учетная запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).
- Работающий экземпляр Digital Twins.
- [Примеры Digital Twins на C#](https://github.com/Azure-Samples/digital-twins-samples-csharp), скачанные и извлеченные на ваш рабочий компьютер.
- [Пакет SDK для .NET Core версии 2.1.403 или более поздней](https://www.microsoft.com/net/download) на компьютере разработки. Он нужен для запуска примера. Выполните команду `dotnet --version`, чтобы проверить, установлена ли необходимая версия.

> [!TIP]
> При подготовке нового экземпляра присвойте уникальное имя экземпляру Digital Twins.

## <a name="stream-data-by-using-event-hubs"></a>Потоковая передача данных с помощью Центров событий

Вы можете использовать службу [Центры событий](../event-hubs/event-hubs-about.md), чтобы создать конвейер для потоковой передачи данных. В этом разделе показано, как создать концентратор событий в качестве соединителя между экземплярами Azure Digital Twins и Аналитики временных рядов.

### <a name="create-an-event-hub"></a>Создание концентратора событий

1. Войдите на [портале Azure](https://portal.azure.com).

1. В области слева выберите **Создать ресурс**.

1. Найдите и выберите **Центры событий**. Нажмите кнопку **Создать**.

    [![Создайте пространство имен Центров событий.](./media/tutorial-facilities-analyze/create-event-hubs.png)](./media/tutorial-facilities-analyze/create-event-hubs.png#lightbox)

1. Введите **имя** для пространства имен концентраторов событий. Выберите **ценовую категорию** **Стандартный**, укажите **подписку**, **группу ресурсов**, используемую для экземпляра Digital Twins, и **расположение**. Нажмите кнопку **Создать**.

1. В развертывании пространства имен Центров событий выберите панель **Обзор**, а затем щелкните **Перейти к ресурсу**.

    [![Пространство имен Центров событий после развертывания](./media/tutorial-facilities-analyze/open-event-hub-ns.png)](./media/tutorial-facilities-analyze/open-event-hub-ns.png#lightbox)

1. В области **Обзор** пространства имен Центров событий нажмите кнопку **Концентратор событий** вверху.
    [![Кнопка концентратора событий](./media/tutorial-facilities-analyze/create-event-hub.png)](./media/tutorial-facilities-analyze/create-event-hub.png#lightbox)

1. Введите **имя** концентратора событий, а затем щелкните **Создать**.

   Развернутый концентратор событий будет отображаться в области **Центры событий** пространства имен Центров событий с состоянием **Активно**. Выберите этот концентратор событий, чтобы открыть область **Обзор**.

1. Нажмите кнопку **Группа потребителей** вверху и введите имя для группы потребителей, например **tsievents**. Нажмите кнопку **Создать**.

    [![Группа потребителей концентратора событий](./media/tutorial-facilities-analyze/event-hub-consumer-group.png)](./media/tutorial-facilities-analyze/event-hub-consumer-group.png#lightbox)

   Созданная группа потребителей отобразится в списке в нижней части области **Обзор** концентратора событий.

1. Откройте область **Политика общего доступа** концентратора событий и нажмите кнопку **Добавить**. Введите **ManageSend** в качестве имени политики, убедитесь, что все флажки установлены, и нажмите кнопку **Создать**.

    [![Строки подключения концентратора событий](./media/tutorial-facilities-analyze/event-hub-connection-strings.png)](./media/tutorial-facilities-analyze/event-hub-connection-strings.png#lightbox)

    > [!TIP]
    > Убедитесь, что вы создаете политику SAS для экземпляра концентратора событий, а не пространства имен.

1. Откройте созданную политику **ManageSend** и скопируйте значения **Строка подключения — первичный ключ** и **Строка подключения — вторичный ключ** во временный файл. Эти значения потребуются, чтобы создать конечную точку для концентратора событий в следующем разделе.

### <a name="create-an-endpoint-for-the-event-hub"></a>Создание конечной точки для концентратора событий

1. В окне командной строки убедитесь, что вы находитесь в папке **occupancy quickstart\src** примера Azure Digital Twins.

1. Откройте файл **actions\createEndpoints.yaml** в редакторе. Замените содержимое этого файла следующим:

    ```yaml
    - type: EventHub
      eventTypes:
      - SensorChange
      - SpaceChange
      - TopologyOperation
      - UdfCustom
      connectionString: Primary_connection_string_for_your_event_hub
      secondaryConnectionString: Secondary_connection_string_for_your_event_hub
      path: Name_of_your_Event_Hub
    - type: EventHub
      eventTypes:
      - DeviceMessage
      connectionString: Primary_connection_string_for_your_event_hub
      secondaryConnectionString: Secondary_connection_string_for_your_event_hub
      path: Name_of_your_Event_Hub
    ```

1. Замените заполнители `Primary_connection_string_for_your_event_hub` значением **Строка подключения — первичный ключ** для концентратора событий. Убедитесь, что формат строки подключения выглядит следующим образом:

   ```ConnectionString
   Endpoint=sb://nameOfYourEventHubNamespace.servicebus.windows.net/;SharedAccessKeyName=ManageSend;SharedAccessKey=yourShareAccessKey1GUID;EntityPath=nameOfYourEventHub
   ```

1. Замените заполнители `Secondary_connection_string_for_your_event_hub` значением **Строка подключения — вторичный ключ** для концентратора событий. Убедитесь, что формат строки подключения выглядит следующим образом: 

   ```ConnectionString
   Endpoint=sb://nameOfYourEventHubNamespace.servicebus.windows.net/;SharedAccessKeyName=ManageSend;SharedAccessKey=yourShareAccessKey2GUID;EntityPath=nameOfYourEventHub
   ```

1. Замените заполнители `Name_of_your_Event_Hub` именем своего Концентратора событий.

    > [!IMPORTANT]
    > Введите все значения без кавычек. Убедитесь, что в файле YAML после двоеточия есть по крайней мере один пробел. Вы также можете проверить содержимое файла YAML с помощью любого средства проверки YAML в Интернете, например [этого](https://onlineyamltools.com/validate-yaml).

1. Сохраните и закройте файл. Выполните следующую команду в окне командной строки и при появлении запроса войдите с помощью учетной записи Azure.

    ```cmd/sh
    dotnet run CreateEndpoints
    ```

   Эта команда создает две конечные точки для концентратора событий.

   [![Конечные точки для Центров событий](./media/tutorial-facilities-analyze/dotnet-create-endpoints.png)](./media/tutorial-facilities-analyze/dotnet-create-endpoints.png#lightbox)

## <a name="analyze-with-time-series-insights"></a>Анализ с помощью Аналитики временных рядов

1. В левой области [портала Azure](https://portal.azure.com) выберите **Создать ресурс**. 

1. Найдите и выберите ресурс **Аналитика временных рядов** (общедоступная версия). Нажмите кнопку **Создать**.

1. Введите **имя** экземпляра Аналитики временных рядов, а затем выберите свою **подписку**. Выберите **группу ресурсов**, которую вы использовали для экземпляра Digital Twins, и укажите **расположение**. По завершении выберите **Next: Event Source** (Далее: Источник события) или перейдите на вкладку **Источник события**.

    [![Выделенные элементы для создания экземпляра Аналитики временных рядов](./media/tutorial-facilities-analyze/create-tsi.png)](./media/tutorial-facilities-analyze/create-tsi.png#lightbox)

1. На вкладке **Источник события** введите **имя**, выберите **Концентратор событий** в качестве **типа источника** и проверьте, правильно ли выбраны другие значения для ссылки на созданный концентратор событий. Выберите **ManageSend** в качестве **имени политики доступа концентратора событий**, а затем в качестве **группы потребителей концентратора событий** выберите ту, которую создали в предыдущем разделе. Выберите **Review + create** (Просмотреть и создать).

    [![Выделенные элементы для создания источника событий](./media/tutorial-facilities-analyze/tsi-event-source.png)](./media/tutorial-facilities-analyze/tsi-event-source.png#lightbox)

1. На панели **Просмотр и создание** просмотрите введенные данные и выберите **Создать**.

1. На панели развертывания выберите только что созданный ресурс Аналитики временных рядов. Откроется панель **обзора** для среды Аналитики временных рядов.

1. Нажмите кнопку **Перейти в среду** в верхней части экрана. Если вы получите предупреждение о доступе к данным, откройте область **Data Access Policies** (Политики доступа к данным) для экземпляра Аналитики временных рядов, щелкните **Добавить**, выберите **Участник** в качестве роли и выберите соответствующего пользователя.

1. В результате нажатия кнопки **Перейти к среде** откроется [обозреватель службы "Аналитика временных рядов"](../time-series-insights/time-series-insights-explorer.md). Если никакие события не отображаются, перейдите к проекту **device-connectivity** примера Digital Twins и запустите `dotnet run`, чтобы сымитировать события устройства.

1. После создания нескольких имитированных событий вернитесь к обозревателю службы "Аналитика временных рядов" и нажмите кнопку "Обновить" вверху. Вы увидите, как для имитированных данных датчиков создаются аналитические диаграммы. 

    [![Диаграмма в обозревателе службы "Аналитика временных рядов"](./media/tutorial-facilities-analyze/tsi-explorer.png)](./media/tutorial-facilities-analyze/tsi-explorer.png#lightbox)

1. В обозревателе службы "Аналитика временных рядов" можно создавать диаграммы и тепловые карты различных событий и данных комнат, датчиков и других ресурсов. В левой части щелкните раскрывающиеся списки с названиями **Мера** и **Разделение по**, чтобы создать собственные визуализации. 

   Например, выберите **События** как значение **меры** и **DigitalTwins-SensorHardwareId** как значение параметра **Разделение по**, чтобы создать тепловую карту для каждого датчика. Тепловая карта будет выглядеть примерно так:

   [![Тепловая карта в обозревателе службы "Аналитика временных рядов"](./media/tutorial-facilities-analyze/tsi-explorer-heatmap.png)](./media/tutorial-facilities-analyze/tsi-explorer-heatmap.png#lightbox)

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы хотите прекратить изучение Azure Digital Twins на этом этапе, можете удалить ресурсы, созданные в этом руководстве:

1. На [портале Azure](https://portal.azure.com) в меню слева щелкните **Все ресурсы**, выберите группу ресурсов Digital Twins, а затем щелкните **Удалить**.

    > [!TIP]
    > Если при удалении экземпляра Digital Twins у вас возникла проблема, запустите обновление службы, в котором эта проблема исправлена. Затем повторите попытку удалить свой экземпляр.

2. При необходимости удалите примеры приложений на компьютере.

## <a name="next-steps"></a>Дополнительная информация

Перейдите к следующей статье, чтобы узнать больше о пространственных аналитических графах и объектных моделях в Azure Digital Twins.

> [!div class="nextstepaction"]
> [Understanding Digital Twins object models and spatial intelligence graph](concepts-objectmodel-spatialgraph.md) (Основные сведения об объектных моделях и пространственном интеллектуальном графе в Digital Twins)
