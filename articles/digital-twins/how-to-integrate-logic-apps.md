---
title: Интеграция с Logic Apps
titleSuffix: Azure Digital Twins
description: См. раздел Подключение Logic Apps к Azure Digital двойников с помощью настраиваемого соединителя.
author: baanders
ms.author: baanders
ms.date: 8/14/2020
ms.topic: how-to
ms.service: digital-twins
ms.reviewer: baanders
ms.openlocfilehash: 20959709854f8366cc067437fe86c245fcbc3ef0
ms.sourcegitcommit: 5a3b9f35d47355d026ee39d398c614ca4dae51c6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/02/2020
ms.locfileid: "89401067"
---
# <a name="integrate-with-logic-apps-using-a-custom-connector"></a>Интеграция с Logic Apps с помощью настраиваемого соединителя

[Azure Logic Apps](../logic-apps/logic-apps-overview.md) — это облачная служба, которая помогает автоматизировать рабочие процессы в приложениях и службах. Подключив Logic Apps к API-интерфейсам Azure Digital двойников, вы можете создавать такие автоматизированные потоки в Azure Digital двойников и их данные.

В Azure Digital двойников в настоящее время нет сертифицированного (предварительно созданного) соединителя для Logic Apps. Вместо этого текущий процесс использования Logic Apps с Azure Digital двойников заключается в создании [**настраиваемого соединителя Logic Apps**](../logic-apps/custom-connector-overview.md)с помощью [настраиваемого цифрового Двойникова Swagger Azure](https://docs.microsoft.com/samples/azure-samples/digital-twins-custom-swaggers/azure-digital-twins-custom-swaggers/) , который был изменен для работы с Logic Apps.

В этой статье вы будете использовать [портал Azure](https://portal.azure.com) , чтобы **создать настраиваемый соединитель** , который можно использовать для подключения Logic apps к экземпляру Digital двойников Azure. Затем вы **создадите приложение логики** , которое использует это подключение для примера сценария, в котором события, активируемые таймером, будут автоматически обновлять двойника в вашем экземпляре Azure Digital двойников. 

## <a name="prerequisites"></a>Предварительные требования

Если у вас еще нет подписки Azure, **создайте [бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F)** , прежде чем начинать работу.

Войдите в [портал Azure](https://portal.azure.com) с помощью этой учетной записи.

### <a name="set-up-azure-digital-twins-instance"></a>Настройка экземпляра Azure Digital Twins

Чтобы подключиться к двойников экземпляру Azure Digital для Logic Apps в этой статье, вам потребуется уже настроенный **экземпляр Azure Digital двойников** . 

Если вам нужно настроить новый экземпляр, проще всего сделать это, выполнив пример скрипта автоматического развертывания. Следуйте инструкциям в разделе [*инструкции. Настройка экземпляра и проверки подлинности (с помощью сценария)*](how-to-set-up-instance-scripted.md) для настройки нового экземпляра и требуемой регистрации приложения Azure AD. В этих инструкциях также указано, как проверить, успешно ли завершен каждый шаг и готов ли новый экземпляр к работе.

В этом учебнике при настройке экземпляра потребуются следующие значения. Если вам нужно снова собрать эти значения, воспользуйтесь приведенными ниже ссылками в соответствующих разделах статьи о настройке, чтобы найти их на [портале Azure](https://portal.azure.com).
* **_Имя узла_** экземпляра Azure Digital Twins ([как найти на портале](how-to-set-up-instance-portal.md#verify-success-and-collect-important-values)).
* **_Идентификатор приложения (клиента)_** для регистрации приложения в Azure AD ([как найти на портале](how-to-set-up-instance-portal.md#collect-important-values)).
* **_Идентификатор каталога (арендатора)_** для регистрации приложения в Azure AD ([как найти на портале](how-to-set-up-instance-portal.md#collect-important-values)).

### <a name="get-app-registration-client-secret"></a>Получение секрета клиента регистрации приложения

Кроме того, вам потребуется создать **_секрет клиента_** для регистрации приложения Azure AD. Для этого перейдите на страницу [Регистрация приложений](https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade) в портал Azure (эту ссылку можно использовать или найти на панели поиска на портале). Выберите регистрацию из списка, чтобы открыть сведения о ней. 

Нажмите *Сертификаты и секреты* в меню регистрации и выберите *+ новый секрет клиента*.

:::image type="content" source="media/how-to-integrate-logic-apps/client-secret.png" alt-text="Представление портала регистрации приложения Azure AD. В меню ресурсов есть выделение сертификаты и секреты, а также выделение на странице новый секрет клиента.":::

Введите любые значения для описания и истечения срока действия, а затем нажмите кнопку *Добавить*.
Секрет будет добавлен в список секретов клиента на странице *Сертификаты и секреты* . Запишите значение, которое будет использоваться позже (вы также можете скопировать его в буфер обмена с помощью значка копирования).

### <a name="add-a-digital-twin"></a>Добавление цифрового двойника

В этой статье для обновления двойника в вашем экземпляре Azure Digital двойников используется Logic Apps. Для продолжения необходимо добавить хотя бы один двойника в экземпляр. 

Вы можете добавить двойников с помощью [API дигиталтвинс](how-to-use-apis-sdks.md), [пакета SDK для .NET (C#)](https://github.com/Azure/azure-sdk-for-net/tree/master/sdk/digitaltwins/Azure.DigitalTwins.Core)или [Azure Digital двойников CLI](how-to-use-cli.md). Подробные инструкции по созданию двойников с помощью этих методов см. в разделе « [*практические руководства. Управление цифровыми двойниковми*](how-to-manage-twin.md)».

Вам потребуется **_идентификатор двойника_** двойника в созданном вами экземпляре.

## <a name="create-custom-logic-apps-connector"></a>Создание настраиваемого соединителя Logic Apps

На этом шаге вы создадите [настраиваемый соединитель Logic Apps](../logic-apps/custom-connector-overview.md) для API-интерфейсов Azure Digital двойников. После этого вы сможете подключать Azure Digital двойников при создании приложения логики в следующем разделе.

Перейдите на страницу [Logic Apps настраиваемый соединитель](https://portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Web%2FcustomApis) в портал Azure (эту ссылку можно использовать или найти на панели поиска портала). Нажмите *+ Добавить*.

:::image type="content" source="media/how-to-integrate-logic-apps/logic-apps-custom-connector.png" alt-text="Страница Logic Apps пользовательский соединитель в портал Azure. Выделение вокруг кнопки Добавить":::

На следующей странице *создание Logic Apps пользовательского соединителя* выберите подписку и группу ресурсов, а также имя и расположение развертывания для нового соединителя. Нажмите кнопку " *Проверка" + "создать*". Откроется вкладка *Просмотр и создание* , где можно нажать кнопку *создать* внизу, чтобы создать ресурс.

:::image type="content" source="media/how-to-integrate-logic-apps/create-logic-apps-custom-connector.png" alt-text="Вкладка Проверка и создание страницы Создание Logic Apps пользовательского соединителя в портал Azure. Выделение вокруг кнопки создать":::

Откроется страница развертывания для соединителя. После завершения развертывания нажмите кнопку *Перейти к ресурсу* , чтобы просмотреть сведения о соединителе на портале.

### <a name="configure-connector-for-azure-digital-twins"></a>Настройка соединителя для Azure Digital двойников

Далее вы настроите созданный соединитель для доступа к Azure Digital двойников.

Сначала скачайте пользовательский файл Swagger Microsoft Azure Digital двойников, который был изменен для работы с Logic Apps. Скачайте образец **пользовательских Swagger Azure Digital двойников** по [этой ссылке](https://docs.microsoft.com/samples/azure-samples/digital-twins-custom-swaggers/azure-digital-twins-custom-swaggers/) , нажав кнопку *скачать ZIP-файл* . Перейдите к скачанной папке *Azure_Digital_Twins_Custom_Swaggers.zip* и распакуйте ее. Пользовательский Swagger для этого учебника находится по адресу *Azure_Digital_Twins_Custom_Swaggers\LogicApps\preview\2020-05-31-preview\digitaltwins.js*.

Затем перейдите на страницу обзора соединителя в [портал Azure](https://portal.azure.com) и нажмите кнопку *изменить*.

:::image type="content" source="media/how-to-integrate-logic-apps/edit-connector.png" alt-text="Страница Обзор для соединителя, созданного на предыдущем шаге. Выделение вокруг кнопки Изменить":::

На странице *изменение Logic Apps пользовательского соединителя* настройте следующие сведения:
* **Настраиваемые соединители**
    - Конечная точка API: ОСТАВШАЯся (оставьте значение по умолчанию)
    - Режим импорта: OpenAPI-файл (оставьте значение по умолчанию)
    - Файл. это будет пользовательский файл Swagger, скачанный ранее. Нажмите кнопку *Импорт*, выберите файл на компьютере (*Azure_Digital_Twins_Custom_Swaggers\LogicApps\preview\2020-05-31-preview\digitaltwins.jsна*) и нажмите кнопку *Открыть*.
* **Общие сведения**
    - Значок, цвет фона значка, описание: заполните все нужные значения.
    - Схема: HTTPS (оставьте значение по умолчанию)
    - Узел. *имя узла* для своего экземпляра Digital двойников Azure.
    - Базовый URL-адрес:/(оставьте значение по умолчанию)

Затем нажмите кнопку *Безопасность* в нижней части окна, чтобы перейти к следующему шагу настройки.

:::image type="content" source="media/how-to-integrate-logic-apps/configure-next.png" alt-text="Снимок экрана с нижней частью страницы изменение Logic Apps пользовательского соединителя. Выделить кнопку вокруг кнопки, чтобы перейти к безопасности":::

На этапе безопасности нажмите кнопку *изменить* и настройте следующие сведения:
* **Тип проверки подлинности**: OAuth 2,0
* **OAuth 2,0**:
    - Поставщик удостоверений: Azure Active Directory
    - Идентификатор клиента: *идентификатор приложения (клиента)* для регистрации приложения Azure AD.
    - Секрет клиента: *секрет клиента* , созданный в [*предварительных требованиях*](#prerequisites) для регистрации приложения Azure AD.
    - URL-адрес для входа: https://login.windows.net (оставьте значение по умолчанию)
    - Идентификатор клиента: *идентификатор каталога (клиента)* для регистрации приложения Azure AD.
    - URL-адрес ресурса: 0b07f429-9f4b-4714-9392-cc5e8e80c8b0
    - Область: Directory. Акцессасусер. ALL
    - URL-адрес перенаправления: (оставьте значение по умолчанию сейчас)

Обратите внимание, что в поле URL-адрес перенаправления указано *Сохранение пользовательского соединителя для создания URL-адреса перенаправления*. Сделайте это сейчас, щелкнув *соединитель обновления* в верхней части панели, чтобы подтвердить параметры соединителя.

:::image type="content" source="media/how-to-integrate-logic-apps/update-connector.png" alt-text="Снимок экрана с верхней частью страницы изменение Logic Apps пользовательского соединителя. Выделить кнопку обновить соединитель":::

<!-- Success message? didn't see one -->

Вернитесь в поле URL-адрес перенаправления и скопируйте созданное значение. Он будет использован на следующем шаге.

:::image type="content" source="media/how-to-integrate-logic-apps/copy-redirect-url.png" alt-text="В поле URL-адрес перенаправления на странице изменить Logic Apps настраиваемый соединитель теперь имеется значение https://logic-apis-westus2.consent.azure-apim.net/redirect . Кнопка для копирования значения выделяется.":::

Это все сведения, необходимые для создания соединителя (нет необходимости продолжать предыдущую защиту на шаге определения). Вы можете закрыть панель *изменить Logic Apps пользовательский соединитель* .

>[!NOTE]
>Вернитесь на страницу обзора соединителя, где вы первоначально наберете *изменение*, обратите внимание, что при нажатии клавиши " *изменить* " будет выполнен весь процесс ввода параметров конфигурации. Они не заполняют значения из последнего момента, поэтому, если вы хотите сохранить обновленную конфигурацию с любыми измененными значениями, необходимо повторно ввести все остальные значения, чтобы избежать их перезаписи по умолчанию.

### <a name="grant-connector-permissions-in-the-azure-ad-app"></a>Предоставление разрешений соединителя в приложении Azure AD

Затем используйте значение *URL-адреса перенаправления* настраиваемого соединителя, скопированное на предыдущем шаге, чтобы предоставить разрешения соединителя в регистрации приложения Azure AD.

Перейдите на страницу [Регистрация приложений](https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade) в портал Azure и выберите регистрацию из списка. 

В разделе *Проверка подлинности* в меню регистрации Добавьте URI.

:::image type="content" source="media/how-to-integrate-logic-apps/add-uri.png" alt-text="Страница проверки подлинности для регистрации приложения в портал Azure. Элемент Authentication в меню выделяется, и на странице выделяется кнопка добавить URI."::: 

Введите *URL-адрес перенаправления* пользовательского соединителя в новое поле и нажмите значок *сохранить* .

:::image type="content" source="media/how-to-integrate-logic-apps/save-uri.png" alt-text="Страница проверки подлинности для регистрации приложения в портал Azure. Будет выделен новый URL-адрес перенаправления и кнопка Сохранить для этой страницы.":::

Теперь вы настроили настраиваемый соединитель, который может получить доступ к API-интерфейсам цифровых двойников Azure. 

## <a name="create-logic-app"></a>Создание приложения логики

Далее вы создадите приложение логики, которое будет использовать новый соединитель для автоматизации обновлений Digital двойников для Azure.

Перейдите на страницу [Logic Apps](https://portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Logic%2Fworkflows) в портал Azure (эту ссылку можно использовать или найти на панели поиска на портале). Нажмите *создать приложение логики*.

:::image type="content" source="media/how-to-integrate-logic-apps/create-logic-app.png" alt-text="Страница Logic Apps в портал Azure. Выделить кнопку создать приложение логики":::

На следующей странице *приложения логики* выберите подписку и группу ресурсов, а также имя и расположение развертывания для нового приложения логики. Нажмите кнопку " *Проверка" + "создать*". Откроется вкладка *Просмотр и создание* , где можно нажать кнопку *создать* внизу, чтобы создать ресурс.

Откроется страница развертывание приложения логики. После завершения развертывания нажмите кнопку *Перейти к ресурсу* , чтобы перейти к *конструктору Logic Apps*, в котором будет заполнена логика рабочего процесса.

### <a name="design-workflow"></a>Рабочий процесс разработки

В *конструкторе Logic Apps*в разделе *Запуск с общим триггером*выберите _**повторение**_.

:::image type="content" source="media/how-to-integrate-logic-apps/logic-apps-designer-recurrence.png" alt-text="Страница конструктора Logic Apps в портал Azure. Выделение общего триггера повторение":::

На следующей странице *конструктора Logic Apps* измените частоту **повторений** до *секунды*, чтобы событие запускалось каждые 3 секунды. Это позволит легко увидеть результаты позже, не дожидаясь очень долго.

Нажмите *+ новый шаг*.

Откроется окно *Выбор действия* . Перейдите на вкладку *Пользовательская* . Вы должны увидеть пользовательский соединитель с более ранней версии в верхнем поле.

:::image type="content" source="media/how-to-integrate-logic-apps/custom-action.png" alt-text="Создание последовательности в конструкторе Logic Apps в портал Azure. В поле "выберите действие" выбрана вкладка Пользовательская. Пользовательский соединитель пользователя из более ранней версии отображается в поле с выделением вокруг него.":::

Выберите его, чтобы отобразить список интерфейсов API, содержащихся в этом соединителе. Используйте панель поиска или прокрутите список, чтобы выбрать **DigitalTwins_Add**. (Это API, используемый в этой статье, но можно также выбрать любой другой API в качестве допустимого варианта подключения Logic Apps).

Возможно, вам будет предложено выполнить вход с использованием учетных данных Azure для подключения к соединителю. Если вы получаете диалоговое окно с *запрошенными разрешениями* , следуйте инструкциям на экране, чтобы предоставить согласие для вашего приложения и принять его.

В поле New *дигиталтвинсадд* (создать) заполните поля следующим образом:
* идентификатор. Укажите *идентификатор двойника* цифрового двойника в экземпляре, который требуется обновить в приложении логики.
* Элемент 1. в этом поле вводится текст, требуемый для выбранного запроса API. Для *дигиталтвинсупдате*это тело в виде кода исправления JSON. Дополнительные сведения о структурировании исправления JSON для обновления двойника см. в разделе " [Обновление цифрового двойника](how-to-manage-twin.md#update-a-digital-twin) " статьи " *Управление цифровыми двойниковми*".
* версия API: в текущей общедоступной предварительной версии это значение — *2020-05-31-Preview* .

Нажмите кнопку *сохранить* в конструкторе Logic Apps.

:::image type="content" source="media/how-to-integrate-logic-apps/save-logic-app.png" alt-text="Завершено представление приложения в соединителе приложения логики. Поле Дигиталтвинсадд заполняется значениями, описанными выше, включая образец текста для исправления JSON. Будет выделена кнопка Сохранить для окна.":::

## <a name="query-twin-to-see-the-update"></a>Запрос двойника для просмотра обновления

Теперь, когда приложение логики создано, событие двойника Update, определенное в конструкторе Logic Apps, должно выполняться каждые три секунды. Это означает, что через три секунды вы сможете запросить двойника и увидеть новые исправленные значения.

Вы можете запросить двойника с помощью выбранного метода (например, [пользовательского клиентского приложения](tutorial-command-line-app.md), [примера приложения для цифрового двойников Explorer](https://docs.microsoft.com/samples/azure-samples/digital-twins-explorer/digital-twins-explorer/), [пакетов SDK и API](how-to-use-apis-sdks.md)или [интерфейса командной строки](how-to-use-cli.md)). 

Дополнительные сведения о запросах к экземпляру Digital двойников для Azure см. [*в статье как выполнить запрос к графу двойника*](how-to-query-graph.md).

## <a name="next-steps"></a>Дальнейшие действия

В этой статье вы создали приложение логики, которое регулярно обновляет двойника в экземпляре Azure Digital двойников с указанным вами исправлением. Вы можете попробовать выбрать другие API в настраиваемом соединителе, чтобы создать Logic Apps для различных действий в экземпляре.

Дополнительные сведения о доступных операциях API и сведениях, которые они необходимы, см. в статье [*Использование интерфейсов API и пакетов SDK для цифровых двойников Azure*](how-to-use-apis-sdks.md).
