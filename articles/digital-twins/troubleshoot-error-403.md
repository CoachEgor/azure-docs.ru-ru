---
title: 'Сбой запроса цифрового двойников для Azure с состоянием: 403 (запрещено)'
description: 'Причины и способы устранения ошибки запроса на обслуживание. Состояние: 403 (запрещено) "в Azure Digital двойников.'
ms.service: digital-twins
author: baanders
ms.author: baanders
ms.topic: troubleshooting
ms.date: 7/20/2020
ms.openlocfilehash: d1c3ad9aa034e6eace5323dd80c5275699a6e728
ms.sourcegitcommit: 03713bf705301e7f567010714beb236e7c8cee6f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/21/2020
ms.locfileid: "92331504"
---
# <a name="service-request-failed-status-403-forbidden"></a>Сбой запроса на обслуживание. Состояние: 403 (запрещено)

В этой статье описываются причины и способы устранения ошибки 403 от запросов на обслуживание к Azure Digital двойников. 

## <a name="symptoms"></a>Симптомы

Эта ошибка может возникать во многих типах запросов на обслуживание, требующих проверки подлинности. Таким результатом является сбой запроса API, возвращающего состояние ошибки `403 (Forbidden)` .

## <a name="causes"></a>Причины

### <a name="cause-1"></a>Причина #1

Чаще всего эта ошибка означает, что разрешения на управление доступом на основе ролей Azure (Azure RBAC) для службы настроены неправильно. Во многих действиях для экземпляра Digital двойников Azure требуется роль *владельца Azure Digital двойников (Предварительная версия)* **на экземпляре, которым вы пытаетесь управлять**. 

### <a name="cause-2"></a>Причина #2

Если вы используете клиентское приложение для обмена данными с цифровым двойников Azure, которое выполняет проверку подлинности с помощью [регистрации приложения](how-to-create-app-registration.md), эта ошибка может возникать из-за того, что регистрация приложения не имеет разрешений, настроенных для службы Digital двойников Azure.

Регистрация приложения должна иметь разрешения на доступ, настроенные для API цифровых двойников Azure. Затем, когда клиентское приложение пройдет проверку подлинности для регистрации приложения, ему будут предоставлены разрешения, настроенные для регистрации приложения.

## <a name="solutions"></a>Решения

### <a name="solution-1"></a>#1 решения

Первое решение заключается в том, чтобы убедиться, что у пользователя Azure есть роль _**владельца Azure Digital двойников (Предварительная версия)**_ на экземпляре, которым вы пытаетесь управлять. Если у вас нет этой роли, настройте ее.

Обратите внимание, что эта роль отличается от...
* роль *владельца* для всей подписки Azure. *Владелец Azure Digital двойников (Предварительная версия)* — это роль в Azure Digital двойников. она ограничивается этим отдельным экземпляром Azure Digital двойников.
* роль *владельца* в Azure Digital двойников. Это две отдельные роли управления цифровыми двойников Azure, а *владелец Azure Digital двойников (Предварительная версия)* — это роль, которую следует использовать для управления во время предварительной версии.

#### <a name="check-current-setup"></a>Проверка текущей установки

[!INCLUDE [digital-twins-setup-verify-role-assignment.md](../../includes/digital-twins-setup-verify-role-assignment.md)]

#### <a name="fix-issues"></a>Устранение проблем 

Если эта роль не назначена, то кто-то с ролью владельца в вашей **подписке Azure** должен выполнить следующую команду, чтобы предоставить пользователю Azure роль *владельца цифрового двойников Azure (Предварительная версия)* в **экземпляре Azure Digital двойников**. 

Если вы являетесь владельцем подписки, вы можете выполнить эту команду самостоятельно. Если это не так, обратитесь к владельцу, чтобы выполнить эту команду от вашего имени.

```azurecli
az dt role-assignment create --dt-name <your-Azure-Digital-Twins-instance> --assignee "<your-Azure-AD-email>" --role "Azure Digital Twins Owner (Preview)"
```

Дополнительные сведения об этом требовании роли и процессе назначения см. в разделе [ *Настройка разрешений доступа пользователя* статьи](how-to-set-up-instance-CLI.md#set-up-user-access-permissions) *инструкции. Настройка экземпляра и проверки подлинности (CLI или портал)*.

Если у вас уже есть такое назначение ролей *и* вы используете регистрацию приложения Azure AD для проверки подлинности клиентского приложения, вы можете перейти к следующему решению, если это решение не решило проблему 403.

### <a name="solution-2"></a>#2 решения

Если вы используете регистрацию приложения Azure AD для проверки подлинности клиентского приложения, второе возможное решение — проверка наличия у регистрации приложения разрешений, настроенных для службы Digital двойников. Если они не настроены, настройте их.

#### <a name="check-current-setup"></a>Проверка текущей установки

Чтобы проверить, правильно ли настроены разрешения, перейдите на [страницу обзора регистрации приложений Azure AD](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/RegisteredApps) в портал Azure. Вы можете перейти на эту страницу самостоятельно, выполнив поиск *Регистрация приложений* на панели поиска портала.

Перейдите на вкладку *все приложения* , чтобы просмотреть все регистрации приложений, созданные в вашей подписке.

Вы должны увидеть только что созданную регистрацию приложения в списке. Выберите его, чтобы открыть подробные сведения.

:::image type="content" source="media/troubleshoot-error-403/app-registrations.png" alt-text="Страница Регистрация приложений в портал Azure":::

Сначала убедитесь, что параметры разрешений Azure Digital двойников были правильно установлены для регистрации. Для этого в строке меню выберите *Манифест* , чтобы просмотреть код манифеста регистрации приложения. Прокрутите окно кода вниз и найдите эти поля в разделе `requiredResourceAccess` . Значения должны соответствовать приведенным на снимке экрана ниже:

:::image type="content" source="media/troubleshoot-error-403/verify-manifest.png" alt-text="Страница Регистрация приложений в портал Azure":::

Затем в строке меню выберите *разрешения API* , чтобы убедиться, что регистрация приложения содержит разрешения на чтение и запись для Azure Digital двойников. Вы должны увидеть запись следующего вида:

:::image type="content" source="media/troubleshoot-error-403/verify-api-permissions.png" alt-text="Страница Регистрация приложений в портал Azure":::

#### <a name="fix-issues"></a>Устранение проблем

Если какой-либо из них отличается от описанного, следуйте инструкциям по настройке регистрации приложения в разделе [*инструкции. Создание регистрации приложения*](how-to-create-app-registration.md).

## <a name="next-steps"></a>Дальнейшие шаги

Ознакомьтесь с шагами по настройке создания и аутентификации нового экземпляра Digital двойников в Azure.
* [*Пошаговое руководство. Настройка экземпляра и проверки подлинности (CLI)*](how-to-set-up-instance-cli.md)

Дополнительные сведения о безопасности и разрешениях для Azure Digital двойников:
* [*Основные понятия: безопасность решений для цифровых двойников Azure*](concepts-security.md)