---
title: Вызов, активация или вкладывание приложений логики
description: Настройка конечных точек HTTP для вызова, триггера или рабочих процессов логики гнезда в приложениях логики Azure
services: logic-apps
ms.workload: integration
ms.reviewer: klam, jehollan, logicappspm
ms.topic: article
ms.date: 11/04/2019
ms.openlocfilehash: d5b5a69c7927d07c0ae6b3b56ec97b6551e5d46b
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "77191338"
---
# <a name="call-trigger-or-nest-logic-apps-by-using-http-endpoints-in-azure-logic-apps"></a>Вызов, триггер или гнездо логических приложений с помощью конечных точек HTTP в приложениях логики Azure

Чтобы сделать приложение логики вызываемым через URL, чтобы приложение логики могло получать входящие запросы от других служб, вы можете наместело синхронную конечную точку HTTP в качестве триггера в этом приложении логики. При настройке этой возможности можно также вложить логическое приложение в другие логические приложения, что позволяет создавать шаблон перезвонимых конечных точек.

Для настройки конечной точки HTTP можно использовать любой из этих типов триггеров, которые позволяют логическим приложениям получать входящие запросы:

* [Запрос](../connectors/connectors-native-reqres.md)
* [HTTP Webhook](../connectors/connectors-native-webhook.md)
* Управляемые триггеры разъема, которые имеют [тип ApiConnectionWebhook](../logic-apps/logic-apps-workflow-actions-triggers.md#apiconnectionwebhook-trigger) и могут получать входящие запросы HTTP

> [!NOTE]
> В этих примерах используется триггер Запроса, но можно использовать любой триггер на основе http, который находится в предыдущем списке. Все принципы одинаково применимы к этим другим типам триггеров.

Если вы новичок в логических приложениях, [Quickstart: Create your first logic app](../logic-apps/quickstart-create-first-logic-app-workflow.md)см. [What is Azure Logic Apps](../logic-apps/logic-apps-overview.md)

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас нет ее, вы можете [зарегистрироваться для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/).

* Логическое приложение, где вы хотите настроить конечную точку HTTP в качестве триггера. Вы можете начать с пустого приложения логики или существующего приложения логики, где вы хотите заменить текущий триггер. Этот пример начинается с пустого приложения логики.

## <a name="create-a-callable-endpoint"></a>Создание вызываемой конечной точки

1. Войдите на [портал Azure](https://portal.azure.com). Создайте и откройте пустое приложение логики в Logic App Designer.

   В этом примере используется триггер Запроса, но можно использовать любой триггер, который может получать входящие запросы HTTP. Все принципы одинаково применимы к этим триггерам. Для получения дополнительной информации о триггере Запроса [см.](../connectors/connectors-native-reqres.md)

1. Под полем поиска выберите **Встроенный.** В поле поиска введите `request` в качестве фильтра. Из списка триггеров выберите **при получении запроса HTTP.**

   ![Найти и выбрать триггер Запроса](./media/logic-apps-http-endpoint/find-and-select-request-trigger.png)

1. Дополнительно в поле **Запрос тела JSON Schema** можно ввести схему JSON, описывающая полезную нагрузку или данные, которые вы ожидаете получить спусковой крючок.

   Дизайнер использует эту схему для создания токенов, которые представляют триггерные выходы. Затем можно легко ссылаться на эти выходы на протяжении всего рабочего процесса приложения логики. Узнайте больше о [токенах, генерируемых из схем JSON.](#generated-tokens)

   В этом примере введите эту схему:

   ```json
      {
      "type": "object",
      "properties": {
         "address": {
            "type": "object",
            "properties": {
               "streetNumber": {
                  "type": "string"
               },
               "streetName": {
                  "type": "string"
               },
               "town": {
                  "type": "string"
               },
               "postalCode": {
                  "type": "string"
               }
            }
         }
      }
   }
    ```

   ![Предоставьте схему JSON для действия Запроса](./media/logic-apps-http-endpoint/manual-request-trigger-schema.png)

   Или можно создать схему JSON, предоставив образец полезной нагрузки:

   1. В триггере **Запроса** выберите **Полезную нагрузку образца для создания схемы.**

   1. В **введите или вставьте образец jSON полезной нагрузки** поле, введите образец полезной нагрузки, например:

      ```json
      {
         "address": {
            "streetNumber": "00000",
            "streetName": "AnyStreet",
            "town": "AnyTown",
            "postalCode": "11111-1111"
        }
      }
      ```

   1. Когда вы будете готовы, выберите **Done.**

      Коробка **Запрос тела JSON Schema** теперь показывает генерируемую схему.

1. Сохраните приложение логики.

   **HTTP POST в этом** поле URL теперь показывает сгенерированный URL-адрес обратного вызова, который другие службы могут использовать для вызова и запуска приложения логики. Этот URL-адрес включает ключ общей подписи доступа (SAS), который используется для проверки подлинности, в параметрах запроса, например:

   ![Созданный URL-адрес обратного вызова для конечной точки](./media/logic-apps-http-endpoint/generated-endpoint-url.png)

   Вы также можете получить URL-адрес http из панели **обзора** приложения логики.

   1. В меню приложения логики выберите **Обзор**.

   1. В разделе **Резюме** выберите **Историю триггера.**

      ![Получение URL-адреса конечной точки HTTP на портале Azure](./media/logic-apps-http-endpoint/find-manual-trigger-url.png)

   1. Под **обратным URL-адресом «POST»** скопируйте URL:

      ![Копирование URL-адреса HTTP с портала Azure](./media/logic-apps-http-endpoint/copy-manual-trigger-callback-url.png)

      URL-адрес также можно получить, выполнив этот вызов:

      ```http
      POST https://management.azure.com/{logic-app-resource-ID}/triggers/{endpoint-trigger-name}/listCallbackURL?api-version=2016-06-01
      ```

<a name="set-method"></a>

## <a name="set-expected-http-method"></a>Установить ожидаемый метод HTTP

По умолчанию триггер Request ожидает запрос HTTP POST. Тем не менее, можно указать другой метод, чтобы ожидать, но только один метод.

1. В триггере Запроса откройте новый список **параметров** и выберите **метод,** который добавляет это свойство к триггеру.

   ![Добавление свойства "Метод" для триггера](./media/logic-apps-http-endpoint/select-add-new-parameter-for-method.png)

1. Из списка **метода** выберите другой метод, который ожидает триггер. Или можно указать пользовательский метод.

   Например, выберите метод **GET,** чтобы можно было проверить URL-адрес http позже.

   ![Выберите метод HTTP для триггера](./media/logic-apps-http-endpoint/select-method-request-trigger.png)

## <a name="accept-parameters-in-endpoint-url"></a>Принять параметры в URL-адресе конечных точек

Если вы хотите, чтобы URL-адрес вашего адресатов принял параметры, укажите относительный путь в триггере. Также необходимо четко [установить метод,](#set-method) который ожидает запрос HTTP.

1. В триггере Запроса откройте новый список **параметров** и выберите **относительный путь,** который добавляет это свойство к триггеру.

   ![Добавление свойства "Относительный путь" для триггера](./media/logic-apps-http-endpoint/select-add-new-parameter-for-relative-path.png)

1. В свойстве **относительного пути** укажите относительный путь параметра в схеме JSON, `address/{postalCode}`который вы хотите, чтобы ваш URL принял, например, .

   ![Указать относительный путь для параметра](./media/logic-apps-http-endpoint/relative-path-url-value.png)

1. Чтобы использовать параметр, найдите и добавьте действие **Response** в приложение логики.

   1. В соответствии с триггером Запроса выберите **новый шаг** > **Добавление действия.**

   1. В разделе **Выберите действие** введите фильтр `response` в поле поиска.

   1. Из списка действий выберите действие **«Ответ».**

1. В свойство **тела действия** «Ответ» включите маркер, представляющий параметр, указанный в относительном пути триггера.

   Например, предположим, что вы `Postal Code: {postalCode}`хотите, чтобы действие Response было возвращено.

   В **Body** свойстве Тела `Postal Code: ` введите с задним пространством. Из списка динамического содержимого, который появляется, выберите маркер **почтового кода.**

   ![Добавление указанного параметра в орган реагирования](./media/logic-apps-http-endpoint/relative-url-with-parameter-token.png)

   Свойство **Тела** теперь включает выбранный параметр:

   ![Пример тела ответа с параметром](./media/logic-apps-http-endpoint/relative-url-with-parameter.png)

1. Сохраните приложение логики.

    URL-адрес конечной точки HTTP теперь включает относительный путь, например:

    ```http
    https://prod-25.westus.logic.azure.com/workflows/{logic-app-resource-ID}/triggers/manual/paths/invoke/address/{postalCode}?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig={shared-access-signature}
    ```

1. Для проверки конечной точки HTTP скопируйте и вставьте обновленный URL-адрес в другом окне браузера, но замените `{postalCode}` на `123456` и нажмите клавишу ВВОД.

   Ваш браузер показывает этот текст:`Postal Code: 123456`

## <a name="call-logic-app-through-http-endpoint"></a>Вызов логики приложение через конечную точку HTTP

После создания конечной точки HTTP можно запустить логическое `POST` приложение, отправив запрос HTTP в полный URL-адрес endpoint. Приложения логики имеют встроенную поддержку конечных точек прямого доступа.

<a name="generated-tokens"></a>

## <a name="tokens-generated-from-schema"></a>Токены, генерируемые из схемы

Когда вы предоставляете схему JSON в триггере Запроса, логический разработчик приложений генерирует токены для свойств в этой схеме. Затем эти токены можно использовать для передачи данных через рабочий процесс приложения логики.

Например, если вы добавляете `"suite"`больше свойств, таких как схема JSON, токены для этих свойств доступны для использования в более поздних шагах для приложения логики. Ниже приведена полная схема JSON.

```json
   {
   "type": "object",
   "properties": {
      "address": {
         "type": "object",
         "properties": {
            "streetNumber": {
               "type": "string"
            },
            "streetName": {
               "type": "string"
            },
            "suite": {
               "type": "string"
            },
            "town": {
               "type": "string"
            },
            "postalCode": {
               "type": "string"
            }
         }
      }
   }
}
```

## <a name="create-nested-logic-apps"></a>Создание вложенных логических приложений

Вы можете вкладывать рабочие процессы в свое приложение логики путем добавления других приложений логики, которые могут принимать запросы. Чтобы включить эти логические приложения, выполните следующие действия:

1. Под шагом, где вы хотите вызвать другое приложение логики, выберите **Новый шаг** > **Добавить действие.**

1. В разделе **Выберите действие** выберите **Встроенный**. В поле поиска введите `logic apps` в качестве фильтра. Из списка действий выберите **рабочий процесс Logic Apps.**

   ![Приложение логики гнезда внутри текущего приложения логики](./media/logic-apps-http-endpoint/choose-logic-apps-workflow.png)

   Дизайнер показывает подходящие логические приложения для выбора.

1. Выберите логическое приложение для вызова из текущего приложения логики.

   ![Выберите приложение логики для вызова из текущего приложения логики](./media/logic-apps-http-endpoint/select-logic-app-to-nest.png)

## <a name="reference-content-from-an-incoming-request"></a>Ссылка на содержимое входящего запроса

Если тип содержимого входящего `application/json`запроса, вы можете ссылаться на свойства в входящий запрос. В противном случае это содержимое рассматривается как единая двоичная единица, которую можно передать другим AA. Чтобы соссылкой этого содержимого в рабочем процессе приложения логики, необходимо сначала преобразовать это содержимое.

Например, если вы передаете `application/xml` содержимое с типом, можно использовать [ `@xpath()` выражение](../logic-apps/workflow-definition-language-functions-reference.md#xpath) для выполнения извлечения XPath или использовать [ `@json()` выражение](../logic-apps/workflow-definition-language-functions-reference.md#json) для преобразования XML в JSON. Подробнее о работе с [поддерживаемыми типами контента.](../logic-apps/logic-apps-content-type.md)

Чтобы получить выход из входящего запроса, можно использовать [ `@triggerOutputs` выражение.](../logic-apps/workflow-definition-language-functions-reference.md#triggerOutputs) Например, предположим, что у вас есть выход, который выглядит следующим образом:

```json
{
   "headers": {
      "content-type" : "application/json"
   },
   "body": {
      "myProperty" : "property value"
   }
}
```

Чтобы получить `body` доступ конкретно к свойству, вы можете использовать [ `@triggerBody()` выражение](../logic-apps/workflow-definition-language-functions-reference.md#triggerBody) в качестве ярлыка.

## <a name="respond-to-requests"></a>Ответ на запросы

Иногда требуется ответить на определенные запросы, которые запускают приложение логики, возвращая содержимое вызывающему абоненту. Чтобы построить код состояния, заголовок и тело для ответа, используйте действие Response. Это действие может находиться в любом месте приложения логики, а не только в конце рабочего процесса. Если приложение логики не включает в себя действие Response, конечная точка HTTP *немедленно* отвечает статусом **202.**

Для успешного получения ответа исходным абонентом все необходимые шаги для ответа должны быть завершены в [пределах срока запроса,](./logic-apps-limits-and-config.md) если только приложение срабатывания логики не называется вложенным приложением логики. Если ответ не возвращается в пределах этого лимита, входящий запрос тайм-аут и получает ответ **408 Клиента тайм-аута.**

Для вложенных логических приложений родительское приложение логики продолжает ждать ответа, пока все шаги не будут завершены, независимо от того, сколько времени требуется.

### <a name="construct-the-response"></a>Создание ответа

В орган ответа можно включить несколько заголовков и любой тип содержимого. Например, в заголовке этого ответа указывается, что тип `application/json` содержимого ответа и что `town` тело `postalCode` содержит значения для и свойств, основанные на схеме JSON, описанной ранее в этой теме для триггера Запроса.

![Предоставление содержимого ответа для действий HTTP Response](./media/logic-apps-http-endpoint/content-for-response-action.png)

У ответов есть следующие свойства:

| Свойство (Дисплей) | Property (JSON) | Описание |
|--------------------|-----------------|-------------|
| **Код статуса** | `statusCode` | Код состояния HTTP для использования в ответе на входящий запрос. Это может быть любой допустимый код состояния, который начинается с 2xx, 4xx или 5xx. Но коды состояния 3xx не допускаются. |
| **Заголовки** | `headers` | Один или несколько заголовков для включения в ответ |
| **Текст** | `body` | Объект тела, который может быть строкой, объектом JSON или даже бинарным контентом, упоминаемым на предыдущем этапе |
||||

Чтобы просмотреть определение JSON для действия Response и полное определение приложения JSON вашего логического приложения на панели инструментов Logic App Designer, выберите **представление кода.**

``` json
"Response": {
   "type": "Response",
   "kind": "http",
   "inputs": {
      "body": {
         "postalCode": "@triggerBody()?['address']?['postalCode']",
         "town": "@triggerBody()?['address']?['town']"
      },
      "headers": {
         "content-type": "application/json"
      },
      "statusCode": 200
   },
   "runAfter": {}
}
```

## <a name="q--a"></a>Вопросы и ответы

#### <a name="q-what-about-url-security"></a>Вопрос. Как обеспечивается безопасность URL-адресов?

**A:** Azure надежно генерирует URL-адреса вызова логических приложений с помощью [общей подписи доступа (SAS).](https://docs.microsoft.com/rest/api/storageservices/delegate-access-with-shared-access-signature) Эта подпись проходит в качестве параметра запроса и должна быть проверена до запуска приложения логики. Azure создает эту подпись на основе уникального сочетания секретного ключа для каждого приложения логики, имени триггера и выполняемой операции. Не имея доступа к секретному ключу приложения логики, создать действительную подпись невозможно.

> [!IMPORTANT]
> Для производства и систем безопасности, мы настоятельно рекомендуем не вызывать ваше логическое приложение непосредственно из браузера по этим причинам:
>
> * ключ общего доступа отображается в URL-адресе;
> * Вы не можете управлять политиками безопасности из-за общих доменов между клиентами Azure Logic Apps.

#### <a name="q-can-i-configure-http-endpoints-further"></a>Вопрос. Могу ли я дополнительно настроить конечные точки HTTP?

**A:** Да, конечные точки HTTP поддерживают более продвинутую конфигурацию через [Управление API Azure.](../api-management/api-management-key-concepts.md) Эта служба также предлагает вам возможность согласованно управлять всеми своими API, включая приложения логики, настраивать имена домена, использовать дополнительные методы проверки подлинности и т. д. В частности она предоставляет следующие возможности:

* [Изменение метода запроса](../api-management/api-management-advanced-policies.md#SetRequestMethod)
* [Изменение сегментов URL-адреса запроса](../api-management/api-management-transformation-policies.md#RewriteURL)
* Настройка доменов управления API на [портале Azure](https://portal.azure.com/)
* настройка политики для проверки базовой проверки подлинности.

## <a name="next-steps"></a>Дальнейшие действия

* [Получайте и отвечайте на входящие вызовы HTTPS с помощью приложений логики Azure](../connectors/connectors-native-reqres.md)