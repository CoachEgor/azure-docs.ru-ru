---
title: Установка локального шлюза данных
description: Чтобы получить доступ к данным в локальной среде из Azure Logic Apps, нужно скачать и установить локальный шлюз данных.
services: logic-apps
ms.suite: integration
ms.reviewer: arthii, logicappspm
ms.topic: article
ms.date: 12/05/2019
ms.openlocfilehash: 797cd82327d68003d4e5f007d1f16e9534092ac0
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79283996"
---
# <a name="install-on-premises-data-gateway-for-azure-logic-apps"></a>Установка локального шлюза данных для Azure Logic Apps

Прежде чем вы сможете [подключиться к локальным источникам данных из Azure Logic Apps,](../logic-apps/logic-apps-gateway-connection.md)загрузите и установите [локальный шлюз данных](https://aka.ms/on-premises-data-gateway-installer) на локальном компьютере. Шлюз работает как мост, обеспечивающий быструю передачу данных и шифрование между источниками данных в помещениях и вашими логическими приложениями. Вы можете использовать ту же установку шлюза с другими облачными службами, такими как Power BI, Power Automate, Power Apps и Azure Analysis Services. Для получения информации о том, как использовать шлюз с этими службами, см.

* [Microsoft Power Автоматизировать предприимки данных шлюз](/power-automate/gateway-reference)
* [Локальный шлюз данных](/power-bi/service-gateway-onprem)
* [Microsoft Power Apps на месте данных шлюз](/powerapps/maker/canvas-apps/gateway-reference)
* [Локальный шлюз данных](../analysis-services/analysis-services-gateway.md)

В этой статье показано, как загружать, устанавливать и настраивать шлюз данных, чтобы можно было получить доступ к источникам данных из приложений Azure Logic Apps. Вы также можете узнать больше о [том, как работает шлюз данных](#gateway-cloud-service) позже в этой теме. Для получения дополнительной информации о шлюзе, [см. Что такое на-предварительный шлюз?](https://docs.microsoft.com/data-integration/gateway/service-gateway-onprem)

<a name="requirements"></a>

## <a name="prerequisites"></a>Предварительные требования

* Учетная запись и подписка Azure. Если у вас нет учетной записи Azure с подпиской, [зарегистрируйтесь на бесплатную учетную запись Azure.](https://azure.microsoft.com/free/)

  * Ваша учетная запись Azure должна принадлежать одному [арендатору или каталогу Azure Active Directory (Azure AD).](../active-directory/fundamentals/active-directory-whatis.md#terminology) Для установки и администрирования шлюза на локальном компьютере необходимо использовать ту же учетную запись Azure.

  * Во время установки шлюза вы регистрируетесь в учетной записи Azure, которая связывает установку шлюза с учетной записью Azure и только этой учетной записью. Позже, на портале Azure, необходимо использовать ту же учетную запись Azure и ad-нанимателей Azure При создании ресурса шлюза Azure, который регистрирует и утверждает установку шлюза. В приложениях Azure Logic Apps на месте триггеры и действия используют ресурс шлюза для подключения к источникам данных.

    > [!NOTE]
    > Вы можете связать только одну установку шлюза и один ресурс шлюза Azure друг с другом. Вы не можете связать одну и ту же установку шлюза с несколькими учетными записями Azure или ресурсами шлюза Azure. Однако учетная запись Azure может связываться с несколькими установками шлюза и ресурсами шлюза Azure. В локте триггера или действия можно выбрать из различных подписок Azure, а затем выбрать связанный ресурс шлюза.

  * Вам нужно войти в систему либо с рабочей учетной записью, `username@contoso.com`либо со школьной учетной записью, также известной как учетная запись *организации,* которая выглядит как . Вы не можете использовать учетные записи Azure B2B @hotmail.com (гостевые) или личные учетные записи Майкрософт, такие как или @outlook.com

    > [!TIP]
    > Если вы подписались на предложение Office 365 и не предоставили свой `username@domain.onmicrosoft.com`рабочий адрес электронной почты, ваш адрес может выглядеть как . Ваша учетная запись хранится в каталоге Active Directory Azure (Azure AD). В большинстве случаев основное имя пользователя (UPN) для вашей учетной записи Azure AD совпадает с вашим адресом электронной почты.
    >
    > Чтобы использовать [подписку Visual Studio Standard,](https://visualstudio.microsoft.com/vs/pricing/) связанную с учетной записью Майкрософт, сначала [создайте арендатора в Azure AD](../active-directory/develop/quickstart-create-new-tenant.md) или воспользуйсь каталогом по умолчанию. Добавьте пользователя с паролем в каталог, а затем предоставьте пользователю доступ к подписке Azure. Затем вы можете войти в систему во время установки шлюза, используя эти имя пользователя и пароль.

* Требования для локального компьютера приведены ниже.

  **Минимальные требования**

  * .NET Framework 4.7.2.
  * 64-разрядная версия Windows 7 или Windows Server 2008 R2 (или более поздняя версия).

  **Рекомендуемые требования**

  * 8-ядерный ЦП.
  * 8 ГБ ОЗУ.
  * 64-битная версия Windows Server 2012 R2 или позже
  * Твердое состояние диска (SSD) хранения для спулинга

  > [!NOTE]
  > Шлюз не поддерживает ядро сервера Windows.

* **Связанные с этим соображения**

  * Установите локальный шлюз данных только на локальном компьютере, а не на контроллер домена. Не нужно устанавливать шлюз на компьютере, на котором размещен источник данных. Вам нужен только один шлюз для всех источников данных, поэтому вам не нужно устанавливать шлюз для каждого источника данных.

    > [!TIP]
    > Чтобы свести к минимуму задержки, шлюз можно установить как можно ближе к источнику данных или даже на том же компьютере, если только у вас есть соответствующие разрешения.

  * Установите шлюз на компьютер, который подключен к проводной сети, подключен к Интернету, всегда включен, и не идет спать. В противном случае шлюз не может работать, и производительность может пострадать по беспроводной сети.

  * Если вы планируете использовать аутентификацию Windows, убедитесь, что вы установите шлюз на компьютере, который является членом той же среды Active Directory, что и ваши источники данных.

  * Область, выбранная для установки шлюза, является тем же местом, которое необходимо выбрать при дальнейшем создании ресурса шлюза Azure для приложения логики. По умолчанию этот регион является тем же местоположеним, что и ваш ad-налажине Azure, который управляет учетной записью Azure. Тем не менее, вы можете изменить местоположение во время установки шлюза.

  * Если вы обновляете установку шлюза до последней версии, удалите текущий шлюз сначала для более чистого опыта.

  * Шлюз имеет два режима: стандартный и персональный режим, который применяется только к Power BI. Вы не можете иметь более одного шлюза работает в том же режиме на том же компьютере.

  * Azure Logic Apps поддерживает операции чтения и записи через шлюз. Тем не менее, эти операции имеют [ограничения на их размер полезной нагрузки.](https://docs.microsoft.com/data-integration/gateway/service-gateway-onprem#considerations)

<a name="install-gateway"></a>

## <a name="install-data-gateway"></a>Установка шлюза данных

1. [Скачайте и запустите установщик шлюза на локальном компьютере](https://aka.ms/on-premises-data-gateway-installer).

1. Просмотрите минимальные требования, сохраните траекторию установки по умолчанию, примите условия использования, а затем выберите **Install.**

   ![Обзор требований и принятие условий использования](./media/logic-apps-gateway-install/review-and-accept-terms-of-use.png)

1. После того, как шлюз успешно установится, укажите адрес электронной почты для учетной записи Azure, а затем выберите **Войти в**систему, например:

   ![Выполнение входа в рабочую или учебную учетную запись](./media/logic-apps-gateway-install/sign-in-gateway-install.png)

   Установка шлюза может быть связана только с одной учетной записью Azure.

1. Выберите **регистрацию нового шлюза на этом компьютере** > **Далее.** Этот шаг регистрирует установку шлюза с [помощью облачного сервиса шлюза.](#gateway-cloud-service)

   ![Регистрация шлюза на локальном компьютере](./media/logic-apps-gateway-install/register-gateway-local-computer.png)

1. Для установки шлюза необходимо указать следующие сведения.

   * Уникальное имя шлюза в вашем арендаторе Azure AD
   * Ключ восстановления, который должен иметь по крайней мере восемь символов, которые вы хотите использовать
   * Подтверждение ключа восстановления

   ![Предоставление информации для установки шлюза](./media/logic-apps-gateway-install/gateway-name-recovery-key.png)

   > [!IMPORTANT]
   > Сохраните и держите ключ восстановления в безопасном месте. Вам нужен этот ключ, если вы когда-нибудь хотите изменить местоположение, переместить, восстановить или взять на себя установку шлюза.

   Обратите внимание на опцию **добавления к существующему кластеру шлюзов,** который вы выбираете при установке дополнительных шлюзов для [сценариев с высокой доступностью.](#high-availability)

1. Проверьте область для облачного сервиса шлюза и [шины службы Azure,](https://azure.microsoft.com/services/service-bus/) которая используется при установке шлюза. По умолчанию этот регион является тем же местоположеним, что и для арендатора Azure AD для учетной записи Azure.

   ![Подтвердите регион для обслуживания шлюза и автобуса обслуживания](./media/logic-apps-gateway-install/confirm-gateway-region.png)

1. Чтобы принять область по умолчанию, выберите **настройку.** Однако, если область по умолчанию не является ближайшей к вам, вы можете изменить область.

   *Причины изменения региона установки шлюза.*

   Например, чтобы уменьшить задержку, можно изменить регион своего шлюза на тот регион, что и в приложении логики. Или можно выбрать регион, который находится ближе всего к локальному источнику данных. *Ресурс шлюза в Azure* и приложение логики могут размещаться в разных расположениях.

   1. Рядом с текущим регионом выберите **Изменить регион**.

      ![Изменение текущего региона шлюза](./media/logic-apps-gateway-install/change-gateway-service-region.png)

   1. На следующей странице откройте список **«Выбрать регион»,** выберите нужный регион и выберите **«Готово».**

      ![Выберите другой регион для службы шлюза](./media/logic-apps-gateway-install/select-region-gateway-install.png)

1. Просмотрите информацию в окне окончательного подтверждения. Этот пример использует ту же учетную запись для логических приложений, Power BI, Power Apps и Power Automate, поэтому шлюз доступен для всех этих служб. Когда вы будете готовы, выберите **Закрыть**.

   ![Подтверждение информации шлюза данных](./media/logic-apps-gateway-install/finished-gateway-default-location.png)

1. Теперь [создайте ресурс Azure для установки шлюза.](../logic-apps/logic-apps-gateway-connection.md)

## <a name="check-or-adjust-communication-settings"></a>Проверка или настройка настроек связи

Шлюз данных зависит от [Azure Service Bus](../service-bus-messaging/service-bus-messaging-overview.md) для подключения к облачным технологиям и устанавливает соответствующие исходящие соединения в связанный с шлюзом регион Azure. Если рабочая среда требует, чтобы трафик проходил через прокси или брандмауэр для доступа в Интернет, это ограничение может помешать шлюзу данных для подключения к облачному сервису шлюза и автобусу Azure Service. Шлюз имеет несколько настроек связи, которые можно настроить. Дополнительные сведения см. в следующих статьях:

* [Отрегулируйте настройки связи для шлюза данных](https://docs.microsoft.com/data-integration/gateway/service-gateway-communication)
* [Настройка параметров прокси-сервера для локального шлюза данных](https://docs.microsoft.com/data-integration/gateway/service-gateway-proxy)

<a name="high-availability"></a>

## <a name="high-availability-support"></a>Поддержка высокой доступности

Чтобы избежать одной точки сбоя для доступа к данным на местах, вы можете иметь несколько установок шлюза (только стандартный режим) с каждым на другом компьютере, и настроить их как кластер или группу. Таким образом, если основной шлюз недоступен, запросы данных направляются на второй шлюз и так далее. Поскольку вы можете установить только один стандартный шлюз на компьютере, необходимо установить каждый дополнительный шлюз, который в кластере, на другом компьютере. Все разъемы, которые работают с шлюзом данных, поддерживают высокую доступность.

* У вас уже должна быть по крайней мере одна установка шлюза с той же учетной записью Azure, что и основной шлюз и ключ восстановления для этой установки.

* На основном шлюзе должны быть установлены обновления от ноября 2017 г. или более ранние.

После настройки основного шлюза, когда вы идете, чтобы установить другой шлюз, выберите **Добавить в существующий кластер шлюза,** выберите основной шлюз, который является первым шлюзом, который вы установили, и обеспечить ключ восстановления для этого шлюза. Дополнительные сведения см. в разделе [Кластеры с высоким уровнем доступности для локальных шлюзов данных](https://docs.microsoft.com/data-integration/gateway/service-gateway-install#add-another-gateway-to-create-a-cluster).

<a name="update-gateway-installation"></a>

## <a name="change-location-migrate-restore-or-take-over-existing-gateway"></a>Изменение расположения, миграции, восстановления или перехват имеющегося шлюза

Если необходимо изменить расположение шлюза, переместить установку шлюза на новый компьютер, восстановить поврежденный шлюз или использовать владельца существующего шлюза, вам потребуется ключ восстановления, предоставленный во время установки шлюза.

1. Запустите установщик шлюза на компьютере с существующим шлюзом. Если у вас нет последнего установщика шлюза, [загрузите последнюю версию шлюза.](https://aka.ms/on-premises-data-gateway-installer)

   > [!NOTE]
   > Перед восстановлением шлюза на компьютере, который имеет оригинальную установку шлюза, необходимо сначала удалить шлюз на этом компьютере. Это действие отключает исходный шлюз.
   > Если вы удалите или удалите кластер шлюза для любой облачной службы, вы не сможете восстановить этот кластер.

1. После открытия установки восвайте ту же учетную запись Azure, которая использовалась для установки шлюза.

1. Например, выберите **«Мигрировать», восстановить или захватить существующий шлюз** > **Next:**

   ![Выберите "Перенос, восстановление или перехват имеющегося шлюза"](./media/logic-apps-gateway-install/migrate-recover-take-over-gateway.png)

1. Выберите из доступных кластеров и шлюзов и введите ключ восстановления для выбранного шлюза, например:

   ![Выберите шлюз и предоставьте ключ восстановления](./media/logic-apps-gateway-install/select-existing-gateway.png)

1. Чтобы изменить регион, выберите **Изменение региона**и выбрать новый регион.

1. Когда вы будете готовы, выберите **нанастройку,** чтобы вы могли закончить задачу.

## <a name="tenant-level-administration"></a>Администрация на уровне арендаторов

Чтобы получить видимость во всех шлюзах данных в агоне Azure AD, глобальные администраторы в этом администраторе могут войти в [центр администратора Power Platform](https://powerplatform.microsoft.com) в качестве администратора-арендатора и выбрать опцию Data **Gateways.** Для получения дополнительной [Tenant-level administration for the on-premises data gateway](https://docs.microsoft.com/data-integration/gateway/service-gateway-tenant-level-admin)информации см.

<a name="restart-gateway"></a>

## <a name="restart-gateway"></a>Перезапуск шлюза

По умолчанию установка шлюза на локальном компьютере выполняется как учетная запись службы Windows под названием "Служба шлюза данных на локальном портале". Тем не менее, `NT SERVICE\PBIEgwService` установка шлюза использует имя для своих учетных данных "Log On As" и имеет "Вход в качестве службы" разрешений.

> [!NOTE]
> Ваша учетная запись службы Windows отличается от учетной записи, используемой для подключения к источникам данных на месте, и от учетной записи Azure, которую вы используете при входе в облачные службы.

Как и любая другая служба Windows, вы можете начать и остановить шлюз различными способами. Для получения дополнительной информации [см.](https://docs.microsoft.com/data-integration/gateway/service-gateway-restart)

<a name="gateway-cloud-service"></a>

## <a name="how-the-gateway-works"></a>Как работает шлюз

Пользователи вашей организации могут получить доступ к данным, к которым они уже имеют авторизованный доступ. Однако, прежде чем эти пользователи смогут подключиться к вашему исходуным данным, необходимо установить и настроить шлюз данных. Как правило, админ — это человек, который устанавливает и устанавливает шлюз. Эти действия могут потребовать разрешения администратора сервера или специальных знаний о ваших внутренних серверах.

Шлюз помогает быстрее и безопаснее закулисно общаться. Эта связь течет между пользователем в облаке, облачным сервисом шлюза и вашим исходным источником данных. Облачная служба шлюза шифрует и хранит учетные данные источников данных и сведения о шлюзах. Служба также направляет запросы и их результаты между пользователем, шлюзом и вашим исходным источником данных.

Шлюз работает с брандмауэрами и использует только исходящие соединения. Весь трафик происходит как защищенный исходящий трафик от агента шлюза. Шлюз передает данные из предварительных источников по зашифрованным каналам через [Azure Service Bus.](../service-bus-messaging/service-bus-messaging-overview.md) Служебная шина создает канал между шлюзом и службой вызовов, при этом она не хранит никаких данных. Шифруются все данные, которые передаются через шлюз.

![Архитектура для шлюза данных](./media/logic-apps-gateway-install/how-on-premises-data-gateway-works-flow-diagram.png)

> [!NOTE]
> В зависимости от облачной службы может потребоваться настроить источник данных для шлюза.

Эти шаги описывают, что происходит при взаимодействии с элементом, подключенным к источнику данных:

1. Облачный сервис создает запрос вместе с зашифрованными учетными данными для источника данных. Затем служба отправляет запрос и учетные данные в очередь шлюза для обработки.

1. Облачный сервис шлюза анализирует запрос и толкает запрос в Шины службы Azure.

1. Автобус службы Azure отправляет нерешенные запросы на шлюз.

1. Шлюз получает запрос, расшифровывает учетные данные и подключается к одному или несколько источникам данных с этими учетными данными.

1. Шлюз отправляет запрос в исходный исход данных для выполнения.

1. Результаты отправляются из источника данных обратно в шлюз, а затем — в облачную службу шлюза. Затем облачная служба шлюза использует эти результаты.

### <a name="authentication-to-on-premises-data-sources"></a>Проверка подлинности в локальных источниках данных

Сохраненный учетный учет используется для подключения от шлюза к локальному источникам данных. Независимо от пользователя, шлюз использует сохраненный учетные данные для подключения. Для конкретных служб, таких как Direct'ery и LiveConnect для аналитических служб в Power BI могут быть исключены исключения аутентификации.

### <a name="azure-active-directory-azure-ad"></a>Azure Active Directory (Azure AD)

Облачные службы Майкрософт используют [Azure AD](../active-directory/fundamentals/active-directory-whatis.md) для проверки подлинности пользователей. Арендатор Azure AD содержит имена пользователей и группы безопасности. Как правило, адрес электронной почты, который используется для ввоза, совпадает с основным именем пользователя (UPN) для вашей учетной записи.

### <a name="what-is-my-upn"></a>Что такое мой UPN?

Если вы не являетесь амином домена, вы можете не знать ваш UPN. Чтобы найти UPN для учетной `whoami /upn` записи, запустите команду с рабочей станции. Хотя результат выглядит как адрес электронной почты, в результате UPN для вашей учетной записи локального домена.

### <a name="synchronize-an-on-premises-active-directory-with-azure-ad"></a>Синхронизация локального каталога Active Directory с Azure AD

UPN для ваших учетных записей Active Directory и учетных записей Azure AD должен быть одинаковым. Таким образом, убедитесь, что каждый внепредконь аккаунт Active Directory совпадает с вашей учетной записью Azure AD. Облачные службы знают только об учетных записях в Azure AD. Таким образом, вам не нужно добавлять учетную запись в свой предпосылок Active Directory. Если учетная запись не существует в Azure AD, эту учетную запись не использовать.

Вот способы, с помощью которого можно сопоставить учетные записи Active Directory с Azure AD.

* Добавляйте учетные записи вручную в Azure AD.

  Создайте учетную запись на портале Azure или в центре для админ-центра Microsoft 365. Убедитесь, что имя учетной записи совпадает с UPN для учетной записи Active Directory.

* Синхронизируйте локальные учетные записи с вашим арендатором Azure AD с помощью инструмента Azure Active Directory Connect.

  Инструмент Azure AD Connect предоставляет варианты синхронизации и настройки проверки подлинности каталога. Эти параметры включают синхронизацию хэша паролей, сквозную аутентификацию и федерацию. Если вы не являетесь амин-аденом-арендатором или локальным амином домена, обратитесь к ИТ-амину, чтобы настроить Azure AD Connect. Azure AD Connect гарантирует соответствие UpN локального Active Directory. Это соответствие помогает, если вы используете службы анализа живых соединений с Power BI или одним всходним (SSO) возможностями.

  > [!NOTE]
  > Синхронизация учетных записей с инструментом Azure AD Connect создает новые учетные записи в вашем атте-арендаторе Azure AD.

<a name="faq"></a>

## <a name="faq-and-troubleshooting"></a>Часто задаваемые вопросы и устранение неполадок

Дополнительные сведения см. в следующих статьях:

* [На-предпосылки данных шлюз часто задаваемые вопросы](https://docs.microsoft.com/data-integration/gateway/service-gateway-onprem-faq)
* [Устранение проблем в шлюзе данных](https://docs.microsoft.com/data-integration/gateway/service-gateway-tshoot)
* [Отслеживание и оптимизация производительности шлюза](https://docs.microsoft.com/data-integration/gateway/service-gateway-performance)

## <a name="next-steps"></a>Дальнейшие действия

* [Подключение к данным о том, что они будут получены из логических приложений](../logic-apps/logic-apps-gateway-connection.md)
* [Возможности интеграции Enterprise](../logic-apps/logic-apps-enterprise-integration-overview.md)
* [Соединители для Azure Logic Apps](../connectors/apis-list.md)
