---
title: Установка локального шлюза данных — Azure Logic Apps
description: Чтобы получить доступ к данным в локальной среде из Azure Logic Apps, нужно скачать и установить локальный шлюз данных.
services: logic-apps
ms.service: logic-apps
ms.suite: integration
author: ecfan
ms.author: estfan
ms.reviewer: arthii, LADocs
ms.topic: article
ms.date: 11/06/2019
ms.openlocfilehash: ef46fce8609119777ef73cbe189d7a8ace662c91
ms.sourcegitcommit: a107430549622028fcd7730db84f61b0064bf52f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/14/2019
ms.locfileid: "74076938"
---
# <a name="install-on-premises-data-gateway-for-azure-logic-apps"></a>Установка локального шлюза данных для Azure Logic Apps

Прежде чем можно будет [подключиться к локальным источникам данных из Azure Logic Apps](../logic-apps/logic-apps-gateway-connection.md), скачайте и установите локальный [шлюз данных](https://aka.ms/on-premises-data-gateway-installer) на локальном компьютере. Шлюз работает как мост, обеспечивающий быструю пересылку данных и шифрование между источниками данных в локальной среде и приложениями логики. Вы можете использовать одну и ту же установку шлюза с другими облачными службами, такими как Power BI, Автоматизация питания, Power Apps и Azure Analysis Services. Сведения об использовании шлюза с этими службами см. в следующих статьях:

* [Локальный шлюз данных Microsoft Power автоматизиру](/power-automate/gateway-reference)
* [Локальный шлюз данных](/power-bi/service-gateway-onprem)
* [Локальный шлюз данных Microsoft Power Apps](/powerapps/maker/canvas-apps/gateway-reference)
* [Локальный шлюз данных](../analysis-services/analysis-services-gateway.md)

В этой статье показано, как скачать, установить и настроить локальный шлюз данных, чтобы получить доступ к локальным источникам данных из Azure Logic Apps. Дополнительные сведения о [работе шлюза данных см](#gateway-cloud-service) . Далее в этом разделе. Дополнительные сведения о шлюзе см. [в статье что такое локальный шлюз](https://docs.microsoft.com/data-integration/gateway/service-gateway-onprem)?

<a name="requirements"></a>

## <a name="prerequisites"></a>предварительным требованиям

* Учетная запись и подписка Azure. Если у вас нет учетной записи Azure с подпиской, зарегистрируйтесь, чтобы [получить бесплатную учетную запись Azure](https://azure.microsoft.com/free/).

  * Учетная запись Azure должна принадлежать к одному [клиенту или каталогу Azure Active Directory (Azure AD)](../active-directory/fundamentals/active-directory-whatis.md#terminology). Для установки и администрирования шлюза на локальном компьютере необходимо использовать одну и ту же учетную запись Azure.

  * Во время установки шлюза вы входите с помощью учетной записи Azure, которая связывает установку шлюза с учетной записью Azure и только с этой учетной записью. Позже в портал Azure необходимо использовать одну и ту же учетную запись Azure и клиент Azure AD при создании ресурса шлюза Azure, который регистрирует и заявляет установку шлюза. В Azure Logic Apps локальные триггеры и действия затем используют ресурс шлюза для подключения к локальным источникам данных.

    > [!NOTE]
    > Вы можете связать только одну установку шлюза и один ресурс шлюза Azure друг с другом. Вы не можете связать одну установку шлюза с несколькими учетными записями Azure или ресурсами шлюза Azure. Однако учетная запись Azure может ссылаться на несколько установок шлюза и ресурсов шлюза Azure. В локальном триггере или действии можно выбрать из различных подписок Azure, а затем выбрать связанный ресурс шлюза.

  * Необходимо выполнить вход с помощью рабочей учетной записи или учебной учетной записи, которая также называется учетной записью *Организации* , которая выглядит как `username@contoso.com`. Вы не можете использовать учетные записи Azure B2B (гостевые) или личные учетные записи Майкрософт, например @hotmail.com или @outlook.com.

    > [!TIP]
    > Если вы зарегистрировались в предложении Office 365 и не ввели свой рабочий адрес электронной почты, ваш адрес может выглядеть `username@domain.onmicrosoft.com`. Ваша учетная запись хранится в клиенте в Azure Active Directory (Azure AD). В большинстве случаев имя участника-пользователя (UPN) для учетной записи Azure AD совпадает с адресом электронной почты.
    >
    > Чтобы использовать [стандартную подписку Visual Studio](https://visualstudio.microsoft.com/vs/pricing/) , связанную с учетная запись Майкрософт, сначала [Создайте клиент в Azure AD](../active-directory/develop/quickstart-create-new-tenant.md) или используйте каталог по умолчанию. Добавьте пользователя с паролем в каталог, а затем предоставьте ему доступ к своей подписке Azure. Затем вы можете войти в систему во время установки шлюза, используя эти имя пользователя и пароль.

* Требования для локального компьютера приведены ниже.

  **Минимальные требования**

  * .NET Framework 4.7.2
  * 64-разрядная версия Windows 7 или Windows Server 2008 R2 (или более поздняя версия).

  **Рекомендуемые требования**

  * 8-ядерный ЦП.
  * 8 ГБ ОЗУ.
  * 64-разрядная версия Windows Server 2012 R2 или более поздней версии
  * Хранилище твердотельных накопителей (SSD) для буферизации

  > [!NOTE]
  > Шлюз не поддерживает Windows Server Core.

* **Связанные вопросы**

  * Локальный шлюз данных должен быть установлен только на локальном компьютере, который не является контроллером домена. Тем не менее не нужно устанавливать шлюз на компьютере, на котором размещен источник данных. Вам нужен только один шлюз для всех источников данных, поэтому вам не нужно устанавливать шлюз для каждого источника данных.

    > [!TIP]
    > Чтобы свести к минимуму задержки, шлюз можно установить как можно ближе к источнику данных или даже на том же компьютере, если только у вас есть соответствующие разрешения.

  * Установите шлюз на компьютере, который находится в проводной сети, подключенном к Интернету, всегда включается и не переходит в спящий режим. В противном случае шлюз не сможет работать, и производительность может снизиться по беспроводной сети.

  * Если вы планируете использовать проверку подлинности Windows, убедитесь, что шлюз установлен на компьютере, который является членом той же среды Active Directory, что и источники данных.

  * Регион, выбранный для установки шлюза, является тем же расположением, которое необходимо выбрать при последующем создании ресурса шлюза Azure для приложения логики. По умолчанию этот регион совпадает с расположением клиента Azure AD, который управляет учетной записью Azure. Однако расположение можно изменить во время установки шлюза.

  * Шлюз имеет два режима: Стандартный и личный режим, который применяется только к Power BI. На одном компьютере нельзя запустить несколько шлюзов в одном и том же режиме.

  * Azure Logic Apps поддерживает операции чтения и записи через шлюз. Однако эти операции имеют [ограничения на размер полезных данных](https://docs.microsoft.com/data-integration/gateway/service-gateway-onprem#considerations).

<a name="install-gateway"></a>

## <a name="install-data-gateway"></a>Установка шлюза данных

1. [Скачайте и запустите установщик шлюза на локальном компьютере](https://aka.ms/on-premises-data-gateway-installer).

1. После открытия установщика нажмите кнопку **Далее**.

   ![Начальный экран для установщика шлюза](./media/logic-apps-gateway-install/gateway-intro-screen.png)

1. Выберите **локальный шлюз данных (рекомендуется)** , который является стандартным режимом, и нажмите кнопку **Далее**.

   ![Выбор режима выполнения для шлюза данных](./media/logic-apps-gateway-install/select-gateway-running-mode.png)

1. Просмотрите минимальные требования, оставьте путь установки по умолчанию, примите условия использования и нажмите кнопку **установить**.

   ![Проверка требований и принятие условий использования](./media/logic-apps-gateway-install/review-and-accept-terms-of-use.png)

1. После успешной установки шлюза укажите адрес электронной почты для учетной записи Azure, а затем выберите **Вход**, например:

   ![Выполнение входа в рабочую или учебную учетную запись](./media/logic-apps-gateway-install/sign-in-gateway-install.png)

   Установка шлюза может ссылаться только на одну учетную запись Azure.

1. Выберите **зарегистрировать новый шлюз на этом компьютере** > **Далее**. Этот шаг регистрирует установку шлюза в [облачной службе шлюза](#gateway-cloud-service).

   ![Регистрация шлюза на локальном компьютере](./media/logic-apps-gateway-install/register-gateway-local-computer.png)

1. Для установки шлюза необходимо указать следующие сведения.

   * Имя шлюза, уникальное для клиента Azure AD
   * Ключ восстановления, который должен содержать по крайней мере восемь символов, которые вы хотите использовать.
   * Подтверждение ключа восстановления

   ![Укажите сведения для установки шлюза](./media/logic-apps-gateway-install/gateway-name-recovery-key.png)

   > [!IMPORTANT]
   > Сохраните и держите ключ восстановления в безопасном месте. Этот ключ необходим, если вам когда-либо нужно изменить расположение, переместить, восстановить или перехватить установку шлюза.

   Обратите внимание на возможность **добавления в существующий кластер шлюза**, который выбирается при установке дополнительных шлюзов для [сценариев с высоким уровнем доступности](#high-availability).

1. Проверьте регион облачной службы шлюза и служебной [шины Azure](https://azure.microsoft.com/services/service-bus/) , которая используется для установки шлюза. По умолчанию этот регион совпадает с расположением клиента Azure AD для вашей учетной записи Azure.

   ![Подтвердите регион для службы шлюза и служебной шины](./media/logic-apps-gateway-install/confirm-gateway-region.png)

1. Чтобы принять регион по умолчанию, щелкните **настроить**. Однако если область по умолчанию не является ближайшим к вам, можно изменить регион.

   *Причины изменения региона установки шлюза.*

   Например, чтобы уменьшить задержку, можно изменить регион своего шлюза на тот регион, что и в приложении логики. Или можно выбрать регион, который находится ближе всего к локальному источнику данных. *Ресурс шлюза в Azure* и приложение логики могут размещаться в разных расположениях.

   1. Рядом с текущим регионом выберите **Изменить регион**.

      ![Изменение текущего региона шлюза](./media/logic-apps-gateway-install/change-gateway-service-region.png)

   1. На следующей странице откройте список **Выбор региона** , выберите нужный регион и нажмите кнопку **Готово**.

      ![Выберите другой регион для службы шлюза](./media/logic-apps-gateway-install/select-region-gateway-install.png)

1. Проверьте сведения в окончательном окне подтверждения. В этом примере используется та же учетная запись для Logic Apps, Power BI, Power Apps и Power автоматизируя, поэтому шлюз доступен для всех этих служб. Когда будете готовы, нажмите кнопку **Закрыть**.

   ![Подтверждение сведений о шлюзе данных](./media/logic-apps-gateway-install/finished-gateway-default-location.png)

1. Теперь [Создайте ресурс Azure для установки шлюза](../logic-apps/logic-apps-gateway-connection.md).

## <a name="check-or-adjust-communication-settings"></a>Проверка или Настройка параметров связи

Локальный шлюз данных зависит от [служебной шины Azure](../service-bus-messaging/service-bus-messaging-overview.md) для подключения к облаку и устанавливает соответствующие исходящие подключения к соответствующему региону Azure шлюза. Если ваша рабочая среда требует, чтобы трафик проработал через прокси-сервер или брандмауэр для доступа к Интернету, это ограничение может препятствовать подключению локального шлюза данных к облачной службе шлюза и служебной шине Azure. Шлюз имеет несколько параметров связи, которые можно настроить. Дополнительные сведения см. в следующих статьях:

* [Настройка параметров связи для локального шлюза данных](https://docs.microsoft.com/data-integration/gateway/service-gateway-communication)
* [Настройка параметров прокси-сервера для локального шлюза данных](https://docs.microsoft.com/data-integration/gateway/service-gateway-proxy)

<a name="high-availability"></a>

## <a name="high-availability-support"></a>Поддержка высокой доступности

Чтобы избежать единой точки отказа для доступа к локальному доступу к данным, можно установить несколько вариантов шлюза (только для стандартного режима) с каждым на разных компьютерах и настроить их как кластер или группу. Таким образом, если основной шлюз недоступен, запросы данных направляются на второй шлюз и т. д. Так как на компьютере можно установить только один стандартный шлюз, необходимо установить каждый дополнительный шлюз, который находится в кластере, на другом компьютере. Все соединители, работающие с локальным шлюзом данных, поддерживают высокий уровень доступности.

* У вас уже должна быть хотя бы одна установка шлюза с той же учетной записью Azure, что и основной шлюз, и ключ восстановления для этой установки.

* На основном шлюзе должны быть установлены обновления от ноября 2017 г. или более ранние.

После настройки основного шлюза, когда вы переходите к установке другого шлюза, выберите **Добавить в существующий кластер шлюза**, выберите основной шлюз, который является первым установленным шлюзом, и укажите ключ восстановления для этого шлюза. Дополнительные сведения см. в разделе [Кластеры с высоким уровнем доступности для локальных шлюзов данных](https://docs.microsoft.com/data-integration/gateway/service-gateway-install#add-another-gateway-to-create-a-cluster).

<a name="update-gateway-installation"></a>

## <a name="change-location-migrate-restore-or-take-over-existing-gateway"></a>Изменение расположения, миграции, восстановления или перехват имеющегося шлюза

Если необходимо изменить расположение шлюза, переместить установку шлюза на новый компьютер, восстановить поврежденный шлюз или использовать владельца существующего шлюза, вам потребуется ключ восстановления, предоставленный во время установки шлюза.

1. Запустите установщик шлюза на компьютере с имеющимся шлюзом. Если у вас нет последнего установщика шлюза, [скачайте последнюю версию шлюза](https://aka.ms/on-premises-data-gateway-installer).

   > [!NOTE]
   > Перед восстановлением шлюза на компьютере с исходной установкой шлюза необходимо сначала удалить шлюз на этом компьютере. Это действие отключает исходный шлюз.
   > Если вы удалите или удалите кластер шлюза для любой облачной службы, вы не сможете восстановить этот кластер.

1. После открытия установщика Войдите в систему, используя ту же учетную запись Azure, которая использовалась для установки шлюза.

1. Выберите **миграция, восстановление или перенаправление существующего шлюза** > **Далее**, например:

   ![Выберите "Перенос, восстановление или перехват имеющегося шлюза"](./media/logic-apps-gateway-install/migrate-recover-take-over-gateway.png)

1. Выберите из доступных кластеров и шлюзов и введите ключ восстановления для выбранного шлюза, например:

   ![Выберите шлюз и укажите ключ восстановления.](./media/logic-apps-gateway-install/select-existing-gateway.png)

1. Чтобы изменить регион, щелкните **изменить регион**и выберите новый регион.

1. Когда будете готовы, нажмите кнопку **настроить** , чтобы завершить выполнение задачи.

## <a name="tenant-level-administration"></a>Администрирование на уровне клиента

Чтобы получить сведения о всех локальных шлюзах данных в клиенте Azure AD, глобальные администраторы этого клиента могут войти в [центр администрирования Power Platform](https://powerplatform.microsoft.com) в качестве администратора клиента и выбрать параметр " **шлюзы данных** ". Дополнительные сведения см. в статье [Администрирование на уровне клиента для локального шлюза данных](https://docs.microsoft.com/data-integration/gateway/service-gateway-tenant-level-admin).

<a name="restart-gateway"></a>

## <a name="restart-gateway"></a>Перезапуск шлюза

По умолчанию установка шлюза на локальном компьютере выполняется как учетная запись службы Windows с именем "Служба локального шлюза данных". Однако при установке шлюза используется `NT SERVICE\PBIEgwService` имя учетной записи для входа в систему, а также разрешения «вход в качестве службы».

> [!NOTE]
> Учетная запись службы Windows отличается от учетной записи, используемой для подключения к локальным источникам данных, и от учетной записи Azure, используемой при входе в облачные службы.

Как и любая другая служба Windows, шлюз можно запускать и прекращать различными способами. Дополнительные сведения см. [в статье перезапуск локального шлюза данных](https://docs.microsoft.com/data-integration/gateway/service-gateway-restart).

<a name="gateway-cloud-service"></a>

## <a name="how-the-gateway-works"></a>Как работает шлюз

Пользователи в вашей организации могут получить доступ к локальным данным, для которых у них уже есть права на доступ. Тем не менее, чтобы пользователи могли подключаться к локальному источнику данных, необходимо установить и настроить локальный шлюз данных. Как правило, администратор — это пользователь, который устанавливает и настраивает шлюз. Для этих действий могут потребоваться разрешения администратора сервера или специальные знания о локальных серверах.

Шлюз обеспечивает быструю и безопасную связь в фоновом режиме. Это взаимодействие между пользователем в облаке, облачной службой шлюза и локальным источником данных. Облачная служба шлюза шифрует и хранит учетные данные источников данных и сведения о шлюзах. Служба также направляет запросы и их результаты между пользователем, шлюзом и локальным источником данных.

Шлюз работает с брандмауэрами и использует только исходящие соединения. Весь трафик поступает как безопасный исходящий трафик от агента шлюза. Шлюз передает данные из локальных источников в зашифрованные каналы через [служебную шину Azure](../service-bus-messaging/service-bus-messaging-overview.md). Служебная шина создает канал между шлюзом и службой вызовов, при этом она не хранит никаких данных. Шифруются все данные, которые передаются через шлюз.

![Архитектура локального шлюза данных](./media/logic-apps-gateway-install/how-on-premises-data-gateway-works-flow-diagram.png)

> [!NOTE]
> В зависимости от облачной службы может потребоваться настроить источник данных для шлюза.

Эти шаги описывают, что происходит при взаимодействии с элементом, подключенным к локальному источнику данных:

1. Облачная служба создает запрос вместе с зашифрованными учетными данными для источника данных. Затем служба отправляет запрос и учетные данные в очередь шлюза для обработки.

1. Облачная служба шлюза анализирует запрос и отправляет запрос в служебную шину Azure.

1. Служебная шина Azure отправляет ожидающие запросы в шлюз.

1. Шлюз получает запрос, расшифровывает учетные данные и подключается к одному или нескольким источникам данных с этими учетными данными.

1. Шлюз отправляет запрос в источник данных для выполнения.

1. Результаты отправляются из источника данных обратно в шлюз, а затем — в облачную службу шлюза. Затем облачная служба шлюза использует эти результаты.

### <a name="authentication-to-on-premises-data-sources"></a>Проверка подлинности в локальных источниках данных

Сохраненные учетные данные используются для подключения из шлюза к локальным источникам данных. Независимо от пользователя, шлюз использует сохраненные учетные данные для подключения. Могут возникнуть исключения проверки подлинности для конкретных служб, например DirectQuery и Ливеконнект, для Analysis Services в Power BI.

### <a name="azure-active-directory-azure-ad"></a>Azure Active Directory (Azure AD)

Облачные службы Майкрософт используют [Azure AD](../active-directory/fundamentals/active-directory-whatis.md) для проверки подлинности пользователей. Клиент Azure AD содержит имена пользователей и группы безопасности. Как правило, адрес электронной почты, используемый для входа, совпадает с именем участника-пользователя (UPN) для вашей учетной записи.

### <a name="what-is-my-upn"></a>Что такое UPN?

Если вы не являетесь администратором домена, возможно, вы не знаете имя участника-пользователя. Чтобы найти имя участника-пользователя для своей учетной записи, выполните команду `whoami /upn` на рабочей станции. Хотя результат выглядит как адрес электронной почты, результатом является имя участника-пользователя для учетной записи локального домена.

### <a name="synchronize-an-on-premises-active-directory-with-azure-ad"></a>Синхронизация локальной Active Directory с Azure AD

Имя участника-пользователя для локальных учетных записей Active Directory и учетных записей Azure AD должно быть одинаковым. Убедитесь, что каждая локальная учетная запись Active Directory соответствует учетной записи Azure AD. Облачные службы узнают только об учетных записях в Azure AD. Поэтому вам не нужно добавлять учетную запись в локальный Active Directory. Если учетная запись не существует в Azure AD, эту учетную запись использовать нельзя.

Ниже приведены способы сопоставления локальных учетных записей Active Directory с Azure AD.

* Вручную добавьте учетные записи в Azure AD.

  Создайте учетную запись в портал Azure или в центре администрирования Microsoft 365. Убедитесь, что имя учетной записи совпадает с именем участника-пользователя для локальной учетной записи Active Directory.

* Синхронизация локальных учетных записей с клиентом Azure AD с помощью средства Azure Active Directory Connect.

  Средство Azure AD Connect предоставляет параметры для синхронизации каталогов и настройки проверки подлинности. Эти параметры включают синхронизацию хэша паролей, сквозную аутентификацию и Федерацию. Если вы не являетесь администратором клиента или администратором локального домена, обратитесь к ИТ-администратору, чтобы получить Azure AD Connect настройки. Azure AD Connect гарантирует, что имя участника-пользователя Azure AD совпадает с локальным Active Directory UPN. Такое сопоставление помогает при использовании Analysis Services активных подключений с функциями Power BI или единого входа (SSO).

  > [!NOTE]
  > Синхронизация учетных записей с помощью средства Azure AD Connect создает новые учетные записи в клиенте Azure AD.

<a name="faq"></a>

## <a name="faq-and-troubleshooting"></a>Часто задаваемые вопросы и устранение неполадок

Дополнительные сведения см. в следующих статьях:

* [Вопросы и ответы о локальном шлюзе данных](https://docs.microsoft.com/data-integration/gateway/service-gateway-onprem-faq)
* [Устранение неполадок локального шлюза данных](https://docs.microsoft.com/data-integration/gateway/service-gateway-tshoot)
* [Мониторинг и оптимизация производительности шлюза](https://docs.microsoft.com/data-integration/gateway/service-gateway-performance)

## <a name="next-steps"></a>Дополнительная информация

* [Подключение к локальным данным из приложений логики](../logic-apps/logic-apps-gateway-connection.md)
* [Возможности интеграции Enterprise](../logic-apps/logic-apps-enterprise-integration-overview.md)
* [Список соединителей](../connectors/apis-list.md)
