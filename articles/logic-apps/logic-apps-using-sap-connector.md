---
title: Подключение к системам SAP - Azure Logic Apps
description: Доступ и управлять ресурсы SAP благодаря автоматизации рабочих процессов с помощью Azure Logic Apps
services: logic-apps
ms.service: logic-apps
ms.suite: integration
author: ecfan
ms.author: estfan
ms.reviewer: divswa, LADocs
ms.topic: article
ms.date: 05/09/2019
tags: connectors
ms.openlocfilehash: bccefec80ef3afd6d312bb1048d3be5d8e708728
ms.sourcegitcommit: 25a60179840b30706429c397991157f27de9e886
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/28/2019
ms.locfileid: "66258152"
---
# <a name="connect-to-sap-systems-from-azure-logic-apps"></a>Подключение к системам SAP из Azure Logic Apps

В этой статье показано, как доступ к SAP локальным ресурсам из внутри приложения логики с помощью соединителя SAP. Соединитель работает с такими классическими выпусками SAP, как R/3, локальные системы ECC. Соединитель также поддерживает интеграцию с более новые системы SAP на базе HANA компании SAP s/4 HANA, например, везде, где они размещаются - в локальной среде или в облаке. Соединитель SAP поддерживает интеграцию сообщений или данных и из систем на основе SAP NetWeaver через промежуточный документа (IDoc) интерфейса программирования приложений бизнеса (BAPI) или удаленный вызов функции (RFC).

Соединитель SAP использует [библиотека соединителя SAP .NET (NCo)](https://support.sap.com/en/product/connectors/msnet.html) и предоставляет эти операции или действия:

* **Отправка в SAP**. Отправлять IDoc по tRFC, вызывать функции BAPI через RFC или вызов RFC/tRFC в системах SAP.
* **Получение из SAP**. Получение IDoc через tRFC, вызывать функции BAPI через tRFC или вызов RFC/tRFC в системах SAP.
* **Создание схем**. Создайте схемы для артефактов SAP RFC, BAPI и IDoc.

Для выполнения всех перечисленных операций соединитель SAP поддерживает базовую аутентификацию на основе имени пользователя и пароля. Соединитель также поддерживает [Communications Network (SNC)](https://help.sap.com/doc/saphelp_nw70/7.0.31/e6/56f466e99a11d1a5b00000e835363f/content.htm?no_cache=true), который можно использовать для SAP NetWeaver единого входа или для обеспечения дополнительной безопасности, предоставляемые на них продуктами обеспечения безопасности.

Соединитель SAP интегрируется с локальными системами SAP через [локальный шлюз данных](../logic-apps/logic-apps-gateway-connection.md). В сценариях отправки например, при отправке сообщения из приложений логики к системе SAP, шлюз данных выступает в качестве клиента RFC и перенаправляет запросы, полученные из приложений логики в SAP.
Аналогичным образом в сценариях Receive, шлюз данных действует как сервер RFC, получает запросы от SAP и пересылает в приложение логики.

В этой статье показано, как создать пример приложения логики, которое интегрируется с SAP, и использовать его для описанных ранее сценариев интеграции.

<a name="pre-reqs"></a>

## <a name="prerequisites"></a>Технические условия

Чтобы выполнить действия, описанные в этой статье, потребуется следующее:

* Подписка Azure. Если у вас еще нет подписки Azure, [получите бесплатную учетную запись Azure](https://azure.microsoft.com/free/).

* Приложение логики, из которого требуется осуществлять доступ к системе SAP, и триггер, который запускает рабочий процесс приложения логики. Если вы не знакомы с приложениями логики, ознакомьтесь со статьями [Что такое Azure Logic Apps](../logic-apps/logic-apps-overview.md) и [Краткое руководство. Создание первого автоматизированного рабочего процесса с помощью Azure Logic Apps на портале Azure](../logic-apps/quickstart-create-first-logic-app-workflow.md).

* Сервер [SAP Application Server](https://wiki.scn.sap.com/wiki/display/ABAP/ABAP+Application+Server) или [SAP Message Server](https://help.sap.com/saphelp_nw70/helpdata/en/40/c235c15ab7468bb31599cc759179ef/frameset.htm)

* Скачайте и установите последнюю версию [локального шлюза данных](https://www.microsoft.com/download/details.aspx?id=53127) на любом компьютере в локальной среде. Не забудьте настроить шлюз на портале Azure, прежде чем продолжить. Шлюз помогает безопасного доступа к локальным данным и ресурсам. Дополнительные сведения см. в статье [Установка локального шлюза данных для Azure Logic Apps](../logic-apps/logic-apps-gateway-install.md).

* Если вы используете SNC с Single Sign-On (SSO), убедитесь, что шлюз работает в качестве пользователя, который сопоставлен с пользователя SAP. Чтобы изменить учетную запись по умолчанию, выберите **изменить учетную запись**и введите учетные данные пользователя.

  ![Изменение учетной записи шлюза](./media/logic-apps-using-sap-connector/gateway-account.png)

* Если вы включаете SNC с помощью программного обеспечения безопасности, скопируйте библиотека SNC или файлы на том же компьютере, где установлен шлюз. Некоторые примеры продуктов SNC [sapseculib](https://help.sap.com/saphelp_nw74/helpdata/en/7a/0755dc6ef84f76890a77ad6eb13b13/frameset.htm), Kerberos, NTLM, и т. д.

* Скачайте и установите последнюю версию библиотеки клиента SAP, которая в данный момент [соединитель SAP (NCo) 3.0.21.0 для Microsoft .NET Framework 4.0 и Windows 64 bit (x64)](https://softwaredownloads.sap.com/file/0020000001865512018), на одном компьютере с локальным шлюзом данных. Необходимо установить эту или более позднюю версию по следующим причинам:

  * Предыдущие версии SAP NCo могут оказаться заблокированными при одновременной отправке более одного сообщения IDoc. Это состояние блокирует все последующие сообщения, передаваемые объекту назначения SAP, что вызывает превышение времени ожидания сообщений.

  * Локальный шлюз данных работает только в 64-разрядных системах. В противном случае возникает ошибка неправильного образа, так как служба узла шлюза управления данными не поддерживает 32-разрядные сборки.

  * Как служба узла шлюза управления данными, так и Microsoft SAP Adapter используют .NET Framework 4.5. SAP NCo для .NET Framework 4.0 работает с процессами, использующими среду выполнения .NET версии от 4.0 до 4.7.1. SAP NCo для .NET Framework 2.0 работает с процессами, использующими среду выполнения .NET версии от 2.0 до 3.5, и больше не работает с новейшей версией локального шлюза данных.

* Содержимое сообщения, отправляемое на сервер SAP, например образец файла IDoc. Это содержимое должно быть в формате XML и включать в себя пространство имен для действия SAP, которое требуется использовать.

<a name="add-trigger"></a>

## <a name="send-to-sap"></a>Отправка в SAP

В этом примере используется приложение логики, которое может запускаться по HTTP-запросу. Приложения логики отправляет промежуточный документ (IDoc) на сервер SAP и возвращает ответ запрашивающему объекту, вызвавшему приложение логики. 

### <a name="add-http-request-trigger"></a>Добавление триггера HTTP-запроса

В Azure Logic Apps каждое приложение логики должно запускаться по [триггеру](../logic-apps/logic-apps-overview.md#logic-app-concepts), который активируется, когда происходит определенное событие или если выполняются заданные условия. При каждом срабатывании триггера обработчик Logic Apps создает экземпляр приложения логики, запускающий рабочий процесс.

В этом примере создается приложение логики с конечной точкой в Azure, позволяющее отправлять *HTTP-запросы POST* в приложение логики. Когда приложение логики получает эти HTTP-запросы, триггер срабатывает и выполняет следующий шаг рабочего процесса.

1. На [портале Azure](https://portal.azure.com) создайте пустое приложение логики. Откроется конструктор приложений логики.

1. В поле поиска введите фильтр "http-запрос". В списке триггеров выберите триггер: **При получении HTTP-запроса**

   ![Добавление триггера HTTP-запроса](./media/logic-apps-using-sap-connector/add-trigger.png)

1. Теперь сохраните приложение логики, чтобы можно было создать для него URL-адрес конечной точки. На панели инструментов конструктора нажмите кнопку **Сохранить**.

   Теперь URL-адрес конечной точки появится в триггере, например:

   ![Создание URL-адреса для конечной точки](./media/logic-apps-using-sap-connector/generate-http-endpoint-url.png)

<a name="add-action"></a>

### <a name="add-sap-action"></a>Добавление действия SAP

В Azure Logic Apps [действие](../logic-apps/logic-apps-overview.md#logic-app-concepts) — это шаг в рамках рабочего процесса, выполняемый после срабатывания триггера или другого действия. Если вы еще не добавили триггер в приложение логики и хотите следовать этому примеру, добавьте [этот триггер](#add-trigger).

1. В конструкторе приложений логики, см. в разделе триггера выберите **новый шаг**.

   ![Выбор нового шага](./media/logic-apps-using-sap-connector/add-action.png)

1. В поле поиска введите слово sap в качестве фильтра. В списке действий выберите действие **Send message to SAP** (Отправить сообщение в SAP)
  
   ![Выбор действия отправки в SAP](media/logic-apps-using-sap-connector/select-sap-send-action.png)

   Вместо поиска также можно щелкнуть вкладку **Корпоративный** и выбрать действие SAP.

   ![Выбор действия отправки в SAP на вкладке "Корпоративный"](media/logic-apps-using-sap-connector/select-sap-send-action-ent-tab.png)

1. Если потребуется ввести сведения о подключении, создайте подключение SAP. Если подключение уже существует, перейдите к следующему шагу, чтобы настроить действие SAP.

   **Создание локального подключения SAP**

   1. Укажите сведения для подключения к серверу SAP. В качестве свойства **Шлюз данных** выберите шлюз данных, созданный на портале Azure при установке шлюза.

      Если для свойства **Logon Type** (Тип входа) установлено значение **Application Server** (Сервер приложений), необходимо указать следующие свойства, которые обычно отображаются как необязательные:

      ![Создание подключения к серверу приложений SAP](media/logic-apps-using-sap-connector/create-SAP-application-server-connection.png)

      Если для свойства **Logon Type** (Тип входа) задано значение **Группа**, необходимо указать следующие свойства, которые обычно отображаются как необязательные:

      ![Создание подключения к серверу сообщений SAP](media/logic-apps-using-sap-connector/create-SAP-message-server-connection.png)

      По умолчанию строгую типизацию используется для проверки для недопустимых значений, выполняя проверки XML на соответствие схеме. Это поведение может помочь обнаружить проблемы ранее. **Безопасный ввод** параметр доступен для обеспечения обратной совместимости и только проверяет длину строки. Дополнительные сведения о [ **безопасный ввод** параметр](#safe-typing).

   1. Когда все будет готово, выберите **Создать**.

      Logic Apps настраивает и проверяет подключение, гарантируя, что оно работает правильно.

1. Теперь найдите и выберите действие с сервера SAP.

   1. В **действие SAP** , выберите значок папки. В списке файлов найдите и выберите сообщение SAP, которое следует использовать. Переходите по списку, используя стрелки.

      В этом примере выбираются IDoc с **заказы** типа.

      ![Поиск и выбор действия IDoc](./media/logic-apps-using-sap-connector/SAP-app-server-find-action.png)

      Если не удается найти необходимое действие, можно вручную ввести путь, например:

      ![Указание пути к действию IDoc вручную](./media/logic-apps-using-sap-connector/SAP-app-server-manually-enter-action.png)

      > [!TIP]
      > Укажите значение для действия SAP через редактор выражений. Таким образом, можно использовать одно действие для разных типов сообщений.

      Дополнительные сведения об операциях IDoc см. в статье [Message schemas for IDOC operations](https://docs.microsoft.com/biztalk/adapters-and-accelerators/adapter-sap/message-schemas-for-idoc-operations) (Схемы сообщений для операций IDoc).

   1. Щелкните внутри поля **Входное сообщение**, чтобы отобразился список динамического содержимого. В этом списке в разделе **При получении HTTP-запроса** выберите поле **Текст**.

      Этот шаг включает содержимое текста из триггера HTTP-запроса и отправляет эти выходные данные на сервер SAP.

      ![Выбор поля "Текст"](./media/logic-apps-using-sap-connector/SAP-app-server-action-select-body.png)

      В итоге действие SAP должно выглядеть приблизительно так, как показано в примере ниже:

      ![Готовое действие SAP](./media/logic-apps-using-sap-connector/SAP-app-server-complete-action.png)

1. Сохраните приложение логики. На панели инструментов конструктора нажмите кнопку **Сохранить**.

<a name="add-response"></a>

### <a name="add-http-response-action"></a>Добавление действия HTTP-ответа

Теперь добавьте действие ответа в рабочий процесс приложения логики и включите в него выходные данные действия SAP. Таким образом приложение логики будет возвращать результаты с сервера SAP исходной запросившей стороне.

1. В конструкторе приложений логики, под действием SAP выберите **новый шаг**.

1. В поле поиска введите фильтр "ответ". В списке действий выберите действие **Ответ**

1. Щелкните внутри поля **Текст**, чтобы отобразился список динамического содержимого. Из этого списка в разделе **отправить сообщение в SAP**выберите **текст** поля.

   ![Готовое действие SAP](./media/logic-apps-using-sap-connector/select-sap-body-for-response-action.png)

1. Сохраните приложение логики.

### <a name="test-your-logic-app"></a>Тестирование приложения логики

1. Если приложение логики еще не включено, в меню приложения логики выберите **Обзор**. На панели инструментов нажмите **Включить**.

1. На панели инструментов конструктора приложений логики нажмите **Запустить**. Так приложение логики будет запущено вручную.

1. Активируйте триггер приложения логики, отправив HTTP-запрос POST на URL-адрес, указанный в триггере HTTP-запроса, и включите в запрос содержимое сообщения. Для отправки запроса можно использовать, например, средство [Postman](https://www.getpostman.com/apps).

   В этой статье запрос передает файл IDoc, который должен быть в формате XML и включать в себя пространство имен для используемого действия SAP, например:

   ``` xml
   <?xml version="1.0" encoding="UTF-8" ?>
   <Send xmlns="http://Microsoft.LobServices.Sap/2007/03/Idoc/2/ORDERS05//720/Send">
      <idocData>
         <...>
      </idocData>
   </Send>
   ```

1. После отправки HTTP-запроса дождитесь ответа от приложения логики.

   > [!NOTE]
   > Время ожидания приложения логики может истечь, если все действия, необходимые для ответа, не будут завершены в течение [времени ожидания запроса](./logic-apps-limits-and-config.md). Если это произойдет, запросы могут быть заблокированы. Для помощи в диагностике неполадок узнайте, как можно [проверять и отслеживать приложения логики](../logic-apps/logic-apps-monitor-your-logic-apps.md).

Поздравляем! Вы создали приложение логики, которое может обмениваться данными с сервером SAP. Теперь с настроенным подключением SAP для приложения логики можно изучить другие доступные действия SAP, например BAPI и RFC.

## <a name="receive-from-sap"></a>Получение из SAP

В этом примере используется приложение логики, которое активируется при получении сообщения из системы SAP.

### <a name="add-sap-trigger"></a>Добавление триггера SAP

1. На портале Azure создайте пустое приложение логики. Откроется конструктор приложений логики.

1. В поле поиска введите слово sap в качестве фильтра. В списке триггеров выберите триггер: **When a message is received from SAP** (При получении сообщения от SAP)

   ![Добавление триггера SAP](./media/logic-apps-using-sap-connector/add-sap-trigger.png)

   Кроме того, можно перейти к **Enterprise** и выберите триггер:

   ![Добавление триггера SAP Enterprise вкладки](./media/logic-apps-using-sap-connector/add-sap-trigger-ent-tab.png)

1. Если потребуется ввести сведения о подключении, создайте подключение SAP. Если подключение уже существует, перейдите к следующему шагу, чтобы настроить действие SAP.

   **Создание локального подключения SAP**

   1. Укажите сведения для подключения к серверу SAP. В качестве свойства **Шлюз данных** выберите шлюз данных, созданный на портале Azure при установке шлюза.

      Если для свойства **Logon Type** (Тип входа) установлено значение **Application Server** (Сервер приложений), необходимо указать следующие свойства, которые обычно отображаются как необязательные:

      ![Создание подключения к серверу приложений SAP](media/logic-apps-using-sap-connector/create-SAP-application-server-connection.png)

      Если для свойства **Logon Type** (Тип входа) задано значение **Группа**, необходимо указать следующие свойства, которые обычно отображаются как необязательные:

      ![Создание подключения к серверу сообщений SAP](media/logic-apps-using-sap-connector/create-SAP-message-server-connection.png)  

      По умолчанию строгую типизацию используется для проверки для недопустимых значений, выполняя проверки XML на соответствие схеме. Это поведение может помочь обнаружить проблемы ранее. **Безопасный ввод** параметр доступен для обеспечения обратной совместимости и только проверяет длину строки. Дополнительные сведения о [ **безопасный ввод** параметр](#safe-typing).

1. Укажите необходимые параметры в зависимости от конфигурации системы SAP.

   При необходимости можно указать одно или несколько действий SAP. Этот список действий определяет сообщения, получаемые триггером с сервера SAP через шлюз данных. Пустой список означает, что триггер будет получать все сообщения. Если в списке указано несколько сообщений, триггер получает только те сообщения, которые указаны в списке. Другие сообщения, отправленные с сервера SAP, будут отклонены шлюзом.

   Действие SAP можно выбрать с помощью средства выбора файла:

   ![Выбор действия SAP](media/logic-apps-using-sap-connector/select-SAP-action-trigger.png)  

   Можно также указать действие вручную:

   ![Ввод действия SAP вручную](media/logic-apps-using-sap-connector/manual-enter-SAP-action-trigger.png) 

   Ниже приведен пример, в котором показано, как действие отображается в случае настройки триггера для получения более одного сообщения.

   ![Пример триггера](media/logic-apps-using-sap-connector/example-trigger.png)  

   Дополнительные сведения о действиях SAP см. в статье [Message schemas for IDOC operations](https://docs.microsoft.com/biztalk/adapters-and-accelerators/adapter-sap/message-schemas-for-idoc-operations) (Схемы сообщений для операций IDoc).

1. Теперь сохраните приложение логики, чтобы вы могли начать получать сообщения из системы SAP.
На панели инструментов конструктора нажмите кнопку **Сохранить**.

Теперь приложение логики может получать сообщения из системы SAP.

> [!NOTE]
> Триггер SAP не является опрашивающим триггером. Это триггер на основе веб-перехватчика. Триггер вызывается из шлюза, только если существует сообщение, поэтому опрос не требуется.

### <a name="test-your-logic-app"></a>Тестирование приложения логики

1. Чтобы активировать приложение логики, отправьте сообщение из системы SAP.

1. В меню приложения логики выберите **Обзор** и проверьте наличие новых запусков приложения логики в **журнале запусков**.

1. Откройте последний запуск, в котором отображается сообщение, отправленное из системы SAP, в разделе выходных данных триггера.

## <a name="generate-schemas-for-artifacts-in-sap"></a>Создание схем для артефактов в SAP

В этом примере используется приложение логики, которое может запускаться по HTTP-запросу. Действие SAP отправляет запрос к системе SAP на создание схем для указанного промежуточного документа (IDoc) и BAPI. Возвращаемые в ответе схемы передаются в учетную запись интеграции с помощью соединителя Azure Resource Manager.

### <a name="add-http-request-trigger"></a>Добавление триггера HTTP-запроса

1. На портале Azure создайте пустое приложение логики. Откроется конструктор приложений логики.

1. В поле поиска введите фильтр "http-запрос". В списке триггеров выберите триггер: **При получении HTTP-запроса**

   ![Добавление триггера HTTP-запроса](./media/logic-apps-using-sap-connector/add-trigger.png)

1. Теперь сохраните приложение логики, чтобы можно было создать для него URL-адрес конечной точки.
На панели инструментов конструктора нажмите кнопку **Сохранить**.

   Теперь URL-адрес конечной точки появится в триггере, например:

   ![Создание URL-адреса для конечной точки](./media/logic-apps-using-sap-connector/generate-http-endpoint-url.png)

### <a name="add-sap-action-to-generate-schemas"></a>Добавление действия SAP для создания схем

1. В конструкторе приложений логики, см. в разделе триггера выберите **новый шаг**.

   ![Выбор нового шага](./media/logic-apps-using-sap-connector/add-action.png)

1. В поле поиска введите слово sap в качестве фильтра. В списке действий выберите действие **Generate schemas** (Создание схем).
  
   ![Выбор действия отправки в SAP](media/logic-apps-using-sap-connector/select-sap-schema-generator-action.png)

   Можно также щелкнуть вкладку **Корпоративный**, а затем выбрать действие SAP.

   ![Выбор действия отправки в SAP на вкладке "Корпоративный"](media/logic-apps-using-sap-connector/select-sap-schema-generator-ent-tab.png)

1. Если потребуется ввести сведения о подключении, создайте подключение SAP. Если подключение уже существует, перейдите к следующему шагу, чтобы настроить действие SAP.

   **Создание локального подключения SAP**

   1. Укажите сведения для подключения к серверу SAP. В качестве свойства **Шлюз данных** выберите шлюз данных, созданный на портале Azure при установке шлюза.

      Если для свойства **Logon Type** (Тип входа) установлено значение **Application Server** (Сервер приложений), необходимо указать следующие свойства, которые обычно отображаются как необязательные:

      ![Создание подключения к серверу приложений SAP](media/logic-apps-using-sap-connector/create-SAP-application-server-connection.png)

      Если для свойства **Logon Type** (Тип входа) задано значение **Группа**, необходимо указать следующие свойства, которые обычно отображаются как необязательные:

      ![Создание подключения к серверу сообщений SAP](media/logic-apps-using-sap-connector/create-SAP-message-server-connection.png)

      По умолчанию строгую типизацию используется для проверки для недопустимых значений, выполняя проверки XML на соответствие схеме. Это поведение может помочь обнаружить проблемы ранее. **Безопасный ввод** параметр доступен для обеспечения обратной совместимости и только проверяет длину строки. Дополнительные сведения о [ **безопасный ввод** параметр](#safe-typing).

   1. Когда все будет готово, выберите **Создать**. 
   
      Logic Apps настраивает и проверяет подключение, гарантируя, что оно работает правильно.

1. Укажите путь к артефакту, для которого требуется создать схему.

   Действие SAP можно выбрать с помощью средства выбора файла:

   ![Выбор действия SAP](media/logic-apps-using-sap-connector/select-SAP-action-schema-generator.png)  

   Можно также ввести действие вручную:

   ![Ввод действия SAP вручную](media/logic-apps-using-sap-connector/manual-enter-SAP-action-schema-generator.png)

   Чтобы создать схемы для нескольких артефактов, укажите сведения о действии SAP для каждого артефакта, например:

   ![Выбор команды "Добавить новый элемент"](media/logic-apps-using-sap-connector/schema-generator-array-pick.png)

   ![Отображение двух элементов](media/logic-apps-using-sap-connector/schema-generator-example.png)

   Дополнительные сведения о действиях SAP см. в статье [Message schemas for IDOC operations](https://docs.microsoft.com/biztalk/adapters-and-accelerators/adapter-sap/message-schemas-for-idoc-operations) (Схемы сообщений для операций IDoc).

1. Сохраните приложение логики. На панели инструментов конструктора нажмите кнопку **Сохранить**.

### <a name="test-your-logic-app"></a>Тестирование приложения логики

1. На панели инструментов конструктора выберите **Запустить**, чтобы активировать выполнение приложения логики.

1. Откройте запуска и проверьте выходные данные для **создать схемы** действие.

   В выходных данных отображаются созданные схемы для указанного списка сообщений.

### <a name="upload-schemas-to-integration-account"></a>Отправка схем в учетную запись интеграции

При необходимости можно загрузить созданные схемы и сохранить их в репозиториях, таких как большой двоичный объект, хранилище или учетная запись интеграции. Учетные записи интеграции предоставляют отличный интерфейс для работы с другими действиями XML, поэтому в этом примере показано, как отправить схемы в учетную запись интеграции для того же приложения логики с помощью соединителя Azure Resource Manager.

1. В конструкторе приложений логики выберите для созданного триггера пункт **Новый шаг**.

1. В поле поиска введите «Resource Manager» в качестве фильтра. Выбор действия **Create or update a resource** (Создать или изменить группу ресурсов).

   ![Выбор действия Azure Resource Manager](media/logic-apps-using-sap-connector/select-azure-resource-manager-action.png)

1. Введите сведения о действии, включая вашей подписки Azure, группу ресурсов Azure и учетной записи интеграции. Чтобы добавить SAP маркеры поля, щелкните внутри поля для этих полей и выберите из списка динамического содержимого, которое отображается.

   1. Откройте **добавьте параметр** и выберите **расположение** и **свойства** поля.

   1. Укажите сведения для этих новых полей, как показано в следующем примере.

      ![Ввод сведений для действия Azure Resource Manager](media/logic-apps-using-sap-connector/azure-resource-manager-action.png)

   Действие SAP **Generate schemas** (Создать схемы) создает схемы в виде коллекции, поэтому конструктор автоматически добавляет цикл **for each** в действие. Ниже приведен пример, в котором показано, как выглядит это действие:

   ![Действие Azure Resource Manager с циклом for each](media/logic-apps-using-sap-connector/azure-resource-manager-action-foreach.png)  

   > [!NOTE]
   > Схемы используют формат в кодировке base64. Чтобы отправить схемы в учетную запись интеграции, они должны быть декодированы с помощью функции `base64ToString()`. Ниже приведен пример, содержащий код для элемента `"properties"`:
   >
   > ```json
   > "properties": {
   >    "Content": "@base64ToString(items('For_each')?['Content'])",
   >    "ContentType": "application/xml",
   >    "SchemaType": "Xml"
   > }
   > ```

1. Сохраните приложение логики. На панели инструментов конструктора нажмите кнопку **Сохранить**.

### <a name="test-your-logic-app"></a>Тестирование приложения логики

1. Чтобы вручную активировать приложение логики, на панели инструментов конструктора щелкните **Запустить**.

1. После успешного запуска, перейти в учетную запись интеграции и проверять, что созданные схемы существуют.

## <a name="enable-secure-network-communications-snc"></a>Включение безопасной связи по сети (SNC)

Перед началом работы убедитесь, что соблюдены указанные [предварительные требования](#pre-reqs):

* Локальный шлюз данных установлен на компьютере, который находится в той же сети, что вашей системы SAP.

* Для единого входа, шлюз работает как пользователь, сопоставленный с пользователя SAP.

* Библиотека SNC, который обеспечивает дополнительную безопасность функции был установлен в той же машине, что шлюз данных. Ниже перечислены некоторые примеры этих [sapseculib](https://help.sap.com/saphelp_nw74/helpdata/en/7a/0755dc6ef84f76890a77ad6eb13b13/frameset.htm), Kerberos, NTLM, и т. д.

Чтобы включить SNC для ваших запросов, или из системы SAP, выберите **использовать SNC** флажок в подключении SAP и предоставьте следующие свойства:

   ![Конфигурирование соединений SNC SAP в соединении](media/logic-apps-using-sap-connector/configure-sapsnc.png)

   | Свойство | Описание |
   |----------| ------------|
   | **Библиотека SNC** | Библиотека SNC name или путь относительно расположения установки NCo или абсолютный путь. Например `sapsnc.dll` или `.\security\sapsnc.dll` или `c:\security\sapsnc.dll` |
   | **SNC SSO** | При подключении через SNC SNC удостоверения обычно используется для проверки подлинности вызывающего объекта. Другой вариант — для переопределения, чтобы сведения пользователя и пароль могут использоваться для проверки подлинности вызывающего объекта, но по-прежнему шифруется строке. |
   | **Меня зовут SNC** | В большинстве случаев это свойство может быть опущено. Установленное решение SNC обычно знает имени SNC. Только для решений, поддерживающих «удостоверения» может потребоваться указать удостоверение для этого конкретного назначения или сервера. |
   | **Имя партнера SNC** | Имя для серверной части SNC |
   | **Качество SNC защиты** | Качество обслуживания, используемый для обмена данными SNC этого конкретного назначения/сервера. Значение по умолчанию определяется серверной системы. Максимальное значение определяется по продуктам безопасности, используемый для SNC. |
   |||

   > [!NOTE]
   > Переменные среды SNC_LIB и SNC_LIB_64 не следует задавать на компьютере, где у вас есть шлюз данных и библиотека SNC. Если задано, они имеет приоритет над библиотека SNC значением, передаваемым через соединитель.

<a name="safe-typing"></a>

## <a name="safe-typing"></a>Безопасный ввод

По умолчанию при создании подключения к SAP, строгую типизацию используется для проверки для недопустимых значений, выполняя проверки XML на соответствие схеме. Это поведение может помочь обнаружить проблемы ранее. **Безопасный ввод** параметр доступен для обеспечения обратной совместимости и только проверяет длину строки. Если вы выберете **безопасный ввод**, DATS типа и типа TIMS в SAP, рассматриваются как строки, а не как эквиваленты XML `xs:date` и `xs:time` где `xmlns:xs="http://www.w3.org/2001/XMLSchema"`. Безопасный ввод влияет на поведение для создания все схемы, отправка сообщений для полезных данных «отправлено» и «получено» ответа и триггер. 

При использовании строгой типизации (**безопасный ввод** не включен), схема сопоставляет типы DATS и TIMS более простые типы XML:

```xml
<xs:element minOccurs="0" maxOccurs="1" name="UPDDAT" nillable="true" type="xs:date"/>
<xs:element minOccurs="0" maxOccurs="1" name="UPDTIM" nillable="true" type="xs:time"/>
```

При отправке сообщений с помощью строгой типизации, в соответствующий формат типа XML соответствует DATS и TIMS ответ:

```xml
<DATE>9999-12-31</DATE>
<TIME>23:59:59</TIME>
```

Когда **безопасный ввод** — включена, схема сопоставляет DATS и TIMS типы в XML строковых полей с ограничениями длины, например:

```xml
<xs:element minOccurs="0" maxOccurs="1" name="UPDDAT" nillable="true">
  <xs:simpleType>
    <xs:restriction base="xs:string">
      <xs:maxLength value="8" />
    </xs:restriction>
  </xs:simpleType>
</xs:element>
<xs:element minOccurs="0" maxOccurs="1" name="UPDTIM" nillable="true">
  <xs:simpleType>
    <xs:restriction base="xs:string">
      <xs:maxLength value="6" />
    </xs:restriction>
  </xs:simpleType>
</xs:element>
```

При отправке сообщений с **безопасный ввод** включен, DATS и TIMS ответ выглядит следующим образом:

```xml
<DATE>99991231</DATE>
<TIME>235959</TIME>
```


## <a name="known-issues-and-limitations"></a>Известные проблемы и ограничения

Ниже приведены известные проблемы и ограничения для соединителя SAP:

* С tRFC работает только один вызов или сообщение для действия отправки в SAP. Шаблон фиксации программного интерфейса бизнес-приложений (BAPI), такой как создание нескольких вызовов tRFC в одном сеансе, не поддерживается.

* Триггер SAP не поддерживает получение пакетов IDOC из SAP. Это действие может привести к сбою подключения RFC между системой SAP и шлюзом данных.

* Триггер SAP не поддерживает кластеры шлюза данных. В некоторых случаях отработки отказа узел шлюза данных, который обменивается данными с системой SAP, может отличаться от активного узла, что приводит к непредвиденному поведению. Кластеры шлюза данных поддерживаются в сценариях отправки.

* Соединитель SAP в настоящее время не поддерживает строки маршрутизатора SAP. Локальный шлюз данных должен существовать в той же локальной сети, что и система SAP, к которой нужно подключиться.

## <a name="connector-reference"></a>Справочник по соединителям

Дополнительные технические сведения о триггерах, действиях и ограничения, которые описаны соединителя OpenAPI (прежнее название — Swagger) описания, просмотрите [соединителя справочной странице](/connectors/sap/).

## <a name="next-steps"></a>Дальнейшие действия

* [Подключение к локальным системам](../logic-apps/logic-apps-gateway-connection.md) из приложений логики.
* Сведения о проверке, преобразовании и других операциях с сообщениями, выполняемых с помощью [пакета интеграции Enterprise](../logic-apps/logic-apps-enterprise-integration-overview.md).
* См. дополнительные сведения о других [соединителях Logic Apps](../connectors/apis-list.md).
