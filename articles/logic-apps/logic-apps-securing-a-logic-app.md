---
title: Безопасный доступ и Azure Logic Apps данных
description: Добавьте параметры безопасности для защиты входных, выходных данных, триггеров на основе запросов, журнала выполнения, задач управления и доступа к другим ресурсам в Azure Logic Apps
services: logic-apps
ms.service: logic-apps
ms.suite: integration
author: ecfan
ms.author: estfan
ms.reviewer: klam, LADocs
ms.topic: conceptual
ms.date: 10/11/2019
ms.openlocfilehash: c9dfc4ed6fce186fea9474222875a072edb32f59
ms.sourcegitcommit: a22cb7e641c6187315f0c6de9eb3734895d31b9d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/14/2019
ms.locfileid: "74084726"
---
# <a name="secure-access-and-data-in-azure-logic-apps"></a>Безопасный доступ и данные в Azure Logic Apps

Для управления доступом и защитой данных в Azure Logic Apps можно настроить безопасность в следующих областях:

* [Доступ к триггерам на основе запросов](#secure-triggers)
* [Доступ к операциям приложения логики](#secure-operations)
* [Доступ к входным и выходным данным журнала выполнения](#secure-run-history)
* [Доступ к входным параметрам](#secure-action-parameters)
* [Доступ к службам и системам, вызываемым из приложений логики](#secure-requests)

<a name="secure-triggers"></a>

## <a name="access-to-request-based-triggers"></a>Доступ к триггерам на основе запросов

Если приложение логики использует триггер на основе запроса, который получает входящие вызовы или запросы, такие как [запрос](../connectors/connectors-native-reqres.md) или триггер [веб-перехватчика](../connectors/connectors-native-webhook.md) , можно ограничить доступ, чтобы только полномочные клиенты могли вызывать приложение логики. Все запросы, полученные приложением логики, шифруются и защищаются с помощью протокола SSL.

Ниже приведены способы защиты доступа к этому типу триггера.

* [создание подписанных URL-адресов](#sas);
* [Ограничить входящие IP-адреса](#restrict-inbound-ip-addresses)
* [Добавление Azure Active Directory OAuth или другого уровня безопасности](#add-authentication)

<a name="sas"></a>

### <a name="generate-shared-access-signatures-sas"></a>Создание подписанных URL-адресов (SAS)

Каждая конечная точка запроса в приложении логики имеет [подпись общего доступа (SAS)](https://docs.microsoft.com/rest/api/storageservices/constructing-a-service-sas) в URL-адресе конечной точки, которая имеет следующий формат:

`https://<request-endpoint-URI>sp=<permissions>sv=<SAS-version>sig=<signature>`

Каждый URL-адрес содержит `sp`, `sv`и `sig` параметр запроса, как описано в этой таблице.

| Параметр запроса | ОПИСАНИЕ |
|-----------------|-------------|
| `sp` | Задает разрешения для использования разрешенными методами HTTP. |
| `sv` | Указывает версию SAS, используемую для создания подписи. |
| `sig` | Указывает подпись, используемую для проверки подлинности доступа к триггеру. Эта сигнатура создается с помощью алгоритма SHA256 с секретным ключом доступа для всех URL-путей и свойств. Никогда не выдается или не публикуется, этот ключ сохраняется в зашифрованном виде и сохраняется в приложении логики. Приложение логики авторизует только те триггеры, которые содержат действительную подпись, созданную с помощью секретного ключа. |
|||

Дополнительные сведения о защите доступа с помощью SAS см. в следующих разделах этой статьи:

* [Повторное создание ключей доступа](#access-keys)
* [Создание URL-адресов обратного вызова с истекающим сроком действия](#expiring-urls)
* [Создание URL-адресов с использованием первичного или вторичного ключа](#primary-secondary-key)

<a name="access-keys"></a>

#### <a name="regenerate-access-keys"></a>Повторное создание ключей доступа

Чтобы создать новый ключ безопасного доступа в любое время, используйте REST API или портал Azure Azure. Все ранее созданные URL-адреса, использующие старый ключ, становятся недействительными и больше не имеют авторизации для активации приложения логики. URL-адреса, которые вы получаете после повторного создания, подписываются новым ключом доступа.

1. В [портал Azure](https://portal.azure.com)откройте приложение логики с ключом, который необходимо повторно создать.

1. В меню приложения логики в разделе **Параметры** выберите **Ключи доступа**.

1. Выберите ключ, который требуется повторно создать, и завершите процесс.

<a name="expiring-urls"></a>

#### <a name="create-expiring-callback-urls"></a>Создание URL-адресов обратного вызова с истекающим сроком действия

При совместном использовании URL-адреса конечной точки для триггера, основанного на запросе, с другими сторонами можно создать URL-адреса обратного вызова, использующие определенные ключи и имеющие даты истечения срока действия. Таким образом можно без труда изменять ключи или ограничивать доступ, чтобы активировать приложение логики на основе определенного интервала времени. Чтобы указать срок действия URL-адреса, используйте [REST API Logic Apps](https://docs.microsoft.com/rest/api/logic/workflowtriggers), например:

``` http
POST /subscriptions/<Azure-subscription-ID>/resourceGroups/<Azure-resource-group-name>/providers/Microsoft.Logic/workflows/<workflow-name>/triggers/<trigger-name>/listCallbackUrl?api-version=2016-06-01
```

В тексте Включите свойство `NotAfter`, используя строку даты JSON. Это свойство возвращает URL-адрес обратного вызова, действительный только до даты и времени, заданной для параметра `NotAfter`.

<a name="primary-secondary-key"></a>

#### <a name="create-urls-with-primary-or-secondary-secret-key"></a>Создание URL-адресов с использованием первичного или вторичного секретного ключа

При создании или перечислении URL-адресов обратного вызова для триггера на основе запроса можно указать ключ, который будет использоваться для подписи URL-адреса. Чтобы создать URL-адрес, подписанный указанным ключом, используйте [REST API Logic Apps](https://docs.microsoft.com/rest/api/logic/workflowtriggers), например:

``` http
POST /subscriptions/<Azure-subscription-ID>/resourceGroups/<Azure-resource-group-name>/providers/Microsoft.Logic/workflows/<workflow-name>/triggers/<trigger-name>/listCallbackUrl?api-version=2016-06-01
```

Добавьте в текст свойство `KeyType` со значением `Primary` или `Secondary`. Это свойство возвращает URL-адрес, подписанный с помощью указанного ключа безопасности.

<a name="restrict-inbound-ip"></a>

### <a name="restrict-inbound-ip-addresses"></a>Ограничить входящие IP-адреса

Вместе с подписанным URL-адресом (SAS) может потребоваться ограничить количество клиентов, которые могут вызывать приложение логики. Например, если вы управляете конечной точкой запроса с помощью службы управления API Azure, вы можете ограничить приложение логики принимать запросы только от IP-адреса экземпляра службы управления API.

#### <a name="restrict-inbound-ip-ranges-in-azure-portal"></a>Ограничить диапазоны входящих IP-адресов в портал Azure

1. Откройте приложение логики в конструкторе приложений логики на [портале Azure](https://portal.azure.com).

1. В меню приложения логики в разделе **Параметры** выберите **Параметры рабочего процесса**.

1. В разделе **Конфигурация контроля доступа** > **Разрешенные IP-адреса для входящего трафика** щелкните **Конкретные диапазоны IP-адресов**.

1. В разделе **Диапазоны IP-адресов для триггеров** укажите диапазоны IP-адресов, которые принимает триггер.

   Допустимый диапазон IP-адресов имеет формат *x.x.x.x/x* или *x.x.x.x-x.x.x.x*.

Если вы хотите, чтобы приложение логики активировалось только как вложенное приложение логики, в списке **Разрешенные входящие IP-адреса** выберите **только другие Logic Apps**. Этот параметр записывает пустой массив в ресурс приложения логики. Таким образом, только вызовы из службы Logic Apps (родительские приложения логики) могут активировать вложенное приложение логики.

> [!NOTE]
> Независимо от IP-адреса вы все равно можете запустить приложение логики, для которого установлен триггер на основе запроса, с помощью команды `/triggers/<trigger-name>/run`, используя REST API Azure или службу управления API. Однако этот сценарий по-прежнему требует проверки подлинности в REST API Azure. Все события отображаются в журнале аудита Azure. Убедитесь, что политики управления доступом настроены соответствующим образом.

#### <a name="restrict-inbound-ip-ranges-in-azure-resource-manager-template"></a>Ограничить диапазоны входящих IP-адресов в шаблоне Azure Resource Manager

Если вы [автоматизируем развертывание для приложений логики с помощью шаблонов диспетчер ресурсов](../logic-apps/logic-apps-azure-resource-manager-templates-overview.md), диапазоны IP-адресов можно указать с помощью раздела `accessControl` с разделом `triggers` в определении ресурса приложения логики, например:

``` json
{
   "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
   "contentVersion": "1.0.0.0",
   "parameters": {},
   "variables": {},
   "resources": [
      {
         "name": "[parameters('LogicAppName')]",
         "type": "Microsoft.Logic/workflows",
         "location": "[parameters('LogicAppLocation')]",
         "tags": {
            "displayName": "LogicApp"
         },
         "apiVersion": "2016-06-01",
         "properties": {
            "definition": {<workflow-definition>},
            "parameters": {},
            "accessControl": {
               "triggers": {
                  "allowedCallerIpAddresses": [
                     {
                        "addressRange": "192.168.12.0/23"
                     },
                     {
                        "addressRange": "2001:0db8::/64"
                     }
                  ]
               }
            }
         }
      }
   ],
   "outputs": {}
}
```

<a name="add-authentication"></a>

### <a name="add-azure-active-directory-oauth-or-other-security"></a>Добавление Azure Active Directory OAuth или другого уровня безопасности

Чтобы добавить дополнительные протоколы авторизации в приложение логики, рассмотрите возможность использования службы [управления API Azure](../api-management/api-management-key-concepts.md) . Эта служба позволяет предоставить приложение логики в качестве API и предоставляет широкие возможности мониторинга, безопасности, политики и документации для любой конечной точки. Управление API может предоставлять общедоступную или частную конечную точку для приложения логики. Чтобы авторизовать доступ к этой конечной точке, можно использовать [Azure Active Directory OAuth](#azure-active-directory-oauth-authentication), [сертификат клиента](#client-certificate-authentication)или другие стандарты безопасности для авторизации доступа к этой конечной точке. Когда служба "Управление API" получает запрос, она отправляет его в приложение логики, выполняя при этом необходимые преобразования или устанавливая ограничения. Чтобы разрешить только управление API, активируя приложение логики, можно использовать параметры диапазона входящих IP-адресов приложения логики.

<a name="secure-operations"></a>

## <a name="access-to-logic-app-operations"></a>Доступ к операциям приложения логики

Вы можете разрешите отдельным пользователям или группам выполнять определенные задачи, такие как управление, редактирование и просмотр приложений логики. Для управления их разрешениями используйте [Управление доступом на основе ролей Azure (RBAC)](../role-based-access-control/role-assignments-portal.md) , чтобы можно было назначить настраиваемые или встроенные роли членам в подписке Azure.

* [Участник приложения логики](../role-based-access-control/built-in-roles.md#logic-app-contributor): позволяет управлять приложениями логики, но вы не можете изменить доступ к ним.

* [Оператор приложения логики](../role-based-access-control/built-in-roles.md#logic-app-operator): позволяет читать, включать и отключать приложения логики, но не может изменять или обновлять их.

Чтобы запретить другим пользователям изменять или удалять приложение логики, можно использовать [блокировку ресурсов Azure](../azure-resource-manager/resource-group-lock-resources.md). Эта возможность предотвращает изменение или удаление рабочих ресурсов другими пользователями.

<a name="secure-run-history"></a>

## <a name="access-to-run-history-data"></a>Доступ к данным журнала выполнения

Во время выполнения приложения логики все данные [шифруются во время транзитного](../security/fundamentals/encryption-overview.md#encryption-of-data-in-transit) транспорта с помощью протокола TLS и [неактивных](../security/fundamentals/encryption-atrest.md)данных. После завершения работы приложения логики можно просмотреть журнал этого запуска, включая шаги, которые были выполнены вместе с состоянием, длительностью, входом и выходом для каждого действия. Эти подробные сведения позволяют понять, как запущено приложение логики и где можно начать устранение любых возникающих проблем.

При просмотре журнала выполнения приложения логики Logic Apps выполняет проверку подлинности доступа, а затем предоставляет ссылки на входные и выходные данные для запросов и ответов для каждого запуска. Однако для действий, которые обрабатывали пароли, секреты, ключи или другие конфиденциальные сведения, необходимо запретить другим пользователям просматривать эти данные и получать к ним доступ. Например, если приложение логики получает секрет от [Azure Key Vault](../key-vault/key-vault-overview.md) для использования при проверке подлинности действия HTTP, необходимо скрыть этот секрет из представления.

Для управления доступом к входным и выходным данным в журнале выполнения приложения логики доступны следующие варианты.

* [Ограничьте доступ по диапазону IP-адресов](#restrict-ip).

  Этот параметр позволяет защитить доступ к журналу выполнения на основе запросов из определенного диапазона IP-адресов.

* [Скрыть данные из журнала выполнения с помощью функции запутывания](#obfuscate).

  Во многих триггерах и действиях их входные и выходные данные могут быть скрыты из журнала выполнения приложения логики.

<a name="restrict-ip"></a>

### <a name="restrict-access-by-ip-address-range"></a>Ограничение доступа по диапазону IP-адресов

Вы можете ограничить доступ к входным и выходным данным в журнале выполнения приложения логики, чтобы только запросы из конкретных диапазонов IP-адресов могли просматривать эти данные. Например, чтобы запретить всем пользователям доступ к входным и выходным данным, укажите диапазон IP-адресов, например `0.0.0.0-0.0.0.0`. Только пользователь с разрешениями администратора может удалить это ограничение, что обеспечивает возможность JIT-доступа к данным приложения логики. Можно указать диапазоны IP-адресов, чтобы ограничить их либо с помощью портал Azure, либо в шаблоне Azure Resource Manager, который используется для развертывания приложения логики.

#### <a name="restrict-ip-ranges-in-azure-portal"></a>Ограничить диапазоны IP-адресов в портал Azure

1. Откройте приложение логики в конструкторе приложений логики на портале Azure.

1. В меню приложения логики в разделе **Параметры** выберите **Параметры рабочего процесса**.

1. В разделе **Конфигурация контроля доступа** > **Разрешенные IP-адреса для входящего трафика** щелкните **Конкретные диапазоны IP-адресов**.

1. В разделе **Диапазоны IP-адресов для содержимого** укажите диапазоны, которые могут получать доступ к содержимому входных и выходных данных. 

   Допустимый диапазон IP-адресов имеет формат *x.x.x.x/x* или *x.x.x.x-x.x.x.x*.

#### <a name="restrict-ip-ranges-in-azure-resource-manager-template"></a>Ограничить диапазоны IP-адресов в шаблоне Azure Resource Manager

Если вы [автоматизируем развертывание для приложений логики с помощью шаблонов диспетчер ресурсов](../logic-apps/logic-apps-azure-resource-manager-templates-overview.md), диапазоны IP-адресов можно указать с помощью раздела `accessControl` с разделом `contents` в определении ресурса приложения логики, например:

``` json
{
   "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
   "contentVersion": "1.0.0.0",
   "parameters": {},
   "variables": {},
   "resources": [
      {
         "name": "[parameters('LogicAppName')]",
         "type": "Microsoft.Logic/workflows",
         "location": "[parameters('LogicAppLocation')]",
         "tags": {
            "displayName": "LogicApp"
         },
         "apiVersion": "2016-06-01",
         "properties": {
            "definition": {<workflow-definition>},
            "parameters": {},
            "accessControl": {
               "contents": {
                  "allowedCallerIpAddresses": [
                     {
                        "addressRange": "192.168.12.0/23"
                     },
                     {
                        "addressRange": "2001:0db8::/64"
                     }
                  ]
               }
            }
         }
      }
   ],
   "outputs": {}
}
```

<a name="obfuscate"></a>

### <a name="hide-data-from-run-history-by-using-obfuscation"></a>Скрытие данных из журнала выполнения с помощью функции запутывания

Многие триггеры и действия имеют параметры для скрытия входов, выходов или и того и другого из журнала выполнения приложения логики. Ниже приведены некоторые [рекомендации, которые следует рассмотреть](#obfuscation-considerations) при использовании этих параметров для защиты этих данных.

#### <a name="secure-inputs-and-outputs-in-the-designer"></a>Защита входных и выходных данных в конструкторе

1. Откройте приложение логики в конструкторе приложений логики на [портале Azure](https://portal.azure.com).

   ![Открытие приложения логики в конструкторе приложений логики](./media/logic-apps-securing-a-logic-app/open-sample-logic-app-in-designer.png)

1. На триггере или действии, для которого требуется защитить данные, нажмите кнопку с многоточием ( **...** ), а затем выберите **Параметры**.

   ![Открыть параметры триггера или действия](./media/logic-apps-securing-a-logic-app/open-action-trigger-settings.png)

1. Включите либо **безопасные входы**, либо **безопасные выходы**, либо и то, и другое. По завершении нажмите кнопку **Готово**.

   ![Включение защиты входных или выходных данных](./media/logic-apps-securing-a-logic-app/turn-on-secure-inputs-outputs.png)

   Действие или триггер теперь отображает значок блокировки в заголовке окна.

   ![Строка заголовка действия или триггера отображается значок блокировки](./media/logic-apps-securing-a-logic-app/lock-icon-action-trigger-title-bar.png)

   Маркеры, которые представляют защищенные выходные данные из предыдущих действий, также отображают значки блокировки. Например, при выборе такого вывода из списка динамического содержимого для использования в действии этот маркер отображает значок блокировки.

   ![Выберите токен для защищенного вывода](./media/logic-apps-securing-a-logic-app/select-secured-token.png)

1. После запуска приложения логики можно просмотреть журнал этого запуска.

   1. В области **Обзор** приложения логики выберите Запуск, который требуется просмотреть.

   1. На панели **Запуск приложения логики** разверните список действий, которые необходимо проверить.

      Если выбрана защита как входных, так и выходных данных, эти значения теперь будут скрыты.

      ![Скрытые входы и выходы в журнале выполнения](./media/logic-apps-securing-a-logic-app/hidden-data-run-history.png)

<a name="secure-data-code-view"></a>

#### <a name="secure-inputs-and-outputs-in-code-view"></a>Защита входных и выходных данных в представлении кода

В базовом триггере или определении действия добавьте или обновите массив `runtimeConfiguration.secureData.properties` одним из следующих значений:

* `"inputs"`: обеспечивает защиту входных данных в журнале выполнения.
* `"outputs"`: обеспечивает защиту выходных данных в журнале выполнения.

Ниже приведены некоторые [рекомендации, которые следует рассмотреть](#obfuscation-considerations) при использовании этих параметров для защиты этих данных.

```json
"<trigger-or-action-name>": {
   "type": "<trigger-or-action-type>",
   "inputs": {
      <trigger-or-action-inputs>
   },
   "runtimeConfiguration": {
      "secureData": {
         "properties": [
            "inputs",
            "outputs"
         ]
      }
   },
   <other-attributes>
}
```

<a name="obfuscation-considerations"></a>

#### <a name="considerations-when-hiding-inputs-and-outputs"></a>Рекомендации по скрытию входных и выходных данных

* При защите входных или выходных данных триггера или действия Logic Apps не отправляет защищенные данные в Azure Log Analytics. Кроме того, вы не можете добавлять [отслеживаемые свойства](logic-apps-monitor-your-logic-apps.md#azure-diagnostics-event-settings-and-details) к этому триггеру или действию для мониторинга.

* [API Logic Apps для обработки журнала рабочего процесса](https://docs.microsoft.com/rest/api/logic/) не возвращает защищенные выходные данные.

* Чтобы защитить выходные данные из действия, которое защищает входные данные или явно использует защищенные выходные данные, включите в это действие **защищенные выходные данные** вручную.

* Убедитесь, что вы включаете **безопасные входные** или **защищенные выходные данные** в нисходящих действиях, где журнал выполнения предполагает защиту этих данных.

  **Параметр безопасных выходов**

  При ручном включении **защищенных выходных** данных в триггере или действии Logic Apps защищает эти выходные данные в журнале выполнения. Если подчиненное действие явно использует эти защищенные выходные данные в качестве входных данных, Logic Apps скрывает входные данные этого действия в журнале выполнения, но *не включает* параметр **безопасных входных данных** действия.

  ![Защищенные выходные данные в качестве входных и нижестоящих последствий для большинства действий](./media/logic-apps-securing-a-logic-app/secure-outputs-as-inputs-flow.png)

  Действия создание, анализ JSON и ответ имеют только параметр **безопасные входы** . При включении параметр также скрывает выходные данные действий. Если эти действия явно используют восходящие защищенные выходные данные в качестве входных данных, Logic Apps скрывает входные и выходные данные этих действий, но *не включает* параметр " **защищенные входные данные** " действий. Если подчиненное действие явно использует скрытые выходные данные из действий создания, анализа JSON или ответа в качестве входных данных, Logic Apps *не скрывает входные и выходные данные этого*последовательного действия.

  ![Защищенные выходные данные в качестве входных данных с нисходящим влиянием на определенные действия](./media/logic-apps-securing-a-logic-app/secure-outputs-as-inputs-flow-special.png)

  **Параметр защищенных входов**

  Если вы вручную включаете **безопасные входные данные** в триггере или действии, Logic Apps защищает эти входные данные в журнале выполнения. Если подчиненное действие явно использует видимые выходные данные из этого триггера или действия в качестве входных данных, Logic Apps скрывает входные данные этого подчиненного действия в журнале выполнения, но *не включает* в это действие **защищенные входные данные** и не скрывает выходные.

  ![Защищенные входные и нисходящие последствия для большинства действий](./media/logic-apps-securing-a-logic-app/secure-inputs-impact-on-downstream.png)

  Если действия "создать", "анализ JSON" и "ответ" явно используют видимые выходные данные триггера или действия, которые имеют защищенные входные данные, Logic Apps скрывают эти входные и выходные данные действий, но *не включает* **безопасные входные данные** этого действия. задав. Если подчиненное действие явно использует скрытые выходные данные из действий создания, анализа JSON или ответа в качестве входных данных, Logic Apps *не скрывает входные и выходные данные этого*последовательного действия.

  ![Защищенные входные и нисходящие последствия для определенных действий](./media/logic-apps-securing-a-logic-app/secure-inputs-flow-special.png)

<a name="secure-action-parameters"></a>

## <a name="access-to-parameter-inputs"></a>Доступ к входным параметрам

При развертывании в разных средах рассмотрите возможность параметризации значений в определении рабочего процесса в зависимости от этих сред. Таким образом, можно избежать жестко запрограммированных данных с помощью [шаблона Azure Resource Manager](../azure-resource-manager/template-deployment-overview.md) для развертывания приложения логики, защиты конфиденциальных данных путем определения защищенных параметров и передачи этих данных в виде отдельных входов через [Параметры шаблона](../azure-resource-manager/template-parameters.md) с помощью [файл параметров](../azure-resource-manager/resource-manager-parameter-files.md).

Например, при проверке подлинности HTTP-действий с помощью [Azure Active Directory OAuth](#azure-active-directory-oauth-authentication)можно определить и защитить параметры, которые принимают идентификатор клиента и секрет клиента, используемые для проверки подлинности. Чтобы определить эти параметры в приложении логики, используйте раздел `parameters` в определении рабочего процесса приложения логики и шаблоне диспетчер ресурсов для развертывания. Чтобы скрыть значения параметров, которые не должны отображаться при изменении приложения логики или просмотре журнала выполнения, определите параметры с помощью `securestring` или `secureobject` типа и при необходимости используйте кодировку. Параметры, имеющие этот тип, не возвращаются вместе с определением ресурса и недоступны при просмотре ресурса после развертывания. Чтобы получить доступ к этим значениям параметров во время выполнения, используйте выражение `@parameters('<parameter-name>')` в определении рабочего процесса. Это выражение вычисляется только во время выполнения и описывается [языком определения рабочего процесса](../logic-apps/logic-apps-workflow-definition-language.md).

> [!NOTE]
> Если вы используете параметр в заголовке или тексте запроса, этот параметр может быть видимым при просмотре журнала выполнения приложения логики и исходящего HTTP-запроса. Кроме того, убедитесь, что политики доступа к содержимому заданы соответствующим образом. Для скрытия входных и выходных данных в журнале выполнения можно также использовать [маскировку](#obfuscate) . Заголовки авторизации никогда не отображаются во входных и выходных данных. Таким образом, если используется секрет, то он не извлекается.

Дополнительные сведения см. в следующих разделах этой статьи:

* [Защита параметров в определениях рабочих процессов](#secure-parameters-workflow)
* [Скрытие данных из журнала выполнения с помощью функции запутывания](#obfuscate)

При [автоматизации развертывания для приложений логики с помощью шаблонов диспетчер ресурсов](../logic-apps/logic-apps-azure-resource-manager-templates-overview.md)можно определить защищенные [Параметры шаблона](../azure-resource-manager/template-parameters.md), которые оцениваются при развертывании с помощью типов `securestring` и `secureobject`. Чтобы определить параметры шаблона, используйте раздел `parameters` верхнего уровня шаблона, который является отдельным и отличным от `parameters`ного раздела определения рабочего процесса. Чтобы указать значения для параметров шаблона, используйте отдельный [файл параметров](../azure-resource-manager/resource-manager-parameter-files.md).

Например, при использовании секретов можно определить и использовать защищенные параметры шаблона, которые извлекают эти секреты из [Azure Key Vault](../key-vault/key-vault-overview.md) при развертывании. Затем можно сослаться на хранилище ключей и секрет в файле параметров. Дополнительные сведения см. в следующих статьях:

* [Передача конфиденциальных значений при развертывании с помощью Azure Key Vault](../azure-resource-manager/resource-manager-keyvault-parameter.md)
* [Безопасность параметров в шаблонах Azure Resource Manager](#secure-parameters-deployment-template) далее в этом разделе

<a name="secure-parameters-workflow"></a>

### <a name="secure-parameters-in-workflow-definitions"></a>Защита параметров в определениях рабочих процессов

Чтобы защитить конфиденциальную информацию в определении рабочего процесса приложения логики, используйте защищенные параметры, чтобы эти сведения не отображались после сохранения приложения логики. Например, предположим, что для действия HTTP требуется обычная проверка подлинности, в которой используются имя пользователя и пароль. В определении рабочего процесса `parameters` раздел определяет параметры `basicAuthPasswordParam` и `basicAuthUsernameParam` с помощью типа `securestring`. Затем определение действия ссылается на эти параметры в разделе `authentication`.

```json
"definition": {
   "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
   "actions": {
      "HTTP": {
         "type": "Http",
         "inputs": {
            "method": "GET",
            "uri": "https://www.microsoft.com",
            "authentication": {
               "type": "Basic",
               "username": "@parameters('basicAuthUsernameParam')",
               "password": "@parameters('basicAuthPasswordParam')"
            }
         },
         "runAfter": {}
      }
   },
   "parameters": {
      "basicAuthPasswordParam": {
         "type": "securestring"
      },
      "basicAuthUsernameParam": {
         "type": "securestring"
      }
   },
   "triggers": {
      "manual": {
         "type": "Request",
         "kind": "Http",
         "inputs": {
            "schema": {}
         }
      }
   },
   "contentVersion": "1.0.0.0",
   "outputs": {}
}
```

<a name="secure-parameters-deployment-template"></a>

### <a name="secure-parameters-in-azure-resource-manager-templates"></a>Защита параметров в шаблонах Azure Resource Manager

[Шаблон диспетчер ресурсов](../logic-apps/logic-apps-azure-resource-manager-templates-overview.md) для приложения логики содержит несколько `parameters` разделов. Для защиты паролей, ключей, секретов и других конфиденциальных данных определите защищенные параметры на уровне шаблона и определения рабочего процесса с помощью `securestring` или `secureobject` типа. Затем эти значения можно сохранить в [Azure Key Vault](../key-vault/key-vault-overview.md) и использовать [файл параметров](../azure-resource-manager/resource-manager-parameter-files.md) для ссылки на хранилище ключей и секрет. Затем шаблон извлекает эти сведения при развертывании. Дополнительные сведения см. [в статье передача конфиденциальных значений при развертывании с помощью Azure Key Vault](../azure-resource-manager/resource-manager-keyvault-parameter.md).

Ниже приведены дополнительные сведения об этих `parameters` разделах.

* На верхнем уровне шаблона в разделе `parameters` определяются параметры для значений, используемых шаблоном при *развертывании*. Например, эти значения могут включать строки подключения для определенной среды развертывания. Затем эти значения можно хранить в отдельном [файле параметров](../azure-resource-manager/resource-manager-parameter-files.md), что упрощает изменение этих значений.

* В определении ресурса приложения логики, но вне определения рабочего процесса в `parameters` разделе указываются значения для параметров определения рабочего процесса. В этом разделе можно присвоить эти значения с помощью выражений шаблона, которые ссылаются на параметры шаблона. Эти выражения оцениваются при развертывании.

* В определении рабочего процесса в разделе `parameters` определяются параметры, используемые приложением логики во время выполнения. Затем можно сослаться на эти параметры в рабочем процессе приложения логики с помощью выражений определения рабочего процесса, которые оцениваются во время выполнения.

Этот пример шаблона с несколькими определениями защищенных параметров, использующих тип `securestring`:

| Имя параметра | ОПИСАНИЕ |
|----------------|-------------|
| `TemplatePasswordParam` | Параметр шаблона, который принимает пароль, который затем передается в параметр `basicAuthPasswordParam` определения рабочего процесса |
| `TemplateUsernameParam` | Параметр шаблона, принимающий имя пользователя, которое затем передается в параметр `basicAuthUserNameParam` определения рабочего процесса |
| `basicAuthPasswordParam` | Параметр определения рабочего процесса, который принимает пароль для обычной проверки подлинности в действии HTTP |
| `basicAuthUserNameParam` | Параметр определения рабочего процесса, который принимает имя пользователя для обычной проверки подлинности в действии HTTP |
|||

```json
{
   "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
   "contentVersion": "1.0.0.0",
   "parameters": {
      "LogicAppName": {
         "type": "string",
         "minLength": 1,
         "maxLength": 80,
         "metadata": {
            "description": "Name of the Logic App."
         }
      },
      "TemplatePasswordParam": {
         "type": "securestring"
      },
      "TemplateUsernameParam": {
         "type": "securestring"
      },
      "LogicAppLocation": {
         "type": "string",
         "defaultValue": "[resourceGroup().location]",
         "allowedValues": [
            "[resourceGroup().location]",
            "eastasia",
            "southeastasia",
            "centralus",
            "eastus",
            "eastus2",
            "westus",
            "northcentralus",
            "southcentralus",
            "northeurope",
            "westeurope",
            "japanwest",
            "japaneast",
            "brazilsouth",
            "australiaeast",
            "australiasoutheast",
            "southindia",
            "centralindia",
            "westindia",
            "canadacentral",
            "canadaeast",
            "uksouth",
            "ukwest",
            "westcentralus",
            "westus2"
         ],
         "metadata": {
            "description": "Location of the Logic App."
         }
      }
   },
   "variables": {},
   "resources": [
      {
         "name": "[parameters('LogicAppName')]",
         "type": "Microsoft.Logic/workflows",
         "location": "[parameters('LogicAppLocation')]",
         "tags": {
            "displayName": "LogicApp"
         },
         "apiVersion": "2016-06-01",
         "properties": {
            "definition": {
               "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-0601/workflowdefinition.json#",
               "actions": {
                  "HTTP": {
                     "type": "Http",
                     "inputs": {
                        "method": "GET",
                        "uri": "https://www.microsoft.com",
                        "authentication": {
                           "type": "Basic",
                           "username": "@parameters('basicAuthUsernameParam')",
                           "password": "@parameters('basicAuthPasswordParam')"
                        }
                     },
                  "runAfter": {}
                  }
               },
               "parameters": {
                  "basicAuthPasswordParam": {
                     "type": "securestring"
                  },
                  "basicAuthUsernameParam": {
                     "type": "securestring"
                  }
               },
               "triggers": {
                  "manual": {
                     "type": "Request",
                     "kind": "Http",
                     "inputs": {
                        "schema": {}
                     }
                  }
               },
               "contentVersion": "1.0.0.0",
               "outputs": {}
            },
            "parameters": {
               "basicAuthPasswordParam": {
                  "value": "[parameters('TemplatePasswordParam')]"
               },
               "basicAuthUsernameParam": {
                  "value": "[parameters('TemplateUsernameParam')]"
               }
            }
         }
      }
   ],
   "outputs": {}
}
```

<a name="secure-requests"></a>

## <a name="access-to-services-and-systems-called-from-logic-apps"></a>Доступ к службам и системам, вызываемым из приложений логики

Ниже приведены некоторые способы защиты конечных точек, получающих вызовы или запросы из приложения логики.

* Добавление проверки подлинности к исходящим запросам.

  При работе с триггером или действием на основе HTTP, которые делают исходящими вызовы, такие как HTTP, HTTP + Swagger или веб-перехватчик, можно добавить проверку подлинности в запрос, отправляемый приложением логики. Например, можно использовать следующие типы проверки подлинности:

  * [Обычная аутентификация](#basic-authentication)

  * [Аутентификация на основе сертификата клиента](#client-certificate-authentication)

  * [Active Directory аутентификации OAuth](#azure-active-directory-oauth-authentication)

  * [Аутентификация управляемого удостоверения](#managed-identity-authentication)
  
  Дополнительные сведения см. в подразделе [Добавление проверки подлинности к исходящим вызовам](#add-authentication-outbound) далее в этой статье.

* Ограничьте доступ с IP-адресов приложений логики.

  Все вызовы конечных точек из приложений логики берутся из определенных IP-адресов, основанных на регионах приложений логики. Можно добавить фильтрацию, чтобы принимать запросы только от этих IP-адресов. Чтобы получить эти IP-адреса, см. раздел [ограничения и настройка для Azure Logic Apps](logic-apps-limits-and-config.md#configuration).

* Обеспечьте безопасность подключений к локальным системам.

  Azure Logic Apps обеспечивают интеграцию с рядом служб для обеспечения безопасных и надежных локальных подключений.

  * Локальный шлюз данных

    Многие управляемые соединители в Azure Logic Apps обеспечивают безопасные подключения к локальным системам, таким как файловая система, SQL, SharePoint и DB2. Шлюз отправляет данные из локальных источников по шифрованным каналам через Служебную шину Azure. Весь трафик поступает как безопасный исходящий трафик от агента шлюза. Узнайте, [как работает локальный шлюз данных](logic-apps-gateway-install.md#gateway-cloud-service).

  * Подключение через службу управления API Azure

    [Служба "Управление API Azure"](../api-management/api-management-key-concepts.md) имеет возможности локального подключения, включая VPN типа "сеть — сеть" и интеграцию ExpressRoute, для защищенного прокси-сервера и подключения к локальным системам. В рабочем процессе приложения логики в конструкторе приложений логики можно выбрать API, предоставляемый службой управления API, который обеспечивает быстрый доступ к локальным системам.

<a name="add-authentication-outbound"></a>

## <a name="add-authentication-to-outbound-calls"></a>Добавление проверки подлинности в исходящие вызовы

Конечные точки HTTP и HTTPS поддерживают различные виды проверки подлинности. В зависимости от триггера или действия, используемого для выполнения исходящих вызовов или запросов, обращающихся к этим конечным точкам, можно выбрать из разных диапазонов типов проверки подлинности. Чтобы обеспечить защиту конфиденциальных данных, обрабатываемых приложением логики, используйте защищенные параметры и зашифровать данные по мере необходимости. Дополнительные сведения об использовании и защите параметров см. [в разделе доступ к входным параметрам](#secure-action-parameters).

| Authentication type (Тип проверки подлинности) | Поддерживается |
|---------------------|--------------|
| [базовая;](#basic-authentication) | Управление API Azure, службы приложений Azure, HTTP, HTTP + Swagger, веб-перехватчик HTTP |
| [Сертификат клиента](#client-certificate-authentication) | Управление API Azure, службы приложений Azure, HTTP, HTTP + Swagger, веб-перехватчик HTTP |
| [Active Directory OAuth](#azure-active-directory-oauth-authentication) | Управление API Azure, службы приложений Azure, функции Azure, HTTP, HTTP + Swagger, веб-перехватчик HTTP |
| [Чтен](#raw-authentication) | Управление API Azure, службы приложений Azure, функции Azure, HTTP, HTTP + Swagger, веб-перехватчик HTTP |
| [Управляемое удостоверение](#managed-identity-authentication) (только назначенное системой) | Управление API Azure, службы приложений Azure, функции Azure, HTTP, HTTP + Swagger, веб-перехватчик HTTP |
|||

> [!NOTE]
> В конструкторе приложений логики свойство **проверки подлинности** может быть скрыто в некоторых триггерах и действиях, где можно указать тип проверки подлинности. Чтобы отобразить свойство в этих случаях, в триггере или действии откройте список **Добавить новый параметр** и выберите **Проверка подлинности**. Дополнительные сведения см. в разделе [Аутентификация доступа с помощью управляемого удостоверения](../logic-apps/create-managed-service-identity.md#authenticate-access-with-identity).

<a name="basic-authentication"></a>

### <a name="basic-authentication"></a>Обычная аутентификация

Если доступен [базовый](../active-directory-b2c/active-directory-b2c-custom-rest-api-netfw-secure-basic.md) параметр, укажите следующие значения свойств.

| Свойство (конструктор) | Свойство (JSON) | обязательные | Значение | ОПИСАНИЕ |
|---------------------|-----------------|----------|-------|-------------|
| **Аутентификация** | `type` | Yes | базовая; | Используемый тип проверки подлинности |
| **Имя пользователя** | `username` | Yes | <*имя пользователя*>| Имя пользователя для аутентификации доступа к целевой конечной точке службы |
| **Пароль** | `password` | Yes | <> *пароля* | Пароль для аутентификации доступа к целевой конечной точке службы |
||||||

При использовании [защищенных параметров](#secure-action-parameters) для управления конфиденциальной информацией, например, в [шаблоне Azure Resource Manager для автоматизации развертывания](../logic-apps/logic-apps-azure-resource-manager-templates-overview.md), можно использовать выражения для доступа к этим значениям параметров во время выполнения. В этом примере определение действия HTTP определяет `type` проверки подлинности как `Basic` и использует [функцию Parameters ()](../logic-apps/workflow-definition-language-functions-reference.md#parameters) для получения значений параметров:

```json
"HTTP": {
   "type": "Http",
   "inputs": {
      "method": "GET",
      "uri": "@parameters('endpointUrlParam')",
      "authentication": {
         "type": "Basic",
         "username": "@parameters('userNameParam')",
         "password": "@parameters('passwordParam')"
      }
  },
  "runAfter": {}
}
```

<a name="client-certificate-authentication"></a>

### <a name="client-certificate-authentication"></a>Проверка подлинности на основе сертификата клиента

Если доступен параметр [сертификат клиента](../active-directory/authentication/active-directory-certificate-based-authentication-get-started.md) , укажите следующие значения свойств.

| Свойство (конструктор) | Свойство (JSON) | обязательные | Значение | ОПИСАНИЕ |
|---------------------|-----------------|----------|-------|-------------|
| **Аутентификация** | `type` | Yes | **Сертификат клиента** <br>или <br>`ClientCertificate` | Тип аутентификации, используемый для сертификатов клиента Secure Sockets Layer (SSL). Хотя самозаверяющие сертификаты поддерживаются, они не допускаются для SSL. |
| **Сохраняется** | `pfx` | Yes | <*с кодировкой-PFX-File-содержимое*> | Содержимое файла обмена личной информацией (PFX-файла) с кодировкой base64. <p><p>Чтобы преобразовать PFX-файл в формат в кодировке Base64, можно использовать PowerShell, выполнив следующие действия. <p>1. Сохраните содержимое сертификата в переменную: <p>   `$pfx_cert = get-content 'c:\certificate.pfx' -Encoding Byte` <p>2. Преобразуйте содержимое сертификата с помощью функции `ToBase64String()` и сохраните содержимое в текстовый файл: <p>   `[System.Convert]::ToBase64String($pfx_cert) | Out-File 'pfx-encoded-bytes.txt'` |
| **Пароль** | `password`| См. Описание | <*пароль для файла pfx*> | Пароль для доступа к PFX-файлу. <p><p>**Примечание**. это значение свойства является обязательным при работе в конструкторе приложений логики и *не* является обязательным при работе в представлении кода. |
|||||

При использовании [защищенных параметров](#secure-action-parameters) для управления конфиденциальной информацией, например, в [шаблоне Azure Resource Manager для автоматизации развертывания](../logic-apps/logic-apps-azure-resource-manager-templates-overview.md), можно использовать выражения для доступа к этим значениям параметров во время выполнения. В этом примере определение действия HTTP определяет `type` проверки подлинности как `ClientCertificate` и использует [функцию Parameters ()](../logic-apps/workflow-definition-language-functions-reference.md#parameters) для получения значений параметров:

```json
"HTTP": {
   "type": "Http",
   "inputs": {
      "method": "GET",
      "uri": "@parameters('endpointUrlParam')",
      "authentication": {
         "type": "ClientCertificate",
         "pfx": "@parameters('pfxParam')",
         "password": "@parameters('passwordParam')"
      }
   },
   "runAfter": {}
}
```

Дополнительные сведения о защите служб с помощью проверки подлинности на основе сертификата клиента см. в следующих разделах:

* [Защита API с помощью проверки подлинности на основе сертификата клиента в службе управления API Azure](../api-management/api-management-howto-mutual-certificates-for-clients.md)
* [Защита серверных служб с помощью проверки подлинности сертификата клиента в службе управления API Azure](../api-management/api-management-howto-mutual-certificates.md)
* [Защита службы RESTFUL с помощью сертификатов клиентов](../active-directory-b2c/active-directory-b2c-custom-rest-api-netfw-secure-cert.md)
* [Учетные данные сертификата для проверки подлинности приложения](../active-directory/develop/active-directory-certificate-credentials.md)
* [Использование SSL-сертификата в коде приложения службы приложений Azure](../app-service/configure-ssl-certificate-in-code.md)

<a name="azure-active-directory-oauth-authentication"></a>

### <a name="azure-active-directory-oauth-authentication"></a>Azure Active Directory аутентификации OAuth

Если доступен параметр [Active Directory OAuth](../active-directory/develop/about-microsoft-identity-platform.md) , укажите следующие значения свойств:

| Свойство (конструктор) | Свойство (JSON) | обязательные | Значение | ОПИСАНИЕ |
|---------------------|-----------------|----------|-------|-------------|
| **Аутентификация** | `type` | Yes | **Active Directory OAuth** <br>или <br>`ActiveDirectoryOAuth` | Тип проверки подлинности. Logic Apps в настоящее время соответствует [протоколу OAuth 2,0](../active-directory/develop/v2-overview.md). |
| **Клиентом** | `tenant` | Yes | <*ИД клиента*> | Идентификатор клиента Azure Active Directory. |
| **Аудитория** | `audience` | Yes | <*ресурс для авторизации*> | Ресурс, который нужно использовать для авторизации, например `https://management.core.windows.net/`. |
| **Идентификатор клиента** | `clientId` | Yes | <*ИД клиента*> | Идентификатор клиента для приложения, запрашивающего авторизацию. |
| **Тип учетных данных** | `credentialType` | Yes | Сертификат <br>или <br>Секрет | Тип учетных данных, используемый клиентом для запроса авторизации. Это свойство и значение не отображаются в базовом определении приложения логики, но определяют свойства, отображаемые для выбранного типа учетных данных. |
| **Секрет** | `secret` | Да, но только для типа учетных данных "секрет" | <*секретный код клиента*> | Секрет клиента для запроса на авторизацию |
| **Сохраняется** | `pfx` | Да, но только для типа учетных данных "Certificate" | <*с кодировкой-PFX-File-содержимое*> | Содержимое файла обмена личной информацией (PFX-файла) с кодировкой base64. |
| **Пароль** | `password` | Да, но только для типа учетных данных "Certificate" | <*пароль для файла pfx*> | Пароль для доступа к PFX-файлу |
| **Авторизации** | `authority` | Нет | <*URL-адрес для поставщика токена*> | URL-адрес для центра сертификации, который предоставляет маркер проверки подлинности. По умолчанию это значение равно `https://login.windows.net`. <p>**Примечание**. чтобы сделать это свойство видимым в конструкторе, в триггере или действии откройте список **Добавить новый параметр** и выберите пункт **центр**. |
|||||

При использовании [защищенных параметров](#secure-action-parameters) для управления конфиденциальной информацией, например, в [шаблоне Azure Resource Manager для автоматизации развертывания](../logic-apps/logic-apps-azure-resource-manager-templates-overview.md), можно использовать выражения для доступа к этим значениям параметров во время выполнения. В этом примере определение действия HTTP определяет `type` проверки подлинности как `ActiveDirectoryOAuth`, тип учетных данных `Secret`и использует [функцию Parameters ()](../logic-apps/workflow-definition-language-functions-reference.md#parameters) для получения значений параметров:

```json
"HTTP": {
   "type": "Http",
   "inputs": {
      "method": "GET",
      "uri": "@parameters('endpointUrlParam')",
      "authentication": {
         "type": "ActiveDirectoryOAuth",
         "tenant": "@parameters('tenantIdParam')",
         "audience": "https://management.core.windows.net/",
         "clientId": "@parameters('clientIdParam')",
         "credentialType": "Secret",
         "secret": "@parameters('secretParam')"
     }
   },
   "runAfter": {}
}
```

<a name="raw-authentication"></a>

### <a name="raw-authentication"></a>Необработанная проверка подлинности

Если параметр **RAW** доступен, этот тип проверки подлинности можно использовать, если необходимо использовать [схемы проверки подлинности](https://iana.org/assignments/http-authschemes/http-authschemes.xhtml) , которые не соответствуют [протоколу OAuth 2,0](https://oauth.net/2/). С этим типом вы вручную создаете значение заголовка авторизации, отправляемое с исходящим запросом, и указываете значение заголовка в триггере или действии.

Например, ниже приведен пример заголовка для HTTPS-запроса, который следует за [протоколом OAuth 1,0](https://tools.ietf.org/html/rfc5849):

```text
Authorization: OAuth realm="Photos",
   oauth_consumer_key="dpf43f3p2l4k3l03",
   oauth_signature_method="HMAC-SHA1",
   oauth_timestamp="137131200",
   oauth_nonce="wIjqoS",
   oauth_callback="http%3A%2F%2Fprinter.example.com%2Fready",
   oauth_signature="74KNZJeDHnMBp0EMJ9ZHt%2FXKycU%3D"
```

В триггере или действии, поддерживающем необработанную проверку подлинности, укажите следующие значения свойств:

| Свойство (конструктор) | Свойство (JSON) | обязательные | Значение | ОПИСАНИЕ |
|---------------------|-----------------|----------|-------|-------------|
| **Аутентификация** | `type` | Yes | Чтен | Используемый тип проверки подлинности |
| **Значение** | `value` | Yes | <" *авторизация — значение заголовка* "> | Значение заголовка авторизации, используемое для проверки подлинности |
||||||

При использовании [защищенных параметров](#secure-action-parameters) для управления конфиденциальной информацией, например, в [шаблоне Azure Resource Manager для автоматизации развертывания](../logic-apps/logic-apps-azure-resource-manager-templates-overview.md), можно использовать выражения для доступа к этим значениям параметров во время выполнения. В этом примере определение действия HTTP определяет `type` проверки подлинности как `Raw`и использует [функцию Parameters ()](../logic-apps/workflow-definition-language-functions-reference.md#parameters) для получения значений параметров:

```json
"HTTP": {
   "type": "Http",
   "inputs": {
      "method": "GET",
      "uri": "@parameters('endpointUrlParam')",
      "authentication": {
         "type": "Raw",
         "value": "@parameters('authHeaderParam')"
      }
   },
   "runAfter": {}
}
```

<a name="managed-identity-authentication"></a>

### <a name="managed-identity-authentication"></a>Проверка подлинности управляемого удостоверения

Если доступен параметр [управляемый идентификатор](../active-directory/managed-identities-azure-resources/overview.md) , приложение логики может использовать назначенное системой удостоверение для проверки подлинности доступа к ресурсам в других клиентах Azure Active Directory (Azure AD) без входа. Azure управляет этим удостоверением за вас и помогает защитить учетные данные, потому что вам не нужно предоставлять или сменять секреты. Узнайте больше о [службах Azure, поддерживающих управляемые удостоверения для аутентификации Azure AD](../active-directory/managed-identities-azure-resources/services-support-managed-identities.md#azure-services-that-support-azure-ad-authentication).

1. Прежде чем приложение логики сможет использовать назначенное системой удостоверение, выполните действия, описанные в разделе [Проверка подлинности доступа к ресурсам Azure с помощью управляемых удостоверений в Azure Logic Apps](../logic-apps/create-managed-service-identity.md). Эти действия включают управляемое удостоверение в приложении логики и настраивает доступ этого удостоверения к целевому ресурсу Azure.

2. Прежде чем функция Azure сможет использовать назначенное системой удостоверение, сначала [включите проверку подлинности для функций Azure](../logic-apps/logic-apps-azure-functions.md#enable-authentication-for-azure-functions).

3. В триггере или действии, где вы хотите использовать управляемое удостоверение, укажите следующие значения свойств.

   | Свойство (конструктор) | Свойство (JSON) | обязательные | Значение | ОПИСАНИЕ |
   |---------------------|-----------------|----------|-------|-------------|
   | **Аутентификация** | `type` | Yes | **Управляемое удостоверение** <br>или <br>`ManagedServiceIdentity` | Используемый тип проверки подлинности |
   | **Аудитория** | `audience` | Yes | <" *целевой объект-ресурса-идентификатор*>" | Идентификатор ресурса для целевого ресурса, к которому требуется получить доступ. <p>Например, `https://storage.azure.com/` делает маркеры доступа для проверки подлинности действительными для всех учетных записей хранения. Однако можно также указать URL-адрес корневой службы, например `https://fabrikamstorageaccount.blob.core.windows.net` для конкретной учетной записи хранения. <p>**Примечание**. это свойство может быть скрыто в некоторых триггерах или действиях. Чтобы сделать это свойство видимым, в триггере или действии откройте список **Добавить новый параметр** и выберите пункт **аудитория**. <p><p>**Важно**. Убедитесь, что этот идентификатор целевого ресурса точно соответствует значению, которое требуется Azure AD, включая все обязательные символы косой черты. Таким образом, для идентификатора ресурса `https://storage.azure.com/` для всех учетных записей хранилища BLOB-объектов Azure требуется завершающая косая черта. Однако для идентификатора ресурса конкретной учетной записи хранения не требуется завершающая косая черта. Чтобы найти эти идентификаторы ресурсов, см. статью [службы Azure, поддерживающие Azure AD](../active-directory/managed-identities-azure-resources/services-support-managed-identities.md#azure-services-that-support-azure-ad-authentication). |
   |||||

   При использовании [защищенных параметров](#secure-action-parameters) для управления конфиденциальной информацией, например, в [шаблоне Azure Resource Manager для автоматизации развертывания](../logic-apps/logic-apps-azure-resource-manager-templates-overview.md), можно использовать выражения для доступа к этим значениям параметров во время выполнения. В этом примере определение действия HTTP определяет `type` проверки подлинности как `ManagedServiceIdentity` и использует [функцию Parameters ()](../logic-apps/workflow-definition-language-functions-reference.md#parameters) для получения значений параметров:

   ```json
   "HTTP": {
      "type": "Http",
      "inputs": {
         "method": "GET",
         "uri": "@parameters('endpointUrlParam')",
         "authentication": {
            "type": "ManagedServiceIdentity",
            "audience": "https://management.azure.com/"
         },
      },
      "runAfter": {}
   }
   ```

## <a name="next-steps"></a>Дополнительная информация

* [Автоматизация развертывания для Azure Logic Apps](logic-apps-azure-resource-manager-templates-overview.md)  
* [См. статью Мониторинг приложений логики.](logic-apps-monitor-your-logic-apps.md)  
* [Диагностика и устранение сбоев рабочих процессов в Azure Logic Apps](logic-apps-diagnosing-failures.md)  
* [Автоматизация развертывания приложений логики](logic-apps-azure-resource-manager-templates-overview.md)
