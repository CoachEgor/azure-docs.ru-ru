---
title: Безопасный доступ в Azure Logic Apps | Документация Майкрософт
description: Добавление защиты для Azure Logic Apps, включая обеспечение безопасности доступа к триггерам, входным и выходным данным, а также к параметрам и другим службам
services: logic-apps
ms.service: logic-apps
ms.suite: integration
author: kevinlam1
ms.author: klam
ms.reviewer: estfan, LADocs
ms.assetid: 9fab1050-cfbc-4a8b-b1b3-5531bee92856
ms.topic: article
ms.date: 02/05/2019
ms.openlocfilehash: 31b18e2dfbad1f572b5c9b0ae59f5e076db7cde2
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "60995703"
---
# <a name="secure-access-in-azure-logic-apps"></a>Безопасный доступ к Azure Logic Apps

Ниже приведены элементы приложения логики, доступ к которым можно защитить.

* [Триггеры запросов или веб-перехватчиков](#secure-triggers).
* [Операции, такие как управление, изменение или просмотр](#secure-operations) приложений логики.
* [Входные и выходные данные](#secure-run-history) из журналов выполнения приложений логики.
* [Параметры действий и входные данные](#secure-action-parameters).
* [Службы, получающие запросы](#secure-requests) из приложения логики.

<a name="secure-triggers"></a>

## <a name="secure-access-to-request-triggers"></a>Безопасный доступ к триггерам запросов

Когда приложение логики использует триггер на основе HTTP-запросов, например триггер [запросов](../connectors/connectors-native-reqres.md) или [веб-перехватчика](../connectors/connectors-native-webhook.md), можно ограничить доступ так, чтобы только авторизованные клиенты могли запустить приложение логики. Все запросы, полученные приложением логики, шифруются и защищаются с помощью протокола SSL. Ниже приведены различные способы защиты доступа к триггеру этого типа:

* [создание подписанных URL-адресов](#sas);
* [ограничение входящих IP-адресов](#restrict-incoming-ip-addresses);
* [добавление Azure Active Directory, OAuth или других механизмов безопасности](#add-authentication).

<a name="sas"></a>

### <a name="generate-shared-access-signatures"></a>Создание подписанных URL-адресов

Каждая конечная точка запроса в приложении логики содержит [подписанный URL-адрес (SAS)](../storage/common/storage-dotnet-shared-access-signature-part-1.md) в своем URL-адресе. Каждый URL-адрес содержит параметр запроса `sp`, `sv` и `sig`.

* `sp` задает разрешения, которые соответствуют методам HTTP, доступным для использования.
* `sv` указывает версию, используемую для создания подписи.
* `sig` используется для аутентификации доступа к триггеру.

Подпись создается с использованием алгоритма SHA256 с секретным ключом доступа для всех URL-путей и свойств. Секретный ключ хранится как часть приложения логики в зашифрованном виде, никогда не раскрывается и не публикуется. Приложение логики авторизует только те триггеры, которые содержат действительную подпись, созданную с помощью секретного ключа. 

По следующим ссылкам приведены дополнительные сведения о защите доступа с подписанного URL-адреса:

* [Повторное создание ключей доступа](#access-keys)
* [Создание URL-адресов обратного вызова с истекающим сроком действия](#expiring-urls)
* [Создание URL-адресов с использованием первичного или вторичного ключа](#primary-secondary-key)

<a name="access-keys"></a>

#### <a name="regenerate-access-keys"></a>Повторное создание ключей доступа

Защищенный ключ доступа можно в любое время повторно создать с помощью REST API или портала Azure. Все текущие URL-адреса, созданные ранее с помощью старого ключа, станут недействительны, и их нельзя будет использовать для запуска приложения логики. URL-адреса, полученные после повторного создания, будут подписаны с помощью нового ключа доступа.

1. На портале Azure откройте приложение логики, для которого необходимо повторно создать ключ.

1. В меню приложения логики в разделе **Параметры** выберите **Ключи доступа**.

1. Выберите ключ, который необходимо создать повторно, и завершите процесс.

<a name="expiring-urls"></a>

#### <a name="create-callback-urls-with-expiration-dates"></a>Создание URL-адресов обратного вызова с истекающим сроком действия

Если URL-адрес конечной точки триггера на основе запросов используется совместно с другими сторонами, при необходимости можно создать URL-адреса обратного вызова с определенными ключами и датами истечения срока действия. После этого можно легко менять ключи или ограничить доступ для запуска приложения логики в определенные периоды времени. Вы можете задать дату окончания срока действия для URL-адреса с помощью [REST API для Logic Apps](https://docs.microsoft.com/rest/api/logic/workflowtriggers) следующим образом:

``` http
POST 
/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Logic/workflows/{workflowName}/triggers/{triggerName}/listCallbackUrl?api-version=2016-06-01
```

Добавьте в текст свойство `NotAfter`, используя строку даты JSON. Это свойство возвращает URL-адрес обратного вызова, действительный только до даты и времени, заданной для параметра `NotAfter`.

<a name="primary-secondary-key"></a>

#### <a name="create-urls-with-primary-or-secondary-secret-key"></a>Создание URL-адресов с использованием первичного или вторичного секретного ключа

При создании или перечислении URL-адресов обратного вызова для триггеров на основе запросов можно указать ключ, который нужно использовать для подписи URL-адреса. Вы можете создать URL-адрес, подписанный с использованием конкретного ключа, с помощью [REST API для Logic Apps](https://docs.microsoft.com/rest/api/logic/workflowtriggers) следующим образом:

``` http
POST 
/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Logic/workflows/{workflowName}/triggers/{triggerName}/listCallbackUrl?api-version=2016-06-01
```

Добавьте в текст свойство `KeyType` со значением `Primary` или `Secondary`. Это свойство возвращает URL-адрес, подписанный с помощью указанного ключа безопасности.

<a name="restrict-incoming-ip"></a>

### <a name="restrict-incoming-ip-addresses"></a>Ограничение входящих IP-адресов

Наряду с подписанным URL-адресом может потребоваться ограничить число клиентов, которые смогут вызывать приложение логики.  
Например, если вы управляете своей конечной точкой запроса с помощью службы "Управление API Azure", можно настроить приложение логики принимать только те запросы, которые поступают с IP-адреса экземпляра управления API. 

#### <a name="set-ip-ranges---azure-portal"></a>Настройка диапазона IP-адресов на портале Azure

Чтобы настроить это ограничение на портале Azure, перейдите к параметрам приложения логики. 

1. Откройте приложение логики в конструкторе приложений логики на портале Azure. 

1. В меню приложения логики в разделе **Параметры** выберите **Параметры рабочего процесса**.

1. В разделе **Конфигурация контроля доступа** > 
**Разрешенные IP-адреса для входящего трафика** щелкните **Конкретные диапазоны IP-адресов**.

1. В разделе **Диапазоны IP-адресов для триггеров** укажите диапазоны IP-адресов, которые принимает триггер. Допустимый диапазон IP-адресов имеет формат *x.x.x.x/x* или *x.x.x.x-x.x.x.x*. 

Если вы хотите, чтобы приложение логики запускалось только как вложенное приложение, в списке **Разрешенные IP-адреса для входящего трафика** выберите **Только другие приложения Logic Apps**. Этот параметр записывает пустой массив в ресурс приложения логики, поэтому только вызовы из службы Logic Apps (родительские приложения логики) могут активировать вложенное приложение логики.

> [!NOTE]
> Независимо от IP-адреса вы все равно можете запустить приложение логики, для которого установлен триггер на основе запроса, с помощью команды `/triggers/{triggerName}/run`, используя REST API Azure или службу управления API. Однако для этого потребуется аутентификация с помощью Azure REST API, а все события отобразятся в журнале аудита Azure. Убедитесь, что политики управления доступом настроены соответствующим образом.

#### <a name="set-ip-ranges---logic-app-deployment-template"></a>Настройка диапазонов IP-адресов в шаблоне развертывания приложения логики

При автоматизации развертывания приложений логики с помощью [шаблона развертывания Azure Resource Manager](../logic-apps/logic-apps-create-deploy-template.md) в этом шаблоне можно задать диапазоны IP-адресов, например:

``` json
{
   "properties": {
      "definition": {},
      "parameters": {},
      "accessControl": {
         "triggers": {
            "allowedCallerIpAddresses": [
               {
                  "addressRange": "192.168.12.0/23"
               },
               {
                  "addressRange": "2001:0db8::/64"
               }
            ]
         }
      }
   },
   "type": "Microsoft.Logic/workflows",
}
```

<a name="add-authentication"></a>

### <a name="add-azure-active-directory-oauth-or-other-security"></a>Добавление Azure Active Directory, OAuth или других механизмов безопасности

Чтобы добавить дополнительные протоколы авторизации в приложение логики, используйте [службу "Управление API Azure"](https://azure.microsoft.com/services/api-management/). Эта служба обеспечивает обширные возможности мониторинга, дополнительные средства безопасности, политики и документацию для любой конечной точки, а также возможность предоставлять приложение логики в качестве API. Служба "Управление API" может предоставлять общедоступную или частную конечную точку для приложения логики, которое затем может использовать Azure Active Directory, сертификат, OAuth или другие методы безопасности. Когда служба "Управление API" получает запрос, она отправляет его в приложение логики, выполняя при этом необходимые преобразования или устанавливая ограничения. Чтобы разрешить приложению логики запускаться только с помощью службы "Управление API", можно использовать параметры диапазона входящих IP-адресов для приложения логики. 

<a name="secure-operations"></a>

## <a name="secure-access-to-logic-app-operations"></a>Безопасный доступ к операциям приложения логики

Чтобы разрешить только определенным пользователям или группам выполнять операции в приложении логики, можно ограничить доступ к таким задачам, как управление, редактирование и просмотр. Logic Apps поддерживают [управление доступом на основе ролей Azure (RBAC)](../role-based-access-control/role-assignments-portal.md). Вы можете настроить его или назначить встроенные роли участникам подписки, например:

* [Создатель приложений логики](../role-based-access-control/built-in-roles.md#logic-app-contributor). Пользователи могут просматривать, изменять и обновлять приложения логики. 

* [Оператор приложений логики](../role-based-access-control/built-in-roles.md#logic-app-operator). Пользователи могут просматривать приложение логики и журнал выполнения, а также включать и отключать приложение логики. Эта роль не позволяет изменять или обновлять приложение логики.

Чтобы запретить другим пользователям изменять или удалять приложение логики, можно использовать [блокировку ресурсов Azure](../azure-resource-manager/resource-group-lock-resources.md). Эта возможность позволяет предотвратить изменение или удаление рабочих ресурсов.

<a name="secure-run-history"></a>

## <a name="secure-access-to-logic-app-run-history"></a>Безопасный доступ к журналу выполнения приложения логики

Чтобы защитить содержимое, передаваемое в качестве входных или выходных данных из предыдущих запусков приложения логики, можно предоставить доступ только определенному диапазону IP-адресов. Эта функция предлагает более гибкое управление доступом. Все данные в запуске приложения логики шифруются во время передачи и при хранении. При отправке запроса к журналу выполнения приложения логики служба Logic Apps проверяет подлинность запроса и предоставляет ссылки на входные и выходные данные запросов и ответов в рабочем процессе приложения логики. Вы можете защитить эти ссылки так, чтобы только запросы с определенного IP-адреса возвращали это содержимое. К примеру, можно указать IP-адрес, такой как `0.0.0.0-0.0.0.0`, чтобы никто не мог получить доступ к входным и выходным данным. Только пользователь с правами администратора может снять это ограничение и предоставить возможность JIT-доступа к содержимому приложения логики.

### <a name="set-ip-ranges---azure-portal"></a>Настройка диапазона IP-адресов на портале Azure

Чтобы настроить это ограничение на портале Azure, перейдите к параметрам приложения логики.

1. Откройте приложение логики в конструкторе приложений логики на портале Azure. 

1. В меню приложения логики в разделе **Параметры** выберите **Параметры рабочего процесса**.

1. В разделе **Конфигурация контроля доступа**> 
   **Разрешенные IP-адреса для входящего трафика** щелкните **Конкретные диапазоны IP-адресов**.

1. В разделе **Диапазоны IP-адресов для содержимого** укажите диапазоны, которые могут получать доступ к содержимому входных и выходных данных. 
   Допустимый диапазон IP-адресов имеет формат *x.x.x.x/x* или *x.x.x.x-x.x.x.x*. 

### <a name="set-ip-ranges---logic-app-deployment-template"></a>Настройка диапазонов IP-адресов в шаблоне развертывания приложения логики

При автоматизации развертывания приложений логики с помощью [шаблона развертывания Azure Resource Manager](../logic-apps/logic-apps-create-deploy-template.md) в этом шаблоне можно задать диапазоны IP-адресов, например:

``` json
{
   "properties": {
      "definition": {},
      "parameters": {},
      "accessControl": {
         "contents": {
            "allowedCallerIpAddresses": [
               {
                  "addressRange": "192.168.12.0/23"
               },
               {
                  "addressRange": "2001:0db8::/64"
               }
            ]
         }
      }
   },
   "type": "Microsoft.Logic/workflows",
}
```

<a name="secure-action-parameters"></a>

## <a name="secure-action-parameters-and-inputs"></a>Защита параметров действий и входных данных

При развертывании в разных средах для определения рабочего процесса приложения логики вам необходимо параметризовать конкретные элементы. Таким образом, вы можете предоставлять входные данные по средах, которые вы используете, и защищать конфиденциальную информацию. Например, определите и защитите параметры, которые принимают идентификатор клиента и секрет клиента, при проверке подлинности действий HTTP с помощью [Azure Active Directory](../logic-apps/logic-apps-workflow-actions-triggers.md#connector-authentication). Для этих параметров определение приложения логики содержит свой собственный раздел `parameters`.
Чтобы получить доступ к значениям параметра во время выполнения, можете использовать выражение `@parameters('parameterName')`, предоставленное [языком определения рабочего процесса](https://aka.ms/logicappsdocs). 

Чтобы защитить параметры и значения, не отображая их при изменении приложения логики или просмотра журнала выполнения, можете определить параметры с помощью ввода `securestring` и использования кодирования при необходимости. Параметры этого типа не возвращаются с помощью определения ресурса и недоступны при просмотре ресурса после развертывания.

> [!NOTE]
> Если параметр используется в заголовках или тексте запроса, он может отображаться при доступе к журналу выполнения приложения логики или исходящему HTTP-запросу. Убедитесь, что вы настроили политику доступа к содержимому соответствующим образом.
> Заголовки авторизации никогда не отображаются во входных и выходных данных. Таким образом, если используется секрет, то он не извлекается.

Дополнительные сведения о защите параметров в определениях приложений логики см. в разделе [Защищенные параметры в определениях приложений логики](#secure-parameters-workflow) далее на этой странице.

Если вы осуществляете автоматизацию развертываний с помощью [шаблонов развертывания Azure Resource Manager](../azure-resource-manager/resource-group-authoring-templates.md#parameters), то в этих шаблонах также можете использовать защищенные параметры. Например, вы можете использовать параметры для получения секретов KeyVault при создании приложения логики. Определение шаблона развертывания содержит свой собственный раздел `parameters`, отдельный от раздела `parameters` приложения логики. Дополнительные сведения о защите параметров в шаблонах развертывания см. в разделе [Защищенные параметры в шаблонах развертывания Azure Resource Manager](#secure-parameters-deployment-template) далее на этой странице.

<a name="secure-parameters-workflow"></a>

### <a name="secure-parameters-in-logic-app-definitions"></a>Защищенные параметры в определениях приложения логики

Для защиты конфиденциальной информации в определении рабочего процесса приложения логики используйте защищенные параметры, чтобы информация не отображалась после сохранения приложения логики. Например, предположим, что в определении действий HTTP вы используете проверку подлинности `Basic`. Этот пример включает раздел `parameters`, который определяет параметры для определения действия, а также раздел `authentication`, который принимает значения параметров `username` и `password`. Чтобы предоставить значения для этих параметров, используйте отдельный файл с параметрами. Пример указан ниже.

```json
"definition": {
   "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
   "actions": {
      "HTTP": {
         "type": "Http",
         "inputs": {
            "method": "GET",
            "uri": "https://www.microsoft.com",
            "authentication": {
               "type": "Basic",
               "username": "@parameters('usernameParam')",
               "password": "@parameters('passwordParam')"
            }
         },
         "runAfter": {}
      }
   },
   "parameters": {
      "passwordParam": {
         "type": "securestring"
      },
      "userNameParam": {
         "type": "securestring"
      }
   },
   "triggers": {
      "manual": {
         "type": "Request",
         "kind": "Http",
         "inputs": {
            "schema": {}
         }
      }
   },
   "contentVersion": "1.0.0.0",
   "outputs": {}
}
```

Если вы используете секреты, получите их во время развертывания с помощью [KeyVault Azure Resource Manager](../azure-resource-manager/resource-manager-keyvault-parameter.md).

<a name="secure-parameters-deployment-template"></a>

### <a name="secure-parameters-in-azure-resource-manager-deployment-templates"></a>Защищенные параметры в шаблонах развертывания Azure Resource Manager

В этом примере показан шаблон развертывания Azure Resource Manager, в котором используется более одного параметра среды выполнения с типом `securestring`.

* `armTemplatePasswordParam`, который представляет собой входные данные для параметра `logicAppWfParam` в определении приложения логики

* `logicAppWfParam`, который представляет собой входные данные для действия HTTP с использованием обычной аутентификации.

Этот пример включает внутренний раздел `parameters`, который относится к определению рабочего процесса приложения логики, и внешний раздел `parameters`, который относится к шаблону развертывания. Чтобы указать значения среды для параметров, используйте отдельный файл с параметрами. 

```json
{
   "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
   "contentVersion": "1.0.0.0",
   "parameters": {
      "logicAppName": {
         "type": "string",
         "minLength": 1,
         "maxLength": 80,
         "metadata": {
            "description": "Name of the Logic App."
         }
      },
      "armTemplatePasswordParam": {
         "type": "securestring"
      },
      "logicAppLocation": {
         "type": "string",
         "defaultValue": "[resourceGroup().location]",
         "allowedValues": [
            "[resourceGroup().location]",
            "eastasia",
            "southeastasia",
            "centralus",
            "eastus",
            "eastus2",
            "westus",
            "northcentralus",
            "southcentralus",
            "northeurope",
            "westeurope",
            "japanwest",
            "japaneast",
            "brazilsouth",
            "australiaeast",
            "australiasoutheast",
            "southindia",
            "centralindia",
            "westindia",
            "canadacentral",
            "canadaeast",
            "uksouth",
            "ukwest",
            "westcentralus",
            "westus2"
         ],
         "metadata": {
            "description": "Location of the Logic App."
         }
      }
   },
   "variables": {},
   "resources": [
      {
         "name": "[parameters('logicAppName')]",
         "type": "Microsoft.Logic/workflows",
         "location": "[parameters('logicAppLocation')]",
         "tags": {
            "displayName": "LogicApp"
         },
         "apiVersion": "2016-06-01",
         "properties": {
            "definition": {
               "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-0601/workflowdefinition.json#",
               "actions": {
                  "HTTP": {
                     "type": "Http",
                     "inputs": {
                        "method": "GET",
                        "uri": "https://www.microsoft.com",
                        "authentication": {
                           "type": "Basic",
                           "username": "@parameters('usernameParam')",
                           "password": "@parameters('logicAppWfParam')"
                        }
                     },
                  "runAfter": {}
                  }
               },
               "parameters": {
                  "logicAppWfParam": {
                     "type": "securestring"
                  },
                  "userNameParam": {
                     "type": "securestring"
                  }
               },
               "triggers": {
                  "manual": {
                     "type": "Request",
                     "kind": "Http",
                     "inputs": {
                        "schema": {}
                     }
                  }
               },
               "contentVersion": "1.0.0.0",
               "outputs": {}
            },
            "parameters": {
               "logicAppWfParam": {
                  "value": "[parameters('armTemplatePasswordParam')]"
               }
            }
         }
      }
   ],
   "outputs": {}
}
```

Если вы используете секреты, получите их во время развертывания с помощью [KeyVault Azure Resource Manager](../azure-resource-manager/resource-manager-keyvault-parameter.md).

<a name="secure-requests"></a>

## <a name="secure-access-to-services-receiving-requests"></a>Защита доступа к службам, которые получают запросы

Ниже приведены несколько способов защиты конечной точки, к которой приложение логики получает доступ и отправляет запросы.

### <a name="add-authentication-on-outbound-requests"></a>Добавление аутентификации при исходящих запросах

При работе с HTTP, HTTP + Swagger (открытый API) или с действием веб-перехватчика можно добавить аутентификацию для запроса, отправляемого приложением логики. Например, это может быть обычная аутентификация, аутентификация на основе сертификата или аутентификация Azure Active Directory. Дополнительные сведения см. в разделе [Проверка подлинности триггеров или действий](../logic-apps/logic-apps-workflow-actions-triggers.md#connector-authentication).

### <a name="restrict-access-to-logic-app-ip-addresses"></a>Разрешение доступа для определенных IP-адресов приложения логики

Все вызовы из приложений логики поступают из определенного набора IP-адресов для каждого региона. Можно добавить фильтрацию, чтобы принимать запросы только от этих IP-адресов. Список этих IP-адресов можно найти в разделе [Конфигурация: IP-адреса](logic-apps-limits-and-config.md#configuration).

### <a name="secure-on-premises-connectivity"></a>Защита подключений в локальной среде

Azure Logic Apps обеспечивают интеграцию с рядом служб для обеспечения безопасных и надежных локальных подключений.

#### <a name="on-premises-data-gateway"></a>Локальный шлюз данных

Многие управляемые соединители для Azure Logic Apps предоставляют безопасное подключение к локальным системам, включая файловую систему, SQL, SharePoint, DB2 и другие. Шлюз отправляет данные из локальных источников по шифрованным каналам через Служебную шину Azure. Весь трафик поступает как безопасный исходящий трафик от агента шлюза. Узнайте, [как работает локальный шлюз данных](logic-apps-gateway-install.md#gateway-cloud-service).

#### <a name="azure-api-management"></a>Cлужба управления Azure API

[Служба "Управление API Azure"](https://azure.microsoft.com/services/api-management/) имеет возможности локального подключения, включая VPN типа "сеть — сеть" и интеграцию ExpressRoute, для защищенного прокси-сервера и подключения к локальным системам. В конструкторе приложений логики можно выбрать API, предоставляемый службой "Управление API" в рамках рабочего процесса приложения логики, который обеспечивает быстрый доступ к локальным системам.

## <a name="next-steps"></a>Дальнейшие действия

* [Создание шаблона развертывания приложения логики](logic-apps-create-deploy-template.md)  
* [Обработка исключений](logic-apps-exception-handling.md)  
* [См. статью Мониторинг приложений логики.](logic-apps-monitor-your-logic-apps.md)  
* [Диагностика и устранение сбоев рабочих процессов в Azure Logic Apps](logic-apps-diagnosing-failures.md)  
