---
title: Добавляйте и запускайте фрагменты кода с помощью вневого кода
description: Узнайте, как создавать и запускать фрагменты кода, используя действия встроенного кода для автоматизированных задач и рабочих процессов, которые создаются с помощью приложений логики Azure
services: logic-apps
ms.suite: integration
ms.reviewer: deli, logicappspm
ms.topic: article
ms.date: 05/14/2019
ms.openlocfilehash: f7a134fd026b42d1666b8310b3fb0c10642c7bb0
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75453498"
---
# <a name="add-and-run-code-snippets-by-using-inline-code-in-azure-logic-apps"></a>Добавляйте и запускайте фрагменты кода, используя вневочный код в приложениях логики Azure

При запуске части кода в приложении логики можно добавить встроенное действие **Inline Code** в качестве шага в рабочий процесс приложения логики. Это действие работает лучше всего, когда вы хотите запустить код, который соответствует этому сценарию:

* Выполняется в JavaScript. Больше языков скоро.
* Заканчивается за пять секунд или меньше.
* Обрабатывает данные размером до 50 МБ.
* Не требует работы с [ **действиями переменных,** ](../logic-apps/logic-apps-create-variables-store-values.md)которые еще не поддерживаются.
* Использует версию Node.js 8.11.1. Для получения дополнительной [Standard built-in objects](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects)информации см. 

  > [!NOTE]
  > Функция `require()` не поддерживается действием **Inline Code** для запуска JavaScript.

Это действие запускает фрагмент кода и возвращает вывод из этого фрагмента в качестве маркера под названием **Result,** который можно использовать в последующих действиях в приложении логики. В других сценариях, где требуется создать функцию для кода, попробуйте [создать и вызвать функцию Azure](../logic-apps/logic-apps-azure-functions.md) в приложении логики.

В этой статье приложение логики примера запускается, когда новое письмо поступает в учетную запись Office 365 Outlook. Фрагмент кода извлекает и возвращает все адреса электронной почты, которые появляются в теле электронной почты.

![Пример обзора](./media/logic-apps-add-run-inline-code/inline-code-example-overview.png)

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас еще нет подписки Azure, [зарегистрируйтесь для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/).

* Приложение логики, где вы хотите добавить фрагмент кода, включая триггер. Если у вас нет приложения логики, [см.](../logic-apps/quickstart-create-first-logic-app-workflow.md)

   Пример логики приложение в этой теме использует этот Office 365 Outlook триггер: **Когда новое письмо приходит**

* [Интеграционная учетная запись,](../logic-apps/logic-apps-enterprise-integration-create-integration-account.md) связанная с вашим логическим приложением

  > [!NOTE]
  > Убедитесь, что вы используете учетную запись интеграции, которая подходит для случая использования или сценария. Например, учетные записи интеграции [свободного уровня](../logic-apps/logic-apps-pricing.md#integration-accounts) предназначены только для исследовательских сценариев и рабочих нагрузок, а не сценариев производства, ограничены в использовании и пропускной записи и не поддерживаются соглашением об уровне обслуживания (SLA). Другие уровни несут расходы, но включают поддержку SLA, предлагают большую пропускную стоимость и имеют более высокие лимиты. Узнайте больше об [уровнях интеграционного](../logic-apps/logic-apps-pricing.md#integration-accounts)счета, [ценах](https://azure.microsoft.com/pricing/details/logic-apps/)и [ограничениях.](../logic-apps/logic-apps-limits-and-config.md#integration-account-limits)

## <a name="add-inline-code"></a>Добавление внеливого кода

1. Если вы еще не сделали этого, на [портале Azure,](https://portal.azure.com)откройте свое логическое приложение в Logic App Designer.

1. В проекте добавьте действие **Inline Code** в нужном месте в рабочем процессе приложения логики.

   * Чтобы добавить действие в конце рабочего процесса, выберите **Новый шаг.**

   * Чтобы добавить действие между существующими шагами, переместите указатель мыши на стрелку, которая соединяет эти шаги. Выберите знак**+** плюс (), и выберите **Добавить действие.**

   Этот пример добавляет действие **Inline Code** в соответствии с триггером Office 365 Outlook.

   ![Добавление нового шага](./media/logic-apps-add-run-inline-code/add-new-step.png)

1. При **выборе действия,** в поле поиска, введите "включаемый код" в качестве фильтра. Из списка действий выберите это действие: **Выполните код JavaScript**

   ![Выберите "Выполнить Код JavaScript"](./media/logic-apps-add-run-inline-code/select-inline-code-action.png)

   Действие отображается в проекте и содержит некоторый пример кода по умолчанию, включая оператора возврата.

   ![Действия inline Code с кодом образца по умолчанию](./media/logic-apps-add-run-inline-code/inline-code-action-default.png)

1. В окне **кода** удалите образец кода и введите код, который вы хотите запустить. Напишите код, который вы поместите в метод, но без определения подписи метода. 

   При вводе признанного ключевого слова отображается список автозаполнения, например, из доступных ключевых слов:

   ![Список автозаполнений ключевых слов](./media/logic-apps-add-run-inline-code/auto-complete.png)

   Фрагмент кода этого примера сначала создает переменную, которая сохраняет *регулярное выражение,* которое определяет шаблон, чтобы соответствовать тексту ввода. Затем код создает переменную, которая хранит данные тела электронной почты от триггера.

   ![Создание переменных](./media/logic-apps-add-run-inline-code/save-email-body-variable.png)

   Чтобы сделать результаты триггера и предыдущих действий более легкими для ссылки, динамический список содержимого отображается в то время как курсор находится внутри окна **Кода.** В этом примере в списке отображаются доступные результаты триггера, включая маркер **body,** который теперь можно выбрать.

   После выбора маркера **тела** действие внестрого кода разрешает `workflowContext` маркер объекту, который `Body` ссылается на значение свойства электронной почты:

   ![Выберите результат](./media/logic-apps-add-run-inline-code/inline-code-example-select-outputs.png)

   В окне **кода** фрагмент может использовать объект `workflowContext` только для чтения в качестве ввода. Этот объект имеет субсвойства, которые дают коду доступ к результатам триггера и предыдущих действий в рабочем процессе.
   Для получения дополнительной информации смотрите этот раздел позже в этой теме: [Триггер ссылки и результаты действий в коде](#workflowcontext).

   > [!NOTE]
   >
   > Если фрагмент кода ссылается на имена действий, которые используют оператора точка (.) необходимо добавить эти имена действий в [параметр **Действий.** ](#add-parameters) Эти ссылки также должны приложить имена действий с квадратными скобками (я) и кавычками, например:
   >
   > `// Correct`</br> 
   > `workflowContext.actions["my.action.name"].body`</br>
   >
   > `// Incorrect`</br>
   > `workflowContext.actions.my.action.name.body`

   Действие внестроки кода не `return` требует оператора, но `return` результаты оператора доступны для справки в последующих действиях через маркер **result.** 
   Например, фрагмент кода возвращает результат, вызывая `match()` функцию, которая находит совпадения в корпусе электронной почты против обычного выражения. В действии **Compose** используется токен **Result** для ссылки на результаты действия в строке кода и создается единый результат.

   ![Готовое приложение логики](./media/logic-apps-add-run-inline-code/inline-code-complete-example.png)

1. Сохраните приложение логики, когда закончите.

<a name="workflowcontext"></a>

### <a name="reference-trigger-and-action-results-in-your-code"></a>Ссылка триггера и результатов действий в коде

Объект `workflowContext` имеет эту структуру, `actions` `trigger`которая `workflow` включает в себя, и субсвойства:

```json
{
   "workflowContext": {
      "actions": {
         "<action-name-1>": @actions('<action-name-1>'),
         "<action-name-2>": @actions('<action-name-2>')
      },
      "trigger": {
         @trigger()
      },
      "workflow": {
         @workflow()
      }
   }
}
```

Эта таблица содержит более подробную информацию об этих субсвойствах:

| Свойство | Тип | Описание |
|----------|------|-------|
| `actions` | Коллекция объектов | Объекты результата из действий, которые работают до выполнения фрагмента кода. Каждый объект имеет пару *ключей,* где ключ является именем действия, а значение эквивалентно `@actions('<action-name>')` [вызову действий() функции](../logic-apps/workflow-definition-language-functions-reference.md#actions) с функцией . В имени действия используется то же имя действия, которое используется в базовом определении рабочего процесса, которое заменяет пробелы («») в названии действия поднижаемыми (я). Этот объект обеспечивает доступ к значениям свойств действия из текущего экземпляра рабочего процесса. |
| `trigger` | Объект | Объект результата от триггера и эквивалентно вызову [триггера() функции.](../logic-apps/workflow-definition-language-functions-reference.md#trigger) Этот объект предоставляет доступ для запуска значений свойств из текущего экземпляра рабочего процесса. |
| `workflow` | Объект | Объект рабочего процесса и эквивалентвызова [функции рабочего процесса()](../logic-apps/workflow-definition-language-functions-reference.md#workflow). Этот объект обеспечивает доступ к значениям свойств рабочего процесса, таким как имя рабочего процесса, идентификатор запуска и т.д., из текущего экземпляра рабочего процесса. |
|||

В примере этой темы `workflowContext` объект имеет следующие свойства, к которым может получить доступ код:

```json
{
   "workflowContext": {
      "trigger": {
         "name": "When_a_new_email_arrives",
         "inputs": {
            "host": {
               "connection": {
                  "name": "/subscriptions/<Azure-subscription-ID>/resourceGroups/<Azure-resource-group-name>/providers/Microsoft.Web/connections/office365"
               }
            },
            "method": "get",
            "path": "/Mail/OnNewEmail",
            "queries": {
               "includeAttachments": "False"
            }
         },
         "outputs": {
            "headers": {
               "Pragma": "no-cache",
               "Content-Type": "application/json; charset=utf-8",
               "Expires": "-1",
               "Content-Length": "962095"
            },
            "body": {
               "Id": "AAMkADY0NGZhNjdhLTRmZTQtNGFhOC1iYjFlLTk0MjZlZjczMWRhNgBGAAAAAABmZwxUQtCGTqSPpjjMQeD",
               "DateTimeReceived": "2019-03-28T19:42:16+00:00",
               "HasAttachment": false,
               "Subject": "Hello World",
               "BodyPreview": "Hello World",
               "Importance": 1,
               "ConversationId": "AAQkADY0NGZhNjdhLTRmZTQtNGFhOC1iYjFlLTk0MjZlZjczMWRhNgAQ",
               "IsRead": false,
               "IsHtml": true,
               "Body": "Hello World",
               "From": "<sender>@<domain>.com",
               "To": "<recipient-2>@<domain>.com;<recipient-2>@<domain>.com",
               "Cc": null,
               "Bcc": null,
               "Attachments": []
            }
         },
         "startTime": "2019-05-03T14:30:45.971564Z",
         "endTime": "2019-05-03T14:30:50.1746874Z",
         "scheduledTime": "2019-05-03T14:30:45.8778117Z",
         "trackingId": "1cd5ffbd-f989-4df5-a96a-6e9ce31d03c5",
         "clientTrackingId": "08586447130394969981639729333CU06",
         "originHistoryName": "08586447130394969981639729333CU06",
         "code": "OK",
         "status": "Succeeded"
      },
      "workflow": {
         "id": "/subscriptions/<Azure-subscription-ID>/resourceGroups/<Azure-resource-group-name>/providers/Microsoft.Logic/workflows/<logic-app-workflow-name>",
         "name": "<logic-app-workflow-name>",
         "type": "Microsoft.Logic/workflows",
         "location": "<Azure-region>",
         "run": {
            "id": "/subscriptions/<Azure-subscription-ID>/resourceGroups/<Azure-resource-group-name>/providers/Microsoft.Logic/workflows/<logic-app-workflow-name>/runs/08586453954668694173655267965CU00",
            "name": "08586453954668694173655267965CU00",
            "type": "Microsoft.Logic/workflows/runs"
         }
      }
   }
}
```

<a name="add-parameters"></a>

## <a name="add-parameters"></a>Добавление параметров

В некоторых случаях может потребоваться явно требовать, чтобы действие **Inline Code** включает результаты триггера или конкретных действий, которые код ссылается как на зависимости, добавляя параметры **триггера** или **действий.** Этот параметр полезен для сценариев, в которых ссылки на результаты не найдены во время выполнения.

> [!TIP]
> Если вы планируете повторно использовать свой код, добавьте ссылки на свойства, используя **code** box, чтобы код включил разрешенные ссылки маркеров, вместо добавления триггера или действий в качестве явных зависимостей.

Например, предположим, что у вас есть код, который ссылается на результат **SelectedOption** в результате действия **отправки утверждения электронной почты** для разъема Office 365 Outlook. В момент создания движок Logic Apps анализирует ваш код, чтобы определить, ссылались ли вы на какие-либо триггеры или результаты действий, и автоматически включает эти результаты. Во время выполнения, если вы получите ошибку, что ссылка триггера или результат действия не доступна в указанном `workflowContext` объекте, вы можете добавить, что триггер или действие в качестве явной зависимости. В этом примере вы добавляете параметр **«Действия»** и указываете, что действие **Inline Code** явно включает результат действия **по электронной почте утверждения Отправки.**

Чтобы добавить эти параметры, откройте новый список **параметров** и выберите параметры, которые вы хотите:

   ![Добавление параметров](./media/logic-apps-add-run-inline-code/inline-code-action-add-parameters.png)

   | Параметр | Описание |
   |-----------|-------------|
   | **Действия** | Включите результаты предыдущих действий. Посмотреть [Включить результаты действий.](#action-results) |
   | **Триггер** | Включите результаты спускового крючка. [См. Включить триггерные результаты.](#trigger-results) |
   |||

<a name="trigger-results"></a>

### <a name="include-trigger-results"></a>Включить результаты триггера

Если вы **выбираете триггеры,** вам предлагается включить результаты триггера.

* Из списка **триггеров** выберите **Да**.

<a name="action-results"></a>

### <a name="include-action-results"></a>Включить результаты действий

Если вы выберете **Действия,** вам подсказывают действия, которые вы хотите добавить. Однако перед началом добавления действий требуется версия имени действия, которая отображается в базовом определении рабочего процесса логического приложения.

* Эта возможность не поддерживает переменные, циклы и индексы итерации.

* Имена в определении рабочего процесса приложения логики используют подчеркивание (я), а не пространство.

* Для имен действий, которые используют точечного оператора (.), включите эти операторы, например:

  `My.Action.Name`

1. На панели инструментов конструктора выберите представление `actions` **кода**и ищите внутри атрибута для имени действия.

   Например, `Send_approval_email_` это имя JSON для действия **электронной почты «Отправить утверждение».**

   ![Найти имя действия в JSON](./media/logic-apps-add-run-inline-code/find-action-name-json.png)

1. Чтобы вернуться к представлению конструктора, на панели инструментов представления кода, выберите **Designer.**

1. Чтобы добавить первое действие, в **пункте действия - 1** коробка, введите имя JSON действия.

   ![Введите первое действие](./media/logic-apps-add-run-inline-code/add-action-parameter.png)

1. Чтобы добавить еще одно действие, **выберите Добавить новый элемент.**

## <a name="reference"></a>Справочник

Для получения дополнительной информации о структуре действия и синтаксисе выполнения **JavaScript Code** в базовом определении рабочего процесса вашего логического приложения с использованием языка определения рабочего процесса смотрите [раздел этого](../logic-apps/logic-apps-workflow-actions-triggers.md#run-javascript-code)действия.

## <a name="next-steps"></a>Дальнейшие действия

Узнайте больше о [разъемах для приложений логики Azure](../connectors/apis-list.md)
