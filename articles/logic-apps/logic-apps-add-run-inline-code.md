---
title: Добавьте и выполнить фрагменты кода — Azure Logic Apps
description: Добавьте и выполнить фрагменты кода со встроенным кодом в Azure Logic Apps
services: logic-apps
ms.service: logic-apps
ms.suite: integration
author: ecfan
ms.author: estfan
ms.reviewer: derek1ee, LADocs
ms.topic: article
ms.date: 05/06/2019
ms.openlocfilehash: 9ef11eb2099ff617fb4da4b9a924dc3f0550f226
ms.sourcegitcommit: f6ba5c5a4b1ec4e35c41a4e799fb669ad5099522
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65160550"
---
# <a name="add-and-run-code-snippets-by-using-inline-code-in-azure-logic-apps"></a>Добавьте и выполнить фрагменты кода с помощью встроенного кода в Azure Logic Apps

Если вы хотите запустить фрагмент кода внутри своего приложения логики, можно добавить встроенные **встроенного кода** действие в качестве шага в рабочем процессе приложения логики. Это действие лучше всего, вы хотите запустить код, который подходит для этого сценария:

* Выполняется в JavaScript. Дополнительные языки, ожидается в ближайшее время.
* Завершает выполнение в течение пяти секунд или менее.
* Обрабатывает данные размером до 50 МБ.
* Node.js версии 8.11.1 используется. Дополнительные сведения см. в разделе [стандартные встроенные объекты](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects).

Это действие выполняется в фрагменте кода и возвращает выходные данные из этого фрагмента маркер с именем **результат**, который можно использовать в последующих действиях в приложении логики. Для других сценариев, где вы хотите создать функцию для кода, попробуйте [Создание и вызов функции Azure](../logic-apps/logic-apps-azure-functions.md) в приложении логики.

В этой статье примере приложение логики срабатывает когда новое письмо приходит в учетной записи Office 365 Outlook. Фрагмент кода извлекает и возвращает все адреса электронной почты, которые отображаются в тексте сообщения электронной почты.

![Общие сведения о примере](./media/logic-apps-add-run-inline-code/inline-code-example-overview.png)

## <a name="prerequisites"></a>Технические условия

* Подписка Azure. Если у вас еще нет подписки Azure, [зарегистрируйтесь для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/).

* Приложение логики, где вы хотите добавить фрагмент кода, включая триггер. Если у вас нет приложения логики, см. в разделе [краткое руководство: Создание первого автоматизированного рабочего процесса с помощью Azure Logic Apps на портале Azure](../logic-apps/quickstart-create-first-logic-app-workflow.md).

   Пример приложения логики в этом разделе использует этот триггер Office 365 Outlook: **When a new email arrives** (При получении нового сообщения электронной почты)

* [Учетной записи интеграции](../logic-apps/logic-apps-enterprise-integration-create-integration-account.md) , связанный с вашим приложением логики

## <a name="add-inline-code"></a>Добавить встроенный код

1. Если у вас ее еще в [портала Azure](https://portal.azure.com), откройте приложение логики в конструкторе приложений логики.

1. В конструкторе добавьте **встроенного кода** действие в расположении, в рабочий процесс приложения логики.

   * Чтобы добавить действие в конце рабочего процесса, выберите **новый шаг**.

   * Чтобы добавить действие между имеющимися шагами, наведите указатель мыши на стрелку, которая подключается, эти действия. Нажмите знак плюса (**+**) и выберите **добавить действие**.

   В этом примере добавляется **встроенного кода** » в разделе «триггер Office 365 Outlook.

   ![Добавить новый шаг](./media/logic-apps-add-run-inline-code/add-new-step.png)

1. В разделе **выбрать действие**, в поле поиска введите «встроенного кода» в качестве фильтра. В списке действий выберите действие **Выполнение кода JavaScript**

   ![Выберите «Выполнить код JavaScript»](./media/logic-apps-add-run-inline-code/select-inline-code-action.png)

   Действие отображается в конструкторе и некоторые примеры кодов по умолчанию, включая оператор return.

   ![Действие встроенного кода с помощью примера кода по умолчанию](./media/logic-apps-add-run-inline-code/inline-code-action-default.png)

1. В **кода** поле, удалите код примера и введите код, который вы хотите запустить. Напишите код, который можно поместить в методе, но без определения сигнатуры метода. 

   При вводе распознанного слова, отобразится список автозаполнения, можно выбрать один из доступных ключевых слов, например:

   ![Список автозаполнения ключевых слов](./media/logic-apps-add-run-inline-code/auto-complete.png)

   Этот фрагмент кода в примере сначала создается переменная, которая хранит *регулярное выражение*, которое указывает шаблон для сопоставления с введенным текстом. Затем код создает переменную, которая хранит данные тела сообщения электронной почты из триггера.

   ![Создание переменных](./media/logic-apps-add-run-inline-code/save-email-body-variable.png)

   Чтобы упростить результаты из триггеров и предыдущих действий к ссылке, появится список динамического содержимого, пока курсор находится внутри **кода** поле. Например, в списке показаны доступные результаты из триггера, включая **текст** маркер, который теперь можно выбрать.

   После выбора **текст** токена, действие встроенный код разрешает маркер `workflowContext` объект, который ссылается на адрес электронной почты `Body` значение свойства:

   ![Выберите результат](./media/logic-apps-add-run-inline-code/inline-code-example-select-outputs.png)

   В **кода** », вкладка «собственный фрагмент кода можно использовать только для чтения `workflowContext` объекта в качестве входных данных. Этот объект имеет вложенные свойства, которые предоставляют доступ к результатам с триггера и предыдущих действий в рабочем процессе.
   Дополнительные сведения см. в разделе этой статьи: [Ссылки результаты триггера и действия в коде](#workflowcontext).

   > [!NOTE]
   >
   > Если фрагмент кода ссылается на имена действий, использующих оператор точки (.), необходимо добавить эти имена действий, чтобы [ **действия** параметр](#add-parameters). Эти ссылки также необходимо заключать имена действий с помощью квадратных скобок ([]) и кавычки, например:
   >
   > `// Correct`</br> 
   > `workflowContext.actions["my.action.name"].body`</br>
   >
   > `// Incorrect`</br>
   > `workflowContext.actions.my.action.name.body`

   Действие встроенный код не требует `return` оператора, но в результате `return` инструкции, доступных для справки в последующих действиях через **результат** токена. 
   Например, фрагмент кода возвращает результат путем вызова `match()` функции, какие находит совпадения в тексте сообщения электронной почты с регулярным выражением. **Compose** использует действие **результат** token к ссылке результаты на основе встроенного кода действия и создает один результат.

   ![Готовое приложение логики](./media/logic-apps-add-run-inline-code/inline-code-complete-example.png)

1. Сохраните приложение логики, когда закончите.

<a name="workflowcontext"></a>

### <a name="reference-trigger-and-action-results-in-your-code"></a>Результаты триггер и действие ссылки в коде

`workflowContext` Объект имеет такую структуру, включая `actions`, `trigger`, и `workflow` вложенных свойства:

```json
{
   "workflowContext": {
      "actions": {
         "<action-name-1>": @actions('<action-name-1>'),
         "<action-name-2>": @actions('<action-name-2>')
      },
      "trigger": {
         @trigger()
      },
      "workflow": {
         @workflow()
      }
   }
}
```

Эта таблица содержит дополнительные сведения о вложенных свойств:

| Свойство | type | ОПИСАНИЕ |
|----------|------|-------|
| `actions` | Коллекция объектов | Объектов результатов из действия, выполняемые перед запуском фрагмента кода. Каждый объект имеет *значение_ключа* пары, где ключ является именем действия, а значение эквивалентно вызову [функция actions()](../logic-apps/workflow-definition-language-functions-reference.md#actions) с `@actions('<action-name>')`. Имя действия использует то же имя действия, который используется в базовое определение рабочего процесса, который заменяет пробелы (» «) в имени действия с символами подчеркивания (_). Данный объект предоставляет доступ к значениям свойств действия из текущего экземпляра рабочего процесса запуска. |
| `trigger` | Object | Объект результата из триггера и эквивалент вызову [trigger() функция](../logic-apps/workflow-definition-language-functions-reference.md#trigger). Данный объект предоставляет доступ к значениям свойств триггера из текущего экземпляра рабочего процесса запуска. |
| `workflow` | Object | Объект рабочего процесса и эквивалентно вызова [workflow() функция](../logic-apps/workflow-definition-language-functions-reference.md#workflow). Этот объект предоставляет доступ к значения свойств рабочего процесса, такие как имя рабочего процесса, идентификатор выполнения и т. д., из текущего экземпляра рабочего процесса запуска. |
|||

В этом разделе примере `workflowContext` объект имеет следующие свойства, которые ваш код может получить доступ:

```json
{
   "workflowContext": {
      "trigger": {
         "name": "When_a_new_email_arrives",
         "inputs": {
            "host": {
               "connection": {
                  "name": "/subscriptions/<Azure-subscription-ID>/resourceGroups/<Azure-resource-group-name>/providers/Microsoft.Web/connections/office365"
               }
            },
            "method": "get",
            "path": "/Mail/OnNewEmail",
            "queries": {
               "includeAttachments": "False"
            }
         },
         "outputs": {
            "headers": {
               "Pragma": "no-cache",
               "Content-Type": "application/json; charset=utf-8",
               "Expires": "-1",
               "Content-Length": "962095"
            },
            "body": {
               "Id": "AAMkADY0NGZhNjdhLTRmZTQtNGFhOC1iYjFlLTk0MjZlZjczMWRhNgBGAAAAAABmZwxUQtCGTqSPpjjMQeD",
               "DateTimeReceived": "2019-03-28T19:42:16+00:00",
               "HasAttachment": false,
               "Subject": "Hello World",
               "BodyPreview": "Hello World",
               "Importance": 1,
               "ConversationId": "AAQkADY0NGZhNjdhLTRmZTQtNGFhOC1iYjFlLTk0MjZlZjczMWRhNgAQ",
               "IsRead": false,
               "IsHtml": true,
               "Body": "Hello World",
               "From": "<sender>@<domain>.com",
               "To": "<recipient-2>@<domain>.com;<recipient-2>@<domain>.com",
               "Cc": null,
               "Bcc": null,
               "Attachments": []
            }
         },
         "startTime": "2019-05-03T14:30:45.971564Z",
         "endTime": "2019-05-03T14:30:50.1746874Z",
         "scheduledTime": "2019-05-03T14:30:45.8778117Z",
         "trackingId": "1cd5ffbd-f989-4df5-a96a-6e9ce31d03c5",
         "clientTrackingId": "08586447130394969981639729333CU06",
         "originHistoryName": "08586447130394969981639729333CU06",
         "code": "OK",
         "status": "Succeeded"
      },
      "workflow": {
         "id": "/subscriptions/<Azure-subscription-ID>/resourceGroups/<Azure-resource-group-name>/providers/Microsoft.Logic/workflows/<logic-app-workflow-name>",
         "name": "<logic-app-workflow-name>",
         "type": "Microsoft.Logic/workflows",
         "location": "<Azure-region>",
         "run": {
            "id": "/subscriptions/<Azure-subscription-ID>/resourceGroups/<Azure-resource-group-name>/providers/Microsoft.Logic/workflows/<logic-app-workflow-name>/runs/08586453954668694173655267965CU00",
            "name": "08586453954668694173655267965CU00",
            "type": "Microsoft.Logic/workflows/runs"
         }
      }
   }
}
```

<a name="add-parameters"></a>

## <a name="add-parameters"></a>Добавление параметров

В некоторых случаях может потребоваться явно требуют **встроенного кода** действие включает в себя результатов из триггера или действия, на которые ссылается код в качестве зависимостей, добавив **триггера** или **Действия** параметров. Этот параметр полезен для сценариев, где на которую указывает ссылка результатов не найдено во время выполнения.

> [!TIP]
> Если планируется многократное использование кода, добавьте ссылки на свойства с помощью **кода** поле, чтобы ваш код включает разрешения ссылок токена, а не Добавление триггера или действия в качестве явных зависимостей.

Например, предположим, что у вас есть код, который ссылается на **SelectedOption** результатом **отправлять сообщение с утверждением** действие для соединителя Office 365 Outlook. Во время создания, обработчик Logic Apps анализирует код, чтобы определить ли ссылки на какой-либо триггер или действие, результаты и автоматически включает эти результаты. Во время выполнения, должны отобразится сообщение об ошибке, на которую указывает ссылка результат триггер или действие, не доступных в указанном `workflowContext` объекта, можно добавить этот триггер или действие, как явная зависимость. В этом примере вы добавите **действия** параметр и указать, что **встроенного кода** действия явно не включить в результате **отправлять сообщение с утверждением** действие.

Чтобы добавить эти параметры, откройте **добавьте параметр** и выберите параметры, которые должны:

   ![Добавление параметров](./media/logic-apps-add-run-inline-code/inline-code-action-add-parameters.png)

   | Параметр | ОПИСАНИЕ |
   |-----------|-------------|
   | **Действия** | Включите результаты из предыдущих действий. См. в разделе [включают результаты действий](#action-results). |
   | **Триггер** | Включите результаты из триггера. См. в разделе [результаты триггера Include](#trigger-results). |
   |||

<a name="trigger-results"></a>

### <a name="include-trigger-results"></a>Включить результаты триггера

При выборе **триггеры**, появится ли включение триггера результатов.

* Из **триггера** выберите **Да**.

<a name="action-results"></a>

### <a name="include-action-results"></a>Включить результаты действия

При выборе **действия**, появится запрос для действия, которые вы хотите добавить. Тем не менее прежде чем начать добавление действий, вам нужна версия имя действия, которое отображается в базовое определение рабочего процесса приложения логики.

* Эта возможность не поддерживает переменные, циклы и итерации индексов.

* Имена в определении рабочего процесса приложения логики используйте символ подчеркивания (_), не пробел.

* Для имен действий, использующих оператор-точка (.) включают эти операторы, например:

  `My.Action.Name`

1. На панели инструментов конструктора нажмите **представление кода**и выполните поиск внутри `actions` атрибут для имени действия.

   Например `Send_approval_email_` имя JSON для **отправлять сообщение с утверждением** действие.

   ![Найти имя действия в формате JSON](./media/logic-apps-add-run-inline-code/find-action-name-json.png)

1. Чтобы вернуться в представление конструктора, на панели инструментов в представлении кода выберите **конструктор**.

1. Чтобы добавить первое действие, **элемента действия — 1** введите название JSON действия.

   ![Введите первое действие](./media/logic-apps-add-run-inline-code/add-action-parameter.png)

1. Чтобы добавить другое действие, выберите **добавить новый элемент**.

## <a name="reference"></a>Справочные материалы

Дополнительные сведения о **выполнение кода JavaScript** структуры и синтаксиса в свое приложение логики с помощью язык определения рабочего процесса, базовое определение рабочего процесса действия см. в разделе это действие [разделом ](../logic-apps/logic-apps-workflow-actions-triggers.md#run-javascript-code).

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о [соединители для Azure Logic Apps](../connectors/apis-list.md)
