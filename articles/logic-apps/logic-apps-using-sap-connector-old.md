---
title: Подключение к системам SAP с помощью Azure Logic Apps | Документация Майкрософт
description: Получение доступа к ресурсам SAP и управление ими путем автоматизации рабочих процессов с помощью Azure Logic Apps
author: ecfan
ms.author: estfan
ms.date: 05/31/2018
ms.topic: article
ms.service: logic-apps
services: logic-apps
ms.reviewer: klam, divswa, LADocs
ms.suite: integration
tags: connectors
ms.openlocfilehash: d677c0eae9c92f90783ed4ebd95a528b34c872ec
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "60847482"
---
# <a name="connect-to-sap-systems-from-azure-logic-apps"></a>Подключение к системам SAP из Azure Logic Apps

> [!NOTE]
> Этот соединитель SAP планируется отменить. Используйте или перенести [более новые и более сложные соединителя SAP](./logic-apps-using-sap-connector.md). 

В этой статье показано, как можно получить доступ к ресурсам SAP из приложения логики с помощью соединителей SAP Application Server и SAP Message Server. Так вы можете автоматизировать задачи, процессы и рабочие процессы, которые управляют данными и ресурсами SAP, путем создания приложений логики.

В этом примере используется приложение логики, которое может запускаться по HTTP-запросу. Приложения логики отправляет промежуточный документ (IDoc) на сервер SAP и возвращает ответ запрашивающему объекту, вызвавшему приложение логики.
Текущие соединители SAP содержат действия, но не триггеры, поэтому в примере используется [триггер HTTP-запроса](../connectors/connectors-native-reqres.md) как первый шаг рабочего процесса приложения логики. Для получения технических сведений о конкретных соединителях SAP см. следующие справочные статьи: 

* <a href="https://docs.microsoft.com/connectors/sapapplicationserver/" target="blank">Соединитель SAP Application Server</a>
* <a href="https://docs.microsoft.com/connectors/sapmessageserver/" target="blank">Соединитель SAP Message Server</a>

Если у вас еще нет подписки Azure, <a href="https://azure.microsoft.com/free/" target="_blank">получите бесплатную учетную запись Azure</a>.

## <a name="prerequisites"></a>Технические условия

Чтобы выполнить действия, описанные в этой статье, потребуется следующее:

* Приложение логики, из которого требуется осуществлять доступ к системе SAP, и триггер, который запускает рабочий процесс приложения логики. Соединители SAP сейчас предоставляют только действия. Если вы не знакомы с приложениями логики, ознакомьтесь со статьями [Что такое Azure Logic Apps](../logic-apps/logic-apps-overview.md) и [Краткое руководство. Создание первого автоматизированного рабочего процесса с помощью Azure Logic Apps на портале Azure](../logic-apps/quickstart-create-first-logic-app-workflow.md).

* Сервер <a href="https://wiki.scn.sap.com/wiki/display/ABAP/ABAP+Application+Server" target="_blank">SAP Application Server</a> или <a href="https://help.sap.com/saphelp_nw70/helpdata/en/40/c235c15ab7468bb31599cc759179ef/frameset.htm" target="_blank">SAP Message Server</a>

* Скачайте и установите последнюю версию [локального шлюза данных](https://www.microsoft.com/download/details.aspx?id=53127) на любом компьютере в локальной среде. Не забудьте настроить шлюз на портале Azure, прежде чем продолжить. Шлюз позволяет безопасно получать доступ к данным и ресурсам в локальной среде. Дополнительные сведения см. в статье [Установка локального шлюза данных для Azure Logic Apps](../logic-apps/logic-apps-gateway-install.md).

* Скачайте и установите последнюю версию клиентской библиотеки SAP, сейчас это — <a href="https://softwaredownloads.sap.com/file/0020000000086282018" target="_blank">SAP Connector (NCo) 3.0.20.0 для Microsoft .NET Framework 4.0 и 64-разрядной версии Windows (x64)</a>, на том же компьютере, где работает локальный шлюз данных. Необходимо установить эту или более позднюю версию по следующим причинам:

  * Предыдущие версии SAP NCo могут оказаться заблокированными при одновременной отправке более одного сообщения IDoc. 
  Это состояние блокирует все последующие сообщения, передаваемые объекту назначения SAP, что вызывает превышение времени ожидания сообщений.

  * Локальный шлюз данных работает только в 64-разрядных системах. 
  В противном случае возникает ошибка неправильного образа, так как служба узла шлюза управления данными не поддерживает 32-разрядные сборки.

  * Как служба узла шлюза управления данными, так и Microsoft SAP Adapter используют .NET Framework 4.5. SAP NCo для .NET Framework 4.0 работает с процессами, использующими среду выполнения .NET версии от 4.0 до 4.7.1. 
  SAP NCo для .NET Framework 2.0 работает с процессами, использующими среду выполнения .NET версии от 2.0 до 3.5, и больше не работает с новейшей версией локального шлюза данных.

* Содержимое сообщения, отправляемое на сервер SAP, например образец файла IDoc. Это содержимое должно быть в формате XML и включать в себя пространство имен для действия SAP, которое требуется использовать.

<a name="add-trigger"></a>

## <a name="add-http-request-trigger"></a>Добавление триггера HTTP-запроса

В Azure Logic Apps каждое приложение логики должно запускаться по [триггеру](../logic-apps/logic-apps-overview.md#logic-app-concepts), который активируется, когда происходит определенное событие или если выполняются заданные условия. При каждом срабатывании триггера обработчик Logic Apps создает экземпляр приложения логики, запускающий рабочий процесс.

В этом примере создается приложение логики с конечной точкой в Azure, позволяющее отправлять *HTTP-запросы POST* в приложение логики. Когда приложение логики получает эти HTTP-запросы, триггер срабатывает и выполняет следующий шаг рабочего процесса.

1. На портале Azure создайте пустое приложение логики. Откроется конструктор приложений логики. 

2. В поле поиска введите фильтр "http-запрос". В списке триггеров выберите триггер: **Запрос — При получении HTTP-запроса**.

   ![Добавление триггера HTTP-запроса](./media/logic-apps-using-sap-connector-old/add-trigger.png)

3. Теперь сохраните приложение логики, чтобы можно было создать для него URL-адрес конечной точки.
На панели инструментов конструктора нажмите кнопку **Сохранить**. 

   Теперь URL-адрес конечной точки появится в триггере, например:

   ![Создание URL-адреса для конечной точки](./media/logic-apps-using-sap-connector-old/generate-http-endpoint-url.png)

<a name="add-action"></a>

## <a name="add-sap-action"></a>Добавление действия SAP

В Azure Logic Apps [действие](../logic-apps/logic-apps-overview.md#logic-app-concepts) — это шаг в рамках рабочего процесса, выполняемый после срабатывания триггера или другого действия. Если вы еще не добавили триггер в приложение логики и хотите следовать этому примеру, добавьте [этот триггер](#add-trigger).

1. В конструкторе приложений логики выберите под триггером пункты **Новый шаг** > **Добавить действие**.

   ![Добавление действия](./media/logic-apps-using-sap-connector-old/add-action.png) 

2. В поле поиска введите фильтр "sap server". В списке действий выберите действие для сервера SAP: 

   * **SAP Application Server — отправить в SAP**
   * **SAP Message Server — отправить в SAP**

   В этом примере это действие: **SAP Application Server — отправить в SAP**

   ![Выберите "SAP Application Server" или "SAP Message Server"](media/logic-apps-using-sap-connector-old/select-sap-action.png)

3. Если потребуется ввести сведения о подключении, создайте подключение SAP. Если подключение уже существует, перейдите к следующему шагу, чтобы настроить действие SAP. 

   **Создание локального подключения SAP**

   1. В разделе **Шлюзы** выберите **Подключаться с помощью локального шлюза данных**, чтобы отобразились свойства локального подключения.

   2. Укажите сведения для подключения к серверу SAP. 
   В качестве свойства **gateway** выберите шлюз данных, созданный на портале Azure при установке шлюза, например:

      **SAP Application Server**

      ![Создание подключения к серверу приложений SAP](./media/logic-apps-using-sap-connector-old/create-SAP-app-server-connection.png)  

      **SAP Message Server**

      ![Создание подключения к серверу сообщений SAP](media/logic-apps-using-sap-connector-old/create-SAP-message-server-connection.png) 

   2. Когда все будет готово, выберите **Создать**.

      Logic Apps настраивает и проверяет подключение, гарантируя, что оно работает правильно.

4. Теперь найдите и выберите действие с сервера SAP. 

   1. В поле **SAP action** (Действие SAP) выберите значок папки. 
   В списке папок найдите и выберите действие, которое следует использовать. 

      В этом примере выбирается категория **IDOC** для действия IDoc. 

      ![Поиск и выбор действия IDoc](./media/logic-apps-using-sap-connector-old/SAP-app-server-find-action.png)

      Если не удается найти необходимое действие, можно вручную ввести путь, например:

      ![Указание пути к действию IDoc вручную](./media/logic-apps-using-sap-connector-old/SAP-app-server-manually-enter-action.png)

      Дополнительные сведения об операциях IDoc см. в статье [Message schemas for IDOC operations](https://docs.microsoft.com/biztalk/adapters-and-accelerators/adapter-sap/message-schemas-for-idoc-operations) (Схемы сообщения для операций IDOC)

   2. Щелкните внутри поля **Входное сообщение**, чтобы отобразился список динамического содержимого. 
   В этом списке в разделе **При получении HTTP-запроса** выберите поле **Текст**. 

      Этот шаг включает содержимое текста из триггера HTTP-запроса и отправляет эти выходные данные на сервер SAP.

      ![Выбор поля "Текст"](./media/logic-apps-using-sap-connector-old/SAP-app-server-action-select-body.png)

      В итоге действие SAP должно выглядеть приблизительно так, как показано в примере ниже:

      ![Готовое действие SAP](./media/logic-apps-using-sap-connector-old/SAP-app-server-complete-action.png)

6. Сохраните приложение логики. На панели инструментов конструктора нажмите кнопку **Сохранить**.

<a name="add-response"></a>

## <a name="add-http-response-action"></a>Добавление действия HTTP-ответа

Теперь добавьте действие ответа в рабочий процесс приложения логики и включите в него выходные данные действия SAP. Таким образом приложение логики будет возвращать результаты с сервера SAP исходной запросившей стороне. 

1. В конструкторе приложений логики под действием SAP выберите пункты **Новый шаг** > **Добавить действие**.

2. В поле поиска введите фильтр "ответ". В списке действий выберите действие **Запрос — Ответ**

3. Щелкните внутри поля **Текст**, чтобы отобразился список динамического содержимого. В этом списке в разделе **Отправить в SAP** выберите поле **Текст**. 

   ![Готовое действие SAP](./media/logic-apps-using-sap-connector-old/select-sap-body-for-response-action.png)

4. Сохраните приложение логики. 

## <a name="test-your-logic-app"></a>Тестирование приложения логики

1. Если приложение логики еще не включено, в меню приложения логики выберите **Обзор**. На панели инструментов нажмите **Включить**. 

2. На панели инструментов конструктора приложений логики нажмите **Запустить**. Так приложение логики будет запущено вручную.

3. Активируйте триггер приложения логики, отправив HTTP-запрос POST на URL-адрес, указанный в триггере HTTP-запроса, и включите в запрос содержимое сообщения. Для отправки запроса можно использовать, например, средство [Postman](https://www.getpostman.com/apps). 

   В этой статье запрос передает файл IDoc, который должен быть в формате XML и включать в себя пространство имен для используемого действия SAP, например: 

   ``` xml
   <?xml version="1.0" encoding="UTF-8" ?>
   <Send xmlns="http://Microsoft.LobServices.Sap/2007/03/Idoc/3/ORDERS05//620/Send">
      <idocData>
         <...>
      </idocData>
   </Send>
   ```

4. После отправки HTTP-запроса дождитесь ответа от приложения логики.

> [!NOTE]
> Время ожидания приложения логики может истечь, если все действия, необходимые для ответа, не будут завершены в течение [времени ожидания запроса](./logic-apps-limits-and-config.md). Если это произойдет, запросы могут быть заблокированы. Для помощи в диагностике неполадок узнайте, как можно [проверять и отслеживать приложения логики](../logic-apps/logic-apps-monitor-your-logic-apps.md).

Поздравляем! Вы создали приложение логики, которое может обмениваться данными с сервером SAP. Теперь с настроенным подключением SAP для приложения логики можно изучить другие доступные действия SAP, например BAPI и RFC.

## <a name="connector-reference"></a>Справочник по соединителям

Технические сведения о соединителе, описанные в его файлах Swagger, см. в следующих статьях справки: 

* [SAP Application Server](/connectors/sapapplicationserver/)
* [SAP Message Server](/connectors/sapmessageserver/)

## <a name="get-support"></a>Получение поддержки

* Если у вас возникли вопросы, то посетите [форум Azure Logic Apps](https://social.msdn.microsoft.com/Forums/en-US/home?forum=azurelogicapps).
* Отправить идею по поводу возможности или проголосовать за нее вы можете на [сайте отзывов пользователей Logic Apps](https://aka.ms/logicapps-wish).

## <a name="next-steps"></a>Дальнейшие действия

* [Подключение к локальным системам](../logic-apps/logic-apps-gateway-connection.md) из приложений логики.
* Сведения о проверке, преобразовании и других операциях с сообщениями, выполняемых с помощью [пакета интеграции Enterprise](../logic-apps/logic-apps-enterprise-integration-overview.md).
* См. дополнительные сведения о других [соединителях Logic Apps](../connectors/apis-list.md).
