---
title: Создание автоматизированных рабочих процессов на основе расписания в Azure Logic Apps
description: В этом руководстве показано, как создать повторяющийся автоматизированный рабочий процесс на основе расписания с использованием Azure Logic Apps
services: logic-apps
ms.service: logic-apps
ms.suite: integration
author: ecfan
ms.author: estfan
ms.manager: carmonm
ms.reviewer: klam, LADocs
ms.topic: tutorial
ms.custom: mvc
ms.date: 09/12/2019
ms.openlocfilehash: 9392cfc9c789a757c3ad533a3dbd4719f5292be5
ms.sourcegitcommit: f3f4ec75b74124c2b4e827c29b49ae6b94adbbb7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/12/2019
ms.locfileid: "70931459"
---
# <a name="tutorial-create-automated-schedule-based-recurring-workflows-by-using-azure-logic-apps"></a>Руководство по cозданию автоматических, выполняемых по расписанию, повторяющихся рабочих процессов с помощью Azure Logic Apps

В этом руководстве показано, как создать [приложение логики](../logic-apps/logic-apps-overview.md) и автоматизировать повторяющийся рабочий процесс, выполняемый по расписанию. В частности, в этом примере приложение логики выполняется каждый будний день утром и проверяет время поездки, включая трафик, между двумя расположениями. Если время превышает определенный предел, приложение логики отправляет электронное письмо с указанием времени в пути и дополнительного времени, необходимого, чтобы достичь пункта назначения.

Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Создание пустого приложения логики.
> * Добавьте триггер повторения, указывающий расписание для приложения логики.
> * Добавьте действие для Карт Bing, которое получает время поездки для маршрута.
> * Добавление действия, которое создает переменную, преобразует время в пути из секунд в минуты и сохраняет результат в переменной.
> * Добавление условия, которое сравнивает время в пути с заданным ограничением.
> * Добавление действия, которое отправляет электронное сообщение, если время в пути превышает ограничение.

По завершении приложение логики будет выглядеть как этот высокоуровневый рабочий процесс:

![Высокоуровневое приложение логики](./media/tutorial-build-scheduled-recurring-logic-app-workflow/check-travel-time-overview.png)

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас еще нет подписки, [подпишитесь для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/), прежде чем начинать работу.

* Учетная запись электронной почты поставщика услуг электронной почты, поддерживаемого Logic Apps, например Office 365 Outlook, Outlook.com или Gmail. Сведения о дополнительных поставщиках см. в [списке соединителей](https://docs.microsoft.com/connectors/). В этом кратком руководстве используется учетная запись Office 365 Outlook. Если используется другая учетная запись электронной почты, общие шаги остаются неизменными, однако пользовательский интерфейс может несколько отличаться.

* Чтобы получить время в пути для маршрута, требуется ключ доступа для API Карт Bing. Чтобы получить этот ключ, выполните шаги [для получения ключа Карт Bing](https://docs.microsoft.com/bingmaps/getting-started/bing-maps-dev-center-help/getting-a-bing-maps-key).

## <a name="sign-in-to-the-azure-portal"></a>Вход на портал Azure

Войдите на [портал Azure](https://portal.azure.com) с помощью учетных данных учетной записи Azure.

## <a name="create-your-logic-app"></a>Создание приложения логики

1. В главном меню на портале Azure последовательно выберите **Создать ресурс** > **Интеграция** > **Приложение логики**.

   ![Создание приложения логики](./media/tutorial-build-scheduled-recurring-logic-app-workflow/create-logic-app.png)

1. В разделе **Создание приложения логики** предоставьте сведения о приложении логики, как показано и описано. Когда все будет готово, выберите **Создать**.

   ![Предоставление сведений о приложении логики](./media/tutorial-build-scheduled-recurring-logic-app-workflow/create-logic-app-settings.png)

   | Свойство | Значение | ОПИСАНИЕ |
   |----------|-------|-------------|
   | **Имя** | LA-TravelTime | Имя приложения логики, которое может содержать только буквы, цифры, дефисы (`-`), символы подчеркивания (`_`), круглые скобки (`(`, `)`) и точки (`.`). В этом примере используется LA-TravelTime. |
   | **подписка** | <*Имя вашей подписки Azure*> | Имя подписки Azure. |
   | **группа ресурсов** | LA-TravelTime-RG | Имя [группы ресурсов Azure](../azure-resource-manager/resource-group-overview.md), используемой для упорядочения связанных ресурсов. В этом примере используется "LA-TravelTime-RG". |
   | **Местоположение.** | Запад США | Регион для хранения данных приложения логики. В этом примере используется регион "Западная часть США". |
   | **Служба Log Analytics** | Отключить | Сохраните параметр **Выкл.** для журнала ведения диагностики. |
   ||||

1. После развертывания приложения в Azure на панели инструментов Azure выберите **Уведомления** > **Перейти к ресурсу** для развернутого приложения логики.

   ![Переход к ресурсу](./media/tutorial-build-scheduled-recurring-logic-app-workflow/go-to-logic-app.png)

   Вы также можете найти и выбрать приложение логики, введя его имя в поле поиска.

   Открывается конструктор Logic Apps и отображается страница с вводным видео, а также часто используемыми триггерами и шаблонами приложений логики. В разделе **Шаблоны** выберите **Пустое приложение логики**.

   ![Выбор шаблона пустого приложения логики](./media/tutorial-build-scheduled-recurring-logic-app-workflow/select-logic-app-template.png)

Затем добавьте [триггер](../logic-apps/logic-apps-overview.md#logic-app-concepts) повторения, который запускается в зависимости от заданного расписания. Каждое приложение логики должно запускаться по триггеру, который активируется, когда происходит определенное событие или если новые данные соответствуют заданным условиям. Дополнительные сведения см. в статье о [создании первого приложения логики](../logic-apps/quickstart-create-first-logic-app-workflow.md).

## <a name="add-the-recurrence-trigger"></a>Добавление триггера повторения

1. В конструкторе приложений логики в поле поиска в качестве фильтра введите "повторение". В списке **Триггеры** выберите триггер **Периодичность**.

   ![Добавление триггера повторения](./media/tutorial-build-scheduled-recurring-logic-app-workflow/add-schedule-recurrence-trigger.png)

1. На фигуре **Повторение** нажмите кнопку с **многоточием** ( **...** ), а затем нажмите кнопку **Переименовать**. Переименуйте триггер, используя это описание: `Check travel time every weekday morning`.

   ![Переименование триггера](./media/tutorial-build-scheduled-recurring-logic-app-workflow/rename-recurrence-schedule-trigger.png)

1. В триггере измените эти свойства.

   ![Изменение интервала и частоты](./media/tutorial-build-scheduled-recurring-logic-app-workflow/change-interval-frequency.png)

   | Свойство | Обязательно | Value | ОПИСАНИЕ |
   |----------|----------|-------|-------------|
   | **Интервал** | Yes | 1 | Количество интервалов ожидания между проверками. |
   | **Frequency** | Yes | Неделя | Единица измерения времени, используемая для повторения. |
   |||||

1. В разделах **Интервал** и **Частота** откройте список **Добавить новый параметр** и выберите эти свойства для добавления в триггер.

   * **В эти дни**
   * **В эти часы**
   * **В эти минуты**

   ![Добавление свойств триггера](./media/tutorial-build-scheduled-recurring-logic-app-workflow/add-trigger-properties.png)

1. Теперь задайте значения для дополнительных свойств, как показано здесь.

   ![Указание расписания и подробностей о повторении](./media/tutorial-build-scheduled-recurring-logic-app-workflow/recurrence-trigger-property-values.png)

   | Свойство | Значение | ОПИСАНИЕ |
   |----------|-------|-------------|
   | **В эти дни** | "Понедельник", "Вторник", "Среда", "Четверг", "Пятница" | Доступно, только если параметру **Frequency** (Частота) присвоено значение "Неделя". |
   | **В эти часы** | 7, 8, 9 | Доступно, только если параметру **Frequency** (Частота) присвоено значение "Неделя" или "День". Выберите часы, в течение которых будет запущено это повторение. Этот пример выполняется на часовых метках 7, 8 и 9. |
   | **В эти минуты** | 0, 15, 30, 45 | Доступно, только если параметру **Frequency** (Частота) присвоено значение "Неделя" или "День". Выберите минуты, в течение которых будет запущено это повторение. Этот пример выполняется каждые 15 минут, начиная с отметки нулевого часа. |
   ||||

   Этот триггер срабатывает каждый день недели, каждые 15 минут с 7:00 до 9:45. В поле **Просмотр** отображается расписание повторения. Дополнительные сведения см. в статье [Планирование регулярно выполняемых задач и рабочих процессов с помощью приложений логики](../connectors/connectors-native-recurrence.md) и разделе [Триггер повторения](../logic-apps/logic-apps-workflow-actions-triggers.md#recurrence-trigger).

1. Чтобы скрыть сведения о триггере, щелкните внутри заголовка окна фигуры.

   ![Свертывание фигуры, чтобы скрыть сведения](./media/tutorial-build-scheduled-recurring-logic-app-workflow/collapse-trigger-shape.png)

1. Сохраните приложение логики. На панели инструментов конструктора щелкните **Сохранить**.

Теперь приложение логики активно, но не выполняет никаких других действий повтора. Итак, добавим действие, отвечающее при срабатывании триггера.

## <a name="get-the-travel-time-for-a-route"></a>Получение данных о времени в пути для маршрута

Теперь, когда у вас есть триггер, добавьте [действие](../logic-apps/logic-apps-overview.md#logic-app-concepts), которое получает данные о времени в пути между двумя местами. Logic Apps предоставляет соединитель для API Карт Bing, чтобы вы могли легко получить эту информацию. Прежде чем начать эту задачу, убедитесь, что у вас есть ключ API Карт Bing, как описано в предварительных требованиях для этого руководства.

1. В конструкторе приложений логики в разделе триггера выберите **Новый шаг**.

1. В разделе **Выберите действие** выберите **Стандартный**. В поле поиска введите "карты Bing" в качестве фильтра и выберите действие **получить маршрут**.

   ![Выбор действия "Получить маршрут"](./media/tutorial-build-scheduled-recurring-logic-app-workflow/select-get-route-action.png)

1. Если у вас нет подключения к Картам Bing, появится запрос на его установку. Укажите сведения о подключении и выберите **Создать**.

   ![Создание подключения к картам Bing](./media/tutorial-build-scheduled-recurring-logic-app-workflow/create-maps-connection.png)

   | Свойство | Обязательно | Value | ОПИСАНИЕ |
   |----------|----------|-------|-------------|
   | **Имя подключения** | Yes | BingMapsConnection | Укажите имя подключения. В этом примере используется "BingMapsConnection". |
   | **Ключ API**. | Yes | <*ваш ключ Карт Bing*> | Введите ключ Карт Bing, полученный ранее. Если у вас нет ключа Карт Bing, узнайте, [как получить его](https://msdn.microsoft.com/library/ff428642.aspx). |
   |||||

1. Переименуйте действие с использованием этого описания: `Get route and travel time with traffic`.

1. В действии откройте **Добавить новый список параметров** и выберите эти свойства для добавления к действию.

   * **Optimize** (Оптимизация)
   * **Distance unit** (Единица расстояния)
   * **Travel mode** (Режим движения)

   ![Добавление свойств в действие "Получить маршрут"](./media/tutorial-build-scheduled-recurring-logic-app-workflow/add-bing-maps-action-properties.png) 

1. Теперь задайте значения для дополнительных свойств действия, как показано здесь.

   ![Ввод сведений для действия Get route (Получить маршрут)](./media/tutorial-build-scheduled-recurring-logic-app-workflow/get-route-action-settings.png) 

   | Свойство | Обязательно | Value | ОПИСАНИЕ |
   |----------|----------|-------|-------------|
   | **Пункт маршрута 1** | Yes | <*исходный пункт*> | Начало маршрута |
   | **Пункт маршрута 2** | Yes | <*пункт назначения*> | Место назначения маршрута |
   | **Optimize** (Оптимизация) | Нет | timeWithTraffic | Параметр для оптимизации маршрута, например расстояние, время в пути в соответствии с текущей загрузкой дорог и т. д. Выберите параметр "timeWithTraffic". |
   | **Distance unit** (Единица расстояния) | Нет | <*выбранная единица*> | Единицы измерения расстояния для маршрута. В этом примере в качестве единицы измерения используется "миля". |
   | **Travel mode** (Режим движения) | Нет | Driving (Движение на автомобиле) | Режим движения для маршрута. Выберите режим "Автомобиль". |
   ||||

   Дополнительные сведения об этих параметрах см. в статье [Calculate a Route](https://docs.microsoft.com/bingmaps/rest-services/routes/calculate-a-route) (Расчет маршрута).

1. Сохраните приложение логики.

Затем создайте переменную, чтобы преобразовать и сохранить текущее время в минутах, а не в секундах. Таким образом можно избежать повторного преобразования и проще использовать значение на последующих шагах. 

## <a name="create-a-variable-to-store-travel-time"></a>Создание переменной для сохранения времени в пути

В некоторых случаях можно выполнять операции с данными в своем рабочем процессе, а затем использовать результаты в последующих действиях. Чтобы повторно использовать результаты и ссылаться на них, их нужно сохранить. Для этого следует создать переменные после их обработки. Переменные можно создать только на верхнем уровне приложения логики.

По умолчанию предыдущее действие **Get route** (Получить маршрут) возвращает текущее время в пути в секундах в соответствии с загрузкой дорог из свойства **Travel Duration Traffic** (Трафик длительности пути). Преобразовав и сохранив это значение в минутах, вы упрощаете его повторное использование, при котором не потребуется преобразование.

1. В действии **Get route** (Получить маршрут) выберите **Новый шаг**.

1. В разделе **Выберите действие** выберите **Встроенный**. В поле поиска введите "переменные" и выберите действие **Инициализировать переменную**.

   ![Выбор действия "Инициализировать переменную"](./media/tutorial-build-scheduled-recurring-logic-app-workflow/select-initialize-variable-action.png)

1. Переименуйте действие с использованием этого описания: `Create variable to store travel time`.

1. Укажите сведения о переменной, как описано здесь:

   | Свойство | Обязательно | Value | ОПИСАНИЕ |
   |----------|----------|-------|-------------|
   | **Имя** | Yes | travelTime | Имя для переменной. В этом примере используется "travelTime". |
   | **Тип** | Yes | Целое число | Тип данных для переменной. |
   | **Значение** | Нет| Выражение, преобразующее текущее время в секундах в минуты (см. шаги в этой таблице). | Начальное значение для переменной |
   ||||

   1. Чтобы создать выражение для свойства **Значение**, щелкните внутри поля для отображения списка динамического содержимого. При необходимости расширьте окно браузера, пока не появится список. В списке динамического содержимого выберите **Выражение**.

      ![Ввод сведений для действия "Инициализировать переменную"](./media/tutorial-build-scheduled-recurring-logic-app-workflow/initialize-variable-action-settings.png)

      Если щелкнуть внутри некоторых полей ввода, откроется список динамического содержимого. В этом списке показаны любые свойства из предыдущих действий, которые можно использовать в качестве входных данных в рабочем процессе. В списке динамического содержимого имеется редактор выражений, в котором можно выбрать функции для выполнения операций. Этот редактор выражений отображается только в списке динамического содержимого.

   1. В редакторе выражений введите следующее выражение: `div(,60)`

      ![Введите следующее выражение: "div(,60)"](./media/tutorial-build-scheduled-recurring-logic-app-workflow/initialize-variable-action-settings-2.png)

   1. Поместите курсор внутрь выражения между левой скобкой ( **(** ) и запятой ( **,** ). 
   Выберите **Динамическое содержимое**.

      ![Расположение курсора, выберите "Динамическое содержимое"](./media/tutorial-build-scheduled-recurring-logic-app-workflow/initialize-variable-action-settings-3.png)

   1. В списке динамического содержимого выберите **Travel Duration Traffic** (Трафик длительности пути).

      ![Выберите свойство Travel Duration Traffic (Трафик длительности пути)](./media/tutorial-build-scheduled-recurring-logic-app-workflow/initialize-variable-action-settings-4.png)

   1. Как только значение свойства в выражении разрешится, нажмите кнопку **ОК**.

      ![Нажатие кнопки "ОК"](./media/tutorial-build-scheduled-recurring-logic-app-workflow/initialize-variable-action-settings-5.png)

      Свойство **Value** теперь отображается, как показано ниже:

      ![Свойство Value с разрешенным выражением](./media/tutorial-build-scheduled-recurring-logic-app-workflow/initialize-variable-action-settings-6.png)

1. Сохраните приложение логики.

Затем добавьте условие, которое проверяет, превышает ли текущее время в пути определенное ограничение.

## <a name="compare-the-travel-time-with-limit"></a>Сравнение времени в пути с ограничением

1. В предыдущем действии выберите **Новый шаг**.

1. В разделе **Выбор действия** выберите **Встроенный** и выполните поиск по слову "условие" и выберите действие **Условие**.

   ![Выберите действие "Условие"](./media/tutorial-build-scheduled-recurring-logic-app-workflow/select-condition-action.png)

1. Переименуйте условие, используя описание: `If travel time exceeds limit`.

1. Создайте условие, которое проверяет, превышает ли значение свойства **travelTime** заданное ограничение, как показано ниже:

   1. Внутри условия щелкните в поле **Выберите значение** в левой части условия.

   1. Когда появится список динамического содержимого, в разделе **Переменные** выберите свойство **travelTime**.

      ![Левая часть сборки условия](./media/tutorial-build-scheduled-recurring-logic-app-workflow/build-condition-left-side.png)

   1. В диалоговом окне сравнения выберите оператор **больше чем**.

   1. В поле **Выбор значения** в правой части условия введите это ограничение: `15`

      После ввода значения условие должно выглядеть приблизительно так, как показано в примере ниже:

      ![Добавление условия](./media/tutorial-build-scheduled-recurring-logic-app-workflow/build-condition-check-travel-time.png)

1. Сохраните приложение логики.

Затем добавьте действие, выполняемое, когда время в пути превышает ограничение.

## <a name="send-email-when-limit-exceeded"></a>Отправка электронного сообщения при превышении ограничения

Теперь добавьте действие, которое отправляет сообщение электронной почты, когда время в пути превышает ограничения. Это сообщение электронной почты содержит текущее время в пути и дополнительное время, необходимое для поездки по заданному маршруту.

1. Внутри ветви **Если истинно** условия выберите **Add an action** (Добавить действие).

1. В разделе **Выберите действие** выберите **Стандартный**. В поле поиска введите "отправка сообщения". Список возвращает много результатов, поэтому сначала выберите нужный соединитель электронной почты, например:

   ![Выбор соединителя электронной почты](./media/tutorial-build-scheduled-recurring-logic-app-workflow/add-action-send-email.png)

   * Для рабочих или учебных учетных записей Azure выберите **Office 365 Outlook**.
   * Для личных учетных записей Майкрософт выберите **Outlook.com**.

1. Когда отобразятся действия соединителя, выберите "действие отправки сообщения", которое вы хотите использовать, например:

   ![Выбор действия "отправить сообщение"](./media/tutorial-build-scheduled-recurring-logic-app-workflow/select-send-email-action.png)

1. Если у вас еще нет подключения, появится запрос на вход в учетную запись электронной почты.

   Logic Apps создает подключение к учетной записи электронной почты.

1. Переименуйте действие с использованием этого описания: `Send email with travel time`.

1. В поле **Кому** введите адрес электронной почты получателя. Для тестирования используйте свой адрес электронной почты.

1. В поле **Тема** укажите тему электронного сообщения и включите переменную **travelTime**.

   1. Введите текст `Current travel time (minutes):` с пробелом. 

   1. В списке динамического содержимого в разделе **Переменные** выберите **Дополнительные сведения**.

      ![Поиск переменной "travelTime"](./media/tutorial-build-scheduled-recurring-logic-app-workflow/find-travelTime-variable.png)

   1. После того как переменная **travelTime** появится в разделе **Переменные**, выберите **travelTime**.

      ![Введите текст темы и выражение, возвращающее время в пути](./media/tutorial-build-scheduled-recurring-logic-app-workflow/select-travelTime-variable.png)

1. В поле **Текст** укажите текст сообщения электронной почты.

   1. Введите текст `Add extra travel time (minutes):` с пробелом.

   1. В списке динамического содержимого выберите **Выражение**.

      ![Создание выражения для текста электронного сообщения](./media/tutorial-build-scheduled-recurring-logic-app-workflow/send-email-body-settings.png)

   1. Введите это выражение в редакторе выражений, чтобы рассчитать, на сколько минут превышается ограничение: ```sub(,15)```.

      ![Введите выражение для расчета дополнительных минут времени в пути](./media/tutorial-build-scheduled-recurring-logic-app-workflow/send-email-body-settings-2.png)

   1. Поместите курсор внутрь выражения между левой скобкой ( **(** ) и запятой ( **,** ). Выберите **Динамическое содержимое**.

      ![Продолжайте создавать выражение для вычисления дополнительных минут времени в пути](./media/tutorial-build-scheduled-recurring-logic-app-workflow/send-email-body-settings-3.png)

   1. В разделе **Переменные** выберите **travelTime**.

      ![Выбор свойства "travelTime" для использования в выражении](./media/tutorial-build-scheduled-recurring-logic-app-workflow/send-email-body-settings-4.png)

   1. Как только свойство в выражении разрешится, нажмите кнопку **ОК**.

      ![Свойство Body с разрешенным выражением](./media/tutorial-build-scheduled-recurring-logic-app-workflow/send-email-body-settings-5.png)

      Свойство **Body** теперь отображается, как показано ниже:

      ![Свойство Body с разрешенным выражением](./media/tutorial-build-scheduled-recurring-logic-app-workflow/send-email-body-settings-6.png)

1. Сохраните приложение логики.

Затем протестируйте приложение логики, которое теперь выглядит, как показано в примере:

![Готовое приложение логики](./media/tutorial-build-scheduled-recurring-logic-app-workflow/check-travel-time-finished.png)

## <a name="run-your-logic-app"></a>Запуск приложения логики

Чтобы вручную запустить приложение логики, на панели инструментов конструктора щелкните **Запустить**.

* Если текущее время в пути не превышает ограничений, приложение логики ничего не делает и ожидает следующего интервала перед повторной проверкой. 

* Если текущее время в пути превышает ограничение, вы получаете электронное письмо с текущим временем в пути и количеством минут сверх ограничения. Ниже приведен пример сообщения, которое отправляет приложение логики:

![Отправленное сообщение электронной почты с временем в пути](./media/tutorial-build-scheduled-recurring-logic-app-workflow/email-notification.png)

Если электронные сообщения не приходят, проверьте папку нежелательной почты. Фильтр нежелательной почты может перенаправлять такие виды электронных сообщений. В противном случае, если вы не уверены, что приложение логики работает правильно, см. статью [Диагностика сбоев приложений логики](../logic-apps/logic-apps-diagnosing-failures.md).

Итак, повторяющееся приложение логики на основе планировщика создано и выполняется. 

Чтобы создать другие приложения логики, использующие триггер **Повторение**, ознакомьтесь со следующими шаблонами, которые станут доступны после создания приложения логики:

* Получайте ежедневные напоминания, отправленные вам.
* Удалите старые большие двоичные объекты Azure.
* Добавьте сообщение в очередь службы хранилища Azure.

## <a name="clean-up-resources"></a>Очистка ресурсов

Если этот образец приложения логики больше не нужен, удалите группу ресурсов, содержащую приложение логики и связанные ресурсы. 

1. В главном меню Azure перейдите к **группам ресурсов** и выберите группу ресурсов для приложения логики.

1. В меню группы ресурсов выберите **Обзор** > **Удалить группу ресурсов**. 

   !["Обзор > Удалить группу ресурсов"](./media/tutorial-build-scheduled-recurring-logic-app-workflow/delete-resource-group.png)

1. Введите имя группы ресурсов для подтверждения и нажмите кнопку **Удалить**.

## <a name="next-steps"></a>Дополнительная информация

В этом руководстве было создано приложение логики, которое проверяет загрузку дорог на основе заданного расписания (по будним дням) и принимает меры (отправляет сообщение электронной почты), когда время в пути превышает указанное ограничение. Теперь узнайте, как создать приложение логики, которое отправляет запросы для списка рассылки на утверждение, интегрируя службы Azure, службы Майкрософт и другие приложения SaaS.

> [!div class="nextstepaction"]
> [Управление запросами для списка рассылки с помощью приложения логики](../logic-apps/tutorial-process-mailing-list-subscriptions-workflow.md)
