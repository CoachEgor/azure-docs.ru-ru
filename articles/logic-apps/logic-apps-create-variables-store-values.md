---
title: Создание и управление переменными для хранения и передачи значений
description: Узнайте, как хранить, управлять, использовать и передавать значения, используя переменные в автоматизированных задачах и рабочем процессе, которые создаются с помощью приложений Azure Logic Apps
services: logic-apps
ms.suite: integration
ms.reviewer: klam, logicappspm
ms.topic: conceptual
ms.date: 09/20/2019
ms.openlocfilehash: 55984082a6b287e9f7cdca005a24ef3c18032491
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75456694"
---
# <a name="store-and-manage-values-by-using-variables-in-azure-logic-apps"></a>Храните и управляйте значениями с помощью переменных в приложениях логики Azure

В этой статье показано, как создавать и работать с переменными, которые используются для хранения значений в приложении логики. Например, переменные могут помочь вам отслеживать количество раз, в течение которого выполняется цикл. Чтобы итерировать массив или проверить массив для конкретного элемента, можно использовать переменную для ссылки на индексный номер для каждого элемента массива.

Вы можете создавать переменные для таких типов данных, как целые числа, числа с плавающей точкой, логические значения, строки, массивы и объекты. После создания переменной можно выполнять другие задачи, например:

* получить значение переменной или сослаться на него;
* увеличить или уменьшить переменную на фиксированное значение, также называемое *инкрементом* или *декрементом*;
* назначить переменной другое значение;
* вставить или *добавить* значение переменной в конце строки или массива.

Переменные существуют и являются глобальными только в рамках экземпляра создавшего их приложения логики. Кроме того, они сохраняются между итерациями циклов в экземпляре приложения логики. При упоминании переменной используйте имя переменной в качестве маркера, а не имя действия, что является обычным способом ссылки на выводы действия.

> [!IMPORTANT]
> По умолчанию циклы в цикле "Для каждого" проходят параллельно. При использовании переменных в циклах, запустите цикл [последовательно,](../logic-apps/logic-apps-control-flow-loops.md#sequential-foreach-loop) чтобы переменные возвращали предсказуемые результаты.

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас нет подписки, [зарегистрируйтесь на бесплатную учетную запись Azure.](https://azure.microsoft.com/free/)

* Приложение логики, где требуется создать переменную

  Если вы новичок в логических приложениях, просмотрите [Что такое приложения логики Azure?](../logic-apps/logic-apps-overview.md) и [quickstart: Создайте свое первое логическое приложение.](../logic-apps/quickstart-create-first-logic-app-workflow.md)

* [Триггер](../logic-apps/logic-apps-overview.md#logic-app-concepts) в качестве первого шага приложения логики

  Прежде чем добавлять действия для создания переменных и работы с ними, необходимо запустить приложение логики при помощи триггера.

<a name="create-variable"></a>

## <a name="initialize-variable"></a>Инициализация переменной

Вы можете создать переменную, а также объявить ее тип данных и исходное значение в рамках одного действия в приложении логики. Объявлять переменные можно только на глобальном уровне, а не в областях, условиях и циклах.

1. На [портале Azure](https://portal.azure.com) или Visual Studio откройте логическое приложение в Logic App Designer.

   В этом примере используются портал Azure и приложение логики с имеющимся триггером.

1. В приложении логики выполните одно из указанных ниже действий на том шаге, где требуется добавить переменную. 

   * Чтобы добавить действие под последним шагом, выберите **Новый шаг.**

     ![Добавление действия](./media/logic-apps-create-variables-store-values/add-action.png)

   * Чтобы добавить действие между шагами, переместите мышь по**+** подключающей стрелке так, чтобы появится знак плюс () Выберите знак плюс, а затем выберите **Добавить действие.**

1. В разделе **Выберите действие** введите фильтр `variables` в поле поиска. Из списка действий выберите **переменную Инициализации.**

   ![Выбор действия](./media/logic-apps-create-variables-store-values/select-initialize-variable-action.png)

1. Предоставьте эту информацию о вашей переменной, как описано ниже:

   | Свойство | Обязательно | Значение |  Описание |
   |----------|----------|-------|--------------|
   | **Название** | Да | <*переменная имя*> | Имя переменной |
   | **Тип** | Да | <*переменный тип*> | Тип данных для переменной |
   | **Значение** | нет | <*стартовая стоимость*> | Начальное значение для переменной <p><p>**Совет**. Указывать это значение необязательно, но рекомендуем сделать это, чтобы всегда знать начальное значение переменной. |
   |||||

   Пример:

   ![Инициализация переменной](./media/logic-apps-create-variables-store-values/initialize-variable.png)

1. Теперь продолжайте добавлять нужные действия. Когда вы закончите, на панели инструментов дизайнера, выберите **Сохранить**.

При переходе от дизайнера к редактору представления кода, вот способ, которым **переменное действие Инициализировать** появляется в определении приложения логики, которое находится в формате JavaScript Object Notation (JSON):

```json
"actions": {
   "Initialize_variable": {
      "type": "InitializeVariable",
      "inputs": {
         "variables": [ {
               "name": "Count",
               "type": "Integer",
               "value": 0
          } ]
      },
      "runAfter": {}
   }
},
```

> [!NOTE]
> Хотя **действие переменной инициализации** имеет `variables` раздел, структурированный как массив, действие может создавать только одну переменную за раз. Каждая новая переменная требует индивидуального **переменного действия.**

Ниже представлены примеры других типов переменных.

*Строковая переменная*

```json
"actions": {
   "Initialize_variable": {
      "type": "InitializeVariable",
      "inputs": {
         "variables": [ {
               "name": "myStringVariable",
               "type": "String",
               "value": "lorem ipsum"
          } ]
      },
      "runAfter": {}
   }
},
```

*Логическая переменная*

```json
"actions": {
   "Initialize_variable": {
      "type": "InitializeVariable",
      "inputs": {
         "variables": [ {
               "name": "myBooleanVariable",
               "type": "Boolean",
               "value": false
          } ]
      },
      "runAfter": {}
   }
},
```

*Массив целых чисел*

```json
"actions": {
   "Initialize_variable": {
      "type": "InitializeVariable",
      "inputs": {
         "variables": [ {
               "name": "myArrayVariable",
               "type": "Array",
               "value": [1, 2, 3]
          } ]
      },
      "runAfter": {}
   }
},
```

*Массив строк*

```json
"actions": {
   "Initialize_variable": {
      "type": "InitializeVariable",
      "inputs": {
         "variables": [ {
               "name": "myArrayVariable",
               "type": "Array",
               "value": ["red", "orange", "yellow"]
          } ]
      },
      "runAfter": {}
   }
},
```

<a name="get-value"></a>

## <a name="get-the-variables-value"></a>Получение значения переменной

Чтобы получить содержимое переменной или сослаться на него, вы также можете использовать [функцию variables()](../logic-apps/workflow-definition-language-functions-reference.md#variables) в конструкторе приложений логики и редакторе кода. Ссылаясь на переменную, используйте в качестве токена ее имя, а не имя действия.

Например, это выражение получает элементы из переменной массива, [созданной ранее в этой статье,](#append-value) с помощью функции. `variables()` Функция `string()` возвращает содержимое переменной в формате строки:`"1, 2, 3, red"`

```json
@{string(variables('myArrayVariable'))}
```

<a name="increment-value"></a>

## <a name="increment-variable"></a>Увеличение переменной 

Чтобы увеличить или *приравните* переменную на постоянное значение, добавьте **действие переменной приращения** в приложение логики. Это действие работает только с целочисленными и дробными переменными.

1. В Logic App Designer, под шагом, где вы хотите увеличить существующую переменную, выберите **новый шаг.** 

   Допустим, это приложение логики уже содержит триггер и действие, создавшее переменную. Добавьте новое действие под этими шагами:

   ![Добавление действия](./media/logic-apps-create-variables-store-values/add-increment-variable-action.png)

   Чтобы добавить действие между существующими шагами, наведите указатель мыши на соединяющую стрелку. Появится знак "плюс" (+). Выберите знак плюс, а затем выберите **Добавить действие.**

1. В поле поиска введите фразу "увеличение переменной". В списке действий выберите **переменную приращения.**

   ![Выберите действие "Увеличение переменной"](./media/logic-apps-create-variables-store-values/select-increment-variable-action.png)

1. Укажите следующие сведения для увеличения переменной:

   | Свойство | Обязательно | Значение |  Описание |
   |----------|----------|-------|--------------|
   | **Название** | Да | <*переменная имя*> | Имя переменной |
   | **Значение** | нет | <*приращение-стоимость*> | Значение, используемое для увеличения переменной. По умолчанию значение равно единице. <p><p>**Совет**. Указывать это значение необязательно, но рекомендуем сделать это, чтобы всегда знать конкретное значение, на которое увеличивается переменная. |
   ||||

   Пример:

   ![Пример увеличения переменной](./media/logic-apps-create-variables-store-values/increment-variable-action-information.png)

1. Когда вы закончите, на панели инструментов дизайнера, выберите **Сохранить**.

При переходе от дизайнера к редактору представления кода, вот способ, которым **действие переменной increment** отображается внутри определения приложения логики, которое находится в формате JSON:

```json
"actions": {
   "Increment_variable": {
      "type": "IncrementVariable",
      "inputs": {
         "name": "Count",
         "value": 1
      },
      "runAfter": {}
   }
},
```

## <a name="example-create-loop-counter"></a>Пример: создание счетчика циклов

Переменные часто используются для подсчета повторений циклов. В этом примере показано, как создать и использовать переменные для этой цели, создав цикл, считающий вложения в электронном сообщении.

1. Создайте пустое приложение логики на портале Azure. Добавьте триггер, проверяющий наличие новых электронных сообщений и вложений.

   В этом примере используется триггер Outlook из Office 365 для события **Когда приходит новое электронное письмо**. Этот триггер можно настроить так, чтобы он срабатывал только при наличии вложений. Однако вы можете использовать любой соединитель, проверяющий наличие новых сообщений с вложениями, например соединитель Outlook.com.

1. В триггере, чтобы проверить наличие вложений и передать эти вложения в рабочий процесс приложения логики, выберите **«Да»** для следующих свойств:

   * **Имеет вложение**
   * **Include Attachments (Включать вложения)**

   ![Проверка и включение вложений](./media/logic-apps-create-variables-store-values/check-include-attachments.png)

1. Добавьте [действие **Инициализировать переменную**](#create-variable). Создайте равностную `Count` переменную с именем с нулевым значением старта.

   ![Добавление действия "Инициализировать переменную"](./media/logic-apps-create-variables-store-values/initialize-variable.png)

1. Чтобы цикл через каждое вложение, добавить *для каждого* цикла.

   1. В соответствии **с переменным** действием Initialize выберите **новый шаг.**

   1. В разделе **Выберите действие** выберите **Встроенный**. В поле поиска `for each` введите как фильтр поиска и выберите для каждого из **них.**

      ![Добавление цикла "for each"](./media/logic-apps-create-variables-store-values/add-loop.png)

1. В цикле щелкните поле **Выберите выходные данные из предыдущих шагов**. Когда появится список динамического содержимого, выберите **Вложения**.

   ![Выбор вложений](./media/logic-apps-create-variables-store-values/select-attachments.png)

   Свойство **Вложений** передает массив, в котором вложения электронной почты из триггера, в цикл.

1. В **для каждого** цикла выберите **Добавить действие.**

   ![Выбор команды "Добавить действие"](./media/logic-apps-create-variables-store-values/add-action-2.png)

1. В поле поиска введите фразу "увеличение переменной". Из списка действий выберите **переменную приращения.**

   > [!NOTE]
   > Убедитесь, что **действие переменной приращения** отображается внутри цикла. Если действие отображается за пределами цикла, перетащите действие в цикл.

1. В действии **Увеличение переменной** выберите в списке **Имя** переменную **Счетчик**.

   ![Выбор переменной "Счетчик"](./media/logic-apps-create-variables-store-values/add-increment-variable-example.png)

1. Добавьте в цикл любое действие, отправляющее вам количество вложений. Включите в это действие значение переменной **Счетчик**, например:

   ![Добавление действия, отправляющего результаты](./media/logic-apps-create-variables-store-values/send-email-results.png)

1. Сохраните приложение логики. На панели инструментов конструктора щелкните **Сохранить**.

### <a name="test-your-logic-app"></a>Тестирование приложения логики

1. Если приложение логики не включено, в меню приложения логики выберите **Обзор**. На панели инструментов выберите **Включить**.

1. На панели инструментов Logic App Designer выберите **Run.** Так приложение логики будет запущено вручную.

1. Отправьте электронное сообщение с одним или несколькими вложениями по электронному адресу, используемому в этом примере.

   На этом шаге срабатывает триггер приложения логики, который создает и запускает экземпляр рабочего процесса приложения логики. В результате приложение логики отправляет вам сообщение или электронное письмо, в котором указывается количество вложений в отправленном сообщении.

При переходе от дизайнера к редактору представления кода, вот способ, которым **для каждого** цикла появляется вместе с переменным действием **Crecrement** внутри определения приложения логики, которое находится в формате JSON.

```json
"actions": {
   "For_each": {
      "type": "Foreach",
      "actions": {
         "Increment_variable": {
           "type": "IncrementVariable",
            "inputs": {
               "name": "Count",
               "value": 1
            },
            "runAfter": {}
         }
      },
      "foreach": "@triggerBody()?['Attachments']",
      "runAfter": {
         "Initialize_variable": [ "Succeeded" ]
      }
   }
},
```

<a name="decrement-value"></a>

## <a name="decrement-variable"></a>Переменная декремента

Чтобы уменьшить или *уменьшить* переменную на постоянное значение, выполните шаги для [увеличения переменной,](#increment-value) за исключением того, что вы найдете и выберите **действие переменной Decrement** вместо этого. Это действие работает только с целочисленными и дробными переменными.

Ниже перечислены свойства действия **Переменная декремента**.

| Свойство | Обязательно | Значение |  Описание |
|----------|----------|-------|--------------|
| **Название** | Да | <*переменная имя*> | Имя уменьшаемой переменной | 
| **Значение** | нет | <*приращение-стоимость*> | Значение для уменьшения переменной. По умолчанию значение равно единице. <p><p>**Совет**. Указывать это значение необязательно, но рекомендуем сделать это, чтобы всегда знать конкретное значение, на которое уменьшается переменная. |
||||| 

При переходе от дизайнера к редактору представления кода, вот способ, которым **действие переменной Decrement** отображается внутри определения приложения логики, которое находится в формате JSON.

```json
"actions": {
   "Decrement_variable": {
      "type": "DecrementVariable",
      "inputs": {
         "name": "Count",
         "value": 1
      },
      "runAfter": {}
   }
},
```

<a name="assign-value"></a>

## <a name="set-variable"></a>Установка значения переменной

Чтобы назначить переменной другое значение, следуйте инструкциям по [увеличению переменной](#increment-value), но:

1. Вместо этого найдите и выберите **действие переменной Set.**

1. укажите имя переменной и нужное значение. Типы данных нового значения и переменной должны совпадать. Указывать значение обязательно, так как у этого действия нет значения по умолчанию.

Ниже перечислены свойства действия **Задать переменную**.

| Свойство | Обязательно | Значение |  Описание |
|----------|----------|-------|--------------|
| **Название** | Да | <*переменная имя*> | Имя изменяемой переменной |
| **Значение** | Да | <*новая стоимость*> | Значение, которое требуется назначить переменной. Их типы данных должны совпадать. |
||||| 

> [!NOTE]
> Если вы не увеличиваете и не уменьшаете переменные, то изменение переменных в циклах *может* привести к неожиданным результатам, так как по умолчанию циклы выполняются параллельно. В таких случаях попробуйте включить последовательное выполнение циклов. Например, если вы хотите сослаться на значение переменной внутри цикла, а в начале и конце этого цикла ожидаются одинаковые значения, выполните следующие действия, чтобы изменить принцип работы цикла: 
>
> 1. В правом верхнем углу цикла выберите кнопку эллипсис **(...)** и выберите **настройки.**
> 
> 2. В разделе **Управление параллелизмом** измените значение параметра **Переопределить значения по умолчанию** на **Вкл**.
>
> 3. Перетащите ползунок **Степень параллелизма** на значение **1**.

При переходе от дизайнера к редактору представления кода, вот способ, которым **действие переменной Set** отображается внутри определения приложения логики, которое находится в формате JSON. Этот пример `Count` изменяет текущее значение переменной на другое значение.

```json
"actions": {
   "Initialize_variable": {
      "type": "InitializeVariable",
      "inputs": {
         "variables": [ {
               "name": "Count",
               "type": "Integer",
               "value": 0
          } ]
      },
      "runAfter": {}
   },
   "Set_variable": {
      "type": "SetVariable",
      "inputs": {
         "name": "Count",
         "value": 100
      },
      "runAfter": {
         "Initialize_variable": [ "Succeeded" ]
      }
   }
},
```

<a name="append-value"></a>

## <a name="append-to-variable"></a>Добавление к переменной

В переменные, в которых хранятся строки или массивы, можно вставлять или *добавлять* значения переменных в качестве последнего элемента строки или массива. Вы можете выполнить действия по [увеличению переменной](#increment-value), но: 

1. Найдите и выберите одно из следующих действий в зависимости от того, является ли переменная строкой или массивом: 

   * **Придаток к переменной строки**
   * **Придатка к переменной массива** 

1. Укажите значение для добавления в качестве последнего элемента строки или массива. Это значение обязательно.

Ниже перечислены свойства действия **Добавление к...**

| Свойство | Обязательно | Значение |  Описание |
|----------|----------|-------|--------------|
| **Название** | Да | <*переменная имя*> | Имя изменяемой переменной |
| **Значение** | Да | <*придатк-значение*> | Значение, которое требуется добавить. Оно может относиться к любому типу. |
|||||

При переходе от дизайнера к редактору представления кода, вот способ, которым **приложение к переменному** действию массива появляется внутри определения приложения логики, которое находится в формате JSON. В этом примере создается массив, в конец которого затем добавляется новое значение. В результате получится обновленная переменная, содержащая следующий массив: `[1,2,3,"red"]`

```json
"actions": {
   "Initialize_variable": {
      "type": "InitializeVariable",
      "inputs": {
         "variables": [ {
            "name": "myArrayVariable",
            "type": "Array",
            "value": [1, 2, 3]
         } ]
      },
      "runAfter": {}
   },
   "Append_to_array_variable": {
      "type": "AppendToArrayVariable",
      "inputs": {
         "name": "myArrayVariable",
         "value": "red"
      },
      "runAfter": {
        "Initialize_variable": [ "Succeeded" ]
      }
   }
},
```

## <a name="next-steps"></a>Дальнейшие действия

* См. дополнительные сведения о [соединителях Logic Apps](../connectors/apis-list.md).
