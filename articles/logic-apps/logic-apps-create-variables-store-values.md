---
title: 'Создание переменных для сохранения значений: Azure Logic Apps | Microsoft Docs'
description: Узнайте, как сохранять значения и управлять ими, создавая переменные в Azure Logic Apps
services: logic-apps
author: ecfan
manager: jeconnoc
ms.author: estfan
ms.topic: article
ms.date: 05/30/2018
ms.service: logic-apps
ms.reviewer: klam, LADocs
ms.suite: integration
ms.openlocfilehash: e525e5584e4835b0f2b73203c818c3f799b77cf5
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61004590"
---
# <a name="create-variables-for-saving-and-managing-values-in-azure-logic-apps"></a>Создание переменных для сохранения значений и управления ими в Azure Logic Apps

В этой статье показано, как сохранять значения и управлять ими в приложении логики, создавая переменные. Например, с помощью переменных можно посчитать количество повторений цикла. При переборе массива или поиске определенного значения с помощью переменной можно ссылаться на каждый элемент массива по номеру индекса. 

Вы можете создавать переменные для таких типов данных, как целые числа, числа с плавающей точкой, логические значения, строки, массивы и объекты. После создания переменной можно выполнять другие задачи, например:

* получить значение переменной или сослаться на него;
* увеличить или уменьшить переменную на фиксированное значение, также называемое *инкрементом* или *декрементом*;
* назначить переменной другое значение;
* вставить или *добавить* значение переменной в конце строки или массива.

Переменные существуют и являются глобальными только в рамках экземпляра создавшего их приложения логики. Кроме того, они сохраняются между итерациями циклов в экземпляре приложения логики. Ссылаясь на переменную, используйте в качестве токена ее имя, а не имя действия. 

> [!IMPORTANT]
> По умолчанию в цикле for each итерации выполняются параллельно. При использовании переменных в циклах запустите цикл [последовательно](../logic-apps/logic-apps-control-flow-loops.md#sequential-foreach-loop), чтобы переменные вернули предсказуемые результаты. 

Если у вас еще нет подписки Azure, <a href="https://azure.microsoft.com/free/" target="_blank">получите бесплатную учетную запись Azure</a>. 

## <a name="prerequisites"></a>Технические условия

Чтобы выполнить действия, описанные в этой статье, вам потребуются перечисленные ниже компоненты.

* Приложение логики, в котором нужно создать переменную 

  Если вы не знакомы с приложениями логики, ознакомьтесь со статьями [Что такое Azure Logic Apps](../logic-apps/logic-apps-overview.md) и [Краткое руководство. Создание первого автоматизированного рабочего процесса с помощью Azure Logic Apps на портале Azure](../logic-apps/quickstart-create-first-logic-app-workflow.md).

* [Триггер](../logic-apps/logic-apps-overview.md#logic-app-concepts) в качестве первого шага приложения логики 

  Прежде чем добавлять действия для создания переменных и работы с ними, необходимо запустить приложение логики при помощи триггера.

<a name="create-variable"></a>

## <a name="initialize-variable"></a>Инициализация переменной

Вы можете создать переменную, а также объявить ее тип данных и исходное значение в рамках одного действия в приложении логики. Объявлять переменные можно только на глобальном уровне, а не в областях, условиях и циклах. 

1. На <a href="https://portal.azure.com" target="_blank">портале Azure</a> или в Visual Studio откройте приложение логики в конструкторе приложений логики. 

   В этом примере используются портал Azure и приложение логики с имеющимся триггером.

2. В приложении логики выполните одно из указанных ниже действий на том шаге, где требуется добавить переменную. 

   * Чтобы добавить действие на последнем шаге, выберите команды **Новый шаг** > **Добавить действие**.

     ![Добавление действия](./media/logic-apps-create-variables-store-values/add-action.png)

   * Чтобы добавить действие между шагами, наведите указатель мыши на соединяющую стрелку. Появится знак "плюс" (+). 
   Щелкните знак "плюс" и выберите **Добавить действие**.

3. В поле поиска введите слово "переменные". В списке действий выберите **Переменные — Инициализировать переменную**.

   ![Выбор действия](./media/logic-apps-create-variables-store-values/select-initialize-variable-action.png)

4. Укажите следующие сведения о переменной:

   | Свойство | Обязательно для заполнения | Value |  Описание |
   |----------|----------|-------|--------------|
   | Name | да | <*variable-name*> | Имя переменной | 
   | type | да | <*variable-type*> | Тип данных для переменной | 
   | Value | Нет | <*start-value*> | Начальное значение для переменной <p><p>**Совет**. Указывать это значение необязательно, но рекомендуем сделать это, чтобы всегда знать начальное значение переменной. | 
   ||||| 

   ![Инициализировать переменную](./media/logic-apps-create-variables-store-values/initialize-variable.png)

5. Теперь продолжайте добавлять нужные действия. Завершив работу, нажмите кнопку **Сохранить** на панели инструментов конструктора.

Если вы переключитесь с конструктора на редактор кода, действие **Инициализировать переменную** будет отображаться в определении приложения логики следующим образом (в формате JSON):

```json
"actions": {
   "Initialize_variable": {
      "type": "InitializeVariable",
      "inputs": {
         "variables": [ {
               "name": "Count",
               "type": "Integer",
               "value": 0
          } ]
      },
      "runAfter": {}
   }
},
```

Ниже представлены примеры других типов переменных.

*Строковая переменная*

```json
"actions": {
   "Initialize_variable": {
      "type": "InitializeVariable",
      "inputs": {
         "variables": [ {
               "name": "myStringVariable",
               "type": "String",
               "value": "lorem ipsum"
          } ]
      },
      "runAfter": {}
   }
},
```

*Логическая переменная*

```json
"actions": {
   "Initialize_variable": {
      "type": "InitializeVariable",
      "inputs": {
         "variables": [ {
               "name": "myBooleanVariable",
               "type": "Boolean",
               "value": false
          } ]
      },
      "runAfter": {}
   }
},
```

*Массив целых чисел*

```json
"actions": {
   "Initialize_variable": {
      "type": "InitializeVariable",
      "inputs": {
         "variables": [ {
               "name": "myArrayVariable",
               "type": "Array",
               "value": [1, 2, 3]
          } ]
      },
      "runAfter": {}
   }
},
```

*Массив строк*

```json
"actions": {
   "Initialize_variable": {
      "type": "InitializeVariable",
      "inputs": {
         "variables": [ {
               "name": "myArrayVariable",
               "type": "Array",
               "value": ["red", "orange", "yellow"]
          } ]
      },
      "runAfter": {}
   }
},
```

<a name="get-value"></a>

## <a name="get-the-variables-value"></a>Получение значения переменной

Чтобы получить содержимое переменной или сослаться на него, вы также можете использовать [функцию variables()](../logic-apps/workflow-definition-language-functions-reference.md#variables) в конструкторе приложений логики и редакторе кода.
Ссылаясь на переменную, используйте в качестве токена ее имя, а не имя действия. 

Например, это выражение получает элементы из массива, [созданного ранее в этой статье](#append-value), с помощью функции **variables()**. Функция **string()** возвращает содержимое переменной в строковом формате: `"1, 2, 3, red"`

```json
@{string(variables('myArrayVariable'))}
```

<a name="increment-value"></a>

## <a name="increment-variable"></a>Увеличение переменной 

Чтобы *увеличить* переменную на фиксированное значение, добавьте действие **Переменные — Увеличение переменной** в приложение логики. Это действие работает только с целочисленными и дробными переменными.

1. В конструкторе приложений логики, на том шаге, где требуется увеличить значение имеющейся переменной, выберите команду **Новый шаг** > **Добавить действие**. 

   Допустим, это приложение логики уже содержит триггер и действие, создавшее переменную. Добавьте новое действие под этими шагами:

   ![Добавление действия](./media/logic-apps-create-variables-store-values/add-increment-variable-action.png)

   Чтобы добавить действие между существующими шагами, наведите указатель мыши на соединяющую стрелку. Появится знак "плюс" (+). Щелкните знак "плюс" и выберите **Добавить действие**.

2. В поле поиска введите фразу "увеличение переменной". В списке действий выберите **Переменные — Увеличение переменной**.

   ![Выберите действие "Увеличение переменной"](./media/logic-apps-create-variables-store-values/select-increment-variable-action.png)

3. Укажите следующие сведения для увеличения переменной:

   | Свойство | Обязательно для заполнения | Value |  Описание |
   |----------|----------|-------|--------------|
   | Name | да | <*variable-name*> | Имя переменной | 
   | Value | Нет | <*increment-value*> | Значение, используемое для увеличения переменной. По умолчанию значение равно единице. <p><p>**Совет**. Указывать это значение необязательно, но рекомендуем сделать это, чтобы всегда знать конкретное значение, на которое увеличивается переменная. | 
   |||| 

   Пример. 
   
   ![Пример увеличения переменной](./media/logic-apps-create-variables-store-values/increment-variable-action-information.png)

4. Завершив работу, нажмите кнопку **Сохранить** на панели инструментов конструктора. 

Если вы переключитесь с конструктора на редактор кода, действие **Увеличение переменной** будет отображаться в определении приложения логики следующим образом (в формате JSON):

```json
"actions": {
   "Increment_variable": {
      "type": "IncrementVariable",
      "inputs": {
         "name": "Count",
         "value": 1
      },
      "runAfter": {}
   }
},
```

## <a name="example-create-loop-counter"></a>Пример: создание счетчика циклов

Переменные часто используются для подсчета повторений циклов. В этом примере показано, как создать и использовать переменные для этой цели, создав цикл, считающий вложения в электронном сообщении.

1. Создайте пустое приложение логики на портале Azure. Добавьте триггер, проверяющий наличие новых электронных сообщений и вложений. 

   В этом примере используется триггер Outlook из Office 365 для события **Когда приходит новое электронное письмо**. 
   Этот триггер можно настроить так, чтобы он срабатывал только при наличии вложений.
   Однако вы можете использовать любой соединитель, проверяющий наличие новых сообщений с вложениями, например соединитель Outlook.com.

2. В триггере выберите **Показать расширенные параметры**. Чтобы триггер проверял наличие вложений и передавал их в рабочий процесс приложения логики, выберите значение **Да** для следующих свойств:
   
   * **Has Attachment** (С вложением) 
   * **Включить вложения** 

   ![Проверка и включение вложений](./media/logic-apps-create-variables-store-values/check-include-attachments.png)

3. Добавьте [действие **Инициализировать переменную**](#create-variable). Создайте целочисленную переменную **Счетчик** с нулевым начальным значением.

   ![Добавление действия "Инициализировать переменную"](./media/logic-apps-create-variables-store-values/initialize-variable.png)

4. Для циклического перебора вложений добавьте цикл *for each*, выбрав **Новый шаг** > **Дополнительно** > **Добавить оператор "для каждого"**.

   ![Добавление цикла "for each"](./media/logic-apps-create-variables-store-values/add-loop.png)

5. В цикле щелкните поле **Выберите выходные данные из предыдущих шагов**. Когда появится список динамического содержимого, выберите **Вложения**. 

   ![Выбор вложений](./media/logic-apps-create-variables-store-values/select-attachments.png)

   Поле **Вложения** передает массив вложений электронного сообщения из выходных данных триггера в цикл.

6. В цикле "for each" выберите **Добавить действие**. 

   ![Выбор команды "Добавить действие"](./media/logic-apps-create-variables-store-values/add-action-2.png)

7. В поле поиска введите фразу "увеличение переменной". В списке действий выберите **Переменные — Увеличение переменной**.

   > [!NOTE]
   > Убедитесь, что действие **Увеличение переменной** отображается в цикле. Если действие отображается за пределами цикла, перетащите действие в цикл.

8. В действии **Увеличение переменной** выберите в списке **Имя** переменную **Счетчик**. 

   ![Выбор переменной "Счетчик"](./media/logic-apps-create-variables-store-values/add-increment-variable-example.png)

9. Добавьте в цикл любое действие, отправляющее вам количество вложений. Включите в это действие значение переменной **Счетчик**, например: 

   ![Добавление действия, отправляющего результаты](./media/logic-apps-create-variables-store-values/send-email-results.png)

10. Сохраните приложение логики. На панели инструментов конструктора нажмите кнопку **Сохранить**. 

### <a name="test-your-logic-app"></a>Тестирование приложения логики

1. Если приложение логики не включено, выберите в его меню пункт **Обзор**. На панели инструментов нажмите **Включить**. 

2. На панели инструментов конструктора приложений логики нажмите **Запустить**. При этом приложение логики автоматически перезапустится.

3. Отправьте электронное сообщение с одним или несколькими вложениями по электронному адресу, используемому в этом примере.

   На этом шаге срабатывает триггер приложения логики, который создает и запускает экземпляр рабочего процесса приложения логики.
   В результате приложение логики отправляет вам сообщение или электронное письмо, в котором указывается количество вложений в отправленном сообщении.

Если вы переключитесь с конструктора на редактор кода, цикл "for each" с действием **Увеличение переменной** будет отображаться в определении приложения логики следующим образом (в формате JSON):

```json
"actions": {
   "For_each": {
      "type": "Foreach",
      "actions": {
         "Increment_variable": {
           "type": "IncrementVariable",
            "inputs": {
               "name": "Count",
               "value": 1
            },
            "runAfter": {}
         }
      },
      "foreach": "@triggerBody()?['Attachments']",
      "runAfter": {
         "Initialize_variable": [ "Succeeded" ]
      }
   }
},
```

<a name="decrement-value"></a>

## <a name="decrement-variable"></a>Переменная декремента

Чтобы *уменьшить* значение переменной на фиксированное значение, следуйте инструкциям по [увеличению переменной](#increment-value), но выберите действие **Переменные — Переменная декремента**. Это действие работает только с целочисленными и дробными переменными.

Ниже перечислены свойства действия **Переменная декремента**.

| Свойство | Обязательно для заполнения | Value |  Описание |
|----------|----------|-------|--------------|
| Name | да | <*variable-name*> | Имя уменьшаемой переменной | 
| Value | Нет | <*increment-value*> | Значение для уменьшения переменной. По умолчанию значение равно единице. <p><p>**Совет**. Указывать это значение необязательно, но рекомендуем сделать это, чтобы всегда знать конкретное значение, на которое уменьшается переменная. | 
||||| 

Если вы переключитесь с конструктора на редактор кода, действие **Переменная декремента** будет отображаться в определении приложения логики следующим образом (в формате JSON):

```json
"actions": {
   "Decrement_variable": {
      "type": "DecrementVariable",
      "inputs": {
         "name": "Count",
         "value": 1
      },
      "runAfter": {}
   }
},
```


<a name="assign-value"></a>

## <a name="set-variable"></a>Установка значения переменной

Чтобы назначить переменной другое значение, следуйте инструкциям по [увеличению переменной](#increment-value), но: 

1. найдите и выберите действие **Переменные — Задать переменную**; 

2. укажите имя переменной и нужное значение. Типы данных нового значения и переменной должны совпадать.
Указывать значение обязательно, так как у этого действия нет значения по умолчанию. 

Ниже перечислены свойства действия **Задать переменную**.

| Свойство | Обязательно для заполнения | Value |  Описание | 
|----------|----------|-------|--------------| 
| Name | да | <*variable-name*> | Имя изменяемой переменной | 
| Value | да | <*new-value*> | Значение, которое требуется назначить переменной. Их типы данных должны совпадать. | 
||||| 

> [!NOTE]
> Если вы не увеличиваете и не уменьшаете переменные, то изменение переменных в циклах *может* привести к неожиданным результатам, так как по умолчанию циклы выполняются параллельно. В таких случаях попробуйте включить последовательное выполнение циклов. Например, если вы хотите сослаться на значение переменной внутри цикла, а в начале и конце этого цикла ожидаются одинаковые значения, выполните следующие действия, чтобы изменить принцип работы цикла: 
>
> 1. В правом верхнем углу окна цикла нажмите кнопку с многоточием (...) и выберите **Параметры**.
> 
> 2. В разделе **Управление параллелизмом** измените значение параметра **Переопределить значения по умолчанию** на **Вкл**.
>
> 3. Перетащите ползунок **Степень параллелизма** на значение **1**.

Если вы переключитесь с конструктора на редактор кода, действие **Установка переменной** будет отображаться в определении приложения логики следующим образом (в формате JSON): В этом примере текущее значение переменной Count меняется на другое. 

```json
"actions": {
   "Initialize_variable": {
      "type": "InitializeVariable",
      "inputs": {
         "variables": [ {
               "name": "Count",
               "type": "Integer",
               "value": 0
          } ]
      },
      "runAfter": {}
   },
   "Set_variable": {
      "type": "SetVariable",
      "inputs": {
         "name": "Count",
         "value": 100
      },
      "runAfter": {
         "Initialize_variable": [ "Succeeded" ]
      }
   }
},
```

<a name="append-value"></a>

## <a name="append-to-variable"></a>Добавление к переменной

В переменные, в которых хранятся строки или массивы, можно вставлять или *добавлять* значения переменных в качестве последнего элемента строки или массива. Вы можете выполнить действия по [увеличению переменной](#increment-value), но: 

1. Найдите и выберите одно из следующих действий в зависимости от того, является ли переменная строкой или массивом: 

   * **Переменные — Добавление в переменную строки**
   * **Переменные — Добавление значения в переменную массива** 

2. Укажите значение для добавления в качестве последнего элемента строки или массива. 
   Это обязательное значение. 

Ниже перечислены свойства действия **Добавление к...**

| Свойство | Обязательно для заполнения | Value |  Описание | 
|----------|----------|-------|--------------| 
| Name | да | <*variable-name*> | Имя изменяемой переменной | 
| Value | да | <*append-value*> | Значение, которое требуется добавить. Оно может относиться к любому типу. | 
|||||  

Если вы переключитесь с конструктора на редактор кода, действие **Добавление значения в переменную массива** будет отображаться в определении приложения логики следующим образом (в формате JSON):
В этом примере создается массив, в конец которого затем добавляется новое значение. В результате получится обновленная переменная, содержащая следующий массив: `[1,2,3,"red"]` 

```json
"actions": {
   "Initialize_variable": {
      "type": "InitializeVariable",
      "inputs": {
         "variables": [ {
            "name": "myArrayVariable",
            "type": "Array",
            "value": [1, 2, 3]
         } ]
      },
      "runAfter": {}
   },
   "Append_to_array_variable": {
      "type": "AppendToArrayVariable",
      "inputs": {
         "name": "myArrayVariable",
         "value": "red"
      },
      "runAfter": {
        "Initialize_variable": [ "Succeeded" ]
      }
   }
},
```

## <a name="get-support"></a>Получение поддержки

* Если у вас возникли вопросы, то посетите [форум Azure Logic Apps](https://social.msdn.microsoft.com/Forums/en-US/home?forum=azurelogicapps).
* Отправить идею по поводу возможности или проголосовать за нее вы можете на [сайте отзывов пользователей Logic Apps](https://aka.ms/logicapps-wish).

## <a name="next-steps"></a>Дальнейшие действия

* См. дополнительные сведения о [соединителях Logic Apps](../connectors/apis-list.md).
