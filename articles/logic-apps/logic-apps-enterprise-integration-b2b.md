---
title: Обмен сообщениями для сценариев интеграции предприятий B2B
description: Получайте и отправляйте B2B-сообщения между торговыми партнерами в приложениях Azure Logic Apps с помощью пакета корпоративной интеграции
services: logic-apps
ms.suite: integration
author: divyaswarnkar
ms.author: divswa
ms.reviewer: jonfan, estfan, logicappspm
ms.topic: article
ms.date: 02/10/2020
ms.openlocfilehash: 01b2bd464db51e255930fe83a3f4321687322275
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "77151200"
---
# <a name="receive-and-send-b2b-messages-by-using-azure-logic-apps-and-enterprise-integration-pack"></a>Получайте и отправляйте B2B-сообщения с помощью приложений Azure Logic Apps и пакета корпоративной интеграции

Если у вас есть интеграционный счет, определяющий торговых партнеров и соглашения, можно создать автоматизированный рабочий процесс для бизнеса (B2B), который обменивается сообщениями между торговыми партнерами с помощью [приложений Azure Logic Apps](../logic-apps/logic-apps-overview.md) с [пакетом корпоративной интеграции.](../logic-apps/logic-apps-enterprise-integration-overview.md) Azure Logic Apps работает с разъемами, поддерживающими протоколы AS2, X12, EDIFACT и RosettaNet. Вы также можете объединить эти разъемы с [другими разъемами, доступными в Logic Apps,](../connectors/apis-list.md)например, Salesforce и Office 365 Outlook.

В этой статье показано, как создать логическое приложение, которое получает запрос HTTP с помощью триггера Запроса, декодирует содержимое сообщения с помощью действий AS2 и X12, а затем возвращает ответ с помощью действия Response.

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас еще нет подписки, [зарегистрируйтесь на бесплатную учетную запись Azure.](https://azure.microsoft.com/free/)

* Пустое приложение логики, чтобы можно было создать рабочий процесс B2B, используя триггер [Запроса,](../connectors/connectors-native-reqres.md) за которым следуют эти действия:

  * [Декодирование AS2](../logic-apps/logic-apps-enterprise-integration-as2.md)

  * [Условие](../logic-apps/logic-apps-control-flow-conditional-statement.md), которое отправляет [ответ](../connectors/connectors-native-reqres.md) на основе того, является ли действие AS2 Decode успешным или не удается

  * [Декодирование сообщения X12](../logic-apps/logic-apps-enterprise-integration-x12.md) 

  Если вы новичок в логических приложениях, просмотрите [Что такое приложения логики Azure?](../logic-apps/logic-apps-overview.md) и [quickstart: Создайте свое первое логическое приложение.](../logic-apps/quickstart-create-first-logic-app-workflow.md)

* [Интеграционная учетная запись,](../logic-apps/logic-apps-enterprise-integration-accounts.md) связанная с подпиской Azure и связанная с приложением логики. Приложение логики и учетная запись интеграции должны существовать в одном месте или в регионе Azure.

* По крайней мере, два [торговых партнера,](../logic-apps/logic-apps-enterprise-integration-partners.md) которые вы уже определили в вашем интеграционном счете вместе с [соглашениями AS2 и X12](logic-apps-enterprise-integration-agreements.md) для этих партнеров.

## <a name="add-request-trigger"></a>Добавление триггера Запроса

В этом примере используется Logic App Designer на портале Azure, но вы можете следовать аналогичным шагам для Logic App Designer в Visual Studio.

1. На [портале Azure](https://portal.azure.com)откройте пустое логическое приложение в Logic App Designer.

1. В поле поиска `when a http request`введите и **выберите, когда запрос HTTP получен** для использования в качестве триггера.

   ![Выберите триггер запроса для запуска рабочего процесса приложения логики](./media/logic-apps-enterprise-integration-b2b/select-http-request-trigger.png)

1. Оставьте поле **Запроса JSON Schema** пустым, поскольку сообщение X12 является плоским файлом.

   ![Оставьте "Запрос тела JSON Schema" пустой](./media/logic-apps-enterprise-integration-b2b/receive-trigger-message-body-json-schema.png)

1. Когда вы закончите, на панели инструментов дизайнера, выберите **Сохранить**.

   Этот шаг генерирует **URL HTTP POST** для использования для отправки запроса, который запускает логическое приложение. Чтобы скопировать этот URL, выберите значок копии рядом с URL-.

   ![URL, генерируемый для триггера Запроса для приема вызовов](./media/logic-apps-enterprise-integration-b2b/generated-url-request-trigger.png)

## <a name="add-as2-decode-action"></a>Добавить действие расшифровки AS2

Теперь добавьте действия B2B, которые вы хотите использовать. В этом примере используются действия AS2 и X12.

1. В разделе триггера щелкните **Добавить шаг**. Чтобы скрыть детали триггера, нажмите на заглавный бар триггера.

   ![Добавьте еще один шаг в рабочий процесс приложения логики](./media/logic-apps-enterprise-integration-b2b/add-new-action-under-trigger.png)

1. Под **Выберите действие,** в поле `as2 decode`поиска, введите, и выберите **AS2 Декодирование (v2)**.

   ![Найти и выбрать "AS2 Декодирование (v2)"](./media/logic-apps-enterprise-integration-b2b/add-as2-decode-action.png)

1. Для **декодирования** свойств Сообщения введите вхотливый, который необходимо `body` декодировать действию AS2, который является содержимым, полученным триггером запроса HTTP. У вас есть несколько способов указать это содержимое как вход, либо из списка динамического содержимого, либо как выражение:

   * Чтобы выбрать из списка, отображающегося доступных триггерных выходов, нажмите внутри **Сообщения для декодирования** коробки. После того, как появится список динамического содержимого, в соответствии **с запросом HTTP**выберите значение свойства **тела,** например:

     ![Выберите значение "Тело" из триггера](./media/logic-apps-enterprise-integration-b2b/select-body-content-from-trigger.png)

   * Чтобы ввести выражение, отсылавав шее к выходу триггера, `body` щелкните внутри Сообщения для **декодирования** окна. После того, как появится список динамического содержимого, выберите **Expression**. В редакторе выражения введите выражение здесь и выберите **OK:**

     `triggerOutputs()['body']`

     Или, в **Послании для декодирования** коробки, непосредственно введите это выражение:

     `@triggerBody()`

     Выражение разрешается маркеру **Тела.**

     ![Разрешенный выход тела из триггера](./media/logic-apps-enterprise-integration-b2b/resolved-trigger-outputs-body-expression.png)

1. Для свойств **заголовков сообщений** введите любые заголовки, необходимые `headers` для действия AS2, которые описаны в содержимом, полученном триггером запроса HTTP.

   Чтобы ввести выражение, отослававшее на выходе триггера, `headers` щелкните в поле **заголовков сообщений.** После того, как появится список динамического содержимого, выберите **Expression**. В редакторе выражения введите выражение здесь и выберите **OK:**

   `triggerOutputs()['Headers']`

   Чтобы разрешить это выражение в качестве маркера, переключитесь между представлением конструктора и кодом, например:

   ![Разрешенный вывод заголовков из триггера](./media/logic-apps-enterprise-integration-b2b/resolved-trigger-outputs-headers-expression.png)

## <a name="add-response-action-for-message-receipt-notification"></a>Добавление действий «Ответ» для уведомления о получении сообщений

Чтобы уведомить торгового партнера о том, что сообщение было получено, вы можете вернуть ответ, содержащий уведомление AS2 Message Disposition (MDN) с помощью действия **Response.** Добавляя это действие сразу после действия **AS2 Decode,** если это действие не сбой, приложение логики не продолжает обработку.

1. Под действием **AS2 Decode** выберите **новый шаг.**

1. Под **выберите действие,** под полем поиска, выберите **Встроенный.** В поле поиска введите `condition`. Из списка **действий** выберите **Состояние**.

   ![Добавить действие "Условие"](./media/logic-apps-enterprise-integration-b2b/add-condition-action.png)

   Теперь появляется форма состояния, включая пути для выполнения состояния или нет.

   ![Форма состояния с путями принятия решений](./media/logic-apps-enterprise-integration-b2b/added-condition-action.png)

1. Теперь укажите условие для оценки. В поле **«Выбрать значение»** введите это выражение:

   `@body('AS2_Decode')?['AS2Message']?['MdnExpected']`

   В средней коробке убедитесь, что `is equal to`операция сравнения установлена на. В правой коробке введите значение. `Expected` Чтобы разрешить выражение в качестве этого маркера, переключитесь между представлением конструктора и кода.

   ![Форма состояния с путями принятия решений](./media/logic-apps-enterprise-integration-b2b/expression-for-evaluating-condition.png)

1. Теперь укажите ответы, чтобы вернуться ли действие **AS2 Decode** успешно или нет.

   1. В случае успеха действия **AS2 Decode** в **истинной** форме выберите **Добавить действие.** Под **Выберите действие,** в поле `response`поиска, введите, и выберите **ответ**.

      ![Найти и выбрать действие "Ответ"](./media/logic-apps-enterprise-integration-b2b/select-http-response-action.png)

   1. Чтобы получить доступ к AS2 MDN из вывода действия **AS2 Decode,** укажите следующие выражения:

      * В свойстве **заголовков** **действия «Ответ»** введите это выражение:

        `@body('AS2_Decode')?['OutgoingMdn']?['OutboundHeaders']`

      * В свойстве **тела действия** **«Ответ»** введите это выражение:

        `@body('AS2_Decode')?['OutgoingMdn']?['Content']`

   1. Чтобы разрешить выражения в качестве токенов, переключитесь между представлением конструктора и кодом:

      ![Разрешенное выражение для доступа к AS2 MDN](./media/logic-apps-enterprise-integration-b2b/response-action-success-resolved-expression.png)

   1. В случае сбоя действия **AS2 Decode** в **ложной** форме выберите **добавить действие.** Под **Выберите действие,** в поле `response`поиска, введите, и выберите **ответ**. Настройте действие **«Ответ»,** чтобы вернуть нужный статус и ошибку.

1. Сохраните приложение логики.

## <a name="add-decode-x12-message-action"></a>Добавить действие сообщения Decode X12

1. Теперь добавьте действие **сообщения Decode X12.** В соответствии с действием **«Ответ»** **выберите «Добавить действие».**

1. Под **Выберите действие,** в поле `x12 decode`поиска, введите и выберите **Сообщение Decode X12.**

   ![Найти и выбрать действие "Декодирование сообщения X12"](./media/logic-apps-enterprise-integration-b2b/add-x12-decode-action.png)

1. Если действие X12 подскажет вам информацию о связи, укажите имя соединения, выберите учетную запись интеграции, которая вы хотите использовать, а затем выберите **Создать.**

   ![Создание подключения X12 к интеграционной учетной записи](./media/logic-apps-enterprise-integration-b2b/create-x12-integration-account-connection.png)

1. Теперь укажите вход для действия X12. В этом примере используется выход из действия AS2, который является содержанием сообщения, но отмечает, что это содержимое находится в формате объекта JSON и закодировано base64. Таким образом, вы должны преобразовать это содержимое в строку.

   В **сообщении файла X12 Flat для декодирования** коробки введите это выражение для преобразования вывода AS2:

   `@base64ToString(body('AS2_Decode')?['AS2Message']?['Content'])`

    Чтобы разрешить выражение в качестве этого маркера, переключитесь между представлением конструктора и кода.

    ![Преобразование базового 64-кодированного содержимого в строку](./media/logic-apps-enterprise-integration-b2b/x12-decode-message-content.png)

1. Сохраните приложение логики.

   Если для этого приложения логики необходимы дополнительные шаги, например, для декодирования содержимого и вывода сообщений, содержимого которого в формате объекта JSON, продолжайте строить приложение логики.

Теперь вы закончили настройку приложения логики B2B. В приложении в реальном мире можно хранить декодированные данные X12 в приложении или хранилище данных line-of-business (LOB). Например, см.

* [Подключение к системам SAP из Azure Logic Apps](../logic-apps/logic-apps-using-sap-connector.md)
* [Мониторинг и создание SFTP-файлов, а также управление ими с помощью SSH и Azure Logic Apps](../connectors/connectors-sftp-ssh.md)

Чтобы подключить собственные приложения LOB и использовать эти AI в приложении логики, вы можете добавить больше действий или [написать пользовательские AI.](../logic-apps/logic-apps-create-api-app.md)

## <a name="next-steps"></a>Дальнейшие действия

* [Получение и ответ на входящие вызовы HTTPS](../connectors/connectors-native-reqres.md)
* [Обмен сообщениями AS2 для интеграции b2B предприятия](../logic-apps/logic-apps-enterprise-integration-as2.md)
* [Обмен сообщениями X12 для интеграции b2B предприятия](../logic-apps/logic-apps-enterprise-integration-x12.md)
* Узнайте больше о [пакете корпоративной интеграции](../logic-apps/logic-apps-enterprise-integration-overview.md)