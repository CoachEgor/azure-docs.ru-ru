---
title: Добавьте и вызов функций Azure из приложений логики Azure
description: Добавление и выполнение функций Azure из приложений логики
services: logic-apps
ms.service: logic-apps
ms.suite: integration
author: ecfan
ms.author: estfan
ms.topic: article
ms.date: 06/04/2019
ms.reviewer: klam, LADocs
ms.openlocfilehash: 524b927ec0966199c51cdee93e920d7b847139ae
ms.sourcegitcommit: 600d5b140dae979f029c43c033757652cddc2029
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/04/2019
ms.locfileid: "66495119"
---
# <a name="call-azure-functions-from-azure-logic-apps"></a>Вызов функций Azure из приложений логики Azure

Если вы хотите запустить код, который выполняет конкретная задача в приложениях логики, можно создать собственную функцию с помощью ["функции Azure"](../azure-functions/functions-overview.md). Эта служба поможет вам создать Node.js, C#, и F# функции, поэтому вам не нужно создавать полные приложения или инфраструктуры для выполнения кода. Также можно [вызывать приложения логики из функций](#call-logic-app). Служба "Функции Azure" обеспечивает бессерверные вычисления в облаке и является полезной при выполнении задач, приведенных ниже.

* Расширение режимов работы приложений логики с помощью функций в Node.js или C#.
* Выполнение вычислений в рабочем процессе приложения логики.
* Применение расширенных функции форматирования или вычисления полей в приложениях логики.

Для выполнения фрагментов кода без создания функции Azure, узнайте, как [Добавление и запуск встроенного кода](../logic-apps/logic-apps-add-run-inline-code.md).

> [!NOTE]
> Интеграция приложений логики и функций Azure в настоящее время не работает с слотов включена.

## <a name="prerequisites"></a>Технические условия

* Подписка Azure. Если у вас еще нет подписки Azure, [зарегистрируйтесь для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/).

* Приложения-функции Azure, который является контейнером для функций Azure, а также функции Azure. При отсутствии приложения-функции [создайте его](../azure-functions/functions-create-first-azure-function.md). Затем можно создать функции либо за пределами приложения логики на портале Azure или [из внутри своего приложения логики](#create-function-designer) в конструкторе приложений логики.

* При работе с приложениями логики, те же требования применяются для приложения-функции и функции, являются ли они существующего или нового:

  * Приложения-функции и приложения логики необходимо использовать той же подписке Azure.

  * Новые приложения-функции необходимо использовать JavaScript или .NET, как стек среды выполнения. При добавлении новой функции для существующих приложений-функций, можно выбрать либо C# или JavaScript.

  * Функция использует **триггер HTTP** шаблона.

    Этот шаблон триггера HTTP поддерживает содержимое приложения логики с типом `application/json`. При добавлении функции Azure в приложение логики, конструктор приложений логики показано пользовательских функций, которые создаются на основе этого шаблона в подписке Azure.

  * Функция не использует настраиваемые маршруты, если только вы определили [определения OpenAPI](../azure-functions/functions-openapi-definition.md) (прежнее название — [файл Swagger](https://swagger.io/)).

  * При наличии определения OpenAPI функции конструктора Logic Apps дает всестороннее взаимодействия при работы с параметрами функции. Прежде чем приложение логики сможет найти и получить доступ к функции с определениями OpenAPI, необходимо [настроить приложение-функцию, выполнив следующие действия](#function-swagger).

* Приложение логики, в которое необходимо добавить функцию, включая [триггер](../logic-apps/logic-apps-overview.md#logic-app-concepts) в качестве первого шага.

  Перед добавлением действия, выполняемые функции, приложение логики должно запускаться по триггеру. Если вы не знакомы с приложениями логики, ознакомьтесь со статьями [Что такое Azure Logic Apps](../logic-apps/logic-apps-overview.md) и [Краткое руководство. Создание первого автоматизированного рабочего процесса с помощью Azure Logic Apps на портале Azure](../logic-apps/quickstart-create-first-logic-app-workflow.md).

<a name="function-swagger"></a>

## <a name="find-functions-that-have-openapi-descriptions"></a>Поиск функций, имеющие описания OpenAPI

Для более широкие возможности при работе с параметрами функции в конструкторе приложений логики в [создавать определения OpenAPI](../azure-functions/functions-openapi-definition.md), ранее известное как [файл Swagger](https://swagger.io/), для функции. Чтобы настроить приложение-функцию, которое позволит приложению логики находить и использовать функции, которые обладают описанием Swagger, выполните следующие действия:

1. Убедитесь, что ваше приложение-функция выполняется.

1. В приложении-функции [совместное использование ресурсов независимо от источника (CORS)](https://en.wikipedia.org/wiki/Cross-origin_resource_sharing) таким образом, чтобы все источники разрешены, сделав следующее:

   1. Из **приложений-функций** выберите свое приложение-функцию. На панели справа выберите **функции платформы** > **CORS**.

      ![Выберите приложение-функция > "Функции платформы" > CORS](./media/logic-apps-azure-functions/function-platform-features-cors.png)

   1. В разделе **CORS**, добавьте символ звездочки ( **`*`** ) подстановочный знак символа, но удалить все прочие источники в списке и выберите **Сохранить**.

      ![Добавление подстановочного знака "*" в разделе CORS*](./media/logic-apps-azure-functions/function-platform-features-cors-origins.png)

## <a name="access-property-values-inside-http-requests"></a>Доступ к значениям свойств внутри HTTP-запросов

Функции веб-перехватчика могут принимать HTTP-запросы в качестве входных и передавать эти запросы другим функциям. Например, несмотря на то, что служба Logic Apps имеет [функции преобразования значений DateTime](../logic-apps/workflow-definition-language-functions-reference.md), в этом базовом примере функции JavaScript отображается доступ к свойству внутри запрашиваемого объекта, который передается функции и выполняет операции над значением свойства. Чтобы получить доступ к свойствам, которые находятся внутри объекта, в этом примере используется [оператор точка (.)](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Operators/Property_accessors).

```javascript
function convertToDateString(request, response){
   var data = request.body;
   response = {
      body: data.date.ToDateString();
   }
}
```

Ниже приведены процессы, которые выполняются внутри функции.

1. Функция создает переменную `data` и присваивает ей объект `body`, который находится внутри объекта `request`. Чтобы ссылаться на объект `body` внутри объекта `request`, функция использует оператор точку (.).

   ```javascript
   var data = request.body;
   ```

1. Теперь функция может получить доступ к свойству `date` через переменную `data` и изменить значение свойства с типа DateTime на тип DateString с помощью вызова функции `ToDateString()`. Также в ответе функции она возвращает результат через свойство `body`.

   ```javascript
   body: data.date.ToDateString();
   ```

После создания функции Azure можно выполнить шаги из раздела [Добавление существующей функций в приложения логики](#add-function-logic-app).

<a name="create-function-designer"></a>

## <a name="create-functions-inside-logic-apps"></a>Создание встроенных функций приложений логики

Перед созданием функцию Azure, начиная с внутри своего приложения логики с помощью конструктора приложений логики, сначала нужно приложения-функции Azure, который является контейнером для ваших функций. При отсутствии приложения-функции создайте его. См. статью [Создание первой функции на портале Azure](../azure-functions/functions-create-first-azure-function.md).

1. Откройте приложение логики в конструкторе приложений логики на [портале Azure](https://portal.azure.com).

1. Чтобы создать и добавить функцию, выполните шаг, который применим к вашему сценарию.

   * На последнем шаге в рабочем процессе приложения логики выберите **Новый шаг**.

   * Между имеющимися шагами в рабочем процессе приложения логики наведите указатель мыши на стрелку, выберите знак плюса (+), а затем выберите **Добавить действие**.

1. В поле поиска введите "Функции Azure" в качестве условия фильтра. В списке действий выберите действие **Choose an Azure function — Azure Functions** (Выбор функции Azure — Функции Azure).

   ![Поиск "Функции Azure"](./media/logic-apps-azure-functions/find-azure-functions-action.png)

1. Выберите приложение-функцию из списка приложений-функций. В открывшейся списке действий выберите это действие: **Функции Azure — Создание функции**

   ![Выбор приложения-функции](./media/logic-apps-azure-functions/select-function-app-create-function.png)

1. Определите функцию в редакторе определения функции.

   1. Введите имя функции в поле **Имя функции**.

   1. В **кода** , добавьте код, чтобы шаблон функции, включая ответа и полезные данные, которые вы хотите возвращается к своему приложению логики, после выполнения функции.

      ![Определение функции](./media/logic-apps-azure-functions/function-definition.png)

      В коде шаблона *объект `context`* относится к сообщению, которое приложение логики отправляет через поле **Текст запроса** на более позднем этапе. Чтобы получить доступ к свойствам объекта `context` изнутри вашей функции, используйте этот синтаксис:

      `context.body.<property-name>`

      Например, чтобы указать ссылку на свойство `content` внутри объекта `context`, используйте этот синтаксис: 

      `context.body.content`

      Код шаблона также включает переменную `input`, которая сохраняет значение из параметра `data`, чтобы ваша функция могла выполнять с ним операции. Внутри функций JavaScript переменная `data` также является ярлыком для `context.body`.

      > [!NOTE]
      > Свойство `body` здесь применяется к объекту `context` и не совпадает с токеном **Текст** из выходных данных действия, который вы также можете передать своей функции.

   1. Когда все будет готово, выберите **Создать**.

1. В поле **Текст запроса** укажите входные данные функции, которые должны быть отформатированы как объект JSON (нотация объектов JavaScript).

   Эти входные данные представляют собой *объект контекста* или сообщение, которое приложение логики отправляет в функцию. Если щелкнуть поле **Текст запроса**, откроется список динамического содержимого, что позволит выбрать токены для выходных данных с предыдущих шагов. В этом примере указано, что полезные данные контекста содержат свойство с именем `content`, которое имеет значение токена **От** из триггера электронной почты:

   ![Пример "Текста запроса": полезные данные объекта контекста](./media/logic-apps-azure-functions/function-request-body-example.png)

   Здесь объект контекста не приводится как строка, что позволяет добавить содержимое объекта напрямую в полезные данные JSON. Тем не менее, если объект контекста не является токеном JSON, который передает строку, либо объектом или массивом JSON, появится сообщение об ошибке. Таким образом, если в этом примере использовался токен **Время получения**, вы можете привести объект контекста к состоянию строки, добавив двойные кавычки:  

   ![Приведение объекта контекста к состоянию строки](./media/logic-apps-azure-functions/function-request-body-string-cast-example.png)

1. Чтобы указать другие сведения, например метод для использования заголовков запроса и параметры запроса, откройте **добавьте параметр** и выберите требуемые параметры.

<a name="add-function-logic-app"></a>

## <a name="add-existing-functions-to-logic-apps"></a>Добавление существующих функций в приложение логики

Чтобы вызвать существующие функции Azure из приложений логики, можно добавить функции Azure, например, любые другие действия в конструкторе приложений логики.

1. Откройте приложение логики в конструкторе приложений логики на [портале Azure](https://portal.azure.com).

1. В шаге, где вы хотите добавить функцию, выберите **новый шаг**и выберите **добавить действие**.

1. В поле поиска введите "Функции Azure" в качестве условия фильтра. В списке действий выберите действие **Choose an Azure function — Azure Functions** (Выбор функции Azure — Функции Azure).

   ![Поиск "Функции Azure"](./media/logic-apps-azure-functions/find-azure-functions-action.png)

1. Выберите приложение-функцию из списка приложений-функций. После появления функции выберите ее.

   ![Выберите приложение-функцию и функцию Azure](./media/logic-apps-azure-functions/select-function-app-existing-function.png)

   Для функций, которые имеют определения API (описания Swagger) и которые [настроены таким образом, чтобы приложение логики могло найти и получить к ним доступ](#function-swagger), можно выбрать **Действия Swagger**.

   ![Выбор приложения-функции, "Действия Swagger", функции Azure](./media/logic-apps-azure-functions/select-function-app-existing-function-swagger.png)

1. В поле **Текст запроса** укажите входные данные функции, которые должны быть отформатированы как объект JSON (нотация объектов JavaScript).

   Эти входные данные представляют собой *объект контекста* или сообщение, которое приложение логики отправляет в функцию. При нажатии кнопки в **текст запроса** появляется поле списка динамического содержимого, в котором можно выбрать маркер выходных данных из предыдущих шагов. В этом примере указано, что полезные данные контекста содержат свойство с именем `content`, которое имеет значение токена **От** из триггера электронной почты:

   ![Пример "Текста запроса": полезные данные объекта контекста](./media/logic-apps-azure-functions/function-request-body-example.png)

   Здесь объект контекста не приводится как строка, что позволяет добавить содержимое объекта напрямую в полезные данные JSON. Тем не менее, если объект контекста не является токеном JSON, который передает строку, либо объектом или массивом JSON, появится сообщение об ошибке. Таким образом, если в этом примере использовался токен **Время получения**, вы можете привести объект контекста к состоянию строки, добавив двойные кавычки:

   ![Приведение объекта контекста к состоянию строки](./media/logic-apps-azure-functions/function-request-body-string-cast-example.png)

1. Чтобы указать другие сведения, например метод для использования заголовков запроса и параметры запроса, откройте **добавьте параметр** и выберите требуемые параметры.

<a name="call-logic-app"></a>

## <a name="call-logic-apps-from-azure-functions"></a>Вызов приложений логики из функций Azure

Если вы хотите вызвать приложение логики изнутри функции Azure, оно должно запускаться триггером, который предоставляет вызываемую конечную точку. Например, вы можете запустить приложение логики с помощью триггера **HTTP**, **Запрос**, **Очереди Azure** или **Сетка событий**. Внутри функции отправьте HTTP-запрос POST на URL-адрес триггера и включите полезные данные, необходимые для обработки приложения логики. Дополнительные сведения см. в разделе [Вызов, активация и вложение приложений логики](../logic-apps/logic-apps-http-endpoint.md).

## <a name="next-steps"></a>Дальнейшие действия

* См. дополнительные сведения о [соединителях Logic Apps](../connectors/apis-list.md).
