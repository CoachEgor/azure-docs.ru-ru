---
title: Создание автоматизированных рабочих процессов на основе утверждений
description: Руководство по созданию автоматизированного рабочего процесса на основе утверждений для обработки подписок на список рассылки с помощью Azure Logic Apps
services: logic-apps
ms.suite: integration
ms.reviewer: logicappspm
ms.topic: tutorial
ms.custom: mvc
ms.date: 09/20/2019
ms.openlocfilehash: c802fafa92ace2260002f7156b0df9841af8338c
ms.sourcegitcommit: 3fc3457b5a6d5773323237f6a06ccfb6955bfb2d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/11/2020
ms.locfileid: "90029585"
---
# <a name="tutorial-create-automated-approval-based-workflows-by-using-azure-logic-apps"></a>Руководство по созданию автоматических рабочих процессов на основе утверждений с помощью Azure Logic Apps

В этом руководстве показано, как создать [приложение логики](../logic-apps/logic-apps-overview.md), которое автоматизирует рабочий процесс на основе утверждений. В частности, это приложение логики обрабатывает запросы на подписку на список рассылки, который управляется службой [MailChimp](https://mailchimp.com/). Это приложение логики отслеживает учетную запись электронной почты для этих запросов, отправляет их на утверждение и добавляет утвержденных участников в список рассылки.

В этом руководстве описано следующее:

> [!div class="checklist"]
>
> * Создание пустого приложения логики.
> * Добавление триггера для отслеживания сообщений электронной почты для запросов подписок.
> * Добавление действия, которое отправляет сообщения электронной почты для утверждения или отклонения этих запросов.
> * Добавление условия, которое проверяет ответ утверждения.
> * Добавление действия, которое добавляет утвержденных участников в список рассылки.
> * Добавление условия, которое проверяет, были ли участники добавлены в список.
> * Добавление действия, которое отправляет сообщения электронной почты с подтверждением того, что участники добавлены в список.

По завершении приложение логики будет выглядеть как этот высокоуровневый рабочий процесс:

![Общие сведения о высокоуровневом готовом приложении логики](./media/tutorial-process-mailing-list-subscriptions-workflow/tutorial-high-level-overview.png)

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас еще нет подписки, [подпишитесь для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/), прежде чем начинать работу.

* Учетная запись MailChimp, которая содержит список с именем test-members-ML, в который приложение логики будет добавлять адреса электронной почты утвержденных участников. Если у вас еще нет учетной записи, [зарегистрируйте бесплатную учетную запись](https://login.mailchimp.com/signup/) и узнайте, [как создать список MailChimp](https://us17.admin.mailchimp.com/lists/#).

* Учетная запись электронной почты в службе Outlook для Microsoft 365 или Outlook.com, которая поддерживает рабочие процессы утверждения. В этой статье используется Office 365 Outlook. Если используется другая учетная запись электронной почты, общие шаги остаются неизменными, однако интерфейс может выглядеть несколько иначе.

## <a name="create-your-logic-app"></a>Создание приложения логики

1. Войдите на [портал Azure](https://portal.azure.com) с помощью учетных данных учетной записи Azure.

1. В главном меню на портале Azure последовательно выберите **Создать ресурс** > **Интеграция** > **Приложение логики**.

   ![Создание ресурса приложения логики](./media/tutorial-process-mailing-list-subscriptions-workflow/create-new-logic-app-resource.png)

1. В разделе **Создание приложения логики** предоставьте сведения о приложении логики, как показано и описано. Когда все будет готово, выберите **Создать**.

   ![Предоставление сведений о приложении логики](./media/tutorial-process-mailing-list-subscriptions-workflow/create-logic-app-settings.png)

   | Свойство | Значение | Описание |
   |----------|-------|-------------|
   | **Имя** | LA-MailingList | Имя приложения логики, которое может содержать только буквы, цифры, дефисы (`-`), символы подчеркивания (`_`), круглые скобки (`(`, `)`) и точки (`.`). В этом примере используется имя LA-MailingList. |
   | **Подписка** | <*Имя вашей подписки Azure*> | Имя подписки Azure. |
   | **Группа ресурсов** | LA-MailingList-RG | Имя [группы ресурсов Azure](../azure-resource-manager/management/overview.md), используемой для упорядочения связанных ресурсов. В этом примере используется имя LA-MailingList-RG. |
   | **Расположение** | западная часть США | Регион для хранения данных приложения логики. В этом примере используется регион "Западная часть США". |
   | **Служба Log Analytics** | Выкл. | Сохраните параметр **Выкл.** для журнала ведения диагностики. |
   ||||

1. После развертывания приложения в Azure на панели инструментов Azure выберите **Уведомления** > **Перейти к ресурсу** для развернутого приложения логики.

   ![Переход к новому ресурсу приложения логики](./media/tutorial-process-mailing-list-subscriptions-workflow/go-to-logic-app-resource.png)

   Вы также можете найти и выбрать приложение логики, введя его имя в поле поиска.

   Открывается конструктор Logic Apps и отображается страница с вводным видео, а также часто используемыми триггерами и шаблонами приложений логики. В разделе **Шаблоны** выберите **Пустое приложение логики**.

   ![Выбор шаблона пустого приложения логики](./media/tutorial-process-mailing-list-subscriptions-workflow/select-logic-app-template.png)

Затем добавьте [триггер](../logic-apps/logic-apps-overview.md#logic-app-concepts), который ожидает передачи входящих сообщений электронной почты с запросами подписок. Каждое приложение логики должно запускаться по триггеру, который активируется, когда происходит определенное событие или если новые данные соответствуют заданным условиям. Дополнительные сведения см. в статье о [создании первого приложения логики](../logic-apps/quickstart-create-first-logic-app-workflow.md).

## <a name="add-trigger-to-monitor-emails"></a>Добавление триггера для отслеживания сообщений электронной почты

1. В конструкторе приложений логики в поле поиска введите `when email arrives` в качестве фильтра. Из списка **Триггеры** для поставщика услуг электронной почты выберите триггер **Когда приходит новое электронное письмо**.

   В этом примере используется триггер Office 365 Outlook.

   ![Выбор триггера "Когда приходит новое электронное письмо" для поставщика услуг электронной почты](./media/tutorial-process-mailing-list-subscriptions-workflow/add-trigger-new-email.png)

   * Для рабочих или учебных учетных записей Azure выберите Office 365 Outlook.
   * Для личных учетных записей Майкрософт выберите Outlook.com.

1. Войдите в учетную запись электронной почты, если появится соответствующий запрос, чтобы подключить эту учетную запись к Logic Apps.

1. Укажите в триггере критерии для проверки новых сообщений электронной почты.

   1. Укажите папку, интервал и частоту проверки сообщений почты.

      ![Указание папки, интервала и частоты проверки сообщений почты](./media/tutorial-process-mailing-list-subscriptions-workflow/add-trigger-set-up-email.png)

      | Свойство | Значение | Описание |
      |----------|-------|-------------|
      | **Папка** | `Inbox` | Папка электронной почты для мониторинга |
      | **Интервал** | `1` | Количество интервалов ожидания между проверками. |
      | **Частота** | `Hour` | Единица измерения времени, используемая для повторения. |
      ||||

   1. Теперь добавьте в триггер еще одно свойство, чтобы можно было выполнить фильтрацию по строке темы в сообщении электронной почты. Откройте список **Добавить новый параметр** и выберите свойство **Фильтр темы**.

      ![Добавление к триггеру свойства "Фильтр темы"](./media/tutorial-process-mailing-list-subscriptions-workflow/add-trigger-add-properties.png)

      Дополнительные сведения о свойствах этого триггера см. в [справочнике по соединителю Office 365 Outlook](/connectors/office365/) или в [справочнике по соединителю Outlook.com](/connectors/outlook/).

   1. Когда это свойство появится в триггере, введите такой текст: `subscribe-test-members-ML`.

      ![Ввод текста для свойства "Фильтр темы"](./media/tutorial-process-mailing-list-subscriptions-workflow/add-trigger-subject-filter-property.png)

1. Чтобы скрыть сведения о триггере, щелкните его заголовок.

   ![Свертывание фигуры, чтобы скрыть сведения](./media/tutorial-process-mailing-list-subscriptions-workflow/collapse-trigger-shape.png)

1. Сохраните приложение логики. На панели инструментов конструктора щелкните **Сохранить**.

Теперь приложение логики активно, но оно только проверяет входящие сообщения почты. Итак, добавим действие, отвечающее при срабатывании триггера.

## <a name="send-approval-email"></a>Отправка сообщения электронной почты с утверждением

Теперь, когда у вас есть триггер, добавьте [действие](../logic-apps/logic-apps-overview.md#logic-app-concepts), отправляющее сообщение почты для утверждения или отклонения запроса.

1. В разделе триггера щелкните **Добавить шаг**. 

1. В разделе **Выберите действие** введите фильтр `approval` в поле поиска. В списке действий выберите **Отправить письмо с запросом на утверждение** для используемого поставщика услуг электронной почты. 

   В этом примере используется действие Office 365 Outlook.

   ![Выбор действия "Отправить письмо с запросом на утверждение"](./media/tutorial-process-mailing-list-subscriptions-workflow/add-action-send-approval-email.png)

1. Предоставьте сведения об этом действии, как описано ниже. 

   ![Свойства действия "Отправить письмо с запросом на утверждение"](./media/tutorial-process-mailing-list-subscriptions-workflow/add-action-approval-email-settings.png)

   | Свойство | Значение | Описание |
   |----------|-------|-------------|
   | **Чтобы** | <*ваш адрес электронной почты*> | Адрес электронной почты утверждающего лица. В целях тестирования можно использовать свой адрес. В этом примере используется вымышленный адрес электронной почты sophia.owen@fabrikam.com. |
   | **Тема** | `Approve member request for test-members-ML` | Описательная тема сообщения |
   | **Параметры пользователя** | `Approve, Reject` | Параметры ответа, которые может выбрать утверждающее лицо. По умолчанию утверждающее лицо может выбрать варианты ответа "Утвердить" или "Отклонить". |
   ||||

   Пока не обращайте внимания на список с динамическим содержимым, который отображается по щелчку внутри некоторых полей редактирования. Этот список позволяет выбрать доступные выводы из предыдущих действий, которые можно использовать в качестве входных данных в рабочем процессе.

   Дополнительные сведения о свойствах этого действия см. в [справочнике по соединителю Office 365 Outlook](/connectors/office365/) или в [справочнике по соединителю Outlook.com](/connectors/outlook/).
 
1. Сохраните приложение логики.

Теперь добавьте условие для проверки выбранного ответа утверждающего лица.

## <a name="check-approval-response"></a>Проверка ответа утверждения

1. В разделе действия **Отправить письмо с запросом на утверждение** выберите **Новый шаг**.

1. В разделе **Выберите действие** выберите **Встроенный**. В поле поиска введите `condition` в качестве фильтра. В списке действий выберите действие **Условие**.

   ![Поиск и выбор действия "Условие"](./media/tutorial-process-mailing-list-subscriptions-workflow/select-condition-action.png)

1. Переименуйте условие, чтобы оно содержало более понятное описание.

   1. В строке заголовка условия нажмите кнопку с **многоточием** ( **…** ) и выберите **Переименовать**.

      ![Переименование описания условия](./media/tutorial-process-mailing-list-subscriptions-workflow/rename-condition-description.png)

   1. Переименуйте условие, используя описание: `If request approved`.

1. Создайте условие, которое проверяет выбор ответа **Утвердить**.

   1. Внутри условия щелкните мышью в поле **Выберите значение** слева от условия.

   1. В отобразившемся списке динамического содержимого в разделе **Отправить письмо с запросом на утверждение** выберите свойство **SelectedOption** (Выбранный вариант).

      ![Выбор SelectedOption в списке динамического содержимого](./media/tutorial-process-mailing-list-subscriptions-workflow/build-condition-check-approval-response.png)

   1. В среднем поле сравнения выберите оператор **равно**.

   1. В поле **Выбор значения** в правой части условия введите такой текст: `Approve`.

      После ввода значения условие должно выглядеть приблизительно так, как показано в примере ниже:

      ![Завершенное действие условия для примера утвержденного запроса](./media/tutorial-process-mailing-list-subscriptions-workflow/build-condition-check-approval-response-2.png)

1. Сохраните приложение логики.

Затем укажите действие для выполнения приложением логики после утверждения запроса рецензентом. 

## <a name="add-member-to-mailchimp-list"></a>Добавление участника в список MailChimp

Теперь добавьте действие, которое включает утвержденного участника в список рассылки.

1. Внутри ветви **Если истинно** условия выберите **Add an action** (Добавить действие).

1. В разделе **Выберите действие** введите `mailchimp` в качестве фильтра и выберите действие **Добавить участника в список**.

   ![Выбор действия "Добавить участника в список"](./media/tutorial-process-mailing-list-subscriptions-workflow/add-action-mailchimp-add-member.png)

1. Если появится запрос на вход в учетную запись MailChimp, введите соответствующие учетные данные.

1. Предоставьте сведения для этого действия, как показано и описано далее.

   ![Указание сведений для действия "Добавить участника в список"](./media/tutorial-process-mailing-list-subscriptions-workflow/add-action-mailchimp-add-member-settings.png)

   | Свойство | Обязательно | Значение | Описание |
   |----------|----------|-------|-------------|
   | **Идентификатор списка** | Да | `test-members-ML` | Имя для списка рассылки MailChimp. В этом примере используется test-members-ML. |
   | **Состояние** | Да | `subscribed` | Выберите состояние подписки для нового участника. В этом примере указано subscribed (подписан). <p>Дополнительные сведения см. в руководстве разработчика об [управлении подписчиками с помощью API MailChimp](https://developer.mailchimp.com/documentation/mailchimp/guides/manage-subscribers-with-the-mailchimp-api/). |
   | **Электронная почта** | Да | <*адрес электронной почты нового участника*> | В списке динамического содержимого выберите из раздела **When a new mail arrives** (Когда приходит новое электронное письмо) элемент **From** (От кого), который передает адрес электронной почты нового участника. |
   ||||

   Дополнительные сведения о свойствах этого действия см. в [справочнике по соединителю MailChimp](/connectors/mailchimp/).

1. Сохраните приложение логики.

Затем добавьте условие, чтобы можно было проверить, добавлен ли новый участник в список рассылки. Таким образом, от приложения логики вы получите уведомление о результате операции добавления участников — успешном или завершившемся сбоем.

## <a name="check-for-success-or-failure"></a>Проверка успешного или неудачного добавления участника

1. В ветви **Если истинно** в действии **Добавить участника в список** выберите **Добавить действие**.

1. В разделе **Выберите действие** выберите **Встроенный**. В поле поиска введите `condition` в качестве фильтра. В списке действий выберите **Условие**.

1. Переименуйте условие, используя описание: `If add member succeeded`.

1. Создайте условие, которое проверяет, успешно ли добавлен в список рассылки утвержденный участник:

   1. Внутри условия щелкните мышью в поле **Выберите значение**, которое находится слева от условия. В списке динамического содержимого в поле **Добавить участника в список** выберите свойство **Состояние**.

      Теперь условие выглядит как в следующем примере.

      ![Выбор параметра "Состояние" в действии "Добавить участника в список"](./media/tutorial-process-mailing-list-subscriptions-workflow/build-condition-check-added-member.png)

   1. В среднем поле сравнения выберите оператор **равно**.

   1. В поле **Выбор значения** в правой части условия введите такой текст: `subscribed`.

      После ввода значения условие должно выглядеть приблизительно так, как показано в примере ниже:

      ![Завершенное действие условия для примера подписавшегося участника](./media/tutorial-process-mailing-list-subscriptions-workflow/build-condition-check-added-member-2.png)

Далее настройте электронную почту на отправку сообщений об успешном или неудачном добавлении утвержденного участника в список рассылки.

## <a name="send-email-if-member-added"></a>Отправка уведомления по электронной почте при добавлении участника

1. В узле условия **If add member succeeded** (При успешном добавлении участника) для ветви **Если истинно** выберите **Добавить действие**.

   ![Внутри ветви "Если истинно" выберите "Добавить действие".](./media/tutorial-process-mailing-list-subscriptions-workflow/add-action-email-success.png)

1. В разделе **Выберите действие** введите фильтр `outlook send email` в поле поиска и выберите действие **Отправить сообщение электронной почты**.

   ![Добавление действия "Отправить сообщение электронной почты"](./media/tutorial-process-mailing-list-subscriptions-workflow/add-action-email-success-2.png)

1. Переименуйте действие с использованием этого описания: `Send email on success`.

1. Укажите сведения для этого действия, как показано и описано ниже.

   ![Указание необходимых сведений для успешной отправки](./media/tutorial-process-mailing-list-subscriptions-workflow/add-action-email-success-settings.png)

   | Свойство | Обязательно | Значение | Описание |
   |----------|----------|-------|-------------|
   | **Чтобы** | Да | <*ваш адрес электронной почты*> | Адрес электронной почты, на который будет отправлено сообщение об успешном выполнении операции. Для тестировании можете использовать свой собственный адрес. |
   | **Тема** | Да | <*тема сообщения об успешном выполнении операции*> | Тема сообщения об успешном выполнении операции. В рамках примеров в этом руководстве введите текст ниже: <p>`Success! Member added to "test-members-ML": ` <p>В списке динамического содержимого в поле **Добавить участника в список** выберите свойство **Адрес электронной почты**. |
   | **Текст** | Да | <*текст сообщения почты об успешном выполнении операции*> | Содержимое сообщения электронной почты об успешном выполнении операции. В рамках примеров в этом руководстве введите текст ниже: <p>`New member has joined "test-members-ML":` <p>В списке динамического содержимого выберите свойство **Адрес электронной почты**. <p>В следующей строке введите такой текст: `Member opt-in status: `. <p> В списке динамического содержимого в поле **Добавить участника в список** выберите свойство **Состояние**. |
   |||||

1. Сохраните приложение логики.

## <a name="send-email-if-member-not-added"></a>Отправка уведомления по электронной почте, если участник не был добавлен

1. В узле условия **If add member succeeded** (При успешном добавлении участника) для ветви **Если ложно** выберите **Добавить действие**.

   ![Внутри ветви "Если ложно" выберите "Добавить действие".](./media/tutorial-process-mailing-list-subscriptions-workflow/add-action-email-failed.png)

1. В разделе **Выберите действие** введите фильтр `outlook send email` в поле поиска и выберите действие **Отправить сообщение электронной почты**.

   ![Добавление действия "Отправить сообщение электронной почты"](./media/tutorial-process-mailing-list-subscriptions-workflow/add-action-email-failed-2.png)

1. Переименуйте действие с использованием этого описания: `Send email on failure`.

1. Предоставьте сведения для этого действия, как показано и описано далее.

   ![Указание сведений для отправки сообщения о том, что участник не был добавлен](./media/tutorial-process-mailing-list-subscriptions-workflow/add-action-email-failed-settings.png)

   | Свойство | Обязательно | Значение | Описание |
   |----------|----------|-------|-------------|
   | **Чтобы** | Да | <*ваш адрес электронной почты*> | Адрес электронной почты, на который будет отправлено сообщение о неудачном выполнении операции. Для тестировании можете использовать свой собственный адрес. |
   | **Тема** | Да | <*тема сообщения о неудачном выполнении операции*> | Тема сообщения о неудачном выполнении операции. В рамках примеров в этом руководстве введите текст ниже: <p>`Failed, member not added to "test-members-ML": ` <p>В списке динамического содержимого в поле **Добавить участника в список** выберите свойство **Адрес электронной почты**. |
   | **Текст** | Да | <*текст сообщения о неудачном выполнении операции*> | Содержимое сообщения электронной почты о неудачном выполнении операции. В рамках примеров в этом руководстве введите текст ниже: <p>`Member might already exist. Check your MailChimp account.` |
   |||||

1. Сохраните приложение логики. 

Затем протестируйте приложение логики, которое теперь выглядит, как показано в примере:

![Пример завершенного рабочего процесса приложения логики](./media/tutorial-process-mailing-list-subscriptions-workflow/tutorial-high-level-completed.png)

## <a name="run-your-logic-app"></a>Запуск приложения логики

1. Отправьте запрос сообщения электронной почты на присоединение к списку рассылки. Дождитесь появления запроса в папке входящих сообщений.

1. Чтобы вручную запустить приложение логики, на панели инструментов конструктора щелкните **Запустить**. 

   Если тема сообщения почты соответствует фильтру темы триггера, приложение логики отправит сообщение электронной почты для утверждения запроса подписки.

1. В сообщении утверждения выберите **Утвердить**.

1. Если адреса электронной почты подписчика нет в списке рассылки, приложение логики добавит его и отправит сообщение почты, которое будет выглядеть, как показано в примере ниже:

   ![Пример электронной почты — успешная подписка](./media/tutorial-process-mailing-list-subscriptions-workflow/add-member-mailing-list-success.png)

   Если приложение логики не добавит подписчика, вы получите сообщение, которое будет выглядеть, как показано в примере ниже:

   ![Пример электронной почты — неудачная попытка подписки](./media/tutorial-process-mailing-list-subscriptions-workflow/add-member-mailing-list-failed.png)

   Если электронные сообщения не приходят, проверьте папку нежелательной почты. Фильтр нежелательной почты может перенаправлять такие виды электронных сообщений. В противном случае, если вы не уверены, что приложение логики работает правильно, см. статью [Диагностика сбоев приложений логики](../logic-apps/logic-apps-diagnosing-failures.md).

Поздравляем! Вы создали и запустили приложение логики, интегрирующее сведения служб Azure, Майкрософт и других приложений SaaS.

## <a name="clean-up-resources"></a>Очистка ресурсов

Если этот образец приложения логики больше не нужен, удалите группу ресурсов, содержащую приложение логики и связанные ресурсы. 

1. В главном меню Azure перейдите к **группам ресурсов** и выберите группу ресурсов для приложения логики.

1. В меню группы ресурсов выберите **Обзор** > **Удалить группу ресурсов**. 

   !["Обзор > Удалить группу ресурсов"](./media/tutorial-process-mailing-list-subscriptions-workflow/delete-resource-group.png)

1. Введите имя группы ресурсов для подтверждения и нажмите кнопку **Удалить**.

## <a name="next-steps"></a>Дальнейшие действия

С помощью этого руководства вы создали приложение логики, управляющее утверждениями запросов для списка рассылки. Теперь вы можете ознакомиться с созданием приложения логики, с помощью которого можно обрабатывать и сохранять вложения электронной почты путем интеграции служб Azure, например службы хранилища Azure и функций Azure.

> [!div class="nextstepaction"]
> [Обработка сообщений электронной почты и вложений с помощью приложения логики](../logic-apps/tutorial-process-email-attachments-workflow.md)
