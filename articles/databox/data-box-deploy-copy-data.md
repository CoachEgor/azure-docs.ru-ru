---
title: Учебник по копированию данных в Azure Data Box через SMB | Документация Майкрософт
description: Узнайте, как копировать данные в Azure Data Box через SMB.
services: databox
author: alkohli
ms.service: databox
ms.subservice: pod
ms.topic: tutorial
ms.date: 09/03/2019
ms.author: alkohli
ms.localizationpriority: high
ms.openlocfilehash: 804b46cd5238c189063608d067c0b40fcd3e306d
ms.sourcegitcommit: 934776a860e4944f1a0e5e24763bfe3855bc6b60
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/20/2020
ms.locfileid: "77505668"
---
::: zone target="docs" 

# <a name="tutorial-copy-data-to-azure-data-box-via-smb"></a>Руководство по Копирование данных в Azure Data Box через SMB

::: zone-end

::: zone target="chromeless"

# <a name="copy-data-to-azure-data-box"></a>Копирование данных в Azure Data Box

::: zone-end

::: zone target="docs"

В этом руководстве объясняется, как подключиться к главному компьютеру и скопировать данные с него с помощью локального пользовательского веб-интерфейса.

В этом руководстве описано следующее:

> [!div class="checklist"]
> * Предварительные требования
> * подключение к Data Box;
> * копирование данных в Data Box;


## <a name="prerequisites"></a>Предварительные требования

Перед тем как начать, убедитесь в следующем.

1. Вы завершили работу со статьей [Руководство: присоединение кабелей и подключение к Azure Data Box](data-box-deploy-set-up.md).
2. Вы получили Data Box. Состояние заказа на портале — **Доставлено**.
3. У вас есть главный компьютер с данными, которые необходимо скопировать в Data Box. На главном компьютере должно быть следующее ПО:
    - [поддерживаемая операционная система](data-box-system-requirements.md);
    - Компьютер должен быть подключен к высокоскоростной сети. Настоятельно рекомендуем использовать хотя бы одно соединение Ethernet со скоростью передачи данных 10 Гбит/с. Если подключение 10 Гбит/с недоступно, можно использовать канал передачи данных 1 Гбит/с, но при этом скорость копирования будет снижена.

## <a name="connect-to-data-box"></a>подключение к Data Box;

В зависимости от выбранной учетной записи хранения Data Box создает указанные ниже ресурсы.
- До трех общих папок для каждой связанной учетной записи хранения (GPv1 и GPv2).
- Одна общая папка для хранилища класса Premium.
- Одна общая папка для учетной записи хранения BLOB-объектов.

В общих папках для блочных и страничных BLOB-объектов объектами первого уровня являются контейнеры, а второго — большие двоичные объекты. В общих папках для файлов Azure объекты первого уровня — общие папки, а объекты второго уровня — файлы.

В следующей таблице приведен UNC-путь к общим папкам в Data Box и URL-адрес службы хранилища Azure, куда отправляются данные. Конечный URL-адрес службы хранилища Azure может быть производным от UNC-пути к общей папке.
 
|                   |                                                            |
|-------------------|--------------------------------------------------------------------------------|
| Блочные BLOB-объекты Azure | <li>UNC-путь к общим папкам: `\\<DeviceIPAddress>\<StorageAccountName_BlockBlob>\<ContainerName>\files\a.txt`</li><li>URL-адрес службы хранилища Azure: `https://<StorageAccountName>.blob.core.windows.net/<ContainerName>/files/a.txt`</li> |  
| Страничные BLOB-объекты Azure  | <li>UNC-путь к общим папкам: `\\<DeviceIPAddres>\<StorageAccountName_PageBlob>\<ContainerName>\files\a.txt`</li><li>URL-адрес службы хранилища Azure: `https://<StorageAccountName>.blob.core.windows.net/<ContainerName>/files/a.txt`</li>   |  
| Файлы Azure       |<li>UNC-путь к общим папкам: `\\<DeviceIPAddres>\<StorageAccountName_AzFile>\<ShareName>\files\a.txt`</li><li>URL-адрес службы хранилища Azure: `https://<StorageAccountName>.file.core.windows.net/<ShareName>/files/a.txt`</li>        |      

Если вы используете главный компьютер с ОС Windows Server, для подключения к Data Box выполните указанные ниже действия.

1. В первую очередь необходимо выполнить проверку подлинности и начать сеанс. Перейдите на страницу **Подключение и копирование**. Чтобы получить учетные данные для доступа к общим папкам, связанным с вашей учетной записью хранения, щелкните **Получить учетные данные**. 

    ![Получение учетных данных для доступа к общей папке 1](media/data-box-deploy-copy-data/get-share-credentials1.png)

2. В диалоговом окне "Доступ к общей папке и копирование данных" скопируйте **имя пользователя** и **пароль**, соответствующие необходимой общей папке. Нажмите кнопку **ОК**.
    
    ![Получение учетных данных для доступа к общей папке 1](media/data-box-deploy-copy-data/get-share-credentials2.png)

3. Чтобы получить доступ к общим папкам, связанным с вашей учетной записью хранения (*devicemanagertest1* в следующем примере) на главном компьютере, откройте окно командной строки. В командной строке введите:

    `net use \\<IP address of the device>\<share name>  /u:<user name for the share>`

    В зависимости от формата ваших данных, пути к общей папке могут быть следующими:
    - Блочный BLOB-объект Azure — `\\10.126.76.172\devicemanagertest1_BlockBlob`.
    - Страничный BLOB-объект Azure — `\\10.126.76.172\devicemanagertest1_PageBlob`.
    - Файлы Azure — `\\10.126.76.172\devicemanagertest1_AzFile`.
    
4. При отображении соответствующего запроса введите пароль для общей папки. В примере ниже показан процесс подключения к общей папке с помощью указанной выше команды.

    ```
    C:\Users\Databoxuser>net use \\10.126.76.172\devicemanagertest1_BlockBlob /u:devicemanagertest1
    Enter the password for 'devicemanagertest1' to connect to '10.126.76.172':
    The command completed successfully.
    ```

4. Нажмите клавиши WINDOWS+R. В окне **Выполнить** введите `\\<device IP address>`. Нажмите кнопку **ОК**, чтобы открыть проводник.
    
    ![Подключение к общей папке с помощью проводника 2](media/data-box-deploy-copy-data/connect-shares-file-explorer1.png)

    Должны отобразиться папки, в том числе общие.
    
    ![Подключение к общей папке с помощью проводника 2](media/data-box-deploy-copy-data/connect-shares-file-explorer2.png)    

    **Всегда создавайте отдельную папку для файлов, которые вы собираетесь скопировать в общую папку**. Папка, созданная в общих папках блочных и страничных BLOB-объектов, представляет собой контейнер, куда передаются данные в виде больших двоичных объектов. Вы не можете копировать файлы напрямую в *корневую* папку в учетной записи хранения.
    
Если вы используете клиент Linux, вставьте общий ресурс SMB с помощью следующей команды. Параметр "vers" указывает версию SMB, которую поддерживает ваш узел Linux. Вставьте необходимую версию в указанную ниже команду. Версии SMB, которые поддерживает Data Box, см. в разделе [Поддерживаемые файловые системы для клиентов Linux](https://docs.microsoft.com/azure/databox/data-box-system-requirements#supported-file-systems-for-linux-clients) 

    `sudo mount -t nfs -o vers=2.1 10.126.76.172:/devicemanagertest1_BlockBlob /home/databoxubuntuhost/databox`
    


## <a name="copy-data-to-data-box"></a>копирование данных в Data Box;

После подключения к общим папкам Data Box можно скопировать данные. Прежде чем начать копирование данных, ознакомьтесь со следующими моментами.

- Убедитесь, что вы собираетесь копировать данные в общие папки, предназначенные для используемого вами формата данных. Например, данные блочного BLOB-объекта необходимо копировать в общую папку для блочных BLOB-объектов. Скопируйте файлы виртуальных жестких дисков в страничные BLOB-объекты. Если формат данных не соответствует общей папке, то на следующем этапе вам не удастся отправить данные в Azure.
-  При копировании данных убедитесь, что размер данных соответствует ограничениям на размер, указанным в статье [Ограничения Azure Data Box](data-box-limits.md).
- Если данные, отправляемые Data Box, одновременно отправляются другими приложениями за пределами Data Box, это может привести к сбоям заданий отправки и повреждению данных.
- Примите во внимание следующие рекомендации.
    - Не используйте протоколы SMB и NFS одновременно.
    - Скопируйте одни и те же данные в одно и то же конечное расположение в Azure. 
     
  В таких случаях невозможно предсказать окончательный результат.
- Всегда создавайте отдельную папку для файлов, которые вы собираетесь скопировать в общую папку. Папка, созданная в общих папках блочных и страничных BLOB-объектов, представляет собой контейнер, куда передаются данные в виде больших двоичных объектов. Вы не можете копировать файлы напрямую в *корневую* папку в учетной записи хранения.

После подключения к общей папке SMB начните копирование данных. Кроме того, для копирования данных можно использовать любое средство для копирования файлов, совместимое с протоколом SMB, например Robocopy. С помощью средства Robocopy можно запустить несколько заданий копирования. Используйте следующую команду:
    
    robocopy <Source> <Target> * /e /r:3 /w:60 /is /nfl /ndl /np /MT:32 or 64 /fft /Log+:<LogFile> 
  
 Атрибуты команды описаны в таблице ниже.
    
|attribute  |Описание  |
|---------|---------|
|/e     |Копирование подкаталогов, включая пустые каталоги.         |
|/r:     |Указание количества повторных попыток для неудавшихся копий.         |
|/w:     |Указание времени ожидания между повторными попытками в секундах.         |
|/is     |Включает одни и те же файлы.         |
|/nfl     |Указание того, что имена файлов не должны регистрироваться.         |
|/ndl    |Указание того, что имена каталогов не должны регистрироваться.        |
|/np     |Указывает, что не нужно отображать ход выполнения операции копирования (количество копируемых файлов или каталогов). Отображение хода выполнения значительно снижает производительность.         |
|/MT     | Использование многопоточности; рекомендуется использовать 32 или 64 потока. Этот параметр не используется при работе с зашифрованными файлами. Вам может потребоваться отделить зашифрованные файлы от незашифрованных. Копирование с использованием одного потока значительно снижает производительность.           |
|/fft     | Используется для уменьшения степени детализации меток времени при работе с любыми файловыми системами.        |
|/b     | Копирует файлы в режиме резервного копирования.        |
|/z    | Копирует файлы в режиме перезапуска. Используйте этот параметр, если среда нестабильна. Этот параметр уменьшает пропускную способность из-за внесения дополнительных сведений в журналы.      |
| /zb     | Использует режим перезапуска. Если доступ запрещен, то для этого параметра используется режим резервного копирования. Этот параметр уменьшает пропускную способность из-за создания контрольных точек.         |
|/efsraw     | Копирование всех зашифрованных файлов в режиме необработанных данных в файловой системе EFS. Используется только при работе с зашифрованными файлами.         |
|log+:\<LogFile>| Добавление выходных данных в существующий файл журнала.|    
 
Ниже приведен пример выходных данных команды robocopy для копирования файлов в Data Box.
    
    C:\Users>robocopy
        -------------------------------------------------------------------------------
        ROBOCOPY     ::     Robust File Copy for Windows
    -------------------------------------------------------------------------------
    
        Started : Thursday, March 8, 2018 2:34:53 PM
            Simple Usage :: ROBOCOPY source destination /MIR
    
                    source :: Source Directory (drive:\path or \\server\share\path).
            destination :: Destination Dir  (drive:\path or \\server\share\path).
                    /MIR :: Mirror a complete directory tree.
    
        For more usage information run ROBOCOPY /?    
    
    ****  /MIR can DELETE files as well as copy them !
    
    C:\Users>Robocopy C:\Git\azure-docs-pr\contributor-guide \\10.126.76.172\devicemanagertest1_AzFile\templates /MT:32
    -------------------------------------------------------------------------------
        ROBOCOPY     ::     Robust File Copy for Windows
    -------------------------------------------------------------------------------
    
        Started : Thursday, March 8, 2018 2:34:58 PM
        Source : C:\Git\azure-docs-pr\contributor-guide\
            Dest : \\10.126.76.172\devicemanagertest1_AzFile\templates\
    
        Files : *.*
    
        Options : *.* /DCOPY:DA /COPY:DAT /MT:32 /R:5 /W:60
    
    ------------------------------------------------------------------------------
    
    100%        New File                 206        C:\Git\azure-docs-pr\contributor-guide\article-metadata.md
    100%        New File                 209        C:\Git\azure-docs-pr\contributor-guide\content-channel-guidance.md
    100%        New File                 732        C:\Git\azure-docs-pr\contributor-guide\contributor-guide-index.md
    100%        New File                 199        C:\Git\azure-docs-pr\contributor-guide\contributor-guide-pr-criteria.md
                New File                 178        C:\Git\azure-docs-pr\contributor-guide\contributor-guide-pull-request-co100%  .md
                New File                 250        C:\Git\azure-docs-pr\contributor-guide\contributor-guide-pull-request-et100%  e.md
    100%        New File                 174        C:\Git\azure-docs-pr\contributor-guide\create-images-markdown.md
    100%        New File                 197        C:\Git\azure-docs-pr\contributor-guide\create-links-markdown.md
    100%        New File                 184        C:\Git\azure-docs-pr\contributor-guide\create-tables-markdown.md
    100%        New File                 208        C:\Git\azure-docs-pr\contributor-guide\custom-markdown-extensions.md
    100%        New File                 210        C:\Git\azure-docs-pr\contributor-guide\file-names-and-locations.md
    100%        New File                 234        C:\Git\azure-docs-pr\contributor-guide\git-commands-for-master.md
    100%        New File                 186        C:\Git\azure-docs-pr\contributor-guide\release-branches.md
    100%        New File                 240        C:\Git\azure-docs-pr\contributor-guide\retire-or-rename-an-article.md
    100%        New File                 215        C:\Git\azure-docs-pr\contributor-guide\style-and-voice.md
    100%        New File                 212        C:\Git\azure-docs-pr\contributor-guide\syntax-highlighting-markdown.md
    100%        New File                 207        C:\Git\azure-docs-pr\contributor-guide\tools-and-setup.md
    ------------------------------------------------------------------------------
    
                    Total    Copied   Skipped  Mismatch    FAILED    Extras
        Dirs :         1         1         1         0         0         0
        Files :        17        17         0         0         0         0
        Bytes :     3.9 k     3.9 k         0         0         0         0          
    C:\Users>
       

Чтобы оптимизировать производительность, при копировании данных используйте указанные ниже параметры robocopy.

|    Платформа    |    Главным образом малые файлы (менее 512 КБ)                           |    Главным образом файлы среднего размера (от 512 КБ до 1 МБ)                      |    Главным образом большие файлы (более 1 МБ)                             |   
|----------------|--------------------------------------------------------|--------------------------------------------------------|--------------------------------------------------------|
|    Data Box         |    2 сеанса Robocopy <br> 16 потоков на сеансы    |    3 сеанса Robocopy <br> 16 потоков на сеансы    |    2 сеанса Robocopy <br> 24 потока на сеансы    |


Дополнительные сведения о команде Robocopy см. в статье [Robocopy и несколько примеров](https://social.technet.microsoft.com/wiki/contents/articles/1073.robocopy-and-a-few-examples.aspx).

Откройте папку назначения для просмотра и проверки скопированных файлов. Если в процессе копирования возникли ошибки, скачайте файл с ошибками для устранения неполадок. Дополнительные сведения см. в разделе [Просмотр журналов ошибок во время копирования данных в Data Box](data-box-logs.md#view-error-log-during-data-copy). Подробный список ошибок во время копирования данных см. в статье об [устранении неполадок, связанных с Azure Data Box](data-box-troubleshoot.md).

Чтобы обеспечить целостность данных, при копировании данных система вычисляет их контрольные суммы. По завершении копирования проверьте использованное и свободное место на устройстве.
    
   ![Проверка свободного и использованного места на панели мониторинга](media/data-box-deploy-copy-data/verify-used-space-dashboard.png)

::: zone-end

::: zone target="chromeless"

Данные можно скопировать с исходного сервера в Data Box с помощью SMB, NFS, REST, службы копирования данных или же скопировать их на управляемые диски.

В каждом случае необходимо убедиться, что имена общих ресурсов и папок, а также объем данных соответствуют рекомендациям, приведенным в разделе об [ограничениях службы хранилища Azure и Data Box](data-box-limits.md).

## <a name="copy-data-via-smb"></a>Копирование данных по протоколу SMB

1. При использовании узла Windows подключитесь к общим папкам SMB с помощью такой команды:

    `\\<IP address of your device>\ShareName`

2. Учетные данные для доступа к общему ресурсу можно узнать на странице **Connect & copy** (Подключение и копирование) в локальном пользовательском веб-интерфейсе Data Box.
3. Для копирования данных в общие папки можно использовать любое средство копирования файлов, совместимое с протоколом SMB, например Robocopy. 

Пошаговые инструкции см. в [руководстве по копированию данных в Azure Data Box по протоколу SMB](data-box-deploy-copy-data.md).

## <a name="copy-data-via-nfs"></a>Копирование данных по протоколу NFS

1. При использовании узла NFS примените следующую команду, чтобы подключить общие папки NFS к Data Box:

    `sudo mount <Data Box device IP>:/<NFS share on Data Box device> <Path to the folder on local Linux computer>`

2. Учетные данные для доступа к общему ресурсу можно узнать на странице **Connect & copy** (Подключение и копирование) в локальном пользовательском веб-интерфейсе Data Box.
3. Используйте команду `cp` или `rsync` для копирования данных.

Пошаговые инструкции см. в [руководстве по копированию данных в Azure Data Box с помощью NFS](data-box-deploy-copy-data-via-nfs.md).

## <a name="copy-data-via-rest"></a>Копирование данных с помощью REST

1. Чтобы скопировать данные, используя хранилище BLOB-объектов службы Data Box и интерфейсы REST API, выполните подключение по протоколу *HTTP* или *HTTPS*.
2. Для копирования данных в хранилище BLOB-объектов службы Data Box можно использовать AzCopy.

Пошаговые инструкции см. в [руководстве по копированию данных в хранилище BLOB-объектов службы Azure Data Box с помощью интерфейсов REST API](data-box-deploy-copy-data-via-nfs.md).

## <a name="copy-data-via-data-copy-service"></a>Копирование данных с помощью службы копирования данных

1. Чтобы скопировать данные с помощью службы копирования данных, необходимо создать задание. В локальном пользовательском интерфейсе Data Box перейдите в раздел **Управление > Копирование данных > Создать**. 
2. Укажите параметры и создайте задание.

Пошаговые инструкции см. в [руководстве по копированию данных в Azure Data Box с помощью службы копирования данных](data-box-deploy-copy-data-via-copy-service.md).

## <a name="copy-data-to-managed-disks"></a>Копирование данных на управляемые диски

1. При заказе устройства Data Box необходимо указать управляемые диски в качестве целевого хранилища данных.
2. Вы можете подключиться к Data Box через общие папки SMB или NFS.
3. Затем можно скопировать данные с помощью средств SMB или NFS.

Пошаговые инструкции см. в [руководстве по использованию Data Box для импорта данных в качестве управляемых дисков в Azure](data-box-deploy-copy-data-from-vhds.md).

::: zone-end


::: zone target="docs"

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве были освещены следующие темы относительно Azure Data Box.

> [!div class="checklist"]
> * Предварительные требования
> * подключение к Data Box;
> * копирование данных в Data Box;


Перейдите к следующему руководству, чтобы узнать, как отправить свой Data Box обратно в корпорацию Майкрософт.

> [!div class="nextstepaction"]
> [Отправка Azure Data Box в корпорацию Майкрософт](./data-box-deploy-picked-up.md)

::: zone-end

