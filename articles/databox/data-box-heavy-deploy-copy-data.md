---
title: Руководство. Копирование данных в Azure Data Box Heavy по SMB | Документация Майкрософт
description: В этом руководстве объясняется, как установить подключение к главному компьютеру и скопировать данные с него в Azure Data Box Heavy, используя SMB и локальный пользовательский интерфейс.
services: databox
author: alkohli
ms.service: databox
ms.subservice: heavy
ms.topic: tutorial
ms.date: 08/29/2019
ms.author: alkohli
ms.localizationpriority: high
ms.openlocfilehash: 77dc64d9660f9a0bf66559c4a5a976362cf1acd0
ms.sourcegitcommit: a2d8acc1b0bf4fba90bfed9241b299dc35753ee6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/12/2020
ms.locfileid: "91951644"
---
::: zone target = "docs"

# <a name="tutorial-copy-data-to-azure-data-box-heavy-via-smb"></a>Руководство по Копирование данных в Azure Data Box Heavy через SMB

::: zone-end

::: zone target = "chromeless"

## <a name="copy-data-to-azure-data-box-heavy"></a>Копирование данных в Azure Data Box Heavy

::: zone-end

::: zone target = "docs"

В этом руководстве объясняется, как подключиться к главному компьютеру и скопировать данные с него с помощью локального пользовательского веб-интерфейса.

В этом руководстве описано следующее:

> [!div class="checklist"]
> * подключение к Azure Data Box Heavy;
> * копирование данных в Data Box Heavy.

::: zone-end

::: zone target = "chromeless"

Данные можно скопировать с исходного сервера в Data Box с помощью SMB, NFS, REST, службы копирования данных или же скопировать их на управляемые диски.

В любом случае вам нужно выбрать имена общих ресурсов и папок, а также указать объем данных в соответствии с [ограничениями службы хранилища Azure и Data Box Heavy](data-box-heavy-limits.md).

::: zone-end

::: zone target = "docs"

## <a name="prerequisites"></a>Предварительные требования

Перед тем как начать, убедитесь в следующем.

1. Вы завершили работу со статьей [Руководство: Настройка Azure Data Box Heavy](data-box-deploy-set-up.md).
2. Вы получили устройство Data Box Heavy (состояние заказа на портале — **Доставлено**).
3. У вас есть главный компьютер с данными, которые необходимо скопировать в Data Box Heavy. На главном компьютере должно быть следующее ПО:
    - [поддерживаемая операционная система](data-box-system-requirements.md);
    - Компьютер должен быть подключен к высокоскоростной сети. Чтобы ускорить копирование, можно параллельно использовать два подключения 40 GbE (по одному на каждый узел). Если у вас нет доступного подключения на 40 GbE, мы рекомендуем использовать хотя бы два подключения 10 GbE (по одному на каждый узел).
   

## <a name="connect-to-data-box-heavy-shares"></a>Подключение к Azure Data Box Heavy

В зависимости от выбранной учетной записи хранения Data Box Heavy создает перечисленные ниже ресурсы.
- До трех общих папок для каждой связанной учетной записи хранения (GPv1 и GPv2).
- Одна общая папка для хранилища класса Premium.
- Одна общая папка для учетной записи хранения BLOB-объектов.

Эти общие папки создаются на обоих узлах устройства.

В общих папках блочных и страничных BLOB-объектов:
- сущности первого уровня являются контейнерами;
- сущности второго уровня являются большими двоичными объектами.

В общих папках для Файлов Azure:
- сущности первого уровня являются общими папками;
- сущности второго уровня являются файлами.

В следующей таблице приведен UNC-путь к общим папкам в Azure Data Box Heavy и URL-адрес службы хранилища Azure, куда отправляются данные. Конечный URL-адрес службы хранилища Azure может быть производным от UNC-пути к общей папке.
 
| Память           | UNC-путь                                                                       |
|-------------------|--------------------------------------------------------------------------------|
| Блочные BLOB-объекты Azure | <li>UNC-путь к общим папкам: `\\<DeviceIPAddress>\<StorageAccountName_BlockBlob>\<ContainerName>\files\a.txt`</li><li>URL-адрес службы хранилища Azure: `https://<StorageAccountName>.blob.core.windows.net/<ContainerName>/files/a.txt`</li> |  
| Страничные BLOB-объекты Azure  | <li>UNC-путь к общим папкам: `\\<DeviceIPAddres>\<StorageAccountName_PageBlob>\<ContainerName>\files\a.txt`</li><li>URL-адрес службы хранилища Azure: `https://<StorageAccountName>.blob.core.windows.net/<ContainerName>/files/a.txt`</li>   |  
| Файлы Azure       |<li>UNC-путь к общим папкам: `\\<DeviceIPAddres>\<StorageAccountName_AzFile>\<ShareName>\files\a.txt`</li><li>URL-адрес службы хранилища Azure: `https://<StorageAccountName>.file.core.windows.net/<ShareName>/files/a.txt`</li>        |      

Инструкции по подключению с помощью клиента Windows и клиента Linux отличаются.

> [!NOTE]
> Выполните те же действия, чтобы подключиться к обоим узлам устройства в параллельном режиме.

### <a name="connect-on-a-windows-system"></a>Подключение в Windows

Если вы используете главный компьютер с Windows Server, для подключения к Data Box Heavy выполните указанные ниже действия.

1. В первую очередь необходимо выполнить проверку подлинности и начать сеанс. Перейдите на страницу **Подключение и копирование**. Чтобы получить учетные данные для доступа к общим папкам, связанным с вашей учетной записью хранения, щелкните **Получить учетные данные**.

    ![Получение учетных данных для доступа к общей папке](media/data-box-heavy-deploy-copy-data/get-share-credentials-1.png)

2. В диалоговом окне "Доступ к общей папке и копирование данных" скопируйте **имя пользователя** и **пароль**, соответствующие необходимой общей папке. Нажмите кнопку **ОК**.
    
    ![Получение учетных данных для доступа к общей папке 2](media/data-box-heavy-deploy-copy-data/get-share-credentials-2.png)

3. Чтобы получить доступ к общим папкам, связанным с вашей учетной записью хранения (*databoxe2etest* в следующем примере) на главном компьютере, откройте окно командной строки. В командной строке введите:

    `net use \\<IP address of the device>\<share name>  /u:<user name for the share>`

    В зависимости от формата ваших данных, пути к общей папке могут быть следующими:
    - Блочный BLOB-объект Azure — `\\10.100.10.100\databoxe2etest_BlockBlob`.
    - Страничный BLOB-объект Azure — `\\10.100.10.100\databoxe2etest_PageBlob`.
    - Файлы Azure — `\\10.100.10.100\databoxe2etest_AzFile`.
    
4. При отображении соответствующего запроса введите пароль для общей папки. В примере ниже показан процесс подключения к общей папке с помощью указанной выше команды.

    ```
    C:\Users\Databoxuser>net use \\10.100.10.100\databoxe2etest_BlockBlob /u:databoxe2etest
    Enter the password for 'databoxe2etest' to connect to '10.100.10.100':
    The command completed successfully.
    ```

4. Нажмите клавиши WINDOWS+R. В окне **Выполнить** введите `\\<device IP address>`. Нажмите кнопку **ОК**, чтобы открыть проводник.
    
    ![Подключение к общей папке с помощью проводника](media/data-box-heavy-deploy-copy-data/connect-shares-file-explorer-1.png)

    Должны отобразиться папки, в том числе общие.
    
    ![Подключение к общей папке с помощью проводника 2](media/data-box-heavy-deploy-copy-data/connect-shares-file-explorer-2.png)

    **Всегда создавайте отдельную папку для файлов, которые вы собираетесь скопировать в общую папку**. Папка, созданная в общих папках блочных и страничных BLOB-объектов, представляет собой контейнер, куда передаются данные в виде больших двоичных объектов. Вы не можете копировать файлы напрямую в *корневую* папку в учетной записи хранения.
    
### <a name="connect-on-a-linux-system"></a>Подключение в Linux

Если вы используете клиент Linux, вставьте общий ресурс SMB с помощью следующей команды.

```
sudo mount -t nfs -o vers=2.1 10.126.76.172:/databoxe2etest_BlockBlob /home/databoxubuntuhost/databox
```

Параметр `vers` указывает версию SMB, которую поддерживает ваш узел Linux. Вставьте необходимую версию в указанную выше команду.

Версии SMB, которые поддерживает Data Box Heavy, см. в разделе [Поддерживаемые файловые системы для клиентов Linux](data-box-heavy-system-requirements.md#supported-file-systems-for-linux-clients)

## <a name="copy-data-to-data-box-heavy"></a>копирование данных в Data Box Heavy.

После подключения к общим папкам Data Box Heavy можно скопировать данные.

### <a name="copy-considerations"></a>Рекомендации по копированию

Прежде чем начать копирование данных, ознакомьтесь со следующими моментами.

- Убедитесь, что вы собираетесь копировать данные в общие папки, предназначенные для используемого вами формата данных. Например, данные блочного BLOB-объекта необходимо копировать в общую папку для блочных BLOB-объектов. Скопируйте файлы виртуальных жестких дисков в страничные BLOB-объекты.

    Если формат данных не соответствует общей папке, то на следующем этапе вам не удастся отправить данные в Azure.
-  При копировании данных убедитесь, что размер данных не превышает [ограничения для Azure Data Box Heavy](data-box-heavy-limits.md).
- Если данные, отправляемые Data Box Heavy, одновременно отправляются другими приложениями за пределами устройства, это может привести к сбоям заданий отправки и повреждению данных.
- Примите во внимание следующие рекомендации.
    - Не используйте протоколы SMB и NFS одновременно.
    - Скопируйте одни и те же данные в одно и то же конечное расположение в Azure.
     
  В таких случаях невозможно предсказать окончательный результат.
- Всегда создавайте отдельную папку для файлов, которые вы собираетесь скопировать в общую папку. Папка, созданная в общих папках блочных и страничных BLOB-объектов, представляет собой контейнер, куда передаются данные в виде больших двоичных объектов. Вы не можете копировать файлы напрямую в *корневую* папку в учетной записи хранения.

После подключения к общей папке SMB начните копирование данных.

1. Кроме того, для копирования данных можно использовать любое средство для копирования файлов, совместимое с протоколом SMB, например Robocopy. С помощью средства Robocopy можно запустить несколько заданий копирования. Используйте следующую команду:
    
    ```
    robocopy <Source> <Target> * /e /r:3 /w:60 /is /nfl /ndl /np /MT:32 or 64 /fft /Log+:<LogFile>
    ```
    Атрибуты команды описаны в таблице ниже.
    
    |attribute  |Описание  |
    |---------|---------|
    |/e      |Копирование подкаталогов, включая пустые каталоги.         |
    |/r:     |Указание количества повторных попыток для неудавшихся копий.         |
    |/w:     |Указание времени ожидания между повторными попытками в секундах.         |
    |/is     |Включает одни и те же файлы.         |
    |/nfl    |Указание того, что имена файлов не должны регистрироваться.         |
    |/ndl    |Указание того, что имена каталогов не должны регистрироваться.        |
    |/np     |Указывает, что не нужно отображать ход выполнения операции копирования (количество копируемых файлов или каталогов). Отображение хода выполнения значительно снижает производительность.         |
    |/MT     | Использование многопоточности; рекомендуется использовать 32 или 64 потока. Этот параметр не используется при работе с зашифрованными файлами. Вам может потребоваться отделить зашифрованные файлы от незашифрованных. Копирование с использованием одного потока значительно снижает производительность.           |
    |/fft    | Используется для уменьшения степени детализации меток времени при работе с любыми файловыми системами.        |
    |/b      | Копирует файлы в режиме резервного копирования.        |
    |/z      | Копирует файлы в режиме перезапуска. Используйте этот параметр, если среда нестабильна. Этот параметр уменьшает пропускную способность из-за внесения дополнительных сведений в журналы.      |
    | /zb    | Использует режим перезапуска. Если доступ запрещен, то для этого параметра используется режим резервного копирования. Этот параметр уменьшает пропускную способность из-за создания контрольных точек.         |
    |/efsraw | Копирование всех зашифрованных файлов в режиме необработанных данных в файловой системе EFS. Используется только при работе с зашифрованными файлами.         |
    |log+:\<LogFile>| Добавление выходных данных в существующий файл журнала.|
    
 
    Ниже приведен пример выходных данных команды Robocopy для копирования файлов на диск Data Box Heavy.

    ```   
    C:\Users>Robocopy C:\Git\azure-docs-pr\contributor-guide \\10.100.10.100\devicemanagertest1_AzFile\templates /MT:24
    -------------------------------------------------------------------------------
        ROBOCOPY     ::     Robust File Copy for Windows
    -------------------------------------------------------------------------------
        Started : Thursday, April 4, 2019 2:34:58 PM
        Source : C:\Git\azure-docs-pr\contributor-guide\
        Dest : \\10.100.10.100\devicemanagertest1_AzFile\templates\
        Files : *.*
        Options : *.* /DCOPY:DA /COPY:DAT /MT:24 /R:5 /W:60
    ------------------------------------------------------------------------------
    
    100%        New File                 206        C:\Git\azure-docs-pr\contributor-guide\article-metadata.md
    100%        New File                 209        C:\Git\azure-docs-pr\contributor-guide\content-channel-guidance.md
    100%        New File                 732        C:\Git\azure-docs-pr\contributor-guide\contributor-guide-index.md
    100%        New File                 199        C:\Git\azure-docs-pr\contributor-guide\contributor-guide-pr-criteria.md
                New File                 178        C:\Git\azure-docs-pr\contributor-guide\contributor-guide-pull-request-co100%  .md
                New File                 250        C:\Git\azure-docs-pr\contributor-guide\contributor-guide-pull-request-et100%  e.md
    100%        New File                 174        C:\Git\azure-docs-pr\contributor-guide\create-images-markdown.md
    100%        New File                 197        C:\Git\azure-docs-pr\contributor-guide\create-links-markdown.md
    100%        New File                 184        C:\Git\azure-docs-pr\contributor-guide\create-tables-markdown.md
    100%        New File                 208        C:\Git\azure-docs-pr\contributor-guide\custom-markdown-extensions.md
    100%        New File                 210        C:\Git\azure-docs-pr\contributor-guide\file-names-and-locations.md
    100%        New File                 234        C:\Git\azure-docs-pr\contributor-guide\git-commands-for-master.md
    100%        New File                 186        C:\Git\azure-docs-pr\contributor-guide\release-branches.md
    100%        New File                 240        C:\Git\azure-docs-pr\contributor-guide\retire-or-rename-an-article.md
    100%        New File                 215        C:\Git\azure-docs-pr\contributor-guide\style-and-voice.md
    100%        New File                 212        C:\Git\azure-docs-pr\contributor-guide\syntax-highlighting-markdown.md
    100%        New File                 207        C:\Git\azure-docs-pr\contributor-guide\tools-and-setup.md
    ------------------------------------------------------------------------------
    
                    Total    Copied   Skipped  Mismatch    FAILED    Extras
        Dirs :         1         1         1         0         0         0
        Files :        17        17         0         0         0         0
        Bytes :     3.9 k     3.9 k         0         0         0         0          
    C:\Users>
    ```       

2. Чтобы оптимизировать производительность, при копировании данных используйте указанные ниже параметры robocopy. (Приведенные ниже значения представляют лучшие варианты.)

    | Платформа    | Главным образом малые файлы (менее 512 КБ)    | Главным образом файлы среднего размера (от 512 КБ до 1 МБ)  | Главным образом большие файлы (более 1 МБ)                             |
    |-------------|--------------------------------|----------------------------|----------------------------|
    | Data Box Heavy | 6 сеансов Robocopy <br> 24 потока на сеансы | 6 сеансов Robocopy <br> 16 потоков на сеансы | 6 сеансов Robocopy <br> 16 потоков на сеансы |


    Дополнительные сведения о команде Robocopy см. в статье [Robocopy и несколько примеров](https://social.technet.microsoft.com/wiki/contents/articles/1073.robocopy-and-a-few-examples.aspx).

3. Откройте папку назначения для просмотра и проверки скопированных файлов.

    ![Просмотр скопированных файлов](media/data-box-heavy-deploy-copy-data/view-copied-files-1.png)


4. При копировании данных:

    - проверяются имена, размеры и формат файлов в соответствии с ограничениями для хранилища и объектов Azure, а также соглашении об именовании контейнеров и файлов Azure.
    - автоматически вычисляются контрольные суммы для обеспечения целостности данных.

    Если в процессе копирования возникли ошибки, скачайте файл с ошибками для устранения неполадок. Выберите значок со стрелкой, чтобы скачать файлы с ошибками.

    ![Скачивание файлов с ошибками](media/data-box-heavy-deploy-copy-data/download-error-files.png)

    См. подробнее о [просмотре журналов ошибок во время копирования данных в Data Box Heavy](data-box-logs.md#view-error-log-during-data-copy). См. подробный список ошибок во время копирования данных в руководстве по [устранению неполадок с Azure Data Box Heavy](data-box-troubleshoot.md).

5. Открытие файла с ошибками в Блокноте Следующий файл с ошибками содержит сведения о несоответствии размера данных.

    ![Открытие файла с ошибкой](media/data-box-heavy-deploy-copy-data/open-error-file.png)
    
    Для страничного BLOB-объекта данные не должны превышать 512 байт. Удаление этих данных устраняет проблему, как показано на следующем снимке экрана.

    ![Проблема устранена](media/data-box-heavy-deploy-copy-data/error-resolved.png)

6. После завершения копирования перейдите на страницу **Просмотр панели мониторинга**. Проверьте использованное и свободное место на устройстве.
    
    ![Проверка свободного и использованного места на панели мониторинга](media/data-box-heavy-deploy-copy-data/verify-used-space-dashboard.png)

Повторите описанные выше шаги, чтобы скопировать данные на второй узел устройства.

## <a name="next-steps"></a>Дальнейшие действия

Из этого руководства вы узнали следующие сведения об Azure Data Box Heavy:

> [!div class="checklist"]
> * подключение к Azure Data Box Heavy;
> * копирование данных в Data Box Heavy.


Перейдите к следующему руководству, чтобы узнать, как отправить Data Box Heavy в Майкрософт.

> [!div class="nextstepaction"]
> [Отправка Azure Data Box Heavy в Майкрософт](./data-box-heavy-deploy-picked-up.md)

::: zone-end

::: zone target = "chromeless"

### <a name="copy-data-via-smb"></a>Копирование данных по протоколу SMB

1. При использовании узла Windows подключитесь к общим папкам SMB с помощью такой команды:

    `\\<IP address of your device>\ShareName`

2. Учетные данные для доступа к общему ресурсу можно узнать на странице **Connect & copy** (Подключение и копирование) в локальном пользовательском веб-интерфейсе Data Box.

3. Для копирования данных в общие папки можно использовать любое средство копирования файлов, совместимое с протоколом SMB, например Robocopy.

Пошаговые инструкции см. в [руководстве по копированию данных в Azure Data Box по протоколу SMB](data-box-heavy-deploy-copy-data.md).

### <a name="copy-data-via-nfs"></a>Копирование данных по протоколу NFS

1. При использовании узла NFS выполните следующую команду, чтобы подключить общие папки NFS:

    `sudo mount <Data Box device IP>:/<NFS share on Data Box device> <Path to the folder on local Linux computer>`

2. Учетные данные для доступа к общему ресурсу можно узнать на странице **Подключение и копирование** в локальном пользовательском веб-интерфейсе Data Box Heavy.
3. Используйте команду `cp` или `rsync` для копирования данных. 
4. Повторите описанные шаги, чтобы подключиться ко второму узлу Data Box Heavy и скопировать данные на него.

Пошаговые инструкции см. в [руководстве по копированию данных в Azure Data Box с помощью NFS](data-box-heavy-deploy-copy-data-via-nfs.md).

### <a name="copy-data-via-rest"></a>Копирование данных с помощью REST

1. Чтобы скопировать данные, используя хранилище BLOB-объектов службы Data Box и интерфейсы REST API, выполните подключение по протоколу *HTTP* или *HTTPS*.
2. Для копирования данных в хранилище BLOB-объектов службы Data Box можно использовать AzCopy.
3. Повторите описанные шаги, чтобы подключиться ко второму узлу Data Box Heavy и скопировать данные на него.

Пошаговые инструкции см. в [руководстве по копированию данных в хранилище BLOB-объектов службы Azure Data Box с помощью интерфейсов REST API](data-box-heavy-deploy-copy-data-via-rest.md).

### <a name="copy-data-via-data-copy-service"></a>Копирование данных с помощью службы копирования данных

1. Чтобы скопировать данные с помощью службы копирования данных, необходимо создать задание. В локальном пользовательском интерфейсе Data Box Heavy выберите **Управление > Копирование данных > Создать**.
2. Укажите параметры и создайте задание.
3. Повторите описанные шаги, чтобы подключиться ко второму узлу Data Box Heavy и скопировать данные на него.

Пошаговые инструкции см. в [руководстве по копированию данных в Azure Data Box Heavy с помощью службы копирования данных](data-box-heavy-deploy-copy-data-via-copy-service.md).

### <a name="copy-data-to-managed-disks"></a>Копирование данных на управляемые диски

1. При заказе устройства Data Box Heavy необходимо указать управляемые диски в качестве целевого хранилища данных.
2. Вы можете подключиться к Data Box Heavy через общие папки SMB или NFS.
3. Затем можно скопировать данные с помощью средств SMB или NFS.
4. Повторите описанные шаги, чтобы подключиться ко второму узлу Data Box Heavy и скопировать данные на него.

Пошаговые инструкции см. в [руководстве по использованию Data Box Heavy для импорта данных в качестве управляемых дисков в Azure](data-box-heavy-deploy-copy-data-from-vhds.md).

::: zone-end


