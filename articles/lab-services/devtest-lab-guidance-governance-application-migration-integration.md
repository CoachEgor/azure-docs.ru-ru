---
title: Миграция и интеграция приложений в Azure DevTest Labs
description: В этой статье приводятся рекомендации по управлению Azure DevTest Labs инфраструктурой в контексте миграции и интеграции приложений.
services: devtest-lab,virtual-machines,lab-services
documentationcenter: na
author: spelluru
manager: femila
ms.service: lab-services
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 11/26/2019
ms.author: spelluru
ms.reviewer: christianreddington,anthdela,juselph
ms.openlocfilehash: 14641e9096fa9366334e9f7460ae55cda0e6c2e8
ms.sourcegitcommit: f788bc6bc524516f186386376ca6651ce80f334d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/03/2020
ms.locfileid: "75644892"
---
# <a name="governance-of-azure-devtest-labs-infrastructure---application-migration-and-integration"></a>Система управления инфраструктурой Azure DevTest Labs. Миграция и интеграция приложений
После создания лабораторной среды для разработки и тестирования обдумайте следующие вопросы.

- Как проектная группа будет использовать эту среду?
- Как обеспечить соблюдение политик организации, сохраняя гибкость для повышения ценности приложения?

## <a name="azure-marketplace-images-vs-custom-images"></a>Образы Azure Marketplace и пользовательские образы

### <a name="question"></a>Вопрос
Когда мне использовать образ Azure Marketplace, а когда — пользовательский образ, созданный в компании?

### <a name="answer"></a>Ответ
По умолчанию следует использовать только образы Azure Marketplace, если у вас нет очень специфичных задач или организационных требований. Вот несколько распространенных допустимых причин для исключений:

- настолько сложный процесс установки программного обеспечения, что его лучше включать в состав базового образа;
- установка и настройка приложения занимают несколько часов, что будет неэффективной тратой вычислительного времени при развертывании образа Azure Marketplace;
- разработчикам и тест-инженерам нужен быстрый доступ к виртуальной машине и минимальные потери времени на настройку новой виртуальной машины;
- обязательные требования или нормативные условия (например, политики безопасности), которые должны строго выполняться для всех компьютеров.

Решение о применении пользовательских образов не следует принимать без серьезной оценки. Они добавляют в решение существенную сложность, вынуждая самостоятельно управлять VHD-файлами базовых образов. Также вам придется регулярно устанавливать в базовые образы исправления и обновления программного обеспечения. Это могут быть обновления операционной системы и (или) любые обновления конфигурации для основного пакета программного обеспечения.

## <a name="formula-vs-custom-image"></a>Формулы или пользовательский образ

### <a name="question"></a>Вопрос
Когда мне использовать формулу, а когда — пользовательский образ?

### <a name="answer"></a>Ответ
Решающими факторами в этом вопросе обычно будут стоимость и возможность повторного использования.

Если в вашей ситуации несколько пользователей и (или) лабораторий будут использовать образы с большим количеством дополнительного программного обеспечения, затраты на его установку можно снизить путем создания пользовательского образа. Это позволит создать нужный образ всего один раз, сокращая время настройки виртуальной машины и затраты на работу виртуальной машины в период настройки.

Но есть и другой важный фактор — частота изменений, вносимых в пакет программного обеспечения. Если вы ежедневно выполняете сборку программного продукта, который должен присутствовать на виртуальных машинах пользователей, вместо пользовательского образа лучше применить формулу.

## <a name="use-custom-organizational-images"></a>Использование корпоративных пользовательских образов

### <a name="question"></a>Вопрос
Как мне настроить легко воспроизводимый процесс, позволяющий использовать корпоративные пользовательские образы в среде DevTest Labs?

### <a name="answer"></a>Ответ
Просмотрите [видео о шаблоне "Фабрика образов"](https://blogs.msdn.microsoft.com/devtestlab/2017/04/17/video-custom-image-factory-with-azure-devtest-labs/). Это достаточно сложный сценарием, и предлагаемые для него скрипты служат только примерами для изучения. Если потребуется внести в них изменения, поддерживайте и обслуживайте специально созданные для вашей среды скрипты.

С помощью DevTest Labs создайте конвейер пользовательского образа в Azure Pipelines.

- [Introduction: Get VMs ready in minutes by setting up an image factory in Azure DevTest Labs](https://blogs.msdn.microsoft.com/devtestlab/2016/09/14/introduction-get-vms-ready-in-minutes-by-setting-up-image-factory-in-azure-devtest-labs/) (Введение: подготовьте виртуальные машины за несколько минут, настроив фабрику образов в Azure DevTest Labs)
- [Фабрика образов — часть 2! Настройка Azure Pipelines и фабричной лаборатории для создания виртуальных машин](https://blogs.msdn.microsoft.com/devtestlab/2017/10/25/image-factory-part-2-setup-vsts-to-create-vms-based-on-devtest-labs/)
- [Image Factory – Part 3: Save Custom Images and Distribute to Multiple Labs](https://blogs.msdn.microsoft.com/devtestlab/2018/01/10/image-factory-part-3-save-custom-images-and-distribute-to-multiple-labs/) (Фабрика образов, часть 3. Сохранение пользовательских образов и распространение их в несколько лабораторий)
- [Video: Custom Image Factory with Azure DevTest Labs](https://blogs.msdn.microsoft.com/devtestlab/2017/04/17/video-custom-image-factory-with-azure-devtest-labs/) (Видео. Фабрика пользовательских образов в Azure DevTest Labs)

## <a name="patterns-to-set-up-network-configuration"></a>Шаблоны для настройки конфигурации сети

### <a name="question"></a>Вопрос
Как гарантировать, что виртуальные машины для разработки и тестирования не смогут подключиться к Интернету? Существуют ли все рекомендуемые шаблоны для настройки конфигурации сети?

### <a name="answer"></a>Ответ
Да. Здесь важно учитывать два элемента — входящий и исходящий трафик.

**Входящий трафик**. Если виртуальная машина не имеет общедоступного IP-адреса, она не сможет стать доступной из Интернета. Наиболее распространенный подход — установить на уровне подписки политику, которая не позволяет пользователям создавать общедоступные IP-адреса.

**Исходящий трафик**. Если вы хотите, чтобы виртуальные машины не могли напрямую обращаться в общедоступный Интернет и генерировать трафик через корпоративный брандмауэр, вы можете локально перенаправить трафик на подключение express route или VPN с помощью принудительной маршрутизации.

> [!NOTE]
> Если в вашей сети прокси-сервер блокирует весь трафик, для которого не настроены параметры прокси, не забудьте добавить исключения для учетной записи хранения артефактов в лаборатории.

Вы также можете добавить группы безопасности сети для виртуальных машины или подсетей. Этот шаг добавит дополнительный уровень защиты, позволяющий разрешать или блокировать трафик.

## <a name="new-vs-existing-virtual-network"></a>Новая или существующая виртуальная сеть

### <a name="question"></a>Вопрос
Когда мне лучше создать новую виртуальную сеть для среды DevTest Labs, а когда — использовать существующую виртуальную сеть?

### <a name="answer"></a>Ответ
Если виртуальные машины должны взаимодействовать с существующей инфраструктурой, обычно лучше использовать существующую виртуальную сеть для среды DevTest Labs. Кроме того, если вы используете ExpressRoute, количество виртуальных сетей и подсетей лучше поддерживать минимально необходимым, чтобы не фрагментировать пространство IP-адресов для назначения подпискам. Также в этой ситуации может подойти шаблон пиринга виртуальных сетей (модель звездообразной топологии). Такой подход позволит организовать обмен данными между виртуальными сетями и (или) подсетями в определенном регионе, но пиринг между регионами для сетей Azure пока не поддерживается.

В противном случае каждой среде DevTest Labs потребуется собственная виртуальная сеть. Не забывайте при этом, что существуют [ограничения](../azure-resource-manager/management/azure-subscription-service-limits.md) на количество виртуальных сетей в одной подписке. По умолчанию действует ограничение в 50 сетей, но его можно увеличить до 100.

## <a name="shared-public-or-private-ip"></a>Общий, общедоступный или частный IP-адрес

### <a name="question"></a>Вопрос
Когда мне лучше использовать общий, общедоступный и частный IP-адреса?

### <a name="answer"></a>Ответ
Если вы используете подключение VPN или Express Route типа "сеть — сеть", лучше всего применить частные IP-адреса. Тогда ваши компьютеры будут доступны во внутренней сети, но недоступны через Интернет.

> [!NOTE]
> Владельцы лаборатории могут изменить эту политику подсетей, чтобы никто не мог случайно создать общедоступный IP-адрес для своей виртуальной машины. Владельцу подписки следует создать политику подписки, запрещающую создание общедоступных IP-адресов.

При использовании общего общедоступного IP-адреса все виртуальные машины в лаборатории совместно используют один общедоступный IP-адрес. Такой подход может оказаться полезным, если важно не превысить ограничения на количество общедоступных IP-адресов для подписки.

## <a name="limits-of-number-of-virtual-machines-per-user-or-lab"></a>Ограничения на количество виртуальных машин для пользователя или лаборатории

### <a name="question"></a>Вопрос
Существуют ли строгие количественные ограничения на количество виртуальных машин для одного пользователя или для лаборатории?

### <a name="answer"></a>Ответ
При выборе числа виртуальных машин для одного пользователя или лаборатории следует учитывать три основных критерия.

- **Общая сумма расходов** группы на ресурсы для лаборатории. Запустить несколько компьютеров очень легко. Чтобы контролировать эти расходы, можно применить ограничение на число виртуальных машин для пользователя и (или) лаборатории.
- Общее число виртуальных машин в лаборатории зависит от доступных [квот уровня подписки](../azure-resource-manager/management/azure-subscription-service-limits.md). Одно из действующих ограничений — не более 800 групп ресурсов на одну подписку. В настоящее время DevTest Labs создает для каждой виртуальной машины новую группу ресурсов (если не используются общие общедоступные IP-адреса). Если в подписке 10 лабораторий, лабораторные занятия могут разместить около 79 виртуальных машин в каждой лаборатории (800 верхний предел — 10 групп ресурсов для 10 практических занятий) = 79 виртуальных машин на лабораторию.
- Если лаборатория подключена к локальной сети через (например) Express Route, для виртуальной сети или подсети будут действовать **определенные доступные пространства IP-адресов**. Чтобы не возникало ситуаций, когда новые виртуальные машины в лаборатории не удается создать из-за ошибки ("не удается получить IP-адрес"), владельцу лаборатории следует настроить для лаборатории ограничение на максимальное количество виртуальных машин, согласованное с размером доступного пространства IP-адресов.

## <a name="use-resource-manager-templates"></a>Использование шаблонов диспетчера ресурсов

### <a name="question"></a>Вопрос
Как применить шаблоны Resource Manager в моей среде DevTest Labs?

### <a name="answer"></a>Ответ
Шаблоны Resource Manager можно развернуть в среде DevTest Labs с помощью процедуры, описанной в статье [Использование Azure DevTest Labs для виртуальных машин и тестовых сред PaaS](devtest-lab-test-env.md). Вкратце, вам нужно разместить нужные шаблоны Resource Manager в репозиторий Git (Azure Repos или GitHub) и добавить в лабораторию [частный репозиторий для шаблонов](devtest-lab-test-env.md).

Этот сценарий не имеет смысла, если вы используете DevTest Labs только для размещения компьютеров разработки, но может оказаться полезен при создании промежуточной среды, которая должна хорошо соответствовать рабочей среде.

Стоит также отметить, что ограничение на количество виртуальных машин для одной лаборатории и (или) одного пользователя влияет только на количество компьютеров, создаваемых в самой лабораторной среде, но не на созданные другими средами (как, например, шаблоны Resource Manager).

## <a name="next-steps"></a>Дальнейшие действия
См. статью [Использование Azure DevTest Labs для виртуальных машин и тестовых сред PaaS](devtest-lab-test-env.md).