---
title: Настройка параметров автоматического завершения работы для виртуальной машины в Azure DevTest Labs
description: Узнайте, как настроить параметры автоматического завершения работы для виртуальной машины, чтобы автоматически завершить работу ВИРТУАЛЬНОЙ машины, если она не используется.
services: devtest-lab,virtual-machines,lab-services
documentationcenter: na
author: spelluru
manager: femila
editor: ''
ms.assetid: ''
ms.service: lab-services
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/16/2020
ms.author: spelluru
ms.openlocfilehash: 4cca4fd4bc9cd880c5b7a75e54e8cfd8192bae1e
ms.sourcegitcommit: d29e7d0235dc9650ac2b6f2ff78a3625c491bbbf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/17/2020
ms.locfileid: "76170208"
---
# <a name="configure-autoshutdown-settings-for-a-vm-in-azure-devtest-labs"></a>Настройка параметров автоматического завершения работы для виртуальной машины в Azure DevTest Labs
Azure DevTest Labs позволяет контролировать расходы и свести к минимуму излишние траты в лабораториях с помощью управления политиками (параметрами) для каждой лаборатории. В этой статье показано, как настроить политику автоматического завершения работы для учетной записи лаборатории и настроить параметры автоматического завершения работы лаборатории в учетной записи лаборатории. Сведения о настройке всех политик лаборатории см. в статье [Управление всеми политиками лаборатории в Azure DevTest Labs](devtest-lab-set-lab-policy.md).  

## <a name="autoshutdown-policy-for-a-lab"></a>Политика автоматического завершения работы для лаборатории
Владелец лаборатории может настроить расписание завершения работы всех виртуальных машин в лаборатории. Таким образом, вы сможете сэкономить на работе компьютеров, которые не используются (в режиме простоя). Вы можете применять политику завершения работы ко всем виртуальным машинам в лаборатории централизованно, а также сократить трудозатраты ваших пользователей лаборатории, настроив расписания их индивидуальных компьютеров. Эта функция позволяет задать политику при запуске расписания лаборатории для ваших пользователей: от предложения без управления до предложения с полным управлением. В качестве владельца лаборатории, вы можете настроить эту политику, выполнив следующие действия:

1. На домашней странице лаборатории выберите функцию **Конфигурация и политики**.
2. Выберите **Политика автоматического завершения работы** в разделе **Расписания** меню слева.
3. Выберите один из способов. Следующие разделы содержат дополнительные сведения об этих вариантах. Задание политики применяется только к новым виртуальным машинам, созданным в лаборатории, но не к уже созданным виртуальным машинам. 

    ![Параметры политики автоматического выключения](./media/devtest-lab-set-lab-policy/auto-shutdown-policy-options.png)

## <a name="configure-autoshutdown-settings-for-a-lab"></a>Настройка параметров автоматического завершения работы лаборатории
Политика автоматического завершения работы помогает снизить объем отходов лаборатории, позволяя указать время завершения работы виртуальных машин лаборатории.

Чтобы просмотреть (и изменить) политики для лаборатории, выполните следующее.

1. Войдите на [портал Azure](https://portal.azure.com).
2. Щелкните **Все службы** и выберите в списке **DevTest Labs**.
3. Из списка лабораторий выберите нужную лабораторию.   
4. Выберите **Configuration and policies** (Конфигурация и политики).

    ![Область параметров политики](./media/devtest-lab-set-lab-policy/policies-menu.png)
5. В области **Конфигурация и политики** лаборатории выберите **Автоматическое завершение работы** в разделе **расписания**.
   
    ![Автоматическое завершение работы](./media/devtest-lab-set-lab-policy/auto-shutdown.png)
6. Щелкните **On** (Вкл.), чтобы включить эту политику, или **Off** (Выкл.), чтобы отключить ее.
7. Если эта политика включена, то укажите время (и часовой пояс) завершения работы всех виртуальных машин в текущей лаборатории.
8. Укажите **Да** или **нет** для отправки уведомления за 15 минут до указанного времени автоматического завершения работы. Выбрав **Да**, укажите конечную точку в виде URL-адреса веб-перехватчика, где будут публиковаться уведомления, или адрес электронной почты, на который будут отправляться такие уведомления. При получении уведомления пользователь получает возможность отложить завершение работы. Дополнительные сведения см. в разделе " [уведомления](#notifications) ". 
9. Щелкните **Сохранить**.

    По умолчанию после включения эта политика применяется ко всем виртуальным машинам в текущей лаборатории. Чтобы удалить этот параметр из определенной виртуальной машины, откройте панель управления виртуальной машины и измените параметры автоматического **завершения работы** .

## <a name="configure-autoshutdown-settings-for-a-vm"></a>Настройка параметров автоматического завершения работы для виртуальной машины

### <a name="user-sets-a-schedule-and-can-opt-out"></a>Пользователь задает расписание и может отказаться от него
Если этот параметр политики задан для лаборатории, пользователи могут переопределять или отказаться от расписания лаборатории. Этот параметр предоставляет пользователям лаборатории полный контроль над расписанием автоматического завершения работы своих виртуальных машин. Пользователи лаборатории не увидят изменений на своей странице расписания автоматического завершения работы виртуальной машины.

![Параметр политики автоматического выключения — 1](./media/devtest-lab-set-lab-policy/auto-shutdown-policy-option-1.png)

### <a name="user-sets-a-schedule-and-cannot-opt-out"></a>Пользователь задает расписание и не может отказаться от него
Если этот параметр политики задан для лаборатории, пользователи могут переопределить расписание лаборатории. Однако они не могут отказаться от политики автоматического завершения работы. Этот параметр гарантирует, что все компьютеры в лаборатории следуют расписанию автоматического завершения работы. Пользователи лаборатории могут обновить расписание автоматического завершения работы своих виртуальных машин и настроить уведомления об отключении.

![Параметр политики автоматического выключения — 2](./media/devtest-lab-set-lab-policy/auto-shutdown-policy-option-2.png)

### <a name="user-has-no-control-over-the-schedule-set-by-lab-admin"></a>Пользователь не может изменять расписание, заданное администратором лаборатории
Если этот параметр политики задан для лаборатории, пользователи не могут переопределять или отказаться от расписания лаборатории. Этот параметр дает администратору лаборатории полный контроль над расписанием каждой машины в лаборатории. Пользователи лаборатории могут задать только уведомления об автоматическом завершении работы своих виртуальных машин.

![Параметр политики автоматического выключения — 3](./media/devtest-lab-set-lab-policy/auto-shutdown-policy-option-3.png)

## <a name="notifications"></a>Уведомления
После настройки автоматического завершения работы владельцем лаборатории уведомления будут отправляться пользователям лаборатории за 15 минут до тех пор, пока автоматическое завершение работы не будет активировано, если на какой бы то ни было несколько виртуальных машин. Этот параметр дает пользователям лаборатории возможность сохранить свою работу перед завершением работы. Кроме того, в уведомлении содержатся ссылки на каждую виртуальную машину для следующих действий.

- Пропустить автозавершение в течение этого времени
- Отложить автоматическое завершение работы на час или 2 часа, чтобы они могли работать на виртуальной машине.

Уведомление отправляется через настроенную конечную точку веб-перехватчика или адрес электронной почты, указанный владельцами лаборатории в параметрах автоматического завершения работы. Веб-Перехватчики позволяют создавать или настраивать интеграции, которые подписываются на определенные события. Когда запускается одно из этих событий, DevTest Labs отправляет полезные данные HTTP POST в настроенный URL-адрес. Дополнительные сведения об объектах webhook см. в статье [Создание функции Azure объекта webhook или API](../azure-functions/functions-create-a-web-hook-or-api-function.md). 

Мы рекомендуем использовать веб-перехватчики, так как они широко поддерживаются различными приложениями (например, временной резерв, Azure Logic Apps и т. д.) и позволяют реализовать собственный способ отправки уведомлений. Пример получения уведомлений об автозавершении работы от электронных писем с помощью Azure Logic Apps см.[в статье Создание приложения логики, которое получает уведомления по электронной почте](devtest-lab-auto-shutdown.md#create-a-logic-app-that-receives-email-notifications). 


## <a name="next-steps"></a>Дальнейшие действия
См. раздел [Управление политиками автоматического завершения лабораторий в Azure DevTest Labs](devtest-lab-auto-shutdown.md)
