---
title: Напередите общую галерею изображений в Лаборатории Тест Azure (ru) Документы Майкрософт
description: Узнайте, как настроить общую галерею изображений в Azure DevTest Labs
services: devtest-lab
documentationcenter: na
author: spelluru
manager: ''
editor: ''
ms.assetid: ''
ms.service: devtest-lab
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/05/2019
ms.author: spelluru
ms.openlocfilehash: 9593d60f76802cd515ca85616bce028cf3aa0d49
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "77589323"
---
# <a name="configure-a-shared-image-gallery-in-azure-devtest-labs"></a>Настройка коллекции общих образов в Azure DevTest Labs
DevTest Labs теперь поддерживает функцию [Общей галереи изображений.](../virtual-machines/windows/shared-image-galleries.md) Это позволяет пользователям лаборатории получать доступ к изображениям из общего местоположения при создании лабораторных ресурсов. Это также поможет вам построить структуру и организацию вокруг пользовательских управляемых изображений VM. Функция «Общая галерея изображений» поддерживает:

- Управляемая глобальная репликация изображений
- Версия и группировка изображений для облегчения управления
- Сделайте изображения доступными с помощью учетных записей зон ыизбыточного хранения (ЗРС) в регионах, поддерживающих зоны доступности. ЗРС обеспечивает лучшую устойчивость к зональным сбоям.
- Обмен между подписками и даже между арендаторами с помощью элемента управления доступом на основе ролей (RBAC).

Для получения дополнительной информации смотрите [общую документацию Image Gallery](../virtual-machines/windows/shared-image-galleries.md). 
 
Если у вас есть большое количество управляемых образов, которые нужно сохранить и сделать доступными для всей компании, можно использовать коллекцию общих образов в качестве репозитория, что позволит легко обновлять и передавать образы. Как владелец лаборатории, вы можете прикрепить существующую общую галерею изображений к вашей лаборатории. После присоединения этой галереи пользователи лаборатории могут создавать машины из этих последних изображений. Ключевым преимуществом этой функции является то, что DevTest Labs теперь могут использовать преимущества совместного использования изображений в лабораториях, по подписке и в разных регионах. 

> [!NOTE]
> Чтобы узнать о расходах, связанных [Billing for Shared Image Gallery](../virtual-machines/windows/shared-image-galleries.md#billing)с службой общей галереи изображений, см.

## <a name="considerations"></a>Рекомендации
- Вы можете прикрепить только одну общую галерею изображений к лаборатории одновременно. Если вы хотите прикрепить другую галерею, вам нужно отсоединить существующую и прикрепить другую. 
- DevTest Labs в настоящее время поддерживает общие изображения галерея обобщенных изображений только.
- DevTest Labs в настоящее время не поддерживает загрузку изображений в галерею через лабораторию. 
- При создании виртуальной машины с использованием общего изображения галереи, DevTest Labs всегда использует последнюю опубликованную версию этого изображения. Однако, если изображение имеет несколько версий, пользователь может выбрать для создания машины из более ранней версии, перейдя на вкладку Расширенные настройки во время создания виртуальной машины.  
- Хотя DevTest Labs автоматически делает все возможное, чтобы общая галерея изображений реплицировала изображения в регионе, в котором существует Лаборатория, это не всегда возможно. Чтобы избежать проблем с созданием виз на этих изображениях, убедитесь, что изображения уже реплицируются в область лаборатории».

## <a name="use-azure-portal"></a>Использование портала Azure
1. Войдите на [портал Azure](https://portal.azure.com).
1. Выберите **все службы** в левом навигационном меню.
1. Выберите **DevTest Labs** из списка.
1. Из списка лабораторий выберите **лабораторию.**
1. Выберите **конфигурацию и политики** в разделе **Настройки** в левом меню.
1. Выберите **галереи общих изображений** под **базами виртуальной машины** в левом меню.

    ![Меню общих галерей изображений](./media/configure-shared-image-gallery/shared-image-galleries-menu.png)
1. Прикрепите существующую общую галерею изображений к вашей лаборатории, нажав на кнопку **Attach** и выбрав галерею в выпадающей.

    ![Attach](./media/configure-shared-image-gallery/attach-options.png)
1. Перейдите в прилагаемую галерею и наймите галерею, чтобы **включить или отключить** общие изображения для создания VM. Выберите галерею изображений из списка, чтобы настроить ее. 

    По умолчанию **разрешить использовать все изображения в качестве виртуальных баз машины, установленных** на **Yes.** Это означает, что все изображения, доступные в присоединенной общей картинной галерее, будут доступны для лабораторного пользователя при создании новой лаборатории VM. Если доступ к определенным изображениям должен быть ограничен, измените **Разрешить использовать все изображения в качестве виртуальных баз машины,** чтобы **No,** и выберите изображения, которые вы хотите разрешить при создании виртуальных машин, а затем выберите кнопку **Сохранить.**

    ![Включить или отключить](./media/configure-shared-image-gallery/enable-disable.png)
1. Затем пользователи лаборатории могут создать виртуальную машину, используя включенные изображения, нажав на **«Добавить»** и найти изображение на **выборе базовой** страницы.

    ![Пользователи лабораторий](./media/configure-shared-image-gallery/lab-users.png)
## <a name="use-azure-resource-manager-template"></a>Использование шаблона Azure Resource Manager

### <a name="attach-a-shared-image-gallery-to-your-lab"></a>Прикрепите общую галерею изображений к вашей лаборатории
Если вы используете шаблон Azure Resource Manager для прикрепления общей галереи изображений к лаборатории, необходимо добавить ее в раздел ресурсов шаблона Resource Manager, как показано в следующем примере:

```json
"resources": [
{
    "apiVersion": "2018-10-15-preview",
    "type": "Microsoft.DevTestLab/labs",
    "name": "mylab",
    "location": "eastus",
    "resources": [
    {
        "apiVersion":"2018-10-15-preview",
        "name":"myGallery",
        "type":"sharedGalleries",
        "properties": {
            "galleryId":"/subscriptions/11111111-1111-1111-1111-111111111111/resourceGroups/mySharedGalleryRg/providers/Microsoft.Compute/galleries/mySharedGallery",
            "allowAllImages": "Enabled"
        }
    }
    ]
}
```

Для полного примера шаблона управления ресурсами смотрите эти образцы шаблонов «Менеджер ресурсов» в нашем общедоступном репозитории GitHub: [Настройте общую галерею изображений при создании лаборатории.](https://github.com/Azure/azure-devtestlab/tree/master/samples/DevTestLabs/QuickStartTemplates/101-dtl-create-lab-shared-gallery-configured)

## <a name="use-api"></a>Использование API

### <a name="shared-image-galleries---create-or-update"></a>Общие галереи изображений - создание или обновление

```rest
PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.DevTestLab/labs/{labName}/sharedgalleries/{name}?api-version= 2018-10-15-preview
Body: 
{
    "properties":{
        "galleryId": "[Shared Image Gallery resource Id]",
        "allowAllImages": "Enabled"
    }
}

```

### <a name="shared-image-galleries-images---list"></a>Общие изображения Галереи Изображения - Список 

```rest
GET  https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.DevTestLab/labs/{labName}/sharedgalleries/{name}/sharedimages?api-version= 2018-10-15-preview
```




## <a name="next-steps"></a>Дальнейшие действия
Смотрите следующие статьи о создании VM с помощью изображения из прилагаемых общих изображений галерея: [Создание VM с помощью общего изображения из галереи](add-vm-use-shared-image.md)
