---
title: Интеграция сред в трубопроводы Azure в Лабораториях Azure DevTest
description: Узнайте, как интегрировать среды Azure DevTest Labs в конвейеры непрерывной интеграции Azure DevOps (CI) и непрерывной доставки (CD).
services: devtest-lab,virtual-machines,lab-services
documentationcenter: na
author: spelluru
manager: femila
ms.service: lab-services
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/16/2020
ms.author: spelluru
ms.openlocfilehash: 3d7e481879326ac30093bd116222bddc28640398
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "76169422"
---
# <a name="integrate-environments-into-your-azure-devops-cicd-pipelines"></a>Интеграция сред в конвейеры Azure DevOps CI/CD
Вы можете использовать расширение Azure DevTest Labs Tasks, которое установлено в службах Azure DevOps (ранее известное как Visual Studio Team Services) для легкой интеграции непрерывной интеграции (CI)/непрерывной доставки (CD) конвейера сборки и выпуска с Azure DevTest Labs. Эти расширения упрощают быстрое развертывание [среды](devtest-lab-test-env.md) для конкретной тестовой задачи, а затем удаляют ее по завершении теста. 

В этой статье показано, как создать и развернуть среду, а затем удалить среду, все в одном завершенном конвейере. Обычно каждую из этих задач вывыполняется индивидуально в своем собственном конвейере сборки-тестирования. Расширения, используемые в этой статье, являются дополнением к этим [задачам создания/удаления DTL VM:](devtest-lab-integrate-ci-cd-vsts.md)

- Создание среда
- Удаление среды

## <a name="before-you-begin"></a>Перед началом
Прежде чем интегрировать конвейер CI/CD с Azure DevTest Labs, установите расширение [задач Azure DevTest Labs](https://marketplace.visualstudio.com/items?itemName=ms-azuredevtestlabs.tasks) из Visual Studio Marketplace. 

## <a name="create-and-configure-the-lab-for-environments"></a>Создание и настройка лаборатории для сред
В этом разделе описывается, как создать и настроить лабораторию, в которой будет развернута среда Azure.

1. [Создайте лабораторию,](devtest-lab-create-lab.md) если у вас ее еще нет. 
2. Нанастройка лаборатории и создание шаблона среды, следуя инструкциям из этой статьи: [Создание мульти-VM-сред и ресурсов PaaS с шаблонами Azure Resource Manager.](devtest-lab-create-environment-from-arm.md)
3. В этом примере используйте существующий [https://azure.microsoft.com/resources/templates/201-web-app-redis-cache-sql-database/](https://azure.microsoft.com/resources/templates/201-web-app-redis-cache-sql-database/)шаблон Azure quickstart.
4. Скопируйте папку **201-web-app-redis-cache-sql-базы данных** в папку **ArmTemplate** в репозитории, настроенном на шаг 2.

## <a name="create-a-release-definition"></a>Создание определения выпуска
Чтобы создать определение выпуска, сделайте следующее:

1.  На вкладке **«Релизы»** **концентратора «Сборка & выпуск»** выберите кнопку **«плюс знак» (кв. м).**
2.  В окне **Создание определения выпуска** выберите шаблон **Пустой**, а затем нажмите кнопку **Далее**.
3.  Выберите **Выбрать позже**, а потом щелкните **Создать**, чтобы создать определение выпуска с одной средой по умолчанию без связанных артефактов.
4.  Чтобы открыть меню ярлыка, в новом определении релиза выберите **эллипсис (...)** рядом с именем среды, а затем выберите **переменные настройки.**
5.  В окне **настройки среды** введите следующие значения переменных, используемых в задачах определения выпуска:
1.  Для **администратораLogin**введите имя входа администратора S'L.
2.  Для **администратораLoginPassword**введите пароль, который будет использоваться логином администратора S'L. Используйте значок "замка" для скрытия и защиты пароля.
3.  Для **того, чтобы унасить базу данных,** введите имя базы данных S'L.
4.  Эти переменные специфичны для примерных сред, различные среды могут иметь различные переменные.

## <a name="create-an-environment"></a>Создание среды
Следующим этапом развертывания является создание среды, которая будет использоваться для целей разработки или тестирования.

1. В определении выпуска выберите **Добавить задачи**.
2. На вкладке **«Задачи»** добавьте задачу Azure DevTest Labs «Создать задачу среды». Настройте задачу следующим образом.
    1. В поле **Подписка на AzureRM** выберите подключение в списке **Доступные подключения к службе Azure** или создайте подключение с ограниченными разрешениями к вашей подписке Azure. Дополнительные сведения см. в разделе о [конечной точке службы Azure Resource Manager](/azure/devops/pipelines/library/service-endpoints).
2. Для **названия лаборатории**выберите название экземпляра, созданного ранее.
3. Для **имени репозитория**выберите репозиторий, в котором шаблон менеджера ресурсов (201) был перемещен в шаблон.
4. Для **названия шаблона**выберите имя среды, сохраненной в репозитории исходного кода. 
5. Название **лаборатории, название репозитория**и **название шаблона** являются дружественными представлениями идентипов ресурса Azure. **Lab Name** Ручное ввод дружественного имени вызовет сбои, используйте списки выпадающих для выбора информации.
6. Для **названия среды,** введите имя, чтобы однозначно определить экземпляр среды в лаборатории.  Он должен быть уникальным в лаборатории.
7. **Параметр файл** и **параметры**, позволяют пользовательские параметры, которые будут переданы в окружающую среду. Либо, либо оба могут быть использованы для установки значений параметров. В этом примере будет использоваться раздел Параметры. Используйте имена переменных, которые вы определили в среде, например:`-administratorLogin "$(administratorLogin)" -administratorLoginPassword "$(administratorLoginPassword)" -databaseName "$(databaseName)" -cacheSKUCapacity 1`
8. Информация в шаблоне среды может быть передана в разделе вывода шаблона. Проверьте **создание выходных переменных на основе вывода шаблона среды,** чтобы другие задачи могли использовать данные. `$(Reference name.Output Name)`является шаблоном для подражания. Например, если эталонное имя было DTL и имя вывода `$(DTL.location)`в шаблоне было расположение переменной будет .

## <a name="delete-the-environment"></a>Удаление среды
Заключительным этапом является удаление среды, развернутой в экземпляре Azure DevTest Labs. Обычно вы удаляете среду после выполнения задач dev или выполняете тесты, необходимые на развернутых ресурсах.

В определении релиза выберите **«Добавить задачи»,** а затем на вкладке **«Развертывание»,** добавьте задачу **удаления среды Лабораторий Azure DevTest.** Настройте его следующим образом.

1. Чтобы удалить VM, см [Azure DevTest Labs Задачи:](https://marketplace.visualstudio.com/items?itemName=ms-azuredevtestlabs.tasks)
    1. В поле **Подписка на AzureRM** выберите подключение в списке **Доступные подключения к службе Azure** или создайте подключение с ограниченными разрешениями к вашей подписке Azure. Дополнительные сведения см. в разделе о [конечной точке службы Azure Resource Manager](/azure/devops/pipelines/library/service-endpoints).
    2. Для **названия лаборатории**выберите лабораторию, в которой существует среда.
    3. Для **названия среды**введите имя среды, которая будет удалена.
2. Введите имя для определения выпуска и сохраните его.

## <a name="next-steps"></a>Дальнейшие действия
См. следующие статьи: 
- [Создавайте мульти-VM-среды с помощью шаблонов Resource Manager.](devtest-lab-create-environment-from-arm.md)
- Шаблоны менеджера ресурсов для автоматизации DevTest Labs из [репозитория DevTest Labs GitHub.](https://github.com/Azure/azure-quickstart-templates)
- [Страница устранения неполадок VSTS](/azure/devops/pipelines/troubleshooting)

