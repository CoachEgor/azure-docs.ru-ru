---
title: Использование лабораторий Azure DevTest в нескольких лабораториях и подписках
description: Узнайте, как сообщить об использовании Лабораторий Azure DevTest в нескольких лабораториях и подписках.
services: devtest-lab,virtual-machines,lab-services
documentationcenter: na
author: tanmayeekamath
manager: femila
editor: ''
ms.service: lab-services
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/16/2020
ms.author: takamath
ms.openlocfilehash: 912f510f6380c0ba1eb92b7c485091801123558e
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "76169178"
---
# <a name="report-azure-devtest-labs-usage-across-multiple-labs-and-subscriptions"></a>Сообщить об использовании Лабораторий Azure DevTest в нескольких лабораториях и подписках

Большинство крупных организаций хотят отслеживать использование ресурсов, чтобы быть более эффективными с этими ресурсами, визуализируя тенденции и выбросы в использовании. Основываясь на использовании ресурсов, владельцы лабораторий или менеджеры могут настроить лаборатории для [улучшения использования ресурсов и затрат.](https://docs.microsoft.com/azure/billing/billing-getting-started) В Лабораториях Azure DevTest можно загрузить использование ресурсов в лаборатории, что позволяет глубже заглянуть в шаблоны использования. Эти шаблоны использования могут помочь определить изменения для повышения эффективности. Большинство предприятий хотят как индивидуального использования лаборатории и общего использования в [нескольких лабораториях и подписки.](https://docs.microsoft.com/azure/architecture/cloud-adoption/decision-guides/subscriptions/) 

В этой статье рассматривается способ обработки информации об использовании ресурсов в нескольких лабораториях и подписках.

![Отчеты об использовании](./media/report-usage-across-multiple-labs-subscriptions/report-usage.png)

## <a name="individual-lab-usage"></a>Индивидуальное использование лаборатории

В этом разделе обсуждается, как экспортировать использование ресурсов для одной лаборатории.

Прежде чем экспортировать использование ресурсов DevTest Labs, необходимо настроить учетную запись хранения данных Azure Storage, чтобы можно было хранить различные файлы, содержащие данные об использовании. Существует два общих способа выполнения экспорта данных:

* [DevTest Labs REST API](https://docs.microsoft.com/rest/api/dtl/labs/exportresourceusage) 
* Модуль PowerShell Az.Resource [Вызывает-AzResourceAction](https://docs.microsoft.com/powershell/module/az.resources/invoke-azresourceaction?view=azps-2.5.0&viewFallbackFrom=azps-2.3.2) с действием идентификатора лабораторного `exportResourceUsage`ресурса и необходимыми параметрами. 

    Статья [об экспорте или удалении персональных данных](personal-data-delete-export.md) содержит образец сценария PowerShell с подробной информацией о данных, которые экспортируются. 

    > [!NOTE]
    > Параметр даты не включает отметку времени, поэтому данные включают все начиная с полуночи в зависимости от часового пояса, в котором находится лаборатория.

Как только экспорт завершен, будет несколько файлов CSV в хранилище капли с различной информацией о ресурсах.
  
В настоящее время существует два файла CSV:

* *virtualmachines.csv* - содержит информацию о виртуальных машинах в лаборатории
* *disks.csv* - содержит информацию о различных дисках в лаборатории 

Эти файлы хранятся в контейнере *labresourceuse* blob под лабораторным названием, уникальным идентификатором Lab, выполненной датой и полной или датой начала, которая была основана на запросе на экспорт. Примером структуры blob будет:

* `labresourceusage/labname/1111aaaa-bbbb-cccc-dddd-2222eeee/<End>DD26-MM6-2019YYYY/full/virtualmachines.csv`
* `labresourceusage/labname/1111aaaa-bbbb-cccc-dddd-2222eeee/<End>DD-MM-YYYY/26-6-2019/20-6-2019<Start>DD-MM-YYYY/virtualmachines.csv`

## <a name="exporting-usage-for-all-labs"></a>Экспорт использования для всех лабораторий

Для экспорта информации об использовании для нескольких лабораторий следует использовать 

* [Функции Azure,](https://docs.microsoft.com/azure/azure-functions/)доступные на многих языках, включая PowerShell, или 
* Для записи экспортного кода [используйте](https://docs.microsoft.com/azure/automation/)powerShell, Python или специального графического дизайнера.

Используя эти технологии, вы можете выполнить отдельные лабораторные экспорта на всех лабораториях в определенные даты и времени. 

Функция Azure должна довести данные до долгосрочного хранения. При экспорте данных для нескольких лабораторий экспорт может занять некоторое время. Чтобы помочь с производительностью и уменьшить возможность дублирования информации, мы рекомендуем выполнять каждую лабораторию параллельно. Чтобы достичь параллелизма, выполняй функции Azure асинхронно. Также воспользуйтесь триггером таймера, который предлагает Azure Functions.

## <a name="using-a-long-term-storage"></a>Использование долгосрочного хранения

Долгосрочное хранилище объединяет экспортную информацию из различных лабораторий в единый источник данных. Еще одним преимуществом использования долгосрочного хранилища является возможность удаления файлов из учетной записи хранилища для снижения дублирования и затрат. 

Долгосрочное хранение может быть использовано для любых манипуляций с текстом, например: 

* добавление дружественных имен
* создание сложных групп
* агрегирование данных.

Некоторые общие решения для хранения данных: [Сервер S'L,](https://azure.microsoft.com/services/sql-database/) [Озеро данных Azure](https://azure.microsoft.com/services/storage/data-lake-storage/)и [Cosmos DB.](https://azure.microsoft.com/services/cosmos-db/) Выбор решения для долгосрочного хранения данных зависит от предпочтений. Можно выбрать инструмент в зависимости от того, что он предлагает с точки зрения доступности взаимодействия при визуализации данных.

## <a name="visualizing-data-and-gathering-insights"></a>Визуализация данных и сбор аналитических данных

Используйте инструмент визуализации данных по вашему выбору для подключения к долгосрочному хранилищу для отображения данных об использовании и сбора информации для проверки эффективности использования. Например, [Power BI](https://docs.microsoft.com/power-bi/power-bi-overview) можно использовать для организации и отображения данных об использовании. 

Для создания, связывания и управления ресурсами в одном интерфейсе местоположения можно использовать [фабрику данных Azure.](https://azure.microsoft.com/services/data-factory/) При необходимости усиления контроля отдельный ресурс может быть создан в рамках единой группы ресурсов и управляться независимо от службы Data Factory.  

## <a name="next-steps"></a>Next Steps

После настройки системы и перехода данных к долгосрочному хранению следующим шагом будет решение вопросов, на которые необходимо ответить на вопросы. Пример: 

-   Что такое использование размера VM?

    Выбирают ли пользователи высокопроизводительные (более дорогие) размеры VM?
-   Какие изображения Marketplace используются?

    Являются ли пользовательские изображения наиболее распространенной базой VM, если будет построен общий магазин изображений, как [Общая галерея изображений](../virtual-machines/windows/shared-image-galleries.md) или [фабрика изображений.](image-factory-create.md)
-   Какие пользовательские изображения используются или не используются?
