---
title: Архитектура корпоративных ссылок для лабораторий Azure DevTest
description: В этой статье содержатся рекомендации по архитектуре для Лабораторий Azure DevTest на предприятии.
services: devtest-lab,virtual-machines,lab-services
documentationcenter: na
author: spelluru
manager: femila
ms.service: lab-services
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/12/2019
ms.author: spelluru
ms.reviewer: christianreddington,anthdela,juselph
ms.openlocfilehash: 77e6ab588f74c8b810f211e069c1c24043155111
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "77132851"
---
# <a name="azure-devtest-labs-reference-architecture-for-enterprises"></a>Архитектура Azure DevTest Labs для предприятий
В этой статье содержится эталонная архитектура, которая поможет развернуть решение, основанное на Лабораториях Azure DevTest, на предприятии. Она включает в себя следующее:
- Подключение на территории через Azure ExpressRoute
- Удаленный рабочий стол для удаленного ввоза в виртуальные машины
- Подключение к репозиторию артефактов для частных артефактов
- Другие службы PaaS, используемые в лабораториях

![Диаграмма эталонной архитектуры](./media/devtest-lab-reference-architecture/reference-architecture.png)

## <a name="architecture"></a>Architecture
Вот ключевые элементы эталонной архитектуры:

- **Активный каталог Azure (Azure AD)**: DevTest Labs использует [службу Azure AD для управления идентификационными данных.](../active-directory/fundamentals/active-directory-whatis.md) Рассмотрим эти два ключевых аспекта, когда вы даете пользователям доступ к среде, основанной на DevTest Labs:
    - **Управление ресурсами:** Он обеспечивает доступ к порталу Azure для управления ресурсами (создание виртуальных машин; создание сред; запуск, остановка, перезапуск, удаление и применение артефактов; и так далее). Управление ресурсами осуществляется в Azure с помощью ролевой системы управления доступом (RBAC). Вы назначаете роли пользователям и устанавливаете разрешения на уровне ресурсов и доступа.
    - **Виртуальные машины (сетевой уровень):** В конфигурации по умолчанию виртуальные машины используют локальную учетную запись админ. Если есть домен[(Azure AD Domain Services,](../active-directory-domain-services/overview.md)домен на основе помещения или облачный домен), машины могут быть соединены с доменом. Пользователи могут использовать свои доменные идентификаторы для подключения к вдовым мысам.
- **На месте подключения**: В нашей архитектуре диаграммы, [ExpressRoute](../expressroute/expressroute-introduction.md) используется. Но вы также можете использовать [сайт на сайт VPN](../vpn-gateway/vpn-gateway-about-vpn-gateway-settings.md). Хотя ExpressRoute не требуется для DevTest Labs, он широко используется на предприятиях. ExpressRoute требуется только при необходимости доступа к корпоративным ресурсам. Общие сценарии:
    - У вас есть данные, которые не могут быть перемещены в облако.
    - Вы предпочитаете присоединиться к виртуальным машинам лаборатории к предварительному домену.
    - Вы хотите заставить весь сетевой трафик в облачную среду и выйти из нее с помощью предварительного брандмауэра для обеспечения безопасности/соответствия.
- **Группы сетевой безопасности**: Общий способ ограничения трафика в облачную среду (или в облачную среду) на основе IP-адресов источника и назначения — это использование [группы сетевой безопасности.](../virtual-network/security-overview.md) Например, требуется разрешить только трафик, который исходит от корпоративной сети, в сети лаборатории.
- **Удаленный настольный шлюз**: Предприятия обычно блокируют исходящие удаленные соединения рабочего стола в корпоративном брандмауэре. Существует несколько вариантов, позволяющих подключение к облачной среде в DevTest Labs, включая:
  - Используйте [удаленный шлюз рабочего стола](/windows-server/remote/remote-desktop-services/desktop-hosting-logical-architecture)и позвольте статическому IP-адресу балансиватель загрузки шлюза.
  - [Направьте весь входящий трафик RDP](../vpn-gateway/vpn-gateway-forced-tunneling-rm.md) через VPN-соединение ExpressRoute/от сайта к сайту. Эта функциональность является общим соображением, когда предприятия планируют развертывание DevTest Labs.
- **Сетевые службы (виртуальные сети, подсети):** топология [сетей Azure](../networking/networking-overview.md) является еще одним ключевым элементом архитектуры DevTest Labs. Он контролирует, могут ли ресурсы лаборатории общаться и иметь доступ к помещениям и Интернету. Наша архитектурная диаграмма включает в себя наиболее распространенные способы, которыми клиенты используют DevTest Labs: все лаборатории подключаются через [виртуальную сеть пиринга](../virtual-network/virtual-network-peering-overview.md) с помощью [модели hub-spoke](/azure/architecture/reference-architectures/hybrid-networking/hub-spoke) к VPN-соединению ExpressRoute/site-to-site к наместникам. Но DevTest Labs использует виртуальную сеть Azure напрямую, поэтому нет никаких ограничений на настройку сетевой инфраструктуры.
- **DevTest Labs**: DevTest Labs является ключевой частью общей архитектуры. Чтобы узнать больше об услуге, смотрите [о DevTest Labs](devtest-lab-overview.md).
- **Виртуальные машины и другие ресурсы (SaaS, PaaS, IaaS)**: Виртуальные машины являются ключевой рабочей нагрузкой, которую DevTest Labs поддерживает вместе с другими ресурсами Azure. DevTest Labs упрощает и быстро предоставляет предприятию доступ к ресурсам Azure (включая vMs и другие ресурсы Azure). Узнайте больше о доступе к Azure для [разработчиков](devtest-lab-developer-lab.md) и [тестеров.](devtest-lab-test-env.md)

## <a name="scalability-considerations"></a>Вопросы масштабируемости
Хотя DevTest Labs не имеет встроенных квот или ограничений, другие ресурсы Azure, которые используются в обычной работе лаборатории, имеют [квоты уровня подписки.](../azure-resource-manager/management/azure-subscription-service-limits.md) Таким образом, в типичном развертывании предприятия требуется несколько подписок Azure, чтобы охватить большое развертывание DevTest Labs. Квоты, которые предприятия чаще всего достигают:

- **Группы ресурсов**: В конфигурации по умолчанию DevTest Labs создает группу ресурсов для каждой новой виртуальной машины, или пользователь создает среду с помощью службы. Подписка может содержать [до 980 групп ресурсов.](../azure-resource-manager/management/azure-subscription-service-limits.md#subscription-limits) Таким образом, это предел виртуальных машин и сред в подписке. Есть две другие конфигурации, которые следует учитывать:
    - **[Все виртуальные машины переходят в одну и ту же группу ресурсов:](resource-group-control.md)** Хотя эта настройка помогает удовлетворить лимит группы ресурсов, она влияет на ограничение группы ресурсов.
    - **Использование общих общедоступных ИП:** Все вм- и т.д. одинакового размера и региона переходят в одну и ту же группу ресурсов. Эта конфигурация является «средней площадкой» между квотами группы ресурсов и квотами группы ресурсов на ресурсную группу, если виртуальным машинам разрешено иметь общедоступные IP-адреса.
- **Ресурсы на группу ресурсов в типе ресурса**: Предел по умолчанию для [ресурсов на группу ресурсов на тип ресурса составляет 800.](../azure-resource-manager/management/azure-subscription-service-limits.md#resource-group-limits)  При использовании *всех ВМ перейти на ту же* конфигурацию группы ресурсов, пользователи попали в эту подписку предел гораздо раньше, особенно если VMs есть много дополнительных дисков.
- **Учетные записи хранения:** Лаборатория в DevTest Labs поставляется с учетной записью хранения. Квота Azure для [количества учетных записей хранилища в регионе на подписку составляет 250.](../azure-resource-manager/management/azure-subscription-service-limits.md#storage-limits) Максимальное количество лабораторий DevTest в том же регионе также составляет 250.
- **Назначения ролей:** назначение ролей — это то, как вы даете пользователю или основному доступу к ресурсу (владелец, ресурс, уровень разрешения). В Azure существует ограничение в [2000 ролевых заданий за подписку.](../azure-resource-manager/management/azure-subscription-service-limits.md#role-based-access-control-limits) По умолчанию служба DevTest Labs создает группу ресурсов для каждого VM. Владельцу предоставляется разрешение *владельца* на DevTest Labs VM и разрешение *читателя* ресурсной группе. Таким образом, каждый новый VM, который вы создаете, использует два назначения ролей в дополнение к назначениям, которые используются при предоставлении пользователям разрешения в лабораторию.
- **API читает/пишет:** Существуют различные способы автоматизации лабораторий Azure и DevTest, включая REST API, PowerShell, Azure CLI и Azure SDK. Благодаря автоматизации вы можете нанести еще один лимит на запросы API: каждая подписка позволяет до [12 000 запросов на чтение и 1200 запросов](../azure-resource-manager/management/request-limits-and-throttling.md)на запись в час. Будьте в курсе этого предела при автоматизации DevTest Labs.

## <a name="manageability-considerations"></a>Вопросы управляемости
DevTest Labs имеет отличный административный пользовательский интерфейс для работы с одной лабораторией. Но на предприятии у вас, вероятно, есть несколько подписок Azure и множество лабораторий. Постоянное внесение изменений во все лаборатории требует создания сценариев/автоматизации. Ниже приведены некоторые примеры и лучшие методы управления для развертывания DevTest Labs:

- **Изменения в настройках лаборатории:** Общим сценарием является обновление определенной настройки лаборатории во всех лабораториях развертывания. Например, доступен новый размер экземпляра VM, и для этого необходимо обновить все лаборатории. Лучше всего автоматизировать эти изменения с помощью скриптов PowerShell, CLI или REST AIS.  
- **Токен личного доступа к репозиторию артефактов:** Как правило, маркеры личного доступа для репозитория Git истекают через 90 дней, один год или два года. Для обеспечения непрерывности важно расширить токен для личного доступа или создать новый. Затем используйте автоматизацию, чтобы применить новый токен для личного доступа ко всем лабораториям.
- **Ограничьте изменения в настройках лаборатории:** Часто определенный параметр должен быть ограничен (например, разрешить использование изображений на рынке). Для предотвращения изменений в типе ресурса можно использовать политику Azure. Или вы можете создать пользовательскую роль и предоставить пользователям эту роль вместо роли *владельца* для лаборатории. Вы можете сделать это для большинства параметров в лаборатории (внутренняя поддержка, объявление лаборатории, разрешенные размеры VM и так далее).
- **Требуйте, чтобы вмистые вывешие лица следовали конвенции о присвоении имен:** менеджеры обычно хотят легко идентифицировать вм- связи, которые являются частью облачной среды разработки и тестирования. Это можно сделать с помощью [политики Azure.](https://github.com/Azure/azure-policy/tree/master/samples/TextPatterns/allow-multiple-name-patterns)

Важно отметить, что DevTest Labs использует базовые ресурсы Azure, которые управляются одинаково: сети, диски, вычисления и так далее. Например, политика Azure применяется к виртуальным машинам, которые создаются в лаборатории. Центр безопасности Azure может сообщать о соответствии VM. Служба резервного копирования Azure может обеспечить регулярное резервное копирование для вс-ч в лаборатории.

## <a name="security-considerations"></a>Замечания по безопасности
Azure DevTest Labs использует существующие ресурсы в Azure (вычислить, сетевые сети и так далее). Таким образом, он автоматически выигрывает от функций безопасности, которые встроены в платформу. Например, чтобы требовать, чтобы входящие удаленные соединения рабочего стола исходили только из корпоративной сети, просто добавляйте группу сетевой безопасности в виртуальную сеть на удаленном шлюзе рабочего стола. Единственным дополнительным соображением безопасности является уровень разрешений, которые вы даете членам группы, которые используют лаборатории на ежедневной основе. Наиболее распространенными разрешениями являются [ *владелец* и *пользователь.*](devtest-lab-add-devtest-user.md) Для получения дополнительной информации об этих ролях [см.](devtest-lab-add-devtest-user.md)

## <a name="next-steps"></a>Дальнейшие действия
Смотрите следующую статью в этой серии: [Масштабирование инфраструктуры Azure DevTest Labs.](devtest-lab-guidance-scale.md)
