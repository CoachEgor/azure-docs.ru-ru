---
title: Управление политиками автоматическое завершение работы в Azure DevTest Labs | Документация Майкрософт
description: Узнайте, как задать политику автоматическое завершение работы в лаборатории, чтобы виртуальные машины автоматически завершают работу, когда они не используются.
services: devtest-lab,virtual-machines,lab-services
documentationcenter: na
author: spelluru
manager: femila
editor: ''
ms.assetid: ''
ms.service: lab-services
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/17/2019
ms.author: spelluru
ms.openlocfilehash: 9adf8dd4a5a3c469ed130b29308a0d828aee40bf
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "65873995"
---
# <a name="manage-autoshutdown-policies-for-a-lab-in-azure-devtest-labs"></a>Управление политиками лаборатории в Azure DevTest Labs автоматическое завершение работы
Azure DevTest Labs позволяет контролировать расходы и свести к минимуму излишние траты в лабораториях с помощью управления политиками (параметрами) для каждой лаборатории. В этой статье показано, как настроить автоматическое завершение работы политики для учетной записи лаборатории и настройте параметры автоматическое завершение работы в лаборатории в учетной записи лаборатории. Сведения о настройке всех политик лаборатории см. в статье [Управление всеми политиками лаборатории в Azure DevTest Labs](devtest-lab-set-lab-policy.md).  

## <a name="set-auto-shutdown-policy-for-a-lab"></a>Задать политики автоматического завершения работы в лаборатории
Владелец лаборатории может настроить расписание завершения работы всех виртуальных машин в лаборатории. Таким образом, вы сможете сэкономить на работе компьютеров, которые не используются (в режиме простоя). Вы можете применять политику завершения работы ко всем виртуальным машинам в лаборатории централизованно, а также сократить трудозатраты ваших пользователей лаборатории, настроив расписания их индивидуальных компьютеров. Эта функция позволяет задать политику при запуске расписания лаборатории для ваших пользователей: от предложения без управления до предложения с полным управлением. В качестве владельца лаборатории, вы можете настроить эту политику, выполнив следующие действия:

1. На домашней странице лаборатории выберите функцию **Конфигурация и политики**.
2. Выберите **Политика автоматического завершения работы** в разделе **Расписания** меню слева.
3. Выберите один из способов. Следующие разделы содержат дополнительные сведения об этих параметрах: Политика задания применяется, только для новых виртуальных машин, созданных в лаборатории, а не для уже существующих виртуальных машин. 

    ![Автоматическое завершение работы параметров политики](./media/devtest-lab-set-lab-policy/auto-shutdown-policy-options.png)

## <a name="configure-auto-shutdown-settings"></a>Настроить параметры автоматического завершения работы
Политика автоматическое завершение работы помогает сократить издержки, позволяя указывать время выключения виртуальных машин в этой лаборатории.

Чтобы просмотреть (и изменить) политики для лаборатории, выполните следующее.

1. Войдите на [портале Azure](https://portal.azure.com).
2. Щелкните **Все службы** и выберите в списке **DevTest Labs**.
3. Из списка лабораторий выберите нужную лабораторию.   
4. Выберите **Configuration and policies** (Конфигурация и политики).

    ![Область параметров политики](./media/devtest-lab-set-lab-policy/policies-menu.png)
5. Лаборатории **конфигурация и политики** области выберите **автоматического завершения работы** под **расписания**.
   
    ![Автоматическое завершение работы](./media/devtest-lab-set-lab-policy/auto-shutdown.png)
6. Щелкните **On** (Вкл.), чтобы включить эту политику, или **Off** (Выкл.), чтобы отключить ее.
7. Если эта политика включена, то укажите время (и часовой пояс) завершения работы всех виртуальных машин в текущей лаборатории.
8. Укажите **Да** или **нет** для параметра для отправки уведомления за 15 минут до времени указанного автоматическое завершение работы. Выбрав **Да**, укажите конечную точку в виде URL-адреса веб-перехватчика, где будут публиковаться уведомления, или адрес электронной почты, на который будут отправляться такие уведомления. При получении уведомления пользователь получает возможность отложить завершение работы. Дополнительные сведения см. в разделе [уведомления](#notifications) раздел. 
9. Щелкните **Сохранить**.

    По умолчанию после включения эта политика применяется ко всем виртуальным машинам в текущей лаборатории. Чтобы удалить этот параметр из конкретной виртуальной Машины, откройте область управления виртуальной Машины и измените его **автоматическое завершение работы** параметр.

### <a name="user-sets-a-schedule-and-can-opt-out"></a>Пользователь задает расписание и может отказаться от него
Если задать лаборатории эту политику, пользователи лаборатории могут переопределить или отказаться от расписания лаборатории. Этот параметр предоставляет пользователям лаборатории полный контроль над расписанием автоматического завершения работы своих виртуальных машин. Пользователи лаборатории не увидят изменений на своей странице расписания автоматического завершения работы виртуальной машины.

![Автоматическое завершение работы политики параметр - 1](./media/devtest-lab-set-lab-policy/auto-shutdown-policy-option-1.png)

### <a name="user-sets-a-schedule-and-cannot-opt-out"></a>Пользователь задает расписание и не может отказаться от него
Если задать лаборатории эту политику, пользователи лаборатории могут переопределить расписание лаборатории. Однако они не могут отказаться от политики автоматического завершения работы. Этот параметр гарантирует, что все компьютеры в лаборатории следуют расписанию автоматического завершения работы. Пользователи лаборатории могут обновить расписание автоматического завершения работы своих виртуальных машин и настроить уведомления об отключении.

![Автоматическое завершение работы политики параметр - 2](./media/devtest-lab-set-lab-policy/auto-shutdown-policy-option-2.png)

### <a name="user-has-no-control-over-the-schedule-set-by-lab-admin"></a>Пользователь не может изменять расписание, заданное администратором лаборатории
Если задать лаборатории эту политику, пользователи лаборатории не смогут переопределить или отказаться от расписания лаборатории. Этот параметр дает администратору лаборатории полный контроль над расписанием каждой машины в лаборатории. Пользователи лаборатории могут задать только уведомления об автоматическом завершении работы своих виртуальных машин.

![Автоматическое завершение работы политики параметр - 3](./media/devtest-lab-set-lab-policy/auto-shutdown-policy-option-3.png)

## <a name="notifications"></a>Уведомления
Будут возвращены после автоматическое завершение работы, настроить владельцем лаборатории, уведомления будут отправляться пользователям лаборатории 15 минут, прежде чем автоматическое завершение работы, происходит, если любой из своих виртуальных машин. Этот параметр позволяет пользователям лаборатории сохранить свою работу до завершения работы. Уведомление также содержит ссылки для каждой виртуальной Машины для следующих действий:

- Пропустить это время автоматическое завершение работы
- Отложить автоматическое завершение работы на один час или 2 часов, таким образом, они могут продолжать работать с виртуальной Машины.

Уведомление отправляется через конечную точку подключения настроенных web или адрес электронной почты указан владельцами лаборатории в параметрах автоматическое завершение работы. Веб-Перехватчики позволяют создавать или настраивать интеграций, которые подписаны на определенные события. При запуске одного из этих событий DevTest Labs отправит полезных данных канала HTTP POST на URL-адреса веб-перехватчика. Дополнительные сведения об объектах webhook см. в статье [Создание функции Azure объекта webhook или API](../azure-functions/functions-create-a-web-hook-or-api-function.md). 

Мы рекомендуем использовать веб-перехватчики, так как они широко поддерживаются в различных приложениях (например, Slack, Azure Logic Apps и т. д.) и позволяет реализовать собственный путь для отправки уведомлений. Например в этой статье пошагово способ получения уведомлений автоматическое завершение работы из сообщений электронной почты с помощью Azure Logic Apps. Во-первых давайте быстро перейти основные шаги для включения уведомлений об автоматическое завершение работы в лаборатории.   

## <a name="create-a-logic-app-that-receives-email-notifications"></a>Создание приложения логики, которое получает уведомления по электронной почте
[Служба Azure Logic Apps](../logic-apps/logic-apps-overview.md) предоставляет множество соединителей out of box, позволяет легко интегрировать службы с другими клиентами, таких как Office 365 и twitter. На высоком уровне действия по установке приложения логики для уведомлений по электронной почте можно разделить на четыре этапа: 

- Создайте приложение логики. 
- Настройка встроенного шаблона.
- Интеграция с почтового клиента
- Получите URL-адрес веб-перехватчика.

### <a name="create-a-logic-app"></a>Создайте приложение логики
Чтобы приступить к работе, создайте приложение логики в вашей подписке Azure, выполнив следующие действия:

1. Выберите **+ создать ресурс** в меню слева, выберите **интеграции**и выберите **приложение логики**. 

    ![Новое меню приложения логики](./media/devtest-lab-auto-shutdown/new-logic-app.png)
2. На **приложения логики — создание** странице, выполните следующие действия: 
    1. Введите **имя** для приложения логики.
    2. Выберите свою **подписку Azure**.
    3. Создайте новую **группу ресурсов** или выберите имеющуюся. 
    4. Выберите **расположение** для приложения логики. 

        ![Новое приложение логики — параметры](./media/devtest-lab-auto-shutdown/new-logic-app-page.png)
3. В **уведомления**выберите **перейти к ресурсу** уведомление. 

    ![Переход к ресурсу](./media/devtest-lab-auto-shutdown/go-to-resource.png)
4. Выберите **конструктор приложений логики** под **средства развертывания** категории.

    ![Выберите HTTP-запросов/ответов](./media/devtest-lab-auto-shutdown/select-http-request-response-option.png)
5. На **HTTP запросов / ответов** выберите **этот шаблон используется**. 

    ![Выберите использование этого параметра шаблона](./media/devtest-lab-auto-shutdown/select-use-this-template.png)
6. Скопируйте приведенный ниже код JSON в **схема JSON текста запроса** раздел: 

    ```json
    {
        "$schema": "http://json-schema.org/draft-04/schema#",
        "properties": {
            "delayUrl120": {
                "type": "string"
            },
            "delayUrl60": {
                "type": "string"
            },
            "eventType": {
                "type": "string"
            },
            "guid": {
                "type": "string"
            },
            "labName": {
                "type": "string"
            },
            "owner": {
                "type": "string"
            },
            "resourceGroupName": {
                "type": "string"
            },
            "skipUrl": {
                "type": "string"
            },
            "subscriptionId": {
                "type": "string"
            },
            "text": {
                "type": "string"
            },
            "vmName": {
                "type": "string"
            }
        },
        "required": [
            "skipUrl",
            "delayUrl60",
            "delayUrl120",
            "vmName",
            "guid",
            "owner",
            "eventType",
            "text",
            "subscriptionId",
            "resourceGroupName",
            "labName"
        ],
        "type": "object"
    }
    ```
    
    ![Схема JSON текста запроса](./media/devtest-lab-auto-shutdown/request-json.png)
7. Выберите **+ новый шаг** в конструкторе и выполните следующие действия:
    1. Поиск **Office 365 Outlook — отправить электронное письмо**. 
    2. Выберите **отправить сообщение электронной почты** из **действия**. 
    
        ![Отправить по электронной почте](./media/devtest-lab-auto-shutdown/select-send-email.png)
    3. Выберите **вход** для входа в учетную запись электронной почты. 
    4. Выберите **TO** поле и выберите владельца.
    5. Выберите **СУБЪЕКТА**и введите тему уведомления по электронной почте. Пример: «Завершение работы компьютера vmName для лаборатории: labName.»
    6. Выберите **текст**и определить содержимое тела уведомления по электронной почте. Например: «vmName запланировано завершение работы в течение 15 минут. Пропустите завершение работы, нажав кнопку: URL-АДРЕС. Задержка завершения работы в течение часа: delayUrl60. Задержка завершения работы для 2 часа: delayUrl120.»

        ![Схема JSON текста запроса](./media/devtest-lab-auto-shutdown/email-options.png)
1. На панели инструментов щелкните **Сохранить**. Теперь вы можете скопировать **URL-адрес HTTP POST**. Нажмите кнопку копирования, чтобы скопировать URL-адрес в буфер обмена. 

    ![WebHook URL](./media/devtest-lab-auto-shutdown/webhook-url.png)

## <a name="next-steps"></a>Дальнейшие действия
Сведения о настройке всех политик, см. в разделе [определение политик лаборатории в Azure DevTest Labs](devtest-lab-set-lab-policy.md).
