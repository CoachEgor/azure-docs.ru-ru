---
title: Включение сред с несколькими виртуальными машинами в службах лаборатории Azure | Документация Майкрософт
description: Узнайте, как создать среду с несколькими виртуальными машинами внутри шаблона виртуальной машины в лабораторной лаборатории служб Azure Labs.
services: lab-services
documentationcenter: na
author: spelluru
manager: ''
editor: ''
ms.service: lab-services
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/13/2019
ms.author: spelluru
ms.openlocfilehash: 9a86ba803f899e78b2ba9640e6cc317966969e64
ms.sourcegitcommit: 1d0b37e2e32aad35cc012ba36200389e65b75c21
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/15/2019
ms.locfileid: "72332322"
---
# <a name="create-an-environment-with-multiple-vms-inside-a-template-vm-of-a-classroom-lab"></a>Создание среды с несколькими виртуальными машинами в шаблоне виртуальной машины лаборатории
Сейчас службы лаборатории Azure позволяют настроить одну виртуальную машину шаблона в лаборатории и сделать одну копию доступной для каждого пользователя. Но если вы являетесь профессорным обучением ИТ-класса о настройке брандмауэров или серверов, вам может потребоваться предоставить каждому из учащихся среду, в которой несколько виртуальных машин могут взаимодействовать друг с другом по сети.

Вложенная виртуализация позволяет создать среду с несколькими виртуальными машинами в виртуальной машине шаблона лаборатории. Публикация шаблона предоставит каждому пользователю в лаборатории виртуальную машину, настроенную с несколькими виртуальными машинами в ней.

## <a name="what-is-nested-virtualization"></a>Что такое вложенная виртуализация?
Вложенная виртуализация позволяет создавать виртуальные машины на виртуальной машине. Вложенная виртуализация выполняется через Hyper-V и доступна только на виртуальных машинах Windows.

Дополнительные сведения о вложенной виртуализации см. в следующих статьях:

- [Вложенная виртуализация в Azure](https://azure.microsoft.com/blog/nested-virtualization-in-azure/)
- [Включение вложенной виртуализации на виртуальной машине Azure](../../virtual-machines/windows/nested-virtualization.md)

## <a name="use-nested-virtualization-in-azure-lab-services"></a>Использование вложенной виртуализации в службах лаборатории Azure
Ниже приведены важные шаги.

1. Создайте компьютер с шаблоном **крупного** размера **Windows** для лабораторной работы. 
2. Подключитесь к нему и [включите вложенную виртуализацию](../../virtual-machines/windows/nested-virtualization.md).


Следующая процедура предоставляет подробные инструкции. 

1. Создайте учетную запись лаборатории, если она еще не создана. Инструкции см. [в разделе Учебник. Настройка учетной записи лаборатории с помощью служб лаборатории Azure](tutorial-setup-lab-account.md).
1. Перейдите на [веб-сайт Служб лабораторий Azure](https://labs.azure.com). Обратите внимание на то, что Internet Explorer 11 еще не поддерживается. 
2. Выберите **Вход** и введите свои учетные данные. Службы лабораторий Azure поддерживают учетные записи организации и учетные записи Майкрософт. 
3. Выберите **создать лабораторию**. 
    
    ![Создание аудиторной лаборатории.](../media/tutorial-setup-classroom-lab/new-lab-button.png)
4. В окне **New Lab** (Создание лаборатории) выполните следующие действия. 
    1. Укажите **имя** своей лаборатории. 
    2. Выберите **крупный (вложенная виртуализация)** или **средняя (вложенная виртуализация)** для **размера виртуальной машины**.
    6. Выберите **образ** Windows, который вы хотите использовать. Вложенная виртуализация доступна только на компьютерах Windows. 
    4. Затем нажмите кнопку **Далее**. 

        ![Создание аудиторной лаборатории.](../media/how-to-enable-multi-vm-environment/new-lab-window.png)
    1. На странице **учетные данные виртуальной машины** укажите учетные данные по умолчанию для всех виртуальных машин в лаборатории. Укажите **имя** и **пароль** для пользователя, а затем нажмите кнопку **Далее**.  

        ![Новое окно лаборатории](../media/tutorial-setup-classroom-lab/virtual-machine-credentials.png)

        > [!IMPORTANT]
        > Запишите имя пользователя и пароль. Они больше не будут отображаться.
    3. На странице **политики лаборатории** введите количество часов, выделенных для каждого пользователя (**квота для каждого пользователя**) за пределами запланированного времени для лаборатории, а затем нажмите кнопку **Готово**. 

        ![Квота для каждого пользователя](../media/tutorial-setup-classroom-lab/quota-for-each-user.png)
5. Вы увидите следующий экран, на котором отображается состояние создания виртуальной машины шаблона. Создание шаблона лаборатории занимает до 20 минут. 

    ![Состояние создания шаблона виртуальной машины](../media/tutorial-setup-classroom-lab/create-template-vm-progress.png)
1. На странице **шаблон** выберите **настроить шаблон** на панели инструментов. 

    ![Кнопка "настроить шаблон"](../media/how-to-create-manage-template/customize-template-button.png)
2. В диалоговом окне **Настройка шаблона** выберите **продолжить**. После запуска шаблона и внесения изменений он больше не будет иметь ту же настройку, что и виртуальные машины, которые были в последний раз опубликованы для пользователей. Изменения шаблона не будут отражены на существующих виртуальных машинах ваших пользователей, пока не будет выполнена повторная публикация.

    ![Диалоговое окно «Настройка»](../media/how-to-create-manage-template/customize-template-dialog.png)
1. Нажмите кнопку **подключиться к шаблону** на панели инструментов, чтобы подключиться к виртуальной машине шаблона для настройки вложенной виртуализации. и следуйте инструкциям. Если это компьютер с Windows, вы увидите параметр для скачивания RDP-файла. 

    ![Подключение к шаблону виртуальной машины](../media/how-to-create-manage-template/connect-template-vm.png) 
9. Внутри шаблона виртуальная машина настройте вложенную виртуализацию и настройте виртуальную сеть с несколькими виртуальными машинами. Подробные пошаговые инструкции см. в статье [Включение вложенной виртуализации на виртуальной машине Azure](../../virtual-machines/windows/nested-virtualization.md). Ниже приведен краткий обзор шагов. 
    1. Включите компонент Hyper-V в виртуальной машине шаблона.
    2. Настройка внутренней виртуальной сети с подключением к Интернету для вложенных виртуальных машин
    3. Создание виртуальных машин с помощью диспетчера Hyper-V
    4. Назначение IP-адреса виртуальным машинам
10. На странице **шаблона** на панели инструментов выберите **опубликовать** . 

    ![Кнопка публикации шаблона](../media/tutorial-setup-classroom-lab/template-page-publish-button.png)

    > [!WARNING]
    > После публикации отменить это действие будет нельзя. 
8. На странице **шаблон публикации** введите число виртуальных машин, которые необходимо создать в лаборатории, и нажмите кнопку **опубликовать**. 

    ![Шаблон публикации — число виртуальных машин](../media/tutorial-setup-classroom-lab/publish-template-number-vms.png)
11. Вы увидите **состояние публикации** шаблона на странице. Этот процесс может занять до одного часа. 

    ![Публикация шаблона — ход выполнения](../media/tutorial-setup-classroom-lab/publish-template-progress.png)


## <a name="next-steps"></a>Дальнейшие действия

Теперь каждый пользователь получает единственную виртуальную машину, которая включает в себя среду с несколькими виртуальными машинами. Чтобы узнать, как добавить пользователей в лабораторию и отправить на них ссылку для регистрации, см. следующую статью: [Добавление пользователей в лабораторию](tutorial-setup-classroom-lab.md#add-users-to-the-lab).