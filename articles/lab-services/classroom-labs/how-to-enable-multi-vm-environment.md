---
title: Включить сред со множеством виртуальных Машин в лаборатории служб Azure | Документация Майкрософт
description: Узнайте, как создать среду с несколькими виртуальными машинами внутри шаблона виртуальной машины в лабораторию аудитории службы лабораторий Azure.
services: lab-services
documentationcenter: na
author: spelluru
manager: ''
editor: ''
ms.service: lab-services
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/18/2019
ms.author: spelluru
ms.openlocfilehash: 6faf32232c42f863bff52fdfb3c0714aee8e9b88
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60702442"
---
# <a name="create-an-environment-with-multiple-vms-inside-a-template-vm-of-a-classroom-lab"></a>Создание среды с несколькими виртуальными машинами внутри шаблона виртуальной Машины лаборатории аудитории
В настоящее время службы лабораторий Azure позволяет настроить один шаблон виртуальной машины в лаборатории и сделать одну копию доступным для каждого пользователя. Но если профессором преподаванием класс ИТ о том, как настроить брандмауэры или серверов, может потребоваться предоставить каждой из своих учащихся в среде, в которой несколько виртуальных машин могут взаимодействовать друг с другом по сети.

Вложенная виртуализация позволяет создать среду с несколькими виртуальными Машинами в лаборатории шаблон виртуальной машины. Публикация шаблона будет предоставлять каждому пользователю в лаборатории с виртуальных машин с несколькими виртуальными машинами внутри него.

## <a name="what-is-nested-virtualization"></a>Что такое вложенной виртуализации?
Вложенная виртуализация позволяет создавать виртуальные машины на виртуальной машине. Вложенная виртуализация осуществляется с помощью Hyper-V и доступно только на виртуальных машинах Windows.

Дополнительные сведения о вложенной виртуализации см. в следующих статьях:

- [Вложенная виртуализация в Azure](https://azure.microsoft.com/blog/nested-virtualization-in-azure/)
- [Включение вложенной виртуализации на виртуальной Машине Azure](../../virtual-machines/windows/nested-virtualization.md)

## <a name="use-nested-virtualization-in-azure-lab-services"></a>Использовать вложенную виртуализацию в службы лабораторий Azure
Ниже приведены важные действия.

1. Создание **больших** размера **Windows** машины-шаблона лаборатории. 
2. Подключиться к нему и [Включение вложенной виртуализации](../../virtual-machines/windows/nested-virtualization.md).


В следующей процедуре представлены подробные инструкции: 

1. Создание учетной записи лаборатории, если вы не сделали. Инструкции см. в разделе [руководства: Настройка учетной записи лаборатории с помощью службы лабораторий Azure](tutorial-setup-lab-account.md).
2. Перейдите на [веб-сайт Служб лабораторий Azure](https://labs.azure.com). 
3. Выберите **Вход** и введите свои учетные данные. Службы лабораторий Azure поддерживают учетные записи организации и учетные записи Майкрософт. 
4. В окне **New Lab** (Создание лаборатории) выполните следующие действия. 
    1. Укажите **имя** своей лаборатории. 
    2. Укажите максимальное **число виртуальных машин** в лаборатории. Количество виртуальных машин можно увеличить или уменьшить после создания лаборатории или в существующей лаборатории. Дополнительные сведения см. в разделе [Обновление количества виртуальных машин в лаборатории](how-to-configure-student-usage.md#update-number-of-virtual-machines-in-lab)/
    6. Щелкните **Сохранить**.

        ![Создание лаборатории для аудитории](../media/tutorial-setup-classroom-lab/new-lab-window.png)
4. На странице **выбора характеристик виртуальных машин** выполните следующие действия:
    1. Выберите **крупный** размера виртуальных машин (ВМ), создаваемого в лаборатории. В настоящее время только большого размера поддерживает вложенную виртуализацию.
    2. Выберите образ виртуальной машины, **образ Windows**. Вложенная виртуализация доступна только на компьютерах Windows. 
    3. Щелкните **Далее**.

        ![Указание характеристик виртуальной машины](../media/how-to-enable-multi-vm-environment/large-windows-vm.png)    
5. На странице **Задание учетных данных** укажите учетные данные по умолчанию для всех виртуальных машин в лаборатории. 
    1. Укажите **имя пользователя** для всех виртуальных машин в лаборатории.
    2. Укажите **пароль** для пользователя. 

        > [!IMPORTANT]
        > Запишите имя пользователя и пароль. Они больше не будут отображаться.
    3. Нажмите кнопку **Создать**. 

        ![Задайте учетные данные](../media/tutorial-setup-classroom-lab/set-credentials.png)
6. На странице **настройки шаблона** отображаются сведения о состоянии создания лаборатории. Создание шаблона лаборатории занимает до 20 минут. 

    ![Настройка шаблона](../media/tutorial-setup-classroom-lab/configure-template.png)
7. По завершении настройки шаблона отобразится следующая страница: 

    ![Страница настройки шаблона по завершении процесса](../media/tutorial-setup-classroom-lab/configure-template-after-complete.png)
8. На **Настройка шаблона** выберите **Connect** для подключения к шаблону виртуальной Машины для настройки вложенной виртуализации. Можно также настроить позже после выполнения шагов в этом мастере. 
9. Внутри шаблона виртуальной машины Настройка вложенной виртуализации и настройте виртуальную сеть с несколькими виртуальными машинами. Подробные пошаговые инструкции см. в разделе [Включение вложенной виртуализации на виртуальной Машине Azure](../../virtual-machines/windows/nested-virtualization.md). Вот краткий перечень шагов: 
    1. Включите функцию Hyper-V в шаблоне виртуальной машины.
    2. Настройка внутренней виртуальной сети с подключением к Интернету для вложенных виртуальных машин
    3. Создание виртуальных машин с помощью диспетчера Hyper-V
    4. Назначение IP-адреса виртуальным машинам
10. Выберите **Далее** на странице шаблона. 
11. На странице **публикации шаблона** выполните описанные ниже действия. 
    1. Чтобы сразу опубликовать шаблон, выберите **Publish** (Опубликовать).  

        > [!WARNING]
        > После публикации отменить это действие будет нельзя. 
    2. Чтобы опубликовать шаблон позже, выберите **Сохранить для использования в будущем**. Вы можете опубликовать шаблон виртуальной машины по завершении работы мастера. Дополнительные сведения о том, как настроить и опубликовать шаблон после завершения работы мастера, см. в [этом разделе](how-to-create-manage-template.md#publish-the-template-vm) статьи [Управление лабораторией для аудитории в решении "Службы лабораторий Azure"](how-to-manage-classroom-labs.md).

        ![Публикация шаблона](../media/how-to-enable-multi-vm-environment/publish-template-page.png)
11. Отобразятся сведения о **ходе публикации** шаблона. Этот процесс может занять до одного часа. 

    ![Публикация шаблона — ход выполнения](../media/tutorial-setup-classroom-lab/publish-template-progress.png)
12. Если шаблон опубликован успешно, отобразится показанная ниже страница. Нажмите кнопку **Готово**.

    ![Публикация шаблона — успешное выполнение](../media/tutorial-setup-classroom-lab/publish-success.png)
1. Откроется **панель мониторинга** лаборатории. 
    
    ![Панель мониторинга лаборатории для аудитории](../media/how-to-enable-multi-vm-environment/dashboard.png)


## <a name="next-steps"></a>Дальнейшие действия

Теперь каждый пользователь получит одну виртуальную машину, включающий в среде с несколькими виртуальными Машинами внутри него. Чтобы научиться добавлять пользователей в лаборатории и отправить их ссылка для регистрации, см. следующую статью: [Добавление пользователей в лабораторию](tutorial-setup-classroom-lab.md#add-users-to-the-lab).