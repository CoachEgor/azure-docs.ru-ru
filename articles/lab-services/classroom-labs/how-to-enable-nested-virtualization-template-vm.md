---
title: Включение вложенной виртуализации на виртуальной машине шаблона в службах лаборатории Azure | Документация Майкрософт
description: Узнайте, как включить вложенную виртуализацию на виртуальной машине шаблона в службах лаборатории Azure.
services: lab-services
documentationcenter: na
author: spelluru
manager: ''
editor: ''
ms.service: lab-services
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/04/2019
ms.author: spelluru
ms.openlocfilehash: 9a52fd958d646af5edd09065e9acf95796c8ce33
ms.sourcegitcommit: d7689ff43ef1395e61101b718501bab181aca1fa
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2019
ms.locfileid: "71981999"
---
# <a name="enable-nested-virtualization-on-a-template-virtual-machine-in-azure-lab-services"></a>Включение вложенной виртуализации на виртуальной машине шаблона в службах лаборатории Azure
В этой статье описывается, как настроить вложенную виртуализацию на виртуальной машине шаблона в службах лаборатории Azure. Вложенная виртуализация используется в службах лаборатории Azure, если для каждого учащегося в классе требуется несколько компьютеров.
 
## <a name="considerations"></a>Рекомендации
Перед настройкой лаборатории с вложенной виртуализацией необходимо принять во внимание некоторые моменты.

- При создании лаборатории выберите значение **средняя (вложенная виртуализация)** или **крупные** размеры для размера виртуальной машины. Размеры виртуальных машин поддерживают вложенную виртуализацию. 
- Выберите размер, который обеспечит хорошую производительность как для узлов, так и для клиентских виртуальных машин.  Помните, что при использовании виртуализации выбранный размер должен быть достаточным для не только для одного компьютера, но и для всех клиентских компьютеров, которые должны выполняться параллельно.
- Клиентские виртуальные машины не будут иметь доступа к ресурсам Azure, таким как DNS-серверы в виртуальной сети Azure.
- Для виртуальной машины узла требуется программа установки, разрешающая подключение клиентского компьютера к Интернету. 
- Клиентские виртуальные машины лицензируются как независимые компьютеры. Сведения о лицензировании операционных систем и продуктов Майкрософт см. в разделе [Лицензирование корпорации Майкрософт](https://www.microsoft.com/licensing/default) . Проверьте лицензионное соглашение для любого другого программного обеспечения, используемого перед настройкой компьютера шаблона.

## <a name="enable-nested-virtualization-on-a-template-vm"></a>Включение вложенной виртуализации на виртуальной машине шаблона
Действия, описанные в этом разделе, касаются настройки вложенной виртуализации для Windows Server 2016 или Windows Server 2019. Для настройки компьютера шаблона с помощью Hyper-V будет использоваться сценарий. Сведения об автоматизированном решении см. в статье сценарии в [службах лаборатории Hyper-V](https://github.com/Azure/azure-devtestlab/tree/master/samples/ClassroomLabs/Scripts/HyperV). Ниже описано, как использовать скрипт.

1. Если вы используете Internet Explorer, может потребоваться добавить `https://github.com` в список надежных сайтов. 
    1. Откройте браузер Internet Explorer.
    1. Щелкните значок шестеренки и выберите **Свойства браузера**.  
    1. Когда откроется диалоговое окно **Свойства обозревателя** , выберите **Безопасность**, выберите **Надежные сайты**, нажмите кнопку **сайты** .
    1. Когда откроется диалоговое окно **Надежные сайты** , добавьте `https://github.com` в список Доверенные веб-сайты и нажмите кнопку **Закрыть**.

        ![Надежные сайты](../media/how-to-enable-nested-virtualization-template-vm/trusted-sites-dialog.png)
1.  Скачайте файлы репозитория Git, как описано в следующих шагах.  Кроме того, репозиторий Git можно клонировать из [https://github.com/Azure/azure-devtestlab.git](https://github.com/Azure/azure-devtestlab.git). 
    1. Перейдите на сайт [https://github.com/Azure/azure-devtestlab/](https://github.com/Azure/azure-devtestlab/).
    1. Нажмите кнопку ***клонировать или скачать** .
    1. Щелкните **скачать ZIP-файл**.
    1. Извлечение ZIP-файла
1. Запустите **PowerShell** в режиме **администратора** .
1. В окне PowerShell перейдите к папке с скачанным скриптом. Если вы выполняете переход из верхней папки файлов репозитория, сценарий размещается по адресу `azure-devtestlab\samples\ClassroomLabs\Scripts\HyperV\`.
1. Для успешного выполнения скрипта может потребоваться изменить политику выполнения. Выполните следующую команду:
    
    ```powershell
    Set-ExecutionPolicy bypass -force 
    ```
1. Выполните сценарий:
    
    ```powershell
    .\SetupForNestedVirtualization.ps1
    ```

    > [!NOTE]
    > Для выполнения сценария может потребоваться перезапустить компьютер. Следуйте инструкциям скрипта и повторно запустите скрипт, пока в выходных данных не появится элемент **script завершен** .
1. Не забудьте сбросить политику выполнения. Выполните следующую команду: 

    ```powershell
    Set-ExecutionPolicy default -force
    ```

## <a name="conclusion"></a>Заключение
Теперь ваш компьютер шаблона готов к созданию виртуальных машин Hyper-V. Инструкции по созданию виртуальных машин Hyper-V см. [в статье Создание виртуальной машины в Hyper-v](/windows-server/virtualization/hyper-v/get-started/create-a-virtual-machine-in-hyper-v) . См. также раздел [Центр оценки Майкрософт](https://www.microsoft.com/evalcenter/) для извлечения доступных операционных систем и программного обеспечения.  

## <a name="next-steps"></a>Следующие шаги 
Ознакомьтесь со следующими статьями:

- [Включение вложенной виртуализации на виртуальной машине Azure](../../virtual-machines/windows/nested-virtualization.md) 
- [Установка роли Hyper-V в Windows Server](/windows-server/virtualization/hyper-v/get-started/install-the-hyper-v-role-on-windows-server)
- [Сценарии Hyper-V служб лаборатории](https://github.com/Azure/azure-devtestlab/tree/master/samples/ClassroomLabs/Scripts/HyperV)
