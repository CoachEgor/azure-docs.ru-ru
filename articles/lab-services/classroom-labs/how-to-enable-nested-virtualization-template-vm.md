---
title: Включить вложенную виртуализацию на шаблоне VM в лабораторных службах Azure (ru) Документы Майкрософт
description: Узнайте, как создать шаблон VM с несколькими vMs внутри.  Другими словами, включите вложенную виртуализацию на шаблоне VM в Службах лаборатории Azure.
services: lab-services
documentationcenter: na
author: spelluru
manager: ''
editor: ''
ms.service: lab-services
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/04/2019
ms.author: spelluru
ms.openlocfilehash: 59b32834369f76d39bb4a253dad4ec541e7ef999
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79502010"
---
# <a name="enable-nested-virtualization-on-a-template-virtual-machine-in-azure-lab-services"></a>Включить вложенную виртуализацию на виртуальной машине шаблона в службах Лаборатории Лабера

В настоящее время Службы Лаборатории Лазурного Излза позволяют настроить один шаблон виртуальной машины в лаборатории и сделать одну копию доступной каждому из пользователей. Если вы профессор преподавания сетей, безопасности или ИТ-классов, возможно, потребуется предоставить каждому из ваших студентов с средой, в которой несколько виртуальных машин могут говорить друг с другом через сеть.

Вложенная виртуализация позволяет создать мульти-VM-среду внутри виртуальной машины шаблона лаборатории. Публикация шаблона обеспечит каждого пользователя в лаборатории с виртуальной машиной, настроенной с несколькими VMs внутри него.  В этой статье рассказывается о том, как настроить вложенную виртуализацию на шаблонной машине в службах Лаборатории Azure.

## <a name="what-is-nested-virtualization"></a>Что такое вложенная виртуализация?

Вложенная виртуализация позволяет создавать виртуальные машины в виртуальной машине. Вложенная виртуализация осуществляется с помощью Hyper-V и доступна только на Windows VMs.

Для получения дополнительной информации о вложенной виртуализации см.

- [Вложенная виртуализация в Azure](https://azure.microsoft.com/blog/nested-virtualization-in-azure/)
- [Как включить вложенную виртуализацию в виртуальных машинах Azure](../../virtual-machines/windows/nested-virtualization.md)

## <a name="considerations"></a>Рекомендации

Прежде чем создать лабораторию с вложенной виртуализацией, вот несколько вещей, которые следует принять во внимание.

- При создании новой лаборатории выберите **средние (виртуализация вложенных)** или **большие (nested виртуализации)** размеры для размера виртуальной машины. Эти виртуальные размеры машины поддерживают вложенную виртуализацию.
- Выберите размер, который обеспечит хорошую производительность как для хоста, так и для виртуальных машин клиента.  Помните, что при использовании виртуализации размер, который вы выбираете, должен быть достаточным не только для одной машины, но и для хоста, а также для любых клиентских машин, которые должны работать одновременно.
- Клиентские виртуальные машины не будут иметь доступа к ресурсам Azure, таким как DNS-серверы в виртуальной сети Azure.
- Хост виртуальной машины требует настройки, чтобы клиент машины иметь подключение к Интернету.
- Клиент виртуальные машины лицензированы как независимые машины. Ознакомьтесь с [информацией о лицензировании](https://www.microsoft.com/licensing/default) операционных систем и продуктов корпорации Майкрософт. Проверьте лицензионные соглашения на любое другое программное обеспечение, используемое перед настройкой шаблонной машины.

## <a name="enable-nested-virtualization-on-a-template-vm"></a>Включение вложенной виртуализации в шаблоне виртуальной машины

Эта статья предполагает, что вы создали учетную запись лаборатории и лаборатории.  Для получения дополнительной информации о [tutorial to set up a Lab Account](tutorial-setup-lab-account.md)создании новой учетной записи лаборатории, см. Для получения дополнительной информации о том, как создать [лабораторию,](tutorial-setup-classroom-lab.md)см.

>[!IMPORTANT]
>Выберите **Большой (вложенная виртуализация)** или **Medium (вложенная виртуализация)** для размера виртуальной машины при создании лаборатории.  Вложенная виртуализация не будет работать иначе.  

Чтобы подключиться к шаблонной машине, [см.](how-to-create-manage-template.md)

### <a name="using-script-to-enable-nested-virtualization"></a>Использование скрипта для включения вложенной виртуализации

Чтобы использовать автоматизированную настройку для вложенной виртуализации с Windows Server 2016 или Windows Server 2019, [см. Включить вложенную виртуализацию на виртуальной машине шаблона в Azure Lab Services с помощью сценария.](how-to-enable-nested-virtualization-template-vm-using-script.md) Для установки роли Hyper-V вы будете использовать скрипты из [скриптов Lab Services Hyper-V.](https://github.com/Azure/azure-devtestlab/tree/master/samples/ClassroomLabs/Scripts/HyperV)  Скрипты также будут настроены сети, чтобы Hyper-V виртуальные машины могут иметь доступ в Интернет.

### <a name="using-windows-tools-to-enable-nested-virtualization"></a>Использование инструментов Windows для обеспечения вложенной виртуализации

Настройка вложенных виртуализации для Windows Server 2016 или Windows Server 2019 с использованием ролей Windows и административных инструментов, [см. Включить вложенных виртуализации на шаблон ежемовая машина в Azure Lab Services вручную](how-to-enable-nested-virtualization-template-vm-ui.md).  Инструкции также будут охватывать, как настроить сеть, чтобы Гипер-V виртуальные машины могут иметь доступ в Интернет.
