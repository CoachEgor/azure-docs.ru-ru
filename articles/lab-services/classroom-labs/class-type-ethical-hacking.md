---
title: Настройка лаборатории этического взлома с помощью лабораторных служб Azure (ru) Документы Майкрософт
description: Узнайте, как создать лабораторию с помощью лабораторных служб Azure для обучения этичному взлому.
services: lab-services
documentationcenter: na
author: spelluru
manager: ''
editor: ''
ms.service: lab-services
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/04/2019
ms.author: spelluru
ms.openlocfilehash: 2b600edc4c360a2b2990be34e44bb8fbd1c8f721
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "74133178"
---
# <a name="set-up-a-lab-to-teach-ethical-hacking-class"></a>Настройка лаборатории для обучения этического класса взлома 
Эта статья показывает вам, как создать класс, который фокусируется на судебно-медицинской стороне этического взлома. Тестирование на проникновение, метод, используемый хакерским сообществом, используется, когда кто-то пытается получить доступ к системе или сети, чтобы продемонстрировать ее уязвимости, которыми потенциально может воспользоваться злоумышленник. 

В классе этичного взлома учащиеся могут изучать современные методы защиты от уязвимостей. Каждый учащийся получает виртуальную машину Windows Server с двумя вложенными виртуальными машинами: одну виртуальную машину с образом [Metasploitable3](https://github.com/rapid7/metasploitable3) и одну виртуальную машину с образом [Kali Linux](https://www.kali.org/). Виртуальная машина Metasploitable используется для изучения проникновений, а виртуальная машина Kali предоставляет доступ к средствам, необходимым для выполнения задач анализа.

Эта статья имеет два основных раздела. Первый раздел охватывает, как создать классную лабораторию. Второй раздел охватывает, как создать шаблон машины с вложенной виртуализации включен и с инструментами и изображениями, необходимыми. В этом случае Metasploitable изображение и изображение Kali Linux на машине, которая имеет Hyper-V позволило разместить изображения.

## <a name="lab-configuration"></a>Настройка лаборатории
Чтобы настроить эту лабораторию, для начала работы требуется подписка Azure. Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/), прежде чем начинать работу. После получения подписки Azure можно создать новую учетную запись лаборатории в лабораторных службах Azure или использовать существующую учетную запись. Смотрите следующий учебник для создания новой учетной записи лаборатории: [Учебник для настройки учетной записи лаборатории](tutorial-setup-lab-account.md).

Следуйте [этому учебнику,](tutorial-setup-classroom-lab.md) чтобы создать новую лабораторию, а затем применить следующие настройки:

| размер виртуальной машины; | Изображение |
| -------------------- | ----- | 
| Средний (Вложенная виртуализация) | Windows Server 2019 Datacenter |

## <a name="template-machine"></a>Шаблон наяпривная машина 

После создания шаблона запустите машину и подключитесь к ней для выполнения следующих трех основных задач. 
 
1. Настройка машины для вложенной виртуализации. Это позволяет всем соответствующим функциям windows, как Hyper-V, и устанавливает сеть для Hyper-V изображения, чтобы иметь возможность общаться друг с другом и В Интернете.
2. Настройка изображения [Kali](https://www.kali.org/) Linux. Kali — это дистрибутив Linux, который включает в себя инструменты для тестирования на проникновение и аудита безопасности.
3. Настройка metasploitable изображения. В этом примере будет использоваться изображение [Metasploitable3.](https://github.com/rapid7/metasploitable3) Это изображение создано для намеренного уязвимости безопасности.

Скрипт, который автоматизирует задачи, изложенные выше, доступен в [Lab Services Ethical Hacking Scripts.](https://github.com/Azure/azure-devtestlab/tree/master/samples/ClassroomLabs/Scripts/EthicalHacking)

### <a name="prepare-template-machine-for-nested-virtualization"></a>Подготовка шаблона машины для вложенной виртуализации
Следуйте инструкциям в [этой статье,](how-to-enable-nested-virtualization-template-vm.md) чтобы подготовить шаблон виртуальной машины для вложенной виртуализации. 

### <a name="set-up-a-nested-virtual-machine-with-kali-linux-image"></a>Настройка вложенной виртуальной машины с помощью изображения Kali Linux
Kali — это дистрибутив Linux, который включает в себя инструменты для тестирования на проникновение и аудита безопасности.

1. Скачать [https://www.offensive-security.com/kali-linux-vm-vmware-virtualbox-image-download/](https://www.offensive-security.com/kali-linux-vm-vmware-virtualbox-image-download/)изображение с .  
    1. Скачать **Kali Linux Hyper-V 64 Бит** для Hyper-V.
    1. Извлеките файл .7z.  Если у вас еще нет 7 zip, скачать его из [https://www.7-zip.org/download.html](https://www.7-zip.org/download.html). Помните о местонахождении извлеченной папки, как вам это понадобится позже.
2. Открытый **менеджер Hyper-V** от административных инструментов.
1. Выберите **действие**, а затем выберите **Импорт Виртуальная машина**. 
1. На странице **Locate Folder** мастера **импортной виртуальной машины** выберите местоположение извлеченной папки, в которой находится изображение Kali Linux.

    ![Найдите диалог Фолдера](../media/class-type-ethical-hacking/locate-folder.png)
1. На странице **Выберите виртуальную машину** выберите изображение Kali Linux.  В этом случае изображение **kali-linux-2019.3-hyperv**.

    ![Выберите изображение Кали](../media/class-type-ethical-hacking/select-kali-image.png)
1.  На странице **«Выбрать импорт»** выберите **«Копировать виртуальную машину» (создайте новый уникальный идентификатор).**

    ![Выберите тип импорта](../media/class-type-ethical-hacking/choose-import-type.png)
1. Примите настройки по умолчанию на **выберите Фолденовые файлы для виртуальных файлов машины** и **выберите Фолдеф для хранения страниц виртуальных жестких дисков,** а затем выберите **Следующий.**
1. На странице **Connect Network** выберите **LabServicesSwitch,** созданный ранее в разделе **Подготовительной виртуализации вложенных** устройств, а затем выберите **следующий**.

    ![Подключение страницы сети](../media/class-type-ethical-hacking/connect-network.png)
1. Выберите **закончить** на странице **Резюме.** Подождите, пока операции копирования и импорта не будут завершены. Виртуальная машина Kali Linux теперь будет доступна в Hyper-V.
1. От **Hyper-V Manager**выберите **Action** -> **Start,** затем выберите **Action** -> **Connect** для подключения к виртуальной машине.  
12. Имя пользователя по умолчанию — `root`, а пароль — `toor`. 

    > [!NOTE]
    > Если вам нужно разблокировать изображение, нажмите клавишу CTRL и перетащите мышь вверх.

## <a name="set-up-a-nested-vm-with-metasploitable-image"></a>Настройка вложенного VM с метаспотируемым изображением  
Метаслоитируемое изображение Rapid7 — это изображение, специально настроенное с уязвимостями безопасности. Вы будете использовать это изображение для тестирования и поиска проблем. Следующие инструкции показывают, как использовать заранее созданный Metasploitable изображения. Однако, если необходима новая версия метаслоитируемого [https://github.com/rapid7/metasploitable3](https://github.com/rapid7/metasploitable3)изображения, см.

1. Перейдите [https://information.rapid7.com/download-metasploitable-2017.html](https://information.rapid7.com/download-metasploitable-2017.html)к . Заполните форму, чтобы загрузить изображение и выберите кнопку **Отправка.**
1. Выберите кнопку **Скачать Metasploitable Now.**
1. Когда файл застежок на молнии, извлеките файл застежки-молнии и запомните местоположение.
1. Преобразуйте извлеченный файл vmdk в файл vhdx, чтобы можно было использовать с Hyper-V. Чтобы сделать это, откройте PowerShell с административными привилегиями и перейдите к папке, где находится файл vmdk, и следуйте этим инструкциям:
    1. Скачать [Microsoft Виртуальный конвертер машины](https://www.microsoft.com/download/details.aspx?id=42497), и запустить mvmc_setup.msi файл, когда предложено.
    1. Импорт модуля PowerShell.  Местом по умолчанию, в котором установлен модуль, является C: «Файлы программирования »Microsoft Virtual Machine Converter»

        ```powershell
        Import-Module 'C:\Program Files\Microsoft Virtual Machine Converter\MvmcCmdlet.psd1'
        ```
    1. Преобразуйте vmdk в файл vhd, который может быть использован Hyper-V. Эта операция может занять несколько минут.
    
        ```powershell
        ConvertTo-MvmcVirtualHardDisk -SourceLiteralPath .\Metasploitable.vmdk -DestinationLiteralPath .\Metasploitable.vhdx -VhdType DynamicHardDisk -VhdFormat vhdx
        ```
    1. Копируйте вновь созданные metasploitable.vhdx к C: «Пользователи »Общественные »Документы »Гипер-V »Виртуальные жесткие диски». 
1. Создайте новую виртуальную машину Hyper-V.
    1. Открытый **менеджер Hyper-V**.
    1. Выберите **действие** -> **Новая** -> **виртуальная машина**.
    1. На **перед вами начать** страницу **нового виртуального мастера машины**, нажмите **далее**.
    1. На странице **«Указать имя и местоположение»** введите **Metasploitable** для **имени**и выберите **Далее.**

        ![Новый мастер изображения VM](../media/class-type-ethical-hacking/new-vm-wizard-1.png)
    1. На странице **«Указать поколение»** примите значения по умолчанию и выберите **«Следующий».**
    1. На странице **Присваивание памяти** введите **512 МБ** для **памяти запуска**и выберите **Следующий**. 

        ![Страница "Выделение памяти"](../media/class-type-ethical-hacking/assign-memory-page.png)
    1. На странице **Настройка Сети** оставьте соединение как **неподключенное.** Позже вы навяжете адаптер сети.
    1. На странице **Connect Virtual Hard Disk** выберите **используйте существующий виртуальный жесткий диск.** Просмотрите место для **metasploitable.vhdx** файл, созданный в предыдущем шаге, и выберите **Следующий**. 

        ![Подключение виртуальной страницы сетевого диска](../media/class-type-ethical-hacking/connect-virtual-network-disk.png)
    1. На **завершение новой виртуальной машине мастер** страницы, и выберите **Закончить**.
    1. Как только виртуальная машина будет создана, выберите ее в Hyper-V Manager. Не включайте машину.  
    1. Выберите**настройки** **действий** -> .
    1. В **настройках для метаслоитируемого** диалога выберите **Добавить оборудование.** 
    1. Выберите **адаптер сети Legacy**и **переберите Добавить**.

        ![Страница сетевого адаптера](../media/class-type-ethical-hacking/network-adapter-page.png)
    1. На странице **адаптера Legacy Network Adapter** выберите **LabServicesSwitch** для настройки **виртуального коммутатора** и выберите **OK.** LabServicesSwitch был создан при подготовке шаблона для Hyper-V в разделе **Подготовительное шаблон для вложенной виртуализации.**

        ![Страница адаптера Legacy Network](../media/class-type-ethical-hacking/legacy-network-adapter-page.png)
    1. Metasploitable изображение теперь готово к использованию. От **Hyper-V Manager**выберите **Action** -> **Start,** затем выберите **Action** -> **Connect** для подключения к виртуальной машине.  Имя пользователя по умолчанию **msfadmin** и пароль **msfadmin**. 


Шаблон в настоящее время обновляется и имеет изображения, необходимые для этического взлома проникновения тестирования класса, изображение с инструментами, чтобы сделать тестирование на проникновение и другое изображение с уязвимостями безопасности, чтобы обнаружить. Изображение шаблона теперь может быть опубликовано в классе. Выберите кнопку **«Публикация»** на странице шаблона, чтобы опубликовать шаблон в лаборатории.
  

## <a name="cost"></a>Стоимость  
Если вы хотите оценить стоимость этой лаборатории, вы можете использовать следующий пример: 
 
Для класса из 25 студентов с 20 часами запланированного времени занятий и 10 часами квоты для домашних заданий или заданий, цена для лаборатории будет: 

25 студентов (20 и 10) часов , 55 лабораторных единиц 0,01 USD в час , 412,50 USD. 

Для получения дополнительной информации о ценах [см.](https://azure.microsoft.com/pricing/details/lab-services/)

## <a name="conclusion"></a>Заключение
Эта статья провела вас через шаги, чтобы создать лабораторию для этического класса взлома. Она включает в себя шаги по настройке вложенной виртуализации для создания двух виртуальных машин внутри хоста виртуальной машины для проникающего тестирования.

## <a name="next-steps"></a>Дальнейшие действия
Следующие шаги являются общими для создания любой лаборатории:

- [Добавление пользователей](tutorial-setup-classroom-lab.md#add-users-to-the-lab)
- [Установленная квота](how-to-configure-student-usage.md#set-quotas-for-users)
- [Установить расписание](tutorial-setup-classroom-lab.md#set-a-schedule-for-the-lab) 
- [Ссылки на регистрацию по электронной почте студентам](how-to-configure-student-usage.md#send-invitations-to-users). 

