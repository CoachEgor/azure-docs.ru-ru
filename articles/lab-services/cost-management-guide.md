---
title: Руководство по управлению затратами для служб лаборатории Azure
description: Изучите различные способы просмотра затрат для служб лаборатории.
author: rbest
ms.author: rbest
ms.date: 08/16/2020
ms.topic: article
ms.openlocfilehash: 0aaa454df05cd8981b314abe238163caced7864c
ms.sourcegitcommit: d661149f8db075800242bef070ea30f82448981e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "88604588"
---
# <a name="cost-management-for-azure-lab-services"></a>Управление затратами для служб лаборатории Azure

Управление затратами можно разделить на две разные области: Оценка затрат и анализ затрат.  Оценка затрат возникает при настройке лаборатории, чтобы убедиться в том, что начальная структура лаборатории будет соответствовать ожидаемому бюджету.  Анализ затрат обычно происходит в конце месяца для анализа затрат и определения необходимых действий в следующем месяце.

## <a name="estimate-the-lab-costs"></a>Оценка затрат на лабораторию

Каждая панель мониторинга лаборатории содержит затраты & раздел, в котором **выставляется** приблизительная оценка того, что лаборатория будет стоить в течение месяца.  Оценка затрат суммирует использование часов с максимальным числом пользователей по предполагаемым затратам в часах.  Чтобы получить наиболее точную оценку, настройте лабораторию, включая [Расписание](how-to-create-schedules.md), и на панели мониторинга будут отражены оценочные затраты.  

Эта оценка может быть не всеми возможными затратами, и некоторые ресурсы не включаются.  Стоимость подготовки шаблона не учитывается в оценке затрат.  Это может значительно варьироваться в течение времени, необходимого для создания шаблона. Стоимость запуска шаблона равна общей стоимости лаборатории в час. Все [Общие затраты коллекции образов](how-to-use-shared-image-gallery.md) не включаются в информационную панель лаборатории, так как коллекция может совместно использоваться несколькими лабораториями.  Наконец, часы, затраченные на запуск компьютера создателем лаборатории, исключаются из этой оценки.

> [!div class="mx-imgBorder"]
> ![Оценка стоимости панели мониторинга](./media/cost-management-guide/dashboard-cost-estimation.png)

## <a name="analyze-previous-months-usage"></a>Анализ использования предыдущих месяцев

Анализ затрат предназначен для просмотра использования предыдущих месяцев, чтобы помочь определить любые корректировки для лаборатории.  Декомпозицию затрат в прошлом можно найти в [анализе стоимости подписки](https://docs.microsoft.com/azure/cost-management-billing/costs/quick-acm-cost-analysis).  В портал Azure в верхнем поле поиска можно ввести "подписки", а затем выбрать параметр подписки.  

> [!div class="mx-imgBorder"]
> ![Поиск по подписке](./media/cost-management-guide/subscription-search.png)

Выберите конкретную подписку, которую необходимо проверить.

> [!div class="mx-imgBorder"]
> ![Выбор подписки](./media/cost-management-guide/subscription-select.png)

 Выберите "анализ затрат" в левой области в разделе " **Управление затратами**".

> [!div class="mx-imgBorder"]
> ![Анализ стоимости подписки](./media/cost-management-guide/subscription-cost-analysis.png)

Эта панель мониторинга обеспечивает подробный анализ затрат, включая возможность экспорта в различные типы файлов по расписанию.  Дополнительные сведения см. в статье Управление затратами. [Обзор учета затрат](https://docs.microsoft.com/azure/cost-management-billing/cost-management-billing-overview)

Фильтрация по типу ресурса: `microsoft.labservices/labaccounts` будет показывать только затраты, связанные со службами лаборатории.

## <a name="understand-the-usage"></a>Сведения об использовании

Ниже приведен пример анализа затрат.

> [!div class="mx-imgBorder"]
> ![Анализ стоимости подписки](./media/cost-management-guide/cost-analysis.png)

По умолчанию существует шесть столбцов: ресурс, тип ресурса, расположение, имя группы ресурсов, теги, затраты.  Столбец ресурсов содержит сведения об учетной записи лаборатории, имени лаборатории и виртуальной машине.  Строки с учетной записью лаборатории, именем лаборатории или по умолчанию — это затраты на лабораторию, которые можно увидеть во второй и третьей строках.  Для используемых виртуальных машин будет использоваться стоимость в учетной записи лаборатории, имя лаборатории, значение по умолчанию или имя виртуальной машины.  В этом примере Добавление первой строки со второй строкой, начинающейся с "ааалаб/доккерлаб", даст вам общую стоимость лаборатории "доккерлаб" в учетной записи лаборатории "ааалаб".

Чтобы получить сведения о коллекции общих образов, измените тип ресурса на `Microsoft.Compute/Galleries` , что обеспечит общую стоимость коллекции образов.  Коллекции общих образов могут не отображаться в затратах в зависимости от того, где хранится коллекция.

> [!NOTE]
> Коллекция общих образов подключена к лабораторной учетной записи.  Это означает, что несколько лабораторий могут использовать одно и то же изображение.

## <a name="separating-costs"></a>Отделение затрат

Некоторые университеты использовали учетную запись лаборатории и группу ресурсов в качестве способов отделения различных классов.  Каждый класс будет иметь собственную учетную запись лаборатории и группу ресурсов. На панели анализ затрат добавьте фильтр на основе имени группы ресурсов с соответствующим именем группы ресурсов для класса, и будут видны только затраты для этого класса.  Это позволяет четко выровнять различные классы при просмотре затрат.  Функция [запланированного экспорта](https://docs.microsoft.com/azure/cost-management-billing/costs/tutorial-export-acm-data) анализа затрат позволяет скачивать затраты каждого класса в отдельных файлах.

## <a name="managing-costs"></a>Управление затратами

В зависимости от типа класса существуют способы управления затратами, позволяющие снизить вероятность запуска виртуальных машин без участия учащихся на компьютере.

### <a name="maximize-cost-control-with-auto-shutdown-settings"></a>Максимально эффективное управление затратами с помощью параметров автоматического завершения работы

Функции управления затратами с автозавершением активно позволяют предотвратить трату времени на использование виртуальных машин в лабораторных занятиях. Сочетание следующих трех функций автоматического завершения работы и отключения перехватывает большую часть случаев, когда пользователи случайно оставляют свои виртуальные машины.

> [!div class="mx-imgBorder"]
> ![Анализ стоимости подписки](./media/cost-management-guide/auto-shutdown-disconnect.png)

Эти параметры можно настроить как на уровне учетной записи лаборатории, так и на уровне лаборатории. Если параметры включены на уровне учетной записи лаборатории, они применяются ко всем лабораториям в учетной записи лаборатории. Для всех новых учетных записей лаборатории эти параметры включены по умолчанию. 

#### <a name="details-about-auto-shutdown-settings"></a>Сведения о параметрах автоматического завершения работы

* Автоматическое отключение пользователей от виртуальных машин, которые операционная система считает неактивными (только для Windows).

    > [!NOTE]
    > Этот параметр доступен только для виртуальных машин Windows.

    Если этот параметр включен, то пользователь отключается от всех машин в лаборатории, когда операционная система Windows считает, что сеанс бездействует (включая шаблоны виртуальных машин). [Определение периода простоя ОС Windows](https://docs.microsoft.com/windows/win32/taskschd/task-idle-conditions#detecting-the-idle-state) использует два критерия: 

    * Отсутствие пользователя — нет ввода с клавиатуры или мыши.
    * Недостаток потребления ресурсов — все процессоры и все диски были бездействовать в течение определенного% времени

    Пользователи увидят примерно такое сообщение внутри виртуальной машины, прежде чем они будут отключены: 

    > [!div class="mx-imgBorder"]
    > ![Анализ стоимости подписки](./media/cost-management-guide/idle-timer-expired.png)
    
    Виртуальная машина все еще работает, когда пользователь отключен. Если пользователь подключится к виртуальной машине, войдя в систему, Windows или файлы, которые были открыты или несохраненные ранее, будут по-прежнему отображаться. В этом состоянии, так как виртуальная машина работает, она по-прежнему считается активной и начисляется стоимость. 
    
    Чтобы автоматически завершить работу бездействующих виртуальных машин Windows, используйте сочетание отключенных пользователей, **когда виртуальные машины бездействуют** и **завершают работу виртуальных машин при отключении параметров пользователей** .

    Например, если настроить параметры следующим образом:
    
    * Отключать пользователей в случае бездействия виртуальных машин — 15 минут после обнаружения состояния простоя.
    * Завершать работу виртуальных машин, когда пользователи отключаются – 5 минут после отключения пользователя.
    
    Виртуальные машины Windows будут автоматически завершать работу через 20 минут после того, как пользователь прекратит их использовать. 
    
    > [!div class="mx-imgBorder"]
    > ![Анализ стоимости подписки](./media/cost-management-guide/vm-idle-diagram.png)
* Автоматически завершать работу виртуальных машин при отключении пользователей (Windows & Linux).
    
    Этот параметр поддерживает виртуальные машины Windows и Linux. Если этот параметр включен, автоматическое завершение работы будет происходить в следующих случаях:
    
    * Для подключения к Windows удаленный рабочий стол (RDP) отключен.
    * Для Linux подключение SSH отключено.
    
    > [!NOTE]
    > Поддерживаются только [определенные дистрибутивы и версии Linux](https://docs.microsoft.com/azure/virtual-machines/extensions/diagnostics-linux#supported-linux-distributions) .
    
    Вы можете указать, как долго виртуальные машины должны ожидать повторного подключения пользователя перед автоматическим завершением работы. 
* Автоматическое завершение работы виртуальных машин, которые запущены, но не подключаются пользователями.
     
    Внутри лаборатории пользователь может запустить виртуальную машину, но не подключаться к ней. Например:
    
    * Расписание в лаборатории запускает все виртуальные машины для сеанса класса, но некоторые учащиеся не отображаются и не подключаются к их компьютерам.  
    * Пользователь запускает виртуальную машину, но забывает подключиться. 
    
    Параметр "завершить работу виртуальных машин, когда пользователи не подключится" перехватит эти случаи и автоматически завершит работу виртуальных машин.  
    
Сведения о настройке и включении автоматического завершения работы виртуальных машин при отключении см. в следующих статьях:

* [Настройка автоматического завершения работы виртуальных машин для учетной записи лаборатории](how-to-configure-lab-accounts.md)
* [Настройка автоматического завершения работы виртуальных машин для лаборатории](how-to-enable-shutdown-disconnect.md)

### <a name="quota-vs-scheduled-time"></a>Квота и запланированное время

Понимание [времени квоты](classroom-labs-concepts.md#quota) и [запланированного времени](classroom-labs-concepts.md#schedules) позволит владельцу лаборатории настроить лабораторию в соответствии с потребностями профессор и учащихся.  Запланированное время — это время, когда все виртуальные машины учащихся запущены и доступны для подключения.  Обычно запланировано в ситуации, когда все студенты будут иметь собственную виртуальную машину и в течение дня, например в часы класса, профессор в течение определенного времени.  Недостаток состоит в том, что все виртуальные машины учащихся запущены и начисляются расходы, даже если студент не входит в виртуальную машину.  Время квоты — это время, выделенное каждому студенту, которое они могут использовать по своему усмотрению и часто используются для независимого изучения. Виртуальные машины не запускаются до тех пор, пока учащийся не запустит виртуальную машину.  

Лаборатория может использовать либо квоту, либо запланированное время, либо их сочетание. Если классу не требуется запланированное время, используйте только время квоты для наиболее эффективного использования виртуальных машин.

### <a name="scheduled-event---stop-only"></a>Запланированное событие — только останавливаться

В расписании можно добавить тип событий «только для отмены», при котором все компьютеры будут прекращаться в определенное время.  Некоторые владельцы лаборатории установили событие «только для остановки» для каждого дня в полночь, чтобы снизить затраты и использование квот, когда студент забыл завершить работу виртуальной машины, которую они используют.  Недостаток этого типа событий заключается в том, что все виртуальные машины будут закрыты даже в том случае, если учащийся использует виртуальную машину.

### <a name="other-costs-related-to-labs"></a>Другие затраты, связанные с лабораториями 

В службах лаборатории нет затрат, но их можно привязать к лабораторной службе.  Общая Коллекция образов может быть подключена к лабораториям, но не показана в затратах на службы лаборатории и требует затрат.  Чтобы сократить общие затраты, следует удалить все неиспользуемые образы из коллекции, так как образы наследуют затраты на хранение.  В лабораторных занятиях могут быть подключения к другому ресурсу Azure по виртуальной сети (VNet) при удалении лаборатории необходимо удалить виртуальную сеть и другие ресурсы.

## <a name="conclusion"></a>Заключение

Надеемся, что приведенные выше сведения помогут вам лучше понять затраты на использование и использовать эти средства для снижения излишней стоимости.
