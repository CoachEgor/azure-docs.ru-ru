---
title: Использование DevTest Labs в конвейерах сборки и выпуска в Azure Pipelines
description: Узнайте, как использовать лаборатории Azure DevTest в конвейерах Azure Pipelines, которые строят и выпускают конвейеры.
services: devtest-lab, lab-services
documentationcenter: na
author: spelluru
manager: femila
ms.service: lab-services
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/16/2020
ms.author: spelluru
ms.openlocfilehash: e16f3c5a0c0b2b86d6a893f541cefb275a8e7d07
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "76169237"
---
# <a name="use-devtest-labs-in-azure-pipelines-build-and-release-pipelines"></a>Использование DevTest Labs в конвейерах сборки и выпуска в Azure Pipelines
В этой статье приводится информация о том, как DevTest Labs может быть использован аименно йодр в сборке и выпуске конвейеров Azure Pipelines. 

## <a name="overall-flow"></a>Общий поток
Основной поток состоит в том, чтобы иметь **конвейер сборки,** который выполняет следующие задачи:

1. Создайте код приложения.
1. Создайте базовую среду в DevTest Labs.
1. Обновление среды с пользовательской информацией.
1. Развертывание приложения в среде DevTest Labs
1. Проверьте код. 

Как только сборка будет успешно завершена, **конвейер выпуска** будет использовать артефакты сборки для развертывания постановки или производства. 

Одним из необходимых условий является то, что вся информация, необходимая для воссоздания проверенной экосистемы, доступна в артефактах сборки, включая конфигурацию ресурсов Azure. Поскольку ресурсы Azure несут расходы при использовании, компании хотят либо контролировать, либо отслеживать использование этих ресурсов. В некоторых ситуациях шаблоны Azure Resource Manager, используемые для создания и настройки ресурсов, могут управляться другим отделом, например ИТ. Эти шаблоны могут храниться в другом репозитории. Это приводит к интересной ситуации, когда сборка будет создана и протестирована, и как код, так и конфигурация должны храниться в артефактах сборки, чтобы правильно воссоздать систему в производстве. 

Используя DevTest Labs на этапе сборки/тестирования, можно добавить шаблоны менеджера ресурсов Azure и поддерживающие файлы в источники сборки, чтобы на этапе выпуска в производство была развернута точная конфигурация, используемая для тестирования. Задача **создания среды Azure DevTest Labs** с надлежащей конфигурацией сохранит шаблоны диспетчера ресурсов в артефактах сборки. В этом примере вы будете использовать код из [учебника: Создайте веб-приложение базы данных .NET Core и S'L Database в Службе приложений Azure,](../app-service/app-service-web-tutorial-dotnetcore-sqldb.md)чтобы развернуть и протестировать веб-приложение в Azure.

![Общий поток](./media/use-devtest-labs-build-release-pipelines/overall-flow.png)

## <a name="set-up-azure-resources"></a>Настройка ресурсов Azure
Есть несколько элементов, которые должны быть созданы заранее:

- Два хранилища. Первый с кодом из учебника и шаблоном Resource Manager с двумя дополнительными VMs. Второй будет содержать базовый шаблон Azure Resource Manager Manager (существующая конфигурация).
- Группа ресурсов для развертывания производственного кода и конфигурации.
- Необходимо настроить лабораторию с [подключением к репозиторию конфигурации](devtest-lab-create-environment-from-arm.md) для конвейера сборки. Шаблон менеджера ресурсов должен быть проверен в репозитории конфигурации как azuredeploy.json с metadata.json, чтобы позволить Лабораториям DevTest распознавать и развертывать шаблон.

Конвейер сборки создаст среду DevTest Labs и развернет код для тестирования.

## <a name="set-up-a-build-pipeline"></a>Настройка конвейера сборки
В Azure Pipelines создайте конвейер сборки, используя код из [учебника: Создайте веб-приложение базы данных .NET Core и S'L в Службе приложений Azure.](../app-service/app-service-web-tutorial-dotnetcore-sqldb.md) Используйте **шаблон ASP.NET Core,** который будет заполнять необходимую задачу для создания, тестирования и публикации кода.

![Выберите шаблон ASP.NET](./media/use-devtest-labs-build-release-pipelines/select-asp-net.png)

Необходимо добавить три дополнительные задачи для создания среды в Лабораториях DevTest и развертывания в среде.

![Трубопровод с тремя задачами](./media/use-devtest-labs-build-release-pipelines/pipeline-tasks.png)

### <a name="create-environment-task"></a>Создание задачи среды
При задаче создания среды **(Azure DevTest Labs Create Environment** task) используйте списки выпадающих средств для выбора следующих значений:

- Подписка Azure.
- название лаборатории
- название репозитория
- имя шаблона (который показывает папку, в которой хранится среда). 

Мы рекомендуем использовать списки выпадающих на странице вместо того, чтобы вводить информацию вручную. Если вы вручную вводите информацию, введите полностью квалифицированные идентификаторы ресурсов Azure. Задача отображает дружественные имена вместо идентификаторов ресурсов. 

Название среды — это отображеное имя, отображаемое в DevTest Labs. Это должно быть уникальное название для каждой сборки. Например: **TestEnv$(Build.BuildId)**. 

Можно указать файл параметров или параметры для передачи информации в шаблон диспетчера ресурсов. 

Выберите переменные вывода Create на основе варианта **вывода шаблона среды** и введите эталонное имя. В этом примере введите **BaseEnv** для эталонного имени. Вы будете использовать этот BaseEnv при настройке следующей задачи. 

![Создание задачи по созданию задачи по созданию среды Azure DevTest Labs](./media/use-devtest-labs-build-release-pipelines/create-environment.png)

### <a name="populate-environment-task"></a>Задание заполнения среды
Вторая задача **(задача Azure DevTest Labs Populate Environmente)** заключается в обновлении существующей среды DevTest Labs. Задача «Создание среды» выводит **BaseEnv.environmentResourceId,** который используется для настройки названия среды для этой задачи. Шаблон ресурсного менеджера для этого примера имеет два параметра - **adminUserName** и **adminPassword.** 

![Заполнить задачу по охране окружающей среды Azure DevTest Labs](./media/use-devtest-labs-build-release-pipelines/populate-environment.png)

## <a name="app-service-deploy-task"></a>Задача развертывания службы приложений
Третьей задачей является задача **развертывания службы приложений Azure.** Тип приложения установлен на **Web App** и имя службы App установлен на **$ (WebSite)**.

![Задача развертывания службы приложений](./media/use-devtest-labs-build-release-pipelines/app-service-deploy.png)

## <a name="set-up-release-pipeline"></a>Настройка конвейера выпуска
Создается конвейер выпуска с двумя задачами: **развертывание Azure: создание или обновление группы ресурсов и** развертывание **службы приложений Azure.** 

Для первой задачи укажите имя и местоположение группы ресурсов. Местоположение шаблона является связанным артефактом. Если шаблон «Менеджер ресурсов» включает в себя связанные шаблоны, необходимо реализовать развертывание группы пользовательских ресурсов. Шаблон находится в опубликованном артефакте капли. Переопределение параметров шаблона для шаблона «Менеджер ресурсов». Оставшиеся параметры можно оставить с значениями по умолчанию. 

Для второй задачи **Развертывайте службу приложений Azure**— указать подписку Azure, выберите **Web-приложение** для **типа приложения**и **$(WebSite)** для **имени службы app.** Оставшиеся параметры можно оставить с значениями по умолчанию. 

## <a name="test-run"></a>Тестовый запуск
Теперь, когда оба конвейера настроены, вручную выстраивайте сборку и видите, как она работает. Следующим шагом является установка соответствующего триггера для сборки и подключение сборки к конвейеру выпуска.

## <a name="next-steps"></a>Дальнейшие действия
См. следующие статьи:

- [Интеграция Лабораторий Azure DevTest в конвейер непрерывной интеграции и доставки трубопроводов Azure Pipelines](devtest-lab-integrate-ci-cd-vsts.md)
- [Интеграция сред в конвейеры Azure Pipelines CI/CD](integrate-environments-devops-pipeline.md)
