---
title: Использование DevTest Labs в Azure Pipelines конвейерах сборки и выпуска | Документация Майкрософт
description: Узнайте, как использовать Azure DevTest Labs в конвейерах сборки и выпуска Azure Pipelines.
services: devtest-lab, lab-services
documentationcenter: na
author: spelluru
manager: femila
ms.service: lab-services
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/29/2019
ms.author: spelluru
ms.openlocfilehash: 032f598fed765b281d4a6a124f8855abc201ee94
ms.sourcegitcommit: 4b5dcdcd80860764e291f18de081a41753946ec9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2019
ms.locfileid: "68774496"
---
# <a name="use-devtest-labs-in-azure-pipelines-build-and-release-pipelines"></a>Использование DevTest Labs в Azure Pipelines конвейерах сборки и выпуска
Azure Pipelines в этой статье содержатся сведения о том, как DevTest Labs можно использовать в конвейерах сборки и выпуска. 

## <a name="overall-flow"></a>Общий поток
Основной поток — создать **конвейер сборки** , который выполняет следующие задачи:

1. Создайте код приложения.
1. Создайте базовую среду в DevTest Labs.
1. Обновите среду с помощью пользовательских сведений.
1. Развертывание приложения в среде DevTest Labs
1. Протестируйте код. 

После успешного завершения сборки **конвейер выпуска** будет использовать артефакты сборки для развертывания промежуточной или рабочей среды. 

Одно из необходимых локальных компонентов состоит в том, что вся информация, необходимая для повторного создания проверенной экосистемы, доступна в рамках артефактов сборки, включая настройку ресурсов Azure. По мере использования ресурсов Azure компании хотят управлять использованием этих ресурсов или контролировать их. В некоторых ситуациях Azure Resource Manager шаблоны, используемые для создания и настройки ресурсов, могут управляться другим отделом, наподобие этого. Кроме того, эти шаблоны могут храниться в другом репозитории. Она приводит к интересной ситуации, когда сборка будет создана и протестирована, и как код, так и конфигурация должны храниться в артефактах сборки для правильного воссоздания системы в рабочей среде. 

Используя DevTest Labs на этапе сборки или тестирования, можно добавить шаблоны Azure Resource Manager и вспомогательные файлы в источники сборки, чтобы на этапе выпуска точная конфигурация, используемая для тестирования, была развернута в рабочей среде. Задача **создания среды Azure DevTest Labs** с правильной конфигурацией сохранит шаблоны диспетчер ресурсов в артефактах сборки. В этом примере вы будете использовать код из [учебника: Создайте веб-приложение .NET Core и базы данных SQL в службе](../app-service/app-service-web-tutorial-dotnetcore-sqldb.md)приложений Azure, чтобы развернуть и протестировать веб-приложение в Azure.

![Общий поток](./media/use-devtest-labs-build-release-pipelines/overall-flow.png)

## <a name="set-up-azure-resources"></a>Настройка ресурсов Azure
Существует несколько элементов, которые необходимо заранее создать.

- Два хранилища. Первый из них с кодом из учебника и шаблоном диспетчер ресурсов с двумя дополнительными виртуальными машинами. Второй будет содержать базовый шаблон Azure Resource Manager (существующая конфигурация).
- Группа ресурсов для развертывания рабочего кода и конфигурации.
- Лаборатория должна быть настроена с [подключением к репозиторию конфигурации](devtest-lab-create-environment-from-arm.md) для конвейера сборки. Шаблон диспетчер ресурсов необходимо вернуть в репозиторий конфигурации в виде azuredeploy. JSON с помощью файла metadata. JSON, чтобы разрешить DevTest лабораториям распознавать и развертывать шаблон.

Конвейер сборки создаст среду DevTest Labs и развернет код для тестирования.

## <a name="set-up-a-build-pipeline"></a>Настройка конвейера сборки
В Azure pipelines создайте конвейер сборки, используя код из [учебника: Создание веб-приложения .NET Core и базы данных SQL в службе](../app-service/app-service-web-tutorial-dotnetcore-sqldb.md)приложений Azure. Используйте шаблон **ASP.NET Core** , который будет заполнять необходимую задачу для сборки, тестирования и публикации кода.

![Выбор шаблона ASP.NET](./media/use-devtest-labs-build-release-pipelines/select-asp-net.png)

Необходимо добавить три дополнительные задачи для создания среды в DevTest Labs и развертывания в среде.

![Конвейер с тремя задачами](./media/use-devtest-labs-build-release-pipelines/pipeline-tasks.png)

### <a name="create-environment-task"></a>Задача "Создание среды"
В задаче Создание среды Azure DevTest Labs (задача "**Создание среды** ") используйте раскрывающиеся списки для выбора следующих значений:

- Подписка Azure
- имя лаборатории
- Имя репозитория
- имя шаблона (который показывает папку, в которой хранится среда). 

Вместо ввода данных вручную рекомендуется использовать раскрывающиеся списки на странице. Если вы вручную вводите сведения, введите полные идентификаторы ресурсов Azure. Задача отображает понятные имена вместо идентификаторов ресурсов. 

Имя среды — это отображаемое имя, отображаемое в DevTest Labs. Оно должно быть уникальным именем для каждой сборки. Пример: **Тестенв $ (Build. BuildId)** . 

Для передачи сведений в шаблон диспетчер ресурсов можно указать файл параметров или параметры. 

Выберите **создать выходные переменные на основе параметра выходные данные шаблона среды** и введите Справочное имя. В этом примере введите **басинв** в качестве справочного имени. Этот Басинв будет использоваться при настройке следующей задачи. 

![Задача "Создание среды Azure DevTest Labs"](./media/use-devtest-labs-build-release-pipelines/create-environment.png)

### <a name="populate-environment-task"></a>Заполнение задачи среды
Вторая задача (**Azure DevTest Labs заполнение задачи среды** ) заключается в обновлении существующей среды DevTest Labs. Задача создания среды выводит **басинв. енвиронментресаурцеид** , которая используется для настройки имени среды для этой задачи. Шаблон диспетчер ресурсов для этого примера имеет два параметра — **adminUserName** и **adminPassword**. 

![Заполнение задачи среды Azure DevTest Labs](./media/use-devtest-labs-build-release-pipelines/populate-environment.png)

## <a name="app-service-deploy-task"></a>Задача развертывания службы приложений
Третья задача — задача **развертывания службы приложений Azure** . Для типа приложения задано значение **веб-приложение** , а для свойства имя службы приложений — **$ (веб-сайт)** .

![Задача развертывания службы приложений](./media/use-devtest-labs-build-release-pipelines/app-service-deploy.png)

## <a name="set-up-release-pipeline"></a>Настройка конвейера выпуска
Вы создадите конвейер выпуска с двумя задачами: **Развертывание Azure: Создайте или обновите группу** ресурсов и **разверните службу приложений Azure**. 

Для первой задачи укажите имя и расположение группы ресурсов. Расположение шаблона — это связанный артефакт. Если шаблон диспетчер ресурсов содержит связанные шаблоны, необходимо реализовать пользовательское развертывание группы ресурсов. Шаблон находится в опубликованном Drop-артефакте. Переопределите параметры шаблона для шаблона диспетчер ресурсов. Остальные параметры можно оставить значениями по умолчанию. 

Для второй задачи **разверните службу приложений Azure**, укажите подписку Azure, выберите **веб-приложение** для **типа приложения**и **$ (веб-сайт)** для **имени службы приложений**. Остальные параметры можно оставить значениями по умолчанию. 

## <a name="test-run"></a>Тестовый запуск
Теперь, когда оба конвейера настроены, вручную заставят сборку в очередь и посмотрим на работу. Следующим шагом является установка соответствующего триггера для сборки и подключение сборки к конвейеру выпуска.

## <a name="next-steps"></a>Следующие шаги
Ознакомьтесь со следующими статьями:

- [Интеграция Azure DevTest Labs в конвейер непрерывной интеграции и доставки Azure Pipelines](devtest-lab-integrate-ci-cd-vsts.md)
- [Интегрируйте среды в конвейеры Azure Pipelines CI/CD](integrate-environments-devops-pipeline.md)
