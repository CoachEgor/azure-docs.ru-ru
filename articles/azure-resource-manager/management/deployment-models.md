---
title: Развертывание с помощью Azure Resource Manager и классическая модель развертывания
description: Описывает различия между моделью развертывания диспетчера ресурсов и классической моделью развертывания (или моделью управления службами).
ms.topic: conceptual
ms.date: 02/06/2020
ms.openlocfilehash: 85691d562f2b58cdced3264de11f3dd29a7ca168
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "77064518"
---
# <a name="azure-resource-manager-vs-classic-deployment-understand-deployment-models-and-the-state-of-your-resources"></a>Развертывание с помощью Azure Resource Manager и классическое развертывание: сведения о моделях развертывания и состоянии ресурсов

> [!NOTE]
> Сведения в этой статье применимы только при миграции из классической модели развертывания в развертывание Azure Resource Manager.

В этой статье содержатся сведения о классической модели развертывания и модели развертывания с помощью Azure Resource Manager. Модель развертывания с помощью Azure Resource Manager и классическая модель представляют собой два разных способа развертывания решений Azure и управления ими. При работе с ними применяются два разных набора API, и развернутые ресурсы могут содержать важные различия. Эти две модели не совместимы друг с другом. Различия между ними описываются в этой статье.

Чтобы упростить развертывание и управление ресурсами, корпорация Майкрософт рекомендует использовать Resource Manager для всех новых ресурсов. И для повторного развертывания существующих ресурсов рекомендуется также по возможности использовать Resource Manager.

Если вы новичок в менеджере ресурсов, вы можете сначала просмотреть терминологию, определенную в обзоре менеджера [ресурсов Azure.](overview.md)

## <a name="history-of-the-deployment-models"></a>История моделей развертывания

Изначально Azure предоставлял только классическую модель развертывания. В этой модели ресурсы использовались отдельно, и их нельзя было сгруппировать. Вместо этого требовалось вручную отслеживать ресурсы, которые использовались для создание решения или приложения, а затем соответствующим образом управлять ими. Чтобы развернуть решение, требовалось либо создать каждый ресурс отдельно с помощью портала, либо создать скрипт для развертывания всех ресурсов в установленном порядке. Удаление решения выполнялось путем удаления каждого ресурса по отдельности. Вы не можете легко применить и обновить политики управления доступом для связанных ресурсов. Наконец, нельзя применять теги к ресурсам для обозначения их терминами, которые помогают отслеживать ресурсы и управлять выставлением счетов.

С появлением Resource Manager (в 2014 г.) было добавлено понятие группы ресурсов. Группа ресурсов — это контейнер для ресурсов с общим жизненным циклом. Модель развертывания диспетчера ресурсов предоставляет несколько преимуществ.

* Вы можете осуществлять развертывание, управление и мониторинг всех служб вашего решения как единой группы вместо того, чтобы работать с ними по отдельности.
* Вы можете повторно развертывать решение на протяжении всего его жизненного цикла и гарантировать, что ресурсы развертываются в согласованном состоянии.
* Вы можете применить контроль доступа ко всем ресурсам в группе, и эти политики будут автоматически применяться ко всем новым ресурсам, добавленным в группу.
* Для логического упорядочивания всех ресурсов в вашей подписке к ним можно применять теги.
* Для определения инфраструктуры решения можно использовать нотацию объектов JavaScript (JSON). Файл JSON представляет собой шаблон Resource Manager.
* Вы можете определять зависимости между ресурсами, чтобы их развертывание выполнялось в правильном порядке.

При появлении диспетчера ресурсов все ресурсы были добавлены в группы ресурсов по умолчанию. Если сейчас ресурс создается через классическое развертывание, ресурс автоматически создается в группе ресурсов по умолчанию для этой службы, даже если вы не указали эту группу ресурсов при развертывании. Однако простое существование в группе ресурсов не означает, что ресурс был преобразован в модель диспетчера ресурсов.

## <a name="understand-support-for-the-models"></a>Общие сведения о поддержке моделей развертывания

Существуют три сценария, о которых важно знать:

1. Облачные службы не поддерживают модель развертывания диспетчера ресурсов.
2. Виртуальные машины, учетные записи хранения и виртуальные сети поддерживают как модель развертывания с помощью Resource Manager, так и классическую модель.
3. Все остальные службы Azure поддерживают модель Resource Manager.

Для виртуальных машин, учетных записей хранения и виртуальных сетей, если ресурс был создан при помощи классического развертывания, необходимо продолжать работать с ним с помощью классических операций. Если виртуальная машина, учетная запись хранения или виртуальная сеть созданы с помощью модели развертывания Resource Manager, они поддерживают операции Resource Manager. Это различие следует учитывать, если в подписке содержатся как ресурсы, созданные в классической модели развертывания, так и ресурсы, созданные с помощью Resource Manager. Такое сочетание ресурсов может привести к неожиданным результатам, поскольку ресурсы не поддерживают одни и те же операции.

В некоторых случаях с помощью команды Resource Manager можно получить сведения о ресурсе, созданном с помощью классического развертывания, или выполнить административные задачи, такие как перемещение классического ресурса в другую группу ресурсов. Но эти случаи не должны складываться впечатление, что тип поддерживает операции менеджера ресурсов. Например, предположим, что имеется группа ресурсов, содержащая виртуальную машину, которая была создана с помощью классического развертывания. Если выполнить следующую команду Resource Manager PowerShell:

```powershell
Get-AzResource -ResourceGroupName ExampleGroup -ResourceType Microsoft.ClassicCompute/virtualMachines
```

Она возвращает виртуальную машину:

```powershell
Name              : ExampleClassicVM
ResourceId        : /subscriptions/{guid}/resourceGroups/ExampleGroup/providers/Microsoft.ClassicCompute/virtualMachines/ExampleClassicVM
ResourceName      : ExampleClassicVM
ResourceType      : Microsoft.ClassicCompute/virtualMachines
ResourceGroupName : ExampleGroup
Location          : westus
SubscriptionId    : {guid}
```

Однако командлет Resource Manager **Get-AzVM** возвращает только виртуальные машины, развернутые с помощью Resource Manager. Следующая команда не возвращает виртуальную машину, созданную с помощью классического развертывания.

```powershell
Get-AzVM -ResourceGroupName ExampleGroup
```

Теги поддерживаются только ресурсами, созданными с помощью диспетчера ресурсов. Вы не можете применить теги к классическим ресурсам.

## <a name="changes-for-compute-network-and-storage"></a>Изменения для вычислительных, сетевых ресурсов и ресурсов хранения

На следующей схеме показаны вычислительные, сетевые ресурсы и ресурсы хранения, развернутые с помощью Resource Manager.

![Архитектура Resource Manager](./media/deployment-models/arm_arch3.png)

Обратите внимание на следующие связи между ресурсами:

* Все ресурсы существуют в одной группе ресурсов.
* Виртуальная машина зависит от определенной учетной записи хранения, определенной в поставщике ресурсов хранилища для хранения ее дисков в хранилище BLOB-объектов (обязательном).
* Виртуальная машина ссылается на конкретную карту сетевого интерфейса, определенную в поставщике ресурсов Сети (требуется) и набор доступности, определенный в поставщике ресурсов Compute (необязательно).
* Карта сетевого интерфейса ссылается на назначенный IP-адрес виртуальной машины (обязательно), подсеть виртуальной сети для виртуальной машины (требуется) и на группу сетевой безопасности (необязательно).
* Подсеть в виртуальной сети ссылается на группу сетевой безопасности (необязательную).
* Пример балансодержателя нагрузки ссылается на пул бэкэнда IP-адресов, которые включают карту сетевого интерфейса виртуальной машины (необязательно) и ссылки на государственный или частный IP-адрес груза (необязательно).

Ниже перечислены компоненты и их связи для классического развертывания.

![классическая архитектура](./media/deployment-models/arm_arch1.png)

Классическое решение для размещения виртуальной машины включает в себя следующие компоненты:

* Требуемой облачной службой, которая выступает в роли контейнера для размещения виртуальных машин (вычислений). Виртуальные машины автоматически предоставляются с помощью карты сетевого интерфейса и IP-адреса, назначенного Azure. Кроме того, облачная служба содержит экземпляр внешней подсистемы балансировки нагрузки, общедоступный IP-адрес и конечные точки по умолчанию, чтобы разрешить трафик удаленного рабочего стола и удаленный трафик PowerShell для виртуальных машин на основе Windows, а также трафик Secure Shell (SSH) для виртуальных машин на основе Linux.
* Обязательная учетная запись хранения, которая хранит виртуальные жесткие диски для виртуальной машины, включая операционную систему, временные и дополнительные диски данных (хранение).
* Дополнительная виртуальная сеть, которая выступает в качестве дополнительного контейнера, в котором можно создать поднетированную структуру и выбрать подсеть, на которой находится виртуальная машина (сеть).

В следующей таблице описаны изменения во взаимодействии поставщиков вычислительных, сетевых ресурсов и ресурсов хранения:

| Item | Классический | Resource Manager |
| --- | --- | --- |
| Облачная служба для виртуальных машин |Облачная служба представляла собой контейнер для хранения виртуальных машин, которым требовались доступность использования на платформе и балансировка нагрузки. |Облачная служба больше не является объектом, необходимым для создания виртуальной машины в новой модели. |
| Виртуальные сети |Создание виртуальной сети для виртуальной машины является необязательным. Если включена, виртуальная сеть не может быть развернута с менеджером ресурсов. |Для виртуальной машины необходима виртуальная сеть, развернутая с помощью Resource Manager. |
| Учетные записи хранения |Виртуальная машина требует учетной записи хранения, которая хранит виртуальные жесткие диски для операционной системы, временные и дополнительные диски данных. |Для виртуальной машины необходима учетная запись хранения для хранения ее дисков в хранилище BLOB-объектов. |
| Группы доступности |Доступность на платформе указывалась путем задания одного и того же параметра AvailabilitySetName на виртуальных машинах. Максимальное число доменов сбоя — 2. |Группа доступности — это ресурс, предоставляемый поставщиком Microsoft.Compute. Виртуальные машины, требующие высокого уровня доступности, должны быть включены в группу доступности. Теперь максимальное число доменов сбоя — 3. |
| Территориальные группы |Территориальные группы требовались для создания виртуальных сетей. Однако, с введением региональных виртуальных сетей, что не требуется больше. |Для упрощения концепция территориальных групп больше не применяется в интерфейсах API, предоставляемых в диспетчере ресурсов Azure. |
| Балансировка нагрузки |При создании облачных служб предоставляется скрытая подсистема балансировки нагрузки для развернутых виртуальных машин. |Подсистема балансировки нагрузки — это ресурс, предоставляемый поставщиком Microsoft.Network. Основной сетевой интерфейс виртуальных машин, для которых необходимо сбалансировать нагрузку, должен ссылаться на подсистему балансировки нагрузки. Подсистемы балансировки нагрузки могут быть внутренними или внешними. Экземпляр подсистемы балансировки нагрузки ссылается на пул внутренних IP-адресов, который включают сетевую карту виртуальной машины (необязательно), и ссылается на общедоступный или частный IP-адрес (необязательно) подсистемы балансировки нагрузки. |
| Виртуальный IP-адрес |При добавлении виртуальной машины в облачную службу облачные службы получают виртуальный IP-адрес по умолчанию. Виртуальный IP-адрес — это адрес, связанный со скрытой подсистемой балансировки нагрузки. |Общедоступный IP-адрес — это ресурс, предоставляемый поставщиком Microsoft.Network. Общедоступный IP-адрес может быть статическим (зарезервированным) или динамическим. Динамические общедоступные IP-адреса могут быть назначены подсистеме балансировки нагрузки. Их можно защитить с помощью групп безопасности. |
| Зарезервированный IP-адрес |Вы можете зарезервировать IP-адрес в Azure и связать его с облачной службой, чтобы убедиться, что его можно назначить. |Общедоступный IP-адрес можно создать в статическом режиме, который предлагает те же возможности, что и зарезервированный IP-адрес. |
| Отдельный общедоступный IP-адрес для каждой виртуальной машины |Общедоступные IP-адреса можно также связать с виртуальной машиной напрямую. |Общедоступный IP-адрес — это ресурс, предоставляемый поставщиком Microsoft.Network. Общедоступный IP-адрес может быть статическим (зарезервированным) или динамическим. |
| Конечные точки |Чтобы входные конечные точки служили в качестве открытых элементов, обеспечивающих подключение, в определенных портах, их необходимо было настроить в виртуальной машине. Один из распространенных способов подключения к виртуальным машинам — это настройка входных конечных точек. |В подсистеме балансировки нагрузки можно настроить правила преобразования сетевых адресов (NAT) для входящих подключений, чтобы получить ту же возможность включения конечных точек в определенных портах для подключения к виртуальным машинам. |
| DNS-имя |Облачная служба получит скрытое глобальное уникальное DNS-имя. Например: `mycoffeeshop.cloudapp.net`. |DNS-имена являются необязательными параметрами, которые можно указать в ресурсе общедоступного IP-адреса. Формат полного доменного имени — `<domainlabel>.<region>.cloudapp.azure.com`. |
| Сетевые интерфейсы |Первичный и вторичный сетевой интерфейс и их свойства были определены в качестве конфигурации сети виртуальной машины. |Сетевой интерфейс — это ресурс, предоставляемый поставщиком Microsoft.Network. Жизненный цикл сетевого интерфейса не привязан к виртуальной машине. Он ссылается на назначенный виртуальной машине IP-адрес (обязательный), подсеть виртуальной сети для виртуальной машины (обязательную) и группу сетевой безопасности (необязательную). |

Сведения о подключении виртуальных сетей с помощью различных моделей развертывания см. в статье [Создание подключения между виртуальными сетями из разных моделей развертывания с помощью портала](../../vpn-gateway/vpn-gateway-connect-different-deployment-models-portal.md).

## <a name="migrate-from-classic-to-resource-manager"></a>Миграция с классической модели развертывания на модель Resource Manager

Если вы готовы перенести ресурсы из классического развертывания в развертывание диспетчеров ресурсов, см.

1. [Техническое руководство по поддерживаемому платформой переносу из классической модели в модель Azure Resource Manager](../../virtual-machines/windows/migration-classic-resource-manager-deep-dive.md)
2. [Поддерживаемый платформой перенос ресурсов IaaS из классической модели в модель Azure Resource Manager](../../virtual-machines/windows/migration-classic-resource-manager-overview.md)
3. [Перенос ресурсов IaaS из классической модели в модель Azure Resource Manager с помощью Azure PowerShell](../../virtual-machines/windows/migration-classic-resource-manager-ps.md)
4. [Перенос ресурсов IaaS из классического развертывания в развертывание с помощью Azure Resource Manager с использованием Azure CLI](../../virtual-machines/virtual-machines-linux-cli-migration-classic-resource-manager.md)

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

**Могу ли я создать виртуальную машину с помощью Resource Manager для развертывания в виртуальной сети, которая создана с помощью классической модели развертывания?**

Эта конфигурация не поддерживается. Вы не можете использовать ресурсный менеджер для развертывания виртуальной машины в виртуальную сеть, созданную с помощью классического развертывания.

**Могу ли я создать виртуальную машину с помощью Resource Manager, применив пользовательский образ, который создан с помощью классической модели развертывания?**

Эта конфигурация не поддерживается. Тем не менее, можно скопировать файлы виртуального жесткого диска из учетной записи хранения, которая была создана с помощью классической модели развертывания, и добавить их в новую учетную запись, созданную через Resource Manager.

**Как использование новых ресурсов влияет на квоту моей подписки?**

Квоты для виртуальных машин, виртуальных сетей и учетных записей хранения, созданных с помощью Azure Resource Manager, используются отдельно от других квот. Каждая подписка получает квоты для создания ресурсов с помощью новых интерфейсов API. Подробнее о дополнительных квотах см. [здесь](../../azure-resource-manager/management/azure-subscription-service-limits.md).

**Могу ли я продолжить использовать свои автоматизированные сценарии для подготовки виртуальных машин, виртуальных сетей и учетных записей хранения с помощью новых интерфейсов API Resource Manager?**

Все автоматизированные сценарии и сценарии, созданные вами, продолжают действовать в существующих виртуальных машинах и виртуальных сетях, созданных в режиме управления службами Azure. Тем не менее эти сценарии необходимо обновить, чтобы использовать новую схему создания тех же ресурсов в режиме Resource Manager.

**Где можно найти примеры шаблонов диспетчера ресурсов Azure?**

Полный набор шаблонов для начинающих можно найти на [шаблонах менеджера ресурсов Azure.](https://azure.microsoft.com/documentation/templates/)

## <a name="next-steps"></a>Дальнейшие действия

* Команды для развертывания шаблонов см. в статье [Развертывание ресурсов с использованием шаблонов Resource Manager и Azure PowerShell](../templates/deploy-powershell.md).

