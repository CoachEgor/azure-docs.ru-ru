---
title: Перемещение виртуальных машин Azure в новую подписку или группу ресурсов
description: Используйте Azure Resource Manager, чтобы переместить виртуальные машины в новую группу ресурсов или подписку.
ms.topic: conceptual
ms.date: 07/21/2020
ms.openlocfilehash: e812f2cee44fc48dccbd8ab66a3343e087790803
ms.sourcegitcommit: 3d79f737ff34708b48dd2ae45100e2516af9ed78
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/23/2020
ms.locfileid: "87063097"
---
# <a name="move-guidance-for-virtual-machines"></a>Перемещение руководств для виртуальных машин

В этой статье описываются сценарии, которые сейчас не поддерживаются, и действия по перемещению виртуальных машин с помощью резервного копирования.

## <a name="scenarios-not-supported"></a>Сценарии не поддерживаются

Следующие сценарии пока не поддерживаются.

* Управляемые диски в Зоны доступности нельзя переместить в другую подписку.
* Невозможно переместить масштабируемые наборы виртуальных машин с Load Balancer SKU "Стандартный" или общедоступный IP-адрес SKU "Стандартный".
* Виртуальные машины, созданные из ресурсов Marketplace с подключенными планами, нельзя перемещать между подписками. Отмените подготовку виртуальной машины в текущей подписке и повторите развертывание в новой подписке.
* Виртуальные машины в существующей виртуальной сети нельзя переместить в новую подписку, если вы не перемещаете все ресурсы в виртуальной сети.
* Виртуальные машины с низким приоритетом и масштабируемые наборы виртуальных машин с низким приоритетом нельзя перемещать между группами ресурсов или подписками.
* Виртуальные машины в группе доступности нельзя перемещать по отдельности.

## <a name="azure-disk-encryption"></a>Шифрование дисков Azure

Вы не можете переместить виртуальную машину, интегрированную с хранилищем ключей, для реализации [шифрования дисков Azure для виртуальных машин Linux](../../../virtual-machines/linux/disk-encryption-overview.md) или [шифрования дисков Azure для виртуальных машин Windows](../../../virtual-machines/windows/disk-encryption-overview.md). Чтобы переместить виртуальную машину, необходимо отключить шифрование.

```azurecli-interactive
az vm encryption disable --resource-group demoRG --name myVm1
```

```azurepowershell-interactive
Disable-AzVMDiskEncryption -ResourceGroupName demoRG -VMName myVm1
```

## <a name="virtual-machines-with-azure-backup"></a>Виртуальные машины с Azure Backup

Чтобы переместить виртуальные машины, настроенные с Azure Backup, необходимо удалить точки восстановления из хранилища.

Если для виртуальной машины включено [обратимое удаление](../../../backup/backup-azure-security-feature-cloud.md) , вы не сможете переместить виртуальную машину во время хранения этих точек восстановления. [Отключите обратимое удаление](../../../backup/backup-azure-security-feature-cloud.md#enabling-and-disabling-soft-delete) или подождите 14 дней после удаления точек восстановления.

### <a name="portal"></a>Портал

1. Временно остановить резервное копирование и хранить данные резервной копии.
2. Чтобы переместить виртуальные машины, настроенные с помощью Azure Backup, выполните следующие действия.

   1. Найдите расположение виртуальной машины.
   2. Найдите группу ресурсов со следующим шаблоном именования: `AzureBackupRG_<location of your VM>_1` . Например, *AzureBackupRG_westus2_1*
   3. В портал Azure установите флажок **Показывать скрытые типы**.
   4. Найдите ресурс с типом **Microsoft. COMPUTE/ресторепоинтколлектионс** , который имеет шаблон именования `AzureBackup_<name of your VM that you're trying to move>_###########` .
   5. Удалите этот ресурс. Эта операция удаляет только точки мгновенного восстановления, но не данные резервных копий в хранилище.
   6. После завершения операции удаления можно переместить виртуальную машину.

3. Переместите виртуальную машину в целевую группу ресурсов.
4. Возобновите резервное копирование.

### <a name="powershell"></a>PowerShell

* Найдите расположение виртуальной машины.
* Найдите группу ресурсов со схемой именования `AzureBackupRG_<location of your VM>_1`, например AzureBackupRG_westus2_1.
* В PowerShell используйте командлет `Get-AzResource -ResourceGroupName AzureBackupRG_<location of your VM>_1`
* Найдите ресурс с типом `Microsoft.Compute/restorePointCollections` и шаблоном именования `AzureBackup_<name of your VM that you're trying to move>_###########`.
* Удалите этот ресурс. Эта операция удаляет только точки мгновенного восстановления, но не данные резервных копий в хранилище.

### <a name="azure-cli"></a>Azure CLI

* Найдите расположение виртуальной машины.
* Найдите группу ресурсов со схемой именования `AzureBackupRG_<location of your VM>_1`, например AzureBackupRG_westus2_1.
* В CLI используйте команду `az resource list -g AzureBackupRG_<location of your VM>_1`.
* Найдите ресурс с типом `Microsoft.Compute/restorePointCollections` и шаблоном именования `AzureBackup_<name of your VM that you're trying to move>_###########`.
* Удалите этот ресурс. Эта операция удаляет только точки мгновенного восстановления, но не данные резервных копий в хранилище.

## <a name="next-steps"></a>Дальнейшие действия

* Команды для перемещения ресурсов см. в статье [Перемещение ресурсов в новую группу ресурсов или подписку](../move-resource-group-and-subscription.md).

* Сведения о перемещении хранилищ служб восстановления для резервного копирования см. в разделе [Ограничения служб восстановления](../../../backup/backup-azure-move-recovery-services-vault.md?toc=/azure/azure-resource-manager/toc.json).
