---
title: Режимы развертывания в Azure Resource Manager | Документация Майкрософт
description: В этой статье описывается, как с помощью Azure Resource Manager задать полный или пошаговый режим развертывания.
author: tfitzmac
ms.service: azure-resource-manager
ms.topic: conceptual
ms.date: 11/11/2019
ms.author: tomfitz
ms.openlocfilehash: 762b0e74e8da20d1b48703385853765d5cc643af
ms.sourcegitcommit: 44c2a964fb8521f9961928f6f7457ae3ed362694
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/12/2019
ms.locfileid: "73953228"
---
# <a name="azure-resource-manager-deployment-modes"></a>Режимы развертывания в Azure Resource Manager

При развертывании имеющихся ресурсов можно указать, что развертывание является добавочным или полным обновлением.  Различие между этими двумя режимами заключается в том, как диспетчер ресурсов обрабатывает существующие ресурсы в группе ресурсов, которые не находятся в шаблоне. По умолчанию используется пошаговый режим.

Для обоих режимов Resource Manager пытается создать все ресурсы, указанные в шаблоне. Если ресурс уже существует в группе ресурсов и его параметры не изменились, для этого ресурса не выполняются операции. Если значения свойств ресурса были изменены, они обновятся в ресурсе. При попытке обновить расположение или тип имеющегося ресурса развертывание завершится ошибкой. Вместо этого вы можете развернуть новый ресурс нужного вам типа с необходимым расположением.

## <a name="complete-mode"></a>Полный режим

При использовании полного режима Resource Manager **удаляет** ресурсы, которые существуют в группе ресурсов, но не указаны в шаблоне.

Если шаблон содержит ресурс, который не развернут, так как [условие](conditional-resource-deployment.md) принимает значение false, результат зависит от того, какая версия REST API используется для развертывания шаблона. Если вы используете более раннюю версию, чем 2019-05-10, ресурс **не удаляется**. В 2019-05-10 или более поздней версии ресурс **удаляется**. Последние версии Azure PowerShell и Azure CLI удаляют ресурс.

Будьте внимательны при использовании полного режима с [циклами копирования](resource-group-create-multiple.md). Все ресурсы, не указанные в шаблоне после разрешения цикла копирования, удаляются.

Если развернуть в [шаблоне несколько групп ресурсов](resource-manager-cross-resource-group-deployment.md), то ресурсы в группе ресурсов, указанной в операции развертывания, могут быть удалены. Ресурсы во вторичных группах ресурсов не удаляются.

Существуют некоторые отличия в том, как типы ресурсов обрабатывают Удаление завершенного режима. Родительские ресурсы автоматически удаляются, если находятся не на шаблоне, который развертывается в полном режиме. Некоторые дочерние ресурсы не удаляются автоматически, если находятся вне шаблона. Однако эти дочерние ресурсы удаляются, если родительский ресурс удаляется. 

Например, если ваша группа ресурсов содержит зону DNS (тип ресурса Microsoft.Network/dnsZones) и запись CNAME (тип ресурса Microsoft.Network/dnsZones/CNAME), то зона DNS является родительским ресурсом для записи CNAME. Если вы используете полный режим во время развертывания и не включаете в вашем шаблоне зону DNS, то и зона DNS, и запись CNAME удаляться. Если вы включили зону DNS в шаблон, но не включили запись CNAME, CNAME не будет удалена. 

Дополнительные сведения об удалении разных типов ресурсов см. в статье [Deletion of Azure resources for complete mode deployments](complete-mode-deletion.md) (Удаление ресурсов Azure для развертываний в полном режиме).

Если группа ресурсов [заблокирована](resource-group-lock-resources.md), то полный режим не удаляет ресурсы.

> [!NOTE]
> Только шаблоны корневого уровня поддерживают режим полного развертывания. Для [связанных или вложенных шаблонов](resource-group-linked-templates.md) необходимо использовать добавочный режим. 
>
> [Развертывания уровня подписки](deploy-to-subscription.md) не поддерживают полный режим.
>
> В настоящее время портал не поддерживает полный режим.
>

## <a name="incremental-mode"></a>Пошаговый режим

В пошаговом режиме Resource Manager **оставляет без изменения** ресурсы, которые существуют в группе ресурсов, но не указаны в шаблоне.

Однако при повторном развертывании существующего ресурса в инкрементном режиме результат будет другим. Укажите все свойства ресурса, а не только те, которые вы обновляете. Распространенным неверным пониманием является то, что свойства, которые не указаны, остаются неизменными. Если вы не укажете определенные свойства, Resource Manager интерпретирует это обновление как перезапись таких значений.

## <a name="example-result"></a>Пример результата

Чтобы понять различие между инкрементным и полным режимом, рассмотрим следующий сценарий.

**Группа ресурсов** содержит:

* ресурс А;
* ресурс Б;
* ресурс В.

**Шаблон** содержит:

* ресурс А;
* ресурс Б;
* ресурс Г.

При развертывании в **пошаговом** режиме группа ресурсов содержит:

* ресурс А;
* ресурс Б;
* ресурс В.
* ресурс Г.

При развертывании в **полном** режиме ресурс В будет удален. Группа ресурсов содержит:

* ресурс А;
* ресурс Б;
* ресурс Г.

## <a name="set-deployment-mode"></a>Установка режима развертывания

Чтобы установить режим развертывания при развертывании с помощью PowerShell, используйте параметр `Mode`.

```azurepowershell-interactive
New-AzResourceGroupDeployment `
  -Mode Complete `
  -Name ExampleDeployment `
  -ResourceGroupName ExampleResourceGroup `
  -TemplateFile c:\MyTemplates\storage.json
```

Чтобы установить режим развертывания при развертывании с помощью Azure CLI, используйте параметр `mode`.

```azurecli-interactive
az group deployment create \
  --name ExampleDeployment \
  --mode Complete \
  --resource-group ExampleGroup \
  --template-file storage.json \
  --parameters storageAccountType=Standard_GRS
```

В примере ниже показан связанный шаблон с добавочным режимом развертывания:

```json
"resources": [
  {
      "apiVersion": "2017-05-10",
      "name": "linkedTemplate",
      "type": "Microsoft.Resources/deployments",
      "properties": {
          "mode": "Incremental",
          <nested-template-or-external-template>
      }
  }
]
```

## <a name="next-steps"></a>Дополнительная информация

* Сведения о создании шаблонов Resource Manager см. в статье [Создание шаблонов диспетчера ресурсов Azure](resource-group-authoring-templates.md).
* Сведения о развертывании ресурсов см. в статье [Развертывание ресурсов с использованием шаблонов Resource Manager и Azure PowerShell](resource-group-template-deploy.md).
* Чтобы просмотреть операции для поставщика ресурсов, ознакомьтесь с [Azure REST API](/rest/api/).
