---
title: Шаблоны Azure Resource Manager
description: Описывает использование шаблонов Azure Resource Manager для развертывания ресурсов.
author: tfitzmac
ms.service: azure-resource-manager
ms.topic: conceptual
ms.date: 09/25/2019
ms.author: tomfitz
ms.openlocfilehash: 96f140cfa5e6151ad53ca242d1fc87ba3397316e
ms.sourcegitcommit: 29880cf2e4ba9e441f7334c67c7e6a994df21cfe
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/26/2019
ms.locfileid: "71300154"
---
# <a name="azure-resource-manager-templates"></a>Шаблоны Azure Resource Manager

При переходе в облако многие группы приняли гибкие методы разработки. Эти команды быстро проходят итерацию. Они должны постоянно развертывать свои решения в облаке и знать, что их инфраструктура находится в надежном состоянии. После того как инфраструктура стала частью итеративного процесса, подразделение между операциями и разработкой исчезло. Группам необходимо управлять инфраструктурой и кодом приложения с помощью единого процесса.

Чтобы удовлетворить эти сложности, можно автоматизировать развертывания и использовать методику инфраструктуры в качестве кода. В коде определяется инфраструктура, которую необходимо развернуть. Код инфраструктуры станет частью вашего проекта. Как и в случае с кодом приложения, код инфраструктуры сохраняется в исходном репозитории и версии. Любой участник команды может запустить код и развернуть аналогичные среды.

Чтобы реализовать инфраструктуру как код для решений Azure, используйте шаблоны Azure Resource Manager. Шаблон — это файл нотация объектов JavaScript (JSON), который определяет инфраструктуру и конфигурацию проекта. Шаблон использует декларативный синтаксис, который позволяет указать объект, который вы собираетесь развернуть. При этом, для развертывания объекта, не нужно писать последовательность команд. В шаблоне укажите ресурсы для развертывания и свойства этих ресурсов.

## <a name="why-choose-resource-manager-templates"></a>Зачем выбирать шаблоны диспетчер ресурсов?

Если вы пытаетесь выбрать использование шаблонов диспетчер ресурсов и одной из других инфраструктур в качестве служб кода, рассмотрите следующие преимущества использования шаблонов:

* **Декларативный синтаксис**: Шаблоны диспетчер ресурсов позволяют декларативно создавать и развертывать всю инфраструктуру Azure. Например, можно развернуть не только виртуальные машины, но и сетевую инфраструктуру, системы хранения и другие ресурсы, которые вам могут потребоваться.

* **Повторяемые результаты**: Повторно разверните инфраструктуру на протяжении всего жизненного цикла разработки и доверите единообразное развертывание ресурсов. Шаблоны — идемпотентными. Это означает, что один и тот же шаблон можно развернуть несколько раз и получить те же типы ресурсов в одном и том же состоянии. Можно разработать один шаблон, представляющий нужное состояние, а не разрабатывать множество отдельных шаблонов для представления обновлений.

* **Оркестрация**. Вам не нужно беспокоиться о сложности операций упорядочивания. Диспетчер ресурсов управляет развертыванием взаимозависимых ресурсов, чтобы они были созданы в правильном порядке. По возможности диспетчер ресурсов развертывать ресурсы параллельно, чтобы развертывания закончится быстрее, чем последовательное развертывание. Шаблон развертывается с помощью одной команды, а не с помощью нескольких императивных команд.

   ![Сравнение Шаблоны развертывания](./media/template-deployment-overview/template-processing.png)

* **Встроенная проверка**: Шаблон развертывается только после прохождения проверки. Диспетчер ресурсов проверяет шаблон перед началом развертывания, чтобы убедиться, что развертывание будет выполняться. Скорее всего, развертывание будет остановлено в состоянии "половина завершено".

* **Модульные файлы**: Вы можете разбить шаблоны на более мелкие, многократно используемые компоненты и связать их вместе во время развертывания. Можно также вложить один шаблон в другие шаблоны.

* **Создайте любой ресурс Azure**: Вы можете сразу же использовать новые службы и функции Azure в шаблонах. Как только поставщик ресурсов познакомится с новыми ресурсами, вы можете развернуть эти ресурсы с помощью шаблонов. Перед использованием новых служб не нужно ждать обновления средств или модулей.

* **Отслеживание развертываний**: В портал Azure можно просмотреть историю развертывания и получить сведения о развертывании шаблона. Можно увидеть развернутый шаблон, значения параметров, переданные в, и все выходные значения. Другие инфраструктуры, так как службы кода, не прописываются на портале.

   ![История развертывания](./media/template-deployment-overview/deployment-history.png)

* **Политика как код**: [Политика Azure](../governance/policy/overview.md) — это политика, которая является платформой кода для автоматизации управления. Если вы используете политики Azure, при развертывании с помощью шаблонов исправление политики выполняется на несоответствующих ресурсах.

* Схемы **развертывания**: Вы можете воспользоваться преимуществами [схем](../governance/blueprints/overview.md) , предоставляемых корпорацией Майкрософт, чтобы удовлетворить нормативные требования и стандарты соответствия. Эти схемы содержат предварительно созданные шаблоны для различных архитектур.

* **Интеграция CI и CD**: Шаблоны можно интегрировать в средства непрерывной интеграции и непрерывного развертывания (CI/CD), которые могут автоматизировать конвейеры выпуска для быстрого и надежного обновления приложений и инфраструктуры. С помощью задачи "шаблоны Azure DevOps и диспетчер ресурсов" можно использовать Azure Pipelines для непрерывного создания и развертывания проектов шаблонов Azure Resource Manager. Дополнительные сведения см. в статье [проект VS с конвейерами](./vs-resource-groups-project-devops-pipelines.md) и [Непрерывная интеграция с Azure pipelines](./resource-manager-tutorial-use-azure-pipelines.md).

* **Экспортируемый код**: Чтобы получить шаблон для существующей группы ресурсов, можно экспортировать текущее состояние группы ресурсов или просмотреть шаблон, используемый для конкретного развертывания. Чтобы лучше понять синтаксис шаблона, изучите [экспортированный шаблон](export-template-portal.md).

* **Средства разработки**: Шаблоны можно создавать с помощью [Visual Studio Code](resource-manager-tools-vs-code.md) и расширения "средство шаблонов". Вы получаете IntelliSense, выделение синтаксиса, встроенную справку и многие другие языковые функции. В дополнение к Visual Studio Code можно также использовать [Visual Studio](./vs-azure-tools-resource-groups-deployment-projects-create-deploy.md).

## <a name="template-file"></a>Файл шаблона

В шаблоне можно создавать [выражения шаблонов](template-expressions.md) , расширяющие возможности JSON. В этих выражениях используются [функции](resource-group-template-functions.md) , предоставляемые диспетчер ресурсов.

Шаблон содержит следующие разделы:

* [Параметры](template-parameters.md) — укажите значения во время развертывания, которые позволяют использовать один и тот же шаблон в различных средах.

* [Переменные](template-variables.md) — определяют значения, которые повторно используются в шаблонах. Они могут быть построены на основе значений параметров.

* [Определяемые пользователем функции](template-user-defined-functions.md) — создание настраиваемых функций, упрощающих шаблон.

* [Ресурсы](resource-group-authoring-templates.md#resources) — укажите ресурсы для развертывания.

* [Выходные данные](template-outputs.md) — возвращаемые значения из развернутых ресурсов.

## <a name="template-deployment-process"></a>Процесс Шаблоны развертывания

При развертывании шаблона диспетчер ресурсов преобразует его в REST API операции. Например, Resource Manager получает шаблон со следующим определением ресурса:

```json
"resources": [
  {
    "apiVersion": "2016-01-01",
    "type": "Microsoft.Storage/storageAccounts",
    "name": "mystorageaccount",
    "location": "westus",
    "sku": {
      "name": "Standard_LRS"
    },
    "kind": "Storage",
    "properties": {
    }
  }
]
```

В таком случае Resource Manager преобразует определение в операцию REST API, которая отправляется поставщику ресурсов Microsoft.Storage:

```HTTP
PUT
https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Storage/storageAccounts/mystorageaccount?api-version=2016-01-01
REQUEST BODY
{
  "location": "westus",
  "properties": {
  }
  "sku": {
    "name": "Standard_LRS"
  },
  "kind": "Storage"
}
```

## <a name="template-design"></a>Разработка шаблона

Вы выбираете определение шаблонов и групп ресурсов по своему усмотрению в зависимости от того, как нужно управлять решением. Например, трехуровневое приложение можно развернуть из одного шаблона в одной группе ресурсов.

![трехуровневый шаблон](./media/template-deployment-overview/3-tier-template.png)

Но определять всю инфраструктуру в одном шаблоне не нужно. Во многих случаях целесообразно разделять требования к развертыванию между несколькими наборами шаблонов, предназначенными для определенных задач. Эти шаблоны можно многократно использовать для различных решений. Чтобы развернуть конкретное решение, создайте главный шаблон, связывающий все необходимые шаблоны. Ниже показано, как развернуть трехуровневое решение из родительского шаблона, в который входят три вложенных шаблона.

![вложенный шаблон](./media/template-deployment-overview/nested-tiers-template.png)

Если в вашем случае у уровней отдельные жизненные циклы, эти уровни можно развернуть в отдельные группы ресурсов. Обратите внимание, что ресурсы по-прежнему могут быть связаны с ресурсами в других группах.

![шаблон уровня](./media/template-deployment-overview/tier-templates.png)

Дополнительные сведения см. в статье [Использование связанных шаблонов в Azure Resource Manager](resource-group-linked-templates.md).

## <a name="next-steps"></a>Следующие шаги

* Сведения о свойствах в файлах шаблонов см. в разделе сведения о [структуре и синтаксисе шаблонов Azure Resource Manager](resource-group-authoring-templates.md).
* Дополнительные сведения об экспорте шаблонов см [. в разделе Краткое руководство. по созданию и развертыванию шаблонов Azure Resource Manager с помощью портала Azure](./resource-manager-quickstart-create-templates-use-the-portal.md).
