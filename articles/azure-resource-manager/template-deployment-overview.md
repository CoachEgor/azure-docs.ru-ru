---
title: Шаблоны Azure Resource Manager
description: Описывает использование шаблонов Azure Resource Manager для развертывания ресурсов.
author: tfitzmac
ms.service: azure-resource-manager
ms.topic: conceptual
ms.date: 09/05/2019
ms.author: tomfitz
ms.openlocfilehash: 4f273a04322246a2b4112c0b5b8a062732bab555
ms.sourcegitcommit: 88ae4396fec7ea56011f896a7c7c79af867c90a1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/06/2019
ms.locfileid: "70390775"
---
# <a name="azure-resource-manager-templates"></a>Шаблоны Azure Resource Manager

При переходе в облако многие группы приняли гибкие методы разработки. Эти команды быстро проходят итерацию. Они должны постоянно и надежно развертывать свои решения в облаке. Разделение между операциями и разработкой исчезло, так как группам требуется управлять инфраструктурой и исходным кодом в одном процессе.

Одним из решений этой проблемы является Автоматизация развертывания и использование методики инфраструктуры в качестве кода. Вы используете код, чтобы определить, что необходимо развернуть, и управлять этим кодом с помощью того же процесса, что и исходный код. Инфраструктура сохраняется в виде кода в исходном репозитории и версии.

Azure Resource Manager позволяет реализовать инфраструктуру как код с помощью шаблонов диспетчер ресурсов. Шаблон — это файл нотация объектов JavaScript (JSON), который содержит инфраструктуру и конфигурацию решения Azure. В шаблоне используется декларативный синтаксис, который позволяет указать, что вы планируете развернуть, не создавая последовательность команд программирования для ее создания. В шаблоне укажите ресурсы для развертывания и свойства этих ресурсов.

## <a name="benefits-of-resource-manager-templates"></a>Преимущества шаблонов диспетчер ресурсов

Шаблоны диспетчер ресурсов предоставляют несколько преимуществ. Можно выполнить следующие действия:

* Развертывайте, контролируйте и отслеживайте все ресурсы решения как группу, а не обрабатывая эти ресурсы по отдельности.

* Повторно разверните решение на протяжении всего жизненного цикла разработки и доверите, что ресурсы развернуты в согласованном состоянии.

* Управляйте своей инфраструктурой с помощью декларативных шаблонов, а не сценариев.

* Определите зависимости между ресурсами, чтобы они были развернуты в правильном порядке.

* Немедленно Используйте преимущества новых версий и служб, так как не требуется выполнять промежуточную работу других сторон.

## <a name="template-file"></a>Файл шаблона

В шаблоне можно создавать [выражения шаблонов](template-expressions.md) , расширяющие возможности JSON. В этих выражениях используются [функции](resource-group-template-functions.md) , предоставляемые диспетчер ресурсов.

Шаблон содержит следующие разделы:

* [Параметры](template-parameters.md) — укажите значения во время развертывания, которые позволяют использовать один и тот же шаблон в различных средах.

* [Переменные](template-variables.md) — определяют значения, используемые в шаблонах.

* [Определяемые пользователем функции](template-user-defined-functions.md) — создание настраиваемых функций, упрощающих шаблон.

* [Ресурсы](resource-group-authoring-templates.md#resources) — укажите ресурсы для развертывания.

* [Выходные данные](template-outputs.md) — возвращаемые значения из развернутых ресурсов.

## <a name="dependencies"></a>Зависимости

Azure Resource Manager анализирует зависимости, чтобы обеспечить создание ресурсов в правильном порядке. Если один ресурс зависит от значения в другом ресурсе (например, виртуальная машина, для которой требуется учетная запись хранения диска), можно задать зависимость. Дополнительные сведения см. в статье [Определение зависимостей в шаблонах диспетчера ресурсов Azure](resource-group-define-dependencies.md).

## <a name="conditional-deployment"></a>Условное развертывание

Вы можете добавить ресурс в шаблон и при необходимости развернуть его. Как правило, передается значение параметра, указывающее, нужно ли развертывать ресурс. Дополнительные сведения см. [в разделе условное развертывание в шаблонах диспетчер ресурсов](conditional-resource-deployment.md).

## <a name="create-multiple-instances"></a>Развертывание нескольких экземпляров

Вместо повторяющихся блоков JSON в шаблоне много раз, можно использовать элемент Copy для указания более чем одного экземпляра переменной, свойства или ресурса. Дополнительные сведения см. [в разделе ресурс, свойство или итерация переменной в шаблонах Azure Resource Manager](resource-group-create-multiple.md).

## <a name="export-templates"></a>Экспорт шаблонов

Чтобы получить шаблон для существующей группы ресурсов, можно экспортировать текущее состояние группы ресурсов или просмотреть шаблон, используемый для конкретного развертывания. Чтобы лучше понять синтаксис шаблона, изучите [экспортированный шаблон](export-template-portal.md).

Если решение создается на портале, оно автоматически включает в себя шаблон развертывания. Вам не нужно создавать шаблон с нуля, так как можно начать с шаблона для своего решения и настроить его в соответствии с конкретными потребностями. Пример см. в [кратком руководстве по созданию и развертыванию шаблонов Azure Resource Manager с помощью портала Azure](./resource-manager-quickstart-create-templates-use-the-portal.md).

## <a name="template-deployment-process"></a>Процесс Шаблоны развертывания

При развертывании шаблона диспетчер ресурсов анализирует шаблон и преобразует его синтаксис в операции REST API. Например, Resource Manager получает шаблон со следующим определением ресурса:

```json
"resources": [
  {
    "apiVersion": "2016-01-01",
    "type": "Microsoft.Storage/storageAccounts",
    "name": "mystorageaccount",
    "location": "westus",
    "sku": {
      "name": "Standard_LRS"
    },
    "kind": "Storage",
    "properties": {
    }
  }
]
```

В таком случае Resource Manager преобразует определение в операцию REST API, которая отправляется поставщику ресурсов Microsoft.Storage:

```HTTP
PUT
https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Storage/storageAccounts/mystorageaccount?api-version=2016-01-01
REQUEST BODY
{
  "location": "westus",
  "properties": {
  }
  "sku": {
    "name": "Standard_LRS"
  },
  "kind": "Storage"
}
```

Если ресурс уже существует в группе ресурсов и запрос не содержит обновлений свойств, никакие действия не предпринимаются. Если ресурс существует, но свойства изменились, то существующий ресурс будет обновлен. Если ресурс не существует, создается новый ресурс. Такой подход позволяет обеспечить безопасность повторного развертывания шаблона и выяснить, что ресурсы остаются в стабильном состоянии.

## <a name="template-design"></a>Разработка шаблона

Вы выбираете определение шаблонов и групп ресурсов по своему усмотрению в зависимости от того, как нужно управлять решением. Например, трехуровневое приложение можно развернуть из одного шаблона в одной группе ресурсов.

![трехуровневый шаблон](./media/template-deployment-overview/3-tier-template.png)

Но определять всю инфраструктуру в одном шаблоне не нужно. Во многих случаях целесообразно разделять требования к развертыванию между несколькими наборами шаблонов, предназначенными для определенных задач. Эти шаблоны можно многократно использовать для различных решений. Чтобы развернуть конкретное решение, создайте главный шаблон, связывающий все необходимые шаблоны. Ниже показано, как развернуть трехуровневое решение из родительского шаблона, в который входят три вложенных шаблона.

![вложенный шаблон](./media/template-deployment-overview/nested-tiers-template.png)

Если в вашем случае у уровней отдельные жизненные циклы, эти уровни можно развернуть в отдельные группы ресурсов. Обратите внимание, что ресурсы по-прежнему могут быть связаны с ресурсами в других группах.

![шаблон уровня](./media/template-deployment-overview/tier-templates.png)

Дополнительные сведения см. в статье [Использование связанных шаблонов в Azure Resource Manager](resource-group-linked-templates.md).

## <a name="next-steps"></a>Следующие шаги

* Сведения о свойствах в файлах шаблонов см. в разделе сведения о [структуре и синтаксисе шаблонов Azure Resource Manager](resource-group-authoring-templates.md).
* Чтобы приступить к разработке шаблона, см. статью [использование Visual Studio Code для создания шаблонов Azure Resource Manager](resource-manager-tools-vs-code.md).


