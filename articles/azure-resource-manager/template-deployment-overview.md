---
title: Шаблоны Azure Resource Manager
description: Описывает использование шаблонов Azure Resource Manager для развертывания ресурсов.
author: tfitzmac
ms.service: azure-resource-manager
ms.topic: conceptual
ms.date: 09/07/2019
ms.author: tomfitz
ms.openlocfilehash: 61e9bbabee969280c07521edb05d67ba68c0c58e
ms.sourcegitcommit: b7b0d9f25418b78e1ae562c525e7d7412fcc7ba0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/08/2019
ms.locfileid: "70802025"
---
# <a name="azure-resource-manager-templates"></a>Шаблоны Azure Resource Manager

При переходе в облако многие группы приняли гибкие методы разработки. Эти команды быстро проходят итерацию. Они должны постоянно развертывать свои решения в облаке и знать, что их инфраструктура находится в надежном состоянии. После того как инфраструктура стала частью итеративного процесса, подразделение между операциями и разработкой исчезло. Группам необходимо управлять инфраструктурой и кодом приложения с помощью единого процесса.

Чтобы удовлетворить эти сложности, можно автоматизировать развертывания и использовать методику инфраструктуры в качестве кода. В коде определяется инфраструктура, которую необходимо развернуть. Код инфраструктуры станет частью вашего проекта. Как и в случае с кодом приложения, код инфраструктуры сохраняется в исходном репозитории и версии. Любой участник команды может запустить код и развернуть аналогичные среды.

Чтобы реализовать инфраструктуру как код для решений Azure, используйте шаблоны Azure Resource Manager. Шаблон — это файл нотация объектов JavaScript (JSON), который определяет инфраструктуру и конфигурацию проекта. В шаблоне используется декларативный синтаксис, который позволяет указать, что вы планируете развернуть, не создавая последовательность команд программирования для ее создания. В шаблоне укажите ресурсы для развертывания и свойства этих ресурсов.

## <a name="benefits-of-resource-manager-templates"></a>Преимущества шаблонов диспетчер ресурсов

Шаблоны диспетчер ресурсов предоставляют следующие преимущества:

* Развертывайте, контролируйте и отслеживайте все ресурсы решения как группу, а не обрабатывая эти ресурсы по отдельности.

* Повторно разверните решение на протяжении всего жизненного цикла разработки и доверите, что ресурсы развернуты в согласованном состоянии.

* Управляйте своей инфраструктурой с помощью декларативных шаблонов, а не сценариев.

Если вы пытаетесь выбрать использование шаблонов диспетчер ресурсов или одной из других инфраструктур в качестве служб кода, рассмотрим следующие шаблоны преимуществ для этих служб:

* Новые службы и функции Azure немедленно доступны в шаблонах. Как только поставщик ресурсов познакомится с новыми ресурсами, вы можете развернуть эти ресурсы с помощью шаблонов. С другой инфраструктурой в качестве служб кода необходимо подождать, пока третьи стороны реализуют интерфейсы для новых ресурсов.

* Развертывания шаблонов обрабатываются с помощью одной отправки шаблона, а не с помощью нескольких императивных команд. Диспетчер ресурсов управляет развертыванием взаимозависимых ресурсов, чтобы они были созданы в правильном порядке. Он анализирует шаблон и определяет правильный порядок развертывания на основе ссылок между ресурсами.

   ![Сравнение Шаблоны развертывания](./media/template-deployment-overview/template-processing.png)

* Развертывание шаблонов ведется в портал Azure. Вы можете просмотреть историю развертывания и получить сведения о развертывании шаблона. Можно увидеть развернутый шаблон, значения параметров, переданные в, и все выходные значения. Другие инфраструктуры, так как службы кода, не прописываются на портале.

   ![История развертывания](./media/template-deployment-overview/deployment-history.png)

* Развертывание шаблонов пройдет проверку предварительной проверки. Диспетчер ресурсов проверяет шаблон перед началом развертывания, чтобы убедиться, что развертывание будет выполняться. Скорее всего, развертывание будет остановлено в состоянии "половина завершено".

* Если вы используете [политики Azure](../governance/policy/overview.md), при развертывании с помощью шаблонов исправление политики выполняется на несоответствующих ресурсах.

* Корпорация Майкрософт предоставляет [схемы развертывания для](../governance/blueprints/overview.md) удовлетворения нормативных требований и стандартов соответствия требованиям. Эти схемы содержат предварительно созданные шаблоны для различных архитектур.

## <a name="idempotent"></a>Идемпотентными

Идемпотентными просто означает, что одни и те же операции можно выполнять много раз и получить тот же результат. Развертывание шаблона диспетчер ресурсов — идемпотентными. Один и тот же шаблон можно развернуть несколько раз и получить те же типы ресурсов в том же состоянии. Эта концепция важна, так как это означает, что вы получаете целостные результаты при повторном развертывании шаблона в существующей группе ресурсов или при развертывании шаблона в новой группе ресурсов.

Предположим, что вы развернули три ресурса в группе ресурсов, а затем решите, что вам нужно добавить четвертый ресурс. Вместо создания нового шаблона, который содержит только новый ресурс, можно добавить четвертый ресурс в существующий шаблон. При развертывании нового шаблона в группе ресурсов, которая уже содержит три ресурса, диспетчер ресурсов определяет, какие действия следует предпринять.

Если ресурс существует в группе ресурсов и запрос не содержит обновлений свойств, никакие действия не предпринимаются. Если ресурс существует, но свойства изменились, то существующий ресурс будет обновлен. Если ресурс не существует, создается новый ресурс.

У вас есть уверенность, что после завершения развертывания ресурсы всегда находятся в ожидаемом состоянии.

## <a name="template-file"></a>Файл шаблона

В шаблоне можно создавать [выражения шаблонов](template-expressions.md) , расширяющие возможности JSON. В этих выражениях используются [функции](resource-group-template-functions.md) , предоставляемые диспетчер ресурсов.

Шаблон содержит следующие разделы:

* [Параметры](template-parameters.md) — укажите значения во время развертывания, которые позволяют использовать один и тот же шаблон в различных средах.

* [Переменные](template-variables.md) — определяют значения, которые повторно используются в шаблонах. Они могут быть построены на основе значений параметров.

* [Определяемые пользователем функции](template-user-defined-functions.md) — создание настраиваемых функций, упрощающих шаблон.

* [Ресурсы](resource-group-authoring-templates.md#resources) — укажите ресурсы для развертывания.

* [Выходные данные](template-outputs.md) — возвращаемые значения из развернутых ресурсов.

## <a name="template-features"></a>Функции шаблонов

Диспетчер ресурсов анализирует зависимости, чтобы убедиться, что ресурсы создаются в правильном порядке. Большинство зависимостей определяется неявно. Однако можно явно задать зависимость, чтобы убедиться, что один ресурс развертывается перед другим ресурсом. Дополнительные сведения см. в статье [Определение зависимостей в шаблонах диспетчера ресурсов Azure](resource-group-define-dependencies.md).

Вы можете добавить ресурс в шаблон и при необходимости развернуть его. Как правило, передается значение параметра, указывающее, нужно ли развертывать ресурс. Дополнительные сведения см. [в разделе условное развертывание в шаблонах диспетчер ресурсов](conditional-resource-deployment.md).

Вместо повторяющихся блоков JSON в шаблоне много раз, можно использовать элемент Copy для указания более чем одного экземпляра переменной, свойства или ресурса. Дополнительные сведения см. [в разделе ресурс, свойство или итерация переменной в шаблонах Azure Resource Manager](resource-group-create-multiple.md).

## <a name="export-templates"></a>Экспорт шаблонов

Чтобы получить шаблон для существующей группы ресурсов, можно экспортировать текущее состояние группы ресурсов или просмотреть шаблон, используемый для конкретного развертывания. Чтобы лучше понять синтаксис шаблона, изучите [экспортированный шаблон](export-template-portal.md).

Если решение создается на портале, оно автоматически включает в себя шаблон развертывания. Вам не нужно создавать шаблон с нуля, так как можно начать с шаблона для своего решения и настроить его в соответствии с конкретными потребностями. Пример см. в [кратком руководстве по созданию и развертыванию шаблонов Azure Resource Manager с помощью портала Azure](./resource-manager-quickstart-create-templates-use-the-portal.md).

## <a name="template-deployment-process"></a>Процесс Шаблоны развертывания

При развертывании шаблона диспетчер ресурсов преобразует его в REST API операции. Например, Resource Manager получает шаблон со следующим определением ресурса:

```json
"resources": [
  {
    "apiVersion": "2016-01-01",
    "type": "Microsoft.Storage/storageAccounts",
    "name": "mystorageaccount",
    "location": "westus",
    "sku": {
      "name": "Standard_LRS"
    },
    "kind": "Storage",
    "properties": {
    }
  }
]
```

В таком случае Resource Manager преобразует определение в операцию REST API, которая отправляется поставщику ресурсов Microsoft.Storage:

```HTTP
PUT
https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Storage/storageAccounts/mystorageaccount?api-version=2016-01-01
REQUEST BODY
{
  "location": "westus",
  "properties": {
  }
  "sku": {
    "name": "Standard_LRS"
  },
  "kind": "Storage"
}
```

## <a name="template-design"></a>Разработка шаблона

Вы выбираете определение шаблонов и групп ресурсов по своему усмотрению в зависимости от того, как нужно управлять решением. Например, трехуровневое приложение можно развернуть из одного шаблона в одной группе ресурсов.

![трехуровневый шаблон](./media/template-deployment-overview/3-tier-template.png)

Но определять всю инфраструктуру в одном шаблоне не нужно. Во многих случаях целесообразно разделять требования к развертыванию между несколькими наборами шаблонов, предназначенными для определенных задач. Эти шаблоны можно многократно использовать для различных решений. Чтобы развернуть конкретное решение, создайте главный шаблон, связывающий все необходимые шаблоны. Ниже показано, как развернуть трехуровневое решение из родительского шаблона, в который входят три вложенных шаблона.

![вложенный шаблон](./media/template-deployment-overview/nested-tiers-template.png)

Если в вашем случае у уровней отдельные жизненные циклы, эти уровни можно развернуть в отдельные группы ресурсов. Обратите внимание, что ресурсы по-прежнему могут быть связаны с ресурсами в других группах.

![шаблон уровня](./media/template-deployment-overview/tier-templates.png)

Дополнительные сведения см. в статье [Использование связанных шаблонов в Azure Resource Manager](resource-group-linked-templates.md).

## <a name="next-steps"></a>Следующие шаги

* Сведения о свойствах в файлах шаблонов см. в разделе сведения о [структуре и синтаксисе шаблонов Azure Resource Manager](resource-group-authoring-templates.md).
* Чтобы приступить к разработке шаблона, см. статью [использование Visual Studio Code для создания шаблонов Azure Resource Manager](resource-manager-tools-vs-code.md).
* Общие сведения о службе диспетчер ресурсов, включая ее функции управления, см. в разделе [обзор Azure Resource Manager](resource-group-overview.md).

