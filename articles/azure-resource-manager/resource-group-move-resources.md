---
title: Перемещение ресурсов Azure в новую подписку или группу ресурсов | Документация Майкрософт
description: Перемещайте ресурсы в новую группу ресурсов или новую подписку с помощью Azure Resource Manager.
author: tfitzmac
ms.service: azure-resource-manager
ms.topic: conceptual
ms.date: 05/16/2019
ms.author: tomfitz
ms.openlocfilehash: 076d120d9c02b15837e92b71bc2a015377f54594
ms.sourcegitcommit: 36c50860e75d86f0d0e2be9e3213ffa9a06f4150
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/16/2019
ms.locfileid: "65792700"
---
# <a name="move-resources-to-new-resource-group-or-subscription"></a>Перемещение ресурсов в новую группу ресурсов или подписку

В этой статье показано, как переместить ресурсы Azure в другую подписку Azure или другую группу ресурсов в той же подписке. Для перемещения ресурса можно использовать портал Azure, Azure PowerShell, интерфейс командной строки Azure или REST API.

Группа источника и группа назначения блокируются на время операции перемещения. Операции записи и удаления для групп ресурсов блокируются до завершения перемещения. Эта блокировка означает, что невозможно добавить, обновить или удалить ресурсы в группах ресурсов, но не означает, что эти ресурсы закреплены. Например, если переместить в новую группу ресурсов экземпляр SQL Server и его базу данных, то приложение, использующее эту базу данных, не будет испытывать простоев в работе. Оно по-прежнему сможет считывать данные из базы данных и записывать их в нее.

При перемещении ресурс всего лишь перемещается в новую группу ресурсов. Операция перемещения не может изменить расположение ресурса. Даже если новая группа ресурсов находится в другом расположении, расположение ресурса не меняется.

> [!NOTE]
> В этой статье описывается, как перемещать ресурсы между существующими подписками Azure. Если вы действительно хотите обновить подписку Azure (например, переключиться с бесплатного уровня до уровня с оплатой по мере использования), необходимо преобразовать вашу подписку.
> * Сведения о том, как перейти с бесплатной пробной версии или подписки Azure Microsoft Imagine на подписку с оплатой по мере использования, см. [здесь](..//billing/billing-upgrade-azure-subscription.md).
> * Сведения о том, как перейти с подписки с оплатой по мере использования на другое предложение, см. [здесь](../billing/billing-how-to-switch-azure-offer.md).
> * Если вам не удается перейти на другую подписку, [создайте запрос на поддержку Azure](../azure-supportability/how-to-create-azure-support-request.md). Выберите тип проблемы **Управление подпиской**.

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

## <a name="when-to-call-azure-support"></a>Когда обращаться в службу поддержки Azure

Большинство ресурсов можно самостоятельно переместить с помощью операций, описанных в этой статье. С помощью этих операций можно выполнять такие действия:

* Перемещение ресурсов Resource Manager.
* перемещение классических ресурсов с учетом [ограничений классического развертывания](#classic-deployment-limitations).

Обратитесь в [службу поддержки](https://portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/overview), если необходимо выполнить такие действия:

* переместить ресурсы в новую учетную запись Azure (и клиент Azure Active Directory) и вам нужна помощь, чтобы выполнить инструкции из предыдущего раздела;
* перемещение классических ресурсов, осложненное проблемами с ограничениями.

## <a name="services-that-can-be-moved"></a>Службы, которые можно переместить

В следующем списке представлена общая сводка служб Azure, которые можно перенести в новую группу ресурсов и подписку. Список, из какой ресурс типы поддерживают перемещение, см. в разделе [перемещения операции благодаря поддержке ресурсов](move-support-resources.md).

* Analysis Services
* Управление API
* Приложения службы приложений (веб-приложения) — см. раздел [Ограничения службы приложений](#app-service-limitations).
* Сертификаты службы приложений — см. сведения в разделе [Ограничения Сертификатов службы приложений](#app-service-certificate-limitations).
* Служба автоматизации Azure — модули Runbook должны находиться в той же группе ресурсов, что и учетная запись службы автоматизации.
* Azure Active Directory B2C
* Кэш Azure для Redis — если экземпляр кэша Azure для Redis настроен с помощью виртуальной сети, его нельзя переместить в другую подписку. Обратитесь к разделу [Ограничения для виртуальных сетей](#virtual-networks-limitations).
* Azure Cosmos DB
* Обозреватель данных Azure
* База данных Azure для MariaDB
* База данных Azure для MySQL
* База данных Azure для PostgreSQL
* Azure DevOps — выполните действия, чтобы [изменить подписку Azure, используемой для выставления счетов](/azure/devops/organizations/billing/change-azure-subscription?view=azure-devops).
* Azure Maps
* Журналы Azure Monitor
* Ретранслятор Azure
* Azure Stack — регистрации
* Пакет
* Службы BizTalk
* Служба программ-роботов
* CDN
* Облачные службы — см. раздел [Ограничения классического развертывания](#classic-deployment-limitations).
* Cognitive Services
* Реестр контейнеров
* Модератор контента
* Управление затратами
* Customer Insights
* Каталог данных
* Фабрика данных
* Data Lake Analytics
* Data Lake Store
* DNS
* Служба "Сетка событий Azure"
* Центры событий;
* Frontdoor
* Кластеры HDInsight — см. раздел [Ограничения HDInsight](#hdinsight-limitations).
* IoT Central
* Центры Интернета вещей;
* Хранилище ключей — хранилища ключей, используемые для шифрования дисков, невозможно переместить в группы ресурсов в той же подписке или между подписками.
* Подсистемы балансировки нагрузки — подсистему балансировки нагрузки с номером SKU "Базовый" можно переместить. Номер SKU "Стандартный" подсистемы балансировки нагрузки нельзя переместить.
* Logic Apps
* Машинное обучение. Веб-службы Студии машинного обучения Microsoft Azure можно переместить в группу ресурсов, размещенную в той же подписке, но не в другую подписку. Другие ресурсы машинного обучения можно перемещать между подписками.
* Управляемые диски — управляемые диски в зонах доступности нельзя переместить в другую подписку
* Управляемое удостоверение, назначаемое пользователем
* Службы мультимедиа
* Монитор — убедитесь, что переход на новую подписку не превышает [квоты для подписки](../azure-subscription-service-limits.md#monitor-limits).
* Центры уведомлений
* Оперативная аналитика
* Пакет Operations Management
* Панели мониторинга на портале
* Power BI (Power BI Embedded и коллекция рабочих областей Power BI)
* Общедоступный IP-адрес — общедоступный IP-адрес с номером SKU "Базовый" можно переместить. Номер SKU "Стандартный" общедоступного IP-адреса нельзя переместить.
* Хранилище Служб восстановления — зарегистрируйтесь для использования [предварительной версии](#recovery-services-limitations).
* SAP HANA в Azure
* Планировщик
* Поиск — вы не можете за одну операцию переместить ресурсы поиска, размещенные в разных регионах. Переместите их в отдельных операциях.
* Служебная шина Azure
* Service Fabric
* Сетка Service Fabric
* Служба SignalR
* Хранилище. Учетные записи хранения, находящиеся в разных регионах, не могут перемещаться в одной и той же операции. Вместо этого используйте отдельные операции для каждого региона.
* Служба хранилища (классическая) — см. раздел [Ограничения классического развертывания](#classic-deployment-limitations).
* Служба синхронизации хранилища
* Stream Analytics — задание Stream Analytics в состоянии выполнения нельзя переместить.
* Сервер базы данных SQL — база данных и сервер должны находиться в одной группе ресурсов. При перемещении сервера SQL Server все его базы данных также перемещаются. Такое поведение также характерно для баз данных SQL Azure и баз данных хранилища данных SQL Azure.
* Аналитика временных рядов
* Диспетчер трафика
* Виртуальные машины — см. в разделе [ограничениях для виртуальных машин](#virtual-machines-limitations)
* Виртуальные машины (классические) — см. раздел [Ограничения классического развертывания](#classic-deployment-limitations).
* Масштабируемые наборы виртуальных машин — см. сведения об [ограничениях для виртуальных машин](#virtual-machines-limitations)
* Виртуальные сети — см. сведения об [ограничениях виртуальных сетей](#virtual-networks-limitations)
* VPN-шлюз

### <a name="services-that-cannot-be-moved"></a>Службы, которые невозможно переместить

В следующем списке представлена общая сводка служб Azure, которые нельзя перенести в новую группу ресурсов и подписку. Более подробные сведения см. в статье [Поддержка операций перемещения ресурсов](move-support-resources.md).

* доменные службы Active Directory;
* служба работоспособности гибридного AD;
* Шлюз приложений
* Azure Database Migration Service
* Azure Databricks
* Брандмауэр Azure
* Служба Azure Kubernetes (AKS)
* Миграция Azure
* Azure NetApp Files
* Сертификаты. Сертификаты службы приложений можно перемещать, но для переданных сертификатов действуют [ограничения](#app-service-limitations).
* Классические приложения
* Экземпляры контейнеров
* Служба контейнеров
* Data Box
* Рабочие среды для разработчиков
* Dynamics LCS.
* ExpressRoute
* Службы лабораторий — Labs аудитории нельзя переместить в новую группу ресурсов или подписку. DevTest Labs можно переместить в новую группу ресурсов в той же подписке, но не для всех подписок.
* Управляемые приложения
* Microsoft Genomics
* Безопасность
* Site Recovery
* Диспетчер устройств StorSimple
* Виртуальные сети (классические) — см. раздел [Ограничения классического развертывания](#classic-deployment-limitations).

## <a name="limitations"></a>Ограничения

В этом разделе описано, как обрабатывать сложные сценарии перемещения ресурсов. Ниже перечислены основные ограничения.

* [Ограничения для виртуальных машин](#virtual-machines-limitations)
* [Ограничения для виртуальных сетей](#virtual-networks-limitations)
* [Ограничения службы приложений](#app-service-limitations)
* [Ограничения сертификатов службы приложений](#app-service-certificate-limitations)
* [Ограничения классического развертывания](#classic-deployment-limitations)
* [Ограничения служб восстановления](#recovery-services-limitations)
* [Ограничения HDInsight](#hdinsight-limitations)

### <a name="virtual-machines-limitations"></a>Ограничения для виртуальных машин

Можно переместить виртуальные машины с управляемыми дисками, управляемые образы, управляемые моментальные снимки и группы доступности с виртуальными машинами, использующих управляемые диски. Управляемые диски в зонах доступности невозможно переместить в другую подписку.

Следующие сценарии пока не поддерживаются.

* Виртуальные машины с сертификатами, хранящимися в Key Vault, можно переместить в новую группу ресурсов в той же подписке. Между разными подписками их переместить нельзя.
* Невозможно переместить масштабируемые наборы виртуальных машин с помощью стандартных SKU подсистемы балансировки нагрузки или стандартный номер SKU общедоступного IP-адреса.
* Виртуальные машины, созданные из ресурсов Marketplace с подключенными планами, невозможно переместить между группами ресурсов или подписками. Отзовите виртуальную машину в текущей подписке и разверните ее в новой подписке.

Чтобы переместить виртуальные машины, настроенные с помощью Azure Backup, используйте следующее обходное решение.

* Найдите расположение виртуальной машины.
* Найдите группу ресурсов со схемой именования `AzureBackupRG_<location of your VM>_1`, например AzureBackupRG_westus2_1.
* Затем на портале Azure щелкните "Показать скрытые типы".
* В PowerShell используйте командлет `Get-AzResource -ResourceGroupName AzureBackupRG_<location of your VM>_1`
* В CLI используйте команду `az resource list -g AzureBackupRG_<location of your VM>_1`.
* Найдите ресурс с типом `Microsoft.Compute/restorePointCollections` и шаблоном именования `AzureBackup_<name of your VM that you're trying to move>_###########`.
* Удалите этот ресурс. Эта операция удаляет только точки мгновенного восстановления, но не данные резервных копий в хранилище.
* По завершении удаления вы сможете перенести виртуальную машину. Хранилище и виртуальную машину можно переместить в целевую подписку. После перемещения можно продолжить резервное копирование без потери данных.
* Сведения о перемещении хранилищ служб восстановления для резервного копирования см. в разделе [Ограничения служб восстановления](#recovery-services-limitations).

### <a name="virtual-networks-limitations"></a>Ограничения для виртуальных сетей

При перемещении виртуальной сети также необходимо переместить зависимые от нее ресурсы, Для VPN-шлюзов необходимо переместить IP-адреса, шлюзы виртуальной сети и все связанные с ними ресурсы подключения. Локальные сетевые шлюзы могут находиться в другой группе ресурсов.

Чтобы переместить виртуальную машину с сетевой картой, необходимо переместить все зависимые ресурсы. Необходимо переместить в виртуальную сеть для сетевой карты, все другие сетевые карты для виртуальной сети и VPN-шлюзов.

Чтобы переместить виртуальную сеть с пиринговым подключением, сначала нужно отключить это подключение. После отключения виртуальную сеть можно переместить. После перемещения установите пиринговое подключение виртуальной сети заново.

Виртуальную сеть невозможно переместить в другую подписку, если эта сеть содержит подсеть со ссылками перехода к ресурсам. Например, если ресурс кэша Azure для Redis развернут в подсеть, эта подсеть содержит ссылку навигации по ресурсам.

### <a name="app-service-limitations"></a>Ограничения службы приложений

Ограничения на перемещение ресурсов службы приложений отличаются в зависимости от того, перемещаются ли ресурсы в пределах одной подписки или переносятся в новую подписку. Если веб-приложение использует сертификат службы приложений, ознакомьтесь со сведениями в разделе [Ограничения Сертификатов службы приложений](#app-service-certificate-limitations).

#### <a name="moving-within-the-same-subscription"></a>Перемещение в пределах одной подписки

При перемещении веб-приложения _в пределах одной подписки_ невозможно переместить сторонние SSL-сертификаты. Однако вы можете переместить веб-приложение в новую группу ресурсов без перемещения его стороннего сертификата, и функции SSL в приложении будут по-прежнему работать.

Чтобы переместить SSL-сертификат с веб-приложением, сделайте следующее:

1. Удалите сторонний сертификат из веб-приложения, но сохраните копию сертификата.
2. Переместите веб-приложение.
3. Загрузите сторонний сертификат в перемещенное веб-приложение.

#### <a name="moving-across-subscriptions"></a>Перемещение между подписками

При перемещении веб-приложения _между подписками_ применяются следующие ограничения.

- В целевой группе ресурсов не должно быть существующих ресурсов службы приложений. Ресурсы службы приложений:
    - Веб-приложения
    - Планы служб приложений
    - отправленные или импортированные SSL-сертификаты;
    - Среды службы приложений
- Все ресурсы службы приложений в группе ресурсов необходимо перемещать вместе.
- Ресурсы службы приложений можно перемещать только из группы ресурсов, в которой они были созданы. Если ресурс службы приложений не находится в исходной группе ресурсов, сначала его необходимо переместить обратно в эту группу ресурсов, а потом можно перемещать между подписками.

Если вы не помните исходной группе ресурсов, его можно найти через диагностики. Для веб-приложения выберите **Диагностика и решение проблем**. Выберите **настройки и управления**.

![Выбор диагностики](./media/resource-group-move-resources/select-diagnostics.png)

Выберите **варианты миграции**.

![Выберите параметры миграции](./media/resource-group-move-resources/select-migration.png)

Выберите параметр для рекомендуемые действия для перемещения веб-приложения.

![Выберите рекомендуемые действия](./media/resource-group-move-resources/recommended-steps.png)

Вы см. рекомендуемые действия, выполняемые перед перемещением ресурсов. Эти сведения включают исходной группе ресурсов для веб-приложения.

![Рекомендации](./media/resource-group-move-resources/recommendations.png)

### <a name="app-service-certificate-limitations"></a>Ограничения Сертификатов службы приложений

Сертификат службы приложений можно переместить в новую группу ресурсов или подписку. Если ваш сертификат службы приложений привязан к веб-приложению, необходимо выполнить некоторые действия перед перемещением ресурсов в новую подписку. Удалите привязку SSL и частный сертификат из веб-приложения перед перемещением ресурсов. Сертификат службы приложений не нужно удалять. Удалите в веб-приложении только частный сертификат.

### <a name="classic-deployment-limitations"></a>Ограничения классического развертывания

Процедуры перемещения ресурсов, развернутых с помощью классической модели, отличаются в зависимости от того, перемещаются ресурсы в пределах одной подписки или переносятся в новую подписку.

#### <a name="same-subscription"></a>Та же подписка

При перемещении ресурсов из одной группы ресурсов в другую в пределах одной подписки действуют следующие ограничения.

* Нельзя перемещать виртуальные сети (классические).
* Виртуальные машины (классические) необходимо перемещать с облачной службой.
* Облачную службу можно перемещать только в тех случаях, когда перемещение включает в себя все виртуальные машины этой службы.
* Одновременно можно перемещать только одну облачную службу.
* Одновременно можно перемещать только одну учетную запись хранения (классическую).
* Нельзя перемещать учетную запись хранения (классическую) в рамках одной операции с виртуальной машиной или облачной службой.

Для перемещения классических ресурсов в новую группу ресурсов в пределах одной подписки используйте стандартные операции перемещения на [портале](#use-portal), в Azure PowerShell, интерфейсе командной строки Azure или интерфейсе REST API. При этом используются те же операции, что и для перемещения ресурсов Resource Manager.

#### <a name="new-subscription"></a>Новая подписка

При перемещении ресурсов в новую подписку действуют следующие ограничения.

* Все классические ресурсы в подписке необходимо переместить в рамках одной операции.
* Целевая подписка не должна содержать никаких других классических ресурсов.
* Перемещение можно запросить только через отдельный интерфейс REST API для классических перемещений. Стандартные команды перемещения Resource Manager не работают, если перемещение классических ресурсов осуществляется в новую подписку.

Для перемещения классических ресурсов в новую подписку используйте операции REST, предназначенные для классических ресурсов. Чтобы использовать REST, выполните следующие действия:

1. Проверьте, может ли исходная подписка участвовать в перемещении между подписками. Выполните такую операцию:

   ```HTTP
   POST https://management.azure.com/subscriptions/{sourceSubscriptionId}/providers/Microsoft.ClassicCompute/validateSubscriptionMoveAvailability?api-version=2016-04-01
   ```

     Включите в текст запроса такой код:

   ```json
   {
    "role": "source"
   }
   ```

     Ответ на операцию проверки имеет следующий формат:

   ```json
   {
    "status": "{status}",
    "reasons": [
      "reason1",
      "reason2"
    ]
   }
   ```

2. Проверьте, может ли целевая подписка участвовать в перемещении между подписками. Выполните такую операцию:

   ```HTTP
   POST https://management.azure.com/subscriptions/{destinationSubscriptionId}/providers/Microsoft.ClassicCompute/validateSubscriptionMoveAvailability?api-version=2016-04-01
   ```

     Включите в текст запроса такой код:

   ```json
   {
    "role": "target"
   }
   ```

     Ответ будет в том же формате, что и проверка исходной подписки.
3. Если обе подписки пройдут проверку, переместите все классические ресурсы из одной подписки в другую, выполнив следующее действие:

   ```HTTP
   POST https://management.azure.com/subscriptions/{subscription-id}/providers/Microsoft.ClassicCompute/moveSubscriptionResources?api-version=2016-04-01
   ```

    Включите в текст запроса такой код:

   ```json
   {
    "target": "/subscriptions/{target-subscription-id}"
   }
   ```

Операция может занять несколько минут.

### <a name="recovery-services-limitations"></a>Ограничения служб восстановления

 Чтобы переместить хранилище Служб восстановления, см. статью [Перемещение хранилища Служб восстановления между подписками Azure и группами ресурсов (ограниченная общедоступная предварительная версия)](../backup/backup-azure-move-recovery-services-vault.md).

В настоящее время за один раз можно переместить одно хранилище Служб восстановления в каждом регионе. Вы не можете перемещать хранилища, которые создают резервные копии служб "Файлы Azure", "Синхронизация файлов Azure" или SQL на виртуальных машинах IaaS.

Если виртуальная машина не перемещается с хранилищем, текущие точки восстановления виртуальной машины остаются в хранилище до истечения срока их действия. Независимо от того, была ли виртуальная машина перемещена с хранилищем или нет, вы можете восстановить виртуальную машину из истории резервного копирования в хранилище.

Хранилище служб восстановления не поддерживает создание резервных копий в нескольких подписках. Если вы перемещаете хранилище с данными резервного копирования виртуальной машины между подписками, вы должны переместить свои виртуальные машины в одну подписку и использовать одну целевую группу ресурсов для продолжения резервного копирования.

Политики резервного копирования, определенные для хранилища, сохраняются после перемещения хранилища. Отчетность и мониторинг нужно снова настроить для хранилища после перемещения.

Чтобы переместить виртуальную машину в новую подписку без перемещения хранилища Служб восстановления, сделайте следующее:

 1. Временно остановите операцию резервного копирования.
 1. [Удаляет точку восстановления](#virtual-machines-limitations). Эта операция удаляет только точки мгновенного восстановления, но не данные резервных копий в хранилище.
 1. Переместите виртуальную машину в новую подписку.
 1. Повторно защитите ее в новом хранилище в этой подписке.

Перемещение не поддерживается для ресурсов хранилища, сетевых и вычислительных ресурсов, используемых для настройки аварийного восстановления с помощью Azure Site Recovery. Предположим, что вы настроили репликацию своих локальных компьютеров в учетную запись хранения (Storage1) и хотите, чтобы защищенный компьютер восстанавливался после отработки отказа в Azure как виртуальная машина (VM1), подключенная к виртуальной сети (Network1). Ни один из этих ресурсов Azure (Storage1, VM1 и Network1) нельзя перемещать между группами ресурсов в пределах одной подписки или между подписками.

### <a name="hdinsight-limitations"></a>Ограничения HDInsight

Кластеры HDInsight можно переместить в новую подписку или группу ресурсов. Однако перемещение между подписками недоступно для сетевых ресурсов, связанных с кластером HDInsight (таких как виртуальная сеть, сетевой адаптер или подсистема балансировки нагрузки). Также невозможно переместить в новую группу ресурсов сетевой адаптер, который подключен к виртуальной машине кластера.

При перемещении кластера HDInsight в новую подписку сначала необходимо переместить другие ресурсы (такие как учетная запись хранения). А затем переместить сам кластер HDInsight.

## <a name="checklist-before-moving-resources"></a>Рекомендации перед перемещением ресурсов

Вот некоторые важные особенности, которые следует учитывать перед перемещением ресурса. Проверив эти условия, можно избежать ошибок.

1. Исходная и целевая подписки должны быть активными. Если у вас возникла проблема при включении учетной записи, которая была отключена, [создайте запрос на поддержку Azure](../azure-supportability/how-to-create-azure-support-request.md). Выберите тип проблемы **Управление подпиской**.

1. Исходная и целевая подписка должны существовать в пределах одного [клиента Azure Active Directory](../active-directory/develop/quickstart-create-new-tenant.md). Используя Azure PowerShell или командную строку Azure, можно убедиться, что обе подписки имеют один и тот же идентификатор клиента.

   Для Azure PowerShell:

   ```azurepowershell-interactive
   (Get-AzSubscription -SubscriptionName <your-source-subscription>).TenantId
   (Get-AzSubscription -SubscriptionName <your-destination-subscription>).TenantId
   ```

   Для интерфейса командной строки Azure:

   ```azurecli-interactive
   az account show --subscription <your-source-subscription> --query tenantId
   az account show --subscription <your-destination-subscription> --query tenantId
   ```

   Если идентификаторы клиентов исходных и целевых подписок не совпадают, используйте следующие методы для выверки идентификаторов клиентов:

   * [Передача прав владения подпиской Azure другой учетной записи](../billing/billing-subscription-transfer.md)
   * [Как связать или добавить подписку Azure в Azure Active Directory](../active-directory/fundamentals/active-directory-how-subscriptions-associated-directory.md)

1. Подписка назначения должна быть зарегистрирована для перемещаемого поставщика ресурсов. В противном случае отображается сообщение о том, что **подписка не зарегистрирована для типа ресурса**. Эта ошибка может возникнуть при перемещении ресурса в новую подписку, которая никогда не использовалась с этим типом ресурса.

   Для PowerShell используйте следующие команды, чтобы получить состояние регистрации:

   ```azurepowershell-interactive
   Set-AzContext -Subscription <destination-subscription-name-or-id>
   Get-AzResourceProvider -ListAvailable | Select-Object ProviderNamespace, RegistrationState
   ```

   Чтобы зарегистрировать поставщик ресурсов, воспользуйтесь командой:

   ```azurepowershell-interactive
   Register-AzResourceProvider -ProviderNamespace Microsoft.Batch
   ```

   Для Azure CLI используйте следующие команды, чтобы получить состояние регистрации:

   ```azurecli-interactive
   az account set -s <destination-subscription-name-or-id>
   az provider list --query "[].{Provider:namespace, Status:registrationState}" --out table
   ```

   Чтобы зарегистрировать поставщик ресурсов, воспользуйтесь командой:

   ```azurecli-interactive
   az provider register --namespace Microsoft.Batch
   ```

1. Учетная запись, используемая для перемещения ресурсов, должна предоставлять по крайней мере следующие разрешения:

   * **Microsoft.Resources/subscriptions/resourceGroups/moveResources/action** для исходной группы ресурсов;
   * **Microsoft.Resources/subscriptions/resourceGroups/write** для целевой группы ресурсов.

1. Прежде чем перемещать ресурсы, проверьте квоты подписки, в которую вы перемещаете ресурсы. Если при перемещении ресурсов квота подписки будет превышена, возможно, вам придется запросить увеличение квоты. Полный список ограничений и способы запросить увеличение квоты см. в статье [Подписка Azure, границы, квоты и ограничения службы](../azure-subscription-service-limits.md).

1. Если это возможно, разделите большие перемещения на несколько операций перемещения. При попытке перемещения более чем 800 ресурсов за одну операцию Resource Manager немедленно возвращает ошибку. Однако перемещение менее чем 800 ресурсов может также завершиться со сбоем из-за превышения времени ожидания.

1. Служба должна иметь возможность перемещения ресурсов. Чтобы определить, будет ли перемещение успешным, [проверьте свой запрос на перемещение](#validate-move). Какие [службы позволяют перемещать ресурсы](#services-that-can-be-moved), а какие — [нет](#services-that-cannot-be-moved) см. в разделах этой статьи ниже.

## <a name="validate-move"></a>Проверка перемещения

[Операция проверки перемещения](/rest/api/resources/resources/validatemoveresources) позволяет проверить сценарий перемещения без фактического перемещения ресурсов. Используйте эту операцию, чтобы определить, будет ли перемещение успешным. Для запуска этой операции вам необходимо:

* имя исходной группы ресурсов;
* идентификатор ресурса целевой группы ресурсов;
* идентификатор каждого перемещаемого ресурса;
* [маркер доступа](/rest/api/azure/#acquire-an-access-token) для вашей учетной записи.

Отправьте следующий запрос:

```
POST https://management.azure.com/subscriptions/<subscription-id>/resourceGroups/<source-group>/validateMoveResources?api-version=2018-02-01
Authorization: Bearer <access-token>
Content-type: application/json
```

С текстом запроса:

```json
{
 "resources": ["<resource-id-1>", "<resource-id-2>"],
 "targetResourceGroup": "/subscriptions/<subscription-id>/resourceGroups/<target-group>"
}
```

Если запрос имеет правильный формат, операция возвращает следующее:

```
Response Code: 202
cache-control: no-cache
pragma: no-cache
expires: -1
location: https://management.azure.com/subscriptions/<subscription-id>/operationresults/<operation-id>?api-version=2018-02-01
retry-after: 15
...
```

Код состояния 202 указывает, что запрос на проверку был принят, но еще не определено, завершится ли операция перемещения успешно. Значение `location` содержит URL-адрес, который используется для проверки состояния продолжительной операции.  

Чтобы проверить состояние, отправьте следующий запрос:

```
GET <location-url>
Authorization: Bearer <access-token>
```

Пока операция все еще выполняется, вы по-прежнему получаете код состояния 202. Подождите в течение времени, указанного в значении `retry-after`, прежде чем повторять попытку. Если проверка операции перемещения завершена успешно, вы получите код состояния 204. Если проверка перемещения закончилась ошибкой, вы получите сообщение об ошибке, например:

```json
{"error":{"code":"ResourceMoveProviderValidationFailed","message":"<message>"...}}
```

## <a name="move-resources"></a>Перемещение ресурсов

### <a name="a-nameuse-portal-by-using-azure-portal"></a><a name="use-portal" />С помощью портала Azure

Чтобы переместить ресурсы, выберите группу ресурсов, в которой они содержатся, а затем нажмите кнопку **Переместить**.

![перемещение ресурсов](./media/resource-group-move-resources/select-move.png)

Укажите, куда будут перемещены ресурсы: в новую группу ресурсов или новую подписку.

Выберите ресурсы, которые необходимо переместить, и целевую группу ресурсов. Подтвердите обновление сценариев для этих ресурсов и нажмите кнопку **ОК**. Если на предыдущем шаге был выбран значок редактирования подписки, то также необходимо выбрать целевую подписку.

![выбор места назначения](./media/resource-group-move-resources/select-destination.png)

В области **уведомлений**вы увидите, что операция перемещения выполняется.

![отображение состояния перемещения](./media/resource-group-move-resources/show-status.png)

После ее завершения отобразится уведомление о результате.

![отображение результата перемещения](./media/resource-group-move-resources/show-result.png)

### <a name="by-using-azure-powershell"></a>с помощью Azure PowerShell;

Чтобы переместить существующие ресурсы в другую группу ресурсов или подписку, используйте команду [Move-AzResource](/powershell/module/az.resources/move-azresource). В следующем примере показано, как переместить несколько ресурсов в новую группу ресурсов.

```azurepowershell-interactive
$webapp = Get-AzResource -ResourceGroupName OldRG -ResourceName ExampleSite
$plan = Get-AzResource -ResourceGroupName OldRG -ResourceName ExamplePlan
Move-AzResource -DestinationResourceGroupName NewRG -ResourceId $webapp.ResourceId, $plan.ResourceId
```

Чтобы переместить ресурс в новую подписку, добавьте значение параметра `DestinationSubscriptionId`.

### <a name="by-using-azure-cli"></a>С помощью Azure CLI

Чтобы переместить существующие ресурсы в другую группу или подписку, используйте команду [az resource move](/cli/azure/resource?view=azure-cli-latest#az-resource-move). Укажите идентификаторы перемещаемых ресурсов. В следующем примере показано, как переместить несколько ресурсов в новую группу ресурсов. В параметре `--ids` укажите перемещаемый список идентификаторов ресурсов с разделителями-пробелами.

```azurecli
webapp=$(az resource show -g OldRG -n ExampleSite --resource-type "Microsoft.Web/sites" --query id --output tsv)
plan=$(az resource show -g OldRG -n ExamplePlan --resource-type "Microsoft.Web/serverfarms" --query id --output tsv)
az resource move --destination-group newgroup --ids $webapp $plan
```

Для перемещения в новую подписку нужно указать параметр `--destination-subscription-id`.

### <a name="by-using-rest-api"></a>С помощью REST API

Чтобы переместить существующие ресурсы в другую группу ресурсов или подписку, выполните следующую команду:

```HTTP
POST https://management.azure.com/subscriptions/{source-subscription-id}/resourcegroups/{source-resource-group-name}/moveResources?api-version={api-version}
```

В тексте запроса укажите целевую группу ресурсов и ресурсы для перемещения. Дополнительные сведения об операции перемещения в REST см. в статье [Move resources](/rest/api/resources/Resources/MoveResources) (Перемещение ресурсов).

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о командлетах PowerShell для управления ресурсами, см. в разделе [с помощью Azure PowerShell с диспетчером ресурсов](manage-resources-powershell.md).
* Дополнительные сведения о командах Azure CLI для управления ресурсами, см. в разделе [с помощью Azure CLI с помощью Resource Manager](manage-resources-cli.md).
* Сведения о функциях портала для управления подпиской см. в статье [Управление ресурсами Azure через портал](resource-group-portal.md).
* Сведения о логической организации ресурсов см. в разделе [Использование тегов для организации ресурсов в Azure](resource-group-using-tags.md).
