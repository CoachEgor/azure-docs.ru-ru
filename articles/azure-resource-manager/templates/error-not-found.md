---
title: Ресурс не найден ные ошибки
description: Описывает, как устранить ошибки, когда ресурс не может быть найден при развертывании с шаблоном управления ресурсами Azure.
ms.topic: troubleshooting
ms.date: 01/21/2020
ms.openlocfilehash: b6f433118092e46f734d4b65040dd97c2fcb58d9
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "76773261"
---
# <a name="resolve-not-found-errors-for-azure-resources"></a>Устранение ошибок с поиском ресурсов Azure

В этой статье описываются ошибки, которые могут возникнуть, когда во время развертывания не удается найти ресурс.

## <a name="symptom"></a>Симптом

Если шаблон содержит имя ресурса, которое не удается разрешить, появится сообщение об ошибке, аналогичное приведенному ниже.

```
Code=NotFound;
Message=Cannot find ServerFarm with name exampleplan.
```

При попытке использовать функции [reference](template-functions-resource.md#reference) или [listKeys](template-functions-resource.md#listkeys) с ресурсом, который не удается устранить, появится следующая ошибка.

```
Code=ResourceNotFound;
Message=The Resource 'Microsoft.Storage/storageAccounts/{storage name}' under resource
group {resource group name} was not found.
```

## <a name="cause"></a>Причина

Resource Manager нужно получить свойства ресурса, но он не может определить ресурс в вашей подписке.

## <a name="solution-1---set-dependencies"></a>Решение 1 — задание зависимостей

При попытке развернуть отсутствующий ресурс в шаблоне проверьте, нужно ли добавить зависимость. Resource Manager оптимизирует развертывание, создавая ресурсы параллельно, когда это возможно. Если один ресурс необходимо развернуть после другого, требуется использовать в шаблоне элемент **dependsOn**. Например, при развертывании веб-приложения вам нужно создать план службы приложений. Если вы не указали, что веб-приложение зависит от плана службы приложений, Resource Manager создаст оба ресурса одновременно. При попытке указать свойство веб-приложения появится сообщение о том, что невозможно найти ресурс плана службы приложений, так как он еще не существует. Чтобы предотвратить эту ошибку, в веб-приложении следует настроить зависимость.

```json
{
  "type": "Microsoft.Web/sites",
  "apiVersion": "2015-08-01",
  "dependsOn": [
    "[variables('hostingPlanName')]"
  ],
  ...
}
```

Но следует избегать задания ненужных зависимостей. Ненужные зависимости могут замедлить развертывание, мешая параллельному развертыванию независимых между собой ресурсов. Кроме того, возможно образование циклических зависимостей, которые блокируют развертывание. Функция [reference](template-functions-resource.md#reference) и функции [list*](template-functions-resource.md#list) создают неявную зависимость от ссылочного ресурса, когда этот ресурс развертывается в том же шаблоне и ссылается на его имя (а не на идентификатор ресурса). Таким образом можно использовать больше зависимостей, чем задано в свойстве **dependsOn**. Функция [resourceId](template-functions-resource.md#resourceid) не создает неявную зависимость и не проверяет, существует ли ресурс. Функция [reference](template-functions-resource.md#reference) и функции [list*](template-functions-resource.md#list) не создают неявную зависимость, когда ресурс ссылается на свой идентификатор ресурса. Чтобы создать неявную зависимость, передайте имя ресурса, развернутого в том же шаблоне.

При возникновении проблем с зависимостями необходимо узнать, в каком порядке развертываются ресурсы. Вот как можно просмотреть порядок операций развертывания.

1. Выберите журнал развертывания для группы ресурсов.

   ![Выбор журнала развертывания](./media/error-not-found/select-deployment.png)

2. Выберите развертывание в журнале, затем выберите **События**.

   ![Выбор событий развертывания](./media/error-not-found/select-deployment-events.png)

3. Изучите последовательность событий для каждого ресурса. Обратите внимание на состояние каждой операции. Например, на следующем рисунке показаны три учетные записи хранения, которые были развернуты параллельно. Обратите внимание, что эти три учетные записи хранения были запущены одновременно.

   ![Параллельное развертывание](./media/error-not-found/deployment-events-parallel.png)

   На следующем рисунке показаны три учетные записи хранения, которые не были развернуты параллельно. Вторая учетная запись хранения зависит от первой учетной записи хранения, а третья учетная запись хранения — от второй. Первая учетная запись хранения должна быть запущена, принята и завершена, прежде чем будет запущена следующая.

   ![Последовательное развертывание](./media/error-not-found/deployment-events-sequence.png)

## <a name="solution-2---get-resource-from-different-resource-group"></a>Решение 2 — получение ресурса из другой группы ресурсов

Если ресурс существует в группе ресурсов, отличной от той, где выполняется развертывание, используйте [функцию resourceId](template-functions-resource.md#resourceid), чтобы получить полное имя ресурса.

```json
"properties": {
  "name": "[parameters('siteName')]",
  "serverFarmId": "[resourceId('plangroup', 'Microsoft.Web/serverfarms', parameters('hostingPlanName'))]"
}
```

## <a name="solution-3---check-reference-function"></a>Решение 3 — проверка функции reference

Найдите выражение с функцией [reference](template-functions-resource.md#reference). Заданные значения различаются в зависимости от того, входит ли ресурс в тот же шаблон, группу ресурсов и подписку. Убедитесь, что вы предоставляете значения обязательного параметра для вашего сценария. Если ресурс находится в другой группе ресурсов, укажите идентификатор ресурса. Например, для создания ссылки на учетную запись хранения в другой группе ресурсов, используйте следующую команду:

```json
"[reference(resourceId('exampleResourceGroup', 'Microsoft.Storage/storageAccounts', 'myStorage'), '2017-06-01')]"
```

## <a name="solution-4---get-managed-identity-from-resource"></a>Решение 4 - получить управляемую идентичность из ресурса

Если развертывание ресурса, неявно создающего [управляемое удостоверение,](../../active-directory/managed-identities-azure-resources/overview.md)необходимо подождать, пока этот ресурс не будет развернут, прежде чем получать значения управляемого иждивественного. Если вы передаете управляемое имя идентификации [в справочную](template-functions-resource.md#reference) функцию, диспетчер ресурсов пытается разрешить ссылку до развертывания ресурса и идентификатора. Вместо этого передайте имя ресурса, к которому применяется идентификация. Этот подход обеспечивает развертывание ресурса и управляемого идентификатора до того, как диспетчер ресурсов разрешит функцию ссылки.

В функции отсчета используйте `Full` для получения всех свойств, включая управляемую идентификацию.

Например, чтобы получить идентификатор клиента для управляемого идентификатора, который применяется к набору виртуальной шкалы машин, используйте:

```json
"tenantId": "[reference(resourceId('Microsoft.Compute/virtualMachineScaleSets',  variables('vmNodeType0Name')), variables('vmssApiVersion'), 'Full').Identity.tenantId]"
```