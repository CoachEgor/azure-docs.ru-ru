---
title: Режимы развертывания
description: В этой статье описывается, как с помощью Azure Resource Manager задать полный или пошаговый режим развертывания.
ms.topic: conceptual
ms.date: 01/17/2020
ms.openlocfilehash: 1077d92f076797fb03c4fe750b353e2306f9b6de
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79460251"
---
# <a name="azure-resource-manager-deployment-modes"></a>Режимы развертывания в Azure Resource Manager

При развертывании имеющихся ресурсов можно указать, что развертывание является добавочным или полным обновлением. Разница между этими двумя режимами заключается в том, как диспетчер ресурсов обрабатывает существующие ресурсы в группе ресурсов, которые не в шаблоне.

Для обоих режимов Resource Manager пытается создать все ресурсы, указанные в шаблоне. Если ресурс уже существует в группе ресурсов и его параметры не изменились, для этого ресурса не выполняются операции. Если значения свойств ресурса были изменены, они обновятся в ресурсе. При попытке обновить расположение или тип имеющегося ресурса развертывание завершится ошибкой. Вместо этого вы можете развернуть новый ресурс нужного вам типа с необходимым расположением.

По умолчанию используется пошаговый режим.

## <a name="complete-mode"></a>Полный режим

При использовании полного режима Resource Manager **удаляет** ресурсы, которые существуют в группе ресурсов, но не указаны в шаблоне.

Если шаблон включает ресурс, который не развернут, поскольку [состояние](conditional-resource-deployment.md) оценивается как ложное, результат зависит от того, какую версию REST API использует для развертывания шаблона. Если вы используете версию раньше 2019-05-10, ресурс **не удаляется.** С 2019-05-10 или позже, ресурс **удаляется**. Последние версии Azure PowerShell и Azure CLI удаляют ресурс.

Будьте осторожны, используя полный режим с [копированием циклов.](copy-resources.md) Все ресурсы, которые не указаны в шаблоне после разрешения цикла копирования, удаляются.

При развертывании [в шаблоне более чем одной группе ресурсов](cross-resource-group-deployment.md)ресурсы группы ресурсов, указанные в операции развертывания, могут быть удалены. Ресурсы в группах вторичных ресурсов не удаляются.

Существуют некоторые различия в том, как типы ресурсов обрабатывают полные удаления режимов. Родительские ресурсы автоматически удаляются, если находятся не на шаблоне, который развертывается в полном режиме. Некоторые дочерние ресурсы не удаляются автоматически, если находятся вне шаблона. Однако эти ресурсы ребенка удаляются, если родительский ресурс удален.

Например, если ваша группа ресурсов содержит зону DNS (тип ресурса Microsoft.Network/dnsZones) и запись CNAME (тип ресурса Microsoft.Network/dnsZones/CNAME), то зона DNS является родительским ресурсом для записи CNAME. Если вы используете полный режим во время развертывания и не включаете в вашем шаблоне зону DNS, то и зона DNS, и запись CNAME удаляться. Если вы включили зону DNS в шаблон, но не включили запись CNAME, CNAME не удаляется.

Дополнительные сведения об удалении разных типов ресурсов см. в статье [Deletion of Azure resources for complete mode deployments](complete-mode-deletion.md) (Удаление ресурсов Azure для развертываний в полном режиме).

Если группа ресурсов [заблокирована,](../management/lock-resources.md)полный режим не удаляет ресурсы.

> [!NOTE]
> Только шаблоны корневого уровня поддерживают режим полного развертывания. Для [связанных или вложенных шаблонов](linked-templates.md) необходимо использовать добавочный режим.
>
> [Развертывание уровня подписки](deploy-to-subscription.md) не поддерживает полный режим.
>
> В настоящее время портал не поддерживает полный режим.
>

## <a name="incremental-mode"></a>Пошаговый режим

В пошаговом режиме Resource Manager **оставляет без изменения** ресурсы, которые существуют в группе ресурсов, но не указаны в шаблоне. Ресурсы в шаблоне **добавляются** в группу ресурсов.

> [!NOTE]
> При передислокации существующего ресурса в инкрементном режиме все свойства репригируются повторно. **Свойства не добавляются постепенно.** Распространенным недоразумением является мысли о том, что свойства, не указанные в шаблоне, остаются неизменными. Если не указано определенные свойства, диспетчер ресурсов интерпретирует развертывание как перезапись этих значений. Свойства, не включенные в шаблон, сбросить значения по умолчанию. Укажите все значения непо умолчанию для ресурса, а не только те, которые вы обновляете. Определение ресурса в шаблоне всегда содержит окончательное состояние ресурса. Он не может представлять частичное обновление существующего ресурса.

## <a name="example-result"></a>Пример результата

Чтобы понять различие между инкрементным и полным режимом, рассмотрим следующий сценарий.

**Группа ресурсов** содержит:

* ресурс А;
* ресурс Б;
* ресурс В;

**Шаблон** содержит:

* ресурс А;
* ресурс Б;
* ресурс Г.

При развертывании в **пошаговом** режиме группа ресурсов содержит:

* ресурс А;
* ресурс Б;
* ресурс В;
* ресурс Г.

При развертывании в **полном** режиме ресурс В будет удален. Группа ресурсов содержит:

* ресурс А;
* ресурс Б;
* ресурс Г.

## <a name="set-deployment-mode"></a>Установка режима развертывания

Чтобы установить режим развертывания при развертывании с помощью PowerShell, используйте параметр `Mode`.

```azurepowershell-interactive
New-AzResourceGroupDeployment `
  -Mode Complete `
  -Name ExampleDeployment `
  -ResourceGroupName ExampleResourceGroup `
  -TemplateFile c:\MyTemplates\storage.json
```

Чтобы установить режим развертывания при развертывании с помощью Azure CLI, используйте параметр `mode`.

```azurecli-interactive
az deployment group create \
  --name ExampleDeployment \
  --mode Complete \
  --resource-group ExampleGroup \
  --template-file storage.json \
  --parameters storageAccountType=Standard_GRS
```

В примере ниже показан связанный шаблон с добавочным режимом развертывания:

```json
"resources": [
  {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2017-05-10",
      "name": "linkedTemplate",
      "properties": {
          "mode": "Incremental",
          <nested-template-or-external-template>
      }
  }
]
```

## <a name="next-steps"></a>Дальнейшие действия

* Чтобы узнать о создании шаблонов «Менеджер ресурсов», [см.](template-syntax.md)
* Сведения о развертывании ресурсов см. в статье [Развертывание ресурсов с использованием шаблонов Resource Manager и Azure PowerShell](deploy-powershell.md).
* Чтобы просмотреть операции для поставщика ресурсов, ознакомьтесь с [Azure REST API](/rest/api/).
