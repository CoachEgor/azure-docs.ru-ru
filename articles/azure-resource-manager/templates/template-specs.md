---
title: Обзор спецификаций шаблонов
description: Описание способов создания спецификаций шаблонов и предоставления к ним общего доступа другим пользователям в Организации.
ms.topic: conceptual
ms.date: 07/20/2020
ms.author: tomfitz
author: tfitzmac
ms.openlocfilehash: 47dcf44b35ad5c0b77dd0b88d683071a7f2f4ecb
ms.sourcegitcommit: 3d79f737ff34708b48dd2ae45100e2516af9ed78
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/23/2020
ms.locfileid: "87097723"
---
# <a name="azure-resource-manager-template-specs-preview"></a>Спецификации шаблонов Azure Resource Manager (Предварительная версия)

Спецификация шаблона — это новый тип ресурсов для хранения шаблона Azure Resource Manager (шаблон ARM) в Azure для последующего развертывания. Этот тип ресурсов позволяет предоставлять общий доступ к шаблонам ARM другим пользователям в вашей организации. Как и любой другой ресурс Azure, можно использовать управление доступом на основе ролей (RBAC) для совместного использования спецификации шаблона. пользователям требуется только доступ для чтения к спецификации шаблона, чтобы можно было предоставить общий доступ к шаблону, не разрешая другим изменять его.

**Microsoft. Resources/темплатеспекс** — это новый тип ресурсов для спецификаций шаблонов. Он состоит из основного шаблона и любого количества связанных шаблонов. Azure безопасно сохраняет спецификации шаблонов в группах ресурсов. Спецификации шаблонов поддерживают [Управление версиями](#versioning).

Для развертывания спецификации шаблона используются стандартные инструменты Azure, такие как PowerShell, Azure CLI, портал Azure, остальные и другие поддерживаемые пакеты SDK и клиенты. Используйте те же команды и передайте одни и те же параметры для шаблона.

Преимущество использования спецификаций шаблонов заключается в том, что группам в Организации не нужно повторно создавать или копировать шаблоны для распространенных сценариев. Вы создаете канонические шаблоны и предоставляете к ним общий доступ. Шаблоны, включаемые в спецификацию шаблона, должны быть проверены администраторами в вашей организации в соответствии с требованиями и рекомендациями Организации.

> [!NOTE]
> Спецификации шаблонов в настоящее время находятся на этапе предварительной версии. Чтобы использовать его, необходимо [зарегистрироваться в списке ожидания](https://aka.ms/templateSpecOnboarding).

## <a name="create-template-spec"></a>Создать спецификацию шаблона

В следующем примере показан простой шаблон для создания учетной записи хранения в Azure.

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "[concat('storage', uniqueString(resourceGroup().id))]",
      "type": "Microsoft.Storage/storageAccounts",
      "apiVersion": "2019-06-01",
      "location": "[resourceGroup().location]",
      "kind": "StorageV2",
      "sku": {
        "name": "Premium_LRS",
        "tier": "Premium"
      }
    }
  ]
}
```

При создании спецификации шаблона команды PowerShell или CLI передаются в основной файл шаблона. Если основной шаблон ссылается на связанные шаблоны, команды найдут их и упаковывают для создания спецификации шаблона. Дополнительные сведения см. в статье [Создание шаблона спецификации со связанными шаблонами](#create-a-template-spec-with-linked-templates).

Создайте шаблонную спецификацию с помощью:

```azurepowershell
New-AzTemplateSpec -Name storageSpec -Version 1.0 -ResourceGroupName templateSpecsRg -TemplateJsonFile ./mainTemplate.json
```

Вы можете просмотреть все спецификации шаблонов в подписке с помощью:

```azurepowershell
Get-AzTemplateSpec
```

Сведения о спецификации шаблона, включая ее версии, можно просмотреть с помощью:

```azurepowershell
Get-AzTemplateSpec -ResourceGroupName templateSpecsRG -Name storageSpec
```

## <a name="deploy-template-spec"></a>Развертывание спецификации шаблона

После создания спецификации шаблона пользователи с доступом на **Чтение** спецификации шаблона могут развернуть его. Сведения о предоставлении доступа см. [в разделе Учебник. Предоставление группе доступа к ресурсам Azure с помощью Azure PowerShell](../../role-based-access-control/tutorial-role-assignments-group-powershell.md).

Спецификации шаблонов можно развернуть с помощью портала, PowerShell, Azure CLI или в виде связанного шаблона в более крупном развертывании шаблона. Пользователи в организации могут развернуть шаблон спецификации в любой области в Azure (Группа ресурсов, подписка, Группа управления или клиент).

Вместо передачи пути или URI для шаблона вы развертываете спецификацию шаблона, предоставляя идентификатор ресурса. Идентификатор ресурса имеет следующий формат:

**/субскриптионс/{субскриптион-ид}/ресаурцеграупс/{ресаурце-грауп}/провидерс/микрософт.ресаурцес/темплатеспекс/{темплате-спек-наме}/версионс/{темплате-спек-версион}**

Обратите внимание, что идентификатор ресурса включает номер версии для спецификации шаблона.

Например, вы развертываете спецификацию шаблона с помощью следующей команды PowerShell.

```azurepowershell
$id = "/subscriptions/11111111-1111-1111-1111-111111111111/resourceGroups/templateSpecsRG/providers/Microsoft.Resources/templateSpecs/storageSpec/versions/1.0"

New-AzResourceGroupDeployment `
  -TemplateSpecId $id `
  -ResourceGroupName demoRG
```

На практике обычно выполняется `Get-AzTemplateSpec` , чтобы получить идентификатор спецификации шаблона, которую требуется развернуть.

```azurepowershell
$id = (Get-AzTemplateSpec -Name storageSpec -ResourceGroupName templateSpecsRg -Version 1.0).Version.Id

New-AzResourceGroupDeployment `
  -TemplateSpecId $id `
  -ResourceGroupName demoRG
```

## <a name="create-a-template-spec-with-linked-templates"></a>Создание спецификации шаблона со связанными шаблонами

Если основной шаблон для спецификации шаблона ссылается на связанные шаблоны, команды PowerShell и CLI могут автоматически находить и упаковывать связанные шаблоны с локального диска. Вам не нужно вручную настраивать учетные записи хранения или репозитории для размещения спецификаций шаблонов. все содержится в ресурсе спецификации шаблона.

Следующий пример состоит из основного шаблона с двумя связанными шаблонами. Пример является только выдержкой из шаблона. Обратите внимание, что для `relativePath` связи с другими шаблонами используется свойство с именем. `apiVersion` `2020-06-01` Для ресурса развертывания необходимо использовать или более поздней версии.

```json
{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    ...
    "resources": [
        {
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-06-01",
            ...
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "relativePath": "artifacts/webapp.json"
                }
            }
        },
        {
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-06-01",
            ...
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "relativePath": "artifacts/database.json"
                }
            }
        }
    ],
    "outputs": {}
}

```

При выполнении команды PowerShell или CLI для создания спецификации шаблона в предыдущем примере команда находит три файла: основной шаблон, шаблон веб-приложения ( `webapp.json` ) и шаблон базы данных ( `database.json` ), а затем упаковывает их в спецификацию шаблона.

Дополнительные сведения см. в разделе [учебник. Создание шаблона спецификации со связанными шаблонами](template-specs-create-linked.md).

## <a name="deploy-template-spec-as-a-linked-template"></a>Развертывание спецификации шаблона в качестве связанного шаблона

После создания спецификации шаблона ее легко использовать из шаблона ARM или другой спецификации шаблона. Чтобы создать ссылку на спецификацию шаблона, добавьте ее идентификатор ресурса в шаблон. Спецификация связанного шаблона автоматически развертывается при развертывании основного шаблона. Такое поведение позволяет разрабатывать спецификации модульных шаблонов и использовать их по мере необходимости.

Например, можно создать шаблон спецификации, который развертывает сетевые ресурсы, и другую спецификацию шаблона, которая развертывает ресурсы хранилища. В шаблонах ARM вы можете ссылаться на эти две спецификации шаблонов в любое время, когда вам понадобится настроить сетевые ресурсы или хранилища.

Следующий пример похож на предыдущий пример, но вы используете `id` свойство для связи с спецификацией шаблона, а не со `relativePath` свойством для связи с локальным шаблоном. Используйте `2020-06-01` для ресурса deployments в качестве версии API. В этом примере спецификации шаблонов находятся в группе ресурсов с именем **темплатеспексрг**.

```json
{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    ...
    "resources": [
        {
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-06-01",
            "name": "networkingDeployment",
            ...
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "id": "[resourceId('templateSpecsRG', 'Microsoft.Resources/templateSpecs/versions', 'networkingSpec', '1.0')]"
                }
            }
        },
        {
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-06-01",
            "name": "storageDeployment",
            ...
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "id": "[resourceId('templateSpecsRG', 'Microsoft.Resources/templateSpecs/versions', 'storageSpec', '1.0')]"
                }
            }
        }
    ],
    "outputs": {}
}
```

Дополнительные сведения о связывании спецификаций шаблонов см. в разделе [учебник. Развертывание шаблона спецификации в качестве связанного шаблона](template-specs-deploy-linked-template.md).

## <a name="versioning"></a>Управление версиями

При создании спецификации шаблона вы предоставляете для него номер версии. По мере выполнения итерации по коду шаблона можно либо обновить существующую версию (для исправлений), либо опубликовать новую версию. Версия является текстовой строкой. Можно выбрать любую систему управления версиями, включая семантическую версию. Пользователи спецификации шаблона могут предоставить номер версии, который они хотят использовать при развертывании.

## <a name="next-steps"></a>Дальнейшие действия

* Сведения о создании и развертывании шаблона см. в разделе [Краткое руководство. Создание и развертывание спецификации шаблона](quickstart-create-template-specs.md).

* Дополнительные сведения о связывании шаблонов в спецификациях шаблонов см. в разделе [учебник. Создание шаблона спецификации со связанными шаблонами](template-specs-create-linked.md).

* Дополнительные сведения о развертывании спецификации шаблона в качестве связанного шаблона см. [в разделе Учебник. Развертывание шаблона спецификации в качестве связанного шаблона](template-specs-deploy-linked-template.md).
