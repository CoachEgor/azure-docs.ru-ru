---
title: Структура шаблона и синтаксис
description: Описывается создание структуры и свойств шаблонов Azure Resource Manager с помощью декларативного синтаксиса JSON.
ms.topic: conceptual
ms.date: 04/20/2020
ms.openlocfilehash: 60d800eb5251fb3454ba60a67bd109261c6ff9d4
ms.sourcegitcommit: acb82fc770128234f2e9222939826e3ade3a2a28
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81687868"
---
# <a name="understand-the-structure-and-syntax-of-arm-templates"></a>Понимание структуры и синтаксиса шаблонов ARM

В этой статье описывается структура шаблона Azure Resource Manager (ARM). Статья содержит информацию о разных разделах шаблона и свойствах, которые доступны в этих разделах.

Эта статья предназначена для пользователей, которые имеют некоторое знакомство с шаблонами ARM. В нем содержится подробная информация о структуре шаблона. Для поэтапного учебника, который проведет вас в процессе создания шаблона, [см.](template-tutorial-create-first-template.md)

## <a name="template-format"></a>Формат шаблона

Шаблон с самой простой структурой содержит следующие элементы:

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "",
  "apiProfile": "",
  "parameters": {  },
  "variables": {  },
  "functions": [  ],
  "resources": [  ],
  "outputs": {  }
}
```

| Имя элемента | Обязательно | Описание |
|:--- |:--- |:--- |
| $schema |Да |Расположение файла схемы JSON, который описывает версию языка шаблона. Использоваваемый номер версии зависит от объема развертывания и редактора JSON.<br><br>Если вы используете [VS Code с расширением инструментов Управления ресурсами Azure,](use-vs-code-to-create-template.md)используйте последнюю версию для развертывания группресурсов:<br>`https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#`<br><br>Другие редакторы (включая Visual Studio) могут быть не в состоянии обрабатывать эту схему. Для редакторов используйте:<br>`https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#`<br><br>Для развертывания подписки используйте:<br>`https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#`<br><br>Для развертывания групп управления используйте:<br>`https://schema.management.azure.com/schemas/2019-08-01/managementGroupDeploymentTemplate.json#`<br><br>Для развертывания клиентов используйте:<br>`https://schema.management.azure.com/schemas/2019-08-01/tenantDeploymentTemplate.json#` |
| contentVersion |Да |Версия шаблона (например, 1.0.0.0). Для этого элемента можно предоставить любое значение. Это значение позволяет задокументировать важные изменения в шаблоне. При развертывании ресурсов с помощью шаблона это значение позволяет убедиться в том, что используется нужный шаблон. |
| apiProfile |нет | Версия API, которая служит в качестве коллекции версий API для типов ресурсов. Используйте это значение, чтобы избежать необходимости указывать версии API для каждого ресурса в шаблоне. Когда вы указываете версию профиля API и не указываете версию API для типа ресурса, менеджер ресурсов использует версию API для этого типа ресурсов, который определен в профиле.<br><br>Свойство профиля API особенно полезно при развертывании шаблона в различных средах, таких как Azure Stack и глобальный Azure. Используйте версию профиля API, чтобы убедиться, что ваш шаблон автоматически использует версии, которые поддерживаются в обеих средах. Для списка текущих версий профиля API и версий API [API Profile](https://github.com/Azure/azure-rest-api-specs/tree/master/profile)ресурсов, определенных в профиле, см.<br><br>Для получения дополнительной информации смотрите [версии Track с использованием профилей API](templates-cloud-consistency.md#track-versions-using-api-profiles). |
| [Параметры](#parameters) |нет |Значения, которые предоставляются при выполнении развертывания для настройки развертывания ресурсов. |
| [Переменные](#variables) |нет |Значения, используемые в виде фрагментов JSON в шаблоне для упрощения выражений на языке шаблона. |
| [Функции](#functions) |нет |Определяемые пользователем функции, доступные в шаблоне. |
| [Ресурсы](#resources) |Да |Типы ресурсов, которые развертываются или обновляются в группе ресурсов или подписке. |
| [Выходы](#outputs) |нет |Значения, возвращаемые после развертывания. |

Каждый элемент содержит свойства, которые можно задать. В этой статье подробнее описаны разделы шаблона.

## <a name="parameters"></a>Параметры

В разделе параметров шаблона указываются значения, которые вы можете вводить во время развертывания ресурсов. Существует ограничение в 256 параметров на один шаблон. Можно уменьшить количество параметров, используя объекты, содержащие несколько свойств.

Доступные свойства для параметра:

```json
"parameters": {
  "<parameter-name>" : {
    "type" : "<type-of-parameter-value>",
    "defaultValue": "<default-value-of-parameter>",
    "allowedValues": [ "<array-of-allowed-values>" ],
    "minValue": <minimum-value-for-int>,
    "maxValue": <maximum-value-for-int>,
    "minLength": <minimum-length-for-string-or-array>,
    "maxLength": <maximum-length-for-string-or-array-parameters>,
    "metadata": {
      "description": "<description-of-the parameter>"
    }
  }
}
```

| Имя элемента | Обязательно | Описание |
|:--- |:--- |:--- |
| параметр-имя |Да |Имя параметра. Должно быть допустимым идентификатором JavaScript. |
| type |Да |Тип значения параметра. Допустимые типы и значения: **string**, **securestring**, **int**, **bool**, **object**, **secureObject** и **array**. Посмотреть [типы данных.](#data-types) |
| defaultValue |нет |Значение параметра, используемое по умолчанию, если пользователь не задал иное значение. |
| allowedValues |нет |Массив допустимых значений параметра, по которому сверяются правильные значения. |
| minValue |нет |Минимальное значение для параметров типа int. Это включающее значение. |
| maxValue |нет |Максимальное значение для параметров типа int. Это включающее значение. |
| minLength |нет |Минимальная длина (включительно) параметров типа string, secure string и array. |
| maxLength |нет |Максимальная длина (включительно) параметров типа string, secure string и array. |
| description |нет |Описание параметра, отображаемого для пользователей на портале. Дополнительные сведения см. в разделе [комментариев в шаблонах](#comments). |

Примеры использования параметров [приведены в шаблонах «Параметры» в шаблонах управления ресурсами Azure.](template-parameters.md)

### <a name="data-types"></a>Типы данных

Для целых числа, передаваемых в качестве рядовых параметров, диапазон значений может быть ограничен SDK или инструментом командной строки, который используется для развертывания. Например, при использовании PowerShell для развертывания шаблона целые типы могут варьироваться от -2147483648 до 2147483647. Чтобы избежать этого ограничения, укажите большие значения рядов в [файле параметра.](parameter-files.md) Типы ресурсов применяют свои собственные ограничения для неопределимых свойств.

При указании значений boolean и integer в шаблоне не окружайте значение кавычками. Значения строки запуска и конца с двойными кавычками.

Объекты начинаются с левой скобки и заканчиваются правой скобкой. Массивы начинаются с левой кронштейна и заканчиваются правой кронштейном.

Безопасные строки и безопасные объекты не могут быть прочитаны после развертывания ресурса.

Для примеров типов форматирования [Parameter type formats](parameter-files.md#parameter-type-formats)данных см.

## <a name="variables"></a>Переменные

В разделе переменных вы создаете значения, которые можно использовать в разных частях шаблона. Переменные определять не обязательно, однако они часто упрощают шаблон, снижая число сложных выражений.

В следующем примере показаны доступные варианты определения переменной:

```json
"variables": {
  "<variable-name>": "<variable-value>",
  "<variable-name>": {
    <variable-complex-type-value>
  },
  "<variable-object-name>": {
    "copy": [
      {
        "name": "<name-of-array-property>",
        "count": <number-of-iterations>,
        "input": <object-or-value-to-repeat>
      }
    ]
  },
  "copy": [
    {
      "name": "<variable-array-name>",
      "count": <number-of-iterations>,
      "input": <object-or-value-to-repeat>
    }
  ]
}
```

Для получения `copy` информации об использовании для создания нескольких значений для переменной [см.](copy-variables.md)

Примеры использования переменных [приведены в шаблоне «Переменные» в шаблоне Управления ресурсами Azure.](template-variables.md)

## <a name="functions"></a>Функции

В шаблоне можно создать свои собственные функции. Эти функции доступны для использования в шаблоне. Как правило, вы определяете сложные выражения, которые не хотите повторяться на протяжении всего шаблона. Создаются определяемые пользователем функции на основе выражений и [функции](template-functions.md), которые поддерживаются в шаблонах.

При определении пользовательской функции есть несколько ограничений:

* Функция не может обращаться к переменным.
* Функция может использовать только параметры, определенные в самой функции. При использовании [функции параметров](template-functions-deployment.md#parameters) в функции, определяемой пользователем, вы ограничены параметрами для этой функции.
* Функция не может вызывать другие функции, определяемые пользователем.
* Для функции нельзя использовать [ссылочную функцию](template-functions-resource.md#reference).
* Для параметров этой функции нельзя задавать значения по умолчанию.

```json
"functions": [
  {
    "namespace": "<namespace-for-functions>",
    "members": {
      "<function-name>": {
        "parameters": [
          {
            "name": "<parameter-name>",
            "type": "<type-of-parameter-value>"
          }
        ],
        "output": {
          "type": "<type-of-output-value>",
          "value": "<function-return-value>"
        }
      }
    }
  }
],
```

| Имя элемента | Обязательно | Описание |
|:--- |:--- |:--- |
| namespace |Да |Namespace для пользовательских функций. Используйте, чтобы избежать конфликта именования с функциями шаблонов. |
| функция-имя |Да |Название пользовательской функции. При вызове функции объедините имя функции с пространством имен. Например, чтобы вызвать функцию, названную uniqueName `"[contoso.uniqueName()]"`в контосо пространства имен, используйте . |
| параметр-имя |нет |Название параметра, который будет использоваться в пользовательской функции. |
| значение параметра |нет |Тип значения параметра. Допустимые типы и значения: **string**, **securestring**, **int**, **bool**, **object**, **secureObject** и **array**. |
| тип вывода |Да |Тип выходного значения. Значения вывода поддерживают те же типы, что и параметры ввода функций. |
| выходное значение |Да |Выражение языка шаблонов, которое оценивается и возвращается из функции. |

Например, можно найти функции, определяемые [пользователями, в шаблоне Azure Resource Manager.](template-user-defined-functions.md)

## <a name="resources"></a>Ресурсы

В разделе resources определяются ресурсы, которые развертываются или обновляются.

Ресурсы определяются с помощью следующей структуры:

```json
"resources": [
  {
      "condition": "<true-to-deploy-this-resource>",
      "type": "<resource-provider-namespace/resource-type-name>",
      "apiVersion": "<api-version-of-resource>",
      "name": "<name-of-the-resource>",
      "comments": "<your-reference-notes>",
      "location": "<location-of-resource>",
      "dependsOn": [
          "<array-of-related-resource-names>"
      ],
      "tags": {
          "<tag-name1>": "<tag-value1>",
          "<tag-name2>": "<tag-value2>"
      },
      "sku": {
          "name": "<sku-name>",
          "tier": "<sku-tier>",
          "size": "<sku-size>",
          "family": "<sku-family>",
          "capacity": <sku-capacity>
      },
      "kind": "<type-of-resource>",
      "copy": {
          "name": "<name-of-copy-loop>",
          "count": <number-of-iterations>,
          "mode": "<serial-or-parallel>",
          "batchSize": <number-to-deploy-serially>
      },
      "plan": {
          "name": "<plan-name>",
          "promotionCode": "<plan-promotion-code>",
          "publisher": "<plan-publisher>",
          "product": "<plan-product>",
          "version": "<plan-version>"
      },
      "properties": {
          "<settings-for-the-resource>",
          "copy": [
              {
                  "name": ,
                  "count": ,
                  "input": {}
              }
          ]
      },
      "resources": [
          "<array-of-child-resources>"
      ]
  }
]
```

| Имя элемента | Обязательно | Описание |
|:--- |:--- |:--- |
| condition | нет | Логическое значение, указывающее, будет ли подготавливаться ресурс во время этого развертывания. Если установлено значение `true`, при развертывании создается ресурс. Если установлено значение `false`, при развертывании ресурс не создается. Посмотреть [условие](conditional-resource-deployment.md). |
| type |Да |Тип ресурса. Это значение представляет собой комбинацию пространства имен поставщика ресурсов и типа ресурса (например, **Microsoft.Storage/storageAccounts).** Чтобы определить доступные значения, [см.](/azure/templates/) Для детского ресурса формат типа зависит от того, вложен онащен в родительский ресурс или определен за пределами родительского ресурса. См. о [настройке имени и типа дочернего ресурса](child-resource-name-type.md). |
| версия_API |Да |Версия REST API, которая будет использована для создания ресурса. Чтобы определить доступные значения, [см.](/azure/templates/) |
| name |Да |Имя ресурса. Имя должно соответствовать ограничениям компонентов URI, определенным в RFC3986. Службы Azure, которые разоблачают имя ресурса для сторонних сторон, проверяют имя, чтобы убедиться, что это не попытка подделать другую идентификацию. Для детского ресурса формат имени зависит от того, вложено ли оно в родительский ресурс или определено за пределами родительского ресурса. См. о [настройке имени и типа дочернего ресурса](child-resource-name-type.md). |
| comments |нет |Заметки по ресурсам в шаблоне. Дополнительные сведения см. в разделе [комментариев в шаблонах](template-syntax.md#comments). |
| location |Различается |Поддерживаемые географические расположения указанного ресурса. Вы можете выбрать любое из доступных расположений. Но обычно имеет смысл выбрать расположение, которое находится недалеко от пользователей. Кроме того, целесообразно разместить взаимодействующие ресурсы в одном регионе. Большинству типов ресурсов нужно расположение, но некоторым типам (например, назначению роли) оно не требуется. Посмотреть [расположение установить ресурс.](resource-location.md) |
| Свойство dependsOn |нет |Ресурсы, которые должны быть развернуты перед развертыванием этого ресурса. Resource Manager оценивает зависимости между ресурсами и развертывает эти ресурсы в правильном порядке. Если ресурсы не зависят друг от друга, они развертываются параллельно. Значение может представлять собой разделенный запятыми список имен ресурсов или уникальных идентификаторов ресурсов. Выводится только список ресурсов, развертываемых в этом шаблоне. Ресурсы, которые не определены в этом шаблоне, уже должны существовать. Избегайте добавления ненужных зависимостей, так как это может замедлить развертывание и привести к созданию циклических зависимостей. Рекомендации по настройке зависимостей см. в статье [Определение зависимостей в шаблонах диспетчера ресурсов Azure](define-resource-dependency.md). |
| tags |нет |Теги, связанные с ресурсом. Примените теги, чтобы логически организовать ресурсы в подписке. |
| sku | нет | В некоторых ресурсах допускается использовать значения, определяющие номер SKU для развертывания. Например, можно указать тип избыточности для учетной записи хранения. |
| kind | нет | В некоторых ресурсах допускается использовать значение, которое определяет тип развертываемого ресурса. Например, можно указать в качестве типа создаваемой базы данных Cosmos DB. |
| copy |нет |Количество создаваемых ресурсов (если нужно несколько экземпляров). Параллельный режим используется по умолчанию. Используйте последовательный режим, если вы не хотите развертывать все ресурсы одновременно. Дополнительные сведения см. в статье [Создание нескольких экземпляров ресурсов в Azure Resource Manager](copy-resources.md). |
| План | нет | В некоторых ресурсах допускается использовать значения, определяющие номер плана для развертывания. Например, можно указать образ Marketplace для виртуальной машины. |
| properties |нет |Параметры конфигурации ресурса. Значения свойств совпадают со значениями, указываемыми в тексте запроса для операции REST API (метод PUT) для создания ресурса. Кроме того, можно указать массив copy для создания нескольких экземпляров свойства. Чтобы определить доступные значения, [см.](/azure/templates/) |
| ресурсов |нет |Дочерние ресурсы, которые зависят от определяемого ресурса. Следует указать только те типы ресурсов, которые разрешены в схеме родительского ресурса. Зависимость от родительского ресурса не подразумевается. Ее необходимо определить явным образом. См. о [настройке имени и типа дочернего ресурса](child-resource-name-type.md). |

## <a name="outputs"></a>Выходные данные

В разделе выходных данных следует указать значения, которые возвращаются после развертывания. Как правило, значения возвращаются из развертываемых ресурсов.

В следующем примере показана структура определения выходных данных:

```json
"outputs": {
  "<output-name>": {
    "condition": "<boolean-value-whether-to-output-value>",
    "type": "<type-of-output-value>",
    "value": "<output-value-expression>",
    "copy": {
      "count": <number-of-iterations>,
      "input": <values-for-the-variable>
    }
  }
}
```

| Имя элемента | Обязательно | Описание |
|:--- |:--- |:--- |
| имя вывода |Да |Имя выходного значения. Должно быть допустимым идентификатором JavaScript. |
| condition |нет | Логическое значение, которое указывает, возвращается ли выходное значение. Если установлено значение `true`, то при развертывании значение является частью выходных данных. Если установлено значение `false`, при развертывании выходное значение не создается. Когда не задано, по умолчанию используется значение `true`. |
| type |Да |Тип выходного значения. Выходные значения поддерживает те же типы, что и входные параметры шаблона. Если вы указываете **безопасную строку** для типа вывода, значение не отображается в истории развертывания и не может быть извлечено из другого шаблона. Чтобы использовать секретное значение в нескольких шаблонах, храните секрет в Key Vault и ссылка на секрет в файле параметра. Дополнительные сведения см. в статье [Использование Azure Key Vault для передачи защищенного значения параметра во время развертывания](key-vault-parameter.md). |
| value |нет |Выражение на языке шаблона, которое вычисляется и возвращается в качестве выходного значения. Укажите **значение** или **копию**. |
| copy |нет | Используется для возврата более одного значения для вывода. Укажите **значение** или **копию**. Для получения дополнительной информации смотрите [итерацию вывода в шаблонах azure Resource Manager.](copy-outputs.md) |

Примеры использования выходных [данных приведены в шаблоне Azure Resource Manager.](template-outputs.md)

<a id="comments" />

## <a name="comments-and-metadata"></a>Комментарии и метаданные

Есть несколько вариантов добавления комментариев и метаданных к шаблону.

### <a name="comments"></a>Комментарии

Для входной комментарии, `//` `/* ... */` вы можете использовать либо или но этот синтаксис не работает со всеми инструментами. Вы не можете использовать редактор шаблона портала для работы над шаблонами с всокольными комментариями. Если вы добавляете этот стиль комментариев, убедитесь, что используемые инструменты поддерживают встроенные комментарии JSON.

> [!NOTE]
> Для развертывания шаблонов с комментариями с помощью Azure CLI с версией 2.3.0 или старше необходимо использовать `--handle-extended-json-format` переключатель.

```json
{
  "type": "Microsoft.Compute/virtualMachines",
  "apiVersion": "2018-10-01",
  "name": "[variables('vmName')]", // to customize name, change it in variables
  "location": "[parameters('location')]", //defaults to resource group location
  "dependsOn": [ /* storage account and network interface must be deployed first */
    "[resourceId('Microsoft.Storage/storageAccounts/', variables('storageAccountName'))]",
    "[resourceId('Microsoft.Network/networkInterfaces/', variables('nicName'))]"
  ],
```

В Visual Studio Code [расширение Azure Resource Manager Tools](use-vs-code-to-create-template.md#install-resource-manager-tools-extension) может автоматически обнаруживать шаблон «Менеджер ресурсов» и соответствующим образом менять языковой режим. Если вы видите **шаблон менеджера ресурсов Azure** в правом нижнем углу VS Code, можно использовать внеочередные комментарии. В таком случае встроенные комментарии больше не будут помечены как недопустимые.

![Режим шаблона шаблона Visual Studio Code Azure Resource Manager](./media/template-syntax/resource-manager-template-editor-mode.png)

### <a name="metadata"></a>Метаданные

Вы можете добавить объект `metadata` практически в любом месте шаблона. Resource Manager игнорирует объект, но ваш редактор JSON может предупредить вас, что свойство недопустимо. Определите необходимые свойства в объекте.

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "comments": "This template was developed for demonstration purposes.",
    "author": "Example Name"
  },
```

В разделе **параметров** добавьте объект `metadata` со свойством `description`.

```json
"parameters": {
  "adminUsername": {
    "type": "string",
    "metadata": {
      "description": "User name for the Virtual Machine."
    }
  },
```

При развертывании шаблона через портал текст, который вы указываете в описании, автоматически используется в качестве подсказки для этого параметра.

![Отображается подсказка для параметра](./media/template-syntax/show-parameter-tip.png)

В разделе **ресурсов** добавьте элемент `comments` или объект метаданных. В следующем примере показан и элемент комментариев, и объект метаданных.

```json
"resources": [
  {
    "type": "Microsoft.Storage/storageAccounts",
    "apiVersion": "2018-07-01",
    "name": "[concat('storage', uniqueString(resourceGroup().id))]",
    "comments": "Storage account used to store VM disks",
    "location": "[parameters('location')]",
    "metadata": {
      "comments": "These tags are needed for policy compliance."
    },
    "tags": {
      "Dept": "[parameters('deptName')]",
      "Environment": "[parameters('environment')]"
    },
    "sku": {
      "name": "Standard_LRS"
    },
    "kind": "Storage",
    "properties": {}
  }
]
```

В разделе **выходных данных** добавьте объект метаданных в выходное значение.

```json
"outputs": {
  "hostname": {
    "type": "string",
    "value": "[reference(variables('publicIPAddressName')).dnsSettings.fqdn]",
    "metadata": {
      "comments": "Return the fully qualified domain name"
    }
  },
```

Добавить объект метаданных в определяемые пользователем функции невозможно.

## <a name="multi-line-strings"></a>Многолинейные строки

Вы можете разбить строку на несколько строк. Например, в следующем примере JSON см. свойство местоположения и один из комментариев.

```json
{
  "type": "Microsoft.Compute/virtualMachines",
  "apiVersion": "2018-10-01",
  "name": "[variables('vmName')]", // to customize name, change it in variables
  "location": "[
    parameters('location')
    ]", //defaults to resource group location
  /*
    storage account and network interface
    must be deployed first
  */
  "dependsOn": [
    "[resourceId('Microsoft.Storage/storageAccounts/', variables('storageAccountName'))]",
    "[resourceId('Microsoft.Network/networkInterfaces/', variables('nicName'))]"
  ],
```

Для развертывания шаблонов с многолинейными строками с помощью Azure CLI с версией 2.3.0 или старше необходимо использовать `--handle-extended-json-format` переключатель.

## <a name="next-steps"></a>Следующие шаги

* Полные шаблоны для различных типов решений доступны на странице [Шаблоны быстрого запуска Azure](https://azure.microsoft.com/documentation/templates/).
* Дополнительные сведения о функциях, которые можно использовать в шаблонах, см. в статье [Функции шаблонов Azure Resource Manager](template-functions.md).
* Инструкции по объединению нескольких шаблонов при развертывании см. в статье [Использование связанных шаблонов в Azure Resource Manager](linked-templates.md).
* Дополнительные рекомендации по созданию шаблонов см. в статье [Рекомендации по работе с шаблонами Azure Resource Manager](template-best-practices.md).
* Рекомендации по созданию шаблонов Resource Manager, которые можно использовать для Azure Stack и всех окружений Azure, см. в статье [Разработка шаблонов Azure Resource Manager для обеспечения согласованности с облаком](templates-cloud-consistency.md).
