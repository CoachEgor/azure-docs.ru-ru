---
title: 'Управление кластером Avere vFXT: Azure'
description: 'Сведения об управлении кластером Avere: добавлении или удалении узлов, перезагрузке, остановке и уничтожении кластера vFXT'
author: ekpgh
ms.service: avere-vfxt
ms.topic: conceptual
ms.date: 01/29/2019
ms.author: v-erkell
ms.openlocfilehash: be9205fdf7fec0661d7382ed0d1bedf47487b15e
ms.sourcegitcommit: 41ca82b5f95d2e07b0c7f9025b912daf0ab21909
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "60409776"
---
# <a name="manage-the-avere-vfxt-cluster"></a>Управление кластером Avere vFXT

После создания кластера может потребоваться добавить узлы кластера либо остановить или перезагрузить кластер. Вам необходимо знать, как после завершения проекта остановить и удалить кластер без возможности восстановления. 

В зависимости от задач управления кластером для этого может потребоваться использовать панель управления Avere, сценарий создания кластеров в командной строке vfxt.py или портал Azure. 

В этой таблице приводится обзор средств, которые можно использовать для каждой задачи. 

| Действие | Панель управления Avere | vfxt.py  | Портал Azure |
| --- | --- | --- | --- |
| Добавление узлов кластера | Нет | Да | Нет |
| Удаление узлов кластера | Да | Нет | Нет |
| Остановка узла кластера | Да (можно также перезапустить службы или выполнить перезагрузку) | Нет | Выключение виртуальной машины узла на портале интерпретируется как сбой узла |
| Запуск остановленного узла | Нет | Нет | Да |
| Уничтожение одного узла кластера | Нет | Нет | Да |
| Перезагрузка кластера |  |  |  |
| Завершение работы или безопасная остановка кластера | Да | Да | Нет |
| Уничтожение кластера  | Нет | Да | Да, но целостность данных не гарантируется |

Подробные инструкции для каждого средства приведены ниже.

## <a name="about-stopped-instances-in-azure"></a>Сведения об остановленных экземплярах в Azure

При завершении работы или остановке любой виртуальной машины Azure перестает взиматься плата за вычислительные ресурсы, но вы по-прежнему должны оплачивать их хранение. Если вы завершаете работу узла vFXT или всего кластера vFXT и не собираетесь перезагружать его, следует удалить связанные виртуальные машины на портале Azure. 

На портале Azure для *остановленного* узла (который можно перезагрузить) отображается состояние **Остановлено**. Для *удаленного* узла отображается состояние **Остановлено (освобождено)** и перестает взиматься плата за вычислительные ресурсы или хранение.

Прежде чем удалить виртуальную машину, все измененные данные необходимо записать из кэша во внутреннее хранилище, используя панель управления Avere или параметры vfxt.py для остановки или завершения работы кластера.

## <a name="manage-the-cluster-with-avere-control-panel"></a>Управление кластером на панели управления Avere 

Панель управления Avere можно использовать для выполнения следующих задач: 

* остановка или перезагрузка отдельных узлов;
* удаление узла из кластера;
* остановка или перезагрузка всего кластера.

На панели управления Avere первостепенное внимание уделено целостности данных, поэтому перед возможной операцией уничтожения предпринимается попытка записать измененные данные во внутреннее хранилище. Это более надежный вариант, чем портал Avere. 

Откройте панель управления Avere в веб-браузере. Если вам нужна помощь, следуйте инструкциям в статье [Access the vFXT cluster](avere-vfxt-cluster-gui.md) (Доступ к кластеру vFXT).

### <a name="manage-nodes-with-avere-control-panel"></a>Управление узлами на панели управления Avere

На странице параметров **FXT Nodes** (Узлы FXT) содержатся элементы управления отдельными узлами.

Чтобы завершить работу, перезагрузите узел или удалите его. Для этого найдите узел в списке на странице **FXT Nodes** (Узлы FXT) и нажмите соответствующую кнопку в столбце **Actions** (Действия).

> [!NOTE] 
> При изменении количества активных узлов IP-адреса могут перемещаться между узлами кластера.

Дополнительные сведения см. в разделе [Cluster > FXT Nodes](<https://azure.github.io/Avere/legacy/ops_guide/4_7/html/gui_fxt_nodes.html#gui-fxt-nodes>) (Кластер > Узлы FXT) в руководстве по параметрам кластера Avere.

### <a name="stop-or-reboot-the-cluster-with-avere-control-panel"></a>Остановка или перезагрузка кластера на панели управления Avere

На странице параметров **System Maintenance** (Обслуживание системы) содержатся команды для перезапуска служб кластеров, перезагрузки кластера или безопасного выключения кластера. Дополнительные сведения см. в разделе [Administration > System Maintenance](<https://azure.github.io/Avere/legacy/ops_guide/4_7/html/gui_system_maintenance.html#gui-system-maintenance>) (Администрирование > Обслуживание системы) в руководстве по параметрам кластера Avere.

Когда кластер завершает работу, сначала на вкладке **Dashboard** (Панель мониторинга) появляются сообщения о состоянии. Через несколько секунд сеанс панели управления Avere перестает отвечать на запросы. Это означает, что кластер завершил работу.

## <a name="manage-the-cluster-with-vfxtpy"></a>Управление кластером с помощью сценария vfxt.py

vfxt.py является программой командной строки для создания кластера и управления им. 

Сценарий vfxt.py предустановлен на виртуальной машине контроллера кластера. Если вы хотите установить его в другой системе, перейдите к документации по адресу <https://github.com/Azure/AvereSDK>.

С помощью сценария vfxt.py можно выполнять такие задачи управления кластером:

* добавление новых узлов в кластер;
* остановка или запуск кластера;  
* уничтожение кластера.

Как и панель управления Avere, операции vfxt.py пытаются обеспечить постоянное хранение измененных данных во внутреннем хранилище перед завершением работы или уничтожением кластера или узла. Это более надежный вариант, чем портал Avere.

Полное руководство по использованию vfxt.py доступно в GitHub: [Cloud cluster management with vfxt.py](https://github.com/azure/averesdk/blob/master/docs/README.md) (Управление облачным кластером с помощью vfxt.py).

### <a name="add-cluster-nodes-with-vfxtpy"></a>Добавление узлов кластера с помощью сценария vfxt.py

Пример сценария команды для добавления узлов кластера включен в контроллер кластера. Найдите файл ``./add-nodes`` в контроллере, откройте его в редакторе и настройте, используя сведения о кластере. 

Для использования этой команды кластер должен быть запущен. 

Укажите следующие значения: 

* имя группы ресурсов для кластера, а также для ресурсов сети и хранилища, если их группа ресурсов отличается;
* расположение кластера;
* сеть и подсеть кластера; 
* Роль доступа узла кластера (использовать встроенную роль [Avere оператор](../role-based-access-control/built-in-roles.md#avere-operator))
* пароль администратора и IP-адрес для управления кластером; 
* количество узлов, которые необходимо добавить (1, 2 или 3);
* тип экземпляра узла и значения размера кэша. 

Если вы не используете прототип, то необходимо создать команду, подобную приведенной ниже, в том числе все сведения, описанные выше. 

```bash
   vfxt.py --cloud-type azure --from-environment \
   --resource-group GROUP_NAME \ 
   [--network-resource-group GROUP_NAME --storage-resource-group GROUP_NAME]  \
   --location LOCATION --azure-network NETWORK_NAME --azure-subnet SUBNET_NAME \
   --add-nodes --nodes NODE_COUNT \
   --management-address CLUSTER_IP --admin-password ADMIN_PASSWORD \
   --instance-type TYPE --node-cache-size SIZE \
   --azure-role "Avere Operator" \
   --log ~/vfxt.log
```

Дополнительные сведения см. в разделе [Add nodes to a cluster](https://github.com/Azure/AvereSDK/blob/master/docs/using_vfxt_py.md#add-nodes-to-a-cluster) (Добавление узлов в кластер) в руководстве по использованию vfxt.py.

### <a name="stop-a-cluster-with-vfxtpy"></a>Остановка кластера с помощью сценария vfxt.py

```bash
vfxt.py --cloud-type azure --from-environment --stop --resource-group GROUPNAME --admin-password PASSWORD --management-address ADMIN_IP --location LOCATION --azure-network NETWORK --azure-subnet SUBNET
```

### <a name="start-a-stopped-cluster-with-vfxtpy"></a>Запуск остановленного кластера с помощью сценария vfxt.py

```bash
vfxt.py --cloud-type azure --from-environment --start --resource-group GROUPNAME --admin-password PASSWORD --management-address ADMIN_IP --location LOCATION --azure-network NETWORK --azure-subnet SUBNET --instances INSTANCE1_ID INSTANCE2_ID INSTANCE3_ID ...
```    

Так как кластер остановлен, необходимо передать идентификаторы экземпляров, чтобы указать узлы кластера. Дополнительные сведения см. в разделе [Specifying which cluster to modify](https://github.com/Azure/AvereSDK/blob/master/docs/using_vfxt_py.md#specifying-which-cluster-to-modify) (Указание кластера для изменения) в руководстве по использованию сценария vfxt.py.

### <a name="destroy-a-cluster-with-vfxtpy"></a>Уничтожение кластера с помощью сценария vfxt.py

```bash
vfxt.py --cloud-type azure --from-environment --destroy --resource-group GROUPNAME --admin-password PASSWORD --management-address ADMIN_IP --location LOCATION --azure-network NETWORK --azure-subnet SUBNET --management-address ADMIN_IP
```

Параметр ``--quick-destroy`` можно использовать в том случае, если вам не нужно записывать измененные данные из кэша кластера.

Дополнительные сведения см. в [руководстве по использованию сценария vfxt.py](<https://github.com/Azure/AvereSDK/blob/master/docs/README.md>).  

## <a name="manage-cluster-vms-from-the-azure-portal"></a>Управление виртуальными машинами кластера с помощью портала Azure 

С помощью портала Azure можно уничтожить виртуальные машины кластера по отдельности, но если сначала не завершить работу кластера надлежащим образом, целостность данных не гарантируется. 

С помощью портала Azure можно выполнять такие задачи управления кластером: 

* запуск остановленного узла vFXT;
* остановка отдельного узла vFXT (кластер интерпретирует это как сбой узла);
* уничтожение кластера vFXT, *если* не нужно обеспечить запись измененных данных в кэше кластера в основной фильтр;
* окончательное удаление узлов vFXT и других ресурсов кластера после безопасного завершения их работы.

### <a name="restart-vfxt-instances-from-the-azure-portal"></a>Перезапуск экземпляров vFXT на портале Azure

Если вам нужно перезапустить остановленный узел, необходимо использовать портал Azure. Выберите **Виртуальные машины** в меню слева и щелкните имя виртуальной машины в списке, чтобы открыть страницу обзора.

Нажмите кнопку **Запуск** в верхней части страницы обзора для повторной активации виртуальной машины.

![Снимок экрана портала Azure, отображающий параметр запуска остановленной виртуальной машины](media/avere-vfxt-start-stopped-incurring-annot.png)

### <a name="delete-cluster-nodes"></a>Удаление узлов кластера

Если необходимо удалить один узел из кластера vFXT, но сохранить остальную часть кластера, следует сначала [удалить узел из кластера](#manage-nodes-with-avere-control-panel) с помощью панели управления Avere.

> [!CAUTION]
> Если удалить узел, не удалив его предварительно из кластера vFXT, возможна потеря данных.

Чтобы безвозвратно уничтожить один или несколько экземпляров, используемых как узел vFXT, перейдите на портал Azure.
Выберите **Виртуальные машины** в меню слева и щелкните имя виртуальной машины в списке, чтобы открыть страницу обзора.

Нажмите кнопку **Удалить** в верхней части страницы обзора, чтобы безвозвратно уничтожить виртуальную машину.

Этот метод можно использовать, чтобы окончательно удалить узлы кластера после безопасного завершения их работы. 

### <a name="destroy-the-cluster-from-the-azure-portal"></a>Уничтожение кластера с помощью портала Azure

> [!NOTE] 
> Если требуется записать все оставшиеся изменения клиента в кэше во внутреннее хранилище, используйте параметр `--destroy` в сценарии vfxt.py или панель управления Avere, чтобы завершить работу кластера надлежащим образом перед удалением экземпляров узла на портале Azure.

Чтобы уничтожить экземпляры узла без возможности восстановления, удалите их на портале Azure. Вы можете удалить их по одному, как описано выше, или сразу несколько одним действием. Чтобы удалить сразу несколько, найдите все виртуальные машины кластера на странице **Виртуальные машины**, выберите их, установив флажки, и нажмите кнопку **Удалить**.

![Список виртуальных машин на портале, отфильтрованный по термину "кластер"; для трех из четырех виртуальных машин установлен флажок, и они выделены](media/avere-vfxt-multi-vm-delete.png)

### <a name="delete-additional-cluster-resources-from-the-azure-portal"></a>Удаление дополнительных кластерных ресурсов на портале Azure

Если вы создали дополнительные ресурсы специально для кластера vFXT, может потребоваться удалить их в процессе удаления кластера. Не уничтожайте элементы, которые содержат нужные данные, или все элементы, которые являются общими с другими проектами.

Помимо удаления узлов кластера рекомендуется удалить такие компоненты: 

* виртуальная машина контроллера кластера;
* диски данных, связанные с узлами кластера;
* сетевые интерфейсы и общедоступные IP-адреса, связанные с компонентами кластера;
* виртуальные сети;
* учетные записи хранения (**только** если они не содержат важных данных);
* Группа доступности 

![Список "Все ресурсы" портала Azure, содержащий ресурсы, созданные для тестового кластера](media/avere-vfxt-all-resources-list.png)

### <a name="delete-a-clusters-resource-group-from-the-azure-portal"></a>Удаление группы ресурсов кластера на портале Azure

Если вы создали группу ресурсов специально для размещения кластера, вы можете уничтожить все связанные ресурсы для кластера, уничтожив эту группу. 

> [!Caution] 
> Уничтожайте группу ресурсов только в том случае, если вы уверены, что ни одно из значений не находится в группе. Например, обязательно переместите все нужные данные из всех контейнеров хранилища в группе ресурсов.  

Чтобы удалить группу ресурсов, щелкните **Группы ресурсов** в левом меню портала и отфильтруйте список групп ресурсов, чтобы найти ту, которая была создана для кластера vFXT. Выберите группу ресурсов и щелкните многоточие в правом углу панели. Выберите **Удалить группу ресурсов**. На портале появится запрос на подтверждение удаления, которое является необратимым.  

![Группа ресурсов, отображающая действие "Удалить группу ресурсов"](media/avere-vfxt-delete-resource-group.png)
