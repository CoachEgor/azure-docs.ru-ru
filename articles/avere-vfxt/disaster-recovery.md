---
title: Руководство по восстановлению стихийных бедствий для Avere vFXT для Azure
description: Как защитить данные в Avere vFXT для Azure от случайного удаления или сбоев
author: ekpgh
ms.service: avere-vfxt
ms.topic: conceptual
ms.date: 12/10/2019
ms.author: rohogue
ms.openlocfilehash: 28278f76497d6e9d0fee221bb4ef32fe6d369db0
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75966649"
---
# <a name="disaster-recovery-guidance-for-avere-vfxt-for-azure"></a>Руководство по восстановлению стихийных бедствий для Avere vFXT для Azure

В этой статье излагаются стратегии защиты Avere vFXT для рабочего процесса Azure и дается рекомендации по резервному копированию данных, чтобы можно было восстановиться после аварий или простоев.

Avere vFXT для Azure временно хранит данные в своем кэше. Данные хранятся в долгосрочной перспективе в бэк-эндовых системах хранения данных - локальной аппаратных системах, контейнерах для хранения Azure Blob или обоих.

Чтобы защититься от простоев и возможной потери данных, рассмотрим следующие четыре области:

* Защита от простоев, если система Avere vFXT для Azure становится недоступной
* Защита данных в кластерном кэше
* Защита данных в бэк-энде NAS аппаратного хранения
* Защита данных в облачном хранилище Azure Blob

Каждый клиент Avere vFXT для Клиента Azure должен создать свой собственный комплексный план аварийного восстановления, который включает планы для этих элементов. Можно также повысить устойчивость к приложениям, которые используете с кластером vFXT. Читайте ссылки в [следующих шагах](#next-steps) для справки.

## <a name="protect-against-downtime"></a>Защита от простоев

Избыточность встроена в Avere vFXT для продукта Azure:

* Кластер очень доступен, и отдельные кластерные узлы могут выполнить сминимальным истечением.
* Данные, измененные в кэше, регулярно записываются на серверные ядра (аппаратные NAS или Azure Blob) для долгосрочного хранения.

Каждый кластер Avere vFXT для Azure должен находиться в одной зоне доступности, но можно использовать избыточные кластеры, расположенные в разных зонах или разных регионах, чтобы обеспечить быстрый доступ в случае регионального простоя.

Вы также можете позиционировать контейнеры хранения в нескольких регионах, если вы обеспокоены потерей доступа к данным. Однако имейте в виду, что транзакции между регионами имеют более высокую задержку и более высокую стоимость, чем транзакции, которые остаются в пределах региона.

## <a name="protect-data-in-the-cluster-cache"></a>Защита данных в кэше кластера

Кэшированные данные всегда записываются в основные регистраторы перед очередной остановкой, но при неконтролируемом завершении измененные данные в кэше могут быть потеряны.

Если вы используете кластер только для оптимизации считываемых файлов, не требуется никаких изменений. Если кластер также используется для кэша изменений файлов (записывает), рассмотрите вопрос о том, следует ли корректировать [политики кэша основных](https://azure.github.io/Avere/legacy/ops_guide/4_7/html/gui_manage_cache_policies.html) файлов<!-- link to legacy doc --> настроить, как часто данные записываются на долгосрочное хранение.

Как правило, план восстановления должен быть направлен на резервное копирование систем хранения данных, которые содержат больше данных и, как правило, более важны для восстановления рабочего процесса после сбоя.

## <a name="protect-data-in-nas-core-filers"></a>Защита данных в файлах ядра NAS

Используйте общепринятые методы для защиты данных, хранящихся в локальном базовом файлена NAS, включая снимки и полные резервные копирования в соответствии с рекомендациями поставщика NAS. Аварийное восстановление для этих основных регистраторов выходит за рамки данной статьи.

## <a name="protect-data-in-azure-blob-storage"></a>Защита данных в хранилище Azure Blob

Avere vFXT для Azure использует локально-избыточное хранилище (LRS) для ядре ядра Azure Blob. Это означает, что данные в контейнерах Blob автоматически копируются для защиты от временных сбоев оборудования в центре обработки данных.

В этом разделе приводятся советы о том, как дальнейше защитить ваши данные в хранилище Blob от редких перебоев в работе по всему региону или случайных удаляний.

Рекомендации по защите данных в хранилище Azure Blob включают:

* Копирование критически важных данных на другую учетную запись хранения в другом регионе часто (так часто, как это определено планом аварийного восстановления).
* Контроль доступа к данным на всех целевых системах для предотвращения случайного удаления или повреждения. Рассмотрите возможность использования [блокировок ресурсов](../azure-resource-manager/management/lock-resources.md) для хранения данных.
* Включите функцию Avere vFXT для [облачного снимка](<https://azure.github.io/Avere/legacy/ops_guide/4_7/html/gui_cloud_snapshot_policies.html>) Azure для ваших регистраторов основных блоков Blob.

### <a name="copy-avere-vfxt-core-filer-data-to-a-backup-account"></a>Копирование данных якорного файлера Avere vFXT на резервную учетную запись

Выполните следующие действия, чтобы установить резервную запись данных в другой учетной записи.

1. При необходимости создайте новый ключ шифрования и безопасно храните его за пределами затронутых систем.

   Если ваши данные зашифрованы кластером Avere vFXT для кластера Azure, необходимо создать новый ключ шифрования, прежде чем копировать данные на другую учетную запись хранения. Храните этот ключ и пароль надежно в безопасном объекте и который не будет затронут региональным сбоем.

   Этот ключ необходимо предоставить при добавлении контейнера в кластер, даже если вы повторно добавляете его в исходный кластер.

   Прочитайте [настройки шифрования облака](<https://azure.github.io/Avere/legacy/ops_guide/4_7/html/gui_cloud_encryption_settings.html>)<!-- link to legacy doc site --> для получения подробной информации.

   Если контейнер использует только встроенное шифрование Azure, вы можете пропустить этот шаг.

1. Удалите основной файлер из системы. Это заставляет кластер записывать все измененные данные в резервное хранилище.

   Хотя вам придется повторно добавить основной файлер после резервного копирования, удаление это лучший способ гарантировать, что все данные полностью написаны на задней части. (Опция "приостановить" иногда может оставить измененные данные в кэше.) <!-- xxx true? or just metadata? -->

   Сделать к сведению имя основного файлера и информацию о стыковке (перечислены на странице **Namespace** в панели управления), так что вы можете повторить его, когда вы повторно добавить контейнер после резервного копирования.

   Используйте панель управления кластером для удаления основного файлера. [Откройте панель управления кластером](avere-vfxt-cluster-gui.md) и выберите **основные файлеры** > **Управление ядром файлеров.** Найдите систему хранения, которую вы хотите создать резервную копию, и используйте кнопку **Удалить,** чтобы удалить ее из кластера.

1. Создайте новый пустой контейнер для хранения Blob в другой учетной записи хранения в другом регионе.

1. Используйте любой удобный инструмент копирования для копирования данных о основном файлере в новый контейнер. Копия должна реплицировать данные без изменений и без нарушения проприетарного формата облачной файловой системы, используемого Avere vFXT для Azure. Инструменты на основе Azure включают [AzCopy,](../storage/common/storage-use-azcopy-v10.md) [Azure PowerShell](../data-lake-store/data-lake-store-get-started-powershell.md)и [фабрику данных Azure.](../data-factory/connector-azure-data-lake-store.md)

1. После копирования данных в резервный контейнер добавьте исходный контейнер обратно в кластер, как описано в [хранении настройки.](avere-vfxt-add-storage.md)

   * Используйте одно и то же имя файлера и информацию о стыковке, чтобы рабочие процессы клиентов не меняли.
   * Установите значение **содержимого ковша** в существующую опцию данных.
   * Если контейнер был зашифрован кластером, необходимо ввести текущий ключ шифрования для его содержимого. (Это ключ, который вы обновили в первом шаге.)

Для резервного копирования после первого, вам не нужно создавать новый контейнер для хранения. Тем не менее, подумайте о создании нового ключа шифрования при каждом удобном для вас ключе, чтобы убедиться, что текущий ключ хранится в месте, которое вы помните.

### <a name="access-a-backup-data-source-during-an-outage"></a>Доступ к резервному источнику данных во время сбой

Чтобы получить доступ к резервному контейнеру из кластера Avere vFXT для кластера Azure, следуйте этому процессу:

1. При необходимости создайте новый avere vFXT для кластера Azure в незатрагном регионе.

   > [!TIP]
   > При создании кластера Avere vFXT для кластера Azure можно сохранить копию шаблона и параметров создания Avere. При сохранении этой информации при создании основного кластера можно использовать ее для создания кластера замены с теми же свойствами. На [странице резюме](avere-vfxt-deploy.md#validation-and-purchase) щелкните **шаблон Скачать и ссылку параметров.** Сохраните информацию в файле перед созданием кластера.

1. Добавьте новый файлер ядра облака, который указывает на дубликат контейнера Blob.

   Убедитесь в том, чтобы указать, что целевой контейнер уже содержит данные в настройке **содержимого ковша** ядра мастера создания ядра. (Система должна предупредить вас, если вы случайно оставите этот набор **пустым.)**  <!-- you can't add a populated volume at cluster creation time via template, only create a fresh one -->

1. При необходимости обновите клиентов, чтобы они устанавливали новый кластер или новый основной файлер вместо оригинала. (Если вы добавите файлер ядра замены с тем же именем и пути соединения, что и исходный контейнер, вам не нужно будет обновлять клиентские процессы, если вам не нужно будет монтировать новый кластер на новый IP-адрес.)

## <a name="next-steps"></a>Дальнейшие действия

* Для получения дополнительной информации о настройке настроек для Avere vFXT для Azure прочитайте [настройку кластера.](avere-vfxt-tuning.md)
* Узнайте больше о аварийном восстановлении и создании устойчивых приложений в Azure:

  * [Техническое руководство по обеспечению устойчивости в Azure](https://docs.microsoft.com/azure/architecture/framework/resiliency/overview)
  * [Восстановление после прерывания работы служб во всем регионе](https://docs.microsoft.com/azure/architecture/resiliency/recovery-loss-azure-region)
  * [Аварийное восстановление и высокий уровень доступности для приложений Azure](<https://docs.microsoft.com/azure/resiliency/resiliency-disaster-recovery-high-availability-azure-applications>)
  <!-- can't find these in the source tree to use relative links -->
