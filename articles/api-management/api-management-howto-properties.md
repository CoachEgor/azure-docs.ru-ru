---
title: Как использовать именованные значения в политиках управления API Azure
description: Узнайте, как использовать именованные значения в политиках управления API Azure.
services: api-management
documentationcenter: ''
author: vladvino
manager: erikre
editor: ''
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.topic: article
ms.date: 01/08/2020
ms.author: apimpm
ms.openlocfilehash: 7c25455e28e57ff40664a69718a2e406b52b7632
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75834298"
---
# <a name="how-to-use-named-values-in-azure-api-management-policies"></a>Как использовать именованные значения в политиках управления API Azure

Политики управления API представляют собой одну из эффективных функций системы, позволяющих порталу Azure изменять поведение интерфейса API путем его настройки. Политика — это коллекция правил, которые выполняются последовательно над запросом или ответом API. Для создания правил политики можно использовать литеральные текстовые значения, выражения политики и именованные значения.

Каждый экземпляр службы Управления API имеет набор пар ключей/значений, которые называются именованными значениями, которые являются глобальными для экземпляра службы. Количество предметов в коллекции не ограничено. Именованные значения могут использоваться для управления постоянными значениями строк во всех конфигурациях и политиках API. Каждое названное значение может иметь следующие атрибуты:

| Атрибут      | Тип            | Описание                                                                                                                            |
| -------------- | --------------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| `Display name` | строка          | Используется для обозначения названного значения в политиках. Строка от одного до 256 символов. Разрешены только буквы, цифры, точка и тире. |
| `Value`        | строка          | Фактическое значение. Не должно быть пустым или состоять только из белого пространства. Максимум 4096 символов длиной.                                        |
| `Secret`       | Логическое         | Определяет, является ли значение секретом и должно ли быть зашифровано.                                                               |
| `Tags`         | Массив строк | Используется для фильтрации названного списка значений. До 32 тегов.                                                                                    |

![Именованные значения](./media/api-management-howto-properties/named-values.png)

Именованные значения могут содержать буквальные строки и [выражения политики.](/azure/api-management/api-management-policy-expressions) Например, значение `Expression` является выражением политики, которое возвращает строку, содержащую текущую дату и время. Названное `Credential` значение помечено как секрет, поэтому его значение не отображается по умолчанию.

| name       | Значение                      | Секрет | Теги          |
| ---------- | -------------------------- | ------ | ------------- |
| Значение      | 42                         | False  | жизненно важные номера |
| Учетные данные | ••••••••••••••••••••••     | True   | security      |
| Выражение | @(DateTime.Now.ToString()) | False  |               |

> [!NOTE]
> Вместо названных значений, хранящихся в службе управления API, можно использовать значения, хранящиеся в службе [Azure Key Vault,](https://azure.microsoft.com/services/key-vault/) как показано в этом [примере.](https://github.com/Azure/api-management-policy-snippets/blob/master/examples/Look%20up%20Key%20Vault%20secret%20using%20Managed%20Service%20Identity.policy.xml)

## <a name="to-add-and-edit-a-named-value"></a>Добавление и отодевать именное значение

![Добавление названного значения](./media/api-management-howto-properties/add-property.png)

1. Выберите **Интерфейсы API** в разделе **УПРАВЛЕНИЕ API**.
2. Выберите раздел **Именованные значения**.
3. Нажмите **на пресс-службу**.

    Поля "Имя" и "Значение" обязательны для заполнения. Если значение является секретом, проверьте _Это секретный_ флажок. Введите один или несколько необязательных тегов, чтобы упорядочить именованные значения, и нажмите кнопку "Сохранить".

4. Нажмите кнопку **Создать**.

Как только названное значение создано, его можно отобразить, нажав на него. При изменении имениного имени значения любые политики, которые ссылаются на указанное значение, автоматически обновляются для использования нового имени.

Для получения информации о редактировании названного [Edit a named value using the REST API](/rest/api/apimanagement/2019-01-01/property?patch)значения с помощью REST API см.

## <a name="to-delete-a-named-value"></a>Удаление именованного значения

Чтобы удалить названное значение, нажмите **Удалить** рядом с именным значением для удаления.

> [!IMPORTANT]
> Если на указанное значение ссылаются какие-либо политики, вы не сможете успешно удалить его, пока не удалите названное значение из всех политик, которые его используют.

Для получения информации об удалении названного значения с помощью REST API [см.](/rest/api/apimanagement/2019-01-01/property/delete)

## <a name="to-search-and-filter-named-values"></a>Для поиска и фильтрации именованных значений

На вкладке **Именованные значения** находятся функции поиска и фильтрации, упрощающие управление этими значениями. Чтобы отфильтровать список именных значений по имени, введите термин поиска в текстовый ящик **свойства поиска.** Чтобы отобразить все именованные значения, очистите поле **Свойство поиска** и нажмите клавишу ВВОД.

Чтобы отфильтровать список по тегу, введите один или несколько тегов в **фильтр по тегам** textbox. Чтобы отобразить все именованные значения, очистите поле **Фильтровать по тегам** и нажмите клавишу ВВОД.

## <a name="to-use-a-named-value"></a>Использовать названное значение

Чтобы использовать названное значение в политике, поместите его `{{ContosoHeader}}`имя в двойную пару фигур, как, как показано в следующем примере:

```xml
<set-header name="{{ContosoHeader}}" exists-action="override">
  <value>{{ContosoHeaderValue}}</value>
</set-header>
```

В этом примере `ContosoHeader` используется как имя заголовка в политике `set-header`, а `ContosoHeaderValue` — в качестве значения этого заголовка. Когда эта политика оценивается во время запроса или `{{ContosoHeader}}` `{{ContosoHeaderValue}}` ответа на шлюз Управления API и заменяется соответствующими значениями.

Именованные значения можно использовать как полные значения атрибутов или элементов, как показано в предыдущем примере. Также их можно вставлять в литеральное текстовое выражение или комбинировать с частью этого выражения, как показано в следующем примере: `<set-header name = "CustomHeader{{ContosoHeader}}" ...>`

Кроме того, именованные значения могут содержать выражения политики. В следующем примере используется `ExpressionProperty` .

```xml
<set-header name="CustomHeader" exists-action="override">
    <value>{{ExpressionProperty}}</value>
</set-header>
```

При оценке этой политики `{{ExpressionProperty}}` заменяется своим значением: `@(DateTime.Now.ToString())`. Поскольку значение является выражением политики, выражение проходит оценку и политика продолжает выполнение.

Это можно проверить на портале разработчика, вызвав операцию, область действия которой включает именованные свойства. В следующем примере вызывается операция с двумя политиками `set-header` с именованными значениями из предыдущего примера. Обратите внимание, что ответ содержит два пользовательских заголовка, которые были настроены с помощью политик с именованными значениями.

![Developer portal][api-management-send-results]

Если вы посмотрите на [след API Inspector](api-management-howto-api-inspector.md) для вызова, который включает две предыдущие политики образца с названными значениями, можно увидеть две `set-header` политики с вставленными значениями имени, а также оценку выражения политики для названного значения, содержащего выражение политики.

![Трассировка с помощью инспектора API][api-management-api-inspector-trace]

Хотя именованные значения могут содержать выражения политики, они не могут содержать другие именованные значения. Если текст, содержащий ссылку на имя значения, используется для значения, `Text: {{MyProperty}}`например, эта ссылка не будет решена и заменена.

## <a name="next-steps"></a>Дальнейшие действия

-   Узнайте больше о работе с политиками
    -   [Политики в управлении API](api-management-howto-policies.md)
    -   [Справочник по политикам](/azure/api-management/api-management-policies)
    -   [Выражения политики](/azure/api-management/api-management-policy-expressions)

[api-management-send-results]: ./media/api-management-howto-properties/api-management-send-results.png
[api-management-properties-filter]: ./media/api-management-howto-properties/api-management-properties-filter.png
[api-management-api-inspector-trace]: ./media/api-management-howto-properties/api-management-api-inspector-trace.png
