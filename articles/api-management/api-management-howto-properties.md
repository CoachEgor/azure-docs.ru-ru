---
title: Как использовать именованные значения в политиках управления API Azure
description: Узнайте, как использовать именованные значения в политиках управления API Azure.
services: api-management
documentationcenter: ''
author: vladvino
manager: erikre
editor: ''
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.topic: article
ms.date: 11/05/2019
ms.author: apimpm
ms.openlocfilehash: d11239aa49a53a90a38f2b5336d36cea6c97e9df
ms.sourcegitcommit: ac56ef07d86328c40fed5b5792a6a02698926c2d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/08/2019
ms.locfileid: "73824173"
---
# <a name="how-to-use-named-values-in-azure-api-management-policies"></a>Как использовать именованные значения в политиках управления API Azure

Политики управления API представляют собой одну из эффективных функций системы, позволяющих порталу Azure изменять поведение интерфейса API путем его настройки. Политика — это коллекция правил, которые выполняются последовательно над запросом или ответом API. Для создания правил политики можно использовать литеральные текстовые значения, выражения политики и именованные значения.

Каждый экземпляр службы управления API имеет коллекцию свойств пар "ключ-значение", которые называются именованными значениями, которые являются глобальными для экземпляра службы. На число элементов в коллекции не наложено ограничение. Именованные значения можно использовать для управления постоянными строковыми значениями во всех конфигурациях и политиках API. Каждое именованное значение может иметь следующие атрибуты:

| Атрибут      | Тип            | Description (Описание)                                                                                                                         |
| -------------- | --------------- | ----------------------------------------------------------------------------------------------------------------------------------- |
| `Display name` | строка          | Используется для ссылки на именованное значение в политиках. Строка от одного до 256 символов. Допускаются только буквы, цифры, точки и тире. |
| `Value`        | строка          | Фактическое значение. Не должно быть пустым или состоять только из пробелов. Не более 4096 символов.                                     |
| `Secret`       | Логическое         | Определяет, является ли значение секретом и должно ли быть зашифровано.                                                            |
| `Tags`         | Массив строк | Используется для фильтрации списка именованных значений. До 32 тегов.                                                                                    |

![Именованные значения](./media/api-management-howto-properties/named-values.png)

Именованные значения могут содержать литеральные строки и [выражения политики](/azure/api-management/api-management-policy-expressions). Например, значение `Expression` является выражением политики, которое возвращает строку, содержащую текущую дату и время. Именованное значение `Credential` помечено как секретное, поэтому его значение не отображается по умолчанию.

| Имя       | Значение                      | Секрет | Теги          |
| ---------- | -------------------------- | ------ | ------------- |
| Значение      | 42                         | Ложь  | важнейшие номера |
| Учетные данные | ••••••••••••••••••••••     | Да   | security      |
| Expression | @(DateTime.Now.ToString()) | Ложь  |               |

## <a name="to-add-and-edit-a-named-value"></a>Добавление и изменение именованного значения

![Добавить именованное значение](./media/api-management-howto-properties/add-property.png)

1. Выберите **Интерфейсы API** в разделе **Управление API**.
2. Выберите раздел **Именованные значения**.
3. Нажмите кнопку **+ Добавить**.

    Поля "Имя" и "Значение" обязательны для заполнения. Если значение является секретом, установите флажок *этот параметр является секретным* . Введите один или несколько необязательных тегов, чтобы упорядочить именованные значения, и нажмите кнопку "Сохранить".

4. Щелкните **Создать**.

После создания именованного значения его можно изменить, щелкнув его. При изменении имени именованного значения все политики, ссылающиеся на это именованное значение, автоматически обновляются для использования нового имени.

Сведения об изменении именованного значения с помощью REST API см. в разделе [изменение именованного значения с помощью REST API](/rest/api/apimanagement/2019-01-01/property?patch).

## <a name="to-delete-a-named-value"></a>Удаление именованного значения

Чтобы удалить именованное значение, щелкните **Удалить** рядом с именованным значением, которое нужно удалить.

> [!IMPORTANT]
> Если на именованное значение ссылаются какие-либо политики, вы не сможете успешно удалить его, пока не будет удалено именованное значение из всех политик, которые его используют.

Сведения об удалении именованного значения с помощью REST API см. в разделе [Удаление именованного значения с помощью REST API](/rest/api/apimanagement/2019-01-01/property/delete).

## <a name="to-search-and-filter-named-values"></a>Поиск и фильтрация именованных значений

На вкладке **Именованные значения** находятся функции поиска и фильтрации, упрощающие управление этими значениями. Чтобы отфильтровать список именованных значений по имени, введите условие поиска в текстовое поле **Свойства поиска** . Чтобы отобразить все именованные значения, очистите поле **Свойство поиска** и нажмите клавишу ВВОД.

Чтобы отфильтровать список по тегу, введите один или несколько тегов в текстовое поле **Фильтровать по тегам** . Чтобы отобразить все именованные значения, очистите поле **Фильтровать по тегам** и нажмите клавишу ВВОД.

## <a name="to-use-a-named-value"></a>Использование именованного значения

Чтобы использовать именованное значение в политике, поместите его имя в двойную пару скобок, например `{{ContosoHeader}}`, как показано в следующем примере:

```xml
<set-header name="{{ContosoHeader}}" exists-action="override">
  <value>{{ContosoHeaderValue}}</value>
</set-header>
```

В этом примере `ContosoHeader` используется как имя заголовка в политике `set-header`, а `ContosoHeaderValue` — в качестве значения этого заголовка. При оценке этой политики во время запроса или ответа шлюза управления API `{{ContosoHeader}}` и `{{ContosoHeaderValue}}` заменяются соответствующими значениями.

Именованные значения можно использовать как полные значения атрибутов или элементов, как показано в предыдущем примере. Также их можно вставлять в литеральное текстовое выражение или комбинировать с частью этого выражения, как показано в следующем примере: `<set-header name = "CustomHeader{{ContosoHeader}}" ...>`

Кроме того, именованные значения могут содержать выражения политики. В следующем примере используется `ExpressionProperty` .

```xml
<set-header name="CustomHeader" exists-action="override">
    <value>{{ExpressionProperty}}</value>
</set-header>
```

При оценке этой политики `{{ExpressionProperty}}` заменяется своим значением: `@(DateTime.Now.ToString())`. Поскольку значение является выражением политики, выражение проходит оценку и политика продолжает выполнение.

Это можно проверить на портале разработчика, вызвав операцию, область действия которой включает именованные свойства. В следующем примере вызывается операция с двумя политиками `set-header` с именованными значениями из предыдущего примера. Обратите внимание, что ответ содержит два пользовательских заголовка, которые были настроены с помощью политик с именованными значениями.

![Портал разработчика][api-management-send-results]

Если взглянуть на [трассировку инспектора API](api-management-howto-api-inspector.md) для вызова, включающего два предыдущих примера политик с именованными значениями, можно увидеть две политики `set-header` с вставленными именованными значениями, а также вычисление выражения политики для именованного значения, которое содержит выражение политики.

![Трассировка с помощью инспектора API][api-management-api-inspector-trace]

Хотя именованные значения могут содержать выражения политики, они не могут содержать другие именованные значения. Если для значения используется текст, содержащий ссылку на именованное значение, например `Text: {{MyProperty}}`, эта ссылка не будет разрешена и заменена.

## <a name="next-steps"></a>Дальнейшие действия

-   Узнайте больше о работе с политиками
    -   [Политики в управлении API](api-management-howto-policies.md)
    -   [Справочник по политикам службы управления Azure API](/azure/api-management/api-management-policies)
    -   [Выражения политики](/azure/api-management/api-management-policy-expressions)

[api-management-send-results]: ./media/api-management-howto-properties/api-management-send-results.png
[api-management-properties-filter]: ./media/api-management-howto-properties/api-management-properties-filter.png
[api-management-api-inspector-trace]: ./media/api-management-howto-properties/api-management-api-inspector-trace.png
