---
title: Использование именованных значений в политиках Управления API Azure
description: Сведения об использования именованных значений в политиках Управления API Azure.
services: api-management
documentationcenter: ''
author: vladvino
manager: erikre
editor: ''
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.topic: article
ms.date: 01/08/2020
ms.author: apimpm
ms.openlocfilehash: 28a9f37f58a6c056bf23a85fcf2641f407988891
ms.sourcegitcommit: dabd9eb9925308d3c2404c3957e5c921408089da
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2020
ms.locfileid: "86243483"
---
# <a name="how-to-use-named-values-in-azure-api-management-policies"></a>Использование именованных значений в политиках Управления API Azure

Политики управления API представляют собой одну из эффективных функций системы, позволяющих порталу Azure изменять поведение интерфейса API путем его настройки. Политика — это коллекция правил, которые выполняются последовательно над запросом или ответом API. Для создания правил политики можно использовать литеральные текстовые значения, выражения политики и именованные значения.

Каждый экземпляр службы "Управление API" имеет коллекцию пар "ключ — значение", которые называются именованными значениями и являются глобальными для экземпляра службы. В коллекции не налагаются ограничения по числу элементов. Именованные значения можно использовать для управления постоянными строковыми значениями во всей конфигурации и политиках API. Каждое именованное свойство может иметь следующие атрибуты.

| attribute      | Тип            | Описание                                                                                                                            |
| -------------- | --------------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| `Display name` | строка          | Используется для ссылки на именованное значение в политиках. Строка длиной от 1 до 256 символов. Допускаются только буквы, цифры, символы точки и дефиса. |
| `Value`        | строка          | Фактическое значение. Не может быть пустым или состоять только из пробелов. Длина не должна превышать 4096 символов.                                        |
| `Secret`       | Логическое         | Определяет, является ли значение секретом и должно ли быть зашифровано.                                                               |
| `Tags`         | Массив строк | Используется для фильтрации списка именованных значений. Не более 32 тегов.                                                                                    |

![Именованные значения](./media/api-management-howto-properties/named-values.png)

Именованные значения могут содержать строковые литералы и [выражения политики](./api-management-policy-expressions.md). Например, значение `Expression` является выражением политики, которое возвращает строку, содержащую текущую дату и время. Именованное свойство `Credential` помечено как секрет, поэтому его значение по умолчанию не отображается.

| Имя       | Значение                      | Секрет | Теги          |
| ---------- | -------------------------- | ------ | ------------- |
| Значение      | 42                         | False  | vital-numbers |
| Учетные данные | ••••••••••••••••••••••     | True   | security      |
| Выражение | @(DateTime.Now.ToString()) | False  |               |

> [!NOTE]
> Вместо именованных значений, которые хранятся в службе "Управление API", можно использовать сохраненные в службе [Azure Key Vault](https://azure.microsoft.com/services/key-vault/) значения, как показано в [этом примере](https://github.com/Azure/api-management-policy-snippets/blob/master/examples/Look%20up%20Key%20Vault%20secret%20using%20Managed%20Service%20Identity.policy.xml).

## <a name="to-add-and-edit-a-named-value"></a>Добавление и изменение именованного значения

![Добавление именованного значения](./media/api-management-howto-properties/add-property.png)

1. Выберите **Интерфейсы API** в разделе **УПРАВЛЕНИЕ API**.
2. Выберите раздел **Именованные значения**.
3. Нажмите кнопку **+ Добавить**.

    Поля "Имя" и "Значение" обязательны для заполнения. Если значение является секретом, установите флажок _Это секрет_. Введите один или несколько необязательных тегов, чтобы упорядочить именованные значения, и нажмите кнопку "Сохранить".

4. Нажмите кнопку **Создать**.

После создания вы можете изменить свойство, щелкнув его имя. Если у именованного значения изменится имя, все политики, ссылающиеся на это свойство, автоматически обновляются для использования нового имени.

## <a name="to-delete-a-named-value"></a>Удаление именованного значения

Чтобы удалить именованное значение, щелкните **Удалить** рядом с этим значением.

> [!IMPORTANT]
> Если на именованное значение ссылаются какие-либо политики, его удастся удалить только после удаления ссылок на него из всех этих политик.

## <a name="to-search-and-filter-named-values"></a>Поиск и фильтрация именованных значений

На вкладке **Именованные значения** находятся функции поиска и фильтрации, упрощающие управление этими значениями. Чтобы отфильтровать список именованных значений по имени, введите условие поиска в текстовое поле **Search property** (Свойство поиска). Чтобы отобразить все именованные значения, очистите поле **Свойство поиска** и нажмите клавишу ВВОД.

Чтобы отфильтровать список по тегам, введите один или несколько тегов в текстовое поле **Фильтровать по тегам**. Чтобы отобразить все именованные значения, очистите поле **Фильтровать по тегам** и нажмите клавишу ВВОД.

## <a name="to-use-a-named-value"></a>Использование именованного значения

Чтобы использовать именованное значение в политике, поместите его имя в две пары фигурных скобок, например `{{ContosoHeader}}`. Это же демонстрируется в следующем примере.

```xml
<set-header name="{{ContosoHeader}}" exists-action="override">
  <value>{{ContosoHeaderValue}}</value>
</set-header>
```

В этом примере `ContosoHeader` используется как имя заголовка в политике `set-header`, а `ContosoHeaderValue` — в качестве значения этого заголовка. При оценке этой политики во время запроса или ответа к шлюзу Управления API `{{ContosoHeader}}` и `{{ContosoHeaderValue}}` заменяются соответствующими значениями.

Именованные значения можно использовать как полные значения атрибутов или элементов, как показано в предыдущем примере. Также их можно вставлять в литеральное текстовое выражение или комбинировать с частью этого выражения, как показано в следующем примере: `<set-header name = "CustomHeader{{ContosoHeader}}" ...>`

Кроме того, именованные значения могут содержать выражения политики. В следующем примере используется `ExpressionProperty` .

```xml
<set-header name="CustomHeader" exists-action="override">
    <value>{{ExpressionProperty}}</value>
</set-header>
```

При оценке этой политики `{{ExpressionProperty}}` заменяется своим значением: `@(DateTime.Now.ToString())`. Поскольку значение является выражением политики, выражение проходит оценку и политика продолжает выполнение.

Это можно проверить на портале разработчика, вызвав операцию, область действия которой включает именованные свойства. В следующем примере вызывается операция с двумя политиками `set-header` с именованными значениями из предыдущего примера. Обратите внимание, что ответ содержит два пользовательских заголовка, которые были настроены с помощью политик с именованными значениями.

![Developer portal][api-management-send-results]

В [трассировке инспектора API](api-management-howto-api-inspector.md) для вызова, который содержит две политики с именованными значениями из предыдущего примера, вы увидите две политики `set-header` со вставленными именованными значениями, а также оценку выражения политики для именованного значения, которое содержало это выражение политики.

![Трассировка с помощью инспектора API][api-management-api-inspector-trace]

Хотя именованные значения могут содержать выражения политики, они не могут содержать другие именованные значения. Если в качестве значения используется текст, содержащий ссылку на именованное значение (например, `Text: {{MyProperty}}`), эта ссылка не будет разрешена и заменена.

## <a name="next-steps"></a>Дальнейшие действия

-   Узнайте больше о работе с политиками
    -   [Политики в управлении API](api-management-howto-policies.md)
    -   [Справочник по политикам](./api-management-policies.md)
    -   [Выражения политики](./api-management-policy-expressions.md)

[api-management-send-results]: ./media/api-management-howto-properties/api-management-send-results.png
[api-management-properties-filter]: ./media/api-management-howto-properties/api-management-properties-filter.png
[api-management-api-inspector-trace]: ./media/api-management-howto-properties/api-management-api-inspector-trace.png
