---
title: Использование именованных значений в политиках управления API Azure
description: Использование именованных значений в политиках управления API Azure.
services: api-management
documentationcenter: ''
author: vladvino
manager: erikre
editor: ''
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.topic: article
ms.date: 07/22/2019
ms.author: apimpm
ms.openlocfilehash: d71d71c4d289235e5b67a5201c1f7417274b8fca
ms.sourcegitcommit: 82499878a3d2a33a02a751d6e6e3800adbfa8c13
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/28/2019
ms.locfileid: "70072330"
---
# <a name="how-to-use-named-values-in-azure-api-management-policies"></a>Использование именованных значений в политиках управления API Azure

Политики управления API представляют собой одну из эффективных функций системы, позволяющих порталу Azure изменять поведение интерфейса API путем его настройки. Политика — это коллекция правил, которые выполняются последовательно над запросом или ответом API. Для создания правил политики можно использовать литеральные текстовые значения, выражения политики и именованные значения.

Каждый экземпляр службы управления API имеет коллекцию свойств пар "ключ-значение", которые называются именованными значениями и являются глобальными для экземпляра службы. На число элементов в коллекции не наложено ограничение. Именованные значения можно использовать для управления постоянными строковыми значениями во всех конфигурациях и политиках API. Каждое именованное значение может иметь следующие атрибуты:

| Атрибут      | Type            | Описание                                                                                                                         |
| -------------- | --------------- | ----------------------------------------------------------------------------------------------------------------------------------- |
| `Display name` | строка          | Используется для ссылки на свойство в политиках. Строка от одного до 256 символов. Допускаются только буквы, цифры, точки и тире. |
| `Value`        | строка          | Фактическое значение. Не должно быть пустым или состоять только из пробелов. Не более 4096 символов.                                     |
| `Secret`       | boolean         | Определяет, является ли значение секретом и должно ли быть зашифровано.                                                            |
| `Tags`         | Массив строк | Используется для фильтрации списка свойств. До 32 тегов.                                                                                    |

![Именованные значения](./media/api-management-howto-properties/named-values.png)

Именованные значения могут содержать литеральные строки и [выражения политики](/azure/api-management/api-management-policy-expressions). Например, значение `Expression` является выражением политики, которое возвращает строку, содержащую текущую дату и время. Именованное значение `Credential` помечается как секретное, поэтому его значение не отображается по умолчанию.

| Название       | Значение                      | Секрет | Tags          |
| ---------- | -------------------------- | ------ | ------------- |
| Значение      | 42                         | False  | важнейшие номера |
| Учетные данные | ••••••••••••••••••••••     | True   | безопасность      |
| Выражение | @(DateTime.Now.ToString()) | False  |               |

## <a name="to-add-and-edit-a-property"></a>Добавление и изменение свойства

![Добавление свойства](./media/api-management-howto-properties/add-property.png)

1. Выберите **Интерфейсы API** в разделе **УПРАВЛЕНИЕ API**.
2. Выберите раздел **Именованные значения**.
3. Нажмите кнопку **+ Добавить**.

    Поля "Имя" и "Значение" обязательны для заполнения. Если значение свойства является секретом, установите флажок "Это секрет". Введите один или несколько необязательных тегов, чтобы упорядочить именованные значения, и нажмите кнопку "Сохранить".

4. Нажмите кнопку **Создать**.

Чтобы изменить свойство после его создания, щелкните его. Если изменяется имя свойства, все политики, которые ссылаются на это свойство, автоматически обновляются для использования нового имени.

Сведения об изменении свойства с помощью REST API см. в [этом разделе](/rest/api/apimanagement/2019-01-01/property?patch).

## <a name="to-delete-a-property"></a>Удаление свойства

Чтобы удалить свойство, нажмите кнопку **Удалить** рядом с нужным свойством.

> [!IMPORTANT]
> Если на свойство ссылаются какие-либо политики, его можно удалить только после удаления из всех политик, которые его используют.

Сведения об удалении свойства с помощью REST API см. в [этом разделе](/rest/api/apimanagement/2019-01-01/property/delete).

## <a name="to-search-and-filter-named-values"></a>Поиск и фильтрация именованных значений

На вкладке **Именованные значения** находятся функции поиска и фильтрации, упрощающие управление этими значениями. Чтобы отфильтровать список свойств по имени свойства, введите условие поиска в поле **Свойство поиска** . Чтобы отобразить все именованные значения, очистите поле **Свойство поиска** и нажмите клавишу ВВОД.

Чтобы отфильтровать список свойств по значениям тегов, введите один или несколько тегов в поле **Фильтровать по тегам** . Чтобы отобразить все именованные значения, очистите поле **Фильтровать по тегам** и нажмите клавишу ВВОД.

## <a name="to-use-a-property"></a>Использование свойства

Чтобы использовать свойство в политике, поместите имя свойства внутри пары двойных фигурных скобок `{{ContosoHeader}}`, как показано в следующем примере.

```xml
<set-header name="{{ContosoHeader}}" exists-action="override">
  <value>{{ContosoHeaderValue}}</value>
</set-header>
```

В этом примере `ContosoHeader` используется как имя заголовка в политике `set-header`, а `ContosoHeaderValue` — в качестве значения этого заголовка. При оценке этой политики во время запроса или ответа к шлюзу управления API `{{ContosoHeader}}` и `{{ContosoHeaderValue}}` заменяются соответствующими значениями свойств.

Именованные значения можно использовать как полные значения атрибутов или элементов, как показано в предыдущем примере. Также их можно вставлять в литеральное текстовое выражение или комбинировать с частью этого выражения, как показано в следующем примере: `<set-header name = "CustomHeader{{ContosoHeader}}" ...>`

Кроме того, именованные значения могут содержать выражения политики. В следующем примере используется `ExpressionProperty` .

```xml
<set-header name="CustomHeader" exists-action="override">
    <value>{{ExpressionProperty}}</value>
</set-header>
```

При оценке этой политики `{{ExpressionProperty}}` заменяется своим значением: `@(DateTime.Now.ToString())`. Поскольку значение является выражением политики, выражение проходит оценку и политика продолжает выполнение.

Это можно проверить на портале разработчика, вызвав операцию, область действия которой включает именованные свойства. В следующем примере вызывается операция с двумя политиками `set-header` с именованными значениями из предыдущего примера. Обратите внимание, что ответ содержит два пользовательских заголовка, которые были настроены с помощью политик с именованными значениями.

![Портал разработчика][api-management-send-results]

Если взглянуть на [трассировку инспектора API](api-management-howto-api-inspector.md) для вызова, который содержит две политики с именованными значениями из предыдущего примера, можно увидеть две политики `set-header` со вставленными значениями свойств, а также оценку выражения политики для свойства, содержащего выражение политики.

![Трассировка с помощью инспектора API][api-management-api-inspector-trace]

Хотя значения свойств могут содержать выражения политики, они не могут содержать другие именованные значения. Если текст, содержащий ссылку на свойство, используется для значения свойства, такого как `Property value text {{MyProperty}}`, эта ссылка на свойство не будет заменена и включится в значение свойства.

## <a name="next-steps"></a>Следующие шаги

-   Узнайте больше о работе с политиками
    -   [Политики в управлении API](api-management-howto-policies.md)
    -   [Справочник по политикам](/azure/api-management/api-management-policies)
    -   [Выражения политики](/azure/api-management/api-management-policy-expressions)

[api-management-send-results]: ./media/api-management-howto-properties/api-management-send-results.png
[api-management-properties-filter]: ./media/api-management-howto-properties/api-management-properties-filter.png
[api-management-api-inspector-trace]: ./media/api-management-howto-properties/api-management-api-inspector-trace.png
