---
title: Импорт приложения-функции Azure в качестве API в службу управления API Azure | Документация Майкрософт
description: В этом руководстве показано, как импортировать приложение-функцию Azure в качестве API в службу "Управление API Azure".
services: api-management
documentationcenter: ''
author: mikebudzynski
manager: cfowler
editor: ''
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.topic: tutorial
ms.date: 06/28/2019
ms.author: apimpm
ms.openlocfilehash: 0c4a95669eea1b98baea5f9a866598e000c0923c
ms.sourcegitcommit: 598c5a280a002036b1a76aa6712f79d30110b98d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/15/2019
ms.locfileid: "74107850"
---
# <a name="import-an-azure-function-app-as-an-api-in-azure-api-management"></a>Импорт приложения-функции Azure в качестве API в службу управления API Azure

Служба "Управления API Azure" поддерживает импорт приложений-функций Azure в качестве новых API или их добавление в уже существующие API. Во время операции в приложении-функции Azure автоматически создается ключ узла, который затем присваивается именованному значению в службе "Управление API Azure".

В этой статье рассматривается импорт приложения-функции Azure в виде API в службу "Управление API Azure". Здесь также описывается процесс тестирования.

Вы научитесь:

> [!div class="checklist"]
> * импортировать приложение-функцию Azure в качестве API;
> * добавлять приложение-функцию Azure в API;
> * просматривать новый ключ узла приложения-функции Azure и именованное значение службы "Управление API Azure";
> * проверка API на портале Azure;
> * проверка API на портале разработчика.

## <a name="prerequisites"></a>Предварительные требования

* Выполните задачи в кратком руководстве по [созданию экземпляра службы "Управление API Azure"](get-started-create-service-instance.md).
* Убедитесь, что в подписке есть приложение-функция Azure. Дополнительные сведения см. в разделе [Создание приложения-функции](../azure-functions/functions-create-first-azure-function.md#create-a-function-app). В приложении должны быть функции с триггером HTTP и уровень авторизации со значением *Анонимный* или *Функция*.

[!INCLUDE [api-management-navigate-to-instance.md](../../includes/api-management-navigate-to-instance.md)]

## <a name="add-new-api-from-azure-function-app"></a> Импорт приложения-функции Azure в качестве нового API

Выполните следующие действия, чтобы создать новый интерфейс API из приложения-функции Azure.

1. В своем экземпляре службы **Управление API Azure** выберите в меню слева **API**.

2. В списке **Добавление нового API** выберите **Приложение-функция**.

    ![Добавление из приложения-функции](./media/import-function-app-as-api/add-01.png)

3. Выберите **Обзор**, чтобы выбрать функции, которые нужно импортировать.

    ![Добавление из приложения-функции](./media/import-function-app-as-api/add-02.png)

4. Выберите раздел **Приложение-функция**, чтобы выбрать из списка доступных приложений-функций.

    ![Добавление из приложения-функции](./media/import-function-app-as-api/add-03.png)

5. Найдите приложение-функцию, из которого нужно импортировать функции, щелкните его и нажмите кнопку **Выбрать**.

    ![Добавление из приложения-функции](./media/import-function-app-as-api/add-04.png)

6. Выберите функции, которые требуется импортировать, и щелкните **Выбрать**.

    ![Добавление из приложения-функции](./media/import-function-app-as-api/add-05.png)

    > [!NOTE]
    > Вы можете импортировать только функции, которые основаны на триггере HTTP и имеют уровень авторизации *Анонимный* или *Функция*.

7. Переключитесь в **полное** представление и назначьте **продукт** вашему новому API. При необходимости измените другие предварительно заполненные поля.

    ![Добавление из приложения-функции](./media/import-function-app-as-api/add-06.png)

8. Нажмите кнопку **Создать**.

## <a name="append-azure-function-app-to-api"></a> Добавление приложения-функции Azure в API

Выполните описанные ниже шаги, чтобы добавить существующее приложение-функцию в имеющийся API.

1. В своем экземпляре службы **Управление API Azure** выберите в меню слева **API**.

2. Выберите API, в который нужно импортировать приложение-функцию Azure. Щелкните **...** и выберите **Импорт** в контекстном меню.

    ![Добавление из приложения-функции](./media/import-function-app-as-api/append-01.png)

3. Выберите плитку **Приложение-функция**.

    ![Добавление из приложения-функции](./media/import-function-app-as-api/append-02.png)

4. Во всплывающем окне щелкните **Обзор**.

    ![Добавление из приложения-функции](./media/import-function-app-as-api/append-03.png)

5. Выберите раздел **Приложение-функция**, чтобы выбрать из списка доступных приложений-функций.

    ![Добавление из приложения-функции](./media/import-function-app-as-api/add-03.png)

6. Найдите приложение-функцию, из которого нужно импортировать функции, щелкните его и нажмите кнопку **Выбрать**.

    ![Добавление из приложения-функции](./media/import-function-app-as-api/add-04.png)

7. Выберите функции, которые требуется импортировать, и щелкните **Выбрать**.

    ![Добавление из приложения-функции](./media/import-function-app-as-api/add-05.png)

8. Щелкните **Импорт**.

    ![Добавление из приложения-функции](./media/import-function-app-as-api/append-04.png)

## <a name="authorization"></a> Авторизация

Во время импорта приложения-функции Azure автоматически создается:

* ключ узла в приложении-функции с именем apim-{*имя экземпляра службы "Управление API Azure"* };
* именованное значение в экземпляре службы "Управление API Azure" с именем {*имя экземпляра приложения-функции Azure*}-key, которое содержит созданный ключ узла.

При использовании интерфейсов API, созданных после 4 апреля 2019 г., ключ узла передается в HTTP-запросе от службы "Управление API" к приложению-функции в заголовке. Более старые API передают ключ узла в виде [параметра запроса](../azure-functions/functions-bindings-http-webhook.md#api-key-authorization). Такое поведение можно изменить с помощью вызова [REST API](https://docs.microsoft.com/rest/api/apimanagement/2019-01-01/backend/update#backendcredentialscontract) `PATCH Backend` к сущности *Backend*, связанной с приложением-функцией.

> [!WARNING]
> Удаление или изменение значения ключа узла в приложении-функции Azure или именованного значения службы "Управление API Azure" приведет к разрыву подключения между службами. Значения не синхронизируются автоматически.
>
> Если вам нужно сменить ключ узла, измените также именованное значение в службе "Управление API Azure".

### <a name="access-azure-function-app-host-key"></a>Доступ к ключу узла приложения-функции Azure

1. Перейдите к экземпляру приложения-функции Azure.

2. На вкладке "Обзор" выберите **Параметры приложения-функции**.

    ![Добавление из приложения-функции](./media/import-function-app-as-api/keys-02-a.png)

3. Этот ключ расположен в разделе **Ключи узла**.

    ![Добавление из приложения-функции](./media/import-function-app-as-api/keys-02-b.png)

### <a name="access-the-named-value-in-azure-api-management"></a>Доступ к именованному значению в службе "Управление API Azure"

Перейдите к экземпляру службы "Управление API Azure" и в меню слева щелкните **Именованные значения**. Здесь хранится ключ приложения-функции Azure.

![Добавление из приложения-функции](./media/import-function-app-as-api/keys-01.png)

## <a name="test-in-azure-portal"></a> Проверка нового API на портале Azure

Операции можно вызывать непосредственно на портале Azure. Использование портала Azure — удобный способ просмотра и тестирования операций с API.  

1. Выберите API, созданный на предыдущем шаге.

2. Откройте вкладку **Тест**.

3. Выберите операцию.

    На странице отобразятся поля для параметров запроса и для заголовков. Один из заголовков, **Ocp-Apim-Subscription-Key**, содержит ключ подписки для продукта, связанного с этим API. Как создатель экземпляра службы "Управление API", вы автоматически являетесь администратором, поэтому сведения о ключе будут заполнены автоматически. 

4. Нажмите кнопку **Отправить**.

    Служба серверной части вернет ответ **200 OK** и другие данные.

[!INCLUDE [api-management-define-api-topics.md](../../includes/api-management-define-api-topics.md)]

## <a name="next-steps"></a>Дополнительная информация

> [!div class="nextstepaction"]
> [Преобразование и защита опубликованного API](transform-api.md)
