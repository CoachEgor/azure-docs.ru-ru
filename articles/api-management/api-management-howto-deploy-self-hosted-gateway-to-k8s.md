---
title: Развертывание самостоятельно размещенного шлюза управления API Azure в Kubernetes | Документация Майкрософт
description: Узнайте, как развернуть локально размещенный шлюз управления API Azure в Kubernetes
services: api-management
documentationcenter: ''
author: miaojiang
manager: gwallace
editor: ''
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.topic: article
ms.date: 10/31/2019
ms.author: apimpm
ms.openlocfilehash: 109316acb73d3c5f00186298c1f8840c516e5790
ms.sourcegitcommit: c22327552d62f88aeaa321189f9b9a631525027c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2019
ms.locfileid: "73513839"
---
# <a name="deploy-a-self-hosted-azure-api-management-gateway-to-kubernetes"></a>Развертывание самостоятельно размещенного шлюза управления API Azure в Kubernetes

В этой статье описаны действия по развертыванию собственного шлюза управления API Azure в кластере Kubernetes.

> [!NOTE]
> Функция самостоятельно размещенного шлюза доступна в предварительной версии. В течение предварительной версии шлюз с самостоятельным размещением доступен только на уровнях Developer и Premium без дополнительной платы. Уровень разработчика ограничен одним развертыванием с помощью самостоятельного размещения шлюза.


## <a name="prerequisites"></a>Технические условия

- Выполните задачи в кратком руководстве по [созданию экземпляра службы управления API Azure](get-started-create-service-instance.md).
- Создайте кластер Kubernetes. [Minikube](https://kubernetes.io/docs/tasks/tools/install-minikube/) является хорошим вариантом для целей разработки и оценки. Для рабочих нагрузок можно использовать [службу Kubernetes Azure](https://azure.microsoft.com/services/kubernetes-service/) или кластер Kubernetes в инородном облаке.
- [Подготавливает ресурс шлюза в экземпляре управления API](api-management-howto-provision-self-hosted-gateway.md).

## <a name="deploy-the-gateway-to-kubernetes"></a>Развертывание шлюза в Kubernetes

1. В разделе **Параметры**выберите **шлюзы** .
2. Выберите ресурс шлюза, который планируется развернуть.
3. Выберите **развертывание**.
4. Обратите внимание, что новый маркер в текстовом поле **токен** был создан автоматически при использовании значений **срока действия** по умолчанию и **секретного ключа** . При необходимости настройте один или оба варианта и нажмите кнопку **создать** , чтобы создать новый маркер.
5. Убедитесь, что в разделе **сценарии развертывания**выбрано **Kubernetes** .
6. Выберите **< шлюз-name >. yml** ссылка на файл рядом с **развернутой** , чтобы скачать файл.
7. При необходимости измените сопоставления портов и имени контейнера в файле yml.
8. Щелкните значок **копирования** , расположенный в правой части текстового поля **развернуть** , чтобы сохранить команду `kubectl` в буфере обмена. 
9. Вставьте команду в окно терминала (или команду). Обратите внимание, что команда ждет, что загруженный файл окружения будет находиться в текущем каталоге.
```console
    kubectl apply -f <gateway-name>.yaml
```
10. Выполните команду. Команда предписывает кластеру Kubernetes запустить контейнер, использовать образ самостоятельно размещенного шлюза, скачанного из реестра контейнеров Майкрософт, и настроить контейнер для предоставления портов HTTP (8080) и HTTPS (443).
11. Выполните приведенную ниже команду, чтобы проверить, запущен ли модуль шлюза. Обратите внимание, что имя Pod будет отличаться. 
```console
kubectl get pods
NAME                              READY   STATUS    RESTARTS   AGE
local-gateway-55f774f844-bv9wt    1/1     Running   0          1m
```
12. Выполните приведенную ниже команду, чтобы проверить, работает ли служба шлюза. Обратите внимание, что имя службы будет отличаться. 
```console
kubectl get services
NAME             TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE
localgateway     NodePort    10.110.230.87   <none>        80:32504/TCP,443:30043/TCP   1m
```
13. Вернитесь к портал Azure и убедитесь, что только что развернутый узел шлюза сообщает о работоспособности.

![состояние шлюза](media/api-management-howto-deploy-self-hosted-gateway-to-k8s/status.png)

> [!TIP]
> Используйте команду <code>kubectl logs <gateway-pod-name></code> для просмотра моментального снимка журнала автономного шлюза.

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о самостоятельно размещенном шлюзе см. в статье [Обзор самостоятельного размещения шлюза в службе управления API Azure](self-hosted-gateway-overview.md) .
* Дополнительные сведения о [службе Kubernetes Azure](https://docs.microsoft.com/azure/aks/intro-kubernetes)


