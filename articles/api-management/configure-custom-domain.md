---
title: Настройка пользовательского доменного имени для экземпляра управления API API Azure
titleSuffix: Azure API Management
description: В этом разделе описано, как настроить пользовательское имя домена для вашего экземпляра службы управления API Azure.
services: api-management
documentationcenter: ''
author: vladvino
manager: anneta
editor: ''
ms.service: api-management
ms.workload: integration
ms.topic: article
ms.date: 01/13/2020
ms.author: apimpm
ms.openlocfilehash: 4587909ad6fca6cdf21d54d11d89f797bbb29833
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80335832"
---
# <a name="configure-a-custom-domain-name"></a>Настройка имени личного домена

При создании экземпляра службы управления API Azure Azure `azure-api.net` присваивает ему субдомен (например,). `apim-service-name.azure-api.net` Тем не менее, вы можете разоблачить ваши конечные точки Управления API, используя свой собственный доменное имя, например **contoso.com.** В этом уроке показано, как сопоставить существующее пользовательское имя DNS с конечными точками, выставленными экземпляром Управления API.

> [!IMPORTANT]
> API Management принимает только запросы с значениями [заголовка хоста,](https://tools.ietf.org/html/rfc2616#section-14.23) соответствующими доменному имени по умолчанию или любому из настроенных пользовательских доменных имен.

> [!WARNING]
> Клиенты, желающие использовать прикалку сертификата для повышения безопасности своих приложений, должны использовать специальное доменное имя и сертификат, которым они управляют, а не сертификат по умолчанию. Клиенты, которые вместо этого прикрепят сертификат по умолчанию, будут сильно зависеть от свойств сертификата, который они не контролируют, что не является рекомендуемой практикой.

## <a name="prerequisites"></a>Предварительные требования

Чтобы выполнить действия, описанные в этой статье, необходимо следующее.

-   Активная подписка Azure.

    [!INCLUDE [quickstarts-free-trial-note](../../includes/quickstarts-free-trial-note.md)]

-   Экземпляр управления API. Дополнительные сведения см. в статье о [создании экземпляра управления API Azure](get-started-create-service-instance.md).
-   Пользовательское доменное имя, принадлежащее вам или вашей организации. Эта тема не дает инструкций о том, как приобрести пользовательское доменное имя.
-   Запись CNAME, размещенная на сервере DNS, который отображает пользовательское доменное имя на доменное имя по умолчанию вашего экземпляра Управления API. В этой теме не указаны инструкции о том, как разместить запись CNAME.
-   Необходимо иметь действующий сертификат с открытым и закрытым ключами (PFX-файл). Альтернативное имя субъекта или субъекта (SAN) должно соответствовать доменному имени (это позволяет экземпляру Управления API безопасно разоблачать URL-адреса по TLS).

## <a name="use-the-azure-portal-to-set-a-custom-domain-name"></a>Настройка пользовательского доменного имени с помощью портала Azure

1. Перейдите на экземпляр Управления API на [портале Azure.](https://portal.azure.com/)
1. Выберите **пользовательские домены**.

    Есть ряд конечных точек, к которым можно назначить пользовательское доменное имя. Сейчас доступны следующие конечные точки:

    - **Шлюз** (по умолчанию: `<apim-service-name>.azure-api.net`,
    - **Portal** (по умолчанию: `<apim-service-name>.portal.azure-api.net`),
    - **Management** (по умолчанию: `<apim-service-name>.management.azure-api.net`),
    - **SCM** (по `<apim-service-name>.scm.azure-api.net`умолчанию: ),
    - **NewPortal** (по `<apim-service-name>.developer.azure-api.net`умолчанию: ).

    > [!NOTE]
    > Только конечная точка **шлюза** доступна для конфигурации на уровне потребления.
    > Можно обновить все конечные точки или некоторые из них. Как правило, клиенты обновляют **Шлюз** (этот URL используется для вызова API, выставленного через API Management) и **Portal** (URL портала разработчиков).
    > **Конечные** точки управления и **SCM** используются внутренне только владельцами экземпляров API Management и, таким образом, реже назначаются пользовательские доменное имя.
    > Уровень **Premium** поддерживает установку нескольких имен хоста для конечной точки **шлюза.**

1. Выберите конечную точку, которую необходимо обновить.
1. В окне справа выберите **Настраиваемое**.

    - В поле **Пользовательское доменное имя** укажите имя, которое следует использовать. Например, `api.contoso.com`.
    - В **сертификате**выберите сертификат из Key Vault. Вы также можете загрузить действительный . PFX файл и предоставить свой **пароль**, если сертификат защищен паролем.

    > [!NOTE]
    > Доменные имена Wildcard, `*.contoso.com` например, поддерживаются во всех уровнях, кроме уровня потребления.

    > [!TIP]
    > Мы рекомендуем использовать Azure Key Vault для управления сертификатами и установки их для аверроации.
    > Если вы используете Azure Key Vault для управления пользовательским сертификатом TLS/SSL, убедитесь, что сертификат вставляется в Key Vault в [качестве _сертификата,_](https://docs.microsoft.com/rest/api/keyvault/CreateCertificate/CreateCertificate)не _секретом._
    >
    > Чтобы получить сертификат TLS/SSL, руководство API должно иметь список и получать разрешения на секреты в Хранилище ключей Azure, содержащее сертификат. При использовании портала Azure все необходимые шаги конфигурации будут завершены автоматически. При использовании инструментов командной строки или API управления эти разрешения должны предоставляться вручную. Это делается в два этапа. Во-первых, используйте страницу Управляемых идентификационных данных на экземпляре Управления API, чтобы убедиться, что управляемая идентификация включена, и сделать заметку основного идентификатора, показанную на этой странице. Во-вторых, дайте список разрешений и получите разрешения секретов на этот основной идентификатор в Хранилище ключей Azure, содержащее сертификат.
    >
    > Если сертификат настроен на авероматию, API Management автоматически подберет последнюю версию без простоя службы (если уровень управления API имеет SLA - т.е. во всех уровнях, кроме уровня разработчика).

1. Нажмите кнопку "Применить".

    > [!NOTE]
    > Назначение сертификата может занять 15 или более минут в зависимости от размера развертывания. Разработчик SKU имеет простои, основные и выше SKUs не имеют простоев.

[!INCLUDE [api-management-custom-domain](../../includes/api-management-custom-domain.md)]

## <a name="dns-configuration"></a>Настройка DNS

При настройке DNS для пользовательского доменного имени у вас есть два варианта:

-   Настроили CNAME-запись, которая указывает на конечную точку настроенного пользовательского доменного имени.
-   Назначьте A-запись, которая указывает на ваш IP-адрес шлюза API Management.

> [!NOTE]
> Хотя IP-адрес экземпляра API Managment статичен, он может измениться в нескольких сценариях. Из-за этого рекомендуется использовать CNAME при настройке пользовательского домена. Примите это во внимание при выборе метода конфигурации DNS. Узнайте больше в [статье документации по ИС](api-management-howto-ip-addresses.md#changes-to-the-ip-addresses) и [часто задаваемые вопросы управления API](api-management-faq.md#how-can-i-secure-the-connection-between-the-api-management-gateway-and-my-back-end-services).

## <a name="next-steps"></a>Дальнейшие действия

[Повышение категории и масштабирование службы](upgrade-and-scale.md)
