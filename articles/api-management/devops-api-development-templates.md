---
title: DevOps для управления API Azure с помощью шаблонов ARM
description: Общие сведения об API DevOps с помощью службы управления API Azure использование шаблонов Azure Resource Manager для управления развертываниями API в конвейере CI/CD
services: api-management
author: miaojiang
ms.service: api-management
ms.topic: conceptual
ms.date: 10/09/2020
ms.author: apimpm
ms.openlocfilehash: 144baa0944451adaf08f0df84325b58079e19d65
ms.sourcegitcommit: 957c916118f87ea3d67a60e1d72a30f48bad0db6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/19/2020
ms.locfileid: "92210064"
---
# <a name="cicd-for-api-management-using-azure-resource-manager-templates"></a>CI/CD для управления API с помощью шаблонов Azure Resource Manager

В этой статье содержатся сведения об API DevOps в службе управления API Azure с помощью шаблонов Azure Resource Manager. Благодаря стратегическому преимуществам интерфейсов API конвейер непрерывной интеграции (CI) и непрерывного развертывания (CD) стал важным аспектом разработки API. Это позволяет организациям автоматизировать развертывание изменений API без погрешностей вручную, выявлять проблемы ранее и в конечном итоге предоставлять пользователям более высокую ценность. 

Дополнительные сведения, средства и примеры кода для реализации подхода DevOps, описанного в этой статье, см. в разделе [набор ресурсов Azure API Management DevOps](https://github.com/Azure/azure-api-management-devops-resource-kit) с открытым исходным кодом в GitHub. Так как клиенты приносят широкий спектр инженерных языков и региональных параметров и существующих решений по автоматизации, этот подход не является единым решением.

## <a name="the-problem"></a>задачи;

Сегодня организации обычно имеют несколько сред развертывания (таких как разработка, тестирование, Рабочая среда) и используют отдельные экземпляры управления API для каждой среды. Некоторые экземпляры совместно используются несколькими группами разработчиков, которые отвечают за различные API-интерфейсы с разными пределами выпуска.

В результате клиенты сталкиваются со следующими проблемами:

* Как автоматизировать развертывание API в службах управления API?
* Как перенести конфигурации из одной среды в другую?
* Как избежать помех между разными командами разработчиков, которые совместно используют один и тот же экземпляр управления API?

## <a name="manage-configurations-in-resource-manager-templates"></a>Управление конфигурациями в диспетчер ресурсов шаблонах

Предложенный подход показан на следующем рисунке. 

:::image type="content" source="media/devops-api-development-templates/apim-devops.png" alt-text="DevOps с управлением API":::

В этом примере есть две среды развертывания: *Разработка* и *производство*. Каждый из них имеет собственный экземпляр управления API. 

* Разработчики API имеют доступ к экземпляру разработки и могут использовать его для разработки и тестирования своих API-интерфейсов. 
* Рабочий экземпляр управляется указанной группой, именуемой *издателями API*.

Ключом в этом предложенном подходе является обеспечение всех конфигураций управления API в [шаблонах Azure Resource Manager](../azure-resource-manager/resource-group-authoring-templates.md). Эти шаблоны должны храниться в системе управления версиями, такой как Git. Как показано на рисунке, существует репозиторий издателя, который содержит все конфигурации экземпляра управления производственного API в коллекции шаблонов:

|Шаблон  |Описание  |
|---------|---------|
|Шаблон службы     | Конфигурации уровня служб для экземпляра службы управления API, такие как ценовая категория и личные домены         |
|Общие шаблоны     |  Общие ресурсы на любом экземпляре управления API, например группы, продукты и средства ведения журнала    |
|Шаблоны API     |  Конфигурации API-интерфейсов и их подресурсов: операции, политики, параметры диагностики        |
|Шаблон главного (основного)     |   Связывает все вместе, [связываясь](../azure-resource-manager/resource-group-linked-templates.md) со всеми шаблонами и развертывая их по порядку. Чтобы развернуть все конфигурации в экземпляре управления API, разверните основной шаблон. Каждый шаблон можно также развертывать по отдельности.       |

Разработчики API развилкают репозиторий издателей в репозиторий для разработчиков и работают над изменениями своих API-интерфейсов. В большинстве случаев они сосредоточены на шаблонах API для своих API-интерфейсов и не требуют изменения шаблонов общего доступа или служб.

## <a name="migrate-configurations-to-templates"></a>Перенос конфигураций в шаблоны
При работе с шаблонами диспетчер ресурсов существуют проблемы, связанные с разработчиками API:

* Разработчики API часто работают со [спецификацией OpenAPI](https://github.com/OAI/OpenAPI-Specification) и могут не быть знакомы с диспетчер ресурсов схемами. Создание шаблонов вручную может быть подвержено ошибкам. 

   Служебное программное средство, именуемое [**Creator**](https://github.com/Azure/azure-api-management-devops-resource-kit/blob/master/src/APIM_ARMTemplate/README.md#Creator) в наборе ресурсов, может помочь автоматизировать создание шаблонов API на основе файла спецификации Open API. Кроме того, разработчики могут предоставлять политики управления API для API в формате XML. 

* Для клиентов, которые уже используют управление API, еще одной проблемой является извлечение существующих конфигураций в шаблоны диспетчер ресурсов. Для этих клиентов средство, именуемое средством [**извлечения**](https://github.com/Azure/azure-api-management-devops-resource-kit/blob/master/src/APIM_ARMTemplate/README.md#extractor) в комплекте ресурсов, может помочь создать шаблоны путем извлечения конфигураций из экземпляров управления API.  

## <a name="workflow"></a>Рабочий процесс

* После того как разработчики API завершат разработку и тестирование API и создали шаблоны API, они могут отправить запрос на вытягивание, чтобы объединить изменения в репозиторий издателя. 

* Издатели API могут проверить запрос на вытягивание и убедиться, что изменения являются надежными и совместимыми. Например, они могут проверять, разрешено ли подключение только по протоколу HTTPS к API. Большинство проверок можно автоматизировать как шаг в конвейере CI/CD.

* После того как изменения утверждены и успешно объединены, издатели API могут развернуть их в рабочем экземпляре по расписанию или по запросу. Развертывание шаблонов можно автоматизировать с помощью [действий GitHub](https://github.com/Azure/apimanagement-devops-samples), [Azure pipelines](/devops/pipelines/), [Azure PowerShell](../azure-resource-manager/templates/deploy-powershell.md), [Azure CLI](../azure-resource-manager/templates/deploy-cli.md)или других средств.

При таком подходе развертывание изменений API в экземплярах управления API может быть автоматизировано, и вы можете легко повысить уровень изменений из одной среды в другую. Поскольку разные группы разработчиков API будут работать с различными наборами шаблонов и файлов API, это предотвращает помехи между разными командами.

## <a name="video"></a>Видеоролик

> [!VIDEO https://www.youtube.com/embed/4Sp2Qvmg6j8]

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения, средства и примеры шаблонов см. в разделе [Azure API Management DevOps Resource Kit](https://github.com/Azure/azure-api-management-devops-resource-kit) с открытым исходным кодом.