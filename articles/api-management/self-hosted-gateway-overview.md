---
title: Самохозня Azure API управления шлюзом обзор Документы Майкрософт
description: Узнайте, как самоуправляемый шлюз Управления API Azure помогает организациям управлять API в гибридных и многооблачных средах.
services: api-management
documentationcenter: ''
author: vlvinogr
manager: gwallace
editor: ''
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.topic: article
ms.date: 10/31/2019
ms.author: apimpm
ms.openlocfilehash: 415f0e209e607a863d715b1a66a2435603a662f0
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "73513722"
---
# <a name="self-hosted-api-management-gateway-overview"></a>Самохозня API управления шлюзом обзор

В этой статье объясняется, как функция самостоятельного шлюза позволяет гибридное и многооблачное управление API, представляет свою архитектуру высокого уровня и подчеркивает ее фундаментальные возможности.

> [!NOTE]
> Функция самостоятельного входной шлюза находится в предварительном просмотре. Во время предварительного просмотра самоходной шлюз доступен только в уровнях разработчика и Premium без дополнительной платы. Уровень разработчика ограничен одним самоходном развертыванием шлюза.

## <a name="hybrid-and-multi-cloud-api-management"></a>Гибридное и многооблачное управление API

Функция самоходной шлюза расширяет поддержку Управления API для гибридных и многооблачных сред и позволяет организациям эффективно и безопасно управлять API, размещенными на территории и в облаках от единого сервиса управления API в Azure.

С помощью самоходного шлюза клиенты могут гибко развертывать контейнерную версию компонента шлюза Управления API в тех же средах, где размещаются свои API- иA. Все самоуправляемые шлюзы управляются из службы управления API, с которой они используются, обеспечивая таким образом клиентам видимость и унифицированный опыт управления во всех внутренних и внешних API. Размещение шлюзов рядом с API позволяет клиентам оптимизировать потоки трафика API и соответствовать требованиям безопасности и соответствия требованиям.

Каждая служба управления API состоит из следующих ключевых компонентов:

-   Плоскость управления, выставленная в качестве API, используется для настройки службы через портал Azure, PowerShell и другие поддерживаемые механизмы.
-   Gateway (или плоскость данных) отвечает за прокси-запросы API, применение политик и сбор телеметрии
-   Портал разработчиков, используемый разработчиками для обнаружения, обучения и использования ABI

По умолчанию все эти компоненты развертываются в Azure, в результате чего весь трафик API (показанный как сплошные черные стрелки на рисунке ниже) проходит через Azure независимо от того, где размещаются резервные варианты реализации API. Оперативная простота этой модели обходится за счет увеличения задержки, проблем с соблюдением нормативных требований, а в некоторых случаях и дополнительных сборов за передачу данных.

![Поток трафика API без самохлаженных шлюзов](media/self-hosted-gateway-overview/without-gateways.png)

Развертывание самоходной шлюзов в тех же средах, что и реализация API бэкэнда, и добавление их в службу управления API позволяет трафику API перетекать непосредственно в АПИ бэкэнда, что улучшает задержку, оптимизирует затраты на передачу данных и позволяет соответствие требованиям, сохраняя при этом преимущества наличия единой точки управления и обнаружения всех AA в организации, независимо от того, где размещаются их реализации.

![Поток трафика API с самохлаженшлями шлюзов](media/self-hosted-gateway-overview/with-gateways.png)

## <a name="packaging-and-features"></a>Упаковка и функции

Самоуправляемый шлюз — это контейнерная, функционально эквивалентная версия управляемого шлюза, развернутого в Azure как часть каждой службы управления API. Самоуправляемый шлюз доступен в виде контейнера Docker на базе Linux из контейнерного реестра Майкрософт. Он может быть развернут в Docker, Kubernetes или в любом другом решении по согласованию контейнеров, работая на настольной, серверной кластере или облачной инфраструктуре.

> [!IMPORTANT]
> Некоторые функциональные возможности, доступные в управляемом шлюзе, пока не доступны в предварительном просмотре. В частности: политика входа в центр событий, интеграция Service Fabric, ниже по течению HTTP/2. Нет никакого плана, чтобы сделать встроенный кэш доступным в самохлаже шлюз.

## <a name="connectivity-to-azure"></a>Подключение к Лазуре

Самоуправляемый шлюз требует исходящих tCP/IP-соединения с Azure в порту 443. Каждый самоходном шлюзе должен быть связан с одной службой управления API и настроен через плоскость управления. Самохлаженный шлюз использует подключение к Azure для:

-   Сообщение о его состоянии, отправляя сообщения сердцебиения каждую минуту
-   Регулярная проверка (каждые 10 секунд) и применение обновлений конфигурации при их доступности
-   Отправка журналов запросов и метрик в Azure Monitor, если она настроена для этого
-   Отправка событий в Application Insights, если она установлена для этого

При потере подключения к Azure самостоятельно размещенный шлюз не сможет получать обновления конфигурации, сообщать о своем состоянии или загружать телеметрию.

Самоуправляемый шлюз предназначен для «провала статичности» и может пережить временную потерю подключения к Azure. Он может быть развернут с или без локальной резервной конфигурации включен. В первом случае самохлаженные шлюзы будут регулярно сохранять копию резервной конфигурации на постоянном объеме, прикрепленном к контейнеру или стручке.

При отключении резервного копирования конфигурации и прерывании подключения к Azure:

-   Самоуправляемые шлюзы, которые работают будет продолжать функционировать с помощью копии конфигурации в памяти
-   Остановленные самохустененный шлюз не сможет начать

При включении резервного копирования конфигурации и прерывании подключения к Azure:

-   Самоуправляемые шлюзы, которые работают будет продолжать функционировать с помощью копии конфигурации в памяти
-   Остановленные самохускопители шлюзов начнут использовать резервную копию конфигурации

Когда подключение будет восстановлено, каждый самоуправляемый шлюз, затронутый отключением, автоматически воссоединяется со связанным с ним службой управления API и загружает все обновления конфигурации, которые произошли в то время как шлюз был «в автономном режиме».

## <a name="next-steps"></a>Дальнейшие действия

-   [Прочитайте информационный документ для дополнительной информации по этой теме](https://aka.ms/hybrid-and-multi-cloud-api-management)
-   [Развертывание самохлаженного шлюза в Докер](api-management-howto-deploy-self-hosted-gateway-to-docker.md)
-   [Развертывание самохлажен ныхполнив в Кубернете](api-management-howto-deploy-self-hosted-gateway-to-k8s.md)
