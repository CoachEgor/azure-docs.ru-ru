---
title: Обзор самостоятельно размещенного шлюза управления API Azure | Документация Майкрософт
description: Узнайте, как самостоятельно размещенный шлюз управления API Azure помогает организациям управлять API в гибридных и многооблачных средах.
services: api-management
documentationcenter: ''
author: vlvinogr
manager: gwallace
editor: ''
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.topic: article
ms.date: 10/31/2019
ms.author: apimpm
ms.openlocfilehash: 415f0e209e607a863d715b1a66a2435603a662f0
ms.sourcegitcommit: c22327552d62f88aeaa321189f9b9a631525027c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2019
ms.locfileid: "73513722"
---
# <a name="self-hosted-api-management-gateway-overview"></a>Обзор самостоятельно размещенного шлюза управления API

В этой статье объясняется, как функция самостоятельно размещенного шлюза обеспечивает гибридное и многооблачное управление API, представляет собой высокоуровневая архитектура и выделяет основные возможности.

> [!NOTE]
> Функция самостоятельно размещенного шлюза доступна в предварительной версии. В течение предварительной версии шлюз с самостоятельным размещением доступен только на уровнях Developer и Premium без дополнительной платы. Уровень разработчика ограничен одним развертыванием с помощью самостоятельного размещения шлюза.

## <a name="hybrid-and-multi-cloud-api-management"></a>Гибридное и многооблачное управление API

Функция самостоятельно размещенного шлюза расширяет возможности управления API для гибридных и многооблачных сред, а также позволяет организациям эффективно и безопасно управлять интерфейсами API, размещенными локально и в разных облаках, из одной службы управления API в Azure.

С помощью самостоятельно размещенного шлюза клиенты могут развертывать контейнерную версию компонента шлюза управления API в тех же средах, где размещены их API. Все локальные шлюзы управляются из службы управления API, с которой они объединяются, тем самым предоставляя клиентам возможность просмотра и унифицированного управления для всех внутренних и внешних API-интерфейсов. Размещение шлюзов близко к интерфейсам API позволяет клиентам оптимизировать потоки трафика API и обеспечить безопасность и соответствие требованиям.

Каждая служба управления API состоит из следующих ключевых компонентов:

-   Плоскость управления, представленная в виде API, используемая для настройки службы с помощью портал Azure, PowerShell и других поддерживаемых механизмов.
-   Шлюз (или плоскость данных) отвечает за прокси-запросы API, применение политик и сбор данных телеметрии.
-   Портал разработчика, используемый разработчиками для обнаружения, изучения и адаптации к использованию API-интерфейсов

По умолчанию все эти компоненты развертываются в Azure, что приводит к тому, что весь трафик API (показанный на рисунке ниже с помощью сплошных стрелок) будет проходить через Azure независимо от того, где размещаются интерфейсы, реализующие API. Оперативная простота этой модели связана с затратами на увеличение задержки, проблем соответствия и в некоторых случаях за дополнительную плату за перемещение данных.

![Поток трафика API без самостоятельно размещенных шлюзов](media/self-hosted-gateway-overview/without-gateways.png)

Развертывание самостоятельно размещенных шлюзов в тех же средах, что и реализация API серверной части, и добавление их в службу управления API позволяет передавать трафик API непосредственно в серверные API, что повышает задержку, оптимизирует затраты на передачу данных и позволяет обеспечение соответствия, сохраняя преимущества единой точки управления и обнаружения всех API в организации независимо от того, где размещаются их реализации.

![Поток трафика API с помощью самостоятельно размещенных шлюзов](media/self-hosted-gateway-overview/with-gateways.png)

## <a name="packaging-and-features"></a>Упаковка и компоненты

Автономный шлюз — это контейнерная, функционально эквивалентная версия управляемого шлюза, развернутого в Azure в составе каждой службы управления API. Автономный шлюз доступен в виде контейнера DOCKER на основе Linux из реестра контейнеров Майкрософт. Его можно развернуть в DOCKER, Kubernetes или любом другом решении оркестрации контейнеров, работающем на настольном компьютере, в кластере серверов или в облачной инфраструктуре.

> [!IMPORTANT]
> Некоторые функции, доступные в управляемом шлюзе, пока недоступны в предварительной версии. Наиболее важно: регистрация в политике концентратора событий Service Fabric интеграция, нисходящий HTTP/2. Нет плана сделать встроенный кэш доступным на собственном шлюзе.

## <a name="connectivity-to-azure"></a>Подключение к Azure

Для самостоятельно размещенного шлюза требуется исходящее подключение TCP/IP к Azure через порт 443. Каждый самостоятельно размещенный шлюз должен быть связан с одной службой управления API и настроен с помощью плоскости управления. Шлюз с автономным размещением использует подключение к Azure для:

-   Сообщает о состоянии, отправляя сообщения пульса каждую минуту
-   Регулярная проверка (каждые 10 секунд) и применение обновлений конфигурации, когда они доступны
-   Отправка журналов запросов и метрик в Azure Monitor, если это настроено.
-   Отправка событий в Application Insights, если для этого задано значение

При потере подключения к Azure шлюзу, размещенному в собственном расположении, не удастся получить обновления конфигурации, сообщить о своем состоянии или отправить телеметрию.

Шлюз, размещенный в собственном расположении, предназначен для "сбоя статического" и может сохранить временную утрату подключения к Azure. Его можно развернуть с включенной локальной конфигурацией или без нее. В первом случае самостоятельно размещенные шлюзы регулярно сохраняют резервную копию конфигурации на постоянном томе, подключенном к контейнеру или модулю Pod.

Когда резервное копирование конфигурации отключено и подключение к Azure прерывается:

-   Автономные шлюзы, которые работают под управлением, будут продолжать работать с использованием копии конфигурации, находящиеся в памяти.
-   Остановленные автономные шлюзы не смогут запуститься

Если резервная копия конфигурации включена и подключение к Azure прервано:

-   Автономные шлюзы, которые работают под управлением, будут продолжать работать с использованием копии конфигурации, находящиеся в памяти.
-   Остановка автономных шлюзов начнется с помощью резервной копии конфигурации.

Когда подключение будет восстановлено, каждый размещенный шлюз, затронутый сбоем, автоматически подключится к соответствующей службе управления API и загрузит все обновления конфигурации, произошедшие, когда шлюз был отключен от сети.

## <a name="next-steps"></a>Дальнейшие действия

-   [Прочитайте технический документ с дополнительными сведениями по этой теме](https://aka.ms/hybrid-and-multi-cloud-api-management)
-   [Развертывание самостоятельно размещенного шлюза в DOCKER](api-management-howto-deploy-self-hosted-gateway-to-docker.md)
-   [Развертывание самостоятельно размещенного шлюза в Kubernetes](api-management-howto-deploy-self-hosted-gateway-to-k8s.md)
