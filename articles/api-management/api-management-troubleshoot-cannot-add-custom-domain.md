---
title: Не удается добавить пользовательский домен с помощью сертификата Key Vault
titleSuffix: Azure API Management
description: Узнайте, как устранить проблему, в которой нельзя добавить пользовательский домен в Azure API Management с помощью сертификата хранилища ключей.
services: api-management
documentationcenter: ''
author: genlin
manager: dcscontentpm
editor: ''
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.topic: article
ms.date: 07/19/2019
ms.author: tehnoonr
ms.openlocfilehash: a09c15466a4a9f62b2696b087cb7ab23cc767379
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75430577"
---
# <a name="failed-to-update-api-management-service-hostnames"></a>Не удалось обновить хост-имена служб управления API

В этой статье описывается ошибка «Не удалось обновить хостимена служб управления API», с которой можно столкнуться при добавлении пользовательского домена для службы управления API Azure. В этой статье приводятся шаги по устранению неполадок, которые помогут вам решить проблему.

## <a name="symptoms"></a>Симптомы

При попытке добавить пользовательский домен для службы управления API с помощью сертификата из Azure Key Vault вы получаете следующее сообщение об ошибке:

- Не удалось обновить хост-имена служб управления API. Запрос наhttps://vaultname.vault.azure.net/secrets/secretname/?api-version=7.0ресурс ' не удалось с StatusCode: Запрещено для RequestId: . Сообщение об исключении: Операция вернула недействительный код статуса 'Запрещено'.

## <a name="cause"></a>Причина

Служба управления API не имеет разрешения на доступ к хранилищу ключей, которое вы пытаетесь использовать для пользовательского домена.

## <a name="solution"></a>Решение

Проблему можно устранить следующим способом.

1. Перейдите на [портал Azure,](Https://portal.azure.com)выберите экземпляр Управления API, а затем выберите **управляемые идентификаторы.** Убедитесь, что опция **«Регистр» с опцией Active Directory Azure** настроена на **Yes.** 
    ![Регистрация у активного директора Azure](./media/api-management-troubleshoot-cannot-add-custom-domain/register-with-aad.png)
1. На портале Azure откройте службу **сводов ключей** и выберите хранилище ключей, которое вы пытаетесь использовать для пользовательского домена.
1. Выберите **политики доступа**и проверьте, есть ли принцип службы, который соответствует названию экземпляра службы управления API. Если это так, выберите основной службы и убедитесь, что у него есть разрешение **Get,** перечисленное в **секретных разрешениях.**  
    ![Добавление политики доступа для основного обслуживания](./media/api-management-troubleshoot-cannot-add-custom-domain/access-policy.png)
1. Если служба управления API не находится в списке, выберите **политику доступа,** а затем создайте следующую политику доступа:
    - **Настройка из шаблона**: Нет
    - **Выберите основной**принцип : Поиск имени службы управления API, а затем выберите его из списка
    - **Ключевые разрешения**: Нет
    - **Секретные разрешения**: Получить
    - **Разрешения на сертификаты**: Нет
1. Выберите **OK** для создания политики доступа.
1. Выберите **Сохранить**, чтобы сохранить изменения.

Убедитесь, что проблема устранена. Для этого попробуйте создать пользовательский домен в службе управления API с помощью сертификата Key Vault.

## <a name="next-steps"></a>Дальнейшие действия
Узнайте больше об услуге управления API:

- См. другие [видео](https://azure.microsoft.com/documentation/videos/index/?services=api-management) об управлении API.
* Другие способы защиты внутренней серверной службы см. в разделе [Взаимная проверка подлинности на основе сертификата](api-management-howto-mutual-certificates.md).

* [Создайте экземпляр службы управления API.](get-started-create-service-instance.md)
* [Импорт и публикация первого API](import-and-publish.md)