---
title: Не удается добавить личный домен с помощью сертификата Key Vault в службе управления API Azure | Документация Майкрософт
description: Узнайте, как устранить проблему, из-за которой нельзя добавить личный домен в службу управления API Azure с помощью сертификата хранилища ключей.
services: api-management
documentationcenter: ''
author: genlin
manager: cfowler
editor: ''
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/19/2019
ms.author: tehnoonr
ms.openlocfilehash: 7aaf29ddf52fb07524aa972f12ca18c235a40928
ms.sourcegitcommit: e72073911f7635cdae6b75066b0a88ce00b9053b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/19/2019
ms.locfileid: "68351397"
---
# <a name="failed-to-update-api-management-service-hostnames"></a>Не удалось обновить имена узлов службы управления API

В этой статье описывается ошибка "не удалось обновить имена узлов службы управления API", которая может возникнуть при добавлении пользовательского домена для службы управления API Azure. В этой статье содержатся инструкции по устранению неполадок, которые помогут устранить проблему.

## <a name="symptoms"></a>Проблемы

При попытке добавить личный домен для службы управления API с помощью сертификата из Azure Key Vault появляется следующее сообщение об ошибке:

- Не удалось обновить имена узлов службы управления API. Сбой запроса к ресурсу "https://vaultname.vault.azure.net/secrets/secretname/?api-version=7.0" с StatusCode: Запрещено для RequestId:. Сообщение об исключении: Операция вернула недопустимый код состояния "запрещено".

## <a name="cause"></a>Причина:

Служба управления API не имеет разрешения на доступ к хранилищу ключей, которое вы пытаетесь использовать для личного домена.

## <a name="solution"></a>Решение

Проблему можно устранить следующим способом.

1. Перейдите к [портал Azure](Https://portal.azure.com), выберите экземпляр управления API, а затем щелкните **управляемые удостоверения**. Убедитесь, что для параметра **Регистрация с Azure Active Directory** выбрано значение **Да**. 
    ![Регистрация в Azure Active Directory](./media/api-management-troubleshoot-cannot-add-custom-domain/register-with-aad.png)
1. В портал Azure откройте службу **хранилища ключей** и выберите хранилище ключей, которое вы пытаетесь использовать для личного домена.
1. Выберите **политики доступа**и проверьте наличие субъекта-службы, соответствующего имени экземпляра службы управления API. Если это так, выберите субъект-службу и убедитесь, что у него есть разрешение **Get** , указанное в разделе **разрешения секрета**.  
    ![Добавление политики доступа для субъекта-службы](./media/api-management-troubleshoot-cannot-add-custom-domain/access-policy.png)
1. Если служба управления API отсутствует в списке, выберите **Добавить политику доступа**, а затем создайте следующую политику доступа:
    - **Настройка из шаблона**: Отсутствуют
    - **Выберите субъект**: Найдите имя службы управления API и выберите ее в списке.
    - **Основные разрешения**: Отсутствуют
    - **Секретные разрешения**: Получение
    - **Разрешения сертификата**: Отсутствуют
1. Нажмите кнопку **ОК** , чтобы создать политику доступа.
1. Выберите **Сохранить**, чтобы сохранить изменения.

Убедитесь, что проблема устранена. Для этого попытайтесь создать личный домен в службе управления API с помощью сертификата Key Vault.

## <a name="next-steps"></a>Следующие шаги
Дополнительные сведения о службе управления API:

- См. другие [видео](https://azure.microsoft.com/documentation/videos/index/?services=api-management) об управлении API.
* Другие способы защиты внутренней серверной службы см. в разделе [Взаимная проверка подлинности на основе сертификата](api-management-howto-mutual-certificates.md).

* [Создание экземпляра службы управления API Azure](get-started-create-service-instance.md)
* [Импорт и публикация первого API](import-and-publish.md)