---
title: Интеграция функций Azure с виртуальной сетью Azure
description: Пошагонный учебник, который показывает, как подключить функцию к виртуальной сети Azure
author: alexkarcher-msft
ms.topic: article
ms.date: 5/03/2019
ms.author: alkarche
ms.reviewer: glenga
ms.openlocfilehash: 0c70c69f547405eb8ebdcf6dcc6ae597db151e53
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75433210"
---
# <a name="tutorial-integrate-functions-with-an-azure-virtual-network"></a>Руководство. Интеграция Функций с виртуальной сетью Azure

В этом уроке показано, как использовать функции Azure для подключения к ресурсам в виртуальной сети Azure. Вы создадите функцию, которая имеет доступ как к Интернету, так и к VM под управлением WordPress в виртуальной сети.

> [!div class="checklist"]
> * Создание приложения функции в плане Premium
> * Развертывание WordPress сайт для VM в виртуальной сети
> * Подключение приложения функции к виртуальной сети
> * Создайте прокси-сервер для доступа к ресурсам WordPress
> * Запрос WordPress файл изнутри виртуальной сети

## <a name="topology"></a>Топология

Следующая диаграмма показывает архитектуру создаваемого решения:

 ![Пользовательский чат для виртуальной сетевой интеграции](./media/functions-create-vnet/topology.png)

Функции, работающие в плане Premium, имеют те же возможности хостинга, что и веб-приложения в Azure App Service, который включает функцию интеграции VNet. Чтобы узнать больше об интеграции VNet, включая устранение неполадок и расширенную конфигурацию, [см.](../app-service/web-sites-integrate-with-vnet.md)

## <a name="prerequisites"></a>Предварительные требования

Для этого учебника важно, чтобы вы понимали IP-адресации и subnetting. Вы можете начать с [этой статьи, которая охватывает основы адресации и subnetting](https://support.microsoft.com/help/164015/understanding-tcp-ip-addressing-and-subnetting-basics). Многие другие статьи и видео доступны в Интернете.

Если у вас нет подписки Azure, создайте [бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F) перед началом.

## <a name="create-a-function-app-in-a-premium-plan"></a>Создание приложения функции в плане Premium

Во-первых, вы создаете функциональное приложение в [плане Premium.] Этот план обеспечивает безсерверный масштаб при поддержке виртуальной сетевой интеграции.

[!INCLUDE [functions-premium-create](../../includes/functions-premium-create.md)]  

Вы можете прикрепить приложение функции к панели мониторинга, выбрав значок штифта в правом верхнем углу. Закрепление упрощает возврат к этой функции приложения после создания VM.

## <a name="create-a-vm-inside-a-virtual-network"></a>Создание VM внутри виртуальной сети

Далее, создать предварительно настроенный VM, который работает WordPress внутри виртуальной сети ([WordPress LEMP7 Макс производительности](https://jetware.io/appliances/jetware/wordpress4_lemp7-170526/profile?us=azure) Jetware). WordPress VM используется из-за его низкой стоимости и удобства. Этот же сценарий работает с любым ресурсом в виртуальной сети, таким как REST AIS, среды служб приложений и другие службы Azure. 

1. На портале выберите **: Создайте ресурс** на левой навигационной `WordPress LEMP7 Max Performance`панели, в типе поля поиска и нажмите Enter.

1. Выберите **Wordpress LEMP Max Performance** в результатах поиска. Выберите программный план **Wordpress LEMP Max Performance для CentOS** в качестве **программного плана** и выберите **Создать.**

1. Во вкладке **«Основы»** используйте настройки VM, указанные в таблице ниже изображения:

    ![Вкладка Основы для создания VM](./media/functions-create-vnet/create-vm-1.png)

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Подписка** | Ваша подписка | Подписка, под которой создаются ваши ресурсы. | 
    | **[Группа ресурсов](../azure-resource-manager/management/overview.md)**  | myResourceGroup | Выберите `myResourceGroup`или группу ресурсов, созданную с помощью приложения функции. Использование той же группы ресурсов для функционального приложения, WordPress VM и хостинг план делает его легче очистить ресурсы, когда вы закончите с этим учебником. |
    | **Название виртуальной машины** | VNET-Wordpress | Имя VM должно быть уникальным в группе ресурсов |
    | **[Регионе](https://azure.microsoft.com/regions/)** | (Европа) Западная Европа | Выберите область рядом с вами или рядом с функциями, которые получают доступ к VM. |
    | **Размер** | B1s | Выберите **размер изменения,** а затем выберите стандартное изображение B1s, которое имеет 1 vCPU и 1 ГБ памяти. |
    | **Тип аутентификации** | Пароль | Чтобы использовать проверку подлинности пароля, необходимо также указать **имя пользователя,** защищенный **пароль,** а затем **подтвердить пароль.** Для этого учебника вам не нужно будет войти в VM, если вам не нужно устранить неполадки. |

1. Выберите вкладку **Сети** и под настройкой виртуальных сетей выберите **Создать новый**.

1. В **виртуальной сети Create**используйте настройки в таблице ниже изображения:

    ![Сетевая вкладка создания VM](./media/functions-create-vnet/create-vm-2.png)

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Название** | myResourceGroup-vnet | Имя по умолчанию, генерируемое для виртуальной сети. |
    | **Диапазон адресов** | 10.10.0.0/16 | Используйте единый диапазон адресов для виртуальной сети. |
    | **Название подсети** | Учебник-Нет | Имя подсети. |
    | **Диапазон адресов** (субнет) | 10.10.1.0/24   | Размер подсети определяет, сколько интерфейсов можно добавить в подсеть. Эта подсеть используется на сайте WordPress.  Подсеть `/24` предоставляет 254 адреса хоста. |

1. Выберите **OK** для создания виртуальной сети.

1. Вернувшись во вкладку **Сеть,** выберите **Нет** для **общественного IP**.

1. Выберите вкладку **"Управление",** а затем в **учетной записи хранилища Diagnostics**- выберите созданную учетную запись хранения с помощью приложения функции.

1. Выберите **Review + create** (Просмотреть и создать). После завершения проверки выберите **Create**. Процесс создания VM занимает несколько минут. Созданный VM может получить доступ только к виртуальной сети.

1. После создания VM **выберите перейдите на ресурс** для просмотра страницы для нового VM, а затем выберите **Networking** под **настройками.**

1. Убедитесь, что нет **общественного IP**. Сделайте примечание **приватный IP**, который вы используете для подключения к VM от вашего приложения функции.

    ![Настройки сети в VM](./media/functions-create-vnet/vm-networking.png)

Теперь у вас есть сайт WordPress развернуты полностью в вашей виртуальной сети. Этот сайт не доступен из интернета.

## <a name="connect-your-function-app-to-the-virtual-network"></a>Подключение приложения функции к виртуальной сети

С wordPress сайт работает в VM в виртуальной сети, теперь вы можете подключить функцию приложение к этой виртуальной сети.

1. В новом приложении функции выберите **функции** > **Платформы Networking.**

    ![Выберите сеть в приложении функции](./media/functions-create-vnet/networking-0.png)

1. В **рамках интеграции VNet**выберите **Нажмите здесь, чтобы настроить.**

    ![Статус для настройки сетевой функции](./media/functions-create-vnet/Networking-1.png)

1. На странице виртуальной сетевой интеграции выберите **Добавить VNet (предварительный просмотр).**

    ![Добавьте предварительный просмотр интеграции VNet](./media/functions-create-vnet/networking-2.png)

1. В **статусе функции сети**используйте настройки в таблице ниже изображения:

    ![Определите функцию приложения виртуальной сети](./media/functions-create-vnet/networking-3.png)

    | Параметр      | Рекомендуемое значение  | Описание      |
    | ------------ | ---------------- | ---------------- |
    | **Виртуальная сеть** | MyResourceGroup-vnet | Эта виртуальная сеть является тот, который вы создали ранее. |
    | **Подсети** | Создание новой подсети | Создайте подсеть в виртуальной сети для использования приложения функции. Интеграция VNet должна быть настроена для использования пустой подсети. Не имеет значения, что ваши функции используют другую подсеть, чем ваш VM. Виртуальная сеть автоматически направляет трафик между двумя подсетями. |
    | **Название подсети** | Функция-Нет | Имя новой подсети. |
    | **Виртуальный сетевой адресный блок** | 10.10.0.0/16 | Выберите тот же адресный блок, используемый на сайте WordPress. Определен только один адресный блок. |
    | **Диапазон адресов** | 10.10.2.0/24   | Размер подсети ограничивает общее количество экземпляров, которыми может быть масштабироваться приложение функции плана Premium. В этом `/24` примере используется подсеть с 254 доступными адресами хоста. Эта подсеть чрезмерно подготовлена, но легко вычислить. |

1. Выберите **OK,** чтобы добавить подсеть. Закройте страницы интеграции VNet и состояния функций сети, чтобы вернуться на страницу приложения функции.

Функция приложение теперь может получить доступ к виртуальной сети, где WordPress сайт работает. Далее вы используете [прокси-функции Azure,](functions-proxies.md) чтобы вернуть файл с сайта WordPress.

## <a name="create-a-proxy-to-access-vm-resources"></a>Создание прокси для доступа к ресурсам VM

С включенной интеграцией VNet можно создать прокси в приложении функции для переадресовки запросов на VM, работающий в виртуальной сети.

1. В приложении функции выберите > **+** **Прокси,** а затем используйте настройки прокси в таблице ниже изображения:

    ![Определение настроек прокси](./media/functions-create-vnet/create-proxy.png)

    | Параметр  | Рекомендуемое значение  | Описание      |
    | -------- | ---------------- | ---------------- |
    | **Название** | РасТениЕ | Имя может быть любой ценностью. Он используется для идентификации прокси. |
    | **Шаблон маршрута** | /завод | Маршрут карт к ресурсу VM. |
    | **Внутренний URL-адрес** | http:/<YOUR_VM_IP>/wp-content/themes/twentyseventeen/assets/images/header.jpg | Замените `<YOUR_VM_IP>` IP-адрес вашего WordPress VM, который вы создали ранее. Это отображение возвращает один файл с сайта. |

1. Выберите **Создать,** чтобы добавить прокси в приложение функции.

## <a name="try-it-out"></a>Попробуйте продукт

1. В браузере попытайтесь получить доступ к URL-адресу, который вы использовали в качестве **URL-адреса Backend.** Как и ожидалось, запрос время от меня. Тайм-аут происходит потому, что ваш сайт WordPress подключен только к вашей виртуальной сети, а не в Интернете.

1. Копируйте значение **прокси-УР** из нового прокси и вставьте его в адресную строку браузера. Возвращается изображение с wordPress сайт работает внутри вашей виртуальной сети.

    ![Файл изображения завода возвращен с сайта WordPress](./media/functions-create-vnet/plant.png)

Ваше функциональное приложение подключено как к Интернету, так и к виртуальной сети. Прокси получает запрос через общедоступный Интернет, а затем выступает в качестве простого прокси HTTP для передачи этого запроса в подключенную виртуальную сеть. Прокси затем передает ответ обратно к вам публично через Интернет.

[!INCLUDE [clean-up-section-portal](../../includes/clean-up-section-portal.md)]

## <a name="next-steps"></a>Дальнейшие действия

В этом учебнике сайт WordPress служит API, который называется с помощью прокси в приложении функции. Этот сценарий делает хороший учебник, потому что это легко настроить и визуализировать. Можно использовать любой другой API, развернутый в виртуальной сети. Можно также создать функцию с кодом, который вызывает AI, развернутые в виртуальной сети. Более реалистичным сценарием является функция, используюв апы кусана данных для вызова экземпляра s'L Server, развернутого в виртуальной сети.

Функции, работающие в плане Premium, имеют ту же базовую инфраструктуру Службы приложений, что и веб-приложения в планах PremiumV2. Вся документация для [веб-приложений в Службе приложений Azure](../app-service/overview.md) относится к функциям плана Premium.

> [!div class="nextstepaction"]
> [Подробнее о опциях сетей в Функциях](./functions-networking-options.md)

[Премиум-план]: functions-scale.md#premium-plan
