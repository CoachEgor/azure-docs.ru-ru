---
title: Рекомендации по хранению для Функций Azure
description: Узнайте о требованиях к хранению в Функциях Azure и о шифровании хранимых данных.
ms.topic: conceptual
ms.date: 01/21/2020
ms.openlocfilehash: 324516240d09a5443908cbffec514e4caba2b604
ms.sourcegitcommit: fdec8e8bdbddcce5b7a0c4ffc6842154220c8b90
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2020
ms.locfileid: "83648804"
---
# <a name="storage-considerations-for-azure-functions"></a>Рекомендации по хранению для Функций Azure

При создании экземпляра приложения-функции для Функций Azure требуется учетная запись хранения Azure. Приложение-функция может использовать следующие службы хранилища.


|Служба хранилища  | Назначение функций  |
|---------|---------|
| [Хранилище BLOB-объектов Azure](../storage/blobs/storage-blobs-introduction.md)     | Поддерживает состояние привязок и функциональные ключи.  <br/>Также используется [центрами задач в Устойчивых функциях](durable/durable-functions-task-hubs.md). |
| [Файлы Azure](../storage/files/storage-files-introduction.md)  | Общая папка, используемая для хранения и запуска кода приложения-функции в [плане потребления](functions-scale.md#consumption-plan). |
| [хранилище очередей Azure](../storage/queues/storage-queues-introduction.md);     | Используется [центрами задач в Устойчивых функциях](durable/durable-functions-task-hubs.md).   |
| [Хранилище таблиц Azure](../storage/tables/table-storage-overview.md)  |  Используется [центрами задач в Устойчивых функциях](durable/durable-functions-task-hubs.md).       |

> [!IMPORTANT]
> При использовании плана потребления файлы кода и конфигурации привязок приложения-функции хранятся в хранилище файлов Azure в основной учетной записи хранения. При удалении основной учетной записи хранения это содержимое удаляется без возможности восстановления.

## <a name="storage-account-requirements"></a>Требования к учетной записи хранения

При создании приложения-функции необходимо создать или привязать учетную запись хранения Azure общего назначения, поддерживающую хранилища BLOB-объектов, очередей и таблиц. Это потому, что для внутренних операций, таких как управление триггерами и ведение журнала выполнения функций, Функции Azure используют службу хранилища Azure. Некоторые учетные записи хранения не поддерживают очереди и таблицы. Например, это относится к учетным записям хранения только для больших двоичных объектов, службе хранилища Azure уровня "Премиум" и учетным записям хранения общего назначения с репликацией ZRS. Эти неподдерживаемые учетные записи будут отфильтрованы из колонки "Учетная запись хранения" при создании приложения-функции.

Дополнительные сведения о типах учетных записей хранения см. в разделе [Введение в службы хранилища Azure](../storage/common/storage-introduction.md#core-storage-services). 

Хотя вы можете использовать существующую учетную запись хранения в приложении-функции, необходимо убедиться, что она соответствует этим требованиям. Учетные записи хранения, созданные как часть процесса создания приложения-функции, гарантированно удовлетворяют этим требованиям к учетной записи хранения.  

## <a name="storage-account-guidance"></a>Руководство по учетной записи хранения

Для работы каждого приложения-функции нужна учетная запись хранения. Если эта учетная запись удалена, приложение-функция не будет работать. Сведения об устранении неполадок, связанных с хранилищем, см. в статье [Устранение неполадок, связанных с хранилищем](functions-recover-storage-account.md). Следующие дополнительные рекомендации относятся к учетной записи хранения, используемой приложениями-функциями.

### <a name="storage-account-connection-setting"></a>Строка подключения учетной записи хранения

Подключение к учетной записи хранения сохраняется в параметре приложения [AzureWebJobsStorage](./functions-app-settings.md#azurewebjobsstorage). 

При повторном создании ключей хранилища необходимо обновить указанные выше строки подключения учетной записи хранения. [Дополнительные сведения об управлении ключом хранилища данных см. здесь](https://docs.microsoft.com/azure/storage/common/storage-create-storage-account).

### <a name="shared-storage-accounts"></a>Общие учетные записи хранения

Несколько приложений функций могут совместно использовать одну и ту же учетную запись хранения без каких бы то ни было проблем. Например, в Visual Studio можно разрабатывать несколько приложений с помощью эмулятора хранения Azure. В этом случае эмулятор действует как единая учетная запись хранения. Учетную запись хранения, используемую приложением-функцией, также можно использовать для хранения данных приложения. Однако этот подход не всегда хорош в рабочей среде.

### <a name="optimize-storage-performance"></a>Оптимизация производительности хранилища

[!INCLUDE [functions-shared-storage](../../includes/functions-shared-storage.md)]

## <a name="storage-data-encryption"></a>Шифрование хранимых данных

[!INCLUDE [functions-storage-encryption](../../includes/functions-storage-encryption.md)]

## <a name="mount-file-shares-linux"></a>Подключение общих папок (Linux)

Вы можете подключить существующие общие папки Файлов Azure к приложениям-функциям Linux. Подключив общую папку к приложению-функции Linux, вы можете использовать существующие модели машинного обучения или другие данные в своих функциях. Вы можете использовать команду [`az webapp config storage-account add`](/cli/azure/webapp/config/storage-account#az-webapp-config-storage-account-add), чтобы подключить существующую общую папку к приложению-функции Linux. 

В этой команде `share-name` — это имя существующей общей папки Файлов Azure, а `custom-id` может быть любой строкой, которая уникально определяет общую папку при подключении к приложению-функции. Кроме того, `mount-path` — это путь, по которому осуществляется доступ к общей папке в приложении-функции. `mount-path` должен иметь формат `/dir-name` и не может начинаться с `/home`.

Полный пример см. в разделе сценариев в [Создание приложения-функции Python и подключение общего файлового ресурса Azure](scripts/functions-cli-mount-files-storage-linux.md). 

В настоящее время поддерживается только `storage-type` `AzureFiles`. Вы можете подключить только пять общих папок к конкретному приложению-функции. Подключение общей папки может увеличить время холодного запуска по крайней мере на 200–300 мс или даже больше, если учетная запись хранения находится в другом регионе.

Подключенная общая папка доступна для кода функции в указанном `mount-path`. Например, если `mount-path` является `/path/to/mount`, доступ к целевому каталогу можно получить с помощью API-интерфейсов файловой системы, как показано в следующем примере Python:

```python
import os
...

files_in_share = os.listdir("/path/to/mount")
```

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о вариантах размещения в Функциях Azure.

> [!div class="nextstepaction"]
> [Масштабирование и размещение Функций Azure](functions-scale.md)


