---
title: Соображения хранения для функций Azure
description: Узнайте о требованиях к хранению функций Azure и о шифровании хранимых данных.
ms.topic: conceptual
ms.date: 01/21/2020
ms.openlocfilehash: 48ff2dedd997cccb76b13acdadc895504f656ea3
ms.sourcegitcommit: 7d8158fcdcc25107dfda98a355bf4ee6343c0f5c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2020
ms.locfileid: "80984169"
---
# <a name="storage-considerations-for-azure-functions"></a>Соображения хранения для функций Azure

Функциям Azure требуется учетная запись хранения Azure при создании экземпляра приложения функции. Приложения функции хранения могут использоваться следующими службами хранения:


|Служба хранения данных  | Использование функций  |
|---------|---------|
| [Хранение Azure Blob](../storage/blobs/storage-blobs-introduction.md)     | Поддержание ключей состояния привязок и функций.  <br/>Также используется [концентраторами задач в долгосрочных функциях.](durable/durable-functions-task-hubs.md) |
| [Файлы Azure](../storage/files/storage-files-introduction.md)  | Доля файлов, используемая для хранения и запуска кода приложения функции в [плане потребления.](functions-scale.md#consumption-plan) |
| [Хранение очереди Azure](../storage/queues/storage-queues-introduction.md)     | Используется [концентраторами задач в прочных функциях.](durable/durable-functions-task-hubs.md)   |
| [Хранение таблицы Azure](../storage/tables/table-storage-overview.md)  |  Используется [концентраторами задач в прочных функциях.](durable/durable-functions-task-hubs.md)       |

> [!IMPORTANT]
> При использовании плана потребления файлы кода и конфигурации привязок приложения-функции хранятся в хранилище файлов Azure в основной учетной записи хранения. При удалении основной учетной записи хранения это содержимое удаляется без возможности восстановления.

## <a name="storage-account-requirements"></a>Требования к учетной записи хранения

При создании приложения функции необходимо создать или связать учетную запись хранения azure общего назначения, которая поддерживает хранение Blob, Queue и Таблицы. Это связано с тем, что функции полагаются на хранилище Azure для таких операций, как управление триггерами и выполнение функций регистрации. Некоторые учетные записи хранения не поддерживают очереди и таблицы. Эти учетные записи включают учетные записи только для хранения данных, Azure Premium Storage и учетные записи общего назначения с репликацией ЗРС. Эти неподдерживаемые учетные записи отфильтровываются из лезвия учетной записи хранилища при создании приложения функции.

Подробнее о типах учетных записей хранилища можно узнать в [представлении служб хранения Azure.](../storage/common/storage-introduction.md#core-storage-services) 

В то время как вы можете использовать существующую учетную запись хранилища с вашим приложением функции, вы должны убедиться, что она отвечает этим требованиям. Учетные записи хранения, созданные как часть потока создания приложения функции, гарантированно отвечают этим требованиям учетной записи хранилища.  

## <a name="storage-account-guidance"></a>Руководство по учету хранилища

Для работы каждого приложения-функции нужна учетная запись хранения. Если эта учетная запись удалена, ваше приложение функции не будет работать. Для устранения неполадок, связанных с хранением, [см.](functions-recover-storage-account.md) Следующие дополнительные соображения относятся к учетной записи хранилища, используемой функциональными приложениями.

### <a name="storage-account-connection-setting"></a>Настройка подключения учетной записи хранилища

Подключение учетной записи хранилища поддерживается в [настройках приложения AzureWebJobsStorage.](./functions-app-settings.md#azurewebjobsstorage) 

Строка подключения учетной записи хранилища должна быть обновлена при регенерации ключей хранения. [Подробнее об управлении ключами хранения можно узнать здесь.](https://docs.microsoft.com/azure/storage/common/storage-create-storage-account)

### <a name="shared-storage-accounts"></a>Общие учетные записи хранения

Несколько функциональных приложений могут совместно хранить одну и ту же учетную запись без каких-либо проблем. Например, в Visual Studio можно разрабатывать несколько приложений с помощью эмулятора хранения azure. В этом случае эмулятор действует как единая учетная запись хранилища. Та же учетная запись хранения, используемая вашим приложением функции, также может быть использована для хранения данных приложения. Однако такой подход не всегда является хорошей идеей в производственной среде.

### <a name="optimize-storage-performance"></a>Оптимизация производительности хранилища

[!INCLUDE [functions-shared-storage](../../includes/functions-shared-storage.md)]

## <a name="storage-data-encryption"></a>Шифрование данных для хранения данных

Azure Storage шифрует все данные в учетной записи хранения в состоянии покоя. Для получения дополнительной [Azure Storage encryption for data at rest](../storage/common/storage-service-encryption.md)информации см.

По умолчанию данные шифруются с помощью ключей, управляемых корпорацией Майкрософт. Для дополнительного контроля над ключами шифрования можно предоставить управляемые клиентом ключи для использования для шифрования кабли и файловых данных. Эти ключи должны присутствовать в Хранилище ключей Azure для функций, чтобы иметь доступ к учетной записи хранилища. Чтобы узнать больше, см. [Нанастройку ключей, управляемых клиентами, с помощью портала Azure.](../storage/common/storage-encryption-keys-portal.md)  

## <a name="mount-file-shares-linux"></a>Доля файлов Mount (Linux)

Вы можете смонтировать существующие доли файлов Azure в приложения функции Linux. Устанавливая долю в приложении функции Linux, вы можете использовать существующие модели машинного обучения или другие данные в своих функциях. Вы можете [`az webapp config storage-account add`](/cli/azure/webapp/config/storage-account#az-webapp-config-storage-account-add) использовать команду для установки существующей доли в приложении функции Linux. 

В этой `share-name` команде есть имя существующего общего общего `custom-id` числа файлов Azure, и может быть любая строка, которая однозначно определяет долю при установке в приложение функции. Кроме `mount-path` того, это путь, с которого доступна доля в приложении функции. `mount-path`должны быть в `/dir-name`формате, и он `/home`не может начать с .

Для полного примера смотрите сценарии в [приложении функции Python и монтируете общий общий обмен файлами Azure.](scripts/functions-cli-mount-files-storage-linux.md) 

В настоящее `storage-type` `AzureFiles` время поддерживается только один из. Вы можете установить только пять акций в приложение данной функции. Установка доли файла может увеличить время начала холода, по крайней мере, на 200-300 мс, или даже больше, когда учетная запись хранилища находится в другом регионе.

Установленная доля доступна вашему функциональному коду в указанном. `mount-path` Например, `mount-path` когда `/path/to/mount`это так, можно получить доступ к целевому каталогу по AIS файловой системы, как в следующем примере Python:

```python
import os
...

files_in_share = os.listdir("/path/to/mount")
```

## <a name="next-steps"></a>Дальнейшие действия

Узнайте больше о вариантах хостинга функций Azure.

> [!div class="nextstepaction"]
> [Масштабирование и размещение Функций Azure](functions-scale.md)


