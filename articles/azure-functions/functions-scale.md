---
title: Масштабирование и размещение Функций Azure
description: Узнайте, как выбрать между планом потребления функций Azure и планом Premium.
ms.assetid: 5b63649c-ec7f-4564-b168-e0a74cb7e0f3
ms.topic: conceptual
ms.date: 03/27/2019
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 92ac0417e9d8adca168dd68e1721a1c9c890de1c
ms.sourcegitcommit: 62c5557ff3b2247dafc8bb482256fef58ab41c17
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/03/2020
ms.locfileid: "80656942"
---
# <a name="azure-functions-scale-and-hosting"></a>Масштабирование и размещение Функций Azure

При создании приложения функции в Azure необходимо выбрать план хостинга для вашего приложения. Есть три хостинга планы доступны для Функции Azure: [План потребления](#consumption-plan), [Премиум план](#premium-plan), и [выделенные (App Service) план](#app-service-plan).

План хостинга, который вы выбираете, диктует следующее поведение:

* Как масштабируется приложение функции.
* Ресурсы, доступные для каждого экземпляра приложения функции.
* Поддержка расширенных функций, таких как подключение виртуальной сети Azure.

Планы Потребления и Премиум автоматически добавляют вычислительную мощность при запуске кода. Ваше приложение масштабируется, когда это необходимо для обработки нагрузки, и масштабируется, когда код перестает работать. Для плана потребления, вы также не должны платить за простоя VMs или резерва потенциала заранее.  

Премиум-план предоставляет дополнительные функции, такие как премиальные вычисления, возможность сохранять теплое значение экземпляров на неопределенный срок и подключение VNet.

План App Service позволяет воспользоваться преимуществами специализированной инфраструктуры, которой вы управляете. Приложение функции не масштабируется на основе событий, что означает, что никогда не масштабируется до нуля. (Требует, чтобы [всегда включено.)](#always-on)

## <a name="hosting-plan-support"></a>Поддержка плана хостинга

Поддержка функций подпадает под следующие две категории:

* _Общедоступный (GA)_: полностью поддерживается и одобрен для использования в производстве.
* _Предварительный просмотр_: еще не полностью поддерживается и не одобрен для использования в производстве.

В следующей таблице указывается текущий уровень поддержки трех хостинговых планов при запуске на Windows или Linux:

| | План потребления | План "Премиум" | Выделенный план |
|-|:----------------:|:------------:|:----------------:|
| Windows | GA | GA | GA |
| Linux | GA | GA | GA |

## <a name="consumption-plan"></a>План потребления

При использовании плана потребления экземпляры хоста Azure Functions динамически добавляются и удаляются в зависимости от количества входящих событий. Этот бессерверный план автоматически масштабируется, и вы платите за вычислительные ресурсы только тогда, когда ваши функции запущены. В плане потребления функция должна выполняться в течение настроенного времени (время ожидания).

Плата начисляется на основе числа операций выполнения, времени выполнения и объема использованной памяти. Плата начисляется совокупно за использование всех функций приложения-функции. Дополнительные сведения см. на [странице цен на Функции Azure](https://azure.microsoft.com/pricing/details/functions/).

План потребления является планом размещения по умолчанию. Он включает следующие преимущества:

* вы платите, только если функции выполняются;
* масштабирование выполняется автоматически, даже во время периодов высокой нагрузки.

Функции приложений в одном регионе могут быть назначены к тому же плану потребления. Нет недостатка или влияния на наличие нескольких приложений, работающих в одном и том же плане потребления. Назначение нескольких приложений одному и тому же плану потребления не влияет на устойчивость, масштабируемость или надежность каждого приложения.

Чтобы узнать больше о том, как оценить затраты при запуске в плане потребления, [см.](functions-consumption-costs.md)

## <a name="premium-plan"></a><a name="premium-plan"></a>Премиум-план

При использовании плана Premium экземпляры хоста Azure Functions добавляются и удаляются в зависимости от количества входящих событий, как и план потребления.  Премиум-план поддерживает следующие функции:

* Постоянно теплые экземпляры, чтобы избежать любого холодного начала
* Подключение виртуальных сетей
* Неограниченная продолжительность исполнения (60 минут гарантировано)
* Размеры премиум-инстанций (один ядр, два ядра и четыре основных экземпляра)
* Более предсказуемое ценообразование
* Распределение приложений высокой плотности для планов с несколькими функциональными приложениями

Информацию о том, как настроить эти параметры можно найти в [документе плана плана Azure Functions Premium.](functions-premium-plan.md)

Вместо выставления счетов за выполнение и потребление памяти, выставление счетов для плана Premium основано на количестве основных секунд и памяти, используемых в необходимых и предварительно разогретых экземплярах. По крайней мере один экземпляр должен быть теплым в любое время в плане. Это означает, что минимальная ежемесячная стоимость для активного плана, независимо от количества выполнения. Имейте в виду, что все функциональные приложения в плане Premium делятся предварительно разогретыми и активными экземплярами.

Рассмотрим премиум-план Azure Functions Premium в следующих ситуациях:

* Приложения-функции выполняются непрерывно или почти непрерывно.
* У вас есть большое количество небольших казней и высокий счет исполнения, но низкий ГБ второй счет в плане потребления.
* Вам нужно больше вариантов процессора или памяти, чем то, что предусмотрено планом потребления.
* Код должен работать дольше, чем [максимальное время выполнения, разрешенное](#timeout) в плане Потребления.
* Вам требуются функции, доступные только в плане Premium, такие как виртуальное подключение к сети.

При запуске функций JavaScript в плане Premium следует выбрать экземпляр с меньшим количеством vCP. Для получения дополнительной информации [см.](functions-reference-node.md#considerations-for-javascript-functions)  

## <a name="dedicated-app-service-plan"></a><a name="app-service-plan"></a>Выделенный (App Service) план

Приложения функции также могут работать на тех же выделенных вс-чатах, что и другие приложения Службы приложений (Основные, Стандартные, Премиум и Изолированные СКУ).

Рассмотрим план службы приложений в следующих ситуациях:

* У вас есть неиспользуемые виртуальные машины, в которых уже запущены другие экземпляры служб приложений.
* Вы хотите предоставить пользовательское изображение, на котором можно запускать свои функции.

Вы платите за функциональные приложения в плане службы приложений, как и за другие ресурсы Службы Приложений, такие как веб-приложения. Дополнительную информацию о том, как действует план службы приложений, см. в статье [Подробный обзор планов службы приложений Azure](../app-service/overview-hosting-plans.md).

С помощью плана службы приложений можно вручную масштабировать, добавляя больше экземпляров VM. Вы также можете включить автомасштаб. Дополнительные сведения см. в статье [Масштабирование числа экземпляров вручную или автоматически](../azure-monitor/platform/autoscale-get-started.md?toc=%2fazure%2fapp-service%2ftoc.json). Вы можете также увеличивать масштаб, используя разные планы службы приложений. Дополнительные сведения см. в статье [Увеличение масштаба приложения в Azure](../app-service/manage-scale-up.md). 

При запуске функций JavaScript в плане службы приложений нужно выбрать план с меньшим количеством виртуальных ЦП. Для получения дополнительной информации [см.](functions-reference-node.md#choose-single-vcpu-app-service-plans) 
<!-- Note: the portal links to this section via fwlink https://go.microsoft.com/fwlink/?linkid=830855 --> 

### <a name="always-on"></a><a name="always-on"></a>Всегда на

Если вы выполняете план Службы приложения, необходимо включить настройку **Always,** чтобы приложение функции работало правильно. В плане службы приложений среда выполнения функции переходит в состояние бездействия через несколько минут отсутствия активности, поэтому только триггеры HTTP могут на самом деле "пробудить" ваши функции. Параметр "Всегда включено" доступен только для плана службы приложений. В плане потребления платформа активирует приложения-функции автоматически.

[!INCLUDE [Timeout Duration section](../../includes/functions-timeout-duration.md)]


Даже с включенным параметром "Всегда включено" время ожидания выполнения для отдельных функций управляется с помощью параметра `functionTimeout` в файле проекта [host.json](functions-host-json.md#functiontimeout).

## <a name="determine-the-hosting-plan-of-an-existing-application"></a>Определение плана хостинга существующего приложения

Чтобы определить план хостинга, используемый вашим функциональным **Overview** приложением, **см.** [Azure portal](https://portal.azure.com) Чтобы увидеть уровень ценообразования, выберите название **плана службы приложений,** а затем выберите **Свойства** из левой панели.

![Просмотр плана масштабирования на портале](./media/functions-scale/function-app-overview-portal.png)

Для определения плана можно также использовать Azure CLI, как показано ниже:

```azurecli-interactive
appServicePlanId=$(az functionapp show --name <my_function_app_name> --resource-group <my_resource_group> --query appServicePlanId --output tsv)
az appservice plan list --query "[?id=='$appServicePlanId'].sku.tier" --output tsv
```  

Если в результате выполнения команды возвращается значение `dynamic`, ваше приложение-функция находится в плане потребления. Когда вывод из этой `ElasticPremium`команды, ваше приложение функции находится в плане Premium. Все остальные значения указывают на различные уровни плана Службы Приложений.

## <a name="storage-account-requirements"></a>Требования к учетной записи хранения

В любом плане функциональному приложению требуется общая учетная запись хранения Azure, которая поддерживает данные Azure Blob, Очередь, Файлы и таблицы. Это связано с тем, что функции Azure опирающиеся на хранилище Azure для таких операций, как управление триггерами и выполнение функций регистрации, но некоторые учетные записи хранения не поддерживают очереди и таблицы. Эти учетные записи, которые включают учетные записи хранения только для больших двоичных объектов (включая хранилище класса Premium) и учетные записи хранения общего назначения с репликацией ZRS, отфильтровываются на основе выбранных вариантов **учетной записи хранения** при создании приложения-функции.

Та же учетная запись хранения, используемая вашим приложением функции, также может быть использована триггерами и привязками для хранения данных приложения. Однако для операций, накопительных по хранению, следует использовать отдельный учет данных.  

Конечно, несколько функциональных приложений могут делиться одной и той же учетной записью хранения без каких-либо проблем. (Хорошим примером этого является разработка нескольких приложений в локальной среде с помощью эмулятора хранения azure, который действует как одна учетная запись хранения.) 

<!-- JH: Does using a Premium Storage account improve perf? -->

Дополнительные сведения о типах учетных записей хранилища см. в разделе [Введение в службы хранилища Azure](../storage/common/storage-introduction.md#azure-storage-services).

## <a name="how-the-consumption-and-premium-plans-work"></a>Как работают планы потребления и премиума

В планах потребления и премиум инфраструктура Azure Functions масштабирует ресурсы процессора и памяти, добавляя дополнительные экземпляры узла функций, основываясь на количестве событий, на которых срабатывают его функции. Каждый экземпляр хоста Функций в плане Потребления ограничен 1,5 ГБ памяти и одним процессором.  Экземпляр хоста — это все функциональное приложение, то есть все функции в ресурсе общего использования приложения функции в экземпляре и масштабируются одновременно. Приложения-функции в одном плане потребления масштабируются независимо друг от друга.  В плане Premium размер плана будет определять доступную память и процессор для всех приложений в этом плане в этом случае.  

Файлы кода функции хранятся на долях файлов Azure в главном учете хранилища функции. При удалении основной учетной записи хранения приложения-функции, файлы кода функции будут удалены без возможности восстановления.

### <a name="runtime-scaling"></a>Масштабирование среды выполнения

Решение "Функции Azure" использует компонент, называемый *контроллером масштабирования*, чтобы отслеживать скорость событий и определять, необходимо ли выполнять масштабирование. Контроллер масштабирования использует эвристику для каждого типа триггеров. Например, при использовании триггера хранилища очередей Azure масштабирование выполняется в зависимости от длины запроса и возраста самого старого сообщения в очереди.

Единицей масштаба для функций Azure является функциональное приложение. При масштабировании приложения-функции выделяются дополнительные ресурсы для выполнения нескольких экземпляров узла службы "Функции Azure". И наоборот, когда потребность в вычислительных ресурсах уменьшается, контроллер масштабирования удаляет экземпляры узла функции. Число экземпляров в конечном итоге *масштабируется* до нуля, когда в приложении функции не работают никакие функции.

![Мониторинг событий и создание экземпляров с помощью контроллера масштабирования](./media/functions-scale/central-listener.png)

### <a name="understanding-scaling-behaviors"></a>Основные сведения о действиях при масштабировании

Масштабирование может зависеть от ряда факторов и выполняться по-разному в зависимости от выбранного триггера и языка. Есть несколько тонкостей масштабирования поведения, чтобы быть в курсе:

* Одно функциональное приложение только масштабируется до максимум 200 экземпляров. Один экземпляр может обрабатывать одновременно более одного сообщения или запроса, поэтому для количества одновременных выполнений не установлено ограничение.
* Для триггеров HTTP новые экземпляры выделяются, максимум, раз в секунду.
* Для триггеров, не относясь к HTTP, новые экземпляры выделяются не чаще одного раза в 30 секунд. Масштабирование происходит быстрее при запуске в [плане Premium.](#premium-plan)
* Для триггеров Service Bus используйте права _управления_ ресурсами для наиболее эффективного масштабирования. С правами _Прослушивания_ масштабирование не так точно, поскольку длина очереди не может быть использована для информирования о решениях масштабирования. Подробнее об установлении прав в политиках доступа к сервисным шинам можно узнать в [политике авторизации общего доступа.](../service-bus-messaging/service-bus-sas.md#shared-access-authorization-policies)
* Для триггеров Event Hub [scaling guidance](functions-bindings-event-hubs-trigger.md#scaling) см. 

### <a name="best-practices-and-patterns-for-scalable-apps"></a>Рекомендации и шаблоны для масштабируемых приложений

В приложении-функции существует множество аспектов, влияющих на качество его масштабирования, в том числе конфигурация узла, используемый объем среды выполнения и эффективность использования ресурсов.  Дополнительные сведения см. в разделе [Рекомендации по масштабируемости](functions-best-practices.md#scalability-best-practices). Вам также следует учитывать поведение подключений при масштабировании приложения-функции. См. дополнительные сведения об [управлении подключениями в службе "Функции Azure"](manage-connections.md).

Для получения дополнительной информации о масштабировании в Python и Node.js см. [руководство разработчика Azure Functions Python - Масштабирование и параллелизм](functions-reference-python.md#scaling-and-concurrency) и [руководство разработчика Azure Functions Node.js - масштабирование и параллелизм.](functions-reference-node.md#scaling-and-concurrency)

### <a name="billing-model"></a>Модель выставления счетов

Выставление счетов за различные планы подробно описано на [странице ценообразования Azure Functions.](https://azure.microsoft.com/pricing/details/functions/) Использование вычисляется на уровне приложения-функции. При этом учитывается только время выполнения кода функции. Счета выставляются по следующим единицам:

* **Потребление ресурсов в гигабайтах в секунду (ГБ/с)**. Вычисляется как сочетание объема памяти и времени выполнения для всех функций, выполняемых в приложении-функции. 
* **Казни**. Вычисляются при каждом выполнении функции в ответ на событие.

Полезные запросы и информацию о том, как понять ваш счет потребления можно найти [на биллинга часто задаваемые вопросы](https://github.com/Azure/Azure-Functions/wiki/Consumption-Plan-Cost-Billing-FAQ).

[Azure Functions pricing page]: https://azure.microsoft.com/pricing/details/functions

## <a name="service-limits"></a>Ограничения службы

В следующей таблице указаны ограничения, которые применяются к функциональным приложениям при запуске в различных планах хостинга:

[!INCLUDE [functions-limits](../../includes/functions-limits.md)]
