---
title: Масштабирование и размещение Функций Azure | Документация Майкрософт
description: Дополнительные сведения о выборе между планом потребления функций Azure и план "премиум".
services: functions
documentationcenter: na
author: ggailey777
manager: jeconnoc
keywords: Azure функции, функции, план потребления, план "премиум", обработка событий, веб-перехватчики, динамические вычисления, бессерверная архитектура
ms.assetid: 5b63649c-ec7f-4564-b168-e0a74cb7e0f3
ms.service: azure-functions
ms.devlang: multiple
ms.topic: reference
ms.date: 03/27/2019
ms.author: glenga
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 3253cc7e379ae63880d533f14bc76e7af5a4425a
ms.sourcegitcommit: 41ca82b5f95d2e07b0c7f9025b912daf0ab21909
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "67050550"
---
# <a name="azure-functions-scale-and-hosting"></a>Масштабирование и размещение Функций Azure

При создании приложения-функции в Azure, необходимо выбрать план размещения для приложения. Для функций Azure доступны три планы размещения: [План потребления](#consumption-plan), [план "премиум"](#premium-plan), и [план службы приложений](#app-service-plan).

Размещения выбранного плана определяет следующее поведение:

* Каким образом ваше приложение-функция масштабируется.
* Ресурсы, доступные в каждом экземпляре приложения функции.
* Поддержка сложных функций, например подключение к виртуальной сети.

Планы потребления и "премиум" автоматически добавляют вычислительной мощности, когда ваш код выполняется. Ваше приложение масштабировать при необходимости для обработки нагрузки и уменьшения масштаба, при остановке выполнения кода. Для плана потребления также не нужно платить за бездействующие виртуальные машины и заранее резервировать ресурсы.  

План "премиум" предоставляют дополнительные функции, такие как уровня "премиум" вычислительных экземпляров, возможность хранить бессрочно "горячего" резервирования экземпляров и подключение к виртуальной сети.

План службы приложений позволяет воспользоваться преимуществами выделенной инфраструктуре, в которой вы управляете. Ваше приложение-функция масштабируется на основе событий, что означает не масштабируется до нуля. (Требуется [Always on](#always-on) включен.)

> [!NOTE]
> Можно переключаться между планы потребления и "премиум", изменив свойство плана ресурс приложения-функции.

## <a name="hosting-plan-support"></a>Поддержка план размещения

Поддержка функций подразделяется на две категории.

* _Общедоступная (GA)_ : полностью поддерживаемые языки, утвержденные для использования в рабочей среде.
* _Предварительная версия_: еще не полностью поддерживаемые языки, утвержденные для использования в рабочей среде.

Следующая таблица указывает текущий уровень поддержки для трех планах размещения, при выполнении в ОС Windows или Linux:

| | План потребления | План "Премиум" | План dedicated |
|-|:----------------:|:------------:|:----------------:|
| Windows | GA | предварительный просмотр | GA |
| Linux | предварительный просмотр | Н/Д | GA |

## <a name="consumption-plan"></a>План потребления

При использовании плана потребления экземпляры узла функций Azure динамически добавляются и удаляются в зависимости от числа входящих событий. Этот бессерверный план автоматически масштабируется, и вы платите за вычислительные ресурсы только тогда, когда ваши функции запущены. В плане потребления функция должна выполняться в течение настроенного времени (время ожидания).

Плата начисляется на основе числа операций выполнения, времени выполнения и объема использованной памяти. Плата начисляется совокупно за использование всех функций приложения-функции. Дополнительные сведения см. на [странице цен на Функции Azure](https://azure.microsoft.com/pricing/details/functions/).

План потребления является планом размещения по умолчанию. Он включает следующие преимущества:

* вы платите, только если функции выполняются;
* масштабирование выполняется автоматически, даже во время периодов высокой нагрузки.

Приложения-функции в одном регионе можно назначить на один и тот же план потребления. Нет, недостатком или влияния на наличие нескольких приложений, выполняемых в один и тот же план потребления. Назначение нескольких приложений на один и тот же план потребления не оказывает влияния на устойчивости, масштабируемости и надежности для каждого приложения.

## <a name="premium-plan"></a>План "премиум" (Предварительная версия)

Если вы используете план "премиум", экземпляров узла функций Azure добавляются и удаляются в зависимости от числа входящих событий, как и в плане потребления.  План "премиум" поддерживает следующие функции:

* Постоянное «горячего» резервирования экземпляры, чтобы избежать любой холодный запуск
* Подключение виртуальных сетей
* Продолжительность выполнения неограниченное
* Размеры экземпляров уровня "премиум" (одно ядро, два ядра и четыре экземпляра core)
* Более прогнозируемые цены
* Приложения с высокой плотностью выделения для планов с помощью нескольких приложений-функций

Сведения о настройке этих параметров можно найти в [документа плана "премиум" функции Azure](functions-premium-plan.md).

Вместо выставления счетов за выполнение и память, занятая другими, выставление счетов для плана "премиум" основан на число ядер в секунду, время выполнения и памяти, используемой по необходимости и зарезервированным экземплярам.  По крайней мере один экземпляр должен быть "горячего" резервирования at все значения времени. Это означает, что является фиксированной ежемесячной оплаты каждого активного плана, независимо от количества выполнений.

Допустим, план "премиум" функции Azure в следующих ситуациях:

* Приложения-функции выполняются непрерывно или почти непрерывно.
* Вам требуется больше ресурсов ЦП или памяти чем доступно в плане потребления.
* Ваш код должен выполнять функции дольше [максимально допустимое время выполнения](#timeout) в плане потребления.
* Вам требуются функции, которые доступны только на план "премиум", например подключение к виртуальной сети и VPN.

> [!NOTE]
> Предварительная версия плана "премиум" в настоящее время поддерживает только "функции Azure" на Windows.

При выполнении функций JavaScript на план "премиум", необходимо выбрать экземпляр с меньшим количеством виртуальных процессоров. Дополнительные сведения см. в разделе [Выбор одноядерных планов уровня "премиум"](functions-reference-node.md#considerations-for-javascript-functions).  

## <a name="app-service-plan"></a>План dedicated (служба приложений)

Приложения-функции могут выполняться в те же выделенные виртуальные машины, как другие приложения службы приложений (Basic, Standard, Premium и изолированной номера SKU).

Рассмотрим план службы приложений в следующих ситуациях:

* У вас есть неиспользуемые виртуальные машины, в которых уже запущены другие экземпляры служб приложений.
* Вы хотите предоставить пользовательский образ, в которой будут выполняться функции.

Же платите за приложения-функции в плане службы приложений, как это делается для других ресурсов службы приложений, например веб-приложений. Дополнительную информацию о том, как действует план службы приложений, см. в статье [Подробный обзор планов службы приложений Azure](../app-service/overview-hosting-plans.md).

С помощью плана службы приложений вы можете выполнить развертывание вручную, добавив дополнительные экземпляры виртуальных Машин. Вы также можете включить Автомасштабирование. Дополнительные сведения см. в статье [Масштабирование числа экземпляров вручную или автоматически](../azure-monitor/platform/autoscale-get-started.md?toc=%2fazure%2fapp-service%2ftoc.json). Вы можете также увеличивать масштаб, используя разные планы службы приложений. Дополнительные сведения см. в статье [Увеличение масштаба приложения в Azure](../app-service/web-sites-scale.md). 

При запуске функций JavaScript в плане службы приложений нужно выбрать план с меньшим количеством виртуальных ЦП. Дополнительные сведения см. в разделе [Выбор одноядерных планов службы приложений](functions-reference-node.md#choose-single-vcpu-app-service-plans). 
<!-- Note: the portal links to this section via fwlink https://go.microsoft.com/fwlink/?linkid=830855 --> 

### <a name="always-on"></a> Always On

При использовании плана службы приложений следует включить параметр **Всегда включено**, чтобы ваше приложение-функция выполнялось правильно. В плане службы приложений среда выполнения функции переходит в состояние бездействия через несколько минут отсутствия активности, поэтому только триггеры HTTP могут на самом деле "пробудить" ваши функции. Параметр "Всегда включено" доступен только для плана службы приложений. В плане потребления платформа активирует приложения-функции автоматически.

[!INCLUDE [Timeout Duration section](../../includes/functions-timeout-duration.md)]


Даже с включенным параметром "Всегда включено" время ожидания выполнения для отдельных функций управляется с помощью параметра `functionTimeout` в файле проекта [host.json](functions-host-json.md#functiontimeout).

## <a name="determine-the-hosting-plan-of-an-existing-application"></a>Определение плана размещения существующего приложения

Чтобы определить план размещения, используемый приложением-функцией, на [портале Azure](https://portal.azure.com) просмотрите для приложения-функции раздел **План службы приложений/ценовая категория** на вкладке **Обзор**. Для планов службы приложений также указывается ценовая категория.

![Просмотр плана масштабирования на портале](./media/functions-scale/function-app-overview-portal.png)

Для определения плана можно также использовать Azure CLI, как показано ниже:

```azurecli-interactive
appServicePlanId=$(az functionapp show --name <my_function_app_name> --resource-group <my_resource_group> --query appServicePlanId --output tsv)
az appservice plan list --query "[?id=='$appServicePlanId'].sku.tier" --output tsv
```  

Если в результате выполнения команды возвращается значение `dynamic`, ваше приложение-функция находится в плане потребления. Если выходные данные этой команды имеет `ElasticPremium`, является приложение-функцию в плане "премиум". Все другие значения свидетельствуют о различных уровнях план службы приложений.

## <a name="storage-account-requirements"></a>Требования к учетной записи хранения

На любой план приложения-функции требуется общая учетной записи хранения Azure, которая поддерживает хранилища BLOB-объектов Azure, очереди, файлы и таблицы. Это обусловлено функции используют службу хранилища Azure для операций, таких как управление триггерами и ведение журнала выполнения функций, но некоторые учетные записи хранения не поддерживают очереди и таблицы. Эти учетные записи, которые включают учетные записи хранения только для больших двоичных объектов (включая хранилище класса Premium) и учетные записи хранения общего назначения с репликацией ZRS, отфильтровываются на основе выбранных вариантов **учетной записи хранения** при создании приложения-функции.

<!-- JH: Does using a Premium Storage account improve perf? -->

Дополнительные сведения о типах учетных записей хранилища см. в разделе [Введение в службы хранилища Azure](../storage/common/storage-introduction.md#azure-storage-services).

## <a name="how-the-consumption-and-premium-plans-work"></a>Как работают планы потребления и "премиум"

В потребления и планами "премиум" "функции Azure" инфраструктуры масштабирует ресурсы ЦП и памяти, добавив дополнительные экземпляры узлов функций в зависимости от количества событий, которые активируют функции на. Каждый экземпляр узла в плане потребления функций ограничен 1,5 ГБ памяти и одного ЦП.  Экземпляра узла — всего приложения-функции, то есть все функции в ресурс приложения-функции общего ресурса в пределах экземпляра и в то же время. Приложения-функции, которые совместно используют один и тот же план потребления масштабируются независимо друг от друга.  В план "премиум" размер вашего плана определяет объем доступной памяти и ЦП для всех приложений в этом плане на этом экземпляре.  

Файлы кода функции хранятся в файловых ресурсах Azure в функции основной учетной записи хранения. При удалении основной учетной записи хранения приложения-функции, файлы кода функции будут удалены без возможности восстановления.

> [!NOTE]
> При использовании триггера большого двоичного объекта в плане потребления обработка новых больших двоичных объектов может осуществляться с задержкой до 10 минут, если приложение-функция стало неактивным. После запуска приложения-функции большие двоичные объекты обрабатываются немедленно. Чтобы избежать этой задержки холодного запуска, использовать план "премиум" или [триггер сетки событий](functions-bindings-event-grid.md). Дополнительные сведения см. в разделе [Триггер](functions-bindings-storage-blob.md#trigger).

### <a name="runtime-scaling"></a>Масштабирование среды выполнения

Решение "Функции Azure" использует компонент, называемый *контроллером масштабирования*, чтобы отслеживать скорость событий и определять, необходимо ли выполнять масштабирование. Контроллер масштабирования использует эвристику для каждого типа триггеров. Например, при использовании триггера хранилища очередей Azure масштабирование выполняется в зависимости от длины запроса и возраста самого старого сообщения в очереди.

Единица масштабирования для функций Azure является приложение-функция. При масштабировании приложения-функции выделяются дополнительные ресурсы для выполнения нескольких экземпляров узла службы "Функции Azure". И наоборот, когда потребность в вычислительных ресурсах уменьшается, контроллер масштабирования удаляет экземпляры узла функции. Если никакие функции не выполняются, то число экземпляров в приложении-функции в конечном итоге сократится до нуля.

![Мониторинг событий и создание экземпляров с помощью контроллера масштабирования](./media/functions-scale/central-listener.png)

### <a name="understanding-scaling-behaviors"></a>Основные сведения о действиях при масштабировании

Масштабирование может зависеть от ряда факторов и выполняться по-разному в зависимости от выбранного триггера и языка. Существует несколько особенностей поведения масштабирования, которые следует учитывать:

* Отдельное приложение-функция масштабируется максимум до 200 экземпляров. Один экземпляр может обрабатывать одновременно более одного сообщения или запроса, поэтому для количества одновременных выполнений не установлено ограничение.
* Для триггеров HTTP новые экземпляры только выделяется не более одного раза каждую секунду.
* Для триггеров, отличных от HTTP новые экземпляры только выделяется не более одного раза каждые 30 секунд.

Для различных триггеров также могут быть установлены разные ограничения масштабирования, а также ограничения, указанные в следующем документе:

* [Концентратор событий](functions-bindings-event-hubs.md#trigger---scaling)

### <a name="best-practices-and-patterns-for-scalable-apps"></a>Рекомендации и шаблоны для масштабируемых приложений

В приложении-функции существует множество аспектов, влияющих на качество его масштабирования, в том числе конфигурация узла, используемый объем среды выполнения и эффективность использования ресурсов.  Дополнительные сведения см. в разделе [Рекомендации по масштабируемости](functions-best-practices.md#scalability-best-practices). Вам также следует учитывать поведение подключений при масштабировании приложения-функции. См. дополнительные сведения об [управлении подключениями в службе "Функции Azure"](manage-connections.md).

### <a name="billing-model"></a>Модель выставления счетов

Выставление счетов для различных планах подробно описан на [странице цен на функции Azure](https://azure.microsoft.com/pricing/details/functions/). Использование вычисляется на уровне приложения-функции. При этом учитывается только время выполнения кода функции. Счета выставляются по следующим единицам:

* **Потребление ресурсов в гигабайтах в секунду (ГБ/с)** . Вычисляется как сочетание объема памяти и времени выполнения для всех функций, выполняемых в приложении-функции. 
* **Выполнения**. Вычисляются при каждом выполнении функции в ответ на событие.

Можно найти полезные запросы и сведения о том, как расшифровка счета потребления [на выставления счетов вопросов и Ответов](https://github.com/Azure/Azure-Functions/wiki/Consumption-Plan-Cost-Billing-FAQ).

[Azure Functions pricing page]: https://azure.microsoft.com/pricing/details/functions

## <a name="service-limits"></a>Ограничения служб

В следующей таблице перечислены ограничения, которые применяются к приложениям-функциям, при запуске в различных планах размещения:

[!INCLUDE [functions-limits](../../includes/functions-limits.md)]
