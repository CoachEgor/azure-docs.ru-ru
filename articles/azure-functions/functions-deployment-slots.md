---
title: Слоты развертывания функций Azure
description: Узнайте, как создавать и использовать слоты развертывания с помощью функций Azure.
services: functions
documentationcenter: na
author: craigshoemaker
manager: gwallace
keywords: функции Azure, функции
ms.service: azure-functions
ms.topic: reference
ms.date: 08/12/2019
ms.author: cshoe
ms.openlocfilehash: 50337745b008cdd38dd860a0329e44ee712e7acd
ms.sourcegitcommit: b4f201a633775fee96c7e13e176946f6e0e5dd85
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2019
ms.locfileid: "70085667"
---
# <a name="azure-functions-deployment-slots"></a>Слоты развертывания функций Azure

Слоты развертывания функций Azure позволяют приложению-функции запускать различные экземпляры, называемые "слотами". Слоты — это разные среды, предоставляемые через общедоступную конечную точку. Один экземпляр приложения всегда сопоставляется с рабочим слотом, и вы можете поменять экземпляры, назначенные слоту, по запросу. Приложения-функции, выполняемые в плане службы приложений, могут иметь несколько слотов, в то время как в условиях использования допускается только один слот.

Ниже показано, как зависят функции подкачки слотов:

- Перенаправление трафика неэффективно; запросы не отбрасываются из-за переключения.
- Если во время переключения выполняется функция, выполнение продолжится, и последующие триггеры направляются в перенаправляемый экземпляр приложения.

> [!NOTE]
> Слоты недоступны для плана потребления Linux.

## <a name="why-use-slots"></a>Зачем использовать слоты?

Использование слотов развертывания имеет ряд преимуществ. В следующих сценариях описываются распространенные способы использования слотов.

- **Разные среды для разных целей**. Использование разных слотов позволяет различать экземпляры приложений перед переключением на рабочую или промежуточный слот.
- Предварительная **Подготовка: развертывание**в слот, а не непосредственно в рабочую среду, позволяет подготовить приложение перед началом работы. Кроме того, использование слотов сокращает задержку для рабочих нагрузок, активируемых HTTP. Экземпляры загружаются до развертывания, что сокращает холодный запуск для вновь развернутых функций.
- **Простые резервные**варианты. После переключения в рабочее состояние слот с ранее подготовленным приложением теперь имеет предыдущее рабочее приложение. Если изменения, переставляемые в рабочий слот, не так, как вы планируете, можно немедленно отменить переключение, чтобы получить «последний удачный экземпляр» назад.

## <a name="swap-operations"></a>Операции переключения

Во время переключения один слот считается источником и другим целевым объектом. Исходный слот содержит экземпляр приложения, который применяется к целевому слоту. Следующие шаги гарантируют, что целевой слот не будет испытывать простои во время переключения.

1. **Применить параметры:** Параметры из целевого слота применяются ко всем экземплярам исходного слота. Например, к промежуточному экземпляру применяются параметры рабочей среды. К примененным параметрам относятся следующие категории:
    - Параметры приложения и строки подключения для [конкретного слота](#manage-settings) (если применимо)
    - Параметры [непрерывного развертывания](../app-service/deploy-continuous-deployment.md) (если включены)
    - Параметры [проверки подлинности службы приложений](../app-service/overview-authentication-authorization.md) (если включены)

1. **Ожидание перезагрузки и доступности:** Переключение ожидает завершения перезагрузки каждого экземпляра в слоте источника и должно быть доступно для запросов. Если какой либо экземпляр не перезапускается, операция переключения вернет все изменения в исходный слот и прекратит выполнение операции.

1. **Маршрутизация обновлений:** Если все экземпляры в исходном слоте успешно загружены, переключение правил маршрутизации завершается двумя слотами. После выполнения этого шага в целевом слоте (например, в рабочем слоте) приложение, которое ранее было перегревается в исходном слоте.

1. **Операция повтора:** Теперь, когда исходный слот имеет предварительно переставляемое приложение в целевом слоте, выполните ту же операцию, применив все параметры и перезапуская экземпляры для исходного слота.

Помните на следующие моменты.

- В любой момент операции переключения происходит инициализация переключенных приложений в исходном слоте. Целевой слот остается в сети во время подготовки исходного слота, независимо от того, успешно ли выполняется операция переключения.

- Чтобы переключить промежуточный слот на рабочий слот, убедитесь, что рабочий слот *всегда* является целевым слотом. Таким образом, операция переключения не влияет на рабочее приложение.

- Параметры, связанные с источниками событий и привязками, должны быть настроены в качестве [параметров слота развертывания](#manage-settings) *перед началом переключения*. Помечая их как «прикрепленные», вы гарантируете, что события и выходные данные будут направлены к нужному экземпляру.

## <a name="manage-settings"></a>Управление параметрами

[!INCLUDE [app-service-deployment-slots-settings](../../includes/app-service-deployment-slots-settings.md)]

### <a name="create-a-deployment-setting"></a>Создание параметра развертывания

Параметры можно пометить как параметр развертывания, что сделает его «прикрепленным». Параметр закрепления не переключается на экземпляр приложения.

При создании параметра развертывания в одном слоте необходимо создать тот же параметр с уникальным значением в любом другом слоте, вовлеченном в подкачку. Таким образом, хотя значение параметра не меняется, имена параметров остаются согласованными между слотами. Согласованность имен гарантирует, что код не пытается получить доступ к параметру, определенному в одном слоте, но не к другому.

Чтобы создать параметр развертывания, выполните следующие действия.

- Переход к *слотам* в приложении функции
- Щелкните имя слота
- В разделе *функции платформы > общие параметры*щелкните **Конфигурация** .
- Щелкните имя параметра, которое вы хотите прикрепить к текущему слоту.
- Установите флажок **параметр слота развертывания** .
- Щелкните **ОК**
- После того, как колонка настройки исчезнет, нажмите кнопку **сохранить** , чтобы сохранить изменения.

![Параметр слота развертывания](./media/functions-deployment-slots/azure-functions-deployment-slots-deployment-setting.png)

## <a name="deployment"></a>Развертывание.

При создании слота слоты пусты. Для развертывания приложения в слот можно использовать любую из [поддерживаемых технологий развертывания](./functions-deployment-technologies.md) .

## <a name="scaling"></a>Масштабирование

Все слоты масштабируются на то же количество рабочих областей, что и рабочий слот.

- Для планов потребления слот масштабируется по мере масштабирования приложения функции.
- Для планов службы приложений приложение масштабируется до фиксированного числа рабочих ролей. Слоты работают на том же числе рабочих ролей, что и план приложения.

## <a name="add-a-slot"></a>Добавление слота

Добавить слот можно с помощью [интерфейса командной строки](https://docs.microsoft.com/cli/azure/functionapp/deployment/slot?view=azure-cli-latest#az-functionapp-deployment-slot-create) или портала. Ниже показано, как создать новый слот на портале.

1. Перейдите к приложению функции и щелкните **знак "плюс** " рядом с *слотами*.

    ![Добавление слота развертывания функций Azure](./media/functions-deployment-slots/azure-functions-deployment-slots-add.png)

1. Введите имя в текстовое поле и нажмите кнопку **создать** .

    ![Имя слота развертывания функций Azure](./media/functions-deployment-slots/azure-functions-deployment-slots-add-name.png)

## <a name="swap-slots"></a>Поменять местами слоты

Вы можете поменять местами слоты с помощью [интерфейса командной строки](https://docs.microsoft.com/cli/azure/functionapp/deployment/slot?view=azure-cli-latest#az-functionapp-deployment-slot-swap) или портала. Ниже показано, как поменять местами слоты на портале.

1. Переход к приложению функции
1. Щелкните имя слота источника, который нужно поменять местами
1. На вкладке *Обзор* нажмите кнопку **Переключить** , ![Swap слот развертывания функций Azure ](./media/functions-deployment-slots/azure-functions-deployment-slots-swap.png)
1. Проверьте параметры конфигурации для переключения и щелкните " **поменять местами** ![Swap слот развертывания функций Azure ](./media/functions-deployment-slots/azure-functions-deployment-slots-swap-config.png)

Операция может занять некоторое время, пока выполняется операция переключения.

## <a name="roll-back-a-swap"></a>Откат переключения

Если переключение приводит к ошибке или вы просто хотите отменить переключение, можно вернуться к начальному состоянию. Чтобы вернуться к состоянию до перекачки, выполните другую замену, чтобы отменить переключение.

## <a name="remove-a-slot"></a>Удаление слота

Вы можете удалить слот с помощью [интерфейса командной строки](https://docs.microsoft.com/cli/azure/functionapp/deployment/slot?view=azure-cli-latest#az-functionapp-deployment-slot-delete) или портала. Ниже показано, как удалить слот на портале.

1. Перейдите к обзору приложения функции.

1. Нажмите кнопку " **Удалить** ".

    ![Добавление слота развертывания функций Azure](./media/functions-deployment-slots/azure-functions-deployment-slots-delete.png)

## <a name="automate-slot-management"></a>Автоматизация управления слотами

С помощью [Azure CLI](https://docs.microsoft.com/cli/azure/functionapp/deployment/slot?view=azure-cli-latest)можно автоматизировать следующие действия для слота:

- [создание](https://docs.microsoft.com/cli/azure/functionapp/deployment/slot?view=azure-cli-latest#az-functionapp-deployment-slot-create)
- [delete](https://docs.microsoft.com/cli/azure/functionapp/deployment/slot?view=azure-cli-latest#az-functionapp-deployment-slot-delete)
- [list](https://docs.microsoft.com/cli/azure/functionapp/deployment/slot?view=azure-cli-latest#az-functionapp-deployment-slot-list)
- [позиции](https://docs.microsoft.com/cli/azure/functionapp/deployment/slot?view=azure-cli-latest#az-functionapp-deployment-slot-swap)
- [Автоматическая замена](https://docs.microsoft.com/cli/azure/functionapp/deployment/slot?view=azure-cli-latest#az-functionapp-deployment-slot-auto-swap)

## <a name="change-app-service-plan"></a>Изменение плана службы приложений

С помощью приложения-функции, которое выполняется в рамках плана службы приложений, можно изменить базовый план службы приложений для слота.

> [!NOTE]
> Невозможно изменить план службы приложений слота в плане потребления.

Чтобы изменить план службы приложений для слота, выполните следующие действия.

1. Переход к слоту

1. В разделе *функции платформы*щелкните **все параметры** .

    ![Изменение плана службы приложений](./media/functions-deployment-slots/azure-functions-deployment-slots-change-app-service-settings.png)

1. Щелкните **план службы приложений** .

1. Выберите новый план службы приложений или создайте новый план.

1. Щелкните **ОК**

    ![Изменение плана службы приложений](./media/functions-deployment-slots/azure-functions-deployment-slots-change-app-service-select.png)


## <a name="limitations"></a>Ограничения

Слоты развертывания функций Azure имеют следующие ограничения.

- Количество слотов, доступных для приложения, зависит от плана. План потребления допускает только один слот развертывания. Дополнительные слоты доступны для приложений, работающих в рамках плана службы приложений.
- Переключение слота сбрасывает ключи для приложений с параметром приложения `AzureWebJobsSecretStorageType`, равным `files`.
- Слоты недоступны для плана потребления Linux.

## <a name="support-levels"></a>Уровни поддержки

Существует два уровня поддержки слотов развертывания.

- **Общая доступность (общедоступная версия)** : полностью поддерживается и утверждено для использования в рабочей среде.
- **Предварительная версия**: пока не поддерживается, но в будущем ожидается, что она будет доступна в общедоступном состоянии.

| План ОС и размещения           | Уровень поддержки     |
| ------------------------- | -------------------- |
| Использование Windows       | Общедоступная версия |
| Windows Premium (Предварительная версия) | Preview (Предварительный просмотр)              |
| Выделенные Windows         | Общедоступная версия |
| Использование Linux         | Не поддерживается          |
| Linux Premium (Предварительная версия)   | Preview (Предварительный просмотр)              |
| Выделенные Linux           | Общедоступная версия |

## <a name="next-steps"></a>Дальнейшие действия

- [Технологии развертывания в функциях Azure](./functions-deployment-technologies.md)
