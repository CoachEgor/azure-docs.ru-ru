---
title: Слоты развертывания функций Azure
description: Научитесь создавать и использовать слоты развертывания с функциями Azure
author: craigshoemaker
ms.topic: reference
ms.date: 08/12/2019
ms.author: cshoe
ms.openlocfilehash: 0e8c93ea6d5c2b525ccbea2af900f100afcc3d93
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75769223"
---
# <a name="azure-functions-deployment-slots"></a>Слоты развертывания функций Azure

Слоты развертывания функций Azure позволяют приложению функции запускать различные экземпляры под названием "слоты". Слоты представляют собой различные среды, подвергающиеся воздействию через общедоступную конечную точку. Один экземпляр приложения всегда отображается на производственном слоте, и вы можете поменять экземпляры, назначенные слоту по требованию. Функциональные приложения, работающие в соответствии с планом Службы приложений, могут иметь несколько слотов, в то время как в соответствии с планом потребления допускается только один слот.

Ниже отражено, как на функции влияет замена слотов:

- Перенаправление трафика является бесшовным; запросы не отменяются из-за свопа.
- Если функция работает во время свопа, выполнение продолжается, и последующие триггеры направляются в экземпляр сменяемых приложений.

> [!NOTE]
> Слоты в настоящее время недоступны для плана потребления Linux.

## <a name="why-use-slots"></a>Зачем использовать слоты?

Использование слотов для развертывания имеет ряд преимуществ. В следующих сценариях описывается общее использование слотов:

- **Различные среды для различных целей:** Использование различных слотов дает вам возможность дифференцировать экземпляры приложений перед заменой на производство или постановочным слотом.
- **Prewarming**: Развертывание в слот вместо непосредственно госпроизводства позволяет приложению разогреться перед тем, как начать жить. Кроме того, использование слотов снижает задержку для рабочих нагрузок http-triggered. Случаи нагреваются перед развертыванием, что уменьшает холодный запуск для вновь развернутых функций.
- **Легкие запасы:** После свопа с производством, слот с ранее постановочным приложением теперь имеет предыдущее приложение производства. Если изменения, внесенные в производственный слот, не так, как вы ожидаете, вы можете немедленно отменить своп, чтобы получить "последний известный хороший экземпляр" обратно.

## <a name="swap-operations"></a>Операции свопа

Во время свопа один слот считается источником, а другой — целью. В исходном слоте имеется экземпляр приложения, которое применяется к целевому слоту. Следующие шаги гарантируют, что целевой слот не испытывает простоя во время свопа:

1. **Применить настройки:** Настройки из целевого слота применяются ко всем экземплярам исходного слота. Например, параметры производства применяются к экземпляру постановки. Прикладные настройки включают следующие категории:
    - [Настройки](#manage-settings) приложения для слотов и строки соединения (если это применимо)
    - [Непрерывные](../app-service/deploy-continuous-deployment.md) настройки развертывания (если включено)
    - Настройки [аутентификации Службы app](../app-service/overview-authentication-authorization.md) (если включено)

1. **Дождитесь перезагрузки и доступности:** Своп ждет каждого экземпляра в исходном слоте для завершения его перезагрузки и для запросов. Если какой-либо экземпляр не перезаработает, операция своп возвращает все изменения в исходный слот и останавливает операцию.

1. **Обновление routing:** Если все экземпляры исходного слота успешно прогреваются, два слота завершают своп, переключая правила реуктора. После этого шага в целевом слоте (например, в производственном слоте) есть приложение, которое предварительно разогревалось в исходном слоте.

1. **Повторите операцию:** Теперь, когда слот исходного кода имеет предварительное своп-приложение, ранее входиввввввв в целевой слот, выполните ту же операцию, применяя все настройки и перезапустив экземпляры для исходного слота.

Помните на следующие моменты.

- В любой точке операции своп, инициализация замененных приложений происходит на исходном слоте. Целевой слот остается в сети в то время как исходный слот готовится, будь то своп успешно или не удается.

- Чтобы поменять сценич-слот на производственный слот, убедитесь, что производственный слот *всегда* является целевым слотом. Таким образом, операция своп не влияет на приложение для производства.

- Настройки, связанные с источниками событий и привязками, должны быть настроены в виде [настроек слота развертывания,](#manage-settings) *прежде чем инициировать своп.* Маркировка их как "липкая" заблаговременно гарантирует, что события и выходы направляются в соответствующий экземпляр.

## <a name="manage-settings"></a>Управление параметрами

[!INCLUDE [app-service-deployment-slots-settings](../../includes/app-service-deployment-slots-settings.md)]

### <a name="create-a-deployment-setting"></a>Создание настройки развертывания

Настройки можно отметить как настройки развертывания, что делает его «липким». Липкая настройка не меняется с экземпляром приложения.

При создании настройки развертывания в одном слоте убедитесь в том, чтобы создать ту же настройку с уникальным значением в любом другом слоте, участвующего в своп. Таким образом, в то время как значение параметра не изменяется, имена параметров остаются последовательными среди слотов. Эта согласованность имен гарантирует, что ваш код не пытается получить доступ к параметру, который определяется в одном слоте, но не в другом.

Используйте следующие шаги для создания настройки развертывания:

- Перейдите к *Слотам* в приложении функции
- Нажмите на имя слота
- Под *особенностями платформы > общие настройки*, нажмите на **конфигурацию**
- Нажмите на имя настройки, которое вы хотите придерживаться текущего слота
- Нажмите на **флажок развертывания, настройка** флажка
- Нажмите кнопку **ОК**
- Как только установка лезвия исчезает, нажмите **Сохранить,** чтобы сохранить изменения

![Установка слота развертывания](./media/functions-deployment-slots/azure-functions-deployment-slots-deployment-setting.png)

## <a name="deployment"></a>Развертывание

Слоты пусты при создании слота. Для развертывания приложения в слот можно использовать любую [из поддерживаемых технологий развертывания.](./functions-deployment-technologies.md)

## <a name="scaling"></a>Масштабирование

Все слоты масштабируются до того же количества работников, что и производственный слот.

- Для планов потребления, слот масштабируется как функция приложения масштабируется.
- Для планов Службы приложений приложение масштабируется до фиксированного числа работников. Слоты работают на том же количестве работников, что и план приложения.

## <a name="add-a-slot"></a>Добавление слота

Вы можете добавить слот через [CLI](https://docs.microsoft.com/cli/azure/functionapp/deployment/slot?view=azure-cli-latest#az-functionapp-deployment-slot-create) или через портал. Следующие шаги демонстрируют, как создать новый слот на портале:

1. Перейдите к приложению функции и нажмите на **знак плюс** рядом с *Слоты*.

    ![Добавление слота для развертывания функций Azure](./media/functions-deployment-slots/azure-functions-deployment-slots-add.png)

1. Введите имя в текстовом ящике и нажмите кнопку **«Создание».**

    ![Название слота развертывания функций Azure](./media/functions-deployment-slots/azure-functions-deployment-slots-add-name.png)

## <a name="swap-slots"></a>Своп слоты

Вы можете поменять слоты через [CLI](https://docs.microsoft.com/cli/azure/functionapp/deployment/slot?view=azure-cli-latest#az-functionapp-deployment-slot-swap) или через портал. Следующие шаги демонстрируют, как поменять слоты на портале:

1. Перейдите к приложению функции
1. Нажмите на имя исходного слота, которое вы хотите поменять
1. Со вкладки *«Обзор»* нажмите на кнопку ![ **Swap** Swap Azure Functions слот для развертывания](./media/functions-deployment-slots/azure-functions-deployment-slots-swap.png)
1. Проверьте настройки конфигурации для своп и нажмите слот для развертывания **Swap** ![Swap Azure Functions](./media/functions-deployment-slots/azure-functions-deployment-slots-swap-config.png)

Операция может занять некоторое время, пока операция своп будет выполнением.

## <a name="roll-back-a-swap"></a>Откат свопа

Если своп приводит к ошибке или вы просто хотите "отменить" своп, вы можете откатить к исходному состоянию. Чтобы вернуться в заранее сменяемый штат, сделайте еще один своп, чтобы отменить своп.

## <a name="remove-a-slot"></a>Удалить слот

Вы можете удалить слот через [CLI](https://docs.microsoft.com/cli/azure/functionapp/deployment/slot?view=azure-cli-latest#az-functionapp-deployment-slot-delete) или через портал. Следующие шаги показывают, как удалить слот на портале:

1. Перейдите к функции приложения Обзор

1. Нажмите на кнопку **Удалить**

    ![Добавление слота для развертывания функций Azure](./media/functions-deployment-slots/azure-functions-deployment-slots-delete.png)

## <a name="automate-slot-management"></a>Автоматизация управления слотом

Используя [Azure CLI,](https://docs.microsoft.com/cli/azure/functionapp/deployment/slot?view=azure-cli-latest)можно автоматизировать следующие действия для слота:

- [Создать](https://docs.microsoft.com/cli/azure/functionapp/deployment/slot?view=azure-cli-latest#az-functionapp-deployment-slot-create)
- [Удалить](https://docs.microsoft.com/cli/azure/functionapp/deployment/slot?view=azure-cli-latest#az-functionapp-deployment-slot-delete)
- [Список](https://docs.microsoft.com/cli/azure/functionapp/deployment/slot?view=azure-cli-latest#az-functionapp-deployment-slot-list)
- [Своп](https://docs.microsoft.com/cli/azure/functionapp/deployment/slot?view=azure-cli-latest#az-functionapp-deployment-slot-swap)
- [авто-своп](https://docs.microsoft.com/cli/azure/functionapp/deployment/slot?view=azure-cli-latest#az-functionapp-deployment-slot-auto-swap)

## <a name="change-app-service-plan"></a>Изменить план службы приложений

С помощью приложения функции, работая в соответствии с планом Службы приложений, у вас есть возможность изменить базовый план службы приложений для слота.

> [!NOTE]
> Вы не можете изменить план службы приложений слота в соответствии с планом потребления.

Используйте следующие шаги, чтобы изменить план службы приложений слота:

1. Перейдите в слот

1. Под *особенностями платформы*, нажмите **все настройки**

    ![Изменение плана обслуживания приложений](./media/functions-deployment-slots/azure-functions-deployment-slots-change-app-service-settings.png)

1. Нажмите на **план службы приложений**

1. Выберите новый план службы приложений или создайте новый план

1. Нажмите кнопку **ОК**

    ![Изменение плана обслуживания приложений](./media/functions-deployment-slots/azure-functions-deployment-slots-change-app-service-select.png)


## <a name="limitations"></a>Ограничения

Слоты развертывания функций Azure имеют следующие ограничения:

- Количество слотов, доступных для приложения, зависит от плана. В плане потребления допускается только один слот для развертывания. Дополнительные слоты доступны для приложений, работающих в соответствии с планом Службы приложений.
- Замена слота сбрасывает клавиши для `AzureWebJobsSecretStorageType` приложений, `files`которые имеют настройки приложения, равные.
- Слоты недоступны для плана потребления Linux.

## <a name="support-levels"></a>Уровни поддержки

Существует два уровня поддержки слотов развертывания:

- **Общая доступность (GA)**: Полностью поддерживается и одобрена для использования в производстве.
- **Предварительный просмотр**: Еще не поддерживается, но, как ожидается, достигнет статуса ГА в будущем.

| План ОС/Хостинг           | Уровень поддержки     |
| ------------------------- | -------------------- |
| Потребление Windows       | Общедоступная версия |
| Windows Premium           | Общедоступная версия  |
| Windows Выделенные         | Общедоступная версия |
| Потребление Linux         | Не поддерживается          |
| Linux Premium             | Общедоступная версия  |
| Linux Посвященный           | Общедоступная версия |

## <a name="next-steps"></a>Дальнейшие действия

- [Технологии развертывания в функциях Azure](./functions-deployment-technologies.md)
