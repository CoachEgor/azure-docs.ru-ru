---
title: План функций Azure Premium
description: Сведения и параметры конфигурации (VNet, без холодного запуска, длительности выполнения) для плана функций Azure Premium.
author: jeffhollan
ms.topic: conceptual
ms.date: 08/28/2020
ms.author: jehollan
ms.custom:
- references_regions
- fasttrack-edit
ms.openlocfilehash: a037c903a72ba79b79c7e6b011fe025aefd7b51d
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "91578042"
---
# <a name="azure-functions-premium-plan"></a>План функций Azure Premium

План функций Azure Premium (иногда называемый планом эластичного уровня "Премиум") является вариантом размещения для приложений-функций. План "Премиум" предоставляет такие функции, как подключение к виртуальной сети, без холодного запуска и оборудование уровня "Премиум".  В один и тот же план Premium можно развернуть несколько приложений с функциями, а план позволяет настроить размер вычислительных экземпляров, базовый размер плана и максимальный размер плана.  Сравнение плана Premium и других типов планов и размещения см. в статье [варианты масштабирования и размещения функций](functions-scale.md).

## <a name="create-a-premium-plan"></a>Создание плана "Премиум"

[!INCLUDE [functions-premium-create](../../includes/functions-premium-create.md)]

Вы также можете создать план Premium с помощью команды [AZ functionapp Plan Create](/cli/azure/functionapp/plan#az-functionapp-plan-create) в Azure CLI. В следующем примере создается план уровня _эластичного Premium 1_ :

```azurecli-interactive
az functionapp plan create --resource-group <RESOURCE_GROUP> --name <PLAN_NAME> \
--location <REGION> --sku EP1
```

В этом примере замените `<RESOURCE_GROUP>` своей группой ресурсов и `<PLAN_NAME>` именем вашего плана, который уникален в группе ресурсов. Укажите [поддерживаемый `<REGION>` ](https://azure.microsoft.com/global-infrastructure/services/?products=functions). Чтобы создать план Premium, поддерживающий Linux, включите `--is-linux` параметр.

После создания плана можно использовать команду [AZ functionapp Create](/cli/azure/functionapp#az-functionapp-create) , чтобы создать приложение функции. На портале одновременно создаются план и приложение. Пример полного скрипта Azure CLI см. [в разделе Создание приложения-функции в плане Premium](scripts/functions-cli-create-premium-plan.md).

## <a name="features"></a>Компоненты

Следующие функции доступны для приложений-функций, развернутых в плане Premium.

### <a name="always-ready-instances"></a>Всегда готовые экземпляры

Если в плане потребления нет событий и выполнений в настоящее время, приложение может масштабироваться до нулевых экземпляров. Когда поступают новые события, новый экземпляр должен быть специализированным для приложения, работающего на нем.  Специализация новых экземпляров может занять некоторое время в зависимости от приложения.  Эта дополнительная задержка при первом вызове часто называется холодный запуском приложения.

В плане "Премиум" приложение можно всегда подготовить к заданному количеству экземпляров.  Максимальное число экземпляров всегда готовности — 20.  Когда события начинают активировать приложение, они сначала направляются в экземпляры всегда готовы.  По мере активации функции дополнительные экземпляры будут заключаться в буфер.  Этот буфер предотвращает холодный запуск для новых экземпляров, необходимых во время масштабирования.  Эти буферизованные экземпляры называются [предварительно](#pre-warmed-instances)заданными экземплярами.  Благодаря сочетанию готовых экземпляров Always и предварительно загруженного буфера приложение может эффективно исключить холодный запуск.

> [!NOTE]
> Каждый план Premium будет постоянно иметь по крайней мере один активный (оплачивается) экземпляр.

Вы можете настроить количество всегда готовых экземпляров в портал Azure, выбрав **приложение-функция**, перейдите на вкладку **функции платформы** и выберите параметры **Scale out** . В окне Изменение приложения функции всегда готовые экземпляры относятся только к этому приложению.

![Параметры эластичного масштабирования](./media/functions-premium-plan/scale-out.png)

Вы также можете настроить для приложения всегда готовые экземпляры с Azure CLI.

```azurecli-interactive
az resource update -g <resource_group> -n <function_app_name>/config/web --set properties.minimumElasticInstanceCount=<desired_always_ready_count> --resource-type Microsoft.Web/sites 
```

#### <a name="pre-warmed-instances"></a>Предварительно заданный экземпляр

Предварительно подготовленные экземпляры — это число экземпляров, затеплох в буфер во время событий масштабирования и активации.  Предварительно зарезервированные экземпляры продолжают работать в буфере до достижения максимального предела масштабирования.  Число предварительно зарезервированных экземпляров по умолчанию равно 1, а для большинства сценариев должно остаться равное 1.  Если приложение имеет длительное время (например, пользовательский образ контейнера), может потребоваться увеличить этот буфер.  Предварительно заданный экземпляр становится активным только после того, как все активные экземпляры будут достаточно загружены.

Рассмотрим этот пример того, как всегда готовые экземпляры и предварительно подготовленные экземпляры работают вместе.  В приложении-функции уровня "Премиум" настроено пять готовых экземпляров, и по умолчанию используется один предварительно заданный экземпляр.  Когда приложение бездействует и события не запускаются, приложение будет подготовлено и запущено на пяти экземплярах.  В настоящее время вам не будет выставлен счет за предварительно заданный экземпляр, так как экземпляры, которые всегда готовы к использованию, не используются, а предварительно не выделены экземпляры.

Как только первый триггер поступает в, все пять готовых экземпляров становятся активными и выделяется предварительно активированный экземпляр.  Теперь приложение работает с шестью подготовленными экземплярами: пять готовых экземпляров всегда готово и шестой предварительно заданный и неактивный буфер.  Если частота выполнения по мере роста возрастает, то в конечном итоге будет использоваться пять активных экземпляров.  Когда платформа принимает решение о масштабировании за пределами пяти экземпляров, оно будет масштабироваться до готового экземпляра.  В этом случае теперь будет шесть активных экземпляров, и седьмой экземпляр будет немедленно подготовлен и заполнен готовый буфер.  Эта последовательность масштабирования и предварительный прогрев будут продолжаться до тех пор, пока не будет достигнуто максимальное число экземпляров для приложения.  Экземпляры не будут предварительно срабатывать или активированы сверх максимального значения.

Число предварительно заданных экземпляров для приложения можно изменить с помощью Azure CLI.

```azurecli-interactive
az resource update -g <resource_group> -n <function_app_name>/config/web --set properties.preWarmedInstanceCount=<desired_prewarmed_count> --resource-type Microsoft.Web/sites 
```

#### <a name="maximum-instances-for-an-app"></a>Максимальное число экземпляров для приложения

Помимо [счетчика максимальное число экземпляров плана](#plan-and-sku-settings), можно настроить максимум для каждого приложения.  Максимальное число приложений можно настроить с помощью [ограничения масштабирования приложения](./functions-scale.md#limit-scale-out).

### <a name="private-network-connectivity"></a>Подключение к частной сети

Функции Azure, развернутые в плане Premium, используют преимущества [новой интеграции с виртуальной сетью для веб-приложений](../app-service/web-sites-integrate-with-vnet.md).  При настройке приложение может взаимодействовать с ресурсами в виртуальной сети или защищено с помощью конечных точек службы.  Ограничения IP-адресов также доступны в приложении для ограничения входящего трафика.

При назначении подсети для приложения-функции в плане Premium требуется подсеть с достаточной IP-адресацией для каждого возможного экземпляра. Для этого требуется блок IP-адресов, в котором по меньшей мере 100.

Дополнительные сведения см. в статье [интеграция приложения-функции с виртуальной](functions-create-vnet.md)сетью.

### <a name="rapid-elastic-scale"></a>Быстрое Эластичное масштабирование

Дополнительные расчетные экземпляры автоматически добавляются в приложение с использованием той же логики быстрого масштабирования, что и план потребления. Приложения в одном плане службы приложений масштабируются независимо друг от друга в зависимости от потребностей отдельного приложения. Однако приложения функций в одном плане службы приложений совместно используют ресурсы виртуальных машин, чтобы снизить затраты, когда это возможно. Число приложений, связанных с виртуальной машиной, зависит от объема каждого приложения и размера виртуальной машины.

Дополнительные сведения о том, как работает масштабирование, см. в статье [масштабирование и размещение функций](./functions-scale.md#how-the-consumption-and-premium-plans-work).

### <a name="longer-run-duration"></a>Длительность длительного выполнения

Использование функций Azure в плане потребления ограничено 10 минутами для одного выполнения.  В плане Premium длительность выполнения по умолчанию составляет 30 минут, чтобы предотвратить неконтролируемые выполнения. Однако вы можете [изменить host.jsв конфигурации](./functions-host-json.md#functiontimeout) , чтобы сделать продолжительность без ограничений для приложений плана Premium (гарантия 60 минут).

## <a name="plan-and-sku-settings"></a>Параметры плана и номера SKU

При создании плана существует два параметра размера плана: минимальное число экземпляров (или размер плана) и максимальное количество пакетов.

Если приложению требуются экземпляры за пределами всегда готовых экземпляров, можно продолжить масштабирование до тех пор, пока количество экземпляров не достигнет максимального количества пакетов.  Счета выставляются за экземпляры, которые выходят за пределы размера вашего плана, только когда они выполняются и выделяются вам в течение секунды.  Мы будем использовать все усилия при масштабировании приложения до заданного максимального предела.

Можно настроить размер и максимум для плана в портал Azure, выбрав параметры **Scale out** в плане или приложение-функцию, развернутое в этом плане (в разделе **функции платформы**).

Кроме того, можно увеличить максимальное число пакетов от Azure CLI:

```azurecli-interactive
az resource update -g <resource_group> -n <premium_plan_name> --set properties.maximumElasticWorkerCount=<desired_max_burst> --resource-type Microsoft.Web/serverfarms 
```

Минимум для каждого плана будет по крайней мере один экземпляр.  Фактическое минимальное количество экземпляров будет настроено на основе всегда готовых экземпляров, запрошенных приложениями в плане.  Например, если приложение а запрашивает пять готовых экземпляров, а приложение б запрашивает два всегда готовых экземпляра в одном плане, минимальный размер плана будет вычисляться как пять.  Приложение а будет выполняться на всех 5, а приложение б будет работать только на 2.

> [!IMPORTANT]
> За каждый экземпляр, выделенный в качестве минимального числа экземпляров, выставляются счета независимо от того, выполняются ли функции.

В большинстве случаев должно быть достаточно автоматически вычисляемого минимума.  Тем не менее, масштабирование сверх минимального значения выполняется наилучшим образом.  Возможно, хотя маловероятно, что в определенное время горизонтальное масштабирование может быть отложено, если дополнительные экземпляры недоступны.  Установив минимальное значение, превышающее автоматически вычисленное минимальное значение, вы резервируете экземпляры перед горизонтальным масштабированием.

Увеличение вычисленного минимума для плана можно выполнить с помощью Azure CLI.

```azurecli-interactive
az resource update -g <resource_group> -n <premium_plan_name> --set sku.capacity=<desired_min_instances> --resource-type Microsoft.Web/serverfarms 
```

### <a name="available-instance-skus"></a>Номера SKU доступных экземпляров

При создании или масштабировании плана можно выбрать один из трех размеров экземпляра.  Вам будет выставлен счет за общее количество ядер и подготовленной памяти в секунду, когда каждый экземпляр выделяется вам.  Приложение может автоматически масштабироваться на несколько экземпляров по мере необходимости.  

|номер SKU|Ядра|Память|Память|
|--|--|--|--|
|EP1|1|3,5 ГБ|Гбайт|
|EP2|2|7 ГБ|Гбайт|
|EP3|4|14 ГБ|Гбайт|

### <a name="memory-utilization-considerations"></a>Рекомендации по использованию памяти
Выполнение на компьютере с большим объемом памяти не всегда означает, что приложение-функция будет использовать всю доступную память.

Например, приложение-функция JavaScript ограничено ограничением памяти по умолчанию в Node.js. Чтобы увеличить этот фиксированный предел памяти, добавьте параметр приложения `languageWorkers:node:arguments` со значением `--max-old-space-size=<max memory in MB>` .

## <a name="region-max-scale-out"></a>Максимальный Scale Out региона

Ниже приведены максимальные значения, которые поддерживаются в настоящее время для одного плана в каждом регионе и конфигурации ОС. Чтобы запросить увеличение, отправьте запрос в службу поддержки.

См. полную региональную доступность функций здесь: [Azure.com](https://azure.microsoft.com/global-infrastructure/services/?products=functions)

|Регион| Windows | Linux |
|--| -- | -- |
|Центральная Австралия| 100 | Недоступно |
|Центральная Австралия 2| 100 | Недоступно |
|Восточная Австралия| 100 | 20 |
|Australia Southeast | 100 | 20 |
|Южная Бразилия| 100 | 20 |
|Центральная Канада| 100 | 20 |
|Центральная часть США| 100 | 20 |
|Восточный Китай 2| 100 | 20 |
|Северный Китай 2| 100 | 20 |
|Восточная Азия| 100 | 20 |
|Восточная часть США | 100 | 20 |
|восточная часть США 2| 100 | 20 |
|Центральная Франция| 100 | 20 |
|Центрально-Западная Германия| 100 | Недоступно |
|Japan East| 100 | 20 |
|Западная Япония| 100 | 20 |
|Республика Корея, центральный регион| 100 | 20 |
|Республика Корея, южный регион| Недоступно | 20 |
|Центрально-северная часть США| 100 | 20 |
|Северная Европа| 100 | 20 |
|Восточная Норвегия;| 100 | 20 |
|Центрально-южная часть США| 100 | 20 |
|Южная Индия | 100 | Недоступно |
|Юго-Восточная Азия| 100 | 20 |
|Северная Швейцария| 100 | Недоступно |
|Западная Швейцария| 100 | Недоступно |
|южная часть Соединенного Королевства| 100 | 20 |
|западная часть Соединенного Королевства| 100 | 20 |
|US Gov (Аризона)| 100 | 20 |
|US Gov (Вирджиния)| 100 | 20 |
|Уснат Восток| 100 | Недоступно |
|Уснат Запад| 100 | Недоступно |
|Западная Европа| 100 | 20 |
|Западная Индия| 100 | 20 |
|центрально-западная часть США| 100 | 20 |
|западная часть США| 100 | 20 |
|западная часть США 2| 100 | 20 |

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Общие сведения о масштабировании и возможностях размещения функций Azure](functions-scale.md)
