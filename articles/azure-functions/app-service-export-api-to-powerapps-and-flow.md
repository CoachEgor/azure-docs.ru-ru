---
title: Экспорт размещенного в Azure API в PowerApps и Microsoft Flow
description: Общие сведения о предоставлении API, размещенного в службе приложений, для PowerApps и Microsoft Flow
ms.topic: conceptual
ms.date: 04/28/2020
ms.reviewer: sunayv
ms.openlocfilehash: 8ded1c5fba902adeaeb883894452c00c4ae1d617
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "83115832"
---
# <a name="exporting-an-azure-hosted-api-to-powerapps-and-microsoft-flow"></a>Экспорт размещенного в Azure API в PowerApps и Microsoft Flow

[PowerApps](https://powerapps.microsoft.com/guided-learning/learning-introducing-powerapps/) — это служба для создания и использования пользовательских бизнес-приложений, которые подключаются к данным и работают на различных платформах. [Microsoft Flow](/learn/modules/get-started-with-flow/index) позволяет легко автоматизировать рабочие и бизнес-процессы между избранными приложениями и службами. PowerApps и Microsoft Flow содержат ряд встроенных соединителей для источников данных, таких как Office 365, Dynamics 365, Salesforce и т д. В некоторых случаях разработчикам приложений и потоков также нужно подключиться к источникам данных и API, созданным в их организации.

Аналогичным образом разработчикам, которым необходимо расширить возможности совместного использования API внутри организации, может потребоваться предоставить доступ к своим API создателям приложений и потоков. В этой статье показано, как экспортировать API, созданный с помощью [функций Azure](../azure-functions/functions-overview.md) или [службы приложений Azure](../app-service/overview.md). Экспортированный API становится *настраиваемым соединителем*, который используется в PowerApps и Microsoft Flow так же, как встроенный соединитель.

> [!IMPORTANT]
> Функциональные возможности определения API, приведенные в этой статье, поддерживаются только для [версии 1. x приложений среды выполнения функций Azure](functions-versions.md#creating-1x-apps) и служб приложений. Версия 2. x функций интегрируется со службой управления API для создания и сопровождения определений OpenAPI. Дополнительные сведения см. в статье [Создание определения OpenAPI для функции с помощью службы управления API Azure](functions-openapi-definition.md). 

## <a name="create-and-export-an-api-definition"></a>Создание и экспорт определения API
Перед экспортом API нужно описать его с помощью определения OpenAPI (ранее называвшегося файлом [Swagger](https://swagger.io/)). Это определение содержит сведения о доступных операция в API и о том, как необходимо структурировать данные запросов и ответов для API. С помощью PowerApps и Microsoft Flow можно создать настраиваемые соединители для любого определения OpenAPI 2.0. Функции Azure и служба приложений Azure имеют встроенную поддержку создания и размещения определений OpenAPI, а также управления ими. Дополнительные сведения см. в статье [Размещение API-интерфейсов RESTful с поддержкой CORS в службе приложений Azure](../app-service/app-service-web-tutorial-rest-api.md).

> [!NOTE]
> Также можно создать настраиваемые соединители в пользовательских интерфейсах PowerApps и Microsoft Flow без использования определения OpenAPI. Дополнительные сведения см. в статьях [Регистрация и использование настраиваемых соединителей в PowerApps](https://powerapps.microsoft.com/tutorials/register-custom-api/) и [Регистрация и использование настраиваемых соединителей в Microsoft Flow](/power-automate/developer/register-custom-api).

Чтобы экспортировать определение API, выполните такие действия:

1. В [портал Azure](https://portal.azure.com)перейдите к приложению функции или приложению службы приложений.

    В меню слева в разделе **API**выберите **Определение API**.

    :::image type="content" source="media/app-service-export-api-to-powerapps-and-flow/api-definition-function.png" alt-text="Определение API Функций Azure":::

2. Кнопка **Export to PowerApps + Microsoft Flow** (Экспорт в PowerApps + Microsoft Flow) должна быть доступна (если нет, сначала нужно создать определение OpenAPI). Нажмите эту кнопку, чтобы начать процесс экспорта.

    ![Кнопка Export to PowerApps + Microsoft Flow (Экспорт в PowerApps + Microsoft Flow)](media/app-service-export-api-to-powerapps-and-flow/export-apps-flow.png)

3. Выберите **режим экспорта**:

    **Экспресс**: позволяет создавать пользовательский соединитель в портале Azure. Для этого требуется, чтобы вы вошли в PowerApps или Microsoft Flow и получили разрешение на создание соединителей в целевой среде. Этот подход рекомендуется, если эти два требования могут быть выполнены. При использовании этого режима следуйте инструкциям, приведенным в разделе [Экспресс экспорт](#express) ниже.

    **Вручную**. Позволяет экспортировать определение API, которое затем импортируется с помощью порталов PowerApps или Microsoft Flow. Этот подход рекомендуется, если пользователь Azure и пользователь с разрешением на создание соединителей являются разными людьми или если соединитель необходимо создать в другом клиенте Azure. При использовании этого режима следуйте инструкциям, приведенным в разделе [Экспорт вручную](#manual) ниже.

    ![Режим экспорта](media/app-service-export-api-to-powerapps-and-flow/export-mode.png)

> [!NOTE]
> Настраиваемый соединитель использует *копию* определения API, поэтому PowerApps и Microsoft Flow не сразу узнают о внесении изменений в приложение и определение API. При внесении изменений повторите действия по экспорту для новой версии.

<a name="express"></a>
## <a name="use-express-export"></a>Экспресс-экспорт

Чтобы выполнить экспорт в режиме **Экспресс**, выполните следующие действия:

1. Убедитесь, что вы вошли в клиент PowerApps или Microsoft Flow, в который необходимо выполнить экспорт. 

2. Используйте настройки, указанные в таблице.

    |Параметр|Описание:|
    |--------|------------|
    |**Среда**|Выберите среду, в которую нужно сохранить настраиваемый соединитель. Дополнительные сведения см. в статье [Обзор сред](https://powerapps.microsoft.com/tutorials/environments-overview/).|
    |**Имя пользовательского API**|Введите имя, которое разработчики PowerApps and Microsoft Flow увидят в своих списках соединителей.|
    |**Подготовка конфигурации безопасности**|При необходимости укажите сведения о конфигурации безопасности, необходимые для предоставления пользователям доступа к API. В этом примере показан ключ API. Дополнительные сведения см. в разделе [Указание типа проверки подлинности](#auth) ниже.|
 
    ![Экспресс-экспорт в PowerApps и Microsoft Flow](media/app-service-export-api-to-powerapps-and-flow/export-express.png)

3. Нажмите кнопку **ОК**. После этого будет создан настраиваемый соединитель, который затем будет добавлен в указанную среду.

<a name="manual"></a>
## <a name="use-manual-export"></a>Экспорт вручную

Чтобы выполнить экспорт в **ручном** режиме, выполните такие действия:

1. Щелкните **Скачать** и сохраните файл или щелкните кнопку "Копировать" и сохраните URL-адрес. При импорте будет использоваться URL-адрес или скачанный файл.
 
    ![Экспорт вручную в PowerApps и Microsoft Flow](media/app-service-export-api-to-powerapps-and-flow/export-manual.png)
 
2. Если определение API содержит какие-либо определения безопасности, эти определения будут вызваны на шаге #2. Во время импорта PowerApps и Microsoft Flow обнаруживает эти определения и запрашивает сведения о безопасности. Получите учетные данные, связанные с определениями. Они понадобятся в следующем разделе. Дополнительные сведения см. в разделе [Указание типа проверки подлинности](#auth) ниже.

    ![Безопасность при экспорте вручную](media/app-service-export-api-to-powerapps-and-flow/export-manual-security.png)

    В этом примере показано определение ключа безопасности API, который содержится в определении OpenAPI.

Теперь, когда определение API экспортировано, импортируйте его, чтобы создать настраиваемый соединитель в PowerApps и Microsoft Flow. Настраиваемые соединители совместно используются двумя службами, поэтому импортировать определение необходимо один раз.

Чтобы импортировать определение API в PowerApps и Microsoft Flow, выполните такие действия:

1. Откройте сайт [powerapps.com](https://web.powerapps.com) или [flow.microsoft.com](https://flow.microsoft.com).

2. В правом верхнем углу нажмите значок шестеренки и выберите **Настраиваемые соединители**.

   ![Значок шестеренки на странице службы](media/app-service-export-api-to-powerapps-and-flow/icon-gear.png)

3. Последовательно щелкните **Создать пользовательский соединитель** и **Импортировать определение OpenAPI**.

   ![Создание пользовательского соединителя](media/app-service-export-api-to-powerapps-and-flow/flow-apps-create-connector.png)

4. Введите имя пользовательского соединителя, затем найдите определение OpenAPI, которое вы экспортировали, и щелкните **Подключить**.

   ![Передача определения OpenAPI](media/app-service-export-api-to-powerapps-and-flow/flow-apps-upload-definition.png)

4. На вкладке **Общие** просмотрите данные, которые поступают из определения OpenAPI.

5. Если появится запрос на ввод сведений о проверке подлинности, введите значения для соответствующего типа проверки подлинности на вкладке **Безопасность**. Нажмите кнопку **Продолжить**.

    ![Вкладка "Безопасность"](media/app-service-export-api-to-powerapps-and-flow/tab-security.png)

    В этом примере показаны обязательные поля для проверки подлинности с использованием ключа API. Поля отличаются в зависимости от типа проверки подлинности.

6. На вкладке **Определения** все операции, определенные в файле OpenAPI, заполняются автоматически. Если определены все необходимые операции, можно перейти к следующему шагу. Если нет, вы можете добавить и изменить операции здесь.

    ![Вкладка "Определения"](media/app-service-export-api-to-powerapps-and-flow/tab-definitions.png)

    В этом примере имеется одна операция, которая называется `CalculateCosts`. Метаданные, такие как **Описание**, берутся из файла OpenAPI.

7. Щелкните **Create connector** (Создать соединитель) в верхней части страницы.

Теперь можно подключиться к настраиваемому соединителю в PowerApps и Microsoft Flow. Дополнительные сведения о создании соединителей на порталах PowerApps и Microsoft Flow см. в статье [Регистрация настраиваемого соединителя (PowerApps)](https://powerapps.microsoft.com/tutorials/register-custom-api/#register-your-custom-connector) и [Регистрация настраиваемого соединителя (Microsoft Flow)](/power-automate/get-started-flow-dev#create-a-custom-connector).

<a name="auth"></a>
## <a name="specify-authentication-type"></a>Укажите тип аутентификации

PowerApps и Microsoft Flow поддерживают коллекцию поставщиков удостоверений, которые обеспечивают проверку подлинности настраиваемых соединителей. Если для API требуется проверка подлинности, это определение должно быть записано в виде _определения безопасности_ в документе OpenAPI, как показано в примере ниже:

```json
"securityDefinitions": {
    "AAD": {
    "type": "oauth2",
    "flow": "accessCode",
    "authorizationUrl": "https://login.windows.net/common/oauth2/authorize",
    "scopes": {}
    }
}
``` 
Во время экспорта укажите значения конфигурации, позволяющие PowerApps и Microsoft Flow проверить подлинность пользователей.

В этом разделе описаны типы проверки подлинности, поддерживаемые в режиме **Экспресс**: ключ API, Azure Active Directory и универсальная OAuth 2.0. PowerApps и Microsoft Flow также поддерживают обычную проверку подлинности и OAuth 2.0 для определенных служб, таких как Dropbox, Facebook или SalesForce.

### <a name="api-key"></a>Ключ API
При использовании ключа API пользователям соединителя будет предложено предоставить ключ во время создания подключения. Укажите имя ключа API, чтобы помочь пользователям понять, какой ключ необходим. В предыдущем примере используется имя `API Key (contact meganb@contoso.com)`, чтобы пользователи знали, где можно получить сведения о ключе API. Для Функций Azure это, как правило, один из ключей узла, охватывающий несколько функций внутри приложения-функции.

### <a name="azure-active-directory-azure-ad"></a>Azure Active Directory (Azure AD)
При использовании Azure AD необходимо две регистрации приложения Azure AD: одна для API, а другая — для настраиваемого соединителя:

- Чтобы настроить регистрацию для API, используйте возможность [проверки подлинности и авторизации в службе приложений](../app-service/configure-authentication-provider-aad.md).

- Чтобы настроить регистрацию для соединителя, выполните действия, описанные в разделе [Добавление приложения](https://docs.microsoft.com/azure/active-directory/develop/active-directory-integrating-applications). Регистрации требуется делегированный доступ к вашему API и URL-адресу ответа из `https://msmanaged-na.consent.azure-apim.net/redirect`. 

Дополнительные сведения см. в примерах регистрации Azure AD для [PowerApps](https://powerapps.microsoft.com/tutorials/customapi-azure-resource-manager-tutorial/) и [Microsoft Flow](https://docs.microsoft.com/connectors/custom-connectors/azure-active-directory-authentication). В этих примерах в качестве API используется Azure Resource Manager. Замените свой API при выполнении этих шагов.

Требуются следующие значения конфигурации:
- **Идентификатор клиента.** Идентификатор клиента регистрации соединителя Azure AD.
- **Секрет клиента.** Секрет клиента регистрации соединителя Azure AD.
- **URL-адрес для входа.** Базовый URL-адрес для Azure AD. Как правило, в Azure `https://login.windows.net` .
- **Идентификатор клиента**: идентификатор клиента, используемый для входа. Этот идентификатор должен иметь значение "Common" или идентификатор клиента, в котором создан соединитель.
- **URL-адрес ресурса.** URL-адрес ресурса регистрации Azure AD для API.

> [!IMPORTANT]
> Если импортировать определение API в PowerApps и Microsoft Flow в качестве ручного потока будет другой пользователь, помимо файла определения API ему нужно предоставить идентификатор и секрет клиента *регистрации соединителя*. Обеспечьте безопасное управление этими секретами. **Не предоставляйте учетные данные безопасности самого API.**

### <a name="generic-oauth-20"></a>Универсальная OAuth 2.0
При использовании универсальной OAuth 2.0 можно интегрироваться с любым поставщиком OAuth 2.0. Это позволяет работать с настраиваемыми поставщиками, которые изначально не поддерживаются.

Требуются следующие значения конфигурации:
- **Идентификатор клиента**: идентификатор клиента OAuth 2.0
- **Секрет клиента**: секрет клиента OAuth 2.0.
- **Authorization URL** (URL-адрес для авторизации) URL-адрес для авторизации OAuth 2.0.
- **Token URL** (URL-адрес токена): URL-адрес токена OAuth 2.0.
- **Refresh URL** (URL-адрес обновления): URL-адрес обновления OAuth 2.0.


