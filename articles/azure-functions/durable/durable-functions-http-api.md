---
title: HTTP APIs in Durable Functions - Azure Functions
description: Сведения о том, как внедрять API HTTP в расширении устойчивых функций для Функций Azure.
author: cgillum
ms.topic: conceptual
ms.date: 09/07/2019
ms.author: azfuncdf
ms.openlocfilehash: 0390211e6fc42bd7183a770cac409b880310d317
ms.sourcegitcommit: d6b68b907e5158b451239e4c09bb55eccb5fef89
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/20/2019
ms.locfileid: "74231392"
---
# <a name="http-api-reference"></a>Справочник по API HTTP

The Durable Functions extension exposes a set of built-in HTTP APIs that can be used to perform management tasks on [orchestrations](durable-functions-types-features-overview.md#orchestrator-functions), [entities](durable-functions-types-features-overview.md#entity-functions), and [task hubs](durable-functions-task-hubs.md). These HTTP APIs are extensibility webhooks that are authorized by the Azure Functions host but handled directly by the Durable Functions extension.

All HTTP APIs implemented by the extension require the following parameters. Тип данных всех параметров — `string`.

| Параметр        | Тип параметра  | Описание |
|------------------|-----------------|-------------|
| **`taskHub`**    | Строка запроса    | Имя [центра задач](durable-functions-task-hubs.md). Если не указано, предполагается имя центра задач текущего приложения-функции. |
| **`connection`** | Строка запроса    | **Имя** строки подключения для учетной записи хранения. Если не указано, предполагается строка подключения по умолчанию для приложения-функции. |
| **`systemKey`**  | Строка запроса    | Ключ авторизации, необходимый для вызова API. |

`systemKey` is an authorization key autogenerated by the Azure Functions host. В частности, он предоставляет доступ к API расширения устойчивых задач и им можно управлять так же, как и [другими ключами авторизации](https://github.com/Azure/azure-webjobs-sdk-script/wiki/Key-management-API). You can generate URLs that contain the correct `taskHub`, `connection`, and `systemKey` query string values using [orchestration client binding](durable-functions-bindings.md#orchestration-client) APIs, such as the `CreateCheckStatusResponse` and `CreateHttpManagementPayload` APIs in .NET, or the `createCheckStatusResponse` and `createHttpManagementPayload` APIs in JavaScript.

В следующих нескольких разделах рассматриваются определенные API HTTP, поддерживаемые расширением, и приведены примеры их использования.

## <a name="start-orchestration"></a>Start orchestration

Starts executing a new instance of the specified orchestrator function.

### <a name="request"></a>Запрос

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
POST /admin/extensions/DurableTaskExtension/orchestrators/{functionName}/{instanceId?}
     ?taskHub={taskHub}
     &connection={connectionName}
     &code={systemKey}
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
POST /runtime/webhooks/durabletask/orchestrators/{functionName}/{instanceId?}
     ?taskHub={taskHub}
     &connection={connectionName}
     &code={systemKey}
```

Параметры запроса для этого API включают набор по умолчанию, упомянутый ранее, а также следующие уникальные параметры:

| Поле              | Тип параметра  | Описание |
|--------------------|-----------------|-------------|
| **`functionName`** | URL-адрес             | The name of the orchestrator function to start. |
| **`instanceId`**   | URL-адрес             | Необязательный параметр. Идентификатор экземпляра оркестрации. If not specified, the orchestrator function will start with a random instance ID. |
| **`{content}`**    | Содержимое запроса | Необязательный элемент. The JSON-formatted orchestrator function input. |

### <a name="response"></a>Ответ

Может быть возвращено несколько кодов состояния.

* **HTTP 202 (Accepted)** : The specified orchestrator function was scheduled to start running. The `Location` response header contains a URL for polling the orchestration status.
* **HTTP 400 (Bad request)** : The specified orchestrator function doesn't exist, the specified instance ID was not valid, or request content was not valid JSON.

The following is an example request that starts a `RestartVMs` orchestrator function and includes  JSON object payload:

```http
POST /runtime/webhooks/durabletask/orchestrators/RestartVMs?code=XXX
Content-Type: application/json
Content-Length: 83

{
    "resourceGroup": "myRG",
    "subscriptionId": "111deb5d-09df-4604-992e-a968345530a9"
}
```

The response payload for the **HTTP 202** cases is a JSON object with the following fields:

| Поле                       | Описание                          |
|-----------------------------|--------------------------------------|
| **`id`**                    |Идентификатор экземпляра оркестрации. |
| **`statusQueryGetUri`**     |URL-адрес состояния экземпляра оркестрации. |
| **`sendEventPostUri`**      |URL-адрес вызова события экземпляра оркестрации. |
| **`terminatePostUri`**      |URL-адрес завершения экземпляра оркестрации. |
| **`purgeHistoryDeleteUri`** |The "purge history" URL of the orchestration instance. |
| **`rewindPostUri`**         |(preview) The "rewind" URL of the orchestration instance. |

Тип данных всех полей — `string`.

Here is an example response payload for an orchestration instance with `abc123` as its ID (formatted for readability):

```http
{
    "id": "abc123",
    "purgeHistoryDeleteUri": "http://localhost:7071/runtime/webhooks/durabletask/instances/abc123?code=XXX",
    "sendEventPostUri": "http://localhost:7071/runtime/webhooks/durabletask/instances/abc123/raiseEvent/{eventName}?code=XXX",
    "statusQueryGetUri": "http://localhost:7071/runtime/webhooks/durabletask/instances/abc123?code=XXX",
    "terminatePostUri": "http://localhost:7071/runtime/webhooks/durabletask/instances/abc123/terminate?reason={text}&code=XXX"
}
```

The http response is intended to be compatible with the *Polling Consumer Pattern*. It also includes the following notable response headers:

* **Location**: The URL of the status endpoint. This URL contains the same value as the `statusQueryGetUri` field.
* **Retry-After**: The number of seconds to wait between polling operations. По умолчанию используется значение `10`.

For more information on the asynchronous HTTP polling pattern, see the [HTTP async operation tracking](durable-functions-http-features.md#async-operation-tracking) documentation.

## <a name="get-instance-status"></a>Получение состояния экземпляра

Возвращает состояние определенного экземпляра оркестрации.

### <a name="request"></a>Запрос

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
GET /admin/extensions/DurableTaskExtension/instances/{instanceId}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &showHistory=[true|false]
    &showHistoryOutput=[true|false]
    &showInput=[true|false]
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
GET /runtime/webhooks/durabletask/instances/{instanceId}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &showHistory=[true|false]
    &showHistoryOutput=[true|false]
    &showInput=[true|false]
```

Параметры запроса для этого API включают набор по умолчанию, упомянутый ранее, а также следующие уникальные параметры:

| Поле                   | Тип параметра  | Описание |
|-------------------------|-----------------|-------------|
| **`instanceId`**        | URL-адрес             | Идентификатор экземпляра оркестрации. |
| **`showInput`**         | Строка запроса    | Необязательный параметр. If set to `false`, the function input will not be included in the response payload.|
| **`showHistory`**       | Строка запроса    | Необязательный параметр. Если задано значение `true`, журнал выполнения оркестрации будет включен в полезные данные ответа.|
| **`showHistoryOutput`** | Строка запроса    | Необязательный параметр. If set to `true`, the function outputs will be included in the orchestration execution history.|
| **`createdTimeFrom`**   | Строка запроса    | Необязательный параметр. When specified, filters the list of returned instances that were created at or after the given ISO8601 timestamp.|
| **`createdTimeTo`**     | Строка запроса    | Необязательный параметр. When specified, filters the list of returned instances that were created at or before the given ISO8601 timestamp.|
| **`runtimeStatus`**     | Строка запроса    | Необязательный параметр. При указании он фильтрует список возвращаемого значения экземпляров на основе их состояния среды выполнения. To see the list of possible runtime status values, see the [Querying instances](durable-functions-instance-management.md) article. |

### <a name="response"></a>Ответ

Может быть возвращено несколько кодов состояния.

* **HTTP 200 (ОК)** (HTTP 200 (ОК)). Указанный экземпляр находится в завершенном состоянии.
* **HTTP 202 (Accepted)** (HTTP 202 (принято)). Указанный экземпляр выполняется.
* **HTTP 400 (Bad Request)** (HTTP 400 (неверный запрос)). На определенном экземпляре произошел сбой, или его работа была прервана.
* **HTTP 404 (Not Found)** (HTTP 404 (не найдено)). Указанный экземпляр не существует или не был запущен.
* **HTTP 500 (внутренняя ошибка сервера)** : сбой указанного экземпляра с необработанным исключением.

Полезные данные ответа для случаев **HTTP 200** и **HTTP 202** являются объектами JSON со следующими полями:

| Поле                 | Тип данных | Описание |
|-----------------------|-----------|-------------|
| **`runtimeStatus`**   | string    | Состояние среды выполнения экземпляра. Возможные значения: *Running*, *Pending*, *Failed*, *Canceled*, *Terminated*, *Completed*. |
| **`input`**           | JSON      | Данные JSON, используемые для инициализации экземпляра. Это поле имеет значение `null`, если для параметра строки запроса `showInput` задано значение `false`.|
| **`customStatus`**    | JSON      | Данные JSON, используемые для состояния пользовательской оркестрации. Если поле не заполнено, для него устанавливается значение `null`. |
| **`output`**          | JSON      | Выходные данные JSON экземпляра. Это поле имеет значение `null`, если экземпляр не находится в завершенном состоянии. |
| **`createdTime`**     | string    | Время, когда был создан экземпляр. Использует расширенную нотацию ISO 8601. |
| **`lastUpdatedTime`** | string    | Время, когда экземпляр был в последний раз сохранен. Использует расширенную нотацию ISO 8601. |
| **`historyEvents`**   | JSON      | Массив JSON, содержащий журнал выполнения оркестрации. Это поле имеет значение `null`, если для параметра строки запроса `showHistory` не задано значение `true`. |

Ниже приведен пример полезных данных ответа, включающий журнал выполнения оркестрации и выходные данные действия (в удобном для чтения формате).

```json
{
  "createdTime": "2018-02-28T05:18:49Z",
  "historyEvents": [
      {
          "EventType": "ExecutionStarted",
          "FunctionName": "E1_HelloSequence",
          "Timestamp": "2018-02-28T05:18:49.3452372Z"
      },
      {
          "EventType": "TaskCompleted",
          "FunctionName": "E1_SayHello",
          "Result": "Hello Tokyo!",
          "ScheduledTime": "2018-02-28T05:18:51.3939873Z",
          "Timestamp": "2018-02-28T05:18:52.2895622Z"
      },
      {
          "EventType": "TaskCompleted",
          "FunctionName": "E1_SayHello",
          "Result": "Hello Seattle!",
          "ScheduledTime": "2018-02-28T05:18:52.8755705Z",
          "Timestamp": "2018-02-28T05:18:53.1765771Z"
      },
      {
          "EventType": "TaskCompleted",
          "FunctionName": "E1_SayHello",
          "Result": "Hello London!",
          "ScheduledTime": "2018-02-28T05:18:53.5170791Z",
          "Timestamp": "2018-02-28T05:18:53.891081Z"
      },
      {
          "EventType": "ExecutionCompleted",
          "OrchestrationStatus": "Completed",
          "Result": [
              "Hello Tokyo!",
              "Hello Seattle!",
              "Hello London!"
          ],
          "Timestamp": "2018-02-28T05:18:54.3660895Z"
      }
  ],
  "input": null,
  "customStatus": { "nextActions": ["A", "B", "C"], "foo": 2 },
  "lastUpdatedTime": "2018-02-28T05:18:54Z",
  "output": [
      "Hello Tokyo!",
      "Hello Seattle!",
      "Hello London!"
  ],
  "runtimeStatus": "Completed"
}
```

Ответ **HTTP 202** также включает заголовок ответа **Location**, который ссылается на тот же URL-адрес, что и поле `statusQueryGetUri`, упомянутое ранее.

## <a name="get-all-instances-status"></a>Получение состояния всех экземпляров

You can also query the status of all instances by removing the `instanceId` from the 'Get instance status' request. In this case, the basic parameters are the same as the 'Get instance status'. Query string parameters for filtering are also supported.

Следует помнить, что `connection` и `code` являются дополнительными. If you have anonymous auth on the function, then `code` isn't required.
If you don't want to use a different storage connection string other than defined in the AzureWebJobsStorage app setting, then you can safely ignore the connection query string parameter.

### <a name="request"></a>Запрос

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
GET /admin/extensions/DurableTaskExtension/instances
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &createdTimeFrom={timestamp}
    &createdTimeTo={timestamp}
    &runtimeStatus={runtimeStatus1,runtimeStatus2,...}
    &showInput=[true|false]
    &top={integer}
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
GET /runtime/webhooks/durableTask/instances?
    taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &createdTimeFrom={timestamp}
    &createdTimeTo={timestamp}
    &runtimeStatus={runtimeStatus1,runtimeStatus2,...}
    &showInput=[true|false]
    &top={integer}
```

Параметры запроса для этого API включают набор по умолчанию, упомянутый ранее, а также следующие уникальные параметры:

| Поле                   | Тип параметра  | Описание |
|-------------------------|-----------------|-------------|
| **`instanceId`**        | URL-адрес             | Идентификатор экземпляра оркестрации. |
| **`showInput`**         | Строка запроса    | Необязательный параметр. If set to `false`, the function input will not be included in the response payload.|
| **`showHistory`**       | Строка запроса    | Необязательный параметр. Если задано значение `true`, журнал выполнения оркестрации будет включен в полезные данные ответа.|
| **`showHistoryOutput`** | Строка запроса    | Необязательный параметр. If set to `true`, the function outputs will be included in the orchestration execution history.|
| **`createdTimeFrom`**   | Строка запроса    | Необязательный параметр. When specified, filters the list of returned instances that were created at or after the given ISO8601 timestamp.|
| **`createdTimeTo`**     | Строка запроса    | Необязательный параметр. When specified, filters the list of returned instances that were created at or before the given ISO8601 timestamp.|
| **`runtimeStatus`**     | Строка запроса    | Необязательный параметр. При указании он фильтрует список возвращаемого значения экземпляров на основе их состояния среды выполнения. To see the list of possible runtime status values, see the [Querying instances](durable-functions-instance-management.md) article. |
| **`top`**               | Строка запроса    | Необязательный параметр. When specified, limits the number of instances returned by the query. |

### <a name="response"></a>Ответ

Вот пример полезных данных ответа, включая состояние оркестрации (в удобном для чтения формате):

```json
[
    {
        "instanceId": "7af46ff000564c65aafbfe99d07c32a5",
        "runtimeStatus": "Completed",
        "input": null,
        "customStatus": null,
        "output": [
            "Hello Tokyo!",
            "Hello Seattle!",
            "Hello London!"
        ],
        "createdTime": "2018-06-04T10:46:39Z",
        "lastUpdatedTime": "2018-06-04T10:46:47Z"
    },
    {
        "instanceId": "80eb7dd5c22f4eeba9f42b062794321e",
        "runtimeStatus": "Running",
        "input": null,
        "customStatus": null,
        "output": null,
        "createdTime": "2018-06-04T15:18:28Z",
        "lastUpdatedTime": "2018-06-04T15:18:38Z"
    },
    {
        "instanceId": "9124518926db408ab8dfe84822aba2b1",
        "runtimeStatus": "Completed",
        "input": null,
        "customStatus": null,
        "output": [
            "Hello Tokyo!",
            "Hello Seattle!",
            "Hello London!"
        ],
        "createdTime": "2018-06-04T10:46:54Z",
        "lastUpdatedTime": "2018-06-04T10:47:03Z"
    },
    {
        "instanceId": "d100b90b903c4009ba1a90868331b11b",
        "runtimeStatus": "Pending",
        "input": null,
        "customStatus": null,
        "output": null,
        "createdTime": "2018-06-04T15:18:39Z",
        "lastUpdatedTime": "2018-06-04T15:18:39Z"
    }
]
```

> [!NOTE]
> Эта операция может быть весьма затратной с точки зрения операций ввода-вывода службы хранилища Azure, если в таблице экземпляров много строк. Дополнительные сведения о таблице экземпляров см. в документации по [производительности и масштабируемости в устойчивых функциях (Функциях Azure)](durable-functions-perf-and-scale.md#instances-table).
>

If more results exist, a continuation token is returned in the response header.  Имя заголовка — `x-ms-continuation-token`.

If you set continuation token value in the next request header, you can get the next page of results. This name of the request header is also `x-ms-continuation-token`.

## <a name="purge-single-instance-history"></a>Purge single instance history

Deletes the history and related artifacts for a specified orchestration instance.

### <a name="request"></a>Запрос

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
DELETE /admin/extensions/DurableTaskExtension/instances/{instanceId}
    ?taskHub={taskHub}
    &connection={connection}
    &code={systemKey}
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
DELETE /runtime/webhooks/durabletask/instances/{instanceId}
    ?taskHub={taskHub}
    &connection={connection}
    &code={systemKey}
```

Параметры запроса для этого API включают набор по умолчанию, упомянутый ранее, а также следующие уникальные параметры:

| Поле             | Тип параметра  | Описание |
|-------------------|-----------------|-------------|
| **`instanceId`**  | URL-адрес             | Идентификатор экземпляра оркестрации. |

### <a name="response"></a>Ответ

The following HTTP status code values can be returned.

* **HTTP 200 (OK)** : The instance history has been purged successfully.
* **HTTP 404 (Not Found)** : The specified instance doesn't exist.

The response payload for the **HTTP 200** case is a JSON object with the following field:

| Поле                  | Тип данных | Описание |
|------------------------|-----------|-------------|
| **`instancesDeleted`** | целое число   | The number of instances deleted. For the single instance case, this value should always be `1`. |

Ниже приведен пример полезных данных ответа (в формате, удобном для чтения):

```json
{
    "instancesDeleted": 1
}
```

## <a name="purge-multiple-instance-histories"></a>Purge multiple instance histories

You can also delete the history and related artifacts for multiple instances within a task hub by removing the `{instanceId}` from the 'Purge single instance history' request. To selectively purge instance history, use the same filters described in the 'Get all instances status' request.

### <a name="request"></a>Запрос

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
DELETE /admin/extensions/DurableTaskExtension/instances
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &createdTimeFrom={timestamp}
    &createdTimeTo={timestamp}
    &runtimeStatus={runtimeStatus1,runtimeStatus2,...}
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
DELETE /runtime/webhooks/durabletask/instances
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &createdTimeFrom={timestamp}
    &createdTimeTo={timestamp}
    &runtimeStatus={runtimeStatus1,runtimeStatus2,...}
```

Параметры запроса для этого API включают набор по умолчанию, упомянутый ранее, а также следующие уникальные параметры:

| Поле                 | Тип параметра  | Описание |
|-----------------------|-----------------|-------------|
| **`createdTimeFrom`** | Строка запроса    | Filters the list of purged instances that were created at or after the given ISO8601 timestamp.|
| **`createdTimeTo`**   | Строка запроса    | Необязательный параметр. When specified, filters the list of purged instances that were created at or before the given ISO8601 timestamp.|
| **`runtimeStatus`**   | Строка запроса    | Необязательный параметр. When specified, filters the list of purged instances based on their runtime status. To see the list of possible runtime status values, see the [Querying instances](durable-functions-instance-management.md) article. |

> [!NOTE]
> This operation can be very expensive in terms of Azure Storage I/O if there are a lot of rows in the Instances and/or History tables. More details on these tables can be found in the [Performance and scale in Durable Functions (Azure Functions)](durable-functions-perf-and-scale.md#instances-table) documentation.

### <a name="response"></a>Ответ

The following HTTP status code values can be returned.

* **HTTP 200 (OK)** : The instance history has been purged successfully.
* **HTTP 404 (Not Found)** : No instances were found that match the filter expression.

The response payload for the **HTTP 200** case is a JSON object with the following field:

| Поле                   | Тип данных | Описание |
|-------------------------|-----------|-------------|
| **`instancesDeleted`**  | целое число   | The number of instances deleted. |

Ниже приведен пример полезных данных ответа (в формате, удобном для чтения):

```json
{
    "instancesDeleted": 250
}
```

## <a name="raise-event"></a>Вызов события

Отправляет сообщение уведомления о событии в выполняющийся экземпляр оркестрации.

### <a name="request"></a>Запрос

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
POST /admin/extensions/DurableTaskExtension/instances/{instanceId}/raiseEvent/{eventName}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
POST /runtime/webhooks/durabletask/instances/{instanceId}/raiseEvent/{eventName}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
```

Параметры запроса для этого API включают набор по умолчанию, упомянутый ранее, а также следующие уникальные параметры:

| Поле             | Тип параметра  | Описание |
|-------------------|-----------------|-------------|
| **`instanceId`**  | URL-адрес             | Идентификатор экземпляра оркестрации. |
| **`eventName`**   | URL-адрес             | Имя события, которое ожидает целевой экземпляр оркестрации. |
| **`{content}`**   | Содержимое запроса | Полезные данные события в формате JSON. |

### <a name="response"></a>Ответ

Может быть возвращено несколько кодов состояния.

* **HTTP 202 (Accepted)** (HTTP 202 (принято)). Вызванное событие принято в обработку.
* **HTTP 400 (Bad request)** (HTTP 400 (неверный запрос)). Содержимое запроса не принадлежит к допустимому типу `application/json` или не является допустимым файлом JSON.
* **HTTP 404 (Not Found)** (HTTP 404 (не найдено)). Указанный экземпляр не найден.
* **HTTP 410 (Gone)** (HTTP 410 (потеряно)). Указанный экземпляр выполнен или завершился с ошибкой и не может обрабатывать возникающие события.

Ниже приведен пример запроса, отправляющий строку JSON `"incr"` в экземпляр, который ожидает событие с именем **operation**:

```http
POST /admin/extensions/DurableTaskExtension/instances/bcf6fb5067b046fbb021b52ba7deae5a/raiseEvent/operation?taskHub=DurableFunctionsHub&connection=Storage&code=XXX
Content-Type: application/json
Content-Length: 6

"incr"
```

Ответы этого API не содержат какого-либо содержимого.

## <a name="terminate-instance"></a>Завершение экземпляра

Завершите выполнение экземпляра оркестрации.

### <a name="request"></a>Запрос

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
POST /admin/extensions/DurableTaskExtension/instances/{instanceId}/terminate
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &reason={text}
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
POST /runtime/webhooks/durabletask/instances/{instanceId}/terminate
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &reason={text}
```

Параметры запроса для этого API включают набор по умолчанию, упомянутый ранее, а также следующий уникальный параметр.

| Поле             | Тип параметра  | Описание |
|-------------------|-----------------|-------------|
| **`instanceId`**  | URL-адрес             | Идентификатор экземпляра оркестрации. |
| **`reason`**      | Строка запроса    | Необязательный элемент. Причина завершения работы экземпляра оркестрации. |

### <a name="response"></a>Ответ

Может быть возвращено несколько кодов состояния.

* **HTTP 202 (Accepted)** (HTTP 202 (принято)). Запрос на завершение принят для обработки.
* **HTTP 404 (Not Found)** (HTTP 404 (не найдено)). Указанный экземпляр не найден.
* **HTTP 410 (Gone)** (HTTP 410 (потеряно)). Определенный экземпляр выполнен успешно или завершился со сбоем.

Ниже приведен пример запроса, который завершает выполнение экземпляра и указывает причину **ошибки**:

```
POST /admin/extensions/DurableTaskExtension/instances/bcf6fb5067b046fbb021b52ba7deae5a/terminate?reason=buggy&taskHub=DurableFunctionsHub&connection=Storage&code=XXX
```

Ответы этого API не содержат какого-либо содержимого.

## <a name="rewind-instance-preview"></a>Экземпляр перемотки (предварительная версия)

Восстанавливает сбойный экземпляр оркестрации в рабочем состоянии путем воспроизведения последних неудачных операций.

### <a name="request"></a>Запрос

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
POST /admin/extensions/DurableTaskExtension/instances/{instanceId}/rewind
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &reason={text}
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
POST /runtime/webhooks/durabletask/instances/{instanceId}/rewind
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &reason={text}
```

Параметры запроса для этого API включают набор по умолчанию, упомянутый ранее, а также следующий уникальный параметр.

| Поле             | Тип параметра  | Описание |
|-------------------|-----------------|-------------|
| **`instanceId`**  | URL-адрес             | Идентификатор экземпляра оркестрации. |
| **`reason`**      | Строка запроса    | Необязательный элемент. Причина перемотки экземпляра оркестрации. |

### <a name="response"></a>Ответ

Может быть возвращено несколько кодов состояния.

* **HTTP 202 (принято)** . Запрос на перемотку принят для обработки.
* **HTTP 404 (Not Found)** (HTTP 404 (не найдено)). Указанный экземпляр не найден.
* **HTTP 410 (потеряно)** . Определенный экземпляр выполнен успешно или был прерван.

Ниже приведен пример запроса, который перематывает сбойный экземпляр и указывает причину **исправления**:

```http
POST /admin/extensions/DurableTaskExtension/instances/bcf6fb5067b046fbb021b52ba7deae5a/rewind?reason=fixed&taskHub=DurableFunctionsHub&connection=Storage&code=XXX
```

Ответы этого API не содержат какого-либо содержимого.

## <a name="signal-entity"></a>Signal entity

Sends a one-way operation message to a [Durable Entity](durable-functions-types-features-overview.md#entity-functions). If the entity doesn't exist, it will be created automatically.

> [!NOTE]
> Durable entities are available starting in Durable Functions 2.0.

### <a name="request"></a>Запрос

The HTTP request is formatted as follows (multiple lines are shown for clarity):

```http
POST /runtime/webhooks/durabletask/entities/{entityType}/{entityKey}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &op={operationName}
```

Параметры запроса для этого API включают набор по умолчанию, упомянутый ранее, а также следующие уникальные параметры:

| Поле             | Тип параметра  | Описание |
|-------------------|-----------------|-------------|
| **`entityType`**  | URL-адрес             | The type of the entity. |
| **`entityKey`**   | URL-адрес             | The unique name of the entity. |
| **`op`**          | Строка запроса    | Необязательный элемент. The name of the user-defined operation to invoke. |
| **`{content}`**   | Содержимое запроса | Полезные данные события в формате JSON. |

Here is an example request that sends a user-defined "Add" message to a `Counter` entity named `steps`. The content of the message is the value `5`. If the entity does not already exist, it will be created by this request:

```http
POST /runtime/webhooks/durabletask/entities/Counter/steps?op=Add
Content-Type: application/json

5
```

### <a name="response"></a>Ответ

This operation has several possible responses:

* **HTTP 202 (Accepted)** : The signal operation was accepted for asynchronous processing.
* **HTTP 400 (Bad request)** : The request content was not of type `application/json`, was not valid JSON, or had an invalid `entityKey` value.
* **HTTP 404 (Not Found)** : The specified `entityType` was not found.

A successful HTTP request does not contain any content in the response. A failed HTTP request may contain JSON-formatted error information in the response content.

## <a name="query-entity"></a>Query entity

Gets the state of the specified entity.

### <a name="request"></a>Запрос

The HTTP request is formatted as follows (multiple lines are shown for clarity):

```http
GET /runtime/webhooks/durabletask/entities/{entityType}/{entityKey}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
```

### <a name="response"></a>Ответ

This operation has two possible responses:

* **HTTP 200 (OK)** : The specified entity exists.
* **HTTP 404 (Not Found)** : The specified entity was not found.

A successful response contains the JSON-serialized state of the entity as its content.

### <a name="example"></a>Пример
The following example HTTP request gets the state of an existing `Counter` entity named `steps`:

```http
GET /runtime/webhooks/durabletask/entities/Counter/steps
```

If the `Counter` entity simply contained a number of steps saved in a `currentValue` field, the response content might look like the following (formatted for readability):

```json
{
    "currentValue": 5
}
```

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Learn how to use Application Insights to monitor your durable functions](durable-functions-diagnostics.md)