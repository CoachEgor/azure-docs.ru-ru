---
title: HTTP AБИ в прочных функциях - Функции Azure
description: Сведения о том, как внедрять API HTTP в расширении устойчивых функций для Функций Azure.
author: cgillum
ms.topic: conceptual
ms.date: 12/17/2019
ms.author: azfuncdf
ms.openlocfilehash: 4e4081ecca4714c713d105d363a83a4f96a0d3fc
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79278172"
---
# <a name="http-api-reference"></a>Справочник по API HTTP

Расширение Durable Functions предоставляет набор встроенных APИ HTTP, которые могут быть использованы [entities](durable-functions-types-features-overview.md#entity-functions)для выполнения задач управления на [оркестровке, сущностях](durable-functions-types-features-overview.md#orchestrator-functions)и [концентратах задач.](durable-functions-task-hubs.md) Эти HTTP-AIS — это веб-крючки расширения, которые авторизованы хостом Azure Functions, но обрабатываются непосредственно расширением durable Functions.

Все HTTP-aIS, реализованные расширением, требуют следующих параметров. Тип данных всех параметров — `string`.

| Параметр        | Тип параметра  | Описание |
|------------------|-----------------|-------------|
| **`taskHub`**    | Строка запроса    | Имя [центра задач](durable-functions-task-hubs.md). Если не указано, предполагается имя центра задач текущего приложения-функции. |
| **`connection`** | Строка запроса    | **Имя** строки подключения для учетной записи хранения. Если не указано, предполагается строка подключения по умолчанию для приложения-функции. |
| **`systemKey`**  | Строка запроса    | Ключ авторизации, необходимый для вызова API. |

`systemKey`— ключ авторизации, авторизуемый хостом Azure Functions. В частности, он предоставляет доступ к API расширения устойчивых задач и им можно управлять так же, как и [другими ключами авторизации](https://github.com/Azure/azure-webjobs-sdk-script/wiki/Key-management-API). Можно создавать URL-адреса, `taskHub`содержащие `connection`правильные значения строки, и `systemKey` зажимать `CreateCheckStatusResponse` значения `CreateHttpManagementPayload` строки, используя apIs `createHttpManagementPayload` [связывания клиента,](durable-functions-bindings.md#orchestration-client) такие как AI и AI в .NET, или AI `createCheckStatusResponse` и AI в JavaScript.

В следующих нескольких разделах рассматриваются определенные API HTTP, поддерживаемые расширением, и приведены примеры их использования.

## <a name="start-orchestration"></a>Начало оркестровки

Начинает выполнять новый экземпляр указанной функции оркестратора.

### <a name="request"></a>Запрос

Для версии 1.x времени выполнения функций запрос отформатирован следующим образом (для ясности отображаются несколько строк):

```http
POST /admin/extensions/DurableTaskExtension/orchestrators/{functionName}/{instanceId?}
     ?taskHub={taskHub}
     &connection={connectionName}
     &code={systemKey}
```

В версии 2.x времени выполнения функций формат URL имеет все те же параметры, но с несколько иной приставкой:

```http
POST /runtime/webhooks/durabletask/orchestrators/{functionName}/{instanceId?}
     ?taskHub={taskHub}
     &connection={connectionName}
     &code={systemKey}
```

Параметры запроса для этого API включают набор по умолчанию, упомянутый ранее, а также следующие уникальные параметры:

| Поле              | Тип параметра  | Описание |
|--------------------|-----------------|-------------|
| **`functionName`** | URL-адрес             | Название функции оркестратора для начала. |
| **`instanceId`**   | URL-адрес             | Необязательный параметр. Идентификатор экземпляра оркестрации. Если не указано, функция оркестратора начнется со случайного идентификатора экземпляра. |
| **`{content}`**    | Содержимое запроса | Необязательный параметр. Ввод функции оркестранта JSON. |

### <a name="response"></a>Ответ

Может быть возвращено несколько кодов состояния.

* **HTTP 202 (Принято)**: Указанная функция оркестратора была запланирована для запуска. Заголовок `Location` ответа содержит URL для опроса статуса оркестровки.
* **HTTP 400 (Плохой запрос)**: Указанная функция оркестратора не существует, указанный идентификатор экземпляра не действителен, или содержимое запроса не было действительным JSON.

Ниже приводится пример запроса, который запускает функцию оркестратора и включает полезную `RestartVMs` нагрузку объекта JSON:

```http
POST /runtime/webhooks/durabletask/orchestrators/RestartVMs?code=XXX
Content-Type: application/json
Content-Length: 83

{
    "resourceGroup": "myRG",
    "subscriptionId": "111deb5d-09df-4604-992e-a968345530a9"
}
```

Полезная нагрузка на ответ для случаев **HTTP 202** — это объект JSON со следующими полями:

| Поле                       | Описание                          |
|-----------------------------|--------------------------------------|
| **`id`**                    |Идентификатор экземпляра оркестрации. |
| **`statusQueryGetUri`**     |URL-адрес состояния экземпляра оркестрации. |
| **`sendEventPostUri`**      |URL-адрес вызова события экземпляра оркестрации. |
| **`terminatePostUri`**      |URL-адрес завершения экземпляра оркестрации. |
| **`purgeHistoryDeleteUri`** |URL-адрес "История очистки" экземпляра оркестровки. |
| **`rewindPostUri`**         |(предварительный просмотр) URL-адрес "перемотка назад" экземпляра оркестровки. |

Тип данных всех полей — `string`.

Вот пример полезной нагрузки ответа для `abc123` экземпляра оркестровки с идентификатором (отформатированным для читаемости):

```http
{
    "id": "abc123",
    "purgeHistoryDeleteUri": "http://localhost:7071/runtime/webhooks/durabletask/instances/abc123?code=XXX",
    "sendEventPostUri": "http://localhost:7071/runtime/webhooks/durabletask/instances/abc123/raiseEvent/{eventName}?code=XXX",
    "statusQueryGetUri": "http://localhost:7071/runtime/webhooks/durabletask/instances/abc123?code=XXX",
    "terminatePostUri": "http://localhost:7071/runtime/webhooks/durabletask/instances/abc123/terminate?reason={text}&code=XXX"
}
```

Ответ HTTP предназначен для совместимости с *шаблоном опроса потребителей.* Он также включает в себя следующие заметные заголовки ответов:

* **Расположение**: URL конечной точки статуса. Этот URL-адрес содержит `statusQueryGetUri` то же значение, что и поле.
* **Повторная попытка-После**: количество секунд, чтобы ждать между операциями опроса. Значение по умолчанию — `10`.

Для получения дополнительной информации об асинхронном шаблоне опроса HTTP см. [HTTP async operation tracking](durable-functions-http-features.md#async-operation-tracking)

## <a name="get-instance-status"></a>Получение состояния экземпляра

Возвращает состояние определенного экземпляра оркестрации.

### <a name="request"></a>Запрос

Для версии 1.x времени выполнения функций запрос отформатирован следующим образом (для ясности отображаются несколько строк):

```http
GET /admin/extensions/DurableTaskExtension/instances/{instanceId}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &showHistory=[true|false]
    &showHistoryOutput=[true|false]
    &showInput=[true|false]
```

В версии 2.x времени выполнения функций формат URL имеет все те же параметры, но с несколько иной приставкой:

```http
GET /runtime/webhooks/durabletask/instances/{instanceId}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &showHistory=[true|false]
    &showHistoryOutput=[true|false]
    &showInput=[true|false]
```

Параметры запроса для этого API включают набор по умолчанию, упомянутый ранее, а также следующие уникальные параметры:

| Поле                   | Тип параметра  | Описание |
|-------------------------|-----------------|-------------|
| **`instanceId`**        | URL-адрес             | Идентификатор экземпляра оркестрации. |
| **`showInput`**         | Строка запроса    | Необязательный параметр. При установке `false`на, ввод функции не будет включен в полезную нагрузку ответа.|
| **`showHistory`**       | Строка запроса    | Необязательный параметр. Если задано значение `true`, журнал выполнения оркестрации будет включен в полезные данные ответа.|
| **`showHistoryOutput`** | Строка запроса    | Необязательный параметр. При установке `true`на , выходы функции будут включены в историю выполнения оркестровки.|
| **`createdTimeFrom`**   | Строка запроса    | Необязательный параметр. При указании фильтрует список возвращенных экземпляров, созданных на или после данной метки времени ISO8601.|
| **`createdTimeTo`**     | Строка запроса    | Необязательный параметр. При указании фильтрует список возвращенных экземпляров, которые были созданы на или до данной метки времени ISO8601.|
| **`runtimeStatus`**     | Строка запроса    | Необязательный параметр. При указании он фильтрует список возвращаемого значения экземпляров на основе их состояния среды выполнения. Чтобы увидеть список возможных значений состояния [Querying instances](durable-functions-instance-management.md) времени выполнения, см. |

### <a name="response"></a>Ответ

Может быть возвращено несколько кодов состояния.

* **HTTP 200 (ОК)** (HTTP 200 (ОК)). Указанный экземпляр находится в завершенном состоянии.
* **HTTP 202 (Accepted)** (HTTP 202 (принято)). Указанный экземпляр выполняется.
* **HTTP 400 (Bad Request)** (HTTP 400 (неверный запрос)). На определенном экземпляре произошел сбой, или его работа была прервана.
* **HTTP 404 (Not Found)** (HTTP 404 (не найдено)). Указанный экземпляр не существует или не был запущен.
* **HTTP 500 (внутренняя ошибка сервера)**: сбой указанного экземпляра с необработанным исключением.

Полезные данные ответа для случаев **HTTP 200** и **HTTP 202** являются объектами JSON со следующими полями:

| Поле                 | Тип данных | Описание |
|-----------------------|-----------|-------------|
| **`runtimeStatus`**   | строка    | Состояние среды выполнения экземпляра. Возможные значения: *Running*, *Pending*, *Failed*, *Canceled*, *Terminated*, *Completed*. |
| **`input`**           | JSON      | Данные JSON, используемые для инициализации экземпляра. Это поле имеет значение `null`, если для параметра строки запроса `showInput` задано значение `false`.|
| **`customStatus`**    | JSON      | Данные JSON, используемые для состояния пользовательской оркестрации. Если поле не заполнено, для него устанавливается значение `null`. |
| **`output`**          | JSON      | Выходные данные JSON экземпляра. Это поле имеет значение `null`, если экземпляр не находится в завершенном состоянии. |
| **`createdTime`**     | строка    | Время, когда был создан экземпляр. Использует расширенную нотацию ISO 8601. |
| **`lastUpdatedTime`** | строка    | Время, когда экземпляр был в последний раз сохранен. Использует расширенную нотацию ISO 8601. |
| **`historyEvents`**   | JSON      | Массив JSON, содержащий журнал выполнения оркестрации. Это поле имеет значение `null`, если для параметра строки запроса `showHistory` не задано значение `true`. |

Ниже приведен пример полезных данных ответа, включающий журнал выполнения оркестрации и выходные данные действия (в удобном для чтения формате).

```json
{
  "createdTime": "2018-02-28T05:18:49Z",
  "historyEvents": [
      {
          "EventType": "ExecutionStarted",
          "FunctionName": "E1_HelloSequence",
          "Timestamp": "2018-02-28T05:18:49.3452372Z"
      },
      {
          "EventType": "TaskCompleted",
          "FunctionName": "E1_SayHello",
          "Result": "Hello Tokyo!",
          "ScheduledTime": "2018-02-28T05:18:51.3939873Z",
          "Timestamp": "2018-02-28T05:18:52.2895622Z"
      },
      {
          "EventType": "TaskCompleted",
          "FunctionName": "E1_SayHello",
          "Result": "Hello Seattle!",
          "ScheduledTime": "2018-02-28T05:18:52.8755705Z",
          "Timestamp": "2018-02-28T05:18:53.1765771Z"
      },
      {
          "EventType": "TaskCompleted",
          "FunctionName": "E1_SayHello",
          "Result": "Hello London!",
          "ScheduledTime": "2018-02-28T05:18:53.5170791Z",
          "Timestamp": "2018-02-28T05:18:53.891081Z"
      },
      {
          "EventType": "ExecutionCompleted",
          "OrchestrationStatus": "Completed",
          "Result": [
              "Hello Tokyo!",
              "Hello Seattle!",
              "Hello London!"
          ],
          "Timestamp": "2018-02-28T05:18:54.3660895Z"
      }
  ],
  "input": null,
  "customStatus": { "nextActions": ["A", "B", "C"], "foo": 2 },
  "lastUpdatedTime": "2018-02-28T05:18:54Z",
  "output": [
      "Hello Tokyo!",
      "Hello Seattle!",
      "Hello London!"
  ],
  "runtimeStatus": "Completed"
}
```

Ответ **HTTP 202** также включает заголовок ответа **Location**, который ссылается на тот же URL-адрес, что и поле `statusQueryGetUri`, упомянутое ранее.

## <a name="get-all-instances-status"></a>Получение состояния всех экземпляров

Вы также можете запросить статус всех экземпляров, удалив `instanceId` запрос «Получить статус экземпляра». В этом случае основные параметры совпадают со статусом «Получить экземпляр». Параметры строки запроса для фильтрации также поддерживаются.

Следует помнить, что `connection` и `code` являются дополнительными. Если у вас есть анонимный `code` auth на функцию, то не требуется.
Если вы не хотите использовать другую строку подключения к хранилищу, кроме определенной в настройках приложения AzureWebWebJobsStorage, то можно безопасно игнорировать параметр строки запроса подключения.

### <a name="request"></a>Запрос

Для версии 1.x времени выполнения функций запрос отформатирован следующим образом (для ясности отображаются несколько строк):

```http
GET /admin/extensions/DurableTaskExtension/instances
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &createdTimeFrom={timestamp}
    &createdTimeTo={timestamp}
    &runtimeStatus={runtimeStatus1,runtimeStatus2,...}
    &showInput=[true|false]
    &top={integer}
```

В версии 2.x времени выполнения функций формат URL имеет все те же параметры, но с несколько иной приставкой:

```http
GET /runtime/webhooks/durableTask/instances?
    taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &createdTimeFrom={timestamp}
    &createdTimeTo={timestamp}
    &runtimeStatus={runtimeStatus1,runtimeStatus2,...}
    &showInput=[true|false]
    &top={integer}
```

Параметры запроса для этого API включают набор по умолчанию, упомянутый ранее, а также следующие уникальные параметры:

| Поле                   | Тип параметра  | Описание |
|-------------------------|-----------------|-------------|
| **`instanceId`**        | URL-адрес             | Идентификатор экземпляра оркестрации. |
| **`showInput`**         | Строка запроса    | Необязательный параметр. При установке `false`на, ввод функции не будет включен в полезную нагрузку ответа.|
| **`showHistory`**       | Строка запроса    | Необязательный параметр. Если задано значение `true`, журнал выполнения оркестрации будет включен в полезные данные ответа.|
| **`showHistoryOutput`** | Строка запроса    | Необязательный параметр. При установке `true`на , выходы функции будут включены в историю выполнения оркестровки.|
| **`createdTimeFrom`**   | Строка запроса    | Необязательный параметр. При указании фильтрует список возвращенных экземпляров, созданных на или после данной метки времени ISO8601.|
| **`createdTimeTo`**     | Строка запроса    | Необязательный параметр. При указании фильтрует список возвращенных экземпляров, которые были созданы на или до данной метки времени ISO8601.|
| **`runtimeStatus`**     | Строка запроса    | Необязательный параметр. При указании он фильтрует список возвращаемого значения экземпляров на основе их состояния среды выполнения. Чтобы увидеть список возможных значений состояния [Querying instances](durable-functions-instance-management.md) времени выполнения, см. |
| **`top`**               | Строка запроса    | Необязательный параметр. При указании ограничивает количество экземпляров, возвращенных запросом. |

### <a name="response"></a>Ответ

Вот пример полезных данных ответа, включая состояние оркестрации (в удобном для чтения формате):

```json
[
    {
        "instanceId": "7af46ff000564c65aafbfe99d07c32a5",
        "runtimeStatus": "Completed",
        "input": null,
        "customStatus": null,
        "output": [
            "Hello Tokyo!",
            "Hello Seattle!",
            "Hello London!"
        ],
        "createdTime": "2018-06-04T10:46:39Z",
        "lastUpdatedTime": "2018-06-04T10:46:47Z"
    },
    {
        "instanceId": "80eb7dd5c22f4eeba9f42b062794321e",
        "runtimeStatus": "Running",
        "input": null,
        "customStatus": null,
        "output": null,
        "createdTime": "2018-06-04T15:18:28Z",
        "lastUpdatedTime": "2018-06-04T15:18:38Z"
    },
    {
        "instanceId": "9124518926db408ab8dfe84822aba2b1",
        "runtimeStatus": "Completed",
        "input": null,
        "customStatus": null,
        "output": [
            "Hello Tokyo!",
            "Hello Seattle!",
            "Hello London!"
        ],
        "createdTime": "2018-06-04T10:46:54Z",
        "lastUpdatedTime": "2018-06-04T10:47:03Z"
    },
    {
        "instanceId": "d100b90b903c4009ba1a90868331b11b",
        "runtimeStatus": "Pending",
        "input": null,
        "customStatus": null,
        "output": null,
        "createdTime": "2018-06-04T15:18:39Z",
        "lastUpdatedTime": "2018-06-04T15:18:39Z"
    }
]
```

> [!NOTE]
> Эта операция может быть весьма затратной с точки зрения операций ввода-вывода службы хранилища Azure, если в таблице экземпляров много строк. Дополнительные сведения о таблице экземпляров см. в документации по [производительности и масштабируемости в устойчивых функциях (Функциях Azure)](durable-functions-perf-and-scale.md#instances-table).
>

При наличии дополнительных результатов в заголовке ответа возвращается маркер продолжения.  Имя заголовка — `x-ms-continuation-token`.

Если в следующем заголовке запроса значение маркера продолжения будет установлено, можно получить следующую страницу результатов. Это имя заголовка запроса `x-ms-continuation-token`также.

## <a name="purge-single-instance-history"></a>Очистка истории одного экземпляра

Удаляет историю и связанные с ней артефакты для указанного экземпляра оркестровки.

### <a name="request"></a>Запрос

Для версии 1.x времени выполнения функций запрос отформатирован следующим образом (для ясности отображаются несколько строк):

```http
DELETE /admin/extensions/DurableTaskExtension/instances/{instanceId}
    ?taskHub={taskHub}
    &connection={connection}
    &code={systemKey}
```

В версии 2.x времени выполнения функций формат URL имеет все те же параметры, но с несколько иной приставкой:

```http
DELETE /runtime/webhooks/durabletask/instances/{instanceId}
    ?taskHub={taskHub}
    &connection={connection}
    &code={systemKey}
```

Параметры запроса для этого API включают набор по умолчанию, упомянутый ранее, а также следующие уникальные параметры:

| Поле             | Тип параметра  | Описание |
|-------------------|-----------------|-------------|
| **`instanceId`**  | URL-адрес             | Идентификатор экземпляра оркестрации. |

### <a name="response"></a>Ответ

Следующие значения кода статуса HTTP могут быть возвращены.

* **HTTP 200 (OK)**: История экземпляра была успешно очищена.
* **HTTP 404 (не найдено)**: Указанный экземпляр не существует.

Полезная нагрузка отклика для случая **HTTP 200** — объект JSON со следующим полем:

| Поле                  | Тип данных | Описание |
|------------------------|-----------|-------------|
| **`instancesDeleted`** | Целое число   | Количество исключенных экземпляров. Для единственного экземпляра это значение `1`всегда должно быть . |

Ниже приведен пример полезных данных ответа (в формате, удобном для чтения):

```json
{
    "instancesDeleted": 1
}
```

## <a name="purge-multiple-instance-histories"></a>Очистка нескольких историй экземпляров

Можно также удалить историю и связанные с ней артефакты `{instanceId}` для нескольких экземпляров в концентраторе задач, удалив запрос «Очистка отдельной истории экземпляра». Для выборочной очистки истории экземпляров используйте те же фильтры, описанные в запросе «Получить все статусы экземпляров».

### <a name="request"></a>Запрос

Для версии 1.x времени выполнения функций запрос отформатирован следующим образом (для ясности отображаются несколько строк):

```http
DELETE /admin/extensions/DurableTaskExtension/instances
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &createdTimeFrom={timestamp}
    &createdTimeTo={timestamp}
    &runtimeStatus={runtimeStatus1,runtimeStatus2,...}
```

В версии 2.x времени выполнения функций формат URL имеет все те же параметры, но с несколько иной приставкой:

```http
DELETE /runtime/webhooks/durabletask/instances
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &createdTimeFrom={timestamp}
    &createdTimeTo={timestamp}
    &runtimeStatus={runtimeStatus1,runtimeStatus2,...}
```

Параметры запроса для этого API включают набор по умолчанию, упомянутый ранее, а также следующие уникальные параметры:

| Поле                 | Тип параметра  | Описание |
|-----------------------|-----------------|-------------|
| **`createdTimeFrom`** | Строка запроса    | Фильтрует список удаленных экземпляров, созданных на или после данной метки времени ISO8601.|
| **`createdTimeTo`**   | Строка запроса    | Необязательный параметр. При указании фильтрует список удаленных экземпляров, созданных на или до данной метки времени ISO8601.|
| **`runtimeStatus`**   | Строка запроса    | Необязательный параметр. При указании фильтрует список удаленных экземпляров в зависимости от состояния времени выполнения. Чтобы увидеть список возможных значений состояния [Querying instances](durable-functions-instance-management.md) времени выполнения, см. |

> [!NOTE]
> Эта операция может быть очень дорогостоящей с точки зрения ввоза/вывода Azure Storage I/O, если в таблицах Instances and/or History много строк. Более подробную информацию об этих таблицах можно найти в документации [«Производительность и масштабирование» в документации «Прочная функции» (Azure Functions).](durable-functions-perf-and-scale.md#instances-table)

### <a name="response"></a>Ответ

Следующие значения кода статуса HTTP могут быть возвращены.

* **HTTP 200 (OK)**: История экземпляра была успешно очищена.
* **HTTP 404 (не найдено)**: Не было найдено экземпляров, которые соответствовали бы выражению фильтра.

Полезная нагрузка отклика для случая **HTTP 200** — объект JSON со следующим полем:

| Поле                   | Тип данных | Описание |
|-------------------------|-----------|-------------|
| **`instancesDeleted`**  | Целое число   | Количество исключенных экземпляров. |

Ниже приведен пример полезных данных ответа (в формате, удобном для чтения):

```json
{
    "instancesDeleted": 250
}
```

## <a name="raise-event"></a>Вызов события

Отправляет сообщение уведомления о событии в выполняющийся экземпляр оркестрации.

### <a name="request"></a>Запрос

Для версии 1.x времени выполнения функций запрос отформатирован следующим образом (для ясности отображаются несколько строк):

```http
POST /admin/extensions/DurableTaskExtension/instances/{instanceId}/raiseEvent/{eventName}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
```

В версии 2.x времени выполнения функций формат URL имеет все те же параметры, но с несколько иной приставкой:

```http
POST /runtime/webhooks/durabletask/instances/{instanceId}/raiseEvent/{eventName}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
```

Параметры запроса для этого API включают набор по умолчанию, упомянутый ранее, а также следующие уникальные параметры:

| Поле             | Тип параметра  | Описание |
|-------------------|-----------------|-------------|
| **`instanceId`**  | URL-адрес             | Идентификатор экземпляра оркестрации. |
| **`eventName`**   | URL-адрес             | Имя события, которое ожидает целевой экземпляр оркестрации. |
| **`{content}`**   | Содержимое запроса | Полезные данные события в формате JSON. |

### <a name="response"></a>Ответ

Может быть возвращено несколько кодов состояния.

* **HTTP 202 (Accepted)** (HTTP 202 (принято)). Вызванное событие принято в обработку.
* **HTTP 400 (Bad request)** (HTTP 400 (неверный запрос)). Содержимое запроса не принадлежит к допустимому типу `application/json` или не является допустимым файлом JSON.
* **HTTP 404 (Not Found)** (HTTP 404 (не найдено)). Указанный экземпляр не найден.
* **HTTP 410 (Gone)** (HTTP 410 (потеряно)). Указанный экземпляр выполнен или завершился с ошибкой и не может обрабатывать возникающие события.

Ниже приведен пример запроса, отправляющий строку JSON `"incr"` в экземпляр, который ожидает событие с именем **operation**:

```http
POST /admin/extensions/DurableTaskExtension/instances/bcf6fb5067b046fbb021b52ba7deae5a/raiseEvent/operation?taskHub=DurableFunctionsHub&connection=Storage&code=XXX
Content-Type: application/json
Content-Length: 6

"incr"
```

Ответы этого API не содержат какого-либо содержимого.

## <a name="terminate-instance"></a>Завершение экземпляра

Завершите выполнение экземпляра оркестрации.

### <a name="request"></a>Запрос

Для версии 1.x времени выполнения функций запрос отформатирован следующим образом (для ясности отображаются несколько строк):

```http
POST /admin/extensions/DurableTaskExtension/instances/{instanceId}/terminate
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &reason={text}
```

В версии 2.x времени выполнения функций формат URL имеет все те же параметры, но с несколько иной приставкой:

```http
POST /runtime/webhooks/durabletask/instances/{instanceId}/terminate
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &reason={text}
```

Параметры запроса для этого API включают набор по умолчанию, упомянутый ранее, а также следующий уникальный параметр.

| Поле             | Тип параметра  | Описание |
|-------------------|-----------------|-------------|
| **`instanceId`**  | URL-адрес             | Идентификатор экземпляра оркестрации. |
| **`reason`**      | Строка запроса    | Необязательный параметр. Причина завершения работы экземпляра оркестрации. |

### <a name="response"></a>Ответ

Может быть возвращено несколько кодов состояния.

* **HTTP 202 (Accepted)** (HTTP 202 (принято)). Запрос на завершение принят для обработки.
* **HTTP 404 (Not Found)** (HTTP 404 (не найдено)). Указанный экземпляр не найден.
* **HTTP 410 (Gone)** (HTTP 410 (потеряно)). Определенный экземпляр выполнен успешно или завершился со сбоем.

Ниже приведен пример запроса, который завершает выполнение экземпляра и указывает причину **ошибки**:

```
POST /admin/extensions/DurableTaskExtension/instances/bcf6fb5067b046fbb021b52ba7deae5a/terminate?reason=buggy&taskHub=DurableFunctionsHub&connection=Storage&code=XXX
```

Ответы этого API не содержат какого-либо содержимого.

## <a name="rewind-instance-preview"></a>Экземпляр перемотки (предварительная версия)

Восстанавливает сбойный экземпляр оркестрации в рабочем состоянии путем воспроизведения последних неудачных операций.

### <a name="request"></a>Запрос

Для версии 1.x времени выполнения функций запрос отформатирован следующим образом (для ясности отображаются несколько строк):

```http
POST /admin/extensions/DurableTaskExtension/instances/{instanceId}/rewind
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &reason={text}
```

В версии 2.x времени выполнения функций формат URL имеет все те же параметры, но с несколько иной приставкой:

```http
POST /runtime/webhooks/durabletask/instances/{instanceId}/rewind
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &reason={text}
```

Параметры запроса для этого API включают набор по умолчанию, упомянутый ранее, а также следующий уникальный параметр.

| Поле             | Тип параметра  | Описание |
|-------------------|-----------------|-------------|
| **`instanceId`**  | URL-адрес             | Идентификатор экземпляра оркестрации. |
| **`reason`**      | Строка запроса    | Необязательный параметр. Причина перемотки экземпляра оркестрации. |

### <a name="response"></a>Ответ

Может быть возвращено несколько кодов состояния.

* **HTTP 202 (принято)**. Запрос на перемотку принят для обработки.
* **HTTP 404 (Not Found)** (HTTP 404 (не найдено)). Указанный экземпляр не найден.
* **HTTP 410 (потеряно)**. Определенный экземпляр выполнен успешно или был прерван.

Ниже приведен пример запроса, который перематывает сбойный экземпляр и указывает причину **исправления**:

```http
POST /admin/extensions/DurableTaskExtension/instances/bcf6fb5067b046fbb021b52ba7deae5a/rewind?reason=fixed&taskHub=DurableFunctionsHub&connection=Storage&code=XXX
```

Ответы этого API не содержат какого-либо содержимого.

## <a name="signal-entity"></a>Сущность сигнала

Отправляет сообщение операции в одну сторону [в долговременное сообщение entity.](durable-functions-types-features-overview.md#entity-functions) Если сущность не существует, она будет создана автоматически.

> [!NOTE]
> Долгосрочные сущности доступны начиная с функций durable 2.0.

### <a name="request"></a>Запрос

Запрос HTTP отформатирован следующим образом (для ясности отображаются несколько строк):

```http
POST /runtime/webhooks/durabletask/entities/{entityName}/{entityKey}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &op={operationName}
```

Параметры запроса для этого API включают набор по умолчанию, упомянутый ранее, а также следующие уникальные параметры:

| Поле             | Тип параметра  | Описание |
|-------------------|-----------------|-------------|
| **`entityName`**  | URL-адрес             | Имя (тип) сущности. |
| **`entityKey`**   | URL-адрес             | Ключ (уникальный идентификатор) сущности. |
| **`op`**          | Строка запроса    | Необязательный параметр. Имя операции, определяемой пользователем, чтобы вызвать. |
| **`{content}`**   | Содержимое запроса | Полезные данные события в формате JSON. |

Вот пример запроса, который отправляет определенное пользователем `Counter` сообщение `steps`"Добавить" объекту с именем. Содержание сообщения является значением `5`. Если сущность еще не существует, она будет создана по этому запросу:

```http
POST /runtime/webhooks/durabletask/entities/Counter/steps?op=Add
Content-Type: application/json

5
```

> [!NOTE]
> По умолчанию с [объектами, основанными на классах в .NET,](durable-functions-dotnet-entities.md#defining-entity-classes)указание `op` значения `delete` будет удалено состояние объекта. Однако если сущность `delete`определяет имя операции, то вместо этого будет вызвана операция с определенным пользователем.

### <a name="response"></a>Ответ

Эта операция имеет несколько возможных ответов:

* **HTTP 202 (Принято)**: Операция сигнала была принята для асинхронной обработки.
* **HTTP 400 (Плохой запрос)**: Содержимое запроса не было типа, `application/json` `entityKey` не было действительным JSON, или имело недействительное значение.
* **HTTP 404 (не найдено)**: Указанный `entityName` не найден.

Успешный запрос HTTP не содержит содержимого в ответе. Неудавшийся запрос HTTP может содержать информацию об ошибках, отстекаемых JSON, в содержимом ответа.

## <a name="get-entity"></a>Получить сущность

Получает состояние указанного объекта.

### <a name="request"></a>Запрос

Запрос HTTP отформатирован следующим образом (для ясности отображаются несколько строк):

```http
GET /runtime/webhooks/durabletask/entities/{entityName}/{entityKey}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
```

### <a name="response"></a>Ответ

Эта операция имеет два возможных ответа:

* **HTTP 200 (OK)**: Указанная сущность существует.
* **HTTP 404 (не найдено)**: Указанная сущность не найдена.

Успешный ответ содержит JSON-серийное состояние сущности в качестве его содержимого.

### <a name="example"></a>Пример
В следующем примере запрос HTTP `Counter` получает `steps`состояние существующей сущности под названием:

```http
GET /runtime/webhooks/durabletask/entities/Counter/steps
```

Если `Counter` объект просто содержал ряд шагов, `currentValue` сохраненных в поле, содержимое ответа может выглядеть следующим (отформатировано для читаемости):

```json
{
    "currentValue": 5
}
```

## <a name="list-entities"></a>Отображение сущностей

Вы можете запросить несколько сущностей по имени сущности или к последней дате операции.

### <a name="request"></a>Запрос

Запрос HTTP отформатирован следующим образом (для ясности отображаются несколько строк):

```http
GET /runtime/webhooks/durabletask/entities/{entityName}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &lastOperationTimeFrom={timestamp}
    &lastOperationTimeTo={timestamp}
    &fetchState=[true|false]
    &top={integer}
```

Параметры запроса для этого API включают набор по умолчанию, упомянутый ранее, а также следующие уникальные параметры:

| Поле                       | Тип параметра  | Описание |
|-----------------------------|-----------------|-------------|
| **`entityName`**            | URL-адрес             | Необязательный параметр. При указании фильтрует список возвращенных сущностей по имени сущности (нечувствительным к делу). |
| **`fetchState`**            | Строка запроса    | Необязательный параметр. При установке `true`на, состояние сущности будет включено в полезную нагрузку ответа. |
| **`lastOperationTimeFrom`** | Строка запроса    | Необязательный параметр. При указании фильтрует список возвращенных сущностей, обрабатывающих операции после данной метки времени ISO8601. |
| **`lastOperationTimeTo`**   | Строка запроса    | Необязательный параметр. При указании фильтрует список возвращенных сущностей, которые обрабатывали операции до данной метки времени ISO8601. |
| **`top`**                   | Строка запроса    | Необязательный параметр. При указании ограничено количество объектов, возвращенных запросом. |


### <a name="response"></a>Ответ

Успешный ответ HTTP 200 содержит jSON-серийный массив сущностей и, по желанию, состояние каждой сущности.

По умолчанию операция возвращает первые 100 сущностей, которые соответствуют критериям запроса. Вызывающее может указать значение `top` параметра строки запроса для возврата другого максимального количества результатов. Если больше результатов существует за пределами того, что возвращается, токен продолжения также возвращается в заголовке ответа. Имя заголовка — `x-ms-continuation-token`.

Если в следующем заголовке запроса значение маркера продолжения будет установлено, можно получить следующую страницу результатов. Это имя заголовка запроса `x-ms-continuation-token`также.

### <a name="example---list-all-entities"></a>Пример - перечислите все сущности

В следующем примере запрос HTTP перечисляет все объекты в концентраторе задач:

```http
GET /runtime/webhooks/durabletask/entities
```

Ответ JSON может выглядеть следующим (отформатированным для читаемости):

```json
[
    {
        "entityId": { "key": "cats", "name": "counter" },
        "lastOperationTime": "2019-12-18T21:45:44.6326361Z",
    },
    {
        "entityId": { "key": "dogs", "name": "counter" },
        "lastOperationTime": "2019-12-18T21:46:01.9477382Z"
    },
    {
        "entityId": { "key": "mice", "name": "counter" },
        "lastOperationTime": "2019-12-18T21:46:15.4626159Z"
    },
    {
        "entityId": { "key": "radio", "name": "device" },
        "lastOperationTime": "2019-12-18T21:46:18.2616154Z"
    },
]
```

### <a name="example---filtering-the-list-of-entities"></a>Пример - фильтрация списка объектов

В следующем примере запрос HTTP перечисляет `counter` только первые два сущности типа, а также получает их состояние:

```http
GET /runtime/webhooks/durabletask/entities/counter?top=2&fetchState=true
```

Ответ JSON может выглядеть следующим (отформатированным для читаемости):

```json
[
    {
        "entityId": { "key": "cats", "name": "counter" },
        "lastOperationTime": "2019-12-18T21:45:44.6326361Z",
        "state": { "value": 9 }
    },
    {
        "entityId": { "key": "dogs", "name": "counter" },
        "lastOperationTime": "2019-12-18T21:46:01.9477382Z",
        "state": { "value": 10 }
    }
]
```

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Узнайте, как использовать Приложения Исследования для мониторинга ваших прочных функций](durable-functions-diagnostics.md)