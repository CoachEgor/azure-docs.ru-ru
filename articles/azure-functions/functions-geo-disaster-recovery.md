---
title: Azure Функции гео-аварийного восстановления и высокой доступности
description: Как использовать географические регионы для избыточности и сбоя в функциях Azure.
ms.assetid: 9058fb2f-8a93-4036-a921-97a0772f503c
ms.topic: conceptual
ms.date: 08/29/2019
ms.openlocfilehash: 481a716bd6ced5c304da41c70fdcfc687b76661d
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79080229"
---
# <a name="azure-functions-geo-disaster-recovery"></a>Восстановление геоаварии Azure Functions

Когда все регионы Azure или центры обработки данных испытывают простои, вычислениям крайне важно продолжить обработку в другом регионе.  В этой статье будут объяснимы некоторые стратегии, которые можно использовать для развертывания функций для обеспечения аварийного восстановления.

## <a name="basic-concepts"></a>Основные понятия

Функции Azure работают в определенном регионе.  Чтобы получить более высокую доступность, можно развернуть одни и те же функции в нескольких регионах.  Когда в нескольких регионах вы можете иметь свои функции работает в *активном / активном* шаблоне или *активной / пассивной* модели.  

* Шаблон "активный — активный". Оба региона активны и получают события (дублирующие или ротационные). Активный/активный рекомендуется для функций HTTPS в сочетании с Azure Front Door.
* Активный/пассивный. Один регион является активным и принимающим события, в то время как вторичный простаивает.  При сбою требуется, вторичный регион активируется и берет на себя обработку.  Это рекомендуется для не-HTTP функций, таких как сервисный автобус и события концентраты.

Узнайте, как [запускать приложения в нескольких регионах,](https://docs.microsoft.com/azure/architecture/reference-architectures/app-service-web-app/multi-region) чтобы узнать больше о многорегионеразвертываниях.

## <a name="activeactive-for-https-functions"></a>Активный/активный для функций HTTPS

Для достижения активного/активного развертывания функций требуется некоторый компонент, который может координировать события между обоими регионами.  Для функций HTTPS эта координация осуществляется с помощью [Azure Front Door.](../frontdoor/front-door-overview.md)  Передняя дверь Azure может направлять и круговоротные запросы HTTPS между несколькими региональными функциями.  Он также периодически проверяет работоспособность каждой конечной точки.  Если региональная функция перестанет реагировать на проверки работоспособности, Azure Front Door вынимет ее из вращения и перенаправляет трафик только на здоровые функции.  

![Архитектура для передней двери и функции Azure](media/functions-geo-dr/front-door.png)  

## <a name="activeactive-for-non-https-functions"></a>Активный/активный для функций, не относясь к HTTPS

Вы все еще можете достичь активных/активных развертываний для функций, не относясь к HTTPS.  Тем не менее, необходимо рассмотреть вопрос о том, как эти два региона будут взаимодействовать или координировать друг с другом.  Если вы развернете одно и то же приложение функции в двух регионах, каждый из которых срабатывает в одной и той же очереди Service Bus, они будут выступать в качестве конкурирующих потребителей при де-очереди.  Хотя это означает, что каждое сообщение обрабатывается только одним из экземпляров, это также означает, что в одном автобусе службы все еще есть одна точка сбоя.  Если развернуть две очереди Service Bus (одну в основном регионе, одну в вторичном регионе) и два приложения функции указали на их очередь в регионе, теперь возникает проблема в том, как сообщения очереди распределяются между двумя регионами.  Часто это означает, что каждый издатель пытается опубликовать сообщение в *обоих* регионах, и каждое сообщение обрабатывается обоими приложениями активных функций.  Хотя это создает активный/активный шаблон, он создает другие проблемы, связанные с дублированием вычислений, а также когда и как данные консолидируются.  По этим причинам рекомендуется использовать спуски active/passive шаблона, не являющаяся HTTPS.

## <a name="activepassive-for-non-https-functions"></a>Активный/пассивный для функций, не относясь к HTTPS

Активный/пассивный способ для обработки каждого сообщения только одной функции, но обеспечивает механизм для сбоя в вторичном регионе в случае аварии.  Функции Azure работают вместе с [геовосстановлениею Azure Service Bus](../service-bus-messaging/service-bus-geo-dr.md) и [геовосстановлениею концентратов событий Azure.](../event-hubs/event-hubs-geo-dr.md)

Используя триггеры Azure Event в качестве примера, активный/пассивный шаблон будет включать в себя следующее:

* Концентратор Azure Event, развернутый как в основной, так и в вторичном регионе.
* Геокатастрофа позволила спарить первичный и вторичный концентратор событий.  Это также создает "псевдоним", который можно использовать для подключения к концентратам событий и переключения с первичного на вторичный без изменения информации о подключении.
* Функциональные приложения, развернутые как в первичном, так и в вторичном регионе.
* Функциональные приложения срабатывают на *строке соединения прямого* (непсевдонимного) для соответствующего концентратора событий. 
* Издатели к центру событий должны публиковать строку подключения под псевдонимом. 

![Архитектура примеров активного действия](media/functions-geo-dr/active-passive.png)

Перед неудачей издатели, отправляя на общий псевдоним, направляются в основной концентратор событий.  Основное приложение функции слушает исключительно основной концентратор событий.  Приложение вторичной функции будет пассивным и простаивает.  Как только инициирован отказ, издатели, отправляя на общий псевдоним, теперь будут направляться к вторичному концентратору событий.  Приложение вторичной функции теперь станет активным и начнет срабатывать автоматически.  Эффективный сбой в вторичном регионе может быть полностью вытеснен из центра событий, при этом функции становятся активными только тогда, когда соответствующий концентратор событий активен.

Узнайте больше об информации и соображениях для сбоя с [сервисным автобусом](../service-bus-messaging/service-bus-geo-dr.md) и [центрами событий](../event-hubs/event-hubs-geo-dr.md).

## <a name="next-steps"></a>Дальнейшие действия

* [Создание передней двери Azure](../frontdoor/quickstart-create-front-door.md)
* [События концентраторы failover соображения](../event-hubs/event-hubs-geo-dr.md#considerations)
