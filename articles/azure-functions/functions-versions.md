---
title: Обзор версий среды выполнения для решения "Функции Azure"
description: Решение "Функции Azure" поддерживает разные версии среды выполнения. В этой статье приводятся различия между ними и рекомендации по выбору подходящей для вас версии.
ms.topic: conceptual
ms.date: 12/09/2019
ms.openlocfilehash: 21a7b25087efd5d4adf2154c935636c263df9afd
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79276560"
---
# <a name="azure-functions-runtime-versions-overview"></a>Обзор версий среды выполнения для решения "Функции Azure"

Основные версии времени выполнения функций Azure связаны с версией .NET, на которой основано время выполнения. В следующей таблице указаны текущая версия времени выполнения, уровень выпуска и связанная с ней версия .NET. 

| Версия среды выполнения | Уровень выпуска<sup>1</sup> | Версия .NET | 
| --------------- | ------------- | ------------ |
| 3.x | GA | .NET Core 3.1 | 
| 2.x | GA | .NET Core 2.2 |
| 1.x | GA<sup>2</sup> | Рамочный униза 4.NET 4.6<sup>3</sup> |

<sup>1</sup> релизы GA поддерживаются для сценариев производства.   
<sup>2</sup> Версия 1.x находится в режиме технического обслуживания. Улучшения предоставляются только в более поздних версиях.   
<sup>3</sup> поддерживает разработку только на портале Azure или локально на компьютерах Windows.

В этой статье подробно описаны некоторые различия между различными версиями, как можно создать каждую версию и как изменять версии.

## <a name="languages"></a>Языки

Начиная с версии 2.x, время выполнения использует модель расширяемости языка, и все функции в приложении функции должны иметь один и тот же язык. Язык функций в функциональном приложении выбирается при создании приложения и поддерживается в настройках [FUNCTIONS\_WORKER\_RUNTIME.](functions-app-settings.md#functions_worker_runtime) 

Экспериментальные языки Azure Functions 1.x не могут использовать новую модель, поэтому они не поддерживаются в 2.x. В следующей таблице перечислены языки программирования, которые в настоящее время поддерживаются для каждой версии среды выполнения.

[!INCLUDE [functions-supported-languages](../../includes/functions-supported-languages.md)]

Дополнительные сведения см. в [списке поддерживаемых языков](supported-languages.md).

## <a name="run-on-a-specific-version"></a><a name="creating-1x-apps"></a>Запуск по определенной версии

По умолчанию функциональные приложения, созданные на портале Azure и Azure CLI, настроены на версию 3.x. Вы можете изменить эту версию по мере необходимости. Вы можете изменить версию времени выполнения только до 1,x после создания приложения функции, но прежде чем добавить какие-либо функции.  Перемещение между 2.x и 3.x разрешено даже с приложениями, которые имеют функции, но это все еще рекомендуется для тестирования в новом приложении в первую очередь.

## <a name="migrating-from-1x-to-later-versions"></a>Миграция от 1.x до более поздних версий

Вы можете перенести существующее приложение, написанное для использования времени выполнения версии 1.x, чтобы вместо этого использовать более новую версию. Большинство изменений, которые необходимо внести, связаны с изменениями в времени выполнения языка, например, изменениями API между .NET Framework 4.7 и .NET Core. Также нужно убедиться, что код и библиотеки совместимы с выбранными языковыми средами выполнения. И наконец, обязательно обратите внимание на все изменения в триггерах, привязках и функциях, указанные ниже. Для достижения наилучших результатов миграции следует создать новое функциональное приложение в новой версии и портировать существующий код функции версии 1.x в новое приложение.  

В то время как можно сделать "на месте" обновление вручную обновление конфигурации приложения, переход от 1,x к более высокой версии включает в себя некоторые изменения нарушения. Например, в C,, отладка объект `TraceWriter` `ILogger`изменяется с . Создавая новую версию проекта 3.x, вы начинаете с обновленных функций, основанных на последней версии 3.x шаблонов.

### <a name="changes-in-triggers-and-bindings-after-version-1x"></a>Изменения в триггерах и привязках после версии 1.x

Начиная с версии 2.x, необходимо установить расширения для определенных триггеров и привязок, используемых функциями в приложении. Единственное исключение — триггеры HTTP и таймера, для которых не требуется расширение.  Для получения дополнительной информации ознакомьтесь с разделом [Регистрация расширений привязки](./functions-bindings-register.md).

Есть также несколько изменений в *function.json* или атрибуты функции между версиями. Например, свойство `path` для концентратора событий теперь имеет атрибут `eventHubName`. Для получения ссылок на документацию для каждой привязки см. [таблицу существующих привязок](#bindings).

### <a name="changes-in-features-and-functionality-after-version-1x"></a>Изменения в функциях и функциональности после версии 1.x

Несколько функций были удалены, обновлены или заменены после версии 1.x. В этом разделе подробно описаны изменения, которые вы видите в более поздних версиях после использования версии 1.x.

В версии 2.x внесены следующие изменения.

* Ключи для вызова конечных точек HTTP всегда хранятся в зашифрованном виде в хранилище BLOB-объектов Azure. В версии 1.x ключи хранились в хранилище Файлов Azure по умолчанию. При обновлении приложения с версии 1.x до версии 2.x выполняется сброс существующих секретных данных, которые находятся в хранилище файлов.

* Среда выполнения версии 2.x не имеет встроенной поддержки для поставщиков веб-перехватчиков. Это изменение внесено для повышения производительности. Вы по-прежнему можете использовать HTTP-триггеры как конечные точки для веб-перехватчиков.

* Файл конфигурации узла (host.json) должен быть пустым или содержать строку `"version": "2.0"`.

* Для улучшения мониторинга панель мониторинга WebJobs на [`AzureWebJobsDashboard`](functions-app-settings.md#azurewebjobsdashboard) портале, которая использовала настройки, [`APPINSIGHTS_INSTRUMENTATIONKEY`](functions-app-settings.md#appinsights_instrumentationkey) заменяется Azure Application Insights, которая использует настройки. Дополнительные сведения см. в разделе [Мониторинг функций Azure](functions-monitoring.md).

* Все функции в приложении-функции должны использовать один язык. При создании приложения-функции необходимо выбрать для приложения стек среды выполнения. Стек времени выполнения определяется значением [`FUNCTIONS_WORKER_RUNTIME`](functions-app-settings.md#functions_worker_runtime) в настройках приложения. Это требование добавлено для уменьшения занимаемого места и ускорения запуска. При локальной разработке также необходимо включить этот параметр в [файл local.settings.json](functions-run-local.md#local-settings-file).

* По умолчанию для функций в плане службы приложений устанавливается время ожидания 30 минут. Вы можете вручную снять это ограничение, изменив параметр [functionTimeout](functions-host-json.md#functiontimeout) в файле host.json.

* Параллельные дроссели http реализуются по умолчанию для функций плана потребления, с по умолчанию 100 одновременных запросов на экземпляр. Вы можете изменить [`maxConcurrentRequests`](functions-host-json.md#http) это в настройках в файле host.json.

* Из-за [ограничений .NET Core](https://github.com/Azure/azure-functions-host/issues/3414)поддержка функций скрипта F's (.fsx) была удалена. Скомпилированные функции F# (.fs) по-прежнему поддерживаются.

* Для веб-перехватчиков триггера сетки событий формат URL-адреса изменен на `https://{app}/runtime/webhooks/{triggerName}`.

## <a name="migrating-from-2x-to-3x"></a>Мигрирование от 2.x до 3.x

Версия 3.x Azure Functions очень обратная, совместимая с версией 2.x.  Многие приложения должны быть в состоянии безопасно обновить до 3,x без каких-либо изменений кода.  При переходе на 3.x рекомендуется, не забудьте запустить обширные тесты, прежде чем изменить основную версию в производственных приложениях.

### <a name="breaking-changes-between-2x-and-3x"></a>Нарушение изменений между 2.x и 3.x

Ниже приведены изменения, которые следует знать, прежде чем обновить 2.x приложение до 3.x.

#### <a name="javascript"></a>JavaScript

* Выходные привязки, назначенные через `context.done` или возврат `context.bindings`значения теперь ведут себя так же, как установка в .

* Таймер триггер объект верблюд Иск вместо PascalCase

* Функциями Event Hub `dataType` срабатывают `binary` функции `string`с двоичными, получится массив вместо .

* Полезная нагрузка запроса HTTP больше `context.bindingData.req`не может быть доступна через .  Он все еще может быть доступен `context.req`в `context.bindings`качестве параметра ввода, и в .

* Node.js 8 больше не поддерживается и не выполняется в 3.x функциях.

#### <a name="net"></a>.NET

* [Синхронные операции сервера отключены по умолчанию.](https://docs.microsoft.com/dotnet/core/compatibility/2.2-3.0#http-synchronous-io-disabled-in-all-servers)

### <a name="changing-version-of-apps-in-azure"></a>Изменение версии приложений в Azure

Версия времени выполнения функций, используемая опубликованными приложениями [`FUNCTIONS_EXTENSION_VERSION`](functions-app-settings.md#functions_extension_version) в Azure, продиктована настройками приложения. Поддерживаются следующие основные значения версии выполнения:

| Значение | Цель выполнения |
| ------ | -------- |
| `~3` | 3.x |
| `~2` | 2.x |
| `~1` | 1.x |

>[!IMPORTANT]
> Не изменяйте эту настройку произвольно, так как могут потребоваться изменения и изменения в ашего функциональном коде.

### <a name="locally-developed-application-versions"></a>Локально разработанные версии приложений

Вы можете сделать следующие обновления для функции приложений, чтобы локально изменить целевые версии.

#### <a name="visual-studio-runtime-versions"></a>Версии среды выполнения Visual Studio

В Visual Studio вы выбираете версию среды выполнения при создании проекта. Инструменты Azure Functions для Visual Studio поддерживают три основные версии времени выполнения. При отладке и публикации правильная версия применяется автоматически на основе настроек проекта. Параметры версии определяются в файле `.csproj` в следующих свойствах:

##### <a name="version-1x"></a>Версия 1.x

```xml
<TargetFramework>net461</TargetFramework>
<AzureFunctionsVersion>v1</AzureFunctionsVersion>
```

##### <a name="version-2x"></a>Версия 2.x

```xml
<TargetFramework>netcoreapp2.1</TargetFramework>
<AzureFunctionsVersion>v2</AzureFunctionsVersion>
```

##### <a name="version-3x"></a>Версия 3.x

```xml
<TargetFramework>netcoreapp3.1</TargetFramework>
<AzureFunctionsVersion>v3</AzureFunctionsVersion>
```

> [!NOTE]
> Azure Functions 3.x и `Microsoft.NET.Sdk.Functions` .NET требуют, чтобы расширение было по крайней мере. `3.0.0`

###### <a name="updating-2x-apps-to-3x-in-visual-studio"></a>Обновление приложений 2.x до 3.x в визуальной студии

Можно открыть существующую функцию, ориентированную на 2.x, и перейти к 3.x, редактируя `.csproj` файл и обновляя приведенные выше значения.  Visual Studio автоматически управляет версиями времени выполнения на основе метаданных проекта.  Тем не менее, это возможно, если вы никогда не создавали приложение 3.x до этого Visual Studio еще не имеют шаблонов и времени выполнения для 3.x на вашей машине.  Это может привести к ошибке типа "Нет функций времени выполнения, которое соответствует версии, указанной в проекте".  Чтобы получить последние шаблоны и время выполнения, пройдите через опыт, чтобы создать новый проект функции.  Когда вы доберетесь до версии и шаблона выберите экран, подождите, пока Visual Studio завершит поиск последних шаблонов.  После того, как последние шаблоны .NET Core 3 будут доступны и отображены, вы сможете запускать и отлаживать любой проект, настроенный для версии 3.x.

> [!IMPORTANT]
> Функции версии 3.x могут быть разработаны только в Visual Studio, если с помощью визуальной версии 16.4 или более новой.

#### <a name="vs-code-and-azure-functions-core-tools"></a>Основные инструменты VS Code и Функций Azure

[Основные инструменты службы функции Azure](functions-run-local.md) используются для разработки из командной строки, а также в [расширении Функций Azure](https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-azurefunctions) для Visual Studio Code. Чтобы разработать против версии 3.x, установите версию 3.x основных инструментов. Разработка версии 2.x требует версии 2.x основных инструментов и так далее. Дополнительные сведения см. в разделе [Установка основных инструментов Функций Azure](functions-run-local.md#install-the-azure-functions-core-tools).

Для разработки в Visual Studio Code следует также изменить параметры пользователя, чтобы `azureFunctions.projectRuntime` соответствовал версии установленных инструментов.  Этот параметр также обновляет шаблоны и языки, используемые при создании приложения-функции.  Для создания `~3` приложений в `azureFunctions.projectRuntime` вас `~3`будет обновляться настройка пользователя для .

![Настройка выполнения функций Azure](./media/functions-versions/vs-code-version-runtime.png)

#### <a name="maven-and-java-apps"></a>Приложения Maven и Java

Вы можете перенести Java-приложения из версии 2.x в 3.x, [установив версию 3.x основных инструментов, необходимых](functions-run-local.md#install-the-azure-functions-core-tools) для локального запуска.  После проверки правильного работы приложения в версии 3.x— `POM.xml` обновите `FUNCTIONS_EXTENSION_VERSION` файл `~3`приложения, чтобы изменить настройку до следующего примера:

```xml
<configuration>
    <resourceGroup>${functionResourceGroup}</resourceGroup>
    <appName>${functionAppName}</appName>
    <region>${functionAppRegion}</region>
    <appSettings>
        <property>
            <name>WEBSITE_RUN_FROM_PACKAGE</name>
            <value>1</value>
        </property>
        <property>
            <name>FUNCTIONS_EXTENSION_VERSION</name>
            <value>~3</value>
        </property>
    </appSettings>
</configuration>
```

## <a name="bindings"></a>Привязки

Начиная с версии 2.x, время выполнения использует новую [привязывающую модель расширяемости,](https://github.com/Azure/azure-webjobs-sdk-extensions/wiki/Binding-Extensions-Overview) которая предлагает следующие преимущества:

* Поддержка сторонних расширений привязок.

* Разделение среды выполнения и привязок. Это изменение позволяет отдельно управлять версиями расширений привязок и выпускать эти расширения. Например, можно выполнить обновление до версии расширения на основе более новой версии базового пакета SDK.

* Менее ресурсоемкая среда выполнения, где в среде выполнения известны только используемые привязки и только они загружаются в нее.

За исключением триггеров HTTP и таймера, все привязки теперь необходимо вручную добавлять в проект приложения-функции или регистрировать на портале. Для получения дополнительной информации ознакомьтесь с разделом [Регистрация расширений привязки](./functions-bindings-expressions-patterns.md).

В следующей таблице перечислены поддерживаемые привязки для каждой версии среды выполнения.

[!INCLUDE [Full bindings table](../../includes/functions-bindings.md)]

[!INCLUDE [Timeout Duration section](../../includes/functions-timeout-duration.md)]

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения см. в следующих ресурсах:

* [Как программировать и тестировать функции Azure в локальной среде](functions-run-local.md)
* [Выбор целевых версий среды выполнения Функций Azure](set-runtime-version.md)
* [Заметки о выпуске](https://github.com/Azure/azure-functions-host/releases)
