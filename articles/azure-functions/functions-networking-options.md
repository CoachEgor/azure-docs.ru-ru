---
title: Azure Functions networking options (Параметры сети для Функций Azure)
description: Обзор всех сетевых опций, доступных в функциях Azure.
author: alexkarcher-msft
ms.topic: conceptual
ms.date: 4/11/2019
ms.author: alkarche
ms.openlocfilehash: d8c3357325eadefec7bb97faba5d600e9c6793a9
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79276716"
---
# <a name="azure-functions-networking-options"></a>Azure Functions networking options (Параметры сети для Функций Azure)

В этой статье описаны сетевые функции, доступные в вариантах хостинга для функций Azure. Все следующие сетевые опции дают вам некоторую возможность получить доступ к ресурсам без использования интернет-адресов или ограничить доступ в Интернет к функциональному приложению.

Модели хостинга имеют различные уровни сетевой изоляции. Выбор правильного поможет вам удовлетворить ваши требования к сетевой изоляции.

Вы можете размещать функциональные приложения несколькими способами:

* Есть набор вариантов плана, которые работают на мультитенантной инфраструктуре, с различными уровнями виртуального подключения к сети и вариантов масштабирования:
    * [План потребления,](functions-scale.md#consumption-plan)который масштабируется динамически в ответ на нагрузку и предлагает минимальные варианты изоляции сети.
    * [Премиум план](functions-scale.md#premium-plan), который также масштабируется динамически, предлагая более всеобъемлющую изоляцию сети.
    * [План службы приложений](functions-scale.md#app-service-plan)Azure, который работает в фиксированном масштабе и предлагает аналогичную изоляцию сети, как план Premium.
* Функции можно выполнять в [среде службы приложений.](../app-service/environment/intro.md) Этот метод развертывает вашу функцию в виртуальной сети и предлагает полный контроль и изоляцию сети.

## <a name="matrix-of-networking-features"></a>Матрица сетевых функций

|                |[План потребления](functions-scale.md#consumption-plan)|[Премиум-план](functions-scale.md#premium-plan)|[План обслуживания приложений](functions-scale.md#app-service-plan)|[Среда обслуживания приложений](../app-service/environment/intro.md)|
|----------------|-----------|----------------|---------|-----------------------|  
|[Входящие ограничения ip-адресов & доступе к частному сайту](#inbound-ip-restrictions)|✅Да|✅Да|✅Да|✅Да|
|[Виртуальная сетевая интеграция](#virtual-network-integration)|❌Нет|✅Да (региональный)|✅Да (Региональный и Шлюз)|✅Да|
|[Триггеры виртуальной сети (не HTTP)](#virtual-network-triggers-non-http)|❌Нет| ✅Да |✅Да|✅Да|
|[Гибридные соединения](#hybrid-connections) (только windows)|❌Нет|✅Да|✅Да|✅Да|
|[Исходящие ограничения ИС](#outbound-ip-restrictions)|❌Нет| ✅Да|✅Да|✅Да|

## <a name="inbound-ip-restrictions"></a>Входящие ограничения ИС

Ограничения IP можно использовать для определения списка IP-адресов, которые разрешены или запрещены к доступу к вашему приложению. Список может включать адреса IPv4 и IPv6. Когда есть одна или несколько записей, неявное "отрицание всех" существует в конце списка. Ограничения ИС работают со всеми функциями-хостинга.

> [!NOTE]
> При вскончающих ограничениях вы можете использовать редактор портала только в виртуальной сети или при покладывании IP-адреса машины, которую вы используете для доступа к порталу Azure в списке безопасных получателей. Тем не менее, вы все еще можете получить доступ к любым функциям на вкладке **платформы** от любой машины.

Чтобы узнать больше, смотрите [ограничения статического доступа службы приложений Azure.](../app-service/app-service-ip-restrictions.md)

## <a name="private-site-access"></a>доступ к частным сайтам;

Частный доступ к сайту означает сделать ваше приложение доступным только из частной сети, такой как виртуальная сеть Azure.

* Частный доступ к сайту доступен в планах [Premium,](./functions-premium-plan.md) [Consumption](functions-scale.md#consumption-plan)и [App Service](functions-scale.md#app-service-plan) при настройке конечных точек обслуживания.
    * Конечные точки службы могут быть настроены на основе приложения под **функциями** > Платформы**Сетевая** > **настройка Ограничения** > доступа**Добавить правило.** Виртуальные сети теперь могут быть выбраны в качестве типа правила.
    * Для получения дополнительной информации смотрите [конечные точки виртуального сетевого обслуживания.](../virtual-network/virtual-network-service-endpoints-overview.md)
    * Имейте в виду, что с конечными точками обслуживания, ваша функция по-прежнему имеет полный исходящий доступ к Интернету, даже с виртуальной сетевой интеграцией настроен.
* Доступ к частному сайту также доступен в среде службы приложений, настроенной с внутренним балансером нагрузки (ILB). Для получения дополнительной информации [см. Создать и использовать внутренний балансер нагрузки с средой службы приложений](../app-service/environment/create-ilb-ase.md).

Чтобы узнать, как настроить частный доступ к сайту, [см.](functions-create-private-site-access.md)

## <a name="virtual-network-integration"></a>Интеграция виртуальной сети

Виртуальная сетевая интеграция позволяет приложению функции получать доступ к ресурсам внутри виртуальной сети. Azure Functions поддерживает два вида виртуальной сетевой интеграции:

[!INCLUDE [app-service-web-vnet-types](../../includes/app-service-web-vnet-types.md)]

Виртуальная сетевая интеграция в Azure Functions использует общую инфраструктуру с веб-приложениями Службы Приложений. Чтобы узнать больше о двух типах виртуальной сетевой интеграции, см.:

* [Региональная виртуальная сетевая интеграция](../app-service/web-sites-integrate-with-vnet.md#regional-vnet-integration)
* [Шлюз требует виртуальной сетевой интеграции](../app-service/web-sites-integrate-with-vnet.md#gateway-required-vnet-integration)

Чтобы узнать, как настроить [виртуальную](functions-create-vnet.md)сетевую интеграцию, см.

## <a name="regional-virtual-network-integration"></a>Региональная виртуальная сетевая интеграция

[!INCLUDE [app-service-web-vnet-types](../../includes/app-service-web-vnet-regional.md)]

## <a name="connecting-to-service-endpoint-secured-resources"></a>Подключение к конечным ресурсам службы

Чтобы обеспечить более высокий уровень безопасности, можно ограничить ряд служб Azure виртуальной сетью, используя конечные точки обслуживания. Затем необходимо интегрировать приложение функции с этой виртуальной сетью для доступа к ресурсу. Эта конфигурация поддерживается во всех планах, поддерживающих виртуальную сетевую интеграцию.

[Узнайте больше о конечных точках виртуального сетевого обслуживания.](../virtual-network/virtual-network-service-endpoints-overview.md)

## <a name="restricting-your-storage-account-to-a-virtual-network"></a>Ограничение учетной записи хранилища виртуальной сетью

При создании приложения функции необходимо создать или связать учетную запись хранения azure общего назначения, которая поддерживает хранение blob, Queue и Таблицы. В настоящее время вы не можете использовать какие-либо фактические сетевые ограничения на эту учетную запись. Если вы наверснете конечную точку виртуального сетевого сервиса в учетной записи хранилища, которую вы используете для приложения функции, это сломает ваше приложение.

[Узнайте больше о требованиях к учетной записи хранилища.](./functions-create-function-app-portal.md#storage-account-requirements)

## <a name="using-key-vault-references"></a>Использование ссылок Key Vault 

Ссылки Key Vault позволяют использовать секреты из Azure Key Vault в приложении Azure Functions, не требуя никаких изменений кода. Служба Azure Key Vault обеспечивает централизованное управление секретами и полный контроль над политиками доступа и журналами аудита.

В настоящее время [ссылки Key Vault](../app-service/app-service-key-vault-references.md) не будут работать, если ваш Ключ Vault защищен конечными точками обслуживания. Для подключения к Key Vault с помощью виртуальной сетевой интеграции необходимо вызвать хранилище ключей в код приложения.

## <a name="virtual-network-triggers-non-http"></a>Триггеры виртуальной сети (не HTTP)

В настоящее время функции триггера, не относясь к HTTP, в виртуальной сети можно использовать одним из двух способов: 
+ Запустите приложение функции в плане Premium и включите поддержку триггера виртуальной сети.
+ Запустите приложение функции в плане службы приложений или среде службы приложений.

### <a name="premium-plan-with-virtual-network-triggers"></a>Премиум-план с виртуальными сетевыми триггерами

При запуске в плане Premium можно подключить функции триггера, не относящейся к HTTP, к службам, работающим внутри виртуальной сети. Для этого необходимо включить виртуальную сетевую поддержку функции приложения. Настройка **триггера виртуальной сети** находится на [портале Azure](https://portal.azure.com) в **настройках приложения Function.**

![VNETToggle](media/functions-networking-options/virtual-network-trigger-toggle.png)

Вы также можете включить виртуальные сетевые триггеры, используя следующую команду Azure CLI:

```azurecli-interactive
az resource update -g <resource_group> -n <function_app_name>/config/web --set properties.functionsRuntimeScaleMonitoringEnabled=1 --resource-type Microsoft.Web/sites
```

Виртуальные триггеры сети поддерживаются в версии 2.x и выше времени выполнения функций. Поддерживаются следующие типы триггеров, не относясь к HTTP.

| Расширение | Минимальная версия |
|-----------|---------| 
|[Microsoft.Azure.WebJobs.Extensions.Storage](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.Storage/) | 3.0.10 или выше |
|[Microsoft.Azure.WebJobs.Extensions.EventHubs](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.EventHubs)| 4.1.0 или выше|
|[Microsoft.Azure.WebJobs.Extensions.ServiceBus](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.ServiceBus)| 3.2.0 или выше|
|[Microsoft.Azure.WebJobs.Extensions.CosmosDB](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.CosmosDB)| 3.0.5 или выше|
|[Microsoft.Azure.WebJobs.Extensions.DurableTask](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.DurableTask)| 2.0.0 или выше|

> [!IMPORTANT]
> При включении виртуальной сети триггерной поддержки, только триггерные типы выше масштаба динамически с вашим приложением. Вы все еще можете использовать триггеры, не перечисленные выше, однако они не масштабируются за пределы их предварительно разогретого количества экземпляров. См [триггеры и привязки](./functions-triggers-bindings.md#supported-bindings) для полного списка триггеров.

### <a name="app-service-plan-and-app-service-environment-with-virtual-network-triggers"></a>План обслуживания приложений и среда службы приложений с виртуальными сетевыми триггерами

Когда приложение функции работает либо в плане службы приложений, либо в среде службы приложений, вы можете использовать функции триггера, не относясь к HTTP. Для правильного срабатывания функций необходимо подключиться к виртуальной сети с доступом к ресурсу, определенному в триггерном соединении. 

Например, предположим, что необходимо настроить Azure Cosmos DB для приема трафика только из виртуальной сети. В этом случае необходимо развернуть функциональное приложение в плане Службы приложений, обеспечивающем виртуальную сетевую интеграцию с этой виртуальной сетью. Это позволяет запускать функцию ресурсом Azure Cosmos DB. 

## <a name="hybrid-connections"></a>Гибридные подключения

[Гибридные соединения](../service-bus-relay/relay-hybrid-connections-protocol.md) — это функция Azure Relay, которую можно использовать для доступа к ресурсам приложений в других сетях. Они обеспечивают доступ из вашего приложения к конечной точке приложения. Вы не можете использовать его для доступа к приложению. Гибридные соединения доступны для функций, работающих на Windows во всех, кроме плана потребления.

При использовании функций Azure каждое гибридное соединение соотносится с одной комбинацией узла TCP и порта. Это означает, что конечная точка гибридного соединения может быть на любой операционной системе и любом приложении до тех пор, пока вы получаете доступ к порту прослушивания TCP. Функция гибридных подключений не знает и не заботится о том, что такое протокол приложения или к чему вы хотите получить доступ. Он просто обеспечивает доступ к сети.

Чтобы узнать больше, смотрите [документацию службы приложений для гибридных подключений.](../app-service/app-service-hybrid-connections.md) Эти же шаги конфигурации поддерживают функции Azure.

>[!IMPORTANT]
> Гибридные соединения поддерживаются только в планах Windows. Linux не поддерживается

## <a name="outbound-ip-restrictions"></a>Исходящие ограничения ИС

Ограничения исходящего IP доступны в плане Premium, плане службы приложений или среде службы приложений. Можно настроить ограничения на выходящие пределы для виртуальной сети, в которой развернута среда службы приложений.

При интеграции функционального приложения в план Premium или плана службы приложений с виртуальной сетью приложение по-прежнему может совершать исходящие звонки в Интернет по умолчанию. Добавляя настройки `WEBSITE_VNET_ROUTE_ALL=1`приложения, вы принуждаете весь исходящий трафик для отправки в виртуальную сеть, где правила группы сетевой безопасности могут быть использованы для ограничения трафика.

## <a name="troubleshooting"></a>Устранение неполадок 

[!INCLUDE [app-service-web-vnet-troubleshooting](../../includes/app-service-web-vnet-troubleshooting.md)]

## <a name="next-steps"></a>Дальнейшие действия

Чтобы узнать больше о сети и функции Azure:

* [Следуйте учебник о начале с виртуальной интеграции сети](./functions-create-vnet.md)
* [Прочтите возможности для задаваемых вопросов о функциях](./functions-networking-faq.md)
* [Подробнее о виртуальной интеграции сети с службой приложений/функциями](../app-service/web-sites-integrate-with-vnet.md)
* [Узнайте больше о виртуальных сетях в Azure](../virtual-network/virtual-networks-overview.md)
* [Включите больше сетевых функций и управления с средой службы приложений](../app-service/environment/intro.md)
* [Подключение к отдельным локализованным ресурсам без изменений брандмауэра с помощью гибридных подключений](../app-service/app-service-hybrid-connections.md)
