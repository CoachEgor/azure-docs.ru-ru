---
title: Параметры сети функций Azure
description: Обзор всех параметров сети, доступных в функциях Azure.
author: alexkarcher-msft
ms.topic: conceptual
ms.date: 4/11/2019
ms.author: alkarche
ms.openlocfilehash: 79c27d252136281249c217f51019e53987922334
ms.sourcegitcommit: 5d6ce6dceaf883dbafeb44517ff3df5cd153f929
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2020
ms.locfileid: "76846451"
---
# <a name="azure-functions-networking-options"></a>Параметры сети функций Azure

В этой статье описываются сетевые функции, доступные в различных вариантах размещения для функций Azure. Все следующие сетевые параметры позволяют получить доступ к ресурсам без использования адресов, маршрутизируемых через Интернет, или ограничить доступ к приложению-функции через Интернет.

Модели размещения имеют разные уровни сетевой изоляции. Выбор правильного варианта поможет удовлетворить требования к изоляции сети.

Размещать приложения-функции можно двумя способами:

* Существует набор параметров плана, которые выполняются в инфраструктуре с несколькими клиентами с различными уровнями возможностей подключения и масштабирования виртуальной сети.
    * [План потребления](functions-scale.md#consumption-plan), который динамически масштабируется в ответ на загрузку и предлагает минимальные варианты сетевой изоляции.
    * [План Premium](functions-scale.md#premium-plan), который также динамически масштабируется, обеспечивая более широкие сетевые изоляции.
    * [План службы приложений](functions-scale.md#app-service-plan)Azure, который работает в фиксированном масштабе и предлагает такую же сетевую изоляцию, как и план Premium.
* Функции можно запускать в [Среда службы приложений](../app-service/environment/intro.md). Этот метод развертывает функцию в виртуальной сети и обеспечивает полный контроль и изоляцию сети.

## <a name="matrix-of-networking-features"></a>Матрица сетевых компонентов

|                |[План потребления](functions-scale.md#consumption-plan)|[План Premium](functions-scale.md#premium-plan)|[План обслуживания приложения](functions-scale.md#app-service-plan)|[Среда службы приложений](../app-service/environment/intro.md)|
|----------------|-----------|----------------|---------|-----------------------|  
|[Ограничения на входящие IP-адреса & доступ к частному сайту](#inbound-ip-restrictions)|✅да|✅да|✅да|✅да|
|[Интеграция с виртуальной сетью](#virtual-network-integration)|❌нет|✅Да (региональный)|✅Да (региональный и шлюз)|✅да|
|[Триггеры виртуальной сети (не HTTP)](#virtual-network-triggers-non-http)|❌нет| ✅да |✅да|✅да|
|[Гибридные подключения](#hybrid-connections) (только для Windows)|❌нет|✅да|✅да|✅да|
|[Ограничения исходящих IP-адресов](#outbound-ip-restrictions)|❌нет| ❌нет|❌нет|✅да|

## <a name="inbound-ip-restrictions"></a>Ограничения на входящие IP-адреса

Вы можете использовать ограничения IP-адресов, чтобы определить упорядоченный по приоритету IP-адреса, которым разрешен или запрещен доступ к вашему приложению. Список может содержать адреса IPv4 и IPv6. Если имеется одна или несколько записей, в конце списка существует неявный "Deny All". Ограничения IP-адресов работают со всеми вариантами размещения функций.

> [!NOTE]
> С учетом ограничений сети можно использовать редактор портала только в пределах виртуальной сети или указать IP-адрес компьютера, который вы используете для доступа к портал Azure в списке Надежные получатели. Тем не менее вы по-прежнему можете получить доступ к любым функциям на вкладке **функции платформы** на любом компьютере.

Дополнительные сведения см. в статье [ограничения статического доступа в службе приложений Azure](../app-service/app-service-ip-restrictions.md).

## <a name="private-site-access"></a>доступ к частным сайтам;

Доступ к частному сайту означает предоставление доступа к приложению только из частной сети, такой как виртуальная сеть Azure.

* Доступ к частному сайту доступен в планах обслуживания " [премиум](./functions-premium-plan.md)", " [потребление](functions-scale.md#consumption-plan)" и " [служба приложений](functions-scale.md#app-service-plan) " при настройке конечных точек службы.
    * Конечные точки службы можно настроить для каждого приложения в разделе **функции платформы** > **сети** > **настроить ограничения доступа** > **Добавить правило**. Теперь в качестве типа правила можно выбрать виртуальные сети.
    * Дополнительные сведения см. в разделе [конечные точки службы виртуальной сети](../virtual-network/virtual-network-service-endpoints-overview.md).
    * Помните, что при использовании конечных точек службы функция по-прежнему имеет полный исходящий доступ к Интернету, даже если настроена интеграция с виртуальной сетью.
* Доступ к частному сайту также доступен в Среда службы приложений, настроенном с внутренней подсистемой балансировки нагрузки (ILB). Дополнительные сведения см. в статье [Создание и использование внутренней подсистемы балансировки нагрузки с среда службы приложений](../app-service/environment/create-ilb-ase.md).

## <a name="virtual-network-integration"></a>Интеграция виртуальной сети

Интеграция виртуальной сети позволяет приложению-функции получить доступ к ресурсам в виртуальной сети. Эта функция доступна как в плане Premium, так и в плане службы приложений. Если приложение находится в Среда службы приложений, оно уже находится в виртуальной сети и не требует интеграции с виртуальной сетью для доступа к ресурсам в той же виртуальной сети.

С помощью интеграции с виртуальной сетью можно разрешить доступ из приложений к базам данных и веб-службам, работающим в виртуальной сети. Благодаря интеграции с виртуальной сетью вам не нужно предоставлять общедоступную конечную точку для приложений на виртуальной машине. Вместо этого можно использовать частные, не являющиеся в Интернете маршрутизируемый адреса.

Существует две формы интеграции виртуальной сети:

+ **Интеграция с региональной виртуальной сетью (Предварительная версия)** : включает интеграцию с виртуальными сетями в одном регионе. Для этого типа интеграции требуется подсеть в виртуальной сети в том же регионе. Эта функция по-прежнему доступна в предварительной версии, но она поддерживается для приложений-функций, работающих в Windows, с предупреждениями, описанными после следующей таблицы проблем или решений.
+ **Интеграция виртуальной сети, требующая шлюза**: включает интеграцию с виртуальными сетями в удаленных регионах или с классическими виртуальными сетями. Для этого типа интеграции требуется развертывание шлюза виртуальной сети в виртуальной сети. Это функция на основе VPN типа "точка — сеть", которая поддерживается только для приложений-функций, работающих в Windows.

Приложение может использовать только один тип функции интеграции виртуальной сети за раз. Хотя оба варианта полезны во многих сценариях, в следующей таблице показано, где следует использовать:

| Проблема  | Решение |
|----------|----------|
| Хотите обратиться к адресу RFC 1918 (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16) в том же регионе | Интеграция региональной виртуальной сети |
| Требуется доступ к ресурсам в классической виртуальной сети или виртуальной сети в другом регионе | Интеграция виртуальной сети, требующая шлюза |
| Хотите получить доступ к конечным точкам RFC 1918 в Azure ExpressRoute | Интеграция региональной виртуальной сети |
| Требуется доступ к ресурсам в конечных точках службы | Интеграция региональной виртуальной сети |

Ни одна из этих функций не позволяет обращаться к адресам, отличным от RFC 1918, в ExpressRoute. Для этого в настоящее время необходимо использовать Среда службы приложений.

При использовании региональной интеграции виртуальной сети виртуальная сеть не подключается к локальным конечным точкам или настраивается конечные точки службы. Это отдельная сетевая конфигурация. Интеграция с региональной виртуальной сетью позволяет приложению выполнять вызовы через эти типы подключений.

Независимо от используемой версии, интеграция виртуальной сети предоставляет приложению-функции доступ к ресурсам в вашей виртуальной сети, но не предоставляет частному сайту доступ к приложению-функции из виртуальной сети. Доступ к частному сайту означает, что приложение доступно только из частной сети, такой как виртуальная сеть Azure. Интеграция виртуальной сети предназначена только для исходящих вызовов из приложения в виртуальную сеть.

Функция интеграции виртуальной сети:

* Требуется план службы приложений "Стандартный", "Премиум" или "категории премиум v2"
* Поддержка TCP и UDP
* Работает с приложениями службы приложений и приложениями функций

Интеграция с виртуальной сетью не поддерживается, в том числе:

* подключение диска;
* Интеграция с Active Directory
* Протокола

Интеграция виртуальной сети в функции Azure использует общую инфраструктуру с веб-приложениями службы приложений. Дополнительные сведения о двух типах интеграции виртуальной сети см. в следующих статьях:

* [Интеграция региональной виртуальной сети](../app-service/web-sites-integrate-with-vnet.md#regional-vnet-integration)
* [Интеграция виртуальной сети, требующая шлюза](../app-service/web-sites-integrate-with-vnet.md#gateway-required-vnet-integration)

Дополнительные сведения об использовании интеграции с виртуальной сетью см. в статье [интеграция приложения-функции с виртуальной сетью Azure](functions-create-vnet.md).

## <a name="connecting-to-service-endpoint-secured-resources"></a>Подключение к защищенным ресурсам конечной точки службы

> [!NOTE]
> Пока новые конечные точки службы станут доступными для приложения функции после настройки ограничений доступа к подчиненному ресурсу, в настоящее время может потребоваться до 12 часов. В течение этого времени ресурс будет полностью недоступен для вашего приложения.

Чтобы обеспечить более высокий уровень безопасности, можно ограничить число служб Azure для виртуальной сети с помощью конечных точек службы. Затем необходимо интегрировать приложение функции с этой виртуальной сетью для доступа к ресурсу. Эта конфигурация поддерживается во всех планах, поддерживающих интеграцию виртуальной сети.

[Дополнительные сведения о конечных точках службы виртуальной сети.](../virtual-network/virtual-network-service-endpoints-overview.md)

### <a name="restricting-your-storage-account-to-a-virtual-network"></a>Учетная запись хранения должна быть ограничена виртуальной сетью

При создании приложения-функции необходимо создать или связать с учетной записью хранения Azure общего назначения, которая поддерживает хранилище BLOB-объектов, очередей и таблиц. Сейчас вы не можете использовать ограничения виртуальной сети для этой учетной записи. Если вы настроили конечную точку службы виртуальной сети в учетной записи хранения, которую вы используете для приложения-функции, это приведет к нарушению работы приложения.

[Дополнительные сведения о требованиях к учетной записи хранения.](./functions-create-function-app-portal.md#storage-account-requirements)

### <a name="using-key-vault-references"></a>Использование Key Vault ссылок 

Key Vault ссылки позволяют использовать секреты из Azure Key Vault в приложении "функции Azure" без каких бы то ни было изменений кода. Azure Key Vault — это служба, которая обеспечивает централизованное управление секретами с полным контролем над политиками доступа и журналом аудита.

В настоящее время [Key Vault ссылки](../app-service/app-service-key-vault-references.md) не будут работать, если ваша Key Vault защищена с помощью конечных точек службы. Чтобы подключиться к Key Vault с помощью интеграции с виртуальной сетью, необходимо вызвать хранилище ключей в коде приложения.

## <a name="virtual-network-triggers-non-http"></a>Триггеры виртуальной сети (не HTTP)

В настоящее время вы можете использовать функции триггеров, отличных от HTTP, из виртуальной сети одним из двух способов: 
+ Запустите приложение-функцию в плане Premium и включите поддержку триггеров виртуальной сети.
+ Запустите приложение функции в плане службы приложений или Среда службы приложений.

### <a name="premium-plan-with-virtual-network-triggers"></a>План Premium с триггерами виртуальной сети

При запуске в плане Premium можно подключать функции триггеров, отличных от HTTP, к службам, запущенным в виртуальной сети. Для этого необходимо включить поддержку триггеров виртуальной сети для приложения функции. Параметр **поддержки триггера виртуальной сети** находится в [портал Azure](https://portal.azure.com) в разделе **Параметры приложения-функции**.

![внеттоггле](media/functions-networking-options/virtual-network-trigger-toggle.png)

Также можно включить триггеры виртуальной сети с помощью следующей команды Azure CLI:

```azurecli-interactive
az resource update -g <resource_group> -n <function_app_name>/config/web --set properties.functionsRuntimeScaleMonitoringEnabled=1 --resource-type Microsoft.Web/sites
```

Триггеры виртуальной сети поддерживаются в версии 2. x и более поздних версиях среды выполнения функций. Поддерживаются следующие типы триггеров, отличных от HTTP.

| Расширение | Минимальная версия |
|-----------|---------| 
|[Microsoft. Azure. веб-задания. Extensions. Storage](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.Storage/) | 3.0.10 или выше |
|[Microsoft. Azure. веб-задания. Extensions. EventHubs](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.EventHubs)| 4.1.0 или выше|
|[Microsoft. Azure. веб-задания. Extensions. ServiceBus](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.ServiceBus)| 3.2.0 или выше|
|[Microsoft. Azure. веб-задания. Extensions. CosmosDB](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.CosmosDB)| 3.0.5 или выше|
|[Microsoft. Azure. веб-задания. Extensions. DurableTask](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.DurableTask)| 2.0.0 или выше|

> [!IMPORTANT]
> При включении поддержки триггеров виртуальной сети в приложении динамически масштабируется только тип триггеров выше. Вы по-прежнему можете использовать триггеры, не указанные выше, однако они не масштабируются за пределы предварительно зарезервированных экземпляров. Полный список триггеров см. в разделе [триггеры и привязки](./functions-triggers-bindings.md#supported-bindings) .

### <a name="app-service-plan-and-app-service-environment-with-virtual-network-triggers"></a>План службы приложений и Среда службы приложений с помощью триггеров виртуальной сети

При запуске приложения-функции в плане службы приложений или Среда службы приложений можно использовать функции триггера, отличные от HTTP. Для правильной активации функций необходимо подключение к виртуальной сети с доступом к ресурсу, определенному в подключении триггера. 

Например, предположим, что требуется настроить Azure Cosmos DB для приема трафика только из виртуальной сети. В этом случае приложение функции необходимо развернуть в плане службы приложений, который обеспечивает интеграцию виртуальной сети с этой виртуальной сетью. Это позволяет активировать функцию с помощью этого Azure Cosmos DB ресурса. 

## <a name="hybrid-connections"></a>Гибридные подключения

[Гибридные подключения](../service-bus-relay/relay-hybrid-connections-protocol.md) — это функция Azure Relay, которую можно использовать для доступа к ресурсам приложения в других сетях. Они обеспечивают доступ из вашего приложения к конечной точке приложения. Его нельзя использовать для доступа к приложению. Гибридные подключения доступен для функций, работающих в Windows, кроме плана потребления.

При использовании в функциях Azure каждое гибридное подключение сопоставляется с одним сочетанием узла и порта TCP. Это означает, что конечная точка гибридного подключения может находиться в любой операционной системе и любом приложении, если вы обращаетесь к порту прослушивания TCP. Функция гибридные подключения не знает, что такое протокол приложения или к чему вы обращаетесь. Он просто предоставляет доступ к сети.

Дополнительные сведения см. в [документации по службе приложений для гибридные подключения](../app-service/app-service-hybrid-connections.md). Эти же шаги настройки поддерживают функции Azure.

>[!IMPORTANT]
> Гибридные подключения поддерживается только в планах Windows. Linux не поддерживается

## <a name="outbound-ip-restrictions"></a>Ограничения исходящих IP-адресов

Ограничения исходящих IP-адресов доступны только для функций, развернутых в Среда службы приложений. Вы можете настроить ограничения для исходящего трафика для виртуальной сети, в которой развернута Среда службы приложений.

При интеграции приложения-функции в план Premium или план службы приложений с виртуальной сетью приложение может выполнять исходящие вызовы через Интернет.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о работе с сетью и функциях Azure:

* [Следуйте указаниям в руководстве по началу работы с интеграцией виртуальной сети.](./functions-create-vnet.md)
* [Прочтите вопросы и ответы по функциям сети](./functions-networking-faq.md)
* [Дополнительные сведения об интеграции виртуальной сети со службой приложений и функциями](../app-service/web-sites-integrate-with-vnet.md)
* [Дополнительные сведения о виртуальных сетях в Azure](../virtual-network/virtual-networks-overview.md)
* [Предоставление дополнительных сетевых функций и управление средами службы приложений](../app-service/environment/intro.md)
* [Подключение к отдельным локальным ресурсам без изменения брандмауэра с помощью гибридные подключения](../app-service/app-service-hybrid-connections.md)
