---
title: Параметры сети для Функций Azure
description: Обзор всех параметров сети, доступных в Функциях Azure.
author: alexkarcher-msft
ms.topic: conceptual
ms.date: 4/11/2019
ms.author: alkarche
ms.openlocfilehash: 03402828720272851f9b74000d5bcb79405885a5
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "85117233"
---
# <a name="azure-functions-networking-options"></a>Параметры сети для Функций Azure

В этой статье описываются сетевые возможности, доступные в различных вариантах размещения для Функций Azure. Все перечисленные ниже параметры сети предоставляют некоторую возможность доступа к ресурсам, не используя адресов с маршрутизацией через Интернет или ограничения доступа к Интернету для приложения-функции.

Для моделей размещения доступны разные уровни сетевой изоляции. Выбор правильного варианта поможет соответствовать требованиям к сетевой изоляции.

Размещать приложения-функции можно двумя способами:

* Можно выбрать из параметров плана, которые выполняются в инфраструктуре с несколькими клиентами, с различными уровнями возможностей подключения и масштабирования виртуальной сети:
    * [План потребления](functions-scale.md#consumption-plan) динамически масштабируется в ответ на загрузку и предлагает минимальные параметры сетевой изоляции.
    * [План категории "Премиум"](functions-scale.md#premium-plan) также динамически масштабируется и предоставляет более широкие возможности сетевой изоляции.
    * [План служб приложений](functions-scale.md#app-service-plan) Azure работает в фиксированном масштабе и обеспечивает такую же сетевую изоляцию, как в плане категории "Премиум".
* Вы можете запускать функции в параметре [Среда службы приложений](../app-service/environment/intro.md). Этот метод развертывает функцию в виртуальной сети и обеспечивает полный сетевой контроль и изоляцию.

## <a name="matrix-of-networking-features"></a>Таблица функций сети

[!INCLUDE [functions-networking-features](../../includes/functions-networking-features.md)]

## <a name="inbound-ip-restrictions"></a>Ограничения входящих IP-адресов

Вы можете использовать ограничения IP-адресов, чтобы определить список IP-адресов, упорядоченных по приоритету, которым разрешен или запрещен доступ к вашему приложению. Список может содержать IPv4- и IPv6-адреса. Если он содержит одну или несколько записей, то в конце списка действует неявный запрет на все адреса. Ограничения IP-адресов работают со всеми вариантами размещения функций.

> [!NOTE]
> С учетом ограничений сети можно использовать редактор портала только в пределах виртуальной сети или указать IP-адрес компьютера, который вы используете для доступа к порталу Azure, в списке "Надежные получатели". Тем не менее вы по-прежнему можете получить доступ к любым функциям на вкладке **Функции платформы** с любого компьютера.

Дополнительные сведения см. в статье [Azure App Service static access restrictions](../app-service/app-service-ip-restrictions.md) (Ограничения статического доступа для Службы приложений Azure).

## <a name="private-site-access"></a>доступ к частным сайтам;

[!INCLUDE [functions-private-site-access](../../includes/functions-private-site-access.md)]

## <a name="virtual-network-integration"></a>Интеграция виртуальной сети

Интеграция виртуальной сети позволяет приложению-функции получить доступ к ресурсам внутри виртуальной сети.
Функции Azure поддерживают два вида интеграции виртуальной сети:

[!INCLUDE [app-service-web-vnet-types](../../includes/app-service-web-vnet-types.md)]

Интеграция виртуальной сети в Функциях Azure использует общую инфраструктуру с веб-приложениями Службы приложений. Дополнительные сведения о двух типах интеграции виртуальной сети см. в следующих статьях:

* [Интеграция региональной виртуальной сети](../app-service/web-sites-integrate-with-vnet.md#regional-vnet-integration)
* [Интеграция виртуальной сети, необходимой шлюзу](../app-service/web-sites-integrate-with-vnet.md#gateway-required-vnet-integration)

Сведения о настройке интеграции виртуальной сети см. в статье [Integrate a function app with an Azure virtual network](functions-create-vnet.md) (Интеграция приложения-функции с виртуальной сетью Azure).

## <a name="regional-virtual-network-integration"></a>Интеграция региональной виртуальной сети

[!INCLUDE [app-service-web-vnet-types](../../includes/app-service-web-vnet-regional.md)]

## <a name="connect-to-service-endpoint-secured-resources"></a>Подключитесь к защищенным ресурсам конечной точки службы

Чтобы обеспечить более высокий уровень безопасности, можно ограничить число служб Azure для виртуальной сети, используя конечные точки служб. Затем необходимо интегрировать приложение-функцию с этой виртуальной сетью, чтобы получить доступ к ресурсу. Эта конфигурация поддерживается во всех планах, которые поддерживают интеграцию виртуальной сети.

Дополнительные сведения см. в статье [Конечные точки служб для виртуальной сети](../virtual-network/virtual-network-service-endpoints-overview.md).

## <a name="restrict-your-storage-account-to-a-virtual-network"></a>Ограничьте учетную запись хранения виртуальной сети

Когда вы создаете приложения-функции, необходимо создать или привязать учетную запись хранения Azure общего назначения, поддерживающую хранилища BLOB-объектов, очередей и таблиц. Сейчас вы не можете использовать ограничения виртуальной сети на этой учетной записи. При настройке конечной точки службы виртуальной сети в учетной записи хранения, которую вы используете для приложения-функции, эта конфигурация приведет к нарушению работы приложения.

Дополнительную информацию см. в статье [Требования учетных записей хранения](./functions-create-function-app-portal.md#storage-account-requirements).

## <a name="use-key-vault-references"></a>Использование возможностей Key Vault

Вы можете использовать возможности Azure Key Vault, чтобы извлекать секреты из Azure Key Vault в приложении Функций Azure без каких-либо изменений кода. Azure Key Vault — это служба, которая обеспечивает централизованное управление секретами и полный контроль над политиками доступа и журналами аудита.

В настоящее время [возможности Key Vault](../app-service/app-service-key-vault-references.md) не будут работать, если хранилище ключей защищено с помощью конечных точек службы. Чтобы подключиться к хранилищу ключей, используя интеграцию с виртуальной сетью, необходимо вызвать Key Vault в коде приложения.

## <a name="virtual-network-triggers-non-http"></a>Триггеры виртуальной сети (без HTTP)

В настоящее время вы можете использовать функции триггеров, отличных от HTTP, из виртуальной сети одним из двух способов:

+ Запустите приложение-функцию в плане категории "Премиум" и включите поддержку триггеров виртуальной сети.
+ Запустите ваше приложение-функцию в плане службы приложений или в среде службы приложений.

### <a name="premium-plan-with-virtual-network-triggers"></a>План категории "Премиум" с триггерами виртуальной сети

При запуске плана категории "Премиум" можно подключать функции триггеров, отличных от HTTP, к службам, выполняемым внутри виртуальной сети. Для этого необходимо включить поддержку триггеров виртуальной сети для приложения-функции. Параметр **Поддержка триггеров виртуальной сети** находится на [портале Azure](https://portal.azure.com) в разделе **Конфигурация** > **Параметры среды выполнения функции**.

:::image type="content" source="media/functions-networking-options/virtual-network-trigger-toggle.png" alt-text="VNETToggle":::

Также можно включить триггеры виртуальной сети, используя следующую команду Azure CLI:

```azurecli-interactive
az resource update -g <resource_group> -n <function_app_name>/config/web --set properties.functionsRuntimeScaleMonitoringEnabled=1 --resource-type Microsoft.Web/sites
```

Триггеры виртуальной сети поддерживаются в версии 2. x и более поздних версиях среды выполнения Функций. Поддерживаются следующие типы триггеров, отличных от HTTP.

| Расширение | Минимальная версия |
|-----------|---------| 
|[Microsoft.Azure.WebJobs.Extensions.Storage](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.Storage/) | 3.0.10 или новее |
|[Microsoft.Azure.WebJobs.Extensions.EventHubs](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.EventHubs)| 4.1.0 или новее|
|[Microsoft.Azure.WebJobs.Extensions.ServiceBus](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.ServiceBus)| 3.2.0 или новее|
|[Microsoft.Azure.WebJobs.Extensions.CosmosDB](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.CosmosDB)| 3.0.5 или новее|
|[Microsoft.Azure.WebJobs.Extensions.DurableTask](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.DurableTask)| 2.0.0 или новее|

> [!IMPORTANT]
> Когда вы подключаете поддержку триггеров виртуальной сети, с приложением динамично масштабируются только те виды триггеров, которые показаны в предыдущей таблице. Вы по-прежнему можете использовать триггеры, которых нет в таблице, но они не масштабируются за пределы предварительных чисел экземпляров. Полный список триггеров см. в разделе [Триггеры и привязки](./functions-triggers-bindings.md#supported-bindings).

### <a name="app-service-plan-and-app-service-environment-with-virtual-network-triggers"></a>План службы приложений и среда службы приложений с триггерами виртуальной сети

При запуске приложения-функции в плане службы приложений или Среде службы приложений можно использовать функции триггера, отличного от HTTP. Для правильной активации функций, вам необходимо подключение к виртуальной сети с доступом к ресурсу, определенному в подключении триггера.

Например, предположим, что вам нужно настроить Azure Cosmos DB для приема трафика только из виртуальной сети. В этом случае приложение-функцию необходимо развернуть в плане службы приложений, который обеспечивает интеграцию виртуальной сети с этой виртуальной сетью. Интеграция включает функцию, чтобы она была активирована через ресурс Azure Cosmos DB.

## <a name="hybrid-connections"></a>Гибридные подключения

[Гибридные подключения](../service-bus-relay/relay-hybrid-connections-protocol.md) — это функция Azure Relay, которую можно использовать для доступа к ресурсам приложения в других сетях. Они обеспечивают доступ из вашего приложения к конечной точке приложения. Она не может быть использована для доступа к приложению. Гибридные подключения доступны для функций, которые везде работают в Windows, кроме плана потребления.

При использовании в Функциях Azure каждое гибридное подключение коррелирует с одной комбинацией узла TCP и TCP-порта. Это означает, что конечная точка гибридного подключения может быть размещена в любой операционной системе и приложении, пока вы предоставляете доступ к TCP-порту прослушивания. Гибридным подключениям не важен используемый протокол приложения или ресурсы, к которым вы обращаетесь. Они просто предоставляют доступ к сети.

Дополнительные сведения см. в [App Service documentation for Hybrid Connections](../app-service/app-service-hybrid-connections.md) (Документация по Службе приложений для гибридных подключений). Эти же шаги конфигурации поддерживают Функции Azure.

>[!IMPORTANT]
> Гибридные подключения поддерживаются только в планах Windows. ОС Linux не поддерживается.

## <a name="outbound-ip-restrictions"></a>Ограничения исходящих IP-адресов

Ограничения исходящих IP-адресов доступны в плане категории "Премиум", в плане службы приложений или Среде службы приложений. Вы можете настроить ограничения исходящего трафика для виртуальной сети, в которой развернута Среда службы приложений.

При интеграции приложения-функции в плане категории "Премиум" или плане службы приложений с виртуальной сетью приложение по умолчанию может выполнять исходящие вызовы через Интернет. Добавив параметр приложения `WEBSITE_VNET_ROUTE_ALL=1`, вы принудительно передаете весь исходящий трафик в виртуальную сеть, где могут использоваться правила группы безопасности сети для ограничения трафика.

## <a name="automation"></a>Автоматизация
Следующие API позволяют программно управлять региональной интеграцией виртуальной сети.

+ **Azure CLI**. Используйте [`az functionapp vnet-integration`](/cli/azure/functionapp/vnet-integration) команды для добавления, перечисления или удаления региональных интеграций виртуальной сети.  
+ **Шаблоны ARM**. интеграция региональной виртуальной сети можно включить с помощью шаблона Azure Resource Manager. Полный пример см. в разделе [шаблон](https://azure.microsoft.com/resources/templates/101-function-premium-vnet-integration/)быстрого запуска функций.

## <a name="troubleshooting"></a>Устранение неполадок

[!INCLUDE [app-service-web-vnet-troubleshooting](../../includes/app-service-web-vnet-troubleshooting.md)]

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о сети и Функциях Azure:

* [Следуйте руководству по началу работы с интеграцией виртуальной сети](./functions-create-vnet.md)
* [Прочтите часто задаваемые вопросы по функциям сети](./functions-networking-faq.md)
* [Узнайте больше об интеграции приложения виртуальной сети со Службой приложений и Функциями](../app-service/web-sites-integrate-with-vnet.md)
* [Узнайте больше о виртуальных сетях в Azure](../virtual-network/virtual-networks-overview.md)
* [Общие сведения о функциях сети и Средах службы приложений](../app-service/environment/intro.md)
* [Подключитесь к индивидуальным локальным ресурсам без изменений в брандмауэре, используя гибридные подключения](../app-service/app-service-hybrid-connections.md)
