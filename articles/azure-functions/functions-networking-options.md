---
title: Azure Functions networking options (Параметры сети для Функций Azure)
description: Обзор всех параметров сети, доступных в функциях Azure.
author: alexkarcher-msft
ms.topic: conceptual
ms.date: 4/11/2019
ms.author: alkarche
ms.openlocfilehash: ce1a214d39f958af36931192aad4561459ca0573
ms.sourcegitcommit: a8ee9717531050115916dfe427f84bd531a92341
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/12/2020
ms.locfileid: "83121357"
---
# <a name="azure-functions-networking-options"></a>Azure Functions networking options (Параметры сети для Функций Azure)

В этой статье описываются сетевые функции, доступные в различных вариантах размещения для функций Azure. Все перечисленные ниже параметры сети предоставляют некоторую возможность доступа к ресурсам без использования адресов с маршрутизацией через Интернет или ограничения доступа к Интернету для приложения-функции.

Модели размещения имеют разные уровни сетевой изоляции. Выбор правильного варианта поможет удовлетворить требования к изоляции сети.

Размещать приложения-функции можно двумя способами:

* Можно выбрать параметры плана, которые выполняются в инфраструктуре с несколькими клиентами, с различными уровнями возможностей подключения и масштабирования виртуальной сети.
    * [План потребления](functions-scale.md#consumption-plan) динамически масштабируется в ответ на загрузку и предлагает минимальные варианты сетевой изоляции.
    * [План Premium](functions-scale.md#premium-plan) также масштабируется динамически и предоставляет более широкие возможности сетевой изоляции.
    * [План службы приложений](functions-scale.md#app-service-plan) Azure работает в фиксированном масштабе и обеспечивает сетевую изоляцию, аналогичную плану Premium.
* Функции можно запускать в [Среда службы приложений](../app-service/environment/intro.md). Этот метод развертывает функцию в виртуальной сети и обеспечивает полный контроль и изоляцию сети.

## <a name="matrix-of-networking-features"></a>Матрица сетевых компонентов

|                |[План потребления](functions-scale.md#consumption-plan)|[План "Премиум"](functions-scale.md#premium-plan)|[План обслуживания приложения](functions-scale.md#app-service-plan)|[Среда службы приложений](../app-service/environment/intro.md)|
|----------------|-----------|----------------|---------|-----------------------|  
|[Ограничения на входящие IP-адреса и частный доступ к сайту](#inbound-ip-restrictions)|✅Да|✅Да|✅Да|✅Да|
|[Интеграция виртуальной сети](#virtual-network-integration)|❌Нет|✅Да (региональный)|✅Да (региональный и шлюз)|✅Да|
|[Триггеры виртуальной сети (не HTTP)](#virtual-network-triggers-non-http)|❌Нет| ✅Да |✅Да|✅Да|
|[Гибридные подключения](#hybrid-connections) (только для Windows)|❌Нет|✅Да|✅Да|✅Да|
|[Ограничения исходящих IP-адресов](#outbound-ip-restrictions)|❌Нет| ✅Да|✅Да|✅Да|

## <a name="inbound-ip-restrictions"></a>Ограничения на входящие IP-адреса

Вы можете использовать ограничения IP-адресов, чтобы определить упорядоченный по приоритету IP-адреса, которым разрешен или запрещен доступ к вашему приложению. Список может содержать адреса IPv4 и IPv6. Если имеется одна или несколько записей, в конце списка существует неявный "Deny All". Ограничения IP-адресов работают со всеми вариантами размещения функций.

> [!NOTE]
> С учетом ограничений сети можно использовать редактор портала только в пределах виртуальной сети или указать IP-адрес компьютера, который вы используете для доступа к портал Azure в списке Надежные получатели. Тем не менее вы по-прежнему можете получить доступ к любым функциям на вкладке **функции платформы** на любом компьютере.

Дополнительные сведения см. в статье [ограничения статического доступа в службе приложений Azure](../app-service/app-service-ip-restrictions.md).

## <a name="private-site-access"></a>доступ к частным сайтам;

Доступ к частному сайту означает предоставление доступа к приложению только из частной сети, такой как виртуальная сеть Azure.

* Доступ к частному сайту доступен в планах обслуживания " [премиум](./functions-premium-plan.md)", " [потребление](functions-scale.md#consumption-plan)" и " [служба приложений](functions-scale.md#app-service-plan) " при настройке конечных точек службы.
    * Конечные точки службы можно настроить для каждого приложения в разделе **функции платформы**  >  **сеть**  >  **Настройка ограничений доступа**  >  **Добавить правило**. Теперь в качестве типа правила можно выбрать виртуальные сети.
    * Дополнительные сведения см. в статье [Конечные точки служб для виртуальной сети](../virtual-network/virtual-network-service-endpoints-overview.md).
    * Помните, что при использовании конечных точек службы функция по-прежнему имеет полный исходящий доступ к Интернету, даже если настроена интеграция с виртуальной сетью.
* Доступ к частному сайту также доступен в Среда службы приложений, настроенном с внутренней подсистемой балансировки нагрузки (ILB). Дополнительные сведения см. в статье [Создание и использование внутренней подсистемы балансировки нагрузки с среда службы приложений](../app-service/environment/create-ilb-ase.md).

Сведения о настройке частного доступа к веб-сайту см. в разделе [Установка функций Azure для доступа к частным сайтам](functions-create-private-site-access.md).

## <a name="virtual-network-integration"></a>Интеграция виртуальной сети

Интеграция виртуальной сети позволяет приложению-функции получить доступ к ресурсам в виртуальной сети.
Функции Azure поддерживают две разновидности интеграции виртуальной сети:

[!INCLUDE [app-service-web-vnet-types](../../includes/app-service-web-vnet-types.md)]

Интеграция виртуальной сети в функции Azure использует общую инфраструктуру с веб-приложениями службы приложений. Дополнительные сведения о двух типах интеграции виртуальной сети см. в следующих статьях:

* [Интеграция региональной виртуальной сети](../app-service/web-sites-integrate-with-vnet.md#regional-vnet-integration)
* [Интеграция виртуальной сети с требуемым шлюзом](../app-service/web-sites-integrate-with-vnet.md#gateway-required-vnet-integration)

Сведения о настройке интеграции виртуальной сети см. в статье [интеграция приложения-функции с виртуальной сетью Azure](functions-create-vnet.md).

## <a name="regional-virtual-network-integration"></a>Интеграция региональной виртуальной сети

[!INCLUDE [app-service-web-vnet-types](../../includes/app-service-web-vnet-regional.md)]

## <a name="connect-to-service-endpoint-secured-resources"></a>Подключение к защищенным ресурсам конечной точки службы

Чтобы обеспечить более высокий уровень безопасности, можно ограничить число служб Azure для виртуальной сети с помощью конечных точек службы. Затем необходимо интегрировать приложение функции с этой виртуальной сетью для доступа к ресурсу. Эта конфигурация поддерживается во всех планах, поддерживающих интеграцию виртуальной сети.

Дополнительные сведения см. в разделе [конечные точки службы виртуальной сети](../virtual-network/virtual-network-service-endpoints-overview.md).

## <a name="restrict-your-storage-account-to-a-virtual-network"></a>Ограничение учетной записи хранения виртуальной сетью

При создании приложения-функции необходимо создать или связать с учетной записью хранения Azure общего назначения, которая поддерживает хранилище BLOB-объектов, очередей и таблиц. Сейчас вы не можете использовать ограничения виртуальной сети для этой учетной записи. При настройке конечной точки службы виртуальной сети в учетной записи хранения, которую вы используете для приложения-функции, эта конфигурация приведет к нарушению работы приложения.

Дополнительные сведения см. в статье [требования к учетной записи хранения](./functions-create-function-app-portal.md#storage-account-requirements).

## <a name="use-key-vault-references"></a>Использование Key Vault ссылок

Azure Key Vault ссылки можно использовать для использования секретов из Azure Key Vault в приложении "функции Azure" без каких бы то ни было изменений кода. Служба Azure Key Vault обеспечивает централизованное управление секретами и полный контроль над политиками доступа и журналами аудита.

В настоящее время [Key Vault ссылки](../app-service/app-service-key-vault-references.md) не будут работать, если хранилище ключей защищено с помощью конечных точек службы. Чтобы подключиться к хранилищу ключей с помощью интеграции с виртуальной сетью, необходимо вызвать Key Vault в коде приложения.

## <a name="virtual-network-triggers-non-http"></a>Триггеры виртуальной сети (не HTTP)

В настоящее время вы можете использовать функции триггеров, отличных от HTTP, из виртуальной сети одним из двух способов:

+ Запустите приложение-функцию в плане Premium и включите поддержку триггеров виртуальной сети.
+ Запустите приложение функции в плане службы приложений или Среда службы приложений.

### <a name="premium-plan-with-virtual-network-triggers"></a>План Premium с триггерами виртуальной сети

При запуске плана Premium можно подключать функции триггеров, отличных от HTTP, к службам, выполняемым внутри виртуальной сети. Для этого необходимо включить поддержку триггеров виртуальной сети для приложения функции. Параметр **поддержки триггера виртуальной сети** находится в [портал Azure](https://portal.azure.com) в разделе **Configuration**  >  **Параметры среды выполнения функции**конфигурации.

:::image type="content" source="media/functions-networking-options/virtual-network-trigger-toggle.png" alt-text="внеттоггле":::

Также можно включить триггеры виртуальной сети с помощью следующей команды Azure CLI:

```azurecli-interactive
az resource update -g <resource_group> -n <function_app_name>/config/web --set properties.functionsRuntimeScaleMonitoringEnabled=1 --resource-type Microsoft.Web/sites
```

Триггеры виртуальной сети поддерживаются в версии 2. x и более поздних версиях среды выполнения функций. Поддерживаются следующие типы триггеров, отличных от HTTP.

| Расширение | Минимальная версия |
|-----------|---------| 
|[Microsoft. Azure. веб-задания. Extensions. Storage](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.Storage/) | 3.0.10 или выше |
|[Microsoft. Azure. веб-задания. Extensions. EventHubs](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.EventHubs)| 4.1.0 или выше|
|[Microsoft. Azure. веб-задания. Extensions. ServiceBus](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.ServiceBus)| 3.2.0 или выше|
|[Microsoft. Azure. веб-задания. Extensions. CosmosDB](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.CosmosDB)| 3.0.5 или выше|
|[Microsoft. Azure. веб-задания. Extensions. DurableTask](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.DurableTask)| 2.0.0 или выше|

> [!IMPORTANT]
> При включении поддержки триггеров виртуальной сети в приложении динамически масштабируется только тип триггеров, показанных в предыдущей таблице. Вы по-прежнему можете использовать триггеры, которых нет в таблице, но они не масштабируются за пределы предварительно заданных экземпляров. Полный список триггеров см. в разделе [триггеры и привязки](./functions-triggers-bindings.md#supported-bindings).

### <a name="app-service-plan-and-app-service-environment-with-virtual-network-triggers"></a>План службы приложений и Среда службы приложений с помощью триггеров виртуальной сети

При запуске приложения-функции в плане службы приложений или Среда службы приложений можно использовать функции триггера, отличные от HTTP. Для правильной активации функций необходимо подключение к виртуальной сети с доступом к ресурсу, определенному в подключении триггера.

Например, предположим, что требуется настроить Azure Cosmos DB для приема трафика только из виртуальной сети. В этом случае приложение функции необходимо развернуть в плане службы приложений, который обеспечивает интеграцию виртуальной сети с этой виртуальной сетью. Интеграция позволяет активировать функцию с помощью этого Azure Cosmos DB ресурса.

## <a name="hybrid-connections"></a>Гибридные подключения

[Гибридные подключения](../service-bus-relay/relay-hybrid-connections-protocol.md) — это функция Azure Relay, которую можно использовать для доступа к ресурсам приложения в других сетях. Они обеспечивают доступ из вашего приложения к конечной точке приложения. Его нельзя использовать для доступа к приложению. Гибридные подключения доступен для функций, которые работают в Windows, кроме плана потребления.

При использовании в функциях Azure каждое гибридное подключение сопоставляется с одним сочетанием узла и порта TCP. Это означает, что конечная точка гибридного подключения может находиться в любой операционной системе и любом приложении, если вы обращаетесь к порту прослушивания TCP. Функция гибридные подключения не знает, что такое протокол приложения или к чему вы обращаетесь. Он просто предоставляет доступ к сети.

Дополнительные сведения см. в [документации по службе приложений для гибридные подключения](../app-service/app-service-hybrid-connections.md). Эти же шаги настройки поддерживают функции Azure.

>[!IMPORTANT]
> Гибридные подключения поддерживается только в планах Windows. Linux не поддерживается.

## <a name="outbound-ip-restrictions"></a>Ограничения исходящих IP-адресов

Ограничения исходящих IP-адресов доступны в плане Premium, в плане службы приложений или Среда службы приложений. Вы можете настроить ограничения для исходящего трафика для виртуальной сети, в которой развернута Среда службы приложений.

При интеграции приложения-функции в план Premium или план службы приложений с виртуальной сетью приложение по умолчанию может выполнять исходящие вызовы через Интернет. Добавив параметр приложения `WEBSITE_VNET_ROUTE_ALL=1` , вы принудительно передаете весь исходящий трафик в виртуальную сеть, где можно использовать правила группы безопасности сети для ограничения трафика.

## <a name="troubleshooting"></a>Устранение неполадок

[!INCLUDE [app-service-web-vnet-troubleshooting](../../includes/app-service-web-vnet-troubleshooting.md)]

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о работе с сетью и функциях Azure:

* [Следуйте указаниям в руководстве по началу работы с интеграцией виртуальной сети.](./functions-create-vnet.md)
* [Прочтите вопросы и ответы по функциям сети](./functions-networking-faq.md)
* [Дополнительные сведения об интеграции виртуальной сети со службой приложений и функциями](../app-service/web-sites-integrate-with-vnet.md)
* [Дополнительные сведения о виртуальных сетях в Azure](../virtual-network/virtual-networks-overview.md)
* [Предоставление дополнительных сетевых функций и управление средами службы приложений](../app-service/environment/intro.md)
* [Подключение к отдельным локальным ресурсам без изменения брандмауэра с помощью гибридные подключения](../app-service/app-service-hybrid-connections.md)
