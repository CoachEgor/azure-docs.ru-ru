---
title: Deploy Ethereum Proof-of-Authority consortium solution template on Azure
description: Use the Ethereum Proof-of-Authority Consortium solution to deploy and configure a multi-member consortium Ethereum network on Azure
ms.date: 04/08/2019
ms.topic: article
ms.reviewer: coborn
ms.openlocfilehash: c3e449c1d6ebaf7c6cb2c35dc9f91d55f569447a
ms.sourcegitcommit: b77e97709663c0c9f84d95c1f0578fcfcb3b2a6c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/22/2019
ms.locfileid: "74326179"
---
# <a name="deploy-ethereum-proof-of-authority-consortium-solution-template-on-azure"></a>Deploy Ethereum proof-of-authority consortium solution template on Azure

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]

[The Ethereum Proof-of-Authority Consortium Azure solution template](https://portal.azure.com/?pub_source=email&pub_status=success#create/microsoft-azure-blockchain.azure-blockchain-ethereumethereum-poa-consortium) is designed to make it easier to deploy, configure, and govern a multi-member consortium Proof-of-authority Ethereum network with minimal Azure and Ethereum knowledge.

Небольшой объем входных пользовательских данных и быстрое развертывание на портале Azure позволяют для каждого участника подготовить сетевое расположение с помощью Microsoft Azure Compute, сетевых служб и служб хранилища по всему миру. Сетевое расположение каждого участника состоит из набора узлов проверяющего элемента управления с балансировкой нагрузки транзакций, с помощью которого приложение или пользователь могут взаимодействовать при отправке транзакций Ethereum.

## <a name="concepts"></a>Концепции

### <a name="terminology"></a>Термины

-   **Консенсус** — процесс синхронизации данных в распределенной сети через проверку и создание блока.

-   **Участник консорциума** — это сущность, участвующая в консенсусе в сети блокчейнов.

-   **Администратор** — учетная запись Ethereum, с помощью которой выполняется управление участием определенного участника консорциума.

-   **Проверяющий элемент управления** — механизм, связанный с учетной записью Ethereum, которая участвует в консенсусе от имени администратора.

### <a name="proof-of-authority"></a>Алгоритм Proof-of-authority

Для тех, кто не знаком с блокчейн-сообществом, выпуск этого решения — отличная возможность познакомиться с этой технологией в простой и настраиваемой среде Azure. Proof-of-work (POW) — это механизм защиты от атак Сивиллы, который автоматически регулирует сеть и разрешает участие на основе вычислительных затрат. Лучше всего его применять в анонимных открытых сетях блокчейнов, в которых майнинг криптовалюты может влиять на защиту. Однако в частных сетях и сетях консорциумов эфир не имеет ценности. An alternative protocol, proof-of-authority, is more suitable for permitted networks where all consensus participants are known and reputable. Не требующий майнинга в привычном его понимании, этот механизм более эффективен. Однако подход к византийской отказоустойчивости по-прежнему сохраняется.

### <a name="consortium-governance"></a>Управление консорциумом

Since proof-of-authority relies upon a permitted list of network authorities to keep the network healthy, it's important to provide a fair mechanism to make modifications to this permission list. Each deployment comes with a set of smart-contracts and portal for on-chain governance of this permitted list. Когда за предложенное изменение проголосует большинство участников консорциума, изменение задействуется. Этот механизм позволяет добавлять новых участников консенсуса или удалять скомпрометированных прозрачным образом, что способствует формированию открытой сети.

### <a name="admin-account"></a>Учетная запись администратора

During the deployment of the proof-of-authority nodes, you'll be asked for an Admin Ethereum address. Создать и защитить эту учетную запись Ethereum можно с помощью нескольких различных механизмов. Добавив этот адрес как удостоверение сети, вы сможете выполнять с помощью этой учетной записи задачи администрирования. Кроме того, эта учетная запись администратора позволяет делегировать участие в консенсусе на узлы проверяющего элемента управления, которые создаются в рамках этого развертывания. Since only the public Ethereum address is used, each admin has the flexibility to secure their private keys in a way that follows their wanted security model.

### <a name="validator-node"></a>Узел проверяющего элемента управления

В протоколе PoA узлы проверяющего элемента управления заменяют традиционные узлы майнинга. Каждый проверяющий элемент управления имеет уникальный идентификатор Ethereum, который добавляется в список разрешений смарт-контрактов. Если проверяющий элемент управления находится в этом списке, его можно использовать в процессе создания блока. Дополнительные сведения об этом процессе см. в документации Parity по [алгоритму консенсуса Authority Round](https://wiki.parity.io/Aura). Каждый участник консорциума может подготовить несколько узлов проверяющего элемента управления в пяти регионах, что позволит обеспечить геоизбыточность. Узлы проверяющего элемента управления взаимодействуют с другими узлами проверяющего элемента управления, чтобы координировать состояние базового распределенного реестра.
Чтобы обеспечить равномерное участие в сети, каждому участнику консорциума запрещено использовать в сети больше проверяющих элементов управления, чем имеет первый участник (если первый участник развертывает три проверяющих элемента управления, каждый участник может иметь только до трех таких элементов).

### <a name="identity-store"></a>Хранилище удостоверений

Since each member will have multiple validator nodes running simultaneously and each node must have a permitted identity, it's important that the validators can safely acquire a unique active identity on the network. To make this easier, we've built an Identity Store that gets deployed in each member's subscription that securely holds the generated Ethereum identities. Upon deployment, the orchestration container will generate an Ethereum private key for each validator and store it in Azure Key Vault. Перед запуском узел равенства сначала получает аренду на неиспользуемое удостоверение, чтобы убедиться, что его не выберет другой узел. Это удостоверение предоставляется клиенту, который наделяет его полномочиями для создания блоков. Если на виртуальной машине размещения произошел сбой, аренда удостоверения освобождается, за счет чего его сможет получить другой узел.

### <a name="bootnode-registrar"></a>Регистратор Bootnode

Чтобы обеспечить простоту подключения, на [конечной точке API данных](#data-api) каждого участника размещается набор сведений о соединении. This data includes a list of bootnodes that are provided as peering nodes for the joining member. Периодически мы обновляем этот список загрузочных узлов, входящий в состав API данных.

### <a name="bring-your-own-operator"></a>Использование собственного оператора

Зачастую участники консорциума хотят участвовать в управлении сети, но не хотят настраивать и обслуживать свою инфраструктуру. В отличие от традиционных систем использование одного оператора в сети имеет отрицательный эффект для децентрализованной модели блокчейн-систем. Вместо найма централизованного посредника для управления сетью каждый участник консорциума может делегировать управление инфраструктурой любому оператору по своему выбору. This allows a hybrid model where each member can choose to operate their own infrastructure or delegate operation to a different partner. Рабочий процесс делегированной операции выглядит следующим образом:

1.  **Участник консорциума** создает адрес Ethereum (содержит закрытый ключ).

2.  **Участник консорциума** предоставляет общедоступный адрес Ethereum **оператору**.

3.  **Оператор** развертывает и настраивает узлы PoA проверяющего элемента управления с помощью Azure Resource Manager.

4.  **Оператор** предоставляет конечную точку RPC и управления **участнику консорциума**.

5.  **Участник консорциума** с помощью закрытого ключа подписывает запрос, принимая узлы проверяющего элемента управления, которые развернул **оператор** для участия от его имени.

### <a name="azure-monitor"></a>Azure Monitor

Это решение также поставляется со службой Azure Monitor, которая позволяет отслеживать статистику узла и сети. Это предоставляет разработчикам приложений возможность отслеживать статистику создания блоков в базовом блокчейне. С помощью Azure Monitor операторы сети могут быстро обнаруживать и предотвращать сбои сети на основе статистических данных об инфраструктуре и сведений из поддерживающих запросы журналов. For more information, see [Service monitoring](#service-monitoring).

### <a name="deployment-architecture"></a>Архитектура развертывания

#### <a name="description"></a>Описание

Это решение может развернуть сеть консорциума Ethereum с несколькими участниками для одного или нескольких регионов. По умолчанию доступ к конечным точкам RPC и пиринга можно получить через общедоступный IP-адрес, что позволяет упростить подключение между подписками и облаками. Советуем использовать [контракты разрешений Parity](https://wiki.parity.io/Permissioning) для элементов управления доступом уровня приложения. Мы также поддерживаем развернутые за VPN сети, которые подключаются между подписками с помощью шлюзов виртуальных сетей. Эти развертывания более сложны, поэтому советуем начать с модели общедоступного IP-адреса.

#### <a name="consortium-member-overview"></a>Сведения о участнике консорциума

Каждое развертывание участника консорциума содержит:

-   виртуальные машины для запуска проверяющих элементов управления PoA;

-   Azure Load Balancer для распределения запросов RPC, пиринга и децентрализованного приложения системы управления;

-   Azure Key Vault для защиты удостоверений проверяющего элемента управления;

-   служба хранилища Azure для размещения сведений о сети и координации аренды;

-   Azure Monitor для объединения статистики производительности и журналов;

-   шлюз виртуальной сети (необязательно) для разрешения VPN-подключений в виртуальных частных сетях.

![Архитектура развертывания](./media/ethereum-poa-deployment/deployment-architecture.png)

Мы используем контейнеры Docker, чтобы обеспечить надежность и модульность. Версионные образы в рамках каждого развертывания размещаются в службе "Реестр контейнеров Azure". Здесь также выполняется их обслуживание. Образы контейнеров состоят из следующих компонентов:

-   Orchestrator

    -   запускается один раз во время развертывания;

    -   создает удостоверения и контракты системы управления;

    -   сохраняет удостоверения в хранилище удостоверений.

-   Клиент Parity:

    -   получает (арендует) удостоверение из хранилища удостоверений;

    -   обнаруживает кэширующие узлы и подключается к ним.

-   Агент EthStats:

    -   собирает локальные журналы и статистику через RPC и отправляет эти данные в Azure Monitor.

-   Децентрализованное приложение системы управления:

    -   веб-интерфейс взаимодействия с контрактами системы управления.

## <a name="how-to-guides"></a>Руководства
### <a name="governance-dapp"></a>Децентрализованное приложение системы управления:

Основополагающую роль в механизме PoA играет децентрализованная система управления. Децентрализованное приложение системы управления — это набор предварительно развернутых [смарт-контрактов](https://github.com/Azure-Samples/blockchain/tree/master/ethereum-on-azure/) и веб-приложение, с помощью которого осуществляется управление центрами сертификации сети.
Центры разделяются на удостоверения администраторов и узел проверяющих элементов управления.
Администраторы имеют возможность делегировать участие в консенсусе на узлы проверяющих элементов управления. Администраторы также могут голосовать за других администраторов в сети или вне ее.

![Децентрализованное приложение системы управления](./media/ethereum-poa-deployment/governance-dapp.png)

-   **Децентрализованная система управления.** Внесение изменений в центры сертификации сети осуществляется путем голосования (по цепочке) выбранных администраторов.

-   **Делегирование проверяющего элемента управления.** Центры сертификации могут управлять узлами их проверяющих элементов управления, настроенными в каждом развертывании PoA.

-   **Поддерживающий аудит журнал изменений.** Каждое изменение записывается в блокчейн, что обеспечивает прозрачность и возможность выполнения аудита.

#### <a name="getting-started-with-governance"></a>Начало работы с системой управления
To perform any kind of transactions through the Governance DApp, you'll need to leverage an Ethereum wallet.  Самый простой подход — использовать кошелек в браузере, например [MetaMask](https://metamask.io). Однако, учитывая, что это смарт-контракты, развернутые в сети, вы также можете автоматизировать свои взаимодействия с контрактом системы управления.

После установки MetaMask перейдите в децентрализованное приложение системы управления в браузере.  Вы можете найти URL-адрес в сообщении электронной почты о подтверждении развертывания или в выходных данных развертывания на портале Azure.  If you don't have an in-browser wallet installed you'll not be able to perform any actions; however, you still can read the administrator state.  

#### <a name="becoming-an-admin"></a>Как стать администратором
If you're the first member that deployed on the network, then you'll automatically become an Admin and your Parity nodes will be listed as Validators.  If you're joining the network, you'll need to get voted in as an Admin by a majority (greater than 50%) of the existing Admin set.  Если вы не хотите становиться администратором, то узлы по-прежнему будут синхронизировать и проверять блокчейн, но без участия в процессе создания блока. Чтобы начать процесс голосования за получение прав администратора, щелкните __Номинация__ и введите адрес и псевдоним Ethereum.

![Назначение](./media/ethereum-poa-deployment/governance-dapp-nominate.png)

#### <a name="candidates"></a>Кандидаты
Перейдя на вкладку __Кандидаты__, вы увидите текущий набор администраторов-кандидатов.  Once a Candidate reaches a majority vote by the current Admins, the Candidate will get promoted to an Admin.  To vote on a Candidate, select the row and click "Vote in" at the top.  Если вы передумаете во время голосования, можно выбрать кандидата и щелкнуть "Rescind vote" (Отменить выбор).

![Кандидаты](./media/ethereum-poa-deployment/governance-dapp-candidates.png)


#### <a name="admins"></a>Администраторы
На вкладке __Администраторы__ отображается текущий набор администраторов, а также предоставляется возможность проголосовать против них.  Once an Admin loses more than 50% support, they'll be removed as an Admin on the network.  Все узлы проверяющего элемента управления, которыми владеет этот администратор, потеряют состояние проверяющего элемента управления и станут узлами транзакций в сети.  An Admin may be removed for any number of reasons; however, it's up to the consortium to agree on a policy in advance.

![Администраторы](./media/ethereum-poa-deployment/governance-dapp-admins.png)

#### <a name="validators"></a>Проверяющие элементы управления
При выборе вкладки __Validators__ (Проверяющие элементы управления) в меню в левой области появятся текущие развернутые узлы равенства для этого экземпляра и их текущее состояние (тип узла).  Each consortium member will have a different set of validators in this list, since this view represents the current deployed consortium member.  If this is a newly deployed instance and you haven't yet added your validators, you'll be shown the option to 'Add Validators'.  Selecting this will automatically choose a regionally balanced set of Parity nodes and assign them to your validator set.  Если вы развернули больше узлов, чем позволяет доступная емкость, остальные узлы станут узлами транзакций в сети.

Адрес каждого проверяющего элемента управления автоматически назначается с использованием [хранилища идентификаторов](#identity-store) в Azure.  Если узел выйдет из строя, он потеряет свой идентификатор, из-за чего другой узел в развертывании станет использоваться вместо предыдущего.  Это гарантирует высокую доступность участия в консенсусе.

![Проверяющие элементы управления](./media/ethereum-poa-deployment/governance-dapp-validators.png)

#### <a name="consortium-name"></a>Имя консорциума
Каждый администратор может обновить имя консорциума, отображаемое в верхней части страницы.  Выберите значок шестеренки в левом верхнем углу, чтобы обновить имя консорциума.

#### <a name="account-menu"></a>Меню учетной записи
В правом верхнем углу находится псевдоним и идентикон учетной записи Ethereum.  If you're an Admin you'll have the ability to update your alias.

![Учетная запись.](./media/ethereum-poa-deployment/governance-dapp-account.png)

### <a name="deploy-ethereum-proof-of-authority"></a>Развертывание сети PoA в Ethereum

Ниже приведен пример процесса развертывания с несколькими участниками.

1.  Три участника создают учетные записи Ethereum с помощью MetaMask.

2.  *Участник А* развертывает сеть Ethereum PoA, предоставляя при этом свой общедоступный адрес Ethereum.

3.  *Участник А* предоставляет URL-адрес консорциума *участнику Б* и *участнику В*.

4.  *Участник Б* и *участник В* развертывают сеть Ethereum PoA, предоставляя свои общедоступные адреса Ethereum и URL-адрес консорциума *участнику А*.

5.  *Участник А* голосует, чтобы *участник Б* получил роль администратора.

6.  *Участник А* и *участник Б* голосуют за присвоение роли администратора *участнику В*.

Для этого процесса нужна подписка Azure, которая может поддерживать развертывание нескольких виртуальных машин и управляемых дисков. При необходимости сначала [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/).

После защиты подписки перейдите на портал Azure. Щелкните знак "плюс" (+) рядом с надписью Azure Marketplace выберите "Показать все" и найдите Ethereum PoA Consortium.

В разделе ниже описано, как настроить расположение первого участника в сети. Процесс развертывания состоит из пяти шагов: основы, регионы развертывания, размер и производительность сети, параметры Ethereum и Azure Monitor.

#### <a name="basics"></a>Основы

В разделе **Основы** укажите значения стандартных параметров любого развертывания, такие как подписка, группа ресурсов и основные свойства виртуальной машины.

Ниже приведено подробное описание каждого параметра.

Имя параметра|Описание|Допустимые значения|Значения по умолчанию
---|---|---|---
Создать новую сеть или присоединиться к существующей сети?|Создание новой сети или подключение к сети существующего консорциума|Создание новой и присоединение к существующей|Создать
Адрес электронной почты (необязательно)|После завершения развертывания вы получите уведомление по электронной почте с информацией об этом процессе.|Допустимый адрес электронной почты|Нет данных
Имя пользователя виртуальной машины|Имя пользователя администратора каждой развернутой виртуальной машины (только буквенно-цифровые символы)|1–64 символов|Нет данных
Authentication type (Тип проверки подлинности)|Способ аутентификации на виртуальной машине.|Пароль или открытый ключ SSH|Пароль
Пароль (тип проверки подлинности = пароль)|Пароль учетной записи администратора для каждой развернутой виртуальной машины.  Пароль должен содержать знаки трех видов из следующих: 1 строчная буква, 1 прописная буква, 1 цифра и 1 специальный знак. Хотя все виртуальные машины изначально имеют одинаковый пароль, вы можете изменить пароль после инициализации.|12–72 символов|Нет данных
Ключ SSH ("Тип аутентификации" = "Открытый ключ")|Ключ защищенной оболочки, используемый для удаленного входа.||Нет данных
Subscription|Подписка, для которой необходимо развернуть сеть консорциума||Нет данных
Группа ресурсов|Группа ресурсов, в которой будет развертываться сеть консорциума.||Нет данных
Location|Регион Azure для группы ресурсов.||Нет данных

Ниже приведен пример развертывания: ![колонка "Основы"](./media/ethereum-poa-deployment/basic-blade.png)

#### <a name="deployment-regions"></a>Регионы развертывания

Затем в разделе Deployment regions (Регионы развертывания) укажите количество регионов, в которых необходимо развернуть сеть консорциума, и выберите регионы Azure, основываясь на указанном количестве регионов. Пользователь может развернуть сеть не более чем в пяти регионах. Советуем выбрать первый регион, чтобы сопоставить расположение группы ресурсов из раздела "Основы". Для тестовых сетей и сетей разработки советуем использовать один регион на каждого участника. Если сеть рабочая, советуем развернуть ее в нескольких регионах, чтобы обеспечить высокую доступность.

Ниже приведено подробное описание каждого параметра.

  Имя параметра|Описание|Допустимые значения|Значения по умолчанию
  ---|---|---|---
  Количество регионов|Количество регионов для развертывания сети консорциума|1, 2, 3, 4, 5|1
  Первый регион|Первый регион для развертывания сети консорциума|Все разрешенные регионы Azure|Нет данных
  Второй регион|Второй регион развертывания сети консорциума (отображается только в том случае, если для количества регионов указано значение 2)|Все разрешенные регионы Azure|Нет данных
  Третий регион|Третий регион развертывания сети консорциума (отображается только в том случае, если для количества регионов указано значение 3)|Все разрешенные регионы Azure|Нет данных
  Четвертый регион|Четвертый регион развертывания сети консорциума (отображается только в том случае, если для количества регионов указано значение 4)|Все разрешенные регионы Azure|Нет данных
  Пятый регион|Пятый регион развертывания сети консорциума (отображается только в том случае, если для количества регионов указано значение 5)|Все разрешенные регионы Azure|Нет данных

Ниже приведен пример развертывания: ![развертывание регионов](./media/ethereum-poa-deployment/deployment-regions.png)

#### <a name="network-size-and-performance"></a>Размер и производительность сети

Затем в разделе Network size and performance (Размер и производительность сети) укажите размер сети консорциума, например количество и размер узлов проверяющих элементов управления.
От размера хранилища узла проверяющего элемента управления зависит потенциальный размер блокчейна. Его можно изменить после развертывания.

Ниже приведено подробное описание каждого параметра.

  Имя параметра|Описание|Допустимые значения|Значения по умолчанию
  ---|---|---|---
  Number of load balanced validator nodes (Количество узлов проверяющих элементов управления с балансировкой нагрузки)|Количество узлов проверяющих элементов управления, подготовленных как часть сети.|2–15|2
  Validator node storage performance (Производительность хранилища узлов проверяющих элементов управления)|Тип управляемых дисков, на которых развернуты узлы проверяющих элементов управления.|SSD: ценовая категория "Стандартный" или "Премиум"|SSD (цен. категория "Стандартный")
  Validator node virtual machine size (Размер виртуальной машины узла проверяющего элемента управления)|Размер виртуальной машины, используемой для узлов проверяющих элементов управления.|Standard A (Стандартный А), Standard D (Стандартный D), Standard D-v2 (Стандартный D-v2), Standard F series (Стандартный серии F), Standard DS (Стандартный DS) и Standard FS (Стандартный FS)|Standard D1 V2 (Стандартный D1 v2)

[Сведения о ценах на хранилище](https://azure.microsoft.com/pricing/details/managed-disks/)

[Сведения о ценах на виртуальную машину](https://azure.microsoft.com/pricing/details/virtual-machines/windows/)

Virtual Machine and Storage Tier will affect network performance.  Мы рекомендуем следующие номера SKU в зависимости от требуемой эффективности затрат:

  Номер SKU виртуальной машины|Уровень хранилища|Цена|Пропускная способность|Задержка
  ---|---|---|---|---
  F1|SSD (цен. категория "Стандартный")|низкая|низкая|высокий
  D2_v3|SSD (цен. категория "Стандартный")|средняя|средняя|средняя
  F16s|Диск SSD категории "Премиум"|высокий|высокий|низкая

Ниже приведен пример развертывания: ![размер и производительность сети](./media/ethereum-poa-deployment/network-size-and-performance.png)

#### <a name="ethereum-settings"></a>Параметры Ethereum

Затем в разделе Ethereum Settings (Параметры Ethereum) укажите параметры конфигурации Ethereum, такие как сетевой идентификатор и пароль учетной записи Ethereum или первичный блок.

Ниже приведено подробное описание каждого параметра.

  Имя параметра|Описание|Допустимые значения|Значения по умолчанию
  ---|---|---|---
Consortium Member ID (Идентификатор участника консорциума)|Идентификатор, связанный с каждым участником сети консорциума, который используется для настройки пространства IP-адресов, чтобы избежать конфликтов. Если сеть частная, идентификатор участника должен быть уникальным среди разных организаций в одной сети.  Уникальный идентификатор участника необходим даже в том случае, когда та же организация развертывает участников в нескольких регионах. Make note of the value of this parameter since you'll need to share it with other joining members to ensure there’s no collision.|0–255|Нет данных
Идентификатор сети|Идентификатор сети для сети Ethereum развертываемого консорциума.  Каждая сеть Ethereum имеет свой собственный идентификатор сети, причем 1 соответствует идентификатору общедоступной сети.|5–999 999 999|10101010
Admin Ethereum Address (Адрес администратора Ethereum)|Адрес учетной записи Ethereum, которая используется в системе управления PoA.  Мы советует создавать адрес Ethereum с помощью MetaMask.|42 буквенно-цифровых символа, начиная с 0|Нет данных
Расширенные параметры|Расширенные параметры Ethereum|"Включить" или "Отключить"|Отключение
Общедоступный IP-адрес ("Расширенные параметры" = "Включить")|Развертывает сеть за шлюзом виртуальной сети и удаляет пиринговый доступ. Если этот параметр установлен, все участники должны подключаться через шлюз виртуальной сети, чтобы обеспечить совместимость.|"Общедоступный IP-адрес" или Private VNet (Частная виртуальная сеть)|Общедоступный IP-адрес
Ограничение газа блока ("Расширенные параметры" = "Включить")|Исходный предел газа блока сети.|Любое числовое|50000000
Период возобновления блока (с)|Частота, при которой будут созданы пустые блоки, когда в сети нет транзакций. Более высокая частота будет способствовать более высокой скорости завершения с увеличенной стоимостью на хранение.|Любое числовое|15
Transaction Permission Contract (Контракт разрешения транзакций) ("Расширенные параметры" = "Включить")|Байт-код контракта разрешения транзакций. Restricts smart contract deployment and execution to a permitted list of Ethereum accounts.|Contract bytecode (Байт-код контракта)|Нет данных

Ниже приведен пример развертывания: ![параметры Ethereum](./media/ethereum-poa-deployment/ethereum-settings.png)

#### <a name="monitoring"></a>Мониторинг

The Monitoring blade allows you to configure an Azure Monitor logs resource for your network. Агент мониторинга будет собирать и оценивать полезные метрики и журналы из сети, предоставляя возможность быстро проверять работоспособность сети и заниматься устранением неполадок.

[!INCLUDE [azure-monitor-log-analytics-rebrand](../../../includes/azure-monitor-log-analytics-rebrand.md)]

  Имя параметра|Описание|Допустимые значения|Значения по умолчанию
  ---|---|---|---
Мониторинг|Параметр включения мониторинга|"Включить" или "Отключить"|Включение
Connect to existing Azure Monitor logs|Create a new Azure Monitor logs instance or join an existing instance|"Создать" или Join existing (Присоединить имеющийся)|Создание
Monitor Location(Connect to existing Azure Monitor logs= Create new)|The region where the new Azure Monitor logs instance will be deployed|All Azure Monitor logs regions|Нет данных
Existing log analytics workspace ID (Connect to existing Azure Monitor logs = Join Existing)|Workspace ID of the existing Azure Monitor logs instance||Нет данных
Existing log analytics primary key (Connect to existing Azure Monitor logs = Join Existing)|The primary key used to connect to the existing Azure Monitor logs instance||Нет данных


Ниже приведен пример развертывания: ![Azure Monitor](./media/ethereum-poa-deployment/azure-monitor.png)

#### <a name="summary"></a>Резюме

Просмотрите итоговую колонку, чтобы изучить предоставленные входные данные и выполнить элементарную проверку перед развертыванием. Перед развертыванием вы можете скачать шаблон и параметры.

Просмотрите юридические и конфиденциальные условия и нажмите кнопку "Приобрести", чтобы выполнить развертывание. Если развертывание включает в себя шлюзы виртуальной сети, этот процесс может занять 45-50 минут.

#### <a name="post-deployment"></a>Задачи, выполняемые после развертывания

##### <a name="deployment-output"></a>Выходные данные развертывания

Once the deployment has completed, you can access the necessary parameters via the confirmation email or through the Azure portal. В этих параметрах доступны такие данные:

-   конечная точка Ethereum RPC;

-   URL-адрес панели мониторинга системы управления;

-   URL-адрес Azure Monitor;

-   URL-адрес данных;

-   идентификатор ресурса шлюза виртуальной сети (необязательно).

##### <a name="confirmation-email"></a>Подтверждающее сообщение электронной почты

Если вы укажете адрес электронной почты (раздел [Основы](#basics)), сообщение электронной почты отправится на него. В этом письме содержатся выходные данные развертывания.

![Письмо с данными о развертывании](./media/ethereum-poa-deployment/deployment-email.png)

##### <a name="portal"></a>Microsoft Azure

Once the deployment has completed successfully and all resources have been provisioned you can view the output parameters in your resource group.

1.  Найдите группу ресурсов на портале.

2.  Перейдите в раздел *Развертывания*.

3.  Выберите верхнее развертывание с таким же именем, что и группа ресурсов.

4.  Выберите *Выходные данные*.

### <a name="growing-the-consortium"></a>Расширение консорциума

Чтобы расширить свой консорциум, сначала необходимо подключиться к физической сети.
Если используется развертывание на основе общедоступного IP-адреса, это сделать просто. If deploying behind a VPN, see the section [Connecting VNet Gateway](#connecting-vnet-gateways) to do the network connection as part of the new member deployment.  После завершения развертывания используйте [децентрализованное приложение системы управления](#governance-dapp), чтобы стать администратором сети.

#### <a name="new-member-deployment"></a>Развертывание нового участника

1.  Предоставьте подключаемому участнику приведенные ниже сведения. Эти сведения можно найти в сообщении электронной почты, полученном после развертывания, или в выходных данных развертывания портала.

    -  URL-адрес данных консорциума;

    -  количество развернутых узлов;

    -  идентификатор ресурса шлюза виртуальной сети (если используется сеть VPN).

2.  При развертывании сети участник должен использовать [то же решение](https://portal.azure.com/?pub_source=email&pub_status=success#create/microsoft-azure-blockchain.azure-blockchain-ethereumethereum-poa-consortium), а также:

    -  выбрать параметр *Join Existing* (Присоединить имеющийся);

    -  выбрать такое же число узлов проверяющих элементов управления, что и остальные участники в сети, чтобы обеспечить справедливое распределение;

    -  использовать адрес Ethereum, полученный на предыдущем шаге;

    -  передать предоставленный *URL-адрес данных консорциума* на вкладке *Ethereum Settings* (Параметры Ethereum);

    -  если остальная часть сети находится за VPN, выбрать параметр *Private VNet* (Частная виртуальная сеть) в разделе дополнительных параметров.

#### <a name="connecting-vnet-gateways"></a>Подключение шлюзов виртуальной сети

Вы можете проигнорировать этот шаг, если развертывание было выполнено с помощью параметров по умолчанию общедоступного IP-адреса. Если сеть частная, ее участники используют разные подключения шлюза виртуальной сети. Before a member can join the network and see transaction traffic, an existing member must do a final configuration on their VPN gateway to accept the connection. This means that the Ethereum nodes of the joining member won't run until a connection is established. It's recommended to create redundant network connections (mesh) into the consortium to reduce chances of a single point of failure.

После развертывания сети новым участником имеющийся участник должен настроить двустороннее подключение, установив подключение к новому участнику через шлюз виртуальной сети. Чтобы сделать это, имеющийся участник должен иметь следующее:

1.  Идентификатор ресурса шлюза виртуальной сети участника, к которому устанавливается подключение (его можно просмотреть в выходных данных развертывания).

2.  Общий ключ подключения.

Чтобы завершить подключение, имеющийся участник должен выполнить приведенный ниже сценарий PowerShell. We recommend using Azure Cloud Shell located in the top-right navigation bar in the portal.

![Cloud Shell](./media/ethereum-poa-deployment/cloud-shell.png)

```Powershell
$MyGatewayResourceId = "<EXISTING_MEMBER_RESOURCEID>"
$OtherGatewayResourceId = "<NEW_MEMBER_RESOURCEID]"
$ConnectionName = "Leader2Member"
$SharedKey = "<NEW_MEMBER_KEY>"

## $myGatewayResourceId tells me what subscription I am in, what ResourceGroup and the VNetGatewayName
$splitValue = $MyGatewayResourceId.Split('/')
$MySubscriptionid = $splitValue[2]
$MyResourceGroup = $splitValue[4]
$MyGatewayName = $splitValue[8]

## $otherGatewayResourceid tells me what the subscription and VNet GatewayName are
$OtherGatewayName = $OtherGatewayResourceId.Split('/')[8]
$Subscription=Select-AzSubscription -SubscriptionId $MySubscriptionid

## create a PSVirtualNetworkGateway instance for the gateway I want to connect to
$OtherGateway=New-Object Microsoft.Azure.Commands.Network.Models.PSVirtualNetworkGateway
$OtherGateway.Name = $OtherGatewayName
$OtherGateway.Id = $OtherGatewayResourceId
$OtherGateway.GatewayType = "Vpn"
$OtherGateway.VpnType = "RouteBased"

## get a PSVirtualNetworkGateway instance for my gateway
$MyGateway = Get-AzVirtualNetworkGateway -Name $MyGatewayName -ResourceGroupName $MyResourceGroup

## create the connection
New-AzVirtualNetworkGatewayConnection -Name $ConnectionName -ResourceGroupName $MyResourceGroup -VirtualNetworkGateway1 $MyGateway -VirtualNetworkGateway2 $OtherGateway -Location $MyGateway.Location -ConnectionType Vnet2Vnet -SharedKey $SharedKey -EnableBgp $True
```

### <a name="service-monitoring"></a>Мониторинг службы

Вы можете перейти на портал Azure Monitor либо по ссылке в сообщении электронной почты с данными развертывания, либо просмотрев значение параметра \[OMS\_PORTAL\_URL\] в выходных данных развертывания.

На портале в первую очередь отображается общая статистика по сети и сведения об узле.

![Категории Monitor](./media/ethereum-poa-deployment/monitor-categories.png)

Щелкнув **Node Overview** (Обзор узла), вы перейдете к просмотру статистики инфраструктуры по отдельным узлам на портале.

![Статистика по узлам](./media/ethereum-poa-deployment/node-stats.png)

Если выбрать **Network Stats** (Статистика по сети), вы перейдете к просмотру статистики сети Ethereum.

![Статистика по сети](./media/ethereum-poa-deployment/network-stats.png)

#### <a name="sample-kusto-queries"></a>Sample Kusto queries

В основе этих панелей мониторинга лежит набор, который поддерживает запросы необработанных журналов. С помощью этих журналов можно настраивать панели мониторинга и оповещения о достижении порогового значения, а также анализировать сбои. Далее приведены примеры запросов, которые можно выполнять в средстве поиска по журналам.

##### <a name="lists-blocks-that-have-been-reported-by-more-than-one-validator-useful-to-help-find-chain-forks"></a>Возвращает список блоков, о которых сообщали несколько проверяющих элементов управления. Это позволяет найти ответвление (форк) цепочки.

```sql
MinedBlock_CL
| summarize DistinctMiners = dcount(BlockMiner_s) by BlockNumber_d, BlockMiner_s
| where DistinctMiners > 1
```

##### <a name="get-average-peer-count-for-a-specified-validator-node-averaged-over-5-minute-buckets"></a>Возвращает среднее количество кэширующих узлов указанного узла проверяющего элемента управления за пятиминутные периоды.

```sql
let PeerCountRegex = @"Syncing with peers: (\d+) active, (\d+) confirmed, (\d+)";
ParityLog_CL
| where Computer == "vl-devn3lgdm-reg1000001"
| project RawData, TimeGenerated
| where RawData matches regex PeerCountRegex
| extend ActivePeers = extract(PeerCountRegex, 1, RawData, typeof(int))
| summarize avg(ActivePeers) by bin(TimeGenerated, 5m)
```

### <a name="ssh-access"></a>Доступ по протоколу SSH

По умолчанию доступ к портам SSH запрещен правилом безопасности сетевой группы. Это сделано по соображениям безопасности. To access the virtual machine instances in the PoA network, you'll need to change this rule to \"Allow\"

1.  Перейдите в раздел "Обзор" развернутой группы ресурсов с портала Azure.

    ![Обзор SSH](./media/ethereum-poa-deployment/ssh-overview.png)

2.  Выберите группу безопасности сети для региона виртуальной машины, к которой вы хотите получить доступ.

    ![Группа безопасности сети SSH](./media/ethereum-poa-deployment/ssh-nsg.png)

3.  Выберите правило \"allow-ssh\".

    ![Правило ssh-allow](./media/ethereum-poa-deployment/ssh-allow.png)

4.  Измените значение параметра \"Действие\" на "Разрешить".

    ![Значение "Разрешить", активирующее протокол SSH](./media/ethereum-poa-deployment/ssh-enable-allow.png)

5.  Нажмите кнопку \"Сохранить\" (применение изменений может занять несколько минут).

Теперь вы можете удаленно подключиться к виртуальным машинам узлов проверяющих элементов управления по протоколу SSH, используя предоставленное имя администратора и пароль или ключ SSH.
Команда SSH, предоставляющая доступ к первому узлу проверяющего элемента управления (SSH\_TO\_FIRST\_VL\_NODE\_REGION1), отображается в параметре вывода развертывания шаблона (для этого развертывания: ssh - p 4000 poaadmin\@leader4vb.eastus.cloudapp.azure.com). Чтобы получить дополнительные узлы транзакций, увеличьте номер порта на единицу (например, первый узел транзакций находится на порту 4000).

Если вы развернули сеть в нескольких регионах, измените в приведенной выше команде DNS-имя или IP-адрес подсистемы балансировки нагрузки на использующиеся в этих регионах. Чтобы найти DNS-имя или IP-адрес этих регионов, найдите ресурс с соглашением об именовании \*\*\*\*\*-lbpip-reg\# и просмотрите соответствующие свойства.

### <a name="azure-traffic-manager-load-balancing"></a>Балансировка нагрузки диспетчера трафика Azure

Диспетчер трафика Azure позволяет сократить время простоя и улучшить скорость реакции сети PoA путем направления входящего трафика по множеству развертываний в разных регионах. Встроенные возможности проверки работоспособности и автоматического перенаправления обеспечивают высокий уровень доступности конечных точек RPC и децентрализованного приложения системы управления. Это полезно в том случае, если вы развернули сеть в нескольких регионах и планируете использовать ее в рабочей среде.

Используйте Traffic Manager в следующих целях:

-   Повысить доступность сети PoA за счет автоматической отработки отказа.

-   Ускорить отклик сети за счет маршрутизации пользователей в расположения Azure с наименьшей задержкой в сети.

Если вы решите создать профиль диспетчера трафика, с помощью его DNS-имени можно получить доступ к сети. После добавления к сети других участников консорциума с помощью диспетчера трафика можно также балансировать нагрузку по их развернутым проверяющим элементам управления.

#### <a name="creating-a-traffic-manager-profile"></a>Создание профиля диспетчера трафика

На портале Azure нажмите кнопку \"Создать ресурс\", а затем найдите и выберите \"Профиль диспетчера трафика\".

![Поиск параметра "Профиль диспетчера трафика"](./media/ethereum-poa-deployment/traffic-manager-search.png)

Введите уникальное имя профиля и выберите группу ресурсов, созданную во время развертывания PoA. Нажмите кнопку "Создать", чтобы выполнить развертывание.

![Создание диспетчера трафика](./media/ethereum-poa-deployment/traffic-manager-create.png)

Once it's deployed, then select the instance in the resource group. DNS-имя доступа к диспетчеру трафика отображается на вкладке "Обзор".

![Поиск DNS диспетчера трафика](./media/ethereum-poa-deployment/traffic-manager-dns.png)

Перейдите на вкладку "Конечные точки" и нажмите кнопку "Добавить". Присвойте конечной точке уникальное имя. Измените тип целевого ресурса на общедоступный IP-адрес. Выберите общедоступный IP-адрес подсистемы балансировки нагрузки первого региона.

![Маршрутизации диспетчера трафика](./media/ethereum-poa-deployment/traffic-manager-routing.png)

Повторите эти шаги для каждого региона в развернутой сети. Once the endpoints are in the \"enabled\" status, they'll be automatically load and region balanced at the DNS name of the traffic manager. Теперь вы можете использовать это DNS-имя и параметр \[CONSORTIUM\_DATA\_URL\] на других шагах документации.

### <a name="data-api"></a>API данных

Каждый участник консорциума размещает информацию, на основе которой выполняется подключение к сети. The existing member will provide the [CONSORTIUM_DATA_URL] before the member's deployment. После развертывания присоединяемый участник получит сведения из интерфейса JSON на следующей конечной точке:

`<CONSORTIUM_DATA_URL>/networkinfo`

The response will contain information useful for joining members (Genesis block, Validator Set contract ABI, bootnodes) and information useful to the existing member (validator addresses). Мы советуем расширить консорциум несколькими поставщиками облачных служб, используя такую стандартизацию. Этот API возвращает ответ в формате JSON со следующей структурой:
```json
{
  "$id": "",
  "type": "object",
  "definitions": {},
  "$schema": "https://json-schema.org/draft-07/schema#",
  "properties": {
    "majorVersion": {
      "$id": "/properties/majorVersion",
      "type": "integer",
      "title": "This schema’s major version",
      "default": 0,
      "examples": [
        0
      ]
    },
    "minorVersion": {
      "$id": "/properties/minorVersion",
      "type": "integer",
      "title": "This schema’s minor version",
      "default": 0,
      "examples": [
        0
      ]
    },
    "bootnodes": {
      "$id": "/properties/bootnodes",
      "type": "array",
      "items": {
        "$id": "/properties/bootnodes/items",
        "type": "string",
        "title": "This member’s bootnodes",
        "default": "",
        "examples": [
          "enode://a348586f0fb0516c19de75bf54ca930a08f1594b7202020810b72c5f8d90635189d72d8b96f306f08761d576836a6bfce112cfb6ae6a3330588260f79a3d0ecb@10.1.17.5:30300",
          "enode://2d8474289af0bb38e3600a7a481734b2ab19d4eaf719f698fe885fb239f5d33faf217a860b170e2763b67c2f18d91c41272de37ac67386f80d1de57a3d58ddf2@10.1.17.4:30300"
        ]
      }
    },
    "valSetContract": {
      "$id": "/properties/valSetContract",
      "type": "string",
      "title": "The ValidatorSet Contract Source",
      "default": "",
      "examples": [
        "pragma solidity 0.4.21;\n\nimport \"./SafeMath.sol\";\nimport \"./Utils.sol\";\n\ncontract ValidatorSet …"
      ]
    },
    "adminContract": {
      "$id": "/properties/adminContract",
      "type": "string",
      "title": "The AdminSet Contract Source",
      "default": "",
      "examples": [
        "pragma solidity 0.4.21;\nimport \"./SafeMath.sol\";\nimport \"./SimpleValidatorSet.sol\";\nimport \"./Admin.sol\";\n\ncontract AdminValidatorSet is SimpleValidatorSet { …"
      ]
    },
    "adminContractABI": {
      "$id": "/properties/adminContractABI",
      "type": "string",
      "title": "The Admin Contract ABI",
      "default": "",
      "examples": [
        "[{\"constant\":false,\"inputs\":[{\"name\":\"proposedAdminAddress\",\"type\":\"address\"},…"
      ]
    },
    "paritySpec": {
      "$id": "/properties/paritySpec",
      "type": "string",
      "title": "The Parity client spec file",
      "default": "",
      "examples": [
        "\n{\n \"name\": \"PoA\",\n \"engine\": {\n \"authorityRound\": {\n \"params\": {\n \"stepDuration\": \"2\",\n \"validators\" : {\n \"safeContract\": \"0x0000000000000000000000000000000000000006\"\n },\n \"gasLimitBoundDivisor\": \"0x400\",\n \"maximumExtraDataSize\": \"0x2A\",\n \"minGasLimit\": \"0x2FAF080\",\n \"networkID\" : \"0x9a2112\"\n }\n }\n },\n \"params\": {\n \"gasLimitBoundDivisor\": \"0x400\",\n \"maximumExtraDataSize\": \"0x2A\",\n \"minGasLimit\": \"0x2FAF080\",\n \"networkID\" : \"0x9a2112\",\n \"wasmActivationTransition\": \"0x0\"\n },\n \"genesis\": {\n \"seal\": {\n \"authorityRound\": {\n \"step\": \"0x0\",\n \"signature\": \"0x0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\"\n }\n },\n \"difficulty\": \"0x20000\",\n \"gasLimit\": \"0x2FAF080\"\n },\n \"accounts\": {\n \"0x0000000000000000000000000000000000000001\": { \"balance\": \"1\", \"builtin\": { \"name\": \"ecrecover\", \"pricing\": { \"linear\": { \"base\": 3000, \"word\": 0 } } } },\n \"0x0000000000000000000000000000000000000002\": { \"balance\": \"1\", \"builtin\": { \"name\": \"sha256\", \"pricing\": { \"linear\": { \"base\": 60, \"word\": 12 } } } },\n \"0x0000000000000000000000000000000000000003\": { \"balance\": \"1\", \"builtin\": { \"name\": \"ripemd160\", \"pricing\": { \"linear\": { \"base\": 600, \"word\": 120 } } } },\n \"0x0000000000000000000000000000000000000004\": { \"balance\": \"1\", \"builtin\": { \"name\": \"identity\", \"pricing\": { \"linear\": { \"base\": 15, \"word\": 3 } } } },\n \"0x0000000000000000000000000000000000000006\": { \"balance\": \"0\", \"constructor\" : \"…\" }\n }\n}"
      ]
    },
    "errorMessage": {
      "$id": "/properties/errorMessage",
      "type": "string",
      "title": "Error message",
      "default": "",
      "examples": [
        ""
      ]
    },
    "addressList": {
      "$id": "/properties/addressList",
      "type": "object",
      "properties": {
        "addresses": {
          "$id": "/properties/addressList/properties/addresses",
          "type": "array",
          "items": {
            "$id": "/properties/addressList/properties/addresses/items",
            "type": "string",
            "title": "This member’s validator addresses",
            "default": "",
            "examples": [
              "0x00a3cff0dccc0ecb6ae0461045e0e467cff4805f",
              "0x009ce13a7b2532cbd89b2d28cecd75f7cc8c0727"
            ]
          }
        }
      }
    }
  }
}

```
## <a name="tutorials"></a>Учебники

### <a name="programmatically-interacting-with-a-smart-contract"></a>Взаимодействие со смарт-контрактами программным образом

> [!WARNING]
> Никогда не отравляйте закрытый ключ Ethereum по сети! Сначала убедитесь, что каждая транзакция имеет локальную подпись, а затем их можно отправлять по сети.

В следующем примере мы с помощью команды *ethereumjs-wallet* создадим адрес Ethereum, с помощью команды *ethereumjs-tx* подпишем транзакцию локально и с помощью команды *web3* отправим необработанную транзакцию на конечную точку RPC Ethereum.

В этом примере используется простой смарт-контракт Hello-World:

```javascript
pragma solidity ^0.4.11;
contract postBox {
    string message;
    function postMsg(string text) public {
        message = text;
    }
    function getMsg() public view returns (string) {
        return message;
    }
}
```

В этом примере предполагается, что контракт уже развернут. Если нет, его можно развернуть программно с помощью команд *solc* и *web3*. Сначала установите следующие модули узлов:
```
sudo npm install web3@0.20.2
sudo npm install ethereumjs-tx@1.3.6
sudo npm install ethereumjs-wallet@0.6.1
```
Скрипт nodeJS выполнит следующее:

-   создаст необработанную транзакцию postMsg;

-   подпишет эту транзакцию с помощью созданного закрытого ключа;

-   отправит подписанную транзакцию в сеть Ethereum.

```javascript
var ethereumjs = require('ethereumjs-tx')
var wallet = require('ethereumjs-wallet')
var Web3 = require('web3')

// TODO Replace with your contract address
var address = "0xfe53559f5f7a77125039a993e8d5d9c2901edc58";
var abi = [{"constant": false,"inputs": [{"name": "text","type": "string"}],"name": "postMsg","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"},{"constant": true,"inputs": [],"name": "getMsg","outputs": [{"name": "","type": "string"}],"payable": false,"stateMutability": "view","type": "function"}];

// Generate a new Ethereum account
var account = wallet.generate();
var accountAddress = account.getAddressString()
var privateKey = account.getPrivateKey();

// TODO Replace with your RPC endpoint
var web3 = new Web3(new Web3.providers.HttpProvider(
    "http://testzvdky-dns-reg1.eastus.cloudapp.azure.com:8545"));

// Get the current nonce of the account
web3.eth.getTransactionCount(accountAddress, function (err, nonce) {
   var data = web3.eth.contract(abi).at(address).postMsg.getData("Hello World");
   var rawTx = {
     nonce: nonce,
     gasPrice: '0x00',
     gasLimit: '0x2FAF080',
     to: address,
     value: '0x00',
     data: data
   }
   var tx = new ethereumjs(rawTx);

   tx.sign(privateKey);

   var raw = '0x' + tx.serialize().toString('hex');
   web3.eth.sendRawTransaction(raw, function (txErr, transactionHash) {
     console.log("TX Hash: " + transactionHash);
     console.log("Error: " + txErr);
   });
 });
```

### <a name="deploy-smart-contract-with-truffle"></a>Развертывание смарт-контрактов с помощью Truffle

-   Установка необходимых библиотек

```javascript
npm init

npm install truffle-hdwallet-provider --save
```
-   В truffle.js добавьте следующий код, чтобы разблокировать свою учетную запись MetaMask и настроить узел PoA как точку входа, предоставив фразу из назначенных символов (MetaMask / параметры / показать слова с начальным значением).

```javascript
var HDWalletProvider = require("truffle-hdwallet-provider");

var rpc_endpoint = "XXXXXX";
var mnemonic = "twelve words you can find in metamask/settings/reveal seed words";

module.exports = {
  networks: {
    development: {
      host: "localhost",
      port: 8545,
      network_id: "*" // Match any network id
    },
    poa: {
      provider: new HDWalletProvider(mnemonic, rpc_endpoint),
      network_id: 3,
      gasPrice : 0
    }
  }
};

```

-   Выполните развертывание в сеть PoA:

```javascript
$ truffle migrate --network poa
```

### <a name="debug-smart-contract-with-truffle"></a>Отладка смарт-контрактов с помощью Truffle

Truffle имеет локальную сеть разработки, с помощью которой можно выполнять отладку смарт-контрактов. Полное руководство см. [здесь](https://truffleframework.com/tutorials/debugging-a-smart-contract).

### <a name="webassembly-wasm-support"></a>Поддержка WebAssembly (WASM)

Поддержка WebAssembly по умолчанию реализована в развернутой сети PoA. Это позволяет разрабатывать смарт-контракты на любом языке, который компилируется в код Web-Assembly (Rust, C, C++). Дополнительные сведения см. по ссылкам ниже:

-   Обзор WebAssembly от Parity — <https://wiki.parity.io/WebAssembly-Home>

-   Руководство от ParityTech — <https://github.com/paritytech/pwasm-tutorial>

## <a name="reference"></a>Справочные материалы

### <a name="faq"></a>Вопросы и ответы

#### <a name="i-notice-there-are-many-transactions-on-the-network-that-i-didnt-send-where-are-these-coming-from"></a>В сети есть ряд не отправляемых мною транзакций. Откуда они поступают?

Разблокировать [личный API](https://web3js.readthedocs.io/en/v1.2.0/web3-eth-personal.html) небезопасно. Боты прослушивают разблокированные учетные записи Ethereum в попытке кражи денежных средств. Бот предполагает, что эти учетные записи содержат эфир, и пытается первым перевести эти средства. Не включайте личные API в сети. Вместо этого подпишите транзакции вручную, используя кошелек, например MetaMask, или программно, как описано в разделе о [взаимодействии со смарт-контрактами программным образом](#programmatically-interacting-with-a-smart-contract).

#### <a name="how-to-ssh-onto-a-vm"></a>Как подключиться по протоколу SSH к виртуальной машине?

По соображениям безопасности порт SSH не отображается. Сведения о том, как включить SSH-порт, см. в [этом руководстве](#ssh-access).

#### <a name="how-do-i-set-up-an-audit-member-or-transaction-nodes"></a>Как настроить аудит узлов транзакций и участников?

Узлы транзакций — это набор клиентов Parity, между которыми настраивается пиринговая связь с сетью, но которые не участвуют в консенсусе. С помощью этих узлов можно по-прежнему отправлять транзакции Ethereum и считывать состояние смарт-контрактов.
Это удобный механизм обеспечения возможности выполнения аудита участниками, не являющимися членами консорциума сети. Чтобы обеспечить это, выполните шаг 2 из раздела "Расширение консорциума".

#### <a name="why-are-metamask-transactions-taking-a-long-time"></a>Почему транзакции MetaMask занимают много времени?

Чтобы обеспечить правильный порядок получения транзакций, каждая из них отправляется с увеличивающимся номером nonce. Если вы использовали учетную запись в MetaMask в другой сети, значение nonce необходимо сбросить. Щелкните значок параметров (3 линии), выберите "Параметры" и щелкните Reset Account (Сбросить учетную запись). Журнал транзакции очистится, и вы сможете повторно отправить транзакцию.

#### <a name="do-i-need-to-specify-gas-fee-in-metamask"></a>Нужно ли указывать сборы на газ в MetaMask?

Эфир не предназначен для этой цели в консорциуме PoA. Следовательно, при отправке транзакций в MetaMask нет необходимости указывать плату за газ.

#### <a name="what-should-i-do-if-my-deployment-fails-due-to-failure-to-provision-azure-oms"></a>Что делать, если развертывание завершается сбоем из-за невозможности подготовить Azure OMS?

Мониторинг — это дополнительная функция. В некоторых редких случаях, когда развертывание завершается сбоем из-за невозможности успешно подготовить ресурсы Azure Monitor, вы можете выполнить повторное развертывание без Azure Monitor.

#### <a name="are-public-ip-deployments-compatible-with-private-network-deployments"></a>Совместимы ли развертывания с общедоступным IP-адресом с развертываниями с частной сетью?

Нет. Кэширующему узлу требуется двусторонний обмен данными, поэтому все сети должны быть общедоступными или частными.

#### <a name="what-is-the-expected-transaction-throughput-of-proof-of-authority"></a>Какова ожидаемая пропускная способность транзакций PoA?

Пропускная способность транзакций будет значительно зависеть от типов транзакций и топологии сети.  Протестировав простые транзакции, мы определили показатель в среднем в 400 транзакций в секунду для сети, развернутой в нескольких регионах.

#### <a name="how-do-i-subscribe-to-smart-contract-events"></a>Как подписаться на события смарт-контрактов?

PoA Ethereum теперь поддерживает веб-сокеты.  Проверьте свой адрес электронной почты развертывания или выходные данные развертывания, чтобы найти URL-адрес и порт веб-сокета.

## <a name="next-steps"></a>Дальнейшие действия

Начните работу, получив решение [Ethereum Proof-of-Authority Consortium](https://portal.azure.com/?pub_source=email&pub_status=success#create/microsoft-azure-blockchain.azure-blockchain-ethereumethereum-poa-consortium).
