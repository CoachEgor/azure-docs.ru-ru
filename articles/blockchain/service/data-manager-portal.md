---
title: Настройте менеджер блокчейн-данных с помощью портала Azure - Azure Blockchain Service
description: Создавайте и управляйте менеджером блокчейн-данных для Blockchain Службы блокчейн Azure с помощью портала Azure.
ms.date: 03/30/2020
ms.topic: article
ms.reviewer: ravastra
ms.openlocfilehash: 08f5a4a807087afce13dd4a6e96c0e9dd0a36103
ms.sourcegitcommit: 8dc84e8b04390f39a3c11e9b0eaf3264861fcafc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/13/2020
ms.locfileid: "81260604"
---
# <a name="configure-blockchain-data-manager-using-the-azure-portal"></a>Настройка диспетчера данных блокчейна с помощью портала Azure

Настройте менеджер блокчейн-данных для Azure Blockchain Service для захвата данных блокчейна и отправки их в тему Azure Event Grid.

Чтобы настроить экземпляр Blockchain Data Manager:

* Создайте экземпляр blockchain Data Manager для узла транзакций Службы блокчейн Azure
* Добавить свои блокчейн-приложения

## <a name="prerequisites"></a>Предварительные требования

* Полный [быстрый запуск: Создайте участника блокчейна с помощью портала Azure](create-member.md) или [quickstart: Создайте блокчейн-участника Blockchain Service Azure с помощью Azure CLI.](create-member-cli.md) *Стандартный* уровень Azure Blockchain Service Standard рекомендуется при использовании Blockchain Data Manager.
* Создание [темы сетки событий](../../event-grid/custom-event-quickstart-portal.md#create-a-custom-topic)
* Подробные сведения см. в статье об [обработчиках событий в службе "Сетка событий Azure"](../../event-grid/event-handlers.md).

## <a name="create-instance"></a>Создание экземпляра

Каждый экземпляр диспетчера данных блокчейна подключается к узлу транзакций службы "Блокчейн Azure" и отслеживает его. Только пользователи, имеющих доступ к узлам транзакции, могут создать соединение. Экземпляр регистрирует все необработанные данные о блоках и транзакциях из узла транзакций. Менеджер блокчейн данных публикует сообщение **RawBlockAndTransactionMsg,** которое представляет собой супернабор информации, возвращенной из web3.eth [getBlock](https://web3js.readthedocs.io/en/v1.2.0/web3-eth.html#getblock) и [getTransaction](https://web3js.readthedocs.io/en/v1.2.0/web3-eth.html#gettransaction) queries.

Исходящее подключение отправляет данные блокчейна в службу "Сетка событий Azure". При создании экземпляра вы настраиваете одно исходящее подключение. Диспетчер данных блокчейна для каждого отдельного экземпляра поддерживает несколько исходящих подключений к разделам Сетки событий. Данные блокчейна можно отправлять в одно или несколько назначений. Чтобы добавить другой пункт назначения, просто добавьте дополнительные исходящие соединения в экземпляр.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Перейдите к участнику службы блокчейн Azure, который необходимо подключить к менеджеру блокчейн-данных. Щелкните **Blockchain Data Manager** (Диспетчер данных блокчейна).
1. Выберите **Добавить**.

    ![Добавление диспетчера данных блокчейна](./media/data-manager-portal/add-instance.png)

    Введите следующие сведения:

    Параметр | Описание
    --------|------------
    Имя | Введите уникальное имя для подключенного диспетчера данных блокчейна. Имя менеджера данных Blockchain может содержать буквы и цифры нижнего регистра и имеет максимальную длину 20 символов.
    Узел транзакции | Выберите узла транзакции. Перечислены только узлы транзакций, к доступу которых вы прочитали.
    Имя соединения | Введите уникальное имя исходящего подключения, в которое отправляются данные транзакций блокчейна.
    Конечная точка Сетки событий | Выберите тему сетки событий в той же подписке, что и экземпляр Blockchain Data Manager.

1. Щелкните **ОК**.

    Создание экземпляра диспетчера данных блокчейна занимает менее минуты. Когда завершается развертывание экземпляра, он запускается автоматически. Запущенный экземпляр Blockchain Data Manager фиксирует события блокчейна из узла транзакции и отправляет данные в исходящие соединения.

    Новый экземпляр отображается в списке экземпляров Blockchain Data Manager для участника службы блокчейн Azure.

    ![Список экземпляров участников блокчейн-данных](./media/data-manager-portal/instance-list.png)

## <a name="add-blockchain-application"></a>Добавление блокчейн-приложения

Если вы добавляете блокчейн-приложение, менеджер blockchain Data Manager декодирует событие и состояние свойства для приложения. В противном случае отправляются только необработанные данные о блокировке и необработанных транзакциях. Менеджер блокчейн данных также обнаруживает адреса контрактов при развертывании контракта. Вы можете добавить несколько блокчейн-приложений в экземпляр Blockchain Data Manager.

> [!IMPORTANT]
> В настоящее время приложения блокчейн, которые декларируют [типы массивов](https://solidity.readthedocs.io/en/v0.5.12/types.html#arrays) Solidity или [типы отображения,](https://solidity.readthedocs.io/en/v0.5.12/types.html#mapping-types) не поддерживаются полностью. Свойства, объявленные в виде типов массива или отображения, не будут декодированы в сообщениях *ContractPropertiesMsg* или *DecodedContractEventsMsg.*

Менеджер блокчейн данных требует смарт-контракт ABI и развернутый файл байтекод для добавления приложения.

### <a name="get-contract-abi-and-bytecode"></a>Получить контракт ABI и байтекод

ABI контракта определяет интерфейсы смарт-контракта. В нем описывается взаимодействие со смарт-контрактом. ABI контракта можно скопировать в буфер обмена через [расширение Пакета средств разработки Блокчейна Azure для Ethereum](https://marketplace.visualstudio.com/items?itemName=AzBlockchain.azure-blockchain).

1. На панели обозревателя Visual Studio Code разверните папку **build/contracts** проекта Solidity.
1. Правой кнопкой мыши щелкните JSON-файл метаданных контракта. Имя файла — это имя смарт-контракта, за которым следует расширение **.json**.
1. Щелкните **Скопировать ABI контракта**.

    ![Панель Visual Studio Code, где выбрано действие "Скопировать ABI контракта"](./media/data-manager-portal/abi-devkit.png)

    ABI контракта скопируется в буфер обмена.

1. Сохраните массив **abi** в JSON-файл. Например, с именем *abi.json*. Он понадобится вам на одном из следующих шагов.

Диспетчеру данных блокчейна нужен развернутый байт-код для смарт-контракта. Развернутый байт-код отличается от байт-кода смарт-контракта. Байт-код можно скопировать в буфер обмена через расширение комплекта SDK Блокчейна Azure.

1. На панели обозревателя Visual Studio Code разверните папку **build/contracts** проекта Solidity.
1. Правой кнопкой мыши щелкните JSON-файл метаданных контракта. Имя файла — это имя смарт-контракта, за которым следует расширение **.json**.
1. Выберите **Copy Transaction Bytecode** (Cкопировать байт-код транзакции).

    ![Панель Visual Studio Code, где выбрано действие Copy Transaction Bytecode (Скопировать байт-код транзакции)](./media/data-manager-portal/bytecode-devkit.png)

    Байт-код скопируется в буфер обмена.

1. Сохраните **байт-код** в виде JSON-файла. Например, с именем *bytecode.json*. Он понадобится вам на одном из следующих шагов.

В следующем примере показаны файлы *abi.json* и *bytecode.json*, открытые в редакторе VS Code. Ваши файлы должны выглядеть примерно так же.

![Пример содержимого файлов abi.json и bytecode.json](./media/data-manager-portal/contract-files.png)

### <a name="create-contract-abi-and-bytecode-url"></a>Создание ABI и URL-адреса байт-кода контракта

Диспетчеру данных блокчейна при добавлении приложения нужно, чтобы файлы ABI и байт-кода для контракта были доступны по URL-адресу. Для предоставления частного URL-адреса можно использовать учетную запись хранения Azure.

#### <a name="create-storage-account"></a>Создание учетной записи хранения

[!INCLUDE [storage-create-account-portal-include](../../../includes/storage-create-account-portal-include.md)]

#### <a name="upload-contract-files"></a>Отправка файлов контракта

1. Создайте новый контейнер для учетной записи хранения. Выберите **Контейнеры > Контейнер**.

    ![Создание контейнера учетной записи хранения](./media/data-manager-portal/create-container.png)

    | Поле | Описание |
    |-------|-------------|
    | Имя  | Присвойте контейнеру имя, например *smartcontract*. |
    | Public access level (Уровень общего доступа) | Выберите *Private (no anonymous access)* (Частный (без анонимного доступа)). |

1. Нажмите кнопку **ОК**, чтобы создать контейнер.
1. Выберите контейнер и щелкните **Отправить**.
1. Выберите оба файла JSON, которые вы создали в разделе, посвященном [получению ABI и байт-кода контракта](#get-contract-abi-and-bytecode).

    ![Отправка большого двоичного объекта](./media/data-manager-portal/upload-blobs.png)

    Выберите команду **Отправить**.

#### <a name="generate-url"></a>Создание URL-адреса

Создайте подписанный URL-адрес для каждого большого двоичного объекта.

1. Выберите большой двоичный объект с кодом JSON для ABI.
1. Щелкните **Создать SAS**.
1. Задайте требуемый срок действия подписи доступа, и щелкните **Создать маркер SAS BLOB-объекта и URL-адрес**.

    ![Создание маркера SAS](./media/data-manager-portal/generate-sas.png)

1. Создайте **URL-адрес SAS BLOB-объекта** и сохраните его для использования в следующем разделе.
1. Повторите шаги [по созданию URL-адреса](#generate-url) для большого двоичного объекта с кодом JSON для байт-кода.

### <a name="add-application-to-instance"></a>Добавление приложения в экземпляр

1. Выберите экземпляр диспетчера данных блокчейна из списка экземпляров.
1. Выберите **Blockchain applications** (Приложения блокчейна).
1. Выберите **Добавить**.

    ![Добавление приложения блокчейна](./media/data-manager-portal/add-application.png)

    Введите имя приложения блокчейна и URL-адреса ABI и байт-кода для смарт-контракта.

    Параметр | Описание
    --------|------------
    Имя | Введите уникальное имя приложения блокчейна, которое нужно отслеживать.
    Contract ABI (ABI контракта) | URL-адрес файла ABI контракта. Подробные сведения см. в разделе о [создании ABI и URL-адреса байт-кода контракта](#create-contract-abi-and-bytecode-url).
    Contract Bytecode (Байт-код контракта) | URL-путь к файлу байт-кода. Подробные сведения см. в разделе о [создании ABI и URL-адреса байт-кода контракта](#create-contract-abi-and-bytecode-url).

1. Щелкните **ОК**.

    Когда приложение будет создано, оно появится в списке приложений блокчейна.

    ![Список приложений блокчейна](./media/data-manager-portal/artifact-list.png)

Вы можете удалить учетную запись хранения Azure или использовать ее для настройки других приложений блокчейна. Если вы хотите удалить учетную запись хранения Azure, можно сразу удалить группу ресурсов. При этом удаляется связанная учетная запись хранения и другие ресурсы, связанные с этой группой ресурсов.

## <a name="stop-instance"></a>Остановка экземпляра

Остановите экземпляр Blockchain Manager, если вы хотите прекратить захват событий блокчейна и отправку данных в исходящие соединения. При прекращении экземпляра плата за нарушение данных Blockchain не взимается. Для получения дополнительной информации [см.](https://azure.microsoft.com/pricing/details/blockchain-service)

1. Перейдите в **Обзор** и выберите **Stop.**

    ![Остановка экземпляра](./media/data-manager-portal/stop-instance.png)

## <a name="next-steps"></a>Дальнейшие действия

Попробуйте следующий учебник, создающий исследователь блокчейн-транзакций, используя Blockchain Data Manager и Azure Cosmos DB.

> [!div class="nextstepaction"]
> [Использование диспетчера данных блокчейна для отправки данных в Azure Cosmos DB](data-manager-cosmosdb.md)