---
title: Использование блокчейн-соединителя Ethereum с Azure Logic Apps
description: Использование блокчейн-соединителя Ethereum с Azure Logic Apps для активации функций и реагирования на события смарт-контракта.
services: azure-blockchain
keywords: ''
author: PatAltimore
ms.author: patricka
ms.date: 09/26/2019
ms.topic: tutorial
ms.service: azure-blockchain
ms.reviewer: chrisseg
manager: femila
ms.openlocfilehash: 48f862bea6df50480ce4f9d21993693da34cfbc9
ms.sourcegitcommit: a19f4b35a0123256e76f2789cd5083921ac73daf
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/02/2019
ms.locfileid: "71720677"
---
# <a name="how-to-use-ethereum-blockchain-connector-with-azure-logic-apps"></a>Использование блокчейн-соединителя Ethereum с Azure Logic Apps

Выполняйте действия смарт-контракта и реагируйте на его события с помощью [блокчейн-соединителя Ethereum](https://docs.microsoft.com/connectors/blockchainethereum/) с [Azure Logic Apps](https://docs.microsoft.com/azure/logic-apps/). Например, вам требуется создать микрослужбу на основе RESTFUL, которая возвращает сведения из реестра блокчейна. С помощью приложения логики можно принимать HTTP-запросы, которые запрашивают сведения, хранящиеся в реестре блокчейна.

## <a name="prerequisites"></a>Предварительные требования

* Выполните дополнительные предварительные требования из руководства [Краткое руководство. Подключение к сети консорциума Блокчейн Azure с помощью Visual Studio Code](connect-vscode.md). В кратком руководстве описывается, как установить [Пакет средств разработки Azure для блокчейна для Ethereum](https://marketplace.visualstudio.com/items?itemName=AzBlockchain.azure-blockchain) и настроить среду разработки блокчейна.

## <a name="create-a-logic-app"></a>Создайте приложение логики

С помощью Azure Logic Apps можно планировать, автоматизировать бизнес-процессы и рабочие процессы, когда необходимо интегрировать системы и службы. Сначала создайте логику, в которой используется блокчейн-соединитель Ethereum.

1. На [портале Azure](https://portal.azure.com) выберите **Создать ресурс > Интеграция > Приложение логики**.
1. В разделе **Создание приложения логики** предоставьте сведения о том, где необходимо создать приложение логики. Когда все будет готово, выберите **Создать**.

    Дополнительные сведения о создании Azure Logic Apps см. в [этом руководстве](../../logic-apps/quickstart-create-first-logic-app-workflow.md).

1. После развертывания приложения в Azure выберите ресурс приложения логики.
1. В разделе **Шаблоны** конструктора приложений логики выберите **Пустое приложение логики**.

Каждое приложение логики должно запускаться по триггеру, который активируется, когда происходит определенное событие или если выполняются заданные условия. При каждом срабатывании триггера обработчик Logic Apps создает экземпляр приложения логики, запускающий и выполняющий рабочий процесс.

В блокчейне-соединителе Ethereum доступен один триггер и несколько действий. Выбор триггера или действия зависит от вашего сценария.

Воспользуйтесь одним из следующих разделов, если ваш рабочий процесс:

* активируется при возникновении события в блокчейне, [используйте триггер события](#use-the-event-trigger);
* запрашивает или развертывает смарт-контракт, [используйте действия](#use-actions);
* идет по распространенному сценарию, [создайте рабочий процесс с помощью комплекта разработчика](#generate-a-workflow).

## <a name="use-the-event-trigger"></a>Использование триггера события

Если требуется, чтобы приложение логики выполнялось после возникновения события смарт-контракта, используйте триггеры событий блокчейна Ethereum. Например, при вызове функции смарт-контракта требуется отправить сообщение электронной почты.

1. В конструкторе приложений логики выберите блокчейн-соединитель Ethereum.
1. На вкладке **Триггеры** выберите **When a smart contract event occurs** (При возникновении события смарт-контракта).
1. Измените или [создайте подключение API](#create-an-api-connection) к службе "Блокчейн Azure".
1. Введите сведения о смарт-контракте, который требуется проверить на наличие событий.

    ![Свойства триггера событий](./media/ethereum-logic-app/event-properties.png)

    | Свойство | ОПИСАНИЕ |
    |----------|-------------|
    | **ABI контракта** | Двоичный интерфейс приложения (ABI) контракта определяет интерфейсы смарт-контракта. Как [получить ABI контракта](#get-contract-abi). |
    | **Адрес смарт-контракта** | Адрес контракта — это адрес назначения смарт-контракта в блокчейне Ethereum. Как получить [адрес контракта](#get-contract-address). |
    | **Имя события** | Выберите событие смарт-контракта, которое необходимо проверить. Событие активирует приложение логики. |
    | **Интервал** и **Частота** | Выберите частоту проверки события. |

1. Щелкните **Сохранить**.

Чтобы завершить создание приложения логики, можно добавить новый шаг, выполняющий действие на основе триггера события блокчейна Ethereum. Например, можно отправить сообщение электронной почты.

## <a name="use-actions"></a>Использование действий

Используйте действия блокчейна Ethereum, если требуется, чтобы приложение логики выполняло действие в реестре блокчейна. Например, требуется создать микрослужбу на основе REST, которая вызывает функцию смарт-контракта при выполнении HTTP-запроса к приложению логики.

Для действий соединителя требуется триггер. Действие блокчейн-соединителя Ethereum можно использовать в качестве следующего шага после триггера. Например, триггер HTTP-запроса для микрослужбы.

1. В конструкторе приложений логики выберите **Новый шаг**, который будет выполняться после триггера.
1. Выберите блокчейн-соединитель Ethereum.
1. На вкладке **Действия** выберите одно из доступных действий.

    ![Свойства действия](./media/ethereum-logic-app/action-properties.png)

1. Измените или [создайте подключение API](#create-an-api-connection) к службе "Блокчейн Azure".
1. В зависимости от выбранного действия укажите следующие сведения о функции смарт-контракта.

    | Свойство | ОПИСАНИЕ |
    |----------|-------------|
    | **ABI контракта** | Двоичный интерфейс приложения (ABI) контракта определяет интерфейсы смарт-контракта. Как [получить ABI контракта](#get-contract-abi). |
    | **Байт-код контракта** | Скомпилированный байт-код смарт-контракта. Как [получить байт-код контракта](#get-contract-bytecode). |
    | **Адрес смарт-контракта** | Адрес контракта — это адрес назначения смарт-контракта в блокчейне Ethereum. Как получить [адрес контракта](#get-contract-address). |
    | **Имя функции смарт-контракта** | Выберите имя функции смарт-контракта для действия. Список заполняется сведениями в интерфейсе ABI контракта. |

    После выбора имени функции смарт-контракта могут отобразиться обязательные поля для параметров функции. Введите значения или динамическое содержимое, необходимое для вашего сценария.

Теперь вы можете использовать приложение логики. При активации события приложения логики запускается действие блокчейна Ethereum. Например, триггер HTTP-запроса запускает действие блокчейна Ethereum для запроса значения состояния смарт-контракта, результатом которого является HTTP-ответ, возвращающий значение.

## <a name="generate-a-workflow"></a>Создание рабочего процесса

Пакет средств разработки Azure для блокчейна для расширения Visual Studio Code Ethereum может создавать рабочие процессы приложения логики для распространенных сценариев. Доступно четыре сценария:

* публикация данных в Базе данных SQL Azure;
* публикация событий в службе "Сетка событий Azure" или "Служебная шина Azure";
* публикация отчетов;
* микрослужба на основе REST.

 Пакет средств разработки Azure для блокчейна использует Truffle для упрощения разработки блокчейна. Чтобы создать приложение логики на основе смарт-контракта, требуется решение Truffle для смарт-контракта. Вам также потребуется подключение к сети консорциума службы "Блокчейн Azure". Дополнительные сведения см. в [кратком руководстве по подключению к сети консорциума службы "Блокчейн Azure" с помощью Visual Studio Code](connect-vscode.md).

Например, с помощью следующих действий можно создать приложение логики микрослужб на основе REST, основанное на смарт-контракте **HelloBlockchain** краткого руководства:

1. На боковой панели обозревателя VS Code разверните папку **contracts** своего решения:
1. Щелкните правой кнопкой мыши файл **HelloBlockchain.sol** и в меню выберите пункт **Generate microservices for smart contracts** (Создать микрослужбы для смарт-контрактов).

    ![Создание приложения логики](./media/ethereum-logic-app/generate-logic-app.png)

1. В палитре команд выберите **Приложение логики**.
1. Введите **адрес контракта**. Дополнительные сведения см. в разделе [Получение адреса контракта](#get-contract-address).
1. Выберите подписку и группу ресурсов Azure для приложения логики.

    В каталоге **generatedLogicApp** создается конфигурация приложения логики и файлы кода.

1. Просмотрите каталог **generatedLogicApp/HelloBlockchain**. Для каждой функции, события и свойства смарт-контракта есть JSON-файл приложения логики.
1. Откройте файл **generatedLogicApp/HelloBlockchain/Service/property.RequestMessage.logicapp.json** и скопируйте содержимое.

    ![JSON для свойства RequestMessage](./media/ethereum-logic-app/requestmessage.png)

1. В приложении логики выберите **Представление кода приложения логики**. Замените имеющийся JSON-файл созданным JSON-файлом приложения логики.

    ![Замена конфигурации приложения логики в представлении кода](./media/ethereum-logic-app/code-view.png)

1. Выберите **Конструктор**, чтобы переключиться в представление конструктора.
1. Приложение логики содержит основные шаги для сценария. Но требуется обновить сведения о конфигурации для блокчейн-соединителя Ethereum.
1. Выберите шаг **Подключения** и измените или [создайте подключение API](#create-an-api-connection) к службе "Блокчейн Azure".

    ![Приложение логики микрослужбы](./media/ethereum-logic-app/microservice-logic-app.png)

1. Теперь вы можете использовать приложение логики. Чтобы протестировать микрослужбу на основе REST, отправьте запрос HTTP POST к URL-адресу запроса приложения логики. Скопируйте **URL-адрес HTTP POST** из шага **При получении HTTP-запроса** .

    ![URL-адрес HTTP POST](./media/ethereum-logic-app/post-url.png)

1. Создайте запрос HTTP POST с помощью cURL. Замените текст заполнителя **\<URL-адрес HTTP POST\>** URL-адресом из предыдущего шага.

    ``` bash
    curl -d "{}" -H "Content-Type: application/json" -X POST "<HTTP POST URL>"
    ```

    Команда cURL возвращает ответ от приложения логики. В этом случае выходные данные функции смарт-контракта **RequestMessage**.

    ![Выходные данные свойства RequestMessage](./media/ethereum-logic-app/curl.png)

Дополнительные сведения об использовании Пакета средств разработки Azure для блокчейна для Ethereum см. на [этой вики-странице](https://github.com/Microsoft/vscode-azure-blockchain-ethereum/wiki).

## <a name="create-an-api-connection"></a>Создание подключения API

Для блокчейн-соединителя Ethereum требуется подключение API к блокчейну. Соединитель API можно использовать для нескольких приложений логики. Некоторые свойства являются обязательными, а другие зависят от вашего сценария.

> [!IMPORTANT]
> Для создания транзакций в блокчейне требуется закрытый ключ или адрес учетной записи и пароль. Требуется только одна форма проверки подлинности. Вам не нужно предоставлять закрытый ключ и сведения об учетной записи. Для запросов контрактов транзакция не требуется. Если вы используете действия, которые запрашивают сведения о состоянии контракта, закрытый ключ или адрес учетной записи и пароль не требуются.

Чтобы настроить подключение к участнику службы "Блокчейн Azure", в зависимости от вашего сценария могут потребоваться следующие свойства.

| Свойство | ОПИСАНИЕ |
|----------|-------------|
|**Имя подключения** | Имя подключения API. Обязательный элемент. |
|**Конечная точка Ethereum RPC** | HTTP-адрес узла транзакций службы "Блокчейн Azure". Обязательный элемент. Как [получить конечную точку RPC](#get-rpc-endpoint). |
|**Закрытый ключ** | Закрытый ключ учетной записи Ethereum. Для транзакций требуются закрытый ключ, адрес учетной записи и пароль. Как [получить закрытый ключ](#get-private-key) |
|**Адрес учетной записи** | Адрес учетной записи участника службы "Блокчейн Azure". Для транзакций требуются закрытый ключ, адрес учетной записи и пароль. Как [получить адрес учетной записи](#get-account-address). |
|**Пароль учетной записи** | Пароль учетной записи задается при создании участника. Сведения о сбросе пароля см. в разделе [Учетная запись Ethereum](consortium.md#ethereum-account).|

## <a name="get-rpc-endpoint"></a>Получение конечной точки RPC

Для подключения к сети блокчейна требуется адрес конечной точки RPC службы "Блокчейн Azure". Адрес конечной точки можно получить с помощью Пакета средств разработки Azure для блокчейна для Ethereum или на портале Azure.

**С использованием комплекта SDK:**

1. В разделе **Служба "Блокчейн Azure"** в Visual Studio Code щелкните правой кнопкой мыши консорциум.
1. Выберите **Copy RPC endpoint** (Копировать конечную точку RPC).

    ![Копирование конечной точки RPC](./media/ethereum-logic-app/devkit-rpc.png)

    Конечная точка RPC скопируется в буфер обмена.

**С использованием портала Azure:**

1. Войдите на [портале Azure](https://portal.azure.com).
1. Перейдите в область участника службы "Блокчейн Azure". Выберите **Transaction nodes** (Узлы транзакций) и щелкните ссылку на узел транзакций по умолчанию.

    ![Выбор узла транзакций по умолчанию](./media/ethereum-logic-app/transaction-nodes.png)

1. Последовательно выберите **Строки подключения > Ключи доступа**.
1. Скопируйте адрес конечной точки из раздела **HTTPS (Access key 1)** (HTTPS (ключ доступа 1)) или ключ доступа 2.

    ![Строка подключения](./media/ethereum-logic-app/connection-string.png)

    Конечная точка RPC — это URL-адрес HTTPS, включая адрес и ключ доступа узла транзакции участника службы "Блокчейн Azure".

## <a name="get-private-key"></a>Получение закрытого ключа

С помощью закрытого ключа учетной записи Ethereum можно выполнять проверку подлинности при отправке транзакции в блокчейн. Открытый и закрытый ключи учетной записи Ethereum создаются из 12 назначенных символов. Назначенные символы создаются в Пакете средств разработки Azure для блокчейна для Ethereum при подключении к участнику консорциума службы "Блокчейн Azure". Адрес конечной точки можно получить с помощью расширения комплекта SDK.

1. Откройте палитру команд (F1) в Visual Studio Code.
1. Выберите **Azure Blockchain: Retrieve private key** (Блокчейн Azure: получение закрытого ключа).
1. Выберите сохраненный назначенный символ при подключении к участнику консорциума.

    ![Выбор назначенного символа](./media/ethereum-logic-app/private-key.png)

    Закрытый ключ скопируется в буфер обмена.

## <a name="get-account-address"></a>Получение адреса учетной записи

С использованием учетной записи и пароля участника можно выполнять проверку подлинности при отправке транзакции в блокчейн. Пароль задается при создании участника.

1. На портале Azure перейдите на страницу обзора службы "Блокчейн Azure".
1. Скопируйте адрес **учетной записи участника**.

    ![Копирование учетной записи участника](./media/ethereum-logic-app/member-account.png)

Дополнительные сведения об адресе и пароле учетной записи см. в разделе [Учетная запись Ethereum](consortium.md#ethereum-account).

## <a name="get-contract-abi"></a>Получение ABI контракта

Двоичный интерфейс приложения (ABI) контракта определяет интерфейсы смарт-контракта. В нем описывается взаимодействие со смарт-контрактом. Интерфейс ABI контракта можно получить с помощью Пакета средств разработки Azure для блокчейна для Ethereum или файла метаданных контракта компилятора Solidity.

**С использованием комплекта SDK:**

Если для создания смарт-контракта использовался комплект SDK или Truffle, вы можете скопировать интерфейс ABI контракта в буфер обмена с помощью расширения.

1. На панели обозревателя Visual Studio Code разверните папку **build/contracts** проекта Solidity.
1. Правой кнопкой мыши щелкните JSON-файл метаданных контракта. Имя файла — это имя смарт-контракта, за которым следует расширение **.json**.
1. Выберите **Copy contract ABI** (Скопировать ABI контракта).

    ![Копирование интерфейса ABI контракта с помощью комплекта SDK](./media/ethereum-logic-app/abi-devkit.png)

    ABI контракта скопируется в буфер обмена.

**С использованием файла метаданных контракта:**

1. Откройте файл метаданных контракта, содержащийся в папке **build/contracts** проекта Solidity. Имя файла — это имя смарт-контракта, за которым следует расширение **.json**.
1. Найдите раздел **abi** в файле JSON.
1. Скопируйте массив JSON **abi**.

    ![Раздел ABI контракта в метаданных](./media/ethereum-logic-app/abi-metadata.png)

## <a name="get-contract-bytecode"></a>Получение байт-кода контракта

Байт-код контракта — это скомпилированный смарт-контракт, выполняемый виртуальной машиной Ethereum. Байт-код контракта можно получить с помощью Пакета средств разработки Azure для блокчейна для Ethereum или компилятора Solidity.

**С использованием комплекта SDK:**

Если для создания смарт-контракта использовался комплект SDK или Truffle, вы можете скопировать байт-код контракта в буфер обмена с помощью расширения.

1. На панели обозревателя Visual Studio Code разверните папку **build/contracts** проекта Solidity.
1. Правой кнопкой мыши щелкните JSON-файл метаданных контракта. Имя файла — это имя смарт-контракта, за которым следует расширение **.json**.
1. Выберите **Copy contract bytecode** (Скопировать байт-код контракта).

    ![Копирование байта-кода контракта с помощью комплекта SDK](./media/ethereum-logic-app/bytecode-devkit.png)

    Байт-код контракта скопируется в буфер обмена.

**С использованием файла метаданных контракта:**

1. Откройте файл метаданных контракта, содержащийся в папке **build/contracts** проекта Solidity. Имя файла — это имя смарт-контракта, за которым следует расширение **.json**.
1. Найдите элемент **bytecode** в файле JSON.
1. Скопируйте значение **bytecode**.

    ![Копирование байт-кода с помощью метаданных](./media/ethereum-logic-app/bytecode-metadata.png)

**С использованием компилятора Solidity:**

Чтобы создать байт-код контракта, используйте команду `solc --bin <smart contract>.sol`.

## <a name="get-contract-address"></a>Получение адреса контракта

Адрес контракта — это адрес назначения смарт-контракта в блокчейне Ethereum. Этот адрес используется для отправки транзакции или запроса состояния смарт-контракта. Адрес контракта можно получить из выходных данных миграции Truffle или файла метаданных контракта.

**С использованием выходных данных миграции Truffle:**

Truffle отображает адрес контракта после развертывания смарт-контракта. Скопируйте **адрес контракта** из выходных данных.

![Адрес контракта из выходных данных Truffle](./media/ethereum-logic-app/contract-address-truffle.png)

**С использованием файла метаданных контракта:**

1. Откройте файл метаданных контракта, содержащийся в папке **build/contracts** проекта Solidity. Имя файла — это имя смарт-контракта, за которым следует расширение **.json**.
1. Найдите раздел **networks** в файле JSON.
1. Частные сети определяются по целочисленному идентификатору сети. Найдите значение адреса в разделе сети.
1. Скопируйте значение **address**.

![Адрес контракта из метаданных](./media/ethereum-logic-app/contract-address-metadata.png)

## <a name="next-steps"></a>Дополнительная информация

Ознакомьтесь с распространенными [сценариями подключения блокчейн-решений с помощью Azure Logic Apps](https://channel9.msdn.com/Shows/Blocktalk/Doing-more-with-Logic-Apps?term=logic%20apps%20blockchain&lang-en=true)
