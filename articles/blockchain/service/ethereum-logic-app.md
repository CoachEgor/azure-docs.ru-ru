---
title: Использование соединителя Ethereum Блокчейн с Azure Logic Apps
description: Используйте соединитель Ethereum Блокчейн с Azure Logic Apps, чтобы активировать функции интеллектуального контракта и реагировать на события смарт-контракта.
services: azure-blockchain
keywords: ''
author: PatAltimore
ms.author: patricka
ms.date: 10/14/2019
ms.topic: article
ms.service: azure-blockchain
ms.reviewer: chrisseg
manager: femila
ms.openlocfilehash: bb23d6b9b42e1c51646765255870a14a1b5d39f7
ms.sourcegitcommit: f4d8f4e48c49bd3bc15ee7e5a77bee3164a5ae1b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2019
ms.locfileid: "73579941"
---
# <a name="use-the-ethereum-blockchain-connector-with-azure-logic-apps"></a>Использование соединителя Ethereum Блокчейн с Azure Logic Apps

Используйте [соединитель Ethereum блокчейн](https://docs.microsoft.com/connectors/blockchainethereum/) с [Azure Logic Apps](https://docs.microsoft.com/azure/logic-apps/) для выполнения действий интеллектуального контракта и реагирования на события смарт-контракта. Например, предположим, что вы хотите создать микрослужбу на основе RESTFUL, которая возвращает информацию из блокчейн книги. С помощью приложения логики можно принимать HTTP-запросы, которые запрашивают сведения, хранящиеся в блокчейн книге.

## <a name="prerequisites"></a>Предварительные требования

Выполните дополнительную предварительную проверку [: используйте Visual Studio Code для подключения к сети консорциума Блокчейн службы Azure](connect-vscode.md). В кратком руководстве описывается, как установить [пакет Azure Блокчейн Development Kit для Ethereum](https://marketplace.visualstudio.com/items?itemName=AzBlockchain.azure-blockchain) и настроить среду разработки блокчейн.

## <a name="create-a-logic-app"></a>Создайте приложение логики

Azure Logic Apps помогает планировать и автоматизировать бизнес-процессы и рабочие процессы, когда необходимо интегрировать системы и службы. Сначала создается логика, использующая соединитель Блокчейн Ethereum.

1. На [портале Azure](https://portal.azure.com) выберите **Создать ресурс** > **Интеграция** > **Приложение логики**.
1. В разделе **Создание приложения логики**укажите сведения о том, где можно создать приложение логики. Когда все будет готово, выберите **Создать**.

    Дополнительные сведения о создании приложений логики см. в статье [Создание автоматических рабочих процессов с помощью Azure Logic Apps](../../logic-apps/quickstart-create-first-logic-app-workflow.md).

1. После развертывания приложения Azure выберите ресурс приложения логики.
1. В конструкторе Logic Apps в разделе **шаблоны**выберите **пустое приложение логики**.

Каждое приложение логики должно запускаться по триггеру, который активируется, когда происходит определенное событие или если выполняются заданные условия. При каждом срабатывании триггера обработчик Logic Apps создает экземпляр приложения логики, запускающий и выполняющий рабочий процесс.

Соединитель Блокчейн Ethereum имеет один триггер и несколько действий. Какой триггер или действие вы используете, зависит от вашего сценария.

Если ваш рабочий процесс:

* Активируется при возникновении события в блокчейн с [помощью триггера события](#use-the-event-trigger).
* Запрашивает или развертывает смарт-контракт, [используйте действия](#use-actions).
* Следует использовать распространенный сценарий, [создающий рабочий процесс с помощью набора разработчика](#generate-a-workflow).

## <a name="use-the-event-trigger"></a>Использование триггера события

Используйте триггеры событий Ethereum Блокчейн, если требуется, чтобы приложение логики выполнялось после возникновения события интеллектуального контракта. Например, вы хотите отправить сообщение электронной почты при вызове функции смарт-контракта.

1. В конструкторе Logic Apps выберите соединитель Блокчейн Ethereum.
1. На вкладке **триггеры** выберите **время возникновения события интеллектуального контракта**.
1. Измените или [Создайте подключение API](#create-an-api-connection) к службе блокчейн Azure.
1. Введите сведения о смарт-контракте, которые требуется проверить на наличие событий.

    ![Конструктор Logic Apps со свойствами триггеров событий](./media/ethereum-logic-app/event-properties.png)

    | Свойство | Description (Описание) |
    |----------|-------------|
    | **Интерфейс ABI контракта** | Двоичный интерфейс приложения контракта (ABI) определяет интерфейсы интеллектуального контракта. Дополнительные сведения см. [в разделе Получение интерфейса ABI контракта](#get-the-contract-abi). |
    | **Адрес смарт-контракта** | Адрес контракта — это адрес назначения смарт-контракта на Ethereum блокчейн. Дополнительные сведения см. [в разделе Получение адреса контракта](#get-the-contract-address). |
    | **Имя события** | Выберите событие интеллектуального контракта для проверки. Событие активирует приложение логики. |
    | **Интервал** и **Частота** | Укажите, как часто требуется проверять событие. |

1. Щелкните **Сохранить**.

Чтобы завершить работу приложения логики, можно добавить новый шаг, выполняющий действие на основе триггера события Ethereum Блокчейн. Например, отправьте сообщение электронной почты.

## <a name="use-actions"></a>Использование действий

Используйте действия Ethereum Блокчейн, если требуется, чтобы приложение логики выполняло действие в книге блокчейн. Например, вы хотите создать микрослужбу на основе RESTFUL, которая вызывает функцию смарт-контракта при выполнении HTTP-запроса к приложению логики.

Для действий соединителя требуется триггер. Действие соединителя Ethereum Блокчейн можно использовать как следующий шаг после триггера, например триггер HTTP-запроса для микрослужбы.

1. В конструкторе Logic Apps выберите **новый шаг** после триггера.
1. Выберите соединитель Ethereum Блокчейн.
1. На вкладке **действия** выберите одно из доступных действий.

    ![Конструктор Logic Apps со свойствами действий](./media/ethereum-logic-app/action-properties.png)

1. Измените или [Создайте подключение API](#create-an-api-connection) к службе блокчейн Azure.
1. В зависимости от выбранного действия укажите следующие сведения о функции интеллектуального контракта.

    | Свойство | Description (Описание) |
    |----------|-------------|
    | **Интерфейс ABI контракта** | Интерфейс ABI контракта определяет интерфейсы интеллектуального контракта. Дополнительные сведения см. [в разделе Получение интерфейса ABI контракта](#get-the-contract-abi). |
    | **Код байта контракта** | Скомпилированный код байта смарт-контракта. Дополнительные сведения см. [в разделе Получение байтового кода контракта](#get-the-contract-bytecode). |
    | **Адрес смарт-контракта** | Адрес контракта — это адрес назначения смарт-контракта на Ethereum блокчейн. Дополнительные сведения см. [в разделе Получение адреса контракта](#get-the-contract-address). |
    | **Имя функции интеллектуального контракта** | Выберите имя функции интеллектуального контракта для действия. Список заполняется сведениями в интерфейсе ABI контракта. |

    После выбора имени функции смарт-контракта могут отображаться обязательные поля для параметров функции. Введите значения или динамическое содержимое, необходимое для вашего сценария.

Теперь вы можете использовать приложение логики. При активации события приложения логики запускается действие Ethereum Блокчейн. Например, триггер HTTP-запроса запускает действие Ethereum блокчейн для запроса значения состояния интеллектуального контракта. Этот запрос приводит к получению HTTP-ответа, возвращающего значение.

## <a name="generate-a-workflow"></a>Создание рабочего процесса

Модуль Azure Блокчейн Development Kit для расширения Ethereum Visual Studio Code может создавать рабочие процессы приложения логики для распространенных сценариев. Доступны четыре сценария:

* Публикация данных в экземпляре базы данных SQL Azure
* Публикация событий в экземпляре службы "Сетка событий Azure" или "служебная шина Azure"
* Публикация отчетов
* Микрослужба на основе RESTFUL

 Пакет Azure Блокчейн Development Kit использует Труффле для упрощения разработки блокчейн. Чтобы создать приложение логики на основе смарт-контракта, требуется Труффле решение для смарт-контракта. Вам также потребуется подключение к сети консорциума Блокчейн службы Azure. Дополнительные сведения см. в статье [использование Visual Studio Code для подключения к краткому руководству по сети консорциума Блокчейн службы Azure](connect-vscode.md).

Например, следующие шаги создают приложение логики микрослужб на основе RESTFUL на основе смарт-контракта быстрого **хеллоблоккчаин** :

1. В боковой панели обозревателя Visual Studio Code разверните папку **контракты** в решении.
1. Щелкните правой кнопкой мыши **хеллоблоккчаин. Sol** и выберите в меню пункт **создать Микрослужбы для смарт-контрактов** .

    ![Панель Visual Studio Code с созданием микрослужб для выбора смарт-контрактов](./media/ethereum-logic-app/generate-logic-app.png)

1. В палитре команд выберите **приложение логики**.
1. Введите **адрес контракта**. Дополнительные сведения см. [в разделе Получение адреса контракта](#get-the-contract-address).
1. Выберите подписку Azure и группу ресурсов для приложения логики.

    Конфигурация приложения логики и файлы кода создаются в каталоге **женератедлогикапп** .

1. Просмотрите каталог **женератедлогикапп/хеллоблоккчаин** . Существует JSON-файл приложения логики для каждой функции, события и свойства интеллектуального контракта.
1. Откройте **женератедлогикапп/хеллоблоккчаин/Service/Property. Файл Рекуестмессаже. logicapp. JSON** и скопируйте его содержимое.

    ![Файл JSON с кодом для копирования](./media/ethereum-logic-app/requestmessage.png)

1. В приложении логики выберите **представление кода приложения логики**. Замените существующий JSON созданным приложением логики JSON.

    ![Представление кода приложения логики с новым замененным кодом приложения](./media/ethereum-logic-app/code-view.png)

1. Выберите **конструктор** , чтобы переключиться в представление конструктора.
1. Приложение логики включает основные шаги для сценария. Однако необходимо обновить сведения о конфигурации для соединителя Ethereum Блокчейн.
1. Выберите шаг **подключения** и измените или [Создайте подключение API](#create-an-api-connection) к службе блокчейн Azure.

    ![Представление конструктора с выбором подключений](./media/ethereum-logic-app/microservice-logic-app.png)

1. Теперь вы можете использовать приложение логики. Чтобы протестировать микрослужбу на основе RESTFUL, отправьте запрос HTTP POST к URL-адресу запроса приложения логики. Скопируйте содержимое **URL-адреса HTTP POST** из шага **при получении HTTP-запроса** .

    ![Панель конструктора Logic Apps с URL-адресом HTTP POST](./media/ethereum-logic-app/post-url.png)

1. Используйте фигурную скобку для создания запроса HTTP POST. Замените текст заполнителя *\<URL-адрес HTTP POST\>* URL-адресом из предыдущего шага.

    ``` bash
    curl -d "{}" -H "Content-Type: application/json" -X POST "<HTTP POST URL>"
    ```

    Команда «прилистывание» возвращает ответ от приложения логики. В этом случае ответ — это выходная функция интеллектуального контракта **рекуестмессаже** .

    ![Вывод кода из функции Smart Contract Рекуестмессаже](./media/ethereum-logic-app/curl.png)

Дополнительные сведения об использовании пакета средств разработки см. на [вики-странице Azure Блокчейн Development Kit для Ethereum](https://github.com/Microsoft/vscode-azure-blockchain-ethereum/wiki).

## <a name="create-an-api-connection"></a>Создание подключения API

Для соединителя Ethereum Блокчейн требуется подключение API к блокчейн. Соединитель API можно использовать для нескольких приложений логики. Некоторые свойства являются обязательными, а другие зависят от вашего сценария.

> [!IMPORTANT]
> Для создания транзакций в блокчейн требуются закрытый ключ, адрес учетной записи и пароль. Требуется только одна форма проверки подлинности. Вам не нужно предоставлять сведения о закрытом ключе и учетной записи. Для запросов к контрактам транзакция не требуется. Если вы используете действия, которые запрашивают состояние контракта, закрытый ключ или адрес учетной записи и пароль не требуются.

Чтобы настроить подключение к члену службы Azure Блокчейн, в списке ниже перечислены возможные свойства, которые могут потребоваться в зависимости от вашего сценария.

| Свойство | Description (Описание) |
|----------|-------------|
|**Имя подключения** | Имя подключения API. обязательный параметр. |
|**Конечная точка RPC Ethereum** | HTTP-адрес узла транзакции службы Azure Блокчейн. обязательный параметр. Дополнительные сведения см. [в статье Получение конечной точки RPC](#get-the-rpc-endpoint). |
|**Закрытый ключ** | Закрытый ключ учетной записи Ethereum. Для транзакций требуются закрытый ключ, адрес учетной записи и пароль. Дополнительные сведения см. [в разделе Получение закрытого ключа](#get-the-private-key). |
|**Адрес учетной записи** | Адрес учетной записи участника службы Azure Блокчейн. Для транзакций требуются закрытый ключ, адрес учетной записи и пароль. Дополнительные сведения см. [в разделе Получение адреса учетной записи](#get-the-account-address). |
|**Пароль учетной записи** | Пароль учетной записи задается при создании члена. Сведения о сбросе пароля см. в разделе [Ethereum Account](consortium.md#ethereum-account).|

## <a name="get-the-rpc-endpoint"></a>Получение конечной точки RPC

Для подключения к сети блокчейн требуется адрес конечной точки RPC службы Azure Блокчейн. Адрес конечной точки можно получить с помощью пакета Azure Блокчейн Development Kit для Ethereum или портал Azure.

**Чтобы использовать пакет средств разработки, выполните следующие действия.**

1. В разделе **Служба Блокчейн Azure** в Visual Studio Code щелкните правой кнопкой мыши консорциум.
1. Выберите **Копировать адрес конечной точки RPC**.

    ![Visual Studio Code панель, показывающая консорциума с выбором адреса конечной точки RPC Copy](./media/ethereum-logic-app/devkit-rpc.png)

    Конечная точка RPC копируется в буфер обмена.

**Чтобы использовать портал Azure, выполните следующие действия.**

1. Войдите на [портал Azure](https://portal.azure.com).
1. Перейдите к своему члену службы Azure Блокчейн. Выберите **Transaction nodes** (Узлы транзакций) и щелкните ссылку на узел транзакций по умолчанию.

    ![Страница «узлы транзакций» с выбором (узел по умолчанию)](./media/ethereum-logic-app/transaction-nodes.png)

1. Выберите **строки подключения** > **ключи доступа**.
1. Скопируйте адрес конечной точки с **HTTPS (ключ доступа 1)** или **HTTPS (ключ доступа 2)** .

    ![портал Azure с ключами доступа к строке подключения](./media/ethereum-logic-app/connection-string.png)

    Конечная точка RPC — это URL-адрес HTTPS, включающий адрес и ключ доступа для узла транзакции члена службы Azure Блокчейн.

## <a name="get-the-private-key"></a>Получение закрытого ключа

Для проверки подлинности при отправке транзакции в блокчейн можно использовать закрытый ключ учетной записи Ethereum. Открытый и закрытый ключи учетной записи Ethereum формируются из 12-словных клавиш. Пакет Azure Блокчейн Development Kit для Ethereum создает назначенный символ при подключении к члену службы Azure Блокчейн Service Consortium. Адрес конечной точки можно получить с помощью расширения комплекта разработки.

1. В Visual Studio Code откройте палитру команд (F1).
1. Выберите **Azure блокчейн: Получение закрытого ключа**.
1. Выберите назначенный, сохраненный при соединении с элементом консорциума.

    ![Палитра команд с возможностью выбора назначенной клавиши](./media/ethereum-logic-app/private-key.png)

    Закрытый ключ будет скопирован в буфер обмена.

## <a name="get-the-account-address"></a>Получение адреса учетной записи

Вы можете использовать учетную запись и пароль участника для проверки подлинности при отправке транзакции в блокчейн. Пароль задается при создании члена.

1. В портал Azure перейдите на страницу обзора службы Azure Блокчейн.
1. Скопируйте адрес **учетной записи участника** .

    ![Страница обзора с адресом учетной записи участника](./media/ethereum-logic-app/member-account.png)

Дополнительные сведения об адресе учетной записи и пароле см. в разделе [Ethereum Account](consortium.md#ethereum-account).

## <a name="get-the-contract-abi"></a>Получение интерфейса ABI контракта

Интерфейс ABI контракта определяет интерфейсы интеллектуального контракта. В нем описывается взаимодействие с интеллектуальным контрактом. Чтобы получить интерфейс ABI контракта, воспользуйтесь пакетом Azure Блокчейн Development Kit для Ethereum. Его также можно получить из файла метаданных контракта, созданного компилятором плотности.

**Чтобы использовать пакет средств разработки, выполните следующие действия.**

Если вы использовали пакет средств разработки или Труффле для создания смарт-контракта, вы можете использовать расширение, чтобы скопировать интерфейс ABI контракта в буфер обмена.

1. В области Обозреватель Visual Studio Code разверните папку **Сборка/контракты** проекта со своей плотностью.
1. Щелкните правой кнопкой мыши JSON-файл метаданных контракта. Имя файла — это имя смарт-контракта, за которым следует расширение **JSON** .
1. Выберите **Копировать контракт ABI**.

    ![Панель Visual Studio Code с выбранным параметром ABI контракта копирования](./media/ethereum-logic-app/abi-devkit.png)

    Интерфейс ABI контракта копируется в буфер обмена.

**Чтобы использовать файл метаданных контракта, выполните следующие действия.**

1. Откройте файл метаданных контракта, содержащийся в папке **Build/Contracts** проекта со своей плотностью. Имя файла — это имя смарт-контракта, за которым следует расширение **JSON** .
1. Найдите раздел **ABI** в файле JSON.
1. Скопируйте массив JSON **ABI** .

    ![Код ABI в файле метаданных контракта](./media/ethereum-logic-app/abi-metadata.png)

## <a name="get-the-contract-bytecode"></a>Получить байтовый код контракта

Байт-код контракта — это скомпилированный интеллектуальный контракт, выполняемый виртуальной машиной Ethereum. Байт контракта можно получить с помощью пакета Azure Блокчейн Development Kit для Ethereum. Его также можно получить из компилятора плотности.

**Чтобы использовать пакет средств разработки, выполните следующие действия.**

Если вы использовали пакет средств разработки или Труффле для создания интеллектуального контракта, вы можете использовать расширение, чтобы скопировать байт-код контракта в буфер обмена.

1. В области Обозреватель Visual Studio Code разверните папку **Сборка/контракты** проекта со своей плотностью.
1. Щелкните правой кнопкой мыши JSON-файл метаданных контракта. Имя файла — это имя смарт-контракта, за которым следует расширение **JSON** .
1. Выберите **Копировать код байт контракта**.

    ![Панель Visual Studio Code с выбором байтового кода контракта копирования](./media/ethereum-logic-app/bytecode-devkit.png)

    Байт-код контракта копируется в буфер обмена.

**Чтобы использовать файл метаданных контракта, выполните следующие действия.**

1. Откройте файл метаданных контракта, содержащийся в папке **Build/Contracts** проекта со своей плотностью. Имя файла — это имя смарт-контракта, за которым следует расширение **JSON** .
1. Найдите элемент **байт** в файле JSON.
1. Скопируйте значение **байтового кода** .

    ![Панель Visual Studio Code с байтом в метаданных](./media/ethereum-logic-app/bytecode-metadata.png)

**Чтобы использовать компилятор плотности, выполните следующие действия.**

Чтобы создать байтовый код контракта, используйте команду `solc --bin <smart contract>.sol`.

## <a name="get-the-contract-address"></a>Получение адреса контракта

Адрес контракта — это адрес назначения смарт-контракта на Ethereum блокчейн. Этот адрес используется для отправки транзакции или состояния запроса смарт-контракта. Адрес контракта можно получить из выходных данных миграции Труффле или файла метаданных контракта.

**Чтобы использовать выходные данные миграции Труффле, выполните следующие действия.**

Труффле отображает адрес контракта после развертывания смарт-контракта. Скопируйте **адрес контракта** из выходных данных.

![Труффле данные миграции с адресом контракта в Visual Studio Code](./media/ethereum-logic-app/contract-address-truffle.png)

**Чтобы использовать файл метаданных контракта, выполните следующие действия.**

1. Откройте файл метаданных контракта, содержащийся в папке **Build/Contracts** проекта со своей плотностью. Имя файла — это имя смарт-контракта, за которым следует расширение **JSON** .
1. Найдите раздел **Networks** в файле JSON.
1. Частные сети идентифицируются по целочисленному ИДЕНТИФИКАТОРу сети. Найдите значение адреса в разделе Network (сеть).
1. Скопируйте значение **адреса** .

![Метаданные со значением адреса в Visual Studio Code](./media/ethereum-logic-app/contract-address-metadata.png)

## <a name="next-steps"></a>Дальнейшие действия

Следите за распространенными сценариями в видео, [поLogic Apps](https://channel9.msdn.com/Shows/Blocktalk/Doing-more-with-Logic-Apps?term=logic%20apps%20blockchain&lang-en=true).
