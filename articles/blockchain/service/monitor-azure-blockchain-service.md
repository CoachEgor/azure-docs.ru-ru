---
title: Мониторинг службы Azure Блокчейн Service (ABS)
description: Наблюдение за службой Azure Блокчейн с помощью Azure Monitor
ms.date: 01/08/2020
ms.topic: article
ms.reviewer: coborn
ms.openlocfilehash: 8c2dc6afeaa00e4c7455940cbdf5a7acd6e17394
ms.sourcegitcommit: 5b073caafebaf80dc1774b66483136ac342f7808
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/09/2020
ms.locfileid: "75780409"
---
# <a name="monitor-azure-blockchain-service-through-azure-monitor"></a>Мониторинг службы Блокчейн Azure с помощью Azure Monitor  

Так как клиенты выполняют блокчейн сценарии производственного класса в службе Блокчейн Azure (ABS), очень важно отслеживать ресурсы на предмет доступности, производительности и операций. В этой статье описываются данные мониторинга, созданные службой Azure Блокчейн, а также способы использования различных функций и интеграции Azure Monitor для анализа и оповещений для управления средами производственного уровня.  

## <a name="what-is-azure-monitor"></a>Общие сведения об Azure Monitor

Служба Блокчейн Azure создает данные мониторинга с помощью Azure Monitor, которая представляет собой полную службу мониторинга стека в Azure, которая предоставляет полный набор функций для мониторинга ресурсов Azure. Дополнительные сведения о Azure Monitor см. [в статье мониторинг ресурсов Azure с помощью Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/insights/monitor-azure-resource).
 

В следующих разделах описывается описание данных, собранных из службы Блокчейн Azure, и приводятся примеры настройки сбора данных и анализа этих данных с помощью средств Azure.

## <a name="monitor-data-collected-from-azure-blockchain-service"></a>Мониторинг данных, собранных из службы Блокчейн Azure  

Служба Блокчейн Azure собирает данные мониторинга такого же типа, как и другие ресурсы Azure, которые описаны в разделе [мониторинг данных](https://docs.microsoft.com/azure/azure-monitor/insights/monitor-azure-resource#monitoring-data) из ресурсов Azure. Подробный справочник по журналам и метрикам, созданным службой Azure Блокчейн, см. в статье [мониторинг справочника по данным службы Блокчейн Azure](#monitor-azure-blockchain-service-data-reference) .

На странице Обзор в портал Azure для каждого ресурса-члена службы Azure Блокчейн содержится краткое представление транзакций, включая обработанные и обработанные блоки запросов. Некоторые из этих данных автоматически собираются и доступны для анализа после создания ресурса члена службы Azure Блокчейн, в то время как можно включить дополнительный сбор данных с дополнительной конфигурацией.

## <a name="diagnostic-settings"></a>Параметры диагностики  

Метрики платформы и журнал действий собираются автоматически, но необходимо создать параметр диагностики для сбора журналов ресурсов или пересылки их за пределы Azure Monitor. Подробный процесс создания параметров диагностики с помощью портал Azure, CLI или PowerShell см. в статье [Создание параметров диагностики для сбора журналов и метрик платформы в Azure](https://docs.microsoft.com/azure/azure-monitor/platform/diagnostic-settings) .

При создании параметра диагностики необходимо указать, какие категории журналов должны быть собраны. Ниже перечислены категории для службы Блокчейн Azure.

**Журналы прокси-сервера блокчейн** — выберите категорию, если требуется отслеживать журналы прокси-сервера нгникс. Все сведения о транзакциях клиента доступны для целей аудита и отладки.  

**Журналы приложений блокчейн** — выберите категорию для получения журналов приложения блокчейн, размещенного в управляемой службе. Например, для члена ABS-кворума эти журналы будут являться журналами самого кворума.  

**Запросы метрик**. Выберите параметр сбора данных метрик из Azure Cosmos DB к местам назначения в параметре диагностики, который автоматически собирается в метриках Azure. Собирайте данные метрик с помощью журналов ресурсов для одновременного анализа обоих видов данных и отправки данных метрик за пределы Azure Monitor.

## <a name="analyze-metric-data"></a>Анализ данных метрик  

Вы можете анализировать метрики для службы Блокчейн Azure с помощью обозревателя метрик, перейдя по вкладке метрики в разделе Мониторинг в колонке ресурсов ABS. Дополнительные сведения об использовании этого средства см. в статье [Приступая к работе с Azure обозреватель метрик](https://docs.microsoft.com/azure/azure-monitor/platform/metrics-getting-started) . Полные метрики для службы Azure Блокчейн находятся в стандартных метриках пространства имен службы Azure Блокчейн.

Можно использовать измерение **node** при добавлении фильтра или разделении метрик, что по сути предоставляет значения метрик на узлы транзакций и узлы проверяющего элемента ABS.

## <a name="analyze-log-data"></a>Анализ данных журналов

Ниже приведены некоторые запросы, которые можно ввести на панели поиска журналов, чтобы помочь в мониторинге членов службы Блокчейн Azure. Эти запросы поддерживают [новый язык](https://docs.microsoft.com/azure/azure-monitor/log-query/log-query-overview).

Чтобы запросить условия ошибки в журналах приложений Блокчейн, используйте следующий запрос:

```
BlockchainApplicationLog | where BlockchainMessage contains "ERROR" or BlockchainMessage contains "fatal"

```

Чтобы запросить условия ошибки в журналах прокси-сервера Блокчейн, используйте приведенный ниже запрос.  


```
BlockchainProxyLog
| filter Code != 200
| limit 500

```
Вы можете использовать фильтры времени, доступные в журналах Azure, чтобы отфильтровать запрос по определенному диапазону времени.

## <a name="monitor-azure-blockchain-service-data-reference"></a>Справочник по мониторингу данных службы Блокчейн Azure  

В этой статье содержится ссылка на данные журнала и метрики, собранные для анализа производительности и доступности службы Блокчейн Azure.  

### <a name="resource-logs"></a>Журналы ресурсов

Все журналы ресурсов совместно используют общую схему верхнего уровня с несколькими уникальными свойствами, характерными для службы блокчейн. См. статью о [схеме журналов ресурсов верхнего уровня](https://docs.microsoft.com/azure/azure-monitor/platform/diagnostic-logs-schema#top-level-resource-logs-schema), сведения о свойствах, связанных со службой Azure блокчейн, приведены ниже.  

В следующей таблице перечислены свойства журналов прокси-сервера Azure Блокчейн при их сборе в Azure Monitor журналов или службе хранилища Azure.  


| Имя свойства  | Description |
|:---|:---|
| time | Дата и время (UTC) выполнения операции. |
| Идентификатора  | Ресурс службы Azure Блокчейн, для которого включены журналы.  |
| категория  |Для службы Azure Блокчейн допустимыми значениями являются **проксилогс** и **аппликатионлогс**. |
| operationName  | Имя операции, которую представляет это событие.   |
| Уровень журнала  | По умолчанию служба Блокчейн Azure включает **информационный** уровень ведения журнала.   |
| ноделокатион  | Регион Azure, в котором развернут член блокчейн.  |
| блоккчаинноденаме  | Имя узла члена службы Azure Блокчейн, в котором выполняется операция.   |
| есмесод  | Метод, который вызывается базовым протоколом блокчейн, в кворуме может быть eth_sendTransactions, eth_getBlockByNumber и т. д.  |
| Агент  | Агент пользователя, действующий от имени пользователя, например веб-браузер Mozilla, ребро и т. д. Примеры значений: "Mozilla/5.0 (Linux x64) Node. js/8.16.0 V8/6.2.414.77"  |
| Код   | Коды ошибок HTTP. Обычно 4XX и 5XX — это условия ошибок.  |
| нодехост  | DNS-имя узла.   |
| рекуестмесоднаме | Вызываемый метод HTTP. Возможные значения задаются для создания члена, GET для получения сведений о существующем члене, DELETE для элемента DELETE, PATCH для обновления элемента.   |
| блоккчаинмембернаме  | Имя члена службы Azure Блокчейн, предоставленное пользователем.  |
| Консорциум | Имя консорциума, предоставленное пользователем.   |
| Remote  | IP-адрес клиента, на котором поступает запрос.  |
| RequestSize  | Размер запроса, выполненного в байтах.  |
| рекуесттиме  | Длительность запроса в миллисекундах.|




В следующей таблице перечислены свойства журналов приложений Azure Блокчейн.


| Имя свойства  | Description |
|:---|:---|
| time | Дата и время (UTC) выполнения операции. |
| Идентификатора  | Ресурс службы Azure Блокчейн, для которого включены журналы.|
| категория  |Для службы Azure Блокчейн значение может быть **проксилогс** и **аппликатионлогс**.  |
| operationName  | Имя операции, которую представляет это событие.   |
| Уровень журнала  | По умолчанию служба Блокчейн Azure включает **информационный** уровень ведения журнала.   |
| ноделокатион  | Регион Azure, в котором развернут член блокчейн.  |
| блоккчаинноденаме  | Имя узла члена службы Azure Блокчейн, в котором выполняется операция.   |
| блоккчаинмессаже    | В этом поле будет содержаться журнал приложений Блокчейн, который является обычными журналами данных. Для ABS-кворума это могут быть журналы кворума. Он содержит сведения о том, какой тип записи журнала является информационным, ошибкой, предупреждением и строкой, которая предоставляет дополнительные сведения о выполняемом действии.   |
| идентификатор клиента;    | Клиент, зависящий от региона, для службы Azure Блокчейн. Формат этого поля https://westlake-rp-prod.<region>. cloudapp.azure.com, где Region указывает регион Azure развернутого элемента.       |
| SourceSystem   | Система заполняет журналы, в данном случае это **Azure**.    |



### <a name="metrics"></a>Метрики

В следующих таблицах перечислены метрики платформы, собранные для службы Блокчейн Azure. Все метрики хранятся в стандартных метриках **службы пространства имен Azure блокчейн** .

Список всех Azure Monitor поддерживаемых метрик (включая службу Azure Блокчейн) см. в статье [Azure Monitor поддерживаемые метрики](https://docs.microsoft.com/azure/azure-monitor/platform/metrics-supported).

### <a name="blockchain-metrics"></a>Метрики блокчейн

В следующей таблице указан список метрик Блокчейн, собираемых для ресурса члена службы Блокчейн Azure.


| Имя метрики | Единица  |  Тип агрегирования| Description   |
|---|---|---|---|
| Ожидающие транзакции   | Количество  |  Среднее | Число транзакций, ожидающих осуществляет интеллектуальный анализ.   |
| Обработанные блоки   | Количество  | SUM  |  Количество блоков, обработанных за каждый интервал времени. В настоящее время размер блока составляет 5 секунд, поэтому каждый узел будет обрабатывать 12 блоков и 60 блоков за 5 минут.   |
|Обработанные транзакции    | Количество  | SUM  | Число транзакций, обработанных в блоке.    |
|Транзакции в очереди    |  Количество | Среднее  | Число транзакций, которые не могут быть немедленно осуществляет интеллектуальный анализ. Это может быть вызвано тем, что они были получены не по порядку, а будущая транзакция ожидает поступления предыдущей транзакции. Или две транзакции могут иметь одинаковый номер, который используется только один раз (nonce) и одно значение газа, поэтому второй из них не может быть осуществляет интеллектуальный анализ.   |

### <a name="connection-metrics"></a>Метрики подключения  

В следующей таблице перечислены различные метрики подключений, собираемые для ресурса члена службы Azure Блокчейн. Это NGINX метрики прокси-сервера.


| Имя метрики | Единица  |  Тип агрегирования| Description |
|---|---|---|---|
| Принятые подключения   | Количество  |  SUM | Общее число принятых клиентских подключений.   |
| Активные подключения  | Количество  | Среднее  |  Текущее число активных клиентских подключений, включая ожидающие подключения.    |
|Обработанные соединения    | Количество  | SUM  | Общее число обработанных соединений. Как правило, значение параметра совпадает с принятыми подключениями, если не достигнуто никаких ограничений на ресурсы.     |
|Обработанные запросы     |  Количество | SUM  | Общее число клиентских запросов.  |


### <a name="performance-metrics"></a>Метрики производительности

В следующей таблице перечислены метрики производительности, собираемые для каждого узла ресурса члена Azure Блокчейн.  


| Имя метрики | Единица  |  Тип агрегирования| Description   |
|---|---|---|---|
| Процент использования ЦП   | Процент  |  Максимальное количество | Процент использования ЦП.     |
| Считанные байты ввода-вывода   | Килобайты   | SUM  |  Сумма операций ввода-вывода на чтение байтов на всех узлах ресурса-члена блокчейн.      |
|Число операций записи ввода-вывода     | Килобайты   | SUM  | Сумма операций ввода-вывода записывает байты на всех узлах ресурса-члена блокчейн.     |
|Ограничение памяти       |  Объем   | Среднее    | Максимальный объем памяти, доступный для процесса блокчейн на каждом узле. |
|Использование памяти     | Объем  |  Среднее | Объем используемой в среднем памяти для всех узлов.  |
| Процент использования памяти     | Процент   | Среднее  |  Процент используемой в среднем памяти для всех узлов.       |
|Использование хранилища      | Объем   | Среднее  | Количество ГБ хранилища, используемое в среднем на всех узлах.       |


## <a name="next-steps"></a>Следующие шаги

Дополнительные сведения о [блокчейн Диспетчер данных](https://docs.microsoft.com/azure/blockchain/service/data-manager) для записи и преобразования блокчейн данных в службу "Сетка событий Azure".
