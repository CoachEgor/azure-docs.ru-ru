---
title: Мониторинг блокчейн-сервиса Azure (ABS)
description: Мониторинг блокчейн-сервиса Azure через Azure Monitor
ms.date: 01/08/2020
ms.topic: article
ms.reviewer: v-umha
ms.openlocfilehash: 6f2a91a8ffce67d3c4008a7587f2787f6446c341
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "76293255"
---
# <a name="monitor-azure-blockchain-service-through-azure-monitor"></a>Мониторинг блокчейн-сервиса Azure через Azure Monitor  

По мере того, как клиенты запускают сценарии блокчейна производственного класса в Azure Blockchain Service (ABS), становится критически важным отслеживать ресурсы для доступности, производительности и операций. В этой статье описаны данные мониторинга, генерируемые Azure Blockchain Service, и то, как можно использовать различные функции и интеграции Azure Monitor для анализа и оповещения для управления средами производственного класса.  

## <a name="what-is-azure-monitor"></a>Общие сведения об Azure Monitor

Служба блокчейн Azure создает данные мониторинга с помощью Azure Monitor, который является службой мониторинга полного стека в Azure, которая предоставляет полный набор функций для мониторинга ресурсов Azure. Для получения дополнительной информации о Azure Monitor см. Мониторинг [ресурсов Azure с помощью Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/insights/monitor-azure-resource).
 

Следующие разделы основывается на этой статье, описывая конкретные данные, собранные из Azure Blockchain Service, и предоставляя примеры настройки сбора данных и анализа этих данных с помощью инструментов Azure.

## <a name="monitor-data-collected-from-azure-blockchain-service"></a>Мониторинг данных, собранных с помощью блокчейн-сервиса Azure  

Служба блокчейн Azure собирает те же данные мониторинга, что и другие ресурсы Azure, которые описаны в [данных мониторинга](https://docs.microsoft.com/azure/azure-monitor/insights/monitor-azure-resource#monitoring-data) с ресурсов Azure. Подробную ссылку на журналы и метрики, созданные службой блокчейн Azure, можно ознакомиться с справкой о [блокчейн-сервисе Monitor Azure Blockchain Service.](#monitor-azure-blockchain-service-data-reference)

Страница обзора на портале Azure для каждого ресурса-члена Azure Blockchain Service содержит краткое представление транзакций, включая обработанные запросы и обработанные блоки. Некоторые из этих данных собираются автоматически и доступны для анализа после создания ресурса-члена Службы блокчейн Azure, в то время как можно включить дополнительный сбор данных с дополнительной конфигурацией.

## <a name="diagnostic-settings"></a>Параметры диагностики  

Метрики платформы и журнал активности собираются автоматически, но необходимо создать диагностическую настройку для сбора журналов ресурсов или пересылать их за пределы Azure Monitor. Смотрите [создать диагностическую настройку для сбора журналов платформ и метрик в Azure](https://docs.microsoft.com/azure/azure-monitor/platform/diagnostic-settings) для детального процесса создания диагностической настройки с помощью портала Azure, CLI или PowerShell.

При создании диагностической настройки указывается, какие категории журналов собирать. Ниже перечислены категории для сервиса блокчейн Azure.

**Блокчейн прокси журналы** - Выберите категорию, если вы хотите контролировать NGNIX прокси журналы. Все данные о транзакциях клиента доступны для аудита и отладки.  

**Блокчейн-журналы приложений** - Выберите категорию для получения журналов приложения блокчейн, размещенных управляемой службой. Например, для члена ABS-Кворума эти журналы будут журналами из самого Кворума.  

**Метрические запросы**: Выберите опцию сбора метрических данных из DB Azure Cosmos в пункты назначения в диагностической настройке, которая собирается автоматически в Azure Metrics. Собирайте метрические данные с помощью журналов ресурсов для совместного анализа обоих видов данных и отправки метрических данных за пределы Azure Monitor.

## <a name="analyze-metric-data"></a>Анализ метрических данных  

Вы можете анализировать метрики для Azure Blockchain Service с помощью explorer Metrics, перемещаться по вкладке «Метрика» в разделе «Мониторинг» в лезвии ресурсов ABS. Подробную информацию об использовании инструмента можно узнать из-за использования инструмента с [помощью Azure Metrics Explorer.](https://docs.microsoft.com/azure/azure-monitor/platform/metrics-getting-started) Полные метрики для Azure Blockchain Service находятся в стандартных метриках службы блокчейн агона Azure.

Измерение **узла** можно использовать при добавлении фильтра или расщеплении метрик, которые в основном обеспечивают метрические значения на узлы транзакции и узлы валидатора члена ABS.

## <a name="analyze-log-data"></a>Анализ данных журналов

Вот некоторые запросы, которые можно ввести в панель поиска журнала, чтобы помочь вам следить за участниками службы блокчейн Azure. Эти запросы поддерживают [новый язык](https://docs.microsoft.com/azure/azure-monitor/log-query/log-query-overview).

Для запроса условий ошибки в журналах приложений Blockchain используйте нижеприведенный запрос:

```
BlockchainApplicationLog | where BlockchainMessage contains "ERROR" or BlockchainMessage contains "fatal"

```

Для запроса условий ошибки в прокси-журналах Blockchain используйте нижеприведенный запрос  


```
BlockchainProxyLog
| filter Code != 200
| limit 500

```
Для фильтрации запроса для определенного диапазона времени можно использовать временные фильтры, доступные в журналах Azure.

## <a name="monitor-azure-blockchain-service-data-reference"></a>Ссылка на данные службы блокчейн Monitor Azure  

В этой статье содержится ссылка на данные журнала и метрики, собранные для анализа производительности и доступности службы блокчейнAzра.  

### <a name="resource-logs"></a>Журналы ресурсов

Все журналы ресурсов имеют общую схему верхнего уровня с несколькими уникальными свойствами, характерными для блокчейн-сервиса. Вы можете сослаться на статью [схема журналов ресурсов верхнего уровня,](https://docs.microsoft.com/azure/azure-monitor/platform/diagnostic-logs-schema#top-level-resource-logs-schema)подробная информация о конкретных свойствах Службы блокчейн Azure описана ниже  

В следующей таблице перечислены свойства прокси-журналов Azure Blockchain, когда они собраны в журналах Azure Monitor или Azure Storage.  


| Имя свойства  | Описание |
|:---|:---|
| time | Дата и время (UTC) выполнения операции. |
| resourceID  | Ресурс Службы блокчейн Azure, для которого включены журналы.  |
| категория  |Для Блокчейн-сервиса Azure возможны **ежей прокси-журналы** и **журналы приложений.** |
| operationName  | Имя операции, которую представляет это событие.   |
| Уровень ведения журнала  | По умолчанию служба Azure Blockchain позволяет **уровень информационного** журнала.   |
| Узловая локация  | Azure области, где используется участник блокчейна.  |
| BlockchainNodeName  | Название узла пользователя Blockchain Service Azure, на котором выполняется операция.   |
| ЭтМот  | Метод, который называется базовым блокчейн-протоколом, в Кворуме, может быть eth_sendTransactions, eth_getBlockByNumber и т.д.  |
| Агент  | Пользовательский агент, который действует от имени пользователя, например, веб-браузер Mozilla, Edge и т.д. Примеры значений: "Mozilla/5.0 (Linux x64) node.js/8.16.0 v8/6.2.414.77"  |
| Код   | Коды ошибок HTTP. Обычно 4XX и 5XX являются условиями ошибки.  |
| УтдХост  | DNS название узла.   |
| ЗапросМетодНам | HTTP метод называется, возможные значения здесь PUT для создания члена, GET для получения подробной информации о существующих членов, DELETE для удаления члена, PATCH для обновления члена.   |
| BlockchainMemberName  | Имя участника службы Blockchain Azure, предоставленное пользователем.  |
| Консорциум | Название консорциума, как это предусмотрено пользователем.   |
| Remote  | IP клиента, в котором находится запрос.  |
| RequestSize  | Размер запроса, сделанного байтами.  |
| ЗапросВремя  | Продолжительность запроса в миллисекундах.|




В следующей таблице перечислены свойства для журналов приложений Azure Blockchain.


| Имя свойства  | Описание |
|:---|:---|
| time | Дата и время (UTC) выполнения операции. |
| resourceID  | Ресурс Службы блокчейн Azure, для которого включены журналы.|
| категория  |Для блокчейн-сервиса Azure возможно значение **proxylogs** и **Applicationlogs.**  |
| operationName  | Имя операции, которую представляет это событие.   |
| Уровень ведения журнала  | По умолчанию служба Azure Blockchain позволяет **уровень информационного** журнала.   |
| Узловая локация  | Azure области, где используется участник блокчейна.  |
| BlockchainNodeName  | Название узла пользователя Blockchain Service Azure, на котором выполняется операция.   |
| BlockchainMessage    | Это поле будет содержать журнал приложений Blockchain, который является простым журналом данных. Для АБС-Кворум это будет иметь журналы Кворума. Он имеет информацию о том, какой тип входа в журнал это, что является информационным, ошибка, предупреждение и строка, которая дает больше информации о действии выполняется.   |
| идентификатор клиента;    | Конкретный региональный арендатор блокчейн-сервиса Azure. Формат этого поля https://westlake-rp-prod. <region>.cloudapp.azure.com, где регион определяет область Azure развернутого участника.       |
| SourceSystem   | Система заполняет журналы, в данном случае это **Azure**.    |



### <a name="metrics"></a>Метрики

В следующих таблицах перечислены метрики платформы, собранные для Azure Blockchain Service. Все метрики хранятся в стандартных метриках службы блокчейн-зоны **Namespace Azure.**

Для списка всех поддерживаемых Azure Monitor метрик (включая службу блокчейн Azure) [см.](https://docs.microsoft.com/azure/azure-monitor/platform/metrics-supported)

### <a name="blockchain-metrics"></a>Блокчейн метрики

В следующей таблице приводится список метрик Blockchain, которые собираются для ресурса-члена Службы блокчейн Azure.


| Имя метрики | Единицы  |  Тип агрегирования| Описание   |
|---|---|---|---|
| Отложенные транзакции   | Count  |  Среднее | Количество транзакций, ожидающих их добычи.   |
| Обработанные блоки   | Count  | SUM  |  Количество блоков, обрабатываемых в каждом временном интервале. В настоящее время размер блока составляет 5 секунд, следовательно, через минуту каждый узло будет обрабатывать 12 блоков и 60 блоков за 5 минут.   |
|Обработанные транзакции    | Count  | SUM  | Количество транзакций, обрабатываемых в блоке.    |
|Очередные транзакции    |  Count | Среднее  | Количество транзакций, которые не могут быть немедленно добыты. Это может быть потому, что они прибыли не в порядке, и будущий ждет предыдущей транзакции, чтобы прибыть. Или, это может быть две транзакции имеют один и тот же номер, используемый только один раз (nonce) и то же значение газа, следовательно, второй не может быть добыт.   |

### <a name="connection-metrics"></a>Метрики подключения  

В следующей таблице перечислены различные метрики соединения, которые собираются для ресурса-члена службы блокчейн Azure. Это прокси-метрики NGINX.


| Имя метрики | Единицы  |  Тип агрегирования| Описание |
|---|---|---|---|
| Принятые соединения   | Count  |  SUM | Общее количество принятых клиентских подключений.   |
| Активные подключения  | Count  | Среднее  |  Текущее число активных клиентских подключений, включая подключения ожидания.    |
|Обрабатываемые соединения    | Count  | SUM  | Общее количество обрабатываемых соединений. Как правило, значение параметра такое же, как и общепринятые соединения, если не были достигнуты некоторые ограничения ресурсов.     |
|Обработка запросов     |  Count | SUM  | Общее количество запросов клиентов.  |


### <a name="performance-metrics"></a>Метрики производительности

В следующей таблице перечислены метрики производительности, собранные для каждого из узлов ресурса-члена Azure Blockchain.  


| Имя метрики | Единицы  |  Тип агрегирования| Описание   |
|---|---|---|---|
| Процент использования процессора   | Процент  |  Max | Процент использования процессора.     |
| IO Читать Байты   | Килобайты   | SUM  |  Сумма IO читается байтами во всех узлах ресурса-члена blockchain.      |
|IO Написать байты     | Килобайты   | SUM  | Сумма IO записывает байты по всем узлам ресурса-члена blockchain.     |
|Предел памяти       |  Гигабайт   | Среднее    | Максимальная память доступна для процесса блокчейна на узлах. |
|Использование памяти     | Гигабайт  |  Среднее | Объем используемой памяти усреднен во всех узлах.  |
| Процент использования памяти     | Процент   | Среднее  |  Процент используемой памяти усреднен во всех узлах.       |
|Использование хранилища      | Гигабайт   | Среднее  | ГБ используемого хранилища усреднен во всех узлах.       |


## <a name="next-steps"></a>Next Steps

Узнайте больше о [Blockchain Data Manager](https://docs.microsoft.com/azure/blockchain/service/data-manager) для захвата и преобразования блокчейн-данных в Azure Event Grid.
