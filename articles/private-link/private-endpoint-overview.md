---
title: Что такое частная конечная точка Azure?
description: Сведения о частной конечной точке Azure
services: private-link
author: malopMSFT
ms.service: private-link
ms.topic: conceptual
ms.date: 01/09/2020
ms.author: allensu
ms.openlocfilehash: dd73f42aaa0d0bd1884892143d96446935a401a5
ms.sourcegitcommit: 7b25c9981b52c385af77feb022825c1be6ff55bf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/13/2020
ms.locfileid: "79245711"
---
# <a name="what-is-azure-private-endpoint"></a>Что такое частная конечная точка Azure?

Частная конечная точка Azure — это сетевой интерфейс, который защищенно и надежно подключается к службе через Приватный канал Azure. Частная конечная точка использует частный IP-адрес из виртуальной сети, фактически передавая ее в виртуальную сеть. Служба может быть службой Azure, такой как служба хранилища Azure, Azure Cosmos DB, SQL и т. д., или собственной [службы частной связи](private-link-service-overview.md).
  
## <a name="private-endpoint-properties"></a>Свойства частной конечной точки 
 Частная конечная точка содержит следующие свойства: 


|Свойство  |Description |
|---------|---------|
|Имя    |    Уникальное имя в группе ресурсов.      |
|Подсеть    |  Подсеть для развертывания и выделения частных IP-адресов из виртуальной сети. Требования к подсети см. в разделе ограничения этой статьи.         |
|Ресурс частной ссылки    |   Ресурс частной связи для подключения с помощью идентификатора ресурса или псевдонима из списка доступных типов. Для всего трафика, отправляемого в этот ресурс, будет создан уникальный идентификатор сети.       |
|Целевой подресурс   |      Подресурс для подключения. Каждый тип ресурса частной связи имеет различные параметры для выбора в зависимости от предпочтений.    |
|Метод утверждения соединения    |  Автоматически или вручную. На основе разрешений на управление доступом на основе ролей (RBAC) Закрытая конечная точка может быть утверждена автоматически. При попытке подключения к ресурсу частной связи без RBAC используйте ручной метод, чтобы разрешить владельцу ресурса утверждать подключение.        |
|Сообщение запроса     |  Можно указать сообщение о том, что запрошенные подключения должны быть утверждены вручную. Это сообщение можно использовать для поиска конкретного запроса.        |
|Состояние подключения   |   Свойство только для чтения, которое указывает, активна ли закрытая конечная точка. Для отправки трафика можно использовать только частные конечные точки в утвержденном состоянии. Доступны дополнительные состояния: <br>-**утверждено**: подключение было автоматически или утверждено вручную и готово к использованию.</br><br>-**Ожидание**: подключение создано вручную и ожидает утверждения владельцем ресурса закрытой ссылки.</br><br>-**отклонено**: соединение было отклонено владельцем ресурса закрытой ссылки.</br><br>-**отключено**: подключение было удалено владельцем ресурса закрытой ссылки. Частная конечная точка станет информативной и должна быть удалена для очистки. </br>|

Ниже приведены некоторые ключевые сведения о частных конечных точках. 
- Частная конечная точка обеспечивает подключение между потребителями из одной и той же виртуальной сети, с помощью виртуальных сетей, глобально одноранговых виртуальных сетей и локальной сети, используя [VPN](https://azure.microsoft.com/services/vpn-gateway/) или [Express Route](https://azure.microsoft.com/services/expressroute/) и службы на базе частной связи.
 
- При создании частной конечной точки также создается сетевой интерфейс для жизненного цикла ресурса. Интерфейсу назначается частный IP-адрес из подсети, сопоставляемой со службой Private Link.
 
- Частная конечная точка должна быть развернута в том же регионе, что и виртуальная сеть. 
 
- Ресурс частной ссылки можно развернуть в регионе, отличном от региона виртуальной сети и частной конечной точки.
 
- Несколько частных конечных точек можно создать с помощью одного и того же ресурса частной связи. Для одной сети, использующей общую конфигурацию DNS-сервера, рекомендуется использовать одну частную конечную точку для данного ресурса закрытой ссылки, чтобы избежать дублирования записей или конфликтов при разрешении DNS. 
 
- В одной и той же виртуальной сети можно создать несколько частных конечных точек для одних и тех же или разных подсетей. Количество частных конечных точек, которые можно создать в подписке, ограничено. Дополнительные сведения см. в статье [ограничения Azure](https://docs.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits#networking-limits).


 
## <a name="private-link-resource"></a>Ресурс частной ссылки 
Ресурс частной ссылки является целевым объектом назначения заданной закрытой конечной точки. Ниже приведен список доступных типов ресурсов частной ссылки. 
 
|Имя ресурса частной ссылки  |Тип ресурса   |Подресурсов  |
|---------|---------|---------|
|**Служба частной связи** (собственная служба)   |  Microsoft. Network/Привателинксервицес       | empty |
|**База данных SQL Azure** | Microsoft.Sql/servers    |  SQL Server (sqlServer)        |
|**Azure синапсе Analytics** | Microsoft.Sql/servers    |  SQL Server (sqlServer)        |
|**Хранилище Azure**  | Microsoft.Storage/storageAccounts    |  Большой двоичный объект (BLOB-объект, blob_secondary)<BR> Таблица (таблица, table_secondary)<BR> Очередь (очередь, queue_secondary)<BR> Файл (файл, file_secondary)<BR> Интернет (веб, web_secondary)        |
|**Azure Data Lake Storage 2-го поколения**  | Microsoft.Storage/storageAccounts    |  Большой двоичный объект (BLOB-объект, blob_secondary)<BR> Data Lake файловой системы Gen2 (DFS, dfs_secondary)       |
|**Azure Cosmos DB** | Microsoft. Азурекосмосдб/databaseAccounts | SQL, MongoDB, Cassandra, Gremlin, Table|
|**База данных Azure для PostgreSQL — один сервер** | Microsoft.DBforPostgreSQL/servers   | постгресклсервер |
|**База данных Azure для MySQL** | Microsoft.DBforMySQL/servers    | mysqlServer |
|**База данных Azure для MariaDB** | Microsoft.DBforMariaDB/servers    | мариадбсервер |
|**Хранилище ключей Azure** | Microsoft.KeyVault/vaults    | Хранилище |
 
## <a name="network-security-of-private-endpoints"></a>Сетевая безопасность частных конечных точек 
При использовании частных конечных точек для служб Azure трафик защищен с помощью определенного ресурса частной ссылки. Платформа выполняет контроль доступа для проверки сетевых подключений, достигнутых только указанным ресурсом частной ссылки. Для доступа к дополнительным ресурсам в одной службе Azure требуются дополнительные частные конечные точки. 
 
Вы можете полностью заблокировать рабочие нагрузки от доступа к общедоступным конечным точкам для подключения к поддерживаемой службе Azure. Этот элемент управления предоставляет дополнительный уровень безопасности сети для ресурсов, предоставляя встроенную защиту утечка, которая предотвращает доступ к другим ресурсам, размещенным в той же службе Azure. 
 
## <a name="access-to-a-private-link-resource-using-approval-workflow"></a>Доступ к ресурсу закрытой ссылки с помощью рабочего процесса утверждения 
Подключиться к ресурсу закрытой ссылки можно с помощью следующих методов утверждения соединения:
- **Автоматически** утверждается, когда вы владеете или имеете разрешение на конкретный ресурс частной связи. Требуемое разрешение основано на типе ресурса частной ссылки в следующем формате: Microsoft. Поставщик\<>/< resource_type >/Приватиндпоинтконнектионаппровал/Актион
- **Ручное** выполнение запроса, если у вас нет необходимых разрешений и требуется запросить доступ. Будет инициирован рабочий процесс утверждения. Частная конечная точка и последующее подключение к частной конечной точке создаются в состоянии "Ожидание". Владелец ресурса частной ссылки должен утвердить это подключение. После утверждения частная конечная точка будет включена для обычной отправки трафика, как показано на следующей схеме рабочего процесса утверждения.  

![утверждение рабочего процесса](media/private-endpoint-overview/private-link-paas-workflow.png)
 
Владелец ресурса закрытой ссылки может выполнять следующие действия через подключение к частной конечной точке: 
- Проверьте все сведения о подключениях к частным конечным точкам. 
- Утвердите подключение к частной конечной точке. Соответствующая частная конечная точка будет включена для отправки трафика в ресурс закрытой ссылки. 
- Отклонение подключения к частной конечной точке. Соответствующая частная конечная точка будет обновлена для отражения состояния.
- Удаление подключения к частной конечной точке в любом состоянии. Соответствующая частная конечная точка будет обновлена с отключенным состоянием, чтобы отразить действие, владелец частной конечной точки может удалить ресурс только на этом этапе. 
 
> [!NOTE]
> Только частная конечная точка в утвержденном состоянии может передавать трафик на данный ресурс закрытой ссылки. 

### <a name="connecting-using-alias"></a>Соединение с помощью псевдонима
Псевдоним — это уникальный моникер, который создается, когда владелец службы создает службу частной связи за стандартную подсистему балансировки нагрузки. Владелец службы может совместно использовать этот псевдоним со своими потребителями в автономном режиме. Потребители могут запрашивать подключение к службе Private Link с помощью URI ресурса или псевдонима. Если вы хотите подключиться с помощью псевдонима, необходимо создать закрытую конечную точку с помощью метода подтверждения соединения вручную. Для использования метода утверждения подключения вручную задайте для параметра ручного запроса значение true во время создания конечной точки с помощью команды "создать поток". Дополнительные сведения см. в описании командлета [New-азприватиндпоинт](/powershell/module/az.network/new-azprivateendpoint?view=azps-2.6.0) и [AZ Network Private-конечной точки Create](/cli/azure/network/private-endpoint?view=azure-cli-latest#az-network-private-endpoint-create) . 

## <a name="dns-configuration"></a>Настройка DNS 
При подключении к ресурсу частной связи с использованием полного доменного имени (FQDN) в строке подключения необходимо правильно настроить параметры DNS, чтобы разрешить доступ к выделенному частному IP-адресу. Возможно, в существующих службах Azure уже есть конфигурация DNS, используемая при подключении через общедоступную конечную точку. Это необходимо переопределить для подключения с помощью частной конечной точки. 
 
Сетевой интерфейс, связанный с частной конечной точкой, содержит полный набор сведений, необходимых для настройки DNS, включая полное доменное имя и частные IP-адреса, выделенные для данного ресурса частной ссылки. 
 
Для настройки параметров DNS для частных конечных точек можно использовать следующие параметры. 
- **Используйте файл узла (рекомендуется только для тестирования)** . Для переопределения DNS можно использовать файл узла на виртуальной машине.  
- **Используйте частную зону DNS**. Для переопределения разрешения DNS для заданной закрытой конечной точки можно использовать частные зоны DNS. Частная зона DNS может быть связана с вашей виртуальной сетью для разрешения конкретных доменов.
- **Используйте пользовательский DNS-сервер**. Можно использовать собственный DNS-сервер для переопределения разрешения DNS для данного ресурса закрытой ссылки. Если [DNS-сервер](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-that-uses-your-own-dns-server) размещен в виртуальной сети, можно создать правило пересылки DNS для использования частной зоны DNS, чтобы упростить настройку для всех ресурсов частной связи.
 
> [!IMPORTANT]
> Не рекомендуется переопределять зону, которая активно используется для разрешения общедоступных конечных точек. Подключения к ресурсам не смогут правильно разрешаться без пересылки DNS в общедоступную службу DNS. Чтобы избежать проблем, создайте другое доменное имя или выполните предлагаемое имя для каждой службы ниже. 
 
Для служб Azure используйте Рекомендуемые имена зон, как описано в следующей таблице.

|Тип ресурса частной ссылки   |Subresource  |Имя зоны  |
|---------|---------|---------|
|SQL DB/DW (Microsoft. SQL/Servers)    |  SQL Server (sqlServer)        |   privatelink.database.windows.net       |
|Учетная запись хранения (Microsoft. Storage/storageAccounts)    |  Большой двоичный объект (BLOB-объект, blob_secondary)        |    privatelink.blob.core.windows.net      |
|Учетная запись хранения (Microsoft. Storage/storageAccounts)    |    Таблица (таблица, table_secondary)      |   privatelink.table.core.windows.net       |
|Учетная запись хранения (Microsoft. Storage/storageAccounts)    |    Очередь (очередь, queue_secondary)     |   privatelink.queue.core.windows.net       |
|Учетная запись хранения (Microsoft. Storage/storageAccounts)   |    Файл (файл, file_secondary)      |    privatelink.file.core.windows.net      |
|Учетная запись хранения (Microsoft. Storage/storageAccounts)     |  Интернет (веб, web_secondary)        |    privatelink.web.core.windows.net      |
|Data Lake файловой системы Gen2 (Microsoft. Storage/storageAccounts)  |  Data Lake файловой системы Gen2 (DFS, dfs_secondary)        |     privatelink.dfs.core.windows.net     |
|Azure Cosmos DB (Microsoft. Азурекосмосдб/databaseAccounts)|SQL |privatelink.documents.azure.com|
|Azure Cosmos DB (Microsoft. Азурекосмосдб/databaseAccounts)|MongoDB |privatelink.mongo.cosmos.azure.com|
|Azure Cosmos DB (Microsoft. Азурекосмосдб/databaseAccounts)|Cassandra|privatelink.cassandra.cosmos.azure.com|
|Azure Cosmos DB (Microsoft. Азурекосмосдб/databaseAccounts)|Gremlin |privatelink.gremlin.cosmos.azure.com|
|Azure Cosmos DB (Microsoft. Азурекосмосдб/databaseAccounts)|Таблица|privatelink.table.cosmos.azure.com|
|База данных Azure для PostgreSQL — один сервер (Microsoft. Дбфорпостгрескл/Servers)|постгресклсервер|privatelink.postgres.database.azure.com|
|База данных Azure для MySQL (Microsoft. Дбформискл/Servers)|mysqlServer|privatelink.mysql.database.azure.com|
|База данных Azure для MariaDB (Microsoft. Дбформариадб/Servers)|мариадбсервер|privatelink.mariadb.database.azure.com|
|Azure Key Vault (Microsoft. KeyVault/Vault)|Хранилище|privatelink.vaultcore.azure.net|
 
Azure создаст каноническое имя DNS-записи (CNAME) на общедоступном DNS-сервере, чтобы перенаправить разрешение в предлагаемые доменные имена. Вы сможете переопределить разрешение с помощью частного IP-адреса закрытых конечных точек. 
 
Приложениям не нужно изменять URL-адрес подключения. При попытке разрешить использование общедоступной службы DNS DNS-сервер теперь будет разрешаться в частные конечные точки. Этот процесс не влияет на ваши приложения. 
 
## <a name="limitations"></a>Ограничения
 
В следующей таблице содержится список известных ограничений при использовании частных конечных точек. 


|Ограничение |Description |Меры по снижению риска  |
|---------|---------|---------|
|Правила группы безопасности сети (NSG) и определяемые пользователем маршруты не применяются к частной конечной точке    |NSG не поддерживается в частных конечных точках. В то время как подсети, содержащие закрытую конечную точку, могут связываться с NSG, правила не будут действовать для трафика, обрабатываемого частной конечной точкой. Для развертывания частных конечных точек в подсети необходимо [Отключить принудительное применение политик сети](disable-private-endpoint-network-policy.md) . NSG по-прежнему применяется к другим рабочим нагрузкам, размещенным в той же подсети. Маршруты в любой подсети клиента будут использовать префикс/32, изменение поведения маршрутизации по умолчанию требует аналогичного UDR  | Управление трафиком с помощью правил NSG для исходящего трафика на исходных клиентах. Развертывайте отдельные маршруты с префиксом/32 для переопределения маршрутов частных конечных точек. Журналы потоков NSG и данные мониторинга для исходящих соединений по-прежнему поддерживаются и могут использоваться.        |


## <a name="next-steps"></a>Дальнейшие действия
- [Create a Private Endpoint using Azure portal ](create-private-endpoint-portal.md) (Создание частной конечной точки для сервера базы данных SQL с помощью портала)
- [Создание частной конечной точки для сервера базы данных SQL с помощью портала PowerShell ](create-private-endpoint-powershell.md)
- [Создание частной конечной точки для сервера базы данных SQL с помощью портала CLI ](create-private-endpoint-cli.md)
- [Создание частной конечной точки для учетной записи хранения, используя портал ](create-private-endpoint-storage-portal.md)
- [Создание частной конечной точки для учетной записи Azure Cosmos с помощью портала](../cosmos-db/how-to-configure-private-endpoints.md)
- [Create your own Private Link service using Azure PowerShel](create-private-link-service-powershell.md) (Создание собственного Приватного канала с помощью Azure PowerShell)
- [Создание собственной частной ссылки для базы данных Azure для PostgreSQL-Single Server с помощью портала](../postgresql/howto-configure-privatelink-portal.md)
- [Создание собственной частной ссылки для базы данных Azure для PostgreSQL-Single Server с помощью интерфейса командной строки](../postgresql/howto-configure-privatelink-cli.md)
- [Создание собственной частной ссылки для базы данных Azure для MySQL с помощью портала](../mysql/howto-configure-privatelink-portal.md)
- [Создание собственной частной ссылки для базы данных Azure для MySQL с помощью интерфейса командной строки](../mysql/howto-configure-privatelink-cli.md)
- [Создание собственной частной ссылки для базы данных Azure для MariaDB с помощью портала](../mariadb/howto-configure-privatelink-portal.md)
- [Создание собственной частной ссылки для базы данных Azure для MariaDB с помощью интерфейса командной строки](../mariadb/howto-configure-privatelink-cli.md)
