---
title: Connect privately to a storage account using Azure Private Endpoint (Частное подключение к учетной записи хранения с помощью частной конечной точки Azure)
description: Узнайте, как подключиться к учетной записи хранилища в Azure с помощью частной конечных точек.
services: private-link
author: malopMSFT
ms.service: private-link
ms.topic: article
ms.date: 09/16/2019
ms.author: allensu
ms.openlocfilehash: 111e6e2f80c3460f363c496b7b32befdca16250d
ms.sourcegitcommit: fb23286d4769442631079c7ed5da1ed14afdd5fc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/10/2020
ms.locfileid: "81115105"
---
# <a name="connect-privately-to-a-storage-account-using-azure-private-endpoint"></a>Connect privately to a storage account using Azure Private Endpoint (Частное подключение к учетной записи хранения с помощью частной конечной точки Azure)
Azure Private Endpoint является основным строительным блоком для Private Link в Azure. Это позволяет ресурсам Azure, таким как виртуальные машины (VM), общаться в частном порядке с ресурсами Private Link.

В этом случае вы узнаете, как создать VM в виртуальной сети Azure, учетную запись хранения с частной конечной точкой с помощью портала Azure. Затем вы можете получить безопасный доступ к учетной записи хранилища из VM.

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на портал Azure по адресу https://portal.azure.com.

## <a name="create-a-vm"></a>Создание виртуальной машины
В этом разделе вы создадите виртуальную сеть и подсеть для размещения VM, который используется для доступа к вашему ресурсу Private Link (учетная запись хранилища в этом примере).

## <a name="virtual-network-and-parameters"></a>Виртуальные сети и параметры

В этом разделе вы создадите виртуальную сеть и подсеть для размещения VM, который используется для доступа к вашему ресурсу Private Link.

В этом разделе необходимо заменить в выполняемых действиях указанные параметры приведенными ниже сведениями.

| Параметр                   | Значение                |
|-----------------------------|----------------------|
| **\<resource-group-name>**  | myResourceGroup |
| **\<virtual-network-name>** | myVirtualNetwork          |
| **\<region-name>**          | центрально-западная часть США      |
| **\<IPv4-address-space>**   | 10.1.0.0\16          |
| **\<subnet-name>**          | mySubnet        |
| **\<subnet-address-range>** | 10.1.0.0\24          |

[!INCLUDE [virtual-networks-create-new](../../includes/virtual-networks-create-new.md)]


### <a name="create-virtual-machine"></a>Создание виртуальной машины

1. На верхней левой стороне экрана на портале Azure выберите **Создать ресурс** > **Compute** > **Virtual machine.**

1. В окне **Создание виртуальной машины — Основы** введите или выберите следующую информацию:

    | Параметр | Значение |
    | ------- | ----- |
    | **Сведения о проекте** | |
    | Подписка | Выберите свою подписку. |
    | Группа ресурсов | Выберите **myResourceGroup**. Вы создали ее в предыдущем разделе.  |
    | **Подробности об экземпляре** |  |
    | Имя виртуальной машины | Введите *myVm*. |
    | Регион | Выберите **WestCentralUS**. |
    | Параметры доступности | Оставьте значение по умолчанию **No infrastructure redundancy required** (Избыточность инфраструктуры не требуется). |
    | Образ — | Выберите **Центр обработки данных Windows Server 2019**. |
    | Размер | Оставьте значение по умолчанию **Standard DS1 v2**. |
    | **Учетная запись администратора** |  |
    | Имя пользователя | Введите выбранное имя пользователя. |
    | Пароль | Введите выбранный пароль. Пароль должен включать минимум 12 символов и соответствовать [определенным требованиям к сложности](../virtual-machines/windows/faq.md?toc=%2fazure%2fvirtual-network%2ftoc.json#what-are-the-password-requirements-when-creating-a-vm).|
    | Подтверждение пароля | Введите пароль еще раз. |
    | **Правила входящего порта** |  |
    | Общедоступные входящие порты | Оставьте значение по умолчанию **Отсутствует**. |
    | **Экономия** |  |
    | Already have a Windows license? (У вас уже есть лицензия Windows?) | Оставьте значение по умолчанию **Нет**. |
    |||

1. По завершении выберите **Next: Диски**.

1. В окне **Создание виртуальной машины — Диски** оставьте значения по умолчанию и выберите **Далее: Сети**.

1. В окне **Создание виртуальной машины — Сети** выберите такую информацию:

    | Параметр | Значение |
    | ------- | ----- |
    | Виртуальная сеть | Оставьте значение по умолчанию **myVirtualNetwork**.  |
    | Пространство адресов | Оставьте значение по умолчанию **10.1.0.0/24**.|
    | Подсеть | Оставьте значение по умолчанию **mySubnet (10.1.0.0/24)** .|
    | Общедоступный IP-адрес | Оставьте значение по умолчанию **(new) myVm-ip**. |
    | Общедоступные входящие порты | Выберите **Разрешить выбранные порты**. |
    | Выбрать входящие порты | Выберите **HTTP** и **RDP**.|
    ||

1. Выберите **Review + create** (Просмотреть и создать). Вы будете перенаправлены на страницу **Просмотр и создание**, где Azure проверит вашу конфигурацию.

1. При появлении сообщения **Проверка пройдена** нажмите кнопку **Создать**.

## <a name="create-your-private-endpoint"></a>Создайте свою частную конечную точку
В этом разделе вы создадите частную учетную запись хранения, используя частную конечную точку. 

1. На верхней левой стороне экрана на портале Azure выберите Создать**учетную запись****хранения** >  **ресурсов.** > 

1. В **учетной записи для хранения данных - Основы**введите или выберите эту информацию:

    | Параметр | Значение |
    | ------- | ----- |
    | **Сведения о проекте** | |
    | Подписка | Выберите свою подписку. |
    | Группа ресурсов | Выберите **myResourceGroup**. Вы создали ее в предыдущем разделе.|
    | **Подробности об экземпляре** |  |
    | Имя учетной записи хранения  | Введите *mystorageaccount*. Если это имя используется, создайте уникальное имя. |
    | Регион | Выберите **WestCentralUS**. |
    | Производительность| Оставьте значение по умолчанию **Стандартная**. |
    | Тип учетной записи | Оставьте хранилище по умолчанию **(общие цели v2)**. |
    | Репликация | Выберите **гео-избыточное хранилище Для чтения (RA-GRS).** |
    |||
  
3. Выберите **Далее: Сеть**.
4. При **создании учетной записи хранилища - Сеть,** метод подключения, выберите **Частную конечную точку.**
5. В **Создать учетную запись хранения - Сеть**, выберите **Добавить частную конечную точку.** 
6. В **создайте частную конечную точку,** введите или выберите эту информацию:

    | Параметр | Значение |
    | ------- | ----- |
    | **Сведения о проекте** | |
    | Подписка | Выберите свою подписку. |
    | Группа ресурсов | Выберите **myResourceGroup**. Вы создали ее в предыдущем разделе.|
    |Расположение|Выберите **WestCentralUS**.|
    |Имя|Введите *myPrivateEndpoint*.  |
    |Подресурс для хранения|Оставьте **Blob**по умолчанию. |
    | **СЕТИ** |  |
    | Виртуальная сеть  | Выберите *MyVirtualNetwork* из ресурсной группы *myResourceGroup*. |
    | Подсеть | Выберите *mySubnet*. |
    | **ЧАСТНАЯ ИНТЕГРАЦИЯ DNS**|  |
    | Интеграция с частной зоной DNS  | Оставьте значение **Yes**по умолчанию . |
    | Частная зона DNS  | Оставьте privatelink.blob.core.windows.net по умолчанию **(New)**. |
    |||
7. Щелкните **ОК**. 
8. Выберите **Review + create** (Просмотреть и создать). Вы будете перенаправлены на страницу **Просмотр и создание**, где Azure проверит вашу конфигурацию. 
9. При появлении сообщения **Проверка пройдена** нажмите кнопку **Создать**. 
10. Просмотр только что созданного ресурса учетной записи хранилища.
11. Выберите **ключи доступа** из меню левого содержимого.
12. Выберите **Copy** на строке соединения для key1.
 
## <a name="connect-to-a-vm-from-the-internet"></a>Подключение к виртуальной машине из Интернета

Подключитесь к виртуальной машине *myVm* из Интернета, выполнив следующие действия.

1. На портале в строке поиска введите *myVm*.

1. Нажмите кнопку **Подключиться**. После нажатия кнопки **Подключиться** откроется окно **Connect to virtual machine** (Подключение к виртуальной машине).

1. Щелкните **Скачать RDP-файл**. Azure создаст и скачает на ваш компьютер файл протокола удаленного рабочего стола (*RDP*).

1. Откройте файл *downloaded.rdp*.

    1. При появлении запроса выберите **Подключиться**.

    1. Введите имя пользователя и пароль, указанные при создании виртуальной машины.

        > [!NOTE]
        > Возможно, потребуется выбрать **More choices** > **Use a different account** (Дополнительные варианты > Использовать другую учетную запись), чтобы указать учетные данные, введенные при создании виртуальной машины.

1. Щелкните **ОК**.

1. При входе в систему может появиться предупреждение о сертификате. В таком случае выберите **Да** или **Продолжить**.

1. Когда появится рабочий стол виртуальной машины, сверните его, чтобы вернуться на локальный рабочий стол.  

## <a name="access-storage-account-privately-from-the-vm"></a>Доступ к учетной записи хранения в частном порядке из VM

В этом разделе вы подключитесь к учетной записи хранилища с помощью частной точки хранения.

1. Откройте PowerShell на удаленном рабочем столе *myVm*.
2. Введите `nslookup mystorageaccount.blob.core.windows.net` Вы получите сообщение, аналогичное этому:
    ```azurepowershell
    Server:  UnKnown
    Address:  168.63.129.16
    Non-authoritative answer:
    Name:    mystorageaccount123123.privatelink.blob.core.windows.net
    Address:  10.0.0.5
    Aliases:  mystorageaccount.blob.core.windows.net
    ```
3. Установите [Обозреватель службы хранилища Microsoft Azure](https://docs.microsoft.com/azure/vs-azure-tools-storage-manage-with-storage-explorer?toc=%2Fazure%2Fstorage%2Fblobs%2Ftoc.json&tabs=windows).
4. Выберите **учетные записи хранилища** с помощью правого клика.
5. Выберите **Подключение к лазурной памяти.**
6. Выберите **Используйте строку соединения.**
7. Выберите **Далее**.
8. Введите строку соединения, вставив ранее скопированную информацию.
9. Выберите **Далее**.
10. Выберите **Подключиться**.
11. Просмотр контейнеров Blob от mystorageaccount 
12. (По желанию) Создавайте папки и/или загружайте файлы в *mystorageaccount.* 
13. Закройте удаленное подключение к рабочему столу *на myVM.* 

Дополнительные опции для доступа к учетной записи хранилища:
- Microsoft Azure Storage Explorer — это автономное бесплатное приложение от корпорации Майкрософт, которое позволяет работать визуально с данными хранения данных Azure на Windows, macOS и Linux. Вы можете установить приложение для просмотра в частном порядке содержимого учетной записи хранилища. 
 
- Утилита AzCopy является еще одним вариантом для высокопроизводительной передачи данных для хранения данных Azure. С помощью AzCopy можно передавать данные из хранилища BLOB-объектов, таблиц и файлов и обратно. 


## <a name="clean-up-resources"></a>Очистка ресурсов 
Когда вы закончите использовать Частную конечную точку, учетную запись хранения и VM, удалите группу ресурсов и все ресурсы, которые она содержит: 
1. Введите *myResourceGroup* в поле **Поиск** в верхней части портала и выберите *myResourceGroup* в результатах поиска. 
2. Выберите **Удалить группу ресурсов**. 
3. Введите *myResourceGroup* для **TYPE RESOURCE GROUP NAME** и выберите **Удалить**. 

## <a name="next-steps"></a>Дальнейшие действия
В этом случае вы создали VM в виртуальной сети и учетной записи хранения данных и частной конечную точку. Вы подключились к одному VM из интернета и надежно передавали сообщение на учетную запись хранения с помощью Private Link. Чтобы узнать больше о частной конечной точке, [см.](private-endpoint-overview.md)
