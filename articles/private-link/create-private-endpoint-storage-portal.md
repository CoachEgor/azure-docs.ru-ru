---
title: Подключение в частном порядке к учетной записи хранения с помощью частной конечной точки Azure
description: Узнайте, как подключаться к учетной записи хранения в Azure с помощью частной конечной точки.
services: private-link
author: KumudD
ms.service: private-link
ms.topic: article
ms.date: 09/16/2019
ms.author: kumud
ms.openlocfilehash: bb0c6e9d20c12df3532a52df1fe4d9574344d4b3
ms.sourcegitcommit: 1c9858eef5557a864a769c0a386d3c36ffc93ce4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/18/2019
ms.locfileid: "71104716"
---
# <a name="connect-privately-to-a-storage-account-using-azure-private-endpoint"></a>Подключение в частном порядке к учетной записи хранения с помощью частной конечной точки Azure
Частная конечная точка Azure — это фундаментальный Стандартный блок для частной ссылки в Azure. Она позволяет ресурсам Azure, таким как виртуальные машины, обмениваться данными с частными ресурсами.

В этом кратком руководстве вы узнаете, как создать виртуальную машину в виртуальной сети Azure, учетную запись хранения с частной конечной точкой, используя портал Azure. Затем вы можете безопасно получить доступ к учетной записи хранения из виртуальной машины.


## <a name="sign-in-to-azure"></a>Войдите в Azure

Войдите на портал Azure по адресу https://portal.azure.com.

## <a name="create-a-vm"></a>Создание виртуальной машины
В этом разделе вы создадите виртуальную сеть и подсеть для размещения виртуальной машины, которая используется для доступа к ресурсу частной ссылки (учетная запись хранения в этом примере).

### <a name="create-the-virtual-network"></a>Создание виртуальной сети

В этом разделе вы создадите виртуальную сеть и подсеть для размещения виртуальной машины, которая используется для доступа к ресурсу частной ссылки.

1. Вверху с левой стороны экрана последовательно выберите **Создать ресурс** > **Сети** > **Виртуальная сеть**.
1. В подменю **Создать виртуальную сеть** введите или выберите следующую информацию:

    | Параметр | Значение |
    | ------- | ----- |
    | Название | Введите *MyVirtualNetwork*. |
    | Адресное пространство | Введите *10.1.0.0/16*. |
    | Подписка | Выберите свою подписку.|
    | Группа ресурсов | Выберите **Создать**, а затем введите *myResourceGroup* и нажмите кнопку **ОК**. |
    | Местоположение | Выберите **WestCentralUS**.|
    | Имя подсети | Введите *mySubnet*. |
    | Диапазон адреса подсети | Введите *10.1.0.0/24*. |
    |||
1. Оставьте без изменений значения остальных параметров и выберите **Создать**.


### <a name="create-virtual-machine"></a>Создание виртуальной машины

1. В верхней левой части экрана портал Azure выберите **создать ресурс** > **вычислений** > **Виртуальная машина**.

1. В окне **Создание виртуальной машины — Основы** введите или выберите следующую информацию:

    | Параметр | Значение |
    | ------- | ----- |
    | **Сведения о проекте** | |
    | Подписка | Выберите свою подписку. |
    | Группа ресурсов | Выберите **myResourceGroup**. Вы создали ее в предыдущем разделе.  |
    | **Подробности об экземпляре** |  |
    | Имя виртуальной машины | Введите *myVm*. |
    | Район | Выберите **WestCentralUS**. |
    | Параметры доступности | Оставьте значение по умолчанию **No infrastructure redundancy required** (Избыточность инфраструктуры не требуется). |
    | Изображение | Выберите **Windows Server 2019 Datacenter**. |
    | Size | Оставьте значение по умолчанию **Standard DS1 v2**. |
    | **Учетная запись администратора** |  |
    | Имя пользователя | Введите выбранное имя пользователя. |
    | Пароль | Введите выбранный пароль. Пароль должен включать минимум 12 символов и соответствовать [определенным требованиям к сложности](../virtual-machines/windows/faq.md?toc=%2fazure%2fvirtual-network%2ftoc.json#what-are-the-password-requirements-when-creating-a-vm).|
    | Подтверждение пароля | Введите пароль еще раз. |
    | **Правила входящего порта** |  |
    | Общедоступные входящие порты | Оставьте значение по умолчанию **Отсутствует**. |
    | **Экономия** |  |
    | Already have a Windows license? (У вас уже есть лицензия Windows?) | Оставьте значение по умолчанию **Нет**. |
    |||

1. По завершении выберите **Next: Диски**.

1. В окне **Создание виртуальной машины — диски**оставьте значения по умолчанию и нажмите **кнопку Далее. Сети**.

1. В окне **Создание виртуальной машины — Сети** выберите такую информацию:

    | Параметр | Значение |
    | ------- | ----- |
    | Виртуальная сеть | Оставьте **MyVirtualNetwork**по умолчанию.  |
    | Адресное пространство | Оставьте значение по умолчанию **10.1.0.0/24**.|
    | Subnet | Оставьте значение по умолчанию **mySubnet (10.1.0.0/24)** .|
    | Общедоступный IP-адрес | Оставьте значение по умолчанию **(new) myVm-ip**. |
    | Общедоступные входящие порты | Выберите **Разрешить выбранные порты**. |
    | Выбрать входящие порты | Выберите **HTTP** и **RDP**.|
    ||

1. Выберите **Review + create** (Просмотреть и создать). Вы будете перенаправлены на страницу **Просмотр и создание**, где Azure проверит вашу конфигурацию.

1. При появлении сообщения **Проверка пройдена** нажмите кнопку **Создать**.

## <a name="create-your-private-endpoint"></a>Создание частной конечной точки
В этом разделе вы создадите закрытую учетную запись хранения, используя для нее закрытую конечную точку. 

1. В верхней левой части экрана портал Azure выберите **создать ресурс** > **хранилище** > **учетная запись хранения**.

1. В статье **Создание учетной записи хранения — основные**сведения введите или выберите следующую информацию:

    | Параметр | Значение |
    | ------- | ----- |
    | **Сведения о проекте** | |
    | Подписка | Выберите свою подписку. |
    | Группа ресурсов | Выберите **myResourceGroup**. Вы создали ее в предыдущем разделе.|
    | **Подробности об экземпляре** |  |
    | Имя учетной записи хранения  | Введите *mystorageaccount*. Если это имя используется, создайте уникальное имя. |
    | Район | Выберите **WestCentralUS**. |
    | Производительность| Оставьте значение по умолчанию **Стандартная**. |
    | Тип учетной записи | Оставьте хранилище по умолчанию **(общее назначение версии 2)** . |
    | Репликация | Выберите **геоизбыточное хранилище с доступом для чтения (RA-GRS)** . |
    |||
  
3. Нажмите **кнопку Далее: сеть**.
4. В окне **Создание учетной записи хранения —** подключение к сети, метод подключения выберите **Частная конечная точка**.
5. В окне **Создание учетной записи хранения — сеть**выберите **Добавить частную конечную точку**. 
6. В окне **Создание частной конечной точки**введите или выберите следующие сведения:

    | Параметр | Значение |
    | ------- | ----- |
    | **Сведения о проекте** | |
    | Подписка | Выберите свою подписку. |
    | Группа ресурсов | Выберите **myResourceGroup**. Вы создали ее в предыдущем разделе.|
    |Местоположение|Выберите **WestCentralUS**.|
    |Название|Введите *миприватиндпоинт*.  |
    |Подресурс хранилища|Оставьте **большой двоичный объект**по умолчанию. |
    | **СЕТИ** |  |
    | Виртуальная сеть  | Выберите *MyVirtualNetwork* из группы ресурсов *myResourceGroup*. |
    | Subnet | Выберите *mySubnet*. |
    | **ЧАСТНАЯ ИНТЕГРАЦИЯ DNS**|  |
    | Интеграция с частной зоной DNS  | Оставьте значение по умолчанию **Да**. |
    | Зона Частная зона DNS  | Оставьте значение по умолчанию  ** (New) privatelink.BLOB.Core.Windows.NET**. |
    |||
7. Нажмите кнопку **ОК**. 
8. Выберите **Проверка и создать**. Вы перейдете на страницу " **Проверка и создание** ", где Azure проверяет вашу конфигурацию. 
9. Когда появится сообщение **Проверка пройдена** , выберите **создать**. 
10. Перейдите к только что созданному ресурсу учетной записи хранения.
11. Выберите **ключи доступа** в меню с содержимым слева.
12. Выберите **Копировать** в строке подключения для key1.
 
## <a name="connect-to-a-vm-from-the-internet"></a>Подключение к виртуальной машине из Интернета

Подключитесь к виртуальной машине *myVm* из Интернета следующим образом:

1. На панели поиска портала введите *myVm*.

1. Нажмите кнопку **Подключиться**. После нажатия кнопки **Подключиться** откроется окно **Connect to virtual machine** (Подключение к виртуальной машине).

1. Щелкните **Скачать RDP-файл**. Azure создаст и скачает на ваш компьютер файл протокола удаленного рабочего стола (*RDP*).

1. Откройте скачанный файл. RDP *.

    1. При появлении запроса выберите **Подключиться**.

    1. Введите имя пользователя и пароль, указанные при создании виртуальной машины.

        > [!NOTE]
        > Возможно, потребуется выбрать **More choices** > **Use a different account** (Дополнительные варианты > Использовать другую учетную запись), чтобы указать учетные данные, введенные при создании виртуальной машины.

1. Нажмите кнопку **ОК**.

1. При входе в систему может появиться предупреждение о сертификате. В таком случае выберите **Да** или **Продолжить**.

1. Когда появится рабочий стол виртуальной машины, сверните его, чтобы вернуться на локальный рабочий стол.  

## <a name="access-storage-account-privately-from-the-vm"></a>Доступ к учетной записи хранения в частном порядке с виртуальной машины

В этом разделе вы будете подключаться к учетной записи хранения с помощью частной конечной точки.

> [!IMPORTANT]
> Конфигурации DNS для хранилища требуется ручное изменение файла hosts для включения полного доменного имени конкретной учетной записи. Измените следующий файл, используя разрешения администратора в Windows: c:\Windows\System32\Drivers\etc\hosts или Linux/etc/hosts Включите сведения DNS для учетной записи из предыдущего шага в следующем формате: [частный IP-адрес] myaccount.blob.core.windows.net

1. В удаленный рабочий стол *myVM*откройте PowerShell.
2. Введите `nslookup mystorageaccount.blob.core.windows.net` примерно следующее сообщение:
    ```azurepowershell
    Server:  UnKnown
    Address:  168.63.129.16
    Non-authoritative answer:
    Name:    mystorageaccount123123.privatelink.blob.core.windows.net
    Address:  10.0.0.5
    Aliases:  mystorageaccount.blob.core.windows.net
3. Install [Microsoft Azure Storage Explorer](https://docs.microsoft.com/azure/vs-azure-tools-storage-manage-with-storage-explorer?toc=%2Fazure%2Fstorage%2Fblobs%2Ftoc.json&tabs=windows).
4. Select **Storage accounts** with the right-click.
5. Select **Connect to an azure storage**.
6. Select **Use a connection string**.
7. Select **Next**.
8. Enter the connection string by pasting the information previously copied.
9. Select **Next**.
10. Select **Connect**.
11. Browse the Blob containers from mystorageaccount 
12. (Optionally) Create folders and/or upload files to *mystorageaccount*. 
13. Close the remote desktop connection to *myVM*. 

Additional options to access the storage account:
- Microsoft Azure Storage Explorer is a standalone free app from Microsoft that enables you to work visually with Azure storage data on Windows, macOS, and Linux. You can install the application to browse privately the storage account content. 
 
- The AzCopy utility is another option for high-performance scriptable data transfer for Azure storage. Use AzCopy to transfer data to and from Blob, File, and Table storage. 


## Clean up resources 
When you're done using the Private Endpoint, storage account and the VM, delete the resource group and all of the resources it contains: 
1. Enter *myResourceGroup* in the **Search** box at the top of the portal and select *myResourceGroup* from the search results. 
2. Select **Delete resource group**. 
3. Enter *myResourceGroup* for **TYPE THE RESOURCE GROUP NAME** and select **Delete**. 

## Next steps
In this Quickstart, you created a VM on a virtual network and storage account and a Private Endpoint. You connected to one VM from the internet and securely communicated to the storage account using Private Link. To learn more about Private Endpoint, see [What is Azure Private Endpoint?](private-endpoint-overview.md).
