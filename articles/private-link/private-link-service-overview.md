---
title: Что такое служба частной ссылки Azure?
description: Узнайте об услуге Azure Private Link.
services: private-link
author: sumeetmittal
ms.service: private-link
ms.topic: conceptual
ms.date: 09/16/2019
ms.author: sumi
ms.openlocfilehash: 2cc6c577abdb3698ef6aca1f1f04d239f09d119c
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79280434"
---
# <a name="what-is-azure-private-link-service"></a>Что такое служба частной ссылки Azure?

Служба "Приватный канал" Azure — это ссылка на вашу собственную службу, которая работает на базе Приватного канала Azure. Ваша служба, работая за [балансом стандартной нагрузки Azure,](../load-balancer/load-balancer-standard-overview.md) может быть включена для доступа к Private Link, чтобы потребители вашей службы могли получить к ней доступ в частном порядке из собственных VNets. Ваши клиенты могут создать частную конечную точку внутри своего VNet и сопоставить ее с этой службой. В этой статье разъясняется понятие, связанное со стороной поставщика услуг. 

## <a name="workflow"></a>Рабочий процесс

![Рабочий процесс службы Private Link](media/private-link-service-overview/private-link-service-workflow.png)

### <a name="create-your-private-link-service"></a>Создайте службу частной ссылки

- Назначьте приложение, чтобы работать за стандартным балансером нагрузки в виртуальной сети. Если приложение уже настроено по стандартному балансулизатору нагрузки, вы можете пропустить этот шаг.   
- Создайте службу приватной ссылки, ссылающуюся на балансиватор нагрузки выше. В процессе выбора баланса нагрузки выберите конфигурацию IP-адреса, в которой вы хотите получить трафик. Выберите подсеть для IP-адресов NAT для службы частных ссылк. Рекомендуется иметь в подсети не менее восьми IP-адресов NAT. Весь потребительский трафик, как представляется, будет исходить из этого пула частных IP-адресов к поставщику услуг. Выберите соответствующие свойства/настройки для службы частных ссылок.    

    > [!NOTE]
    > Служба частных ссылок Azure поддерживается только на standard Load Balancer. 
    
### <a name="share-your-service"></a>Поделитесь своим сервисом

После создания службы Private Link Azure будет создавать глобально уникальное имя под названием «псевдоним» на основе имени, которое вы предоставляете для службы. Вы можете поделиться псевдонимом или ресурсом URI вашего сервиса с вашими клиентами в автономном режиме. Потребители могут начать подключение Private Link, используя псевдоним или ресурс URI.
 
### <a name="manage-your-connection-requests"></a>Управление запросами на подключение

После того, как потребитель инициирует подключение, поставщик услуг может принять или отклонить запрос на подключение. Все запросы на подключение будут перечислены в собственности **privateendpointconnections** в службе Private Link.
 
### <a name="delete-your-service"></a>Удалить свой сервис

Если служба Private Link больше не используется, вы можете удалить ее. Однако перед удалением службы убедитесь, что с ней нет личных соединений конечных точек. Вы можете отклонить все соединения и удалить службу.

## <a name="properties"></a>Свойства

Служба Private Link определяет следующие свойства: 

|Свойство |Объяснение  |
|---------|---------|
|Положение о предоставлении (положение)  |Свойство только для чтения, в которое перечислено текущее состояние подготовки для службы Private Link. Применимые положения подготовки: "Разгранижение; Не удалось; Успешно; Обновление". Когда состояние подготовки "Успешно", вы успешно предоставляете свой сервис Private Link.        |
|Прозвище (псевдоним)     | Alias является глобально уникальной строкой только для чтения для вашего сервиса. Это поможет вам замаскировать данные клиентов для вашего сервиса и в то же время создает простое в обмен еде для вашего сервиса. При создании службы Private Link Azure генерирует псевдоним для службы, которым вы можете поделиться со своими клиентами. Ваши клиенты могут использовать этот псевдоним для запроса подключения к вашей службе.          |
|Видимость (видимость)     | Видимость — это свойство, которое контролирует настройки экспозиции для службы Private Link. Поставщики услуг могут ограничить доступ к своим услугам подпискам с разрешениями управления доступом на основе ролей (RBAC), ограниченным набором подписок или всеми подписками Azure.          |
|Автоматическое утверждение (автоодобрение)    |   Автоматическое утверждение контролирует автоматизированный доступ к службе Private Link. Подписки, указанные в списке автоодобрения, утверждаются автоматически, когда подключение запрашивается из частных конечных точек в этих подписках.          |
|Конфигурация IP-адреса Грузобаланса Frontend (loadBalancerFrontendIpConfigurations)    |    Служба Private Link привязана к IP-адресу Стандартной нагрузки. Весь трафик, предназначенный для службы, достигнет передней части SLB. Вы можете настроить правила SLB, чтобы направить этот трафик в соответствующие пулы бэкэнда, где работают приложения. Конфигурации IP-адреса балансового баланса нагрузки отличаются от конфигураций NAT IP.      |
|Конфигурация IP-нацида NAT (ipConfigurations)    |    Это свойство относится к конфигурации IP-адреса NAT (Network Address Translation) для службы Private Link. IP-адрес NAT можно выбрать из любой подсети в виртуальной сети поставщика услуг. Частный ссылка служба выполняет назначения стороне NAT-ING на трафик Private Link. Это гарантирует отсутствие конфликта IP между пространством адресов источника (потребительская сторона) и местом назначения (поставщик услуг). Со стороны назначения (сторона поставщика услуг) IP-адрес NAT будет отображаться в качестве исходного IP для всех пакетов, полученных вашим сервисом и IP-адресом назначения для всех пакетов, отправленных вашей службой.       |
|Частные конечные соединения (privateEndpointConnections)     |  В этом свойстве перечислены частные конечные точки, подключенные к службе Private Link. Несколько частных конечных точек могут подключиться к одной и той же службе Private Link, а поставщик услуг может контролировать состояние для отдельных частных конечных точек.        |
|TCP Прокси V2 (EnableProxyProtocol)     |  Это свойство позволяет поставщику услуг использовать прокси-сервер tcp v2 для получения информации о подключении потребителя услуг. Поставщик услуг отвечает за настройку конфигураций приемника, чтобы иметь возможность разбирать заголовок прокси-протокола v2.        |
|||


### <a name="details"></a>Сведения

- Доступ к сервису Private Link можно получить из утвержденных частных конечных точек в том же регионе. Частная конечная точка может быть достигнута из той же виртуальной сети, регионально заглянул VNets, глобально заглянул VNets и на помещениях с использованием частных VPN или ExpressRoute соединений. 
 
- При создании службы private Link создается сетевой интерфейс для жизненного цикла ресурса. Этот интерфейс не управляется клиентом.
 
- Служба частной связи должна быть развернута в том же регионе, что и виртуальная сеть и балансер стандартной нагрузки.  
 
- Доступ к одной службе private Link можно получить из нескольких частных конечных точек, принадлежащих различным VNets, подпискам и/или арендаторам Active Directory. Соединение устанавливается через рабочий процесс соединения. 
 
- Несколько сервисов Private Link могут быть созданы на одном и том же балансе стандартной нагрузки с использованием различных конфигураций IP-адреса. Существует ограничение на количество услуг Private Link, которые можно создать в балансе стандартной нагрузки и на подписку. Для получения подробной [информации](https://docs.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits#networking-limits)см.
 
- Служба Private Link может иметь более одной конфигурации IP-адресов NAT. Выбор нескольких конфигураций NAT IP может помочь поставщикам услуг масштабироваться. Сегодня поставщики услуг могут назначать до восьми IP-адресов NAT на одну службу Private Link. С каждым IP-адресом NAT вы можете назначить больше портов для подключения TCP и таким образом масштабировать. После добавления нескольких IP-адресов NAT в службу Private Link нельзя удалять IP-адреса NAT. Это делается для того, чтобы активные соединения не замечались при утяге IP-адресов NAT.


## <a name="alias"></a>Псевдоним

**Alias** – это всемирно уникальное имя для вашего сервиса. Это поможет вам замаскировать данные клиентов для вашего сервиса и в то же время создает простое в обмен еде для вашего сервиса. При создании службы Private Link Azure генерирует псевдоним для службы, которым вы можете поделиться со своими клиентами. Ваши клиенты могут использовать этот псевдоним для запроса подключения к вашей службе.

Псевдоним состоит из трех частей: *Префикс*. *GUID*. *Суффикс*

- Префикс — это имя службы. Вы можете выбрать себе префикс. После создания "Alias" вы не можете изменить его, поэтому выберите префикс соответствующим образом.  
- GUID будет предоставляться платформой. Это помогает сделать имя глобально уникальным. 
- Суффикс придаток к лазурному берегу: *регион*.azure.privatelinkservice 

Полный псевдоним: *Префикс*. (ГУИД). *регион*.azure.privatelinkservice  

## <a name="control-service-exposure"></a>Экспозиция служб управления

Сервис Private Link предоставляет вам возможность контролировать экспозицию вашего сервиса с помощью параметра "Видимость". Вы можете сделать службу частной для потребления из различных VNets, которыми вы владеете (только разрешения RBAC), ограничить доступ к ограниченному набору подписок, которым вы доверяете, или сделать ее общедоступной, чтобы все подписки Azure могли запрашивать подключения в Private Link Службы. Настройки видимости определяют, может ли потребитель подключиться к вашей службе или нет. 

## <a name="control-service-access"></a>Доступ к службе управления

Потребители, имеющие экспозицию (контролируемую настройкой видимости) к службе Private Link, могут создать частную конечную точку в своих VNets и запросить подключение к службе Private Link. Частное соединение конечных точек будет создано в состоянии "В ожидании" на объекте службы Private Link. Поставщик услуг несет ответственность за действия по запросу соединения. Вы можете либо утвердить соединение, отклонить соединение или удалить соединение. Только утвержденные соединения могут отправлять трафик в службу Private Link.

Действие утверждения соединений можно автоматизировать с помощью свойства автоматического утверждения в службе Private Link. Auto-Approval — это возможность для поставщиков услуг предварительно утвердить набор подписок для автоматизированного доступа к своим услугам. Клиенты должны будут поделиться своими подписками в автономном режиме для поставщиков услуг, чтобы добавить в список авто-утверждения. Автоматическое утверждение — это подмножество массива видимости. Видимость контролирует настройки экспозиции, в то время как автоматическое утверждение контролирует настройки утверждения для службы. Если клиент запрашивает подключение от подписки в списке автоматического утверждения, соединение автоматически утверждается и соединение устанавливается. Поставщикам услуг больше не нужно вручную утверждать запрос. С другой стороны, если клиент запрашивает подключение от подписки в массиве видимости, а не в массиве автоматического утверждения, запрос дойдет до поставщика услуг, но поставщик услуг должен вручную утвердить соединения.

## <a name="getting-connection-information-using-tcp-proxy-v2"></a>Получение информации о подключении с помощью TCP Proxy v2

При использовании частной службы ссылок исходным IP-адресом пакетов, поступающих из частной конечной точки, является сетевой адрес, переведенный (NAT) со стороны поставщика услуг с помощью IP-адреса NAT, выделенного из виртуальной сети провайдера. Таким образом, приложения получают выделенный IP-адрес NAT вместо фактического исходного IP-адреса потребителей услуг. Если вашему приложению нужен фактический исходный IP-адрес со стороны потребителя, вы можете включить протокол Proxy в вашей службе и получить информацию из заголовка прокси-протокола. В дополнение к исходному IP-адресу, заголовок прокси-протокола также несет LinkID частной конечной точки. Комбинация исходного IP-адреса и LinkID может помочь поставщикам услуг однозначно идентифицировать своих потребителей. Для получения дополнительной информации о протоколе прокси, посетите [здесь](https://www.haproxy.org/download/1.8/doc/proxy-protocol.txt). 

Эта информация кодируется с помощью пользовательского вектора Type-Length-Value (TLV) следующим образом:

Пользовательские детали TLV:

|Поле |Длина (Октеты)  |Описание  |
|---------|---------|----------|
|Тип  |1        |PP2_TYPE_AZURE (0xEE)|
|Длина  |2      |Длина стоимости|
|Значение  |1     |PP2_SUBTYPE_AZURE_PRIVATEENDPOINT_LINKID (0x01)|
|  |4        |UINT32 (4 байта), представляющий LINKID частной конечной точки. Закодирован в маленьком эндианском формате.|

 > [!NOTE]
 > Поставщик услуг несет ответственность за то, чтобы служба, стоящая за стандартным балансера нагрузки, была настроена для разбора заголовка протокола прокси в соответствии с [спецификацией,](https://www.haproxy.org/download/1.8/doc/proxy-protocol.txt) когда протокол прокси включен в частную службу ссылок. Запрос не сработает, если настройка прокси-протокола включена в частную службу ссылок, но служба поставщика услуг не настроена для разбора заголовка. Аналогичным образом, запрос не будет сбой, если служба поставщика услуг ожидает прокси-протокол заголовок в то время как параметр не включен в частной службе ссылки. Как только настройка прокси-протокола включена, заголовок прокси-протокола также будет включен в зонды работы HTTP/TCP от хоста до бэкэнда виртуальных машин, даже если в заголовке не будет никакой информации о клиентах. 

## <a name="limitations"></a>Ограничения

Ниже приведены известные ограничения при использовании сервиса Private Link:
- Поддерживается только на балансе стандартной нагрузки 
- Поддерживает только трафик IPv4
- Поддерживает только трафик TCP

## <a name="next-steps"></a>Дальнейшие действия
- [Создание частной службы ссылки с помощью Azure PowerShell](create-private-link-service-powershell.md)
- [Создание частной службы ссылки с помощью Azure CLI](create-private-link-service-cli.md)
