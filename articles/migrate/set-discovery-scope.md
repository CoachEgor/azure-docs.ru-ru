---
title: Настройка области для обнаружения виртуальных машин VMware с помощью службы "миграция Azure"
description: Описание настройки области обнаружения для оценки виртуальных машин VMware и миграции с помощью службы "миграция Azure".
ms.topic: how-to
ms.date: 03/23/2020
ms.openlocfilehash: 29b3077ead168cef2790468d6ac62d1c59c24c11
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "80337640"
---
# <a name="set-discovery-scope-for-vmware-vms"></a>Задание области обнаружения для виртуальных машин VMware

В этой статье описывается, как ограничить область обнаружения для виртуальных машин VMware, обнаруженных устройством " [Миграция Azure](migrate-appliance-architecture.md)".

Устройство Azure Migrate выполняет обнаружение локальных виртуальных машин VMware в следующих случаях: 

- Используйте средство [Azure Migration: Server](migrate-services-overview.md#azure-migrate-server-assessment-tool) для оценки виртуальных машин VMware для миграции в Azure.
- Используйте средство [миграции с сервера Azure Migration](migrate-services-overview.md#azure-migrate-server-migration-tool) Tool для [миграции](server-migrate-overview.md) виртуальных машин VMware в Azure без агента.

## <a name="set-discovery-scope"></a>Задать область обнаружения


После настройки устройства "миграция Azure" для оценки или миграции виртуальных машин VMware устройство начинает Обнаружение виртуальных машин и отправляет метаданные виртуальной машины в Azure. Перед подключением устройства к vCenter Server для обнаружения можно задать область обнаружения, чтобы ограничить обнаружение vCenter Server центрами обработки данных, кластерами, папкой кластеров, узлами, папкой узлов или отдельными виртуальными машинами.

Чтобы задать область, необходимо назначить разрешения на учетную запись, которую использует служба "миграция Azure" для доступа к vCenter Server.

## <a name="create-a-vcenter-user-account"></a>Создание учетной записи vCenter

Если вы еще не настроили учетную запись пользователя vCenter, которую устройство Azure Migrate использует для обнаружения, оценки и миграции виртуальных машин VMware, сначала сделайте это.

1.    Войдите в веб-клиент vSphere с правами администратора vCenter Server.
2.    Выберите **Администрирование** > **Пользователи и группы единого входа**и перейдите на вкладку **Пользователи** .
3.    Щелкните значок **Новый пользователь**.
4.    Заполните сведения о новом пользователе > **ОК**.

Разрешения учетной записи зависят от того, что вы развертываете.

**Компонент** | **Разрешения учетной записи**
--- | ---
[Оценка](tutorial-assess-vmware.md)| Учетной записи требуется доступ только для чтения.
[Обнаружение приложений, ролей и функций](how-to-discover-applications.md) | Учетной записи требуется доступ только для чтения с включенными правами для виртуальных машин > гостевых операциях.
[Анализ зависимостей (без агента)](how-to-create-group-machine-dependencies-agentless.md) | Учетной записи требуется доступ только для чтения с включенными правами для виртуальных машин > гостевых операциях.
[Миграция (без агента)](tutorial-migrate-vmware.md) | Вам потребуется роль, которой назначены правильные разрешения.<br/><br/> Чтобы создать роль, войдите в веб-клиент vSphere в качестве администратора vCenter Server. Выберите экземпляр vCenter Server > **создать роль**. Укажите имя роли, например <em>Azure_Migrate</em>, и назначьте роли [необходимые разрешения](migrate-support-matrix-vmware-migration.md#agentless-vmware-servers) .


## <a name="assign-permissions-on-vcenter-objects"></a>Назначение разрешений для объектов vCenter

Разрешения для объектов инвентаризации можно назначить с помощью одного из двух методов:

- Назначьте роль с необходимыми разрешениями для учетной записи, которую вы используете, для всех родительских объектов, на которых размещаются виртуальные машины, которые необходимо обнаружить или перенести.
- Кроме того, можно назначить роль и учетную запись пользователя на уровне центра обработки данных и распространить их на дочерние объекты. Затем предоставьте учетной записи роль " **нет доступа** " для каждого объекта, который вы не хотите обнаруживать или переносить. Этот подход не рекомендуется, так как он громоздкий и может предоставлять доступ к элементам управления доступом, так как каждому новому дочернему объекту автоматически предоставляется доступ, наследуемый от родительского объекта.

Чтобы назначить роль учетной записи, которую вы используете для всех соответствующих объектов, выполните следующие действия.

- **Для оценки**: для оценки виртуальных машин примените роль **только для чтения** к учетной записи vCenter для всех родительских объектов, на которых размещаются виртуальные машины, которые необходимо обнаружить. Родительские объекты включают в себя: узел, папку узлов, кластер и папку кластеров в иерархии, вплоть до центра обработки данных. Распространить эти разрешения на дочерние объекты в иерархии.

    ![Назначение разрешений](./media/tutorial-assess-vmware/assign-perms.png)

- **Для миграции**без агента: для миграции без агента примените определяемую пользователем роль с [необходимыми разрешениями](migrate-support-matrix-vmware-migration.md#agentless-vmware-servers) для учетной записи пользователя для всех родительских объектов, на которых размещаются виртуальные машины, которые нужно обнаружить. Имя роли можно присвоить <em>Azure_Migrate</em>.

### <a name="scope-support"></a>Поддержка области

В настоящее время средство оценки серверов не может обнаружить виртуальные машины, если учетной записи vCenter предоставлен доступ на уровне папки виртуальной машины vCenter. Поддерживаются папки узлов и кластеров.

Если вы хотите определить область обнаружения по папкам виртуальных машин, выполните следующую процедуру, чтобы убедиться, что учетная запись vCenter имеет доступ только для чтения, назначенный на уровне виртуальной машины.

1. Назначьте разрешения только на чтение для всех виртуальных машин в папках виртуальных машин, для которых необходимо выполнить обнаружение.
2. Предоставьте доступ только для чтения всем родительским объектам, на которых размещаются виртуальные машины.
    - Включаются все родительские объекты (узел, папка узлов, кластер, папка кластеров) в иерархии вплоть до центра обработки данных.
    - Вам не нужно распространять разрешения на все дочерние объекты.
3. Используйте учетные данные для обнаружения, выбрав центр данных в качестве **области сбора данных**. Настройка управления доступом на основе ролей гарантирует, что соответствующая учетная запись пользователя vCenter имеет доступ только к виртуальным машинам, относящимся к конкретному клиенту.


## <a name="next-steps"></a>Дальнейшие шаги

[Настройте устройство](how-to-set-up-appliance-vmware.md) и [запустите непрерывное обнаружение](how-to-set-up-appliance-vmware.md#start-continuous-discovery-by-providing-vcenter-server-and-vm-credential).
