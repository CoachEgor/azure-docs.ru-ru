---
title: Настройка прибора Azure Migrate для Hyper-V
description: Узнайте, как настроить прибор Azure Migrate для оценки и переноса ВМ с Hyper-V.
ms.topic: article
ms.date: 03/23/2020
ms.openlocfilehash: 77c13a3a8c87d116bd0863324d28669185c53c84
ms.sourcegitcommit: 31ef5e4d21aa889756fa72b857ca173db727f2c3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81538296"
---
# <a name="set-up-an-appliance-for-hyper-v-vms"></a>Настройка прибора для Hyper-V VM

Следите за этой статьей, чтобы настроить прибор Azure Migrate для оценки Hyper-V VMs с помощью инструмента [оценки Azure Migrate:Server Assessment.](migrate-services-overview.md#azure-migrate-server-assessment-tool)

[Прибор Azure Migrate](migrate-appliance.md) — это легкий прибор, используемый Azure Migrate/Migration для обнаружения на фотонных Hyper-V V MM и отправки данных о метадатах/производительности VM в Azure.

Развертывание прибора можно несколькими методами:

- Настройка на Hyper-V VM с помощью загруженного VHD. Это метод, описанный в этой статье.
- Настройка на Hyper-V VM или физической машине со скриптом установки PowerShell. [Этот метод](deploy-appliance-script.md) следует использовать, если вы не можете настроить VM с помощью VHD, или если вы находитесь в правительстве Azure.

После создания модуля убедитесь, что он может подключиться к средству оценки серверов службы "Миграция Azure", выполните его первоначальную настройку и зарегистрируйте в проекте службы "Миграция Azure".

## <a name="appliance-deployment-vhd"></a>Развертывание приборов (VHD)

Настройка прибора с помощью шаблона VHD:

- Скачайте сжатый виртуальный жесткий диск Hyper-V с портала Azure.
- Создайте устройство и убедитесь, что оно может подключиться к средству оценки сервера в службе "Миграция Azure".
- Настройте устройство в первый раз и зарегистрируйте его в проекте службы "Миграция Azure".

## <a name="download-the-vhd"></a>Скачивание VHD-файла

Скачайте сжатый шаблон VHD для устройства.

1. Последовательно выберите разделы **Цели миграции** > **Серверы** > **Azure Migrate: Server Assessment (Миграция Azure: оценка серверов)** и щелкните **Обнаружение**.
2. В разделе**Обнаружение компьютеров** > **Ваши компьютеры виртуализированы?** выберите **Да, с Hyper-V**.
3. Нажмите кнопку **Скачать**, чтобы скачать VHD-файл.

    ![Скачивание виртуальной машины](./media/how-to-set-up-appliance-hyper-v/download-appliance-hyperv.png)


### <a name="verify-security"></a>Проверка безопасности

Прежде чем развертывать сжатый ZIP-файл, убедитесь, что он не поврежден.

1. На компьютере, на который был скачан файл, откройте командное окно с правами администратора.
2. Выполните следующую команду, чтобы создать хэш VHD-файла.
    - ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
    - Пример использования: ```C:\>CertUtil -HashFile C:\AzureMigrate\AzureMigrate.vhd SHA256```
3.  Для версии прибора 2.19.11.12 генерируемый хэш должен соответствовать этим [настройкам.](https://docs.microsoft.com/azure/migrate/tutorial-assess-hyper-v#verify-security)




## <a name="create-the-appliance-vm"></a>Создание виртуальной машины устройства

Импортируйте скачанный файл и создайте виртуальную машину.

1. Извлеките сжатый VHD-файл в папку на узле Hyper-V, на котором будет размещена виртуальная машина устройства. Извлекаются три папки.
2. Откройте диспетчер Hyper-V. В меню **Actions** (Действия) щелкните команду **Import Virtual Machine** (Импорт виртуальной машины).

    ![Развертывание VHD](./media/how-to-set-up-appliance-hyper-v/deploy-vhd.png)

2. В мастере импорта виртуальных машин в разделе **Before you begin** (Перед началом работы) нажмите кнопку **Next** (Далее).
3. В поле **Locate Folder** (Определить папку) укажите папку, содержащую извлеченный VHD. Затем нажмите кнопку **Далее**.
1. В меню **Select Virtual Machine** (Выбор виртуальной машины) нажмите кнопку **Next** (Далее).
2. В меню **Choose Import Type** (Выбор типа импорта) щелкните **Copy the virtual machine (create a new unique ID)** (Копировать виртуальную машину (создать уникальный идентификатор)). Затем нажмите кнопку **Далее**.
3. В меню **Choose Destination** (Выбор назначения) оставьте параметр по умолчанию. Щелкните **Далее**.
4. В меню **Storage Folders** (Папки хранилища) оставьте значение по умолчанию. Щелкните **Далее**.
5. В поле **Choose Network** (Выбор сети) укажите виртуальный коммутатор, который будет использоваться виртуальной машиной. Ему требуется подключение к Интернету для отправки данных в Azure.
6. Просмотрите информацию на странице **Summary** (Сводка). Нажмите кнопку **Готово**.
7. В диспетчере Hyper-V в разделе **Virtual Machines** (Виртуальные машины) запустите виртуальную машину.


### <a name="verify-appliance-access-to-azure"></a>Проверка доступа устройства к Azure

Убедитесь, что прибор VM может подключаться к URL-адресам Azure для [общедоступных](migrate-appliance.md#public-cloud-urls) и [правительственных](migrate-appliance.md#government-cloud-urls) облаков.

## <a name="configure-the-appliance"></a>Настройка устройства

Настройте устройство в первый раз. При развертывании прибора с помощью скрипта вместо VHD первые два шага в процедуре не применимы.

1. В диспетчере Hyper-V в разделе **Virtual Machines** (Виртуальные машины) щелкните правой кнопкой мыши виртуальную машину и выберите **Connect** (Подключиться).
2. Укажите язык, часовой пояс и пароль для устройства.
3. Откройте браузер на любом компьютере, который может подключиться к виртуальной машине, и откройте URL-адрес веб-приложения устройства: **https://*имя устройства или IP-адрес*: 44368**.

   Кроме того, вы можете открыть приложение с рабочего стола устройства, щелкнув ярлык приложения.
1. В веб-приложении выберите **Настройка необходимых компонентов** и выполните приведенные ниже действия.
    - **Лицензия**: Примите условия лицензии и прочитайте информацию от сторонних производителей.
    - **Возможность подключения**: приложение проверит наличие доступа к Интернету у виртуальной машины. Если виртуальная машина использует прокси, выполните приведенные ниже действия.
        - Щелкните **Proxy settings** (Параметры прокси-сервера) и укажите адрес и порт прослушивания прокси-сервера в виде http://ProxyIPAddress или http://ProxyFQDN.
        - Укажите учетные данные, если для прокси-сервера требуется аутентификация.
        - Поддерживается только прокси-сервер HTTP.
    - **Синхронизация времени**: время проверяется. Время на устройстве должно быть синхронизировано со временем в Интернете для правильной работы обнаружения виртуальных машин.
    - **Установка обновлений**: средство "Оценка сервера" службы "Миграция Azure" проверяет, установлены ли на устройстве последние обновления.

### <a name="register-the-appliance-with-azure-migrate"></a>Регистрация устройства с помощью службы "Миграция Azure"

1. Щелкните **Войти в систему**. Если этот параметр не отображается, убедитесь, что в браузере отключена блокировка всплывающих окон.
2. На новой вкладке выполните вход с использованием учетных данных Azure.
    - Войдите с использованием имени пользователя и пароля.
    - Вход с помощью PIN-кода не поддерживается.
3. После успешного входа вернитесь к веб-приложению.
4. Выберите подписку, в которой был создан проект службы "Миграция Azure". Затем выберите проект.
5. Укажите имя для устройства. Это имя должно содержать буквы и цифры, не более 14 символов.
6. Щелкните **Зарегистрировать**.


### <a name="delegate-credentials-for-smb-vhds"></a>Делегирование учетных данных для виртуальных жестких дисков SMB

Если вы запускаете виртуальные жесткие диски в SMB, необходимо включить делегирование учетных данных с устройства на узлы Hyper-V. Для этого из прибора:

1. На виртуальной машине устройства выполните эту команду. HyperVHost1/HyperVHost2 — это примеры имен узлов.

    ```
    Enable-WSManCredSSP -Role Client -DelegateComputer HyperVHost1.contoso.com HyperVHost2.contoso.com -Force
    ```

2. Кроме того, это можно сделать в редакторе локальных групповых политик на устройстве:
    - В разделе **Политика локального компьютера** > **Конфигурация компьютера** щелкните **Административные шаблоны** > **Система** > **Передача учетных данных**.
    - Дважды щелкните **Разрешить передачу новых учетных данных** и выберите **Включено**.
    - В разделе **Параметры** щелкните **Показать** и добавьте в список каждый узел Hyper-V, который требуется обнаружить, используя **wsman/** в качестве префикса.
    - В области **Передача учетных данных** дважды щелкните **Разрешить делегирование новых учетных данных с проверкой подлинности сервера "только NTLM"**. Еще раз добавьте в список каждый узел Hyper-V, который требуется обнаружить, используя **wsman/** в качестве префикса.

## <a name="start-continuous-discovery"></a>Запуск непрерывного обнаружения

Подключитесь с устройства к узлам или кластерам Hyper-V и запустите обнаружение виртуальных машин.

1. В полях **Имя пользователя** и **Пароль** укажите данные учетной записи, которую устройство будет использовать для обнаружения виртуальных машин. Укажите понятное имя учетных данных и щелкните **Сохранить подробности**.
2. Щелкните **Добавить узел** и укажите сведения об узле или кластере Hyper-V.
3. Нажмите кнопку **Проверить**. После проверки отображается число виртуальных машин, которые можно обнаружить на каждом узле или кластере.
    - Если проверка для узла завершается неудачно, проверьте ошибку, наведя указатель мыши на значок в столбце **Состояние**. Устраните проблемы и повторите проверку.
    - Чтобы удалить узлы или кластеры, выберите **Удалить**.
    - Невозможно удалить конкретный узел из кластера. Вы можете удалить только весь кластер.
    - Вы можете добавить кластер, даже если возникли проблемы с конкретными узлами в кластере.
4. После проверки щелкните **Сохранить и начать обнаружение**, чтобы начать процесс обнаружения.

Запустится обнаружение. Чтобы метаданные обнаруженных виртуальных машин отобразились на портале Azure, потребуется около 15 минут.

## <a name="verify-vms-in-the-portal"></a>Проверка виртуальных машин на портале

После завершения обнаружения вы можете убедиться, что виртуальные машины отображаются на портале Azure.

1. Откройте панель мониторинга службы "Миграция Azure".
2. На странице **Azure Migrate — Servers** > **Azure Migrate: Server Assessment** (Миграция Azure — серверы > Миграция Azure: оценка сервера) щелкните значок, отображающий количество **обнаруженных серверов**.


## <a name="next-steps"></a>Следующие шаги

Попробуйте [оценку Hyper-V](tutorial-assess-hyper-v.md) с помощью оценки Azure Migrate Server.
