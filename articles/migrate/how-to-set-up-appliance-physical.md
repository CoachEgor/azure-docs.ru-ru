---
title: Настройка устройства "миграция Azure" для физических серверов
description: Узнайте, как настроить устройство "миграция Azure" для оценки физических серверов.
ms.service: azure-migrate
ms.topic: article
ms.date: 04/15/2020
ms.openlocfilehash: 1b4e875a81c92f74cd7d2db96cf1c313157297eb
ms.sourcegitcommit: 62e1884457b64fd798da8ada59dbf623ef27fe97
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2020
ms.locfileid: "88923579"
---
# <a name="set-up-an-appliance-for-physical-servers"></a>Настройка устройства для физических серверов

В этой статье описывается, как настроить устройство службы "миграция Azure", если вы оцениваете физические серверы с помощью средства Azure Migrate: Server (средство оценки серверов).

Устройство "миграция Azure" — это упрощенное устройство, используемое службой "миграция Azure: Оценка серверов" для выполнения следующих задач.

- Обнаружение локальных серверов.
- Отправка метаданных и данных о производительности обнаруженных серверов в Azure для оценки сервера.

Дополнительные [сведения](migrate-appliance.md) об устройстве миграции Azure.


## <a name="appliance-deployment-steps"></a>Этапы развертывания устройства

Чтобы настроить устройство, сделайте следующее.
- Укажите имя устройства и создайте ключ проекта "миграция Azure" на портале.
- Скачайте ZIP-файл со скриптом установщика службы "Миграция Azure" с портала Azure.
- Извлеките содержимое ZIP-файла. Откройте консоль PowerShell с правами администратора.
- Выполните скрипт PowerShell, чтобы запустить веб-приложение устройства.
- Настройте устройство в первый раз и зарегистрируйте его в проекте службы "миграция Azure" с помощью ключа проекта "миграция Azure".

### <a name="generate-the-azure-migrate-project-key"></a>Создание ключа проекта службы "миграция Azure"

1. Последовательно выберите разделы **Цели миграции** > **Серверы** > **Azure Migrate: оценка серверов** и щелкните **Обнаружить**.
2. В разделе **Обнаружение компьютеров**  >  **виртуальные машины виртуализованные?** выберите **физический или другой (AWS, обеспечить, Xen и т. д.)**.
3. В **разделе 1. Создание ключа проекта для службы "миграция Azure**" укажите имя для устройства "миграция Azure", которое будет настроено для обнаружения физических или виртуальных серверов. Имя должно состоять из букв и цифр длиной не более 14 символов.
1. Щелкните **создать ключ** , чтобы начать создание необходимых ресурсов Azure. Не закрывайте страницу Обнаружение компьютеров во время создания ресурсов.
1. После успешного создания ресурсов Azure создается ключ проекта службы " **Миграция Azure** ".
1. Скопируйте ключ, так как он потребуется для завершения регистрации устройства во время его настройки.

### <a name="download-the-installer-script"></a>Скачивание скрипта установщика

В **2. Скачайте устройство для переноса Azure**, щелкните **скачать**.

   ![Параметры для обнаружения компьютеров](./media/tutorial-assess-physical/servers-discover.png)


   ![Параметры для создания ключа](./media/tutorial-assess-physical/generate-key-physical.png)

### <a name="verify-security"></a>Проверка безопасности

Прежде чем развертывать сжатый ZIP-файл, убедитесь, что он не поврежден.

1. На компьютере, на который был скачан файл, откройте командное окно с правами администратора.
2. Выполните следующую команду, чтобы создать хэш ZIP-файла.
    - ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
    - Пример использования для общедоступного облака: ```C:\>CertUtil -HashFile C:\Users\administrator\Desktop\AzureMigrateInstaller-Server-Public.zip SHA256 ```.
    - Пример использования для облака для государственных организаций: ```  C:\>CertUtil -HashFile C:\Users\administrator\Desktop\AzureMigrateInstaller-Server-USGov.zip MD5 ```.
3.  Проверьте последнюю версию устройства и [Параметры](./tutorial-assess-physical.md#verify-security)хэш-значений.
 

## <a name="run-the-azure-migrate-installer-script"></a>Запуск скрипта установщика службы "Миграция Azure"
Скрипт установщика выполняет следующие операции.

- Устанавливает агенты и веб-приложения для обнаружения и оценки физических серверов.
- Устанавливает роли Windows, включая службу активации Windows, IIS и интегрированную среду разработку PowerShell.
- Скачивает и устанавливает доступный для записи модуль IIS. [Подробнее](https://www.microsoft.com/download/details.aspx?id=7435).
- Обновляет раздел реестра (HKLM), используя постоянные значения параметров для службы "Миграция Azure".
- Создает следующие файлы по указанному пути.
    - **Файлы конфигурации**: %Programdata%\Microsoft Azure\Config
    - **Файлы журнала**: %Programdata%\Microsoft Azure\Logs

Выполните скрипт следующим образом:

1. Извлеките ZIP-файл в папку на сервере, на котором будет размещено устройство.  Убедитесь, что скрипт не выполняется на виртуальной машине в существующем устройстве Миграции Azure.
2. Запустите PowerShell на указанном сервере с повышенными правами (права администратора).
3. Измените каталог PowerShell на папку, в которую было извлечено содержимое скачанного ZIP-файла.
4. Запустите скрипт с именем **AzureMigrateInstaller.ps1**, выполнив следующую команду:

    - Для общедоступного облака: 
    
        ``` PS C:\Users\administrator\Desktop\AzureMigrateInstaller-Server-Public> .\AzureMigrateInstaller.ps1 ```
    - Для Azure для государственных организаций: 
    
        ``` PS C:\Users\Administrators\Desktop\AzureMigrateInstaller-Server-USGov>.\AzureMigrateInstaller.ps1 ```

    После успешного завершения скрипт запустит веб-приложение устройства.

Журналы скриптов для устранения неполадок см. здесь: C:\ProgramData\Microsoft Azure\Logs\AzureMigrateScenarioInstaller_<em>Timestamp</em>.log.



### <a name="verify-appliance-access-to-azure"></a>Проверка доступа устройства к Azure

Убедитесь, что виртуальная машина устройства может подключиться к URL-адресам Azure для [общедоступного](migrate-appliance.md#public-cloud-urls) облака и облака для [государственных организаций](migrate-appliance.md#government-cloud-urls).

### <a name="configure-the-appliance"></a>Настройка устройства

Настройте устройство в первый раз.

1. Откройте браузер на любом компьютере, который может подключиться к устройству, и откройте URL-адрес веб-приложения устройства: **https://*имя или IP-адрес устройства*: 44368**.

   Кроме того, вы можете открыть приложение с рабочего стола, щелкнув ярлык приложения.
2. Примите **условия лицензионного соглашения**и ознакомьтесь со сторонними сведениями.
1. В веб-приложении выберите **Настройка необходимых компонентов** и выполните приведенные ниже действия.
    - **Возможность подключения**: Приложение проверит наличие доступа к Интернету у сервера. Если на сервере используется прокси-сервер:
        - Щелкните **настроить прокси-сервер** и укажите адрес прокси-сервера (в форме http://ProxyIPAddress или http://ProxyFQDN) прослушиваемом порте).
        - Укажите учетные данные, если для прокси-сервера требуется аутентификация.
        - Поддерживается только прокси-сервер HTTP.
        - Если вы добавили сведения о прокси-сервере или отключили прокси и (или) проверку подлинности, нажмите кнопку **сохранить** , чтобы активировать проверку подключения снова.
    - **Синхронизация времени**: время проверяется. Для правильной работы обнаружения серверов время на устройстве должно быть синхронизировано со временем в Интернете.
    - **Установка обновлений**. Оценка сервера "миграция Azure" проверяет, установлены ли на устройстве последние обновления. После завершения проверки можно щелкнуть **Просмотр служб устройства** , чтобы просмотреть состояние и версии компонентов, выполняющихся на устройстве.

### <a name="register-the-appliance-with-azure-migrate"></a>Регистрация устройства с помощью службы "Миграция Azure"

1. Вставьте **ключ проекта "миграция Azure** ", скопированный с портала. Если у вас нет ключа, перейдите в раздел **Оценка сервера> обнаружение> управление существующими устройствами**, выберите имя устройства, которое вы указали во время создания ключа, и скопируйте соответствующий ключ.
1. Щелкните **Вход**. Откроется окно входа в Azure на новой вкладке браузера. Если он не отображается, убедитесь, что вы отключили блокирование всплывающих окон в браузере.
1. В новой вкладке выполните вход, используя имя пользователя и пароль Azure.
   
   Вход с помощью PIN-кода не поддерживается.
3. После успешного входа вернитесь в веб-приложение. 
4. Если учетная запись пользователя Azure, используемая для ведения журнала, имеет правильные [разрешения](tutorial-prepare-physical.md) на ресурсы Azure, созданные во время создания ключа, будет инициирована регистрация устройства.
1. После успешной регистрации устройства можно просмотреть сведения о регистрации, щелкнув **Просмотреть сведения**.


## <a name="start-continuous-discovery"></a>Запуск непрерывного обнаружения

Далее подключитесь с устройства к физическим серверам, которые требуется обнаружить, и запустите процесс обнаружения.

1. На **шаге 1. Укажите учетные данные для обнаружения физических или виртуальных серверов Windows и Linux**, щелкните **Добавить учетные данные** , чтобы указать понятное имя учетных данных, добавить **имя пользователя** и **пароль** для сервера Windows или Linux. Щелкните **Save**(Сохранить).
1. Если вы хотите добавить несколько учетных данных одновременно, щелкните **Добавить еще** , чтобы сохранить и добавить дополнительные учетные данные. Для обнаружения физических серверов поддерживается несколько учетных данных.
1. На **шаге 2. Укажите сведения о физическом или виртуальном сервере**, щелкните **Добавить источник обнаружения** , чтобы указать **IP-адрес или полное доменное** имя сервера, а также понятные имена учетных данных для подключения к серверу.
1. Можно **добавить один элемент** за раз или **Добавить несколько элементов** в одном пути. Существует также параметр для предоставления сведений о сервере с помощью **импорта CSV**-файла.

    ![Параметры для добавления источника обнаружения](./media/tutorial-assess-physical/add-discovery-source-physical.png)

    - При выборе **пункта добавить один элемент**можно выбрать тип ОС, указать понятное имя для учетных данных, добавить **IP-адрес или полное доменное** название сервера и нажать кнопку **сохранить**.
    - При выборе параметра **Добавить несколько элементов**можно добавить сразу несколько записей, указав **IP-адрес или полное доменное** имя сервера с понятным именем для учетных данных в текстовом поле. **Проверьте** добавленные записи и нажмите кнопку " **сохранить**".
    - Если выбрать **Импорт CSV** _(выбран по умолчанию)_, можно скачать CSV-файл шаблона, заполняя в файле **IP Address/FQDN** и понятное имя для учетных данных. Затем файл импортируется в устройство, **Проверьте** записи в файле и нажмите кнопку **сохранить**.

1. При нажатии кнопки сохранить устройство попытается проверить подключение к добавленным серверам и отобразит **состояние проверки** в таблице для каждого сервера.
    - Если проверка не пройдена для сервера, проверьте ошибку, щелкнув в столбце Состояние таблицы значение Ошибка **проверки** . Устраните проблему и повторите проверку.
    - Чтобы удалить сервер, нажмите кнопку **Удалить**.
1. Можно повторно **проверить** подключение к серверам в любое время перед началом обнаружения.
1. Нажмите кнопку **запустить обнаружение**, чтобы начать обнаружение успешно проверенных серверов. После успешной инициализации обнаружения можно проверить состояние обнаружения для каждого сервера в таблице.


Запустится обнаружение. Для отображения метаданных обнаруженного сервера в портал Azure требуется примерно 2 минуты на сервер.

## <a name="verify-servers-in-the-portal"></a>Проверка серверов на портале

После завершения обнаружения можно убедиться, что серверы отображаются на портале.

1. Откройте панель мониторинга службы "Миграция Azure".
2. На странице **Azure Migrate — Servers** > **Azure Migrate: Server Assessment** (Миграция Azure — серверы > Миграция Azure: оценка сервера) щелкните значок, отображающий количество **обнаруженных серверов**.


## <a name="next-steps"></a>Дальнейшие действия

Испытайте [оценку физических серверов](tutorial-assess-physical.md) с помощью службы "Миграция серверов Azure".
