---
title: Миграция на основе агентов в Azure миграция миграции сервера
description: Содержит общие сведения о миграции виртуальных машин VMware на основе агентов с миграцией Azure миграция сервера.
author: rayne-wiselman
ms.service: azure-migrate
ms.topic: conceptual
ms.date: 11/19/2019
ms.author: raynew
ms.openlocfilehash: a8477b4c10ccbc76f36eed4d64ac12e8bb648a28
ms.sourcegitcommit: dbde4aed5a3188d6b4244ff7220f2f75fce65ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/19/2019
ms.locfileid: "74186101"
---
# <a name="agent-based-migration-architecture"></a>Архитектура миграции на основе агента

В этой статье приводятся общие сведения об архитектуре и процессах, используемых для репликации на основе агентов, с помощью средства миграции сервера Azure Migration Server.

Служба " [Миграция Azure](migrate-services-overview.md) " предоставляет центральный концентратор для наблюдения за обнаружением, оценкой и миграцией локальных приложений и рабочих нагрузок, а также экземпляров ВИРТУАЛЬНЫХ машин AWS/обеспечить в Azure. Эта служба предоставляет инструменты для оценки и миграции, а также предложения сторонних независимых поставщиков программного обеспечения (ISV).

## <a name="agent-based-replication"></a>Репликация на основе агентов

Репликация на основе агентов в средстве репликации Azure Migrate Server используется для переноса локальных виртуальных машин VMware и физических серверов в Azure. Его также можно использовать для миграции других локальных виртуальных серверов, а также частных и общедоступных облачных виртуальных машин, включая экземпляры AWS и виртуальные машины обеспечить.

Для миграции VMware средство миграции сервера Azure Migration Server предлагает несколько вариантов:

- Миграция с использованием репликации на основе агента, как описано в этой статье.
- Безагентная репликация для переноса виртуальных машин без необходимости установки каких-либо компонентов.

Дополнительные сведения о [выборе метода миграции для VMware](server-migrate-overview.md).

## <a name="server-migration-and-azure-site-recovery"></a>Миграция и Azure Site Recovery сервера

Миграция сервера в Azure — это инструмент для переноса локальных и общедоступных облачных рабочих нагрузок в Azure. Она оптимизирована для миграции. Site Recovery — это средство аварийного восстановления. Миграция сервера Azure и Site Recovery совместно используют некоторые общие технологические компоненты, используемые для репликации данных, но служат разным целям.

## <a name="architectural-components"></a>Компоненты архитектуры

![Архитектура](./media/agent-based-replication-architecture/architecture.png)

В таблице перечислены компоненты, используемые для миграции на основе агентов.

**Компонент** | **Дополнительные сведения** | **Установка**
--- | --- | ---
**Устройство репликации** | Устройство репликации (сервер конфигурации) — это локальный компьютер, который выступает в качестве моста между локальной средой, а также средством миграции сервера Azure. Устройство обнаруживает локальную инвентаризацию виртуальных машин, чтобы миграция сервера Azure могла управлять репликацией и миграцией. Устройство имеет два компонента:<br/><br/> **Сервер конфигурации**: подключается к миграции сервера в Azure миграция и координирует репликацию.<br/> **Сервер обработки**: обрабатывает репликацию данных. Он получает данные виртуальной машины, сжимает их и шифрует, а затем отправляет в подписку Azure. В этом случае Серверная миграция записывает данные на управляемые диски. | По умолчанию сервер обработки устанавливается вместе с сервером конфигурации на устройстве репликации.
**Служба Mobility Service** | Служба Mobility Service — это агент, установленный на каждом компьютере, который необходимо реплицировать и перенести. Он отправляет данные репликации с компьютера на сервер обработки. Существует несколько различных доступных агентов службы Mobility Service. | Файлы установки для службы Mobility Service находятся на устройстве репликации. Вы скачиваете и устанавливаете необходимые агенты в соответствии с операционной системой и версией компьютера, который требуется реплицировать.

### <a name="mobility-service-installation"></a>Установка службы Mobility Service

Вы можете запустить службу Mobility Service одним из следующих способов:

- **Принудительная установка**. Служба Mobility Service устанавливается сервером обработки при включении защиты для компьютера. 
- **Установка вручную**. службу Mobility Service можно установить вручную на каждом компьютере с помощью пользовательского интерфейса или командной строки.

Служба Mobility Service взаимодействует с устройством репликации и реплицированными компьютерами. Если антивирусное программное обеспечение запущено на устройстве репликации, серверах обработки или реплицируемых компьютерах, следующие папки должны быть исключены из проверки:


- C:\Program Files\Microsoft Azure Recovery Services Agent
- C:\ProgramData\ASR.
- C:\ProgramData\ASRLogs.
- C:\ProgramData\ASRSetupLogs.
- C:\ProgramData\LogUploadServiceLogs.
- C:\ProgramData\Microsoft Azure Site Recovery.
- C:\Program Files (x86)\Microsoft Azure Site Recovery
- К:\програмдата\аср\ажент (на компьютерах Windows с установленной службой Mobility Service)

## <a name="replication-process"></a>Процесс репликации

1. При включении репликации для виртуальной машины начинается начальная репликация в Azure.
2. Во время начальной репликации служба Mobility Service считывает данные с дисков компьютера и отправляет их на сервер обработки.
3. Эти данные используются для заполнения копии диска в подписке Azure. 
4. После завершения начальной репликации начинается репликация разностных изменений в Azure. Репликация — уровень блокировки и почти непрерывная.
4. Служба Mobility Service перехватывает операции записи в память диска виртуальной машины путем интеграции с подсистемой хранения операционной системы. Этот метод позволяет избежать операций дискового ввода-вывода на реплицируемом компьютере для добавочной репликации. 
5. Записанные изменения для компьютера отправляются на сервер обработки через порт HTTPS 9443 inbound. Этот порт можно изменить. Сервер обработки сжимает и шифрует его, а затем отправляет в Azure. 

## <a name="ports"></a>порты;

**Устройство** | **Connection**
--- | --- 
Виртуальные машины | Служба Mobility Service, работающая на виртуальных машинах, обменивается данными с локальным устройством репликации через порт HTTPS 443 Inbound для управления репликацией.<br/><br/> Виртуальные машины отправляют данные репликации на сервер обработки (по умолчанию выполняется на устройстве репликации) через порт HTTPS 9443 inbound. Этот порт можно изменить.
Устройство репликации | Устройство репликации управляет репликацией с помощью Azure через порт HTTPS 443 Outbound.
Сервер обработки | Сервер обработки получает данные репликации, оптимизирует и шифрует их, а затем отправляет в службу хранилища Azure через порт 443 для исходящих подключений.


## <a name="performance-and-scaling"></a>Производительность и масштабируемость

По умолчанию развертывается одно устройство репликации, на котором запущены сервер конфигурации и сервер обработки. Если репликация выполняется только на нескольких компьютерах, это развертывание достаточно. Однако при репликации и переносе сотен компьютеров один сервер обработки может не суметь обработать весь трафик репликации. В этом случае можно развернуть дополнительные серверы обработки масштабирования.

### <a name="site-recovery-deployment-planner-for-vmware"></a>Планировщик развертывания Site Recovery для VMware

При репликации виртуальных машин VMware можно использовать [Планировщик развертывания Site Recovery](../site-recovery/site-recovery-deployment-planner.md) для VMware, чтобы определить требования к производительности, в том числе частоту ежедневных изменений данных и необходимые серверы обработки.

### <a name="replication-appliance-capacity"></a>Емкость устройства репликации

Значения в этой таблице можно использовать, чтобы выяснить, нужен ли дополнительный сервер обработки в развертывании.

- Если частота ежедневного изменения (частота обновления) превышает 2 ТБ, разверните дополнительный сервер обработки.
- Если выполняется репликация более 200 компьютеров, разверните дополнительное устройство репликации.

**ЦП** | **Память** | **Свободное место для кэширования данных** | **Частота обновлений** | **Ограничения репликации**
--- | --- | --- | --- | ---
8 виртуальных ЦП (2 сокета по 4 ядра с частотой \@ 2,5 ГГц) | 16 ГБ | 300 ГБ | 500 ГБ или менее | < 100 компьютеров 
12 виртуальных ЦП (2 сокета по 6 ядер с частотой \@ 2,5 ГГц) | 18 ГБ | 600 ГБ | От 501 ГБ до 1 ТБ | 100-150 компьютеров.
16 виртуальных ЦП (2 сокета по 8 ядер с частотой \@ 2,5 ГГц) | 32 G1 |  1 TБ | От 1 ТБ до 2 ТБ | 151-200 компьютеров.

### <a name="scale-out-process-server-sizing"></a>Изменение размера сервера обработки масштабирования

Если необходимо развернуть сервер обработки масштабирования, эта таблица поможет выяснить размер сервера.

**Сервер обработки** | **Свободное место для кэширования данных** | **Частота обновлений** | **Ограничения репликации**
--- | --- | --- | --- 
4 виртуальных ЦП (2 сокета по 2 ядра с частотой \@ 2,5 ГГц), 8 ГБ памяти | 300 ГБ | 250 ГБ или менее | До 85 компьютеров 
8 виртуальных ЦП (2 сокета по 4 ядра с частотой \@ 2,5 ГГц), 12 ГБ памяти | 600 ГБ | От 251 ГБ до 1 ТБ    | 86-150 компьютеров.
12 виртуальных ЦП (2 сокета * 6 ядер \@ 2,5 ГГц), память объемом 24 ГБ | 1 TБ | 1-2 TБ | 151-225 компьютеров.

## <a name="control-upload-throughput"></a>Управление пропускной способностью передачи


 Трафик VMware, который реплицируется в Azure, проходит через определенный сервер обработки. Можно ограничить пропускную способность передачи путем регулирования пропускной способности на компьютерах, работающих как серверы обработки. Вы можете повлиять на пропускную способность с помощью этого раздела реестра:

- Параметр реестра HKEY_LOCAL_MACHINE \Софтваре\микрософт\виндовс Azure Баккуп\репликатион\уплоадсреадспервм указывает количество потоков, используемых для обмена данными (исходная или разностная репликация) диска. Если задать высокое значение, пропускная способность сети, используемая для репликации, увеличивается. Значение по умолчанию — четыре. Максимальное значение — 32. Следите за трафиком для оптимизации значения.
- Кроме того, можно регулировать пропускную способность на компьютере сервера обработки следующим образом:

    1. На компьютере сервера обработки откройте оснастку консоли управления Azure Backup MMC. На рабочем столе есть ярлык или в папке C:\Program Files\Microsoft Azure Recovery Services Ажент\бин. 
    2. В оснастке выберите **Change Properties** (Изменить свойства).
    3. В окне **регулирования**выберите **включить регулирование использования полосы пропускания Интернета для операций резервного копирования**. Задайте ограничения для рабочего и нерабочего времени. Допустимы значения в диапазоне от 512 Кбит/с до 1,023 Мбит/с.


## <a name="next-steps"></a>Дополнительная информация

Испытайте миграцию [виртуальных машин VMware](tutorial-migrate-vmware-agent.md) на основе агентов с помощью миграции сервера миграция Azure.
