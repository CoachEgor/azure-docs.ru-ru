---
title: Архитектура миграции на основе агента в миграции сервера миграции Azure
description: Обзор миграции виртуальных Машин VMware на основе агента с миграцией сервера миграции Azure.
author: rayne-wiselman
ms.service: azure-migrate
ms.topic: conceptual
ms.date: 07/10/2019
ms.author: raynew
ms.openlocfilehash: 21c779587842c976ba93d7fa592a91ee714bc55c
ms.sourcegitcommit: 47ce9ac1eb1561810b8e4242c45127f7b4a4aa1a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2019
ms.locfileid: "67811158"
---
# <a name="agent-based-migration-architecture"></a>Архитектура миграции на основе агента

В этой статье Обзор архитектуры и процессы, используемые для репликации на основе агента с помощью средства миграции сервера миграции Azure.

[Служба "Миграция Azure"](migrate-services-overview.md) предоставляют центральный концентратор для отслеживания, обнаружения, оценки и миграции локальных приложений и рабочих нагрузок и экземпляров виртуальных Машин AWS/GCP, в Azure. Концентратор средства "Миграция Azure" для оценки и миграции, а также сторонних независимых Независимым производителям предложений.

## <a name="agent-based-replication"></a>Репликация на основе агента

Агент репликации в Azure перенос сервера репликации средство используется для переноса локальных виртуальных машин VMware и физических серверов в Azure. Он может также использоваться для переноса других локальных виртуализированных серверов, а также частных и общедоступных облаков виртуальных машин, а экземпляры AWS, GCP виртуальных машин.

Для миграции VMware средства миграции сервера миграции Azure предлагает несколько вариантов:

- Миграция агента репликации на основе, как описано в этой статье.
- Без агента репликации, чтобы перенести виртуальные машины не нужно ничего устанавливать на них.

Дополнительные сведения о [Выбор метода переноса для VMware](server-migrate-overview.md).

## <a name="server-migration-and-azure-site-recovery"></a>Миграция сервера и Azure Site Recovery

Миграции в Azure миграции сервера — это средство для переноса локальных и общедоступных облачных рабочих нагрузок в Azure. Он оптимизирован для миграции. Site Recovery — это средство аварийного восстановления. Миграция сервера и Azure Site Recovery имеют некоторые общие компоненты технологии, используемой для репликации данных, но предназначены для разных целей.

## <a name="architectural-components"></a>Компоненты архитектуры

![Архитектура](./media/agent-based-replication-architecture/architecture.png)

В таблице перечислены компоненты, используемые для миграции на основе агента.

**Компонент** | **Сведения** | **Установка**
--- | --- | ---
**Модуль репликации** | Устройство репликации (сервер конфигурации) находится на локальном компьютере, который выступает в качестве моста между локальной средой и средства миграции сервера миграции Azure. Модуль обнаруживает инвентаризации виртуальной Машины в локальной, таким образом, чтобы миграция сервера Azure можно управлять репликацией и миграции. Модуль состоит из двух компонентов:<br/><br/> **Сервер конфигурации** Подключается к миграции сервера миграции Azure и координирует репликацию.<br/> **Сервер обработки** Репликация данных. Он получает данные виртуальной Машины, сжимает и шифрует его и отправляет в подписку Azure. Существует миграция сервера записывает данные для использования управляемых дисков. | По умолчанию сервер обработки устанавливается вместе с сервером конфигурации через модуль репликации.
**Служба Mobility Service** | Служба мобильности не установлена на каждом компьютере, который вы хотите реплицировать и перенести агент. Он отправляет данные репликации с компьютера на сервер обработки. Существует ряд различных агентов Mobility service. | Файлы установки служб Mobility Service, находятся на устройстве репликации. Скачайте и установите агент, что нужно, соответствующий операционной системы и версию на компьютере, который вы хотите реплицировать.

### <a name="mobility-service-installation"></a>Установка службы Mobility Service

Вы можете запустить службу Mobility Service одним из следующих способов:

- **Принудительная установка**. Служба Mobility service устанавливается с помощью сервера обработки при включении защиты для компьютера. 
- **Установка вручную**. Можно установить службу Mobility service вручную на каждом компьютере через пользовательский Интерфейс или командную строку.

Службу Mobility service взаимодействует с устройством репликации и реплицированным машинам. При наличии антивирусного программного обеспечения на устройства репликации, серверов обработки или машин реплицируются в следующие папки должны быть исключены из проверки:


- C:\Program Files\Microsoft Azure Recovery Services Agent
- C:\ProgramData\ASR.
- C:\ProgramData\ASRLogs.
- C:\ProgramData\ASRSetupLogs.
- C:\ProgramData\LogUploadServiceLogs.
- C:\ProgramData\Microsoft Azure Site Recovery.
- C:\Program Files (x86)\Microsoft Azure Site Recovery
- C:\ProgramData\ASR\agent (на компьютерах Windows с установленной службой Mobility)

## <a name="replication-process"></a>Процесс репликации

1. При включении репликации для виртуальной Машины, начинает начальной репликации в Azure.
2. Во время начальной репликации служба мобильности считывает данные из дисков компьютера и отправляет его на сервер обработки.
3. Эти данные используются для задания начального значения это копия диска в своей подписке Azure. 
4. После завершения начальной репликации начинается репликация разностных изменений в Azure. Репликация является уровня блока и непрерывной.
4. Перехватывает службы Mobility Service записывает памяти диска виртуальной Машины, интегрируя в подсистеме операционной системы. Этот метод позволяет избежать операций ввода-вывода диска на реплицируемом компьютере для добавочного репликации. 
5. Отслеживаемые изменения для машины отправляются на сервер обработки через порт HTTPS 9443 входящего трафика. Этот порт можно изменить. Сервер обработки сжимает и шифрует его и отправит его в Azure. 

## <a name="ports"></a>порты;

**Устройство** | **Connection**
--- | --- 
Виртуальные машины | Службы мобильности, запущенной на виртуальных машинах взаимодействует с устройством в локальной репликации через порт HTTPS 443 входящего трафика для управления репликацией.<br/><br/> Виртуальные машины отправляют данные репликации на сервер обработки (запущенный на устройстве репликации по умолчанию) через порт HTTPS 9443 входящих подключений. Этот порт можно изменить.
Модуль репликации | Модуль репликации управляет репликацией с Azure через порт HTTPS 443 для исходящих подключений.
Сервер обработки | Сервер обработки получает данные репликации, оптимизирует и шифрует их, а затем отправляет в службу хранилища Azure через порт 443 для исходящих подключений.


## <a name="performance-and-scaling"></a>Производительность и масштабируемость

По умолчанию при развертывании репликации с одного устройства, работающей на сервере конфигурации и сервер обработки. Если только вы реплицируете несколько компьютеров, это развертывание будет достаточно. Тем не менее если репликации и миграции сотни компьютеров, на одном сервере может не иметь возможность обрабатывать весь трафик репликации. В этом случае можно развернуть серверы обработки дополнительных, горизонтального масштабирования.

### <a name="site-recovery-deployment-planner-for-vmware"></a>Планировщик развертывания Site Recovery для VMware

Если вы выполняете репликацию виртуальных машин VMware, можно использовать [планировщик развертывания Site Recovery](../site-recovery/site-recovery-deployment-planner.md) для VMware для определения требований к производительности, включая ежедневные данные изменить скорость и серверов обработки, вам нужно.

### <a name="replication-appliance-capacity"></a>Емкость устройства репликации

Значения в этой таблице можно использовать для выяснения того, нужна ли в вашем развертывании дополнительный сервер обработки.

- Если объем ежедневно изменяемых данных (частоту обновлений) составляет более 2 ТБ, разверните дополнительный сервер обработки.
- Если вы выполняете репликацию более 200 компьютеров, развертывание устройства дополнительной репликации.

**CPU** | **Память** | **Свободное место для кэширования данных** | **Скорость обработки данных** | **Ограничения репликации**
--- | --- | --- | --- | ---
8 виртуальных ЦП (2 сокета по 4 ядра с частотой \@ 2,5 ГГц) | 16 ГБ | 300 ГБ | 500 ГБ или менее | < 100 компьютеров 
12 виртуальных ЦП (2 сокета по 6 ядер с частотой \@ 2,5 ГГц) | 18 ГБ | 600 ГБ | От 501 ГБ до 1 ТБ | 100 – 150 компьютеров.
16 виртуальных ЦП (2 сокета по 8 ядер с частотой \@ 2,5 ГГц) | 32 G1 |  1 TБ | От 1 ТБ до 2 ТБ | 151 – 200 компьютеров.

### <a name="scale-out-process-server-sizing"></a>Определение размера сервера обработки масштабирования

Если требуется развернуть сервер обработки масштабирования, эта таблица поможет рассчитать размер сервера.

**Сервер обработки** | **Свободное место для кэширования данных** | **Скорость обработки данных** | **Ограничения репликации**
--- | --- | --- | --- 
4 виртуальных ЦП (2 сокета по 2 ядра с частотой \@ 2,5 ГГц), 8 ГБ памяти | 300 ГБ | 250 ГБ или менее | До 85 компьютеров 
8 виртуальных ЦП (2 сокета по 4 ядра с частотой \@ 2,5 ГГц), 12 ГБ памяти | 600 ГБ | От 251 ГБ до 1 ТБ    | 86-150 компьютеров.
12 виртуальных ЦП (2 сокета * 6 ядер \@ 2,5 ГГц), память объемом 24 ГБ | 1 TБ | 1-2 TБ | 151 до 225 компьютеров.

## <a name="control-upload-throughput"></a>Пропускная способность отправки для элемента управления

Можно ограничить объем пропускной способности, используемый для отправки данных в Azure на каждом узле Hyper-V. Будь осторожен. Если значение слишком мало значений, он будет отрицательно влиять на репликацию и отложить миграцию.


1. Войдите на узел или кластер узлов Hyper-V.
2. Запустите **C:\Program Files\Microsoft Azure Recovery Services Agent\bin\wabadmin.msc**, чтобы открыть оснастку MMC в Windows Azure Backup.
3. В оснастке выберите **Change Properties** (Изменить свойства).
4. В **регулирование**выберите **включить использование пропускной способности Интернета, регулирование для операций резервного копирования**. Задайте ограничения для рабочего и нерабочего времени. Допустимы значения в диапазоне от 512 Кбит/с до 1,023 Мбит/с.
I

### <a name="influence-upload-efficiency"></a>Эффективность передачи влияния

Если имеет свободную пропускную способность для репликации и хотите увеличить передачи, можно увеличить количество потоков, выделенных для задачи «Отправка», следующим образом:

1. Откройте реестр с помощью Regedit.
2. Перейдите к разделу HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\Replication\UploadThreadsPerVM
3. Увеличьте значение для числа потоков, используемых для передачи данных для каждой реплицируемой виртуальной Машины. Значение по умолчанию — 4, а максимальное значение равно 32. 

## <a name="next-steps"></a>Следующие шаги

Испытайте основе агента [миграции виртуальной Машины VMware](tutorial-migrate-vmware-agent.md) с помощью миграции сервера миграции Azure.
