---
title: Подготовка локальных компьютеров к миграции в Azure с помощью службы "Миграция Azure"
description: В этой статье описывается подготовка локальных компьютеров к миграции в Azure с помощью службы "Миграция Azure".
author: rayne-wiselman
manager: carmonm
ms.service: azure-migrate
ms.topic: tutorial
ms.date: 10/03/2019
ms.author: raynew
ms.custom: MVC
ms.openlocfilehash: d2eeada500de0f174178234ab92b51bcf16b3502
ms.sourcegitcommit: 42748f80351b336b7a5b6335786096da49febf6a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2019
ms.locfileid: "72176731"
---
# <a name="prepare-on-premises-machines-for-migration-to-azure"></a>Подготовка локальных компьютеров к миграции в Azure

В этой статье описывается подготовка локального и облачного компьютера перед миграцией в Azure с помощью [миграции сервера службы "Миграция Azure"](migrate-services-overview.md#azure-migrate-server-migration).


Работая с этой статьей, вы выполните следующие задачи:
> [!div class="checklist"]
> * Проверка ограничений, накладываемых при выполнении миграции.
> * Проверка требований к операционной системе и ограничений для поддерживаемых функций.
> * Проверка доступа к URL-адресу и порту для компьютеров, которые необходимо перенести.
> * Проверка изменений, которые, возможно, придется внести перед началом миграции.
> * Настройка параметров, обеспечивающая сохранение букв дисков после миграции.
> * Подготовка компьютеров, позволяющая подключаться к виртуальным машинам Azure после миграции.


## <a name="verify-migration-limitations"></a>Проверка ограничений, накладываемых при выполнении миграции

- Вы можете оценить до 35 000 виртуальных машин VMware и Hyper-V в одном проекте Миграции Azure с помощью миграции сервера службы "Миграция Azure". Проект может объединять виртуальные машины VMware и Hyper-V, пока не будут достигнуты ограничения для каждого вида.
- За раз вы можете выбрать до 10 виртуальных машин для миграции. Если нужно реплицировать большее количество, выполните репликацию группами из 10 машин.
- При миграции VMware без агента вы можете запустить до 100 репликаций одновременно.

## <a name="verify-operating-system-requirements"></a>Проверка требований к операционной системе

- Проверьте, поддерживаются ли ваши [операционные системы Windows](https://support.microsoft.com/help/2721672/microsoft-server-software-support-for-microsoft-azure-virtual-machines) в Azure.
- Проверьте, поддерживаются ли ваши [дистрибутивы Linux](../virtual-machines/linux/endorsed-distros.md) в Azure.


## <a name="check-whats-supported"></a>Проверка поддерживаемых функций

- Для виртуальных машин VMware миграция сервера службы "Миграция Azure" поддерживает [миграцию без агентов или на основе агентов](server-migrate-overview.md). Проверьте требования и поддерживаемые функции виртуальной машины VMware для [миграции без агентов](migrate-support-matrix-vmware.md#migration---limitations) и [на основе агентов](migrate-support-matrix-vmware.md#agent-based-migration-vmware-vm-requirements).
- Проверьте [требования к миграции и поддерживаемые функции](migrate-support-matrix-hyper-v.md#migration-hyper-v-vm-requirements) для виртуальных машин Hyper-V.
- Проверьте [требования к миграции и поддерживаемые функции](migrate-support-matrix-vmware.md#agent-based-migration-vmware-vm-requirements) для локальных физических компьютеров или других виртуализированных серверов. Эти требования аналогичны требованиям для виртуальных машин VMware.





## <a name="review-urlport-access"></a>Проверка доступа к URL-адресу или порту

Во время миграции компьютерам может понадобиться доступ к Интернету.

- Проверьте URL-адреса, к которым виртуальные машины VMware должны иметь доступ во время миграции [без агента](migrate-support-matrix-vmware.md#agentless-migration-url-access-requirements) или [на основе агента ](migrate-support-matrix-vmware.md#agent-based-migration-url-access-requirements).
- Проверьте URL-адреса, к которым узлы Hyper-V должны иметь доступ во время миграции. Виртуальные машины Hyper-V не нуждаются в доступе к Интернету.
- [Проверьте URL-адреса](migrate-support-matrix-vmware.md#agent-based-migration-url-access-requirements), к которым физические компьютеры или другие виртуализированные серверы должны иметь доступ во время миграции.
- При миграции виртуальных машин VMware или физических серверов на основе агента Службе мобильности, работающей на компьютерах, необходим доступ к компонентам службы "Миграция Azure". Для управления репликацией служба, работающая на компьютере, взаимодействует с локальным устройством репликации службы "Миграция Azure" через входящий порт HTTPS 443. Компьютеры отправляют данные репликации на сервер обработки службы "Миграция Azure" через входящий порт HTTPS 9443. Этот порт можно изменить.


## <a name="verify-required-changes-before-migration"></a>Проверка изменений, которые необходимо внести перед миграцией

Для некоторых виртуальных машин могут потребоваться изменения, позволяющие им работать в Azure. Служба "Миграция Azure" вносит эти изменения автоматически в таких операционных системах:
- Red Hat Enterprise Linux 6.5+, 7.0+;
- CentOS 6.5+, 7.0+;
- SUSE Linux Enterprise Server 12 SP1+;
- Ubuntu 14.04LTS, 16.04LTS, 18.04LTS;
- Debian 7, 8.

Для других операционных систем компьютеры необходимо подготовить перед миграцией вручную. 

### <a name="prepare-windows-machines"></a>Подготовка компьютеров с Windows

При миграции компьютера с Windows перед выполнением операции необходимо внести описанные ниже изменения. Если вы перенесете виртуальную машину до внесения изменений, она может не загрузиться в Azure.

1. [Включите консоль последовательного доступа Azure](../virtual-machines/troubleshooting/serial-console-windows.md) для виртуальной машины Azure. Это помогает при устранении неполадок. Перезагружать виртуальную машину не нужно. Виртуальная машина будет загружаться с помощью образа диска. Это действие эквивалентно перезагрузке для новой виртуальной машины. 
2. Если вы переносите машины под управлением Windows Server 2003, установите Hyper-V Guest Integration Services в операционной системе виртуальной машины. [Узнайте больше](https://docs.microsoft.com/windows-server/virtualization/hyper-v/manage/manage-hyper-v-integration-services#install-or-update-integration-services).

### <a name="prepare-linux-machines"></a>Подготовка компьютеров с Linux

1. Установите Hyper-V Linux Integration Services. В большинстве новых версий дистрибутивов Linux это включено по умолчанию.
2. Выполните повторную сборку образа инициализации Linux, чтобы он содержал необходимые драйверы Hyper-V. Это гарантирует, что виртуальная машина будет загружаться в Azure, и требуется только в некоторых дистрибутивах.
3. [Включите ведение журнала последовательной консоли Azure](../virtual-machines/troubleshooting/serial-console-linux.md). Это помогает при устранении неполадок. Перезагружать виртуальную машину не нужно. Виртуальная машина будет загружаться с помощью образа диска. Это действие эквивалентно перезагрузке для новой виртуальной машины.
4. Обновите файл сопоставления устройств с именем устройства для сопоставлений томов, чтобы использовать постоянные идентификаторы устройств.
5. Обновите записи fstab, чтобы использовать постоянные идентификаторы томов.
6. Удалите все правила udev, которые резервируют имена интерфейсов на основе MAC-адресов и т. д.
7. Обновите сетевые интерфейсы для получения IP-адреса из DHCP.
8. Ознакомьтесь с дополнительными сведениями о шагах, необходимых для запуска виртуальной машины Linux в Azure, и инструкциями для некоторых популярных дистрибутивов Linux в [этой статье](../virtual-machines/linux/create-upload-generic.md).

## <a name="preserve-drive-letters-after-migration"></a>Сохранение букв дисков после миграции

При миграции локального компьютера в Microsoft Azure буквы дополнительных дисков с данными могут отличаться от предыдущих значений. По умолчанию виртуальным машинам Azure в качестве временного хранилища назначен диск D. В результате для всех остальных назначений подключенного накопителя будет использоваться следующая по порядку буква.

Например, если в локальной установке используется диск данных, который назначен диску D для установок приложений, назначение этого диска будет изменено на диск E после миграции виртуальной машины в Azure. Чтобы предотвратить такое автоматическое назначение и убедиться, что Azure назначает следующую свободную букву диска временному тому, задайте для политики сети хранения данных (SAN) значение OnlineAll следующим образом:

1. На локальной компьютере (не на сервере узла) откройте командную строку с повышенными привилегиями.
2. Введите **diskpart**.
3. Введите **SAN**. Если буква диска гостевой ОС не поддерживается, возвращается значение **Offline All** (Перевод всего в состояние "вне сети") или **Offline Shared** (Перевод в состояние "вне сети" общих ресурсов).
4. В командной строке **DISKPART** введите **SANPOLICY=ONLINEALL**. Этот параметр гарантирует, что диски подключены к сети и доступны для чтения и записи.
5. Во время тестовой миграции вы можете проверить, сохраняются ли буквы дисков.


## <a name="check-azure-vm-requirements"></a>Проверка требований для виртуальных машин Azure

Локальные компьютеры, реплицируемые в Azure, должны соответствовать требованиям к операционной системе и архитектуре, дискам, сетевым настройкам и наименованию для виртуальных машин Azure. Перед выполнением миграции проверьте требования для [виртуальных машин VMware или физических серверов](migrate-support-matrix-vmware.md#azure-vm-requirements) и [виртуальных машин Hyper-V](migrate-support-matrix-hyper-v.md#migration-hyper-v-vm-requirements).


## <a name="prepare-to-connect-after-migration"></a>Подготовка к подключению после миграции

Виртуальные машины Azure создаются во время миграции в Azure. После миграции вам необходимо подключиться к новым виртуальным машинам Azure. Для успешной установки подключения необходимо выполнить несколько шагов.

### <a name="prepare-to-connect-to-windows-azure-vms"></a>Подготовка к подключению к виртуальным машинам Windows Azure

На локальных компьютерах с Windows выполните следующие действия:

1. Настройте параметры Windows. К ним относится удаление любых статических постоянных маршрутов или прокси-сервера WinHTTP.
2. Убедитесь, что [эти службы](../virtual-machines/windows/prepare-for-upload-vhd-image.md#check-the-windows-services) работают.
3. Включите удаленный рабочий стол (RDP), чтобы разрешить установку удаленных подключений к локальному компьютеру. Сведения о включении RDP с помощью PowerShell см. в [этой статье](../virtual-machines/windows/prepare-for-upload-vhd-image.md#update-remote-desktop-registry-settings).
4. Чтобы получить доступ к виртуальной машине Azure через Интернет после миграции, в брандмауэре Windows на локальном компьютере разрешите протоколы TCP и UDP в общедоступном профиле и установите RDP в качестве разрешенного приложения для всех профилей.
5. Если вы хотите получить доступ к виртуальной машине Azure через VPN типа "сеть — сеть" после миграции, в брандмауэре Windows на локальном компьютере разрешите RDP для частного профиля и профиля домена. Ознакомьтесь со сведениями о разрешении трафика RDP на [этой странице](../virtual-machines/windows/prepare-for-upload-vhd-image.md#configure-windows-firewall-rules). 
6. Прежде чем выполнять миграцию убедитесь, что на локальной виртуальной машине нет ожидающих установки обновлений Windows. В противном случае установка этих обновлений на виртуальной машине Azure может активироваться после миграции, и вы не сможете войти в нее до завершения установки.


### <a name="prepare-to-connect-with-linux-azure-vms"></a>Подготовка к подключению к виртуальным машинам Linux Azure

На локальных компьютерах с Linux выполните следующие действия:

1. Настройте автоматический запуск службы SSH при загрузке системы (если он еще не настроен).
2. Убедитесь, что правила брандмауэра разрешают SSH-подключение.

### <a name="configure-azure-vms-after-migration"></a>Настройка виртуальных машин Azure после миграции

После миграции выполните следующие действия на созданных виртуальных машинах Azure.

1. Чтобы подключиться к виртуальной машине через Интернет, назначьте ей общедоступный IP-адрес. Для виртуальной машины Azure нельзя указывать общедоступный IP-адрес, ранее используемый для локального компьютера. [Узнайте больше](../virtual-network/virtual-network-public-ip-address.md).
2. Убедитесь, что правила группы безопасности сети (NSG) на виртуальной машине разрешают входящие подключения к порту RDP или SSH.
3. Перейдите в раздел [Диагностика загрузки](../virtual-machines/troubleshooting/boot-diagnostics.md#enable-boot-diagnostics-on-existing-virtual-machine), чтобы просмотреть сведения о виртуальной машине.

> [!NOTE]
> Служба "Бастион Azure" предоставляет закрытый доступ по RDP и SSH к виртуальным машинам Azure. [Ознакомьтесь с дополнительными сведениями](../bastion/bastion-overview.md) об этой службе.



## <a name="next-steps"></a>Дополнительная информация

Выберите предпочтительный метод [миграции виртуальных машин VMware](server-migrate-overview.md) в Azure или начните миграцию [виртуальных машин Hyper-V](tutorial-migrate-hyper-v.md), [физических серверов или виртуализованных/облачных виртуальных машин](tutorial-migrate-physical-virtual-machines.md).
