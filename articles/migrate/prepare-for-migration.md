---
title: Подготовка компьютеров к миграции с помощью Миграции Azure
description: Подготовка локальных компьютеров к миграции в Azure с помощью службы "Миграция Azure"
ms.topic: tutorial
ms.date: 02/17/2020
ms.custom: MVC
ms.openlocfilehash: eba177a254606bb847e0866ae48281a889c53f9b
ms.sourcegitcommit: 9cbd5b790299f080a64bab332bb031543c2de160
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/08/2020
ms.locfileid: "78927470"
---
# <a name="prepare-on-premises-machines-for-migration-to-azure"></a>Подготовка локальных компьютеров к миграции в Azure

В этой статье описывается подготовка локальных компьютеров перед миграцией в Azure с помощью функции [Azure Migrate: Server Migration](migrate-services-overview.md#azure-migrate-server-migration-tool) (Миграция Azure: миграция сервера).

Работая с этой статьей, вы выполните следующие задачи:
> [!div class="checklist"]
> * Проверка ограничений, накладываемых при выполнении миграции.
> * Проверка требований к операционной системе и ограничений для поддерживаемых функций.
> * Проверка доступа к URL-адресу и порту для компьютеров, которые необходимо перенести.
> * Проверка изменений, которые, возможно, придется внести перед началом миграции.
> * Настройка параметров, обеспечивающая сохранение букв дисков после миграции.
> * Подготовка компьютеров, позволяющая подключаться к виртуальным машинам Azure после миграции.

## <a name="verify-migration-limitations"></a>Проверка ограничений, накладываемых при выполнении миграции

- Вы можете оценить до 35 000 виртуальных машин VMware и Hyper-V в одном проекте Миграции Azure с помощью миграции сервера службы "Миграция Azure". Проект может объединять виртуальные машины VMware и Hyper-V, пока не будут достигнуты ограничения для каждого вида.
- За раз вы можете выбрать до 10 виртуальных машин для миграции. Если нужно реплицировать большее количество, выполните репликацию группами из 10 машин.
- При миграции VMware без агента вы можете запустить до 100 репликаций одновременно.

## <a name="verify-operating-system-requirements"></a>Проверка требований к операционной системе

- Проверьте, поддерживаются ли ваши [операционные системы Windows](https://support.microsoft.com/help/2721672/microsoft-server-software-support-for-microsoft-azure-virtual-machines) в Azure.
- Проверьте, поддерживаются ли ваши [дистрибутивы Linux](../virtual-machines/linux/endorsed-distros.md) в Azure.

## <a name="see-whats-supported"></a>Поддерживаемые функции

Для виртуальных машин VMware средство миграции сервера поддерживает [миграцию без агентов или на основе агентов](server-migrate-overview.md).

- **Виртуальные машины VMware**/ Проверьте [требования к миграции и поддерживаемые функции](migrate-support-matrix-vmware-migration.md) для виртуальных машин VMware.
- **Виртуальные машины Hyper-V**. Проверьте [требования к миграции и поддерживаемые функции](migrate-support-matrix-hyper-v-migration.md) для виртуальных машин Hyper-V.
- **Физические компьютеры**. Проверьте [требования к миграции и поддерживаемые функции](migrate-support-matrix-physical-migration.md) для локальных физических компьютеров или других виртуализированных серверов. 

## <a name="review-url-and-port-access"></a>Проверка доступа к URL-адресу или порту

Во время миграции компьютерам может понадобиться доступ к Интернету.

- **Устройство службы "Миграция Azure"** : Проверьте [URL-адреса](migrate-appliance.md#url-access) и [порты](migrate-support-matrix-vmware-migration.md#agentless-ports), к которым устройству Миграции Azure требуется доступ во время миграции без агента.
- **Миграция виртуальной машины VMware на основе агента**. Проверьте [URL-адреса](migrate-replication-appliance.md#url-access) и [порты](migrate-replication-appliance.md#port-access), которые используются устройством репликации во время миграции виртуальной машины VMware на основе агента. 
- **Узлы Hyper-V**. Проверьте [URL-адреса и порты](migrate-support-matrix-hyper-v-migration.md#hyper-v-hosts), которые должны быть доступны узлам Hyper-V во время миграции. 
- **Физические серверы**. Проверьте [URL-адреса](migrate-replication-appliance.md#url-access) и [порты](migrate-replication-appliance.md#port-access), которые используются устройством репликации во время миграции физического сервера.

## <a name="verify-required-changes-before-migrating"></a>Проверка необходимых изменений перед миграцией

Для некоторых виртуальных машин могут потребоваться изменения, позволяющие им работать в Azure. Служба "Миграция Azure" вносит эти изменения автоматически в таких операционных системах:

- Red Hat Enterprise Linux 7.0+, 6.5+
- CentOS 7.0+, 6.5+
- SUSE Linux Enterprise Server 12 SP1+;
- Ubuntu 18.04LTS, 16.04LTS, 14.04LTS;
- Debian 8, 7.

Для других операционных систем компьютеры необходимо подготовить к миграции вручную. 

### <a name="prepare-windows-machines"></a>Подготовка компьютеров с Windows

При миграции компьютера с Windows перед выполнением операции необходимо внести описанные ниже изменения. Если вы перенесете виртуальную машину до внесения изменений, она может не загрузиться в Azure.

1. [Включите Серийную консоль Azure](../virtual-machines/troubleshooting/serial-console-windows.md) для виртуальной машины Azure. Включение консоли поможет устранить неполадки. Перезагружать виртуальную машину не нужно. Виртуальная машина Azure будет загружаться с помощью образа диска. Для новой виртуальной машины загрузка с образа диска эквивалентна перезагрузке. 
2. Если вы переносите машины под управлением Windows Server 2003, установите Hyper-V Guest Integration Services в операционной системе виртуальной машины. [Подробнее](https://docs.microsoft.com/windows-server/virtualization/hyper-v/manage/manage-hyper-v-integration-services#install-or-update-integration-services).

### <a name="prepare-linux-machines"></a>Подготовка компьютеров с Linux

1. Установите Hyper-V Linux Integration Services. Большинство новых версий дистрибутивов Linux включают Hyper-V Linux Integration Services по умолчанию.
2. Выполните повторную сборку образа инициализации Linux, чтобы он содержал необходимые драйверы Hyper-V. Повторная сборка образа инициализации гарантирует, что виртуальная машина будет загружаться в Azure (требуется только в некоторых дистрибутивах).
3. [Включите ведение журнала Серийной консоли Azure](../virtual-machines/troubleshooting/serial-console-linux.md). Включение ведения журнала консоли поможет устранить неполадки. Перезагружать виртуальную машину не нужно. Виртуальная машина Azure будет загружаться с помощью образа диска. Для новой виртуальной машины загрузка с образа диска эквивалентна перезагрузке.
4. Обновите файл сопоставления устройств с именем устройства для сопоставлений томов, чтобы использовать постоянные идентификаторы устройств.
5. Обновите записи в файле fstab, чтобы использовать постоянные идентификаторы томов.
6. Удалите все правила udev, которые резервируют имена интерфейсов на основе MAC-адресов и т. д.
7. Обновите сетевые интерфейсы для получения IP-адреса из DHCP.

Ознакомьтесь с дополнительными сведениями об [этапах запуска виртуальной машины Linux в Azure](../virtual-machines/linux/create-upload-generic.md) и инструкциями для некоторых популярных дистрибутивов Linux в этой статье.

## <a name="preserve-drive-letters-after-migration"></a>Сохранение букв дисков после миграции

При миграции локального компьютера в Microsoft Azure буквы дополнительных дисков с данными могут отличаться от исходных значений. 

По умолчанию виртуальным машинам Azure в качестве временного хранилища назначен диск D. В результате для всех остальных назначений подключенного накопителя будет использоваться следующая по порядку буква. Например, если в локальной установке используется диск данных, который назначен диску D для установок приложений, назначение этого диска будет изменено на диск E после миграции виртуальной машины в Azure. Чтобы предотвратить такое автоматическое назначение и убедиться, что Azure назначает следующую свободную букву диска временному тому, задайте для политики сети хранения данных (SAN) значение **OnlineAll**:

1. На локальном компьютере (не на сервере узла) откройте командную строку с повышенными привилегиями.
2. Введите **diskpart**.
3. Введите **SAN**. Если буква диска гостевой ОС не поддерживается, возвращается значение **Offline All** (Перевод всего в состояние "вне сети") или **Offline Shared** (Перевод в состояние "вне сети" общих ресурсов).
4. В командной строке **DISKPART** введите **SAN Policy=OnlineAll**. Этот параметр гарантирует, что диски будут подключены к сети, и вы сможете выполнять чтение и запись на обоих дисках.
5. Во время тестовой миграции вы можете проверить, сохраняются ли буквы дисков.

## <a name="check-azure-vm-requirements"></a>Проверка требований для виртуальных машин Azure

Локальные компьютеры, реплицируемые в Azure, должны соответствовать требованиям к операционной системе и архитектуре, дискам, сетевым настройкам и наименованию для виртуальных машин Azure. Перед выполнением миграции проверьте требования для [виртуальных машин VMware или физических серверов](migrate-support-matrix-vmware-migration.md#azure-vm-requirements) и [виртуальных машин Hyper-V](migrate-support-matrix-hyper-v-migration.md#azure-vm-requirements).

## <a name="prepare-to-connect-after-migration"></a>Подготовка к подключению после миграции

Виртуальные машины Azure создаются во время миграции в Azure. После миграции вам необходимо подключиться к новым виртуальным машинам Azure. Для успешного подключения требуется выполнить несколько шагов.

### <a name="prepare-to-connect-to-azure-windows-vms"></a>Подготовка к подключению к виртуальным машинам Windows в Azure

На локальных компьютерах с Windows:

1. Настройте параметры Windows. К ним относится удаление любых статических постоянных маршрутов или прокси-сервера WinHTTP.
2. Убедитесь, что [необходимые службы](../virtual-machines/windows/prepare-for-upload-vhd-image.md#check-the-windows-services) запущены.
3. Включите удаленный рабочий стол (RDP), чтобы разрешить установку удаленных подключений к локальному компьютеру. Узнайте, как [использовать PowerShell для включения RDP](../virtual-machines/windows/prepare-for-upload-vhd-image.md#update-remote-desktop-registry-settings).
4. Чтобы получить доступ к виртуальной машине Azure через Интернет после миграции, в брандмауэре Windows на локальном компьютере разрешите протоколы TCP и UDP в общедоступном профиле и установите RDP в качестве разрешенного приложения для всех профилей.
5. Если вы хотите получить доступ к виртуальной машине Azure через VPN типа "сеть — сеть" после миграции, в брандмауэре Windows на локальном компьютере разрешите RDP для частного профиля и профиля домена. Узнайте, как [разрешить RDP-трафик](../virtual-machines/windows/prepare-for-upload-vhd-image.md#configure-windows-firewall-rules). 
6. Прежде чем выполнять миграцию убедитесь, что на локальной виртуальной машине нет ожидающих установки обновлений Windows. В противном случае установка этих обновлений на виртуальной машине Azure может активироваться после миграции, и вы не сможете войти в нее до завершения установки.

### <a name="prepare-to-connect-with-linux-azure-vms"></a>Подготовка к подключению к виртуальным машинам Linux Azure

На локальных компьютерах с Linux:

1. Настройте автоматический запуск службы SSH при загрузке системы (если он еще не настроен).
2. Убедитесь, что правила брандмауэра разрешают SSH-подключение.

### <a name="configure-azure-vms-after-migration"></a>Настройка виртуальных машин Azure после миграции

После миграции выполните следующие действия на созданных виртуальных машинах Azure.

1. Чтобы подключиться к виртуальной машине через Интернет, назначьте ей общедоступный IP-адрес. Для виртуальной машины Azure следует указать общедоступный IP-адрес, отличный от ранее используемых для локального компьютера. [Подробнее](../virtual-network/virtual-network-public-ip-address.md).
2. Убедитесь, что правила группы безопасности сети (NSG) на виртуальной машине разрешают входящие подключения к порту RDP или SSH.
3. Перейдите в раздел [диагностики загрузки](../virtual-machines/troubleshooting/boot-diagnostics.md#enable-boot-diagnostics-on-existing-virtual-machine), чтобы просмотреть сведения о виртуальной машине.

> [!NOTE]
> Служба "Бастион Azure" предоставляет закрытый доступ по RDP и SSH к виртуальным машинам Azure. [Ознакомьтесь с дополнительными сведениями](../bastion/bastion-overview.md) об этой службе.

## <a name="next-steps"></a>Дальнейшие действия

Выберите предпочтительный метод [миграции виртуальных машин VMware](server-migrate-overview.md) в Azure или начните миграцию [виртуальных машин Hyper-V](tutorial-migrate-hyper-v.md), [физических серверов либо виртуализованных или облачных виртуальных машин](tutorial-migrate-physical-virtual-machines.md).
