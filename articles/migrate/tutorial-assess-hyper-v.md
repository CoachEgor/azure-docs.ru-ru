---
title: Оценка виртуальных машин Hyper-V для миграции в Azure с помощью службы "Миграция Azure" | Документация Майкрософт
description: В этой статье описывается, как оценивать локальные виртуальные машины Hyper-V для миграции в Azure с помощью службы "Миграция Azure".
author: rayne-wiselman
manager: carmonm
ms.service: azure-migrate
ms.topic: tutorial
ms.date: 08/11/2019
ms.author: raynew
ms.custom: mvc
ms.openlocfilehash: 1ff46ec437de671d5804eeb31a5d1fb0284a8946
ms.sourcegitcommit: 5a8c65d7420daee9667660d560be9d77fa93e9c9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/15/2019
ms.locfileid: "74123518"
---
# <a name="assess-hyper-v-vms-with-azure-migrate-server-assessment"></a>Оценка виртуальных машин Hyper-V с помощью средства "Оценка сервера" службы "Миграция Azure"

В этой статье описывается, как оценивать локальные виртуальные машины Hyper-V с помощью средства "Оценка сервера" службы "Миграция Azure".

Служба [Миграция Azure](migrate-services-overview.md) объединяет в себе инструменты, которые используются для поиска, оценки и переноса приложений, инфраструктуры и рабочих нагрузок в Microsoft Azure. Она включает в себя инструменты Миграции Azure и предложения независимых поставщиков программного обеспечения.



Это руководство является вторым в серии, в которой показано, как оценивать и переносить виртуальные машины Hyper-V в Azure. Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Настройка проекта службы "Миграция Azure".
> * Настройка и регистрация устройства службы "Миграция Azure".
> * Запуск непрерывного обнаружения локальных виртуальных машин.
> * Группирование обнаруженных виртуальных машин и оценка группы.
> * Просмотр оценки.

> [!NOTE]
> В руководствах показан простейший путь развертывания сценария, использование которого позволяет быстро настроить проверку концепции. В руководствах по возможности используются параметры по умолчанию и показаны не все возможные параметры и пути. Для получения подробных инструкций ознакомьтесь со статьями с инструкциями.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/pricing/free-trial/), прежде чем начинать работу.


## <a name="prerequisites"></a>Предварительные требования

- [Завершите](tutorial-prepare-hyper-v.md) работу с первым руководством в этой серии. Если этого не сделать, инструкции в этом руководстве не будут работать.
- В первом руководстве вы должны были выполнить следующие действия.
    - [Настройка разрешений Azure](tutorial-prepare-hyper-v.md#prepare-azure) для службы "Миграция Azure".
    - [Подготовка кластеров](tutorial-prepare-hyper-v.md#prepare-for-hyper-v-assessment), узлов и виртуальных машин Hyper-V для оценки.

## <a name="set-up-an-azure-migrate-project"></a>Настройка проекта службы "Миграция Azure"

1. На портал Azure выберите **Все службы** и найдите службу **Миграция Azure**.
2. В результатах поиска выберите **Миграция Azure**.
3. В разделе **Обзор** в области **Обнаружение, оценка и перенос серверов** щелкните **Оценка и миграция серверов**.

    ![Обнаружение и оценка серверов](./media/tutorial-assess-hyper-v/assess-migrate.png)

4. В разделе **Приступая к работе** щелкните **Добавить инструменты**.
5. На вкладке**Проект миграции** выберите подписку Azure и создайте группу ресурсов, если у вас ее нет.
6. В разделе **Сведения о проекте** укажите имя проекта и регион для создания проекта.


    ![Создание проекта службы "Миграция Azure"](./media/tutorial-assess-hyper-v/migrate-project.png)

    Проект службы "Миграция Azure" можно создать в следующих регионах.

    **География** | **Регион**
    --- | ---
    Азия  | Юго-Восточная Азия
    Европа | Северная или Западная Европа
    Великобритания |  Южная часть Соединенного Королевства или западная часть Соединенного Королевства
    США | Восточная часть США, западная часть США 2 или центрально-западная часть США

    - Регион проекта используется только для хранения метаданных, полученных из локальных виртуальных машин.
    - При миграции виртуальных машин можно выбрать другой целевой регион Azure. Для целевого объекта миграции поддерживаются все регионы Azure.

7. Щелкните **Далее**.
8. В области **Выберите инструмент оценки** выберите **Azure Migrate: Server Assessment (Миграция Azure: оценка сервера)**  > **Далее**.

    ![Создание проекта службы "Миграция Azure"](./media/tutorial-assess-hyper-v/assessment-tool.png)

9. В области **Выберите инструмент миграции** выберите **Пропустить добавление инструмента миграции** > **Далее**.
10. В области **Review + add tools** (Проверка и добавление инструментов) проверьте параметры и щелкните **Add tools** (Добавить инструменты).
11. Развертывание проекта службы "Миграция Azure" может занять несколько минут. После этого откроется страница проекта. Если проект не отображается, доступ к нему можно получить в разделе **Серверы** на панели мониторинга службы "Миграция Azure".




## <a name="set-up-the-appliance-vm"></a>Настройка виртуальной машины устройства

Средство "Оценка севера" службы "Миграция Azure" запускает упрощенное устройство виртуальной машины Hyper-V.

- Это устройство выполняет обнаружение виртуальных машин и инициирует отправку метаданных и данных производительности в средство "Оценка севера" службы "Миграция Azure".
- Чтобы настроить устройство, сделайте следующее.
    - Скачайте сжатый виртуальный жесткий диск Hyper-V с портала Azure.
    - Создайте устройство и убедитесь, что оно может подключиться к средству оценки сервера в службе "Миграция Azure".
    - Настройте устройство в первый раз и зарегистрируйте его в проекте службы "Миграция Azure".

### <a name="download-the-vhd"></a>Скачивание VHD-файла

Скачайте сжатый шаблон VHD для устройства.

1. Последовательно выберите разделы **Цели миграции** > **Серверы** > **Azure Migrate: Server Assessment (Миграция Azure: оценка серверов)** и щелкните **Обнаружение**.
2. В разделе**Обнаружение компьютеров** > **Ваши компьютеры виртуализированы?** выберите **Да, с Hyper-V**.
3. Нажмите кнопку **Скачать**, чтобы скачать VHD-файл.

    ![Скачивание виртуальной машины](./media/tutorial-assess-hyper-v/download-appliance-hyperv.png)


### <a name="verify-security"></a>Проверка безопасности

Прежде чем развертывать сжатый ZIP-файл, убедитесь, что он не поврежден.

1. На компьютере, на который был скачан файл, откройте командное окно с правами администратора.

2. Выполните следующую команду PowerShell, чтобы создать хэш ZIP-файла.
    - ```C:\>Get-FileHash -Path <file_location> -Algorithm [Hashing Algorithm]```
    - Пример использования: ```C:\>Get-FileHash -Path ./AzureMigrateAppliance_v1.19.06.27.zip -Algorithm SHA256```

3.  Для версии устройства 2.19.07.30 созданный хэш должен соответствовать этим параметрам.

  **Алгоритм** | **Значение хэша**
  --- | ---
  MD5 | d0a68e76ea24ba4e4a494c0dab95e90e
  SHA256 | 0551221d2a9de75c352c201ccc88f7f10e87e5df1ecda42bfd4ec6c8defc57c0



### <a name="create-the-appliance-vm"></a>Создание виртуальной машины устройства

Импортируйте скачанный файл и создайте виртуальную машину.

1. После скачивания сжатого VHD-файла на узел Hyper-V, на котором будет размещена виртуальная машина устройства, разархивируйте ZIP-файл.
    - В указанном расположении файл буде распакован в папку с именем **AzureMigrateAppliance_VersionNumber**.
    - Эта папка содержит вложенную папку, которая также называется **AzureMigrateAppliance_VersionNumber**.
    - В этой вложенной папке находятся три вложенные папки — **Snapshots**, **Virtual Hard Disks** и **Virtual Machines**.

2. Откройте диспетчер Hyper-V. В меню **Actions** (Действия) щелкните команду **Import Virtual Machine** (Импорт виртуальной машины).

    ![Развертывание VHD](./media/tutorial-assess-hyper-v/deploy-vhd.png)

2. В мастере импорта виртуальных машин в разделе **Before you begin** (Перед началом работы) нажмите кнопку **Next** (Далее).
3. В окне **выбора папки** выберите папку **Virtual Machines**. Нажмите кнопку **Далее**.
1. В меню **Select Virtual Machine** (Выбор виртуальной машины) нажмите кнопку **Next** (Далее).
2. В меню **Choose Import Type** (Выбор типа импорта) щелкните **Copy the virtual machine (create a new unique ID)** (Копировать виртуальную машину (создать уникальный идентификатор)). Нажмите кнопку **Далее**.
3. В меню **Choose Destination** (Выбор назначения) оставьте параметр по умолчанию. Щелкните **Далее**.
4. В меню **Storage Folders** (Папки хранилища) оставьте значение по умолчанию. Щелкните **Далее**.
5. В поле **Choose Network** (Выбор сети) укажите виртуальный коммутатор, который будет использоваться виртуальной машиной. Ему требуется подключение к Интернету для отправки данных в Azure.
6. Просмотрите информацию на странице **Summary** (Сводка). Нажмите кнопку **Готово**.
7. В диспетчере Hyper-V в разделе **Virtual Machines** (Виртуальные машины) запустите виртуальную машину.


### <a name="verify-appliance-access-to-azure"></a>Проверка доступа устройства к Azure

Убедитесь, что виртуальная машина устройства может подключиться к [URL-адресам Azure](migrate-support-matrix-hyper-v.md#assessment-appliance-url-access).

### <a name="configure-the-appliance"></a>Настройка устройства

Настройте устройство в первый раз.

1. В диспетчере Hyper-V в разделе **Virtual Machines** (Виртуальные машины) щелкните правой кнопкой мыши виртуальную машину и выберите **Connect** (Подключиться).
2. Укажите язык, часовой пояс и пароль для устройства.
3. Откройте браузер на любом компьютере, который может подключиться к виртуальной машине, и откройте URL-адрес веб-приложения устройства: **https://*имя устройства или IP-адрес*: 44368**.

   Кроме того, вы можете открыть приложение с рабочего стола устройства, щелкнув ярлык приложения.
1. В веб-приложении выберите **Настройка необходимых компонентов** и выполните приведенные ниже действия.
    - **Лицензия**: Примите условия лицензии и прочитайте информацию от сторонних производителей.
    - **Возможность подключения**: приложение проверит наличие доступа к Интернету у виртуальной машины. Если виртуальная машина использует прокси, выполните приведенные ниже действия.
      - Щелкните **Proxy settings** (Параметры прокси-сервера) и укажите адрес и порт прослушивания прокси-сервера в виде http://ProxyIPAddress или http://ProxyFQDN.
      - Укажите учетные данные, если для прокси-сервера требуется аутентификация.
      - Поддерживается только прокси-сервер HTTP.
    - **Синхронизация времени**: время проверяется. Время на устройстве должно быть синхронизировано со временем в Интернете для правильной работы обнаружения виртуальных машин.
    - **Установка обновлений**: средство "Оценка сервера" службы "Миграция Azure" проверяет, установлены ли на устройстве последние обновления.

### <a name="register-the-appliance-with-azure-migrate"></a>Регистрация устройства с помощью службы "Миграция Azure"

1. Щелкните **Войти в систему**. Если этот параметр не отображается, убедитесь, что в браузере отключена блокировка всплывающих окон.
2. На новой вкладке выполните вход с использованием учетных данных Azure.
    - Войдите с использованием имени пользователя и пароля.
    - Вход с помощью PIN-кода не поддерживается.
3. После успешного входа вернитесь к веб-приложению.
4. Выберите подписку, в которой был создан проект службы "Миграция Azure". Затем выберите проект.
5. Укажите имя для устройства. Это имя должно содержать буквы и цифры, не более 14 символов.
6. Щелкните **Зарегистрировать**.


### <a name="delegate-credentials-for-smb-vhds"></a>Делегирование учетных данных для виртуальных жестких дисков SMB

Если вы запускаете виртуальные жесткие диски в SMB, необходимо включить делегирование учетных данных с устройства на узлы Hyper-V. Для этого требуется следующее:

- Настройте каждый узел в качестве делегата для устройства. Вы должны были сделать во время работы с предыдущим учебником, когда готовили Hyper-V для оценки и миграции. Вы должны были либо настроить CredSSP для узлов [вручную](tutorial-prepare-hyper-v.md#enable-credssp-on-hosts), либо [запустить скрипт настройки необходимых компонентов для Hyper-V](tutorial-prepare-hyper-v.md#hyper-v-prerequisites-configuration-script).
- Включите делегирование CredSSP, чтобы устройство Миграции Azure могло выступать в качестве клиента, передавая учетные данные узлу.

Включите делегирование на устройстве следующим образом:

#### <a name="option-1"></a>Вариант 1

На виртуальной машине устройства выполните эту команду. HyperVHost1/HyperVHost2 — это примеры имен узлов.

```
Enable-WSManCredSSP -Role Client -DelegateComputer HyperVHost1.contoso.com HyperVHost2.contoso.com -Force
```

Пример: ` Enable-WSManCredSSP -Role Client -DelegateComputer HyperVHost1.contoso.com HyperVHost2.contoso.com -Force `

#### <a name="option-2"></a>Вариант 2

Кроме того, это можно сделать в редакторе локальных групповых политик на устройстве:

1. В разделе **Политика локального компьютера** > **Конфигурация компьютера** щелкните **Административные шаблоны** > **Система** > **Передача учетных данных**.
2. Дважды щелкните **Разрешить передачу новых учетных данных** и выберите **Включено**.
3. В разделе **Параметры** щелкните **Показать** и добавьте в список каждый узел Hyper-V, который требуется обнаружить, используя **wsman/** в качестве префикса.
4. Затем в области **Передача учетных данных** дважды щелкните **Разрешить делегирование новых учетных данных с проверкой подлинности сервера "только NTLM"** . Еще раз добавьте в список каждый узел Hyper-V, который требуется обнаружить, используя **wsman/** в качестве префикса.

## <a name="start-continuous-discovery"></a>Запуск непрерывного обнаружения

Подключитесь с устройства к узлам или кластерам Hyper-V и запустите обнаружение виртуальных машин.

1. В полях **Имя пользователя** и **Пароль** укажите данные учетной записи, которую устройство будет использовать для обнаружения виртуальных машин. Укажите понятное имя учетных данных и щелкните **Сохранить подробности**.
2. Щелкните **Добавить узел** и укажите сведения об узле или кластере Hyper-V.
3. Щелкните **Проверить**. После проверки отображается число виртуальных машин, которые можно обнаружить на каждом узле или кластере.
    - Если проверка для узла завершается неудачно, проверьте ошибку, наведя указатель мыши на значок в столбце **Состояние**. Устраните проблемы и повторите проверку.
    - Чтобы удалить узлы или кластеры, выберите **Удалить**.
    - Невозможно удалить конкретный узел из кластера. Вы можете удалить только весь кластер.
    - Вы можете добавить кластер, даже если возникли проблемы с конкретными узлами в кластере.
4. После проверки щелкните **Сохранить и начать обнаружение**, чтобы начать процесс обнаружения.

Запустится обнаружение. Чтобы метаданные обнаруженных серверов отобразились на портале Azure, потребуется около 1,5 минут на узел. 

### <a name="verify-vms-in-the-portal"></a>Проверка виртуальных машин на портале

После завершения обнаружения вы можете убедиться, что виртуальные машины отображаются на портале Azure.

1. Откройте панель мониторинга службы "Миграция Azure".
2. На странице **Azure Migrate — Servers** > **Azure Migrate: Server Assessment** (Миграция Azure — серверы > Миграция Azure: оценка сервера) щелкните значок, отображающий количество **обнаруженных серверов**.

## <a name="set-up-an-assessment"></a>Настройка оценки

Существует два типа оценки, которые можно запустить с помощью средства "Оценка сервера" службы "Миграция Azure".

**Оценка** | **Дополнительные сведения** | **Данные**
--- | --- | ---
**На основе производительности** | Оценки на основе собранных данных производительности | **Рекомендуемый размер виртуальной машины**: на основе данных об использовании ЦП и памяти.<br/><br/> **Рекомендуемый тип диска (управляемый диск цен. категории "Стандартный" или "Премиум")** : на основе операций ввода-вывода в секунду и пропускной способности локальных дисков.
**Как в локальной среде** | Оценки на основе определения размера в локальной среде. | **Рекомендуемый размер виртуальной машины**: на основе размера локальной виртуальной машины.<br/><br> **Рекомендуемый тип диска**: на основе параметра типа хранилища, выбранного для оценки.



### <a name="run-an-assessment"></a>Запуск оценки

Запустите оценку следующим образом:

1. Просмотрите [рекомендации](best-practices-assessment.md) для создания оценок.
2. В разделе **Серверы** > **Azure Migrate: Server Assessment** (Миграция Azure: оценка сервера) щелкните **Оценка**.

    ![Оценка](./media/tutorial-assess-hyper-v/assess.png)

3. В разделе **Оценка серверов** укажите имя для оценки.
4. Щелкните **Просмотреть все**, чтобы просмотреть свойства оценки.

    ![Свойства оценки](./media/tutorial-assess-hyper-v/assessment-properties.png)

3. В разделе **Создание или выбор группы** выберите **Создать** и укажите имя группы. Группа собирает одну или несколько виртуальных машин для оценки.
4. В разделе **Добавление компьютеров в группу** выберите виртуальные машины, которые необходимо добавить в группу.
5. Щелкните **Создать оценку**, чтобы создать группу и запустить оценку.

    ![Создание оценки](./media/tutorial-assess-hyper-v/assessment-create.png)

6. После создания оценки просмотрите ее, выбрав **Серверы** > **Azure Migrate: Server Assessment** (Миграция Azure: оценка сервера).
7. Щелкните **Экспорт оценки**, чтобы скачать оценку в виде файла Excel.


## <a name="review-an-assessment"></a>Проверка оценки

В результатах оценки описывается:

- **готовность к работе в Azure**: подходят ли виртуальные машины для миграции в Azure;
- **примерную ежемесячную стоимость**: оценочную месячная стоимость вычислений и хранения для работы виртуальных машин в Azure;
- **примерную стоимость хранилища в месяц**: расчетную стоимость хранилища дисков после миграции.


### <a name="view-an-assessment"></a>Просмотр оценки

1. Последовательно выберите разделы **Цели миграции** >  **Серверы** > **Azure Migrate: Server Assessment** (Миграция Azure: оценка сервера) и щелкните **Оценки**.
2. В разделе **Оценки** щелкните оценку, чтобы открыть сведения о ней.

    ![Сводка оценки](./media/tutorial-assess-hyper-v/assessment-summary.png)


### <a name="review-azure-readiness"></a>Проверка готовности к работе в Azure

1. В разделе **Готовность к работе в Azure** проверьте, готовы ли виртуальные машины к миграции в Azure.
2. Проверьте состояние виртуальной машины:
    - **Готово к работе в Azure**: служба "Миграция Azure" рекомендует размер и стоимость виртуальных машин в оценке.
    - **Готово при выполнении условий**: отображает проблемы и предлагаемые способы исправления.
    - **Не готово для Azure**: отображает проблемы и предлагаемые способы исправления.
    - **Уровень готовности неизвестен**: используется, когда служба "Миграция Azure" не может оценить готовность из-за проблем с доступностью данных.

2. Щелкните состояние **Готовность к работе в Azure**. Вы можете просмотреть сведения о готовности виртуальной машины и сведения о самой виртуальной машине, включая вычисления, хранилище и параметры сети.

### <a name="review-cost-details"></a>Просмотр сведений о затратах

В этом представлении отображается оценочная стоимость вычислений и хранения для запуска виртуальных машин в Azure.

1. Просмотрите ежемесячные затраты на вычисления и хранение. Затраты объединяются для всех виртуальных машин в оцениваемой группе.

    - Оценки стоимости основаны на рекомендациях по размеру компьютера, его дисков и свойств.
    - Показана расчетная месячная стоимость вычислений и хранения.
    - Оценка затрат предназначена для запуска локальных виртуальных машин в качестве виртуальных машин IaaS. Средство "Оценка серверов" службы "Миграция Azure" не учитывает затраты на PaaS или SaaS.

2. Вы можете просмотреть примерную стоимость хранилища в месяц. В этом представлении показаны совокупные затраты на хранение для оцениваемой группы, распределенные по дискам хранения разных типов.
3. Вы можете воспользоваться детализацией для просмотра сведений об определенных виртуальных машинах.


### <a name="review-confidence-rating"></a>Просмотр рейтинга достоверности

При запуске оценок на основе производительности для них назначается оценка достоверности.

![Оценка достоверности](./media/tutorial-assess-hyper-v/confidence-rating.png)

- Можно получить оценку от 1 звезды (самая низкая) до 5 звезд (самая высокая).
- Оценка достоверности помогает определить надежность рекомендаций по выбору размера, предоставленных оценкой.
- Оценка достоверности назначается на основе доступности точек данных, необходимых для вычисления оценки.

Ниже приведены оценки достоверности.

**Доступность точки данных** | **Оценка достоверности**
--- | ---
0–20 % | 1 звезда
21–40 % | 2 звезды
41–60 % | 3 звезды
61–80 % | 4 звезды
81–100 % | 5 звезд

Дополнительные сведения о рекомендациях для оценки достоверности см. [здесь](best-practices-assessment.md#best-practices-for-confidence-ratings).





## <a name="next-steps"></a>Дополнительная информация

Изучив это руководство, вы:

> [!div class="checklist"]
> * Настроили устройство службы "Миграция Azure".
> * Создали и проверили оценку.

Перейдите к третьему руководству из этой серии, чтобы узнать, как перенести виртуальные машины Hyper-V в Azure с помощью средства "Миграция сервера" службы "Миграция Azure".

> [!div class="nextstepaction"]
> [Migrate Hyper-V VMs to Azure](./tutorial-migrate-hyper-v.md) (Перенос виртуальных машин Hyper-V в Azure)
