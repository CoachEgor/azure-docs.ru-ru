---
title: Архитектура устройства "миграция Azure"
description: Содержит общие сведения об устройстве миграции Azure, используемом при оценке и миграции сервера.
author: rayne-wiselman
ms.service: azure-migrate
ms.topic: conceptual
ms.date: 11/19/2019
ms.author: raynew
ms.openlocfilehash: bdc81820b1ac9867d45fd26e26d24c65e20641e4
ms.sourcegitcommit: dbde4aed5a3188d6b4244ff7220f2f75fce65ada
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/19/2019
ms.locfileid: "74185833"
---
# <a name="azure-migrate-appliance"></a>Устройство службы "Миграция Azure"

В этой статье описывается устройство миграции Azure. Вы развертываете устройство при использовании средств оценки и миграции Azure для обнаружения, оценки и миграции приложений, инфраструктуры и рабочих нагрузок в Microsoft Azure. 

Служба " [Миграция Azure](migrate-services-overview.md) " предоставляет центральный концентратор для наблюдения за обнаружением, оценкой и миграцией локальных приложений и рабочих нагрузок, а также виртуальных машин частного или общедоступного облака в Azure. Эта служба предоставляет инструменты для оценки и миграции, а также предложения сторонних независимых поставщиков программного обеспечения (ISV).



## <a name="appliance-overview"></a>Общие сведения об устройстве

Ниже перечислены типы и использование устройств для переноса Azure.

**Развернуто как** | **Область использования** | **Дополнительные сведения**
--- | --- |  ---
Виртуальная машина VMware | Оценка виртуальных машин VMware с помощью средства оценки миграции Azure.<br/><br/> Миграция виртуальных машин VMware без агента с помощью средства миграции сервера Azure Migration Server | Скачайте шаблон OVA и импортируйте его в vCenter Server, чтобы создать виртуальную машину устройства.
Виртуальная машина Hyper-V | Оценка виртуальных машин Hyper-V с помощью средства оценки миграции Azure. | Скачайте сжатый виртуальный жесткий диск и импортируйте его в Hyper-V, чтобы создать виртуальную машину устройства.

## <a name="appliance-access"></a>Доступ к устройству

После настройки устройства можно получить удаленный доступ к виртуальной машине устройства через TCP-порт 3389. Вы также можете удаленно получить доступ к приложению веб-управления для устройства через порт 44368 с URL-адресом: `https://<appliance-ip-or-name>:44368`.

## <a name="appliance-license"></a>Лицензия на устройство
Устройство поставляется с лицензией на ознакомительную версию Windows Server 2016, которая действительна в течение 180 дней. Если период оценки близок к истечению срока действия, рекомендуется скачать и развернуть новое устройство или активировать лицензию операционной системы виртуальной машины устройства.

## <a name="appliance-agents"></a>Агенты устройства
На устройстве установлены эти агенты.

**Agent** | **Дополнительные сведения**
--- | ---
Агент обнаружения | Сбор данных конфигурации локальных виртуальных машин
Агент оценки | Профили локальная среда для получения данных о производительности виртуальной машины.
Адаптер миграции | Управляет репликацией виртуальных машин и координирует обмен данными между виртуальными машинами и Azure.
Шлюз миграции | Отправляет реплицированные данные виртуальной машины в Azure.


## <a name="appliance-deployment-requirements"></a>Требования к развертыванию устройства

- [Ознакомьтесь](migrate-support-matrix-vmware.md#assessment-appliance-requirements) с требованиями к развертыванию для устройства VMware и URL-адресами, к которым должно обращаться устройство.
- [Ознакомьтесь](migrate-support-matrix-hyper-v.md#assessment-appliance-requirements) с требованиями к развертыванию для устройства Hyper-V и URL-адресами, к которым должно обращаться устройство.


## <a name="collected-performance-data-vmware"></a>Собранные данные производительности — VMware

Ниже приведены данные производительности виртуальной машины VMware, которые устройство собирает и отправляет в Azure.

**Данные** | **Счетчик** | **Влияние на оценку**
--- | --- | ---
загрузка ЦП; | cpu.usage.average | Рекомендуемый размер и стоимость виртуальной машины
Использование памяти | mem.usage.average | Рекомендуемый размер и стоимость виртуальной машины
Пропускная способность чтения с диска (МБ в секунду) | virtualDisk.read.average | Вычисление размера диска, стоимости хранилища, размера виртуальной машины
Пропускная способность записи на диск (МБ в секунду) | virtualDisk.write.average | Вычисление размера диска, стоимости хранилища, размера виртуальной машины
Количество операций чтения с диска в секунду | virtualDisk.numberReadAveraged.average | Вычисление размера диска, стоимости хранилища, размера виртуальной машины
Операций записи на диск в секунду | virtualDisk.numberWriteAveraged.average  | Вычисление размера диска, стоимости хранилища, размера виртуальной машины
Пропускная способность чтения сетевого адаптера (МБ в секунду) | net.received.average | Вычисление размера виртуальной машины
Пропускная способность записи сетевого адаптера (МБ в секунду) | net.transmitted.average  |Вычисление размера виртуальной машины


## <a name="collected-metadata-vmware"></a>Собранные метаданные — VMware

> [!NOTE]
> Метаданные, обнаруженные устройством "миграция Azure", используются для того, чтобы масштабировать приложения по мере их переноса в Azure, выполнять анализ соответствия требованиям для Azure, анализ зависимостей приложений и планирование затрат. Корпорация Майкрософт не использует эти данные в отношении аудита соответствия лицензионным требованиям.

Ниже приведен полный список метаданных виртуальных машин VMware, которые устройство собирает и отправляет в Azure.

**Данные** | **Счетчик**
--- | --- 
**Сведения о компьютере** | 
Идентификатор виртуальной машины | vm.Config.InstanceUuid 
Имя виртуальной машины | vm.Config.Name
Идентификатор vCenter Server | Вмвареклиент. instance. UUID
Описание виртуальной машины | vm.Summary.Config.Annotation
Имя продукта лицензии | vm.Client.ServiceContent.About.LicenseProductName
Тип операционной системы | машину. Суммариконфиг. Гуестфуллнаме
Тип загрузки | vm.Config.Firmware
Число ядер | vm.Config.Hardware.NumCPU
Память (МБ) | vm.Config.Hardware.MemoryMB
Количество дисков | машину. Файл config. Hardware. Device. ToList (). FindAll (x = > — VirtualDisk). Count
Список размеров диска | машину. Файл config. Hardware. Device. ToList (). FindAll (x = > — VirtualDisk)
Список сетевых адаптеров | машину. Файл config. Hardware. Device. ToList (). FindAll (x = > — Виртуалесернет). Count
загрузка ЦП; | cpu.usage.average
Использование памяти |mem.usage.average
**Сведения о диске** | 
Значение ключа диска | disk.Key
Номер дикунит | disk.UnitNumber
Значение ключа контроллера диска | disk.ControllerKey.Value
Подготовленных гигабайт | virtualDisk.DeviceInfo.Summary
Имя диска | Значение, созданное с помощью диска. Унитнумбер, Disk. Ключ, диск. Контроллеркэй. VAlue
Число операций чтения за секунду. | virtualDisk.numberReadAveraged.average
Число операций записи за секунду. | virtualDisk.numberWriteAveraged.average
Пропускная способность чтения (МБ в секунду) | virtualDisk.read.average
Пропускная способность записи (МБ в секунду) | virtualDisk.write.average
**Сведения для каждого сетевого адаптера** | 
Имя сетевого адаптера | nic.Key
MAC-адрес. | ((VirtualEthernetCard)nic).MacAddress
IPv4-адреса | vm.Guest.Net
IPv6-адреса | vm.Guest.Net
Пропускная способность чтения (МБ в секунду) | net.received.average
Пропускная способность записи (МБ в секунду) | net.transmitted.average
**Сведения о пути инвентаризации** | 
имя | container.GetType().Name
Тип дочернего объекта | container.ChildType
Справочные сведения | container.MoRef
Сведения о родительском объекте | Container.Parent
Сведения о папке на виртуальную машину | ((Folder)container).ChildEntity.Type
Сведения о центре обработки данных на виртуальную машину | ((Datacenter)container).VmFolder
Сведения о центре обработки данных на папку узлов | ((Datacenter)container).HostFolder
Сведения о кластере на узле | ((Клустеркомпутересаурце) контейнер). Хост
Сведения об узле на виртуальную машину | ((Хостсистем) контейнер). МАШИНУ



## <a name="collected-performance-data-hyper-v"></a>Собранные данные производительности — Hyper-V

> [!NOTE]
> Метаданные, обнаруженные устройством "миграция Azure", используются для того, чтобы масштабировать приложения по мере их переноса в Azure, выполнять анализ соответствия требованиям для Azure, анализ зависимостей приложений и планирование затрат. Корпорация Майкрософт не использует эти данные в отношении аудита соответствия лицензионным требованиям.

Ниже приведены данные о производительности виртуальной машины Hyper, которые устройство собирает и отправляет в Azure.

**Класс счетчика производительности** | **Счетчик** | **Влияние на оценку**
--- | --- | ---
Виртуальный процессор гипервизора Hyper-V | % Времени выполнения гостевой работы | Рекомендуемый размер и стоимость виртуальной машины
Виртуальная машина Hyper-V динамическая память | Текущая нагрузка (%)<br/> Физическая доступная Гостевая память (МБ) | Рекомендуемый размер и стоимость виртуальной машины
Виртуальное запоминающее устройство Hyper-V | Байтов чтения в секунду | Вычисление размера диска, стоимости хранилища, размера виртуальной машины
Виртуальное запоминающее устройство Hyper-V | Записано байт в секунду | Вычисление размера диска, стоимости хранилища, размера виртуальной машины
Виртуальный сетевой адаптер Hyper-V | Получено байт/сек | Вычисление размера виртуальной машины
Виртуальный сетевой адаптер Hyper-V | Отправлено байтов в секунду | Вычисление размера виртуальной машины

- Загрузка ЦП — это сумма всех использований для всех виртуальных процессоров, подключенных к виртуальной машине.
- Использование памяти — (текущее давление * видимая физическая память)/100.
- Значения использования диска и сети собираются из перечисленных счетчиков производительности Hyper-V.

## <a name="collected-metadata-hyper-v"></a>Собранные метаданные — Hyper-V

Ниже приведен полный список метаданных виртуальной машины Hyper-V, которые устройство собирает и отправляет в Azure.

**Данные** | **Класс WMI** | **Свойство класса WMI**
--- | --- | ---
**Сведения о компьютере** | 
Серийный номер BIOS _ Msvm_BIOSElement | биоссериалнумбер
Тип виртуальной машины (GEN 1 или 2) | Msvm_VirtualSystemSettingData | виртуалсистемсубтипе
Отображаемое имя виртуальной машины | Msvm_VirtualSystemSettingData | ElementName
Версия виртуальной машины | Msvm_ProcessorSettingData | виртуалкуантити
Память (байт) | Msvm_MemorySettingData | виртуалкуантити
Максимальный объем памяти, который может потребляться виртуальной машиной | Msvm_MemorySettingData | Ограничение
Динамическая память включена | Msvm_MemorySettingData | динамикмеморенаблед
Имя, версия или полное доменное название операционной системы | Msvm_KvpExchangeComponent | Данные имени Гуестинтринсицексчанжеитемс
Состояние питания виртуальной машины | Msvm_ComputerSystem | Отличается
**Сведения о диске** | 
Идентификатор диска | Msvm_VirtualHardDiskSettingData | виртуалдискид
Тип виртуального жесткого диска | Msvm_VirtualHardDiskSettingData | введите
Размер виртуального жесткого диска | Msvm_VirtualHardDiskSettingData | максинтерналсизе
Родительский элемент виртуального жесткого диска | Msvm_VirtualHardDiskSettingData | парентпас
**Сведения для каждого сетевого адаптера** | 
IP-адреса (синтетические сетевые карты) | Msvm_GuestNetworkAdapterConfiguration | IPAddresses
DHCP включен (синтетические сетевые карты) | Msvm_GuestNetworkAdapterConfiguration | DHCPEnabled
ИДЕНТИФИКАТОР сетевого адаптера (синтетические сетевые карты) | Msvm_SyntheticEthernetPortSettingData | InstanceID
MAC-адрес NIC (синтетические сетевые карты) | Msvm_SyntheticEthernetPortSettingData | Адрес
ИДЕНТИФИКАТОР сетевого адаптера (устаревшие сетевые карты) | Данные Мсвмемулатедесернетпортсеттинг | InstanceID
MAC ID NIC (устаревшие сетевые карты) | Данные Мсвмемулатедесернетпортсеттинг | Адрес




## <a name="discovery-and-collection-process"></a>Процесс обнаружения и сбора

Устройство взаимодействует с серверами vCenter и узлами или кластером Hyper-V, используя следующий процесс.


1. **Запустить обнаружение**:
    - При запуске обнаружения на устройстве Hyper-V оно взаимодействует с узлами Hyper-V на портах WinRM 5985 (HTTP) и 5986 (HTTPS).
    - При запуске обнаружения на устройстве VMware оно по умолчанию взаимодействует с сервером vCenter через TCP-порт 443. Если сервер vCenter Server прослушивает другой порт, его можно настроить в веб-приложении устройства.
2. **Сбор данных о метаданных и производительности**:
    - Устройство использует сеанс модель CIM (CIM) для сбора данных виртуальной машины Hyper-v с узла Hyper-V на портах 5985 и 5986.
    - По умолчанию устройство взаимодействует с портом 443 для сбора данных виртуальной машины VMware из vCenter Server.
3. **Send Data (отправить данные**). устройство отправляет собранные данные в Azure Migration Server оценок и выполняет миграцию сервера миграции Azure через порт SSL 443.
    - Для данных производительности устройство собирает данные об использовании в режиме реального времени.
        - Данные о производительности собираются каждые 20 секунд для VMware и каждые 30 секунд для Hyper-V для каждой метрики производительности.
        - Собранные данные суммируются для создания одной точки данных в течение десяти минут.
        - Значение пиковой загрузки выбирается во всех 20/30 секундных точках данных и отправляется в Azure для вычисления оценки.
        - На основе значения процентиля, указанного в свойствах оценки (50/90/95 процентиль/99-м), точки с десятью минутами сортируются в возрастающем порядке, а соответствующее значение процентиля используется для вычисления оценки.
    - Для миграции сервера устройство начинает сбор данных виртуальной машины и реплицирует их в Azure.
4. **Оценка и миграция**. Теперь вы можете создавать оценки на основе метаданных, собранных устройством, с помощью функции "Миграция серверов Azure". Кроме того, можно также приступить к переносу виртуальных машин VMware с помощью миграции сервера миграция Azure для координации репликации виртуальных машин без агента.


![Архитектура](./media/migrate-appliance/architecture.png)


## <a name="appliance-upgrades"></a>Обновление устройства

Устройство обновляется, так как агенты службы "миграция Azure", работающие на устройстве, обновляются.

- Это происходит автоматически, так как автоматическое обновление включено на устройстве по умолчанию.
- Вы можете изменить этот параметр по умолчанию, чтобы обновить агенты вручную.
- Чтобы отключить автоматическое обновление, перейдите в редактор реестра > HKEY_LOCAL_MACHINE \Софтваре\микрософт\азуреапплианце и установите раздел реестра — "автоматическое обновление" в значение 0 (DWORD).
 
### <a name="set-agent-updates-to-manual"></a>Установка обновлений агента вручную

Для ручного обновления убедитесь, что одновременно обновляются все агенты на устройстве, с помощью кнопки **Обновить** для каждого устаревшего агента на устройстве. Вы можете в любое время переключить параметр обновления обратно на автоматические обновления.

## <a name="next-steps"></a>Дополнительная информация

[Узнайте, как](tutorial-assess-vmware.md#set-up-the-appliance-vm) настроить устройство для VMware.
[Узнайте, как](tutorial-assess-hyper-v.md#set-up-the-appliance-vm) настроить устройство для Hyper-V.

