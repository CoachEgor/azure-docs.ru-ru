---
title: Устройство службы "Миграция Azure"
description: Предоставляет обзор прибора Azure Migrate, используемого для оценки серверов и миграции.
ms.topic: conceptual
ms.date: 03/23/2020
ms.openlocfilehash: bccf4738d46b65f2d149eafc8e69591141d7d073
ms.sourcegitcommit: ced98c83ed25ad2062cc95bab3a666b99b92db58
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/31/2020
ms.locfileid: "80437595"
---
# <a name="azure-migrate-appliance"></a>Устройство службы "Миграция Azure"

В этой статье кратко излагаются предпосылки и требования к поддержке прибора Azure Migrate. 

## <a name="deployment-scenarios"></a>Сценарии развертывания

Прибор Azure Migrate используется в следующих сценариях.

**Сценарий** | **Инструмент** | **Используется для** 
--- | --- | ---
**VMware VM оценка** | Миграция Azure:Оценка сервера | Откройте для себя VMware VMs<br/><br/> Откройте для себя машинные приложения и зависимости<br/><br/> Сбор метаданных машины и метаданных производительности для оценки.
**VMware VM безагента миграции** | Миграция Azure:Миграция серверов | Откройте для себя VMware VMs <br/><br/> Реплицировать VMware VMs с безагента миграции.
**Оценка Hyper-V VM** | Миграция Azure:Оценка сервера | Откройте для себя Гипер-V V M<br/><br/> Сбор метаданных машины и метаданных производительности для оценки.
**Оценка физической машины** |  Миграция Azure:Оценка сервера |  Откройте для себя физические серверы (или vMs, которые вы рассматриваете как физические серверы).<br/><br/> Сбор метаданных машины и метаданных производительности для оценки.

## <a name="appliance---vmware"></a>Прибор - VMware 

В следующей таблице кратко излагаются требования к приборам Azure Migrate для VMware.

**Требование** | **Vmware** 
--- | ---
**Компоненты приборов** | Прибор имеет следующие компоненты:<br/><br/> - **Приложение управления**: Это веб-приложение для ввода пользователем во время развертывания прибора. Используется при оценке машин для миграции в Azure.<br/> - **Агент обнаружения**: Агент собирает данные конфигурации машины. Используется при оценке машин для миграции в Azure.<br/>- **Агент оценки**: Агент собирает данные о производительности. Используется при оценке машин для миграции в Azure.<br/>- **Служба автоматического обновления**: Обновления компонентов прибора (работает каждые 24 часа).<br/>- **Агент DRA**: оркеструет репликацию VM и координирует связь между реплицированными машинами и Azure. Используется только при репликации VMware VMs в Azure с использованием бесагентной миграции.<br/>- **Шлюз**: Отправляет реплицированные данные в Azure. Используется только при репликации VMware VMs в Azure с использованием бесагентной миграции.
**Поддерживаемое развертывание** | Развертывание как VMware VM с помощью шаблона OVA.<br/><br/> Развертывание в качестве VMware VM или физической машины с помощью сценария установки PowerShell.
**Поддержка проекта** |  Прибор может быть связан с одним проектом. <br/> Любое количество приборов может быть связано с одним проектом.<br/> 
**Ограничения на открытие** | Прибор может обнаружить до 10 000 VMware VMs на vCenter Server.<br/> Прибор может подключиться к одному серверу vCenter.
**Шаблон OVA** | Скачать с https://aka.ms/migrate/appliance/vmwareпортала или с .<br/><br/> Размер загрузки 11,2 ГБ.<br/><br/> Шаблон загруженного прибора поставляется с лицензией на оценку Windows Server 2016, которая действительна в течение 180 дней. Если период оценки близок к истечению, мы рекомендуем загрузить и развернуть новый прибор, или активировать лицензию операционной системы прибора VM.
**Скрипт PowerShell** | [Загрузка](https://go.microsoft.com/fwlink/?linkid=2105112)сценария .<br/><br/> 
**Программное обеспечение/аппаратное обеспечение** |  Прибор должен работать на машине с Windows Server 2016, 32-ГБ оперативной памяти, 8 vCPUs, около 80 ГБ диска хранения, и внешний виртуальный переключатель.<br/> Прибор требует доступа в Интернет, либо непосредственно, либо через прокси.<br/><br/> Если вы запустите прибор на VMware VM, вам нужно достаточно ресурсов на vCenter Server, чтобы выделить VM, который отвечает требованиям.<br/><br/> Если вы запустите прибор на физическом компьютере, убедитесь, что он работает под управлением Windows Server 2016 и отвечает требованиям оборудования. 
**Требования к VMware** | При развертывании прибора в качестве VMware VM, он должен быть развернут на хосте ESXi под управлением версии 5.5 или позже.<br/><br/> vCenter Server работает 5.5, 6.0, 6.5, или 6.7.
**VDDK (бесагентная миграция)** | Если вы разворачиваете прибор в виде VMware VM и используете бесагентную миграцию, VMware vSphere VDDK должен быть установлен на прибор VM.
**Хэш значение-OVA** | [Проверить](tutorial-assess-vmware.md#verify-security) значения хэша шаблона OVA.
**Скрипт Хэш-значение PowerShell** | [Проверить](deploy-appliance-script.md#verify-file-security) значения хэша скрипта powerShell.




## <a name="appliance---hyper-v"></a>Прибор - Hyper-V

**Требование** | **Hyper-V** 
--- | ---
**Компоненты приборов** | Прибор имеет следующие компоненты:<br/><br/>- **Приложение управления**: Это веб-приложение для ввода пользователем во время развертывания прибора. Используется при оценке машин для миграции в Azure.<br/> - **Агент обнаружения**: Агент собирает данные конфигурации машины. Используется при оценке машин для миграции в Azure.<br/>- **Агент оценки**: Агент собирает данные о производительности. Используется при оценке машин для миграции в Azure.<br/>- **Служба автоматического обновления**: Обновления компонентов прибора (работает каждые 24 часа).
**Поддерживаемое развертывание** | Развертывание как Hyper-V VM с помощью шаблона VHD.<br/><br/> Развертывание в качестве Hyper-V VM или физической машины с помощью сценария установки PowerShell.
**Поддержка проекта** |  Прибор может быть связан с одним проектом. <br/> Любое количество приборов может быть связано с одним проектом.<br/> 
**Ограничения на открытие** | Прибор может обнаружить до 5000 Hyper-V M.<br/> Прибор может подключаться к 300 хостам Hyper-V.
**Шаблон VHD** | Папка с циппедом, включая VHD. Скачать с https://aka.ms/migrate/appliance/hypervпортала или с .<br/><br/> Размер загрузки составляет 10 ГБ.<br/><br/> Шаблон загруженного прибора поставляется с лицензией на оценку Windows Server 2016, которая действительна в течение 180 дней. Если период оценки близок к истечению, мы рекомендуем загрузить и развернуть новый прибор, или активировать лицензию операционной системы прибора VM.
**Скрипт PowerShell** | [Загрузка](https://go.microsoft.com/fwlink/?linkid=2105112)сценария .<br/><br/> 
**Программное обеспечение/аппаратное обеспечение***   |  Прибор должен работать на машине с Windows Server 2016, 32-ГБ оперативной памяти, 8 vCPUs, около 80 ГБ диска хранения, и внешний виртуальный переключатель.<br/> Прибор нуждается в статичном или динамическом IP-адресе и требует доступа в Интернет, как напрямую, так и через прокси.<br/><br/> Если вы запустите прибор как Hyper-V VM, вам нужно достаточно ресурсов на хосте Hyper-V, чтобы выделить 16-ГБ оперативной памяти, 8 vCPUs, около 80 ГБ места для хранения и внешний переключатель для прибора VM.<br/><br/> Если вы запустите прибор на физическом компьютере, убедитесь, что он работает под управлением Windows Server 2016 и отвечает требованиям оборудования. 
**Требования к Hyper-V** | При развертывании прибора с помощью шаблона VHD прибор VM, предоставляемый Azure Migrate, представляет hyper-V VM версию 5.0.<br/><br/> Хост Hyper-V должен работать под управлением Windows Server 2012 R2 или позже. 
**Hash значение-VHD** | [Проверить](tutorial-assess-hyper-v.md#verify-security) значения хэша шаблона VHD.
**Скрипт Хэш-значение PowerShell** | [Проверить](deploy-appliance-script.md#verify-file-security) значения хэша скрипта powerShell.


## <a name="appliance---physical"></a>Прибор - Физический

**Требование** | **Физической** 
--- | ---
**Компоненты приборов** | Прибор имеет следующие компоненты: <br/><br/> - **Приложение управления**: Это веб-приложение для ввода пользователем во время развертывания прибора. Используется при оценке машин для миграции в Azure.<br/> - **Агент обнаружения**: Агент собирает данные конфигурации машины. Используется при оценке машин для миграции в Azure.<br/>- **Агент оценки**: Агент собирает данные о производительности. Используется при оценке машин для миграции в Azure.<br/>- **Служба автоматического обновления**: Обновления компонентов прибора (работает каждые 24 часа).
**Поддерживаемое развертывание** | Развертывание в качестве специальной физической машины, или VM, с помощью сценария установки PowerShell.
**Поддержка проекта** |  Прибор может быть связан с одним проектом. <br/> Любое количество приборов может быть связано с одним проектом.<br/> 
**Ограничения на открытие** | Прибор может обнаружить до 250 физических серверов.
**Скрипт PowerShell** | Загрузите скрипт (AzureMigrateInstaller.ps1) в папке с застежкой-молнией с портала. [Подробнее](tutorial-assess-physical.md#set-up-the-appliance). Кроме того, [скачать непосредственно](https://go.microsoft.com/fwlink/?linkid=2105112).<br/><br/> Размер загрузки 59,7 МБ.
**Программное обеспечение/аппаратное обеспечение** |  Прибор должен работать на машине с Windows Server 2016, 32-ГБ оперативной памяти, 8 vCPUs, около 80 ГБ диска хранения, и внешний виртуальный переключатель.<br/> Прибор нуждается в статичном или динамическом IP-адресе и требует доступа в Интернет, как напрямую, так и через прокси.<br/><br/> Если вы запустите прибор на физическом компьютере, убедитесь, что он работает под управлением Windows Server 2016 и отвечает требованиям оборудования. 
**Значение хэша** | [Проверить](deploy-appliance-script.md#verify-file-security) значения хэша скрипта powerShell.

## <a name="url-access"></a>доступ по URL-адресу

Прибор Azure Migrate нуждается в подключении к Интернету.

- При развертывании прибора Azure Migrate проверяет подключение к URL-адресам, обобщенным в таблице ниже.
- Если вы используете прокси на основе URL для подключения к Интернету, необходимо разрешить доступ к этим URL-адресам, убедившись, что прокси разрешает любые записи CNAME, полученные при поиске URL-адресов.

**URL-адрес** | **Сведения**  
--- | --- |
*.portal.azure.com  | Перейдите на портал Azure.
*.windows.net <br/> *.msftauth.net <br/> *.msauth.net <br/> *.microsoft.com <br/> *.live.com | Войдите в свою подписку Azure.
*.microsoftonline.com <br/> *.microsoftonline-p.com | Создавайте приложения Active Directory (AD) для связи с приложением С Azure Migrate.
management.azure.com | Создавайте приложения Azure AD для связи прибора с службой Azure Migrate.
dc.services.visualstudio.com | Загружать журналы приложений, используемые для внутреннего мониторинга.
*.vault.azure.net | Управление секретами в Убежище ключей Azure.
aka.ms/ | Разрешить доступ к акам ссылки. Используется для обновлений приборов Azure Migrate.
download.microsoft.com/download | Разрешить загрузку из Microsoft скачать.
*.servicebus.windows.net | Связь между прибором и службой Azure Migrate.
*.discoverysrv.windowsazure.com <br/> *.migration.windowsazure.com | Подключение к URL-адресам службы Azure Migrate.
*.hypervrecoverymanager.windowsazure.com | **Используется для миграции без агентов VMware**<br/><br/> Подключение к URL-адресам службы Azure Migrate.
*.blob.core.windows.net |  **Используется для миграции без агентов VMware**<br/><br/>Загрузка данных для хранения для миграции.




## <a name="collected-data---vmware"></a>Собранные данные - VMware

Прибор собирает метаданные, данные о производительности и данные анализа зависимостей (если используется [анализ зависимостей](concepts-dependency-visualization.md) без бессилия).

### <a name="metadata"></a>Метаданные

Метаданные, обнаруженные прибором Azure Migrate, помогают выяснить, готовы ли машины и приложения к миграции в Azure, машины и приложения правильного размера, планы затрат и анализ зависимостей приложений. Корпорация Майкрософт не использует эти данные при любом аудите соответствия лицензии.

Вот полный список метаданных VMware VM, которые прибор собирает и отправляет в Azure.

**Данных** | **Счетчик**
--- | --- 
**Детали машины** | 
Идентификатор виртуальной машины | vm.Config.InstanceUuid 
имя виртуальной машины; | vm.Config.Name
Идентификатор vCenter Server | VMwareClient.Instance.Uuid
Описание виртуальной машины | vm.Summary.Config.Annotation
Имя продукта лицензии | vm.Client.ServiceContent.About.LicenseProductName
Тип операционной системы | Vm. SummaryConfig.GuestFullName
Тип загрузки | vm.Config.Firmware
Число ядер | vm.Config.Hardware.NumCPU
Память (МБ) | vm.Config.Hardware.MemoryMB
Количество дисков | Vm. Config.Hardware.Device.Tolist(). FindAll (x -> virtualDisk).
Список размеров диска | Vm. Config.Hardware.Device.Tolist(). FindAll (x> является VirtualDisk)
Список сетевых адаптеров | Vm. Config.Hardware.Device.Tolist(). FindAll (x> virtualEthernet).count
загрузка ЦП; | cpu.usage.average
Использование памяти |mem.usage.average
**Детали диска** | 
Значение ключа диска | disk.Key
Номер Дикунита | disk.UnitNumber
Значение ключа контроллера диска | disk.ControllerKey.Value
Подготовленных гигабайт | virtualDisk.DeviceInfo.Summary
Имя диска | Значение, генерируемое с помощью диска. UnitNumber, диск. Ключ, диск. ControllerKey.VAlue
Число операций чтения за секунду. | virtualDisk.numberReadAveraged.average
Число операций записи за секунду. | virtualDisk.numberWriteAveraged.average
Пропускная часть (Mb в секунду) | virtualDisk.read.average
Пропускная часть записи (МБ в секунду) | virtualDisk.write.average
**Детали за NIC** | 
Имя сетевого адаптера | nic.Key
MAC-адрес. | ((VirtualEthernetCard)nic).MacAddress
IPv4-адреса | vm.Guest.Net
IPv6-адреса | vm.Guest.Net
Пропускная часть (Mb в секунду) | net.received.average
Пропускная часть записи (МБ в секунду) | net.transmitted.average
**Детали траектории инвентаризации** | 
Имя | container.GetType().Name
Тип дочернего объекта | container.ChildType
Справочные сведения | container.MoRef
Сведения о родительском объекте | Container.Parent
Детали Folder на VM | ((Folder)container).ChildEntity.Type
Детали центра обработки данных на VM | ((Datacenter)container).VmFolder
Детали центра обработки данных на папку хоста | ((Datacenter)container).HostFolder
Детали кластера на ухозяин | ((ClusterComputeResource)контейнер). Узла
Детали хоста на VM | ((HostSystem)контейнер). Vm

### <a name="performance-data"></a>Данные о производительности


Вот данные о производительности VMware VM, которые прибор собирает и отправляет в Azure.

**Данные** | **Счетчик** | **Влияние на оценку**
--- | --- | ---
загрузка ЦП; | cpu.usage.average | Рекомендуемый размер/стоимость VM
Использование памяти | mem.usage.average | Рекомендуемый размер/стоимость VM
Пропускная часть чтения диска (МБ в секунду) | virtualDisk.read.average | Расчет размера диска, стоимости хранилища, размера VM
Пропускная часть диска (Mb в секунду) | virtualDisk.write.average | Расчет размера диска, стоимости хранилища, размера VM
Операции считываемыми дисками в секунду | virtualDisk.numberReadAveraged.average | Расчет размера диска, стоимости хранилища, размера VM
Диск записывает операции в секунду | virtualDisk.numberWriteAveraged.average  | Расчет размера диска, стоимости хранилища, размера VM
Пропускная часть чтения NIC (MB в секунду) | net.received.average | Расчет для размера VM
NIC записывает пропускную выливку (МБ в секунду) | net.transmitted.average  |Расчет для размера VM

### <a name="app-dependencies-metadata"></a>Метаданные зависимостей приложений

Анализ зависимости без агента собирает данные о подключении и обработке.

#### <a name="connection-data"></a>Данные о подключении

Вот данные о подключении, которые прибор собирает с каждого ВМ включен для анализа зависимостей без агента. Эти данные отправляются в Azure.

**Данные** | **Используется команда** 
--- | --- 
Локальный порт | netstat
Локальный IP-адрес | netstat
Удаленный порт | netstat
Удаленный IP-адрес | netstat
Состояние соединения TCP | netstat
ИД процесса | netstat
Нет. активных соединений | netstat

#### <a name="process-data"></a>Обработка данных
Вот данные процесса, которые прибор собирает с каждого ВМ включен для анализа зависимостей без агента. Эти данные отправляются в Azure.

**Данные** | **класс WMI** | **Имущество класса WMI**
--- | --- | ---
Имя процесса | Win32_Process | Исполняемый Путь
Обработка аргументов | Win32_Process | Командная строка
имя приложения; | Win32_Process | VersionInfo.ProductName параметр свойства ExecutablePath

#### <a name="linux-vm-data"></a>Данные Linux VM

Вот данные о подключении и обработке, которые прибор собирает с каждого Linux VM, включенный для анализа зависимостей без агента. Эти данные отправляются в Azure.

**Данные** | **Используется команда** 
--- | ---
Локальный порт | netstat 
Локальный IP-адрес | netstat 
Удаленный порт | netstat 
Удаленный IP-адрес | netstat 
Состояние соединения TCP | netstat 
Нет. активных соединений | netstat
ИД процесса  | netstat 
Имя процесса | ps
Обработка аргументов | ps
имя приложения; | dpkg или об /ч.



## <a name="collected-data---hyper-v"></a>Собранные данные - Hyper-V

Прибор собирает метаданные, данные о производительности и данные анализа зависимостей (если используется [анализ зависимостей](concepts-dependency-visualization.md) без бессилия).

### <a name="metadata"></a>Метаданные
Метаданные, обнаруженные прибором Azure Migrate, помогают выяснить, готовы ли машины и приложения к миграции в Azure, машины и приложения правильного размера, планы затрат и анализ зависимостей приложений. Корпорация Майкрософт не использует эти данные при любом аудите соответствия лицензии.

Вот полный список метаданных Hyper-V VM, которые прибор собирает и отправляет в Azure.

**Данных* | **WMI CLASS** | **WMI CLASS PROPERTY**
--- | --- | ---
**Детали машины** | 
Серийный номер BIOS - Msvm_BIOSElement | BIOSSerialNumber
Тип VM (Gen 1 или 2) | Msvm_VirtualSystemSettingData | VirtualSystemSubType
Имя дисплея VM | Msvm_VirtualSystemSettingData | ElementName
Версия VM | Msvm_ProcessorSettingData | ВиртуальныйЯя ямена
Память (байты) | Msvm_MemorySettingData | ВиртуальныйЯя ямена
Максимальная память, которую может потреблять VM | Msvm_MemorySettingData | Ограничение
Динамическая память включена | Msvm_MemorySettingData | DynamicMemoryEnabled
Название/версия операционной системы/ФЗДН | Msvm_KvpExchangeComponent | Данные имен GuestIntrinsicExchangeItems
Статус мощности VM | Msvm_ComputerSystem | EnabledState
**Детали диска** | 
Идентификатор диска | Msvm_VirtualHardDiskSettingData | VirtualDiskId
Виртуальный тип жесткого диска | Msvm_VirtualHardDiskSettingData | Тип
Виртуальный размер жесткого диска | Msvm_VirtualHardDiskSettingData | MaxInternalSize
Виртуальный родитель жесткого диска | Msvm_VirtualHardDiskSettingData | ParentPath
**Детали за NIC** | 
IP-адреса (синтетические NICs) | Msvm_GuestNetworkAdapterConfiguration | IPAddresses
Включен DHCP (синтетические NICs) | Msvm_GuestNetworkAdapterConfiguration | DHCPEnabled
NIC ID (синтетические NICs) | Msvm_SyntheticEthernetPortSettingData | InstanceID
Адрес NIC MAC (синтетические NICs) | Msvm_SyntheticEthernetPortSettingData | Адрес
NIC ID (устаревшие NICs) | MsvmEmulatedEthernetPortSetting данные | InstanceID
Идентификатор NIC MAC (устаревшие NICs) | MsvmEmulatedEthernetPortSetting данные | Адрес

### <a name="performance-data"></a>Данные о производительности

Вот данные о производительности Hyper VM, которые прибор собирает и отправляет в Azure.

**Класс счетчика производительности** | **Счетчик** | **Влияние на оценку**
--- | --- | ---
Виртуальный процессор Hyper-V Hypervisor | % Время выполнения гостей | Рекомендуемый размер/стоимость VM
Hyper-V Динамическая память VM | Текущее давление (%)<br/> Гость видимая физическая память (MB) | Рекомендуемый размер/стоимость VM
Гипер-V Виртуальное устройство хранения | Читать Байты / Второй | Расчет размера диска, стоимости хранилища, размера VM
Гипер-V Виртуальное устройство хранения | Написать Байты / Второй | Расчет размера диска, стоимости хранилища, размера VM
Виртуальный сетевой адаптер Hyper-V | Байты Получены/Второй | Расчет для размера VM
Виртуальный сетевой адаптер Hyper-V | Байты Отправлено/Второй | Расчет для размера VM

- Использование процессора является сумма всего использования, для всех виртуальных процессоров, прикрепленных к VM.
- Использование памяти (Текущее давление - видимая физическая память гостя) / 100.
- Значения использования дисков и сети собираются из перечисленных счетчиков производительности Hyper-V.

## <a name="appliance-upgrades"></a>Модернизация приборов

Аппарат обновляется по мере обновления агентов Azure Migrate, работающих на приборе. Это происходит автоматически, потому что автоматическое обновление включено на приборе по умолчанию. Можно изменить эту настройку по умолчанию, чтобы обновить агенты вручную.

- **Выключите автоматическое обновление:** Вы выключите автоматическое обновление в реестре, установив HKEY_LOCAL_MACHINE»SOFTWARE-Microsoft-AzureAppliance "AutoUpdate" ключ к 0 (DWORD). Если вы решили использовать ручные обновления, важно обновить все агенты на приборе в то же время, используя кнопку **обновления** для каждого устаревшего агента на приборе.
- **Обновление вручную:** Для ручных обновлений, убедитесь, что вы обновляете все агенты на приборе, используя кнопку **обновления** для каждого устаревшего агента на приборе. Вы можете переключить настройку обновления обратно на автоматические обновления в любое время.

![Автоматическое обновление прибора](./media/migrate-appliance/autoupdate.png)

## <a name="next-steps"></a>Следующие шаги

- [Узнайте, как](how-to-set-up-appliance-vmware.md) настроить прибор для VMware.
- [Узнайте, как](how-to-set-up-appliance-hyper-v.md) настроить прибор для Hyper-V.
- [Узнайте, как](how-to-set-up-appliance-physical.md) настроить прибор для физических серверов.

