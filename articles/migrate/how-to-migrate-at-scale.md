---
title: Автоматизация переноса большого количества виртуальных машин в Azure | Документация Майкрософт
description: Описывается, как использовать сценарии для переноса большого количества виртуальных машин с помощью Azure Site Recovery
author: snehaamicrosoft
ms.service: azure-migrate
ms.topic: article
ms.date: 04/01/2019
ms.author: snehaa
ms.openlocfilehash: f90140e9464ee72e9ceae8ca140bd060c51aade8
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60597114"
---
# <a name="scale-migration-of-vms-using-azure-site-recovery"></a>Масштабное перемещение виртуальных машин с помощью Azure Site Recovery

Эта статья поможет вам понять, как использовать сценарии для перемещения большого количества виртуальных машин с помощью Azure Site Recovery. Эти сценарии можно скачать из репозитория [примеров для Azure PowerShell](https://github.com/Azure/azure-docs-powershell-samples/tree/master/azure-migrate/migrate-at-scale-with-site-recovery) на GitHub. Скрипты можно использовать для переноса VMware, AWS, GCP виртуальных машин и физических серверов в Azure и поддержки миграции на управляемые диски. С их помощью также можно перенести виртуальные машины Hyper-V, если вы переносите виртуальные машины как физические серверы. Эти сценарии используют модуль PowerShell для Azure Site Recovery, описанный [здесь](https://docs.microsoft.com/azure/site-recovery/vmware-azure-disaster-recovery-powershell).

## <a name="current-limitations"></a>Текущие ограничения:
- Поддержка указания статического IP-адреса только для основной сетевой карты целевой виртуальной машины.
- Сценарии не принимают входные данные, связанные с Преимуществом гибридного использования Azure. Вам необходимо вручную обновлять свойства реплицированной виртуальной машины на портале.

## <a name="how-does-it-work"></a>Как это работает?

### <a name="prerequisites"></a>Технические условия
Перед началом работы необходимо сделать следующее:
- Убедитесь, что хранилище Site Recovery создано в подписке Azure.
- Убедитесь, что в исходной среде установлен сервер конфигурации и сервер обработки и хранилище может обнаружить эту среду.
- Убедитесь, что политика репликации создана и связана с сервером конфигурации.
- Убедитесь, что добавили учетной записи администратора виртуальной Машины на сервер конфигурации (который будет использоваться для репликации в локальную службу виртуальных машин)
- Убедитесь, что целевой артефакты в Azure создаются
    - Целевая группа ресурсов
    - Целевой учетной записи хранения (и его группу ресурсов) — создать учетную запись хранения уровня "премиум", если вы планируете миграцию на "премиум" управляемые диски
    - Учетная запись хранения кэша (и его группу ресурсов) — создать стандартную учетную запись хранения в том же регионе, что и хранилище
    - целевая виртуальная сеть для отработки отказа (и ее группа ресурсов);
    - целевая подсеть;
    - целевая виртуальная сеть для тестовой отработки отказа (и ее группа ресурсов);
    - группа доступности (при необходимости);
    - целевая группа безопасности сети и ее группа ресурсов.
- Убедитесь, что вы определились со свойствами целевой виртуальной машины:
    - имя целевой виртуальной машины;
    - размер целевой виртуальной машины в Azure (можно определить с помощью оценки службы "Миграция Azure");
    - частный IP-адрес основной сетевой карты на виртуальной машине.
- Скачайте сценарии из репозитория [примеров для Azure PowerShell](https://github.com/Azure/azure-docs-powershell-samples/tree/master/azure-migrate/migrate-at-scale-with-site-recovery) на GitHub.

### <a name="csv-input-file"></a>Входной CSV-файл
После завершения всех необходимых компонентов, необходимо создать CSV-файла, которое содержит данные для каждого исходного компьютера, который требуется перенести. Входной CSV-файл должен содержать строку заголовка со сведениями о входных данных и строку с подробными сведениями для каждого компьютера, который необходимо перенести. Все сценарии предназначены для работы с одним и тем же CSV-файлом. Пример шаблона CSV-файла доступен в папке сценариев для справки.

### <a name="script-execution"></a>Выполнение сценария
После подготовки CSV-файла можно выполнить следующие действия для переноса локальных виртуальных машин:

**Шаг №** | **Имя сценария** | **Описание**
--- | --- | ---
1 | asr_startmigration.ps1 | Включение репликации для всех виртуальных машин, перечисленных в CSV-файле. Сценарий генерирует выходные данные в формате CSV со сведениями о задании для каждой виртуальной машины.
2 | asr_replicationstatus.ps1 | Проверка состояния репликации. Сценарий создает CSV-файл с состоянием для каждой виртуальной машины.
3 | asr_updateproperties.ps1 | Когда виртуальные машины будут реплицированы и защищены, используйте этот сценарий для обновления целевых свойств виртуальной машины (свойства вычисления и сети).
4. | asr_propertiescheck.ps1 | Проверка того, правильно ли обновлены свойства.
5 | asr_testmigration.ps1 |  Запуск тестовой отработки отказа виртуальных машин, перечисленных в CSV-файле. Сценарий создает выходные данные в формате CSV со сведениями о задании для каждой виртуальной машины.
6 | asr_cleanuptestmigration.ps1 | После того как вы вручную проверите виртуальные машины после тестовой отработки отказа, можно использовать этот сценарий для очистки виртуальных машин, использованных для тестовой отработкой отказа.
7 | asr_migration.ps1 | Запуск внеплановой отработки отказа для виртуальных машин, перечисленных в CSV-файле. Сценарий создает выходные данные в формате CSV со сведениями о задании для каждой виртуальной машины. Скрипт не завершает работу в локальную службу виртуальных машин перед отработкой отказа, для обеспечения согласованности приложений, мы рекомендуем вручную завершить работу виртуальных машин перед выполнением сценария.
8 | asr_completemigration.ps1 | Выполнение операции фиксации на виртуальных машинах и удалять сущности Azure Site Recovery
9 | asr_postmigration.ps1 | Если вы планируете назначить группы безопасности сети для сетевых карт после отработки отказа, для этого можно использовать этот сценарий. Он назначает группу безопасности сети для любой одной сетевой карты в целевой виртуальной машине.

## <a name="how-to-migrate-to-managed-disks"></a>Как перенести на управляемые диски?
По умолчанию скрипт переносит виртуальные машины для использования управляемых дисков в Azure. Если указанной учетной записи хранения целевой учетной записи хранения уровня "премиум", "премиум" управляемые диски создаются после миграции. Учетная запись хранения кэша может быть стандартной учетной записью. Если целевая учетная запись хранения является учетной записью хранения класса standard, стандартные диски создаются после миграции. 

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о переносе серверов в Azure с помощью Azure Site Recovery см. [здесь](https://docs.microsoft.com/azure/site-recovery/migrate-tutorial-on-premises-azure).
