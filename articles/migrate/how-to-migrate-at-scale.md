---
title: Автоматизация миграционных машин в Azure Migrate
description: Описывает, как использовать скрипты для переноса большого количества машин в Azure Migrate
author: snehaamicrosoft
ms.service: azure-migrate
ms.topic: article
ms.date: 04/01/2019
ms.author: snehaa
ms.openlocfilehash: 317b6e8aa799b7982e9897c6a504d6092491c7ec
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "74196358"
---
# <a name="scale-migration-of-vms"></a>Масштабная миграция вс-м внедома 

Эта статья поможет вам понять, как использовать скрипты для переноса большого количества виртуальных машин (VM). Для масштабирования миграции используется [восстановление сайта Azure.](../site-recovery/site-recovery-overview.md) 

Скрипты восстановления сайта доступны для загрузки в репо [Azure PowerShell Samples](https://github.com/Azure/azure-docs-powershell-samples/tree/master/azure-migrate/migrate-at-scale-with-site-recovery) на GitHub. Скрипты можно использовать для переноса VMware, AWS, GCP VMs и физических серверов на управляемые диски в Azure. С их помощью также можно перенести виртуальные машины Hyper-V, если вы переносите виртуальные машины как физические серверы. Сценарии, использующие Azure Site Recovery PowerShell, описаны [здесь.](https://docs.microsoft.com/azure/site-recovery/vmware-azure-disaster-recovery-powershell)

## <a name="current-limitations"></a>Текущие ограничения
- Поддержка указания статического IP-адреса только для основной сетевой карты целевой виртуальной машины.
- Сценарии не принимают входные данные, связанные с Преимуществом гибридного использования Azure. Вам необходимо вручную обновлять свойства реплицированной виртуальной машины на портале.

## <a name="how-does-it-work"></a>Как это работает?

### <a name="prerequisites"></a>Предварительные требования
Перед началом работы необходимо сделать следующее:
- Убедитесь, что хранилище Site Recovery создано в подписке Azure.
- Убедитесь, что в исходной среде установлен сервер конфигурации и сервер обработки и хранилище может обнаружить эту среду.
- Убедитесь, что политика репликации создана и связана с сервером конфигурации.
- Убедитесь, что вы добавили учетную запись администратора VM на сервер конфигурации (который будет использоваться для репликации на территории VMs)
- Убедитесь, что целевые артефакты в Azure создаются
    - целевая группа ресурсов;
    - Учетная запись целевого хранилища (и ее группа ресурсов) - Создание премиум-аккаунта хранения, если вы планируете перейти на диски с премиальным управлением
    - Учетная запись хранения кэша (и ее группа ресурсов) - Создание стандартной учетной записи хранилища в том же регионе, что и хранилище
    - целевая виртуальная сеть для отработки отказа (и ее группа ресурсов);
    - целевая подсеть;
    - целевая виртуальная сеть для тестовой отработки отказа (и ее группа ресурсов);
    - группа доступности (при необходимости);
    - целевая группа безопасности сети и ее группа ресурсов.
- Убедитесь, что вы определились со свойствами целевой виртуальной машины:
    - имя целевой виртуальной машины;
    - размер целевой виртуальной машины в Azure (можно определить с помощью оценки службы "Миграция Azure");
    - частный IP-адрес основной сетевой карты на виртуальной машине.
- Скачайте сценарии из репозитория [примеров для Azure PowerShell](https://github.com/Azure/azure-docs-powershell-samples/tree/master/azure-migrate/migrate-at-scale-with-site-recovery) на GitHub.

### <a name="csv-input-file"></a>Входной CSV-файл
После завершения всех предварительных запросов необходимо создать файл CSV, в котором есть данные для каждой исходной машины, которую вы хотите перенести. Входной CSV-файл должен содержать строку заголовка со сведениями о входных данных и строку с подробными сведениями для каждого компьютера, который необходимо перенести. Все сценарии предназначены для работы с одним и тем же CSV-файлом. Пример шаблона CSV-файла доступен в папке сценариев для справки.

### <a name="script-execution"></a>Выполнение сценария
После подготовки CSV-файла можно выполнить следующие действия для переноса локальных виртуальных машин:

**Шаг №** | **Имя сценария** | **Описание**
--- | --- | ---
1 | asr_startmigration.ps1 | Включение репликации для всех виртуальных машин, перечисленных в CSV-файле. Сценарий генерирует выходные данные в формате CSV со сведениями о задании для каждой виртуальной машины.
2 | asr_replicationstatus.ps1 | Проверка состояния репликации. Сценарий создает CSV-файл с состоянием для каждой виртуальной машины.
3 | asr_updateproperties.ps1 | Когда виртуальные машины будут реплицированы и защищены, используйте этот сценарий для обновления целевых свойств виртуальной машины (свойства вычисления и сети).
4 | asr_propertiescheck.ps1 | Проверка того, правильно ли обновлены свойства.
5 | asr_testmigration.ps1 |  Запуск тестовой отработки отказа виртуальных машин, перечисленных в CSV-файле. Сценарий создает выходные данные в формате CSV со сведениями о задании для каждой виртуальной машины.
6 | asr_cleanuptestmigration.ps1 | После того как вы вручную проверите виртуальные машины после тестовой отработки отказа, можно использовать этот сценарий для очистки виртуальных машин, использованных для тестовой отработкой отказа.
7 | asr_migration.ps1 | Запуск внеплановой отработки отказа для виртуальных машин, перечисленных в CSV-файле. Сценарий создает выходные данные в формате CSV со сведениями о задании для каждой виртуальной машины. Скрипт не выключает на помещении VMs до запуска сбоя, для согласованности приложения, рекомендуется вручную выключить VMs перед выполнением сценария.
8 | asr_completemigration.ps1 | Выполните операцию коммита на вс-миси и удалите объекты восстановления сайта Azure
9 | asr_postmigration.ps1 | Если вы планируете назначить группы безопасности сети для сетевых карт после отработки отказа, для этого можно использовать этот сценарий. Он присваивает NSG любому NIC в целевом VM.

## <a name="how-to-migrate-to-managed-disks"></a>Как перейти на управляемые диски?
По умолчанию скрипт переносит в Azure mMs на управляемые диски. Если предоставленная учетная запись целевого хранилища является премиум-аккаунтом хранения, диски, управляемые премиум-классом, создаются после миграции. Учетная запись хранения кэша по-прежнему может быть стандартной учетной записью. Если учетная запись целевого хранилища является стандартной учетной записью хранения, создаются стандартные диски после миграции. 

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о переносе серверов в Azure с помощью Azure Site Recovery см. [здесь](https://docs.microsoft.com/azure/site-recovery/migrate-tutorial-on-premises-azure).
