---
title: Устранение неполадок в службе "Миграция Azure" | Документация Майкрософт
description: Эта статья содержит обзор известных проблем в службе "Миграция Azure" и советы по устранению распространенных ошибок.
author: rayne-wiselman
ms.service: azure-migrate
ms.topic: conceptual
ms.date: 03/13/2019
ms.author: raynew
ms.openlocfilehash: dff3c96cf3ac8eea7c1160ee1834cc70390c0333
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60533187"
---
# <a name="troubleshoot-azure-migrate"></a>Устранение неполадок в службе "Миграция Azure"

## <a name="troubleshoot-common-errors"></a>Устранение распространенных ошибок

Служба [Миграция Azure](migrate-overview.md) выполняет оценку локальных рабочих нагрузок для переноса в Azure. Используйте эту статью для устранения неполадок при развертывании и использовании службы "Миграция Azure".

### <a name="i-am-using-the-ova-that-continuously-discovers-my-on-premises-environment-but-the-vms-that-are-deleted-in-my-on-premises-environment-are-still-being-shown-in-the-portal"></a>Я использую OVA-файл, который выполняет непрерывное обнаружение моей локальной среды, но виртуальные машины, которые будут удалены из моей локальной среды, по-прежнему отображаются на портале.

Модуль непрерывного обнаружения только собирает данные о производительности, он не обнаруживает изменения конфигурации в локальной среде (например, добавление, удаление виртуальной машины, добавление диска и т. д.). Если в локальной среде была изменена конфигурация и вам нужно отразить эти изменения на портале, сделайте следующее:

- Добавление элементов (виртуальных машин, дисков, ядер и т. д.). Чтобы отразить эти изменения на портале Azure, вы можете остановить обнаружение с модуля, а затем запустить его снова. Это позволит обновить изменения в проекте "Миграция Azure".

   ![Остановить обнаружение](./media/troubleshooting-general/stop-discovery.png)

- Удаление виртуальных машин. Из-за особенностей конструкции модуля удаление виртуальных машин не отражается даже при остановке и повторном запуске обнаружения. Это связано с тем, что данные из последующих обнаружений добавляются к более старым обнаружениям, а не переопределяются. В этом случае вы можете просто игнорировать виртуальную машину на портале, удалив ее из своей группы и пересчитав оценку.

### <a name="deletion-of-azure-migrate-projects-and-associated-log-analytics-workspace"></a>Удаление проектов службы "Миграция Azure" и связанной рабочей области Log Analytics

При удалении проекта службы "Миграция Azure" удаляется проект миграции, а также все группы и оценки. Однако если к проекту была присоединена рабочая область Log Analytics, она не будет удаляться автоматически. Это обусловлено тем, что одна рабочая область Log Analytics может применяться в нескольких вариантах использования. Если вы также хотите удалить рабочую область Log Analytics, это необходимо сделать вручную.

1. Перейдите к рабочей области Log Analytics, связанной с проектом.
   a. Если вы не удалили проект миграции, ссылку на рабочую область можно найти на странице обзора проекта в разделе "Основное".

   ![Рабочая область LA](./media/troubleshooting-general/LA-workspace.png)

   2. Если вы уже удалили проект миграции, щелкните **Группы ресурсов** на панели слева на портале Azure и перейдите к группе ресурсов, в которой была создана рабочая область, а затем перейдите к нему.
2. Следуйте инструкциям из [этой статьи](https://docs.microsoft.com/azure/azure-monitor/platform/delete-workspace), чтобы удалить рабочую область.

### <a name="migration-project-creation-failed-with-error-requests-must-contain-user-identity-headers"></a>Создание проекта миграции завершилось ошибкой *Requests must contain user identity headers* (Запросы должны содержать заголовки удостоверений пользователей)

Эта проблема может произойти для пользователей, у которых нет доступа к клиенту Azure Active Directory (Azure AD) организации. При добавлении пользователя к клиенту Azure AD в первый раз он получает письмо с приглашением присоединиться к клиенту. Для успешного добавления пользователю необходимо открыть письмо и принять приглашение. Если вы не можете просмотреть письмо, обратитесь к пользователю, имеющему доступ к клиенту, и попросите его отправить приглашение, следуя описанным [здесь](https://docs.microsoft.com/azure/active-directory/b2b/add-users-administrator#resend-invitations-to-guest-users) указаниям.

Получив письмо с приглашением, необходимо открыть его и перейти по содержащейся в нем ссылке, чтобы принять это приглашение. После этого необходимо выйти из портала Azure и войти снова (а не обновить окно браузера). Затем попробуйте создать проект миграции.

### <a name="i-am-unable-to-export-the-assessment-report"></a>Не удается экспортировать отчет об оценке

Если вы не можете экспортировать отчет об оценке с портала, попробуйте с помощью приведенного ниже REST API получить URL-адрес для загрузки отчета об оценке.

1. Установите *armclient* на свой компьютер (если он еще не установлен):

   a. В окне командной строки с правами администратора выполните следующую команду: ```@powershell -NoProfile -ExecutionPolicy Bypass -Command "iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))" && SET "PATH=%PATH%;%ALLUSERSPROFILE%\chocolatey\bin"```

   2. В окне Windows PowerShell с правами администратора выполните следующую команду: ```choco install armclient```

2. Получите URL-адрес загрузки для отчета об оценке с помощью REST API службы "Миграция Azure".

   a.    В окне Windows PowerShell с правами администратора выполните следующую команду: ```armclient login```

        This opens the Azure login pop-up where you need to sign in to Azure.

   2.    В том же окне PowerShell выполните следующую команду, чтобы получить URL-адрес загрузки для отчета об оценке. Замените параметры URI соответствующими значениями. Пример запроса API приведен ниже.

       ```armclient POST https://management.azure.com/subscriptions/{subscriptionID}/resourceGroups/{resourceGroupName}/providers/Microsoft.Migrate/projects/{projectName}/groups/{groupName}/assessments/{assessmentName}/downloadUrl?api-version=2018-02-02```

      Пример запроса и выходных данных:

      ```PS C:\WINDOWS\system32> armclient POST https://management.azure.com/subscriptions/8c3c936a-c09b-4de3-830b-3f5f244d72e9/r
   esourceGroups/ContosoDemo/providers/Microsoft.Migrate/projects/Demo/groups/contosopayroll/assessments/assessment_11_16_2
   018_12_16_21/downloadUrl?api-version=2018-02-02
   {
   "assessmentReportUrl": "https://migsvcstoragewcus.blob.core.windows.net/4f7dddac-f33b-4368-8e6a-45afcbd9d4df/contosopayrollassessment_11_16_2018_12_16_21?sv=2016-05-31&sr=b&sig=litQmHuwi88WV%2FR%2BDZX0%2BIttlmPMzfVMS7r7dULK7Oc%3D&st=2018-11-20T16%3A09%3A30Z&se=2018-11-20T16%3A19%3A30Z&sp=r",
   "expirationTime": "2018-11-20T22:09:30.5681954+05:30"```

3. Скопируйте URL-адрес из ответа и откройте его в браузере, чтобы загрузить отчет об оценке.

4. После загрузки отчета с помощью Excel перейдите к загруженной папке и просмотрите файл.

### <a name="performance-data-for-cpu-memory-and-disks-is-showing-up-as-zeroes"></a>Данные производительности ЦП, памяти и диски отображаются как нули

Служба "Миграция Azure" постоянно профилирует локальную среду для сбора данных производительности локальных виртуальных машин. Если вы только что запустили обнаружение среды, необходимо подождать по крайней мере сутки, пока будут собраны данные производительности. Если оценка создается без ожидания в течение суток, вместо метрик производительности отображаются нули. По истечении суток вы можете либо создать новую оценку, либо обновить существующую, используя параметр "Пересчитать" в отчете об оценке.

### <a name="i-specified-an-azure-geography-while-creating-a-migration-project-how-do-i-find-out-the-exact-azure-region-where-the-discovered-metadata-would-be-stored"></a>Во время создания проекта по миграции была выбрана географическая территория Azure. Как узнать точное название региона Azure, в котором будут храниться обнаруженные метаданные?

Перейдите к разделу **Основное** на странице **Обзор** проекта, чтобы определить точное расположение, где хранятся метаданные. Служба "Миграция Azure" выбирает расположение случайным образом в пределах географической территории, и его нельзя изменить. Если вы хотите создать проект только в определенном регионе, создайте проект миграции с помощью REST API, передав нужный регион.

   ![Расположение проекта](./media/troubleshooting-general/geography-location.png)

## <a name="collector-issues"></a>Проблемы сборщика

### <a name="deployment-of-azure-migrate-collector-failed-with-the-error-the-provided-manifest-file-is-invalid-invalid-ovf-manifest-entry"></a>Развертывание Сборщика миграции Azure завершается сбоем с ошибкой: The provided manifest file is invalid: Invalid OVF manifest entry (Предоставленный файл манифеста является недопустимым: недопустимая запись манифеста OVF).

1. Убедитесь, что файл OVA Сборщика миграции Azure скачан правильно, проверив его хэш-код. Проверка хэш-кода описана в [этой статье](https://docs.microsoft.com/azure/migrate/tutorial-assessment-vmware#verify-the-collector-appliance). Если хэш-коды не совпадают, скачайте OVA-файл снова и повторите попытку развертывания.
2. Если проблема не исчезла, а развертывание OVF выполняется с помощью клиента VMware vSphere, попробуйте развернуть его через веб-клиент vSphere. Если проблема так и не исчезла, попробуйте использовать другой браузер.
3. Если вы применяете веб-клиент vSphere для развертывания в vCenter Server 6.5 или 6.7, попробуйте развернуть OVA-файл напрямую на узле ESXi, выполнив описанные ниже действия:
   - Подключитесь напрямую к узлу ESXi (вместо сервера vCenter Server) с помощью веб-клиента (https://<*IP-адрес узла*>/ui)
   - Откройте раздел "Домашняя страница" > "Список"
   - Щелкните "Файл" > "Развернуть шаблон OVF", затем найдите нужный OVA-файл и завершите развертывание.
4. Если развертывание по-прежнему не удается, обратитесь в поддержку службы "Миграция Azure".

### <a name="unable-to-select-the-azure-cloud-in-the-appliance-fails-with-error-azure-cloud-selection-failed"></a>Невозможно выбрать Azure облако в устройстве, происходит сбой с ошибкой «Не удалось выбрать облачных Azure»

Это известная проблема, и доступно исправление для проблемы. Загрузите [последние обновления bits](https://docs.microsoft.com/azure/migrate/concepts-collector-upgrade#continuous-discovery-upgrade-versions) для устройства и обновления устройства, примените исправление.

### <a name="collector-is-not-able-to-connect-to-the-internet"></a>Сборщик не может подключиться к Интернету

Это может произойти, если используемый компьютер находится за прокси-сервером. Убедитесь, что вы предоставляете учетные данные авторизации, требуемые прокси-сервером.
При использовании любого прокси-сервера брандмауэра на основе URL-адреса для управления исходящими подключениями, внесите в список этих разрешений требуемые URL-адреса:

**URL-адрес** | **Назначение**  
--- | ---
*.portal.azure.com | Требуется для проверки подключения к службе Azure и проверки с синхронизацией времени.
*.oneget.org | Необходимо скачать модуль PowerCLI vCenter на основе PowerShell.

**Сборщик не может подключиться к Интернету из-за ошибки при проверке сертификата**

Это может произойти, если вы подключаетесь к Интернету через перехватывающий прокси-сервер и если вы не импортировали сертификат прокси-сервера на виртуальную машину сборщика. Сертификат прокси-сервера можно импортировать с помощью действий, описанных [здесь](https://docs.microsoft.com/azure/migrate/concepts-collector).

**Сборщику не удается подключиться к проекту, используя идентификатор и ключ проекта, скопированные на портале.**

Убедитесь, что вы скопировали и вставили правильную информацию. Чтобы устранить неполадки, установите агент Microsoft Monitoring Agent (MMA) и проверьте, может ли MMA подключиться к проекту. Для этого сделайте следующее:

1. Скачайте [MMA](https://go.microsoft.com/fwlink/?LinkId=828603) на виртуальную машину сборщика.
2. Чтобы начать установку, дважды щелкните скачанный файл.
3. В программе установки на странице **приветствия** нажмите кнопку **Далее**. На странице **Условия лицензии** нажмите кнопку **Принимаю**, чтобы принять условия лицензии.
4. В поле **Конечная папка** оставьте или измените папку установки по умолчанию. Нажмите кнопку **Далее**.
5. В разделе **Параметры установки агента** последовательно выберите **Azure Log Analytics** > **Далее**.
6. Щелкните **Добавить**, чтобы добавить новую рабочую область Log Analytics. Вставьте скопированные идентификатор и ключ проекта. Нажмите кнопку **Далее**.
7. Убедитесь, что агент может подключиться к проекту. Если установить подключение не удается, проверьте параметры. Если агент может подключиться к проекту, но сборщик — нет, обратитесь в службу поддержки.


### <a name="error-802-date-and-time-synchronization-error"></a>Ошибка 802. Ошибка синхронизации даты и времени

Часы сервера могут быть не синхронизированы с текущим временем более чем на пять минут. Измените время на виртуальной машине сборщика с соответствии с текущим временем, как показано ниже.

1. Откройте командную строку с правами администратора на этой виртуальной машине.
2. Чтобы проверить часовой пояс, выполните команду w32tm /tz.
3. Чтобы синхронизировать время, выполните команду w32tm /resync.

### <a name="vmware-powercli-installation-failed"></a>Не удалось установить VMware PowerCLI

Сборщик службы "Миграция Azure" скачивает PowerCLI и устанавливает его на устройстве. Сбой при установке PowerCLI может произойти в связи с недоступностью конечных точек для репозитория PowerCLI. Для устранения неполадок вручную установите PowerCLI на виртуальных машинах сборщика, следуя указанным ниже инструкциям.

1. Запустите Windows PowerShell в режиме администратора.
2. Перейдите в каталог C:\ProgramFiles\ProfilerService\VMWare\Scripts\.
3. Запустите сценарий InstallPowerCLI.ps1.

### <a name="error-unhandledexception-internal-error-occurred-systemiofilenotfoundexception"></a>Ошибка UnhandledException. Произошла внутренняя ошибка: System.IO.FileNotFoundException

Эта ошибка может возникать из-за проблемы с установкой VMware PowerCLI. Устранить проблему можно следующим образом:

1. Если вы используете не самую новую версию модуля сборщика, обновите его до [последней версии](https://aka.ms/migrate/col/checkforupdates) и проверьте, устранена ли проблема.
2. При наличии последней версии сборщика выполните следующие действия, чтобы выполнить чистую установку PowerCLI.

   a. Закройте веб-браузер на устройстве.

   2. Остановите службу "Сборщик Миграции Azure", перейдя к диспетчеру служб Windows (откройте "Выполнить" и введите services.msc, чтобы открыть диспетчер служб Windows). Щелкните службу "Сборщика Миграции Azure" правой кнопкой мыши и выберите "Остановить".

   c. Удалите все папки, начинающиеся с "VMware", из следующих расположений: C:\Program Files\WindowsPowerShell\Modules;  
        C:\Program Files (x86)\WindowsPowerShell\Modules.

   d. Перезапустите службу "Сборщик Миграции Azure" в диспетчере служб Windows (откройте "Выполнить" и введите services.msc, чтобы открыть диспетчер служб Windows). Щелкните службу "Сборщик Миграции Azure" правой кнопкой и выберите "Запустить".

   д. Дважды щелкните ярлык "Запуск сборщика" на рабочем столе, чтобы запустить приложение сборщика. Приложение сборщика на автоматически необходимо загрузить и установить требуемую версию PowerCLI.

3. Если оно не устраняет проблему, выполните действия для c выше и установить PowerCLI в устройстве, выполнив следующие действия:

   a. Очистить все незавершенные PowerCLI файлы установки, выполнив следующие шаги #к #c шаг #2.

   2. Выберите Пуск > выполнить > Откройте PowerShell(x86) Windows в режиме администратора

   c. Выполните приведенную ниже команду.  Install-Module «VMWare.VimAutomation.Core» - RequiredVersion «6.5.2.6234650» (тип «A», когда он запрашивает подтверждение)

   d. Перезапустите службу "Сборщик Миграции Azure" в диспетчере служб Windows (откройте "Выполнить" и введите services.msc, чтобы открыть диспетчер служб Windows). Щелкните службу "Сборщик Миграции Azure" правой кнопкой и выберите "Запустить".

   д. Дважды щелкните ярлык "Запуск сборщика" на рабочем столе, чтобы запустить приложение сборщика. Приложение сборщика на автоматически необходимо загрузить и установить требуемую версию PowerCLI.

4. Если не удается загрузить модуль в устройство, из-за проблем с брандмауэром, загрузите и установите модуль в компьютере, который имеет доступ к Интернету, выполнив следующие действия:

    a. Очистить все незавершенные PowerCLI файлы установки, выполнив следующие шаги #к #c шаг #2.

    2. Выберите Пуск > выполнить > Откройте PowerShell(x86) Windows в режиме администратора

    c. Выполните приведенную ниже команду.  Install-Module «VMWare.VimAutomation.Core» - RequiredVersion «6.5.2.6234650» (тип «A», когда он запрашивает подтверждение)

    d. Скопируйте все модули, начиная с «VMware» из «C:\Program Files (x86) \WindowsPowerShell\Modules», в то же расположение на виртуальной Машине сборщика.

    д. Перезапустите службу "Сборщик Миграции Azure" в диспетчере служб Windows (откройте "Выполнить" и введите services.msc, чтобы открыть диспетчер служб Windows). Щелкните службу "Сборщик Миграции Azure" правой кнопкой и выберите "Запустить".

    Е. Дважды щелкните ярлык "Запуск сборщика" на рабочем столе, чтобы запустить приложение сборщика. Приложение сборщика на автоматически необходимо загрузить и установить требуемую версию PowerCLI.

### <a name="error-unabletoconnecttoserver"></a>Ошибка UnableToConnectToServer

Не удается подключиться к vCenter Server Servername.com:9443 из-за ошибки: There was no endpoint listening at https://Servername.com:9443/sdk that could accept the message (Ни одна конечная точка, которая могла бы принять сообщение, не ожидала передачи данных по адресу https://Servername.com:9443/sdk).

Проверьте, установлена ли последняя версия устройства сборщика. В противном случае обновите устройство до [последней версии](https://docs.microsoft.com/azure/migrate/concepts-collector).

Если проблема не исчезает в последней версии, это может происходить, если компьютеру сборщика не удается разрешить указанное имя сервера vCenter Server, или если порт указан неправильно. Если порт не указан, сборщик по умолчанию будет пытаться подключиться к порту 443.

1. Попробуйте проверить связь с сайтом Servername.com с компьютера сборщика.
2. Если не удается выполнить шаг 1, попробуйте подключиться к серверу vCenter Server по IP-адресу.
3. Определите правильный номер порта для подключения к серверу vCenter Server.
4. Наконец, проверьте, работает ли сервер vCenter Server.

### <a name="antivirus-exclusions"></a>Исключения антивирусной программы

Для усиления защиты устройства "Миграция Azure" вам потребуется исключить следующие папки устройства из антивирусного сканирования:

- Папка с двоичными файлами для службы "Миграция Azure". Исключите все вложенные папки.
  %ProgramFiles%\ProfilerService  
- Веб-приложение службы "Миграция Azure". Исключите все вложенные папки.
  %SystemDrive%\inetpub\wwwroot
- Локальный кэш для базы данных и файлов журнала. Службе "Миграция Azure" необходим доступ к этой папке с правами на чтение и запись.
  %SystemDrive%\Profiler

## <a name="dependency-visualization-issues"></a>Неполадки с визуализацией зависимостей

### <a name="i-am-unable-to-find-the-dependency-visualization-functionality-for-azure-government-projects"></a>Я не могу найти возможности визуализации зависимостей для проектов Azure для государственных организаций.

Возможность визуализации зависимостей в службе "Миграция Azure" зависит от решения "Сопоставление служб", и, так как данное решение в настоящее время недоступно в Azure для государственных организаций, эта возможность также недоступна.

### <a name="i-installed-the-microsoft-monitoring-agent-mma-and-the-dependency-agent-on-my-on-premises-vms-but-the-dependencies-are-now-showing-up-in-the-azure-migrate-portal"></a>На локальные виртуальные машины установлены Microsoft Monitoring Agent (MMA) и агент зависимостей, однако зависимости не отображаются на портале службы "Миграция Azure".

После того как в системе будут установлены агенты, службе "Миграция Azure" обычно требуется 15–30 минут, чтобы отобразить зависимости на портале. Если прошло более 30 минут, убедитесь, что агент MMA может обмениваться данными с рабочей областью OMS, выполнив следующие действия:

Для виртуальной машины Windows:
1. Перейдите на **панель управления** и запустите **Microsoft Monitoring Agent**.
2. Перейдите на вкладку **Azure Log Analytics (OMS)** во всплывающем окне свойств MMA.
3. Убедитесь, что **состояние** рабочей области отображается зеленым цветом.
4. Если состояние не зеленое, попробуйте удалить рабочую область и снова добавить ее в MMA.
        ![Состояние MMA](./media/troubleshooting-general/mma-status.png)

Для виртуальной машины Linux убедитесь, что команды установки для MMA и агента зависимостей были выполнены успешно.

### <a name="what-are-the-operating-systems-supported-by-mma"></a>Какие операционные системы поддерживаются агентом MMA?

Список операционных систем Windows, поддерживаемых MMA, см. в [этой статье](https://docs.microsoft.com/azure/log-analytics/log-analytics-concept-hybrid#supported-windows-operating-systems).
Список операционных систем Linux, поддерживаемых MMA, см. в [этой статье](https://docs.microsoft.com/azure/log-analytics/log-analytics-concept-hybrid#supported-linux-operating-systems).

### <a name="what-are-the-operating-systems-supported-by-dependency-agent"></a>Какие операционные системы поддерживаются агентом зависимостей?

Список операционных систем Windows, поддерживаемых агентом зависимостей, см. в [этой статье](https://docs.microsoft.com/azure/monitoring/monitoring-service-map-configure#supported-windows-operating-systems).
Список операционных систем Linux, поддерживаемых агентом зависимостей, см. в [этой статье](https://docs.microsoft.com/azure/monitoring/monitoring-service-map-configure#supported-linux-operating-systems).

### <a name="i-am-unable-to-visualize-dependencies-in-azure-migrate-for-more-than-one-hour-duration"></a>В службе "Миграция Azure" нельзя визуализировать зависимости за период свыше одного часа?
В службе "Миграция Azure" можно визуализировать зависимости за период не больше одного часа. Хотя служба "Миграция Azure" позволяет вернуться к определенной дате в журнале за последний месяц, максимальный период, для которого можно визуализировать зависимости, составляет не более 1 часа. Например, вы можете использовать функцию периода времени на карте зависимостей, чтобы просмотреть вчерашние зависимости, однако просматривать их можно только для периода времени в один час. Тем не менее, вы можете использовать журналы Azure Monitor для [запроса данных зависимостей](https://docs.microsoft.com/azure/migrate/how-to-create-group-machine-dependencies) за более длительный срок.

### <a name="i-am-unable-to-visualize-dependencies-for-groups-with-more-than-10-vms"></a>Можно ли визуализировать зависимости для групп из более чем 10 виртуальных машин?
Вы можете [визуализировать зависимости групп](https://docs.microsoft.com/azure/migrate/how-to-create-group-dependencies), в которых имеется до 10 виртуальных машин. Если в группе более 10 виртуальных машин, рекомендуем разбить ее на более мелкие группы, а после этого приступить к визуализации зависимостей.

### <a name="i-installed-agents-and-used-the-dependency-visualization-to-create-groups-now-post-failover-the-machines-show-install-agent-action-instead-of-view-dependencies"></a>Мной были установлены агенты и созданы группы с помощью визуализации зависимостей. Теперь после отработки отказа на компьютере отображается действие "Установить агент" вместо "Просмотреть зависимости"
* После плановой или внеплановой отработки отказа локальные компьютеры отключаются и запускаются эквивалентные компьютеры в Azure. Эти компьютеры получают другие MAC-адреса. Они могут получить другой IP-адрес, если пользователь не указал сохранение локального IP-адреса. Если MAC-адрес и IP-адрес отличаются, служба "Миграция Azure" не связывает локальные компьютеры с какими-либо данными зависимостей сопоставления служб и предлагает пользователю установить агенты вместо просмотра зависимостей.
* Поле тестовой отработки отказа локальные компьютеры остаются включенными, как ожидается. Каждый эквивалентный компьютер, запускаемый в Azure, получает другой MAC-адрес и может получить другой IP-адрес. Если в блоках пользователя исходящих Azure Monitor журналы трафика с этих компьютеров, "Миграция Azure" не связывает локальные компьютеры с любыми данными зависимостей сопоставления служб и предлагает пользователю установить агенты вместо просмотра зависимостей.

## <a name="troubleshoot-azure-readiness-issues"></a>Устранение проблемы готовности к работе в Azure

**Проблема** | **Исправление**
--- | ---
Неподдерживаемый тип загрузки | Azure не поддерживает виртуальные машины с типом загрузки EFI. Перед миграцией рекомендуем преобразовать тип загрузки в BIOS. <br/><br/>Для переноса таких виртуальных машин можно использовать [Azure Site Recovery](https://docs.microsoft.com/azure/site-recovery/tutorial-migrate-on-premises-to-azure), так как эта служба в процессе миграции преобразует тип загрузки виртуальной машины в BIOS.
Условно поддерживаемая ОС Windows | Закончился срок поддержки ОС. Для [поддержки в Azure](https://aka.ms/WSosstatement) требуется соглашение Custom Support Agreement (CSA). Перед миграцией в Azure обновите ОС.
Неподдерживаемая версия Windows | Azure поддерживает только [определенные версии ОС Windows](https://aka.ms/WSosstatement). Перед миграцией в Azure обновите ОС на компьютере.
Условно поддерживаемая ОС Linux | Azure поддерживает только [определенные версии ОС Linux](../virtual-machines/linux/endorsed-distros.md). Перед миграцией в Azure обновите ОС на компьютере.
Неподдерживаемая ОС Linux | Компьютер может загружаться в Azure, но установленная на нем ОС в Azure не поддерживается. Перед миграцией в Azure замените ОС одной из [поддерживаемых версий Linux](../virtual-machines/linux/endorsed-distros.md).
Неизвестная операционная система | Операционная система виртуальной машины была указана в vCenter Server как "Другая". Поэтому службе "Миграция Azure" не удалось определить готовность виртуальной машины к работе в Azure. Перед переносом компьютера убедитесь, что запущенная на нем операционная система [поддерживается](https://aka.ms/azureoslist) в Azure.
Неподдерживаемая разрядность ОС | Виртуальные машины с 32-разрядной операционной системой могут загружаться в Azure. Но перед миграцией в Azure рекомендуем обновить ОС виртуальной машины с 32-разрядной на 64-разрядную.
Требуется подписка Visual Studio. | На компьютере выполняется клиентская ОС Windows, которая поддерживается только в подписке Visual Studio.
Не удалось найти хранилище с требуемой производительностью. | Производительность хранилища (число операций ввода-вывода и пропускная способность), необходимая для компьютера, превышает возможности поддерживаемых виртуальных машин Azure. Снизьте требования к хранилищу для компьютера перед выполнением миграции.
Не удалось найти виртуальную машину с требуемой производительностью сети. | Производительность сети (скорость входящего и исходящего трафика), необходимая для компьютера, превышает возможности поддерживаемых виртуальных машин Azure. Уменьшите требования к сети для компьютера.
Не удалось найти виртуальную машину в указанном расположении. | Используйте другое целевое расположение, прежде чем выполнять миграцию.
Один или несколько неподходящих дисков. | Один или несколько дисков, подключенных к виртуальной машине, не соответствуют требованиям Azure. Размер каждого диска, присоединенного к виртуальной машине, не должен превышать 4 ТБ. Если ваш диск большего размера, сожмите его перед миграцией в Azure. Убедитесь, что [управляемые диски виртуальной машины](https://docs.microsoft.com/azure/azure-subscription-service-limits#storage-limits) Azure поддерживают производительность (операции ввода-вывода в секунду и пропускную способность), которая требуется для каждого диска.   
Один или несколько неподходящих сетевых адаптеров. | Удалите неиспользуемые сетевые адаптеры с компьютера перед миграцией.
Число дисков превышает ограничение | Удалите неиспользуемые диски с компьютера перед миграцией.
Размер диска превышает ограничение | Azure поддерживает диски размером до 4 ТБ. Уменьшите диски до размера менее 4 ТБ перед выполнением миграции.
Диск недоступен в указанном расположении | Убедитесь, что диск доступен в целевом расположении, прежде чем выполнять миграцию.
Недоступен диск для обеспечения указанной избыточности | Диск должен использовать тип избыточности хранилища, указанный в параметрах оценки (по умолчанию — LRS).
Не удалось определить пригодность диска из-за внутренней ошибки | Попробуйте создать новую оценку для группы.
Виртуальная машина с требуемым числом ядер и объемом памяти не найдена | Службе Azure не удалось найти подходящий тип виртуальной машины. Уменьшите объем памяти и число ядер на локальном компьютере, прежде чем выполнять миграцию.
Не удалось определить пригодность виртуальной машины из-за внутренней ошибки. | Попробуйте создать новую оценку для группы.
Не удалось определить пригодность одного или нескольких дисков из-за внутренней ошибки. | Попробуйте создать новую оценку для группы.
Не удалось определить пригодность одного или нескольких сетевых адаптеров из-за внутренней ошибки. | Попробуйте создать новую оценку для группы.


## <a name="collect-logs"></a>Сбор журналов

**Как собирать журналы на виртуальной машине сборщика?**

Ведение журнала включено по умолчанию. Журналы расположены в следующих папках:

- C:\Profiler\ProfilerEngineDB.sqlite
- C:\Profiler\Service.log
- C:\Profiler\WebApp.log

Чтобы собирать данные трассировки событий Windows, выполните следующее.

1. На виртуальной машине сборщика откройте командное окно PowerShell.
2. Выполните команду **Get-EventLog -LogName Application | export-csv eventlog.csv**.

**Как собирать журналы сетевого трафика на портале?**

1. Откройте браузер, перейдите [к порталу](https://portal.azure.com) и войдите в него.
2. Нажмите клавишу F12, чтобы открыть средства для разработчиков. При необходимости снимите флажок **Clear entries on navigation** (Очищать записи при переходе).
3. Щелкните вкладку **Network** (Сеть) и начните сбор журналов сетевого трафика.
   - В Chrome установите флажок **Preserve log** (Сохранить журнал). Запись должна начаться автоматически. Красный кружок указывает, что данные трафика записываются. Если он не отображается, щелкните черный кружок, чтобы начать запись.
   - В Microsoft Edge или Internet Explorer запись должна начаться автоматически. Если это не так, нажмите зеленую кнопку воспроизведения.
4. Попробуйте воспроизвести ошибку.
5. Если при записи возникла ошибка, остановите запись и сохраните копию записанных действий.
   - В Chrome щелкните запись правой кнопкой мыши и выберите **Save as HAR with content** (Сохранить как HAR-файл с содержимым). Журналы будут заархивированы в формате ZIP и экспортированы в виде HAR-файла.
   - В Microsoft Edge или Internet Explorer щелкните значок **Экспорт собранного трафика**. Журнал будет заархивирован в формате ZIP и экспортирован.
6. Перейдите на вкладку **Консоль**, чтобы проверить наличие предупреждений или ошибок. Чтобы сохранить журнал консоли, сделайте следующее.
   - В Chrome щелкните правой кнопкой мыши в любом месте в журнале консоли. Выберите **Save as** (Сохранить как), чтобы заархивировать журнал в формате ZIP и экспортировать его.
   - В Microsoft Edge или Internet Explorer щелкните правой кнопкой мыши ошибки и выберите **Копировать все**.
7. Закройте средства для разработчиков.

## <a name="collector-error-codes-and-recommended-actions"></a>Коды ошибок сборщика и рекомендуемые действия

| Код ошибки | Имя ошибки   | Сообщение   | Возможные причины | Рекомендуемое действие  |
| --- | --- | --- | --- | --- |
| 601       | CollectorExpired               | Истек срок действия сборщика.                                                        | Срок действия сборщика истек.                                                                                    | Скачайте новую версию сборщика и повторите попытку.                                                                                      |
| 751       | UnableToConnectToServer        | Не удалось подключиться к vCenter Server "%Имя;" из-за ошибки: %Сообщение_об_ошибке;     | Дополнительные сведения приводятся в сообщении об ошибке.                                                             | Устраните указанную проблему и повторите попытку.                                                                                                           |
| 752       | InvalidvCenterEndpoint         | Сервер "%Имя;" не является сервером vCenter Server.                                  | Предоставьте сведения о vCenter Server.                                                                       | Повторите операцию с правильной информацией о vCenter Server.                                                                                   |
| 753       | InvalidLoginCredentials        | Не удалось подключиться к vCenter Server "%Имя;" из-за ошибки: %Сообщение_об_ошибке; | Не удалось подключиться к vCenter Server, так как указаны недействительные учетные данные для входа.                             | Укажите правильные учетные данные для входа.                                                                                    |
| 754       | NoPerfDataAvailable           | Данные о производительности недоступны.                                               | Проверьте уровень статистики в vCenter Server. Чтобы предоставлялись данные производительности, здесь должен быть указан уровень 3. | Установите уровень статистики 3 (на 5 минут, 30 минут или на 2 часа) и повторите попытку примерно через сутки.                   |
| 756       | NullInstanceUUID               | Обнаружен компьютер со значением NULL для InstanceUUID                                  | Возможно, в vCenter Server существует недопустимый объект.                                                      | Устраните указанную проблему и повторите попытку.                                                                                                           |
| 757       | VMNotFound                     | Виртуальная машине не найдена                                                  | Возможно, виртуальная машина %VMID; удалена                                                                | Убедитесь, что в период обнаружения существуют виртуальные машины, выбранные для области vCenter                                      |
| 758       | GetPerfDataTimeout             | Истекло время ожидания запроса VCenter. Сообщение %Сообщение;                                  | Неправильные учетные данные для vCenter Server.                                                              | Проверьте учетные данные vCenter Server и убедитесь, что vCenter Server доступен. Повторите операцию. Если проблема не исчезла, обратитесь в службу поддержки. |
| 759       | VmwareDllNotFound              | Библиотека DLL VMWare.Vim не найдена.                                                     | PowerCLI установлен неправильно.                                                                   | Проверьте, правильно ли установлен PowerCLI. Повторите операцию. Если проблема не исчезла, обратитесь в службу поддержки.                               |
| 800       | ServiceError                   | Служба Сборщика Миграции Azure не запущена.                               | Служба Сборщика Миграции Azure не запущена.                                                       | Примените оснастку services.msc, чтобы запустить эту службу, затем повторите операцию.                                                                             |
| 801       | PowerCLIError                  | Не удалось установить VMware PowerCLI.                                          | Не удалось установить VMware PowerCLI.                                                                  | Повторите операцию. Если проблема повторится, установите службу вручную и повторите операцию.                                                   |
| 802       | TimeSyncError                  | Время не синхронизировано с сервером времени в Интернете.                            | Время не синхронизировано с сервером времени в Интернете.                                                    | Убедитесь, что время на компьютере указано верно с учетом часового пояса, затем повторите операцию.                                 |
| 702       | OMSInvalidProjectKey           | Указан недопустимый ключ проекта.                                                | Указан недопустимый ключ проекта.                                                                        | Повторите операцию с правильным ключом проекта.                                                                                              |
| 703       | OMSHttpRequestException        | Ошибка при отправке запроса. Сообщение %Сообщение;                                | Проверьте идентификатор и ключ проекта, а также убедитесь, что конечная точка доступна.                                       | Повторите операцию. Если проблема будет повторяться, обратитесь в службу поддержки Майкрософт.                                                                     |
| 704       | OMSHttpRequestTimeoutException | Истекло время ожидания запроса HTTP. Сообщение %Сообщение;                                     | Проверьте идентификатор и ключ проекта, а также убедитесь, что конечная точка доступна.                                       | Повторите операцию. Если проблема будет повторяться, обратитесь в службу поддержки Майкрософт.                                                                     |
