---
title: Устранение неполадок в службе "Миграция Azure" | Документация Майкрософт
description: Содержит общие сведения об известных проблемах в службе "миграция Azure", а также советы по устранению распространенных ошибок.
author: rayne-wiselman
ms.service: azure-migrate
ms.topic: conceptual
ms.date: 09/17/2019
ms.author: raynew
ms.openlocfilehash: 49c43d393ef0722424088e0073942b56787f1bc7
ms.sourcegitcommit: f209d0dd13f533aadab8e15ac66389de802c581b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/17/2019
ms.locfileid: "71067808"
---
# <a name="troubleshoot-azure-migrate"></a>Устранение неполадок в службе "Миграция Azure"

Служба " [Миграция Azure](migrate-services-overview.md) " предоставляет центр средств для оценки и миграции, а также предложения независимых поставщиков программного обеспечения (ISV) сторонних разработчиков. Эта статья поможет вам устранить неполадки, связанные с миграцией Azure, оценкой сервера Azure для миграции и миграцией Azure Migration Server.


## <a name="find-a-project"></a>Найти проект

Существует [две версии](https://docs.microsoft.com/azure/migrate/migrate-services-overview#azure-migrate-versions) службы "миграция Azure".


Если вы создали проект "миграция Azure" в текущей версии службы "миграция Azure", выполните следующие действия.

1. В [портал Azure](https://portal.azure.com)выполните поиск по запросу служба " **Миграция Azure**".
2. На панели мониторинга миграция Azure > **серверы**щелкните **изменить** в правом верхнем углу.

    ![Переключение на существующий проект службы "миграция Azure"](./media/troubleshooting-general/switch-project.png)

3. Выберите подходящую подписку и проект "миграция Azure".


Если вы создали проект в предыдущей версии службы "миграция Azure", выполните следующие действия.

1. В [портал Azure](https://portal.azure.com)выполните поиск по запросу служба " **Миграция Azure**".
2. Если вы создали проект в предыдущей версии, на панели мониторинга "миграция Azure" появится баннер, ссылающаяся на старые проекты. Выберите баннер.

    ![Доступ к существующим проектам](./media/troubleshooting-general/access-existing-projects.png)

3. Проверьте список старых проектов.


## <a name="create-additional-projects"></a>Создание дополнительных проектов

Создайте проект службы "миграция Azure", выполнив следующие действия.

1. В [портал Azure](https://portal.azure.com)выполните поиск по запросу служба " **Миграция Azure**".
2. На панели мониторинга миграция Azure > **серверы**щелкните **изменить** в правом верхнем углу.

   ![Изменение проекта службы "миграция Azure"](./media/troubleshooting-general/switch-project.png)

3. Чтобы создать новый проект, выберите **щелкните здесь**.

   ![Создание второго проекта службы "миграция Azure"](./media/troubleshooting-general/create-new-project.png)

## <a name="review-supported-geographies"></a>Проверка поддерживаемых географических регионов

Ознакомьтесь с поддерживаемыми географическими схемами для [VMware](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-vmware#azure-migrate-projects) и [Hyper-V](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-hyper-v#azure-migrate-projects).

## <a name="delete-projectsworkspaces"></a>Удаление проектов и рабочих областей

При удалении проектов "миграция Azure" и Log Analytics рабочих областей Обратите внимание на следующее:

- При удалении проекта службы "миграция Azure" проект *и* метаданные об обнаруженных компьютерах удаляются.
- Если вы подключили рабочую область Log Analytics к средству оценки серверов, Рабочая область не удаляется автоматически.
- Ту же рабочую область Log Analytics можно использовать для нескольких сценариев.
- Если вы хотите удалить рабочую область Log Analytics, это необходимо сделать вручную.


### <a name="delete-a-project"></a>Удаление проекта

Чтобы удалить проект в текущей версии службы "миграция Azure", выполните следующие действия.

1. Откройте группу ресурсов Azure, в которой был создан проект.
2. На странице Группа ресурсов выберите пункт **Показывать скрытые типы**.
3. Выберите проект миграции, который необходимо удалить. Ресурс имеет тип Microsoft. Migrate/мигратепрожектс и удаляет его.

Чтобы удалить проект в более ранней версии службы "миграция Azure", выполните следующие действия.

1. Откройте группу ресурсов Azure, в которой был создан проект.
2. Выберите проект миграции, который необходимо удалить. Тип ресурса — Migration Project и удаляется.


### <a name="delete-a-workspace"></a>Удаление рабочей области

Перейдите к рабочей области Log Analytics, связанной с проектом.
* Если вы еще не удалили проект службы "миграция Azure", ссылка на рабочую область можно найти на странице оценки **Essentials** > **Server**.
       ![Ла Рабочая область](./media/troubleshooting-general/loganalytics-workspace.png)

     * If you've already deleted the Azure Migrate project, select **Resource Groups** in the left pane of the Azure portal. Locate the workspace in the relevant resources group, and [follow the instructions](https://docs.microsoft.com/azure/azure-monitor/platform/delete-workspace) to delete it.


## <a name="error-requests-must-contain-user-identity-headers"></a>Ошибка "запросы должны содержать заголовки удостоверений пользователей"

При создании проекта эта ошибка может означать, что у вас нет доступа к клиенту Azure Active Directory (Azure AD) Организации.

- Когда вы впервые добавите в клиент Azure AD, вы получите по электронной почте приглашение присоединиться к клиенту.
- Примите приглашение, чтобы успешно добавить его в клиент.
    - Если вы не видите сообщение электронной почты, обратитесь к пользователю с правами доступа к клиенту и попросите его [повторно отправить приглашение](https://docs.microsoft.com/azure/active-directory/b2b/add-users-administrator#resend-invitations-to-guest-users) .
    - После получения приглашения по электронной почте откройте его и щелкните ссылку, чтобы принять приглашение. Затем выйдите из портал Azure и войдите снова. (обновление браузера не будет работать.) После этого можно приступить к созданию проекта миграции.


## <a name="error-invalid-ovf-manifest-entry"></a>Ошибка "Недопустимая запись манифеста OVF"

Если появляется сообщение об ошибке "предоставленный файл манифеста недопустим: Недопустимая запись манифеста OVF ", выполните следующие действия:

1. Проверьте, правильно ли загружен файл OVA устройства для миграции Azure, проверив его хэш-значение. [Узнайте больше](https://docs.microsoft.com/azure/migrate/tutorial-assessment-vmware). Если хэш-значение не совпадает, скачайте файл OVA еще раз и повторите попытку развертывания.
2. Если развертывание по-прежнему завершается сбоем и вы используете VMware vSphere клиент для развертывания файла OVF, попробуйте развернуть его с помощью веб-клиента vSphere. Если развертывание по-прежнему завершается сбоем, попробуйте использовать другой веб-браузер.
3. Если вы используете веб-клиент vSphere и пытаетесь развернуть его на vCenter Server 6,5 или 6,7, попробуйте развернуть OVA непосредственно на узле ESXi:
   - Подключитесь к узлу ESXi напрямую (вместо vCenter Server) с помощью веб-клиента (HTTPS://<*IP-адрес узла*>/УИ).
   - В окне **Главная** > **Инвентаризация**выберите **файл** > **развернуть шаблон OVF**. Перейдите к OVA и завершите развертывание.
4. Если развертывание по-прежнему не удается, обратитесь в поддержку службы "Миграция Azure".

## <a name="appliance-cant-connect-to-the-internet"></a>Устройству не удается подключиться к Интернету

Это может произойти, если компьютер устройства находится за прокси-сервером.

- Убедитесь, что вы предоставляете учетные данные для авторизации, если они требуются прокси-серверу.
- Если вы используете прокси-сервер брандмауэра на основе URL-адресов для управления исходящими подключениями, добавьте эти URL-адреса в список разрешений:

    - [URL-адреса для оценки VMware](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-vmware#assessment-url-access-requirements)
    - [URL-адреса для оценки Hyper-V](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-hyper-v#assessment-appliance-url-access)
    - [URL-адреса для миграции без агента VMware](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-vmware#agentless-migration-url-access-requirements)
    - [URL-адреса для миграции на основе агента VMware](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-vmware#replication-appliance-url-access)
    - [URL-адреса для миграции Hyper-V](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-hyper-v#migration-hyper-v-host-url-access)

- Если вы используете перехватчик прокси-сервера для подключения к Интернету, импортируйте сертификат прокси-сервера на виртуальную машину устройства, выполнив [следующие действия](https://docs.microsoft.com/azure/migrate/concepts-collector).

## <a name="errordatetime-synchronization"></a>Ошибка: Синхронизация даты и времени

Ошибка синхронизации даты и времени (802) означает, что часы сервера могут быть не синхронизированы с текущим временем более чем за пять минут. Измените время на виртуальной машине сборщика в соответствии с текущим временем:

1. Откройте командную строку с правами администратора на этой виртуальной машине.
2. Чтобы проверить часовой пояс, выполните команду **w32tm/ТЗ**.
3. Чтобы синхронизировать время, выполните команду **w32tm/resync**.


## <a name="error-unabletoconnecttoserver"></a>Ошибка: UnableToConnectToServer

При возникновении этой ошибки подключения может быть невозможно подключиться к vCenter Server *ServerName*. com: 9443. Сведения об ошибке указывают на то, что конечная точка не прослушивается на https://*ServerName*. com: 9443/SDK, которые могут принимать сообщение.

- Проверьте, используете ли вы последнюю версию устройства. Если вы не используете, обновите устройство до [последней версии](https://docs.microsoft.com/azure/migrate/concepts-collector).
- Если проблема по-прежнему возникает в последней версии, возможно, устройство не сможет разрешить указанное vCenter Server имя, или указанный порт может быть неверным. По умолчанию, если порт не указан, сборщик попытается подключиться к порту номер 443.

    1. Выполните команду ping *ServerName*. com с устройства.
    2. В случае сбоя шага 1 Попробуйте подключиться к серверу vCenter с помощью IP-адреса.
    3. Найдите правильный номер порта для подключения к vCenter Server.
    4. Убедитесь, что vCenter Server работает.


## <a name="error-appliance-might-not-be-registered"></a>Ошибка: Возможно, устройство не зарегистрировано

- Ошибка 60052, "устройство может быть не зарегистрировано в проекте" миграция Azure ", происходит, если учетная запись Azure, используемая для регистрации устройства, имеет недостаточные разрешения.
    - Убедитесь, что учетная запись пользователя Azure, используемая для регистрации устройства, имеет по крайней мере разрешения участника на подписку.
    - Дополнительные [сведения](https://docs.microsoft.com/azure/migrate/migrate-appliance#appliance-deployment-requirements) о необходимых ролях и разрешениях Azure.
- Ошибка 60039, "устройство может быть не зарегистрировано в проекте" миграция Azure ", может произойти, если регистрация завершается неудачей, поскольку не удается найти проект" миграция Azure ", используемый для регистрации устройства.
    - В портал Azure и проверьте, существует ли проект в группе ресурсов.
    - Если проект не существует, создайте новый проект "миграция Azure" в группе ресурсов и снова зарегистрируйте устройство. [Узнайте, как](https://docs.microsoft.com/azure/migrate/how-to-add-tool-first-time#create-a-project-and-add-a-tool) создать новый проект.

## <a name="error-key-vault-management-operation-failed"></a>Ошибка: Сбой операции управления Key Vault

При возникновении ошибки 60030 или 60031 "не удалось выполнить операцию управления Azure Key Vault" выполните следующие действия.
- Убедитесь, что учетная запись пользователя Azure, используемая для регистрации устройства, имеет по крайней мере разрешения участника на подписку.
- Убедитесь, что учетная запись имеет доступ к хранилищу ключей, указанному в сообщении об ошибке, и повторите операцию.
- Если проблема будет повторяться, обратитесь в службу поддержки Майкрософт.
- Дополнительные [сведения](https://docs.microsoft.com/azure/migrate/migrate-appliance#appliance-deployment-requirements) о необходимых ролях и разрешениях Azure.

## <a name="fix-discovery-couldnt-be-initiated"></a>Исправление: Не удалось инициировать обнаружение

Ошибка 60028: "Не удалось инициировать обнаружение из-за ошибки. Сбой операции для указанного списка узлов или кластеров. указывает на то, что не удалось запустить обнаружение на узлах, перечисленных в сообщении об ошибке из-за проблемы при доступе или извлечении сведений о виртуальной машине. Остальные узлы успешно добавлены.

- Снова добавьте узлы, перечисленные в ошибке, с помощью параметра **Добавить узел** .
- При возникновении ошибки проверки ознакомьтесь с руководством по исправлению, чтобы исправить ошибки, а затем повторите попытку **сохранить и запустить обнаружение** .

## <a name="fix-azure-ad-operation-failed-60025"></a>Исправление: Сбой операции Azure AD (60025)

Ошибка 60025: "Не удалось выполнить операцию Azure AD. Произошла ошибка при создании или обновлении приложения Azure AD "", если учетная запись пользователя Azure, используемая для запуска обнаружения, отличается от учетной записи, используемой для регистрации устройства. Выполните одно из следующих действий.

- Убедитесь, что учетная запись пользователя, инициирующая обнаружение, совпадает с той, которая использовалась для регистрации устройства.
- Предоставьте Azure Active Directory разрешения на доступ к учетной записи пользователя, для которой происходит сбой операции обнаружения.
- Удалите группу ресурсов, созданную ранее для проекта службы "миграция Azure". Создайте другую группу ресурсов для повторного запуска.
- Дополнительные [сведения](https://docs.microsoft.com/azure/migrate/migrate-appliance#appliance-deployment-requirements) о Azure Active Directory разрешениях приложения.


## <a name="discovered-vms-not-in-portal"></a>Обнаруженные виртуальные машины, отсутствующие на портале

Если вы запускаете обнаружение, чтобы **в ходе** **оценки сервера** и **миграции сервера** отображалось обнаружение, но на портале еще не отображаются виртуальные машины, обратите внимание на следующее:

- После запуска обнаружения с устройства оно занимает около 15 минут для обнаружения виртуальных машин VMware и около двух минут для каждого добавленного узла для обнаружения виртуальных машин Hyper-V.
- Если вы продолжаете видеть **процесс обнаружения** даже после этих периодов ожидания, выберите **Обновить** на вкладке **серверы** . Должно отобразиться количество обнаруженных серверов в **оценке сервера** и **миграции сервера**.


## <a name="deleted-vms-in-the-portal"></a>Удаленные виртуальные машины на портале

Если вы развернули устройство, которое постоянно обнаруживает локальную среду, но удаленные виртуальные машины по-прежнему отображаются на портале, обратите внимание на следующее:  

- Данные обнаружения, собранные устройством, будут отражены на портале до 30 минут.
- Если вы не видите актуальную информацию через 30 минут, обновите данные, выполнив следующие действия.

    1. На панели **серверы** > **Azure миграция сервера Оценка**выберите **Обзор**.
    2. В разделе **Управление**выберите **работоспособность агентов**
    3. Выберите **Обновить агент**.
    1. Дождитесь завершения операции обновления. Теперь вы должны увидеть актуальные сведения.

## <a name="vm-information-isnt-in-the-portal"></a>Сведения о виртуальной машине отсутствуют на портале

- Данные обнаружения, собранные устройством, будут отражены на портале до 30 минут.
- Если вы не видите актуальную информацию через 30 минут, обновите данные, выполнив следующие действия.

    1. На панели **серверы** > **Azure миграция сервера Оценка**выберите **Обзор**.
    2. В разделе **Управление**выберите **работоспособность агентов**
    3. Выберите **Обновить агент**.
    1. Дождитесь завершения операции обновления. Теперь вы должны увидеть актуальные сведения.


## <a name="fix-cant-connect-to-host-or-cluster"></a>Исправление: Не удается подключиться к узлу или кластеру

Ошибка 50004: "Не удается подключиться к узлу или кластеру, так как не удается разрешить имя сервера. Код ошибки WinRM: 0x803381B9 "может возникнуть, если служба Azure DNS для устройства не может разрешить указанный кластер или имя узла.

- Если вы видите эту ошибку в кластере, полное доменное имя кластера.
- Эта ошибка может также возникать для узлов в кластере. Это означает, что устройство может подключаться к кластеру, но кластер возвращает имена узлов, которые не являются полными доменными именами. Чтобы устранить эту ошибку, обновите файл hosts на устройстве, добавив сопоставление IP-адреса и имени узла:
    1. Откройте Блокнот с правами администратора.
    2. Откройте файл C:\Windows\System32\Drivers\etc\hosts.
    3. Добавьте IP-адрес и имя узла в строку. Повторите эти действия для каждого узла или кластера, где отображается эта ошибка.
    4. Сохраните и закройте файл hosts.
    5. Проверьте, может ли устройство подключаться к узлам с помощью приложения управления устройством. Через 30 минут вы увидите последние сведения об этих узлах в портал Azure.



## <a name="fix-assessment-readiness"></a>Устранение готовности к оценке

Устраните проблемы готовности к оценке, как показано ниже.

**Проблема** | **Исправление**
--- | ---
Неподдерживаемый тип загрузки | Azure не поддерживает виртуальные машины с типом загрузки EFI. Перед выполнением миграции рекомендуется преобразовать тип загрузки в BIOS. <br/><br/>Миграцию таких виртуальных машин можно выполнить с помощью миграции сервера Azure Migration. Во время миграции тип загрузки виртуальной машины будет преобразован в BIOS.
Условно поддерживаемая операционная система Windows | Операционная система прошла дату окончания поддержки, и для [поддержки в Azure](https://aka.ms/WSosstatement)требуется специальное соглашение о поддержке (CSA). Перед миграцией в Azure рассмотрите возможность обновления.
Неподдерживаемая операционная система Windows | Azure поддерживает только [Выбранные версии ОС Windows](https://aka.ms/WSosstatement). Рекомендуется обновить компьютер перед миграцией в Azure.
Условно поддерживаемая ОС Linux | Azure подтверждает только [Выбранные версии ОС Linux](../virtual-machines/linux/endorsed-distros.md). Рекомендуется обновить компьютер перед миграцией в Azure.
Неподдерживаемая ОС Linux | Компьютер может начать работу в Azure, но Azure не поддерживает операционные системы. Перед миграцией в Azure рассмотрите возможность обновления до рекомендованной [версии Linux](../virtual-machines/linux/endorsed-distros.md) .
Неизвестная операционная система | Операционная система виртуальной машины была указана в vCenter Server как "другая". Это поведение блокирует миграцию Azure для проверки готовности виртуальной машины к работе в Azure. Перед переносом компьютера убедитесь, что операционная система [поддерживается](https://aka.ms/azureoslist) Azure.
Неподдерживаемая разрядная версия | Виртуальные машины с 32-разрядными операционными системами могут загружаться в Azure, но перед миграцией в Azure рекомендуется выполнить обновление до 64-разрядной версии.
Требуется подписка Microsoft Visual Studio | Компьютер работает под управлением клиентской операционной системы Windows, которая поддерживается только в рамках подписки Visual Studio.
Не найдена виртуальная машина для требуемой производительности хранилища | Производительность хранилища (операций ввода-вывода в секунду и пропускная способность), необходимая для компьютера, превышает поддержку виртуальной машины Azure. Снизьте требования к хранилищу для компьютера перед выполнением миграции.
Не найдена виртуальная машина для требуемой производительности сети | Производительность сети (скорость входящего и исходящего трафика), необходимая для компьютера, превышает возможности поддерживаемых виртуальных машин Azure. Уменьшите требования к сети для компьютера.
Виртуальная машина не найдена в указанном расположении | Используйте другое целевое расположение, прежде чем выполнять миграцию.
Один или несколько неподходящих дисков | Один или несколько дисков, подключенных к виртуальной машине, не соответствуют требованиям Azure. Конкретного<br/><br/> Миграция Azure Оценка сервера сейчас не поддерживает SSD (цен. категория "Ультра") диски и оценивает диски в соответствии с ограничениями дисков для управляемых дисков уровня "Премиум" (32 ТБ).<br/><br/> Для каждого диска, подключенного к виртуальной машине, убедитесь, что размер диска составляет < 64 ТБ (поддерживается SSD (цен. категория "Ультра") дисками).<br/><br/> Если это не так, сократите размер диска перед миграцией в Azure или используйте несколько дисков в Azure и разработайте [их вместе](https://docs.microsoft.com/azure/virtual-machines/windows/premium-storage-performance#disk-striping) , чтобы получить более высокие ограничения хранилища. Убедитесь, что производительность (операций ввода-вывода и пропускная способность), необходимая для каждого диска, поддерживается [дисками виртуальной машины под управлением](https://docs.microsoft.com/azure/azure-subscription-service-limits#storage-limits)Azure.
Один или несколько неподходящих сетевых адаптеров. | Удалите неиспользуемые сетевые адаптеры с компьютера перед миграцией.
Число дисков превышает ограничение | Удалите неиспользуемые диски с компьютера перед миграцией.
Размер диска превышает ограничение | Миграция Azure Оценка сервера сейчас не поддерживает SSD (цен. категория "Ультра") диски и оценивает диски на основе ограничений на количество дисков категории "Премиум" (32 ТБ).<br/><br/> Однако Azure поддерживает диски размером до 64 ТБ (поддерживается SSD (цен. категория "Ультра") дисков). Сократите диски до 64 ТБ перед миграцией или используйте несколько дисков в Azure и разработайте [их вместе](https://docs.microsoft.com/azure/virtual-machines/windows/premium-storage-performance#disk-striping) , чтобы получить более высокие ограничения хранилища.
Диск недоступен в указанном расположении | Убедитесь, что диск доступен в целевом расположении, прежде чем выполнять миграцию.
Недоступен диск для обеспечения указанной избыточности | Диск должен использовать тип избыточности хранилища, указанный в параметрах оценки (по умолчанию — LRS).
Не удалось определить пригодность диска из-за внутренней ошибки | Попробуйте создать новую оценку для группы.
Виртуальная машина с требуемым числом ядер и объемом памяти не найдена | Azure не удалось найти подходящий тип виртуальной машины. Уменьшите объем памяти и число ядер на локальном компьютере, прежде чем выполнять миграцию.
Не удалось определить пригодность виртуальной машины из-за внутренней ошибки | Попробуйте создать новую оценку для группы.
Не удалось определить пригодность для одного или нескольких дисков из-за внутренней ошибки | Попробуйте создать новую оценку для группы.
Не удалось определить пригодность для одного или нескольких сетевых адаптеров из-за внутренней ошибки | Попробуйте создать новую оценку для группы.

## <a name="linux-vms-are-conditionally-ready"></a>Виртуальные машины Linux называются условно готовыми.

Оценка сервера помечает виртуальные машины Linux как "условно готовые" из-за известного разрыва в оценке сервера.

- Разрыв предотвращает обнаружение дополнительной версии ОС Linux, установленной на локальных виртуальных машинах.
- Например, для RHEL 6,10 в настоящее время Оценка сервера обнаруживает только RHEL 6 в качестве версии ОС.
-  Так как Azure поддерживает только определенные версии Linux, виртуальные машины Linux в настоящее время отмечены как условно готовые к оценке серверов.
- Вы можете определить, будет ли операционная система Linux, работающая на локальной виртуальной машине, одобрена в Azure, просмотрев [поддержку Linux в Azure](https://aka.ms/migrate/selfhost/azureendorseddistros).
-  Убедившись в подтвержденном распространении, можно проигнорировать это предупреждение.

## <a name="azure-skus-exceed-on-premises-sizing"></a>Размер SKU Azure превышает локальное изменение размера

При оценке серверов в службе "миграция Azure" можно рекомендовать номера SKU виртуальных машин Azure с большим количеством ядер и памяти, чем текущее локальное выделение, в зависимости от типа оценки:


- Рекомендации по SKU виртуальной машины зависят от свойств оценки.
- Это зависит от типа оценки, выполняемой при оценке сервера. На *основе производительности*или *в локальной среде*.
- Для оценки на основе производительности в ходе оценки серверов учитываются данные об использовании локальных виртуальных машин (ЦП, памяти, диска и использования сети), чтобы определить правильный номер SKU целевой виртуальной машины для локальных виртуальных машин. Он также добавляет эффективный фактор при определении эффективного использования.
- Для локального изменения размера данные о производительности не учитываются, и рекомендуется использовать целевой номер SKU на основе локального выделения.

Чтобы продемонстрировать, как это может повлиять на рекомендации, давайте рассмотрим пример.

У нас есть локальная виртуальная машина с четырьмя ядрами и восемью ГБ памяти, с 50% использования ЦП и 50% использования памяти и заданным комфортным фактором 1,3.

-  Если оценка является **локальной**, то рекомендуется использовать SKU виртуальной машины Azure с 4 ядрами и 8 ГБ памяти.
- Если оценка основана на производительности, зависит от эффективности использования ЦП и памяти (50% от 4 ядер * 1,3 = 2,6 ядер и 50% от 8 ГБ памяти * 1,3 = 5,3 ГБ памяти), самый дешевый номер SKU для четырех ядер (ближайшее поддерживаемое число ядер) и 8 ГБ памяти (ближайшее поддерживаемое рекомендуется использовать память).
- Дополнительные [сведения](concepts-assessment-calculation.md#sizing) о размере оценки.

## <a name="azure-disk-skus-bigger-than-on-premises"></a>Номера SKU дисков Azure больше, чем в локальной среде

Для оценки серверов в Azure можно использовать более крупный диск в зависимости от типа оценки.
- Размер диска в оценке сервера зависит от двух свойств оценки: критериев изменения размера и типа хранилища.
- Если критерии изменения размера **основаны на производительности**и для типа хранилища задано значение **автоматически**, значения операций ввода-вывода и пропускной способности диска будут учитываться при определении типа целевого диска (HDD (цен. Категория "Стандартный"), SSD (цен. Категория "Стандартный") или Premium). Рекомендуется использовать дисковый номер SKU из типа диска, и в рекомендации учитываются требования к размеру локального диска.
- Если критерии изменения размера **основаны на производительности**, а тип хранилища — **Premium**, рекомендуется использовать номер SKU диска уровня "Премиум" в Azure на основе требований к операциям ввода-вывода, пропускной способности и размеру локального диска. Та же логика используется для создания размера диска, если критерий изменения размера — **локально** , а тип хранилища — **HDD (цен. Категория "Стандартный")** , **SSD (цен. Категория "Стандартный")** или **Premium**.

Например, если у вас есть локальный диск с 32 ГБ памяти, но агрегированные операции чтения и записи для диска составляет 800 операций ввода-вывода, серверная Оценка рекомендует диск уровня "Премиум" (из-за более высоких требований к операциям ввода-вывода), а затем рекомендует номер SKU диска, который может поддерживать r мые операции ввода-вывода и размер. Наиболее подходящий вариант в этом примере будет P15 (256 ГБ и 1100 операций ввода-вывода). Несмотря на то, что размер, необходимый для локального диска, составляет 32 ГБ, при оценке сервера рекомендуется использовать диск большего размера из-за высокого требования к операции ввода-вывода в секунду для локального диска.

## <a name="fix-percentage-of-utilized-core-or-memory-missing"></a>Исправление: Процент используемых ядер или памяти отсутствует

Отчеты об оценке серверов "Перцентажеофкоресутилизедмиссинг" или "Перцентажеофмеморютилизедмиссинг", если устройство для миграции Azure не может выполнять собранные данные о производительности для соответствующих локальных виртуальных машин.

- Это может произойти, если виртуальные машины отключены в течение периода оценки. Устройство не может выполнять собранные данные о производительности для виртуальной машины, если она выключена.
- Если отсутствуют только счетчики памяти и вы пытаетесь оценить виртуальные машины Hyper-V, проверьте, включена ли динамическая память на этих виртуальных машинах. Существует известная ошибка только для виртуальных машин Hyper-V, в которых устройство для миграции Azure не может выполнять получение данных об использовании памяти для виртуальных машин, для которых не включена динамическая память.
- Если какой-либо из счетчиков производительности отсутствует, Оценка сервера Azure для миграции переключается на выделенные ядра и память и рекомендует соответствующий размер виртуальной машины.

## <a name="is-the-vm-os-license-cost-included-in-cost-assessment"></a>Стоимость лицензии ОС виртуальной машины включена в оценку затрат?

Оценка сервера "миграция Azure" в настоящее время учитывает затраты на лицензии операционной системы только для компьютеров Windows. Затраты на лицензии для компьютеров Linux в настоящее время не рассматриваются.

## <a name="performance-history-and-percentile-use"></a>Журнал производительности и использование процентилей

Эти свойства применяются только к изменению размера на основе производительности в службе "Миграция серверов Azure".

Средство оценки серверов непрерывно ведет журнал производительности локальных компьютеров. Эти данные используются для предоставления рекомендаций по выбору номера SKU виртуальной машины и диска в Azure. Эти данные производительности собираются с помощью оценки сервера следующим образом.
- Устройство "миграция Azure" непрерывно проводит локальную среду для сбора данных об использовании в режиме реального времени каждые 20 секунд для виртуальных машин VMware и каждые 30 секунд для виртуальных машин Hyper-V.
- Устройство выполняет сведение 20 или 30-секундных выборок, чтобы создать одну точку данных каждые 10 минут. Чтобы создать одну точку данных, устройство выбирает пиковое значение из 20-секундных и 30-секундных выборок, а затем отправляет их в Azure.
- Когда средство выполняет оценку с учетом периода оценки производительности и значения процентиля журнала производительности, определяется репрезентативный показатель использования. Например, если журнал производительности составляет одну неделю, а использование процентиля — 95 процентиль, то служба "миграция Azure" сортирует все 10-минутные точки выборки за последнюю неделю в возрастающем порядке, а затем выбирает 95 процентиль процентиль в качестве репрезентативного значения.
- Значение 95 процентиль процентиль гарантирует игнорирование любых выбросов, которые могут быть добавлены при выборе 99-м процентиль.
- Если вы хотите выбрать пиковое использование для периода и не хотите пропускать выбросы, следует выбрать 99-м процентиль для использования процентиля.



## <a name="i-cant-find-dependency-visualization-for-azure-government"></a>Не удается найти визуализацию зависимостей для Azure для государственных организаций

Служба "миграция Azure" зависит от Сопоставление служб функции визуализации зависимостей. Так как Сопоставление служб в настоящее время недоступна в Azure для государственных организаций, эта функция недоступна в Azure для государственных организаций.

## <a name="dependencies-dont-show-after-installing-agents"></a>Зависимости не отображаются после установки агентов


После установки агентов визуализации зависимостей на локальных виртуальных машинах для отображения зависимостей на портале Служба "миграция Azure" обычно занимает 15-30 минут. Если вы ожидали более 30 минут, убедитесь, что Microsoft Monitoring Agent (MMA) может подключаться к рабочей области Log Analytics.

Для виртуальных машин Windows:
1. На панели управления запустите MMA.
2. В **свойствах** > Microsoft Monitoring Agent**Azure log Analytics (OMS)** убедитесь, что **состояние** рабочей области — зеленый.
3. Если состояние не является зеленым, попробуйте удалить рабочую область и добавить ее снова в MMA.

      ![Диалоговое окно «Свойства MMA»](./media/troubleshooting-general/mma-status.png)

Для виртуальных машин Linux убедитесь, что команды установки для MMA и агент зависимостей были успешной.

## <a name="supported-mma-os"></a>Поддерживаемая ОС MMA

 Ознакомьтесь с поддерживаемыми операционными системами [Windows](https://docs.microsoft.com/azure/log-analytics/log-analytics-concept-hybrid#supported-windows-operating-systems)и [Linux](https://docs.microsoft.com/azure/log-analytics/log-analytics-concept-hybrid#supported-linux-operating-systems) .

## <a name="supported-dependency-agent-os"></a>Поддерживаемые ОС агента зависимостей

Ознакомьтесь с поддерживаемыми операционными системами [Windows и Linux](../azure-monitor/insights/vminsights-enable-overview.md#supported-operating-systems) .

## <a name="dependencies-for-more-than-an-hour"></a>Зависимости более часа

Хотя служба "миграция Azure" позволяет вернуться к определенной дате в прошлом месяце, максимальная продолжительность, для которой можно визуализировать зависимости, составляет один час.

Например, можно использовать функцию длительности времени в сопоставлении зависимостей для просмотра зависимостей за вчерашний период, но их можно просмотреть только в течение одного часа.

Однако можно использовать журналы Azure Monitor для [запроса данных зависимости](https://docs.microsoft.com/azure/migrate/how-to-create-group-machine-dependencies) в течение более длительного времени.

## <a name="i-cant-visualize-dependencies-for-groups-with-more-than-10-vms"></a>Не удается визуализировать зависимости для групп с более чем 10 виртуальными машинами

С помощью средства "Миграция серверов в Azure" можно [визуализировать зависимости для групп](https://docs.microsoft.com/azure/migrate/how-to-create-group-dependencies) с 10 виртуальными машинами. Для более крупных групп рекомендуется разделить виртуальные машины на более мелкие группы, чтобы визуализировать зависимости.

## <a name="machines-show-install-agent-not-view-dependencies"></a>На компьютерах отображается значение "установить агент", а не "Просмотреть зависимости"

После переноса компьютеров с включенной визуализацией зависимостей в Azure компьютеры могут отображать действие "установить агент" вместо "Просмотр зависимостей" из-за следующего поведения:


- После миграции в Azure локальные компьютеры отключаются, а аналогичные виртуальные машины загружаются в Azure. Эти компьютеры получают другие MAC-адреса.
- Компьютеры могут также иметь разные IP-адреса в зависимости от того, был ли сохранен локальный IP-адрес.
- Если MAC и IP-адреса отличаются от локальных, служба "миграция Azure" не связывает локальные компьютеры с данными зависимостей Сопоставление служб. В этом случае будет показан параметр для установки агента, а не для просмотра зависимостей.
- После выполнения тестовой миграции в Azure локальные компьютеры остаются включенными, как и ожидалось. Аналогичные компьютеры запрашиваются в Azure, получают другой MAC-адрес и могут получать разные IP адреса. Если вы не блокируете исходящий трафик журнала Azure Monitor с этих компьютеров, служба "миграция Azure" не будет связывать локальные компьютеры с данными зависимостей Сопоставление служб, поэтому в этом случае отобразится возможность установки агентов, а не для просмотра зависимостей.


## <a name="collect-network-traffic-logs-in-portal"></a>Получение журналов сетевого трафика на портале

Собирайте журналы следующим образом:

1. Войдите на [портале Azure](https://portal.azure.com).
2. Нажмите клавишу F12, чтобы запустить Средства для разработчиков. При необходимости снимите флажок **Очистить записи в** параметрах навигации.
3. Перейдите на вкладку **сеть** и запустите запись сетевого трафика.
   - В Chrome установите флажок **Preserve log** (Сохранить журнал). Запись должна начаться автоматически. Красный кружок означает, что трафик перехватывается. Если красный круг не отображается, выберите черный круг для начала.
   - В Microsoft ребр и Internet Explorer запись должна запускаться автоматически. Если это не так, нажмите зеленую кнопку воспроизведения.
4. Попробуйте воспроизвести ошибку.
5. Если при записи возникла ошибка, остановите запись и сохраните копию записанных действий.
   - В Chrome щелкните правой кнопкой мыши и выберите **Сохранить как HAR с содержимым**. Это действие сжимает и экспортирует журналы как HAR-файл.
   - В Microsoft ребр или Internet Explorer выберите параметр **экспортировать захваченный трафик** . Это действие сжимает и экспортирует журнал.
6. Перейдите на вкладку **консоль** , чтобы проверить наличие предупреждений или ошибок. Чтобы сохранить журнал консоли, сделайте следующее.
   - В Chrome щелкните правой кнопкой мыши в любом месте в журнале консоли. Выберите **Сохранить как**, экспорт и заархивировать журнал.
   - В Microsoft ребр или Internet Explorer щелкните ошибки правой кнопкой мыши и выберите команду **Копировать все**.
7. Закройте средства для разработчиков.
