---
title: Устранение неполадок в службе "Миграция Azure" | Документация Майкрософт
description: Эта статья содержит обзор известных проблем в службе "Миграция Azure" и советы по устранению распространенных ошибок.
author: rayne-wiselman
ms.service: azure-migrate
ms.topic: conceptual
ms.date: 07/22/2019
ms.author: raynew
ms.openlocfilehash: 15d3809b9a028fd2495c504e9bf19251dd051520
ms.sourcegitcommit: 57a7d4f67635212f5bf0c56e58fd87c8ec366f2c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/22/2019
ms.locfileid: "68372585"
---
# <a name="troubleshoot-azure-migrate"></a>Устранение неполадок в службе "Миграция Azure"

Служба " [Миграция Azure](migrate-services-overview.md) " предоставляет центр средств Майкрософт для оценки и миграции, а также предложения независимых поставщиков программного обеспечения (ISV) сторонних разработчиков. В этом документе содержится справка по устранению ошибок в службе "миграция Azure". Оценка серверов и миграция Azure: Миграции Azure.

## <a name="azure-migrate-project-issues"></a>Проблемы с проектом службы "миграция Azure"

### <a name="i-am-unable-to-find-my-existing-azure-migrate-project"></a>Не удается найти существующий проект службы "миграция Azure".

Существует [две версии](https://docs.microsoft.com/azure/migrate/migrate-services-overview#azure-migrate-versions) службы "миграция Azure". В зависимости от версии, в которой был создан проект, выполните следующие действия, чтобы найти проект:

1. Если вы ищете проект, созданный с помощью версии предыдущей (старый интерфейс) службы "миграция Azure", выполните следующие действия, чтобы найти проект.

    1. Перейдите по адресу [портал Azure](https://portal.azure.com), выполните поиск по запросу " **Миграция Azure**".
    2. На панели мониторинга "миграция Azure" вы увидите баннер, в котором рассказывается о доступе к старым проектам. Этот баннер отображается только в том случае, если вы создали проект со старым интерфейсом. Щелкните баннер.

    ![Доступ к существующим проектам](./media/troubleshooting-general/access-existing-projects.png)

    3. Теперь отобразится список существующих проектов, созданных с помощью предыдущей версии службы "миграция Azure".

2. Если вы ищете проект, созданный с помощью текущей версии (новый интерфейс), выполните следующие действия, чтобы найти проект.

    1. Перейдите по адресу [портал Azure](https://portal.azure.com), выполните поиск по запросу " **Миграция Azure**".
    2. На панели мониторинга миграция Azure перейдите на страницу **серверы** в левой области и выберите **изменить** в правом верхнем углу.

    ![Переключение на существующий проект службы "миграция Azure"](./media/troubleshooting-general/switch-project.png)

    3. Выберите подходящую **подписку** и **выполните миграцию проекта**.

### <a name="i-am-unable-to-create-a-second-azure-migrate-project"></a>Я не могу создать второй проект службы "миграция Azure".

Выполните описанные ниже действия, чтобы создать проект службы "миграция Azure".

1. Перейдите по адресу [портал Azure](https://portal.azure.com), выполните поиск по запросу " **Миграция Azure**".
2. На панели мониторинга миграция Azure перейдите на страницу **серверы** в левой области и выберите **изменить** в правом верхнем углу.

   ![Изменение проекта службы "миграция Azure"](./media/troubleshooting-general/switch-project.png)

3. Чтобы создать новый проект, выберите **щелкните здесь** , как показано на снимке экрана ниже:

   ![Создание второго проекта службы "миграция Azure"](./media/troubleshooting-general/create-new-project.png)

### <a name="which-azure-geographies-are-supported-by-azure-migrate"></a>Какие географические регионы Azure поддерживает служба "Миграция Azure"?

Список для [VMware](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-vmware#azure-migrate-projects) можно найти здесь и для [Hyper-V здесь](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-hyper-v#azure-migrate-projects).

### <a name="deletion-of-azure-migrate-projects-and-associated-log-analytics-workspace"></a>Удаление проектов службы "Миграция Azure" и связанной рабочей области Log Analytics

При удалении проекта службы "миграция Azure" проект миграции удаляется вместе с метаданными об обнаруженных компьютерах. Однако если вы присоединяете рабочую область Log Analytics к средству оценки серверов, она не удаляет автоматически рабочую область Log Analytics. Это обусловлено тем, что одна рабочая область Log Analytics может применяться в нескольких вариантах использования. Если вы также хотите удалить рабочую область Log Analytics, это необходимо сделать вручную.

1. Перейдите к рабочей области Log Analytics, связанной с проектом.
     1. Если вы еще не удалили проект миграции, ссылку на рабочую область можно найти на странице Обзор оценки сервера в разделе Основные компоненты.

     ![Рабочая область LA](./media/troubleshooting-general/loganalytics-workspace.png)

     2. Если вы уже удалили проект миграции, выберите **группы ресурсов** в левой области в портал Azure. Перейдите к группе ресурсов, в которой создана Рабочая область, и перейдите к ней.
2. Следуйте инструкциям из [этой статьи](https://docs.microsoft.com/azure/azure-monitor/platform/delete-workspace), чтобы удалить рабочую область.

### <a name="migration-project-creation-failed-with-error-requests-must-contain-user-identity-headers"></a>Создание проекта миграции завершилось ошибкой *Requests must contain user identity headers* (Запросы должны содержать заголовки удостоверений пользователей)

Эта проблема может произойти для пользователей, у которых нет доступа к клиенту Azure Active Directory (Azure AD) организации. При добавлении пользователя к клиенту Azure AD в первый раз он получает письмо с приглашением присоединиться к клиенту. Для успешного добавления пользователю необходимо открыть письмо и принять приглашение. Если вы не можете просмотреть письмо, обратитесь к пользователю, имеющему доступ к клиенту, и попросите его отправить приглашение, следуя описанным [здесь](https://docs.microsoft.com/azure/active-directory/b2b/add-users-administrator#resend-invitations-to-guest-users) указаниям.

Получив письмо с приглашением, необходимо открыть его и перейти по содержащейся в нем ссылке, чтобы принять это приглашение. После этого необходимо выйти из портал Azure и снова войти в систему, обновление браузера не будет работать. Затем попробуйте создать проект миграции.

## <a name="appliance-issues"></a>Проблемы с устройством

### <a name="deployment-of-azure-migrate-appliance-for-vmware-failed-with-the-error-the-provided-manifest-file-is-invalid-invalid-ovf-manifest-entry"></a>Сбой развертывания устройства миграции Azure для VMware с ошибкой: The provided manifest file is invalid: Invalid OVF manifest entry (Предоставленный файл манифеста является недопустимым: недопустимая запись манифеста OVF).

1. Проверьте, правильно ли загружен файл OVA устройства миграции Azure, проверив его хэш-значение. Проверка хэш-кода описана в [этой статье](https://docs.microsoft.com/azure/migrate/tutorial-assessment-vmware). Если хэш-коды не совпадают, скачайте OVA-файл снова и повторите попытку развертывания.
2. Если проблема не исчезла, а развертывание OVF выполняется с помощью клиента VMware vSphere, попробуйте развернуть его через веб-клиент vSphere. Если проблема так и не исчезла, попробуйте использовать другой браузер.
3. Если вы применяете веб-клиент vSphere для развертывания в vCenter Server 6.5 или 6.7, попробуйте развернуть OVA-файл напрямую на узле ESXi, выполнив описанные ниже действия:
   - Подключитесь непосредственно к узлу ESXi (вместо vCenter Server) с помощью веб-клиента (HTTPS://<*IP-адрес узла*>/УИ).
   - Перейдите на **домашнюю** > **инвентаризацию**.
   - Щелкните **файл** > **развернуть шаблон OVF**. Перейдите к OVA и завершите развертывание.
4. Если развертывание по-прежнему не удается, обратитесь в поддержку службы "Миграция Azure".

### <a name="appliance-is-not-able-to-connect-to-the-internet"></a>Устройство не может подключиться к Интернету

Это может произойти, если используемый компьютер находится за прокси-сервером. Убедитесь, что вы предоставляете учетные данные авторизации, требуемые прокси-сервером.
Если вы используете прокси-сервер брандмауэра на основе URL-адресов для управления исходящими подключениями, обязательно добавьте эти необходимые URL-адреса в список разрешений:

Сценарий | Список URL-адресов
--- | ---
Оценка серверов для VMware | [Здесь](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-vmware#assessment-url-access-requirements)
Оценка сервера для Hyper-V | [Здесь](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-hyper-v#assessment-appliance-url-access)
Миграция сервера для VMware (без агента) | [Здесь](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-vmware#agentless-migration-url-access-requirements)
Миграция сервера VMware (на основе агента) | [Здесь](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-vmware#replication-appliance-url-access)
Миграция сервера для Hyper-V | [Здесь](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-hyper-v#migration-hyper-v-host-url-access)

Если для подключения к Интернету используется перехватчиковый прокси-сервер, необходимо импортировать сертификат прокси-сервера на виртуальную машину устройства. Сертификат прокси-сервера можно импортировать с помощью действий, описанных [здесь](https://docs.microsoft.com/azure/migrate/concepts-collector).

### <a name="error-802-date-and-time-synchronization-error"></a>Ошибка 802. Ошибка синхронизации даты и времени

Часы сервера могут быть не синхронизированы с текущим временем более чем на пять минут. Измените время на виртуальной машине сборщика с соответствии с текущим временем, как показано ниже.

1. Откройте командную строку с правами администратора на этой виртуальной машине.
2. Чтобы проверить часовой пояс, выполните команду w32tm /tz.
3. Чтобы синхронизировать время, выполните команду w32tm /resync.


### <a name="error-unabletoconnecttoserver"></a>Ошибка UnableToConnectToServer

Не удается подключиться к vCenter Server Servername.com:9443 из-за ошибки: There was no endpoint listening at https://Servername.com:9443/sdk that could accept the message (Ни одна конечная точка, которая могла бы принять сообщение, не ожидала передачи данных по адресу https://Servername.com:9443/sdk ).

Проверьте, установлена ли последняя версия устройства сборщика. В противном случае обновите устройство до [последней версии](https://docs.microsoft.com/azure/migrate/concepts-collector).

Если проблема не исчезает в последней версии, это может происходить, если компьютеру сборщика не удается разрешить указанное имя сервера vCenter Server, или если порт указан неправильно. Если порт не указан, сборщик по умолчанию будет пытаться подключиться к порту 443.

1. Попробуйте проверить связь с сайтом Servername.com с компьютера сборщика.
2. Если не удается выполнить шаг 1, попробуйте подключиться к серверу vCenter Server по IP-адресу.
3. Определите правильный номер порта для подключения к серверу vCenter Server.
4. Наконец, проверьте, работает ли сервер vCenter Server.


### <a name="the-appliance-could-not-be-registered-successfully-to-the-azure-migrate-project-error-id-60052"></a>Не удалось успешно зарегистрировать устройство в проекте службы "миграция Azure" (Идентификатор ошибки: 60052)

Эта ошибка вызвана недостаточными разрешениями для учетной записи Azure, используемой для регистрации устройства. Убедитесь, что учетная запись пользователя Azure, используемая для регистрации устройства, имеет по крайней мере права доступа участника в подписке. Дополнительные [сведения](https://docs.microsoft.com/azure/migrate/migrate-appliance#appliance-deployment-requirements) о необходимых ролях и разрешениях Azure.

### <a name="the-appliance-could-not-be-registered-successfully-to-the-azure-migrate-project-error-id-60039"></a>Не удалось успешно зарегистрировать устройство в проекте службы "миграция Azure" (Идентификатор ошибки: 60039)

Проект службы "миграция Azure", выбранный вами для регистрации устройства, не найден, что приводит к сбою регистрации. Перейдите к портал Azure и проверьте, существует ли проект в группе ресурсов. Если проект не существует, создайте новый проект "миграция Azure" в группе ресурсов и снова зарегистрируйте устройство. [Узнайте больше](https://docs.microsoft.com/azure/migrate/how-to-add-tool-first-time#create-a-project-and-add-a-tool) о создании нового проекта службы "миграция Azure".

### <a name="azure-key-vault-management-operation-failed-error-id-60030-60031"></a>Не удалось выполнить операцию управления хранилищем ключей Azure (Идентификатор ошибки: 60030, 60031)

Убедитесь, что учетная запись пользователя Azure, используемая для регистрации устройства, имеет по крайней мере права доступа участника в подписке. Кроме того, проверьте, имеет ли учетная запись доступ к Key Vault, указанным в сообщении об ошибке, и повторите операцию. Если проблема будет повторяться, обратитесь в службу поддержки Майкрософт. Дополнительные [сведения](https://docs.microsoft.com/azure/migrate/migrate-appliance#appliance-deployment-requirements) о необходимых ролях и разрешениях Azure.

### <a name="discovery-could-not-be-initiated-due-to-the-error-the-operation-failed-for-the-given-list-of-hosts-or-clusters-error-id-60028"></a>Не удалось запустить обнаружение из-за ошибки. Не удалось выполнить операцию для заданного списка узлов или кластеров (Идентификатор ошибки: 60028)

Не удалось запустить обнаружение на узлах, перечисленных в ошибке из-за проблемы доступа или извлечения сведений о виртуальной машине. остальные добавленные узлы успешно добавлены. Добавьте в ошибку узлы, используя параметр **Добавить узел** . При возникновении ошибки проверки ознакомьтесь с руководством по исправлению, чтобы исправить ошибки, и повторите попытку **сохранения и повторного запуска обнаружения** .

### <a name="azure-active-directory-aad-operation-failed-the-error-occurred-while-creating-or-updating-the-aad-application-error-id-60025"></a>Сбой операции Azure Active Directory (AAD). Произошла ошибка при создании или обновлении приложения AAD (Идентификатор ошибки: 60025)

Учетная запись пользователя Azure, используемая для регистрации устройства, не имеет доступа к приложению AAD, указанному в сообщении об ошибке. Проверьте, являетесь ли вы владельцем приложения AAD. Дополнительные [сведения](https://docs.microsoft.com/azure/migrate/migrate-appliance#appliance-deployment-requirements) о разрешениях для приложений AAD.


## <a name="discovery-issues"></a>Проблемы с обнаружением

### <a name="i-started-discovery-but-i-dont-see-the-discovered-vms-on-azure-portal-server-assessment-and-server-migration-tiles-show-a-status-of-discovery-in-progress"></a>Я начал обнаружение, но не вижу обнаруженные виртуальные машины на портал Azure. Плитки «Оценка сервера» и «миграция сервера» показывают состояние «Обнаружение выполняется».
После запуска обнаружения с устройства подождите некоторое время, чтобы обнаруженные компьютеры отображались на портал Azure. Для обнаружения VMware требуется около 15 минут и около 2 минут на каждый добавленный узел для обнаружения Hyper-V. Если вы продолжаете видеть "выполняется обнаружение" даже после этого, нажмите кнопку **Обновить** на вкладке **серверы** . Должно отобразиться количество обнаруженных серверов на плитках "Оценка сервера" и "миграция сервера".


### <a name="i-am-using-the-appliance-that-continuously-discovers-my-on-premises-environment-but-the-vms-that-are-deleted-in-my-on-premises-environment-are-still-being-shown-in-the-portal"></a>Я использую устройство, которое постоянно обнаруживает мою локальную среду, но виртуальные машины, удаленные в моей локальной среде, по-прежнему отображаются на портале.

Данные обнаружения, собранные устройством для отражения на портале, занимают до 30 минут. Если вы не видите актуальную информацию даже через 30 минут, выполните обновление данных, выполнив следующие действия.

1. В списке Серверы > службе "миграция Azure": Оценка сервера щелкните **Обзор**.
2. В разделе " **Управление**" щелкните **работоспособность агентов**
3. Щелкните параметр, чтобы **Обновить агент**. Вы увидите этот параметр ниже списка агентов.
4. Дождитесь завершения операции обновления. Убедитесь, что вы можете просматривать актуальные сведения о виртуальных машинах.

### <a name="i-dont-the-latest-information-on-the-on-premise-vms-on-the-portal"></a>На портале не находятся последние сведения о локальных виртуальных машинах

Данные обнаружения, собранные устройством для отражения на портале, занимают до 30 минут. Если вы не видите актуальную информацию даже через 30 минут, выполните обновление данных, выполнив следующие действия.

1. В списке Серверы > службе "миграция Azure": Оценка сервера щелкните **Обзор**.
2. В разделе " **Управление**" щелкните **работоспособность агентов**
3. Щелкните параметр, чтобы **Обновить агент**. Этот параметр отображается под списком агентов.
4. Дождитесь завершения операции обновления. Теперь вы должны увидеть актуальные сведения о виртуальных машинах.

### <a name="unable-to-connect-to-hosts-or-cluster-as-the-server-name-cannot-be-resolved-winrm-error-code-0x803381b9-error-id-50004"></a>Не удалось подключиться к узлам или кластеру, так как не удается разрешить имя сервера. Код ошибки WinRM: 0x803381B9 (Идентификатор ошибки: 50004)
Эта ошибка возникает, если DNS-сервер, обслуживающий устройство, не может разрешить указанный кластер или имя узла. Если вы видите эту ошибку в кластере, попробуйте указать полное доменное имя кластера.

Эта ошибка может также возникать для узлов в кластере. В этом случае устройство может подключиться к кластеру. Но кластер вернул имена узлов, которые не являются полными доменными именами.

Чтобы устранить эту ошибку, обновите файл hosts на устройстве, добавив сопоставление IP-адреса и имен узлов.
1. Откройте Блокнот от имени администратора. Откройте файл C:\Windows\System32\Drivers\etc\hosts.
2. Добавьте IP-адрес и имя узла в строку. Повторите эти действия для каждого узла или кластера, где отображается эта ошибка.
3. Сохраните и закройте файл hosts.
4. Вы можете проверить, может ли устройство подключаться к узлам с помощью приложения управления устройством. Через 30 минут вы сможете просмотреть последние сведения об этих узлах на портал Azure.


## <a name="assessment-issues"></a>Ошибки оценки

### <a name="azure-readiness-issues"></a>Проблемы готовности к работе в Azure

Проблемы | Исправление
--- | ---
Неподдерживаемый тип загрузки | Azure не поддерживает виртуальные машины с типом загрузки EFI. Перед выполнением миграции рекомендуется преобразовать тип загрузки в BIOS. <br/><br/>Вы можете использовать миграцию сервера Azure Migration для миграции таких виртуальных машин, так как она преобразует тип загрузки виртуальной машины в BIOS во время миграции.
Условно поддерживаемая ОС Windows | Закончился срок поддержки ОС. Для [поддержки в Azure](https://aka.ms/WSosstatement) требуется соглашение Custom Support Agreement (CSA). Перед миграцией в Azure обновите ОС.
Неподдерживаемая версия Windows | Azure поддерживает только [определенные версии ОС Windows](https://aka.ms/WSosstatement). Перед миграцией в Azure обновите ОС на компьютере.
Условно поддерживаемая ОС Linux | Azure поддерживает только [определенные версии ОС Linux](../virtual-machines/linux/endorsed-distros.md). Перед миграцией в Azure обновите ОС на компьютере.
Неподдерживаемая ОС Linux | Компьютер может загружаться в Azure, но установленная на нем ОС в Azure не поддерживается. Перед миграцией в Azure замените ОС одной из [поддерживаемых версий Linux](../virtual-machines/linux/endorsed-distros.md).
Неизвестная операционная система | Операционная система виртуальной машины была указана в vCenter Server как "Другая". Поэтому службе "Миграция Azure" не удалось определить готовность виртуальной машины к работе в Azure. Перед переносом компьютера убедитесь, что запущенная на нем операционная система [поддерживается](https://aka.ms/azureoslist) в Azure.
Неподдерживаемая разрядность ОС | Виртуальные машины с 32-разрядной операционной системой могут загружаться в Azure. Но перед миграцией в Azure рекомендуем обновить ОС виртуальной машины с 32-разрядной на 64-разрядную.
Требуется подписка Visual Studio. | На компьютере выполняется клиентская ОС Windows, которая поддерживается только в рамках подписки Visual Studio.
Не удалось найти хранилище с требуемой производительностью. | Производительность хранилища (число операций ввода-вывода и пропускная способность), необходимая для компьютера, превышает возможности поддерживаемых виртуальных машин Azure. Снизьте требования к хранилищу для компьютера перед выполнением миграции.
Не удалось найти виртуальную машину с требуемой производительностью сети. | Производительность сети (скорость входящего и исходящего трафика), необходимая для компьютера, превышает возможности поддерживаемых виртуальных машин Azure. Уменьшите требования к сети для компьютера.
Не удалось найти виртуальную машину в указанном расположении. | Используйте другое целевое расположение, прежде чем выполнять миграцию.
Один или несколько неподходящих дисков. | Один или несколько дисков, подключенных к виртуальной машине, не соответствуют требованиям Azure. Размер каждого диска, присоединенного к виртуальной машине, не должен превышать 4 ТБ. Если ваш диск большего размера, сожмите его перед миграцией в Azure. Убедитесь, что [управляемые диски виртуальной машины](https://docs.microsoft.com/azure/azure-subscription-service-limits#storage-limits) Azure поддерживают производительность (операции ввода-вывода в секунду и пропускную способность), которая требуется для каждого диска.   
Один или несколько неподходящих сетевых адаптеров. | Удалите неиспользуемые сетевые адаптеры с компьютера перед миграцией.
Число дисков превышает ограничение | Удалите неиспользуемые диски с компьютера перед миграцией.
Размер диска превышает ограничение | Azure поддерживает диски размером до 4 ТБ. Уменьшите диски до размера менее 4 ТБ перед выполнением миграции.
Диск недоступен в указанном расположении | Убедитесь, что диск доступен в целевом расположении, прежде чем выполнять миграцию.
Недоступен диск для обеспечения указанной избыточности | Диск должен использовать тип избыточности хранилища, указанный в параметрах оценки (по умолчанию — LRS).
Не удалось определить пригодность диска из-за внутренней ошибки | Попробуйте создать новую оценку для группы.
Виртуальная машина с требуемым числом ядер и объемом памяти не найдена | Службе Azure не удалось найти подходящий тип виртуальной машины. Уменьшите объем памяти и число ядер на локальном компьютере, прежде чем выполнять миграцию.
Не удалось определить пригодность виртуальной машины из-за внутренней ошибки. | Попробуйте создать новую оценку для группы.
Не удалось определить пригодность одного или нескольких дисков из-за внутренней ошибки. | Попробуйте создать новую оценку для группы.
Не удалось определить пригодность одного или нескольких сетевых адаптеров из-за внутренней ошибки. | Попробуйте создать новую оценку для группы.

### <a name="i-am-unable-to-specify-enterprise-agreement-ea-as-an-azure-offer-in-the-assessment-properties"></a>Не удается указать Соглашение Enterprise (EA) в качестве предложения Azure в свойствах оценки?
Миграция Azure Миграции Azure сейчас не поддерживает ценовые предложения на основе Соглашения Enterprise. Но вы можете использовать предложение Azure с оплатой по мере использования и свойство Discount, чтобы определить все пользовательские скидки, которые вы получите. См. подробнее о [настройке оценки](https://aka.ms/migrate/selfhelp/eapricing).

### <a name="why-does-server-assessment-mark-my-linux-vms-conditionally-ready-is-there-anything-i-need-to-do-to-fix-this"></a>Почему Оценка сервера помечает мои виртуальные машины Linux как условно подготовленные. Что мне нужно сделать для решения этой проблемы?
В средстве оценки серверов есть известная проблема с определением дополнительной версии ОС Linux, установленной на локальных виртуальных машинах (например, для RHEL 6.10 это средство определяет только версию RHEL 6). Так как Azure поддерживает только некоторые версии Linux, виртуальные машины Linux сейчас определяются средством оценки серверов как условно готовые. Вы можете вручную убедиться, что операционная система Linux, работающая на локальной виртуальной машине, одобрена в Azure, просмотрев документацию по [поддержке Linux в Azure.](https://aka.ms/migrate/selfhost/azureendorseddistros) Если дистрибутив поддерживается, это предупреждение можно игнорировать.

### <a name="the-vm-sku-recommended-by-server-assessment-has-more-number-of-cores-and-a-larger-memory-size-than-what-is-allocated-on-premises-why-is-that-so"></a>Номер SKU виртуальной машины, рекомендуемый для оценки серверов, превышает число ядер и больший объем памяти, чем объем, выделенный в локальной среде. Почему это так?
Рекомендация средства оценки серверов в отношении номера SKU виртуальной машины зависит от свойств оценки. Средство поддерживает два типа оценки: на основе производительности и локального использования. Для оценки на основе производительности в ходе оценки серверов учитываются данные об использовании локальных виртуальных машин (ЦП, памяти, диска и использования сети), чтобы определить правильный номер SKU целевой виртуальной машины для локальных виртуальных машин. Кроме того, при выборе размера на основе производительности учитывается фактор комфорта для определения фактического использования. При использовании второго типа оценки данные о производительности не учитываются, и рекомендация по целевому номеру SKU предоставляется на основе ресурсов, выделенных для локального использования.

Например, предположим, что существует локальная виртуальная машина с 4 ядрами и 8 ГБ памяти с 50% использования ЦП и 50% использования памяти, а в ходе оценки указывается отличный фактор 1,3. Если критерий определения размера для оценки — "как локальная", используется номер SKU виртуальной машины Azure с 4 ядрами и 8 ГБ памяти, однако, если критерий изменения размера зависит от эффективности использования ЦП и памяти (50% от 4 ядер * 1,3 = 2,6 ядер и 50% от 8 ГБ) память * 1,3 = 5,3-ГБ памяти), рекомендуется использовать самый дешевый номер SKU виртуальных машин из четырех ядер (ближайшее поддерживаемое число ядер) и 8 ГБ памяти (ближайший поддерживаемый объем памяти). См. подробнее об [определении размера средством оценки серверов](https://docs.microsoft.com/azure/migrate/concepts-assessment-calculation#sizing).

### <a name="the-disk-sku-recommended-by-server-assessment-has-a-bigger-size-than-what-is-allocated-on-premises-why-is-that-so"></a>Номер SKU диска, рекомендуемый для оценки сервера, превышает размер, выделенный в локальной среде. Почему это так?
Выбор размера диска средством оценки серверов зависит от двух свойств оценки — условия определения размера и типа хранилища. Если для критерия изменения размера задано значение "Автоматический", то значения операций ввода-вывода и пропускной способности диска будут считаться типом целевого диска (HDD (цен. категория "Стандартный"), SSD (цен. категория "Стандартный") или дисков уровня "Премиум"). Затем для целевого типа диска предоставляется рекомендация в отношении номера SKU с учетом потребностей в размере локального диска. Если в качестве критерия изменения размера выбран тип "Премиум", то рекомендуется использовать номер SKU диска уровня "Премиум" в Azure на основе требований к операциям ввода-вывода, пропускной способности и размеру локального диска. Та же логика применяется при выборе размера диска, когда условие определения размера основано на локальных характеристиках и задан тип хранилища HDD (цен. категория "Стандартный"), SSD (цен. категория "Стандартный" или "Премиум").

Например, если имеется локальный диск с объемом памяти 32 ГБ, а суммарные операции чтения и записи для диска составляет 800 операций ввода-вывода, то при оценке сервера будет рекомендован тип диска уровня "Премиум" (из-за более высоких требований к операциям ввода/вывода), а затем рекомендуется использовать номер SKU диска, поддерживающий требуемые операции ввода-вывода и размер. Наиболее подходящий вариант в этом примере будет P15 (256 ГБ и 1100 операций ввода-вывода). Таким образом, хотя размер, требуемый диском категории "Премиум", составлял 32 ГБ, средство оценки серверов рекомендовало использовать больший размер из-за более высоких требований к числу операций ввода-вывода для локального диска.

### <a name="why-does-my-assessment-report-say-percentageofcoresutilizedmissing-or-percentageofmemoryutilizedmissing-for-some-vms"></a>Почему отчет об оценке содержит "Перцентажеофкоресутилизедмиссинг" или "Перцентажеофмеморютилизедмиссинг" для некоторых виртуальных машин?
Описанные выше проблемы перечислены в тех случаях, когда устройству миграции Azure не удается выполнить репликацию данных о производительности для локальных виртуальных машин. Это может произойти, если виртуальные машины будут отключены на время, в течение которого вы создаете оценку (последний день/одна неделя/месяц), так как устройство не может сосчитать данные о производительности виртуальной машины, когда она выключена. Если отсутствуют только счетчики памяти и вы пытаетесь оценить виртуальные машины Hyper-V, проверьте, включена ли динамическая память на этих виртуальных машинах. В настоящее время существует известная ситуация, из-за которой устройство, выполняющее миграцию Azure, не может получить сведения об использовании памяти для виртуальных машин, для которых не включена динамическая память. Обратите внимание, что эта ошибка возникает только для виртуальных машин Hyper-V, а не для виртуальных машин VMware. Если какой либо счетчик производительности отсутствует, служба "миграция Azure" выполняет следующие действия: Оценка сервера возвращается к выделенным ядрам и памяти и рекомендуется соответственно размеру виртуальной машины.

### <a name="is-the-os-license-cost-of-the-vm-included-in-the-compute-cost-estimated-by-server-assessment"></a>Стоимость лицензии ОС виртуальной машины, включенной в стоимость вычислений, оцененная оценкой сервера?
Сейчас средство оценки серверов учитывает только стоимость лицензии на ОС для компьютеров Windows, но не стоимость лицензии на ОС для компьютеров Linux.

### <a name="what-impact-does-performance-history-and-percentile-utilization-have-on-the-size-recommendations"></a>Как данные журнала производительности и процент использования влияют на рекомендации по размеру?
Эти свойства применимы только при выборе размера на основе производительности. Средство оценки серверов непрерывно ведет журнал производительности локальных компьютеров. Эти данные используются для предоставления рекомендаций по выбору номера SKU виртуальной машины и диска в Azure. Ниже описано, как средство оценки серверов собирает данные о производительности.
- Устройство "миграция Azure" непрерывно проводит локальную среду для сбора данных об использовании в режиме реального времени каждые 20 секунд для виртуальных машин VMware и каждые 30 секунд для виртуальных машин Hyper-V.
- Устройство сводит полученные выборки и создает одну точку данных каждые 10 минут. Чтобы создать одну точку данных, устройство выбирает пиковое значение из всех выборок и отправляет его в Azure.
- Когда средство выполняет оценку с учетом периода оценки производительности и значения процентиля журнала производительности, определяется репрезентативный показатель использования. Например, если журнал производительности составляет одну неделю, а использование процентиля — 95 процентиль, то служба "миграция Azure" будет сортировать все 10-минутные точки выборки за последнюю неделю в возрастающем порядке, а затем выбрать 95 процентиль процентиль в качестве репрезентативного значения.
Это значение гарантирует игнорирование выбросов, которые могут присутствовать при выборе 99-го процентиля. Если вам нужно выбрать пиковое использование для указанного периода и вы не хотите пропускать выбросы, выберите 99-й процентиль.

## <a name="dependency-visualization-issues"></a>Неполадки с визуализацией зависимостей

### <a name="i-am-unable-to-find-the-dependency-visualization-functionality-for-azure-government-projects"></a>Я не могу найти возможности визуализации зависимостей для проектов Azure для государственных организаций.

Возможность визуализации зависимостей в службе "Миграция Azure" зависит от решения "Сопоставление служб", и, так как данное решение в настоящее время недоступно в Azure для государственных организаций, эта возможность также недоступна.

### <a name="i-installed-the-microsoft-monitoring-agent-mma-and-the-dependency-agent-on-my-on-premises-vms-but-the-dependencies-are-now-showing-up-in-the-azure-migrate-portal"></a>На локальные виртуальные машины установлены Microsoft Monitoring Agent (MMA) и агент зависимостей, однако зависимости не отображаются на портале службы "Миграция Azure".

После того как в системе будут установлены агенты, службе "Миграция Azure" обычно требуется 15–30 минут, чтобы отобразить зависимости на портале. Если прошло более 30 минут, убедитесь, что агент MMA может обмениваться данными с рабочей областью OMS, выполнив следующие действия:

Для виртуальной машины Windows:
1. Перейдите в **Панель управления** и запустите **Microsoft Monitoring Agent**.
2. Перейдите на вкладку **Azure log Analytics (OMS)** во всплывающем окне свойств MMA.
3. Убедитесь, что **состояние** рабочей области отображается зеленым цветом.
4. Если состояние не зеленое, попробуйте удалить рабочую область и снова добавить ее в MMA.
        ![Состояние MMA](./media/troubleshooting-general/mma-status.png)

Для виртуальной машины Linux убедитесь, что команды установки для MMA и агента зависимостей были выполнены успешно.

### <a name="what-are-the-operating-systems-supported-by-mma"></a>Какие операционные системы поддерживаются агентом MMA?

Список операционных систем Windows, поддерживаемых MMA, см. в [этой статье](https://docs.microsoft.com/azure/log-analytics/log-analytics-concept-hybrid#supported-windows-operating-systems).
Список операционных систем Linux, поддерживаемых MMA, см. в [этой статье](https://docs.microsoft.com/azure/log-analytics/log-analytics-concept-hybrid#supported-linux-operating-systems).

### <a name="what-are-the-operating-systems-supported-by-dependency-agent"></a>Какие операционные системы поддерживаются агентом зависимостей?

Список операционных систем Windows, поддерживаемых агентом зависимостей, см. в [этой статье](https://docs.microsoft.com/azure/monitoring/monitoring-service-map-configure#supported-windows-operating-systems).
Список операционных систем Linux, поддерживаемых агентом зависимостей, см. в [этой статье](https://docs.microsoft.com/azure/monitoring/monitoring-service-map-configure#supported-linux-operating-systems).

### <a name="i-am-unable-to-visualize-dependencies-in-azure-migrate-for-more-than-one-hour-duration"></a>В службе "Миграция Azure" нельзя визуализировать зависимости за период свыше одного часа?
В службе "Миграция Azure" можно визуализировать зависимости за период не больше одного часа. Хотя служба "Миграция Azure" позволяет вернуться к определенной дате в журнале за последний месяц, максимальный период, для которого можно визуализировать зависимости, составляет не более 1 часа. Например, вы можете использовать функцию периода времени на карте зависимостей, чтобы просмотреть вчерашние зависимости, однако просматривать их можно только для периода времени в один час. Однако можно использовать журналы Azure Monitor для [запроса данных зависимости](https://docs.microsoft.com/azure/migrate/how-to-create-group-machine-dependencies) в течение более длительного времени.

### <a name="i-am-unable-to-visualize-dependencies-for-groups-with-more-than-10-vms"></a>Можно ли визуализировать зависимости для групп из более чем 10 виртуальных машин?
Вы можете [визуализировать зависимости групп](https://docs.microsoft.com/azure/migrate/how-to-create-group-dependencies), в которых имеется до 10 виртуальных машин. Если в группе более 10 виртуальных машин, рекомендуем разбить ее на более мелкие группы, а после этого приступить к визуализации зависимостей.

### <a name="i-installed-agents-and-used-the-dependency-visualization-to-create-groups-now-post-failover-the-machines-show-install-agent-action-instead-of-view-dependencies"></a>Мной были установлены агенты и созданы группы с помощью визуализации зависимостей. Теперь после отработки отказа на компьютере отображается действие "Установить агент" вместо "Просмотреть зависимости"
* После плановой или внеплановой отработки отказа локальные компьютеры отключаются и запускаются эквивалентные компьютеры в Azure. Эти компьютеры получают другие MAC-адреса. Они могут получить другой IP-адрес, если пользователь не указал сохранение локального IP-адреса. Если MAC-адрес и IP-адрес отличаются, служба "Миграция Azure" не связывает локальные компьютеры с какими-либо данными зависимостей сопоставления служб и предлагает пользователю установить агенты вместо просмотра зависимостей.
* Поле тестовой отработки отказа локальные компьютеры остаются включенными, как ожидается. Каждый эквивалентный компьютер, запускаемый в Azure, получает другой MAC-адрес и может получить другой IP-адрес. Если пользователь не блокирует исходящие Azure Monitor записывает трафик с этих компьютеров, служба "миграция Azure" не связывает локальные компьютеры с данными зависимостей Сопоставление служб и запрашивает у пользователя установку агентов вместо просмотра зависимостей.

## <a name="collect-azure-portal-logs"></a>Получение журналов портал Azure

**Разделы справки собирайте журналы сетевого трафика портал Azure?**

1. Откройте браузер и перейдите на портал и войдите в [него](https://portal.azure.com).
2. Нажмите клавишу F12, чтобы открыть средства для разработчиков. При необходимости снимите флажок **Clear entries on navigation** (Очищать записи при переходе).
3. Щелкните вкладку **Network** (Сеть) и начните сбор журналов сетевого трафика.
   - В Chrome установите флажок **Preserve log** (Сохранить журнал). Запись должна начаться автоматически. Красный кружок указывает, что данные трафика записываются. Если он не отображается, щелкните черный круг, чтобы начать.
   - В Microsoft Edge или Internet Explorer запись должна начаться автоматически. Если это не так, нажмите зеленую кнопку воспроизведения.
4. Попробуйте воспроизвести ошибку.
5. Если при записи возникла ошибка, остановите запись и сохраните копию записанных действий.
   - В Chrome щелкните запись правой кнопкой мыши и выберите **Save as HAR with content** (Сохранить как HAR-файл с содержимым). Это сжимает и экспортирует журналы как HAR-файл.
   - В Microsoft Edge или Internet Explorer щелкните значок **Экспорт собранного трафика**. Это сжимает и экспортирует журнал.
6. Перейдите на вкладку **Консоль**, чтобы проверить наличие предупреждений или ошибок. Чтобы сохранить журнал консоли, сделайте следующее.
   - В Chrome щелкните правой кнопкой мыши в любом месте в журнале консоли. Выберите **Сохранить как**, экспорт и заархивировать журнал.
   - В Microsoft Edge или Internet Explorer щелкните правой кнопкой мыши ошибки и выберите **Копировать все**.
7. Закройте средства для разработчиков.
