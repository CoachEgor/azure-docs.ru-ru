---
title: Архитектура Azure служба "Миграция" | Документация Майкрософт
description: Обзор службы "Миграция Azure".
author: rayne-wiselman
ms.service: azure-migrate
ms.topic: conceptual
ms.date: 07/01/2019
ms.author: raynew
ms.openlocfilehash: 16fbf8d3523ac2ab36447aa51a93a0bb5a9fad54
ms.sourcegitcommit: 47ce9ac1eb1561810b8e4242c45127f7b4a4aa1a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2019
ms.locfileid: "67811431"
---
# <a name="azure-migrate-architecture-and-processes"></a>Azure служба "Миграция" Архитектура и процессы

[Служба "Миграция Azure"](migrate-overview.md) представляет собой центр для средств, которые помогают обнаруживать, оценивать и перенос приложений, инфраструктуры и рабочих нагрузок в Microsoft Azure. Концентратор включает "Миграция Azure" Инструменты и независимые поставщики независимых стороннего программного обеспечения. 

 В этой статье перечислены оценки и миграции архитектуру и процессы, для оценки сервера миграции Azure, а также миграция сервера миграции Azure.

## <a name="assessment-with-azure-migrate-server-assessment"></a>Оценка с использованием Azure перенести оценки Server

Azure оценки миграции сервера можно оценить виртуальных машин Hyper-V и виртуальных машин VMware для миграции в Azure. Оценка работает следующим образом:

1. **Подготовка к оценке**: В локальной настройкой упрощенный "Миграция Azure" устройства в локальной как виртуальных Машин VMware или Hyper-V и регистрация устройства с "Миграция Azure".
2. **Обнаружение виртуальных машин**: Модуль "Миграция Azure" выполняется для обнаружения локальных виртуальных машин. 
    - Ничего не должен быть установлен на обнаруженных виртуальных машинах.
    - Метаданные виртуальной Машины включает в себя сведения о ядер, память, диски, размеры дисков и сетевых адаптеров.
    - Данные о производительности включает в себя информацию о ЦП и памяти, использование операций ввода-ВЫВОДА, пропускная способность дисков (Мбит/с), на диске и сети выходных данных (Мбит/с)
- **Соберите и оценить готовность компьютеров**: В Azure, когда обнаружение завершится, портала, которые можно собрать обнаруженные виртуальные машины в группы, которые обычно состоят из виртуальных машин, которые вы хотите мигрировать друг с другом. Выполнять оценку для группы.


## <a name="vmware-assessment"></a>Оценка VMware 

На схеме показаны принцип оценки виртуальных Машин VMware с помощью оценки сервера миграции Azure.

![Архитектура оценки VMware](./media/migrate-architecture/sas-architecture-vmware.png)

Процесс таков:

1. **Развертывание устройства "Миграция Azure"** :

    1\. Загрузите шаблон (OVA) на портале Azure.

    2\. Импортируйте его к компьютеру сервера vCenter, создайте виртуальную Машину.

    В. Подключение к этой виртуальной Машины, Настройка основных параметров для него и зарегистрировать его с помощью "Миграция Azure".

2. **Запуск обнаружения**:

    1\. Подключиться к сборщику приложение, работающее на устройстве, чтобы начать обнаружение.

    2\. Модуль постоянно отправляет метаданные и данные производительности с виртуальных машин в Azure.

    - Модуль всегда подключен к службе "Миграция Azure".
    - Изменения среды во время непрерывного обнаружения регистрируются. Например добавление виртуальных машин в области обнаружения или дисков виртуальной Машины или сетевых адаптеров.

3. **Оценить готовность компьютеров**:

    1\. В Azure, когда обнаружение завершится, портала, которые можно собрать обнаруженные виртуальные машины в группы.  Группы обычно состоит из виртуальных машин, которые вы хотите мигрировать друг с другом.

    2\. Выполните оценку для каждой группы.

4. **Просмотрите оценки**: 

    1\. По завершении оценки просмотрите его на портале.

    2\. Для дальнейшего анализа скачивание средства для оценки в формате Excel.



### <a name="vmware-ports"></a>Порты VMware
Служба "Миграция Azure" использует следующие порты подключения для VMware:

**Source** | **Цель** | **Порт** | **Сведения**
--- | --- | --- | ---
Устройство Azure служба "Миграция" | со службой Миграция Azure | Target-TCP 443 | Отправьте метаданные и данные производительности для "Миграция Azure".
Устройство Azure служба "Миграция" | с сервером vCenter | Target-TCP 443 | Подключиться к vCenter Server для метаданных и данные производительности. 443 по умолчанию, но можно изменить при помощи vCenter прослушивает другой порт. 
Клиент RDP | Устройство Azure служба "Миграция" | Target-TCP3389 | RDP-подключение обнаружения триггера из устройства.

### <a name="collected-vmware-metadata"></a>Собранные метаданные VMware

Устройство отправляет метаданные и данные, связанные с производительностью из виртуальных машин Azure.

**Действие** | **Сведения**
--- | ---
**Собранные метаданные** | имя виртуальной Машины vCenter<br/> путь к виртуальной Машине vCenter (папка узлом и кластером)<br/> IP-адрес и MAC-адреса<br/> Операционная система<br/> Число ядер/дисков и сетевых адаптеров<br/> Размер памяти и диска.
**Собранные данные о производительности** | Использование ЦП и памяти<br/> На диске данных (скорость чтения/записи диска; операций чтения и записи диска в секунду)<br/> Данные сетевой Адаптер (сеть в исходящий сетевой трафик).<br/><br/> Данные производительности собираются постоянно после устройство подключается к vCenter Server. Исторические данные не собираются.

## <a name="hyper-v-assessment"></a>Оценка Hyper-V

На схеме показаны, как работает Hyper-V оценки ода оценки сервера миграции Azure.

![Архитектура оценки Hyper-V](./media/migrate-architecture/sas-architecture-hyper-v.png)

Процесс таков:

1. **Создание устройства "Миграция Azure"** :

    1\. Скачайте виртуальную Машину в сжатом формате на портале Azure.

    2\. Импортируйте его на узел Hyper-V.

    В. Подключение к устройству виртуальной Машины. Настройка основных параметров для него и зарегистрируйте его с "Миграция Azure".

2. **Запуск обнаружения**:

    1\. Подключение к устройству "Миграция Azure" для запуска обнаружения. Ничего не должен быть установлен на обнаруженных виртуальных машинах.

    2\. Модуль постоянно отправляет данные метаданные и производительности виртуальной Машины "Миграция Azure".

    - Модуль всегда подключается к службе "Миграция Azure" (с помощью сеансов CIM).
    - Изменения среды во время непрерывного обнаружения регистрируются. Например добавление виртуальных машин в области обнаружения или дисков виртуальной Машины или сетевых адаптеров.


3. **Оценить готовность компьютеров**:

    1\. В Azure, когда обнаружение завершится, портала, которые можно собрать обнаруженные виртуальные машины в группы.  Группы обычно состоит из виртуальных машин, которые вы хотите мигрировать друг с другом.

    2\. Выполните оценку для каждой группы.

4. **Просмотрите оценки**:

    1\. По завершении оценки просмотрите его на портале.

    2\. Для дальнейшего анализа скачивание средства для оценки в формате Excel.

### <a name="hyper-v-ports"></a>Портам Hyper-V

Служба миграции Azure использует следующие порты подключения для Hyper-v.

**Source** | **Цель** | **Порт** | **Сведения**
--- | --- | --- | ---
Устройство Azure служба "Миграция" | со службой Миграция Azure | Target-TCP 443 | Отправьте метаданные и данные производительности для "Миграция Azure".
Устройство Azure служба "Миграция" | Кластер узлов Hyper-V | Target-Default WinRM ports-HTTP:5985; HTTPS:5986 | Подключение к узлу метаданные и данные производительности. Сеанс CIM, используемый для подключения
Клиент RDP | Устройство Azure служба "Миграция" | Target-TCP3389 | RDP-подключение обнаружения триггера из устройства.

## <a name="collected-hyper-v-vm-metadata"></a>Собранные метаданные виртуальной Машины Hyper-V

Устройство отправляет метаданные и данные, связанные с производительностью из виртуальных машин Azure.


**Действие** | **Сведения**
--- | ---
**Собранные метаданные** | имя виртуальной машины;<br/> Путь к виртуальной Машине (папка узлом и кластером)<br/> IP-адрес и MAC-адреса<br/> Операционная система<br/> Число ядер/дисков и сетевых адаптеров<br/> Размеры диска и памяти<br/> Диск операций ввода-ВЫВОДА, пропускная способность дисков (Мбит/с), выходные данные сетевой (Мбит/с)
**Собранные данные о производительности** |  Использование ЦП и памяти<br/> На диске данных (скорость чтения/записи диска; операций чтения и записи диска в секунду)<br/> Данные сетевой Адаптер (сеть в исходящий сетевой трафик).<br/><br/> Данные производительности собираются постоянно после того, как устройство подключится к узлу Hyper-V. Исторические данные не собираются.




## <a name="migration-with-azure-migrate-server-migration"></a>Миграция с помощью Azure миграции сервера

Миграция сервера миграции Azure можно перенести перечисленные ниже, в Azure:

- Локальные виртуальные машины VMware
- Локальных виртуальных машин Hyper-V
- Локальные физические серверы
- Экземпляры виртуальных Машин Windows в AWS
- Экземпляры виртуальных Машин Windows GCP

Процесс миграции слегка отличается, в зависимости от какой вы переносите.


## <a name="migrate-vmware-vms"></a>Перенос виртуальных машин VMware

Azure миграция сервера миграции доступно два способа для миграции локальных виртуальных машин VMware:

- **Без агента репликации**: Перенос виртуальных машин не нужно ничего устанавливать на них.
- **Агент репликации**. Установите агент на виртуальной Машине для репликации.

Несмотря на то, что с точки зрения развертывания проще без агента репликации, в настоящее время он имеет ряд ограничений. [Дополнительные сведения](server-migrate-overview.md) об этих ограничениях.
 

### <a name="agent-based-migration"></a>Миграции на основе агента

Миграции на основе агента виртуальных машин VMware требуется несколько компонентов для развертывания, как описано в таблице.

**Компонент** | **Требование** | **Сведения**
--- | --- | ---
**Компьютер сервера конфигурации** | Один на локальной виртуальной Машины VMware, которое развертывается с помощью скачанного шаблона OVF.<br/><br/> На этом компьютере выполняются все компоненты Site Recovery в локальной, включая сервер конфигурации и сервер обработки. | **Сервер конфигурации** координирует обмен данными между локальной средой и Azure, а также управляет репликацией данных.<br/><br/> **Сервер обработки** По умолчанию устанавливается на сервере конфигурации. Он получает данные репликации; оптимизирует их путем кэширования, сжатия и шифрования; и отправляет его в Azure. Сервер обработки также устанавливает службу Mobility Service Azure Site Recovery на виртуальных машинах и выполняет автоматическое обнаружение локальных компьютеров.
**Служба Mobility Service** | Служба Mobility Service устанавливается на каждой виртуальной Машине VMware, которые вы реплицируете. | Рекомендуем разрешить автоматическую установку с сервера обработки. Кроме того, вы можете установить службу вручную или использовать средство автоматического развертывания, такое как System Center Configuration Manager.





### <a name="agent-based-replication-process"></a>Процесс репликации на основе агента

![Процесс репликации](./media/migrate-architecture/v2a-architecture-henry.png)

1. При включении репликации для виртуальной Машины, начинает начальной репликации в Azure. 
    - Репликация является уровня блока, непрерывной, используя агент службы Mobility service на виртуальной Машине.
    - Применяются параметры политики репликации.
        - **Пороговое значение RPO**. Этот параметр не влияет на репликацию. Он помогает с мониторингом. Будет создано событие, возможно, с отправкой сообщения электронной почты, если текущее значение RPO превышает заданное вами пороговое значение.
        - **Хранение точки восстановления**. Этот параметр указывает, на какой период в прошлом вы хотите вернуться в случае нарушения работы. Максимальный срок хранения в хранилище класса "Премиум" — 24 часа. В хранилище категории "Стандартный" — 72 часа. 
        - **Согласованные с приложением моментальные снимки**. Моментальный снимок, согласованный с приложением, может создаваться с интервалом от 1 до 12 часов в зависимости от потребностей приложения. Это стандартные моментальные снимки BLOB-объектов Azure. Агент службы Mobility, запущенный на виртуальной машине, запрашивает моментальный снимок VSS в соответствии с этим параметром и отмечает этот момент времени как точку согласованности приложения в потоке репликации.

2. Трафик реплицируется в общедоступные конечные точки службы хранилища Azure через Интернет.

    - Кроме того, можно использовать Azure ExpressRoute с [пиринг Майкрософт](../expressroute/expressroute-circuit-peerings.md#microsoftpeering).
    - Репликация трафика через VPN типа "сеть — сеть" с локального сайта в Azure не поддерживается.
3. После завершения начальной репликации начинается репликация разностных изменений в Azure. Отслеживаемые изменения для машины отправляются на сервер обработки.
2. Обмен данными происходит следующим образом.

    - Виртуальные машины обмениваются данными с локальным сервером конфигурации через HTTPS-порт 443 для входящих подключений, чтобы управлять репликацией.
    - Сервер конфигурации выполняет оркестрацию репликации в Azure через HTTPS-порт 443 для исходящих подключений.
    - Виртуальные машины отправляют данные репликации на сервер обработки (запущенный на компьютере сервера конфигурации) через HTTPS-порт 9443 для входящих подключений. Этот порт можно изменить.
    - Сервер обработки получает данные репликации, оптимизирует и шифрует их, а затем отправляет в службу хранилища Azure через порт 443 для исходящих подключений.
5. Данные репликации первый land журналы в учетную запись хранения кэша в Azure. Эти журналы, обрабатываются и данные хранятся в Azure управляемого диска (начальное значение диск Azure Site Recovery). Точки восстановления создаются на этом диске.







## <a name="next-steps"></a>Следующие шаги

- [Просмотрите часто задаваемые вопросы](resources-faq.md) о службе "Миграция Azure".
- Помощь от сообщества, посетите [перенести форум MSDN по Azure](https://social.msdn.microsoft.com/Forums/home?forum=AzureMigrate&filter=alltypes&sort=lastpostdesc) или [Stack Overflow](https://stackoverflow.com/search?q=azure+migrate).

