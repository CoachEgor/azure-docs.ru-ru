---
title: Как работает миграция Hyper-V с миграцией сервера миграции Azure? | Документы Майкрософт
description: Общие сведения о миграции Hyper-V в миграции сервера миграции Azure
author: rayne-wiselman
ms.service: azure-migrate
ms.topic: conceptual
ms.date: 07/09/2019
ms.author: raynew
ms.openlocfilehash: 9148e76a9f2abd369ae595422d785a347e58dfab
ms.sourcegitcommit: 47ce9ac1eb1561810b8e4242c45127f7b4a4aa1a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2019
ms.locfileid: "67811717"
---
# <a name="how-does-hyper-v-replication-work"></a>Как работает репликация Hyper-V?

В этой статье Обзор архитектуры и процессы, используемые при переносе виртуальных машин Hyper-V с помощью средства миграции сервера миграции Azure.

[Служба "Миграция Azure"](migrate-services-overview.md) предоставляют центральный концентратор для отслеживания, обнаружения, оценки и миграции локальных приложений и рабочих нагрузок и закрытого и открытого облака виртуальных машин в Azure. Концентратор средства "Миграция Azure" для оценки и миграции, а также сторонних независимых Независимым производителям предложений.

## <a name="agentless-migration"></a>Миграцию без агента

Средство миграции сервера миграции Azure предоставляет без агента репликации для локальных виртуальных машин Hyper-V, используя рабочий процесс миграции, который оптимизирован для Hyper-V. Агент программного обеспечения устанавливается только на узлах Hyper-V или узлами кластера. Ничего не должен быть установлен на виртуальных машинах Hyper-V.

## <a name="server-migration-and-azure-site-recovery"></a>Миграция сервера и Azure Site Recovery

Миграции в Azure миграции сервера — это средство для переноса локальных рабочих нагрузок и облачных виртуальных машин, в Azure. Site Recovery — это средство аварийного восстановления. Средства имеют некоторые общие компоненты технологии, используемой для репликации данных, но предназначены для разных целей. 


## <a name="architectural-components"></a>Компоненты архитектуры

![Архитектура](./media/hyper-v-replication-architecture/architecture.png)



**Компонент** | **Развертывание** | 
--- | --- 
**Поставщик репликации** | Поставщик Microsoft Azure Site Recovery устанавливается на узлах Hyper-V и зарегистрировано миграция сервера миграции Azure.<br/> Поставщик оркестрирует репликацию для виртуальных машин Hyper-V.
**Агент служб восстановления** | Агент служб восстановления Microsoft Azure обрабатывает данные репликации. Он работает с поставщиком для репликации данных из виртуальных машин Hyper-V в Azure.<br/> Реплицированные данные передаются в учетную запись хранения в подписке Azure. Миграция сервера средство процессы реплицированных данных и применяет их к диски реплики в подписке. Диски реплики используются для создания виртуальных машин Azure, при миграции.

- Компоненты устанавливаются в отдельный файл установки, Скачанный из миграции сервера миграции Azure на портале.
- Поставщик и устройства использовать исходящие подключения по протоколу HTTPS порт 443 для связи с миграция сервера миграции Azure.
- Связи от поставщика и агента, защищенным и зашифрованным каналам.


## <a name="replication-process"></a>Процесс репликации

1. При включении репликации для виртуальной Машины Hyper-V, начальная репликация начинает.
2. Создается моментальный снимок виртуальной Машины Hyper-V.
3. Виртуальные жесткие диски на виртуальной Машине, реплицируемых по одному, пока все они будут скопированы в Azure. Время начальной репликации зависит от размера виртуальной Машины и пропускной способности сети.
4. Изменений на диске, возникающих во время начальной репликации, отслеживаются с помощью реплики Hyper-V и хранятся в файлах журнала (hrl-файлы).
    - Файлы журнала находятся в той же папке, что диски.
    - Каждый диск имеет связанный hrl-файл, который отправляется в дополнительное хранилище.
    - При начальной репликации файлы моментальных снимков и журналов потребляют ресурсы диска.
4. После завершения начальной репликации моментальный снимок виртуальной Машины удаляется, и начинается разностная репликация.
5. Диск добавочные изменения отслеживаются в hrl-файлы. Журналы репликации периодически отправляются в учетную запись хранилища Azure с помощью агента служб восстановления.


## <a name="performance-and-scaling"></a>Производительность и масштабируемость

Производительность репликации для Hyper-V зависит от факторов, которые включают размер виртуальной Машины, скорость изменения данных (обновлений) виртуальных машин, доступное пространство на узле Hyper-V для хранения файлов журнала, пропускная способность передачи данных репликации и целевого хранилища в Azure.

- Если вы выполняете репликацию нескольких машин, в то же время, используйте [планировщик развертывания Azure Site Recovery](../site-recovery/hyper-v-deployment-planner-overview.md) для Hyper-V, с целью оптимизации репликации.
- Планирование репликации Hyper-V и распространять репликации учетных записей хранения Azure, в соответствии с емкостью.

### <a name="control-upload-throughput"></a>Пропускная способность отправки для элемента управления

Можно ограничить объем пропускной способности, используемый для отправки данных в Azure на каждом узле Hyper-V. Будь осторожен. Если значение слишком мало значений, он будет отрицательно влиять на репликацию и отложить миграцию.


1. Войдите на узел или кластер узлов Hyper-V.
2. Запустите **C:\Program Files\Microsoft Azure Recovery Services Agent\bin\wabadmin.msc**, чтобы открыть оснастку MMC в Windows Azure Backup.
3. В оснастке выберите **Change Properties** (Изменить свойства).
4. В **регулирование**выберите **включить использование пропускной способности Интернета, регулирование для операций резервного копирования**. Задайте ограничения для рабочего и нерабочего времени. Допустимы значения в диапазоне от 512 Кбит/с до 1,023 Мбит/с.
I

### <a name="influence-upload-efficiency"></a>Эффективность передачи влияния

Если имеет свободную пропускную способность для репликации и хотите увеличить передачи, можно увеличить количество потоков, выделенных для задачи «Отправка», следующим образом:

1. Откройте реестр с помощью Regedit.
2. Перейдите к разделу HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\Replication\UploadThreadsPerVM
3. Увеличьте значение для числа потоков, используемых для передачи данных для каждой реплицируемой виртуальной Машины. Значение по умолчанию — 4, а максимальное значение — 32. 




## <a name="next-steps"></a>Следующие шаги

Испытайте [миграции Hyper-V](tutorial-migrate-hyper-v.md) с помощью миграции сервера миграции Azure.
