---
title: Как работает миграция Hyper-V в Azure Migrate?
description: Узнайте больше о миграции Hyper-V с помощью Azure Migrate
author: rayne-wiselman
ms.service: azure-migrate
ms.topic: conceptual
ms.date: 11/19/2019
ms.author: raynew
ms.openlocfilehash: 8bca88fc63a7fc04a22d2a68adbe59259b07f50e
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "74185878"
---
# <a name="how-does-hyper-v-replication-work"></a>Как работает репликация Hyper-V?

В этой статье приводится обзор архитектуры и процессов, используемых при переносе V-M Hyper-V с помощью инструмента миграции серверов Azure Migrate.

Служба [Миграция Azure](migrate-services-overview.md) объединяет в себе средства наблюдения за обнаружением, оценкой и миграцией локальных приложений и рабочих нагрузок, а также виртуальных машин частного или общедоступного облака в Azure. Эта служба предоставляет инструменты для оценки и миграции, а также предложения сторонних независимых поставщиков программного обеспечения (ISV).

## <a name="agentless-migration"></a>Бесагентная миграция

Инструмент миграции серверов Azure Migrate предоставляет бесагентную репликацию для внутренних микро-технологий Hyper-V с использованием миграционного рабочего процесса, оптимизированного для Hyper-V. Вы устанавливаете программный агент только на узлы Hyper-V или кластерные узлы. Ничто не должно быть установлено на Hyper-V VMs.

## <a name="server-migration-and-azure-site-recovery"></a>Миграция серверов и восстановление сайта Azure

Azure Migrate Server Migration — это инструмент для переноса рабочих нагрузок на непредпорочные и облачные ввовы в Azure. Восстановление сайта является инструментом аварийного восстановления. Инструменты имеют некоторые общие технологические компоненты, используемые для репликации данных, но служат различным целям. 


## <a name="architectural-components"></a>Компоненты архитектуры

![Architecture](./media/hyper-v-replication-architecture/architecture.png)



**Компонент** | **Развертывание** | 
--- | --- 
**Поставщик репликации** | Поставщик восстановления сайтов Microsoft Azure устанавливается на хосты Hyper-V и регистрируется в Azure Migration Server Migration.<br/> Поставщик организует репликацию для Hyper-V VM.
**Агент служб восстановления** | Агент службы восстановления Microsoft Azure обрабатывает репликацию данных. Он работает с поставщиком для воспроизведения данных с Hyper-V VMs в Azure.<br/> Реплицированные данные загружаются в учетную запись хранилища в подписке Azure. Инструмент миграции серверов обрабатывает реплицированные данные и применяет их к репликационным дискам в подписке. Диски реплики используются для создания VMs Azure при миграции.

- Компоненты устанавливаются одним файлом настройки, загруженным из миграции серверов Azure Migrate server на портале.
- Поставщик и прибор используют исходящие соединения порта HTTPS 443 для связи с миграцией серверов Azure Migrate Server.
- Сообщения от поставщика и агента являются безопасными и зашифрованными.


## <a name="replication-process"></a>Процесс репликации

1. Когда вы включите репликацию для Hyper-V VM, начинается начальная репликация.
2. Снимок Hyper-V VM сделан.
3. VHD на VM реплицируются один за одним, пока все они не будут скопированы в Azure. Начальное время репликации зависит от размера VM и пропускной способности сети.
4. Изменения диска, происходящие во время первоначальной репликации, отслеживаются с помощью Hyper-V Replica и хранятся в файлах журнала (файлах hrl).
    - Файлы журнала находятся в той же папке, что и диски.
    - Каждый диск имеет связанный файл hrl, отправленный во вторичное хранилище.
    - При начальной репликации файлы моментальных снимков и журналов потребляют ресурсы диска.
4. После завершения первоначальной репликации снимок VM удаляется и начинается репликация дельты.
5. Инкрементные изменения диска отслеживаются в файлах hrl. Журналы репликации периодически загружаются в учетную запись хранения Azure агентом служб восстановления.


## <a name="performance-and-scaling"></a>Производительность и масштабируемость

На производительность репликации hyper-V влияют такие факторы, как размер VM, скорость изменения данных (отток) виртуальных вывеши, доступное пространство на хосте Hyper-V для хранения файлов журнала, пропускная способность для данных репликации и целевое хранилище в Azure.

- Если вы воспроизводите несколько машин одновременно, используйте [планировщик развертывания развертывания сайта Azure](../site-recovery/hyper-v-deployment-planner-overview.md) для Hyper-V, чтобы помочь оптимизировать репликацию.
- Планируйте репликацию Hyper-V и распространяйте репликацию по учетным записям хранения Azure в соответствии с емкостью.

### <a name="control-upload-throughput"></a>Пропускная пропускная информация control upload

Можно ограничить объем пропускной способности, используемой для загрузки данных в Azure на каждом хосте Hyper-V. Будь осторожен. При слишком низком значении это отрицательно скажется на репликации и задержит миграцию.


1. Войти на узлы Hyper-V или кластерный узла.
2. Выполнить **C: «Файлы программы»Microsoft Azure Recovery Services Agent'bin'wabadmin.msc**, чтобы открыть snap-in MMC резервного копирования Windows Azure.
3. В оснастке выберите **Change Properties** (Изменить свойства).
4. В **throttling**, выберите **Включить интернет-пропускной способности использования регулирования для операций резервного копирования.** Задайте ограничения для рабочего и нерабочего времени. Допустимы значения в диапазоне от 512 Кбит/с до 1,023 Мбит/с.
I

### <a name="influence-upload-efficiency"></a>Влияние эффективности загрузки

Если у вас есть запасная пропускная способность для репликации, и вы хотите увеличить загрузку, вы можете увеличить количество потоков, выделенных для задачи загрузки, следующим образом:

1. Откройте реестр с Regedit.
2. Перейдите к ключевым HKEY_LOCAL_MACHINE»SOFTWARE»Microsoft-Windows Azure Backup/Репликация
3. Увеличьте значение для количества потоков, используемых для загрузки данных для каждого репликационного VM. Значение по умолчанию 4, а максимальное значение 32. 




## <a name="next-steps"></a>Дальнейшие действия

Попробуйте [миграцию Hyper-V](tutorial-migrate-hyper-v.md) с помощью Azure Migrate Server Migration.
