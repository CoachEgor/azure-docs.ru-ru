---
title: Оценка готовности виртуальных машин VMware к миграции в Azure с помощью оценки сервера в службе "Миграция Azure"
description: В этой статье описывается, как оценить готовность к миграции в Azure для локальных виртуальных машин VMware с помощью службы "Миграция Azure".
author: rayne-wiselman
manager: carmonm
ms.service: azure-migrate
ms.topic: tutorial
ms.date: 11/19/2019
ms.author: hamusa
ms.openlocfilehash: 7f161afe13bad8c548806d4b4ceb9372dc511cc3
ms.sourcegitcommit: 0947111b263015136bca0e6ec5a8c570b3f700ff
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/24/2020
ms.locfileid: "79223291"
---
# <a name="assess-vmware-vms-by-using-azure-migrate-server-assessment"></a>Оценка готовности виртуальных машин VMware с помощью оценки сервера в службе "Миграция Azure"

В этой статье описывается, как оценить локальные виртуальные машины VMware с помощью средства оценки серверов в службе "Миграция Azure".

Служба [Миграция Azure](migrate-services-overview.md) объединяет в себе инструменты, которые используются для поиска, оценки и переноса приложений, инфраструктуры и рабочих нагрузок в Microsoft Azure. Здесь предоставляются инструменты службы "Миграция Azure" и предложения независимых поставщиков программного обеспечения, сотрудничающих с корпорацией Майкрософт.

Это руководство является вторым в серии, в которой показано, как оценивать и переносить виртуальные машины VMware в Azure. В этом руководстве описано следующее:
> [!div class="checklist"]
> * Настройка проекта службы "Миграция Azure".
> * Настройка устройства службы "Миграция Azure", работающего локально, для оценки виртуальных машин.
> * Запуск непрерывного обнаружения локальных виртуальных машин. Устройство отправляет данные конфигурации и производительности для обнаруженных виртуальных машин в Azure.
> * Группирование обнаруженных виртуальных машин и оценка группы виртуальных машин.
> * Просмотр оценки.

> [!NOTE]
> В руководствах показан простейший путь развертывания сценария, использование которого позволяет быстро настроить проверку концепции. В руководствах по возможности используются параметры по умолчанию и показаны не все возможные параметры и пути. Для получения подробных инструкций ознакомьтесь с практическими руководствами.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/pricing/free-trial/), прежде чем начинать работу.

## <a name="prerequisites"></a>Предварительные требования

[Выполните действия из первого руководства](tutorial-prepare-vmware.md) этой серии. Если этого не сделать, инструкции в этом руководстве не будут работать.

В первом руководстве вы должны были выполнить следующие действия.

- [Настройка разрешений Azure](tutorial-prepare-vmware.md#prepare-azure) для службы "Миграция Azure".
- [Подготовка VMware](tutorial-prepare-vmware.md#prepare-for-vmware-vm-assessment) для оценки.
   - [Проверьте](migrate-support-matrix-vmware.md#vmware-requirements) параметры VMware.
   - Настройте разрешения в VMware для создания виртуальной машины VMware с использованием шаблона в формате OVA.
   - Настройте [обнаружение виртуальных машин для учетной записи](migrate-support-matrix-vmware.md#vmware-requirements). 
   - Сделайте все [требуемые порты](migrate-support-matrix-vmware.md#port-access) доступными.
   - Учтите все [URL-адреса](migrate-replication-appliance.md#url-access), необходимые для доступа к Azure.

## <a name="set-up-an-azure-migrate-project"></a>Настройка проекта службы "Миграция Azure"

Настройте новый проект службы "Миграция Azure" следующим образом.

1. На портал Azure выберите **Все службы** и найдите службу **Миграция Azure**.
1. В разделе **Службы** выберите **Миграция Azure**.
1. В разделе **Обзор** в области **Обнаружение, оценка и миграция серверов** выберите **Оценка и миграция серверов**.

   ![Кнопка оценки и миграции серверов](./media/tutorial-assess-vmware/assess-migrate.png)

1. В разделе **Начало работы** щелкните **Добавить инструменты**.
1. В разделе **Проект миграции** выберите подписку Azure и создайте группу ресурсов, если у вас ее нет.     
1. В разделе **Сведения о проекте** укажите имя проекта и регион для создания проекта. Поддерживаются такие регионы: Азия, Европа, Соединенное Королевство и США.

   Географический регион проекта используется только для хранения обнаруженных метаданных локальных виртуальных машин. При выполнении миграции можно выбрать любой целевой регион.

   ![Поля для имени и региона проекта](./media/tutorial-assess-vmware/migrate-project.png)

1. Выберите **Далее**.
1. В области **Выберите инструмент оценки** выберите **Azure Migrate: Server Assessment (Миграция Azure: оценка сервера)**  > **Далее**.

   ![Выбор средства оценки серверов](./media/tutorial-assess-vmware/assessment-tool.png)

1. В области **Выберите инструмент миграции** выберите **Пропустить добавление инструмента миграции** > **Далее**.
1. В разделе **Проверка и добавление инструментов** проверьте параметры и щелкните **Добавить инструменты**.
1. Развертывание проекта службы "Миграция Azure" может занять несколько минут. После этого откроется страница проекта. Если проект не отображается, доступ к нему можно получить в разделе **Серверы** на панели мониторинга службы "Миграция Azure".

## <a name="set-up-the-appliance-vm"></a>Настройка виртуальной машины устройства

Средство оценки северов службы "Миграция Azure" запускает упрощенное устройство виртуальной машины VMware. Это устройство выполняет обнаружение виртуальных машин, а также собирает их метаданные и сведения о производительности.

Чтобы настроить устройство, сделайте следующее.

- Скачайте файл шаблона OVA и импортируйте его в vCenter Server.
- Создайте устройство и убедитесь, что оно может подключиться к средству оценки сервера в службе "Миграция Azure".
- Настройте устройство в первый раз и зарегистрируйте его в проекте службы "Миграция Azure".

Для одного проекта службы "Миграция Azure" можно настроить несколько устройств. Средство оценки серверов поддерживает обнаружение до 35 000 виртуальных машин на всех устройствах. На одном устройстве можно обнаруживать не более 10 000 серверов.

### <a name="download-the-ova-template"></a>Скачивание шаблона OVA

1. Последовательно выберите разделы **Цели миграции** > **Серверы** > **Azure Migrate: оценка серверов** и щелкните **Обнаружить**.
1. В разделе **Обнаружение компьютеров** > **Ваши компьютеры виртуализированы?** щелкните **Да, с использованием VMware vSphere Hypervisor**.
1. Щелкните **Скачать**, чтобы получить OVA-файл шаблона.

   ![Выбор параметров для скачивания OVA-файла](./media/tutorial-assess-vmware/download-ova.png)

### <a name="verify-security"></a>Проверка безопасности

Прежде чем развертывать OVA-файл, убедитесь, что он не поврежден.

1. На компьютере, на который был скачан файл, откройте командное окно с правами администратора.
1. Выполните следующую команду, чтобы создать хэш OVA-файла.
  
   ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
   
   Пример использования: ```C:\>CertUtil -HashFile C:\AzureMigrate\AzureMigrate.ova SHA256```

Для версии 2.19.07.30 созданный хэш должен соответствовать следующим значениям:

**Алгоритм** | **Значение хэша**
--- | ---
MD5 | c06ac2a2c0f870d3b274a0b7a73b78b1
SHA256 | 4ce4faa3a78189a09a26bfa5b817c7afcf5b555eb46999c2fad9d2ebc808540c

### <a name="create-the-appliance-vm"></a>Создание виртуальной машины устройства

Импортируйте скачанный файл и создайте виртуальную машину.

1. В консоли клиента vSphere выберите **File** (Файл) > **Deploy OVF Template** (Развернуть шаблон OVF).

   ![Команда меню для развертывания шаблона OVF](./media/tutorial-assess-vmware/deploy-ovf.png)

1. В мастере развертывания шаблона OVF выберите **Source** (Источник) и укажите расположение OVA-файла.
1. В полях **Name** (Имя) и **Location** (Расположение) укажите понятное имя для виртуальной машины. Выберите объект инвентаризации, в котором будет размещена эта виртуальная машина.
1. В поле **Host/Cluster** (Узел или кластер) укажите узел или кластер, в котором будет работать виртуальная машина.
1. В поле **Storage** (Хранилище) укажите место хранения данных виртуальной машины.
1. В поле **Disk Format** (Формат диска) укажите тип и размер диска.
1. В поле **Network Mapping** (Сетевое сопоставление) укажите сеть, к которой будет подключена виртуальная машина. Этой сети требуется подключение к Интернету для отправки метаданных в средство оценки серверов службы "Миграция Azure".
1. Проверьте и подтвердите параметры и нажмите кнопку **Finish** (Готово).

### <a name="verify-appliance-access-to-azure"></a>Проверка доступа устройства к Azure

Убедитесь, что виртуальная машина устройства может подключиться к [URL-адресам Azure](migrate-appliance.md#url-access).

### <a name="configure-the-appliance"></a>Настройка устройства

Настройте устройство, выполнив следующие действия.

1. В консоли клиента vSphere щелкните правой кнопкой мыши виртуальную машину и выберите **Open Console** (Открыть консоль).
1. Укажите язык, часовой пояс и пароль для устройства.
1. Откройте браузер на любом компьютере, который может подключиться к виртуальной машине, и откройте URL-адрес веб-приложения устройства: **https://*имя устройства или IP-адрес*: 44368**.

   Кроме того, вы можете открыть приложение с рабочего стола устройства, щелкнув ярлык приложения.
1. В веб-приложении выберите **Настройка необходимых компонентов** и выполните приведенные ниже действия.
   - **Лицензия**: Примите условия лицензии и прочитайте информацию от сторонних производителей.
   - **Возможность подключения**: приложение проверит наличие доступа к Интернету у виртуальной машины. Если виртуальная машина использует прокси, выполните приведенные ниже действия.
     - Щелкните **Proxy settings** (Параметры прокси-сервера) и укажите адрес и порт прослушивания прокси-сервера в формате http://ProxyIPAddress или http://ProxyFQDN.
     - Укажите учетные данные, если для прокси-сервера требуется аутентификация.
     - Обратите внимание, что поддерживается только прокси-сервер HTTP.
   - **Синхронизация времени**: Время на устройстве должно быть синхронизировано со временем в Интернете, чтобы обнаружение виртуальных машин работало правильно.
   - **Установка обновлений**: Устройство обеспечивает установку последних обновлений.
   - **Установка VDDK**. Устройство проверяет, установлено ли VMware vSphere Virtual Disk Development Kit (VDDK). Если он не установлен, скачайте VDDK 6.7 из VMware и извлеките скачанное содержимое ZIP-файла в указанное расположение на устройстве.

     Средство миграции серверов службы "Миграция Azure" использует VDDK для репликации компьютеров во время миграции на Azure.       

### <a name="register-the-appliance-with-azure-migrate"></a>Регистрация устройства с помощью службы "Миграция Azure"

1. Выберите **Вход**. Если этот параметр не отображается, убедитесь, что в браузере отключена блокировка всплывающих окон.
1. В новой вкладке выполните вход, используя имя пользователя и пароль Azure.
   
   Вход с помощью PIN-кода не поддерживается.
1. Войдя, вернитесь к веб-приложению.
1. Выберите подписку, в которой был создан проект службы "Миграция Azure", а затем выберите проект.
1. Укажите имя для устройства. Это имя должно содержать буквы и цифры (не более 14 символов).
1. Выберите **Зарегистрировать**.

## <a name="start-continuous-discovery"></a>Запуск непрерывного обнаружения

Устройство должно подключиться к vCenter Server для обнаружения конфигурации и данных о производительности виртуальных машин.

### <a name="specify-vcenter-server-details"></a>Укажите сведения о vCenter Server
1. В разделе **Выбор сведений о vCenter Server** укажите полное доменное имя или IP-адрес экземпляра vCenter Server. Вы можете оставить порт по умолчанию или указать пользовательский порт, на котором vCenter Server ожидает передачу данных.
1. В полях **Имя пользователя** и **Пароль** укажите данные учетной записи vCenter Server, которые устройство будет использовать для обнаружения виртуальных машин в экземпляре vCenter Server. 

   Убедитесь, что в учетной записи есть [необходимые разрешения для обнаружения](migrate-support-matrix-vmware.md#vmware-requirements). Вы можете [обозначить область обнаружения](tutorial-assess-vmware.md#set-the-scope-of-discovery), ограничив доступ к учетной записи vCenter.
1. Щелкните **Проверить подключение** и убедитесь, что устройство может подключаться к vCenter Server.

### <a name="specify-vm-credentials"></a>Указание учетных данных виртуальной машины
Для обнаружения приложений, ролей и функций, а также визуализации зависимостей виртуальных машин можно предоставить учетные данные виртуальной машины, которые обеспечивают доступ к виртуальным машинам VMware. Вы можете добавить одни учетные данные для виртуальных машин Windows, а другие учетные данные — для виртуальных машин Linux. См. сведения о [требуемых разрешениях на доступ](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-vmware).

> [!NOTE]
> Эти параметры не являются обязательными, но потребуются для обнаружения приложений и визуализации зависимостей без агента.

1. В разделе **Обнаружение приложений и зависимостей на виртуальных машинах** щелкните **Добавить учетные данные**.
1. Выберите значение параметра **Операционная система**.
1. Введите понятное имя для учетных данных.
1. В полях **Имя пользователя** и **Пароль** укажите данные учетной записи, имеющую по крайней мере гостевой доступ к виртуальным машинам.
1. Выберите **Добавить**.

После указания учетных данных для экземпляра vCenter Server и виртуальных машин (необязательно) щелкните **Сохранить и начать обнаружение**, чтобы начать обнаружение в локальной среде.

Чтобы метаданные обнаруженных виртуальных машин отобразились на портале, потребуется около 15 минут. Обнаружение установленных приложений, ролей и компонентов занимает некоторое время, которое зависит от числа обнаруженных виртуальных машин. Для отображения приложений на 500 виртуальных машинах на портале Миграции Azure потребуется примерно 1 час.

### <a name="set-the-scope-of-discovery"></a>Настройка области обнаружения

Область обнаружения можно задать, ограничивая права доступа для учетной записи vCenter, которая используется для обнаружения. Вы можете задать в качестве области центры данных vCenter Server, кластеры, папки кластеров, узлы, папки узлов или отдельные виртуальные машины.

Чтобы настроить область, выполните следующие процедуры.

#### <a name="1-create-a-vcenter-user-account"></a>1. Создание учетной записи vCenter
1.  Войдите в веб-клиент vSphere с правами администратора vCenter Server.
1.  Выберите **Администрирование** > **Пользователи и группы единого входа**, а затем откройте вкладку **Пользователи**.
1.  Щелкните значок **Новый пользователь**.
1.  Введите необходимые данные для создания нового пользователя и щелкните **ОК**.

#### <a name="2-define-a-new-role-with-required-permission"></a>2. Определение новой роли с необходимыми разрешениями
Эта процедура является обязательной при переносе сервера без агента.
1.  Войдите в веб-клиент vSphere с правами администратора vCenter Server.
1.  Выберите к **Администрирование** > **Диспетчер ролей**.
1.  Выберите в раскрывающемся списке нужный экземпляр vCenter Server.
1.  Щелкните **Create Role** (Создать роль).
1.  Введите имя новой роли, например <em>Azure_Migrate</em>.
1.  Назначьте [разрешения](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-vmware) для новой роли.
1.  Щелкните **ОК**.

#### <a name="3-assign-permissions-on-vcenter-objects"></a>3. Назначение разрешений для объектов vCenter

Существует два подхода к назначению прав доступа к объектам инвентаризации в vCenter для учетной записи пользователя vCenter с назначенной ролью.

Для оценки сервера необходимо применить к учетной записи пользователя vCenter роль **Только для чтения** для всех родительских объектов, в которых размещаются обнаруживаемые виртуальные машины. Должны быть включены все родительские объекты (узел, папка узлов, кластер, папка кластеров) в иерархии, вплоть до центра обработки данных. Эти разрешения распространяются на дочерние объекты в иерархии.

Аналогичным образом для переноса сервера необходимо применить к учетной записи vCenter пользовательскую роль c [разрешениями](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-vmware) для всех родительских объектов, в которых размещены виртуальные машины, которые необходимо перенести. Эту роль можно назвать <em>Azure _Migrate</em>.

![Назначение разрешений](./media/tutorial-assess-vmware/assign-perms.png)

Кроме того, вы можете назначить учетную запись и роль на уровне центра обработки данных и распространить их на дочерние объекты. Затем присвойте учетной записи роль **Нет доступа** для каждого объекта (например, виртуальных машин), который вы не хотите обнаруживать или переносить. 

Этот вариант конфигурации довольно громоздок. Она не обеспечивает полный контроль доступа, так как каждый дочерний объект автоматически наследует права доступа родительского объекта. Поэтому мы рекомендуем использовать первый подход.

> [!NOTE]
> Сейчас средство оценки серверов не может обнаруживать виртуальные машины, если доступ к учетной записи vCenter предоставлен на уровне папок виртуальных машин vCenter. Если вы хотите ограничить обнаружение папками виртуальной машины, примените следующую процедуру. Так вы настроите для учетной записи vCenter доступ только для чтения на уровне виртуальной машины.
>
> 1. Назначьте разрешения только для чтения для всех виртуальных машин в папках, в которых вы хотите определить область обнаружения.
> 1. Предоставьте доступ только для чтения всем родительским объектам, где размещены виртуальные машины. Будут включены все родительские объекты (узел, папка узлов, кластер, папка кластеров) в иерархии, вплоть до центра обработки данных. Вам не нужно распространять разрешения на все дочерние объекты.
> 1. Используйте учетные данные для обнаружения, выбрав центр данных в качестве **области сбора данных**. Настроенное управление доступом на основе ролей гарантирует, что пользователи vCenter получат доступ только к виртуальным машинам соответствующих клиентов.
>
> Обратите внимание, что поддерживаются папки узлов и кластеров.

### <a name="verify-vms-in-the-portal"></a>Проверка виртуальных машин на портале

После обнаружения вы можете убедиться, что виртуальные машины отображаются на портале Azure.

1. Откройте панель мониторинга службы "Миграция Azure".
1. На странице **Azure Migrate — Servers** > **Azure Migrate: оценка серверов** щелкните значок, отображающий число **обнаруженных серверов**.

## <a name="set-up-an-assessment"></a>Настройка оценки

Вы можете создать два типа оценки с помощью средства оценки серверов службы "Миграция Azure".

**Оценка** | **Сведения** | **Data**
--- | --- | ---
**На основе производительности** | Оценки на основе собранных данных производительности | **Рекомендуемый размер виртуальной машины**: на основе данных об использовании ЦП и памяти.<br/><br/> **Рекомендуемый тип диска (управляемый диск цен. категории "Стандартный" или "Премиум")** : на основе операций ввода-вывода в секунду и пропускной способности локальных дисков.
**Как в локальной среде** | Оценки на основе определения размера в локальной среде | **Рекомендуемый размер виртуальной машины**: на основе размера локальной виртуальной машины.<br/><br> **Рекомендуемый тип диска**: на основе типа хранилища, выбранного для оценки.

## <a name="run-an-assessment"></a>Запуск оценки

Запустите оценку следующим образом:

1. Просмотрите [рекомендации](best-practices-assessment.md) для создания оценок.
1. На вкладке **Серверы** на плитке **Миграция Azure: оценка серверов** щелкните **Оценка**.

   ![Расположение кнопки оценки](./media/tutorial-assess-vmware/assess.png)

1. В разделе **Оценка серверов** укажите имя для оценки.
1. Щелкните **Просмотреть все**, чтобы проверить свойства оценки.

   ![Свойства оценки](./media/tutorial-assess-vmware/view-all.png)

1. В разделе **Создание или выбор группы** выберите **Создать** и укажите имя группы. Группа собирает одну или несколько виртуальных машин для оценки.
1. В разделе **Добавление компьютеров в группу** выберите виртуальные машины, которые необходимо добавить в группу.
1. Щелкните **Создать оценку**, чтобы создать группу и запустить оценку.

   ![Оценка серверов](./media/tutorial-assess-vmware/assessment-create.png)

1. После создания оценки просмотрите ее, выбрав **Серверы** > **Azure Migrate: Server Assessment** >  (Миграция Azure: оценка сервера) **Оценки**.
1. Щелкните **Экспорт оценки**, чтобы скачать оценку в виде файла Excel.

## <a name="review-an-assessment"></a>Проверка оценки

В результатах оценки описывается:

- **готовность к работе в Azure**: подходят ли виртуальные машины для миграции в Azure;
- **примерную ежемесячную стоимость**: оценочную месячная стоимость вычислений и хранения для работы виртуальных машин в Azure;
- **примерную стоимость хранилища в месяц**: расчетную стоимость хранилища дисков после миграции.

Чтобы просмотреть оценку, сделайте следующее.

1. В разделе **Цели миграции** > **Серверы** щелкните **Оценки** в области **Миграция Azure: Server Assessment** (Миграция Azure: оценка сервера).
1. В разделе **Оценки** щелкните оценку, чтобы открыть сведения о ней.

   ![Сводка оценки](./media/tutorial-assess-vmware/assessment-summary.png)

### <a name="review-azure-readiness"></a>Проверка готовности к работе в Azure

1. В разделе **Готовность к работе в Azure** проверьте, готовы ли виртуальные машины к миграции в Azure.
1. Проверьте состояние виртуальной машины:
    - **Готово к работе в Azure**: используется, когда служба "Миграция Azure" рекомендует размер и стоимость виртуальных машин в оценке.
    - **Готово при выполнении условий**: отображает проблемы и предлагаемые способы исправления.
    - **Не готово для Azure**: отображает проблемы и предлагаемые способы исправления.
    - **Уровень готовности неизвестен**: используется, когда служба "Миграция Azure" не может оценить готовность из-за проблем с доступностью данных.

1. Щелкните состояние **Готовность к работе в Azure**. Вы можете просмотреть сведения о готовности виртуальной машины. Также здесь можно развернуть подробные сведения о виртуальной машине, включая параметры вычислений, хранилища и сети.

### <a name="review-cost-details"></a>Просмотр сведений о затратах

В сводке по оценке отображается оценочная стоимость вычислений и хранения для запущенных виртуальных машин в Azure. Затраты объединяются для всех виртуальных машин в оцениваемой группе. Вы можете развернуть подробные сведения об определенных виртуальных машинах.

> [!NOTE]
> Оценки стоимости основываются на рекомендациях по размеру и параметрам компьютера и его дисков. Оценки учитывают выполнение локальных виртуальных машин в качестве виртуальных машин IaaS. Средство "Оценка серверов" службы "Миграция Azure" не учитывает затраты на PaaS или SaaS.

Совокупные затраты на хранение для оцениваемой группы предусматривают использование разных типов дисков хранения. 

### <a name="review-confidence-rating"></a>Просмотр рейтинга достоверности

Средство оценки серверов службы "Миграция Azure" присваивает параметрам производительности оценку достоверности в диапазоне от 1 звезды (самый низкий уровень) до 5 звезд (самый высокий).

![Оценка достоверности](./media/tutorial-assess-vmware/confidence-rating.png)

Оценка достоверности помогает определить надежность предоставленных рекомендаций по выбору размера. Эта оценка основывается на доступности точек данных, необходимых для вычисления оценки.

**Доступность точки данных** | **Оценка достоверности**
--- | ---
0–20 % | 1 звезда
21–40 % | 2 звезды
41–60 % | 3 звезды
61–80 % | 4 звезды
81–100 % | 5 звезд

См. сведения о [рекомендациях для оценки достоверности](best-practices-assessment.md#best-practices-for-confidence-ratings).

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве описано, как настроить устройство службы "Миграция Azure", а также создать и проверить оценку.

Чтобы узнать, как перенести виртуальные машины VMware в Azure с помощью средства миграции серверов службы "Миграция Azure", перейдите к третьему руководству этой серии.

> [!div class="nextstepaction"]
> [Migrate VMware VMs to Azure (agentless)](./tutorial-migrate-vmware.md) (Перенос виртуальных машин VMware (без агента))
