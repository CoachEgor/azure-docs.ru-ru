---
title: Архитектура приборов Azure Migrate
description: Предоставляет обзор прибора Azure Migrate, используемого для оценки серверов и миграции.
ms.topic: conceptual
ms.date: 03/23/2020
ms.openlocfilehash: d55d123bb056b46b5e78dd8ac836eeaf9b42fe70
ms.sourcegitcommit: 0553a8b2f255184d544ab231b231f45caf7bbbb0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2020
ms.locfileid: "80389024"
---
# <a name="azure-migrate-appliance-architecture"></a>Архитектура приборов Azure Migrate

В этой статье описывается архитектура и процессы приборов Azure Migrate. Прибор Azure Migrate — это легкий прибор, развернутый в помещениях для обнаружения вс-мазадок и физических серверов для миграции в Azure. 

## <a name="deployment-scenarios"></a>Сценарии развертывания

Прибор Azure Migrate используется в следующих сценариях.

**Сценарий** | **Инструмент** | **Используется для** 
--- | --- | ---
**VMware VM оценка** | Миграция Azure:Оценка сервера | Откройте для себя VMware VMs.<br/><br/> Откройте для себя машинные приложения и зависимости.<br/><br/> Собирайте метаданные машины и метаданные производительности и отправляйте в Azure.
**VMware VM миграция (без агента)** | Миграция Azure:Миграция серверов | Откройте для себя VMware VMs<br/><br/>  Replicate VMware VMs с [безагентной миграцией.](server-migrate-overview.md)
**Оценка Hyper-V VM** | Миграция Azure:Оценка сервера | Откройте для себя Hyper-V VM.<br/><br/> Собирайте метаданные машины и метаданные производительности и отправляйте в Azure.
**Физический компьютер** |  Миграция Azure:Оценка сервера |  Откройте для себя физические серверы.<br/><br/> Собирайте метаданные машины и метаданные производительности и отправляйте в Azure.

## <a name="appliance-components"></a>Компоненты приборов

Прибор имеет ряд компонентов.

- **Приложение управления**: Это веб-приложение для ввода пользователем во время развертывания прибора. Используется при оценке машин для миграции в Azure.
- **Агент обнаружения**: Агент собирает данные конфигурации машины. Используется при оценке машин для миграции в Azure. 
- **Агент оценки**: Агент собирает данные о производительности. Используется при оценке машин для миграции в Azure.
- **Агент DRA**: оркеструет репликацию VM и координирует связь между реплицированными машинами и Azure. Используется только при репликации VMware VMs в Azure с использованием бесагентной миграции.
- **Шлюз**: Отправляет реплицированные данные в Azure. Используется только при репликации VMware VMs в Azure с использованием бесагентной миграции.
- **Служба автоматического обновления**: Обновления компонентов прибора (работает каждые 24 часа).



## <a name="appliance-deployment"></a>Развертывание приборов

- Прибор Azure Migrate можно настроить с помощью шаблона для [Hyper-V](how-to-set-up-appliance-hyper-v.md) или [VMware](how-to-set-up-appliance-vmware.md) или с помощью установки скриптов PowerShell для [VMware/Hyper-V,](deploy-appliance-script.md)а также для [физических серверов.](how-to-set-up-appliance-physical.md) 
- Требования к поддержке приборов и предпосылки развертывания суммируются в [матрице поддержки приборов.](migrate-appliance.md)


## <a name="appliance-registration"></a>Регистрация приборов

Во время настройки прибора регистрируется прибор с помощью Azure Migrate, и возникают действия, обобщенные в таблице.

**Действие** | **Подробно** | **Разрешения**
--- | --- | ---
**Регистрация поставщиков источников** | Поставщики этих ресурсов зарегистрированы в подписке, выбираемый при настройке прибора: Microsoft.OffAzure, Microsoft.Migrate и Microsoft.KeyVault.<br/><br/> Регистрация поставщика ресурсов настраивает подписку для работы с поставщиком ресурсов. | Для регистрации поставщиков ресурсов требуется роль участника или владельца в подписке.
**Создание приложения-коммуникации Azure AD** | Azure Migrate создает приложение Azure Active Directory (Azure AD) для связи (аутентификация и авторизация) между агентами, работающими на приборе, и их соответствующими службами, работающими в Azure.<br/><br/> Это приложение не имеет привилегий, чтобы сделать Azure менеджер ресурсов вызова, или RBAC доступ на любом ресурсе. | Для создания приложения необходимы [эти разрешения](tutorial-prepare-vmware.md#assign-permissions-to-register-the-appliance) для Azure Migrate.
**Создание приложений Azure AD-Key** | Это приложение создано только для безагентной миграции VMw VMw в Azure.<br/><br/> Он используется исключительно для доступа к хранилищу ключей, созданного в подписке пользователя для бесагентной миграции.<br/><br/> Он имеет доступ к RBAC в хранилище ключей Azure (создан в клиенте), когда открытие инициируется с прибора. | Для создания приложения необходимы [эти разрешения](tutorial-prepare-vmware.md#assign-permissions-to-register-the-appliance) для Azure Migrate.



## <a name="collected-data"></a>Собранные данные

Данные, собранные клиентом для всех сценариев развертывания, обобщаются в [матрице поддержки приборов.](migrate-appliance.md)

## <a name="discovery-and-collection-process"></a>Процесс обнаружения и сбора

![Architecture](./media/migrate-appliance-architecture/architecture.png)

Прибор общается с серверами vCenter и хостами Hyper-V/кластером, используя следующий процесс.

1. **Начало открытия:**
    - Когда вы начинаете открытие на приборе Hyper-V, он общается с хостами Hyper-V на портах WinRM 5985 (HTTP) и 5986 (HTTPS).
    - Когда вы начинаете открытие на приборе VMware, он общается с сервером vCenter на порте TCP 443 по умолчанию. ЕСЛИ сервер vCenter слушает на другом порту, вы можете настроить его в приложении для веб-приложений.
2. **Сбор метаданных и данных о производительности:**
    - Прибор использует сеанс общей информационной модели (CIM) для сбора данных Hyper-V VM с хоста Hyper-V в портах 5985 и 5986.
    - Прибор общается с портом 443 по умолчанию, чтобы собрать данные VMware VM с сервера vCenter Server.
3. **Отправка данных:** Прибор отправляет собранные данные в Azure Migrate Server Assessment и Azure Migrate Server Migration через порт SSL 443. Прибор может подключиться к Azure через Интернет, или вы можете использовать ExpressRoute с публичным/Microsoft пирингом.
    - Для данных о производительности прибор собирает данные об использовании в режиме реального времени.
        - Данные о производительности собираются каждые 20 секунд для VMware и каждые 30 секунд для Hyper-V для каждой метрики производительности.
        - Собранные данные сворачиваются для создания единой точки данных в течение 10 минут.
        - Значение пикового использования выбирается из всех 20/30-секундных точек данных и отправляется в Azure для расчета оценки.
        - На основе процентильного значения, указанного в свойствах оценки (50th/90th/95th/99th), десятиминутные точки сортируются в порядке возрастания, и соответствующее значение процентиля используется для вычисления оценки
    - Для «Миграции серверов» прибор начинает собирать данные VM и воспроизводит их в Azure.
4. **Оценить и перенести:** Теперь можно создавать оценки из метаданных, собранных прибором, с помощью оценки Azure Migrate Server. Кроме того, можно также начать мигрировать vMware VMs с помощью Azure Migrate Server Migration для организации репликации VM без агента.





## <a name="appliance-upgrades"></a>Модернизация приборов

Аппарат обновляется по мере обновления агентов Azure Migrate, работающих на приборе. Это происходит автоматически, потому что автоматическое обновление включено на приборе по умолчанию. Можно изменить эту настройку по умолчанию, чтобы обновить агенты вручную.

Вы выключаете автоматическое обновление в реестре, установив ключ HKEY_LOCAL_MACHINE»-SOFTWARE-Microsoft-AzureAppliance "AutoUpdate" ключом к 0 (DWORD).

 

## <a name="next-steps"></a>Дальнейшие действия

[Просмотрите](migrate-appliance.md) матрицу поддержки прибора.

