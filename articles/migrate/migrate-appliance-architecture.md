---
title: Архитектура устройства службы "Миграция Azure"
description: Общие сведения об устройстве Миграции Azure, используемом для оценки и миграции серверов.
ms.topic: conceptual
ms.date: 06/09/2020
ms.openlocfilehash: 028e0e5b0bbf83c08b5f9cd6d24d7914513ae89a
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "91322263"
---
# <a name="azure-migrate-appliance-architecture"></a>Архитектура устройства службы "Миграция Azure"

В этой статье описывается архитектура и процессы устройства "миграция Azure". Устройство миграции Azure — это упрощенное устройство, которое развертывается локально, чтобы обнаружить виртуальные машины и физические серверы для миграции в Azure. 

## <a name="deployment-scenarios"></a>Сценарии развертывания

Устройство Миграции Azure используется в приведенных ниже сценариях.

**Сценарий** | **Инструмент** | **Область использования** 
--- | --- | ---
**Оценка виртуальных машин VMware** | Миграция Azure: оценка серверов | Обнаружение виртуальных машин VMware.<br/><br/> Обнаружение приложений и зависимостей компьютера.<br/><br/> Собирайте метаданные компьютера и метаданные производительности и отправляйте их в Azure.
**Миграция виртуальных машин VMware (без агента)** | Миграция Azure: миграция серверов | Обнаружение виртуальных машин VMware<br/><br/>  Репликация виртуальных машин VMware с [миграцией без агента](server-migrate-overview.md).
**Оценка виртуальных машин Hyper-V** | Миграция Azure: оценка серверов | Обнаружение виртуальных машин Hyper-V.<br/><br/> Собирайте метаданные компьютера и метаданные производительности и отправляйте их в Azure.
**Физический компьютер** |  Миграция Azure: оценка серверов |  Обнаружение физических серверов.<br/><br/> Собирайте метаданные компьютера и метаданные производительности и отправляйте их в Azure.

## <a name="appliance-components"></a>Компоненты устройства

Устройство имеет ряд компонентов.

- **Приложение для управления**. Это веб-приложение для ввода данных пользователем во время развертывания устройства. Он используется для оценки локальных компьютеров перед миграцией в Azure.
- **Агент обнаружения**. Агент собирает данные конфигурации компьютеров. Он используется для оценки локальных компьютеров перед миграцией в Azure. 
- **Агент сборщика**: агент собирает данные о производительности. Он используется для оценки локальных компьютеров перед миграцией в Azure.
- **Агент DRA**. Управляет репликацией виртуальных машин и координирует взаимодействие между реплицированными компьютерами и Azure. Используется только при репликации виртуальных машин VMware в Azure с помощью миграции без агента.
- **Шлюз**. Отправляет реплицированные данные в Azure. Используется только при репликации виртуальных машин VMware в Azure с помощью миграции без агента.
- **Служба автоматического обновления**. Обновляет компоненты устройства (запускается каждые 24 часа).



## <a name="appliance-deployment"></a>Развертывание устройства

- Устройство для миграции Azure можно настроить с помощью шаблона для [Hyper-V](how-to-set-up-appliance-hyper-v.md) или [VMware](how-to-set-up-appliance-vmware.md) либо с помощью установщика сценариев PowerShell для VMware, [Hyper-V](deploy-appliance-script.md)и [физических серверов](how-to-set-up-appliance-physical.md). 
- Требования к поддержке устройства и необходимые компоненты для развертывания приведены в [матрице поддержки устройств](migrate-appliance.md).


## <a name="appliance-registration"></a>Регистрация устройства

Во время настройки устройства необходимо зарегистрировать устройство в службе "миграция Azure" и выполнить действия, приведенные в таблице.

**Действие** | **Сведения** | **Разрешения**
--- | --- | ---
**Регистрация поставщиков источников** | Эти поставщики ресурсов регистрируются в подписке, выбранной во время настройки устройства: Microsoft. Оффазуре, Microsoft. Migrate и Microsoft. KeyVault.<br/><br/> Регистрация поставщика ресурсов настраивает подписку для работы с поставщиком ресурсов. | Для регистрации поставщиков ресурсов требуется роль участника или владельца в подписке.
**Создание приложения Azure AD — обмен данными** | Служба "миграция Azure" создает приложение Azure Active Directory (Azure AD) для обмена данными (проверка подлинности и авторизация) между агентами, работающими на устройстве, и соответствующими службами, работающими в Azure.<br/><br/> Это приложение не имеет привилегий для выполнения Azure Resource Managerных вызовов или доступа RBAC к любому ресурсу. | Для создания приложения необходимы [эти разрешения](tutorial-prepare-vmware.md#assign-permissions-to-create-azure-ad-apps) для службы "миграция Azure".
**Создание приложений Azure AD — хранилище ключей** | Это приложение создается только для переноса виртуальных машин VMware в Azure без агента.<br/><br/> Он используется исключительно для доступа к хранилищу ключей, созданному в подписке пользователя для миграции без агента.<br/><br/> Он имеет доступ RBAC к хранилищу ключей Azure (созданному в клиенте клиента), когда обнаружение инициируется на устройстве. | Для создания приложения необходимы [эти разрешения](tutorial-prepare-vmware.md#assign-permissions-to-create-a-key-vault) для службы "миграция Azure".



## <a name="collected-data"></a>Собранные данные

Данные, собираемые клиентом для всех сценариев развертывания, описаны в [матрице поддержки устройств](migrate-appliance.md).

## <a name="discovery-and-collection-process"></a>Процесс обнаружения и сбора

![Architecture](./media/migrate-appliance-architecture/architecture1.png)

Устройство взаимодействует с серверами vCenter и узлами или кластером Hyper-V, используя следующий процесс.

1. **Запустить обнаружение**:
    - При запуске обнаружения на устройстве Hyper-V оно взаимодействует с узлами Hyper-V на порте WinRM 5985 (HTTP).
    - При запуске обнаружения на устройстве VMware оно по умолчанию взаимодействует с сервером vCenter через TCP-порт 443. Если сервер vCenter Server прослушивает другой порт, его можно настроить в веб-приложении устройства.
2. **Сбор данных о метаданных и производительности**:
    - Устройство использует сеанс модель CIM (CIM) для сбора данных виртуальной машины Hyper-v с узла Hyper-V через порт 5985.
    - По умолчанию устройство взаимодействует с портом 443 для сбора данных виртуальной машины VMware из vCenter Server.
3. **Send Data (отправить данные**). устройство отправляет собранные данные в Azure Migration Server оценок и выполняет миграцию сервера миграции Azure через порт SSL 443. Устройство может подключаться к Azure через Интернет или через ExpressRoute (требуется пиринг Майкрософт).
    - Для данных производительности устройство собирает данные об использовании в режиме реального времени.
        - Данные о производительности собираются каждые 20 секунд для VMware и каждые 30 секунд для Hyper-V для каждой метрики производительности.
        - Собранные данные суммируются для создания одной точки данных в течение 10 минут.
        - Значение Пиковая загрузка выбирается со всех 20-секундных точек данных и отправляется в Azure для вычисления оценки.
        - На основе значения процентиля, указанного в свойствах оценки (50/90/95 процентиль/99-м), точки с десятью минутами сортируются в возрастающем порядке, а соответствующее значение процентиля используется для вычисления оценки.
    - Для миграции сервера устройство начинает сбор данных виртуальной машины и реплицирует их в Azure.
4. **Оценка и миграция**. Теперь вы можете создавать оценки на основе метаданных, собранных устройством, с помощью функции "Миграция серверов Azure". Кроме того, можно также приступить к переносу виртуальных машин VMware с помощью миграции сервера миграция Azure для координации репликации виртуальных машин без агента.

## <a name="appliance-upgrades"></a>Обновление устройства

Устройство обновляется при обновлении агентов Миграции Azure, работающих на устройстве. Это происходит автоматически, так как автоматическое обновление включено на устройстве по умолчанию. Вы можете изменить этот параметр по умолчанию, чтобы обновить агенты вручную.

Вы отключаете автоматическое обновление в реестре, присвоив параметру HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\AzureAppliance "Автообновление" значение 0 (DWORD).


## <a name="next-steps"></a>Дальнейшие шаги

[Ознакомьтесь](migrate-appliance.md) с матрицей поддержки устройств.

