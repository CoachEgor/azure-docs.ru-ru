---
title: Архитектура устройства службы "Миграция Azure"
description: Содержит общие сведения об устройстве миграции Azure, используемом при оценке и миграции сервера.
ms.topic: conceptual
ms.date: 03/23/2020
ms.openlocfilehash: d55d123bb056b46b5e78dd8ac836eeaf9b42fe70
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "80389024"
---
# <a name="azure-migrate-appliance-architecture"></a>Архитектура устройства службы "Миграция Azure"

В этой статье описывается архитектура и процессы устройства "миграция Azure". Устройство миграции Azure — это упрощенное устройство, которое развертывается локально, чтобы обнаружить виртуальные машины и физические серверы для миграции в Azure. 

## <a name="deployment-scenarios"></a>Сценарии развертывания

Устройство "миграция Azure" используется в следующих сценариях.

**Сценарий** | **Инструмент** | **Используется для** 
--- | --- | ---
**Оценка виртуальных машин VMware** | Служба "миграция Azure": Оценка сервера | Обнаружение виртуальных машин VMware.<br/><br/> Обнаружение приложений и зависимостей компьютера.<br/><br/> Собирайте метаданные компьютера и метаданные производительности и отправляйте их в Azure.
**Миграция виртуальных машин VMware (без агента)** | Миграция Azure: миграция сервера | Обнаружение виртуальных машин VMware<br/><br/>  Репликация виртуальных машин VMware с [миграцией без агента](server-migrate-overview.md).
**Оценка виртуальных машин Hyper-V** | Служба "миграция Azure": Оценка сервера | Обнаружение виртуальных машин Hyper-V.<br/><br/> Собирайте метаданные компьютера и метаданные производительности и отправляйте их в Azure.
**Физический компьютер** |  Служба "миграция Azure": Оценка сервера |  Обнаружение физических серверов.<br/><br/> Собирайте метаданные компьютера и метаданные производительности и отправляйте их в Azure.

## <a name="appliance-components"></a>Компоненты устройства

Устройство имеет ряд компонентов.

- **Приложение управления**: это веб-приложение для ввода данных пользователем во время развертывания устройства. Используется при оценке компьютеров для миграции в Azure.
- **Агент обнаружения**. агент собирает данные конфигурации компьютера. Используется при оценке компьютеров для миграции в Azure. 
- **Агент оценки**: агент собирает данные о производительности. Используется при оценке компьютеров для миграции в Azure.
- **Агент DRA**: управляет РЕПЛИКАЦИЕЙ виртуальной машины и координирует взаимодействие между реплицированными компьютерами и Azure. Используется только при репликации виртуальных машин VMware в Azure с помощью миграции без агента.
- **Шлюз**: отправляет реплицированные данные в Azure. Используется только при репликации виртуальных машин VMware в Azure с помощью миграции без агента.
- **Автоматическое обновление службы**: обновляет компоненты устройства (выполняется каждые 24 часа).



## <a name="appliance-deployment"></a>Развертывание устройства

- Устройство для миграции Azure можно настроить с помощью шаблона для [Hyper-V](how-to-set-up-appliance-hyper-v.md) или [VMware](how-to-set-up-appliance-vmware.md) либо с помощью установщика сценариев PowerShell для VMware, [Hyper-V](deploy-appliance-script.md)и [физических серверов](how-to-set-up-appliance-physical.md). 
- Требования к поддержке устройства и необходимые компоненты для развертывания приведены в [матрице поддержки устройств](migrate-appliance.md).


## <a name="appliance-registration"></a>Регистрация устройства

Во время настройки устройства необходимо зарегистрировать устройство в службе "миграция Azure" и выполнить действия, приведенные в таблице.

**Действие** | **Сведения** | **Разрешения**
--- | --- | ---
**Регистрация поставщиков источников** | Эти поставщики ресурсов регистрируются в подписке, выбранной во время настройки устройства: Microsoft. Оффазуре, Microsoft. Migrate и Microsoft. KeyVault.<br/><br/> Регистрация поставщика ресурсов настраивает подписку для работы с поставщиком ресурсов. | Для регистрации поставщиков ресурсов требуется роль участника или владельца в подписке.
**Создание приложения Azure AD — обмен данными** | Служба "миграция Azure" создает приложение Azure Active Directory (Azure AD) для обмена данными (проверка подлинности и авторизация) между агентами, работающими на устройстве, и соответствующими службами, работающими в Azure.<br/><br/> Это приложение не имеет привилегий для выполнения Azure Resource Managerных вызовов или доступа RBAC к любому ресурсу. | Для создания приложения необходимы [эти разрешения](tutorial-prepare-vmware.md#assign-permissions-to-register-the-appliance) для службы "миграция Azure".
**Создание приложений Azure AD — хранилище ключей** | Это приложение создается только для переноса виртуальных машин VMware в Azure без агента.<br/><br/> Он используется исключительно для доступа к хранилищу ключей, созданному в подписке пользователя для миграции без агента.<br/><br/> Он имеет доступ RBAC к хранилищу ключей Azure (созданному в клиенте клиента), когда обнаружение инициируется на устройстве. | Для создания приложения необходимы [эти разрешения](tutorial-prepare-vmware.md#assign-permissions-to-register-the-appliance) для службы "миграция Azure".



## <a name="collected-data"></a>Собранные данные

Данные, собираемые клиентом для всех сценариев развертывания, описаны в [матрице поддержки устройств](migrate-appliance.md).

## <a name="discovery-and-collection-process"></a>Процесс обнаружения и сбора

![Architecture](./media/migrate-appliance-architecture/architecture.png)

Устройство взаимодействует с серверами vCenter и узлами или кластером Hyper-V, используя следующий процесс.

1. **Запустить обнаружение**:
    - При запуске обнаружения на устройстве Hyper-V оно взаимодействует с узлами Hyper-V на портах WinRM 5985 (HTTP) и 5986 (HTTPS).
    - При запуске обнаружения на устройстве VMware оно по умолчанию взаимодействует с сервером vCenter через TCP-порт 443. Если сервер vCenter Server прослушивает другой порт, его можно настроить в веб-приложении устройства.
2. **Сбор данных о метаданных и производительности**:
    - Устройство использует сеанс модель CIM (CIM) для сбора данных виртуальной машины Hyper-v с узла Hyper-V на портах 5985 и 5986.
    - По умолчанию устройство взаимодействует с портом 443 для сбора данных виртуальной машины VMware из vCenter Server.
3. **Send Data (отправить данные**). устройство отправляет собранные данные в Azure Migration Server оценок и выполняет миграцию сервера миграции Azure через порт SSL 443. Устройство может подключаться к Azure через Интернет. также можно использовать ExpressRoute с общедоступным или пирингом Майкрософт.
    - Для данных производительности устройство собирает данные об использовании в режиме реального времени.
        - Данные о производительности собираются каждые 20 секунд для VMware и каждые 30 секунд для Hyper-V для каждой метрики производительности.
        - Собранные данные суммируются для создания одной точки данных в течение 10 минут.
        - Значение Пиковая загрузка выбирается со всех 20-секундных точек данных и отправляется в Azure для вычисления оценки.
        - На основе значения процентиля, указанного в свойствах оценки (50/90/95 процентиль/99-м), точки с десятью минутами сортируются в возрастающем порядке, а соответствующее значение процентиля используется для вычисления оценки.
    - Для миграции сервера устройство начинает сбор данных виртуальной машины и реплицирует их в Azure.
4. **Оценка и миграция**. Теперь вы можете создавать оценки на основе метаданных, собранных устройством, с помощью функции "Миграция серверов Azure". Кроме того, можно также приступить к переносу виртуальных машин VMware с помощью миграции сервера миграция Azure для координации репликации виртуальных машин без агента.





## <a name="appliance-upgrades"></a>Обновление устройства

Устройство обновляется, так как агенты службы "миграция Azure", работающие на устройстве, обновляются. Это происходит автоматически, так как автоматическое обновление включено на устройстве по умолчанию. Вы можете изменить этот параметр по умолчанию, чтобы обновить агенты вручную.

Вы отключаете автоматическое обновление в реестре, присвоив параметру HKEY_LOCAL_MACHINE \Софтваре\микрософт\азуреапплианце "Автообновление" значение 0 (DWORD).

 

## <a name="next-steps"></a>Дальнейшие действия

[Ознакомьтесь](migrate-appliance.md) с матрицей поддержки устройств.

