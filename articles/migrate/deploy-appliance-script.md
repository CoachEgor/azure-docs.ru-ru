---
title: Настройка устройства "миграция Azure" с помощью сценария
description: Узнайте, как настроить устройство для миграции Azure с помощью сценария.
ms.topic: article
ms.date: 04/16/2020
ms.openlocfilehash: d5603aaef0a1c3e784f455777302c23e6724fbe7
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "85052472"
---
# <a name="set-up-an-appliance-with-a-script"></a>Настройка устройства с помощью сценария

Выполните инструкции из этой статьи, чтобы создать [устройство миграции Azure](deploy-appliance.md) для оценки и миграции виртуальных машин VMware и виртуальных машин Hyper-V. Запустите сценарий для создания устройства и убедитесь, что он может подключиться к Azure. 

Вы можете развернуть устройство для виртуальных машин VMware и Hyper-V с помощью сценария или с помощью шаблона, скачанного из портал Azure. Использование скрипта полезно, если не удается создать виртуальную машину с помощью скачанного шаблона.

- Чтобы использовать шаблон, следуйте инструкциям в руководствах по [VMware](tutorial-prepare-vmware.md) или [Hyper-V](tutorial-prepare-hyper-v.md).
- Чтобы настроить устройство для физических серверов, можно использовать только скрипт. Выполните инструкции из [этой статьи](how-to-set-up-appliance-physical.md).
- Чтобы настроить устройство в облаке Azure для государственных организаций, выполните инструкции из [этой статьи](deploy-appliance-script-government.md).

## <a name="prerequisites"></a>Предварительные условия

Этот сценарий настраивает устройство миграции Azure на существующем физическом компьютере или виртуальной машине.

- Компьютер, который будет работать как устройство, должен соответствовать следующим требованиям к оборудованию и ОС:

Сценарий | Requirements (Требования)
--- | ---
VMware | Windows Server 2016 с 32 ГБ памяти, восемь виртуальных ЦП, около 80 ГБ дискового накопителя
Hyper-V | Windows Server 2016 с 16 ГБ памяти, восемь виртуальных ЦП, около 80 ГБ дискового накопителя
- Компьютеру также нужен внешний виртуальный коммутатор. Для этого требуется статический или динамический IP-адрес, а также доступ к Интернету.
- Перед развертыванием устройства ознакомьтесь с подробными сведениями о требованиях к устройству для [виртуальных машин VMware](migrate-appliance.md#appliance---vmware), [виртуальных машин Hyper-V](migrate-appliance.md#appliance---hyper-v).
- Не запускайте сценарий на существующем устройстве миграции Azure.

## <a name="set-up-the-appliance-for-vmware"></a>Настройка устройства для VMware

Чтобы настроить устройство для VMware, скачайте zip-файл с именем AzureMigrateInstaller.zip [отсюда](https://go.microsoft.com/fwlink/?linkid=2105112)и извлеките его содержимое. Запустите сценарий PowerShell, чтобы запустить веб-приложение устройства. Настройте устройство и настройте его в первый раз. Затем вы регистрируете устройство в проекте службы "миграция Azure".


### <a name="verify-file-security"></a>Проверка безопасности файлов

Прежде чем развертывать сжатый ZIP-файл, убедитесь, что он не поврежден.

1. На компьютере, на который был скачан файл, откройте командное окно с правами администратора.
2. Выполните следующую команду, чтобы создать хэш ZIP-файла.
    - ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
    - Пример: ```C:\>CertUtil -HashFile C:\Users\administrator\Desktop\AzureMigrateInstaller.zip SHA256```
3. Проверьте последнюю версию и скрипт устройства для общедоступного облака Azure:

    **Алгоритм** | **Загрузить** | **SHA256**
    --- | --- | ---
    VMware (63,1 ГБ) | [Последняя версия](https://go.microsoft.com/fwlink/?linkid=2105112) | 0a27adf13cc5755e4b23df0c05732c6ac08d1fe8850567cb57c9906fbc3b85a0



### <a name="run-the-script"></a>Выполнение скрипта

Вот что делает сценарий:

- Устанавливает агенты и веб-приложение.
- Устанавливает роли Windows, включая службу активации Windows, IIS и интегрированную среду сценариев PowerShell.
- Скачивает и устанавливает перезаписываемый модуль IIS. [Подробнее.](https://www.microsoft.com/download/details.aspx?id=7435)
- Обновляет раздел реестра (HKLM) с постоянными параметрами для службы "миграция Azure".
- Создает файлы журналов и конфигурации следующим образом:
    - **Файлы конфигурации**:%програмдата%\микрософт азуре\конфиг
    - **Файлы журналов**:%програмдата%\микрософт азуре\логс

Выполните следующее, чтобы запустить этот сценарий.

1. Извлеките сжатый ZIP-файл в папку на компьютере, на котором будет размещено устройство. Убедитесь, что скрипт не выполняется на виртуальной машине в существующем устройстве Миграции Azure.
2. Запустите PowerShell на компьютере с привилегиями администратора (с повышенными правами).
3. Измените каталог PowerShell на папку, содержащую содержимое, извлеченное из скачанного ZIP-файла.
4. Выполните **AzureMigrateInstaller.ps1**скрипта следующим образом:

    ``` PS C:\Users\administrator\Desktop\AzureMigrateInstaller> AzureMigrateInstaller.ps1 -scenario VMware ```
   
5. После успешного выполнения скрипта запускается веб-приложение устройства, которое позволяет настроить устройство. При возникновении проблем просмотрите журналы скриптов в файла c:\ProgramData\Microsoft Азуре\логс\ AzureMigrateScenarioInstaller_<em>timestamp</em>. log.

### <a name="verify-access"></a>Проверка доступа

Убедитесь, что устройство может подключаться к URL-адресам Azure для [общедоступного](migrate-appliance.md#public-cloud-urls) облака.

## <a name="set-up-the-appliance-for-hyper-v"></a>Настройка устройства для Hyper-V

Чтобы настроить устройство для Hyper-V, скачайте zip-файл с именем AzureMigrateInstaller.zip [отсюда](https://go.microsoft.com/fwlink/?linkid=2105112)и извлеките его содержимое. Запустите сценарий PowerShell, чтобы запустить веб-приложение устройства. Настройте устройство и настройте его в первый раз. Затем вы регистрируете устройство в проекте службы "миграция Azure".


### <a name="verify-file-security"></a>Проверка безопасности файлов

Прежде чем развертывать сжатый ZIP-файл, убедитесь, что он не поврежден.

1. На компьютере, на который был скачан файл, откройте командное окно с правами администратора.
2. Выполните следующую команду, чтобы создать хэш ZIP-файла.
    - ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
    - Пример: ```C:\>CertUtil -HashFile C:\Users\administrator\Desktop\AzureMigrateInstaller.zip SHA256```

3. Проверьте последнюю версию и скрипт устройства для общедоступного облака Azure:

    **Сценарий** | **Загрузить** | **SHA256**
    --- | --- | ---
    Hyper-V (63,1 МБ) | [Последняя версия](https://go.microsoft.com/fwlink/?linkid=2105112) |  572be425ea0aca69a9aa8658c950bc319b2bdbeb93b440577264500091c846a1

### <a name="run-the-script"></a>Выполнение скрипта

Вот что делает сценарий:

- Устанавливает агенты и веб-приложение.
- Устанавливает роли Windows, включая службу активации Windows, IIS и интегрированную среду сценариев PowerShell.
- Скачивает и устанавливает перезаписываемый модуль IIS. [Подробнее.](https://www.microsoft.com/download/details.aspx?id=7435)
- Обновляет раздел реестра (HKLM) с постоянными параметрами для службы "миграция Azure".
- Создает файлы журналов и конфигурации следующим образом:
    - **Файлы конфигурации**:%програмдата%\микрософт азуре\конфиг
    - **Файлы журналов**:%програмдата%\микрософт азуре\логс

Выполните следующее, чтобы запустить этот сценарий.

1. Извлеките сжатый ZIP-файл в папку на компьютере, на котором будет размещено устройство. Убедитесь, что скрипт не выполняется на виртуальной машине в существующем устройстве Миграции Azure.
2. Запустите PowerShell на компьютере с привилегиями администратора (с повышенными правами).
3. Измените каталог PowerShell на папку, содержащую содержимое, извлеченное из скачанного ZIP-файла.
4. Выполните **AzureMigrateInstaller.ps1**скрипта следующим образом:``` PS C:\Users\administrator\Desktop\AzureMigrateInstaller> AzureMigrateInstaller.ps1 -scenario Hyperv ```
   
5. После успешного выполнения скрипта запускается веб-приложение устройства, которое позволяет настроить устройство. При возникновении проблем просмотрите журналы скриптов в файла c:\ProgramData\Microsoft Азуре\логс\ AzureMigrateScenarioInstaller_<em>timestamp</em>. log.

### <a name="verify-access"></a>Проверка доступа

Убедитесь, что устройство может подключаться к URL-адресам Azure для [общедоступного](migrate-appliance.md#public-cloud-urls) облака.

## <a name="next-steps"></a>Дальнейшие шаги

После развертывания устройства необходимо настроить его в первый раз и зарегистрировать в проекте службы "миграция Azure".

- Настройте устройство для [VMware](how-to-set-up-appliance-vmware.md#configure-the-appliance).
- Настройте устройство для [Hyper-V](how-to-set-up-appliance-hyper-v.md#configure-the-appliance).
