---
title: Настройка прибора Azure Migrate со скриптом
description: Узнайте, как настроить прибор Azure Migrate со сценарием
ms.topic: article
ms.date: 04/16/2020
ms.openlocfilehash: 0c4d85909bbfa623b5ad8590e973250474d9d95a
ms.sourcegitcommit: acb82fc770128234f2e9222939826e3ade3a2a28
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81676313"
---
# <a name="set-up-an-appliance-with-a-script"></a>Настройка прибора со скриптом

Следуйте этой статье, чтобы создать [прибор Azure Migrate](deploy-appliance.md) для оценки/миграции VMw и Hyper-V VMs. Вы запускаете скрипт для создания прибора и проверяете, можно ли подключиться к Azure. 

Развертывание прибора для VMware и Hyper-V M можно с помощью скрипта или с помощью шаблона, который вы загружаете с портала Azure. Использование скрипта полезно, если вы не можете создать VM с помощью загруженного шаблона.

- Чтобы использовать шаблон, следуйте учебникам для [VMware](tutorial-prepare-vmware.md) или [Hyper-V](tutorial-prepare-hyper-v.md).
- Для настройки прибора для физических серверов можно использовать только скрипт. Следуйте [этой статье](how-to-set-up-appliance-physical.md).
- Чтобы настроить прибор в облаке правительства Azure, следуйте [этой статье](deploy-appliance-script-government.md).

## <a name="prerequisites"></a>Предварительные требования

Скрипт настраивает прибор Azure Migrate на существующую физическую машину или VM.

- Машина, которая будет выступать в качестве устройства, должна работать под управлением Windows Server 2016, с 32 ГБ памяти, восемью vCPUs, около 80 ГБ дискового хранилища и внешним виртуальным коммутатором. Для этого требуется статический или динамический IP-адрес, а также доступ к Интернету.
- Перед развертыванием прибора просмотрите подробные требования к приборам [vMw,](migrate-appliance.md#appliance---vmware) [Hyper-V VMs](migrate-appliance.md#appliance---hyper-v)и [физическим серверам.](migrate-appliance.md#appliance---physical)
- Не запускайте скрипт на существующем приборе Azure Migrate.

## <a name="set-up-the-appliance-for-vmware"></a>Настройка прибора для VMware

Чтобы настроить прибор для VMware, вы загружаете файл с молнии с портала Azure и извлекаете содержимое. Вы запускаете сценарий PowerShell для запуска веб-приложения. Вы настраиваете прибор и настраиваете его в первый раз. Затем вы регистрируете прибор в проекте Azure Migrate.

### <a name="download-the-script"></a>Скачать сценарий

1.  Последовательно выберите разделы **Цели миграции** > **Серверы** > **Azure Migrate: Server Assessment (Миграция Azure: оценка серверов)** и щелкните **Обнаружение**.
2.  В разделе **Обнаружение компьютеров** > **Ваши компьютеры виртуализированы?** щелкните **Да, с использованием VMware vSphere Hypervisor**.
3.  Нажмите **Скачать**, чтобы загрузить почтовый файл. 


### <a name="verify-file-security"></a>Проверка безопасности файлов

Прежде чем развертывать сжатый ZIP-файл, убедитесь, что он не поврежден.

1. На компьютере, на который был скачан файл, откройте командное окно с правами администратора.
2. Выполните следующую команду, чтобы создать хэш ZIP-файла.
    - ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
    - Пример: ```C:\>CertUtil -HashFile C:\Users\administrator\Desktop\AzureMigrateInstaller.zip SHA256```
3. Проверить значение генерируемого хэша. Для последней версии прибора:

    **Алгоритм** | **Значение хэша**
    --- | ---
    MD5 | 1e92ede3e87c03bd148e56a708cdd33f
    SHA256 | a3fa78edc8ff8aff9ab5ae66be1b64e66de7b9f475b6542beef114b20bfdac3c



### <a name="run-the-script"></a>Выполнение скрипта

Вот что делает скрипт:

- Устанавливает агенты и веб-приложение.
- Устанавливает роли Windows, включая службу активации Windows, IIS и PowerShell ISE.
- Загружает и устанавливает модуль IIS, переизменяемый. [Подробнее](https://www.microsoft.com/download/details.aspx?id=7435).
- Обновление ключа реестра (HKLM) с постоянными настройками для Azure Migrate.
- Создает файлы журналов и конфигураций следующим образом:
    - **Файлы конфигурации**: %ProgramData%\Microsoft Azure\Config
    - **Файлы журнала**: %ProgramData%\Microsoft Azure\Logs

Выполните следующее, чтобы запустить этот сценарий.

1. Извлеките застегнутый на молнию файл в папку на машине, которая будет размещать прибор. Убедитесь, что скрипт не запускать на машине на существующем приборе Azure Migrate.
2. Запуск PowerShell на машине, с администратором (повышенные) привилегии.
3. Измените каталог PowerShell в папку, содержащую содержимое, извлеченное из загруженного файла на молнии.
4. Выполнить сценарий **AzureMigrateInstaller.ps1**, следующим образом:

    ``` PS C:\Users\administrator\Desktop\AzureMigrateInstaller> AzureMigrateInstaller.ps1 -scenario VMware ```
   
5. После успешного запуска скрипта он запускает веб-приложение для обработки приборов, чтобы можно было настроить прибор. Если вы столкнулись с какими-либо проблемами, просмотрите журналы скриптов на c: «ProgramData»Microsoft Azure AzureMigrateScenarioInstaller_<em>Timestamp</em>.log.

### <a name="verify-access"></a>Проверка доступа

Убедитесь, что прибор может подключаться к URL-адресам Azure для [общедоступного](migrate-appliance.md#public-cloud-urls) облака.

## <a name="set-up-the-appliance-for-hyper-v"></a>Настройка прибора для Hyper-V

Чтобы настроить прибор для Hyper-V, вы загружаете файл с молнии с портала Azure и извлекаете содержимое. Вы запускаете сценарий PowerShell для запуска веб-приложения. Вы настраиваете прибор и настраиваете его в первый раз. Затем вы регистрируете прибор в проекте Azure Migrate.

### <a name="download-the-script"></a>Скачать сценарий

1.  Последовательно выберите разделы **Цели миграции** > **Серверы** > **Azure Migrate: Server Assessment (Миграция Azure: оценка серверов)** и щелкните **Обнаружение**.
2.  В разделе **Обнаружение компьютеров** > **Ваши компьютеры виртуализированы?** выберите **Yes, with Hyper-V** (Да, с помощью Hyper-V).
3.  Нажмите **Скачать**, чтобы загрузить почтовый файл. 


### <a name="verify-file-security"></a>Проверка безопасности файлов

Прежде чем развертывать сжатый ZIP-файл, убедитесь, что он не поврежден.

1. На компьютере, на который был скачан файл, откройте командное окно с правами администратора.
2. Выполните следующую команду, чтобы создать хэш ZIP-файла.
    - ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
    - Пример: ```C:\>CertUtil -HashFile C:\Users\administrator\Desktop\AzureMigrateInstaller.zip SHA256```

3. Проверить значения генерируемого хэша. Для последней версии прибора:

    **Алгоритм** | **Значение хэша**
    --- | ---
    MD5 | 1e92ede3e87c03bd148e56a708cdd33f
    SHA256 | a3fa78edc8ff8aff9ab5ae66be1b64e66de7b9f475b6542beef114b20bfdac3c

### <a name="run-the-script"></a>Выполнение скрипта

Вот что делает скрипт:

- Устанавливает агенты и веб-приложение.
- Устанавливает роли Windows, включая службу активации Windows, IIS и PowerShell ISE.
- Загружает и устанавливает модуль IIS, переизменяемый. [Подробнее](https://www.microsoft.com/download/details.aspx?id=7435).
- Обновление ключа реестра (HKLM) с постоянными настройками для Azure Migrate.
- Создает файлы журналов и конфигураций следующим образом:
    - **Файлы конфигурации**: %ProgramData%\Microsoft Azure\Config
    - **Файлы журнала**: %ProgramData%\Microsoft Azure\Logs

Выполните следующее, чтобы запустить этот сценарий.

1. Извлеките застегнутый на молнию файл в папку на машине, которая будет размещать прибор. Убедитесь, что скрипт не запускать на машине на существующем приборе Azure Migrate.
2. Запуск PowerShell на машине, с администратором (повышенные) привилегии.
3. Измените каталог PowerShell в папку, содержащую содержимое, извлеченное из загруженного файла на молнии.
4. Выполнить сценарий **AzureMigrateInstaller.ps1**, следующим образом:``` PS C:\Users\administrator\Desktop\AzureMigrateInstaller> AzureMigrateInstaller.ps1 -scenario Hyperv ```
   
5. После успешного запуска скрипта он запускает веб-приложение для обработки приборов, чтобы можно было настроить прибор. Если вы столкнулись с какими-либо проблемами, просмотрите журналы скриптов на c: «ProgramData»Microsoft Azure AzureMigrateScenarioInstaller_<em>Timestamp</em>.log.

### <a name="verify-access"></a>Проверка доступа

Убедитесь, что прибор может подключаться к URL-адресам Azure для [общедоступного](migrate-appliance.md#public-cloud-urls) облака.

## <a name="next-steps"></a>Следующие шаги

После развертывания прибора необходимо настроить его в первый раз и зарегистрировать в проекте Azure Migrate.

- Настройка прибора для [VMware.](how-to-set-up-appliance-vmware.md#configure-the-appliance)
- Настройка прибора для [Hyper-V](how-to-set-up-appliance-hyper-v.md#configure-the-appliance).
