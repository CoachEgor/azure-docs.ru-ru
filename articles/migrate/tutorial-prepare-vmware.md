---
title: Подготовка виртуальных машин VMware к оценке и миграции с помощью службы "Миграция Azure"
description: Узнайте, как подготовить виртуальные машины VMware к оценке и миграции с помощью службы "Миграция Azure".
ms.topic: tutorial
ms.date: 04/19/2020
ms.custom: mvc
ms.openlocfilehash: a3f9716d6302c41f139d9a2a8b1f994b79afd199
ms.sourcegitcommit: acb82fc770128234f2e9222939826e3ade3a2a28
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81677296"
---
# <a name="prepare-vmware-vms-for-assessment-and-migration-to-azure"></a>Подготовка виртуальных машин VMware к оценке и миграции в Azure

Эта статья поможет вам выполнить подготовку для оценки и миграции локальных виртуальных машин VMware в Azure с помощью службы [Миграция Azure](migrate-services-overview.md).



Данное руководство является первым в серии, в которой показано, как оценивать и переносить виртуальные машины VMware. В этом руководстве описано следующее:

> [!div class="checklist"]
> * подготовка Azure для работы со службой "Миграция Azure";
> * Подготовка VMware для оценки виртуальных машин с помощью средства оценки сервера службы "Миграция Azure".
> * Подготовка VMware к миграции с помощью средства оценки сервера службы "Миграция Azure". 

> [!NOTE]
> В учебниках описан самый простой способ развертывания для определенного сценария. Они будут полезны при настройке развертывания и в качестве быстрого подтверждения концепции. В руководствах по возможности используются параметры по умолчанию и показаны не все возможные параметры и пути. 

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/pricing/free-trial/), прежде чем начинать работу.


## <a name="prepare-azure"></a>Подготовка Azure

Прежде чем можно будет оценивать или переносить виртуальные машины VMware, для выполнения этих задач в Azure понадобятся эти разрешения.

**Задача** | **Сведения** 
--- | --- 
**Создание проекта службы "Миграция Azure"** | Чтобы создать проект, учетная запись Azure должна иметь привилегии участника или владельца. 
**Регистрация поставщиков ресурсов** | Миграция Azure использует упрощенный модуль для обнаружения и оценки виртуальных машин VMware, а также их миграции в Azure с помощью средства оценки серверов Миграции Azure.<br/><br/> Когда вы регистрируете модуль, в выбранной для модуля подписке регистрируются поставщики ресурсов. [Подробнее](migrate-appliance-architecture.md#appliance-registration).<br/><br/> Для регистрации поставщиков ресурсов требуется роль участника или владельца в подписке.
**Создание приложений Azure AD** | При регистрации модуля Миграция Azure создает приложения Azure Active Directory (Azure AD). <br/><br/> — Первое приложение используется для обмена данными между агентами, выполняющимися на устройстве, и соответствующими службами, выполняющимися в Azure.<br/><br/> — Второе приложение используется исключительно для доступа к хранилищу Key Vault, созданному в подписке пользователя для миграции виртуальных машин VMware без агента. [Подробнее](migrate-appliance-architecture.md#appliance-registration).<br/><br/> Для создания приложений Azure AD требуются разрешения (доступно в роли разработчика приложений).
**Создание Key Vault** | Чтобы выполнить миграцию виртуальных машин VMware с помощью миграции без агента, служба "Миграция Azure" создает хранилище ключей (Key Vault), которое используется для управления клавишами доступа учетной записи хранения репликации в подписке.<br/><br/> Чтобы создать хранилище, вам потребуются разрешения на назначение ролей в группе ресурсов, в которой находится проект Миграции Azure.




### <a name="assign-permissions-to-create-project"></a>Назначение разрешений для создания проекта

1. На портале Azure откройте подписку, а затем выберите **Управление доступом (IAM)** .
2. В разделе **Проверить доступ** найдите соответствующую учетную запись и щелкните ее, чтобы просмотреть разрешения.
3. Вы должны обладать разрешениями уровня **Участник** или **Владелец**.
    - Если вы создали бесплатную учетную запись Azure, вы являетесь владельцем подписки.
    - Если вы не являетесь владельцем подписки, назначьте эту роль совместно с владельцем.

### <a name="assign-permissions-to-register-the-appliance"></a>Назначение разрешений для регистрации устройства

Чтобы зарегистрировать устройство, во время процесса регистрации необходимо назначить службе "Миграция Azure" разрешения для создания этих приложений Azure AD. Разрешения можно назначить с помощью одного из следующих методов:

- **Предоставление разрешений**. Администратор клиента и глобальный администратор могут предоставлять разрешения пользователям в клиенте для создания и регистрации приложений Azure AD.
- **Назначение роли разработчика приложения**. Администратор клиента и глобальный администратор могут назначить роль разработчика приложений (которая уже имеет нужные разрешения).

> [!NOTE]
> - Приложения не имеют других разрешений на доступ к подписке, помимо описанных выше.
> - Эти разрешения требуются только для регистрации нового устройства. После настройки устройства разрешения можно удалить.


#### <a name="grant-account-permissions"></a>Предоставление разрешений учетной записи

Если вы хотите, чтобы администратор клиента или глобального администратора предоставил разрешения, сделайте следующее.

1. В Azure AD глобальному администратору или администратору клиента нужно перейти в раздел **Azure Active Directory** > **Пользователи** > **Параметры пользователей**.
2. Затем для параметра **Регистрация приложений** нужно выбрать вариант **Да**. Это значение по умолчанию, которое разрешает выполнять регистрацию. [Подробнее](https://docs.microsoft.com/azure/active-directory/develop/active-directory-how-applications-are-added#who-has-permission-to-add-applications-to-my-azure-ad-instance).

    ![Разрешения Azure AD](./media/tutorial-prepare-vmware/aad.png)



#### <a name="assign-application-developer-role"></a>Назначение роли разработчика приложения

Кроме того, администратор клиента и глобальный администратор могут назначить учетной записи роль разработчика приложений. См. [Дополнительные сведения о назначении ролей](https://docs.microsoft.com/azure/active-directory/fundamentals/active-directory-users-assign-role-azure-portal).

### <a name="assign-permissions-to-create-a-key-vault"></a>Присвоение разрешений для создания Key Vault

Чтобы разрешить службе "Миграция Azure" создавать Key Vault, необходимо ей присвоить разрешения, выполнив приведенные ниже действия.

1. В группе ресурсов на портале Azure выберите **Управление доступом (IAM)** .
2. В разделе **Проверить доступ** найдите соответствующую учетную запись и щелкните ее, чтобы просмотреть разрешения.

    - Для запуска оценки сервера достаточно разрешений **Участника**.
    - Для запуска миграции без агента у вас должны быть права доступа **Владелец** (или **Участник** и **Администратор доступа пользователя**).

3. Если у вас нет необходимых разрешений, запросите их у владельца группы ресурсов.



## <a name="prepare-for-vmware-vm-assessment"></a>Подготовка оценки виртуальных машин VMware

Для подготовки оценки виртуальных машин VMware необходимо выполнить приведенные ниже действия.

- **Проверка параметров VMware**. Убедитесь, что vCenter Server и виртуальные машины, которые нужно перенести, соответствуют требованиям.
- **Настройка учетной записи для оценки**. Служба "Миграция Azure" использует эту учетную запись для доступа к vCenter Server и обнаружения виртуальных машин для оценки.
- **Проверка требований к устройству**. Перед развертыванием проверьте требования к развертыванию для устройства службы "Миграция Azure".

### <a name="verify-vmware-settings"></a>Проверка параметров VMware

1. [Проверьте](migrate-support-matrix-vmware.md#vmware-requirements) соответствие требованиям сервера VMware для оценки.
2. [Убедитесь](migrate-support-matrix-vmware.md#port-access), что на сервере vCenter Server открыты необходимые порты.
3. На сервере vCenter Server убедитесь, что у вашей учетной записи есть разрешения на создание виртуальной машины с использованием файла OVA. Развертывание устройства службы "Миграции Azure" в качестве виртуальной машины VMware осуществляется с использованием файла OVA.


### <a name="set-up-an-account-for-assessment"></a>Настройка учетной записи для оценки

Службе "миграция Azure" требуется доступ к vCenter Server для обнаружения виртуальных машин для оценки и миграции без агентов.

- Если вы планируете выполнять обнаружение приложений или визуализацию зависимостей без агента, создайте учетную запись vCenter Server с доступом только для чтения и включенными привилегиями для параметра **Виртуальные машины** > **Guest Operations** (Гостевые операции).

  ![Привилегии учетной записи vCenter Server](./media/tutorial-prepare-vmware/vcenter-server-permissions.png)

- Если вы не планируете выполнять обнаружение приложений и визуализацию зависимостей без агентов, настройте учетную запись только для чтения для vCenter Server.

### <a name="verify-appliance-settings-for-assessment"></a>Проверка настроек устройства для оценки

Перед настройкой устройства Миграции Azure и началом оценки из следующего руководства вам следует подготовиться к развертыванию устройства.

1. [Проверьте](migrate-appliance.md#appliance---vmware) требования к устройству Миграции Azure
2. Проверьте URL-адреса Azure, к которым модуль будет обращаться в [общедоступных](migrate-appliance.md#public-cloud-urls) облаках и облаках для [государственных организаций](migrate-appliance.md#government-cloud-urls).
3. [Просмотрите данные](migrate-appliance.md#collected-data---vmware), собранные устройством во время обнаружения и оценки.
4. [Обратите внимание](migrate-support-matrix-vmware.md#port-access) на требования доступа к порту для устройства.




## <a name="prepare-for-agentless-vmware-migration"></a>Подготовка к миграции VMware без агента

Ознакомьтесь с требованиями к [миграции виртуальных машин VMware без агента](server-migrate-overview.md).

1. [Проверьте](migrate-support-matrix-vmware-migration.md#agentless-vmware-servers) требования сервера VMware.
2. [Проверьте разрешения](migrate-support-matrix-vmware-migration.md#agentless-vmware-servers), необходимые службе "Миграция Azure" для доступа к vCenter Server.
3. [Проверьте](migrate-support-matrix-vmware-migration.md#agentless-vmware-vms) требования виртуальных машин VMware.
4. [Проверьте](migrate-support-matrix-vmware-migration.md#agentless-azure-migrate-appliance) требования к устройству Миграции Azure.
5. Обратите внимание на доступ к URL-адресам, необходимый для [общедоступных](migrate-appliance.md#public-cloud-urls) облаков и облаков для [государственных организаций](migrate-appliance.md#government-cloud-urls).
6. Просмотрите требования для [доступа к порту](migrate-support-matrix-vmware-migration.md#agentless-ports).

## <a name="prepare-for-agent-based-vmware-migration"></a>Подготовка к миграции VMware на основе агента

Ознакомьтесь с требованиями к [миграции виртуальных машин VMware с использованием агента](server-migrate-overview.md).

1. [Проверьте](migrate-support-matrix-vmware-migration.md#agent-based-vmware-servers) требования сервера VMware.
2. [Проверьте разрешения](migrate-support-matrix-vmware-migration.md#agent-based-vmware-servers), необходимые службе "Миграция Azure" для доступа к vCenter Server.
2. [Ознакомьтесь](migrate-support-matrix-vmware-migration.md#agent-based-vmware-vms) с требованиями к виртуальным машинам VMware, включая установку службы "Мобильность" на каждой виртуальной машине, которую требуется перенести.
3. Миграция на основе агентов использует устройство репликации:
    - [Ознакомьтесь](migrate-replication-appliance.md#appliance-requirements) с требованиями к развертыванию для устройства репликации.
    - [Проверьте параметры](migrate-replication-appliance.md#mysql-installation) для установки MySQL на устройстве.
    - Обратите внимание на доступ к URL-адресам, необходимый для [общедоступных](migrate-replication-appliance.md#url-access) облаков и облаков для [государственных организаций](migrate-replication-appliance.md#azure-government-url-access).
    - Проверьте требования к доступу к [портам](migrate-replication-appliance.md#port-access) для модуля репликации.
    
## <a name="next-steps"></a>Дальнейшие действия

Изучив это руководство, вы:

> [!div class="checklist"]
> * Настройка разрешений Azure
> * Подготовка VMware к оценке и миграции


Перейдите ко второму руководству по настройке проекта миграции Azure и оцените виртуальные машины VMware для миграции на Azure.

> [!div class="nextstepaction"]
> [Migrate VMware VMs to Azure (agentless)](./tutorial-assess-vmware.md) (Миграция виртуальных машин VMware в Azure (без агента))
