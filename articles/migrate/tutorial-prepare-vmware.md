---
title: Подготовка виртуальных машин VMware к оценке и миграции с помощью службы "Миграция Azure"
description: Узнайте, как подготовить виртуальные машины VMware к оценке и миграции с помощью службы "Миграция Azure".
ms.topic: tutorial
ms.date: 06/08/2020
ms.custom: mvc
ms.openlocfilehash: 8b812924c0922d460c631baec8b0e13a9f45cd76
ms.sourcegitcommit: 62717591c3ab871365a783b7221851758f4ec9a4
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/22/2020
ms.locfileid: "86109582"
---
# <a name="prepare-vmware-vms-for-assessment-and-migration-to-azure"></a>Подготовка виртуальных машин VMware к оценке и миграции в Azure

Эта статья поможет вам выполнить подготовку для оценки и миграции локальных виртуальных машин VMware в Azure с помощью службы [Миграция Azure](migrate-services-overview.md).

Данное руководство является первым в серии, в которой показано, как оценивать и переносить виртуальные машины VMware. В этом руководстве описано следующее:

> [!div class="checklist"]
> * подготовка Azure для работы со службой "Миграция Azure";
> * подготовка к оценке виртуальных машин VMware с помощью средства оценки сервера службы "Миграция Azure";
> * подготовка к миграции виртуальных машин VMware с помощью средства оценки сервера службы "Миграция Azure". 

> [!NOTE]
> В учебниках описан самый простой способ развертывания для определенного сценария. Их удобно использовать для оперативного подтверждения концепции. В руководствах по возможности используются параметры по умолчанию и показаны не все возможные параметры и пути. 

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/pricing/free-trial/), прежде чем начинать работу.


## <a name="prepare-azure"></a>Подготовка Azure

В таблице перечислены задачи, которые необходимо выполнить в Azure. После таблицы также приведены инструкции для каждой задачи.

**Задача** | **Сведения** | **Разрешения**
--- | --- | ---
**Создание проекта службы "Миграция Azure"** | Проект службы "Миграция Azure" обеспечивает централизованное выполнение оркестрации и администрирования процессов оценки и миграции с помощью средств Миграции Azure, других средств корпорации Майкрософт и сторонних предложений. | Учетной записи Azure требуются разрешения участника или владельца в группе ресурсов, в которой находится проект.
**Регистрация устройства** | Служба "Миграция Azure" использует упрощенное устройство Миграции Azure для обнаружения виртуальных машин, оценки их с помощью средства оценки серверов, а также их миграции без использования агента с помощью средства миграции серверов. [Дополнительные сведения](migrate-appliance-architecture.md#appliance-registration) о регистрации. | Чтобы зарегистрировать устройство, учетной записи Azure требуются разрешения участника или владельца для подписки Azure.
**Создание приложений Azure AD** | При регистрации устройства служба "Миграция Azure" создает приложения Azure Active Directory (Azure AD). <br/><br/> — Первое приложение используется для обмена данными между агентами, выполняющимися на устройстве и в службе "Миграция Azure". <br/><br/> — Второе приложение используется исключительно для доступа к хранилищу Key Vault, созданному в подписке пользователя для миграции виртуальных машин VMware без агента.   | Учетная запись Azure должна иметь разрешения на создание приложений Azure AD.
**Создание Key Vault** | Чтобы выполнить миграцию виртуальных машин VMware без агента, служба "Миграция Azure" создает хранилище Key Vault, которое используется для управления клавишами доступа к учетной записи репликации в подписке. | Чтобы разрешить службе "Миграция Azure" создать Key Vault, установите разрешения (владельца или участника и администратора доступа пользователей) в группе ресурсов, в которой находится проект службы "Миграция Azure".


### <a name="assign-permissions-to-create-project"></a>Назначение разрешений для создания проекта

1. На портале Azure откройте подписку, а затем выберите **Управление доступом (IAM)** .
2. В разделе **Проверить доступ** найдите соответствующую учетную запись и щелкните ее, чтобы просмотреть разрешения.
3. Вы должны обладать разрешениями уровня **Участник** или **Владелец**.
    - Если вы создали бесплатную учетную запись Azure, вы являетесь владельцем подписки.
    - Если вы не являетесь владельцем подписки, назначьте эту роль совместно с владельцем.

### <a name="assign-permissions-to-create-azure-ad-apps"></a>Присвоение разрешений для создания приложений Azure AD

Чтобы зарегистрировать устройство, учетной записи Azure необходимы разрешения на создание приложений Azure AD. Назначьте разрешения с помощью одного из следующих методов.

- **Метод 1. Предоставление разрешений учетной записи**. Администратор клиента и глобальный администратор могут предоставлять разрешения учетным записям пользователей в клиенте для создания и регистрации приложений Azure AD.
- **Метод 2. Назначение роли с разрешениями учетной записи пользователя**. Администратор клиента и глобальный администратор могут назначить роль разработчика приложений (которая уже имеет нужные разрешения) учетной записи пользователя.

> [!NOTE]
> Эти разрешения требуются только для регистрации нового устройства. После настройки устройства разрешения можно удалить.


#### <a name="method-1-grant-permissions-to-the-account"></a>Метод 1. Предоставление разрешений учетной записи

Предоставьте разрешения учетной записи, как указано ниже.

1. Убедитесь, что у вас есть права администратора клиента или глобального администратора. Затем в Azure AD перейдите в раздел **Azure Active Directory** > **Пользователи** > **Параметры пользователей**.
2. Задайте для параметра **Регистрация приложений** значение **Да**. Это значение по умолчанию, которое разрешает выполнять регистрацию. [Подробнее](../active-directory/develop/active-directory-how-applications-are-added.md#who-has-permission-to-add-applications-to-my-azure-ad-instance).

    ![Разрешения Azure AD](./media/tutorial-prepare-vmware/aad.png)



#### <a name="method-2-assign-application-developer-role"></a>Метод 2. Назначение роли разработчика приложения

Кроме того, администратор клиента и глобальный администратор могут назначить учетной записи роль разработчика приложений. См. [Дополнительные сведения о назначении ролей](../active-directory/fundamentals/active-directory-users-assign-role-azure-portal.md).

### <a name="assign-permissions-to-create-a-key-vault"></a>Присвоение разрешений для создания Key Vault

Чтобы разрешить службе "Миграция Azure" создавать Key Vault, необходимо ей присвоить разрешения, выполнив приведенные ниже действия.

1. В группе ресурсов на портале Azure выберите **Управление доступом (IAM)** .
2. В разделе **Проверить доступ** найдите соответствующую учетную запись и щелкните ее, чтобы просмотреть разрешения.

    - Для запуска оценки сервера достаточно разрешений **Участника**.
    - Для запуска миграции без агента у вас должны быть права доступа **Владелец** (или **Участник** и **Администратор доступа пользователя**).

3. Если у вас нет необходимых разрешений, запросите их у владельца группы ресурсов.

## <a name="prepare-for-assessment"></a>Подготовка к оценке

Для подготовки оценки виртуальных машин VMware необходимо выполнить приведенные ниже действия.

1. **Проверка параметров VMware**. Убедитесь, что vCenter Server и виртуальные машины, которые нужно перенести, соответствуют требованиям.
2. **Настройка разрешений для оценки**. Служба "Миграция Azure" использует учетную запись vCenter для доступа к vCenter Server, а также обнаружения и оценки виртуальных машин.
3. **Проверка требований к устройству**. Перед развертыванием согласно инструкциям в следующем учебнике проверьте требования к развертыванию для устройства Миграции Azure.

### <a name="verify-vmware-settings"></a>Проверка параметров VMware

1. [Проверьте соответствие требованиям VMware](migrate-support-matrix-vmware.md#vmware-requirements) для оценки.
2. [Убедитесь](migrate-support-matrix-vmware.md#port-access-requirements), что на сервере vCenter Server открыты необходимые порты.
3. На сервере vCenter Server убедитесь, что у вашей учетной записи есть разрешения на создание виртуальной машины с использованием файла OVA. Это необходимо при развертывании устройства Миграции Azure в качестве виртуальной машины VMware с использованием файла OVA.
4. Прежде чем переносить виртуальные машины в Azure, необходимо внести в них некоторые изменения.

    - В некоторых операционных системах Миграция Azure вносит эти изменения автоматически. 
    - Важно внести эти изменения до начала миграции. Если вы перенесете виртуальную машину до внесения изменений, она может не загрузиться в Azure.
    - Просмотрите сведения об изменениях для [Windows](prepare-for-migration.md#windows-machines) и [Linux](prepare-for-migration.md#linux-machines), которые необходимо внести.


### <a name="set-up-permissions-for-assessment"></a>Настройка разрешений для оценки

Службе "Миграция Azure" требуется доступ к vCenter Server для обнаружения виртуальных машин с целью оценки и миграции без агентов с помощью устройства Миграции Azure. Настройте учетную запись, как указано ниже.

1. В веб-клиенте vSphere откройте **Administration** > **Access** > **SSO Users and Groups** (Администрирование > Доступ > Пользователи и группы для единого входа).
2. В разделе **Users** (Пользователи) щелкните значок **New User** (Создать пользователя).
3. Введите сведения о новом пользователе.
4. Выберите разрешения в соответствии со значениями таблицы.

    **Компонент** | **Разрешения учетной записи**
    --- | ---
    [Оценка виртуальных машин](tutorial-assess-vmware.md) | Для оценки учетной записи требуется доступ только для чтения.
    [Обнаружение приложений, ролей и компонентов виртуальной машины](how-to-discover-applications.md) | Если вы хотите использовать обнаружение приложений, для учетной записи с доступом только для чтения, применяемой для оценки, потребуется активировать разрешения для следующих действий: **Virtual machines** > **Guest Operations** (Виртуальные машины > Гостевые операции).
    [Анализ зависимостей на виртуальных машинах (без агента)](how-to-create-group-machine-dependencies-agentless.md) | Если необходимо выполнить анализ зависимостей, для учетной записи с доступом только для чтения, применяемой для оценки, потребуется активировать разрешения для следующих действий: **Virtual machines** > **Guest Operations** (Виртуальные машины > Гостевые операции).
    
> [!NOTE]
> Если вы хотите ограничить обнаружение оцениваемых виртуальных машин определенной областью, ознакомьтесь с [этой статьей](set-discovery-scope.md#assign-a-role-for-assessment).

### <a name="verify-appliance-settings-for-assessment"></a>Проверка настроек устройства для оценки

В [следующем учебнике](tutorial-assess-vmware.md) рассказывается, как настроить устройство Миграции Azure и начать оценку. Прежде чем это сделать, ознакомьтесь с требованиями к устройству, изложенными ниже. 

1. [Проверьте требования](migrate-appliance.md#appliance---vmware) для развертывания устройства Миграции Azure.
2. Проверьте URL-адреса Azure, к которым модуль будет обращаться в [общедоступных](migrate-appliance.md#public-cloud-urls) облаках и облаках для [государственных организаций](migrate-appliance.md#government-cloud-urls).
3. [Обратите внимание](migrate-support-matrix-vmware.md#port-access-requirements) на порты, используемые устройством.
4. [Просмотрите данные](migrate-appliance.md#collected-data---vmware), собранные устройством во время обнаружения и оценки.

## <a name="prepare-for-agentless-vmware-migration"></a>Подготовка к миграции VMware без агента

Вы можете использовать для виртуальных машин VMware миграцию [с агентом и без него](server-migrate-overview.md). В этом разделе вкратце описаны требования для миграции без агента.

1. [Решите](server-migrate-overview.md#compare-migration-methods), хотите ли вы использовать миграцию без агента.
2. [Проверьте](migrate-support-matrix-vmware-migration.md#vmware-requirements-agentless) соблюдение требований к гипервизору для компьютеров, которые требуется перенести.
3. [Проверьте](migrate-support-matrix-vmware-migration.md#vm-requirements-agentless) соблюдение требований к виртуальным машинам VMware, которые вы хотите перенести с помощью миграции без агента.
4. [Проверьте](migrate-support-matrix-vmware-migration.md#appliance-requirements-agentless) соблюдение требований к устройству Миграции Azure для миграции без агента.
5. Обратите внимание на доступ к URL-адресам, необходимый для [общедоступных](migrate-appliance.md#public-cloud-urls) облаков и облаков для [государственных организаций](migrate-appliance.md#government-cloud-urls).
6. Просмотрите требования для [доступа к порту](migrate-support-matrix-vmware-migration.md#port-requirements-agentless).
7. Настройте разрешения для миграции без агента, как описано в следующей процедуре.


### <a name="assign-permissions-to-an-account"></a>Назначение разрешений учетной записи

Устройство Миграции Azure подключается к vCenter Server для обнаружения и миграции виртуальных машин без агента. Можно назначить учетной записи пользователя разрешения, необходимые устройству, или создать роль с разрешениями и назначить эту роль учетной записи пользователя.

1. В веб-клиенте vSphere откройте **Administration** > **Access** > **SSO Users and Groups** (Администрирование > Доступ > Пользователи и группы для единого входа).
2. В разделе **Users** (Пользователи) щелкните значок **New User** (Создать пользователя).
3. Введите сведения о новом пользователе.
4. Назначьте [эти разрешения](migrate-support-matrix-vmware-migration.md#vmware-requirements-agentless).

#### <a name="create-a-role-and-assign-to-an-account"></a>Создание роли и назначение ее учетной записи

Вы можете также создать учетную запись. Затем создайте роль и назначьте ее учетной записи следующим образом.

1. Войдите в веб-клиент vSphere с правами администратора vCenter Server.
2. Выберите экземпляр vCenter Server и щелкните **Create role** (Создать роль).
3. Укажите имя роли, например <em>Миграция_Azure</em>, и назначьте роли [необходимые разрешения](migrate-support-matrix-vmware-migration.md#vmware-requirements-agentless).

    ![Привилегии учетной записи vCenter Server](./media/tutorial-prepare-vmware/vcenter-server-permissions.png)

4. Теперь создайте учетную запись и назначьте ей роль.

> [!NOTE]
> Если вы хотите ограничить миграцию оцениваемых виртуальных машин без агента определенной областью, ознакомьтесь с [этой статьей](set-discovery-scope.md#assign-a-role-for-agentless-migration).



## <a name="prepare-for-agent-based-vmware-migration"></a>Подготовка к миграции VMware на основе агента

Вы можете использовать для виртуальных машин VMware миграцию [с агентом и без него](server-migrate-overview.md). В этом разделе вкратце описаны требования для миграции на основе агента.

1. [Решите](server-migrate-overview.md#compare-migration-methods), хотите ли вы использовать миграцию на основе агента.
1. [Проверьте](migrate-support-matrix-vmware-migration.md#vmware-requirements-agent-based) соблюдение требований к гипервизору для компьютеров, которые требуется перенести.
2. [Ознакомьтесь](migrate-support-matrix-vmware-migration.md#vm-requirements-agent-based) с требованиями к виртуальным машинам VMware, включая установку службы "Мобильность" на каждой виртуальной машине, которую требуется перенести.
3. Миграция на основе агентов использует устройство репликации:
    - [Ознакомьтесь](migrate-replication-appliance.md#appliance-requirements) с требованиями к развертыванию для устройства репликации.
    - [Проверьте параметры](migrate-replication-appliance.md#mysql-installation) для установки MySQL на устройстве.
    - Обратите внимание на доступ к URL-адресам, необходимый для [общедоступных](migrate-replication-appliance.md#url-access) облаков и облаков для [государственных организаций](migrate-replication-appliance.md#azure-government-url-access).
    - Проверьте требования к доступу к [портам](migrate-replication-appliance.md#port-access) для устройства репликации.
4. Прежде чем переносить виртуальные машины в Azure, необходимо внести в них некоторые изменения. Просмотрите сведения об изменениях для [Windows](prepare-for-migration.md#windows-machines) и [Linux](prepare-for-migration.md#linux-machines), которые необходимо внести.



## <a name="next-steps"></a>Дальнейшие действия

Изучив это руководство, вы:

> [!div class="checklist"]
> * Настройка разрешений Azure
> * Подготовка VMware к оценке и миграции


Перейдите ко второму руководству по настройке проекта миграции Azure и оцените виртуальные машины VMware для миграции на Azure.

> [!div class="nextstepaction"]
> [Migrate VMware VMs to Azure (agentless)](./tutorial-assess-vmware.md) (Миграция виртуальных машин VMware в Azure (без агента))
