---
title: Подготовка виртуальных машин VMware к оценке и миграции с помощью службы "Миграция Azure"
description: Узнайте, как подготовить виртуальные машины VMware к оценке и миграции с помощью службы "Миграция Azure".
author: rayne-wiselman
ms.service: azure-migrate
ms.topic: tutorial
ms.date: 11/19/2019
ms.author: raynew
ms.custom: mvc
ms.openlocfilehash: cc1eb4c4fce1398365145b2f3d63db984635d667
ms.sourcegitcommit: 8e31a82c6da2ee8dafa58ea58ca4a7dd3ceb6132
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/19/2019
ms.locfileid: "74196237"
---
# <a name="prepare-vmware-vms-for-assessment-and-migration-to-azure"></a>Подготовка виртуальных машин VMware к оценке и миграции в Azure

Эта статья поможет вам выполнить подготовку для оценки и миграции локальных виртуальных машин VMware в Azure с помощью службы [Миграция Azure](migrate-services-overview.md).

Служба [Миграция Azure](migrate-overview.md) объединяет в себе инструменты, которые используются для поиска, оценки и переноса приложений, инфраструктуры и рабочих нагрузок в Microsoft Azure. Она включает в себя инструменты Миграции Azure и предложения независимых поставщиков программного обеспечения.


Данное руководство является первым в серии, в которой показано, как оценивать и переносить виртуальные машины VMware. Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * подготовка Azure для работы со службой "Миграция Azure";
> * подготовка VMware для оценки виртуальных машин;
> * подготовка VMware для миграции виртуальных машин.

> [!NOTE]
> В учебниках описан самый простой способ развертывания для определенного сценария. Они будут полезны при настройке развертывания и в качестве быстрого подтверждения концепции. В руководствах по возможности используются параметры по умолчанию и показаны не все возможные параметры и пути. Для получения подробных инструкций ознакомьтесь со статьей о выполнении оценки и миграции VMware.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/pricing/free-trial/), прежде чем начинать работу.


## <a name="prepare-azure"></a>Подготовка Azure

Вам потребуются следующие разрешения.

**Task** | **Разрешения**
--- | ---
**Создание проекта службы "Миграция Azure"** | Учетная запись Azure должна иметь разрешения на создание проекта.
**Регистрация устройства службы "Миграция Azure"** | Служба "Миграция Azure" использует упрощенное устройство службы для оценки виртуальных машин VMware с помощью собственного средства оценки серверов, а также для запуска [безагентной миграции](server-migrate-overview.md) виртуальных машин VMware с помощью собственного средства миграции серверов. Это устройство обнаруживает виртуальные машины и инициирует отправку метаданных и данных производительности виртуальной машины в службу "Миграция Azure".<br/><br/>Во время регистрации служба "Миграция Azure" создает два приложения Azure Active Directory (Azure AD), которые однозначно идентифицируют устройство. Ей требуются разрешения на создание этих приложений.<br/> — Первое приложение взаимодействует с конечными точками службы "Миграция Azure".<br/> — Второе приложение обращается к Azure Key Vault, созданному во время регистрации, для хранения информации приложения Azure AD и параметров конфигурации устройства.
**Создание Key Vault** | Чтобы выполнить миграцию виртуальных машин VMware с помощью средства миграции серверов службы "Миграция Azure", эта служба создает хранилище ключей (Key Vault), которое используется для управления ключами доступа учетной записи хранилища репликации в подписке. Чтобы создать хранилище, вам потребуются разрешения на назначение ролей в группе ресурсов, в которой находится проект Миграции Azure.


### <a name="assign-permissions-to-create-project"></a>Назначение разрешений для создания проекта

1. На портале Azure откройте подписку, а затем выберите **Управление доступом (IAM)** .
2. В разделе **Проверить доступ** найдите соответствующую учетную запись и щелкните ее, чтобы просмотреть разрешения.
3. Вы должны обладать разрешениями уровня **Участник** или **Владелец**.
    - Если вы создали бесплатную учетную запись Azure, вы являетесь владельцем подписки.
    - Если вы не являетесь владельцем подписки, назначьте эту роль совместно с владельцем.

### <a name="assign-permissions-to-register-the-appliance"></a>Назначение разрешений для регистрации устройства

Чтобы зарегистрировать устройство, во время процесса регистрации необходимо назначить службе "Миграция Azure" разрешения для создания этих приложений Azure AD. Разрешения можно назначить с помощью одного из следующих методов:

- Администратор клиента и глобальный администратор могут предоставлять разрешения пользователям в клиенте для создания и регистрации приложений Azure AD.
- Администратор клиента и глобальный администратор могут назначить роль разработчика приложений (которая уже имеет нужные разрешения).

> [!NOTE]
> - Приложения не имеют других разрешений на доступ к подписке, помимо описанных выше.
> - Эти разрешения требуются только для регистрации нового устройства. После настройки устройства разрешения можно удалить.


#### <a name="grant-account-permissions"></a>Предоставление разрешений учетной записи

Администратор клиента и глобальный администратор могут предоставить разрешения, выполнив следующие действия:

1. В Azure AD глобальному администратору или администратору клиента нужно перейти в раздел **Azure Active Directory** > **Пользователи** > **Параметры пользователей**.
2. Затем для параметра **Регистрация приложений** нужно выбрать вариант **Да**. Это значение по умолчанию, которое разрешает выполнять регистрацию. [Узнайте больше](https://docs.microsoft.com/azure/active-directory/develop/active-directory-how-applications-are-added#who-has-permission-to-add-applications-to-my-azure-ad-instance).

    ![Разрешения Azure AD](./media/tutorial-prepare-vmware/aad.png)



#### <a name="assign-application-developer-role"></a>Назначение роли разработчика приложения

Администратор клиента и глобальный администратор могут назначить учетной записи роль разработчика приложений. [Узнайте больше](https://docs.microsoft.com/azure/active-directory/fundamentals/active-directory-users-assign-role-azure-portal).

### <a name="assign-role-assignment-permissions"></a>Назначение разрешений для назначенных ролей

Чтобы разрешить службе "Миграция Azure" создавать Key Vault, необходимо ей присвоить разрешения для назначенных ролей следующим образом:

1. В группе ресурсов на портале Azure выберите **Управление доступом (IAM)** .
2. В разделе **Проверить доступ** найдите соответствующую учетную запись и щелкните ее, чтобы просмотреть разрешения.

    - Для запуска оценки сервера достаточно разрешений **Участника**.
    - Для запуска миграции без агента у вас должны быть права доступа **Владелец** (или **Участник** и **Администратор доступа пользователя**).

3. Если у вас нет необходимых разрешений, запросите их у владельца группы ресурсов.



## <a name="prepare-for-vmware-vm-assessment"></a>Подготовка оценки виртуальных машин VMware

Для подготовки оценки виртуальных машин VMware необходимо выполнить приведенные ниже действия.

- **Проверка параметров VMware**. Убедитесь, что vCenter Server и виртуальные машины, которые нужно перенести, соответствуют требованиям.
- **Настройка учетной записи оценки**. Службе "Миграция Azure" требуется доступ к vCenter Server для обнаружения виртуальных машин для оценки.
- **Проверка требований к устройству**. Проверьте требования к развертыванию для устройства службы "Миграция Azure", используемого для оценки.

### <a name="verify-vmware-settings"></a>Проверка параметров VMware

1. [Проверьте](migrate-support-matrix-vmware.md#assessment-vcenter-server-requirements) соответствие требованиям сервера VMware для оценки.
2. [Убедитесь](migrate-support-matrix-vmware.md#assessment-port-requirements), что на сервере vCenter Server открыты необходимые порты.


### <a name="set-up-an-account-for-assessment"></a>Настройка учетной записи для оценки

Службе "миграция Azure" требуется доступ к vCenter Server для обнаружения виртуальных машин для оценки и миграции без агентов.

- Если вы планируете выполнять обнаружение приложений или визуализацию зависимостей без агента, создайте учетную запись vCenter Server с доступом только для чтения и включенными привилегиями для параметра **Виртуальные машины** > **Guest Operations** (Гостевые операции).

  ![Привилегии учетной записи vCenter Server](./media/tutorial-prepare-vmware/vcenter-server-permissions.png)

- Если вы не планируете выполнять обнаружение приложений и визуализацию зависимостей без агентов, настройте учетную запись только для чтения для vCenter Server.

### <a name="verify-appliance-settings-for-assessment"></a>Проверка настроек устройства для оценки

Проверьте требования к устройству перед его развертыванием.

1. [Проверьте](migrate-support-matrix-vmware.md#assessment-appliance-requirements) требования к устройству и его ограничения.
2. Если вы используете прокси-сервер или брандмауэр на основе URL-адресов, [проверьте](migrate-support-matrix-vmware.md#assessment-url-access-requirements) URL-адреса Azure, к которым устройству потребуется доступ. Убедитесь, что прокси-сервер разрешает любые записи CNAME, полученные при поиске URL-адресов.
3. Просмотрите [данные производительности](migrate-appliance.md#collected-performance-data-vmware) и [метаданные](migrate-appliance.md#collected-metadata-vmware), собранные устройством во время обнаружения и оценки.
4. [Обратите внимание](migrate-support-matrix-vmware.md#assessment-port-requirements) на порты, к которым устройство осуществляет доступ.
5. На сервере vCenter Server убедитесь, что у вашей учетной записи есть разрешения на создание виртуальной машины с использованием файла OVA. Развертывание устройства службы "Миграции Azure" в качестве виртуальной машины VMware осуществляется с использованием файла OVA.

При использовании firewall.proxy на основе URL-адреса, разрешите доступ к требуемым [URL-адресам Azure](migrate-support-matrix-vmware.md#assessment-url-access-requirements).




## <a name="prepare-for-agentless-vmware-migration"></a>Подготовка к миграции VMware без агента

Ознакомьтесь с требованиями к миграции виртуальных машин VMware без агента.

1. [Проверьте](migrate-support-matrix-vmware.md#agentless-migration-vmware-server-requirements) требования сервера VMware.
2. Настройте учетную запись с [необходимыми разрешениями](migrate-support-matrix-vmware.md#agentless-migration-vcenter-server-permissions), чтобы служба "Миграция Azure" получила доступ к vCenter Server для миграции без агента с использованием собственного средства миграции серверов.
3. [Просмотрите](migrate-support-matrix-vmware.md#agentless-migration-vmware-vm-requirements) требования к виртуальным машинам VMware, которые вы хотите перенести в Azure с помощью миграции без агента.
4. [Изучите](migrate-support-matrix-vmware.md#agentless-migration-appliance-requirements) требования к использованию устройства службы "Миграция Azure" для миграции без агента.
5. Обратите внимание на [доступ к URL-адресам](migrate-support-matrix-vmware.md#agentless-migration-url-access-requirements) и [порту](migrate-support-matrix-vmware.md#agentless-migration-port-requirements), которые требуются устройству службы "Миграция Azure" для миграции без агента.


## <a name="prepare-for-agent-based-vmware-migration"></a>Подготовка к миграции VMware на основе агента

Ознакомьтесь с требованиями к [миграции виртуальных машин VMware с использованием агента](server-migrate-overview.md).

1. [Проверьте](migrate-support-matrix-vmware.md#agent-based-migration-vmware-server-requirements) требования сервера VMware.
2. Настройте учетную запись с [необходимыми разрешениями](migrate-support-matrix-vmware.md#agent-based-migration-vcenter-server-permissions). В результате служба "Миграция Azure" сможет получить доступ к vCenter Server для миграции без агента с использованием собственного средства миграции серверов.
3. [Просмотрите](migrate-support-matrix-vmware.md#agent-based-migration-vmware-vm-requirements) требования к виртуальным машинам VMware, которые вы хотите перенести в Azure с помощью миграции на основе агентов, включая установку Mobility Service на каждую виртуальную машину, которую вы хотите перенести.
4. Обратите внимание на [Доступ к URL-адресам](migrate-support-matrix-vmware.md#agent-based-migration-url-access-requirements).
5. Проверьте [доступ к порту](migrate-support-matrix-vmware.md#agent-based-migration-port-requirements), который необходим компонентам службы "Миграция Azure" для доступа на основе агента.

## <a name="next-steps"></a>Дополнительная информация

Изучив это руководство, вы:

> [!div class="checklist"]
> * Настройка разрешений Azure
> * Подготовка VMware к оценке и миграции


Перейдите ко второму руководству по настройке проекта миграции Azure и оцените виртуальные машины VMware для миграции на Azure.

> [!div class="nextstepaction"]
> [Migrate VMware VMs to Azure (agentless)](./tutorial-assess-vmware.md) (Миграция виртуальных машин VMware в Azure (без агента))
