---
title: Устройство репликации в службе "Миграция Azure"
description: Узнайте о приборе репликации Azure Migrate для миграции VMWare на основе агента.
ms.topic: conceptual
ms.date: 01/30/2020
ms.openlocfilehash: 85641f514fc4367f02901eb1dd394cfa204c3ec4
ms.sourcegitcommit: 31ef5e4d21aa889756fa72b857ca173db727f2c3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81535219"
---
# <a name="replication-appliance"></a>Репликационный прибор

В этой статье описывается прибор репликации, используемый [инструментом Azure Migrate: Server Migration](migrate-services-overview.md#azure-migrate-server-migration-tool) при миграции VMw VMw, физических машин и частных/публичных облачных ВМ в Azure с использованием миграции на основе агента. 


## <a name="overview"></a>Обзор

Прибор репликации развертывается при настройке агентской миграции VMw или физических серверов на основе агента. Он развернут как единая автоматка, как VMware VM, либо физический сервер. Он работает:

- **Прибор репликации:** прибор репликации координирует связь и управляет репликацией данных для предприимчивых VM VMw и физических серверов, реплицируемых в Azure.
- **Процесс сервера**: Процесс сервера, который установлен по умолчанию на репликации прибора, и делает следующее:
    - **Репликация шлюза**: Он действует как шлюз репликации. Он получает данные репликации с машин, включенных для репликации. Он оптимизирует данные репликации с помощью кэширования, сжатия и шифрования и отправляет их в Azure.
    - **Агент установки**: Выполняет толчок установки службы мобильности. Эта служба должна быть установлена и запущена на каждой натерритории машины, которую вы хотите воспроизвести для миграции.

## <a name="appliance-deployment"></a>Развертывание приборов

**Используется для** | **Сведения**
--- |  ---
**Миграция на основе агентов VMware VM** | Вы загружаете шаблон OVA из концентратора Azure Migrate и импортируете в vCenter Server для создания прибора VM.
**Миграция на основе физического агента** | Если у вас нет инфраструктуры VMware, или если вы не можете создать VMware VM с помощью шаблона OVA, вы загружаете установщик программного обеспечения из концентратора Azure Migrate и запустите его для настройки прибора.

> [!NOTE]
> Если вы развертываете в развертывании в правительстве Azure, используйте файл установки для развертывания прибора репликации.

## <a name="appliance-requirements"></a>Требования к приборам

При настройке устройства репликации с помощью шаблона OVA, предоставленного в концентраторе Azure Migrate, прибор запускает Windows Server 2016 и соответствует требованиям поддержки. Если вы настроили прибор репликации вручную на физическом сервере, убедитесь, что он соответствует требованиям.

**Компонент** | **Требование**
--- | ---
 | **VMware VM прибор**
PowerCLI | [Версия PowerCLI 6.0](https://my.vmware.com/web/vmware/details?productId=491&downloadGroup=PCLI600R1) должна быть установлена, если прибор репликации работает на VMware VM.
Тип сетевой карты | VMXNET3 (если прибор VMware VM)
 | **Настройки оборудования**
Ядра ЦП | 8
ОЗУ | 16 ГБ
Количество дисков | Три: диск ОС, обработка диска кэша сервера и диск удержания.
Свободное дисковое пространство (кэш) | 600 ГБ
Свободное место на диске (диск хранения) | 600 ГБ
**Настройки программного обеспечения** |
Операционная система | Windows Server 2016 или Windows Server 2012 R2.
Лицензия | Прибор поставляется с лицензией на оценку Windows Server 2016, которая действительна в течение 180 дней.<br/><br/> Если период оценки близок к истечению, мы рекомендуем загрузить и развернуть новый прибор, или активировать лицензию операционной системы прибора VM.
Язык операционной системы | Английский (en-us)
TLS | TLS 1.2 должен быть включен.
.NET Framework | .NET Framework 4.6 или позже должен быть установлен на машине (с сильной криптографией включена.
MySQL | MyS'L должен быть установлен на приборе.<br/> Должен быть установлен компонент MySQL. Вы можете установить вручную, или восстановление сайта можно установить во время развертывания прибора.
Другие приложения | Не запускайте другие приложения на приборе репликации.
Роли Windows Server | Не включайте эти роли: <br> — доменные службы Active Directory; <br>— службы IIS; <br> — Hyper-V.
Групповые политики | Не включать эти групповые политики: <br> — запрет на использование командной строки; <br> — запрет на использование инструментов редактирования реестра; <br> — логика доверия для вложенных файлов; <br> — включение выполнения скриптов. <br> [Дополнительные сведения](https://technet.microsoft.com/library/gg176671(v=ws.10).aspx)
IIS | — Должен отсутствовать предварительно созданный веб-сайт по умолчанию. <br> — Должен отсутствовать предварительно созданный веб-сайт или приложение, ожидающее передачи данных на порте 443. <br>— включите [анонимную аутентификацию](https://technet.microsoft.com/library/cc731244(v=ws.10).aspx); <br> — включите параметр [FastCGI](https://technet.microsoft.com/library/cc753077(v=ws.10).aspx);
**Настройки сети** |
Тип IP-адреса | Статические
порты; | 443 (оркестрация канала управления)<br>9443 (передача данных)
Тип сетевой карты | VMXNET3

## <a name="mysql-installation"></a>Установка MyS'L 

MyS'L должен быть установлен на аппарате репликации прибора. Он может быть установлен с помощью одного из этих методов.

**Метод** | **Сведения**
--- | ---
Скачать и установить вручную | Загрузите приложение MyS'L & поместите его в папку C: «Темп»ASRSetup, а затем установите вручную.<br/> При настройке прибора MyS'L будет отображаться как уже установленный.
Без загрузки в Интернете | Поместите приложение установки MyS'L в папку C: «Темп-ASRSetup. При установке прибора и нажмите кнопку, чтобы загрузить и установить MyS'L, установка будет использовать установку вы добавили.
Скачать и установить в Azure Migrate | Когда вы установите прибор и подсказываются для MyS'L, выберите **Скачать и установить**.

## <a name="url-access"></a>доступ по URL-адресу

Прибор репликации нуждается в доступе к этим URL-адресам в общедоступном облаке Azure.

**URL-адрес** | **Сведения**
--- | ---
\*.backup.windowsazure.com | Используется для передачи и координации реплицированных данных
\*.store.core.windows.net | Используется для передачи и координации реплицированных данных
\*.blob.core.windows.net | Используется для получения доступа к учетной записи хранения, в которой хранятся реплицируемые данные
\*.hypervrecoverymanager.windowsazure.com | Используется для операций управления репликацией и координации
https:\//management.azure.com | Используется для операций управления репликацией и координации
*.services.visualstudio.com | Используется в целях телеметрии (дополнительный параметр)
time.windows.com | Используются для проверки синхронизации системного и глобального времени.
https:\//login.microsoftonline.com <br/> https:\//secure.aadcdn.microsoftonline-p.com <br/> https:\//login.live.com <br/> https:\//graph.windows.net <br/> https:\//login.windows.net <br/> https:\//www.live.com <br/> https:\//www.microsoft.com  | Настройка прибора нуждается в доступе к этим URL-адресам. Они используются для управления доступом и удостоверениями с помощью Azure Active Directory.
https:\//dev.mysql.com/get/Downloads/MySQLInstaller/mysql-installer-community-5.7.20.0.msi | Для завершения загрузки MyS'L. В некоторых регионах загрузка может быть перенаправлена на URL CDN. Убедитесь, что URL CDN также разрешен при необходимости.


## <a name="azure-government-url-access"></a>Доступ к URL-адресам правительства Azure

Прибор репликации нуждается в доступе к этим URL-адресам в правительстве Azure.

**URL-адрес** | **Сведения**
--- | ---
\*.backup.windowsazure.us | Используется для передачи и координации реплицированных данных
\*.store.core.windows.net | Используется для передачи и координации реплицированных данных
\*.blob.core.windows.net | Используется для получения доступа к учетной записи хранения, в которой хранятся реплицируемые данные
\*.hypervrecoverymanager.windowsazure.us | Используется для операций управления репликацией и координации
https:\//management.usgovcloudapi.net | Используется для операций управления репликацией и координации
*.services.visualstudio.com | Используется в целях телеметрии (дополнительный параметр)
time.nist.gov | Используются для проверки синхронизации системного и глобального времени.
https:\//login.microsoftonline.com <br/> https:\//secure.aadcdn.microsoftonline-p.com <br/> https:\//login.live.com <br/> https:\//graph.windows.net <br/> https:\//login.windows.net <br/> https:\//www.live.com <br/> https:\//www.microsoft.com  | Установка прибора с OVA нуждается в доступе к этим URL-адресам. Они используются для управления доступом и управления идентификацией в каталоге Azure Active.
https:\//dev.mysql.com/get/Downloads/MySQLInstaller/mysql-installer-community-5.7.20.0.msi | Для завершения загрузки MyS'L. В некоторых регионах загрузка может быть перенаправлена на URL CDN. Убедитесь, что URL CDN также разрешен при необходимости.

## <a name="port-access"></a>Доступ в порт

**Устройство** | **Соединение**
--- | ---
Виртуальные машины | Служба мобильности, работающая на VMs, общается с прибором репликации (сервер конфигурации) на входящих порте HTTPS 443 для управления репликацией.<br/><br/> Виртуальные машины отправляют данные репликации на сервер обработки (запущенный на компьютере сервера конфигурации) через HTTPS-порт 9443 для входящих подключений. Этот порт можно изменить.
Репликационный прибор | Прибор репликации оркеструет репликацию с Azure над исходящим портом HTTPS 443.
Сервер обработки | Сервер процесса получает данные репликации, оптимизирует и шифрует их и отправляет в хранилище Azure через исходящий порт 443.<br/> По умолчанию сервер процесса работает на приборе репликации.


## <a name="replication-process"></a>Процесс репликации

1. При включении репликации для виртуальной машины начинается начальная репликация в службу хранилища Azure с помощью указанной политики репликации. 
2. Трафик реплицируется в общедоступные конечные точки службы хранилища Azure через Интернет. Репликация трафика через VPN типа "сеть — сеть" с локального сайта в Azure не поддерживается.
3. После завершения начальной репликации начинается разностная репликация. Отслеживаемые изменения для машины регистрируются.
4. Обмен данными происходит следующим образом.
    - VM общаются с прибором репликации на входящих портах HTTPS 443 для управления репликацией.
    - Прибор репликации оркеструет репликацию с Azure над исходящим портом HTTPS 443.
    - ВМ отправляют данные репликации на сервер процесса (работает на приборе репликации) на входящих в порт HTTPS 9443. Этот порт можно изменить.
    - Сервер процесса получает данные репликации, оптимизирует и шифрует их и отправляет в хранилище Azure через исходящий порт 443.
5. Данные репликации сначала приземляются в учетную запись хранения кэша в Azure. Эти журналы обрабатываются, и данные хранятся на управляемом Azure диске.

![Architecture](./media/migrate-replication-appliance/architecture.png)

## <a name="appliance-upgrades"></a>Модернизация приборов

Прибор обновляется вручную из концентратора Azure Migrate. Мы рекомендуем вам всегда запускать последнюю версию.

1. В Azure мигрируют > серверы > Azure мигрируют: Оценка серверов, серверы инфраструктуры, **нажмите На серверы конфигурации.**
2. В **серверах конфигурации,** ссылка появляется в **версии агента,** когда новая версия прибора репликации доступна. 
3. Загрузите установщик на аппарат репликации и установите обновление. Установщик обнаруживает ток версии, работающий на приборе.
 
## <a name="next-steps"></a>Следующие шаги

- [Узнайте, как](tutorial-migrate-vmware-agent.md#set-up-the-replication-appliance) настроить прибор репликации для миграции VMware VM на основе агента.
- [Узнайте, как](tutorial-migrate-physical-virtual-machines.md#set-up-the-replication-appliance) настроить прибор репликации для физических серверов.
