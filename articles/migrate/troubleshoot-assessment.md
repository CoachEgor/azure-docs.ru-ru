---
title: Устранение неполадок при оценке и визуализации зависимостей в службе "миграция Azure"
description: Получите справку по устранению неполадок при оценке и визуализации зависимостей в службе "миграция Azure".
ms.service: azure-migrate
ms.topic: troubleshooting
author: musa-57
ms.manager: abhemraj
ms.author: hamusa
ms.date: 01/02/2020
ms.openlocfilehash: 205b52201edb849abab02809b58ff9dc77a32a29
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "80127677"
---
# <a name="troubleshoot-assessmentdependency-visualization"></a>Устранение неполадок с визуализацией оценок и зависимостей

Эта статья поможет вам устранить проблемы с оценкой и визуализацией зависимостей с помощью службы ["миграция Azure": Оценка сервера](migrate-services-overview.md#azure-migrate-server-assessment-tool).


## <a name="assessment-readiness-issues"></a>Проблемы готовности к оценке

Устраните проблемы готовности к оценке, как показано ниже.

**Проблема** | **Исправно**
--- | ---
Неподдерживаемый тип загрузки | Azure не поддерживает виртуальные машины с типом загрузки EFI. Перед выполнением миграции рекомендуется преобразовать тип загрузки в BIOS. <br/><br/>Миграцию таких виртуальных машин можно выполнить с помощью миграции сервера Azure Migration. Во время миграции тип загрузки виртуальной машины будет преобразован в BIOS.
Условно поддерживаемая операционная система Windows | Операционная система прошла дату окончания поддержки, и для [поддержки в Azure](https://aka.ms/WSosstatement)требуется специальное соглашение о поддержке (CSA). Перед миграцией в Azure рассмотрите возможность обновления.
Неподдерживаемая операционная система Windows | Azure поддерживает только [Выбранные версии ОС Windows](https://aka.ms/WSosstatement). Рекомендуется обновить компьютер перед миграцией в Azure.
Условно поддерживаемая ОС Linux | Azure подтверждает только [Выбранные версии ОС Linux](../virtual-machines/linux/endorsed-distros.md). Рекомендуется обновить компьютер перед миграцией в Azure.
Неподдерживаемая ОС Linux | Компьютер может начать работу в Azure, но Azure не поддерживает операционные системы. Перед миграцией в Azure рассмотрите возможность обновления до рекомендованной [версии Linux](../virtual-machines/linux/endorsed-distros.md) .
Неизвестная операционная система | Операционная система виртуальной машины была указана в vCenter Server как "другая". Это поведение блокирует миграцию Azure для проверки готовности виртуальной машины к работе в Azure. Перед переносом компьютера убедитесь, что операционная система [поддерживается](https://aka.ms/azureoslist) Azure.
Неподдерживаемая разрядная версия | Виртуальные машины с 32-разрядными операционными системами могут загружаться в Azure, но перед миграцией в Azure рекомендуется выполнить обновление до 64-разрядной версии.
Требуется подписка Microsoft Visual Studio | Компьютер работает под управлением клиентской операционной системы Windows, которая поддерживается только в рамках подписки Visual Studio.
Не найдена виртуальная машина для требуемой производительности хранилища | Производительность хранилища (операций ввода-вывода в секунду и пропускная способность), необходимая для компьютера, превышает поддержку виртуальной машины Azure. Снизьте требования к хранилищу для компьютера перед выполнением миграции.
Не найдена виртуальная машина для требуемой производительности сети | Производительность сети (скорость входящего и исходящего трафика), необходимая для компьютера, превышает возможности поддерживаемых виртуальных машин Azure. Уменьшите требования к сети для компьютера.
Виртуальная машина не найдена в указанном расположении | Используйте другое целевое расположение, прежде чем выполнять миграцию.
Один или несколько несоответствующих дисков | Один или несколько дисков, подключенных к виртуальной машине, не соответствуют требованиям Azure. Конкретного<br/><br/> Служба "миграция Azure". Оценка серверов сейчас не поддерживает SSD (цен. категория "Ультра") диски и оценивает диски на основе ограничений дискового пространства для управляемых дисков уровня "Премиум" (32 ТБ).<br/><br/> Для каждого диска, подключенного к виртуальной машине, убедитесь, что размер диска составляет < 64 ТБ (поддерживается SSD (цен. категория "Ультра") дисками).<br/><br/> Если это не так, сократите размер диска перед миграцией в Azure или используйте несколько дисков в Azure и разработайте [их вместе](https://docs.microsoft.com/azure/virtual-machines/windows/premium-storage-performance#disk-striping) , чтобы получить более высокие ограничения хранилища. Убедитесь, что производительность (операций ввода-вывода и пропускная способность), необходимая для каждого диска, поддерживается [дисками виртуальной машины под управлением](https://docs.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits#storage-limits)Azure.
Один или несколько неподходящих сетевых адаптеров. | Удалите неиспользуемые сетевые адаптеры с компьютера перед миграцией.
Число дисков превышает ограничение | Удалите неиспользуемые диски с компьютера перед миграцией.
Размер диска превышает ограничение | Служба "миграция Azure": Оценка серверов сейчас не поддерживает SSD (цен. категория "Ультра") диски и оценивает диски на основе ограничений по лимиту дисков уровня "Премиум" (32 ТБ).<br/><br/> Однако Azure поддерживает диски размером до 64 ТБ (поддерживается SSD (цен. категория "Ультра") дисков). Сократите диски до 64 ТБ перед миграцией или используйте несколько дисков в Azure и разработайте [их вместе](https://docs.microsoft.com/azure/virtual-machines/windows/premium-storage-performance#disk-striping) , чтобы получить более высокие ограничения хранилища.
Диск недоступен в указанном расположении | Убедитесь, что диск доступен в целевом расположении, прежде чем выполнять миграцию.
Недоступен диск для обеспечения указанной избыточности | Диск должен использовать тип избыточности хранилища, указанный в параметрах оценки (по умолчанию — LRS).
Не удалось определить пригодность диска из-за внутренней ошибки | Попробуйте создать новую оценку для группы.
Виртуальная машина с требуемым числом ядер и объемом памяти не найдена | Azure не удалось найти подходящий тип виртуальной машины. Уменьшите объем памяти и число ядер на локальном компьютере, прежде чем выполнять миграцию.
Не удалось определить пригодность виртуальной машины из-за внутренней ошибки | Попробуйте создать новую оценку для группы.
Не удалось определить пригодность для одного или нескольких дисков из-за внутренней ошибки | Попробуйте создать новую оценку для группы.
Не удалось определить пригодность для одного или нескольких сетевых адаптеров из-за внутренней ошибки | Попробуйте создать новую оценку для группы.

## <a name="linux-vms-are-conditionally-ready"></a>Виртуальные машины Linux называются условно готовыми.

Оценка сервера помечает виртуальные машины Linux как "условно готовые" из-за известного разрыва в оценке сервера.

- Разрыв предотвращает обнаружение дополнительной версии ОС Linux, установленной на локальных виртуальных машинах.
- Например, для RHEL 6,10 в настоящее время Оценка сервера обнаруживает только RHEL 6 в качестве версии ОС.
-  Так как Azure поддерживает только определенные версии Linux, виртуальные машины Linux в настоящее время отмечены как условно готовые к оценке серверов.
- Вы можете определить, будет ли операционная система Linux, работающая на локальной виртуальной машине, одобрена в Azure, просмотрев [поддержку Linux в Azure](https://aka.ms/migrate/selfhost/azureendorseddistros).
-  Убедившись в подтвержденном распространении, можно проигнорировать это предупреждение.

## <a name="azure-skus-bigger-than-on-premises"></a>Номера SKU Azure больше, чем в локальной среде

При оценке серверов в службе "миграция Azure" можно рекомендовать номера SKU виртуальных машин Azure с большим количеством ядер и памяти, чем текущее локальное выделение, в зависимости от типа оценки:


- Рекомендации по SKU виртуальной машины зависят от свойств оценки.
- Это зависит от типа оценки, выполняемой при оценке сервера: на *основе производительности*или *в локальной среде*.
- Для оценки на основе производительности в ходе оценки серверов учитываются данные об использовании локальных виртуальных машин (ЦП, памяти, диска и использования сети), чтобы определить правильный номер SKU целевой виртуальной машины для локальных виртуальных машин. Он также добавляет эффективный фактор при определении эффективного использования.
- Для локального изменения размера данные о производительности не учитываются, и рекомендуется использовать целевой номер SKU на основе локального выделения.

Чтобы продемонстрировать, как это может повлиять на рекомендации, давайте рассмотрим пример.

У нас есть локальная виртуальная машина с четырьмя ядрами и восемью ГБ памяти, с 50% использования ЦП и 50% использования памяти и заданным комфортным фактором 1,3.

-  Если оценка является **локальной**, то рекомендуется использовать номер SKU виртуальной машины Azure с четырьмя ядрами и 8 ГБ памяти.
- Если оценка основана на производительности, то в зависимости от эффективности использования ЦП и памяти (50% от 4 ядер * 1,3 = 2,6 ядер и 50% от 8 ГБ памяти * 1,3 = 5,3 ГБ памяти) рекомендуется использовать самый дешевый номер SKU для четырех ядер (ближайшее поддерживаемое число ядер) и восемь Гб памяти (ближайший поддерживаемый объем памяти).
- Дополнительные [сведения](concepts-assessment-calculation.md#types-of-assessments) о размере оценки.

## <a name="azure-disk-skus-bigger-than-on-premises"></a>Номера SKU дисков Azure больше, чем в локальной среде

Для оценки серверов в Azure можно использовать более крупный диск в зависимости от типа оценки.
- Размер диска в оценке сервера зависит от двух свойств оценки: критериев изменения размера и типа хранилища.
- Если критерии изменения размера **основаны на производительности**, а для типа хранилища задано значение **автоматически**, значения операций ввода-вывода и пропускной способности диска учитываются при определении типа целевого диска (HDD (цен. Категория "Стандартный"), SSD (цен. Категория "Стандартный") или Premium). Рекомендуется использовать дисковый номер SKU из типа диска, и в рекомендации учитываются требования к размеру локального диска.
- Если критерии изменения размера **основаны на производительности**, а тип хранилища — **Premium**, рекомендуется использовать номер SKU диска уровня "Премиум" в Azure на основе требований к операциям ввода-вывода, пропускной способности и размеру локального диска. Та же логика используется для создания размера диска, если критерий изменения размера — **локально** , а тип хранилища — **HDD (цен. Категория "Стандартный")**, **SSD (цен. Категория "Стандартный")** или **Premium**.

Например, если у вас есть локальный диск с 32 ГБ памяти, но агрегированные операции чтения и записи для диска составляет 800 операций ввода-вывода, серверная Оценка рекомендует диск уровня "Премиум" (из-за более высоких требований к операциям ввода-вывода), а затем рекомендует номер SKU диска, поддерживающий требуемые операции ввода-вывода и размер. Наиболее подходящий вариант в этом примере будет P15 (256 ГБ и 1100 операций ввода-вывода). Несмотря на то, что размер, необходимый для локального диска, составляет 32 ГБ, при оценке сервера рекомендуется использовать диск большего размера из-за высокого требования к операции ввода-вывода в секунду для локального диска.

## <a name="utilized-corememory-percentage-missing"></a>Использованные ядра/процент памяти отсутствует

Отчеты об оценке серверов "Перцентажеофкоресутилизедмиссинг" или "Перцентажеофмеморютилизедмиссинг", если устройство для миграции Azure не может выполнять собранные данные о производительности для соответствующих локальных виртуальных машин.

- Это может произойти, если виртуальные машины отключены в течение периода оценки. Устройство не может выполнять собранные данные о производительности для виртуальной машины, если она выключена.
- Если отсутствуют только счетчики памяти и вы пытаетесь оценить виртуальные машины Hyper-V, проверьте, включена ли динамическая память на этих виртуальных машинах. Существует известная ошибка только для виртуальных машин Hyper-V, в которых устройство для миграции Azure не может выполнять получение данных об использовании памяти для виртуальных машин, для которых не включена динамическая память.
- Если какой-либо из счетчиков производительности отсутствует, Оценка сервера Azure для миграции переключается на выделенные ядра и память и рекомендует соответствующий размер виртуальной машины.
- Если все счетчики производительности отсутствуют, убедитесь, что выполнены требования к доступу к портам для оценки. Узнайте больше о требованиях к доступу к портам для оценки [VMware](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-vmware#port-access), [Hyper-V](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-hyper-v#port-access) и [физического](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-physical#port-access) сервера.

## <a name="is-the-operating-system-license-included"></a>Включена ли лицензия на операционную систему?

Оценка сервера "миграция Azure" в настоящее время учитывает затраты на лицензии операционной системы только для компьютеров Windows. Затраты на лицензии для компьютеров Linux в настоящее время не рассматриваются.

## <a name="how-does-performance-based-sizing-work"></a>Как работает изменение размера на основе производительности?

Средство оценки серверов непрерывно ведет журнал производительности локальных компьютеров. Эти данные используются для предоставления рекомендаций по выбору номера SKU виртуальной машины и диска в Azure. [Узнайте, как](concepts-assessment-calculation.md#calculate-sizing-performance-based) собираются данные на основе производительности.


## <a name="dependency-visualization-in-azure-government"></a>Визуализация зависимостей в Azure для государственных организаций

Служба "миграция Azure" зависит от Сопоставление служб функции визуализации зависимостей. Так как Сопоставление служб в настоящее время недоступна в Azure для государственных организаций, эта функция недоступна в Azure для государственных организаций.

## <a name="dependencies-dont-show-after-agent-install"></a>Зависимости не отображаются после установки агента

После установки агентов визуализации зависимостей на локальных виртуальных машинах для отображения зависимостей на портале Служба "миграция Azure" обычно занимает 15-30 минут. Если вы ожидали более 30 минут, убедитесь, что Microsoft Monitoring Agent (MMA) может подключаться к рабочей области Log Analytics.

Для виртуальных машин Windows:
1. На панели управления запустите MMA.
2. В **свойствах** > Microsoft Monitoring Agent**Azure log Analytics (OMS)** убедитесь, что **состояние** рабочей области — зеленый.
3. Если состояние не является зеленым, попробуйте удалить рабочую область и добавить ее снова в MMA.

    ![Состояние MMA](./media/troubleshoot-assessment/mma-properties.png)

Для виртуальных машин Linux убедитесь, что команды установки для MMA и агент зависимостей были успешной.

## <a name="supported-operating-systems"></a>Поддерживаемые операционные системы

- **MMS Agent**: Ознакомьтесь с поддерживаемыми операционными системами [Windows](https://docs.microsoft.com/azure/log-analytics/log-analytics-concept-hybrid#supported-windows-operating-systems)и [Linux](https://docs.microsoft.com/azure/log-analytics/log-analytics-concept-hybrid#supported-linux-operating-systems) .
- **Агент зависимостей**. Поддерживаемые операционные системы [Windows и Linux](../azure-monitor/insights/vminsights-enable-overview.md#supported-operating-systems) .

## <a name="visualize-dependencies-for--hour"></a>Визуализировать зависимости для > часа

Хотя служба "миграция Azure" позволяет вернуться к определенной дате в прошлом месяце, максимальная продолжительность, для которой можно визуализировать зависимости, составляет один час.

Например, можно использовать функцию длительности времени в сопоставлении зависимостей для просмотра зависимостей за вчерашний период, но их можно просмотреть только в течение одного часа.

Однако можно использовать журналы Azure Monitor для [запроса данных зависимости](https://docs.microsoft.com/azure/migrate/how-to-create-group-machine-dependencies) в течение более длительного времени.

## <a name="visualized-dependencies-for--10-machines"></a>Наглядные зависимости для > 10 компьютеров

С помощью средства "Миграция серверов в Azure" можно [визуализировать зависимости для групп](https://docs.microsoft.com/azure/migrate/how-to-create-group-dependencies) с 10 виртуальными машинами. Для более крупных групп рекомендуется разделить виртуальные машины на более мелкие группы, чтобы визуализировать зависимости.

## <a name="machines-show-install-agent"></a>Компьютеры показывают "установить агент"

После переноса компьютеров с включенной визуализацией зависимостей в Azure компьютеры могут отображать действие "установить агент" вместо "Просмотр зависимостей" из-за следующего поведения:


- После миграции в Azure локальные компьютеры отключаются, а аналогичные виртуальные машины загружаются в Azure. Эти компьютеры получают другие MAC-адреса.
- Компьютеры могут также иметь разные IP-адреса в зависимости от того, был ли сохранен локальный IP-адрес.
- Если MAC и IP-адреса отличаются от локальных, служба "миграция Azure" не связывает локальные компьютеры с данными зависимостей Сопоставление служб. В этом случае будет показан параметр для установки агента, а не для просмотра зависимостей.
- После выполнения тестовой миграции в Azure локальные компьютеры остаются включенными, как и ожидалось. Аналогичные компьютеры запрашиваются в Azure, получают другой MAC-адрес и могут получать разные IP адреса. Если вы не блокируете исходящий трафик журнала Azure Monitor с этих компьютеров, служба "миграция Azure" не будет связывать локальные компьютеры с данными зависимостей Сопоставление служб, поэтому в этом случае отобразится возможность установки агентов, а не для просмотра зависимостей.


## <a name="capture-network-traffic"></a>Запись сетевого трафика

Собирайте журналы сетевого трафика следующим образом:

1. Войдите на [портал Azure](https://portal.azure.com).
2. Нажмите клавишу F12, чтобы запустить Средства для разработчиков. При необходимости снимите флажок **Очистить записи в** параметрах навигации.
3. Перейдите на вкладку **сеть** и запустите запись сетевого трафика.
   - В Chrome установите флажок **Preserve log** (Сохранить журнал). Запись должна начаться автоматически. Красный кружок означает, что трафик перехватывается. Если красный круг не отображается, выберите черный круг для начала.
   - В Microsoft ребр и Internet Explorer запись должна запускаться автоматически. Если это не так, нажмите зеленую кнопку воспроизведения.
4. Попробуйте воспроизвести ошибку.
5. Если при записи возникла ошибка, остановите запись и сохраните копию записанных действий.
   - В Chrome щелкните правой кнопкой мыши и выберите **Сохранить как HAR с содержимым**. Это действие сжимает и экспортирует журналы как HAR-файл.
   - В Microsoft ребр или Internet Explorer выберите параметр **экспортировать захваченный трафик** . Это действие сжимает и экспортирует журнал.
6. Перейдите на вкладку **консоль** , чтобы проверить наличие предупреждений или ошибок. Чтобы сохранить журнал консоли, сделайте следующее.
   - В Chrome щелкните правой кнопкой мыши в любом месте в журнале консоли. Выберите **Сохранить как**, экспорт и заархивировать журнал.
   - В Microsoft ребр или Internet Explorer щелкните ошибки правой кнопкой мыши и выберите команду **Копировать все**.
7. Закройте средства для разработчиков.

## <a name="next-steps"></a>Дальнейшие шаги

[Создание](how-to-create-assessment.md) или [Настройка](how-to-modify-assessment.md) оценки.
