---
title: Оценка проблем и визуализация зависимости в Azure Migrate
description: Получите помощь в оценке устранения неполадок и визуализации зависимостей в Azure Migrate.
ms.service: azure-migrate
ms.topic: troubleshooting
author: musa-57
ms.manager: abhemraj
ms.author: hamusa
ms.date: 01/02/2020
ms.openlocfilehash: 205b52201edb849abab02809b58ff9dc77a32a29
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80127677"
---
# <a name="troubleshoot-assessmentdependency-visualization"></a>Устранение неполадок с визуализацией оценок и зависимостей

Эта статья помогает выснять проблемы с оценкой и визуализацией зависимостей с [помощью Azure Migrate: Server Assessment.](migrate-services-overview.md#azure-migrate-server-assessment-tool)


## <a name="assessment-readiness-issues"></a>Вопросы готовности к оценке

Исправление проблем готовности оценки следующим образом:

**Проблема** | **Исправить**
--- | ---
Неподдерживаемый тип загрузки | Azure не поддерживает vMs с типом загрузки EFI. Мы рекомендуем преобразовать тип загрузки в BIOS перед запуском миграции. <br/><br/>Для обработки миграции таких висеях можно использовать миграцию серверов Azure Migrate. Он преобразует тип загрузки VM в BIOS во время миграции.
Условно поддерживаемая операционная система Windows | Операционная система прошла дату окончания поддержки и нуждается в Соглашении о таможенной поддержке (CSA) для [поддержки в Azure.](https://aka.ms/WSosstatement) Перед переходом в Azure подумайте об обновлении.
Неподдерживаемая операционная система Windows | Azure поддерживает только [отдельные версии ОС Windows.](https://aka.ms/WSosstatement) Перед переходом в Azure можно обновить машину.
Условно поддерживаемая ОС Linux | Azure поддерживает только [отдельные версии Linux OS.](../virtual-machines/linux/endorsed-distros.md) Перед переходом в Azure можно обновить машину.
Неподдерживаемая ОС Linux | Машина может быть приведена в эксплуатацию в Azure, но Azure не обеспечивает поддержку операционной системы. Перед переходом в Azure можно перейти на [обновленную версию Linux.](../virtual-machines/linux/endorsed-distros.md)
Неизвестная операционная система | Операционная система VM была указана как "Другие" в vCenter Server. Такое поведение блокирует Azure Migrate от проверки готовности Azure VM. Убедитесь, что операционная система [поддерживается](https://aka.ms/azureoslist) Azure перед переносом машины.
Неподдерживаемая версия бита | ВМ с 32-разрядными операционными системами могут загружаться в Azure, но мы рекомендовали обновиться до 64-битного, прежде чем перейти в Azure.
Требуется подписка Microsoft Visual Studio | Машина работает под управлением клиентской операционной системы Windows, которая поддерживается только через подписку Visual Studio.
VM не найден для требуемой производительности хранилища | Производительность хранилища (входные/выходные операции в секунду (IOPS) и пропускная способность), необходимая для машины, превышает поддержку Azure VM. Снизьте требования к хранилищу для компьютера перед выполнением миграции.
VM не найден для требуемой производительности сети | Производительность сети (скорость входящего и исходящего трафика), необходимая для компьютера, превышает возможности поддерживаемых виртуальных машин Azure. Уменьшите требования к сети для компьютера.
VM не найден в указанном месте | Используйте другое целевое расположение, прежде чем выполнять миграцию.
Один или несколько неподходящих дисков | Один или несколько дисков, прикрепленных к VM, не соответствуют требованиям Azure. A<br/><br/> Azure Migrate: Оценка серверов в настоящее время не поддерживает диски Ultra SSD и оценивает диски на основе ограничений дисков для премиальных управляемых дисков (32 ТБ).<br/><br/> Для каждого диска, прикрепленного к VM, убедитесь, что размер диска составляет < 64 ТБ (поддерживается Ультра SSD дисков).<br/><br/> Если это не так, уменьшите размер диска перед миграцией в Azure, или используйте несколько дисков в Azure и [сливих их вместе,](https://docs.microsoft.com/azure/virtual-machines/windows/premium-storage-performance#disk-striping) чтобы получить более высокие лимиты хранения. Убедитесь, что производительность (IOPS и пропускная способность), необходимая каждому диску, поддерживается [управляемыми фактическими машинными дисками](https://docs.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits#storage-limits)Azure.
Один или несколько неподходящих сетевых адаптеров. | Удалите неиспользуемые сетевые адаптеры с компьютера перед миграцией.
Число дисков превышает ограничение | Удалите неиспользуемые диски с компьютера перед миграцией.
Размер диска превышает ограничение | Azure Migrate: Оценка серверов в настоящее время не поддерживает диски Ultra SSD и оценивает диски на основе премиум-лимитов дисков (32 ТБ).<br/><br/> Тем не менее, Azure поддерживает диски с размером до 64 ТБ (поддерживается ультра SSD дисками). Сократите диски до менее чем 64 ТБ до миграции или используйте несколько дисков в Azure и [сгруппировать их вместе,](https://docs.microsoft.com/azure/virtual-machines/windows/premium-storage-performance#disk-striping) чтобы получить более высокие лимиты хранения.
Диск недоступен в указанном расположении | Убедитесь, что диск доступен в целевом расположении, прежде чем выполнять миграцию.
Недоступен диск для обеспечения указанной избыточности | Диск должен использовать тип избыточности хранилища, указанный в параметрах оценки (по умолчанию — LRS).
Не удалось определить пригодность диска из-за внутренней ошибки | Попробуйте создать новую оценку для группы.
Виртуальная машина с требуемым числом ядер и объемом памяти не найдена | Azure не смогла найти подходящий тип VM. Уменьшите объем памяти и число ядер на локальном компьютере, прежде чем выполнять миграцию.
Не удалось определить пригодность VM из-за внутренней ошибки | Попробуйте создать новую оценку для группы.
Не удалось определить пригодность для одного или нескольких дисков из-за внутренней ошибки | Попробуйте создать новую оценку для группы.
Не удалось определить пригодность для одного или нескольких сетевых адаптеров из-за внутренней ошибки | Попробуйте создать новую оценку для группы.

## <a name="linux-vms-are-conditionally-ready"></a>Linux VMs "условно готовы"

Оценка сервера отмечает Linux VMs как «условно готовый» из-за известного пробела в оценке серверов.

- Разрыв не позволяет обнаружить незначительную версию ОС Linux, установленную на предприимчовых ВМ.
- Например, для RHEL 6.10 в настоящее время оценка сервера обнаруживает только RHEL 6 в качестве версии ОС.
-  Поскольку Azure поддерживает только конкретные версии Linux, Linux VMs в настоящее время помечены как условно готовые в оценке серверов.
- Вы можете определить, поддерживается ли оси Linux, работающим на предприимчивом VM, в Azure, просмотрев [поддержку Azure Linux.](https://aka.ms/migrate/selfhost/azureendorseddistros)
-  После проверки одобренного дистрибутива вы можете проигнорировать это предупреждение.

## <a name="azure-skus-bigger-than-on-premises"></a>Azure SKUs больше, чем на территории

Оценка azure Migrate Server может рекомендовать SkUS Azure VM с большим количеством ядер и памяти, чем текущее распределение на месте в зависимости от типа оценки:


- Рекомендация ВМ СКУ зависит от свойств оценки.
- На это влияет тип оценки, выполняемый в Server Assessment: *Performance-based,* или *Как на месте.*
- Для оценки производительности Server Assessment учитывает данные об использовании внутренних VM (CPU, память, диск и использование сети) для определения правильной цели VM SKU для ваших предприимчовых VMs. Он также добавляет фактор комфорта при определении эффективного использования.
- Для расположения на территории размеров данные о производительности не учитываются, а целевой SKU рекомендуется на основе распределения помещений.

Чтобы показать, как это может повлиять на рекомендации, давайте возьмем пример:

У нас есть предприимчательный VM с четырьмя ядрами и восемью ГБ памяти, с 50% использованием процессора и 50% использованием памяти, и указанный коэффициент комфорта 1,3.

-  Если оценка проводится в **качестве предварительного**помещения, рекомендуется Azure VM SKU с четырьмя ядрами и 8 ГБ памяти.
- Если оценка основана на производительности, на основе эффективного использования процессора и памяти (50% от 4 ядер no 1.3 и 2,6 ядра и 50% памяти 8 ГБ и памяти 1,3 и 5,3 ГБ памяти), самый дешевый VM SKU из четырех ядер (ближайший поддерживаемый основной кол) и восемь ГБ памяти (ближайший поддерживаемый память) рекомендуется.
- [Подробнее](concepts-assessment-calculation.md#types-of-assessments) об размерах оценки.

## <a name="azure-disk-skus-bigger-than-on-premises"></a>Azure диск SKUs больше, чем на месте

Оценка миграционных серверов Azure может рекомендовать больший диск в зависимости от типа оценки.
- Размер диска в оценке сервера зависит от двух свойств оценки: критериев размера и типа хранилища.
- Если критерии размеров **основаны на производительности,** а тип хранилища установлен на **Automatic,** IOPS и значения пропускной способности диска учитываются при определении типа целевого диска (Standard HDD, Standard SSD или Premium). Затем рекомендуется диск SKU из типа диска, и в рекомендации учитываются требования к размеру лоясового диска.
- Если критерии размеров **основаны на производительности,** а тип хранилища **— премиум,** то в Azure рекомендуется высококлассный диск SKU, основанный на требованиях IOPS, пропускной способности и размера множества диска. Та же логика используется для выполнения размеров диска, когда критерии размеров, **как на месте** и тип хранения **стандартных HDD**, **Стандартный SSD**, или **Премиум**.

Например, если у вас есть внутренний диск с 32 ГБ памяти, но агрегированные читать и писать IOPS для диска 800 IOPS, Server Assessment рекомендует премиум диск (из-за более высоких требований IOPS), а затем рекомендует диск SKU, который может поддерживать требуется IOPS и размер. Наиболее подходящий вариант в этом примере будет P15 (256 ГБ и 1100 операций ввода-вывода). Несмотря на то, что размер, требуемый локальным диском, составил 32 ГБ, Server Assessment рекомендует более крупный диск из-за высокого требования IOPS к локальным дискам.

## <a name="utilized-corememory-percentage-missing"></a>Использованое ядро/процент памяти отсутствует

Оценка серверов сообщает "PercentageOfCoresUtilizedMissing" или "PercentageOfMemoryUtilizedMissing", когда прибор Azure Migrate не может собирать данные о производительности для соответствующих внутренних VMs.

- Это может произойти, если ВМ выключены во время оценки. Прибор не может собирать данные о производительности для VM при выключении.
- Если отсутствуют только счетчики памяти и вы пытаетесь оценить Hyper-V V, проверьте, есть ли у вас динамическая память включена на этих VMs. Известна проблема только для Hyper-V V, в которой прибор Azure Migrate не может собирать данные об использовании памяти для vMs, которые не имеют динамической памяти.
- Если какой-либо из счетчиков производительности отсутствует, оценка Azure Migrate Server Переходит возвращается к выделенным ядрам и памяти, и рекомендует соответствующий размер VM.
- Если все счетчики производительности отсутствуют, убедитесь, что требования к доступу в порт для оценки будут выполнены. Узнайте больше о требованиях к доступу в порт для [VMware,](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-vmware#port-access) [Hyper-V](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-hyper-v#port-access) и [оценки физического](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-physical#port-access) сервера.

## <a name="is-the-operating-system-license-included"></a>Включена ли лицензия операционной системы?

В настоящее время Azure Migrate Server Assessment рассматривает стоимость лицензии операционной системы только для компьютеров Windows. Стоимость лицензии на машины Linux в настоящее время не рассматривается.

## <a name="how-does-performance-based-sizing-work"></a>Как работает размер на основе производительности?

Средство оценки серверов непрерывно ведет журнал производительности локальных компьютеров. Эти данные используются для предоставления рекомендаций по выбору номера SKU виртуальной машины и диска в Azure. [Узнайте, как](concepts-assessment-calculation.md#calculate-sizing-performance-based) собираются данные, основанные на производительности.


## <a name="dependency-visualization-in-azure-government"></a>Визуализация зависимостей в правительстве Azure

Azure Migrate зависит от карты обслуживания для функциональности визуализации зависимостей. Поскольку карта обслуживания в настоящее время недоступна в правительстве Azure, эта функциональность недоступна в правительстве Azure.

## <a name="dependencies-dont-show-after-agent-install"></a>Зависимости не отображимы после установки агента

После установки элементов визуализации зависимостей на предприимчивых визумах Azure Migrate обычно занимает 15-30 минут для отображения зависимостей на портале. Если вы ждали более 30 минут, убедитесь, что агент мониторинга Майкрософт (MMA) может подключиться к рабочей области Log Analytics.

Для виртуальных машин Windows:
1. В панели управления, начать MMA.
2.  > В **свойствах агента мониторинга Майкрософт****Azure Log Analytics (OMS)** убедитесь, что **статус** рабочего пространства является зеленым.
3. Если статус не является зеленым, попробуйте удалить рабочее пространство и добавить его снова в MMA.

    ![Статус ММА](./media/troubleshoot-assessment/mma-properties.png)

Для Linux VMs убедитесь, что команды установки для MMA и агента зависимости удалось.

## <a name="supported-operating-systems"></a>Поддерживаемые операционные системы

- **Агент MMS**: Просмотрите поддерживаемые [Операционные](https://docs.microsoft.com/azure/log-analytics/log-analytics-concept-hybrid#supported-windows-operating-systems)системы Windows и [Linux.](https://docs.microsoft.com/azure/log-analytics/log-analytics-concept-hybrid#supported-linux-operating-systems)
- **Агент зависимости:** поддерживаемые операционные системы [Windows и Linux.](../azure-monitor/insights/vminsights-enable-overview.md#supported-operating-systems)

## <a name="visualize-dependencies-for--hour"></a>Визуализация зависимостей за > час

Хотя Azure Migrate позволяет вернуться к определенной дате в прошлом месяце, максимальная продолжительность, для которой вы можете визуализировать зависимости, составляет один час.

Например, можно использовать функциональность продолжительности времени на карте зависимостей для просмотра зависимостей за вчерашний день, но можно просматривать их только за один час.

Однако для [запроса данных зависимости](https://docs.microsoft.com/azure/migrate/how-to-create-group-machine-dependencies) можно использовать журналы Azure Monitor в течение более длительного времени.

## <a name="visualized-dependencies-for--10-machines"></a>Визуализированные зависимости для > 10 машин

В оценке Azure Migrate Server Можно [визуализировать зависимости для групп](https://docs.microsoft.com/azure/migrate/how-to-create-group-dependencies) с до 10 ВМ. Для больших групп мы рекомендуем разделить визуализировать визуализировать зависимости на более мелкие группы.

## <a name="machines-show-install-agent"></a>Машины показывают "Установить агент"

После того, как мигрирующие машины с визуализацией зависимостей включены в Azure, машины могут отображать действие "Установка агента" вместо "Просмотр зависимостей" из-за следующего поведения:


- После миграции в Azure в Azure отключаются прививные машины и в Azure закручены эквивалентные ВМ. Эти компьютеры получают другие MAC-адреса.
- Машины могут также иметь другой IP-адрес, в зависимости от того, сохранили ли вы на территории IP-адрес или нет.
- Если оба MAC и IP-адреса отличаются от предварительных, Azure Migrate не связывает наемные машины с данными зависимости карты обслуживания. В этом случае он будет отображать возможность установки агента, а не просматривать зависимости.
- После тестового переноса в Azure, в ней остаются включены, как ожидалось. Эквивалентные машины, вращаемые в Azure, приобретают различные MAC-адреса и могут приобретать различные IP-адреса. Если вы не заблокируете исходящий трафик журналов Azure Monitor из этих машин, Azure Migrate не будет связывать предприимчивые машины с любыми данными зависимости карты обслуживания и, таким образом, будет отображать возможность установки агентов, а не просматривать зависимости.


## <a name="capture-network-traffic"></a>Захват сетевого трафика

Сбор журналов сетевого трафика следующим образом:

1. Войдите на [портал Azure](https://portal.azure.com).
2. Нажмите F12, чтобы начать разработчик инструменты. При необходимости очистите **четкие записи в** настройках навигации.
3. Выберите вкладку **Сети** и начните захват сетевого трафика:
   - В Chrome установите флажок **Preserve log** (Сохранить журнал). Запись должна начаться автоматически. Красный круг указывает на захват трафика. Если красный круг не отображается, выберите черный круг для начала.
   - В Microsoft Edge и Internet Explorer запись должна начинаться автоматически. Если это не так, выберите зеленую кнопку воспроизведения.
4. Попробуйте воспроизвести ошибку.
5. Если при записи возникла ошибка, остановите запись и сохраните копию записанных действий.
   - В Chrome, правой кнопкой мыши и выберите **Сохранить как HAR с содержанием**. Это действие сжимает и экспортирует журналы в виде файла .har.
   - В Microsoft Edge или Internet Explorer выберите опцию **трафика, захваченного экспортом.** Это действие сжимает и экспортирует журнал.
6. Выберите вкладку **Консоль** для проверки любых предупреждений или ошибок. Чтобы сохранить журнал консоли, сделайте следующее.
   - В Chrome щелкните правой кнопкой мыши в любом месте в журнале консоли. Выберите **Сохранить как**, экспортировать, и застегнуть журнал.
   - В Microsoft Edge или Internet Explorer, право нажмите на ошибки и выберите **Копировать все**.
7. Закройте средства для разработчиков.

## <a name="next-steps"></a>Дальнейшие действия

[Создайте](how-to-create-assessment.md) или [настройте](how-to-modify-assessment.md) оценку.
