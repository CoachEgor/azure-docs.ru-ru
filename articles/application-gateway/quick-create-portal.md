---
title: Краткое руководство. прямой веб-трафик с помощью портала
titleSuffix: Azure Application Gateway
description: Узнайте, как с помощью портала Azure создать Шлюз приложений Azure, который направляет веб-трафик к виртуальным машинам в серверном пуле.
services: application-gateway
author: vhorne
ms.service: application-gateway
ms.topic: quickstart
ms.date: 03/09/2020
ms.author: victorh
ms.custom: mvc
ms.openlocfilehash: 17adc800bd5a2ae53e27350c7e0d588eaeee4a8f
ms.sourcegitcommit: 8f4d54218f9b3dccc2a701ffcacf608bbcd393a6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/09/2020
ms.locfileid: "78945795"
---
# <a name="quickstart-direct-web-traffic-with-azure-application-gateway---azure-portal"></a>Краткое руководство. Направление веб-трафика с помощью шлюза приложений Azure на портале Azure

В этом кратком руководстве для создания шлюза приложений используется портал Azure. Затем протестируйте его, чтобы убедиться, что он работает правильно. 

Шлюз приложений направляет веб-трафик приложений в определенные ресурсы в серверном пуле. Вы назначаете прослушиватели для портов, создаете правила и добавляете ресурсы во внутренний пул. Для простоты в этой статье используется простая настройка с общедоступным внешним IP-адресом, базовый прослушиватель для размещения одного сайта в шлюзе приложений, правило маршрутизации запросов и две виртуальные машины во внутреннем пуле.

Это краткое руководство можно также выполнить с помощью [Azure PowerShell](quick-create-powershell.md) или [Azure CLI](quick-create-cli.md).

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]



## <a name="prerequisites"></a>предварительные требования

- Учетная запись Azure с активной подпиской. [Создайте учетную запись бесплатно](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).

## <a name="sign-in-to-the-azure-portal"></a>Вход на портал Azure

Войдите на [портал Azure](https://portal.azure.com) с помощью своей учетной записи Azure.

## <a name="create-an-application-gateway"></a>Создание шлюза приложений

Вы создадите шлюз приложений с помощью вкладок на странице **Создание шлюза приложений** .

1. На **домашней странице** или в меню портала Azure выберите **Создать ресурс**. Появится окно **Создать**.

2. Выберите **Сети**, а затем в списке **Рекомендованные** выберите **Шлюз приложений**.

### <a name="basics-tab"></a>Вкладка "Основные сведения"

1. На вкладке **Основные сведения** введите значения для следующих параметров шлюза приложений.

   - **Группа ресурсов**. Выберите **myResourceGroupAG** для группы ресурсов. Выберите **Создать** для создания группы ресурсов, если она еще не существует.
   - **Имя шлюза приложений**. Введите *myAppGateway* в качестве имени шлюза приложений.

     ![Создание нового шлюза приложений: основные сведения](./media/application-gateway-create-gateway-portal/application-gateway-create-basics.png)

2. В Azure для обмена между создаваемыми ресурсами необходима виртуальная сеть. Вы можете создать новую виртуальную сеть или использовать существующую. В этом примере вы можете создать виртуальную сеть одновременно со шлюзом приложений. Экземпляры Шлюза приложений создаются в отдельных подсетях. В этом примере создаются две подсети: одна — для шлюза приложений, а вторая — для внутренних серверов.

    В разделе **Настройка виртуальной сети** создайте новую виртуальную сеть, выбрав команду **Создать**. В открывшемся окне **Создание виртуальной сети** введите следующие значения, которые будут использоваться для создания виртуальной сети и двух подсетей.

    - **Имя**: введите *myVNet* в качестве имени виртуальной сети.

    - **Имя подсети** (подсеть шлюза приложений). в сетке **подсети** будет отображаться подсеть с именем *по умолчанию*. Измените имя этой подсети на *myAGSubnet*.<br>Подсеть шлюза приложений может содержать только шлюзы приложений. Другие ресурсы запрещены.

    - **Имя подсети** (подсеть внутреннего сервера). во второй строке сетки **подсети** введите *MyBackendSubnet* в столбце **имя подсети** .

    - **Диапазон адресов** (подсеть внутреннего сервера). во второй строке сетки **подсетей** введите диапазон адресов, который не пересекается с диапазоном адресов *myAGSubnet*. Например, если диапазон адресов *myAGSubnet* равен 10.0.0.0/24, введите *10.0.1.0/24* для диапазона адресов *myBackendSubnet*.

    Выберите **ОК**, чтобы закрыть окно **Создание виртуальной сети** и сохранить настройки виртуальной сети.

     ![Создание шлюза приложений: виртуальная сеть](./media/application-gateway-create-gateway-portal/application-gateway-create-vnet.png)
    
3. На вкладке **основные** параметры примите значения по умолчанию для других параметров, а затем выберите **Далее:** внешние.

### <a name="frontends-tab"></a>Вкладка "Интерфейсные серверы"

1. На вкладке **Интерфейсные серверы** убедитесь, что для параметра **Тип IP-адреса интерфейсных серверов** установлено значение **Общедоступный**. <br>Вы можете настроить общедоступный интерфейсный или частный IP-адрес, согласно вашему варианту использования. В этом примере мы будем использовать общедоступный интерфейсный IP-адрес.
   > [!NOTE]
   > Для этого номера SKU Шлюза приложений версии 2 нужно предоставить только **общедоступную** интерфейсную IP-конфигурацию. Вы по-прежнему можете использовать общедоступную и частную IP-конфигурацию, но частная IP-конфигурация (только в режиме ILB) сейчас отключена для SKU версии 2. 

2. Выберите команду **Создать** для **Общедоступного IP-адреса** и введите *myAGPublicIPAddress* в качестве имени общедоступного IP-адреса, а затем щелкните **ОК**. 

     ![Создание шлюза приложений: интерфейсные серверы](./media/application-gateway-create-gateway-portal/application-gateway-create-frontends.png)

3. Нажмите кнопку **Далее: незавершенные**.

### <a name="backends-tab"></a>Вкладка "Серверные компоненты"

Серверный пул используется для перенаправления запросов на внутренние серверы, на которых обслуживается запрос. Внутренние пулы могут состоять из сетевых адаптеров, масштабируемых наборов виртуальных машин, общедоступных IP-адресов, внутренних IP-адресов, полных доменных имен и таких мультитенантых серверных частей, как служба приложений Azure. В этом примере вы создадите пустой серверный пул со своим шлюзом приложений, а затем добавите в этот серверный пул целевые объекты.

1. На вкладке **Серверные компоненты** выберите **Добавить внутренний пул**.

2. В открывшемся окне **Добавить внутренний пул** введите следующие значения для создания пустого внутреннего пула.

    - **Имя**: введите *myBackendPool* в качестве имени внутреннего пула.
    - **Добавить внутренний пул без конечных объектов**: выберите **Да** , чтобы создать серверный пул без целевых объектов. После создания шлюза приложения вы добавите серверные целевые объекты.

3. В окне **Добавление внутреннего пула** выберите **Добавить**, чтобы сохранить конфигурацию внутреннего пула и вернуться на вкладку **Серверные компоненты**.

     ![Создание шлюза приложений: серверные компоненты](./media/application-gateway-create-gateway-portal/application-gateway-create-backends.png)

4. На вкладке " **незавершенные** работы" выберите **Далее: Конфигурация**.

### <a name="configuration-tab"></a>Вкладка "Конфигурация"

На вкладке **Конфигурация** созданный интерфейсный и внутренний пул подключается с помощью правила маршрутизации.

1. Выберите **Добавить правило** в столбце **Правила маршрутизации**.

2. В открывшемся окне **Добавление правила маршрутизации** введите *myRoutingRule* в поле **Имя правила**.

3. Для правила маршрутизации требуется прослушиватель. На вкладке **Прослушиватель** в окне **Добавление правила маршрутизации** введите следующие значения для прослушивателя.

    - **Имя прослушивателя**: введите *myListener* в качестве имени прослушивателя.
    - **Интерфейсный IP-адрес**: выберите **общедоступный, чтобы выбрать** общедоступный IP-адрес, созданный для внешнего интерфейса.
  
      Примите значения по умолчанию для других параметров на вкладке **Прослушиватель**, а затем выберите вкладку **Серверные целевые объекты**, чтобы настроить остальную часть правила маршрутизации.

   ![Создание шлюза приложений: прослушиватель](./media/application-gateway-create-gateway-portal/application-gateway-create-rule-listener.png)

4. На вкладке **Серверные целевые объекты** выберите значение **myBackendPool** для параметра **Серверный целевой объект**.

5. Для **Параметр HTTP** выберите **Создать**, чтобы создать новый параметр HTTP. Параметр HTTP будет определять поведение правила маршрутизации. В открывшемся окне **Добавление параметра HTTP** введите *михттпсеттинг* для **имени параметра HTTP** и *80* для **внутреннего порта**. Примите значения по умолчанию для других параметров в окне **Добавление параметра HTTP**, затем выберите **Добавить**, чтобы вернуться к окну **Добавление правила маршрутизации**. 

     ![Создание нового шлюза приложений: параметр HTTP](./media/application-gateway-create-gateway-portal/application-gateway-create-httpsetting.png)

6. В окне **Добавление правила маршрутизации** выберите **Добавить**, чтобы сохранить правило маршрутизации и вернуться на вкладку **Конфигурация**.

     ![Создание шлюза приложений: правило маршрутизации](./media/application-gateway-create-gateway-portal/application-gateway-create-rule-backends.png)

7. Выберите **Далее: Теги** , а затем нажмите кнопку **Далее: Проверка и создание**.

### <a name="review--create-tab"></a>Вкладка "Просмотр и создание"

Просмотрите параметры на вкладке **Просмотр и создание**, а затем выберите **Создать**, чтобы создать виртуальную сеть, общедоступный IP-адрес и шлюз приложения. Создание шлюза приложений в Azure может занять несколько минут. Дождитесь успешного завершения развертывания перед переходом к следующему разделу.

## <a name="add-backend-targets"></a>Добавление серверных целевых объектов

В этом примере мы будем использовать виртуальные машины в качестве целевых объектов серверной части. Вы можете использовать существующие виртуальные машины или создать новые. Вы создадите две виртуальные машины в качестве внутренних серверов для шлюза приложений.

Для этого сделайте следующее:

1. Создайте две виртуальные машины (*myVM* и *myVM2*), которые будут использоваться в качестве внутренних серверов.
2. Установить службы IIS на виртуальных машинах, чтобы убедиться, что шлюз приложений успешно создан.
3. Добавить внутренние серверы к внутренним пулам.

### <a name="create-a-virtual-machine"></a>Создание виртуальной машины

1. На **домашней странице** или в меню портала Azure выберите **Создать ресурс**. Появится окно **Создать**.
2. Выберите **Windows Server 2016 Datacenter** в списке **Популярные**. Появится страница **Создание виртуальной машины**.<br>Шлюз приложений может осуществлять маршрутизацию трафика для любого типа виртуальной машины, используемой в этом внутреннем пуле. В этом примере используется Windows Server 2016 Datacenter.
3. На вкладке **Основы** введите для следующих параметров виртуальной машины такие значения:

    - **Группа ресурсов**. Выберите **myResourceGroupAG** для имени группы ресурсов.
    - **Имя виртуальной машины**. Введите *myVM* в качестве имени виртуальной машины.
    - **Регион**. Выберите тот же регион, в котором был создан шлюз приложений.
    - **Username**: введите *azureuser* в качестве имени пользователя администратора.
    - **Пароль**. Введите пароль.
4. Примите другие значения по умолчанию и нажмите кнопку **Далее: диски**.  
5. Примите параметры по умолчанию на вкладке **диски** и выберите **Далее: сеть**.
6. На вкладке **Сети** убедитесь, что для параметра **Виртуальная сеть** выбрано значение **myVNet**, а для параметра **Подсеть** — значение **myBackendSubnet**. Примите другие значения по умолчанию и нажмите кнопку **Далее: Управление**.<br>Шлюз приложений может взаимодействовать с экземплярами за пределами виртуальной сети, к которой он относится, при наличии подключения по IP-адресу.
7. На вкладке **Управление** для параметра **Диагностика загрузки** задайте значение **Выкл**. Примите другие значения по умолчанию и выберите **Review + create** (Просмотр и создание).
8. На вкладке **Review + create** (Просмотр и создание) проверьте параметры, устраните ошибки проверки, а затем выберите **Создать**.
9. Прежде чем продолжить, дождитесь завершения создания виртуальной машины.

### <a name="install-iis-for-testing"></a>Установка служб IIS для тестирования

В этом примере службы IIS устанавливаются на виртуальные машины, чтобы проверить, создан ли шлюз приложений в Azure.

1. Откройте Azure PowerShell. Выберите **Cloud Shell** на верхней панели навигации портал Azure а затем в раскрывающемся списке выберите **PowerShell** . 

    ![Установка пользовательского расширения](./media/application-gateway-create-gateway-portal/application-gateway-extension.png)

2. Выполните следующую команду, чтобы установить службы IIS на виртуальной машине. При необходимости измените параметр *Location* : 

    ```azurepowershell-interactive
    Set-AzVMExtension `
      -ResourceGroupName myResourceGroupAG `
      -ExtensionName IIS `
      -VMName myVM `
      -Publisher Microsoft.Compute `
      -ExtensionType CustomScriptExtension `
      -TypeHandlerVersion 1.4 `
      -SettingString '{"commandToExecute":"powershell Add-WindowsFeature Web-Server; powershell Add-Content -Path \"C:\\inetpub\\wwwroot\\Default.htm\" -Value $($env:computername)"}' `
      -Location EastUS
    ```

3. Создайте вторую виртуальную машину и установите IIS, следуя только что выполненным инструкциям. Используйте *myVM2* в качестве имени виртуальной машины и параметр **VMName** для командлета **Set-AzVMExtension**.

### <a name="add-backend-servers-to-backend-pool"></a>Добавление серверов во внутренние пулы

1. В меню портала Azure выберите **Все ресурсы** или выполните поиск и выберите *Все ресурсы*. Затем выберите **myAppGateway**.

2. Выберите **Серверные пулы** в меню слева.

3. Выберите **myBackendPool**.

4. В разделе **серверные целевые объекты**, **тип целевого объекта**выберите **Виртуальная машина** из раскрывающегося списка.

5. В разделе **Цель**выберите виртуальные машины **myVM** и **myVM2** и связанные с ними сетевые интерфейсы из раскрывающихся списков.


   > [!div class="mx-imgBorder"]
   > ![добавить внутренние серверы](./media/application-gateway-create-gateway-portal/application-gateway-backend.png)

6. Щелкните **Сохранить**.

7. Прежде чем переходить к следующему шагу, дождитесь завершения развертывания.

## <a name="test-the-application-gateway"></a>Тестирование шлюза приложений

Хотя IIS не требуется для создания шлюза приложений, вы установили его в этом кратком руководстве, чтобы проверить, успешно ли Azure создал шлюз приложений. Используйте IIS для тестирования шлюза приложений.

1. На странице **Обзор** найдите общедоступный IP-адрес для шлюза приложений. ![Запишите общедоступный IP-адрес шлюза приложений](./media/application-gateway-create-gateway-portal/application-gateway-record-ag-address.png). В качестве альтернативы вы можете выбрать **Все ресурсы** и ввести в поисковое поле *myAGPublicIPAddress*, а затем выбрать этот адрес из результатов поиска. Общедоступный IP-адрес отобразится в Azure на странице **Обзор**.
2. Скопируйте общедоступный IP-адрес и вставьте его в адресную строку браузера, чтобы просмотреть этот IP-адрес.
3. Проверьте ответ. Допустимый ответ подтверждает, что шлюз приложений создан и может успешно подключиться к серверу.

   ![Тестирование шлюза приложений](./media/application-gateway-create-gateway-portal/application-gateway-iistest.png)

   Обновите браузер несколько раз, и вы увидите подключения к myVM и myVM2.

## <a name="clean-up-resources"></a>Очистка ресурсов

Если ресурсы, созданные с помощью шлюза приложений, больше не нужны, удалите группу ресурсов. При удалении группы ресурсов также удаляется шлюз приложений и все связанные с ним ресурсы.

Чтобы удалить группу ресурсов, сделайте следующее:

1. В меню портала Azure выберите **Группы ресурсов** или выполните поиск по запросу *Группы ресурсов* и выберите этот пункт.
2. На странице **Группы ресурсов** выполните поиск группы **myResourceGroupAG** в списке и выберите ее.
3. На странице **группы ресурсов** выберите **Удалить группу ресурсов**.
4. Введите *myResourceGroupAG* в поле **Введите имя группы ресурсов**, а затем выберите **Удалить**.

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Руководство по управлению веб-трафиком с помощью шлюза приложений и Azure CLI](./tutorial-manage-web-traffic-cli.md)
