---
title: Переписать заголовки запросов и ответов HTTP на портале - Azure Application Gateway
description: Узнайте, как использовать портал Azure для настройки шлюза приложения Azure для переписывания заголовков HTTP в запросах и ответах, проходящих через шлюз
services: application-gateway
author: abshamsft
ms.service: application-gateway
ms.topic: article
ms.date: 11/13/2019
ms.author: absha
ms.custom: mvc
ms.openlocfilehash: b90736b3ed1c1f69488fde4a386cf215d751c362
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "74012857"
---
# <a name="rewrite-http-request-and-response-headers-with-azure-application-gateway---azure-portal"></a>Переписать заголовки запросов и ответов HTTP с помощью шлюза приложения Azure - портал Azure

В этой статье описывается, как использовать портал Azure для настройки экземпляра [Application Gateway v2 SKU](<https://docs.microsoft.com/azure/application-gateway/application-gateway-autoscaling-zone-redundant>) для переписывания заголовков HTTP в запросах и ответах.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="before-you-begin"></a>Перед началом

Для выполнения шагов в этой статье необходимо иметь экземпляр Application Gateway v2 SKU. Переписывание заголовков не поддерживается в v1 SKU. Если у вас нет v2 SKU, создайте экземпляр [Application Gateway v2 SKU](https://docs.microsoft.com/azure/application-gateway/tutorial-autoscale-ps) перед началом.

## <a name="create-required-objects"></a>Создание требуемых объектов

Чтобы настроить перезапись заголовка HTTP, необходимо выполнить эти шаги.

1. Создайте объекты, необходимые для перезаписи заголовка HTTP:

   - **Перепишите действие**: Используется для указания полей заголовка запроса и запроса, которые вы собираетесь переписать, и нового значения для заголовков. Одно или несколько условий перезаписи можно связать с действием перезаписи.

   - **Перепишите условие**: Дополнительная конфигурация. Переписать условия оценки содержания запросов и ответов HTTP (S). Действие перезаписи будет происходить, если запрос или ответ HTTP(S соответствует состоянию перезаписи.

     Если вы связываете более одного состояния с действием, действие происходит только тогда, когда все условия выполнены. Другими словами, операция является логичной и операцией.

   - **Перепишите правило**: Содержит несколько действий переписать / переписать комбинации условий.

   - **Последовательность правил**: Помогает определить порядок выполнения правил переписывания. Эта конфигурация полезна, когда у вас есть несколько правил перезаписи в наборе перезаписи. Правило перезаписи с более низким значением последовательности правил выполняется первым. Присваивайте одно и то же значение последовательности правил двум правилам переписывания, порядок выполнения не является детерминированным.

   - **Перепишите набор:** Содержит несколько правил переписывания, которые будут связаны с правилом разгрома запроса.

2. Прикрепите набор перезаписи к правилу разгрома. Конфигурация перезаписи прикрепляется к исходному слушателю через правило разгрома. При использовании базового правила заголовка конфигурация перезаписи заголовка связана с слушателем исходного кода и является глобальным перезаписьм заголовка. При использовании правила маршрутирования на основе путей конфигурация перезаписи заголовка определяется на карте траектории URL. В этом случае это относится только к конкретной области пути сайта.

Вы можете создать несколько наборов заголовок HTTP и применить каждый набор перезаписи к нескольким слушателям. Но вы можете применить только один набор переписать к конкретному слушателю.

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на [портал Azure](https://portal.azure.com/) с помощью своей учетной записи Azure.

## <a name="configure-header-rewrite"></a>Переписать заголовок

В этом примере мы изменим URL-адрес перенаправления, переписав заголовок местоположения в ответе HTTP, отправленном приложением бэк-энда.

1. Выберите **все ресурсы,** а затем выберите шлюз приложения.

2. Выберите **перезаписи** в левом стеле.

3. Выберите **набор перезаписи:**

   ![Добавить перезапись набора](media/rewrite-http-headers-portal/add-rewrite-set.png)

4. Укажите имя набора перезаписей и свяжете его с правилом разгрома:

   - Введите имя для перезаписи, установленной в поле **Name.**
   - Выберите один или несколько правил, перечисленных в списке **правил ассоциированной кону.** Можно выбрать только правила, которые не были связаны с другими наборами перезаписи. Правила, которые уже были связаны с другими наборами перезаписи, затемнены.
   - Нажмите кнопку **Далее**.
   
     ![Добавление имени и ассоциации](media/rewrite-http-headers-portal/name-and-association.png)

5. Создайте правило перезаписи:

   - Выберите **правило переписать добавление.**

     ![Добавить правило перезаписи](media/rewrite-http-headers-portal/add-rewrite-rule.png)

   - Введите имя для правила перезаписи в поле **имени правила Перезаписи.** Введите номер в поле **последовательности правил.**

     ![Добавить переписать имя правила](media/rewrite-http-headers-portal/rule-name.png)

6. В этом примере мы переписываем заголовок местоположения только тогда, когда он содержит ссылку на azurewebsites.net. Для этого добавьте условие, чтобы оценить, содержит ли заголовок местоположения в ответе azurewebsites.net:

   - Выберите **Условие Добавить,** а затем выберите поле, содержащее инструкции **If,** чтобы расширить его.

     ![Добавить условие](media/rewrite-http-headers-portal/add-condition.png)

   - В **типе переменной для проверки** списка выберите **заголовок HTTP.**

   - В списке **типов заголовков** выберите **ответ.**

   - Поскольку в этом примере мы оцениваем заголовок местоположения, который является общим заголовком, выберите **общий заголовок** под **именем заголовка.**

   - В списке **общих заголовков** выберите **Местоположение**.

   - В соответствии с **кейс-чувствительным,** выберите **Нет**.

   - В списке **Оператора** выберите **равный (я)**.

   - Введите шаблон регулярного выражения. В этом примере мы будем `(https?):\/\/.*azurewebsites\.net(.*)$`использовать шаблон .

   - Нажмите кнопку **ОК**.

     ![Настройка условия if](media/rewrite-http-headers-portal/condition.png)

7. Добавьте действие, чтобы переписать заголовок местоположения:

   - В списке **типов действий** выберите **Set**.

   - В списке **типов заголовков** выберите **ответ.**

   - Под **именем заголовка**выберите **Общий заголовок.**

   - В списке **общих заголовков** выберите **Местоположение**.

   - Введите значение заголовка. В этом примере мы `{http_resp_Location_1}://contoso.com{http_resp_Location_2}` будем использовать значение заголовка. Это значение заменит *azurewebsites.net* *contoso.com* в заголовке местоположения.

   - Нажмите кнопку **ОК**.

     ![Добавление действия](media/rewrite-http-headers-portal/action.png)

8. Выберите **Создать** для создания набора перезаписи:

   ![Нажмите кнопку "Создать"](media/rewrite-http-headers-portal/create.png)

9. Откроется представление набора Перезаписи. Убедитесь, что созданный набор перезаписи находится в списке наборов перезаписи:

   ![Перезапись представления набора](media/rewrite-http-headers-portal/rewrite-set-list.png)

## <a name="next-steps"></a>Дальнейшие действия

Чтобы узнать больше о том, как настроить некоторые общие случаи использования, [см.](https://docs.microsoft.com/azure/application-gateway/rewrite-http-headers)