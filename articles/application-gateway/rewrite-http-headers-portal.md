---
title: Перепишите заголовки запросов и ответов HTTP со шлюзом приложений Azure — портал Azure | Документация Майкрософт
description: Узнайте, как использовать портал Azure для настройки шлюза приложений Azure переписывать заголовки HTTP в запросах и ответах, проходящие через шлюз
services: application-gateway
author: abshamsft
ms.service: application-gateway
ms.topic: article
ms.date: 04/10/2019
ms.author: absha
ms.custom: mvc
ms.openlocfilehash: 6afc07f98905469b06622e7829ec4a215b94845e
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60716258"
---
# <a name="rewrite-http-request-and-response-headers-with-azure-application-gateway---azure-portal"></a>Перепишите заголовки запросов и ответов HTTP со шлюзом приложений Azure — портал Azure

В этой статье показано, как с помощью портала Azure настроить [SKU шлюза приложений версии 2](<https://docs.microsoft.com/azure/application-gateway/application-gateway-autoscaling-zone-redundant>) переписывать заголовки HTTP в запросах и ответах.

> [!IMPORTANT]
> SKU автоматического масштабирования и шлюза приложений, избыточного между зонами, на данный момент доступен в общедоступной предварительной версии. Предварительная версия предоставляется без соглашения об уровне обслуживания. Не рекомендуем использовать ее в рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены. См. [дополнительные условия использования для предварительных версий Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="before-you-begin"></a>Перед началом работы

Необходимо иметь шлюз приложений версии 2, SKU, так как возможность перезаписи заголовок не поддерживается для v1 SKU. Если у вас нет v2 SKU, создать [SKU шлюза приложений версии 2](https://docs.microsoft.com/azure/application-gateway/tutorial-autoscale-ps) перед началом работы.

## <a name="what-is-required-to-rewrite-a-header"></a>Что такое требуется переписать заголовок

Чтобы настроить перезапись заголовка HTTP, необходимо будет:

1. Создать новые объекты, необходимые для переработки заголовков HTTP:

   - **Перепишите действие**: используется для указания запроса и полей заголовка запроса, которые вы собираетесь переписать и новое значение, необходимо переписать, чтобы исходные заголовки. Вы можете связать один или дополнительные условия перезаписи с помощью действия переопределения.

   - **Перепишите условие**: Он является необязательной конфигурацией. Если добавляется условие перезаписи, выполняется оценка содержимого HTTP (S) запросов и ответов. Решение для выполнения определенного действия переопределения, связанный с условием перезаписи будет основываться ли HTTP (S) запроса или ответа соответствует условию перезаписи. 

     Если более одного условия связаны с действие, а затем действие выполняется только в том случае, если все условия выполняются, т. е., будет выполняться логическую операцию и.

   - **Правила переопределения**: правила переопределения содержит несколько действие переопределения — переписать сочетания условий.

   - **Правила последовательности**: помогает определить порядок, в котором разные правила переопределения сработать. Это полезно при наличии нескольких правила подстановки в наборе перезаписи. Сначала выполняется с меньшим значением последовательности правило правила перезаписи. Если указать той же последовательности правила, чтобы два правила подстановки порядок выполнения будет недетерминированным.

   - **Перепишите набора**: содержит несколько переопределения правила, которые будут связаны с правило маршрутизации запроса.

2. Вам потребуется присоединить перезаписи набор с помощью правила маршрутизации. Это обусловлено конфигурации перезаписи присоединяется к исходному прослушивателю посредством правила маршрутизации. При использовании базового правила маршрутизации конфигурация перезаписи связывается с прослушивателем источника и выполняется перезапись глобального заголовка. При использовании правила маршрутизации на основе пути конфигурация перезаписи заголовка определяется в сопоставлении URL-пути. Поэтому она применяется только к области конкретного пути на сайте.

Можно создать несколько наборов переопределения заголовка http, и каждый набор переопределения может применяться к несколько прослушивателей. Тем не менее можно применить только один переписать набора для конкретного прослушивателя.

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на [портал Azure](https://portal.azure.com/) с помощью своей учетной записи Azure.

## <a name="configure-header-rewrite"></a>Настройка переопределения заголовка

В этом примере мы будем изменять URL-адрес перенаправления, переписав под заголовком location в HTTP-ответа, отправленные в серверное приложение. 

1. Выберите **все ресурсы**, а затем выберите шлюз приложений.

2. Выберите **перезаписывает** в меню слева.

3. Щелкните **+ переписать набора**. 

   ![Добавление новой версии набора](media/rewrite-http-headers-portal/add-rewrite-set.png)

4. Укажите имя для переопределения набора и связать его с правило маршрутизации:

   - Введите имя в перезаписи **имя** текстового поля.
   - Выберите одно или несколько правил, перечисленные в **связанные правила маршрутизации** списка. Можно выбрать только те правила, которые не были связаны с другими наборами перезаписи. Правила, которые уже были связаны с другими наборами перезаписи будут закрашены серым.
   - Нажмите кнопку «Далее».
   
     ![Добавьте имя и связь](media/rewrite-http-headers-portal/name-and-association.png)

5. Создайте правила переопределения:

   - Щелкните **+ добавить правило переопределения**.![ Добавление правила переопределения](media/rewrite-http-headers-portal/add-rewrite-rule.png)
   - Введите имя для правила перезаписи в текстовом поле имя правила переопределения и укажите правила последовательности.![Добавьте имя правила](media/rewrite-http-headers-portal/rule-name.png)

6. В этом примере мы перепишет заголовок location только в том случае, если он содержит ссылку на «azurewebsites.net». Чтобы сделать это, добавьте условие для оценки под заголовком location в ответе содержит azurewebsites.net ли:

   - Щелкните **+ добавить условие** и нажмите кнопку в разделе с **Если** инструкции, чтобы развернуть его.![ Добавьте имя правила](media/rewrite-http-headers-portal/add-condition.png)

   - Выберите **заголовок HTTP** из **тип переменной, чтобы проверить** раскрывающегося списка. 

   - Выберите **тип заголовка** как **ответа**.

   - Так как в этом примере мы при оценке заголовок location, который является общих заголовков, выберите **общая область** "переключатель" как **имя заголовка**.

   - Выберите **расположение** из **общая область** раскрывающегося списка.

   - Выберите **нет** как **с учетом регистра** параметр.

   - Выберите **равно (=)** из **оператор** раскрывающегося списка.

   - Введите шаблон регулярного выражения. В этом примере мы будем использовать шаблон `(https?):\/\/.*azurewebsites\.net(.*)$` .

   - Последовательно выберите **ОК**.

     ![Изменить заголовок location](media/rewrite-http-headers-portal/condition.png)

7. Добавьте действие, которое перезаписывает заголовок расположения:

   - Выберите **задать** как **тип действия**.

   - Выберите **ответа** как **тип заголовка**.

   - Выберите **общая область** как **имя заголовка**.

   - Выберите **расположение** из **общая область** раскрывающегося списка.

   - Введите значение заголовка. В этом примере мы будем использовать `{http_resp_Location_1}://contoso.com{http_resp_Location_2}` как значение заголовка. Это приведет к замене *azurewebsites.net* с *contoso.com* в заголовке location.

   - Последовательно выберите **ОК**.

     ![Изменить заголовок location](media/rewrite-http-headers-portal/action.png)

8. Щелкните **создать** Создание перезаписи набора.

   ![Изменить заголовок location](media/rewrite-http-headers-portal/create.png)

9. Будет выполнен переход к представлению набора перезаписи. Убедитесь, что набор перезаписи, созданную ранее в списке наборов перезаписи.

   ![Изменить заголовок location](media/rewrite-http-headers-portal/rewrite-set-list.png)

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о настройке, необходимых для выполнения самых распространенных вариантов использования, см. в разделе [общая область переписывать сценарии](https://docs.microsoft.com/azure/application-gateway/rewrite-http-headers).

   
