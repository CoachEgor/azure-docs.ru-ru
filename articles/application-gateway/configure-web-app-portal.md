---
title: Управление трафиком для мультитенантных приложений, таких как веб-приложения службы с помощью шлюза приложений Azure — портал
description: Статья содержит рекомендации о том, как настроить веб-приложениях службы приложений Azure в качестве членов во внутреннем пуле на существующем или новом шлюзе приложений.
services: application-gateway
author: abshamsft
ms.service: application-gateway
ms.topic: article
ms.date: 3/11/2019
ms.author: absha
ms.openlocfilehash: 4dae04c14f9132c54dcc0575ccb2841a4742a626
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60831219"
---
# <a name="configure-app-service-with-application-gateway"></a>Настройка службы приложений с помощью шлюза приложений

Шлюз приложений позволяет иметь веб-приложения Azure App service или других служб с несколькими клиентами как элемент внутреннего пула. 

В этой статье раскрываются следующие темы:

> [!div class="checklist"]
>
> - Создание серверного пула и его добавления в службу приложений
> - Создать параметры HTTP и настраиваемый зонд с параметрами «Выбрать Hostname» включен

## <a name="prerequisites"></a>Технические условия

- Шлюз приложений. Если у вас нет шлюза приложений, см. в разделе Практическое [Создание шлюза приложений](https://docs.microsoft.com/azure/application-gateway/quick-create-portal)
- Служба приложений: Если у вас нет существующей службы приложений, см. в разделе [документации по службе приложений](https://docs.microsoft.com/azure/app-service/).

## <a name="add-app-service-as-backend-pool"></a>Добавить службы приложений в качестве серверного пула

1. На портале Azure откройте представление конфигурации шлюза приложений.

2. В разделе **серверные пулы**, щелкните **добавить** для создания нового внутреннего пула.

3. Укажите подходящее имя во внутренний пул. 

4. В разделе **целевых объектов**, щелкните раскрывающийся список и выберите пункт **службы приложений** как параметр.

5. Раскрывающийся список под **целевых объектов** появится раскрывающийся список, который будет содержать список ваши службы приложений. Этот раскрывающийся список выберите службы приложений, необходимо добавить в качестве участника пула серверной части и нажмите кнопку Добавить.

   ![Серверная часть приложения службы](./media/configure-web-app-portal/backendpool.png)

## <a name="create-http-settings-for-app-service"></a>Создать параметры HTTP для службы приложений

1. В разделе **параметры HTTP**, нажмите кнопку **добавить** для создания нового параметра HTTP.

2. Введите имя для параметра HTTP, и вы можете включить или отключить сходство на основе файлов Cookie согласно вашим требованиям.

3. Выберите протокол HTTP или HTTPS в соответствии с требуемым. 

4. Установите флажок для **использования для службы приложений** и он приведет к включению **Создание пробы с именем узла подбора из адресов серверной части** и **подбора имя узла из адресов серверной части** параметры. Этот параметр также будет автоматически создать пробу с параметром включена и свяжите ее с этой настройкой HTTP.

5. Нажмите кнопку **ОК** для создания параметра HTTP.

   ![HTTP-setting1](./media/configure-web-app-portal/http-setting1.png)

   ![HTTP-setting2](./media/configure-web-app-portal/http-setting2.png)

## <a name="create-rule-to-tie-the-listener-backend-pool-and-http-setting"></a>Создайте правило для привязки прослушивателя, серверного пула и параметр HTTP

1. В разделе **правила**, нажмите кнопку **основные** для создания нового базовое правило.

2. Укажите подходящее имя и выберите прослушиватель, который принимает входящие запросы для службы приложений.

3. В **внутренний пул** раскрывающемся списке выберите пул серверной части, созданную ранее.

4. В **параметр HTTP** раскрывающемся списке выберите параметр, мы создали выше HTTP.

5. Нажмите кнопку **ОК** сохранить это правило.

   ![Правило](./media/configure-web-app-portal/rule.png)

## <a name="restrict-access"></a>Ограничение доступа

Веб-приложения, развернутые в этих примерах, используют общедоступные IP-адреса, доступ к которым можно получить напрямую из Интернета. Это помогает устранить неполадки, когда вы знакомитесь с новыми функциями и пробуете новинки. Однако, если вы хотите развернуть функцию в производственной среде, необходимо добавить дополнительные ограничения.

Один из способов ограничения доступа к веб-приложению — использовать [ограничения статических IP-адресов в Службе приложений Azure](../app-service/app-service-ip-restrictions.md). Например, можно ограничить веб-приложение, чтобы получать трафик только из шлюза приложения. Используйте функцию ограничения IP-адреса для службы приложения, чтобы сделать виртуальный IP-адрес шлюза приложения единственным адресом с доступом.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о службе приложений и других поддержка нескольких клиентов с помощью шлюза приложений, см. в разделе [мультитенантная служба поддержки со шлюзом приложений](https://docs.microsoft.com/azure/application-gateway/application-gateway-web-app-overview).

В случае, если ответ от службы приложений выполняет перенаправление на URL-адрес службы приложений, см. в разделе Практическое [Устранение перенаправление к проблеме URL-адрес службы приложений](https://docs.microsoft.com/azure/application-gateway/troubleshoot-app-service-redirection-app-service-url).
