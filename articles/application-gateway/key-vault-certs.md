---
title: Завершение SSL с сертификатами Azure Key Vault
description: Узнайте, как интегрировать шлюз приложений Azure с Key Vault для сертификатов сервера, подключенных к прослушивателям с поддержкой HTTPS.
services: application-gateway
author: vhorne
ms.service: application-gateway
ms.topic: article
ms.date: 4/25/2019
ms.author: victorh
ms.openlocfilehash: 725a9d67e6a6412fc48a4278b5a8a163272e5133
ms.sourcegitcommit: e97a0b4ffcb529691942fc75e7de919bc02b06ff
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/15/2019
ms.locfileid: "71000984"
---
# <a name="ssl-termination-with-key-vault-certificates"></a>Завершение SSL с сертификатами Key Vault

[Azure Key Vault](../key-vault/key-vault-overview.md) — это хранилище секретов, управляемое платформой, которое можно использовать для защиты секретов, ключей и SSL-сертификатов. Шлюз приложений Azure поддерживает интеграцию с Key Vault (в общедоступной предварительной версии) для сертификатов сервера, подключенных к прослушивателям с поддержкой HTTPS. Эта поддержка ограничена номером SKU шлюза приложений версии 2.

> [!IMPORTANT]
> Интеграция шлюза приложений с Key Vault в настоящее время доступна в общедоступной предварительной версии. Эта предварительная версия предоставляется без соглашения об уровне обслуживания (SLA) и не рекомендуется для рабочих нагрузок. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

Эта общедоступная Предварительная версия предлагает две модели для завершения SSL-запросов:

- Можно явно предоставить SSL-сертификаты, подключенные к прослушивателю. Эта модель является традиционным способом передачи SSL-сертификатов в шлюз приложений для завершения SSL-запросов.
- При создании прослушивателя с поддержкой HTTPS можно дополнительно указать ссылку на существующий Key Vault сертификат или секрет.

Интеграция шлюза приложений с Key Vault предлагает множество преимуществ, в том числе:

- Более надежная защита, так как SSL-сертификаты не обрабатываются группой разработчиков приложений напрямую. Интеграция позволяет отдельной группе безопасности:
  * Настройте шлюзы приложений.
  * Управление жизненным циклом шлюза приложений.
  * Предоставьте выбранным шлюзам приложений разрешения на доступ к сертификатам, хранящимся в хранилище ключей.
- Поддержка импорта существующих сертификатов в хранилище ключей. Или используйте Key Vault API для создания новых сертификатов и управления ими с любыми доверенными партнерами Key Vault.
- Поддержка автоматического продления сертификатов, хранящихся в хранилище ключей.

Сейчас шлюз приложений поддерживает только сертификаты, проверенные программным обеспечением. Аппаратный модуль безопасности (HSM) — проверенные сертификаты не поддерживаются. После того как шлюз приложений настроен для использования сертификатов Key Vault, его экземпляры получают сертификат из Key Vault и устанавливают их локально для завершения SSL. Кроме того, экземпляры опрашиваются Key Vault с интервалом в 24 часа, чтобы получить обновленную версию сертификата, если он существует. Если найден обновленный сертификат, SSL-сертификат, который сейчас связан с прослушивателем HTTPS, автоматически поворачивается.

## <a name="how-integration-works"></a>Принцип работы интеграции

Для интеграции шлюза приложений с Key Vault требуется процесс настройки, сопоставленный с тремя шагами:

1. **Создание управляемого удостоверения, назначенного пользователем**

   Вы создаете или повторно используете существующее назначенное пользователем управляемое удостоверение, которое шлюз приложений использует для получения сертификатов от Key Vault от вашего имени. Дополнительные сведения см. в статье [Что такое управляемые удостоверения для ресурсов Azure](../active-directory/managed-identities-azure-resources/overview.md). На этом шаге создается новое удостоверение в клиенте Azure Active Directory. Удостоверение является доверенным для подписки, которая используется для создания удостоверения.

1. **Настройка хранилища ключей**

   Затем импортируйте существующий сертификат или создайте новый в хранилище ключей. Сертификат будет использоваться приложениями, которые выполняются через шлюз приложений. На этом шаге можно также использовать секрет хранилища ключей, который хранится в виде PFX-файла, не имеющего пароля, с базовым размером 64. Рекомендуется использовать тип сертификата из-за возможности автопродления, доступной для объектов типа сертификата в хранилище ключей. После создания сертификата или секрета вы определяете политики доступа в хранилище ключей, *чтобы предоставить удостоверению доступ к* секрету.

1. **Настройка шлюза приложений**

   После выполнения двух предыдущих шагов можно настроить или изменить существующий шлюз приложений для использования управляемого удостоверения, назначенного пользователем. Можно также настроить SSL-сертификат прослушивателя HTTP, чтобы он указывал на полный URI Key Vault сертификата или секретного идентификатора.

   ![Сертификаты хранилища ключей](media/key-vault-certs/ag-kv.png)

## <a name="next-steps"></a>Следующие шаги

[Настройка завершения SSL с использованием Key Vault сертификатов с помощью Azure PowerShell](configure-keyvault-ps.md)
