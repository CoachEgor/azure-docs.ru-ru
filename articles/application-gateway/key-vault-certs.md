---
title: Прекращение TLS с сертификатами Azure Key Vault
description: Узнайте, как можно интегрировать шлюз приложений Azure с Key Vault для серверных сертификатов, которые прикрепляются к слушателям с поддержкой HTTPS.
services: application-gateway
author: vhorne
ms.service: application-gateway
ms.topic: article
ms.date: 4/25/2019
ms.author: victorh
ms.openlocfilehash: 934cf854b0c526ed994c7dc91763f65de64fd14b
ms.sourcegitcommit: eefb0f30426a138366a9d405dacdb61330df65e7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2020
ms.locfileid: "81617510"
---
# <a name="tls-termination-with-key-vault-certificates"></a>Прекращение TLS с сертификатами Key Vault

[Azure Key Vault](../key-vault/general/overview.md) — это секретный магазин, управляемый платформой, который можно использовать для защиты секретов, ключей и сертификатов TLS/SSL. Azure Application Gateway поддерживает интеграцию с Key Vault для серверных сертификатов, которые прикрепляются к слушателям с поддержкой HTTPS. Эта поддержка ограничена v2 SKU Прикладного шлюза.

Key Vault интеграции предлагает две модели для прекращения TLS:

- Вы можете явно предоставить сертификаты TLS/SSL, прикрепленные к слушателю. Эта модель является традиционным способом передачи сертификатов TLS/SSL в шлюз приложения для прекращения TLS.
- При создании слушателя с поддержкой HTTPS можно по желанию предоставить ссылку на существующий сертификат Убежища ключей или секрет.

Интеграция Gateway приложений с Key Vault предлагает множество преимуществ, в том числе:

- Более сильная безопасность, поскольку сертификаты TLS/SSL непосредственно не обрабатываются командой разработчиков приложений. Интеграция позволяет отдельной группе безопасности:
  * Настройка шлюзов приложений.
  * Управление жизненным циклом шлюза приложения.
  * Предоставлять разрешения выбранным шлюзам приложений для доступа к сертификатам, которые хранятся в хранилище ключей.
- Поддержка импорта существующих сертификатов в хранилище ключей. Или используйте ключевые AAP Vault для создания и управления новыми сертификатами с любым из доверенных партнеров Key Vault.
- Поддержка автоматического обновления сертификатов, хранящихся в хранилище ключей.

В настоящее время Application Gateway поддерживает только проверенные программное обеспечение сертификаты. Проверенные сертификаты безопасности оборудования (HSM) не поддерживаются. После настройки шлюза приложения для использования сертификатов Key Vault его экземпляры извлекают сертификат из Key Vault и устанавливают его локально для прекращения TLS. Экземпляры также опрашивают Key Vault с интервалом в 24 часа, чтобы получить обновленную версию сертификата, если он существует. При обнаружении обновленного сертификата сертификат TLS/SSL, в настоящее время связанный с слушателем HTTPS, автоматически поворачивается.

> [!NOTE]
> Портал Azure поддерживает только сертификаты KeyVault, а не секреты. Приложение Gateway по-прежнему поддерживает ссылки секреты из KeyVault, но только через не-портал ресурсов, таких как PowerShell, CLI, API, ARM шаблоны и т.д. 

## <a name="how-integration-works"></a>Как работает интеграция

Интеграция шлюза приложений с Key Vault требует трехступенчатого процесса настройки:

1. **Создание управляемого удостоверения, назначаемого пользователем**

   Вы создаете или повторно используете существующую управляемую изнача для пользователя, которую Прикладный шлюз использует для получения сертификатов из Key Vault от вашего имени. Для получения дополнительной информации [см. Что такое управляемые идентификаторы для ресурсов Azure?.](../active-directory/managed-identities-azure-resources/overview.md) Этот шаг создает новую идентификацию в арендаторе Active Directory Azure. Идентификационным данным доверяет подписка, используемая для создания идентификации.

1. **Настройка хранилища ключей**

   Затем вы импортируете существующий сертификат или создаете новый сертификат в хранилище ключей. Сертификат будет использоваться приложениями, которые проходят через шлюз приложения. На этом этапе можно также использовать секрет хранилища ключей, который хранится в виде менее пароля, закодированного файла PFX. Мы рекомендуем использовать тип сертификата из-за возможности автоматического обновления, которая доступна с объектами типа сертификата в хранилище ключей. После создания сертификата или секрета вы определяете политики доступа в хранилище ключей, чтобы удостоверение должно было *быть* предоставлено доступом к секрету.
   
   > [!NOTE]
   > При развертывании шлюза приложения с помощью шаблона ARM, либо с помощью Azure CLI или PowerShell, либо через приложение Azure, развернутое с портала Azure, sSL-сертификат, который хранится в хранилище ключей в качестве базового файла PFX, **должен быть без паролей.** Кроме того, необходимо выполнить этапы [в Хранилище ключей Azure, чтобы пройти безопасное значение параметра во время развертывания.](../azure-resource-manager/templates/key-vault-parameter.md) Это особенно важно, `enabledForTemplateDeployment` чтобы `true`установить на .

1. **Настройка шлюза приложения**

   После завершения двух предыдущих этапов можно настроить или изменить существующий шлюз приложения, чтобы использовать назначенную пользователем управляемую идентификацию. Вы также можете настроить сертификат TLS/SSL слушателя HTTP, чтобы указать на полный URI сертификата Key Vault или секретного идентификатора.

   ![Сертификаты хранилища ключей](media/key-vault-certs/ag-kv.png)

## <a name="next-steps"></a>Дальнейшие действия

[Налажить окончание TLS с помощью key Vault с помощью Сертификатов Ключей PowerShell](configure-keyvault-ps.md)
