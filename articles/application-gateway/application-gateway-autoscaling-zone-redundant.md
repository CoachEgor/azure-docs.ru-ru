---
title: Автоматическое масштабирование и Шлюз приложений, избыточный между зонами, версии 2
description: В этой статье представлены Standard_v2 приложения Azure и WAF_v2 SKU, который включает функции autoscaling и зоны.
services: application-gateway
author: vhorne
ms.service: application-gateway
ms.topic: article
ms.date: 03/24/2020
ms.author: victorh
ms.openlocfilehash: 4cd2969f9a56c96af2b2c6db216f6829a080260c
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "80371281"
---
# <a name="autoscaling-and-zone-redundant-application-gateway-v2"></a>Автоматическое масштабирование и Шлюз приложений, избыточный между зонами, версии 2 

Приложение Шлюз и веб-приложений firewall (WAF) также доступны под Standard_v2 и WAF_v2 SKU. V2 SKU предлагает повышение производительности и добавляет поддержку для критических новых функций, таких как автоматическое масштабирование, избыточность зон и поддержка статических VIP-персон. Существующие функции в соответствии со Стандартом и WAF SKU продолжают поддерживаться в новом v2 SKU, за некоторыми исключениями, перечисленными в разделе [сравнения.](#differences-with-v1-sku)

Новый v2 SKU включает в себя следующие усовершенствования:

- **Автоматическое масштабирование**: шлюз приложений или развертывания WAF в SKU автоматического масштабирования могут изменять масштаб в соответствии с изменениями в объеме трафика. Кроме того, автоматическое масштабирование позволяет не выбирать размер развертывания или количество экземпляров во время подготовки. Этот SKU предлагает истинную эластичность. В Standard_v2 и WAF_v2 SKU, Application Gateway может работать как в фиксированной емкости (автомасштабирование отключено), так и в режиме автоматического масштабирования. Режим фиксированной емкости подходит для сценариев с постоянной, предсказуемой рабочей нагрузкой. Режим автоматического масштабирования полезен в приложениях, которые видят отклонение в трафике приложений.
- **Резервность зон**: Развертывание шлюза приложения или WAF может охватывать несколько зон доступности, устраняя необходимость предоставления отдельных экземпляров шлюза приложений в каждой зоне с помощью менеджера трафика. Можно выбрать одну зону или несколько зон, в которых развертываются экземпляры шлюза приложений, что делает ее более устойчивой к сбою зоны. Внутренний пул приложений можно аналогичным образом распределить по зонам доступности.

  Избыточность зон доступна только там, где доступны зоны Azure. В других регионах все остальные функции поддерживаются. Для получения дополнительной [информации](../availability-zones/az-overview.md#services-support-by-region) см.
- **Static VIP**: Application Gateway v2 SKU поддерживает только статический VIP-тип. Это гарантирует, что VIP,связанный с шлюзом приложения не изменится в течение жизненного цикла развертывания, даже после перезагрузки.  В v1 нет статического VIP-персоны, поэтому необходимо использовать URL-адрес шлюза приложения вместо IP-адреса для разгрома доменных имен в Службы приложений через шлюз приложения.
- **Перезапись заголовка**: Шлюз приложений позволяет добавлять, удалять или обновлять заголовки http и ответов с помощью v2 SKU. Для получения дополнительной информации смотрите [перезаписи заголовков HTTP с помощью шлюза приложений](rewrite-http-headers.md)
- **Key Vault Integration**: Application Gateway v2 поддерживает интеграцию с Key Vault для серверных сертификатов, которые прилагаются к httpS включенным слушателям. Для получения дополнительной [SSL termination with Key Vault certificates](key-vault-certs.md)информации см.
- **Контроллер входа службы Azure Kubernetes:** Контроллер входа в приложение Gateway v2 позволяет использовать шлюз приложения Azure в качестве входа в службу Azure Kubernetes (AKS), известную как AKS Cluster. Для получения дополнительной информации, [см. Что такое приложение шлюз Ingress контроллер?](ingress-controller-overview.md).
- **Повышение производительности**: V2 SKU предлагает до 5X лучше SSL разгрузки производительность по сравнению со стандартом / WAF SKU.
- **Более быстрое время развертывания и обновления** v2 SKU обеспечивает более быстрое развертывание и время обновления по сравнению со стандартным/WAF SKU. Это также включает изменения конфигурации WAF.

![](./media/application-gateway-autoscaling-zone-redundant/application-gateway-autoscaling-zone-redundant.png)

## <a name="supported-regions"></a>Поддерживаемые регионы

Standard_v2 и WAF_v2 SKU доступен в следующих регионах: Северная Центральная часть США, южная центральная часть США, Западная ЧАСТЬ США, Западная ЧАСТЬ США 2, Восточная ЧАСТЬ США, Восточная ЧАСТЬ США, Центральная Часть США, Западная Европа, юго-восточная Азия, Франция Центральная, Великобритания Запад, Япония Восток, Австралия Восток , Австралия юго-восток, Бразилия южная, Канада Центральной, Канада Восток, Восточная Азия, Корея Центральной, Корея южная, Великобритания южная, Центральная Индия, Западная Индия, южная Индия.

## <a name="pricing"></a>Цены

С v2 SKU модель ценообразования определяется потреблением и больше не прикрепляется к отсчету экземпляра или размерам. Цена v2 SKU имеет два компонента:

- **Фиксированная цена** - это почасовая (или частичная) цена для предоставления Standard_v2 или WAF_v2 шлюза. Обратите внимание, что 0 дополнительных минимальных экземпляров по-прежнему обеспечивают высокую доступность услуги, которая всегда включена с фиксированной ценой.
- **Цена блока емкости** - Это стоимость на основе потребления, которая взимается в дополнение к фиксированной стоимости. Плата за единицу емкости также вычисляется почасовой или частично йожевой. Есть три измерения блока емкости - вычислительный блок, постоянные соединения и пропускная способность. Вычислительный блок является мерой потребляемой емкости процессора. Факторами, влияющими на вычислительный блок, являются соединения TLS/sec, вычисления URL-переписок и обработка правил WAF. Постоянное соединение является мерой установленных подключений TCP к шлюзу приложения в данном интервале выставления счетов. Пропускная часть — это средняя мегабитная/сек, обрабатываемые системой в данном интервале выставления счетов.  Выставление счетов осуществляется на уровне единицы емкости для чего-либо выше зарезервированного количества экземпляров.

Каждая единица емкости состоит не более того: 1 вычислительный блок, или 2500 постоянных соединений, или пропускная способность 2,22 Мбит/с.

Руководство вычислительной единицы:

- **Standard_v2** - Каждый вычислительный блок способен приблизительно 50 соединений в секунду с сертификатом RSA 2048-битного ключа TLS.
- **WAF_v2** - Каждая вычислительная единица может поддерживать приблизительно 10 одновременных запросов в секунду для 70-30% сочетания трафика с 70% запросов менее чем на 2 КБ GET/POST и оставаясь выше. В настоящее время на производительность WAF не влияет размер ответа.

> [!NOTE]
> Каждый экземпляр в настоящее время может поддерживать приблизительно 10 единиц емкости.
> Количество запросов, которыми может обрабатывать вычислительная единица, зависит от различных критериев, таких как размер ключа сертификата TLS, алгоритм обмена ключами, перезаписи заголовка и в случае размера входящего запроса WAF. Мы рекомендуем вам выполнить тесты приложений для определения скорости запроса на вычислительную единицу. Как единица емкости, так и вычислительная единица будут доступны в качестве метрики до начала выставления счетов.

В следующей таблице показаны примеры цен и предназначены только для иллюстраций.

**Цены на Востоке США**:

|              Номер SKU                             | Фиксированная цена ($/hr)  | Цена единицы мощности ($/CU-hr)   |
| ------------------------------------------------- | ------------------- | ------------------------------- |
| Standard_v2                                       |    0,20             | 0.0080                          |
| WAF_v2                                            |    0.36             | 0.0144                          |

Для получения дополнительной [информации](https://azure.microsoft.com/pricing/details/application-gateway/)о ценах, см. 

**Пример 1**

Standard_v2 gateway application готовится без автоматического масштабирования в режиме ручного масштабирования с фиксированной емкостью в пять экземпляров.

Фиксированная цена - 744 (часы) - 0,20 доллара США и 148,8 доллара <br>
Вместимость единиц - 744 (часы) - 10 единица емкости на экземпляр, 5 экземпляров - $0,008 за единицу емкости в час - $297,6

Общая цена - $148.8 и $297.6 и $446.4

**Пример 2**

Standard_v2 прикладного шлюза готовится в течение месяца, с нулевым исходящим минимумом экземпляров, и за это время он получает 25 новых SSL-соединений/сек, в среднем 8,88-Мбит/с передачи данных. Предполагая, что соединения недолговечны, ваша цена будет:

Фиксированная цена - 744 (часы) - 0,20 доллара США и 148,8 доллара

Цена единицы емкости - 744 (часы) - Макс (25/50 вычислительный блок для соединений/сек, 8,88/2,22 единицы емкости для пропускной способности)

Общая цена - $148.8-23.81 и $172.61

Как вы можете видеть, вы выставляется только для четырех единиц емкости, а не для всего экземпляра. 

> [!NOTE]
> Функция Max возвращает наибольшее значение в паре значений.


**Пример 3**

Standard_v2 прикладного шлюза предоставляется в течение месяца, как минимум, пять экземпляров. Предполагая, что нет трафика и соединения недолговечны, ваша цена будет:

Фиксированная цена - 744 (часы) - 0,20 доллара США и 148,8 доллара

Цена единицы емкости - 744 (часы) - Макс (0/50 вычислительная единица для соединений/сек, 0/2,22 единица емкости для пропускной способности)

Общая цена - $148.80-297.60 и $446.4

В этом случае вам выставляется счет за все пять экземпляров, даже если нет трафика.

**Пример 4**

Standard_v2 прикладного шлюза готовится в течение месяца, с минимум пятью экземплярами, но на этот раз происходит в среднем 125 Мбит/с передачи данных и 25 SSL-соединений в секунду. Предполагая, что нет трафика и соединения недолговечны, ваша цена будет:

Фиксированная цена - 744 (часы) - 0,20 доллара США и 148,8 доллара

Цена единицы емкости - 744 (часы) - Макс (25/50 вычислительный блок для соединений/сек, 125/2,22 единицы емкости для пропускной способности) - $0,008

Общая цена - $148.80-339.26 и $488.06

В этом случае вам выставляется счет за полные пять экземпляров, а также семь единиц емкости (что составляет 7/10 экземпляра).  

**Пример 5**

Заявка шлюза WAF_v2 предоставляется в течение месяца. За это время он получает 25 новых SSL-соединений/сек, в среднем 8,88-Мбит/с передачи данных и делает 80 запросов в секунду. Предполагая, что соединения недолговечны, и что расчетный удельный расчет приложения поддерживает 10 RPS на вычислительную единицу, ваша цена будет:

Фиксированная цена - 744 (часы) - $0,36 - $267,84

Цена единицы емкости - 744 (часы) - Макс (вычислительная единица Max (25/50 для соединений/сек, 80/10 WAF RPS), 8,88/2,22 единица емкости для пропускной способности)

Общая цена - $267.84 и $85.71 и $353.55

> [!NOTE]
> Функция Max возвращает наибольшее значение в паре значений.

## <a name="scaling-application-gateway-and-waf-v2"></a>Масштабирование шлюза приложений и WAF v2

Портал приложений и WAF можно настроить для масштабирования в двух режимах:

- **Автоматическое масштабирование** - С включенным автомасштабированием, шлюз приложений и WAF v2 SKUs масштабируются вверх или вниз в зависимости от требований к трафику приложений. Этот режим обеспечивает лучшую эластичность приложения и устраняет необходимость угадать размер шлюза приложения или количество экземпляров. Этот режим также позволяет экономить затраты, не требуя, чтобы шлюз запускался на пиковой производительности для ожидаемой максимальной нагрузки трафика. Необходимо указать минимальное и опционно максимальное количество экземпляров. Минимальная емкость гарантирует, что Application Gateway и WAF v2 не опадают ниже указанного минимального количества экземпляров, даже при отсутствии трафика. Каждый экземпляр считается 10 дополнительными зарезервированными единицами емкости. Ноль означает отсутствие зарезервированной емкости и является чисто автомасштабированием в природе. Обратите внимание, что ноль дополнительных минимальных экземпляров по-прежнему обеспечивает высокую доступность услуги, которая всегда включена с фиксированной ценой. Можно также дополнительно указать максимальное количество экземпляров, что гарантирует, что шлюз приложения не будет масштабироваться сверх указанного количества экземпляров. Вы будете продолжать выставлять сячку за объем трафика, обслуживаемого шлюзом. Количество экземпляров может варьироваться от 0 до 125. Значение по умолчанию для максимального количества экземпляров составляет 20, если не указано.
- **Руководство** - Вы можете выбрать режим ручного вхождения, в котором шлюз не будет автоматическимасштабироваться. В этом режиме, если трафик больше, чем то, что приложение шлюз или WAF может обрабатывать, это может привести к потере трафика. В ручном режиме указание количества экземпляров является обязательным. Количество экземпляров может варьироваться от 1 до 125 экземпляров.

## <a name="feature-comparison-between-v1-sku-and-v2-sku"></a>Сравнение функций между v1 SKU и v2 SKU

В следующей таблице сравниваются функции, доступные с каждым SKU.

|                                                   | v1 SKU   | v2 SKU   |
| ------------------------------------------------- | -------- | -------- |
| Автомасштабирование                                       |          | &#x2713; |
| Избыточность в пределах зоны                                   |          | &#x2713; |
| Статический виртуальный IP-адрес                                        |          | &#x2713; |
| Azure Kubernetes Service (AKS) Ingress контроллер |          | &#x2713; |
| Интеграция с хранилищем ключей Azure                       |          | &#x2713; |
| Переписать заголовки HTTP (S)                           |          | &#x2713; |
| Маршрутизация на основе URL-адреса                                 | &#x2713; | &#x2713; |
| Размещение нескольких сайтов                             | &#x2713; | &#x2713; |
| Перенаправление трафика                               | &#x2713; | &#x2713; |
| Брандмауэр веб-приложения (WAF)                    | &#x2713; | &#x2713; |
| Настраиваемые правила WAF                                  |          | &#x2713; |
| Завершение запросов SSL            | &#x2713; | &#x2713; |
| Сквозное шифрование SSL                         | &#x2713; | &#x2713; |
| Сходство сеансов                                  | &#x2713; | &#x2713; |
| Пользовательские страницы ошибок                                | &#x2713; | &#x2713; |
| Поддержка WebSocket                                 | &#x2713; | &#x2713; |
| Поддержка HTTP/2                                    | &#x2713; | &#x2713; |
| фильтрация подключений;                               | &#x2713; | &#x2713; |

> [!NOTE]
> Autoscaling v2 SKU теперь поддерживает [зонды работоспособности по умолчанию,](application-gateway-probe-overview.md#default-health-probe) чтобы автоматически контролировать работоспособность всех ресурсов в своем пуле бэк-энда и выделять те бэкэнд-члены, которые считаются нездоровыми. Зонд работоспособности по умолчанию автоматически настраивается для бэкэндов, которые не имеют пользовательской конфигурации зонда. Чтобы узнать больше, смотрите [зонды работоспособности в шлюзе приложения.](application-gateway-probe-overview.md)

## <a name="differences-with-v1-sku"></a>Различия с v1 SKU

|Различие|Сведения|
|--|--|
|Сертификат аутентификации|Не поддерживается.<br>Для получения дополнительной информации смотрите [Обзор конца до конца SSL с помощью шлюза приложений](ssl-overview.md#end-to-end-ssl-with-the-v2-sku).|
|Смешанное использование Standard_v2 и Шлюза приложений (цен. категория "Стандартный") в той же подсети|Не поддерживается|
|Пользовательский маршрут (UDR) в подсети Application Gateway|Поддерживается (конкретные сценарии). В предварительном просмотре.<br> Для получения дополнительной информации [Application Gateway configuration overview](configuration-overview.md#user-defined-routes-supported-on-the-application-gateway-subnet)об поддерживаемых сценариях см.|
|NSG для диапазона портов входящего трафика| – 65200 до 65535 для SKU Standard_v2.<br>– 65503 до 65534 для SKU (цен. категория "Стандартный").<br>Дополнительные сведения см. в разделе [Часто задаваемые вопросы](application-gateway-faq.md#are-network-security-groups-supported-on-the-application-gateway-subnet).|
|Журналы производительности в системе диагностики Azure|Не поддерживается.<br>Следует использовать метрики Azure.|
|Выставление счетов|Начало биллинга запланировано на 1 июля 2019 года.|
|Режим FIPS|В настоящее время не поддерживаются.|
|Только режим ILB|В настоящее время это не поддерживается. Комбинация общедоступного режима и режима ILB не поддерживается.|
|Интеграция Наблюдателя за сетями|Не поддерживается.|
|Интеграция Центра безопасности Azure|Пока недоступно.

## <a name="migrate-from-v1-to-v2"></a>Миграция из версии 1 в версию 2

Скрипт Azure PowerShell доступен в галерее PowerShell, чтобы помочь вам перейти от вашего v1 Application Gateway/WAF к SKU для автоскалирования v2. Этот скрипт поможет скопировать конфигурацию с шлюза v1. Миграция трафика по-прежнему ваша ответственность. Для получения дополнительной информации [см.](migrate-v1-v2.md)

## <a name="next-steps"></a>Дальнейшие действия

- [Краткое руководство. Направление веб-трафика с помощью шлюза приложений Azure на портале Azure](quick-create-portal.md)
- [Создание автоматически масштабируемого, избыточного в пределах зоны шлюза приложений с зарезервированным виртуальным IP-адресом с помощью Azure PowerShell](tutorial-autoscale-ps.md)
- Дополнительные сведения о [шлюзе приложений](overview.md).
- Дополнительные сведения о [брандмауэре Azure](../firewall/overview.md).
