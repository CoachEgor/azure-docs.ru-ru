---
title: Компоненты шлюза приложения
description: В этой статье содержится информация о различных компонентах в шлюзе приложения
services: application-gateway
author: abshamsft
ms.service: application-gateway
ms.topic: article
ms.date: 02/20/2019
ms.author: absha
ms.openlocfilehash: 90b3c3fd18bc9211c731ccf16dd646a64a4a1116
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80133093"
---
# <a name="application-gateway-components"></a>Компоненты шлюза приложения

 Шлюз приложения служит единой точкой контакта для клиентов. Он распределяет входящий трафик приложений через несколько пулов бэкэнда, которые включают в себя vMs-технологии Azure, виртуальные наборы машин, службу приложений Azure и напрей-притонные/внешние серверы. Для распределения трафика шлюз приложения использует несколько компонентов, описанных в этой статье.

![Компоненты, используемые в шлюзе приложения](./media/application-gateway-components/application-gateway-components.png)

## <a name="frontend-ip-addresses"></a>IP-адреса Frontend

IP-адресом прифронтовой связи является IP-адрес, связанный с шлюзом приложения. Вы можете настроить шлюз приложения с общедоступным IP-адресом, личным IP-адресом или и тем, и другим. Шлюз приложения поддерживает один публичный или один частный IP-адрес. Ваша виртуальная сеть и общедоступный IP-адрес должны находиться в том же месте, что и шлюз приложения. После его создания IP-адрес переднего энда связан со слушателем.

### <a name="static-versus-dynamic-public-ip-address"></a>Статический и динамический публичный IP-адрес

SKU Azure Application Gateway V2 может быть настроен как для поддержки как статического внутреннего IP-адреса, так и статического общедоступного IP-адреса, либо только статического общедоступного IP-адреса. Он не может быть настроен для поддержки только статический внутренний IP-адрес.

V1 SKU может быть настроен для поддержки статического или динамического внутреннего IP-адреса и динамического публичного IP-адреса. Динамический IP-адрес Gateway приложения не изменяется на запущенном шлюзе. Он может меняться только тогда, когда вы останавливаетесь или запустите шлюз. Он не изменяется при сбоях системы, обновлениях, обновлениях хостов Azure и т.д. 

Имя DNS, связанное с шлюзом приложения, не меняется в течение жизненного цикла шлюза. В результате следует использовать псевдоним CNAME и указать его на dNS-адрес шлюза приложения.

## <a name="listeners"></a>Прослушиватели

Слушатель — это логическая сущность, которая проверяет входящие запросы на подключение. Слушатель принимает запрос, если протокол, порт, имя хоста и IP-адрес, связанный с запросом, совпадают с теми же элементами, связанными с конфигурацией слушателя.

Перед использованием шлюза приложения необходимо добавить хотя бы одного слушателя. К шлюзу приложения может быть прикреплено несколько слушателей, и они могут быть использованы для одного и того же протокола.

После того, как слушатель обнаруживает входящие запросы от клиентов, шлюз приложения направляет эти запросы участникам в пулбэка, настроенном в правиле.

Слушатели поддерживают следующие порты и протоколы.

### <a name="ports"></a>порты;

Порт — это место, где слушатель слушает запрос клиента. Вы можете настроить порты от 1 до 65502 для v1 SKU и от 1 до 65199 для v2 SKU.

### <a name="protocols"></a>Протоколы

Приложение Gateway поддерживает четыре протокола: HTTP, HTTPS, HTTP/2 и WebSocket:
>[!NOTE]
>Поддержка протокола HTTP/2 доступна только для клиентов, подключающихся к прослушивателям шлюза приложений. Связь с пулами серверов всегда более HTTP/1.1. Поддержка HTTP/2 отключена по умолчанию. Вы можете включить его.

- Укажите между протоколами HTTP и HTTPS в конфигурации слушателя.
- Поддержка [протоколов WebSockets и HTTP/2](features.md#websocket-and-http2-traffic) предоставляется по умолчанию, а [поддержка WebSocket](application-gateway-websocket.md) включена по умолчанию. Настраиваемый пользователем параметр для выборочного включения или отключения поддержки WebSocket отсутствует. Используйте WebSockets как с http, так и httpS слушателями.

Используйте слушатель HTTPS для прекращения TLS. Слушатель HTTPS разгружает работу шифрования и расшифровки на шлюз приложения, поэтому ваши веб-серверы не обременены накладными расходами.

### <a name="custom-error-pages"></a>Пользовательские страницы ошибок

Приложение Gateway позволяет создавать пользовательские страницы ошибок вместо отображения страниц ошибок по умолчанию. На пользовательской странице ошибок вы можете использовать собственные символику и макет. Приложение Gateway отображает пользовательскую страницу ошибки, когда запрос не может достичь бэкэнда.

Для получения дополнительной информации смотрите [страницы пользовательских ошибок для шлюза приложения.](custom-error.md)

### <a name="types-of-listeners"></a>Типы слушателей

Существует два типа слушателей:

- **Базовый**. Этот тип слушателя слушает один домен сайта, где он имеет один DNS отображение на IP-адрес шлюза приложения. Эта конфигурация слушателя необходима при размещении одного сайта за шлюзом приложения.

- **Мульти-сайт**. Эта конфигурация слушателя необходима при настройке нескольких веб-приложений в одном экземпляре шлюза приложения. Это позволяет настроить более эффективную топологию для развертывания, добавляя до 100 веб-сайтов в один шлюз приложения. Каждый веб-сайт может быть направлен в свой собственный внутренний пул. Например, три поддомена, abc.contoso.com, xyz.contoso.com и pqr.contoso.com, указывают на IP-адрес шлюза приложения. Вы бы создать три многоузловых слушателей и настроить каждого слушателя для соответствующего порта и протокола настройки.

    Для получения дополнительной информации, [см.](application-gateway-web-app-overview.md)

После создания слушателя вы связываете его с правилом разгрома запроса. Это правило определяет, как запрос, полученный на слушателя, должен быть направлен в бэкэнд.

Приложение Gateway обрабатывает слушателей в [указанном порядке.](configuration-overview.md#order-of-processing-listeners)

## <a name="request-routing-rules"></a>Правила запроса на разгром

Правило маршрутизатия запроса является ключевым компонентом шлюза приложения, поскольку оно определяет, как направлять трафик на слушателя. Правило связывает слушателя, пул сервера бэк-энда и настройки бэкэнда HTTP.

Когда слушатель принимает запрос, правило направления запроса перенаправляет запрос в бэкэнд или перенаправляет его в другое место. Если запрос перенаправлен в бэкэнд, правило разгрома запроса определяет, какой пул серверов бэкэнда для его переадресов. Правило разгрома запроса также определяет, должны ли быть переписаны заголовки в запросе. Один слушатель может быть прикреплен к одному правилу.

Существует два типа правил разгрома запросов:

- **Базовый**. Все запросы на связанного слушателя (например, blog.contoso.com/) направляются в связанный пул бэкэнда с помощью сопутствующее параметр HTTP.

- **Путь на основе**. Это правило маршрутизации позволяет направлять запросы по связанного слушателя в определенный пул бэкэнда, основываясь на URL-адресе в запросе. Если путь URL-адреса в запросе соответствует шаблону пути в правиле, основанном на пути, правило направляет запрос. Он применяет шаблон пути только к пути URL, а не к параметрам запроса. Если путь URL-адреса в запросе слушателя не совпадает ни с одним из правил, основанных на пути, он направляет запрос в пул бэкэнда по умолчанию и настройки HTTP.

Для получения дополнительной [URL-based routing](url-route-overview.md)информации см.

### <a name="redirection-support"></a>Поддержка перенаправления

Правило направления запроса также позволяет перенаправлять трафик на шлюзе приложения. Это общий механизм перенаправления, так что вы можете перенаправить в и из любого порта вы определяете с помощью правил.

Вы можете выбрать цель перенаправления, чтобы быть другим слушателем (который может помочь включить автоматическое перенаправление HTTPS) или внешний сайт. Вы также можете выбрать, чтобы перенаправление было временным или постоянным, или прибавить в строке URI и строке запроса к перенаправленному URL-.

Для получения дополнительной информации смотрите [перенаправление трафика на шлюзе приложения.](redirect-overview.md)

### <a name="rewrite-http-headers"></a>Перезапись заголовков HTTP

Используя правила разгрома запроса, можно добавить, удалить или обновить заголовки запросов и ответов HTTP(S по мере перемещения пакетов запросов и ответов между пулами клиентов и бэкэнда через шлюз приложения.

Заголовки могут быть настроены на статические значения или на другие заголовки и переменные сервера. Это помогает при таких важных случаях использования, как извлечение IP-адресов клиентов, удаление конфиденциальной информации о бэкэнде, дополнительная безопасность и так далее.

Для получения дополнительной информации смотрите [заголовки HTTP на шлюзе приложения.](rewrite-http-headers.md)

## <a name="http-settings"></a>Параметры HTTP

Приложение шлюз маршрутов трафика на серверы бэкэнда (указано в правиле маршрутификации запроса, которые включают параметры HTTP) с помощью номера порта, протокола и других параметров, описанных в этом компоненте.

Порт и протокол, используемые в настройках HTTP, определяют, шифруется ли трафик между шлюзом приложения и серверами бэкэнда (предоставляя сквозной TLS) или незашифрован.

Этот компонент также используется для:

- Определите, следует ли сохранять сеанс пользователя на одном сервере с помощью [сродства сеанса на основе файлов cookie.](features.md#session-affinity)

- Изящно удалить бэкэнд членов пула с помощью [соединения слива](features.md#connection-draining).

- Ассоциируете пользовательский зонд для мониторинга работоспособности бэкэнда, установите интервал тайм-аута запроса, переопределить имя и путь узла в запросе и предоставьте один клик, чтобы указать параметры бэкэнда Службы App.

## <a name="backend-pools"></a>Бассейны бэкэнда

Маршруты бэкэнда пула запрос на серверы бэкэнда, которые обслуживают запрос. Пулы бэкэнда могут содержать:

- Сетевые карты
- Масштабируемые наборы виртуальных машин
- Общедоступные IP-адреса
- Внутренние IP-адреса
- Полное доменное имя.
- Мультитенантные бэкэнды (например, служба приложений)

Члены пула бэкэнда приложения Gateway не привязаны к набору доступности. Шлюз приложения может общаться со экземплярами за пределами виртуальной сети, в которых он вне. В результате члены пулов бэкэнда могут быть в группах, в центрах обработки данных или за пределами Azure, если есть подключение IP.

Если вы используете внутренние IPs в качестве бэкэнд-пула, вы должны использовать [виртуальную сеть пиринга](../virtual-network/virtual-network-peering-overview.md) или [VPN шлюз.](../vpn-gateway/vpn-gateway-about-vpngateways.md) Виртуальная сеть пиринга поддерживается и выгодно для балансировки нагрузки трафика в других виртуальных сетей.

Шлюз приложения также может общаться с наемными серверами, когда они подключены azure ExpressRoute или VPN туннелями, если трафик разрешен.

Можно создавать различные пулы бэкэнда для различных типов запросов. Например, создайте один пул бэкэнда для общих запросов, а затем еще один пул бэкэнда для запросов в микрослужбы для вашего приложения.

## <a name="health-probes"></a>Пробы работоспособности

По умолчанию шлюз приложения отслеживает работоспособность всех ресурсов в пуле бэкэнда и автоматически удаляет неработоспособные ресурсы. Затем он отслеживает нездоровые экземпляры и добавляет их обратно в здоровый пул бэкэнда, когда они становятся доступными и реагируют на зонды здоровья.

Помимо проверки работоспособности по умолчанию проверку также можно настроить в соответствии с требованиями приложения. Пользовательские зонды позволяют более детальный контроль за мониторингом здоровья. При использовании пользовательских зондов можно настроить интервал зонда, URL и путь для тестирования, а также количество неудачных ответов, которые можно принять до того, как экземпляр пула бэкэнда будет помечен как неработоспособный. Мы рекомендуем настроить пользовательские зонды для мониторинга работоспособности каждого пула бэкэнда.

Для получения дополнительной информации [см.](../application-gateway/application-gateway-probe-overview.md)

## <a name="next-steps"></a>Дальнейшие действия

Создание шлюза приложений

* [На портале Azure](quick-create-portal.md)
* [с помощью Azure PowerShell;](quick-create-powershell.md)
* [Используя Azure CLI](quick-create-cli.md)
