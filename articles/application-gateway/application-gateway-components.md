---
title: Компоненты шлюза приложения
description: Эта статья содержит сведения о различных компонентах в шлюзе приложений
services: application-gateway
author: abshamsft
ms.service: application-gateway
ms.topic: article
ms.date: 02/20/2019
ms.author: absha
ms.openlocfilehash: f5dfa34760bcef23bf54d65b35e3ad8f48cc2ee5
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "60831848"
---
# <a name="application-gateway-components"></a>Компоненты шлюза приложения

 Шлюз приложений служит в качестве единственной точкой контакта для клиентов. Он распределяет входящий трафик приложений в нескольких пулах серверной части, в том числе виртуальных машин Azure, масштабируемые наборы виртуальных машин, службы приложений Azure и в локальной среде и внешних серверов. Для распределения трафика, шлюз приложений использует несколько компонентов, описанных в этой статье.

![Компоненты, используемые в шлюзе приложений](./media/application-gateway-components/application-gateway-components.png)

## <a name="frontend-ip-addresses"></a>Интерфейсные IP-адреса

Внешний IP-адрес является IP-адрес, связанный со шлюзом приложений. Можно настроить шлюз приложений требуется общедоступный IP-адрес и частный IP-адрес. Шлюз приложений поддерживает один общедоступный или частный IP-адрес. Виртуальную сеть и общедоступный IP-адрес должен быть в том же расположении, что шлюз приложений. После его создания, внешний IP-адрес, связанный с прослушиватель.

### <a name="static-versus-dynamic-public-ip-address"></a>Статический или динамический общедоступный IP-адрес

Номер SKU шлюза приложений Azure версии 2 поддерживает оба статические внутренние и статические общедоступные IP-адреса, несмотря на то, что номер SKU v1 поддерживает только статические внутренние IP-адреса. Если шлюз приложений будет остановлена и запущена, можно изменить виртуальный адрес IP-адрес (VIP).

DNS-имя, связанное со шлюзом приложений не изменяется в течение жизненного цикла шлюза. Таким образом необходимо использовать псевдоним CNAME и настроить его для DNS-адрес шлюза приложений.

## <a name="listeners"></a>Прослушиватели

Прослушиватель — это логическая сущность, которое проверяет наличие входящих запросов на подключение. Прослушиватель принимает запрос, если протокол, порт, узла и IP-адрес, связанный с запросом совпадает те же элементы, связанные с конфигурацией прослушивателя.

Прежде чем использовать шлюз приложений, необходимо добавить хотя бы один прослушиватель. Может существовать несколько прослушивателей, присоединенного к шлюзу приложений, и они могут использоваться для тот же протокол.

После прослушиватель обнаруживает входящие запросы от клиентов, шлюз приложений направляет эти запросы к элементам в серверном пуле. Шлюз приложений использует правила маршрутизации запроса, определенные для прослушивателя, получившего входящего запроса.

Прослушиватели поддерживает следующие порты и протоколы.

### <a name="ports"></a>порты;

Порт — где прослушиватель прослушивает клиентского запроса. Вы можете настроить порты, от 1 до 65502 для v1 SKU и 1 для 65199 для v2 SKU.

### <a name="protocols"></a>Протоколы

Шлюз приложений поддерживает четыре протокола: HTTP, HTTPS, HTTP/2 и WebSocket:

- Укажите HTTP или HTTPS протоколы в конфигурации прослушивателя.
- Поддержка [протоколы WebSocket и HTTP/2](https://docs.microsoft.com/azure/application-gateway/overview#websocket-and-http2-traffic) предоставляется в собственном коде, и [поддержка WebSocket](https://docs.microsoft.com/azure/application-gateway/application-gateway-websocket) включена по умолчанию. Настраиваемый пользователем параметр для выборочного включения или отключения поддержки WebSocket отсутствует. Использование WebSockets с прослушивателями HTTP и HTTPS.
- Поддержка протокола HTTP/2 доступна только для клиентов, подключающихся к прослушивателям шлюза приложений. Подключение к внутренним пулам серверов осуществляется по протоколу HTTP/1.1. Поддержка HTTP/2 отключена по умолчанию. Вы можете включить ее.

Используйте HTTPS-прослушиватель для завершения SSL-запросов. Прослушиватель HTTPS позволяет разгрузить операцию шифрования и расшифровки на шлюз приложений, поэтому веб-серверов не испытывать нагрузку по издержки. Затем ваши приложения могут сосредоточиться на бизнес-логики.

### <a name="custom-error-pages"></a>Пользовательские страницы ошибок

Шлюз приложений позволяет создавать пользовательские страницы ошибок вместо отображения страницы ошибок по умолчанию. На пользовательской странице ошибок вы можете использовать собственные символику и макет. Шлюз приложений отображает на пользовательскую страницу ошибки, если запрос не может достичь серверной части.

Дополнительные сведения см. в разделе [страницы настраиваемых ошибок для шлюза приложений](https://docs.microsoft.com/azure/application-gateway/custom-error).

### <a name="types-of-listeners"></a>Типы прослушивателей

Существует два типа прослушивателей:

- **Базовый** Этот тип прослушиватель прослушивает сайтом одним доменом, в котором она имеет одно сопоставление DNS на IP-адрес шлюза приложений. Эта конфигурация прослушивателя необходим при размещении одного сайта за шлюзом приложений.

- **Многосайтовые**. Эта конфигурация прослушивателя необходим при настройке более одного веб-приложения на одном экземпляре шлюза приложений. Он позволяет настроить более эффективную топологию развертывания путем добавления до 100 веб-сайтов в один шлюз приложений. Каждый веб-сайт может быть направлен в свой собственный внутренний пул. Например три дочерних доменов, abc.contoso.com, xyz.contoso.com и pqr.contoso.com, указывать IP-адрес шлюза приложений. Вы бы создайте три многосайтовые прослушиватели и настройте каждый прослушиватель для соответствующих порта и протокола.

    Дополнительные сведения см. в разделе [размещение нескольких сайтов](https://docs.microsoft.com/azure/application-gateway/application-gateway-web-app-overview).

После создания прослушивателя, связывается с правило маршрутизации запроса. Это правило определяет, как запрос, полученный на прослушивателе должно быть направлено в серверную часть.

Шлюз приложений обрабатывает прослушивателей в указанном порядке. Если основной прослушиватель соответствует входящий запрос, он обрабатывается первым. Для маршрутизации трафика на правильный внутренний сервер, настройте многосайтового прослушивателя до основного прослушивателя.

## <a name="request-routing-rules"></a>Запрос правила маршрутизации

Правило маршрутизации запроса является ключевым компонентом из шлюза приложений, так как он определяет способ маршрутизации трафика в прослушиватель. Это правило связывает прослушиватель, параметры HTTP серверной части и пула внутренних серверов.

Если прослушиватель принимает запрос, правило маршрутизации запроса перенаправляет запрос в серверную часть или перенаправляет его в другом месте. Если запрос передается на внутренний сервер, правило маршрутизации запроса определяет какой пул внутренних серверов, чтобы переслать сообщение. Кроме того правило маршрутизации запроса также определяет, должны быть переписаны заголовков в запросе. Для одного правила можно подключить один прослушиватель.

Существует два типа правил маршрутизации запроса:

- **Базовый** Все запросы на связанный прослушиватель (например, blog.contoso.com/*) перенаправляются связанные во внутренний пул с помощью связанного параметра HTTP.

- **На основе путей**. Это правило маршрутизации позволяет перенаправлять запросы на связанный прослушиватель в определенном серверном пуле, в зависимости от URL-адрес в запросе. Если путь к URL-адрес в запросе соответствует шаблону пути в правила на основе пути, правило направляет этот запрос. Шаблон пути применяется только к URL-пути, а не к своих параметрах запроса. Если URL-адрес запроса в прослушиватель не соответствует ни одному из правил на основе путей, он направляет запрос серверный пул по умолчанию и параметры HTTP.

Дополнительные сведения см. в разделе [маршрутизации на основе URL-адрес](https://docs.microsoft.com/azure/application-gateway/url-route-overview).

### <a name="redirection-support"></a>Поддержка перенаправления

Правило маршрутизации запроса также дает возможность перенаправления трафика на шлюзе приложений. Это универсальный механизм перенаправления, поэтому можно перенаправить в и из любого порта определяется с помощью правил.

Вы можете выбрать целевой объект перенаправления другой прослушиватель (Это позволяет включить автоматическое перенаправление с HTTP на HTTPS) или внешнего узла. Также вы можете иметь перенаправление быть временным или постоянным, или нужно добавить строку URI путь и запрос на перенаправленном URL-адрес.

Дополнительные сведения см. в разделе [перенаправления трафика на шлюз приложений](https://docs.microsoft.com/azure/application-gateway/redirect-overview).

### <a name="rewrite-http-headers"></a>Перезапись заголовков HTTP

С помощью правил маршрутизации запроса, можно добавить, удалить или обновить запрос HTTP (S) и заголовки ответа как пакетах запросов и ответов перемещение между клиентской и серверной части пулов с помощью шлюза приложений.

Заголовки можно задать статические значения или других заголовков и переменных сервера. Благодаря этому с важными случаи применения, таких как извлечение клиентских IP-адресов, удаления конфиденциальных сведений о серверной части, добавив большую безопасность и т. д.

Дополнительные сведения см. в разделе [заголовки HTTP, перепишите на шлюзе приложений](https://docs.microsoft.com/azure/application-gateway/rewrite-http-headers).

## <a name="http-settings"></a>Параметры HTTP

Шлюз приложений направляет трафик на внутренние серверы (указанной в правиле маршрутизации запроса, включают параметры HTTP), используя номер порта, протокола и другие параметры, описанные в этом компоненте.

Порт и протокол, используемый в параметрах HTTP определить, зашифрован ли трафик между сервером шлюза и серверной части приложения (при условии-сквозного режима связи SSL) или без шифрования.

Этот компонент также используется для:

- Определить, является ли сеанс пользователя должны храниться на одном сервере с помощью [сходства сеансов на основе файлов cookie](https://docs.microsoft.com/azure/application-gateway/overview#session-affinity).

- Корректно удалить участников серверного пула с помощью [фильтрации подключений](https://docs.microsoft.com/azure/application-gateway/overview#connection-draining).

- Свяжите пользовательскую проверку для мониторинга работоспособности серверной части, задайте интервал времени ожидания запроса, переопределить имя узла и путь в запросе и обеспечивают простоту одним щелчком, чтобы указать параметры для серверной части службы приложений.

## <a name="backend-pools"></a>Серверные пулы

Внутренний пул направляет запрос на внутренних серверах, которые обслуживать запрос. Серверные пулы могут содержать:

- сетевые карты;
- наборы для масштабирования виртуальных машин
- Общедоступные IP-адреса
- Внутренние IP-адреса
- ПОЛНОЕ ДОМЕННОЕ ИМЯ
- Мультитенантные серверные части (например, служба приложений)

Участники серверного пула шлюза приложений не привязаны к группе доступности. Шлюз приложений может взаимодействовать с экземплярами за пределами виртуальной сети, он выполняется. Таким образом членов во внутренние пулы можно в кластерах, между центрами обработки данных или за пределами Azure до тех пор, пока есть IP-подключения.

При использовании в качестве участников серверного пула внутренних IP-адресов необходимо использовать [пиринга виртуальных сетей](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview) или [VPN-шлюз](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways). Пиринг виртуальных сетей — поддерживаемые и полезным для балансировки нагрузки трафика в других виртуальных сетях.

Шлюз приложений также взаимодействуют для локальных серверов, если они подключены через Azure ExpressRoute или VPN-туннели, если трафик.

Можно создать различные внутренние пулы для различных типов запросов. Например можно создайте один серверный пул для общих запросов и еще один внутренний пул для запросов к микрослужбам для вашего приложения.

## <a name="health-probes"></a>Пробы работоспособности

По умолчанию шлюз приложений следит за работоспособностью всех ресурсов в свой внутренний пул и автоматически удаляет неработоспособное из них. Он затем отслеживает неработоспособные экземпляры и добавляет их в пул получается работоспособная серверная, когда они становятся доступными и отвечать на пробы работоспособности.

Помимо проверки работоспособности по умолчанию проверку также можно настроить в соответствии с требованиями приложения. Пользовательские проверки позволяют более детального контроля над мониторингом работоспособности. Если вы используете пользовательскую проверку работоспособности, можно настроить интервал, URL-адрес и путь для тестирования и сколько неудачных откликов, прежде чем экземпляр внутреннего пула будет помечена как Неработоспособная. Мы рекомендуем настроить пользовательские пробы для наблюдения за работоспособностью каждого внутреннего пула.

Дополнительные сведения см. в разделе [наблюдения за работоспособностью шлюза приложений](https://docs.microsoft.com/azure/application-gateway/application-gateway-probe-overview).

## <a name="next-steps"></a>Дальнейшие действия

Создание шлюза приложений

* [на портале Azure](quick-create-portal.md).
* [С помощью Azure PowerShell](quick-create-powershell.md)
* [С помощью Azure CLI](quick-create-cli.md)
