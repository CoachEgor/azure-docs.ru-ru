---
title: Общие сведения о брандмауэре веб-приложения для шлюза приложений Azure
description: На этой странице представлен обзор брандмауэра веб-приложения на Шлюзе приложений.
services: application-gateway
author: vhorne
ms.service: application-gateway
ms.date: 5/22/2019
ms.author: amsriva
ms.topic: conceptual
ms.openlocfilehash: 9c2759222198f5df682d9e7a5363c0d9679e0fad
ms.sourcegitcommit: cfbc8db6a3e3744062a533803e664ccee19f6d63
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/21/2019
ms.locfileid: "65991404"
---
# <a name="web-application-firewall-for-azure-application-gateway"></a>Брандмауэр веб-приложения для шлюза приложений Azure

Шлюз приложений Azure предлагает брандмауэром веб-приложения (WAF), обеспечивающий централизованную защиту веб-приложений от распространенных эксплойтов и уязвимостей. Веб-приложения все чаще распространяется вредоносных атак, использующих известные уязвимости. Внедрение кода SQL и межсайтовых сценариев являются наиболее распространенных атак.

Предотвращение таких атак в коде приложения является сложной задачей. Может потребоваться неукоснительного обслуживания, установки исправлений и мониторинга на различных уровнях топологии приложения. Брандмауэром централизованного веб-приложения помогает упростить управление безопасностью. WAF также обеспечивает администраторы приложений повышенную степень защиты от и угроз вторжения.

Решение WAF может реагировать на угрозы безопасности быстрее, централизованно установке исправлений известных уязвимостей, вместо обеспечения защиты каждого отдельного веб-приложения. Имеющиеся шлюзы приложений можно легко преобразовать в шлюзы приложений с поддержкой стены пожара.

WAF шлюза приложений на основе [набор основных правил (CRS)](https://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project) версии 3.0 или 2.2.9 из Open Web Application Security Project (OWASP). Брандмауэр веб-приложения автоматически обновится для добавления защиты от новых уязвимостей, которых не требуется дополнительная настройка.

![Схема WAF шлюза приложений](./media/waf-overview/WAF1.png)

Шлюз приложений работает как контроллер доставки приложений (ADC). Он предлагает завершение Secure Sockets Layer (SSL), соответствие сеансу на основе файлов cookie, распределение нагрузки по методу циклического, маршрутизация на основе содержимого, возможность размещения нескольких веб-сайтов и улучшения безопасности.

Улучшения безопасности шлюза приложений относятся управление политиками и поддерживает SSL end-to-end. Безопасность приложений является усилена за счет интеграции WAF в шлюзе приложений. Комбинация защищает веб-приложений от распространенных уязвимостей. А также легко настроить центральное расположение для управления.

## <a name="benefits"></a>Преимущества

В этом разделе описаны основные преимущества шлюза приложений и его WAF.

### <a name="protection"></a>Защита

* Защита веб-приложений из веб-уязвимостей и атак без изменения в код серверной части.

* Защита нескольких веб-приложений, в то же время. Экземпляр шлюза приложений можно разместить до 100 веб-сайтов, которые защищены брандмауэром веб-приложения.

### <a name="monitoring"></a>Мониторинг

* Мониторинг атак на систему веб-приложений с помощью в режиме реального времени журнал WAF. Журнал интегрирован с [Azure Monitor](../monitoring-and-diagnostics/monitoring-overview.md) для отслеживания предупреждений WAF и простого мониторинга тенденций.

* WAF шлюза приложений интегрирован с центром безопасности Azure. Центр безопасности Azure обеспечивает централизованное представление о состоянии безопасности всех ресурсов Azure.

### <a name="customization"></a>Настройка

* Вы можете настроить правила WAF и группы правил в соответствии с требованиями приложения и устраните ложные срабатывания.

## <a name="features"></a>Функции

- Защита от внедрения кода SQL.
- Защита от межсайтовых сценариев.
- Защита от других распространенных сетевых атак, таких как внедрение команд, несанкционированных HTTP-ответа разделение, HTTP-запроса и включение удаленных файлов.
- Защита от нарушений протокола HTTP.
- Защита от аномалий протокола HTTP, например, отсутствие агента пользователя узла и заголовки accept.
- Защита от программ-роботов, программ-обходчиков и сканеров.
- Обнаружение распространенных неправильных конфигураций приложений (например, Apache и IIS).
- С помощью нижнюю и верхнюю границы ограничивает размер запроса можно настроить.
- Списки исключений позволяют опустить определенных атрибутов запроса на основе оценки WAF. Распространенным примером является маркеры вставлены Active Directory, которые используются для проверки подлинности или пароля.

### <a name="core-rule-sets"></a>Основные наборы правил

Шлюз приложений поддерживает два набора правил CRS 3.0 и CRS 2.2.9. Эти правила защиты веб-приложений от вредоносных действий.

WAF шлюза приложений поставляется с CR 3.0 по умолчанию. Но вы можете вместо этого используйте версию CRS 2.2.9. В предложениях CR 3.0 сократилось число ложноположительных по сравнению с CRS 2.2.9. Вы также можете [Настройка правил в соответствии с потребностями](application-gateway-customize-waf-rules-portal.md).

Брандмауэр веб-приложения может обеспечивать защиту от следующих сетевых уязвимостей.

- Атаки путем внедрения кода SQL
- Атаки с использованием межузловых сценариев
- Других распространенных атак, таких как внедрение команд, HTTP запроса НТТР, разделением ответа HTTP и включение удаленных файлов
- Нарушение протокола HTTP
- Аномалий протокола HTTP, например, отсутствие агента пользователя узла и заголовков accept.
- Программ-роботов, программ-обходчиков и сканеров.
- Распространенных неправильных конфигураций приложений (например, Apache и IIS)

#### <a name="owasp-crs-30"></a>OWASP CRS 3.0

CRS 3.0 включает в себя 13 групп правил, как показано в следующей таблице. Каждая группа содержит несколько правил, которые могут быть отключены.

|Группы правил|Описание|
|---|---|
|**[REQUEST-911-METHOD-ENFORCEMENT](application-gateway-crs-rulegroups-rules.md#crs911)**|Блокировки методов (PUT, PATCH)|
|**[REQUEST-913-SCANNER-DETECTION](application-gateway-crs-rulegroups-rules.md#crs913)**|Защиту от сканеров портов и среды|
|**[REQUEST-920-PROTOCOL-ENFORCEMENT](application-gateway-crs-rulegroups-rules.md#crs920)**|Защититесь от протокола и кодирование проблемы|
|**[REQUEST-921-PROTOCOL-ATTACK](application-gateway-crs-rulegroups-rules.md#crs921)**|Защита от внедрения заголовка, несанкционированных запросов и разделения ответа|
|**[REQUEST-930-APPLICATION-ATTACK-LFI](application-gateway-crs-rulegroups-rules.md#crs930)**|Защита от атак путь и имя файла|
|**[REQUEST-931-APPLICATION-ATTACK-RFI](application-gateway-crs-rulegroups-rules.md#crs931)**|Защита от атак удаленного файла (RFI) включения|
|**[REQUEST-932-APPLICATION-ATTACK-RCE](application-gateway-crs-rulegroups-rules.md#crs932)**|Повторно защитить атак выполнения удаленный запуск программного кода|
|**[REQUEST-933-APPLICATION-ATTACK-PHP](application-gateway-crs-rulegroups-rules.md#crs933)**|Защита от атак путем внедрения кода PHP|
|**[REQUEST-941-APPLICATION-ATTACK-XSS](application-gateway-crs-rulegroups-rules.md#crs941)**|Защита от атак межсайтовых сценариев|
|**[REQUEST-942-APPLICATION-ATTACK-SQLI](application-gateway-crs-rulegroups-rules.md#crs942)**|Защита от атак путем внедрения кода SQL|
|**[REQUEST-943-APPLICATION-ATTACK-SESSION-FIXATION](application-gateway-crs-rulegroups-rules.md#crs943)**|Защита от атак с фиксацией сеанса|

#### <a name="owasp-crs-229"></a>OWASP CRS 2.2.9

CRS 2.2.9 включает в себя 10 групп правил, как показано в следующей таблице. Каждая группа содержит несколько правил, которые могут быть отключены.

|Группы правил|Описание|
|---|---|
|**[crs_20_protocol_violations](application-gateway-crs-rulegroups-rules.md#crs20)**|Защита от нарушений протокола (недопустимые символы или GET с текстом запроса)|
|**[crs_21_protocol_anomalies](application-gateway-crs-rulegroups-rules.md#crs21)**|Защиту от неверных сведений в заголовке|
|**[crs_23_request_limits](application-gateway-crs-rulegroups-rules.md#crs23)**|Защита от аргументов или файлов, которые превышают ограничения|
|**[crs_30_http_policy](application-gateway-crs-rulegroups-rules.md#crs30)**|Защиту от ограниченных методов, заголовки и типы файлов|
|**[crs_35_bad_robots](application-gateway-crs-rulegroups-rules.md#crs35)**|Защита от программ-обходчиков и сканеров|
|**[crs_40_generic_attacks](application-gateway-crs-rulegroups-rules.md#crs40)**|Защиту от универсальных атак (например, фиксация сеанса, включение удаленных файлов и внедрение кода PHP)|
|**[crs_41_sql_injection_attacks](application-gateway-crs-rulegroups-rules.md#crs41sql)**|Защита от атак путем внедрения кода SQL|
|**[crs_41_xss_attacks](application-gateway-crs-rulegroups-rules.md#crs41xss)**|Защита от атак межсайтовых сценариев|
|**[crs_42_tight_security](application-gateway-crs-rulegroups-rules.md#crs42)**|Защититься от атак с обходом пути|
|**[crs_45_trojans](application-gateway-crs-rulegroups-rules.md#crs45)**|Защититься от программы-трояны|

### <a name="waf-modes"></a>Режимы WAF

WAF шлюза приложений можно настроить для запуска в двух режимов:

* **Режим обнаружения**: Отслеживает и регистрирует все оповещения. Включите ведение журнала диагностики для шлюза приложений в **диагностики** раздел. Вам также необходимо убедиться в том, что журнал WAF выбран и включен. Брандмауэр веб-приложения не блокирует входящие запросы, когда он работает в режиме обнаружения.
* **Режим предотвращения**: Блокирует вторжения и атаки, которые позволяют обнаружить правила. Злоумышленник получает исключение «403 — несанкционированный доступ», и соединение будет разорвано. Режим предотвращения подобных атак записывает в журналы WAF.

### <a name="anomaly-scoring-mode"></a>Режим Scoring аномалий

OWASP имеет два режима для принятия решения для блокировки трафика: Традиционный режим и режим оценки аномалий.

В стандартном режиме независимо от других результатов поиска правило считается трафик, соответствующий любое правило. Данный режим прост для понимания. Но отсутствие сведений о сколько правила соответствуют определенному запросу является ограничением. Таким образом был введен режим оценки аномалий. Это значение по умолчанию для OWASP 3. *x*.

В режиме оценки аномалий трафик, соответствующий любое правило не будет блокироваться немедленно при брандмауэр в режиме предотвращения. Правила имеют определенного уровня важности: *Критические*, *ошибка*, *предупреждение*, или *Обратите внимание, что*. Что серьезность влияет на числовое значение для запроса, который называется показатель аномалии. Например, один *предупреждение* правила соответствия вносит 3 в оценку. Один *критическое* правила соответствия вносит 5.

|Severity  |Value  |
|---------|---------|
|критические ошибки.     |5|
|Ошибка        |4.|
|Предупреждение      |3|
|Уведомление       |2|

Есть пороговое значение 5 в качестве показателя аномалий блокировки трафика. Таким образом, один *критическое* совпадения правила достаточно, WAF шлюза приложений для блокировки запроса, даже в режиме предотвращения. Но одной *предупреждение* правило соответствия, просто увеличится аномалий оценка на 3, который недостаточно сама по себе блокировать трафик.

> [!NOTE]
> Сообщение, которое регистрируется, когда трафик соответствует правилу WAF включает значение действия «Заблокировано». Но трафик, фактически только заблокированные для оценку аномалии, 5 или более поздней версии.  

### <a name="waf-monitoring"></a>Мониторинг WAF

Важно наблюдение за работоспособностью шлюза приложений. Наблюдение за работоспособностью WAF и приложениями, которые он защищает поддерживается интеграция с центром безопасности Azure, Azure Monitor и журналы Azure Monitor.

![Схема диагностики WAF шлюза приложений](./media/waf-overview/diagnostics.png)

#### <a name="azure-monitor"></a>Azure Monitor

Журналы шлюза приложений интегрированы с [Azure Monitor](../monitoring-and-diagnostics/monitoring-overview.md). Это позволяет отслеживать диагностические сведения, включая журналы и оповещения WAF. Эта возможность доступна на **диагностики** вкладку в ресурсе шлюза приложений на портале или непосредственно через Azure Monitor. Дополнительные сведения о включении журналов, см. в разделе [диагностикой шлюза приложений](application-gateway-diagnostics.md).

#### <a name="azure-security-center"></a>Центр безопасности Azure

[Центр безопасности](../security-center/security-center-intro.md) позволяет предотвращать, обнаруживать и реагировать на угрозы. Он предоставляет контроль над безопасностью ресурсов Azure и повышенному контролю. Шлюз приложений — [интегрированы с центром безопасности](application-gateway-integration-security-center.md). Центр безопасности проверяет среды для обнаружения незащищенных веб-приложений. Он может рекомендовать WAF шлюза приложений для защиты таких уязвимых ресурсов. Брандмауэры создать непосредственно в центре безопасности. Эти экземпляры WAF интегрируются с центром безопасности. Они отправляют предупреждения и сведения о работоспособности в центр безопасности для отчетов.

![Окно обзора центра безопасности](./media/waf-overview/figure1.png)

#### <a name="logging"></a>Ведение журналов

WAF шлюза приложений предоставляет подробные отчеты о каждой из угроз, обнаруженных этим средством. Функция ведения журналов интегрирована с журналами системы диагностики Azure. Оповещения записываются в формат JSON. Эти журналы можно интегрировать с [журналами Azure Monitor](../azure-monitor/insights/azure-networking-analytics.md).

![Журналы диагностики шлюза приложений windows](./media/waf-overview/waf2.png)

```json
{
  "resourceId": "/SUBSCRIPTIONS/{subscriptionId}/RESOURCEGROUPS/{resourceGroupId}/PROVIDERS/MICROSOFT.NETWORK/APPLICATIONGATEWAYS/{appGatewayName}",
  "operationName": "ApplicationGatewayFirewall",
  "time": "2017-03-20T15:52:09.1494499Z",
  "category": "ApplicationGatewayFirewallLog",
  "properties": {
    "instanceId": "ApplicationGatewayRole_IN_0",
    "clientIp": "104.210.252.3",
    "clientPort": "4835",
    "requestUri": "/?a=%3Cscript%3Ealert(%22Hello%22);%3C/script%3E",
    "ruleSetType": "OWASP",
    "ruleSetVersion": "3.0",
    "ruleId": "941320",
    "message": "Possible XSS Attack Detected - HTML Tag Handler",
    "action": "Blocked",
    "site": "Global",
    "details": {
      "message": "Warning. Pattern match \"<(a|abbr|acronym|address|applet|area|audioscope|b|base|basefront|bdo|bgsound|big|blackface|blink|blockquote|body|bq|br|button|caption|center|cite|code|col|colgroup|comment|dd|del|dfn|dir|div|dl|dt|em|embed|fieldset|fn|font|form|frame|frameset|h1|head|h ...\" at ARGS:a.",
      "data": "Matched Data: <script> found within ARGS:a: <script>alert(\\x22hello\\x22);</script>",
      "file": "rules/REQUEST-941-APPLICATION-ATTACK-XSS.conf",
      "line": "865"
    }
  }
} 

```

## <a name="application-gateway-waf-sku-pricing"></a>Цена на SKU для WAF шлюза приложений

WAF шлюза приложений доступны в разделе новый номер SKU. Этот номер SKU доступен только в модели подготовки Azure Resource Manager, а не в классической модели развертывания. Кроме того номера SKU WAF поставляются только средних и крупных размеров экземпляров шлюза приложений. Все ограничения для шлюза приложений также применяются к номера SKU WAF.

Ценовая политика основывается на почасовой стоимости использования экземпляра шлюза и стоимости обработки данных. [Цены на шлюз приложений](https://azure.microsoft.com/pricing/details/application-gateway/) для номера SKU WAF, отличается от стандартные тарифы за SKU. Плата за обработку данных одинаковы. Плата не каждого правила или группы правил. Вы можете защитить несколько веб-приложений, за тем же брандмауэром веб-приложения. Не взимается плата за поддержку нескольких приложений.

## <a name="next-steps"></a>Дальнейшие действия

См. в разделе [Настройка брандмауэра веб-приложения в шлюзе приложений](tutorial-restrict-web-traffic-powershell.md).
