---
title: Включение сквозного режима связи SSL в Шлюзе приложений Azure
description: В этой статье рассматривается поддержка сквозного режима связи SSL в Шлюзе приложений.
services: application-gateway
author: amsriva
ms.service: application-gateway
ms.topic: article
ms.date: 3/19/2019
ms.author: victorh
ms.openlocfilehash: 1259e755642563a7baad5496bc84ed736d5499f8
ms.sourcegitcommit: 16cb78a0766f9b3efbaf12426519ddab2774b815
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/17/2019
ms.locfileid: "65849808"
---
# <a name="overview-of-ssl-termination-and-end-to-end-ssl-with-application-gateway"></a>Общие сведения о завершение запросов SSL и сквозного режима связи SSL со шлюзом приложений

Secure Sockets Layer (SSL) — это технология стандартная безопасность для установления зашифрованному каналу между веб-сервером и браузером. Эту ссылку, гарантирует, что все данные, передаваемые между веб-сервера и браузеров остается закрытым и зашифрованный. Шлюз приложений поддерживает оба моста SSL шлюза, а также сквозное шифрование SSL.

## <a name="ssl-termination"></a>завершение SSL-запросов;

Шлюз приложений поддерживает функции моста SSL, после применения которых трафик обычно передается в незашифрованном виде на внутренние серверы. Существует ряд преимуществ, это завершение запросов SSL на шлюзе приложений.

- **Улучшенная производительность** — крупнейших производительность при выполнении расшифровки SSL — это первоначальное подтверждение установления связи. Для повышения производительности, server, выполнив расшифровка кэширует идентификаторы сеансов SSL и билетов сеанса TLS. Если это делается на шлюзе приложений, все запросы от одного клиента можно использовать кэшированные значения. Если это будет сделано на внутренних серверах, каждый раз, когда запросы клиента перейдите на другой сервер, клиент должен re‑authenticate. Использование TLS билетов может помочь устранить эту проблему, но они не поддерживаются всеми клиентами и может быть сложно настраивать и управлять ими.
- **Более эффективное использование внутренних серверов** — ЦП с большим объемом обработки SSL/TLS и становится все более интенсивно, при увеличении размеров ключей. Удаление этой работы из внутренних серверов позволяет им сосредоточиться на то, что они наиболее эффективны при доставке содержимого.
- **Интеллектуальную маршрутизацию** — по расшифровки трафика, шлюз приложений имеет доступ к содержимому запроса, такие как заголовки, URI и т. д. и эти данные, чтобы перенаправлять запросы можно использовать.
- **Управление сертификатами** — сертификаты только необходимо приобрести и установить на шлюзе приложений и не все внутренних серверов. Это экономит время и деньги.

Настройка моста SSL, SSL-сертификат требуется для добавления прослушивателя получить симметричный ключ, согласно спецификации протокола SSL шлюз приложений. Затем симметричный ключ используется для шифрования и расшифровки трафика, передаваемого в шлюз. SSL-сертификат должен быть в формате обмена личной информацией (PFX). Этот формат файла позволяет экспортировать закрытый ключ, необходимый шлюзу приложений для шифрования и расшифровки трафика.

> [!NOTE] 
>
> Шлюз приложений не предоставляет никаких возможностей для создания нового сертификата или отправить запрос сертификата в центр сертификации.

Для соединения SSL для работы необходимо убедиться, что SSL-сертификат удовлетворяла следующим условиям:

- Текущая дата и время находится в пределах «Действителен с» и «Действителен по» диапазон дат в сертификате.
- Общее имя сертификата соответствует заголовку узла в запросе. Например, если клиент запрашивает `https://www.contoso.com/`, то должно использоваться общее имя `www.contoso.com`.

### <a name="certificates-supported-for-ssl-termination"></a>Сертификаты, поддерживаемые для завершения SSL-запросов

Шлюз приложений поддерживает следующие типы сертификатов:

- Сертификат центра сертификации (ЦС): Сертификат ЦС — это цифровой сертификат, выданный центром сертификации (ЦС)
- Сертификат высокой Надежности (расширенная проверка): Сертификат высокой Надежности — это стандартный сертификат отраслевые рекомендации. Это становилась зеленой панели указателя браузера и публикации также название компании.
- Групповой сертификат: Этот сертификат поддерживает любое количество дочерних доменов, на основе *. site.com, где был бы заменен дочернего домена *. Тем не менее, не поддерживает site.com, поэтому в случае, если пользователи обращаются к веб-сайта без необходимости ввода в начале «www», групповой сертификат будет не говорить об этом.
- Самозаверяющие сертификаты: Клиентские браузеры не доверяете ли эти сертификаты и предупредит пользователя о том, что сертификата виртуальной службы не является частью цепочки доверия. Самозаверяющие сертификаты хорошо подходят для тестирования или средах, где администраторы управления клиентами и может безопасно обойти оповещения системы безопасности обозревателя. Рабочие нагрузки, нельзя использовать самозаверяющие сертификаты.

Дополнительные сведения см. в разделе [настройке завершения запросов SSL со шлюзом приложений](https://docs.microsoft.com/azure/application-gateway/create-ssl-portal).

### <a name="size-of-the-certificate"></a>Размер сертификата
Файл обмена личной информацией (PFX), сведениями о сертификате SSL не должно быть размером более 10 КБ.

## <a name="end-to-end-ssl-encryption"></a>Сквозное шифрование SSL

Некоторые клиенты могут не допускают незашифрованная связь внутренних серверов. Причина может заключаться в требованиях безопасности и соответствия или в том, что приложение может принимать только безопасные подключения. Теперь для таких приложений шлюз приложений поддерживает сквозное шифрование SSL.

Сквозное шифрование SSL позволяет безопасно передавать зашифрованные конфиденциальные данные в серверную часть, используя при этом обеспечиваемые шлюзом приложений преимущества балансировки нагрузки уровня 7. Сюда входит сходство сеансов на основе файлов cookie, маршрутизация на основе URL-адресов, поддержка маршрутизации на основе сайтов и возможность внедрения заголовков X-Forwarded-*.

Если на шлюзе приложений настроен сквозной режим связи SSL, он завершает сеансы SSL пользователей на шлюзе и расшифровывает пользовательский трафик. Затем он применяет настроенные правила и выбирает подходящий экземпляр внутреннего пула для передачи трафика в него. Затем шлюз приложений инициирует новое SSL-подключение ко внутреннему серверу и повторно шифрует данные с помощью сертификата открытого ключа внутреннего сервера, прежде чем передать запрос в серверную часть. Любой ответ веб-сервера проходит через тот же процесс на пути к пользователю. Сквозное шифрование SSL можно включить, задав параметр протокола [параметры HTTP серверной части](https://docs.microsoft.com/azure/application-gateway/configuration-overview#http-settings) на HTTPS, который применяется к внутреннему пулу.

Политика SSL применяется для внешнего и внутреннего трафика. Во внешнем интерфейсе шлюза приложений выступает в качестве сервера и применяет политику. В серверной части шлюз приложений работает как клиент и отправляет их протокола и шифрования как предпочтения во время подтверждения SSL.

Шлюз приложений взаимодействует только с этими экземплярами серверной части, которые имеют либо список разрешенных свой сертификат с помощью шлюза приложений или которого сертификаты подписываются центрами хорошо известных ЦС где общее имя сертификата совпадает с именем узла в HTTP параметры серверной части. К ним относятся доверенных служб Azure, таких как веб-приложениях службы приложений Azure и управления API Azure.

Если сертификаты членов во внутреннем пуле не зарегистрированы известное центрами сертификации, каждого экземпляра в серверном пуле с поддержкой сквозного режима связи SSL необходимо настроить с помощью сертификата, чтобы обеспечивать безопасное взаимодействие. Это гарантирует, что шлюз приложений взаимодействует только с известными экземплярами серверной части, тем самым защищая сквозной обмен данными.

> [!NOTE] 
>
> Настройка проверки подлинности сертификата не является обязательным для надежных служб Azure, таких как веб-приложениях службы приложений Azure и службы управления API Azure.

> [!NOTE] 
>
> Сертификат, добавленный **параметры HTTP серверной части** для проверки подлинности в серверную часть серверы можно так же, как сертификат, добавленный **прослушивателя** для оконечной точки SSL в шлюзе приложений и различные Усиление безопасности.

![Сценарий сквозного шифрования SSL][1]

В этом примере запросы, в которых используется TLS1.2, направляются на внутренние серверы в пул 1 с помощью сквозного шифрования SSL.

## <a name="end-to-end-ssl-and-whitelisting-of-certificates"></a>Сквозное шифрование SSL и список разрешенных сертификатов

Шлюз приложений взаимодействует только с известными экземплярами серверной части, которые имеют сертификат из списка разрешений, определенного на шлюзе приложений. Чтобы включить список разрешенных сертификатов, необходимо передать открытый ключ сертификатов внутреннего сервера (а не корневой сертификат) в шлюз приложений. После этого будут разрешены подключения только к известным и включенным в разрешенный список серверам. Оставшиеся серверы будут выдавать ошибку шлюза. Самозаверяющие сертификаты предназначены только для тестирования и не рекомендуются для рабочих нагрузок в рабочей среде. Такие сертификаты нужно добавить в список разрешений с помощью шлюза приложений, как описано ранее, прежде чем их можно будет использовать.

> [!NOTE]
> Для надежных служб Azure, таких как служба приложений Azure, настраивать сертификат аутентификации не нужно.

## <a name="end-to-end-ssl-with-the-v2-sku"></a>Сквозное шифрование SSL в номере SKU версии 2

Сертификаты проверки подлинности устарели и заменены доверенными корневыми сертификатами в номере SKU Шлюза приложений версии 2. Они действуют идентично сертификатам проверки подлинности, за исключением нескольких ключевых различий:

- Сертификаты, подписанные хорошо известными ЦС, общие имена которых совпадают с именем узла в параметрах HTTP серверной части, не требуют никаких дополнительных действий для обеспечения работы сквозного шифрования SSL. 

   Например, если сертификаты серверной части выданы хорошо известным центром сертификации и имеют общее имя contoso.com, а в поле узла в параметрах HTTP внутреннего сервера также указано значение contoso.com, дополнительные действия не требуются. Для протокола в параметрах HTTP серверной части можно задать HTTPS. Таким образом, и для пробы работоспособности, и для пути данных будет включен SSL. Если вы используете службу приложений Azure или другие Azure веб-службы внутреннего сервера, они также являются неявно доверенными, и никаких действий не требуется для сквозного режима связи SSL.
- Если сертификат самозаверяющий или подписан неизвестными посредниками, тогда для включения сквозного шифрования SSL в номере SKU версии 2 необходимо определить доверенный корневой сертификат. Шлюз приложений будет взаимодействовать только с серверными частями, корневой сертификат сертификата сервера которых совпадает с одним из сертификатов из списка доверенных корневых сертификатов в параметре HTTP серверной части, который связан с пулом.
- Помимо соответствия корневому сертификату Шлюз приложений также проверяет, соответствуют ли параметры узла, указанные в параметрах HTTP серверной части, обычному имени, представленному сертификатом SSL внутреннего сервера. При попытке установить SSL-подключение к серверной части Шлюз приложений задает расширение SNI узлу, указанному в параметрах HTTP серверной части.
- Если в параметре HTTP серверной части **выбрать имя узла из адреса серверной части** вместо поля узла, то заголовок SNI всегда будет со значением полного доменного имени узла серверной части. Общее имя в сертификате SSL внутреннего сервера должно соответствовать полному доменному имени. В этом сценарии не поддерживаются участников серверного пула с IP-адресами.
- Корневой сертификат — это закодированный в Base64 корневой сертификат из списка сертификатов внутреннего сервера.

## <a name="next-steps"></a>Дальнейшие действия

Ознакомившись со сквозным шифрованием SSL, [настройте сквозное шифрование SSL в Шлюзе приложений с помощью PowerShell](application-gateway-end-to-end-ssl-powershell.md), чтобы создать шлюз приложений, использующий сквозное шифрование SSL.

<!--Image references-->

[1]: ./media/ssl-overview/scenario.png
