---
title: Приложение шлюз высокий объем трафика поддержки
description: В этой статье содержится руководство по настройке шлюза приложений Azure в поддержку сценариев высокого объема сетевого трафика.
services: application-gateway
author: caya
ms.service: application-gateway
ms.topic: article
ms.date: 03/24/2020
ms.author: caya
ms.openlocfilehash: 65f404b52a5fc06d8fa5bb5aad291e57fde8caba
ms.sourcegitcommit: bc738d2986f9d9601921baf9dded778853489b16
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/02/2020
ms.locfileid: "80617200"
---
# <a name="application-gateway-high-traffic-support"></a>Поддержка больших объемов трафика Шлюза приложений

>[!NOTE]
> В этой статье описаны несколько предлагаемых рекомендаций, которые помогут вам настроить шлюз приложения для обработки дополнительного трафика из-за большого объема трафика, который может возникнуть из-за кризиса COVID-19.

Вы можете использовать шлюз приложений с веб-приложением Firewall (WAF) для масштабируемого и безопасного способа управления трафиком в веб-приложениях.

Следующие предложения помогут вам настроить шлюз приложений с WAF для обработки дополнительного трафика.

## <a name="use-the-v2-sku-over-v1-for-its-autoscaling-capabilities-and-performance-benefits"></a>Используйте v2 SKU над v1 для своих возможностей автоматического масштабирования и преимуществ производительности
V2 SKU предлагает автоматическое масштабирование, чтобы гарантировать, что ваш шлюз приложения может масштабироваться по мере увеличения трафика. Он также предлагает другие значительные преимущества производительности, такие как 5x лучше TLS разгрузки производительности, более быстрое развертывание и время обновления, резервность зоны, и многое другое по сравнению с v1. Для получения дополнительной [v2 documentation](https://docs.microsoft.com/azure/application-gateway/application-gateway-autoscaling-zone-redundant)информации см. 

## <a name="set-maximum-instance-count-to-the-maximum-possible-125"></a>Установите максимальное количество экземпляров до максимально возможного (125)
 
Предполагая, что у вас есть Application Gateway v2 SKU, установление максимально возможного значения экземпляра 125 позволяет Шлюзу приложения масштабироваться по мере необходимости. Это позволяет ему обрабатывать возможное увеличение трафика на ваши приложения. С вас будет взиматься плата только за использовать единицы емкости (CUs).  

## <a name="set-your-minimum-instance-count-based-on-your-average-cu-usage"></a>Установите минимальный отсчет экземпляра на основе среднего использования CU

Предполагая, что у вас есть приложение Gateway v2 SKU, автоматическое масштабирование занимает от шести до семи минут, чтобы масштабировать. При более высоком минимальном подсчете экземпляров шлюз приложения может лучше обрабатывать трафик при увеличении нагрузки, так как скачок трафика не требует операции автоматического масштабирования.  

## <a name="alert-if-a-certain-metric-surpasses-75-of-average-cu-utilization"></a>Предупреждение, если определенная метрика превышает 75% от среднего использования CU 
Ознакомиться с документацией по метрике и другим пошаг-прокладкам можно в [документации «Метрики приложений».](https://docs.microsoft.com/azure/application-gateway/application-gateway-metrics#metrics-visualization) 

### <a name="example-setting-up-an-alert-on-75-of-average-cu-usage"></a>Пример: Настройка оповещения о 75% от среднего использования CU

В этом примере показано, как использовать портал Azure для настройки оповещения при достигается 75% среднего использования CU. 
1. Перейдите к **шлюзу приложения**.
2. На левой панели выберите **метрики** под вкладкой **Мониторинг.** 
3. Добавьте метрику для **средних текущих вычислительных единиц.** 
![Настройка метрики WAF](./media/application-gateway-covid-guidelines/waf-setup-metrics.png)
4. Если вы установили минимальный показатель экземпляра, чтобы быть средним использованием CU, идите вперед и установите оповещение, когда 75% минимальных экземпляров используются. Например, если среднее использование составляет 10 CUs, установите оповещение на 7,5 CUs. Это предупреждает вас, если использование увеличивается и дает вам время, чтобы ответить. Вы можете поднять минимум, если вы думаете, что этот трафик будет устойчивым, чтобы предупредить вас, что трафик может увеличиваться. 
![Настройка оповещения WAF](./media/application-gateway-covid-guidelines/waf-setup-monitoring-alert.png)

> [!NOTE]
> Вы можете настроить оповещение, чтобы произойти на более низком или более высоком проценте использования CU в зависимости от того, насколько чувствительны вы хотите быть к потенциальным всплескам трафика.

## <a name="set-up-waf-with-geofiltering-and-bot-protection-to-stop-attacks"></a>Настройка WAF с геофильтрацией и защитой ботов, чтобы остановить атаки
Если требуется дополнительный уровень безопасности перед приложением, используйте шлюз приложения WAF_v2 SKU для возможностей WAF. Вы можете настроить v2 SKU, чтобы разрешить доступ к вашим приложениям только из данной страны или страны. Вы настраиваете пользовательское правило WAF, чтобы явно разрешить или заблокировать трафик на основе геолокации. Для получения дополнительной информации, см [геофильтрации пользовательских правил](https://docs.microsoft.com/azure/web-application-firewall/ag/geomatch-custom-rules) и [как настроить пользовательские правила на приложение шлюз WAF_v2 SKU через PowerShell](https://docs.microsoft.com/azure/web-application-firewall/ag/configure-waf-custom-rules).

Включите защиту бота, чтобы блокировать известных плохих ботов. Это должно уменьшить объем трафика, попадание в приложение. Для получения дополнительной [информации см.](https://docs.microsoft.com/azure/web-application-firewall/ag/configure-waf-custom-rules)

## <a name="turn-on-diagnostics-on-application-gateway-and-waf"></a>Включите диагностику на шлюзе приложений и WAF

Диагностические журналы позволяют просматривать журналы брандмауэров, журналы производительности и журналы доступа. Эти журналы можно использовать в Azure для управления шлюзов приложений и устранения неполадок. Для получения дополнительной информации ознакомьтесь с нашей [диагностической документацией](https://docs.microsoft.com/azure/application-gateway/application-gateway-diagnostics#diagnostic-logging). 

## <a name="set-up-an-tls-policy-for-extra-security"></a>Настройка политики TLS для дополнительной безопасности
Убедитесь, что вы используете последнюю версию политики TLS[(AppGwSslPolicy20170401S](https://docs.microsoft.com/azure/application-gateway/application-gateway-ssl-policy-overview#appgwsslpolicy20170401s)). Это обеспечивает соблюдение TLS 1.2 и более сильные шифры. Для получения дополнительной информации см. [настройку версий политики TLS и наборов шифров через PowerShell.](https://docs.microsoft.com/azure/application-gateway/application-gateway-configure-ssl-policy-powershell)
