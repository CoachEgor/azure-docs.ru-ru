---
title: Поддержка больших объемов трафика Шлюза приложений
description: Эта статья содержит рекомендации по настройке Шлюза приложений Azure для сценариев, связанных с большим объемом трафика в сети.
services: application-gateway
author: caya
ms.service: application-gateway
ms.topic: conceptual
ms.date: 03/24/2020
ms.author: caya
ms.openlocfilehash: 48730d03e9a578fb26b691577fa033e5f7bb4d19
ms.sourcegitcommit: 0ce1ccdb34ad60321a647c691b0cff3b9d7a39c8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/05/2020
ms.locfileid: "93397490"
---
# <a name="application-gateway-high-traffic-support"></a>Поддержка больших объемов трафика Шлюза приложений

>[!NOTE]
> В этой статье приведен ряд рекомендаций, которые помогут вам настроить Шлюз приложений для обработки увеличенных объемов трафика в связи с кризисом из-за распространения инфекции COVID-19.

Шлюз приложений можно использовать в сочетании с брандмауэром веб-приложения (WAF) для масштабируемой и надежной обработки трафика веб-приложений.

Приведенные ниже советы и рекомендации помогут вам настроить Шлюз приложений и WAF для обработки возросшего трафика.

## <a name="use-the-v2-sku-over-v1-for-its-autoscaling-capabilities-and-performance-benefits"></a>Для доступа к функциям автоматического масштабирования и повышенной производительности используйте SKU версии 2, а не 1
SKU версии 2 поддерживает автомасштабирование, благодаря чему Шлюз приложений может справляться с увеличением трафика. В этой версии также существенно повышена производительность: в частности, впятеро увеличена эффективность разгрузки TLS, ускорены процессы развертывания и обновления, обеспечена избыточность зон и реализованы дополнительные улучшения в сравнении с версией 1. Дополнительные сведения см. в [документации по версии 2](./application-gateway-autoscaling-zone-redundant.md). 

## <a name="set-maximum-instance-count-to-the-maximum-possible-125"></a>Установите максимально возможное число экземпляров (125)
 
Если вы используете SKU версии 2 Шлюза приложений, установка максимального числа экземпляров (125) позволит этой службе при необходимости горизонтально увеличивать масштаб. Благодаря этому она сможет обрабатывать возросший трафик в ваших приложениях. Счет будет выставляться вам только за реально использованные единицы емкости (CU).  

## <a name="set-your-minimum-instance-count-based-on-your-average-cu-usage"></a>Установите минимальное число экземпляров с учетом ваших средних показателей использования CU

Если вы используете SKU версии 2 Шлюза приложений, автоматическое горизонтальное масштабирование занимает от шести до семи минут. Чем больше минимальное число экземпляров, тем эффективнее Шлюз приложений обрабатывает трафик при увеличении нагрузки, поскольку рост трафика в таком случае не требует автоматического масштабирования.  

## <a name="alert-if-a-certain-metric-surpasses-75-of-average-cu-utilization"></a>Настройте оповещение при превышении определенной метрикой 75 % от среднего показателя использования CU 
Подробное описание наших метрик и другие пошаговые руководства приведены в нашей [документации по метрикам Шлюза приложений](./application-gateway-metrics.md#metrics-visualization). 

### <a name="example-setting-up-an-alert-on-75-of-average-cu-usage"></a>Пример настройка оповещения на уровне 75 % от среднего показателя использования CU

В этом примере показано, как с помощью портала Azure настроить оповещение, которое сработает при достижении 75 % от среднего показателя использования CU. 
1. Перейдите к **Шлюзу приложений**.
2. На левой панели на вкладке **Мониторинг** выберите **Метрики**. 
3. Добавьте метрику **Среднее текущее число единиц вычислений**. 
![Настройка метрики WAF](./media/application-gateway-covid-guidelines/waf-setup-metrics.png)
4. Если вы установили минимальное число экземпляров на уровне среднего числа используемых CU, настройте оповещение, которое должно срабатывать при использовании 75 % от вашего минимального числа экземпляров. Например, если в среднем вы используете 10 CU, установите оповещение на уровне 7,5 CU. В результате оповещение сработает, если уровень вашего использования увеличится, и у вас будет время среагировать на изменение. Вы сможете увеличить минимальное число, если считаете, что возросший объем трафика сохранится, чтобы при дальнейшем увеличении получить новое оповещение. 
![Настройка оповещения WAF](./media/application-gateway-covid-guidelines/waf-setup-monitoring-alert.png)

> [!NOTE]
> Вы можете установить оповещение на более низком или высоком процентном уровне использования CU в зависимости от того, насколько чувствительна ваша система к пикам трафика.

## <a name="set-up-waf-with-geofiltering-and-bot-protection-to-stop-attacks"></a>Настройте WAF с геофильтрацией и защитой от ботов для нейтрализации атак
Если вы хотите добавить дополнительный уровень защиты для своего приложения, воспользуйтесь соответствующими функциями WAF, реализованными в SKU версии 2 Шлюза приложений. SKU версии 2 можно настроить таким образом, чтобы доступ к вашим приложениям был разрешен только из определенных стран и регионов. Для этого создается настраиваемое правило WAF, явным образом разрешающее или блокирующее трафик по признаку геолокации. Дополнительные сведения см. в статьях о [настраиваемых правилах геофильтрации](../web-application-firewall/ag/geomatch-custom-rules.md) и [создании настраиваемых правил WAF в SKU версии 2 Шлюза приложений с помощью PowerShell](../web-application-firewall/ag/configure-waf-custom-rules.md).

Активируйте защиту от ботов, которая будет блокировать заведомо вредоносные боты. Это должно уменьшить трафик, поступающий в ваше приложение. Дополнительные сведения см. в [инструкциях по настройке защиты от ботов](../web-application-firewall/ag/configure-waf-custom-rules.md).

## <a name="turn-on-diagnostics-on-application-gateway-and-waf"></a>Включите диагностику Шлюза приложений и брандмауэра веб-приложения

Журналы диагностики включают журналы брандмауэра, производительности и доступа, которые можно просматривать. В Azure эти журналы можно использовать для управления шлюзами приложений и устранения возникающих в них неполадок. Дополнительные сведения см. в нашей [документации по диагностике](./application-gateway-diagnostics.md#diagnostic-logging). 

## <a name="set-up-an-tls-policy-for-extra-security"></a>Настройте политику TLS для дополнительной защиты
Используйте последнюю версию политики TLS ([AppGwSslPolicy20170401S](./application-gateway-ssl-policy-overview.md#appgwsslpolicy20170401s)). В ней реализована версия протокола TLS 1.2 и более надежные шифры. Дополнительные сведения см. в статье о [настройке версий политики TLS и комплектов шифров с помощью PowerShell](./application-gateway-configure-ssl-policy-powershell.md).