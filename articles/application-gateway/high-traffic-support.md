---
title: Поддержка большого объема трафика шлюза приложений
description: В этой статье приводятся рекомендации по настройке шлюза приложений Azure для поддержки больших объемов трафика в сети.
services: application-gateway
author: caya
ms.service: application-gateway
ms.topic: article
ms.date: 03/24/2020
ms.author: caya
ms.openlocfilehash: 65f404b52a5fc06d8fa5bb5aad291e57fde8caba
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "80617200"
---
# <a name="application-gateway-high-traffic-support"></a>Поддержка больших объемов трафика Шлюза приложений

>[!NOTE]
> В этой статье описываются некоторые рекомендации по настройке шлюза приложений для поддержки дополнительного трафика из-за большого объема трафика, который может произойти из-за критического сбоя КОВИД-19.

Шлюз приложений с брандмауэром веб-приложения (WAF) можно использовать для масштабируемого и безопасного способа управления трафиком в веб-приложениях.

Следующие рекомендации помогут настроить шлюз приложений с WAF для работы с дополнительным трафиком.

## <a name="use-the-v2-sku-over-v1-for-its-autoscaling-capabilities-and-performance-benefits"></a>Используйте SKU v2 более v1 для своих возможностей автоматического масштабирования и преимуществ производительности.
SKU v2 предлагает Автомасштабирование, чтобы обеспечить возможность масштабирования шлюза приложений по мере увеличения трафика. Кроме того, он предоставляет другие значительные преимущества для повышения производительности, например 5x лучшую производительность разгрузки TLS, более быстрое развертывание и время обновления, избыточность зоны и многое другое по сравнению с v1. Дополнительные сведения см. в [документации по версии 2](https://docs.microsoft.com/azure/application-gateway/application-gateway-autoscaling-zone-redundant). 

## <a name="set-maximum-instance-count-to-the-maximum-possible-125"></a>Установите максимально возможное число экземпляров (125)
 
При условии, что у вас есть номер SKU шлюза приложений версии 2, установка максимального числа экземпляров на максимально возможное значение 125 позволяет шлюзу приложений масштабироваться по мере необходимости. Это позволяет ИТ справиться с возможным увеличением трафика для приложений. Вам будет взята только цена за используемые единицы мощности (Cu).  

## <a name="set-your-minimum-instance-count-based-on-your-average-cu-usage"></a>Установите минимальное число экземпляров на основе среднего CU использования

При условии, что у вас есть номер SKU шлюза приложений версии 2, автоматическое масштабирование занимает от шести до семи минут. С более высоким минимальным числом экземпляров шлюз приложений может улучшить обработку трафика при увеличении нагрузки, так как для пикового трафика не требуется операция автомасштабирования.  

## <a name="alert-if-a-certain-metric-surpasses-75-of-average-cu-utilization"></a>Оповещать, если определенная метрика превышает 75% от среднего использования CU 
Подробное описание наших метрик и других пошаговых руководств см. в [документации по метрикам шлюза приложений](https://docs.microsoft.com/azure/application-gateway/application-gateway-metrics#metrics-visualization) . 

### <a name="example-setting-up-an-alert-on-75-of-average-cu-usage"></a>Пример. Настройка оповещения на 75% от среднего CU использования

В этом примере показано, как использовать портал Azure, чтобы настроить оповещение при достижении 75% от среднего CU использования. 
1. Перейдите к своему **шлюзу приложений**.
2. На панели слева выберите **метрики** на вкладке **мониторинг** . 
3. Добавьте метрику для **среднего числа текущих единиц вычислений**. 
![Настройка метрики WAF](./media/application-gateway-covid-guidelines/waf-setup-metrics.png)
4. Если минимальное число экземпляров равно среднему CU использованию, настройте оповещение, когда будет использоваться 75% от минимального числа экземпляров. Например, если среднее использование составляет 10 Cu, установите оповещение 7,5 Cu. Это предупреждает об увеличении использования и дает время на ответ. Можно увеличить минимальное значение, если вы считаете, что этот трафик будет поддерживаться, чтобы предупредить о том, что трафик может увеличиваться. 
![Настройка оповещения WAF](./media/application-gateway-covid-guidelines/waf-setup-monitoring-alert.png)

> [!NOTE]
> Вы можете настроить оповещение на более низкий или более высокий процент использования CU в зависимости от того, насколько конфиденциально вы хотите получить потенциальные пики трафика.

## <a name="set-up-waf-with-geofiltering-and-bot-protection-to-stop-attacks"></a>Настройка WAF с использованием геофильтра и программы-робота для защиты от атак
Если требуется дополнительный уровень безопасности перед приложением, используйте шлюз приложений WAF_v2 SKU для возможностей WAF. Вы можете настроить SKU v2, чтобы разрешить доступ только к приложениям из определенной страны или стран. Вы настраиваете пользовательское правило WAF, чтобы явно разрешать или блокировать трафик на основе географического расположения. Дополнительные сведения см. в статьях [геофильтрация настраиваемых правил](https://docs.microsoft.com/azure/web-application-firewall/ag/geomatch-custom-rules) и [Настройка настраиваемых правил на шлюзе приложений WAF_v2 SKU с помощью PowerShell](https://docs.microsoft.com/azure/web-application-firewall/ag/configure-waf-custom-rules).

Включите защиту Bot, чтобы заблокировать известные неправильные программы-роботы. Это должно сократить объем трафика, поступающий в приложение. Дополнительные сведения см. [в статье Защита Bot с помощью инструкции Set up](https://docs.microsoft.com/azure/web-application-firewall/ag/configure-waf-custom-rules).

## <a name="turn-on-diagnostics-on-application-gateway-and-waf"></a>Включение диагностики для шлюза приложений и WAF

Журналы диагностики позволяют просматривать журналы брандмауэра, журналы производительности и журналы доступа. Эти журналы можно использовать в Azure для управления шлюзами приложений и устранения неполадок в них. Дополнительные сведения см. в [документации по диагностике](https://docs.microsoft.com/azure/application-gateway/application-gateway-diagnostics#diagnostic-logging). 

## <a name="set-up-an-tls-policy-for-extra-security"></a>Настройка политики TLS для дополнительной безопасности
Убедитесь, что используется последняя версия политики TLS ([AppGwSslPolicy20170401S](https://docs.microsoft.com/azure/application-gateway/application-gateway-ssl-policy-overview#appgwsslpolicy20170401s)). Это обеспечивает применение протокола TLS 1,2 и более надежных шифров. Дополнительные сведения см. в разделе [Настройка версий политик TLS и комплектов шифров с помощью PowerShell](https://docs.microsoft.com/azure/application-gateway/application-gateway-configure-ssl-policy-powershell).
