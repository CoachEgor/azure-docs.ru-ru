---
title: Что такое контроллер входящего трафика шлюза приложений Azure?
description: В этой статье приводятся общие сведения о контроллере входящего трафика шлюза приложений.
services: application-gateway
author: caya
ms.service: application-gateway
ms.topic: article
ms.date: 06/10/2020
ms.author: caya
ms.openlocfilehash: 26f53a8f93d4d51ec8f8fd91051496a46670f432
ms.sourcegitcommit: 0ce1ccdb34ad60321a647c691b0cff3b9d7a39c8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/05/2020
ms.locfileid: "93397354"
---
# <a name="what-is-application-gateway-ingress-controller"></a>Что такое входной контроллер шлюза приложений?
Контроллер входящего трафика шлюза приложений (АГИК) — это приложение Kubernetes, которое позволяет клиентам [Azure Kubernetes Service (AKS)](https://azure.microsoft.com/services/kubernetes-service/) использовать собственный [шлюз](https://azure.microsoft.com/services/application-gateway/) нагрузки уровня 7 для Microsoft Azure, чтобы предоставить доступ к облачному программному обеспечению через Интернет. АГИК отслеживает кластер Kubernetes, на котором он размещен, и постоянно обновляет шлюз приложений, чтобы выбранные службы были доступны в Интернете.

Входной контроллер работает в своем собственном модуле в AKS клиента. АГИК отслеживает подмножество ресурсов Kubernetes для внесения изменений. Состояние кластера AKS преобразуется в конфигурацию шлюза приложений и применяется к [Azure Resource Manager (ARM)](../azure-resource-manager/management/overview.md).

## <a name="benefits-of-application-gateway-ingress-controller"></a>Преимущества контроллера входящего трафика шлюза приложений
АГИК помогает устранить необходимость создания другой подсистемы балансировки нагрузки или общедоступного IP-адреса перед кластером AKS и избежать нескольких прыжков в пути данных до достижения запросов к кластеру AKS. Шлюз приложений обращается к модулям Pod напрямую с помощью частных IP-адресов и не требует Нодепорт или Кубепрокси Services. Это также повышает производительность развертывания.

Входной контроллер поддерживается исключительно Standard_v2 и WAF_v2 SKU, что также приводит к преимуществам автоматического масштабирования. Шлюз приложений может реагировать в ответ на увеличение или уменьшение нагрузки на трафик и соответствующим образом масштабировать, не используя ресурсы из кластера AKS.

Использование шлюза приложений в дополнение к АГИК также помогает защитить кластер AKS, предоставляя политику TLS и функцию брандмауэра веб-приложения (WAF).

![Шлюз приложений Azure + AKS](./media/application-gateway-ingress-controller-overview/architecture.png)

АГИК настраивается с помощью [ресурса](https://kubernetes.io/docs/user-guide/ingress/)входящих данных Kubernetes, а также службы, развертываний и модулей Pod. Он предоставляет ряд функций, использующих балансировщик нагрузки уровня "Стандартный" шлюза приложений Azure. Вот некоторые из них:
  - Маршрутизация URL-адресов
  - Сходство на основе файлов cookie,
  - Терминирование TLS
  - Сквозной протокол TLS
  - Поддержка общедоступных, частных и гибридных веб-сайтов
  - Интегрированный брандмауэр веб-приложения

## <a name="difference-between-helm-deployment-and-aks-add-on"></a>Разница между развертыванием Helm и AKS Add-On
Существует два способа развертывания АГИК для кластера AKS. Первый способ — через Helm; второй — через AKS в качестве надстройки. Основное преимущество развертывания АГИК в качестве надстройки AKS заключается в том, что это гораздо проще, чем развертывание с помощью Helm. Для новой установки можно развернуть новый шлюз приложений и новый кластер AKS с АГИК, включенным в качестве надстройки, в одной строке Azure CLI. Надстройка также является полностью управляемой службой, которая предоставляет дополнительные преимущества, такие как автоматическое обновление и расширенная поддержка. АГИК, развернутый через Helm, не поддерживается AKS, однако АГИК, развернутый как надстройка AKS, поддерживается AKS. 

Надстройка АГИК все еще развертывается как Pod в кластере AKS клиента, однако существует ряд различий между версией развертывания Helm и версией надстройки АГИК. Ниже приведен список различий между двумя версиями: 
  - Невозможно изменить значения развертывания Helm в надстройке AKS:
    - `verbosityLevel` по умолчанию будет иметь значение 5
    - `usePrivateIp` по умолчанию будет иметь значение false; Это может быть перезаписано [заметкой use-Private-IP](ingress-controller-annotations.md#use-private-ip)
    - `shared` не поддерживается в надстройке 
    - `reconcilePeriodSeconds` не поддерживается в надстройке
    - `armAuth.type` не поддерживается в надстройке
  - АГИК, развернутый через Helm, поддерживает Прохибитедтаржетс, что означает, что АГИК может настроить шлюз приложений специально для кластеров AKS, не затрагивая другие существующие серверные возможности. Надстройка АГИК сейчас не поддерживает эту возможность. 
  - Так как надстройка АГИК является управляемой службой, клиенты автоматически будут обновлены до последней версии надстройки АГИК, в отличие от АГИК, развернутых с помощью Helm, где клиент должен вручную обновить АГИК. 

> [!NOTE]
> Метод развертывания надстройки АГИК AKS в настоящее время находится на этапе предварительной версии. Мы не рекомендуем выполнять производственные рабочие нагрузки на функциях, которые остались в предварительной версии, поэтому, если вас интересуют, мы рекомендуем настроить новый кластер для его тестирования. 

В следующих таблицах сортируются сценарии, которые в настоящее время поддерживаются версией развертывания Helm и версией надстройки AKS АГИК. 

### <a name="aks-add-on-agic-single-aks-cluster"></a>Надстройка AKS АГИК (один кластер AKS)
|                  |1 шлюз приложений |2 + шлюзы приложений |
|------------------|---------|--------|
|**1 АГИК**|Да, это поддерживается |Нет, это невыполненная работа |
|**2 + Агикс**|Нет, только 1 АГИК поддерживается или кластер |Нет, только 1 АГИК поддерживается или кластер |

### <a name="helm-deployed-agic-single-aks-cluster"></a>Helm развернутый АГИК (кластер с одним AKS)
|                  |1 шлюз приложений |2 + шлюзы приложений |
|------------------|---------|--------|
|**1 АГИК**|Да, это поддерживается |Нет, это невыполненная работа |
|**2 + Агикс**|Необходимо использовать общие функции Прохибитедтаржет и наблюдать за отдельными пространствами имен |Да, это поддерживается |

### <a name="helm-deployed-agic-2-aks-clusters"></a>Helm развернутые АГИК (2 + AKS кластеры)
|                  |1 шлюз приложений |2 + шлюзы приложений |
|------------------|---------|--------|
|**1 АГИК**|Н/Д |Н/Д |
|**2 + Агикс**|Необходимо использовать общую функциональность Прохибитедтаржет |Недоступно |

## <a name="next-steps"></a>Дальнейшие действия
- [**AKS Add-On нуля Deployment**](tutorial-ingress-controller-add-on-new.md): инструкции по установке надстройки АГИК, AKS и шлюза приложений в инфраструктуре пустого материала.
- [**AKS Add-On серия статей Brownfield Deployment**](tutorial-ingress-controller-add-on-existing.md): Установка агик надстройки в кластере AKS с существующим шлюзом приложений.
- [**Развертывание Helm нуля**](ingress-controller-install-new.md): Установка агик с помощью Helm, нового кластера AKS и нового шлюза приложений в инфраструктуре пустого материала.
- [**Развертывание Helm серия статей Brownfield**](ingress-controller-install-existing.md). Развертывание агик через Helm в существующем кластере AKS и шлюзе приложений.