---
title: Предельный размер запросов брандмауэра веб-приложения и списки исключений в Шлюзе приложений Azure — портал Azure
description: В этой статье приводятся сведения о настройке предельного размера запросов брандмауэра веб-приложения и списков исключений в шлюзе приложений на портале Azure.
services: application-gateway
author: vhorne
ms.service: application-gateway
ms.date: 5/15/2019
ms.author: victorh
ms.topic: conceptual
ms.openlocfilehash: 5ddcdeca41e2f21fa27db25f7e0721c7ef87e491
ms.sourcegitcommit: 3675daec6c6efa3f2d2bf65279e36ca06ecefb41
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/14/2019
ms.locfileid: "65620279"
---
# <a name="web-application-firewall-request-size-limits-and-exclusion-lists"></a>Предельный размер запросов брандмауэра веб-приложения и списки исключений

Брандмауэр веб-приложения (WAF) шлюза приложений Azure обеспечивает защиту веб-приложений В этой статье описывается настройка предельного размера запросов WAF и списков исключений.

## <a name="waf-request-size-limits"></a>Предельный размер запросов WAF

![Предельный размер запросов](media/application-gateway-waf-configuration/waf-requestsizelimit.png)

Брандмауэр веб-приложения позволяет настроить предельный размер запроса с нижней и верхней границей. Доступны следующие две конфигурации предельного размера:

- Поле размер максимального запроса текст задается в килобайтах и элементы управления, которые передает общую предельный размер запроса, за исключением любой файл. Значение поля может варьироваться от 1 КБ (минимум) до 128 КБ (максимум). Значение по умолчанию — 128 КБ.
- Поле "Предельный размер отправки файла" указывается в МБ и определяет максимальный размер отправки файла. Минимальное значение поля — 1 МБ, максимальное — 500 МБ для крупных экземпляров SKU, а для средних — не более 100 МБ. Значение по умолчанию — 100 МБ.

WAF также позволяет настроить ручку, включающую и отключающую проверку текста запроса. По умолчанию проверка включена. Если проверка тела запроса окажется выключен, WAF не вычислять значение содержимого текста сообщения HTTP. В таких случаях WAF продолжит применять свои правила к заголовкам, файлам cookie и URI. Если проверка текста запроса отключена, то поле максимального размера текста запроса будет неприменимо и его невозможно будет настроить. Отключение проверки текста запроса позволяет отправлять в брандмауэр веб-приложения сообщения, длина которых превышает 128 Кбайт, но текст сообщения не проверяется на наличие уязвимостей.

## <a name="waf-exclusion-lists"></a>Списки исключений WAF

![waf-exclusion.png](media/application-gateway-waf-configuration/waf-exclusion.png)

Списки исключений WAF позволяют пропустить некоторые атрибуты запроса при проверке WAF. Распространенный пример — вставленные токены Active Directory, которые используются для проверки подлинности или полей пароля. Такие атрибуты часто могут содержать специальные символы, которые активируют ложные срабатывания правил WAF. После добавления атрибута в список исключений WAF он не учитывается ни одним настроенным и активным правилом WAF. Списки исключений применяются глобально.

В списки исключений можно добавить следующие атрибуты:

* Заголовки запроса
* Объекты cookie запросов
* Имя атрибута запроса (args)

   * Данные формы с разделителем
   * XML
   * JSON
   * Аргументы запроса URL-адрес

Вы можете указать точное соответствие заголовка запроса, текста, файла cookie или атрибута строки запроса.  Либо при необходимости вы можете задать частичное соответствие. Исключение всегда составляет поле заголовка, но не его значение. Правила исключения являются глобальными в области и применяются ко всем страницам и всем правилам.

Поддерживаемые операторы критериев соответствия:

- **Equals**:  этот оператор используется для точного совпадения. Например, для выбора заголовка с именем **bearerToken** используйте оператор равенства со значением селектора **bearerToken**.
- **Starts with**: этот оператор находит все поля, которые начинаются с указанного значения селектора.
- **Ends with**:  этот оператор находит все поля запроса, которые заканчиваются на указанное значение селектора.
- **Contains**: этот оператор находит все поля запроса, которые содержат указанное значение селектора.
- **Равно любой**: Этот оператор соответствует все поля запроса. * будет значение селектора.

Во всех случаях при поиске не учитывается регистр, и в качестве селекторов запрещено использовать регулярные выражения.

### <a name="examples"></a>Примеры

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

Следующие примеры демонстрируют использование исключений.

### <a name="example-1"></a>Пример 1

В этом примере требуется исключить заголовок user-agent. Заголовок агента пользователя запроса содержит строку характеристик, которая позволяет узлам сети протокол для определения типа приложения, операционной системы, поставщику программного обеспечения или программного обеспечения версии запрашивающим агентом пользователя программного обеспечения. Дополнительные сведения см. в разделе [User-Agent](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/User-Agent).

Может существовать любое количество причины отключения оценке этот заголовок. Может быть строка, WAF увидит и предполагается, что он является вредоносным. Например, классической атаке SQL «x = x» в строке. В некоторых случаях это может быть трафика. Поэтому необходимо исключить этот заголовок на основе оценки WAF.

Следующий командлет Azure PowerShell не включает заголовок user-agent на основе оценки:

```azurepowershell
$exclusion1 = New-AzApplicationGatewayFirewallExclusionConfig `
   -MatchVariable "RequestHeaderNames" `
   -SelectorMatchOperator "Equals" `
   -Selector "User-Agent"
```

### <a name="example-2"></a>Пример 2

В этом примере исключает значение в *пользователя* параметр, передаваемый в запросе с помощью URL-адрес. Например предположим, что довольно часто в вашей среде для пользователя поле, содержащее строку, которая просматривает WAF как вредоносного содержимого, поэтому он блокирует его.  Можно исключить параметр пользователя таким образом, чтобы брандмауэр веб-приложения не вычисляет любого элемента в поле.

Следующий командлет Azure PowerShell не включает параметр пользователя на основе оценки:

```azurepowershell
$exclusion2 = New-AzApplicationGatewayFirewallExclusionConfig `
   -MatchVariable "RequestArgNames" `
   -SelectorMatchOperator "Equals" `
   -Selector "user"
```
Поэтому, если URL-адрес **http://www.contoso.com/?user=fdafdasfda** передается для WAF, он не будет оценен строка **fdafdasfda**.

## <a name="next-steps"></a>Дальнейшие действия

После настройки параметров WAF вы можете узнать, как просматривать журналы WAF. Дополнительные сведения см. в разделе [Журналы диагностики](application-gateway-diagnostics.md#diagnostic-logging).
