---
title: Руководство. Создание шлюза приложений с правилами маршрутизации на основе URL-пути при помощи портала Azure
description: В этом руководстве вы узнаете, как создать правила маршрутизации на основе URL-пути для шлюза приложений и масштабируемый набор виртуальных машин с помощью портала Azure.
services: application-gateway
author: vhorne
ms.service: application-gateway
ms.topic: tutorial
ms.date: 4/18/2019
ms.author: victorh
ms.openlocfilehash: 5307f7674635fd33241e1faba9bb0b7c0432d10b
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "66134763"
---
# <a name="tutorial-create-an-application-gateway-with-path-based-routing-rules-using-the-azure-portal"></a>Руководство по Создание шлюза приложений с правилами маршрутизации на основе URL-пути при помощи портала Azure | Документация Майкрософт

Для настройки [правил маршрутизации на основе URL-пути](url-route-overview.md) при создании [шлюза приложений](overview.md) можно использовать портал Azure. В этом руководстве мы создадим серверные пулы с использованием виртуальных машин. Затем мы создадим правила маршрутизации, которые обеспечивают поступление веб-трафика на соответствующие серверы в пуле.

Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Создание шлюза приложений
> * создание виртуальных машин для внутренних серверов;
> * создание серверных пулов с внутренними серверами;
> * создание серверного прослушивателя;
> * создание правила маршрутизации на основе пути.

![Пример маршрутизации для URL-адресов](./media/create-url-route-portal/scenario.png)

При необходимости инструкции из этого руководства можно выполнить с помощью [Azure CLI](tutorial-url-route-cli.md) или [Azure PowerShell](tutorial-url-route-powershell.md).

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на портал Azure по адресу [https://portal.azure.com](https://portal.azure.com).

## <a name="create-an-application-gateway"></a>Создание шлюза приложений

Виртуальная сеть необходима для обмена данными между создаваемыми ресурсами. В этом примере создаются две подсети: одна для шлюза приложений, а другая — для внутренних серверов. Вы можете создать виртуальную сеть во время создания шлюза приложений.

1. Нажмите кнопку **Создать** в верхнем левом углу портала Azure.
2. Щелкните **Сети**, а затем в списке "Рекомендованные" выберите **Шлюз приложений**.
3. Введите следующие значения для шлюза приложений:

   - *myAppGateway* — для имени шлюза приложений.
   - *myResourceGroupAG* — для новой группы ресурсов.

     ![Создание шлюза приложений](./media/create-url-route-portal/application-gateway-create.png)

4. Оставьте значения по умолчанию для других параметров, а затем нажмите кнопку **ОК**.
5. Щелкните **Выбрать виртуальную сеть**, выберите **Создать**, а затем введите следующие значения для виртуальной сети:

   - *myVNet* — имя виртуальной сети;
   - *10.0.0.0/16* — диапазон адресов виртуальной сети;
   - *myAGSubnet* — имя подсети;
   - *10.0.0.0/24* — диапазон адресов подсети.

     ![Создание виртуальной сети](./media/create-url-route-portal/application-gateway-vnet.png)

6. Нажмите кнопку **ОК**, чтобы создать виртуальную сеть и подсеть.
7. Щелкните **Выберите общедоступный IP-адрес**, выберите **Создать**, а затем введите имя общедоступного IP-адреса. В этом примере общедоступный IP-адрес — *myAGPublicIPAddress*. Оставьте значения по умолчанию для других параметров, а затем нажмите кнопку **ОК**.
8. Оставьте значения по умолчанию для конфигурации прослушивателя, оставьте брандмауэр веб-приложения отключенным и нажмите кнопку **ОК**.
9. Просмотрите параметры на странице сводки и выберите **ОК**, чтобы создать сетевые ресурсы и шлюз приложений. Процесс создания шлюза приложений может занять несколько минут. Дождитесь успешного завершения развертывания, прежде чем переходить к следующему разделу.

### <a name="add-a-subnet"></a>Добавление подсети

1. Выберите **Все ресурсы** в меню слева, а затем в списке ресурсов щелкните **myVNet**.
2. Выберите **Подсети**, а затем — **Подсеть**.

    ![Создание подсети](./media/create-url-route-portal/application-gateway-subnet.png)

3. Введите *myBackendSubnet* в качестве имени подсети и нажмите кнопку **ОК**.

## <a name="create-virtual-machines"></a>Создание виртуальных машин

В этом примере создаются три виртуальные машины, используемые в качестве внутренних серверов для шлюза приложений. Вы также установите службы IIS на виртуальных машинах, чтобы убедиться, что шлюз приложений успешно создан.

1. Нажмите кнопку **Создать**.
2. Выберите **Вычисления**, а затем в списке "Рекомендованные" выберите **Windows Server 2016 Datacenter**.
3. Введите следующие значения для виртуальной машины:

    - *myVM1* — для имени виртуальной машины;
    - *azureuser* — для имени пользователя учетной записи администратора;
    - *Azure123456!* — пароль.
    - Щелкните **Use existing** (Использовать существующую), а затем выберите *myResourceGroupAG*.

4. Нажмите кнопку **ОК**.
5. Выберите значение **DS1_V2** в качестве размера виртуальной машины и нажмите кнопку **Выбрать**.
6. Убедитесь, что выбрана виртуальная сеть **myVNet** и подсеть **myBackendSubnet**. 
7. Выберите **Отключено**, чтобы отключить диагностику загрузки.
8. Нажмите кнопку **ОК**, просмотрите параметры на странице сводки и щелкните **Создать**.

### <a name="install-iis"></a>Установка служб IIS

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

1. Откройте интерактивную оболочку и убедитесь, что выбрана оболочка **PowerShell**.

    ![Установка пользовательского расширения](./media/create-url-route-portal/application-gateway-extension.png)

2. Чтобы установить службы IIS, выполните на виртуальной машине следующие команды: 

    ```azurepowershell-interactive
    $publicSettings = @{ "fileUris" = (,"https://raw.githubusercontent.com/Azure/azure-docs-powershell-samples/master/application-gateway/iis/appgatewayurl.ps1");  "commandToExecute" = "powershell -ExecutionPolicy Unrestricted -File appgatewayurl.ps1" }
    Set-AzVMExtension `
      -ResourceGroupName myResourceGroupAG `
      -Location eastus `
      -ExtensionName IIS `
      -VMName myVM1 `
      -Publisher Microsoft.Compute `
      -ExtensionType CustomScriptExtension `
      -TypeHandlerVersion 1.4 `
      -Settings $publicSettings
    ```

3. Создайте еще две виртуальные машины и установите службы IIS, используя только что выполненные указания. Введите *myVM2* и *myVM3* в качестве имен и значений VMName в Set-AzVMExtension.

## <a name="create-backend-pools-with-the-virtual-machines"></a>Создание серверных пулов с виртуальными машинами

1. Выберите **Все ресурсы**, а затем — **myAppGateway**.
2. Выберите **Серверные пулы**. Пул по умолчанию был создан автоматически с помощью шлюза приложений. Выберите **appGatewayBackendPool**.
3. Щелкните **Добавить целевой объект**, чтобы добавить *myVM1* в appGatewayBackendPool.

    ![Добавление внутренних серверов](./media/create-url-route-portal/application-gateway-backend.png)

4. Щелкните **Сохранить**.
5. Выберите **Серверные пулы**, а затем щелкните **Добавить**.
6. Введите имя *imagesBackendPool* и добавьте *myVM2* с помощью параметра **Добавить целевой объект**.
7. Нажмите кнопку **ОК**.
8. Еще раз щелкните **Добавить**, чтобы добавить другой серверный пул с именем *videoBackendPool*, и добавьте в него *myVM3*.

## <a name="create-a-backend-listener"></a>Создание серверного прослушивателя

1. Выберите **Прослушиватели**, а затем — **Базовые**.
2. Введите *myBackendListener* в качестве имени, задайте *myFrontendPort* в качестве имени интерфейсного порта, а затем укажите *8080* в качестве порта для прослушивателя.
3. Нажмите кнопку **ОК**.

## <a name="create-a-path-based-routing-rule"></a>Создание правила маршрутизации на основе пути

1. Выберите **Правила**, а затем выберите **На основе пути**.
2. Введите имя *rule2*.
3. Введите *Images* в качестве имени первого пути. Введите путь */images/*\*. Выберите для серверного пула значение **imagesBackendPool**.
4. Введите *Video* в качестве имени второго пути. Введите путь */video/*\*. Выберите для серверного пула значение **videoBackendPool**.

    ![Создание правила на основе пути](./media/create-url-route-portal/application-gateway-route-rule.png)

5. Нажмите кнопку **ОК**.

## <a name="test-the-application-gateway"></a>Тестирование шлюза приложений

1. Выберите **Все ресурсы**, а затем щелкните **myAGPublicIPAddress**.

    ![Запись общедоступного IP-адреса шлюза приложений](./media/create-url-route-portal/application-gateway-record-ag-address.png)

2. Скопируйте общедоступный IP-адрес и вставьте его в адресную строку браузера. Например, http://40.121.222.19.

    ![Тестирование базового URL-адреса в шлюзе приложений](./media/create-url-route-portal/application-gateway-iistest.png)

3. Измените URL-адрес на http://&lt;ip-address&gt;:8080/images/test.htm и замените &lt;ip-address&gt; своим IP-адресом. Результат должен быть примерно таким:

    ![Тестирование URL-адреса изображений в шлюзе приложений](./media/create-url-route-portal/application-gateway-iistest-images.png)

4. Измените URL-адрес на http://&lt;ip-address&gt;:8080/video/test.htm и замените &lt;ip-address&gt; своим IP-адресом. Результат должен быть примерно таким:

    ![Тестирование URL-адреса видео в шлюзе приложений](./media/create-url-route-portal/application-gateway-iistest-video.png)

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вам уже не нужны ресурсы, созданные с помощью шлюза приложений, удалите группу ресурсов. Удалив ее, вы также удалите шлюз приложений и все связанные с ним ресурсы. 

Чтобы удалить группу ресурсов:

1. На портале Azure в меню слева выберите **Группы ресурсов**.
2. На странице **Группы ресурсов** выполните поиск группы **myResourceGroupAG** в списке и выберите ее.
3. На странице **группы ресурсов** выберите **Удалить группу ресурсов**.
4. Введите *myResourceGroupAG* в поле **Введите имя группы ресурсов**, а затем выберите **Удалить**.

## <a name="next-steps"></a>Дополнительная информация

> [!div class="nextstepaction"]
> [Дополнительные сведения о возможностях Шлюза приложений Azure](application-gateway-introduction.md)
