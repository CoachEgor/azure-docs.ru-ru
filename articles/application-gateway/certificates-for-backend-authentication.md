---
title: Сертификаты, необходимые для предоставления серверов бэкэнда
titleSuffix: Azure Application Gateway
description: В этой статье приводятся примеры того, как сертификат TLS/SSL может быть преобразован в сертификат аутентификации и доверенный корневой сертификат, который требуется для допуска резервов бэкэнда в шлюзе приложений Azure
services: application-gateway
author: vhorne
ms.service: application-gateway
ms.topic: article
ms.date: 11/14/2019
ms.author: absha
ms.openlocfilehash: 20f588639c54b0a8b7cd304f33b5a9d633a73be6
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80133045"
---
# <a name="create-certificates-to-allow-the-backend-with-azure-application-gateway"></a>Создание сертификатов, позволяющих резервному энду с помощью шлюза приложений Azure

Чтобы сделать от конца до конца TLS, Application Gateway требует, чтобы бэкэнд экземпляры были разрешены путем загрузки сертификатов аутентификации/доверенных корней. Для v1 SKU требуются сертификаты аутентификации, но для доверенных корневых сертификатов v2 SKU требуется, чтобы сертификаты.

Вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
>
> - Свидетельство об экспортной аутентификации из сертификата бэкэнда (для v1 SKU)
> - Экспортный доверенный корневой сертификат из сертификата бэкэнда (для v2 SKU)

## <a name="prerequisites"></a>Предварительные требования

Существующий сертификат бэкэнда необходим для создания сертификатов аутентификации или доверенных корневых сертификатов, необходимых для разрешения экземпляров бэкэнда с помощью шлюза приложения. Сертификат бэкэнда может быть таким же, как сертификат TLS/SSL, или другим для дополнительной безопасности. Приложение Gateway не предоставляет вам никакого механизма для создания или покупки сертификата TLS/SSL. Для целей тестирования можно создать сертификат с самим себе, но не следует использовать его для производственных нагрузок. 

## <a name="export-authentication-certificate-for-v1-sku"></a>Свидетельство о проверке подлинности экспорта (для v1 SKU)

Сертификат аутентификации требуется для того, чтобы резервные экземпляры в Application Gateway v1 SKU. Сертификат аутентификации является общедоступным ключом серверных сертификатов бэкэнда в закодированном X.509 Base-64(. CER) формат. В этом примере вы будете использовать сертификат TLS/SSL для сертификата бэкэнда и экспортировать его общедоступный ключ, который будет использоваться в качестве сертификата аутентификации. Кроме того, в этом примере вы будете использовать инструмент Менеджера сертификатов Windows для экспорта требуемых сертификатов. Вы можете использовать любой другой инструмент, который является удобным.

Из сертификата TLS/SSL экспортируйте открытый файл .cer (не частный ключ). Следующие шаги помогут экспортировать файл .cer в Закодированном X.509(. CER) формат для сертификата:

1. Чтобы получить из сертификата CER-файл, откройте раздел **Управление сертификатами пользователей**. Найдите сертификат, как правило, в "Сертификаты - Текущий пользователь /Личные сертификаты" и правой кнопкой мыши. Щелкните **Все задачи** > **Экспорт**. Откроется **мастера экспорта сертификатов**. Если не удается найти сертификат в разделе <текущий_пользователь>\Personal\Certificates, возможно, вы случайно открыли "Certificates — Local Computer"вместо "Certificates— <текущий_пользователь>". Если вы хотите открыть диспетчер сертификатов в области текущего пользователя с помощью PowerShell, выполните команду *certmgr* в окне консоли.

   ![Экспорт](./media/certificates-for-backend-authentication/export.png)

2. В окне мастера нажмите **Далее**.

   ![Экспорт сертификата](./media/certificates-for-backend-authentication/exportwizard.png)

3. Выберите **Нет, не экспортировать закрытый ключ** и снова нажмите кнопку **Далее**.

   ![Выбор параметра "Нет, не экспортировать закрытый ключ"](./media/certificates-for-backend-authentication/notprivatekey.png)

4. На странице **Формат экспортируемого файла** выберите **Файлы X.509 (.CER) в кодировке Base-64** и нажмите кнопку **Далее**.

   ![Выбор параметра "Файлы X.509 (.CER) в кодировке Base-64"](./media/certificates-for-backend-authentication/base64.png)

5. На странице **Имя экспортируемого файла** нажмите кнопку **Обзор**, чтобы перейти в расположение для экспорта сертификата. В поле **Имя файла**введите имя для файла сертификата. Затем нажмите кнопку **Далее**.

   ![Обзор](./media/certificates-for-backend-authentication/browse.png)

6. Нажмите кнопку **Готово**, чтобы выполнить экспорт сертификата.

   ![Готово](./media/certificates-for-backend-authentication/finish.png)

7. Сертификат успешно экспортирован.

   ![Успешно](./media/certificates-for-backend-authentication/success.png)

   Экспортированный сертификат выглядит примерно так:

   ![Экспортированный сертификат](./media/certificates-for-backend-authentication/exported.png)

8. Если открыть экспортированный сертификат в Блокноте, результат будет приблизительно таким, как в приведенном ниже примере. Раздел синим цветом содержит информацию, загруженную на шлюз приложения. Если вы открываете сертификат с блокнотом и он не похож на это, как правило, это означает, что вы не экспортировать его с помощью базы-64 закодирован Ы.509 (. CER) формат. Кроме того, при использовании другого текстового редактора следует учитывать, что в некоторых редакторах может выполняться непреднамеренное форматирование в фоновом режиме. Это может вызвать проблемы при передаче текста из этого сертификата в Azure.

   ![Открытие в Блокноте](./media/certificates-for-backend-authentication/format.png)

## <a name="export-trusted-root-certificate-for-v2-sku"></a>Экспортный доверенный корневой сертификат (для v2 SKU)

Доверенный корневой сертификат требуется для белого списка бэкэнд ассоциатовых экземпляров в приложении шлюз v2 SKU. Корневой сертификат — это закодированный X.509 Базы-64(. CER) корневой сертификат формата из серверных сертификатов бэкэнда. В этом примере мы будем использовать сертификат TLS/SSL для сертификата бэкэнда, экспортируем его общедоступный ключ, а затем экспортируем корневой сертификат доверенного CA из общедоступного ключа в закодированном формате base64 для получения надежного корневого сертификата. Промежуточный сертификат (ы) должен быть увязан с серверным сертификатом и установлен на сервере бэкэнда.

Следующие шаги помогут вам экспортировать файл .cer для вашего сертификата:

1. Используйте шаги 1-9, упомянутые в **разделе Экспортный сертификат аутентификации из сертификата бэкэнда (для v1 SKU)** выше, чтобы экспортировать открытый ключ из сертификата бэкэнда.

2. После того, как открытый ключ был экспортирован, откройте файл.

   ![Открытый сертификат авторизации](./media/certificates-for-backend-authentication/openAuthcert.png)

   ![о сертификате](./media/certificates-for-backend-authentication/general.png)

3. Перейдите к представлению Пути сертификации, чтобы просмотреть сертификационный орган.

   ![детали сертификата](./media/certificates-for-backend-authentication/certdetails.png)

4. Выберите корневой сертификат и нажмите на **Сертификат Просмотра.**

   ![cert путь](./media/certificates-for-backend-authentication/rootcert.png)

   Вы должны увидеть данные корневого сертификата.

   ![cert информация](./media/certificates-for-backend-authentication/rootcertdetails.png)

5. Перейдите к просмотру **деталей** и нажмите **Кнопка Копия файла...**

   ![копия корневой сертификат](./media/certificates-for-backend-authentication/rootcertcopytofile.png)

6. На этом этапе вы извлекли детали корневого сертификата из сертификата бэкэнда. Вы увидите **Мастера Экспорта Сертификата.** Теперь используйте шаги 2-9, упомянутые в **разделе Экспортный сертификат аутентификации из бэкэнд-сертификата (для v1 SKU)** выше, чтобы экспортировать доверенный корневой сертификат в Базе-64 закодированного X.509(. CER) формат.

## <a name="next-steps"></a>Дальнейшие действия

Теперь у вас есть сертификат аутентификации /доверенный корневой сертификат в Базе-64, закодированном X.509(. CER) формат. Вы можете добавить это к шлюзу приложения в белый список серверов бэкэнда для от ока до конца шифрования TLS. [См. Наверстную настройку до конца TLS с помощью шлюза приложений с PowerShell.](https://docs.microsoft.com/azure/application-gateway/application-gateway-end-to-end-ssl-powershell)

