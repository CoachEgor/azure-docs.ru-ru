---
title: Сертификаты, необходимые для серверных систем в список разрешений шлюза приложений Azure
description: Эта статья содержит примеры преобразования SSL-сертификат для сертификата проверки подлинности и доверенный корневой сертификат, которые необходимы для списка разрешенных экземпляров серверной части в шлюзе приложений Azure
services: application-gateway
author: abshamsft
ms.service: application-gateway
ms.topic: article
ms.date: 3/14/2019
ms.author: absha
ms.openlocfilehash: 72ee9123ad959c0c7240d4f7a906adc1a4dd1a93
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60831726"
---
# <a name="create-certificates-for-whitelisting-backend-with-azure-application-gateway"></a>Создание сертификатов для списка разрешенных серверной части шлюза приложений Azure

Для выполнения сквозного режима связи SSL, шлюзу приложений требуется экземплярами серверной части должен быть разрешен путем отправки проверки подлинности/доверенных корневых сертификатов. В случае v1 SKU, сертификатов проверки подлинности являются обязательными, тогда как в случае v2 SKU, доверенные корневые сертификаты необходимы для списка разрешенных сертификатов

В этой статье раскрываются следующие темы:

> [!div class="checklist"]
>
> - Экспорт сертификата проверки подлинности на основе сертификата серверной части (для номера SKU v1)
> - Экспортировать доверенный корневой сертификат из внутреннего сертификата (для номера SKU v2)

## <a name="prerequisites"></a>Технические условия

Требуется существующий сертификат серверной части для создания сертификатов проверки подлинности или доверенных корневых сертификатов, необходимых для списка разрешенных экземпляров серверной части с помощью шлюза приложений. Внутренний сертификат может быть то же, что SSL-сертификат или другой для повышения безопасности. Шлюз приложений не поддерживает любой механизм для создания или приобрести сертификат SSL. В целях тестирования можно создать самозаверяющий сертификат, но его не следует использовать для производственных рабочих нагрузок. 

## <a name="export-authentication-certificate-for-v1-sku"></a>Экспорт сертификата проверки подлинности (для номера SKU v1)

Сертификат проверки подлинности является обязательным в белый список серверных экземпляров в версии 1 приложения шлюза SKU. Сертификат проверки подлинности — открытый ключ сертификатов внутреннего сервера в кодировке Base64-кодировке X.509 (. Формат CER). В этом примере мы будет использовать SSL-сертификат для сертификата серверной части и экспортируйте свой открытый ключ, который будет служить сертификации для проверки подлинности. Кроме того в этом примере мы будем использовать средство диспетчера сертификатов Windows для экспорта требуемых сертификатов. Вы можете использовать любой другой инструмент, в соответствии с вашего удобства.

Из SSL-сертификата Экспорт открытого ключа CER-файл (а не закрытый ключ). Ниже показано, как экспортировать CER-файлу справки файл в кодировке Base64-кодировке X.509 (. Формат CER) для сертификата:

1. Чтобы получить из сертификата CER-файл, откройте раздел **Управление сертификатами пользователей**. Найдите сертификат, обычно в «Certificates - Current User\Personal\Certificates» и щелкните правой кнопкой мыши. Щелкните **Все задачи** > **Экспорт**. Откроется **мастера экспорта сертификатов**. Если не удается найти сертификат в разделе <текущий_пользователь>\Personal\Certificates, возможно, вы случайно открыли "Certificates — Local Computer"вместо "Certificates— <текущий_пользователь>". Если вы хотите открыть диспетчер сертификатов в области текущего пользователя с помощью PowerShell, выполните команду *certmgr* в окне консоли.

   ![Экспортировать](./media/certificates-for-backend-authentication/export.png)

2. В мастере нажмите кнопку **Далее**.

   ![Экспорт сертификата](./media/certificates-for-backend-authentication/exportwizard.png)

3. Выберите **Нет, не экспортировать закрытый ключ** и снова нажмите кнопку **Далее**.

   ![Выбор параметра "Нет, не экспортировать закрытый ключ"](./media/certificates-for-backend-authentication/notprivatekey.png)

4. На странице **Формат экспортируемого файла** выберите **Файлы X.509 (.CER) в кодировке Base-64** и нажмите кнопку **Далее**.

   ![Выбор параметра "Файлы X.509 (.CER) в кодировке Base-64"](./media/certificates-for-backend-authentication/base64.png)

5. На странице **Имя экспортируемого файла** нажмите кнопку **Обзор**, чтобы перейти в расположение для экспорта сертификата. В поле **Имя файла**введите имя для файла сертификата. Затем щелкните **Далее**.

   ![Обзор](./media/certificates-for-backend-authentication/browse.png)

6. Нажмите кнопку **Готово** , чтобы экспортировать сертификат.

   ![Завершить](./media/certificates-for-backend-authentication/finish.png)

7. Сертификат успешно экспортирован.

   ![Успешно](./media/certificates-for-backend-authentication/success.png)

   Экспортированный сертификат выглядит примерно так:

   ![Экспортированный сертификат](./media/certificates-for-backend-authentication/exported.png)

8. Если открыть экспортированный сертификат в Блокноте, результат будет приблизительно таким, как в приведенном ниже примере. Выделенный синим цветом раздел содержит сведения, который загружается в шлюз приложений. Если при открытии сертификата в Блокноте он не выглядит, как приведенный ниже пример, как правило, это означает, что экспорт выполнен не в формате X.509 (.CER) с кодировкой Base64. Кроме того, при использовании другого текстового редактора следует учитывать, что в некоторых редакторах может выполняться непреднамеренное форматирование в фоновом режиме. Это может вызвать проблемы при передаче текста из этого сертификата в Azure.

   ![Открытие в Блокноте](./media/certificates-for-backend-authentication/format.png)

## <a name="export-trusted-root-certificate-for-v2-sku"></a>Экспорт доверенного корневого сертификата (для номера SKU v2)

Доверенный корневой сертификат необходим для серверных экземпляров белый список в версии 2 для шлюза приложений SKU. — Корневой сертификат X.509 в кодировке Base-64 (. Формат CER) корневого сертификата из сертификатов внутреннего сервера. В этом примере мы будет использовать SSL-сертификат для сертификата серверной части, Экспорт открытого ключа и затем экспортировать корневой сертификат доверенного ЦС из открытого ключа в формате в кодировке base64, чтобы получить доверенный корневой сертификат. 

Чтобы экспортировать CER-файл для сертификата сделайте следующее:

1. Выполните шаги 1 – 9, описанный в разделе **экспорта сертификата проверки подлинности на основе сертификата серверной части (для номера SKU v1)** выше, чтобы экспортировать открытый ключ из сертификата серверной части.

2. После экспорта открытый ключ, откройте файл.

   ![Открытая авторизация сертификата](./media/certificates-for-backend-authentication/openAuthcert.png)

   ![о сертификате](./media/certificates-for-backend-authentication/general.png)

3. Переместите в путь сертификации представления центра сертификации.

   ![сведения о сертификате.](./media/certificates-for-backend-authentication/certdetails.png)

4. Выберите корневой сертификат и щелкнув **Просмотр сертификата**.

   ![путь сертификата](./media/certificates-for-backend-authentication/rootcert.png)

   Вы сможете просмотреть сведения о корневом сертификате.

   ![сведения о CERT](./media/certificates-for-backend-authentication/rootcertdetails.png)

5. Переместить **сведения** просмотра и нажмите кнопку **Копировать в файл...**

   ![копирование корневой сертификат](./media/certificates-for-backend-authentication/rootcertcopytofile.png)

6. На этом этапе извлекли данные корневого сертификата из серверной части сертификата. Вы увидите **мастер экспорта сертификатов**. Теперь используйте шаги 2 – 9, описанный в разделе **экспорта сертификата проверки подлинности на основе сертификата серверной части (для номера SKU v1)** выше Экспорт доверенного корневого сертификата в кодировке Base64-кодировке X.509 (. Формат CER).

## <a name="next-steps"></a>Дальнейшие действия

Теперь у вас есть сертификат/надежной проверки подлинности корневой сертификат в кодировке Base64-кодировке X.509 (. Формат CER). Это можно добавить в шлюз приложений в белый список внутренних серверов для сквозного шифрования SSL. См. в разделе [Настройка сквозного шифрования SSL](https://docs.microsoft.com/azure/application-gateway/application-gateway-end-to-end-ssl-powershell).