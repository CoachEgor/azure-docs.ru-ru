---
title: Настройка внутренней точки баланса нагрузки (ILB)
titleSuffix: Azure Application Gateway
description: В этой статье содержится информация о том, как настроить шлюз приложения с частным IP-адресом
services: application-gateway
author: abshamsft
ms.service: application-gateway
ms.topic: article
ms.date: 01/30/2020
ms.author: victorh
ms.openlocfilehash: 809274aba35e9607aeacf7c6483ec3d10f899667
ms.sourcegitcommit: 7e04a51363de29322de08d2c5024d97506937a60
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81312374"
---
# <a name="configure-an-application-gateway-with-an-internal-load-balancer-ilb-endpoint"></a>Настройка шлюза приложения с помощью внутренней точки балансировора нагрузки (ILB)

Шлюз приложений Azure можно настроить с помощью VIP-персоны с доступом к Интернету или с внутренней конечной точкой, которая не подвергается воздействию Интернета. Внутренняя конечная точка использует частный IP-адрес для прифронтовой, который также известен как *внутренняя конечная точка баланса нагрузки (ILB).*

Настройка шлюза с использованием прикрытого частного IP-адреса полезна для внутренних бизнес-приложений, которые не подвержены воздействию Интернета. Это также полезно для служб и уровней в многоуровневом приложении, которые находятся в границе безопасности, которая не подвергается воздействию Интернета, но по-прежнему требуют кругового распределения нагрузки, липкости сеанса или безопасности транспортного слоя (TLS), ранее известного как Безопасный слой розок (SSL), прекращение.

Эта статья проведет вас через шаги по настройке шлюза приложения с прифронтовым частным IP-адресом с помощью портала Azure.

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на портал Azure по адресу <https://portal.azure.com>.

## <a name="create-an-application-gateway"></a>Создание шлюза приложений

В Azure для обмена между создаваемыми ресурсами необходима виртуальная сеть. Вы можете создать новую виртуальную сеть или использовать существующую. В этом примере мы создадим виртуальную сеть. Вы можете создать виртуальную сеть во время создания шлюза приложений. Экземпляры Шлюза приложений создаются в отдельных подсетях. В этом примере создаются две подсети: одна — для шлюза приложений, а вторая — для внутренних серверов.

1. Расширьте меню портала и выберите **Создать ресурс.**
2. Щелкните **Сети**, а затем в списке "Рекомендованные" выберите **Шлюз приложений**.
3. Для имени шлюза приложений введите *myAppGateway*, а для новой группы ресурсов — *myResourceGroupAG*.
4. Для **региона,** выберите **(США) Центральная часть США.**
5. Для **уровня**, выберите **Стандарт**.
6. Под **настраивать виртуальную сеть** выберите **Создать новый,** а затем ввести эти значения для виртуальной сети:
   - *myVNet* — имя виртуальной сети;
   - *10.0.0.0/16* — диапазон адресов виртуальной сети;
   - *myAGSubnet* — имя подсети;
   - *10.0.0.0/24* — диапазон адресов подсети.
   - *myBackendSubnet* - для названия подсети бэкэнда.
   - *10.0.0.0/24* - для нижнего подсетевого адресного пространства.

    ![Создание виртуальной сети](./media/configure-application-gateway-with-private-frontend-ip/private-frontendip-1.png)

6. Нажмите кнопку **ОК**, чтобы создать виртуальную сеть и подсеть.
7. Выберите **Следующий:Фронтенды**.
8. Для **типа IP-адреса Frontend**выберите **Private**.

   По умолчанию это динамическое назначение IP-адреса. Первый доступный адрес настроенной подсети присваивается в качестве IP-адреса фронтового.
   > [!NOTE]
   > После выделения тип IP-адреса (статического или динамического) не может быть изменен позже.
9. Выберите **Следующий:Backends**.
10. Выберите **Добавить бэкэнд бассейн**.
11. Для **имени**, введите *приложениеGatewayBackendPool*.
12. Для **добавления бэкэнд абонек бассейн без целей,** выберите **Да**. Вы добавите цели позже.
13. Выберите **Добавить**.
14. Выберите **следующий:Конфигурация**.
15. В соответствии с **правилами реуктора,** **выберите Добавить правило.**
16. Для **названия правила,** типа *Rrule-01*.
17. Для **имени слушателя,** введите *Listener-01*.
18. Для **Frontend IP**, выберите **Частный**.
19. Примите оставшиеся значения по умолчанию и выберите вкладку **Backend targets.**
20. Для **типа Target**выберите пул **Backend,** а затем выберите **приложениеGatewayBackendPool.**
21. Для **настройки HTTP**выберите **Создать новый**.
22. Для **названия настройки HTTP,** введите *http-setting-01*.
23. Для **протокола Backend**выберите **HTTP**.
24. Для **порта Backend,** тип *80*.
25. Примите оставшиеся по умолчанию и **выберите Добавить**.
26. На странице **правила «Добавить правила»** выберите **Добавить.**
27. Выберите **далее: Теги**.
28. Выберите **далее: Обзор и создайте**.
29. Просмотрите настройки на странице резюме, а затем выберите **Создать** для создания сетевых ресурсов и шлюза приложения. Создание шлюза приложений может занять несколько минут. Дождитесь успешного завершения развертывания перед переходом к следующему разделу.

## <a name="add-backend-pool"></a>Добавление внутреннего пула

Серверный пул используется для перенаправления запросов на внутренние серверы, на которых обслуживается запрос. Бэкэнд может состоять из NICs, виртуальных наборов масштабов машин, общедоступных IP-адресов, внутренних IP-адресов, полностью квалифицированных доменных имен (ФЗДН) и мультитенантных бэк-эндов, таких как Azure App Service. В этом примере мы будем использовать виртуальные машины в качестве целевых объектов серверной части. Вы можете использовать существующие виртуальные машины или создать новые. В этом примере вы создадите две виртуальные машины, которые будут использоваться в Azure как внутренние серверы для шлюза приложений.

Для этого необходимо сделать следующее:

1. Создайте две новые виртуальные машины, *myVM* и *myVM2*, используемые в качестве серверов бэкэнда.
2. Установить службы IIS на виртуальных машинах, чтобы убедиться, что шлюз приложений успешно создан.
3. Добавить внутренние серверы к внутренним пулам.

### <a name="create-a-virtual-machine"></a>Создание виртуальной машины

1. Выберите **Создать ресурс**.
2. Выберите **вычислить,** а затем выберите **виртуальную машину.**
4. Введите следующие значения для виртуальной машины:
   - выберите *myResourceGroupAG* для **группы ресурсов**.
   - *myVM* - для **виртуальной машины имя**.
   - Выберите **Windows Server 2019 Центр обработки данных** для **изображения.**
   - *azureadmin* - для **имени пользователя**.
   - *Azure123456!* для **пароля**.
5. Примите оставшиеся по умолчанию и выберите **Следующий : Диски**.
6. Примите по умолчанию и выберите **Следующую : Сеть**.
7. Убедитесь, что выбрана виртуальная сеть **myVNet** и подсеть **myBackendSubnet**.
8. Примите оставшиеся по умолчанию и выберите **Далее: Управление.**
9. Нажмите кнопку **Отключить**, чтобы выключить диагностику загрузки.
10. Примите оставшиеся по умолчанию и выберите **Далее: Расширенный**.
11. Выберите **далее : Теги**.
12. Выберите **Далее : Обзор и создайте**.
13. Просмотрите параметры на странице сводки и нажмите кнопку **Создать**. Создание VM может занять несколько минут. Дождитесь успешного завершения развертывания перед переходом к следующему разделу.

### <a name="install-iis"></a>Установка служб IIS

1. Откройте облачную оболочку и убедитесь, что она установлена на **PowerShell.**
    ![частный фронтендип-3](./media/configure-application-gateway-with-private-frontend-ip/private-frontendip-3.png)
2. Чтобы установить службы IIS, выполните на виртуальной машине следующие команды:

   ```azurepowershell
   Set-AzVMExtension `
   
     -ResourceGroupName myResourceGroupAG `
   
     -ExtensionName IIS `
   
     -VMName myVM `
   
     -Publisher Microsoft.Compute `
   
     -ExtensionType CustomScriptExtension `
   
     -TypeHandlerVersion 1.4 `

     -SettingString '{"commandToExecute":"powershell Add-WindowsFeature Web-Server; powershell Add-Content -Path \"C:\\inetpub\\wwwroot\\Default.htm\" -Value $($env:computername)"}' `

     -Location CentralUS `

   ```



3. Создайте вторую виртуальную машину и установите службы IIS, следуя только что выполненным инструкциям. Введите myVM2 в качестве имени виртуальной машины и значения параметра VMName в команде Set-AzVMExtension.

### <a name="add-backend-servers-to-backend-pool"></a>Добавление серверов во внутренние пулы

1. Выберите **все ресурсы,** а затем выберите **myAppGateway**.
2. Выберите **Серверные пулы**. Выберите **приложениеGatewayBackendPool**.
3. Под **типом цели** выберите **Виртуальную машину** и под **целью**, выберите vNIC, связанный с myVM.
4. Повторите, чтобы добавить MyVM2.
   ![частный фронтендип-4](./media/configure-application-gateway-with-private-frontend-ip/private-frontendip-4.png)
5. выберите **Сохранить.**

## <a name="test-the-application-gateway"></a>Тестирование шлюза приложений

1. Проверьте свой фронтальный IP, который был назначен, нажав на страницу **Frontend IP Configurations** на портале.
    ![частный фронтендип-5](./media/configure-application-gateway-with-private-frontend-ip/private-frontendip-5.png)
2. Копируйте личный IP-адрес, а затем вставьте его в панель адресов браузера в VM в том же VNet или на месте, которое имеет подключение к этому VNet и попытаться получить доступ к шлюзу приложения.

## <a name="next-steps"></a>Следующие шаги

Если вы хотите следить за работоспособностью бэкэнда, см. [журналы здоровья и диагностики Back-end для Gateway приложения.](application-gateway-diagnostics.md)
