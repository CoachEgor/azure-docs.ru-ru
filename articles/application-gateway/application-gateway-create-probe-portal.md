---
title: Создание пользовательского зонда с помощью портала
titleSuffix: Azure Application Gateway
description: Узнайте, как создать пользовательскую пробу для шлюза приложений с помощью портала.
services: application-gateway
author: vhorne
ms.service: application-gateway
ms.topic: article
ms.date: 11/14/2019
ms.author: victorh
ms.openlocfilehash: 15daf47a1cb44635932311e60b3690af9ff58677
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "74074603"
---
# <a name="create-a-custom-probe-for-application-gateway-by-using-the-portal"></a>Создание пользовательской пробы для шлюза приложений с помощью портала

> [!div class="op_single_selector"]
> * [Портал Azure](application-gateway-create-probe-portal.md)
> * [PowerShell и диспетчер ресурсов Azure](application-gateway-create-probe-ps.md)
> * [Azure Классический PowerShell](application-gateway-create-probe-classic-ps.md)

В этой статье вы добавляете пользовательский зонд работоспособности к существующему шлюзу приложения через портал Azure. Используя зонды работоспособности, Azure Application Gateway отслеживает работоспособность ресурсов в пуле бэк-энда.

## <a name="before-you-begin"></a>Перед началом

Если у вас нет шлюза приложений, ознакомьтесь с [этой статьей](application-gateway-create-gateway-portal.md), чтобы создать его.

## <a name="create-probe-for-application-gateway-v2-sku"></a>Создание зонда для приложения шлюз v2 SKU

На портале пробы настраиваются в два этапа. Первым шагом является ввод значений, необходимых для конфигурации зонда. На втором этапе вы тестируете работоспособность бэкэнда с помощью этой конфигурации зонда и сохраняете зонд. 

### <a name="enter-probe-properties"></a><a name="createprobe"></a>Введите свойства зонда

1. Войдите на [портал Azure](https://portal.azure.com). Если у вас еще нет учетной записи, вы можете подписаться на [бесплатную пробную версию на один месяц](https://azure.microsoft.com/free)

2. На портале Azure в области "Избранное" щелкните "Все ресурсы". Выберите шлюз приложений в колонке "Все ресурсы". Если выбранная подписка имеет несколько ресурсов, в поле "Фильтровать по имени..." введите partners.contoso.net, чтобы быстро получить доступ к необходимому шлюзу приложений.

3. Выберите **зонды здоровья,** а затем выберите **Добавить,** чтобы добавить новый зонд здоровья.

   ![Добавить новый зонд][4]

4. На странице **зонда «Добавить здоровье»** заполните необходимую информацию для зонда, а при завершении выберите **OK.**

   |**Параметр** | **Значение** | **Подробно**|
   |---|---|---|
   |**Название**|customProbe|Это значение является дружественным именем, данное зонду, который доступен на портале.|
   |**Протокол**|HTTP или HTTPS | Протокол, используемый пробой работоспособности. |
   |**Узел**|Например, contoso.com|Это значение — это имя виртуального хоста (отличается от имени хоста VM), работаемого на сервере приложения. Зонд отправляется в (протокол):/(имя хозяина):(порт от httpsetting)/urlPath.  Это применимо, когда мультисайт настроен на шлюзе приложения. Если шлюз приложения настроен для одного сайта, введите '127.0.0.1'.|
   |**Выберите имя хоста из настроек бэкэнда HTTP**|"Да" или "Нет".|Устанавливает заголовок *узла* в зонде на имя хоста бэк-энда ресурса в пуле бэк-энда, связанном с настройкой HTTP, с которой связан этот зонд. Специально требуется в случае мультитенантных бэкэндов, таких как служба приложений Azure. [Дополнительные сведения](https://docs.microsoft.com/azure/application-gateway/configuration-overview#pick-host-name-from-back-end-address)|
   |**Путь**|/ или другой путь|Остальная часть полного URL-адреса пользовательской пробы. Путь должен начинаться с /. Для пути по умолчанию http:\//contoso.com просто используйте '/' |
   |**Интервал (с)**|30|Интервал между выполнением проб работоспособности. Не рекомендуется задавать значение менее 30 секунд.|
   |**Время ожидания (с)**|30|Количество времени зонд ждет до времени. Если действительный ответ не получен в течение этого периода тайм-аута, зонд помечается как неудачный. Интервал времени ожидания должен быть достаточно большим для выполнения HTTP-вызова, чтобы обеспечить доступность страницы с данными о работоспособности внутреннего сервера. Обратите внимание, что значение тайм-аута не должно быть больше, чем значение «Interval», используемое в этой настройке зонда, или значение тайм-аута «Запрос» в настройке HTTP, которое будет связано с этим зондом.|
|**Нездоровый порог**|3|Количество последовательных неудачных попыток, которые будут считаться нездоровыми. Порог может быть установлен на 1 или более.|
   |**Использование условий сопоставления зонда**|"Да" или "Нет".|По умолчанию ответ HTTP (S) со кодом состояния между 200 и 399 считается здоровым. Можно изменить допустимый диапазон кода ответа бэкэнда или тела бэкэнд-ответа. [Дополнительные сведения](https://docs.microsoft.com/azure/application-gateway/application-gateway-probe-overview#probe-matching)|
   |**Настройки HTTP**|выбор из выпадения|Зонд будет связан с выбранной здесь настройкой HTTP(s), и, следовательно, будет следить за работоспособностью этого бэкэнд-пула, который связан с выбранным параметром HTTP. Он будет использовать тот же порт для запроса зонда, что и тот, который используется в выбранной настройке HTTP. Вы можете выбрать только те настройки HTTP (ы), которые не связаны с любым другим пользовательским зондом. <br>Обратите внимание, что только те настройки HTTP (ы) доступны для ассоциации, которые имеют тот же протокол, что и протокол, выбранный в этой конфигурации зонда, и имеют то же состояние для *названия выбора хоста тока от переключателя настройки Backend HTTP.*|
   
   > [!IMPORTANT]
   > Зонд будет следить за работоспособностью бэкэнда только тогда, когда он связан с одним или более http Setting(ы). Он будет следить за бэк-энд ресурсами тех бэк-энд бассейнов, которые связаны с настройками HTTP (ы), с которыми этот зонд связан с. Запрос зонда будет отправлен на http://(имя хозяина):(порт от httpsetting)/urlPath.

### <a name="test-backend-health-with-the-probe"></a>Тест бэкэнд здоровья с зондом

После ввода свойств зонда можно проверить работоспособность ресурсов бэк-энда, чтобы убедиться, что конфигурация зонда верна и что ресурсы бэк-энда работают как ожидалось.

1. Выберите **тест** и обратите внимание на результат зонда. Шлюз приложения проверяет работоспособность всех ресурсов бэкэнда в пулах бэкэнда, связанных с настройками HTTP (ы), используемыми для этого зонда. 

   ![Тест бэкэнд ассока][5]

2. Если есть какие-либо неработоспособные ресурсы бэкэнда, проверьте столбец **«Детали»,** чтобы понять причину неработоспособного состояния ресурса. Если ресурс был помечен неработоспособным из-за неправильной конфигурации зонда, выберите **ссылку "Перейти к зонду"** и отспособить конфигурацию зонда. В противном случае, если ресурс был отмечен нездоровым из-за проблемы с бэкэндом, затем решить проблемы с бэкэнд ресурсом, а затем проверить бэкэнд снова, выбрав **Вернуться к зонду** ссылку и выбрать **тест.**

   > [!NOTE]
   > Вы можете сохранить зонд даже с нездоровыми ресурсами бэкэнда, но это не рекомендуется. Это связано с тем, что шлюз приложения удаляет ресурсы бэкэнда из пула бэкэнда, которые, как установлено, нездоровы зондом. В случае, если в пуле бэкэнда нет здоровых ресурсов, вы не сможете получить доступ к приложению и получите ошибку 502.

   ![Просмотр результата зонда][6]

3. Выберите **Добавить,** чтобы сохранить зонд. 

## <a name="create-probe-for-application-gateway-v1-sku"></a>Создание зонда для приложения шлюз v1 SKU

На портале пробы настраиваются в два этапа. Сначала нужно создать пробу. Затем следует добавить ее в параметры протокола HTTP серверной части приложения шлюза.

### <a name="create-the-probe"></a><a name="createprobe"></a>Создание зонда

1. Войдите на [портал Azure](https://portal.azure.com). Если у вас еще нет учетной записи, вы можете подписаться на [бесплатную пробную версию на один месяц](https://azure.microsoft.com/free)

2. На портале Azure в области Избранное выберите **Все ресурсы**. Выберите шлюз приложения на странице **«Все ресурсы».** Если выбранная подписка имеет несколько ресурсов, в поле "Фильтровать по имени..." введите partners.contoso.net, чтобы быстро получить доступ к необходимому шлюзу приложений.

3. Выберите **зонды,** а затем выберите **Добавить,** чтобы добавить зонд.

   ![Колонка добавления пробы с заполненной информацией][1]

4. На лезвии **зонда Добавить здоровье,** заполнить необходимую информацию для зонда, и при полной выберите **OK**.

   |**Параметр** | **Значение** | **Подробно**|
   |---|---|---|
   |**Название**|customProbe|Это значение является дружественным именем, данное зонду, который доступен на портале.|
   |**Протокол**|HTTP или HTTPS | Протокол, используемый пробой работоспособности. |
   |**Узел**|Например, contoso.com|Это значение — это имя виртуального хоста (отличается от имени хоста VM), работаемого на сервере приложения. Зонд отправляется в (протокол):/(имя хозяина):(порт от httpsetting)/urlPath.  Это применимо, когда мультисайт настроен на шлюзе приложения. Если шлюз приложения настроен для одного сайта, введите '127.0.0.1'.|
   |**Выберите имя хоста из настроек бэкэнда HTTP**|"Да" или "Нет".|Устанавливает заголовок *узла* в зонде на имя хоста бэк-энда ресурса в пуле бэк-энда, связанном с настройкой HTTP, с которой связан этот зонд. Специально требуется в случае мультитенантных бэкэндов, таких как служба приложений Azure. [Дополнительные сведения](https://docs.microsoft.com/azure/application-gateway/configuration-overview#pick-host-name-from-back-end-address)|
   |**Путь**|/ или другой путь|Остальная часть полного URL-адреса пользовательской пробы. Путь должен начинаться с /. Для пути по умолчанию http:\//contoso.com просто используйте '/' |
   |**Интервал (с)**|30|Интервал между выполнением проб работоспособности. Не рекомендуется задавать значение менее 30 секунд.|
   |**Время ожидания (с)**|30|Количество времени зонд ждет до времени. Если действительный ответ не получен в течение этого периода тайм-аута, зонд помечается как неудачный. Интервал времени ожидания должен быть достаточно большим для выполнения HTTP-вызова, чтобы обеспечить доступность страницы с данными о работоспособности внутреннего сервера. Обратите внимание, что значение тайм-аута не должно быть больше, чем значение «Interval», используемое в этой настройке зонда, или значение тайм-аута «Запрос» в настройке HTTP, которое будет связано с этим зондом.|
|**Нездоровый порог**|3|Количество последовательных неудачных попыток, которые будут считаться нездоровыми. Порог может быть установлен на 1 или более.|
   |**Использование условий сопоставления зонда**|"Да" или "Нет".|По умолчанию ответ HTTP (S) со кодом состояния между 200 и 399 считается здоровым. Можно изменить допустимый диапазон кода ответа бэкэнда или тела бэкэнд-ответа. [Дополнительные сведения](https://docs.microsoft.com/azure/application-gateway/application-gateway-probe-overview#probe-matching)|

   > [!IMPORTANT]
   > Имя узла не является именем сервера. Это имя виртуального узла, который выполняется на сервере приложений. Проба отправляется по адресу http://(имя_узла):(порт_из_параметров_HTTP)/urlPath.

### <a name="add-probe-to-the-gateway"></a>Добавление пробы в шлюз

После создания пробы пора добавить ее в шлюз. Настройки пробы задаются в параметрах протокола HTTP серверной части приложения шлюза.

1. Щелкните **Настройки HTTP** для шлюза приложения и откройте колонку конфигурации, выбрав текущие параметры HTTP серверной части в окне.

   ![Окно параметров HTTPS][2]

2. На странице настроек **appGatewayBackEndHttpSettings** проверьте пользовательский флажок **зонда и** выберите зонд, созданный в разделе [«Создание зонда»](#createprobe) на **custom probe** drop-down.
   По завершении нажмите кнопку **Сохранить**, и параметры будут применены.

## <a name="next-steps"></a>Дальнейшие действия

Просмотр работоспособности ресурсов бэкэнда, определяемый зондом с помощью [представления о здоровье бэкэнда.](https://docs.microsoft.com/azure/application-gateway/application-gateway-diagnostics#back-end-health)

[1]: ./media/application-gateway-create-probe-portal/figure1.png
[2]: ./media/application-gateway-create-probe-portal/figure2.png
[4]: ./media/application-gateway-create-probe-portal/figure4.png
[5]: ./media/application-gateway-create-probe-portal/figure5.png
[6]: ./media/application-gateway-create-probe-portal/figure6.png
