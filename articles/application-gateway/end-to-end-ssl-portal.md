---
title: Настройка сквозного шифрования TLS с помощью портала
titleSuffix: Azure Application Gateway
description: Узнайте, как использовать портал Azure для создания шлюза приложения с сквозным шифрованием TLS.
services: application-gateway
author: vhorne
ms.service: application-gateway
ms.topic: article
ms.date: 11/14/2019
ms.author: absha
ms.custom: mvc
ms.openlocfilehash: 6f86f32e64bbbe79ea5a403d04f7d6c29ee6b980
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80133012"
---
# <a name="configure-end-to-end-tls-by-using-application-gateway-with-the-portal"></a>Настройка сквозного TLS с помощью шлюза приложения с помощью портала

В этой статье описывается, как использовать портал Azure для настройки сквозного шифрования безопасности транспортного уровня (TLS), ранее известного как шифрование Безопасных разъемов (SSL) через Azure Application Gateway v1 SKU.

> [!NOTE]
> Application Gateway v2 SKU требует надежных корневых сертификатов для обеспечения сквозной конфигурации.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="before-you-begin"></a>Перед началом

Для настройки сквозного TLS с помощью шлюза приложения необходим сертификат для шлюза. Сертификаты также необходимы для серверов бэк-энда. Сертификат шлюза используется для получения симметричного ключа в соответствии со спецификацией протокола TLS. Затем симметричный ключ используется для шифрования и расшифровки трафика, отправленного на шлюз. 

Для сквозного шифрования TLS в шлюзе приложения должны быть разрешены правые серверы. Чтобы обеспечить такой доступ, загрузите в шлюз приложения общедоступный сертификат серверов бэк-энда, также известный как сертификаты аутентификации (v1) или Trusted Root Certificates (v2). Добавление сертификата гарантирует, что шлюз приложения общается только с известными экземплярами бэк-энда. Эта конфигурация обеспечивает дальнейшую связь.

Чтобы узнать больше, смотрите [Обзор прекращения TLS и окончание до конца TLS с помощью шлюза приложений.](https://docs.microsoft.com/azure/application-gateway/ssl-overview)

## <a name="create-a-new-application-gateway-with-end-to-end-tls"></a>Создание нового шлюза приложений с сквозным TLS

Чтобы создать новый шлюз приложения с сквозным шифрованием TLS, необходимо сначала включить прекращение TLS при создании нового шлюза приложения. Это действие позволяет шифрование TLS для связи между клиентом и шлюзом приложения. Затем необходимо разместить в списке Safe Recipients сертификаты для серверов бэк-энда в настройках HTTP. Эта конфигурация позволяет шифрование TLS для связи между шлюзом приложения и серверами бэк-энда. Это выполняет сквозное шифрование TLS.

### <a name="enable-tls-termination-while-creating-a-new-application-gateway"></a>Включить прекращение TLS при создании нового шлюза приложений

Чтобы узнать больше, [см. включить tLS прекращения при создании нового шлюза приложения.](https://docs.microsoft.com/azure/application-gateway/create-ssl-portal)

### <a name="add-authenticationroot-certificates-of-back-end-servers"></a>Добавление сертификатов аутентификации/корней серверов бэк-энда

1. Выберите **все ресурсы,** а затем выберите **myAppGateway**.

2. Выберите **параметры HTTP** из меню слева. Azure автоматически создал настройку HTTP по умолчанию, **appGatewayBackendHttpSettings,** когда вы создали шлюз приложения. 

3. Выберите **приложениеGatewayBackendHttpSettings**.

4. В соответствии с **протоколом,** выберите **HTTPS**. Появляется панель для **сертификатов проверки подлинности Backend или сертификатов Trusted root.**

5. Выберите **Создать**.

6. В поле **Name** введите подходящее имя.

7. Выберите файл сертификата в окне **сертификата Upload CER.**

   Для шлюзов приложений Standard и WAF (v1) следует загрузить общедоступный ключ сертификата сервера в формате .cer.

   ![Добавление сертификата](./media/end-to-end-ssl-portal/addcert.png)

   Для Standard_v2 и WAF_v2 шлюзов приложений следует загрузить корневой сертификат сервера в формате .cer. Если сертификат бэк-энда выдан известным сертификационным органом (CA), вы можете выбрать флажок **сертификата Use Well Known CA,** и тогда вам не придется загружать сертификат.

   ![Добавление надежного корневого сертификата](./media/end-to-end-ssl-portal/trustedrootcert-portal.png)

   ![Корневой сертификат](./media/end-to-end-ssl-portal/trustedrootcert.png)

8. Нажмите кнопку **Сохранить**.

## <a name="enable-end-to-end-tls-for-an-existing-application-gateway"></a>Включить сквозной TLS для существующего шлюза приложений

Чтобы настроить существующий шлюз приложения с помощью сквозного шифрования TLS, необходимо сначала включить прекращение TLS в слушателе. Это действие позволяет шифрование TLS для связи между клиентом и шлюзом приложения. Затем поместите эти сертификаты для серверов бэк-энда в настройки HTTP в списке безопасных получателей. Эта конфигурация позволяет шифрование TLS для связи между шлюзом приложения и серверами бэк-энда. Это выполняет сквозное шифрование TLS.

Вам нужно будет использовать слушателя с протоколом HTTPS и сертификатом для обеспечения прекращения TLS. Вы можете использовать существующий слушатель, который отвечает этим условиям или создать нового слушателя. Если вы выберете первый вариант, можно проигнорировать следующее раздела "Включить прекращение TLS в существующем шлюзе приложения" и перейти непосредственно к разделу "Добавить сертификаты аутентификации/доверенных корней для серверов бэкэнда".

Если вы выберете последний вариант, примените шаги в следующей процедуре.
### <a name="enable-tls-termination-in-an-existing-application-gateway"></a>Включить прекращение TLS в существующем шлюзе приложения

1. Выберите **все ресурсы,** а затем выберите **myAppGateway**.

2. Выберите **Слушателей** из меню слева.

3. Выберите слушателя **Basic** или **Multi-site** в зависимости от ваших требований.

4. В соответствии с **протоколом,** выберите **HTTPS**. Появляется панель **сертификата.**

5. Загрузите сертификат PFX, который вы собираетесь использовать для прекращения TLS между клиентом и шлюзом приложения.

   > [!NOTE]
   > Для целей тестирования можно использовать сертификат, подписанный самостоятельно. Тем не менее, это не рекомендуется для производственных нагрузок, потому что они сложнее управлять и не являются полностью безопасными. Для получения дополнительной [create a self-signed certificate](https://docs.microsoft.com/azure/application-gateway/create-ssl-portal#create-a-self-signed-certificate)информации см.

6. Добавьте другие необходимые настройки для **слушателя**в зависимости от ваших требований.

7. Нажмите кнопку **ОК**, чтобы сохранить введенные данные.

### <a name="add-authenticationtrusted-root-certificates-of-back-end-servers"></a>Добавление сертификатов аутентификации/доверенных корневых сертификатов серверов бэк-энда

1. Выберите **все ресурсы,** а затем выберите **myAppGateway**.

2. Выберите **параметры HTTP** из меню слева. Сертификаты можно поместить в существующую настройку HTTP на бэк-энде в список безопасных получателей или создать новую настройку HTTP. (На следующем этапе сертификат для настройки HTTP по умолчанию, **appGatewayBackendHttpSettings,** добавляется в список безопасных получателей.)

3. Выберите **приложениеGatewayBackendHttpSettings**.

4. В соответствии с **протоколом,** выберите **HTTPS**. Появляется панель для **сертификатов проверки подлинности Backend или сертификатов Trusted root.** 

5. Выберите **Создать**.

6. В поле **Name** введите подходящее имя.

7. Выберите файл сертификата в окне **сертификата Upload CER.**

   Для шлюзов приложений Standard и WAF (v1) следует загрузить общедоступный ключ сертификата сервера в формате .cer.

   ![Добавление сертификата](./media/end-to-end-ssl-portal/addcert.png)

   Для Standard_v2 и WAF_v2 шлюзов приложений следует загрузить корневой сертификат сервера в формате .cer. Если сертификат бэк-энда выдан известным ЦС, вы можете выбрать флажок **сертификата Use Well Known CA,** и тогда вам не придется загружать сертификат.

   ![Добавление надежного корневого сертификата](./media/end-to-end-ssl-portal/trustedrootcert-portal.png)

8. Нажмите кнопку **Сохранить**.

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Управление веб-трафиком с помощью шлюза приложений и Azure CLI](./tutorial-manage-web-traffic-cli.md)
