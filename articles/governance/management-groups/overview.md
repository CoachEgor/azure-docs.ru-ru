---
title: Упорядочивание ресурсов с помощью групп управления (Система управления Azure)
description: Сведения о группах управления и способах их использования, а также о том, как работают разрешения.
author: rthorn17
ms.assetid: 482191ac-147e-4eb6-9655-c40c13846672
ms.service: governance
ms.date: 04/22/2019
ms.author: rithorn
ms.topic: overview
ms.openlocfilehash: aa4c5a7bfe7333c02fe79612b828df5680b83b26
ms.sourcegitcommit: 1c2659ab26619658799442a6e7604f3c66307a89
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/10/2019
ms.locfileid: "72254730"
---
# <a name="organize-your-resources-with-azure-management-groups"></a>Упорядочивание ресурсов с помощью групп управления Azure

Если в вашей организации оформлено много подписок, возможно, потребуется повысить эффективность управления доступом, политиками и соответствием требованиям для этих подписок. Группы управления Azure обеспечивают высокий уровень охвата подписок. Подписки упорядочиваются в контейнеры, которые называются группами управления. К ним применяются условия системы управления. Все подписки в группе управления автоматически наследуют условия, применяемые к группе управления. Группы управления обеспечивают корпоративное управление в больших масштабах независимо от типа подписки. Все подписки в одной группе управления должны доверять одному и тому же клиенту Azure Active Directory.

Например, вы можете применить политики к группе управления, которая ограничивает регионы, где можно создать виртуальную машину. Эта политика будет применяться ко всем группам управления, подпискам и ресурсам в этой группе управления, разрешая создавать виртуальные машины только в этом регионе.

## <a name="hierarchy-of-management-groups-and-subscriptions"></a>Иерархия групп управления и подписок

Вы можете создать гибкую структуру групп управления и подписок для упорядочивания своих ресурсов в иерархию для унифицированного управления политикой и доступом. На следующей схеме показано, как создать иерархию управления с использованием групп управления.

![Пример иерархического дерева группы управления](./media/tree.png)

Вы можете создать иерархию, чтобы применить политику, например разрешить группе управления "Рабочая среда" создавать виртуальные машины только в регионе "Западная часть США". Эта политика будет наследоваться в обеих подписках EA в этой группе управления и применяться ко всем виртуальным машинам в этих подписках. Владелец ресурса или подписки не может изменить эту политику, что улучшает функции управления.

Еще один сценарий, в котором можно использовать группы управления, — предоставление пользователю доступа к нескольким подпискам. Перемещая несколько подписок в пределах одной группы управления, вы можете создать одно назначение [RBAC](../../role-based-access-control/overview.md) (управление доступом на основе ролей) в этой группе управления, которая унаследует доступ ко всем нужным подпискам.
Не нужно создавать скрипты назначений RBAC для разных подписок. Вместо этого вы можете разрешить пользователям доступ к необходимым ресурсам с помощью одного назначения в группе управления.

### <a name="important-facts-about-management-groups"></a>Важные сведения о группах управления

- Один каталог может поддерживать 10 000 групп управления.
- Дерево группы управления может поддерживать до шести уровней глубины.
  - Это ограничение не включает уровень корня или подписки.
- Каждая группа управления и подписка может поддерживать только одну родительскую группу.
- Каждая группа управления может содержать несколько дочерних групп.
- Все группы управления и подписки включены в иерархию в каждом каталоге. См. [важные сведения о корневой группе управления](#important-facts-about-the-root-management-group).

## <a name="root-management-group-for-each-directory"></a>Корневая группа управления для каждого каталога

Каждому каталогу присваивается одна группа управления верхнего уровня, которая называется корневой группой управления.
Эта группа встроена в иерархию, чтобы в нее входили все группы управления и подписки. Она позволяет применять глобальные политики и назначения ролей RBAC на уровне каталогов. [Глобальному администратору Azure AD нужно повысить привилегии](../../role-based-access-control/elevate-access-global-admin.md) до роли администратора доступа пользователей, чтобы он изначально был владельцем этой корневой группы управления. После повышения привилегий администратор сможет назначить любую роль RBAC другим пользователям или группам в каталоге для управления иерархией. Как администратор вы можете назначить собственную учетную запись от имени владельца корневой группы управления.

### <a name="important-facts-about-the-root-management-group"></a>Важные сведения о корневой группе управления

- По умолчанию отображаемое имя корневой группы управления — это имя **корневой группы клиента**. В качестве идентификатора используется идентификатор Azure Active Directory.
- Чтобы изменить отображаемое имя, учетной записи необходимо назначить роль владельца или участника в корневой группе управления. Инструкции см. в разделе об [изменении имени группы управления](manage.md#change-the-name-of-a-management-group).
- Корневую группу управления нельзя переместить или удалить, в отличие от других групп управления.  
- Все группы управления и подписки добавляются в единую корневую группу управления в каталоге.
  - Все ресурсы в каталоге добавляются в корневую группу управления для глобального управления.
  - Новые подписки автоматически попадают в корневую группу управления при создании.
- Все клиенты Azure могут видеть корневую группу управления, но не у всех клиентов есть доступ к управлению этой корневой группой управления.
  - Все, кто имеет доступ к подписке, могут видеть контекст расположения подписки в иерархии.  
  - Никто не получает доступ к корневой группе управления по умолчанию. Только глобальные администраторы Azure AD могут повысить свои права для получения доступа.  Получив доступ к корневой группе управления, глобальные администраторы могут назначить любую роль RBAC другим пользователям для управления.  

> [!IMPORTANT]
> Любое назначение доступа или политики в корневой группе управления **применяется ко всем ресурсам в каталоге**.
> Поэтому все клиенты должны оценивать необходимость определения элементов в этой области.
> Доступ для пользователей или назначения политики должны быть обязательными только в этой области.  

## <a name="initial-setup-of-management-groups"></a>Начальная настройка групп управления

Когда любой пользователь начинает использовать группы управления, выполняется начальная настройка. Сначала в каталоге создается корневая группа управления. После создания этой группы все существующие подписки из каталога становятся дочерними элементами корневой группы управления. Это делается для того, чтобы в каталоге существовала только одна иерархия групп управления. Одна иерархия в каталоге позволяет административным клиентам применять глобальный доступ и политики, которые другие клиенты в каталоге не могут обойти. Все назначенные в корневой группе элементы будут распространяться на всю иерархию, включая все группы управления, подписки, группы ресурсов и ресурсы в арендаторе Azure AD.

## <a name="trouble-seeing-all-subscriptions"></a>Проблемы с отображением всех подписок

В некоторых каталогах, для которых группы управления использовались на раннем этапе предварительной версии до 25 июня 2018 г., может возникнуть проблема, когда не все подписки входят в иерархию. Это связано с тем, что все подписки были перемещены в иерархию после назначения роли или политики в корневой группе управления в каталоге. 

### <a name="how-to-resolve-the-issue"></a>Способы устранения проблемы

Устранить эту проблему можно двумя способами.

1. Удалить все назначения ролей и политик из корневой группы управления.
   1. Если удалить все назначения политик и ролей из корневой группы управления, служба снова заполнит все подписки в иерархии в следующем цикле.  Это позволяет проверить, не был ли случайно предоставлен доступ ко всем подпискам клиентов или назначена политика всем подпискам клиентов.
   1. Чтобы выполнить эту проверку без влияния на работу служб, лучше всего применить назначения ролей или политик на один уровень ниже корневой группы управления. После этого можно удалить все назначения из корневой области.
1. Вызвать API напрямую, чтобы начать процесс обратного заполнения.
   1. Любой клиент в каталоге может вызвать API *TenantBackfillStatusRequest* или *StartTenantBackfillRequest*. Если вызвать API StartTenantBackfillRequest, запустится процесс начальной настройки для перемещения всех подписок в иерархию. В рамках этого процесса также все новые подписки принудительно назначаются в качестве дочерних для корневой группы управления. Это можно сделать, не изменяя назначения на корневом уровне. Вызывая API, вы соглашаетесь с тем, что любое назначение политики или доступа будет применяться ко всем подпискам.

Если у вас есть вопросы о процессе обратного заполнения, свяжитесь с нами: managementgroups@microsoft.com  
  
## <a name="management-group-access"></a>Доступ к группе управления

Группы управления Azure поддерживают [управление доступом на основе ролей в Azure (RBAC)](../../role-based-access-control/overview.md) для любого доступа к ресурсам и определения ролей.
Эти разрешения наследуются дочерними ресурсами, которые есть в иерархии. Любую встроенную роль RBAC можно назначить группе управления, которая будет наследовать вниз по иерархии к ресурсам.
Например, группе управления можно назначить роль RBAC участника виртуальной машины. Эта роль не имеет действий в группе управления, но будет наследоваться для всех виртуальных машин в этой группе управления.

В следующей таблице приводится список ролей и доступных действий в группах управления.

| Роль RBAC             | Создание | Переименование | Перемещение** | Удаление | Назначение доступа | Назначение политики | Чтение  |
|:-------------------------- |:------:|:------:|:------:|:------:|:-------------:| :------------:|:-----:|
|Владелец                       | X      | X      | X      | X      | X             | X             | X     |
|Участник                 | X      | X      | X      | X      |               |               | X     |
|Участник группы управления*             | X      | X      | X      | X      |               |               | X     |
|Читатель                      |        |        |        |        |               |               | X     |
|Читатель группы управления*                  |        |        |        |        |               |               | X     |
|Участник политики ресурсов |        |        |        |        |               | X             |       |
|Администратор доступа пользователей   |        |        |        |        | X             | X             |       |

\* Роли участника и читателя группы управления позволяют выполнять указанные выше действия только в области действия группы управления.  
** Чтобы переместить подписку или группу управления в корневую группу управления или из нее, в корневой группе не требуется назначать роли.  Сведения о перемещении элементов в пределах иерархии см. в статье [Manage your resources with management groups](manage.md) (Управление ресурсами с помощью групп управления).

### <a name="custom-rbac-role-definition-and-assignment"></a>Пользовательское определение и назначение роли RBAC

В настоящее время настраиваемые роли RBAC не поддерживаются в группах управления. Состояние этого элемента можно отслеживать на [форуме обратной связи по группам управления](https://aka.ms/mgfeedback).

## <a name="audit-management-groups-using-activity-logs"></a>Аудит групп управления с помощью журналов действий

[Журнал действий Azure](../../azure-monitor/platform/activity-logs-overview.md) поддерживает группы управления. Сведения обо всех событиях, происходящих в группе управления, можно найти в том же централизованном расположении, что и другие ресурсы Azure.  Например, вы можете просмотреть сведения обо всех изменениях в назначениях ролей или назначении политик, внесенные в пределах определенной группы управления.

![Журналы действий для групп управления](media/al-mg.png)

Если нужно создать запрос к группам управления вне портала Azure, целевая область для групп управления будет такой: **"/providers/Microsoft.Management/managementGroups/{идентификатор_вашей_группы_управления}"** .

## <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения о группах управления:

- [Создание групп управления для организации ресурсов Azure](create.md)
- [Изменение, удаление групп управления и управление ими](manage.md)
- [Просмотр групп управления в модуле ресурсов Azure PowerShell](/powershell/module/az.resources#resources)
- [Просмотр групп управления в REST API](/rest/api/resources/managementgroups)
- [Просмотр групп управления в Azure CLI](/cli/azure/account/management-group)
