---
title: Этапы развертывания схемы
description: Сведения о действиях, которые выполняет Azure Blueprintные службы во время развертывания.
author: DCtheGeek
ms.author: dacoulte
ms.date: 03/14/2019
ms.topic: conceptual
ms.service: blueprints
ms.openlocfilehash: 4645edde5163f1c8bca787416f5465e5a8f2d355
ms.sourcegitcommit: d7689ff43ef1395e61101b718501bab181aca1fa
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2019
ms.locfileid: "71978528"
---
# <a name="stages-of-a-blueprint-deployment"></a>Этапы развертывания схемы

При развертывании проекта служба "схемы Azure" предпринимает ряд действий для развертывания ресурсов, определенных в проекте. В этой статье приводятся сведения о том, что включает каждый шаг.

Развертывание схемы активируется путем назначения схемы подписке или [обновления существующего назначения](../how-to/update-existing-assignments.md). Во время развертывания схемы выполняются в следующих общих действиях:

> [!div class="checklist"]
> - Схемы, получившие права владельца
> - Объект назначения схемы создан
> - Необязательные — схемы создание управляемого удостоверения, **назначенного системой**
> - Управляемые удостоверения развертывает артефакты схемы
> - Служба схемы и **назначенные системой** управляемые удостоверения отменяются

## <a name="blueprints-granted-owner-rights"></a>Схемы, получившие права владельца

Субъекту-службе схем Azure предоставляются права владельца для назначенной подписки или подписок. Предоставленная роль позволяет проектам создавать и позднее отменять [назначенное системой управляемое удостоверение](../../../active-directory/managed-identities-azure-resources/overview.md).

Права предоставляются автоматически, если назначение выполняется на портале. Однако, если назначение выполняется с помощью REST API, предоставление прав необходимо выполнять с помощью отдельного вызова API. Идентификатор AppId Azure Blueprint `f71766dc-90d9-4b7d-bd9d-4499c4331c3f`, но субъект-служба зависит от клиента. Для получения субъекта-службы используйте [Azure Active Directory API Graph](../../../active-directory/develop/active-directory-graph-api.md) и конечную точку RESTful [Свойства serviceprincipals](/graph/api/resources/serviceprincipal) . Затем предоставьте роль _владельца_ в Azure на [портале](../../../role-based-access-control/role-assignments-portal.md), [Azure CLI](../../../role-based-access-control/role-assignments-cli.md), [Azure PowerShell](../../../role-based-access-control/role-assignments-powershell.md), [REST API](../../../role-based-access-control/role-assignments-rest.md)или [шаблоне диспетчер ресурсов](../../../role-based-access-control/role-assignments-template.md).

Служба чертежей не развертывает ресурсы напрямую.

## <a name="the-blueprint-assignment-object-is-created"></a>Объект назначения схемы создан

Пользователь, группа или субъект-служба назначает проект для подписки. Объект назначения существует на уровне подписки, где был назначен проект. Ресурсы, созданные при развертывании, не выполняются в контексте сущности развертывания.

При создании назначения схемы выбирается тип [управляемого удостоверения](../../../active-directory/managed-identities-azure-resources/overview.md) . Значение по умолчанию — управляемое **системой** удостоверение. Можно выбрать **назначаемое пользователем** управляемое удостоверение. При использовании управляемого удостоверения, **назначенного пользователем** , его необходимо определить и предоставить разрешения перед созданием назначения схемы.

## <a name="optional---blueprints-creates-system-assigned-managed-identity"></a>Необязательные — схемы создание управляемого удостоверения, назначенного системой

При выборе [управляемого удостоверения, назначенного системой](../../../active-directory/managed-identities-azure-resources/overview.md) во время назначения, схемы создают удостоверение и предоставляют управляемому удостоверению роль [владельца](../../../role-based-access-control/built-in-roles.md#owner) . При [обновлении существующего назначения](../how-to/update-existing-assignments.md)схемы используют ранее созданное управляемое удостоверение.

Управляемое удостоверение, связанное с назначением схемы, используется для развертывания или повторного развертывания ресурсов, определенных в проекте. Такая схема позволяет избежать непреднамеренного влияния на назначения друг на друга.
Эта схема также поддерживает функцию [блокировки ресурсов](./resource-locking.md) , контролируя безопасность каждого развернутого ресурса из схемы.

## <a name="the-managed-identity-deploys-blueprint-artifacts"></a>Управляемые удостоверения развертывает артефакты схемы

Затем управляемое удостоверение активирует диспетчер ресурсов развертывания артефактов в пределах схемы в определенном [порядке последовательности](./sequencing-order.md). Заказ можно изменить, чтобы убедиться, что артефакты, зависящие от других артефактов, развернуты в правильном порядке.

Сбой доступа при развертывании часто является результатом уровня доступа, предоставляемого управляемому удостоверению. Служба чертежей управляет жизненным циклом безопасности управляемого удостоверения, **назначенного системой** . Однако пользователь несет ответственность за управление правами и жизненным циклом управляемого удостоверения, **назначаемого пользователем** .

## <a name="blueprint-service-and-system-assigned-managed-identity-rights-are-revoked"></a>Служба схемы и назначенные системой управляемые удостоверения отменяются

После завершения развертывания схемы отменяют права управляемого **системой** удостоверения из подписки. Затем служба чертежей отзывает свои права из подписки. Удаление прав предотвращает создание планами постоянного владельца подписки.

## <a name="next-steps"></a>Следующие шаги

- Узнайте, как использовать [статические и динамические параметры](parameters.md).
- Научитесь настраивать [последовательность схемы](sequencing-order.md).
- Узнайте, как применять [блокировку ресурсов схемы](resource-locking.md).
- Узнайте, как [обновлять существующие назначения](../how-to/update-existing-assignments.md).
- Устраняйте проблемы, возникающие во время назначения схемы, с помощью [общих инструкций по устранению неполадок](../troubleshoot/general.md).