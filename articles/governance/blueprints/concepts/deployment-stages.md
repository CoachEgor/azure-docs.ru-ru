---
title: Этапы развертывания схемы
description: Изучите шаги, связанные с безопасностью и артефактами, которые проходят службы Azure Blueprint Blueprints при создании назначения чертежа.
ms.date: 11/13/2019
ms.topic: conceptual
ms.openlocfilehash: daa7722fa37547929aa21b76b870f70143ae71ab
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "76156630"
---
# <a name="stages-of-a-blueprint-deployment"></a>Этапы развертывания схемы

При развертывании чертежа служба Azure Blueprints принимает ряд действий для развертывания ресурсов, определенных в чертеже. В этой статье приводится подробная информация о том, что включает в себя каждый шаг.

Развертывание чертежа запускается путем назначения чертежа подписке или [обновления существующего назначения.](../how-to/update-existing-assignments.md) Во время развертывания Blueprints выполняет следующие шаги высокого уровня:

> [!div class="checklist"]
> - Чертежи предоставлены права владельца
> - Объект назначения чертежа создается
> - Дополнительно - Чертежи создают **системно-назначенную управляемую** идентификацию
> - Управляемая идентификация развертывает артефакты чертежей
> - Служба blueprint и **системно-назначенные** управляемые права идентификации аннулируются

## <a name="blueprints-granted-owner-rights"></a>Чертежи предоставлены права владельца

Директор службы Azure Blueprints получает права владельца на назначенные подписки или подписки при использовании управляемого удостоверения [управляемого удостоверения управляемого удостоверения, управляемого](../../../active-directory/managed-identities-azure-resources/overview.md) имитаторами. Предоставленная роль позволяет Blueprints создавать, а затем отменять управляемые удостоверения, **назначенные системой.** При использовании **управляемого** удостоверения пользователя принцип службы Azure Blueprints не получает и не нуждается в правах владельца подписки.

Права предоставляются автоматически, если уступка осуществляется через портал. Однако, если назначение выполняется через REST API, предоставление прав должно быть сделано с помощью отдельного вызова API. Azure Blueprints AppId `f71766dc-90d9-4b7d-bd9d-4499c4331c3f`— это, но основной сервис зависит от арендатора. Для получения основного средства службы используйте [API API Active Directory GraphPI Ис лазурного средства](../../../active-directory/develop/active-directory-graph-api.md) и [службу](/graph/api/resources/serviceprincipal) endpoint REST. Затем предоставите Лазурные чертежи роли _владельца_ через [портал,](../../../role-based-access-control/role-assignments-portal.md) [Azure CLI](../../../role-based-access-control/role-assignments-cli.md), [Azure PowerShell](../../../role-based-access-control/role-assignments-powershell.md), [REST API](../../../role-based-access-control/role-assignments-rest.md)или [шаблон менеджера ресурсов.](../../../role-based-access-control/role-assignments-template.md)

Служба Blueprints непосредственно не развертывает ресурсы.

## <a name="the-blueprint-assignment-object-is-created"></a>Объект назначения чертежа создается

Основной пользователь, группа или служба присваивает подписке чертеж. Объект назначения существует на уровне подписки, где был назначен чертеж. Ресурсы, созданные развертыванием, не выполняются в контексте развертывания объекта.

При создании назначения чертежа выбирается тип [управляемого иектра.](../../../active-directory/managed-identities-azure-resources/overview.md) По умолчанию это **система назначенных управляемых** итог. Можно выбрать **управляемую изначадляемую личность, назначенную пользователем.** При использовании управляемого удостоверения, **назначенного пользователем,** оно должно быть определено и предоставлено разрешения до создания назначения чертежа. Встроенные роли [владельца](../../../role-based-access-control/built-in-roles.md#owner) и [оператора Blueprint](../../../role-based-access-control/built-in-roles.md#blueprint-operator) `blueprintAssignment/write` имеют необходимое разрешение на создание назначения, используюкоторого управляемым идентификатором, **назначенным пользователем.**

## <a name="optional---blueprints-creates-system-assigned-managed-identity"></a>Дополнительно - Чертежи создают системно-назначенную управляемую идентификацию

При [выборе управляемого удостоверения, назначенного системой](../../../active-directory/managed-identities-azure-resources/overview.md) во время назначения, Чертежи создают идентификацию и предоставляют управляемую идентификацию роли [владельца.](../../../role-based-access-control/built-in-roles.md#owner) Если [существующее назначение обновлено,](../how-to/update-existing-assignments.md)Чертежи используют ранее созданный управляемый имитизм.

Управляемая идентификация, связанная с назначением чертежа, используется для развертывания или перераспределения ресурсов, определенных в чертеже. Эта конструкция позволяет избежать назначений, непреднамеренно мешающих друг другу.
Эта конструкция также поддерживает функцию [блокировки ресурсов,](./resource-locking.md) контролируя безопасность каждого развернутого ресурса из чертежа.

## <a name="the-managed-identity-deploys-blueprint-artifacts"></a>Управляемая идентификация развертывает артефакты чертежей

Управляемая идентификация запускает развертывание ресурсов диспетчера артефактов в чертеже в определенном [порядке последовательности.](./sequencing-order.md) Порядок может быть скорректирован, чтобы гарантировать, что артефакты, зависящие от других артефактов, развернуты в правильном порядке.

Сбой в доступе в результате развертывания часто является результатом уровня доступа к управляемому итору. Служба Blueprints управляет жизненным циклом безопасности управляемого удостоверения, **назначенного системой.** Однако пользователь отвечает за управление правами и жизненным циклом управляемого удостоверения, **назначенного пользователем.**

## <a name="blueprint-service-and-system-assigned-managed-identity-rights-are-revoked"></a>Служба blueprint и системно-назначенные управляемые права идентификации аннулируются

После завершения развертывания Blueprints отменяет права на управляемую идентификацию **системы** из подписки. Затем сервис Blueprints отменяет свои права из подписки. Удаление прав не позволяет Blueprints стать постоянным владельцем по подписке.

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте, как использовать [статические и динамические параметры](parameters.md).
- Научитесь настраивать [последовательность схемы](sequencing-order.md).
- Узнайте, как применять [блокировку ресурсов схемы](resource-locking.md).
- Узнайте, как [обновлять существующие назначения](../how-to/update-existing-assignments.md).
- Устраняйте проблемы, возникающие во время назначения схемы, с помощью [общих инструкций по устранению неполадок](../troubleshoot/general.md).
