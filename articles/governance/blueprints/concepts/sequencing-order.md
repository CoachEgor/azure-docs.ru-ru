---
title: Сведения о порядке последовательности развертывания
description: Узнайте о порядке выполнения по умолчанию, в который развертываются артефакты чертежа во время назначения чертежа, и о том, как настроить порядок развертывания.
ms.date: 08/22/2019
ms.topic: conceptual
ms.openlocfilehash: 41b1b1ada5b7c6c919f227927001570332eeccbf
ms.sourcegitcommit: 642a297b1c279454df792ca21fdaa9513b5c2f8b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2020
ms.locfileid: "80677567"
---
# <a name="understand-the-deployment-sequence-in-azure-blueprints"></a>Сведения о последовательности развертывания в Azure Blueprint

Azure Blueprints использует **порядок секвенирования** для определения порядка создания ресурсов при обработке назначения определения чертежа. В этой статье объясняются следующие концепции:

- используемый порядок последовательности по умолчанию;
- настройка порядка;
- обработка настроенного порядка.

В примерах кода JSON есть переменные, значения которых необходимо заменить на ваши собственные значения:

- `{YourMG}` — замените это значение именем своей группы управления.

## <a name="default-sequencing-order"></a>Порядок последовательности по умолчанию

Если определение чертежа не содержит директивы для заказа на развертывание артефактов или директива недействительна, используется следующий порядок:

- Артефакты **назначения ролей** уровня подписки сортируются по имени артефакта
- Артефакты **назначения политик** уровня подписки сортируются по имени артефакта
- Артефакты **шаблонов Azure Resource Manager** уровня подписки сортируются по имени артефакта
- Артефакты **группы ресурсов** (включая дочерние артефакты) сортируются по имени заполнителя

Для каждого артефакта **группы ресурсов** при создании артефактов в этой группе ресурсов используется следующий порядок последовательности:

- Дочерние артефакты **назначения ролей** группы ресурсов сортируются по имени артефакта
- Дочерние артефакты **назначения политик** группы ресурсов сортируются по имени артефакта
- Дочерние артефакты **шаблонов Azure Resource Manager** группы ресурсов сортируются по имени артефакта

> [!NOTE]
> Использование [артефактов ()](../reference/blueprint-functions.md#artifacts) создает неявную зависимость от навистого артефакта.

## <a name="customizing-the-sequencing-order"></a>Изменение порядка последовательности

При составлении определений больших чертежей может потребоваться создание ресурсов в определенном порядке. Наиболее распространенный шаблон использования этого сценария — когда определение чертежа включает несколько шаблонов azure Resource Manager. Azure Blueprints обрабатывает этот шаблон, позволяя определить порядок секвенирования.

Для определения порядка в коде JSON определяется свойство `dependsOn`. Определение чертежа для групп ресурсов и объектов артефактов поддерживает это свойство. `dependsOn` представляет собой массив строк имен артефактов, которые необходимо создать перед созданием указанного артефакта.

> [!NOTE]
> При создании объектов чертежа каждый ресурс артефакта получает свое имя от имени файла, если он использует [PowerShell,](/powershell/module/az.blueprint/new-azblueprintartifact)или конечную точку URL, если использует [REST API.](/rest/api/blueprints/artifacts/createorupdate)
> Ссылки _group ресурсов_ в артефактах должны соответствовать тем, которые определены в определении чертежа.

### <a name="example---ordered-resource-group"></a>Пример - упорядоченная группа ресурсов

В этом примере определение чертежа имеет группу ресурсов, которая определила пользовательский порядок последовательности, объявив значение для, `dependsOn`вместе со стандартной группой ресурсов. В этом случае артефакт **assignPolicyTags** будет обрабатываться до группы ресурсов **ordered-rg**.
**standard-rg** будет обрабатываться в соответствии с порядком последовательности по умолчанию.

```json
{
    "properties": {
        "description": "Example blueprint with custom sequencing order",
        "resourceGroups": {
            "ordered-rg": {
                "dependsOn": [
                    "assignPolicyTags"
                ],
                "metadata": {
                    "description": "Resource Group that waits for 'assignPolicyTags' creation"
                }
            },
            "standard-rg": {
                "metadata": {
                    "description": "Resource Group that follows the standard sequence ordering"
                }
            }
        },
        "targetScope": "subscription"
    },
    "type": "Microsoft.Blueprint/blueprints"
}
```

### <a name="example---artifact-with-custom-order"></a>Пример: артефакт с пользовательским порядком последовательности

Этот пример содержит артефакт политики, который зависит от шаблона Azure Resource Manager. При использовании порядка сортировки по умолчанию артефакт политики был бы создан перед шаблоном Azure Resource Manager. Это упорядочение позволяет артефакту политики ожидать, пока будет создан шаблон Azure Resource Manager.

```json
{
    "properties": {
        "displayName": "Assigns an identifying tag",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/2a0e14a6-b0a6-4fab-991a-187a4f81c498",
        "resourceGroup": "standard-rg",
        "dependsOn": [
            "customTemplate"
        ]
    },
    "kind": "policyAssignment",
    "type": "Microsoft.Blueprint/artifacts"
}
```

### <a name="example---subscription-level-template-artifact-depending-on-a-resource-group"></a>Пример - артефакт шаблона уровня подписки в зависимости от группы ресурсов

Этот пример предназначен для того, чтобы шаблон управления ресурсами, развернутый на уровне подписки, в зависимости от группы ресурсов. При заказе по умолчанию артефакты уровня подписки будут создаваться перед группами ресурсов и детскими артефактами в этих группах ресурсов. Группа ресурсов определяется в определении чертежа следующим образом:

```json
"resourceGroups": {
    "wait-for-me": {
        "metadata": {
            "description": "Resource Group that is deployed prior to the subscription level template artifact"
        }
    }
}
```

Артефакт шаблона уровня подписки в зависимости от группы ресурсов **ожидания** определяется следующим образом:

```json
{
    "properties": {
        "template": {
            ...
        },
        "parameters": {
            ...
        },
        "dependsOn": ["wait-for-me"],
        "displayName": "SubLevelTemplate",
        "description": ""
    },
    "kind": "template",
    "type": "Microsoft.Blueprint/blueprints/artifacts"
}
```

## <a name="processing-the-customized-sequence"></a>Обработка пользовательской последовательности

В процессе создания используется топологическая сортировка для создания графа зависимостей схемы и ее артефактов. Выполняется проверка того, что поддерживается каждый уровень зависимостей между группами ресурсов и артефактами.

Если объявляется зависимость артефактов, которая не изменяет порядок последовательности по умолчанию, никакие изменения не вносятся. Например, это относится к группе ресурсов, которая зависит от политики уровня подписки. Другой пример — назначение дочерней политики standart-rg для группы ресурсов, которая зависит от назначения дочерней роли standard-rg для группы ресурсов. В обоих случаях `dependsOn` не изменяет порядок последовательности по умолчанию, и изменения не производятся.

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте о [жизненном цикле чертежей.](lifecycle.md)
- Узнайте, как использовать [статические и динамические параметры](parameters.md).
- Узнайте, как применять [блокировку ресурсов схемы](resource-locking.md).
- Узнайте, как [обновлять существующие назначения](../how-to/update-existing-assignments.md).
- Устраняйте проблемы, возникающие во время назначения схемы, с помощью [общих инструкций по устранению неполадок](../troubleshoot/general.md).