---
title: Устранение распространенных ошибок
description: Узнайте, как устранять неполадки при создании определений политик, различных пакетах SDK и надстройки для Kubernetes.
ms.date: 05/22/2020
ms.topic: troubleshooting
ms.openlocfilehash: 868b8c53a120ebdb6a35806538e02af39e25c338
ms.sourcegitcommit: f684589322633f1a0fafb627a03498b148b0d521
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/06/2020
ms.locfileid: "85970847"
---
# <a name="troubleshoot-errors-using-azure-policy"></a>Устранение ошибок с помощью политики Azure

Вы можете столкнуться с ошибками при создании определений политик, работе с пакетом SDK или настройке [политики Azure для](../concepts/policy-for-kubernetes.md) надстройки Kubernetes. В этой статье описываются различные ошибки, которые могут возникнуть, и пути их решения.

## <a name="finding-error-details"></a>Поиск сведений об ошибке

Расположение сведений об ошибке зависит от действия, которое вызывает ошибку.

- При работе с настраиваемой политикой попробуйте использовать ее в портал Azure, чтобы получить linting отзыв о схеме или просмотреть результирующие [данные о соответствии](../how-to/get-compliance-data.md) , чтобы увидеть, как ресурсы были оценены.
- При работе с различными пакетами SDK пакет SDK предоставляет сведения о причинах сбоя функции.
- При работе с надстройкой для Kubernetes Начните с [ведения журнала](../concepts/policy-for-kubernetes.md#logging) в кластере.

## <a name="general-errors"></a>Общие ошибки

### <a name="scenario-alias-not-found"></a>Сценарий: псевдоним не найден

#### <a name="issue"></a>Проблемы

Политика Azure использует [псевдонимы](../concepts/definition-structure.md#aliases) для соотнесения со свойствами Azure Resource Manager.

#### <a name="cause"></a>Причина:

В определении политики используется неправильный или несуществующий псевдоним.

#### <a name="resolution"></a>Решение

Сначала убедитесь, что свойство диспетчер ресурсов имеет псевдоним. Используйте [расширение политики Azure для Visual Studio Code](../how-to/extension-for-vscode.md), [графа ресурсов Azure](../../resource-graph/samples/starter.md#distinct-alias-values)или пакета SDK, чтобы найти доступные псевдонимы. Если псевдоним для свойства диспетчер ресурсов не существует, создайте запрос в службу поддержки.

### <a name="scenario-evaluation-details-not-up-to-date"></a>Сценарий: сведения об оценке не обновлены

#### <a name="issue"></a>Проблемы

Ресурс находится в состоянии "не запущено" или сведения о соответствии не являются актуальными.

#### <a name="cause"></a>Причина:

Применение новой политики или назначения инициативы занимает около 30 минут. Новые или обновленные ресурсы в области действия существующего назначения становятся доступными примерно через 15 минут позже. Стандартная проверка соответствия происходит каждые 24 часа. Дополнительные сведения см. в разделе [триггеры оценки](../how-to/get-compliance-data.md#evaluation-triggers).

#### <a name="resolution"></a>Решение

Сначала дождитесь необходимого времени для завершения оценки, и результаты обеспечения соответствия будут доступны в портал Azure или пакете SDK. Чтобы запустить новую проверку для оценки с Azure PowerShell или REST API, см. статью [Проверка оценки по требованию](../how-to/get-compliance-data.md#on-demand-evaluation-scan).

### <a name="scenario-evaluation-not-as-expected"></a>Сценарий: вычисление не так, как ожидалось

#### <a name="issue"></a>Проблемы

Ресурс не находится в состоянии оценки ( _соответствует_ или _не соответствует требованиям_), ожидаемому для этого ресурса.

#### <a name="cause"></a>Причина:

Ресурс не находится в правильной области действия для назначения политики, или определение политики не работает должным образом.

#### <a name="resolution"></a>Решение

- Для несоответствующего ресурса, который должен быть соответствующим, начните с [определения причин несоответствия](../how-to/determine-non-compliance.md). Сравнение определения с вычисленным значением свойства указывает, почему ресурс не соответствует требованиям.
- Для соответствующего ресурса, который должен быть несоответствующим, прочтите условие определения политики по условию и оцените свойства ресурсов. Проверьте, что логические операторы группируют правильные условия и что условия не инвертированы.

Если соответствие для назначения политики показывает `0/0` ресурсы, ресурсы не были определены как применимые в области назначения. Проверьте определение политики и область назначения.

### <a name="scenario-enforcement-not-as-expected"></a>Сценарий: принудительное применение не так, как ожидалось

#### <a name="issue"></a>Проблемы

Ресурс, который должен обрабатываться политикой Azure, не содержит записей в [журнале действий Azure](../../../azure-monitor/platform/platform-logs-overview.md).

#### <a name="cause"></a>Причина:

Назначение политики настроено для [Енфорцементмоде](../concepts/assignment-structure.md#enforcement-mode) _отключено_. Если режим принудительного применения отключен, то этот результат политики не применяется, и в журнале действий нет записи.

#### <a name="resolution"></a>Решение

Обновите **енфорцементмоде** , чтобы _включить_. Это изменение позволяет политике Azure действовать с ресурсами в этом назначении политики и передавать записи в журнал действий. Если **енфорцементмоде** уже включен, ознакомьтесь с курсами действий [в разделе Вычисление не так, как ожидалось](#scenario-evaluation-not-as-expected) .

### <a name="scenario-denied-by-azure-policy"></a>Сценарий: отклонено политикой Azure

#### <a name="issue"></a>Проблемы

Для создания или обновления ресурса отказано.

#### <a name="cause"></a>Причина:

Назначение политики области, в которой новый или обновленный ресурс соответствует критериям определения политики с применением [запрета](../concepts/effects.md#deny) . Ресурсы собрания эти определения не могут быть созданы или обновлены.

#### <a name="resolution"></a>Решение

Сообщение об ошибке из назначения «запретить политику» включает в себя определение политики и идентификаторы назначения политики. Если информация об ошибке в сообщении отсутствует, она также доступна в [журнале действий](../../../azure-monitor/platform/activity-log-view.md). Используйте эти сведения для получения дополнительных сведений об ограничениях ресурсов и настройке свойств ресурсов в запросе в соответствии с допустимыми значениями.

## <a name="template-errors"></a>Ошибки шаблона

### <a name="scenario-policy-supported-functions-processed-by-template"></a>Сценарий: Поддерживаемые функцией политики функции, обрабатываемые шаблоном

#### <a name="issue"></a>Проблемы

Политика Azure поддерживает несколько Azure Resource Manager функций и функций шаблона (шаблона ARM), которые доступны только в определении политики. Диспетчер ресурсов обрабатывает эти функции как часть развертывания, а не как часть определения политики.

#### <a name="cause"></a>Причина:

Использование поддерживаемых функций, таких как `parameter()` или `resourceGroup()` , приводит к обработке результата функции во время развертывания, вместо того чтобы использовать функцию для определения политики и для обработки обработчика политики Azure.

#### <a name="resolution"></a>Решение

Чтобы передать функцию через, чтобы она была частью определения политики, заэкранированайте всю строку с `[` таким образом, чтобы свойство было похоже на `[[resourceGroup().tags.myTag]` . Escape-символ заставляет диспетчер ресурсов считать значение строкой при обработке шаблона. Затем политика Azure помещает функцию в определение политики, что позволяет использовать ее динамически, как и ожидалось. Дополнительные сведения см. [в разделе синтаксис и выражения в шаблонах Azure Resource Manager](../../../azure-resource-manager/templates/template-expressions.md).

## <a name="add-on-installation-errors"></a>Ошибки установки надстройки

### <a name="scenario-install-using-helm-chart-fails-on-password"></a>Сценарий: Установка с использованием диаграммы Helm завершается сбоем при пароле

#### <a name="issue"></a>Проблемы

`helm install azure-policy-addon`Команда завершается с одним из следующих сообщений:

- `!: event not found`
- `Error: failed parsing --set data: key "<key>" has no value (cannot end with ,)`

#### <a name="cause"></a>Причина:

Созданный пароль включает запятую ( `,` ), на которой Helm диаграмма.

#### <a name="resolution"></a>Решение

`,`При запуске `helm install azure-policy-addon` с помощью обратной косой черты () в качестве значения пароля используется escape-последовательность () `\` .

### <a name="scenario-install-using-helm-chart-fails-as-name-already-exists"></a>Сценарий: Установка с использованием диаграммы Helm не выполняется, так как имя уже существует

#### <a name="issue"></a>Проблемы

`helm install azure-policy-addon`Команда завершается со следующим сообщением:

- `Error: cannot re-use a name that is still in use`

#### <a name="cause"></a>Причина:

Диаграмма Helm с именем `azure-policy-addon` уже установлена или частично установлена.

#### <a name="resolution"></a>Решение

Следуйте указаниям, чтобы [удалить политику Azure для надстройки Kubernetes](../concepts/policy-for-kubernetes.md#remove-the-add-on), а затем повторите `helm install azure-policy-addon` команду.

## <a name="next-steps"></a>Дальнейшие действия

Если вы не видите своего варианта проблемы или вам не удается ее устранить, дополнительные сведения можно получить, посетив один из следующих каналов.

- Получите ответы от экспертов по [Microsoft Q&а](/answers/topics/azure-policy.html).
- Подключитесь к [@AzureSupport](https://twitter.com/azuresupport) — официальной учетной записи Microsoft Azure. Она помогает оптимизировать работу пользователей благодаря возможности доступа к ресурсам сообщества Azure (ответы на вопросы, поддержка и консультации специалистов).
- Если вам нужна дополнительная помощь, отправьте запрос в службу поддержки Azure. Перейдите на [сайт поддержки Azure](https://azure.microsoft.com/support/options/) и щелкните **Получить поддержку**.
