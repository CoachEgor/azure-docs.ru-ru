---
title: Определение причин несоответствия требованиям
description: Если ресурс является несоответствующим, существует множество возможных причин. Узнайте, как выяснения причины несоответствия.
author: DCtheGeek
ms.author: dacoulte
ms.date: 04/26/2019
ms.topic: conceptual
ms.service: azure-policy
manager: carmonm
ms.openlocfilehash: 2f856e9c42b26d4e286493e2eb5d019a8cff6c23
ms.sourcegitcommit: e7d4881105ef17e6f10e8e11043a31262cfcf3b7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/29/2019
ms.locfileid: "64868703"
---
# <a name="determine-causes-of-non-compliance"></a>Определение причин несоответствия требованиям

Когда ресурс Azure определяется как несоответствующее в правило политики, необходимо понять, какая часть ресурса не соответствует требованиям, с помощью правила. Это также позволяет понять, какие изменения изменен ранее соответствующее ресурс, чтобы сделать его как несоответствующие. Существует два способа получить эти сведения:

> [!div class="checklist"]
> - [Сведения о соответствии](#compliance-details)
> - [Журнал изменений (Предварительная версия)](#change-history-preview)

## <a name="compliance-details"></a>Сведения о соответствии

Если ресурс является несоответствующим, сведения о соответствии для этого ресурса доступны из **соответствие политике** страницы. В области сведений соответствия включает в себя следующие сведения:

- Сведения о ресурсах, например имя, тип, расположение и ресурсов по Идентификатору
- Состояние соответствия и отметка времени последнего вычисления текущей назначения политики
- Список _причин_ несоответствии ресурсов

> [!IMPORTANT]
> Как сведения о соответствии для _несоответствующие_ ресурсе показано текущее значение свойства в этом ресурсе, пользователь должен иметь **чтение** операции **тип** из ресурс. Например если _несоответствующие_ ресурс является **Microsoft.Compute/virtualMachines** затем пользователь должен иметь **Microsoft.Compute/virtualMachines/read** операция. Если у пользователя нет необходимых операцию, отображается ошибка доступа.

Чтобы просмотреть сведения о соответствии, выполните следующие действия.

1. Запустите службу "Политика Azure" на портале Azure, щелкнув **Все службы**, а затем выполнив поиск и выбрав **Политика**.

1. На **Обзор** или **соответствия** выберите политику в **состояние соответствия** то есть _несоответствующие_.

1. В разделе **соответствие ресурсов** вкладке **соответствие политике** странице, щелкните правой кнопкой мыши или нажмите кнопку с многоточием ресурса в **состояние соответствия** то есть  _Несовместимые_. Затем выберите **просмотреть сведения о соответствии**.

   ![Параметр сведений соответствия представления](../media/determine-non-compliance/view-compliance-details.png)

1. **Сведения о соответствии** панели отображаются сведения из последней оценки ресурса для текущего назначения политики. В этом примере поле **Microsoft.Sql/servers/version** является _12.0_ хотя ожидалось Определение политики _14.0_. Если ресурс является несоответствующим по нескольким причинам, каждый присутствует в этой области.

   ![Сведения о соответствия и причины несоответствия](../media/determine-non-compliance/compliance-details-pane.png)

   Для **auditIfNotExists** или **deployIfNotExists** Определение политики, эти сведения включают **details.type** свойство и любые дополнительные свойства. Список, см. в разделе [свойства auditIfNotExists](../concepts/effects.md#auditifnotexists-properties) и [deployIfNotExists свойства](../concepts/effects.md#deployifnotexists-properties). **Последняя проверка ресурсов** имеет связанный ресурс из **сведения** часть определения.

   Пример частичной **deployIfNotExists** определение:

   ```json
   {
       "if": {
           "field": "type",
           "equals": "[parameters('resourceType')]"
       },
       "then": {
           "effect": "DeployIfNotExists",
           "details": {
               "type": "Microsoft.Insights/metricAlerts",
               "existenceCondition": {
                   "field": "name",
                   "equals": "[concat(parameters('alertNamePrefix'), '-', resourcegroup().name, '-', field('name'))]"
               },
               "existenceScope": "subscription",
               "deployment": {
                   ...
               }
           }
       }
   }
   ```

   ![Область сведений соответствия - * ifNotExists](../media/determine-non-compliance/compliance-details-pane-existence.png)

> [!NOTE]
> Для защиты данных, в том случае, когда значение свойства является _секрет_ текущее значение отображается звездочка.

Эти сведения объяснить, почему ресурс является в настоящее время несоответствующим, но не отображаются, когда изменения к ресурсу, из-за нарушения соответствия. Дополнительные сведения см. в разделе [журнал (Предварительная версия) изменений](#change-history-preview) ниже.

### <a name="compliance-reasons"></a>Соответствия требованиям

Приведенной ниже таблице сопоставляет каждое возможное _Причина_ чтобы ответственный [условие](../concepts/definition-structure.md#conditions) в определении политики:

|Причина | Условие |
|-|-|
|Текущее значение может содержать целевое значение как ключ. |containsKey или **не** notContainsKey |
|Текущее значение может содержать целевое значение. |содержит или **не** notContains |
|Текущее значение должно быть равно целевому. |равно или **не** notEquals |
|Текущее значение должен существовать. |exists (существует) |
|Текущее значение должно быть включено в целевое значение. |в или **не** notIn |
|Текущее значение должно находиться как целевое значение. |как и или **не** notLike |
|Текущее значение должно с учетом регистра соответствовать целевому значению. |соответствует или **не** notMatch |
|Текущее значение должно без учета регистра соответствовать целевому значению. |matchInsensitively или **не** notMatchInsensitively |
|Текущее значение не может содержать целевое значение как ключ. |notContainsKey или **не** containsKey|
|Текущее значение не должно содержать целевое значение. |notContains или **не** содержит |
|Текущее значение не должно быть равно целевому. |notEquals или **не** равно |
|Текущее значение не должно существовать. |**не** существует  |
|Текущее значение не должно быть в целевое значение. |notIn или **не** в |
|Текущее значение не должно быть как целевое значение. |notLike или **не** как |
|Текущее значение не должно с учетом регистра соответствовать целевому значению. |notMatch или **не** соответствует |
|Текущее значение не должно без учета регистра соответствовать целевому значению. |notMatchInsensitively или **не** matchInsensitively |
|Нет связанных ресурсов, соответствующих сведениям о воздействии в определении политики. |Ресурс типа, определенного в **then.details.type** и связанный ресурс, определенный в **Если** часть правила политики не существует. |

## <a name="compliance-details-for-guest-configuration"></a>Сведения о соответствии для конфигурации гостевой

Для _аудита_ политик в _конфигурации гостевой_ категории, может существовать несколько параметров, вычисляется в виртуальной Машине, и вам потребуется просмотреть подробные сведения для каждого параметра. Например, если вы аудит список установленных приложений и состояние назначения является _несоответствующие_, вам потребуется знать, какие конкретные приложения отсутствуют.

Также у вас нет доступа для входа на виртуальную машину напрямую, но вам нужно сообщить, на которой находится виртуальная машина _несоответствующие_. Например можно аудит, что виртуальные машины присоединены к правильному домену и включает текущего членства в домене в сведениях об отчетности.

### <a name="azure-portal"></a>Портал Azure

1. Запустите службу "Политика Azure" на портале Azure, щелкнув **Все службы**, а затем выполнив поиск и выбрав **Политика**.

1. На **Обзор** или **соответствия** выберите назначение политики для любой инициативы, которая содержит определение политики конфигурации гостевой что _несоответствующие_.

1. Выберите _аудита_ политики в рамках инициативы что _несоответствующие_.

   ![Просмотр сведений о определение аудита](../media/determine-non-compliance/guestconfig-audit-compliance.png)

1. На **соответствие ресурсов** вкладке приводятся следующие сведения:

   - **Имя** -имя назначения конфигурации гостевой.
   - **Родительский ресурс** -виртуальной машины в _несоответствующие_ состояния для выбранной конфигурации гостевой назначения.
   - **Тип ресурса** - _guestConfigurationAssignments_ полное имя.
   - **Последнее вычисление** — время последней конфигурации гостевой служба уведомление о политике Azure о состоянии целевой виртуальной машины.

   ![Просмотрите сведения о соответствии.](../media/determine-non-compliance/guestconfig-assignment-view.png)

1. Выберите имя Назначение конфигурации гостевой в **имя** столбца, чтобы открыть **соответствие ресурсов** страницы.

1. Выберите **ресурс представления** кнопку в верхней части страницы, чтобы открыть **назначения гостевой** страницы.

**Назначения гостевой** странице отображаются все сведения о доступных соответствия. Каждая строка в представлении представляет вычисление, которое было выполнено на виртуальной машине. В **Причина** столбец, фразы, описывающий, почему он гостевой назначен _несоответствующие_ отображается. Например, если аудит, что виртуальные машины должен быть присоединен к домену **Причина** столбец будет отображать текст, включая членство в текущем домене.

![Просмотрите сведения о соответствии.](../media/determine-non-compliance/guestconfig-compliance-details.png)

### <a name="azure-powershell"></a>Azure PowerShell

Можно также просмотреть сведения о соответствии с помощью Azure PowerShell. Во-первых убедитесь, что вы установили модуль конфигурации гостевой.

```azurepowershell-interactive
Install-Module Az.GuestConfiguration
```

Можно просматривать текущее состояние всех назначений гостя для виртуальной Машины, используя следующую команду:

```azurepowershell-interactive
Get-AzVMGuestPolicyReport -ResourceGroupName <resourcegroupname> -VMName <vmname>
```

```output
PolicyDisplayName                                                         ComplianceReasons
-----------------                                                         -----------------
Audit that an application is installed inside Windows VMs                 {[InstalledApplication]bwhitelistedapp}
Audit that an application is not installed inside Windows VMs.            {[InstalledApplication]NotInstalledApplica...
```

Чтобы просмотреть только _Причина_ фразу, которая описывает, почему виртуальная машина не _несоответствующие_, возвращают только причина дочернее свойство.

```azurepowershell-interactive
Get-AzVMGuestPolicyReport -ResourceGroupName <resourcegroupname> -VMName <vmname> | % ComplianceReasons | % Reasons | % Reason
```

```output
The following applications are not installed: '<name>'.
```

Можно также выводить журнал соответствия для назначений гостя в области для виртуальной машины. Выходные данные этой команды содержит сведения о каждом отчете для виртуальной Машины.

> [!NOTE]
> Выходные данные могут возвращать большое количество данных. Рекомендуется сохранить выходные данные в переменной.

```azurepowershell-interactive
$guestHistory = Get-AzVMGuestPolicyStatusHistory -ResourceGroupName <resourcegroupname> -VMName <vmname>
$guestHistory
```

```output
PolicyDisplayName                                                         ComplianceStatus ComplianceReasons StartTime              EndTime                VMName LatestRepor
                                                                                                                                                                  tId
-----------------                                                         ---------------- ----------------- ---------              -------                ------ -----------
[Preview]: Audit that an application is installed inside Windows VMs      NonCompliant                       02/10/2019 12:00:38 PM 02/10/2019 12:00:41 PM VM01  ../17fg0...
<truncated>
```

Чтобы упростить это представление, используйте **ShowChanged** параметра. Выходные данные этой команды включает только отчеты, за которой изменение состояния соответствия.

```azurepowershell-interactive
$guestHistory = Get-AzVMGuestPolicyStatusHistory -ResourceGroupName <resourcegroupname> -VMName <vmname> -ShowChanged
$guestHistory
```

```output
PolicyDisplayName                                                         ComplianceStatus ComplianceReasons StartTime              EndTime                VMName LatestRepor
                                                                                                                                                                  tId
-----------------                                                         ---------------- ----------------- ---------              -------                ------ -----------
Audit that an application is installed inside Windows VMs                 NonCompliant                       02/10/2019 10:00:38 PM 02/10/2019 10:00:41 PM VM01  ../12ab0...
Audit that an application is installed inside Windows VMs.                Compliant                          02/09/2019 11:00:38 AM 02/09/2019 11:00:39 AM VM01  ../e3665...
Audit that an application is installed inside Windows VMs                 NonCompliant                       02/09/2019 09:00:20 AM 02/09/2019 09:00:23 AM VM01  ../15ze1...
```

## <a name="a-namechange-historychange-history-preview"></a><a name="change-history"/>Журнал изменений (Предварительная версия)

Как часть нового **общедоступной предварительной версии**, за последние 14 дней, историю изменений доступны для всех ресурсов Azure, которые поддерживают [завершить режим удаления](../../../azure-resource-manager/complete-mode-deletion.md). Журнал изменений содержит подробные сведения о том, когда было обнаружено изменение и _отличия между визуальными элементами_ для каждого изменения. Обнаружение изменений активируется в том случае, когда добавлены, удалены или изменены свойства Resource Manager.

1. Запустите службу "Политика Azure" на портале Azure, щелкнув **Все службы**, а затем выполнив поиск и выбрав **Политика**.

1. На **Обзор** или **соответствия** выберите политику в любом **состояние соответствия**.

1. В разделе **соответствие ресурсов** вкладке **соответствие политике** странице, выберите ресурс.

1. На странице **Соответствие ресурсов** выберите вкладку **Журнал изменений (предварительная версия)**. После этого отобразится список обнаруженных изменений (при наличии).

   ![Вкладка "Политика журнал изменений на странице соответствие ресурсов"](../media/determine-non-compliance/change-history-tab.png)

1. Выберите одно из обнаруженных изменений. _Visual diff_ для ресурса, отображаемым на **журнал изменений** страницы.

   ![Политика изменения журнала Visual Diff на странице журнала изменений](../media/determine-non-compliance/change-history-visual-diff.png)

_Отличия между визуальными элементами_ позволяют обнаружить изменения ресурса. Обнаружены изменения не могут быть связаны с текущее состояние соответствия ресурса.

Предоставляемые данных журнала изменений [график ресурсов Azure](../../resource-graph/overview.md). Чтобы запросить эти сведения за пределами портала Azure, см. в разделе [получить изменения ресурсов](../../resource-graph/how-to/get-resource-changes.md).

## <a name="next-steps"></a>Дальнейшие действия

- Просмотрите примеры доступны на [примеры политик Azure](../samples/index.md).
- См. дополнительные сведения о [структуре определения Политики Azure](../concepts/definition-structure.md).
- См. дополнительные сведения о [действиях политик](../concepts/effects.md).
- Понять, как [программное создание политик](programmatically-create.md).
- Узнайте, как [получить данные о соответствии](getting-compliance-data.md).
- Узнайте, как [исправлять несоответствующие ресурсы](remediate-resources.md).
- Просмотрите, какие группы управления — с [упорядочение ресурсов с помощью групп управления Azure](../../management-groups/overview.md).