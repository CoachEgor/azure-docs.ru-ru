---
title: Политики авторов для массива свойств ресурсов
description: Научитесь работать с параметрами массива и выражениями языка массива, оценивать псевдонимы и прикладивать элементы с правилами определения политики Azure.
ms.date: 11/26/2019
ms.topic: how-to
ms.openlocfilehash: 991d159f6444133d902382bc9ca43bc2acd201e2
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79280668"
---
# <a name="author-policies-for-array-properties-on-azure-resources"></a>Автором политик для свойств массивов ресурсов Azure

Свойства менеджера ресурсов Azure обычно определяются как строки и булеи. При наличии отношения «один к много» сложные свойства определяются как массивы. В политике Azure массивы используются несколькими способами:

- Тип [параметра определения,](../concepts/definition-structure.md#parameters)чтобы обеспечить несколько вариантов
- Часть [правила политики,](../concepts/definition-structure.md#policy-rule) использующего **notIn** условия **в**
- Часть правила политики, которая оценивает [ \[ \* \] псевдоним](../concepts/definition-structure.md#understanding-the--alias) для оценки:
  - Сценарии, такие как **Нет,** **Любой,** или **Все**
  - Сложные сценарии с **подсчетом**
- В [эффекте приложения](../concepts/effects.md#append) заменить или добавить к существующему массиву

В этой статье рассматривается каждое использование Azure Policy и приводится несколько примеров определений.

## <a name="parameter-arrays"></a>Массивы параметров

### <a name="define-a-parameter-array"></a>Определение массива параметров

Определение параметра как массива позволяет гибкость политики при необходимости более чем одного значения.
Это определение политики позволяет любое единое местоположение для параметра **allowedLocations** и по умолчанию _eastus2:_

```json
"parameters": {
    "allowedLocations": {
        "type": "string",
        "metadata": {
            "description": "The list of allowed locations for resources.",
            "displayName": "Allowed locations",
            "strongType": "location"
        },
        "defaultValue": "eastus2"
    }
}
```

Поскольку **тип** был _строкой,_ при назначении политики можно установить только одно значение. При присвоении этой политики ресурсы в области могут быть разрешены только в пределах одного региона Azure. Большинство определений политик должны предусмотреть список утвержденных вариантов, таких как разрешение _eastus2,_ _eastus_и _westus2._

Чтобы создать определение политики, чтобы разрешить несколько вариантов, используйте **тип** _массива._ Та же политика может быть переписана следующим образом:

```json
"parameters": {
    "allowedLocations": {
        "type": "array",
        "metadata": {
            "description": "The list of allowed locations for resources.",
            "displayName": "Allowed locations",
            "strongType": "location"
        },
        "defaultValue": "eastus2",
        "allowedValues": [
            "eastus2",
            "eastus",
            "westus2"
        ]

    }
}
```

> [!NOTE]
> После сохранения определения политики свойство **типа** по параметру не может быть изменено.

Это новое определение параметра требует более одного значения при назначении политики. При определении свойств массива, которые **определяются,** значения, доступные во время уступки, дополнительно ограничены заранее определенным списком вариантов. Использование **разрешенныхзначени** является необязательным.

### <a name="pass-values-to-a-parameter-array-during-assignment"></a>Передайте значения массиву параметров во время назначения

При назначении политики через портал Azure параметр _массива_ **типа** отображается в виде единого текстового ящика. Подсказка говорит: "Использование ; для разделения значений. (например, Лондон; Нью-йорк)". Чтобы передать допустимые значения местоположения _eastus2,_ _eastus_и _westus2_ к параметру, используйте следующую строку:

`eastus2;eastus;westus2`

Формат значения параметра отличается при использовании Azure CLI, Azure PowerShell или REST API. Значения передаются через строку JSON, которая также включает в себя имя параметра.

```json
{
    "allowedLocations": {
        "value": [
            "eastus2",
            "eastus",
            "westus2"
        ]
    }
}
```

Чтобы использовать эту строку с каждым SDK, используйте следующие команды:

- Azure CLI: [назначение политики](/cli/azure/policy/assignment?view=azure-cli-latest#az-policy-assignment-create) команды az создается с **параметрами парамов**
- Azure PowerShell: Cmdlet [New-AzPolicyAssignment](/powershell/module/az.resources/New-Azpolicyassignment) с параметром **ПолитикаПараспара**
- REST API: В работе _PUT_ [создать](/rest/api/resources/policyassignments/create) как часть органа запроса как значение **свойства.**

## <a name="policy-rules-and-arrays"></a>Правила и массивы политики

### <a name="array-conditions"></a>Условия массива

[Условия](../concepts/definition-structure.md#conditions) правила политики, с которыми может использоваться `in` `notIn`**тип** _массива_
параметра, ограничены и . Возьмем в качестве примера следующее определение политики с условием: `equals`

```json
{
  "policyRule": {
    "if": {
      "not": {
        "field": "location",
        "equals": "[parameters('allowedLocations')]"
      }
    },
    "then": {
      "effect": "audit"
    }
  },
  "parameters": {
    "allowedLocations": {
      "type": "Array",
      "metadata": {
        "description": "The list of allowed locations for resources.",
        "displayName": "Allowed locations",
        "strongType": "location"
      }
    }
  }
}
```

Попытка создать это определение политики через портал Azure приводит к ошибке, такой как сообщение об ошибке:

- «Политика «ГУИД» не может быть параметризирована из-за ошибок проверки. Пожалуйста, проверьте, правильно ли определены параметры политики. Внутреннее исключение «Результат оценки выражения языка » «параметры ('разрешенныеLocations')» — это тип «Array», ожидаемый тип — «String».

Ожидаемый **тип** `equals` состояния _строки_. Поскольку **allowedLocations** определяется как _массив_ **типа,** движок политики оценивает выражение языка и бросает ошибку. С `in` `notIn` условием движок политики ожидает _массив_ **типа** в выражении языка. Чтобы разрешить это сообщение `equals` об `in` `notIn`ошибке, измените на любой или .

### <a name="evaluating-the--alias"></a>Оценка псевдонима «»

Псевдонимы, ** \[ \* ** прикрепившиеся к их имени, указывают на **то,** что тип представляет собой _массив._ Вместо того, чтобы оценивать значение ** \[ \* ** всего массива, позволяет оценивать каждый элемент массива по отдельности, с логическим и между ними. Есть три стандартных сценария, в которых эта оценка по элементу _полезна_в: Нет, _Любой,_ или _Все_ элементы совпадают. Для сложных сценариев используйте [count](../concepts/definition-structure.md#count).

Двигатель политики запускает **эффект** в **то** только тогда, когда правило **if** оценивается как верное.
Этот факт важно понимать в контексте того, как ** \[ \* ** оценивается каждый отдельный элемент массива.

Пример политики для таблицы сценариев ниже:

```json
"policyRule": {
    "if": {
        "allOf": [
            {
                "field": "Microsoft.Storage/storageAccounts/networkAcls.ipRules",
                "exists": "true"
            },
            <-- Condition (see table below) -->
        ]
    },
    "then": {
        "effect": "[parameters('effectType')]"
    }
}
```

Массив **ipRules** следующим образом для таблицы сценариев ниже:

```json
"ipRules": [
    {
        "value": "127.0.0.1",
        "action": "Allow"
    },
    {
        "value": "192.168.1.1",
        "action": "Allow"
    }
]
```

Для каждого условия пример `<field>` `"field": "Microsoft.Storage/storageAccounts/networkAcls.ipRules[*].value"`ниже, заменить на .

Следующие результаты являются результатом сочетания состояния и примера правила политики и массива существующих значений выше:

|Условие |Результат | Сценарий |Объяснение |
|-|-|-|-|
|`{<field>,"notEquals":"127.0.0.1"}` |Nothing |Ни один матч не совпадает |Один элемент массива оценивается как ложный (127.0.0.1 ! 127.0.0.1) и один как верный (127.0.0.1 ! 192.168.1.1.1), так что условие **notEquals** _является ложным_ и эффект не срабатывает. |
|`{<field>,"notEquals":"10.0.4.1"}` |Эффект политики |Ни один матч не совпадает |Оба элемента массива оценивают как истинные (10.0.4.1 ! 127.0.0.1 и 10.0.4.1 ! 192.168.1.1), так что условие **notEquals** _верно_ и эффект срабатывает. |
|`"not":{<field>,"notEquals":"127.0.0.1" }` |Эффект политики |Один или несколько совпадений |Один элемент массива оценивает как ложный (127.0.0.1 ! 127.0.0.1) и один как истинный (127.0.0.1 ! » 192.168.1.1), так что условие **notEquals** является _ложным_. Логический оператор оценивает как истинный **(не** _ложный),_ так что эффект срабатывает. |
|`"not":{<field>,"notEquals":"10.0.4.1"}` |Nothing |Один или несколько совпадений |Оба элемента массива оценивают как истинные (10.0.4.1 ! 127.0.0.1 и 10.0.4.1 ! 192.168.1.1), так что условие **notEquals** _верно._ Логический оператор оценивает как ложный **(не** _соответствует действительности),_ так что эффект не срабатывает. |
|`"not":{<field>,"Equals":"127.0.0.1"}` |Эффект политики |Не все совпадают |Один элемент массива оценивается как верный (127.0.0.1 , 127.0.0.1) и один как ложный (127.0.0.1 , 192.168.1.1), поэтому условие **Равные** _ложно._ Логический оператор оценивает как истинный **(не** _ложный),_ так что эффект срабатывает. |
|`"not":{<field>,"Equals":"10.0.4.1"}` |Эффект политики |Не все совпадают |Оба элемента массива оцениваются как ложные (10.0.4.1 q 127.0.0.1 и 10.0.4.1 , 192.168.1.1), поэтому условие **Равные** _является ложным._ Логический оператор оценивает как истинный **(не** _ложный),_ так что эффект срабатывает. |
|`{<field>,"Equals":"127.0.0.1"}` |Nothing |Все матчи |Один элемент массива оценивается как верный (127.0.0.1 , 127.0.0.1) и один как ложный (127.0.0.1 , 192.168.1.1), поэтому условие **Равные** _ложно_ и эффект не срабатывает. |
|`{<field>,"Equals":"10.0.4.1"}` |Nothing |Все матчи |Оба элемента массива оцениваются как ложные (10.0.4.1 q 127.0.0.1 и 10.0.4.1 , 192.168.1.1), поэтому условие **Равные** _является ложным_ и эффект не срабатывает. |

## <a name="the-append-effect-and-arrays"></a>Эффект приложения и массивы

[Эффект приложения](../concepts/effects.md#append) ведет себя по-разному в зависимости от того, является ли **details.field** псевдонимом ** \[ \* ** или нет.

- Если это ** \[ \* ** не псевдоним, приложение заменяет весь массив свойством **значения**
- Когда псевдоним, приложение добавляет свойство значения к существующему массиву или создает новый массив **value** ** \[ \* **

Для получения дополнительной информации смотрите [примеры приложений](../concepts/effects.md#append-examples).

## <a name="next-steps"></a>Дальнейшие действия

- Просмотрите [примеры на примерах политики Azure](../samples/index.md).
- Изучите статью о [структуре определения Политики Azure](../concepts/definition-structure.md).
- Изучите [сведения о действии политик](../concepts/effects.md).
- Понять, как [программно создавать политики.](programmatically-create.md)
- Узнайте, как [исправления несовместимых ресурсов.](remediate-resources.md)
- Просмотрите, что представляет собой группа управления с [организацией ресурсов с группами управления Azure.](../../management-groups/overview.md)
