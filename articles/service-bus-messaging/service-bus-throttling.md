---
title: Обзор регулирования автобусов Azure (ru) Документы Майкрософт
description: Обзор регулирования сервисного автобуса - Стандартные и Премиум уровни.
services: service-bus-messaging
author: axisc
editor: spelluru
ms.service: service-bus-messaging
ms.topic: article
ms.date: 10/01/2019
ms.author: aschhab
ms.openlocfilehash: f852ad70b2eb97e2b8b3e40d086e98b3836c3592
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "77598295"
---
# <a name="throttling-operations-on-azure-service-bus"></a>Операции по дроссельной заслонке на сервисном автобусе Azure

Облачные решения дают представление о неограниченных ресурсах, которые могут масштабироваться с вашей рабочей нагрузкой. Хотя это понятие более верно в облаке, чем в отношении систем, не связанных с помещениями, в облаке по-прежнему существуют ограничения.

Эти ограничения могут привести к задушению запросов клиентских приложений как на уровнях Standard, так и в Премиум, как это обсуждается в этой статье. 

## <a name="throttling-in-azure-service-bus-standard-tier"></a>Заслонка в стандартном уровне сервиса Azure

Уровень Azure Service Bus Standard работает как многотенантная установка с моделью ценообразования с оплатой по мере использования. Здесь несколько областей имен в одном и том же кластере разделяют выделенные ресурсы. Стандартный уровень является рекомендуемым выбором для сред разработчика, тестирования и систем контроля наряду с системами производства с низкой пропускной стоимостью.

В прошлом у Azure Service Bus были грубые ограничения на регулирование, строго зависящие от использования ресурсов. Тем не менее, есть возможность уточнить логику регулирования и обеспечить предсказуемое поведение регулирования для всех областей имен, которые делятся этими ресурсами.

В попытке обеспечить справедливое использование и распределение ресурсов во всех областях имен Azure Service Bus Standard, которые используют одни и те же ресурсы, логика регулирования была изменена, чтобы быть кредитной.

> [!NOTE]
> Важно отметить, что регулирование ***не является чем-то новым*** для Azure Service Bus или любого нативного облачного сервиса.
>
> Кредитное регулирование просто уточняет способ совместного использования ресурсов различными пространствами имен в среде многотентичного стандартного уровня и тем самым обеспечивает справедливое использование всеми пространствами имен, разделяющими ресурсы.

### <a name="what-is-credit-based-throttling"></a>Что такое кредитная заслонка?

Кредитное регулирование ограничивает количество операций, которые могут быть выполнены в данном пространстве имен в определенный период времени. 

Ниже приводится рабочий процесс для кредитной основе регулирования - 

  * В начале каждого периода времени мы предоставляем определенное количество кредитов для каждого пространства имен.
  * Любые операции, выполняемые отправителем или получателем клиентских приложений, будут учитываться в отношении этих кредитов (и вычтены из имеющихся кредитов).
  * Если кредиты исчерпаны, последующие операции будут задушены до начала следующего периода времени.
  * Кредиты пополняются в начале следующего периода времени.

### <a name="what-are-the-credit-limits"></a>Каковы кредитные лимиты?

Кредитные лимиты в настоящее время установлены на '1000' кредитов каждую секунду (в пространстве имен).

Не все операции созданы равными. Вот кредитные расходы каждой из операций - 

| Операция | Стоимость кредита|
|-----------|-----------|
| Операции данных (Отправить, SendAsync, Получить, ReceiveAsync, Peek) |1 кредит за сообщение |
| Операции управления (Создание, Чтение, Обновление, Удаление в очередях, темах, подписках, фильтрах) | 10 кредитов |

> [!NOTE]
> Обратите внимание, что при отправке в тему каждое сообщение оценивается по фильтру (ы) перед тем, как быть доступным в Подписке.
> Каждая оценка фильтра также учитывается в отношении кредитного лимита (т.е. 1 кредит на оценку фильтра).
>

### <a name="how-will-i-know-that-im-being-throttled"></a>Как я узнаю, что меня задушили?

Когда запросы клиентского приложения замедляются, ответ ниже сервера будет получен вашим приложением и зарегистрирован.

```
The request was terminated because the entity is being throttled. Error code: 50009. Please wait 2 seconds and try again.
```

### <a name="how-can-i-avoid-being-throttled"></a>Как я могу избежать задушения?

При общих ресурсах важно обеспечить добросовестное использование в различных областях имен Service Bus, которые разделяют эти ресурсы. Дроссевание гарантирует, что любой всплеск одной рабочей нагрузки не приведет к тому, что другие рабочие нагрузки на тех же ресурсах будут задушены.

Как упоминалось позже в статье, нет никакого риска в том, чтобы быть задушены, потому что клиент SDKs (и другие предложения Azure PaaS) имеют политику повтора по умолчанию, встроенную в них. Любые задушенные запросы будут повторены с экспоненциальным откатом и в конечном итоге пройдут, когда кредиты будут пополнены.

Понятно, что некоторые приложения могут быть чувствительны к задушению. В этом случае рекомендуется [перенести текущее пространство имен Service Bus Standard в Premium.](service-bus-migrate-standard-premium.md) 

Что же в случае миграции, то можно выделить выделенные ресурсы в пространство имен Service Bus и соответствующим образом увеличить масштаб ресурсов при наличии всплеска рабочей нагрузки и снизить вероятность задушения. Кроме того, когда рабочая нагрузка снижается до нормального уровня, можно сократить объем ресурсов, выделяемых в пространство имен.

## <a name="throttling-in-azure-service-bus-premium-tier"></a>Заслонка в Azure Сервис Автобус Премиум уровня

Уровень [Azure Service Bus Premium](service-bus-premium-messaging.md) выделяет выделенные ресурсы, с точки зрения обменов, для каждой настройки пространства имен клиентом. Эти выделенные ресурсы обеспечивают предсказуемую пропускную и задержку и рекомендуются для систем высокого пропускной или чувствительного производственного класса.

Кроме того, уровень Premium также позволяет клиентам увеличить пропускную способность при спайках рабочей нагрузки.

### <a name="how-does-throttling-work-in-service-bus-premium"></a>Как работает регулирование в Сервисном автобусе Premium?

Благодаря эксклюзивному распределению ресурсов для Service Bus Premium регулирование происходит исключительно из-за ограниченности ресурсов, выделяемых на пространство имен.

Если количество запросов больше, чем могут обслуживать текущие ресурсы, то запросы будут задушены.

### <a name="how-will-i-know-that-im-being-throttled"></a>Как я узнаю, что меня задушили?

Существуют различные способы идентификации регулирования в Azure Service Bus Premium - 
  * **Заседоные запросы** отображаются в [метриках Запроса мониторинга Azure,](service-bus-metrics-azure-monitor.md#request-metrics) чтобы определить, сколько запросов было задушено.
  * Высокое **использование процессора** указывает на то, что текущее распределение ресурсов является высоким и запросы могут быть загружены, если текущая рабочая нагрузка не уменьшается.
  * Высокое **использование памяти** указывает на то, что текущее распределение ресурсов является высоким и запросы могут быть загружены, если текущая рабочая нагрузка не уменьшается.

### <a name="how-can-i-avoid-being-throttled"></a>Как я могу избежать задушения?

Поскольку в пространстве имен Service Bus Premium уже есть выделенные ресурсы, можно уменьшить возможность задушения, увеличив масштабирование числа единиц обмена сообщениями, выделенных в ваше пространство имен в случае (или ожидания) всплеска рабочей нагрузки.

Масштабирование вверх/вниз может быть достигнуто путем создания [runbooks,](../automation/automation-create-alert-triggered-runbook.md) которые могут быть вызваны изменениями в вышеуказанных метриках.

## <a name="faqs"></a>Часто задаваемые вопросы

### <a name="how-does-throttling-affect-my-application"></a>Как регулирование влияет на мое приложение?

Когда запрос задушен, это означает, что служба занята, потому что она сталкивается с большим количеством запросов, чем позволяют ресурсы. Если та же операция будет опробована через несколько мгновений, как только служба проработает текущую рабочую нагрузку, запрос может быть выполнен.

Поскольку регулирование — это ожидаемое поведение любого облачного нативного сервиса, мы встроили логику повторной попытки в сам Azure Service Bus SDK. По умолчанию устанавливается автоматическая повторная попытка с экспоненциальным бэк-офф, чтобы гарантировать, что у нас нет одного и того же запроса, который задушил каждый раз.

Логика повтора по умолчанию будет применяться к каждой операции.

### <a name="does-throttling-result-in-data-loss"></a>Приводит ли регулирование к потере данных?

Шины обслуживания Azure оптимизированы для сохранения, мы гарантируем, что все данные, отправленные в Service Bus, будут храниться до того, как служба признает успешность запроса.

Как только запрос успешно 'ACK' (признан) Сервисным автобусом, это означает, что Service Bus успешно обработал запрос. Если Service Bus возвращает 'NACK' (сбой), то это означает, что Service Bus не смог обработать запрос и клиентская заявка должна повторить запрос.

Однако, когда запрос регулируется, служба подразумевает, что она не может принять и обработать запрос прямо сейчас из-за ограниченности ресурсов. Это **не** означает какой-либо потери данных, потому что Service Bus просто не посмотрел на запрос. В этом случае, опираясь на политику повторной попытки по умолчанию в Сервисавтобус SDK гарантирует, что запрос в конечном итоге обрабатывается.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения и примеры использования обмена сообщениями в служебной шине Microsoft Azure см. в следующих дополнительных статьях:

* [Основные сведения об обмене сообщениями через служебную шину](service-bus-messaging-overview.md)
* [Краткое руководство по отправке и получению сообщений Служебной шины Azure с помощью портала Azure и .NET](service-bus-quickstart-portal.md)
* [Руководство. Обновление информации о запасах с помощью портала Azure, разделов и подписок](service-bus-tutorial-topics-subscriptions-portal.md)

