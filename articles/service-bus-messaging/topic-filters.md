---
title: Фильтры разделов в служебной шине Azure | Документация Майкрософт
description: В этой статье объясняется, как подписчики могут определить, какие сообщения они хотят получать от темы, указывая фильтры.
services: service-bus-messaging
documentationcenter: ''
author: clemensv
manager: timlt
editor: ''
ms.service: service-bus-messaging
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/27/2020
ms.author: spelluru
ms.openlocfilehash: b8ffbb16763bfe6485ebf2ab770f4537ddbc8569
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "76774501"
---
# <a name="topic-filters-and-actions"></a>Фильтры и действия разделов

Подписчики могут самостоятельно определять, какие сообщения они хотят получать из раздела. Эти сообщения определяются в одном или нескольких именованных правилах подписки. Каждое правило состоит из условия, которое выбирает определенные сообщения, и действия, которое добавляет к ним заметки. При каждом совпадении с условиями правила подписка создает копию сообщения, каждая из которых может содержать разные заметки в соответствии с разными правилами.

Для каждой новой подписки на раздел устанавливается правило подписки с начальным значением по умолчанию. Если явно не указать условие фильтра для этого правила, применяется фильтр **true**, который отбирает в подписку все сообщения раздела. Для правила по умолчанию не установлено действие по созданию заметок.

Служебная шина поддерживает три условия фильтрации:

-   *Логические фильтры*. **TrueFilter** отбирает все поступившие сообщения (**true**), а **FalseFilter** не отбирает ни одного сообщения (**false**).

-   *Фильтры SQL*. **SqlFilter** содержит SQL-подобное условное выражение, которое вычисляется в брокере для определяемых пользователем свойств и системных свойств каждого поступившего сообщения. Все системные свойства в условном выражении предваряются префиксом `sys.`. [Подмножество языка SQL для условий фильтра](service-bus-messaging-sql-filter.md) может проверять существование свойств (`EXISTS`) и наличие значений Null (`IS NULL`), содержит логические операторы НЕ (NOT), И (AND) и ИЛИ (OR), операторы отношений, умеет выполнять простые арифметические вычисления и простые сопоставления по текстовым шаблонам (`LIKE`).

-   *Фильтры корреляции*. **CorrelationFilter** содержит набор условий, которые сопоставляются с одним или несколькими из пользовательских и системных свойств для каждого поступающего сообщения. Обычно он используется для проверки свойства **CorrelationId**, но вы можете применить его в приложении для оценки свойств **ContentType**, **Label**, ** MessageID**, **ReplyTo**, **ReplyToSessionId**, **SessionId**, **To** или любых определяемых пользователем свойств. Совпадение регистрируется, когда значение свойства поступающего сообщения равно тому значению, которое указано в фильтре корреляции. Для строковых выражений при сравнении учитывается регистр. Если вы укажете несколько свойств для сравнения, фильтр объединяет эти условия логическим оператором И (AND). Это означает, что для регистрации совпадения должны выполняться все условия фильтра.

Все фильтры оценивают только свойства сообщения. Фильтры не умеют работать с текстом сообщения.

Сложные правила фильтрации требуют значительных вычислительных ресурсов. В частности, использование правил фильтрации SQL снижает общую пропускную способность (количество обрабатываемых сообщений) на уровне подписки, раздела и пространства имен. Насколько это возможно, в приложениях вместо фильтров SQL следует применять фильтры корреляции, так как они выполняются значительно быстрее и, соответственно, меньше влияют на пропускную способность.

## <a name="actions"></a>Действия

С помощью условий фильтров SQL можно определить действие, которое добавляет примечания с помощью добавления, удаления или изменения свойств и их значений. Это действие [использует выражение в стиле SQL](service-bus-messaging-sql-filter.md), отдаленно напоминающее синтаксис инструкции SQL UPDATE. Это действие применяется к сообщению после сопоставления, но до помещения в подписку. Все изменения свойств сообщения действуют только для той копии сообщения, которая помещается в подписку.

## <a name="usage-patterns"></a>Варианты использования

Самый простой сценарий использования разделов — копирование в каждую подписку каждого сообщения, отправляемого в раздел, что соответствует режиму широковещательной трансляции.

Фильтры и действия позволяют реализовать еще две группы методов: секционирование и маршрутизацию.

При секционировании фильтры распределяют сообщения по нескольким подпискам на разделы так, что каждое сообщение попадает только в один строго прогнозируемый раздел. Метод секционирования удобен в том случае, если масштаб системы требует обрабатывать много идентичных по функциональности секций, каждая из которых имеет свой контекст и содержит определенное подмножество данных. В качестве примера можно указать данные профилей клиентов. Издатель, отправляющий сообщение в определенный раздел, не обязан понимать, как работает модель секционирования, и даже знать о ее существовании. Сообщение помещается в нужную подписку, из которой его получает обработчик сообщений, настроенный для этой секции.

При маршрутизации фильтры распределяют сообщения между подписками на разделы прогнозируемым образом, но не обязательно уникально. В сочетании с функцией [автоматической переадресации](service-bus-auto-forwarding.md) фильтры разделов позволяют создавать сложные схемы маршрутов в пространстве имен сервисной шины и распространять сообщения внутри региона Azure. Если вы примените Функции Azure или Azure Logic Apps в качестве моста между пространствами имен Служебной шины Azure, вы получите возможность создавать еще более сложные глобальные топологии с прямой интеграцией в бизнес-приложения.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об обмене сообщениями через служебную шину см. в следующих статьях:

* [Очереди, разделы и подписки служебной шины](service-bus-queues-topics-subscriptions.md)
* [Синтаксис SQLFilter](service-bus-messaging-sql-filter.md)
* [Как использовать разделы и подписки служебной шины](service-bus-dotnet-how-to-use-topics-subscriptions.md)