---
title: Сетевая безопасность для сервисного автобуса Azure
description: В этой статье описаны функции сетевой безопасности, такие как теги обслуживания, правила IP-брандмауэра, конечные точки службы и частные конечные точки.
services: service-bus-messaging
documentationcenter: .net
author: axisc
editor: spelluru
ms.service: service-bus-messaging
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 03/13/2020
ms.author: aschhab
ms.openlocfilehash: 95f8c2a3b47b59bab7df909be43dacdb1f9c58f7
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79479284"
---
# <a name="network-security-for-azure-service-bus"></a>Сетевая безопасность для сервисного автобуса Azure 
В этой статье описывается, как использовать следующие функции безопасности в Azure Service Bus: 

- Теги служб
- Правила IP Firewall
- Конечные точки сетевого обслуживания
- Частные конечные точки (предварительный просмотр)


## <a name="service-tags"></a>Теги служб
Тег службы представляет собой группу префиксов IP-адресов из данной службы Azure. Корпорация Майкрософт управляет адресными префиксами, охватываемыми тегом службы, и автоматически обновляет тег службы по мере изменения адресов, снижая сложность частых обновлений правил сетевой безопасности. Для получения дополнительной информации о тегах услуг смотрите [обзор тегов службы](../virtual-network/service-tags-overview.md).

Теги служб можно использовать для определения элементов управления доступом к сети в [группах сетевой безопасности](../virtual-network/security-overview.md#security-rules) или [Azure Firewall.](../firewall/service-tags.md) При создании правил безопасности используйте теги служб вместо конкретных IP-адресов. Указывая имя тега службы (например, **ServiceBus)** в соответствующем *поле источника* или *направления* правила, можно разрешить или отклонить трафик для соответствующей службы.

| Сервисный тег | Назначение | Можно использовать входящие или исходящие? | Может быть региональным? | Можно ли использовать с Azure Firewall? |
| --- | -------- |:---:|:---:|:---:|:---:|:---:|:---:|:---:|
| **СервисБус** | Трафик автобусов Службы Azure, который использует уровень обслуживания Premium. | Исходящие | Да | Да |


## <a name="ip-firewall"></a>Брандмауэр IP-адресов 
По умолчанию пространства имен Service Bus доступны из интернета до тех пор, пока запрос поступает с проверкой подлинности и авторизации. С помощью IP-брандмауэра его можно ограничить только набором адресов IPv4 или диапазонов адресов IPv4 в обозначении [CIDR (Classless Inter-Domain Routing).](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing)

Эта функция полезна в сценариях, в которых автобус Службы Azure должен быть доступен только на некоторых известных сайтах. Правила брандмауэра позволяют настроить правила для приема трафика, исходиющего из определенных адресов IPv4. Например, если вы используете служебный автобус с экспресс-маршрутом Azure Express, можно создать **правило брандмауэра,** позволяющее трафикисироваться только с IP-адресов инфраструктуры, либо адресов корпоративного шлюза NAT. 

Правила БРАНДМС применяются на уровне пространства имен Service Bus. Поэтому они действуют для всех клиентских подключений по любым поддерживаемым протоколам. Любые попытки подключения с IP-адресов, которые не соответствуют правилу разрешенных IP-адресов для пространства имен Служебной шины, отклоняются. В ответе клиенту правило фильтрации IP-адресов не упоминается. Правила фильтрации IP-адресов применяются по порядку, поэтому первое правило, которое соответствует IP-адресу, определяет действие (принять или отклонить).

Для получения дополнительной информации [см.](service-bus-ip-filtering.md)

## <a name="network-service-endpoints"></a>Конечные точки сетевого обслуживания
Интеграция сервисных конечных точек Service Bus с [виртуальной сетью (VNet)](service-bus-service-endpoints.md) обеспечивает безопасный доступ к возможностям обмена сообщениями с рабочих нагрузок, таких как виртуальные машины, которые привязаны к виртуальным сетям, при этом путь сетевого трафика обеспечивается на обоих концах.

Если настроена привязка по крайней мере к одной конечной точке службы подсети виртуальной сети, пространство имен соответствующей Служебной шины принимает трафик только из авторизованных виртуальных сетей. С точки зрения виртуальной сети привязка пространства имен Служебной шины к конечной точке службы настраивает изолированный сетевой туннель от подсети виртуальной сети к службе обмена сообщениями.

Результатом является частная и изолированная взаимосвязь между рабочими нагрузками, связанными с подсетью, и соответствующим пространством имен Служебной шины, несмотря на то что наблюдаемый сетевой адрес конечной точки службы обмена сообщениями находится в общедоступном диапазоне IP-адресов.

> [!IMPORTANT]
> Виртуальные сети поддерживаются только в пространствах имен службы "Служебная шина" [ценовой категории "Премиум"](service-bus-premium-messaging.md).
> 
> При использовании конечных точек службы VNet с помощью Service Bus не следует включать эти конечные точки в приложениях, которые смешивают области имен стандартного и премиум-уровня Service Bus. Потому что стандартный уровень не поддерживает VNets. Конечная точка ограничена только пространствами имен уровня Premium.

### <a name="advanced-security-scenarios-enabled-by-vnet-integration"></a>Расширенные сценарии обеспечения безопасности, доступные при интеграции с виртуальной сетью 

Решения, требующие жесткой и раздельной защиты, где подсети виртуальной сети обеспечивают сегментирование между разделенными службами, обычно все же нуждаются в путях взаимодействия между службами, находящимися в этих секциях.

Любой прямой IP-маршрут между секциями, включая передачу трафика HTTPS через TCP/IP, несет риск использования уязвимостей на сетевом уровне. Службы обмена сообщениями обеспечивают полностью изолированные пути взаимодействия, где сообщения даже записываются на диск при передаче между сторонами. Рабочие нагрузки в двух разных виртуальных сетях, которые связаны с одним и тем же экземпляром Служебной шины, могут эффективно и надежно связываться с использованием сообщений, в то время как целостность границ изолированной сети сохраняется.
 
Это означает, что ваши конфиденциальные облачные решения, влияющие на безопасность, не только получают доступ к ведущим в отрасли надежным, масштабируемым и асинхронным службам обмена сообщениями Azure, но теперь могут использовать обмен сообщениями, чтобы создавать пути передачи данных между защищенными секциями решений. По своей сути такие пути обеспечивают больше безопасности, чем при любом режиме одноранговой связи, включая HTTPS и другие протоколы сокетов TLS.

### <a name="bind-service-bus-to-virtual-networks"></a>Привязать сервисный автобус к виртуальным сетям

*Правила виртуальной сети* — это функция безопасности брандмауэра, которая позволяет контролировать, принимает ли сервер Служебной шины Azure соединения из определенной подсети виртуальной сети.

Привязка пространства имен Служебной шины к виртуальной сети состоит из двух этапов. Сначала необходимо создать **конечную точку службы Виртуальной сети** в подсети Virtual Network и включить ее для **Microsoft.ServiceBus,** как это объясняется в [обзоре конечных точек службы.](service-bus-service-endpoints.md) Добавив конечную точку службы, вы привязываете к ней пространство имен Служебной шины с помощью **правила виртуальной сети**.

Правило виртуальной сети — это связь пространства имен Служебной шины с подсетью виртуальной сети. Пока правило существует, всем рабочим нагрузкам, привязанным к подсети, предоставляется доступ к пространству имен Служебной шины. Служебная шина никогда не устанавливает исходящие подключения и не нуждается в доступе, и поэтому это правило не предоставляет ей доступ к вашей подсети.

Для получения дополнительной информации [см. Как настроить конечные точки виртуального сетевого обслуживания для пространства имен Service Bus](service-bus-service-endpoints.md)

## <a name="private-endpoints"></a>Частные конечные точки

Служба частных ссылок Azure позволяет получить доступ к службам Azure (например, Azure Service Bus, Azure Storage и Azure Cosmos DB) и Azure размещает услуги клиентов/партнеров через **частную конечную точку** в виртуальной сети.

Частная конечная точка — это сетевой интерфейс, который соединяет вас в частном порядке и надежно к службе, работающей на Azure Private Link. Частная конечная точка использует частный IP-адрес из виртуальной сети, по сути перемещая службу в виртуальную сеть. Весь трафик к службе может маршрутизироваться через частную конечную точку, поэтому шлюзы, устройства преобразования сетевых адресов (NAT), подключения ExpressRoute и VPN, а также общедоступные IP-адреса не требуются. Трафик между виртуальной сетью и службой проходит через магистральную сеть Майкрософт, что позволяет избежать рисков общедоступного Интернета. Вы можете подключиться к экземпляру ресурса Azure, обеспечивая наивысшую степень детализации в управлении доступом.

Для получения дополнительной [What is Azure Private Link?](../private-link/private-link-overview.md) информации см.

> [!NOTE]
> Эта функция поддерживается **премиум-уровнем** сервиса Azure Bus. Для получения дополнительной информации о премиальном уровне можно ознакомиться в статье [Service Bus Premium и Standard messaging tiers.](service-bus-premium-messaging.md)
>
> Эта функция в настоящее время в **предварительном просмотре**. 


Для получения дополнительной информации [см. Как настроить частные конечные точки для пространства имен Service Bus](private-link-service.md)


## <a name="next-steps"></a>Дальнейшие действия
См. следующие статьи:

- [Как настроить брандмауэр IP для пространства имен Service Bus](service-bus-ip-filtering.md)
- [Как настроить виртуальные конечные точки сетевого обслуживания для пространства имен Service Bus](service-bus-service-endpoints.md)
- [Как настроить частные конечные точки для пространства имен Service Bus](private-link-service.md)
