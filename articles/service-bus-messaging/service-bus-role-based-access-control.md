---
title: Управление доступом к служебной шине Azure на основе ролей (RBAC) (предварительная версия) | Документация Майкрософт
description: Управление доступом к служебной шине Azure на основе ролей
services: service-bus-messaging
documentationcenter: na
author: axisc
manager: timlt
editor: spelluru
ms.assetid: ''
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/19/2018
ms.author: aschhab
ms.openlocfilehash: 6f5390162ce56a0e77ef41740d7e88f3546c5530
ms.sourcegitcommit: f56b267b11f23ac8f6284bb662b38c7a8336e99b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/28/2019
ms.locfileid: "67444728"
---
# <a name="active-directory-role-based-access-control-preview"></a>Управление доступом к служебной шине Azure на основе ролей (предварительная версия)

Microsoft Azure предоставляет интегрированную систему управления доступом к ресурсам и приложениям на основе Azure Active Directory (Azure AD). С помощью Azure AD вы можете осуществлять управление учетными записями пользователей и приложениями специально для приложений на основе Azure или же объединить в федерацию имеющуюся инфраструктуру Active Directory с Azure AD для обеспечения единого входа на всех компьютерах компании, а также для ресурсов и приложений в Azure. Затем можно назначить эти удостоверения пользователя и приложения Azure AD для глобальных ролей и ролей определенных служб, чтобы предоставить доступ к ресурсам Azure.

Для служебной шины Azure управление пространствами имен и всеми связанными ресурсами через портал Azure и API управления ресурсами Azure уже защищено с помощью модели *управления доступом на основе ролей* (RBAC). Сейчас компонент RBAC для операций среды выполнения доступен в общедоступной предварительной версии.

В приложении, использующем RBAC Azure AD, не нужно обрабатывать правила SAS и ключи, а также любые другие маркеры доступа, относящиеся к служебной шине. Клиентское приложение получает маркер доступа для служебной шины и взаимодействует с Azure AD, чтобы установить контекст аутентификации. С помощью учетных записей пользователей домена, требующих интерактивного входа в систему, приложение не обрабатывает учетные данные напрямую.

## <a name="service-bus-roles-and-permissions"></a>Роли и разрешения служебной шины

Azure предоставляет ниже встроенные роли RBAC для авторизации доступа к пространству имен служебной шины:

* [Владелец данных шины службы Azure (Предварительная версия)](../role-based-access-control/built-in-roles.md#azure-service-bus-data-owner-preview): Обеспечивает доступ к данным к пространству имен служебной шины и его сущностей (очереди, разделы, подписки и фильтры)

>[!IMPORTANT]
> Ранее поддерживается добавление управляемое удостоверение для **«Владелец»** или **«Участник»** роли.
>
> Однако права для доступа к данным **«Владелец»** и **«Участник»** роли больше не будут учитываться. Если вы использовали **«Владелец»** или **«Участник»** роли, то их необходимо будет адаптировать для использования **Azure Service Bus данных» владелец «(Предварительная версия)** роли.

## <a name="use-service-bus-with-an-azure-ad-domain-user-account"></a>Использование служебной шины с помощью учетной записи пользователя домена в Azure AD

Следующий раздел описывает шаги, необходимые для создания и запуска примера приложения, которые запрашиваются интерактивный Azure AD пользователю войти в систему, как предоставить доступ к этой учетной записи пользователя служебной шине и как использовать это удостоверение для доступа к концентраторам событий.

В этом введении описано простое консольное приложение, [код для которого находится на сайте GitHub](https://github.com/Azure/azure-service-bus/tree/master/samples/DotNet/Microsoft.ServiceBus.Messaging/RoleBasedAccessControl).

### <a name="create-an-active-directory-user-account"></a>Создание учетной записи пользователя Active Directory

Первый шаг не является обязательным. Каждая подписка Azure автоматически связана с клиентом Azure Active Directory. Если у вас есть к ней доступ, то она уже зарегистрирована. Это означает, что вы можете использовать имеющуюся учетную запись.

Если вам все же нужно создать учетную запись для этого сценария, [выполните следующие действия](../automation/automation-create-aduser-account.md). Необходимо наличие разрешения на создание учетных записей в клиенте Azure Active Directory. Этот вариант не подходит для крупных корпоративных сценариев.

### <a name="create-a-service-bus-namespace"></a>Создание пространства имен служебной шины

Далее, [создать пространство имен обмена сообщениями служебной шины](service-bus-create-namespace-portal.md).

После создания пространства имен перейдите на страницу **Управление доступом (IAM)** на портале и щелкните **Добавить назначение ролей**, чтобы добавить учетную запись пользователя Azure AD к роли владельца. Если вы используете собственную учетную запись пользователя и создали пространство имен, вам уже назначена роль владельца. Чтобы добавить другую учетную запись в роль, найдите имя веб-приложения в области **Добавление разрешений** в поле **Select** (Выбор), а затем щелкните запись. Нажмите кнопку **Сохранить**.

Теперь учетная запись имеет доступ к пространству имен служебной шины и к ранее созданной очереди.

### <a name="register-the-application"></a>Регистрация приложения

Перед запуском примера приложения зарегистрируйте его в Azure AD и утвердите запрос на продолжение, позволяющий приложению получить доступ к служебной шине Azure от его имени.

Так как образец приложения является консольным, необходимо зарегистрировать собственное приложение и добавить разрешения API для **Microsoft.ServiceBus** в набор необходимых разрешений. Собственным приложениям также необходим **URI перенаправления** в Azure AD, выступающий в качестве идентификатора. URI не должен быть назначением сети. В этом примере используйте `https://servicebus.microsoft.com`, так как в образце кода уже используется этот URI.

Действия для регистрации подробно описаны в [этом руководстве](../active-directory/develop/quickstart-v1-integrate-apps-with-azure-ad.md). Выполните следующие действия, чтобы зарегистрировать **собственное** приложение, а затем следуйте инструкциям по обновлению, чтобы добавить API **Microsoft.ServiceBus** для необходимых разрешений. Выполняя эти действия, запишите значения **TenantId** и **ApplicationId**, так как они необходимы для запуска приложения.

### <a name="run-the-app"></a>Запуск приложения

Перед запуском примера измените файл App.config и в зависимости от вашего сценария установите следующие значения:

- `tenantId`: задайте значение **TenantId**.
- `clientId`: задайте значение **ApplicationId**.
- `clientSecret`: если необходимо войти в систему с помощью секрета клиента, создайте его в Azure AD. Кроме того, используйте веб-приложение или API вместо собственного приложения. Добавьте приложение на страницу **Управление доступом (IAM)** в созданном ранее пространстве имен.
- `serviceBusNamespaceFQDN`: Укажите полное DNS-имя созданного пространства имен Служебной шины (например, `example.servicebus.windows.net`).
- `queueName`: Укажите имя созданной очереди.
- URI перенаправления, указанный в приложении на предыдущих шагах.

При запуске консольного приложения вам будет предложено выбрать сценарий. Щелкните **Interactive User Login** (Вход в систему с учетными данными текущего пользователя), указав его номер и нажав клавишу ВВОД. В приложении отображается окно входа в систему, оно запрашивает ваше согласие на доступ к служебной шине, а затем использует службу для запуска сценария отправки или получения с помощью удостоверения для входа.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительную информацию об обмене сообщениями через служебную шину см. в следующих разделах.

* [Очереди, разделы и подписки служебной шины](service-bus-queues-topics-subscriptions.md)
* [Начало работы с очередями служебной шины](service-bus-dotnet-get-started-with-queues.md)
* [Как использовать разделы и подписки служебной шины](service-bus-dotnet-how-to-use-topics-subscriptions.md)
