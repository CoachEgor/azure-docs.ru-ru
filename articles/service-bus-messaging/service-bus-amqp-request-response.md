---
title: Операции запроса/ответа AMQP 1,0 в служебной шине Azure
description: В этой статье описывается список операций AMQP запросов и ответов в служебная шина Microsoft Azure.
services: service-bus-messaging
documentationcenter: na
author: axisc
editor: spelluru
ms.assetid: ''
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 01/23/2020
ms.author: aschhab
ms.openlocfilehash: 338b411eade35fa357f64131c64b8ef2034c92b0
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "76761089"
---
# <a name="amqp-10-in-microsoft-azure-service-bus-request-response-based-operations"></a>AMQP 1.0 в служебной шине Microsoft Azure: операции c запросами и ответами

В этой статье приводится список операций с запросами и ответами в служебной шине Microsoft Azure. Эта информация основана на использовании рабочего проекта службы управления AMQP версии 1.0.  
  
Подробные инструкции по работе с протоколом AMQP 1.0 на уровне соединения, в которых объясняется, как служебная шина реализует и использует техническую спецификацию OASIS AMQP, см. в руководствах по [использованию протокола AMQP 1.0 в служебной шине и Центрах событий Azure] и [использованию протокола AMQP 1.0].  
  
## <a name="concepts"></a>Основные понятия  
  
### <a name="entity-description"></a>Описание сущности  

Описание сущности касается таких объектов служебной шины, как [класс QueueDescription](/dotnet/api/microsoft.servicebus.messaging.queuedescription), [класс TopicDescription](/dotnet/api/microsoft.servicebus.messaging.topicdescription) и [класс SubscriptionDescription](/dotnet/api/microsoft.servicebus.messaging.subscriptiondescription).  
  
### <a name="brokered-message"></a>Сообщение в брокере  

Сообщение в служебной шине, сопоставленное с сообщением AMQP. Определение сопоставления см. в статье [Руководство по использованию протокола AMQP 1.0 в служебной шине и концентраторах событий Azure](service-bus-amqp-protocol-guide.md).  
  
## <a name="attach-to-entity-management-node"></a>Подключение к узлу управления сущностью  

Все операции, описанные в этом документе, соответствуют шаблону "запрос — ответ", ограничены сущностью, и для их выполнения требуется подключение к узлу управления сущностью.  
  
### <a name="create-link-for-sending-requests"></a>Создание ссылки для отправки запросов  

Создание ссылки на узел управления для отправки запросов.  
  
```
requestLink = session.attach(
role: SENDER,
    target: { address: "<entity address>/$management" },
    source: { address: ""<my request link unique address>" }
)

```
  
### <a name="create-link-for-receiving-responses"></a>Создание ссылки для получения ответов  

Создание ссылки для получения ответов от узла управления.  
  
```
responseLink = session.attach(
role: RECEIVER,
    source: { address: "<entity address>/$management" }
    target: { address: "<my response link unique address>" }
)

```
  
### <a name="transfer-a-request-message"></a>Передача сообщения запроса  

Передача сообщения запроса.  
При необходимости можно добавить transaction-state для операций, которые поддерживают транзакции.

```
requestLink.sendTransfer(
        Message(
                properties: {
                        message-id: <request id>,
                        reply-to: "<my response link unique address>"
                },
                application-properties: {
                        "operation" -> "<operation>",
                }
        ),
        [Optional] State = transactional-state: {
                txn-id: <txn-id>
        }
)
```
  
### <a name="receive-a-response-message"></a>Получение ответного сообщения  

Получение ответного сообщения по ссылке ответа.  
  
```
responseMessage = responseLink.receiveTransfer()
```
  
Ответное сообщение имеет следующий формат:
  
```
Message(
properties: {
        correlation-id: <request id>
    },
    application-properties: {
            "statusCode" -> <status code>,
            "statusDescription" -> <status description>,
           },
)

```
  
### <a name="service-bus-entity-address"></a>Адрес сущности служебной шины  

Адреса сущностей служебной шины составляются следующим образом:  
  
|Тип сущности|Адрес|Пример|  
|-----------------|-------------|-------------|  
|очередь|`<queue_name>`|`“myQueue”`<br /><br /> `“site1/myQueue”`|  
|Раздел|`<topic_name>`|`“myTopic”`<br /><br /> `“site2/page1/myQueue”`|  
|Подписка|`<topic_name>/Subscriptions/<subscription_name>`|`“myTopic/Subscriptions/MySub”`|  
  
## <a name="message-operations"></a>Операции с сообщениями  
  
### <a name="message-renew-lock"></a>Блокировка обновления сообщений  

Продлевает блокировку сообщения до момента времени, указанного в описании сущности.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операции|строка|Да|`com.microsoft:renew-lock`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
 Текст запроса должен включать раздел amqp-value, содержащий схему со следующими элементами.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|`lock-tokens`|Массив UUID|Да|Маркеры блокировки сообщения для обновления.|  

> [!NOTE]
> Маркеры блокировки являются свойством `DeliveryTag` в полученных сообщениях. См. следующий пример в [пакете SDK для .NET](https://github.com/Azure/azure-service-bus-dotnet/blob/6f144e91310dcc7bd37aba4e8aebd535d13fa31a/src/Microsoft.Azure.ServiceBus/Amqp/AmqpMessageConverter.cs#L336) которой их извлекает. Маркер может также отображаться в "DeliveryAnnotations" как "x-opt-lock-token" тем не менее, это не гарантируется и `DeliveryTag` будут иметь больший приоритет. 
> 
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|INT|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|строка|Нет|Описание состояния.|  
  
Текст ответа должен включать раздел amqp-value, содержащий схему со следующими элементами.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|expirations|Массив метки времени|Да|Новый срок действия для маркера блокировки сообщения, который соответствует маркерам блокировки запроса.|  
  
### <a name="peek-message"></a>Просмотр сообщения  

Просмотр сообщений без блокировки.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операции|строка|Да|`com.microsoft:peek-message`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст сообщения запроса должен состоять из раздела **AMQP-value** , содержащего **карту** со следующими записями:  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|`from-sequence-number`|long|Да|Порядковый номер, с которого следует начать просмотр.|  
|`message-count`|INT|Да|Максимальное число просматриваемых сообщений.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|INT|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — есть дополнительные сообщения.<br /><br /> 204: No content — нет сообщений|  
|statusDescription|строка|Нет|Описание состояния.|  
  
Текст ответного сообщения должен состоять из раздела **AMQP-value** , содержащего **карту** со следующими записями:  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|отправляемых из облака на устройство|Список схем|Да|Список сообщений, в котором каждая схема представляет сообщение.|  
  
Схема, представляющая сообщение, должна содержать следующие элементы.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|сообщение|Массив байтов|Да|Сообщение с кодированием линии связи AMQP 1.0.|  
  
### <a name="schedule-message"></a>Расписание сообщения  

Расписание для сообщений. Эта операция поддерживает транзакции.
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операции|строка|Да|`com.microsoft:schedule-message`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст сообщения запроса должен состоять из раздела **AMQP-value** , содержащего **карту** со следующими записями:  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|отправляемых из облака на устройство|Список схем|Да|Список сообщений, в котором каждая схема представляет сообщение.|  
  
Схема, представляющая сообщение, должна содержать следующие элементы.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|message-id|строка|Да|`amqpMessage.Properties.MessageId` в качестве строки|  
|session-id|строка|Нет|`amqpMessage.Properties.GroupId as string`|  
|partition-key|строка|Нет|`amqpMessage.MessageAnnotations.”x-opt-partition-key"`|
|via-partition-key|строка|Нет|`amqpMessage.MessageAnnotations."x-opt-via-partition-key"`|
|сообщение|Массив байтов|Да|Сообщение с кодированием линии связи AMQP 1.0.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|INT|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|строка|Нет|Описание состояния.|  
  
Текст ответного сообщения должен состоять из раздела **AMQP-value** , содержащего карту со следующими записями:  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|sequence-numbers|Массив длинных чисел|Да|Порядковый номер запланированных сообщений. Порядковый номер используется для отмены.|  
  
### <a name="cancel-scheduled-message"></a>Отмена запланированного сообщения  

Отмена запланированных сообщений.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операции|строка|Да|`com.microsoft:cancel-scheduled-message`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст сообщения запроса должен состоять из раздела **AMQP-value** , содержащего **карту** со следующими записями:  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|sequence-numbers|Массив длинных чисел|Да|Порядковый номер запланированных сообщений для отмены.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|INT|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|строка|Нет|Описание состояния.|   
  
## <a name="session-operations"></a>Операции на уровне сеанса  
  
### <a name="session-renew-lock"></a>Блокировка обновления сеанса  

Продлевает блокировку сообщения до момента времени, указанного в описании сущности.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операции|строка|Да|`com.microsoft:renew-session-lock`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст сообщения запроса должен состоять из раздела **AMQP-value** , содержащего **карту** со следующими записями:  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|session-id|строка|Да|Идентификатор сеанса.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|INT|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — есть дополнительные сообщения.<br /><br /> 204: No content — нет сообщений|  
|statusDescription|строка|Нет|Описание состояния.|  
  
Текст ответного сообщения должен состоять из раздела **AMQP-value** , содержащего карту со следующими записями:  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|expiration|TIMESTAMP|Да|Новый срок действия.|  
  
### <a name="peek-session-message"></a>Просмотр сообщения сеанса  

Просмотр сообщений сеанса без блокировки.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операции|строка|Да|`com.microsoft:peek-message`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст сообщения запроса должен состоять из раздела **AMQP-value** , содержащего **карту** со следующими записями:  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|from-sequence-number|long|Да|Порядковый номер, с которого следует начать просмотр.|  
|message-count|INT|Да|Максимальное число просматриваемых сообщений.|  
|session-id|строка|Да|Идентификатор сеанса.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|INT|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — есть дополнительные сообщения.<br /><br /> 204: No content — нет сообщений|  
|statusDescription|строка|Нет|Описание состояния.|  
  
Текст ответного сообщения должен состоять из раздела **AMQP-value** , содержащего карту со следующими записями:  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|отправляемых из облака на устройство|Список схем|Да|Список сообщений, в котором каждая схема представляет сообщение.|  
  
 Схема, представляющая сообщение, должна содержать следующие элементы.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|сообщение|Массив байтов|Да|Сообщение с кодированием линии связи AMQP 1.0.|  
  
### <a name="set-session-state"></a>Установка состояния сеанса  

Установка состояния сеанса.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операции|строка|Да|`com.microsoft:set-session-state`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст сообщения запроса должен состоять из раздела **AMQP-value** , содержащего **карту** со следующими записями:  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|session-id|строка|Да|Идентификатор сеанса.|  
|session-state|Массив байтов|Да|Непрозрачные двоичные данные.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|INT|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|строка|Нет|Описание состояния.|  
  
### <a name="get-session-state"></a>Получение состояния сеанса  

Получение состояния сеанса.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операции|строка|Да|`com.microsoft:get-session-state`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст сообщения запроса должен состоять из раздела **AMQP-value** , содержащего **карту** со следующими записями:  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|session-id|строка|Да|Идентификатор сеанса.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|INT|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|строка|Нет|Описание состояния.|  
  
Текст ответного сообщения должен состоять из раздела **AMQP-value** , содержащего **карту** со следующими записями:  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|session-state|Массив байтов|Да|Непрозрачные двоичные данные.|  
  
### <a name="enumerate-sessions"></a>Перечисление сеансов  

Перечисление сеансов в сущности обмена сообщениями.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операции|строка|Да|`com.microsoft:get-message-sessions`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст сообщения запроса должен состоять из раздела **AMQP-value** , содержащего **карту** со следующими записями:  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|last-updated-time|TIMESTAMP|Да|Фильтр включает только сеансы, обновленные после указанного времени.|  
|skip|INT|Да|Пропуск определенного числа сеансов.|  
|top|INT|Да|Максимальное число сеансов.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|INT|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — есть дополнительные сообщения.<br /><br /> 204: No content — нет сообщений|  
|statusDescription|строка|Нет|Описание состояния.|  
  
Текст ответного сообщения должен состоять из раздела **AMQP-value** , содержащего **карту** со следующими записями:  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|skip|INT|Да|Количество пропущенных сеансов, если код состояния равен 200.|  
|sessions-ids|Массив строк|Да|Массив идентификаторов, если код состояния равен 200.|  
  
## <a name="rule-operations"></a>Операции с правилами  
  
### <a name="add-rule"></a>Добавление правила  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операции|строка|Да|`com.microsoft:add-rule`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст сообщения запроса должен состоять из раздела **AMQP-value** , содержащего **карту** со следующими записями:  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|rule-name|строка|Да|Имя правила без учета имени подписки и раздела.|  
|rule-description|карта|Да|Описание правила, как указано в следующем разделе.|  
  
Схема " **правило-описание** " должна включать следующие записи, в которых фильтр **SQL-Filter** и **корреляции** являются взаимоисключающими:  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|sql-filter|карта|Да|`sql-filter`, как указано в следующем разделе.|  
|correlation-filter|карта|Да|`correlation-filter`, как указано в следующем разделе.|  
|sql-rule-action|карта|Да|`sql-rule-action`, как указано в следующем разделе.|  
  
Схема sql-filter должна включать следующие элементы.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|expression|строка|Да|Выражение фильтра SQL.|  
  
Сопоставление **фильтра корреляции** должно включать хотя бы одну из следующих записей:  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|correlation-id|строка|Нет||  
|message-id|строка|Нет||  
|значение|строка|Нет||  
|reply-to|строка|Нет||  
|label|строка|Нет||  
|session-id|строка|Нет||  
|reply-to-session-id|строка|Нет||  
|content-type|строка|Нет||  
|properties|карта|Нет|Сопоставляется с [BrokeredMessage.Properties](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) в служебной шине.|  
  
Схема **SQL-Rule-Action** должна включать следующие элементы:  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|expression|строка|Да|Выражение действия SQL.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|INT|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|строка|Нет|Описание состояния.|  
  
### <a name="remove-rule"></a>Удаление правила  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операции|строка|Да|`com.microsoft:remove-rule`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст сообщения запроса должен состоять из раздела **AMQP-value** , содержащего **карту** со следующими записями:  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|rule-name|строка|Да|Имя правила без учета имени подписки и раздела.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|INT|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|строка|Нет|Описание состояния.|  
  
### <a name="get-rules"></a>Получение правил

#### <a name="request"></a>Запрос

Сообщение запроса должно включать следующие свойства приложения.

|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операции|строка|Да|`com.microsoft:enumerate-rules`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  

Текст сообщения запроса должен состоять из раздела **AMQP-value** , содержащего **карту** со следующими записями:  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|top|INT|Да|Число получаемых правил на странице.|  
|skip|INT|Да|Число пропускаемых правил. Определяет начальный индекс (+1) списка правил. | 

#### <a name="response"></a>Ответ

Ответное сообщение содержит следующие свойства.

|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|INT|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|правила| Массив сопоставлений|Да|Массив правил. Каждое правило представлено сопоставлением.|

Каждая запись сопоставления в массиве содержит следующие свойства.

|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|rule-description|Массив описанных объектов|Да|`com.microsoft:rule-description:list` с описанным кодом AMQP 0x0000013700000004| 

`com.microsoft.rule-description:list` представляет собой массив описанных объектов. Массив содержит следующие элементы.

|Индекс|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
| 0 | Массив описанных объектов | Да | `filter`, как указано ниже. |
| 1 | Массив описанных объектов | Да | `ruleAction`, как указано ниже. |
| 2 | строка | Да | Имя правила. |

`filter` может быть одного из приведенных ниже типов.

| Имя дескриптора | Код дескриптора | Значение |
| --- | --- | ---|
| `com.microsoft:sql-filter:list` | 0x000001370000006 | Фильтр SQL |
| `com.microsoft:correlation-filter:list` | 0x000001370000009 | Фильтр корреляции |
| `com.microsoft:true-filter:list` | 0x000001370000007 | Фильтр значений True, представляющий схему 1=1 |
| `com.microsoft:false-filter:list` | 0x000001370000008 | Фильтр значений False, представляющий схему 1=0 |

`com.microsoft:sql-filter:list` представляет собой описанный массив, который включает в себя следующие элементы.

|Индекс|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
| 0 | строка | Да | Выражение фильтра SQL |

`com.microsoft:correlation-filter:list` представляет собой описанный массив, который включает в себя следующие элементы.

|Индекс (если существует)|Тип значения|Содержимое значения|  
|---------|----------------|--------------|
| 0 | строка | Идентификатор корреляции |
| 1 | строка | Идентификатор сообщения |
| 2 | строка | Кому |
| 3 | строка | Ответить |
| 4 | строка | Метка |
| 5 | строка | Идентификатор сеанса |
| 6 | строка | Ответ на идентификатор сеанса|
| 7 | строка | Тип содержимого |
| 8 | Схема | Сопоставление определенных приложением свойств |

`ruleAction` может быть одного из приведенных ниже типов.

| Имя дескриптора | Код дескриптора | Значение |
| --- | --- | ---|
| `com.microsoft:empty-rule-action:list` | 0x0000013700000005 | Пустое правило действия: действие правила отсутствует |
| `com.microsoft:sql-rule-action:list` | 0x0000013700000006 | Действие правила SQL |

`com.microsoft:sql-rule-action:list` представляет собой массив описанных объектов, первая запись которого является строкой, содержащей выражение действия правила SQL.

## <a name="deferred-message-operations"></a>Операции с отложенными сообщениями  
  
### <a name="receive-by-sequence-number"></a>Получение по порядковому номеру  

Получение отложенных сообщений по порядковым номерам.  
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операции|строка|Да|`com.microsoft:receive-by-sequence-number`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст сообщения запроса должен состоять из раздела **AMQP-value** , содержащего **карту** со следующими записями:  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|sequence-numbers|Массив длинных чисел|Да|Порядковые номера.|  
|receiver-settle-mode|ubyte|Да|Режим **сопоставления приемника** , как указано в AMQP Core v 1.0.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|INT|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|строка|Нет|Описание состояния.|  
  
Текст ответного сообщения должен состоять из раздела **AMQP-value** , содержащего **карту** со следующими записями:  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|отправляемых из облака на устройство|Список схем|Да|Список сообщений, в котором каждая схема представляет сообщение.|  
  
Схема, представляющая сообщение, должна содержать следующие элементы.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|lock-token|uuid|Да|Маркер блокировки, если значение `receiver-settle-mode` равно -1.|  
|сообщение|Массив байтов|Да|Сообщение с кодированием линии связи AMQP 1.0.|  
  
### <a name="update-disposition-status"></a>Обновление состояния метода обработки  

Обновление состояния метода обработки для отложенных сообщений. Эта операция поддерживает транзакции.
  
#### <a name="request"></a>Запрос  

Сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|операции|строка|Да|`com.microsoft:update-disposition`|  
|`com.microsoft:server-timeout`|uint|Нет|Время ожидания ответа от сервера, на котором выполняется операция, в миллисекундах.|  
  
Текст сообщения запроса должен состоять из раздела **AMQP-value** , содержащего **карту** со следующими записями:  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|disposition-status|строка|Да|выполнено<br /><br /> abandoned (прервано)<br /><br /> suspended (приостановлено)|  
|lock-tokens|Массив UUID|Да|Маркеры блокировки сообщения для обновления состояния метода обработки.|  
|deadletter-reason|строка|Нет|Может быть задано, если состояние метода обработки имеет значение **suspended**.|  
|deadletter-description|строка|Нет|Может быть задано, если состояние метода обработки имеет значение **suspended**.|  
|properties-to-modify|карта|Нет|Список свойств сообщений в брокере служебной шины, подлежащих изменению.|  
  
#### <a name="response"></a>Ответ  

Ответное сообщение запроса должно включать следующие свойства приложения.  
  
|Клавиши|Тип значения|Обязательный|Содержимое значения|  
|---------|----------------|--------------|--------------------|  
|statusCode|INT|Да|Код ответа HTTP [RFC2616].<br /><br /> 200: ОК — операция выполнена успешно; в противном случае — сбой.|  
|statusDescription|строка|Нет|Описание состояния.|

## <a name="next-steps"></a>Дальнейшие шаги

Сведения о служебной шине и AMQP см. по следующим ссылкам.

* [Протокол AMQP служебной шины — обзор]
* [Руководство по использованию протокола AMQP 1.0]
* [Протокол AMQP служебной шины для Windows Server]

[Протокол AMQP служебной шины — обзор]: service-bus-amqp-overview.md
[Руководство по использованию протокола AMQP 1.0]: service-bus-amqp-protocol-guide.md
[Протокол AMQP служебной шины для Windows Server]: https://docs.microsoft.com/previous-versions/service-bus-archive/dn282144(v=azure.100)
