---
title: Мигрировать пространства имен Azure Service Bus - стандарт для премиум
description: Руководство, позволяющее переносить существующие стандартные пространства имен Azure Service Bus в премиум-пространство
services: service-bus-messaging
documentationcenter: ''
author: axisc
editor: spelluru
ms.service: service-bus-messaging
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/18/2019
ms.author: aschhab
ms.openlocfilehash: 27e3260b91bebee14ff12188a7dbd6c7cf76355c
ms.sourcegitcommit: e040ab443f10e975954d41def759b1e9d96cdade
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/29/2020
ms.locfileid: "80385033"
---
# <a name="migrate-existing-azure-service-bus-standard-namespaces-to-the-premium-tier"></a>Перенести существующие стандартные пространства имен Azure Service Bus на уровень премиум-класса

Ранее Azure Service Bus предлагала пространства имен только на стандартном уровне. Namespaces — это мультитенантные настройки, оптимизированные для сред с низкой пропускной устойчивостью и разработчиком. Премиум-уровень предлагает выделенные ресурсы на одну область имен для предсказуемой задержки и увеличения пропускной связи по фиксированной цене. Премиум-уровень оптимизирован для высокой пропускной и производственной среды, которые требуют дополнительных корпоративных функций.

В этой статье описывается, как перенести существующие стандартные области имен на премиум-уровень.  

>[!WARNING]
> Миграция предназначена для обновления стандартных именных пространств Service Bus до премиум-уровня. Инструмент миграции не поддерживает понижение.

Некоторые из моментов, чтобы отметить:

- Эта миграция должна произойти на месте, а это означает, что существующие приложения отправителя и получателя **не требуют каких-либо изменений в коде или конфигурации.** Существующая строка соединения автоматически указывает на новое премиум-пространство имен.
- **Премиальное** пространство имен не должно иметь в нем **сущностей** для успешной миграции.
- Все **сущности** в стандартном пространстве имен **копируются** в премиум-пространство имен во время процесса миграции.
- Миграция поддерживает **1000 сущностей на единицу обмена сообщениями** на премиум-уровне. Чтобы определить, сколько единиц обмена сообщениями вам нужно, начните с количества сущностей, которые у вас есть в текущем стандартном пространстве имен.
- Вы не можете напрямую перейти от **базового уровня** к **премиум-уровня,** но вы можете сделать это косвенно, переходя от базового к стандарту, а затем от стандарта к премиум уровень в следующем шаге.

## <a name="migration-steps"></a>Этапы миграции

Некоторые условия связаны с процессом миграции. Ознакомьтесь со следующими шагами, чтобы уменьшить вероятность ошибок. Эти шаги определяют процесс миграции, а пошаговые детали перечислены в следующих разделах.

1. Создайте новое премиальное пространство имен.
1. Соедините стандартные и премиальные пространства имен друг к другу.
1. Синхронизация (копирование) сущностей от стандарта до премиального пространства имен.
1. Совершите миграцию.
1. Слейте объекты в стандартном пространстве имен, используя имя пространства имен после миграции.
1. Удалите стандартное пространство имен.

>[!IMPORTANT]
> После того, как миграция была совершена, получите доступ к старому стандартному пространству имен и истощаем очереди и подписки. После того, как сообщения были осушены, они могут быть отправлены в новое премиум-пространство имен для обработки приложениями-получателями. После того, как очереди и подписки были исчерпаны, мы рекомендуем удалить старое стандартное пространство имен.

### <a name="migrate-by-using-the-azure-cli-or-powershell"></a>Мигрировать с помощью Azure CLI или PowerShell

Чтобы перенести стандартное пространство имен Service Bus в премиум, используя инструмент Azure CLI или PowerShell, выполните следующие действия.

1. Создайте новое премиальное пространство для обслуживания автобусов. Вы можете ссылаться на [шаблоны менеджера ресурсов Azure](service-bus-resource-manager-namespace.md) или [использовать портал Azure.](service-bus-create-namespace-portal.md) Обязательно выберите **премиум** для параметра **serviceBusSku.**

1. Установите следующие переменные среды для упрощения команд миграции.

   ```
   resourceGroup = <resource group for the standard namespace>
   standardNamespace = <standard namespace to migrate>
   premiumNamespaceArmId = <Azure Resource Manager ID of the premium namespace to migrate to>
   postMigrationDnsName = <post migration DNS name entry to access the standard namespace>
   ```

    >[!IMPORTANT]
    > Для доступа к старому стандартному пространству имен будет использоваться псевдоним/имя (post_migration_dns_name) после миграции. Используйте это, чтобы истощить очереди и подписки, а затем удалите пространство имен.

1. Соедините стандартные и премиальные пространства имен и начните синхронизацию с помощью следующей команды:

    ```azurecli-interactive
    az servicebus migration start --resource-group $resourceGroup --name $standardNamespace --target-namespace $premiumNamespaceArmId --post-migration-name $postMigrationDnsName
    ```

1. Проверьте состояние миграции с помощью следующей команды:

    ```azurecli-interactive
    az servicebus migration show --resource-group $resourceGroup --name $standardNamespace
    ```

    Миграция считается полной, когда вы видите следующие значения:

    * МиграцияГосударство - "Активный"
    * ожидающие ожиданияРепликиОперацииСчет No 0
    * подготовкаГосударство - "Успешно"

    Эта команда также отображает конфигурацию миграции. Проверьте, чтобы убедиться, что значения настроены правильно. Также проверьте преминное пространство имен на портале, чтобы убедиться, что все очереди и темы были созданы, и что они соответствуют тому, что существовало в стандартном пространстве имен.

1. Совершить миграцию, выполняя следующую полную команду:

   ```azurecli-interactive
   az servicebus migration complete --resource-group $resourceGroup --name $standardNamespace
   ```

### <a name="migrate-by-using-the-azure-portal"></a>Мигрировать с помощью портала Azure

Миграция с помощью портала Azure имеет тот же логический поток, что и миграция с помощью команд. Выполните следующие действия, чтобы мигрировать с помощью портала Azure.

1. В меню **Навигации** в левом стеле выберите **Migrate to premium.** Нажмите кнопку **Get Started,** чтобы продолжить работу на следующей странице.
    ![Страница посадки миграции][]

1. Полная **настройка**.
   ![Настройка пространства имен][]
   1. Создайте и назначайте пространство премиум-имен для переноса существующего стандартного пространства имен.
        ![Настройка пространства имен - создание премиального пространства имен][]
   1. Выберите **имя после миграции.** Это имя будет использоваться для доступа к стандартному пространству имен после завершения миграции.
        ![Настройка пространства имен - выбрать имя пост-миграции][]
   1. Выберите **"Следующий"** для продолжения.
1. Синхронизация сущностей между стандартными и премиальными пространствами имен.
    ![Пространство имен настройки - сущности синхронизации - начало][]

   1. Выберите **Start Sync,** чтобы начать синхронизацию сущностей.
   1. Выберите **Да** в диалоговом поле для подтверждения и запуска синхронизации.
   1. Подождите, пока синхронизация будет завершена. Статус доступен в панели статуса.
        ![Пространство имен настройки - сущности синхронизации - прогресс][]
        >[!IMPORTANT]
        > Если по какой-либо причине необходимо прервать миграцию, пожалуйста, просмотрите поток прерывания в разделе часто задаваемых вопросов этого документа.
   1. После завершения синхронизации выберите **«Следующий»** в нижней части страницы.

1. Просмотр изменений на сводной странице. Выберите **Полную миграцию** для переключения пространства имен и завершения миграции.
    ![Пространство имен переключателя - меню переключения][]  
    Страница подтверждения появляется по завершении миграции.
    ![Пространство имен переключателя - успех][]

## <a name="caveats"></a>Предупреждения

Некоторые функции, предоставляемые уровнем Azure Service Bus Standard, не поддерживаются уровнем Azure Service Bus Premium. Они разработаны, так как премиум-уровня предлагает выделенные ресурсы для предсказуемой пропускной их и задержки.

Вот список функций, не поддерживаемых Premium и их смягчение -

### <a name="express-entities"></a>Экспресс-сущности

   Экспресс-сущности, которые не фиксируют данные сообщений для хранения, не поддерживаются в Premium. Выделенные ресурсы обеспечили значительное улучшение пропускной ситуации при обеспечении сохранения данных, как это ожидается от любой корпоративной системы обмена сообщениями.

   Во время миграции любое из ваших экспресс-сущностей в пространстве имен Стандарта будет создано в пространстве имен Premium как неэкспрессовое.

   Если вы используете шаблоны Azure Resource Manager (ARM), пожалуйста, убедитесь, что вы удалите флаг "enableExpress" из конфигурации развертывания, чтобы автоматизированные рабочие процессы выполнялись без ошибок.

### <a name="partitioned-entities"></a>Разделенные сущности

   Разделители были поддержаны в стандартном уровне, чтобы обеспечить лучшую доступность в мультитенантной установке. С предоставлением выделенных ресурсов, доступных для одного пространства имен на уровне Premium, это больше не требуется.

   Во время миграции любая разделенная сущность в пространстве стандартных имен создается в пространстве имен Premium как неразделимое.

   Если ваш шаблон ARM устанавливает 'enablePartitioning' к 'истинному' для определенной очереди или темы, то он будет проигнорирован брокером.

## <a name="faqs"></a>Часто задаваемые вопросы

### <a name="what-happens-when-the-migration-is-committed"></a>Что происходит при совершении миграции?

После того, как миграция будет зафиксирована, строка соединения, упомянувавнемый на стандартное пространство имен, укажет на премиальное пространство имен.

Приложения отправителя и получателя будут отключены от стандартного Namespace и автоматически подключатся к премиальному пространству имен.

### <a name="what-do-i-do-after-the-standard-to-premium-migration-is-complete"></a>Что делать после завершения стандарта для премиум-миграции?

Стандарт для миграции премиум гарантирует, что метаданные сущности, такие как темы, подписки и фильтры, будут скопированы из стандартного пространства имен в премиум-пространство имен. Данные сообщений, которые были зафиксированы в стандартном пространстве имен, не скопированы из стандартного пространства имен в премиум-пространство.

Стандартное пространство имен может иметь некоторые сообщения, которые были отправлены и зафиксированы во время миграции. Вручную исчерпывать эти сообщения из стандартного Namespace и вручную отправлять их в премиальное namespace. Чтобы вручную слить сообщения, используйте консольное приложение или скрипт, который истощает стандартные объекты пространства имен, используя имя DNS Post Migration, указанное в командах миграции. Отправить эти сообщения в премиум-пространство имен, чтобы они могли быть обработаны приемниками.

После того, как сообщения были осушены, удалите стандартное пространство имен.

>[!IMPORTANT]
> После того, как сообщения из стандартного пространства имен были исчерпаны, удалите стандартное пространство имен. Это важно, потому что строка соединения, которая первоначально относилась к стандартному пространству имен, теперь относится к премиальному пространству имен. Стандартное пространство имен больше не понадобится. Уменьшение стандартного пространства имен, которое вы мигрировали, помогает уменьшить более позднюю путаницу.

### <a name="how-much-downtime-do-i-expect"></a>Сколько простоев я ожидаю?

Процесс миграции призван сократить ожидаемое время простоя для приложений. Время простоя сокращается за счет строки подключения, которую используют отправитель и приложения получателя, чтобы указать на новое премиальное пространство имен.

Время простоя, которое испытывает приложение, ограничено временем, заданным обновлением ввода DNS, чтобы указать на премиальное пространство имен. Время простоя составляет около 5 минут.

### <a name="do-i-have-to-make-any-configuration-changes-while-doing-the-migration"></a>Должен ли я вносить какие-либо изменения конфигурации при выполнении миграции?

Нет, для миграции не требуется никаких изменений кода или конфигурации. Строка подключения, используемая отправителем и приемником для доступа к стандартному Namespace, автоматически отображается в качестве псевдонима для премиального пространства имен.

### <a name="what-happens-when-i-abort-the-migration"></a>Что происходит, когда я прерываю миграцию?

Миграция может быть прервана либо `Abort` с помощью команды, либо с помощью портала Azure.

#### <a name="azure-cli"></a>Azure CLI

```azurecli-interactive
az servicebus migration abort --resource-group $resourceGroup --name $standardNamespace
```

#### <a name="azure-portal"></a>Портал Azure

![Поток прерывания - прерывание синхронизации][]
![Прерывание потока - прерывание полного][]

Когда процесс миграции прерывается, он прерывает процесс копирования сущностей (темы, подписки и фильтры) от стандарта к премиальному пространству имен и ломает сопряжение.

Строка соединения не обновляется, чтобы указать на премиум-пространство имен. Существующие приложения продолжают работать так же, как и до начала миграции.

Тем не менее, он не удаляет сущности на премиум-пространстве имен или удалить премиум-пространство имен. Удалите сущности вручную, если вы решили не двигаться вперед с миграцией.

>[!IMPORTANT]
> Если вы решили прервать миграцию, удалите премиальное namespace, которое вы предусмотрели для миграции, чтобы с вас не взимали плату за ресурсы.

#### <a name="i-dont-want-to-have-to-drain-the-messages-what-do-i-do"></a>Я не хочу, чтобы осушить сообщения. Что делать?

Во время миграции и непосредственно перед совершением миграции могут быть сообщения, отправляемые приложениями отправителя и совершаемые в хранилище в стандартном пространстве имен.

Во время миграции фактические данные сообщения/полезная нагрузка не копируется со стандарта в премиум-пространство имен. Сообщения должны быть вручную осушены, а затем отправлены в премиум-пространство имен.

Однако, если вы можете мигрировать во время запланированного окна обслуживания/домашнего хозяйства, и вы не хотите вручную слить и отправить сообщения, выполните следующие действия:

1. Остановить приложения отправителя. Приложения-приемники обрабатывают сообщения, которые в настоящее время находятся в стандартном пространстве имен, и истощают очередь.
1. После того, как очереди и подписки в стандартном пространстве имен пустуют, следуйте описанной ранее процедуре для выполнения миграции из стандарта в премиальное пространство имен.
1. После завершения миграции можно перезапустить приложения отправителя.
1. Отправители и получатели теперь автоматически подключаются к премиальном пространстве имен.

    >[!NOTE]
    > Вам не нужно останавливать приложения для получения миграции.
    >
    > После завершения миграции приложения приемника отключаются от стандартного пространства имен и автоматически подключаются к премиальному пространству имен.

## <a name="next-steps"></a>Дальнейшие действия

* Узнайте больше о [различиях между стандартным и премиум-сообщениями.](./service-bus-premium-messaging.md)
* Узнайте об [аспектах высокой доступности и восстановления гео-катастроф для премии Service Bus.](service-bus-outages-disasters.md#protecting-against-outages-and-disasters---service-bus-premium)

[Страница посадки миграции]: ./media/service-bus-standard-premium-migration/1.png
[Настройка пространства имен]: ./media/service-bus-standard-premium-migration/2.png
[Настройка пространства имен - создание премиального пространства имен]: ./media/service-bus-standard-premium-migration/3.png
[Настройка пространства имен - выбрать имя пост-миграции]: ./media/service-bus-standard-premium-migration/4.png
[Пространство имен настройки - сущности синхронизации - начало]: ./media/service-bus-standard-premium-migration/5.png
[Пространство имен настройки - сущности синхронизации - прогресс]: ./media/service-bus-standard-premium-migration/8.png
[Пространство имен переключателя - меню переключения]: ./media/service-bus-standard-premium-migration/9.png
[Пространство имен переключателя - успех]: ./media/service-bus-standard-premium-migration/12.png

[Поток прерывания - синхронизация прерывания]: ./media/service-bus-standard-premium-migration/abort1.png
[Поток прерывания - прерывание полного]: ./media/service-bus-standard-premium-migration/abort3.png
