---
title: Краткое руководство. Тестирование базы знаний с использованием пакетных вопросов
description: Используйте средство пакетного тестирования QnA Maker для тестирования баз знаний в ресурсе QnA Maker с использованием ожидаемых ответов, оценок достоверности и многоэтапных запросов.
ms.service: cognitive-services
ms.subservice: qna-maker
ms.topic: tutorial
ms.date: 05/26/2020
ms.openlocfilehash: ac406761abf922ff5f0d86eacd3e419c374ce096
ms.sourcegitcommit: ef69245ca06aa16775d4232b790b142b53a0c248
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2020
ms.locfileid: "91776771"
---
# <a name="quickstart-test-knowledge-base-with-batch-questions-and-expected-answers"></a>Краткое руководство. Тестирование базы знаний с использованием пакетных вопросов и ожидаемых ответов

Используйте средство пакетного тестирования QnA Maker для тестирования баз знаний в ресурсе QnA Maker с использованием ожидаемых ответов, оценок достоверности и многоэтапных запросов.

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure — [создайте бесплатную учетную запись](https://azure.microsoft.com/free/cognitive-services/).
* [Создайте новую службу QnA Maker](create-publish-knowledge-base.md) или используйте существующую, в которой применяется английский язык.
* Скачайте [файл `.docx` с многоэтапным запросом](https://github.com/Azure-Samples/cognitive-services-sample-data-files/blob/master/qna-maker/data-source-formats/multi-turn.docx).
* Скачайте [средство пакетного тестирования](https://aka.ms/qnamakerbatchtestingtool) и извлеките исполняемый файл из файла `.zip`.

## <a name="sign-into-qna-maker-portal"></a>Вход на портал QnA Maker

[Войдите](https://www.qnamaker.ai/) на портал QnA Maker.

## <a name="create-a-new-knowledge-base-from-the-multi-turn-sampledocx-file"></a>Создание новой базы знаний из файла sample.docx с многоэтапным запросом

1. Щелкните **Create a knowledge base** (Создать базу знаний) на панели инструментов.
1. Пропустите **шаг 1**, так как ресурс QnA Maker у вас уже есть. Перейдите к **шагу 2**, чтобы выбрать сведения об существующем ресурсе:
    * идентификатор Azure Active Directory;
    * имя подписки Azure;
    * имя службы Azure QnA;
    * язык (английский).
1. В качестве имени для базы знаний введите значение `Multi-turn batch test quickstart`.

1. На **шаге 4** настройте параметры, используя значения из приведенной ниже таблицы.

    |Параметр|Значение|
    |--|--|
    |**Enable multi-turn extraction from URLs, .pdf or .docx files** (Включить многоэтапное извлечение из URL-адресов, файлов .pdf или .docx)|Флажок установлен|
    |**Текст ответа по умолчанию**| `Batch test - default answer not found.`|
    |**+ Добавить файл**|Выберите скачанный файл `.docx`, который указан в списке необходимых компонентов.|
    |**Chit-chat** (Беседа)|Выберите значение **Professional** (Профессиональная)|

1. На **шаге 5** щелкните **Create your KB** (Создать базу знаний).

    Когда процесс создания завершится, портал отобразит доступную для редактирования базу знаний.

## <a name="save-train-and-publish-knowledge-base"></a>Сохранение, обучение и публикация базы знаний

1. Щелкните **Save and Train** (Сохранить и обучить) на панели инструментов, чтобы сохранить базу знаний.
1. Щелкните **Publish** (Опубликовать) на панели инструментов, а затем снова щелкните **Publish** (Опубликовать), чтобы опубликовать базу знаний. Публикация делает базу знаний доступной для запросов по URL-адресу общедоступной конечной точки. Когда публикация завершится, сохраните сведения об URL-адресе узла и ключе конечной точки, которые отображаются на странице **Publish** (Публикация).

    |Требуемые данные| Пример|
    |--|--|
    |Узел публикации|`https://YOUR-RESOURCE-NAME.azurewebsites.net`|
    |Ключ публикации|`XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX` (строка длиной 32 символа, которая отображается после `Endpoint`)|
    |Идентификатор приложения API.|`xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx` (строка длиной 36 символов, которая отображается в составе `POST`) |

## <a name="create-batch-test-file-with-question-ids"></a>Создание файла пакетного теста с идентификаторами вопросов

Чтобы использовать средство пакетного тестирования, создайте в текстовом редакторе файл с именем `batch-test-data-1.tsv`. Этот файл должен быть в формате UTF-8 и содержать следующие столбцы, разделенные знаками табуляции.

|Поля входного файла с разделением знаками табуляции|Примечания|Пример|
|--|--|--|
|Идентификатор базы знаний|Идентификатор базы знаний, представленный на странице публикации. Вы можете тестировать сразу несколько баз знаний в одной службе, используя один файл с несколькими идентификаторами базы знаний.|`xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx` (строка длиной 36 символов, которая отображается в составе `POST`) |
|Вопрос|Текст вопроса, который будет вводить пользователь. Не более 1000 символов|`How do I sign out?`|
|Теги метаданных|необязательный|`topic:power` использует формат _ключ:значение_|
|Наилучший вариант|необязательный|`25`|
|Идентификатор ожидаемого ответа|необязательный|`13`|

Для этой базы знаний добавьте в файл три строки с двумя обязательными столбцами. Первый столбец содержит идентификатор базы знаний, а второй — следующий список вопросов:

|Столбец 2: вопросы|
|--|
|`Use Windows Hello to sign in`|
|`Charge your Surface Pro 4`|
|`Get to know Windows 10`|

Эти вопросы точно дублируют фразы из базы знаний и должны возвращать оценки достоверности 100.

Затем добавьте три строки с аналогичными вопросами в немного другой формулировке, используя тот же идентификатор базы знаний:

|Столбец 2: вопросы|
|--|
|`What is Windows Hello?`|
|`How do I charge the laptop?`|
|`What features are in Windows 10?`|

> [!CAUTION]
> Следите за тем, чтобы каждый столбец отделялся только знаком табуляции. Все начальные или конечные пробелы будут считаться частью данных столбца, что приведет к созданию исключений из-за несовпадения типа или размера.

Файл пакетного теста, открытый в программе Excel, должен выглядеть как на следующем рисунке. Идентификатор базы знаний здесь заменен для безопасности строкой `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx`. Для вашего пакетного теста здесь должен быть реальный идентификатор базы знаний.

> [!div class="mx-imgBorder"]
> ![Первая версия входного файла .tsv для пакетного теста](../media/batch-test/batch-test-1-input.png)

## <a name="test-the-batch-file"></a>Выполните тестирование с пакетным файлом

Запустите программу пакетного тестирования, выполнив следующую команду CLI в командной строке.

Замените значения `YOUR-RESOURCE-NAME` и `ENDPOINT-KEY` реальными значениями имени службы и ключа конечной точки. Их вы можете найти на странице **Settings** (Параметры) портала QnA Maker.

```console
batchtesting.exe batch-test-data-1.tsv https://YOUR-RESOURCE-NAME.azurewebsites.net ENDPOINT-KEY out.tsv
```
Выполняемый тест создаст файл `out.tsv`:

> [!div class="mx-imgBorder"]
> ![Первая версия выходного файла .tsv пакетного теста](../media/batch-test/batch-test-1-output.png)

Идентификатор базы знаний здесь заменен для безопасности строкой `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx`. В результатах вашего пакетного теста этот столбец содержит реальный идентификатор базы знаний.

Значения оценки достоверности в четвертом столбце выходных данных теста демонстрируют, что первые три вопроса возвращают ожидаемую оценку 100, так как каждый из них точно совпадает с вопросом из базы знаний. Последние три вопроса с другими формулировками возвращают более низкие оценки достоверности. Чтобы увеличить эту оценку в результатах теста и в реальных запросах пользователей, следует добавить в базу знаний дополнительные вопросы.

## <a name="testing-with-the-optional-fields"></a>Тестирование с необязательными полями

Разобравшись с форматом и процессом тестирования, вы сможете создать файл для выполнения в базе знаний из произвольного источника данных, например из журналов чатов.

Благодаря автоматизации источника данных и процесса тестовый файл можно выполнять много раз с разными параметрами, чтобы найти наиболее подходящие значения.

Например, если у вас есть журнал чата и вы хотите определить, как соотносятся строки текста из этого журнала и поля метаданных, создайте файл теста и укажите поля метаданных для каждой строки. Запустите тест и проверьте, какие строки соответствуют метаданным. Как правило, совпадения будут положительными, но обязательно проверьте и ложноположительные результаты. Ложноположительным результатом называется строка, которая обозначена как соответствующая метаданным, но содержит текст, который не должен им соответствовать.

## <a name="using-optional-fields-in-the-input-batch-test-file"></a>Использование необязательных полей во входном файле пакетного теста

Следующая схема поможет вам понять, как найти значения полей для необязательных данных.

|Номер столбца|Необязательный столбец|Расположение данных|
|--|--|--|
|3|метаданные|Экспортируйте существующую базу знаний, чтобы получить существующие пары _ключ:значение_.|
|4|top|Мы рекомендуем использовать значение по умолчанию `25`.|
|5|Идентификатор набора вопросов и ответов|Экспортируйте существующую базу знаний, чтобы получить значения идентификаторов. Также обратите внимание на идентификаторы, которые возвращаются в выходном файле.|

## <a name="add-metadata-to-the-knowledge-base"></a>Добавление метаданных в базу знаний

1. На портале QnA на странице **Edit** (Правка) добавьте метаданные `topic:power` к следующим вопросам.

    |Вопросы|
    |--|
    |Charge your Surface Pro 4|
    |Check the battery level|

    Две пары "вопрос — ответ" с указанными метаданными.

    > [!TIP]
    > Чтобы получить метаданные и идентификаторы QnA для каждого набора, экспортируйте базу знаний. Перейдите на страницу **Settings** (Параметры), а затем щелкните **Export** (Экспортировать), чтобы получить файл `.xls`. Найдите этот скачанный файл и откройте его в Excel для просмотра метаданных и идентификатора.

1. Выберите действие **Save and train** (Сохранить и обучить), а затем откройте страницу **Publish** (Публикация) и нажмите кнопку **Publish** (Опубликовать). После этих действий изменения станут доступными для пакетного теста. Скачайте базу знаний на странице **Settings** (Параметры).

    В скачанном файле метаданные имеют правильный формат и правильные идентификаторы набора вопросов и ответов. Эти поля применяются в следующем разделе

    > [!div class="mx-imgBorder"]
    > ![Экспортированная база знаний с метаданными](../media/batch-test/exported-knowledge-base-with-metadata.png)

## <a name="create-a-second-batch-test"></a>Создание второго пакетного теста

Существуют два основных сценария пакетного тестирования:
* **Обработка файлов журнала чата** позволяет найти наилучший ответ на вопрос, который ранее не встречался. Чаще всего это нужно при обработке файла журнала с запросами, например с вопросами пользователей боту в чате. Создайте файл пакетного теста, содержащий только обязательные столбцы. Этот тест возвращает самый подходящий ответ для каждого вопроса. Но самый подходящий ответ не всегда будет правильным. После завершения этого теста перейдите к проверочному тесту.
* **Проверочный тест** проверяет ожидаемые ответы. Этот тест предполагает проверку всех вопросов и соответствующих ожидаемых ответов в пакетном тесте. Обычно для этого нужно выполнить некоторую работу вручную.

В следующей процедуре предполагается, что мы обрабатываем журналы разговора

1. Создайте новый файл пакетного теста и включите в него необязательные данные `batch-test-data-2.tsv`. Добавьте шесть строк из исходного входного файла пакетного теста, а затем добавьте метаданные, наилучший ответ и идентификатор пары "вопрос — ответ" для каждой строки.

    Чтобы имитировать автоматическую проверку нового текста из журналов разговора на соответствие с базой знаний, для метаданных в каждом столбце задайте одно и то же значение `topic:power`.

    > [!div class="mx-imgBorder"]
    > ![Вторая версия входного файла .tsv для пакетного теста](../media/batch-test/batch-test-2-input.png)

1. Запустите тест еще раз, изменив имена входного и выходного файлов, чтобы указать, что это второй тест.

    > [!div class="mx-imgBorder"]
    > ![Вторая версия выходного файла .tsv для пакетного теста](../media/batch-test/batch-test-2-output.png)

## <a name="test-results-and-an-automated-test-system"></a>Результаты тестирования и автоматизированная система тестирования

Этот выходной файл теста можно анализировать в автоматизированном конвейере непрерывного тестирования.

Выходные данные в нашем примере следует понимать следующим образом: каждая строка фильтруется по метаданным, которые не соответствуют метаданным в базе знаний, поэтому для каждой несовпадающей строки возвращается ответ по умолчанию, информирующий о том, что в базе знаний не найдено хорошего совпадения. Для совпадающих строк возвращается идентификатор и оценка QnA.

Все строки здесь отмечены как неправильные, так как все они не соответствует ожидаемому идентификатору ответа.

Теперь вы знаете, что можно взять журнал чата и применить текст каждой строки из него в качестве запроса. Если у вас не было никаких сведений о данных, эти результаты предоставят много полезной информации, на основе которой вы сможете двигаться далее:

* метаданные
* идентификатор QnA
* score

Была ли полезной фильтрация по метаданным для тестирования? И да, и нет. Тестовая система должна создавать тестовые файлы для каждой пары метаданных, а также тест без пар метаданных.

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы не собираетесь продолжать тестирование базы знаний, удалите средство пакетного тестирования и тестовые файлы.

Если вы не собираетесь использовать эту базу знаний, удалите все связанные с ней ресурсы, выполнив следующие действия.

1. На портале QnA Maker щелкните **My Knowledge bases** (Мои базы знаний) в меню сверху.
1. В списке баз знаний щелкните значок **Delete** (Удалить) в строке той базы знаний, которую вы создали для этого краткого руководства.

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [QnA Maker (V4) REST API Reference](https://go.microsoft.com/fwlink/?linkid=2092179) (Справочник по API REST QnA Maker (V4))
