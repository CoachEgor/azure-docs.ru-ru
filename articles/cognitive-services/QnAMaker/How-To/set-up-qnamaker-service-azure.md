---
title: Настройка службы QnA Maker QnA Maker
titleSuffix: Azure Cognitive Services
description: Перед созданием базы знаний службы QnA Maker необходимо настроить эту службу в Azure. Настроить службу QnA Maker может любой пользователь с правами на создание ресурсов в подписке.
services: cognitive-services
author: diberry
manager: nitinme
ms.service: cognitive-services
ms.subservice: qna-maker
ms.topic: conceptual
ms.date: 08/30/2019
ms.author: diberry
ms.custom: seodec18
ms.openlocfilehash: bec154a7e437621f377c503642b186cf166016cc
ms.sourcegitcommit: 532335f703ac7f6e1d2cc1b155c69fc258816ede
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/30/2019
ms.locfileid: "70195320"
---
# <a name="manage-qna-maker-resources"></a>Управление ресурсами QnA Maker

Перед созданием базы знаний службы QnA Maker необходимо настроить эту службу в Azure. Настроить службу QnA Maker может любой пользователь с правами на создание ресурсов в подписке.

## <a name="types-of-keys-in-qna-maker"></a>Типы ключей в QnA Maker

Служба QnA Maker работает с двумя видами ключей: **ключами подписки** и **ключами конечной точки**.

![Управление ключами](../media/qnamaker-how-to-key-management/key-management.png)

|Название|Местоположение|Цель|
|--|--|--|
|Ключ подписки|[портал Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F)|используются для доступа к [API службы управления QnA Maker](https://go.microsoft.com/fwlink/?linkid=2092179). Эти API позволяют изменять вопросы и ответы в базе знаний и публиковать базу знаний. Эти ключи создаются при создании новой службы QnA Maker.<br><br>Эти ключи находятся на **Cognitive Services** ресурсе на странице **ключи** .|
|Ключ конечной точки|[Портал QnA Maker](http://www.qnamaker.ai)|Эти ключи используются для доступа к конечной точке опубликованной базы знаний для получения ответа на пользовательский вопрос. Обычно эта конечная точка используется в программе-роботе Chat или в коде клиентского приложения, который подключается к службе QnA Maker. Эти ключи создаются при публикации базы знаний QnA Maker.<br><br>Эти ключи находятся на странице **параметров службы** . Найдите эту страницу в раскрывающемся меню, расположенном в верхней части окна правого пользователя.|

## <a name="create-a-new-qna-maker-service"></a>Создание службы QnA Maker

Эта процедура создает ресурсы Azure, необходимые для управления содержимым базы знаний. После выполнения этих действий вы найдете ключи _подписки_ на странице **ключи** для ресурса в портал Azure.

1. Войдите в портал Azure и создайте ресурс [QnA Maker](https://ms.portal.azure.com/#create/Microsoft.CognitiveServicesQnAMaker) .

1. Выберите **создать** после прочтения условий.

    ![Создание службы QnA Maker](../media/qnamaker-how-to-setup-service/create-new-resource-button.png)

1. В **QnA Maker** выберите соответствующие уровни и регионы.

    ![Создание службы QnA Maker — ценовая категория и регионы](../media/qnamaker-how-to-setup-service/enter-qnamaker-info.png)

    * Введите в поле **Имя** уникальное имя, которое будет обозначать эту службу QnA Maker. Кроме того, это имя определяет конечную точку QnA Maker, с которой будут связаны базы знаний.
    * Выберите **подписку**, в которой будет развернут ресурс QnA Maker.
    * Выберите **ценовую категорию** для служб управления QnA Maker (API портала и управления). На [этой странице](https://aka.ms/qnamaker-pricing) вы найдете сведения о ценах для существующих номеров SKU.
    * Создайте новую **группу ресурсов** (рекомендуется) или используйте существующую группу ресурсов, в которой вы намерены развернуть этот ресурс QnA Maker. QnA Maker создает несколько ресурсов Azure; При создании группы ресурсов для хранения этих ресурсов можно легко находить эти ресурсы, управлять ими и удалять их по имени группы ресурсов.
    * Выберите **расположение группы ресурсов**.
    * Выберите **ценовую категорию поиска** для службы "Поиск Azure". Если уровень "Бесплатный" неактивен, значит в вашей подписке уже развернут этот уровень для службы "Поиск Azure". В этом случае выберите другой уровень (не ниже категории "Базовый") для службы "Поиск Azure". Подробные сведения о ценах на Поиск Azure см. [здесь](https://azure.microsoft.com/pricing/details/search/).
    * Выберите **расположение**, в котором будут развернуты данные для Поиска Azure. При выборе расположения для Поиска Azure автоматически учитываются ограничения на размещение клиентских данных.
    * Присвойте имя службе приложений в поле **Имя приложения**.
    * По умолчанию для службы приложений используется стандартный уровень (S1). Вы можете изменить выбранный план после создания службы. Дополнительные сведения о ценах на службу приложений см. на [этой странице](https://azure.microsoft.com/pricing/details/app-service/).
    * Выберите **Расположение веб-сайта**, в котором будет развернута служба приложений.

        > [!NOTE]
        > Расположение службы "Поиск" может отличаться от расположения веб-сайта.

    * Выберите, нужно ли включить службу **Application Insights**. Если **Application Insights** включена, QnA Maker собирает данные телеметрии по трафику, журналам чата и ошибкам.
    * Выберите **расположение Application Insights**, в котором будет развернут ресурс Application Insights.
    * Для мер экономии затрат можно [предоставить общий доступ к](#share-existing-services-with-qna-maker) некоторым, но не всем ресурсам Azure, созданным для QnA Maker. 

1. После проверки всех полей выберите **создать**. Выполнение может занять несколько минут.

1. Когда развертывание завершится, вы увидите в своей подписке следующий список созданных ресурсов.

    ![Ресурс, созданный в службе QnA Maker](../media/qnamaker-how-to-setup-service/resources-created.png)

    Ресурс с типом _Cognitive Services_ имеет ключи _подписки_ .

## <a name="find-subscription-keys-in-azure-portal"></a>Поиск ключей подписки в портал Azure

Вы можете просматривать и сбрасывать ключи подписки, изменяя их с портал Azure, где был создан QnA Maker ресурс. 

1. Перейдите к ресурсу QnA Maker в портал Azure и выберите ресурс с типом _Cognitive Services_.

    ![Список ресурсов QnA Maker](../media/qnamaker-how-to-key-management/qnamaker-resource-list.png)

2. Перейдите в раздел **Ключи**.

    ![Ключ подписки](../media/qnamaker-how-to-key-management/subscription-key.PNG)

## <a name="find-endpoint-keys-in-qna-maker-portal"></a>Поиск ключей конечных точек на портале QnA Maker

Ключами конечной точки можно управлять на [портале QnA Maker](https://qnamaker.ai).

1. Войдите на [портал QnA Maker](https://qnamaker.ai), перейдите в свой профиль и щелкните **Service settings** (Параметры службы).

    ![Ключ конечной точки](../media/qnamaker-how-to-key-management/Endpoint-keys.png)

2. Просмотрите или сбросьте свои ключи.

    ![Диспетчер ключей конечной точки](../media/qnamaker-how-to-key-management/Endpoint-keys1.png)

    >[!NOTE]
    >Если вы подозреваете, что ключи были скомпрометированы, обновите их. Для этого может потребоваться внести соответствующие изменения в код клиентского приложения или бота.

## <a name="share-existing-services-with-qna-maker"></a>Совместное использование существующих служб с QnA Maker

QnA Maker создает несколько ресурсов Azure. Чтобы сократить затраты на управление и преимущества совместного использования затрат, используйте следующую таблицу, чтобы понять, что вы можете и не можете поделиться:

|Служба|Общий доступ|Причина|
|--|--|--|
|Cognitive Services|X|Невозможно по проекту|
|План обслуживания приложений|✔|Фиксированное дисковое пространство, выделенное для плана службы приложений. Если другие приложения, совместно использующие один и тот же план службы приложений, используют значительный объем дискового пространства, служба приложений QnAMaker будет столкнуться с проблемами.|
|Служба приложений|X|Невозможно по проекту|
|Application Insights|✔|Может быть в общем доступе.|
|Служба поиска|✔|1. `testkb` является зарезервированным именем для службы QnAMaker, оно не может использоваться другими пользователями.<br>2. Сопоставление синонимов `synonym-map` по имени зарезервировано для службы QnAMaker.<br>3. Количество опубликованных KBs ограничено уровнем службы поиска. Если доступны свободные индексы, другие службы могут его использовать.|

### <a name="using-a-single-search-service"></a>Использование одной службы поиска

Если вы создаете службу QnA и ее зависимости (например, поиск) на портале, служба поиска создается и привязывается к службе QnA Maker. После создания этих ресурсов можно обновить параметр службы приложений, чтобы использовать ранее существующую службу поиска, и удалить только что созданную службу поиска.

При создании службы QnA с помощью шаблонов Azure Resource Manager можно создать все ресурсы и управлять созданием службы приложений для использования существующей службы поиска. 

## <a name="upgrade-qna-maker"></a>QnA Maker обновления

|Обновить|Причина|
|--|--|
|[Обновление](#upgrade-qna-maker-sku) SKU управления QnA Maker|Вам необходимо получить дополнительные вопросы и ответы в базе знаний.|
|[Обновление](#upgrade-app-service) Номер SKU службы приложений|База знаний должна обслуживать больше запросов из клиентского приложения, например с ленты чата.|
|[Обновление](#upgrade-azure-search-service) Служба поиска Azure|Вы планируете использовать множество баз знаний.|


### <a name="upgrade-qna-maker-sku"></a>Обновление SKU QnA Maker

Если вам необходимо расширить число вопросов и ответов в базе знаний за пределы текущего уровня, перейдите на ценовую категорию службы QnA Maker. 

Чтобы обновить номер SKU для управления службой QnA Maker, сделайте следующее:

1. Перейдите к ресурсу QnA Maker на портале Azure и выберите **Ценовая категория**.

    ![Ресурс QnA Maker](../media/qnamaker-how-to-upgrade-qnamaker/qnamaker-resource.png)

1. Определите соответствующий номер SKU и нажмите **Выбрать**.

    ![Цены на QnA Maker](../media/qnamaker-how-to-upgrade-qnamaker/qnamaker-pricing-page.png)

### <a name="upgrade-app-service"></a>Обновление службы приложений

 Если потребуется, чтобы база знаний обслуживала большее количество запросов из клиентского приложения, перейдите на ценовую категорию службы приложений.

Масштаб службы приложений можно [увеличить](https://docs.microsoft.com/azure/app-service/manage-scale-up) или уменьшить.

При необходимости перейдите к ресурсу службы приложений на портале Azure и выберите **Увеличить масштаб** или **Уменьшить масштаб**.

![Масштабирование службы приложения QnA Maker](../media/qnamaker-how-to-upgrade-qnamaker/qnamaker-appservice-scale.png)

### <a name="upgrade-azure-search-service"></a>Обновление службы Поиска Azure

Если вы планируете использовать несколько баз знаний, перейдите на ценовую категорию службы поиска Azure. 

Сейчас вы не можете обновить номер SKU Поиска Azure. Но можно создать новый ресурс Поиска Azure с требуемым номером SKU, восстановить туда данные, а затем привязать его к стеку QnA Maker.

1. Создайте ресурс Поиска Azure на портале Azure и выберите требуемый номер SKU.

    ![Ресурс Поиска Azure в QnA Maker](../media/qnamaker-how-to-upgrade-qnamaker/qnamaker-azuresearch-new.png)

1. Восстановите индексы из исходного ресурса Поиска Azure на новый. См. [пример кода резервного копирования и восстановления](https://github.com/pchoudhari/QnAMakerBackupRestore).

1. После восстановления данных перейдите на новый ресурс поиска Azure, выберите **Ключи**, а затем запишите **имя** и **ключ администратора**.

    ![Ключи поиска Azure в QnA Maker](../media/qnamaker-how-to-upgrade-qnamaker/qnamaker-azuresearch-keys.png)

1. Чтобы связать новый ресурс поиска Azure со стеком QnA Maker, перейдите к службе приложений QnA Maker.

    ![Служба приложений QnA Maker](../media/qnamaker-how-to-upgrade-qnamaker/qnamaker-resource-list-appservice.png)

1. Выберите **Параметры приложения** и замените поля **AzureSearchName** и **AzureSearchAdminKey** из шага 3.

    ![Настройка службы приложений QnA Maker](../media/qnamaker-how-to-upgrade-qnamaker/qnamaker-appservice-settings.png)

1. Перезапустите службу приложений.

    ![Перезапуск службы приложений QnA Maker](../media/qnamaker-how-to-upgrade-qnamaker/qnamaker-appservice-restart.png)

## <a name="get-latest-runtime-updates"></a>Получение последних обновлений среды выполнения

Среда выполнения QnAMaker является частью службы приложений Azure, развернутой при [создании службы QnAMaker](./set-up-qnamaker-service-azure.md) в портал Azure. Периодически устанавливаются обновления для этой среды выполнения. QnA Maker служба приложений находится в режиме автоматического обновления после выпуска апреля 2019 для расширения сайта (версия 5 +). Это уже призвано позаботиться об НУЛЕВом времени простоя во время обновлений. 

Текущую версию можно проверить по адресу https://www.qnamaker.ai/UserSettings. Если версия старше версии 5. x, необходимо перезапустить службу приложений, чтобы применить последние обновления.

1. Перейдите к службе QnA Maker (группе ресурсов) на [портале Azure](https://portal.azure.com).

    ![Группа ресурсов Azure для QnA Maker](../media/qnamaker-how-to-troubleshoot/qnamaker-azure-resourcegroup.png)

1. Щелкните службу приложений и откройте раздел "Обзор".

     ![Служба приложений QnA Maker](../media/qnamaker-how-to-troubleshoot/qnamaker-azure-appservice.png)

1. Перезапустите службу приложений. Эта операция должна потребовать нескольких секунд. Все зависимые приложения или программы-роботы, использующие эту службу QnAMaker, будут недоступны конечным пользователям в течение этого периода перезапуска.

    ![Перезапуск службы приложений QnA Maker](../media/qnamaker-how-to-upgrade-qnamaker/qnamaker-appservice-restart.png)

## <a name="management-service-region"></a>Регион службы управления

Служба управления QnA Maker, которая используется только для & портала QnA Maker для начальной обработки данных, доступна только в западной части США. В этой западной службе США не хранятся данные клиентов.

## <a name="next-steps"></a>Следующие шаги

> [!div class="nextstepaction"]
> [Создание и публикация базы знаний](../Quickstarts/create-publish-knowledge-base.md)
