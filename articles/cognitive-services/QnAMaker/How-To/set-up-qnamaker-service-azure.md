---
title: Настройка службы QnA Maker QnA Maker
titleSuffix: Azure Cognitive Services
description: Перед созданием базы знаний службы QnA Maker необходимо настроить эту службу в Azure. Настроить службу QnA Maker может любой пользователь с правами на создание ресурсов в подписке.
services: cognitive-services
author: diberry
manager: nitinme
ms.service: cognitive-services
ms.subservice: qna-maker
ms.topic: conceptual
ms.date: 09/13/2019
ms.author: diberry
ms.custom: seodec18
ms.openlocfilehash: dc3bb6882963205e17e37f52ec9dcdffecdf9e21
ms.sourcegitcommit: 5d6ce6dceaf883dbafeb44517ff3df5cd153f929
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2020
ms.locfileid: "76843196"
---
# <a name="manage-qna-maker-resources"></a>Управление ресурсами QnA Maker

Перед созданием базы знаний службы QnA Maker необходимо настроить эту службу в Azure. Настроить службу QnA Maker может любой пользователь с правами на создание ресурсов в подписке.

## <a name="types-of-keys-in-qna-maker"></a>Типы ключей в QnA Maker

Ваша служба QnA Maker работает с двумя типами ключей: **ключами подписки** и **ключами конечных точек**.

![Управление ключами](../media/qnamaker-how-to-key-management/key-management.png)

|Имя|Расположение|Цель|
|--|--|--|
|Ключ подписки|[Портал Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F)|Эти ключи используются для доступа к [API-интерфейсам службы управления QnA Maker](https://go.microsoft.com/fwlink/?linkid=2092179). Эти API позволяют изменять вопросы и ответы в базе знаний и публиковать базу знаний. Эти ключи создаются при создании новой службы QnA Maker.<br><br>Эти ключи находятся на **Cognitive Services** ресурсе на странице **ключи** .|
|Ключ конечной точки|[Портал QnA Maker](https://www.qnamaker.ai)|Эти ключи используются для доступа к конечной точке опубликованной базы знаний для получения ответа на пользовательский вопрос. Обычно эта конечная точка используется в роботе чата или в коде клиентского приложения, который подключается к службе QnA Maker. Эти ключи создаются при публикации базы знаний QnA Maker.<br><br>Эти ключи находятся на странице " **Параметры службы** ". Найдите эту страницу в меню пользователя в правой верхней части страницы в раскрывающемся меню.|

## <a name="create-a-new-qna-maker-service"></a>Создание службы QnA Maker

Эта процедура создает ресурсы Azure, необходимые для управления содержимым базы знаний. После выполнения этих действий вы найдете ключи _подписки_ на странице **ключи** для ресурса в портал Azure.

1. Войдите в портал Azure и создайте ресурс [QnA Maker](https://ms.portal.azure.com/#create/Microsoft.CognitiveServicesQnAMaker) .

1. Выберите **создать** после прочтения условий:

    ![Создание службы QnA Maker](../media/qnamaker-how-to-setup-service/create-new-resource-button.png)

1. В **QnA Maker**выберите соответствующие уровни и регионы.

    ![Создание службы QnA Maker — ценовая категория и регионы](../media/qnamaker-how-to-setup-service/enter-qnamaker-info.png)

    * В поле **имя** введите уникальное имя для указания этой службы QnA Maker. Это имя также определяет конечную точку QnA Maker, с которой будут связаны базы знаний.
    * Выберите **подписку** , в которой будет развернут ресурс QnA Maker.
    * Выберите **ценовую категорию** для служб управления QnA Maker (API портала и управления). См. [Дополнительные сведения о ценах на SKU](https://aka.ms/qnamaker-pricing).
    * Создайте новую **группу ресурсов** (рекомендуется) или используйте существующую, чтобы развернуть этот QnA Maker ресурс. QnA Maker создает несколько ресурсов Azure. При создании группы ресурсов для хранения этих ресурсов можно легко находить эти ресурсы, управлять ими и удалять их по имени группы ресурсов.
    * Выберите **расположение группы ресурсов**.
    * Выберите **ценовую категорию поиска** для службы когнитивный Поиск Azure. Если параметр уровень Free недоступен (отображается серым цветом), это означает, что у вас уже есть бесплатная служба, развернутая через подписку. В этом случае необходимо начать с уровня "базовый". См. [сведения о ценах на когнитивный Поиск Azure](https://azure.microsoft.com/pricing/details/search/).
    * Выберите **место поиска** , в котором должны развертываться индексы когнитивный Поиск Azure. Ограничения на место хранения данных клиента помогут определить расположение, выбранное для Когнитивный поиск Azure.
    * В поле **имя приложения** введите имя экземпляра службы приложений Azure.
    * По умолчанию служба приложений по умолчанию имеет уровень Standard (S1). Вы можете изменить выбранный план после создания службы. Дополнительные сведения о [ценах на службу приложений](https://azure.microsoft.com/pricing/details/app-service/).
    * Выберите **расположение веб-сайта** , в котором будет развернута служба приложений.

        > [!NOTE]
        > **Расположение поиска** может отличаться от **расположения веб-сайта**.

    * Выберите, следует ли включить **Application Insights**. Если **Application Insights** включена, QnA Maker собирает данные телеметрии по трафику, журналам чата и ошибкам.
    * Выберите **расположение app Insights** , в котором будет развернут ресурс Application Insights.
    * Для экономии затрат вы можете [предоставить общий доступ](#share-existing-services-with-qna-maker) к некоторым (не всем) ресурсам Azure, созданным для QnA Maker.

1. После проверки всех полей выберите **создать**. Процесс может занять несколько минут.

1. После завершения развертывания вы увидите следующие ресурсы, созданные в вашей подписке:

   ![Ресурс, созданный в службе QnA Maker](../media/qnamaker-how-to-setup-service/resources-created.png)

    У ресурса с типом _Cognitive Services_ есть ключи _подписки_ .

## <a name="find-subscription-keys-in-the-azure-portal"></a>Поиск ключей подписки в портал Azure

Вы можете просматривать и сбрасывать ключи подписки в портал Azure, где был создан QnA Maker ресурс.

1. Перейдите к ресурсу QnA Maker в портал Azure и выберите ресурс с типом _Cognitive Services_ :

    ![Список ресурсов QnA Maker](../media/qnamaker-how-to-key-management/qnamaker-resource-list.png)

2. К **ключам**:

    ![Ключ подписки](../media/qnamaker-how-to-key-management/subscription-key.PNG)

## <a name="find-endpoint-keys-in-the-qna-maker-portal"></a>Поиск ключей конечных точек на портале QnA Maker

Конечная точка находится в том же регионе, что и ресурс, так как ключи конечной точки используются для выполнения вызова к базе знаний.

Ключами конечной точки можно управлять на [портале QnA Maker](https://qnamaker.ai).

1. Войдите на [портал QnA Maker](https://qnamaker.ai), перейдите к своему профилю и выберите **Параметры службы**:

    ![Ключ конечной точки](../media/qnamaker-how-to-key-management/Endpoint-keys.png)

2. Просмотр или сброс ключей:

    ![Диспетчер ключей конечных точек](../media/qnamaker-how-to-key-management/Endpoint-keys1.png)

    >[!NOTE]
    >Обновите ключи, если считаете, что они скомпрометированы. Для этого может потребоваться внести соответствующие изменения в код клиентского приложения или бота.

## <a name="share-existing-services-with-qna-maker"></a>Совместное использование существующих служб с QnA Maker

QnA Maker создает несколько ресурсов Azure. Чтобы упростить управление и воспользоваться преимуществами совместного использования затрат, используйте следующую таблицу, чтобы понять, что вы можете и не можете поделиться:

|Служба|Распространение|Причина|
|--|--|--|
|Когнитивные сервисы|X|Невозможно по проекту|
|План службы приложений|✔|Фиксированное дисковое пространство, выделенное для плана службы приложений. Если другие приложения, использующие один план службы приложений, используют значительное место на диске, экземпляр службы приложений QnAMaker будет столкнуться с проблемами.|
|App Service|X|Невозможно по проекту|
|Application Insights|✔|Может быть в общем доступе.|
|Служба поиска|✔|1. `testkb` является зарезервированным именем для службы QnAMaker; они не могут использоваться другими пользователями.<br>2. сопоставлению синонимов по имени `synonym-map` зарезервировано для службы QnAMaker.<br>3. количество опубликованных баз знаний ограничено уровнем службы поиска. Если доступны свободные индексы, они могут использоваться другими службами.|

Дополнительные сведения о [службе приложений](../../../app-service/index.yml) и службе [поиска](../../../search/index.yml).

## <a name="using-a-single-search-service"></a>Использование одной службы поиска

Если вы создаете службу QnA и ее зависимости (например, поиск) на портале, служба поиска создается и связывается со службой QnA Maker. После создания этих ресурсов можно обновить параметр службы приложений, чтобы использовать ранее существующую службу поиска, и удалить только что созданную.

При создании службы QnA с помощью шаблонов Azure Resource Manager можно создать все ресурсы и управлять созданием службы приложений для использования существующей службы поиска.


## <a name="configure-qna-maker-to-use-different-cognitive-search-resource"></a>Настройка QnA Maker для использования другого Когнитивный поиск ресурса

Если вы создаете службу QnA и ее зависимости (например, поиск) на портале, служба поиска создается и связывается со службой QnA Maker. После создания этих ресурсов можно обновить параметр службы приложений, чтобы использовать ранее существующую службу поиска, и удалить только что созданную.

Ресурс **службы приложений** QnA Maker использует ресурс когнитивный Поиск. Чтобы изменить Когнитивный поиск ресурс, используемый QnA Maker, необходимо изменить параметр в портал Azure.

1. Получите **ключ администратора** и **имя** ресурса когнитивный Поиск, который QnA Maker будет использовать.

1. Войдите в [портал Azure](https://portal.azure.com) и найдите **службу приложений** , связанную с ресурсом QnA Maker. Оба с имеют одинаковое имя.

1. Выберите **Параметры**, а затем **Конфигурация**. Отобразятся все существующие параметры для службы приложений QnA Maker.

    > [!div class="mx-imgBorder"]
    > ![снимок экрана портал Azure с параметрами конфигурации службы приложений](../media/qnamaker-how-to-upgrade-qnamaker/change-search-service-app-service-configuration.png)

1. Измените значения для следующих ключей:

    * **азуресеарчадминкэй**
    * **азуресеарчнаме**

1. Чтобы использовать новые параметры, необходимо перезапустить службу приложений. Выберите **Обзор**, а затем щелкните **перезапустить**.

    > [!div class="mx-imgBorder"]
    > ![снимок экрана портал Azure перезапуска службы приложений после изменения параметров конфигурации](../media/qnamaker-how-to-upgrade-qnamaker/screenshot-azure-portal-restart-app-service.png)

При создании службы QnA с помощью шаблонов Azure Resource Manager можно создать все ресурсы и управлять созданием службы приложений для использования существующей службы поиска.

## <a name="upgrade-qna-maker"></a>QnA Maker обновления

|Обновление|Причина|
|--|--|
|[Обновление](#upgrade-qna-maker-sku) SKU управления QnA Maker|Вы хотите получить дополнительные вопросы и ответы в своей базе знаний.|
|[Обновление](#upgrade-app-service) Номер SKU службы приложений|База знаний должна обслуживать больше запросов из клиентского приложения, например Bot чата.|
|[Обновление](#upgrade-the-azure-cognitive-search-service) Служба Когнитивный поиск Azure|Вы планируете использовать множество баз знаний.|


### <a name="upgrade-qna-maker-sku"></a>Обновление SKU QnA Maker

Если вы хотите получить больше вопросов и ответов в базе знаний, помимо текущего уровня, обновите ценовую категорию службы QnA Maker.

Чтобы обновить номер SKU для управления службой QnA Maker, сделайте следующее:

1. Перейдите к ресурсу QnA Maker на портале Azure и выберите **Ценовая категория**.

    ![Ресурс QnA Maker](../media/qnamaker-how-to-upgrade-qnamaker/qnamaker-resource.png)

1. Определите соответствующий номер SKU и нажмите **Выбрать**.

    ![Цены на QnA Maker](../media/qnamaker-how-to-upgrade-qnamaker/qnamaker-pricing-page.png)

### <a name="upgrade-app-service"></a>Обновление службы приложений

 Если ваша база знаний должна обслуживать больше запросов из клиентского приложения, обновите ценовую категорию службы приложений.

Вы можете [увеличить](https://docs.microsoft.com/azure/app-service/manage-scale-up) или уменьшить масштаб службы приложений.

Перейдите к ресурсу службы приложений в портал Azure и выберите вариант **увеличения** **или уменьшения масштаба,** как требуется.

![Масштабирование службы приложений QnA Maker](../media/qnamaker-how-to-upgrade-qnamaker/qnamaker-appservice-scale.png)

### <a name="upgrade-the-azure-cognitive-search-service"></a>Обновление службы Когнитивный поиск Azure

Если вы планируете использовать множество баз знаний, обновите ценовую категорию службы Когнитивный поиск Azure.

Сейчас невозможно выполнить обновление на месте для номера SKU поиска Azure. Но можно создать новый ресурс Поиска Azure с требуемым номером SKU, восстановить туда данные, а затем привязать его к стеку QnA Maker. Для этого выполните следующие действия.

1. Создайте новый ресурс службы "Поиск Azure" в портал Azure и выберите нужный номер SKU.

    ![Ресурс Поиска Azure в QnA Maker](../media/qnamaker-how-to-upgrade-qnamaker/qnamaker-azuresearch-new.png)

1. Восстановите индексы из исходного ресурса Поиска Azure на новый. См. [пример кода для восстановления резервной копии](https://github.com/pchoudhari/QnAMakerBackupRestore).

1. После восстановления данных перейдите к новому ресурсу поиска Azure, выберите **ключи**и запишите **имя** и **ключ администратора**:

    ![Ключи поиска Azure в QnA Maker](../media/qnamaker-how-to-upgrade-qnamaker/qnamaker-azuresearch-keys.png)

1. Чтобы связать новый ресурс службы "Поиск Azure" с QnA Makerным стеком, перейдите к QnA Makerному экземпляру служб приложений.

    ![Экземпляр службы приложений QnA Maker](../media/qnamaker-how-to-upgrade-qnamaker/qnamaker-resource-list-appservice.png)

1. Выберите **Параметры приложения** и измените параметры в полях **азуресеарчнаме** и **азуресеарчадминкэй** из шага 3.

    ![QnA Maker параметр службы приложений](../media/qnamaker-how-to-upgrade-qnamaker/qnamaker-appservice-settings.png)

1. Перезапустите экземпляр службы приложений.

    ![Перезапуск экземпляра службы приложений QnA Maker](../media/qnamaker-how-to-upgrade-qnamaker/qnamaker-appservice-restart.png)

## <a name="get-the-latest-runtime-updates"></a>Получение последних обновлений среды выполнения

Среда выполнения QnAMaker является частью экземпляра службы приложений Azure, который разворачивается при [создании службы QnAMaker](./set-up-qnamaker-service-azure.md) в портал Azure. Периодически устанавливаются обновления для этой среды выполнения. QnA Maker экземпляр службы приложений находится в режиме автоматического обновления после выпуска расширения сайта от апреля 2019 (версия 5 +). Это обновление предназначено для того, чтобы принимать во внимание время простоя при обновлении.

Текущую версию можно проверить на https://www.qnamaker.ai/UserSettings. Если версия старше версии 5. x, необходимо перезапустить службу приложений, чтобы установить последние обновления:

1. Перейдите к службе QnAMaker (Группа ресурсов) в [портал Azure](https://portal.azure.com).

    ![Группа ресурсов Azure для QnA Maker](../media/qnamaker-how-to-troubleshoot/qnamaker-azure-resourcegroup.png)

1. Выберите экземпляр службы приложений и откройте раздел **Обзор** .

    ![Экземпляр службы приложений QnAMaker](../media/qnamaker-how-to-troubleshoot/qnamaker-azure-appservice.png)

1. Перезапустите службу приложений. Процесс обновления должен завершиться через пару секунд. Все зависимые приложения или программы-роботы, использующие эту службу QnAMaker, будут недоступны конечным пользователям в течение этого периода перезапуска.

    ![Перезапуск экземпляра службы приложений QnAMaker](../media/qnamaker-how-to-upgrade-qnamaker/qnamaker-appservice-restart.png)

## <a name="management-service-region"></a>Регион службы управления

Служба управления QnA Maker используется только для портала QnA Maker и для начальной обработки данных. Эта служба доступна только в регионе "Западная часть США". В этой западной службе США не хранятся данные клиентов.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о [службе приложений](../../../app-service/index.yml) и службе [поиска](../../../search/index.yml).

> [!div class="nextstepaction"]
> [Создание и публикация базы знаний](../Quickstarts/create-publish-knowledge-base.md)
