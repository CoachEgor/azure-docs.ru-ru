---
title: Руководство по интеграции с Power Virtual Agents (QnA Maker)
description: В этом руководстве рассматривается улучшение качества базы знаний с помощью активного обучения. Просматривайте, подтверждайте, отклоняйте и добавляйте вопросы без удаления или изменения существующих.
ms.topic: tutorial
ms.date: 06/08/2020
ms.openlocfilehash: f1d51f6ad8892252161238eb71fbb02f463463fd
ms.sourcegitcommit: ce44069e729fce0cf67c8f3c0c932342c350d890
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/09/2020
ms.locfileid: "84635393"
---
# <a name="tutorial-add-your-knowledge-base-to-power-virtual-agents"></a>Руководство по добавлению базы знаний в Power Virtual Agents
Создайте бот [Power Virtual Agents](https://powervirtualagents.microsoft.com/) и дополните его для предоставления ответов из базы знаний.

В этом руководстве описано следующее:

<!-- green checkmark -->
> [!div class="checklist"]
> * Создание бота Power Virtual Agents
> * Создание раздела системного возврата
> * Добавление QnA Maker в качестве действия в раздел потока Power Automate
> * Создание решения Power Automate
> * Добавление потока Power Automate в решение
> * Публикация Power Virtual Agents
> * Тестирование Power Virtual Agents и получение ответа из базы знаний QnA Maker

## <a name="integrate-an-agent-with-a-knowledge-base"></a>Интеграция агента с базой знаний

Служба [Power Virtual Agents](https://powervirtualagents.microsoft.com/) позволяет специалистам создавать мощные боты с помощью интерактивного графического интерфейса без написания кода. Вам не потребуются разработчики или специалисты по обработке и анализу данных.

В Power Virtual Agents создается агент с набором разделов (предметных областей) для ответов на вопросы пользователей путем выполнения действий. Если ответ не найден, системный возврат может вернуть ответ.

Настройте в агенте отправку вопроса в базу знаний в составе действия для раздела или в пути *Системный возврат*. В обоих случаях используется действие для подключения к базе знаний и получения ответа.

## <a name="power-automate-connects-to-generateanswer-action"></a>Подключение Power Automate к действию `GenerateAnswer`

Чтобы подключить агент к базе знаний, для создания действия используйте Power Automate. Power Automate предоставляет поток процесса, который подключается к API `GenerateAnswer` QnA Maker.

После создания и сохранения потока он становится доступен в решении Power Automate. Используйте это решение в качестве действия в агенте.

## <a name="connect-an-agent-to-your-knowledge-base"></a>Подключение агента к базе знаний

Ниже перечислены шаги по подключению агента в Power Virtual Agents к базе знаний в QnA Maker.

* На портале [QnA Maker](https://www.qnamaker.ai/) сделайте следующее:
    * Создайте и опубликуйте базу знаний.
    * Скопируйте сведения о базе знаний, включая идентификатор, ключ конечной точки среды выполнения и узел конечной точки среды выполнения.
* На портале [Power Virtual Agents](https://powerva.microsoft.com/) сделайте следующее:
    * Создайте раздел агента.
    * Вызовите действие (для потока Power Automate).
* На портале [Power Automate](https://us.flow.microsoft.com/) сделайте следующее:
    * Найдите шаблон _Создание ответа с помощью QnA Maker_
    * Используйте шаблон, чтобы настроить поток для использования [GenerateAnswer в QnA Maker](https://docs.microsoft.com/connectors/cognitiveservicesqnamaker/).
        * Информация о базе знаний, опубликованной в QnA Maker:
            * Идентификатор базы знаний
            * Узел конечной точки ресурса QnA Maker
            * Ключ конечной точки ресурса QnA Maker
        * Входные данные — пользовательский запрос
        * Выходные данные — ответ базы знаний
    * Создайте решение и добавьте поток или добавьте поток в существующее решение.
* Вернитесь к Power Virtual Agents и сделайте следующее:
    * Выберите выходные данные решения в качестве сообщения для раздела.

## <a name="create-and-publish-a-knowledge-base"></a>Создание и публикация базы знаний

1. Чтобы создать базу знаний, следуйте указаниям в [кратком руководстве](../Quickstarts/create-publish-knowledge-base.md). Не выполняйте последний раздел, посвященный созданию бота. Вместо этого вернитесь к этому руководству для создания бота в Power Virtual Agents.

    > [!div class="mx-imgBorder"]
    > ![Снимок экрана с параметрами опубликованной базы знаний](../media/how-to-integrate-power-virtual-agent/published-knowledge-base-settings.png)

    Введите параметры опубликованной базы знаний, которые указаны на странице **Параметры** на портале [QnA Maker](https://www.qnamaker.ai/). На шаге [Power Automate](#create-a-power-automate-flow-to-connect-to-your-knowledge-base) вы примените эти сведения, чтобы настроить подключение к `GenerateAnswer` в QnA Maker.

1. На странице **Параметры** портала QnA Maker найдите ключ конечной точки, узел конечной точки и идентификатор базы знаний.

## <a name="create-an-agent-in-power-virtual-agents"></a>Создание агента в Power Virtual Agents

1. [Выполните вход в Power Virtual Agents](https://go.microsoft.com/fwlink/?LinkId=2108000&clcid=0x409). Укажите рабочий или учебный адрес электронной почты.

1. Если это ваш первый бот, откроется **домашняя страница** агента. Если у вас уже есть боты, выберите нужный в правой части страницы и щелкните **+ New Bot** (+ Создать бота).

    > [!div class="mx-imgBorder"]
    > ![Снимок экрана с домашней страницей Power Virtual Agents](../media/how-to-integrate-power-virtual-agent/power-virtual-agent-home.png)

## <a name="topics-provided-in-the-bot"></a>Предоставленные в боте разделы

Агент использует коллекцию разделов для ответа на вопросы в нужной предметной области. В этом примере агент содержит вам много разделов, которые делятся на пользовательские и системные.

Выберите **Разделы** в левой области навигации, чтобы просмотреть разделы, предоставленные ботом.

> [!div class="mx-imgBorder"]
> ![Снимок экрана со списком предоставленных в агенте разделов](../media/how-to-integrate-power-virtual-agent/power-virtual-agent-topics-provided.png)


## <a name="create-the-system-fallback-topic"></a>Создание раздела системного возврата

Агент может подключаться к базе знаний из любого раздела, но в этом примере используется только *системный раздел возврата*. Раздел "Возврат" используется в том случае, если агенту не удается найти ответ. Агент передает текст пользователя в API `GenerateAnswer` в QnA Maker, получает ответ из базы знаний и отображает его пользователю в виде сообщения.

1. На портале [Power Virtual Agents](https://powerva.microsoft.com/#/) в правом верхнем углу выберите **Параметры** (значок шестеренки). Теперь выберите **System Fallback** (Системный возврат).

    > [!div class="mx-imgBorder"]
    > ![Снимок экрана с элементом меню System Fallback (Системный возврат) в Power Virtual Agents](../media/how-to-integrate-power-virtual-agent/power-virtual-agent-settings-system-fallback.png)

1. Щелкните **+ Add** (+ Добавить), чтобы добавить раздел системного возврата.

    > [!div class="mx-imgBorder"]
    > ![Снимок экрана для добавления раздела возврата.](../media/how-to-integrate-power-virtual-agent/power-virtual-agent-settings-add-fallback-topic.png)

1. После добавления раздела выберите команду **Go to Fallback topic** (Перейти к разделу возврата), чтобы создать раздел возврата на холсте разработки.

    > [!TIP]
    > Если вам нужно вернуться к разделу возврата, он доступен в области **Разделы** в составе группы **Системные**.

## <a name="use-the-authoring-canvas-to-add-an-action"></a>Использование холста разработки для добавления действия

Используйте холст разработки Power Virtual Agents, чтобы подключить раздел возврата к базе знаний. Этот раздел начинается с нераспознанного пользовательского текста. Добавьте действие, которое передает этот текст в QnA Maker и отображает ответ в виде сообщения. Последний этап отображения ответа обрабатывается в видео [отдельного шага](#add-your-solutions-flow-to-power-virtual-agents), как описано далее в этом руководстве.

В этом разделе создается поток беседы раздела возврата.

1. В новом действии возврата могут уже присутствовать элементы потока беседы. Удалите элемент **Escalate** (Передать), выбрав меню **Параметры**.

    :::image type="content" source="../media/how-to-integrate-power-virtual-agent/delete-escalate-action-using-option-menu.png" alt-text="Частичный снимок экрана потока диалога с выделенным параметром Удалить.":::

1. Выберите соединитель **+** , который идет к блоку **Сообщение**, а затем выберите команду **Вызов действия**.

    :::image type="content" source="../media/how-to-integrate-power-virtual-agent/create-new-item-call-an-action.png" alt-text="Частичный снимок экрана с командой вызова действия.":::

1. Выберите элемент **Создать поток**. После этого откроется портал Power Automate.

    > [!div class="mx-imgBorder"]
    > ![Снимок экрана с командой создания потока](../media/how-to-integrate-power-virtual-agent/create-a-flow.png)


    Power Automate открывается в новом шаблоне. Вы не будете использовать этот новый шаблон.

    :::image type="content" source="../media/how-to-integrate-power-virtual-agent/power-automate-flow-initial-template.png" alt-text="Частичный снимок экрана: Power Automate с новым шаблоном потока.":::

## <a name="create-a-power-automate-flow-to-connect-to-your-knowledge-base"></a>Создание потока Power Automate для подключения к базе знаний

Следующая процедура позволяет создать поток Power Automate, который:
* принимает входящий пользовательский текст и отправляет его в QnA Maker;
* Возвращает верхний ответ к агенту.

1. В **Power Automate** выберите **Шаблоны** в левой области навигации. Если вам будет предложено покинуть страницу браузера, нажмите "Покинуть".

1. На странице шаблонов найдите шаблон **Создать ответ с помощью QnA Maker** и выберите его. Этот шаблон содержит все шаги для вызова QnA Maker с параметрами базы знаний и возврата верхнего ответа.

1. На новом экране для потока QnA Maker выберите **Продолжить**.

    :::image type="content" source="../media/how-to-integrate-power-virtual-agent/power-automate-qna-flow-template-continue.png" alt-text="Частичный снимок экрана: поток шаблона QnA Maker с выделенной кнопкой Продолжить.":::

1. Выберите поле действия **Создать ответ** и заполните параметры QnA Maker из предыдущего раздела, озаглавленного [Создание и публикация базы знаний](#create-and-publish-a-knowledge-base). **Узел службы** на следующем рисунке ссылается на узел базы знаний **Узел** и имеет формат `https://YOUR-RESOURCE-NAME.azurewebsites.net/qnamaker`.


    :::image type="content" source="../media/how-to-integrate-power-virtual-agent/power-virtual-agent-fill-in-generate-answer-settings.png" alt-text="Частичный снимок экрана: поток шаблона QnA Maker с выделенной кнопкой Продолжить.":::

1. Выберите **Сохранить**, чтобы сохранить поток.

## <a name="create-a-solution-and-add-the-flow"></a>Создание решения и добавление потока

Чтобы агент мог находить поток и подключаться к нему, следует добавить этот поток в решение Power Automate.

1. На портале Power Automate, выберите **Решения** в области навигации слева.

1. Выберите команду **Создать решение**.

1. Введите отображаемое имя. Список решений содержит все решения в вашей организации или учебном заведении. Выберите соглашение об именовании, чтобы отфильтровать только нужные решения. Например, можно добавить адрес электронной почты в качестве префикса к имени решения: `jondoe-power-virtual-agent-qnamaker-fallback`.

1. Выберите издателя в списке вариантов.

1. Примите значения по умолчанию для имени и версии.

1. Нажмите кнопку **Создать**, чтобы завершить процесс.

## <a name="add-your-flow-to-the-solution"></a>Добавление потока в решение

1. В списке решений выберите только что созданное решение. Оно должно находиться в верхней части списка. Если это не так, выполните поиск по адресу электронной почты, который является частью имени решения.

1. В решении выберите команду **+ Добавить существующий**, а затем в списке выберите **Поток**.

1. Найдите поток в списке **Внешние решения** и нажмите **Добавить**, чтобы завершить процесс. Если потоков много, просмотрите столбец **Изменен**, чтобы найти самый последний поток.

## <a name="add-your-solutions-flow-to-power-virtual-agents"></a>Добавление потока решения в Power Virtual Agents

1. Вернитесь на вкладку браузера, где открыта странице агента в Power Virtual Agents. Созданный холст по-прежнему должен быть открыт.

1. Чтобы вставить новый шаг в поток, над полем действия **Сообщение** выберите соединитель **+** . Затем выберите команду **Call an action** (Вызов действия).

1. Во всплывающем окне **Поток** выберите новый поток с именем **Создать ответы с помощью базы знаний QnA Maker...** . В потоке появится новое действие.

    :::image type="content" source="../media/how-to-integrate-power-virtual-agent/power-virtual-agent-flow-after-adding-action.png" alt-text="Частичный снимок экрана: холст беседы Power Virtual Agent после добавления потока QnA Maker.":::

1. Чтобы правильно задать входную переменную для действия QnA Maker, выберите **Выбрать переменную** и нажмите **bot.UnrecognizedTriggerPhrase**.

    :::image type="content" source="../media/how-to-integrate-power-virtual-agent/power-virtual-agent-selection-action-input.png" alt-text="Частичный снимок экрана: холст беседы Power Virtual Agent с выбором входной переменной.":::


1. Чтобы правильно задать выходную переменную для действия QnA Maker, в действии **Сообщение** выберите **UnrecognizedTriggerPhrase**, затем щелкните значок, чтобы вставить переменную, `{x}`, и выберите **FinalAnswer**.

1. На контекстной панели инструментов нажмите кнопку **Сохранить**, чтобы сохранить сведения с холста разработки для раздела.

Так выглядит окончательный холст агента.

> [!div class="mx-imgBorder"]
> ![Снимок экрана с окончательной версией агента на холсте](../media/how-to-integrate-power-virtual-agent/power-virtual-agent-topic-authoring-canvas-full-flow.png)

## <a name="test-the-agent"></a>Тестирование агента

1. На панели тестирования установите переключатель **Track between topics** (Отслеживать по разделам). Это позволяет отслеживать ход выполнения по нескольким разделам или в пределах одного раздела.

1. Протестируйте агент, введя пользовательский текст в следующем порядке. На холсте разработки успешно выполненные шаги будут отмечены зеленой галочкой.

    |Порядок вопросов|Тестовые вопросы|Назначение|
    |--|--|--|
    |1|Привет|Начало беседы|
    |2|Время хранения|Пример раздела. Он настраивается без дополнительных усилий с вашей стороны.|
    |3|Да|Ответ на `Did that answer your question?`|
    |4|Высокая|Ответ на `Please rate your experience.`|
    |5|Да|Ответ на `Can I help with anything else?`|
    |6|Как повысить пропускную способность для прогнозов запросов?|Этот вопрос активирует действие возврата, которое отправляет текст в базу знаний для ответа. После этого отображается ответ. Зеленые флажки для отдельных действий указывают на успешное выполнение каждого действия.|

    :::image type="content" source="../media/how-to-integrate-power-virtual-agent/power-virtual-agent-test-tracked.png" alt-text="Снимок экрана: чат-бот с холстом с зелеными флажками, обозначающими успешные действия.":::

## <a name="publish-your-bot"></a>Публикация бота

Чтобы агент стал доступным для всех участников учебного заведения или организации, его необходимо опубликовать.

1. Щелкните **Publish** (Опубликовать) в меню навигации слева. На открывшейся странице щелкните **Publish** (Опубликовать).

1. Проверьте работу бота на демонстрационном веб-сайте (ссылку можно найти в разделе **Publish** (Публикация)).

    Откроется новая веб-страница с ботом. Задайте боту тот же тестовый вопрос: `How can I improve the throughput performance for query predictions?`

    > [!div class="mx-imgBorder"]
    > ![Снимок экрана с окончательной версией агента на холсте](../media/how-to-integrate-power-virtual-agent/demo-chat-bot.png)

## <a name="share-your-bot"></a>Публикация своего бота

Чтобы предоставить общий доступ к демонстрационному веб-сайту, настройте его как канал.

1. В меню навигации слева последовательно выберите **Manage** > **Channels** (Управление > Каналы).

1. В списке каналов выберите **Демонстрационный веб-сайт**.

1. Скопируйте ссылку и нажмите кнопку **Сохранить**. Вставьте ссылку на свой демонстрационный веб-сайт в сообщение электронной почты для пользователей в учебном заведении или организации.

## <a name="clean-up-resources"></a>Очистка ресурсов

Завершив работу с базой знаний, удалите ресурсы QnA Maker на портале Azure.

## <a name="next-step"></a>Следующий шаг

[Анализ базы знаний](../How-To/get-analytics-knowledge-base.md)

См. также:
* [Power Virtual Agents](https://docs.microsoft.com/power-virtual-agents/)
* [Power Automate](https://docs.microsoft.com/power-automate/)
* [Соединитель QnA Maker](https://us.flow.microsoft.com/connectors/shared_cognitiveservicesqnamaker/qna-maker/) и [настройки соединителя](https://docs.microsoft.com/connectors/cognitiveservicesqnamaker/)