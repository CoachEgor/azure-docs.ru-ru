---
title: Руководство по интеграции с Power Virtual Agent — QnA Maker
description: В этом руководстве рассматривается улучшение качества базы знаний с помощью активного обучения. Просмотр, принятие или отклонение, добавление без удаления или изменения существующих вопросов.
ms.topic: tutorial
ms.date: 03/11/2020
ms.openlocfilehash: 283667c587e395a1d712f82f3385582b4c5c3227
ms.sourcegitcommit: 632e7ed5449f85ca502ad216be8ec5dd7cd093cb
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2020
ms.locfileid: "80398634"
---
# <a name="tutorial-add-knowledge-base-to-power-virtual-agent"></a>Руководство по добавлению базы знаний в Power Virtual Agent
Создание и расширение бота [Power Virtual Agent](https://powervirtualagents.microsoft.com/) для предоставления ответов из базы знаний.

**В этом руководстве рассмотрено, как выполнять следующие задачи.**

<!-- green checkmark -->
> [!div class="checklist"]
> * Создание Power Virtual Agent
> * Создание раздела системного возврата
> * Добавление QnA Maker в качестве действия в раздел в качестве потока Power Automate
> * Создание решения Power Automate
> * Добавление в решение потока Power Automate
> * Публикация Power Virtual Agent
> * Тестирование Power Virtual Agent, получение ответа из базы знаний QnA Maker

## <a name="integrate-a-power-virtual-agent-with-a-knowledge-base"></a>Интеграция Power Virtual Agent с базой знаний

[Power Virtual Agent](https://powervirtualagents.microsoft.com/) позволяет специалистам с помощью интерактивного графического интерфейса, без написания кода и без необходимости привлечения специалистов по обработке и анализу данных, легко создавать производительные боты.

Power Virtual Agent создается с набором разделов (предметных областей) для ответов на вопросы пользователей путем выполнения действий. Если ответ не найден, системный возврат может вернуть ответ.

Настройте агент на отправку вопроса в базу знаний как действия раздела или как пути раздела **Системный возврат**. В них используется один и тот же механизм действия для подключения к базе знаний и возврата ответа.

## <a name="power-automate-connects-to-generateanswer-action"></a>Power Automate подключается к действию GenerateAnswer

Чтобы подключить агент к базе знаний, для создания действия используйте Power Automate. Power Automate предоставляет **поток**, который подключается к API GenerateAnswer в QnA Maker.

После создания и сохранения **потока** он доступен в **Решении** Power Automate.  После добавления потока GenerateAnswer в решение используйте это решение как действие в своем агенте.

## <a name="process-steps-to-connect-an-agent-to-your-knowledge-base"></a>Этапы процесса подключения агента к базе знаний

Далее представлены общие сведения, которые помогут понять, как эти этапы связаны с целью подключения Power Virtual Agent к базе знаний QnA Maker.

Действия для использования Power Virtual Agent с QnA Maker:
* На портале [QnA Maker](https://www.qnamaker.ai/)
    * Создание и публикация базы знаний
    * Копирование сведений о базе знаний, включая идентификатор базы знаний, ключ конечной точки выполнения и узел конечной точки среды выполнения
* На портале [Power Virtual Agent](https://powerva.microsoft.com/)
    * Создание раздела агента
    * Вызов действия (в поток Power Automate)
* На портале [Power Automate](https://us.flow.microsoft.com/)
    * Создание потока с соединителем к интерфейсу [GenerateAnswer в QnA Maker](https://docs.microsoft.com/connectors/cognitiveservicesqnamaker/)
        * Информация в базе знаний, опубликованная с помощью QnA Maker
            * Идентификатор базы знаний
            * Узел конечной точки ресурса QnA Maker
            * Ключ конечной точки ресурса QnA Maker
        * Входные данные — пользовательский запрос
        * Выходные данные — ответ базы знаний
    * Создание решения и добавление потока
* Возврат к Power Virtual Agent
    * Выбор выходных данных решения как сообщения для раздела

## <a name="create-and-publish-a-knowledge-base"></a>Создание и публикация базы знаний

1. Чтобы создать базу знаний, следуйте указаниям в [кратком руководстве](../Quickstarts/create-publish-knowledge-base.md). Не завершайте последний раздел, чтобы создать бота. Это руководство заменяет последний раздел краткого руководства, так как в этом руководстве для создания бота используется Power Virtual Agent, а не Bot Framework, как в кратком руководстве.

    > [!div class="mx-imgBorder"]
    > ![Введите опубликованные параметры базы знаний на странице **Параметры** на портале [QnA Maker](https://www.qnamaker.ai/).](../media/how-to-integrate-power-virtual-agent/published-knowledge-base-settings.png)

    Эти сведения понадобятся [Power Automate](#create-power-automate-flow-to-connect-to-your-knowledge-base), чтобы настроить подключение GenerateAnswer в QnA Maker.

1. Найдите ключ конечной точки, узел конечной точки и идентификатор базы знаний на странице **Параметры** портала QnA Maker.

## <a name="create-power-virtual-agent"></a>Создание Power Virtual Agent

1. [Войдите](https://go.microsoft.com/fwlink/?LinkId=2108000&clcid=0x409) в Power Virtual Agent используя свою учетную запись учебного заведения или рабочей электронной почты.
1. Если это первый бот, то вы должны попасть на **страницу приветствия** агента. Если это не первый Power Virtual Agent, выберите бота в области навигации справа и нажмите кнопку **+ New Bot** (Добавить бота).

    > [!div class="mx-imgBorder"]
    > ![Введите опубликованные параметры базы знаний на странице **Параметры** на портале [QnA Maker](https://www.qnamaker.ai/).](../media/how-to-integrate-power-virtual-agent/power-virtual-agent-home.png)

## <a name="several-topics-are-provided-in-the-bot"></a>Бот содержит несколько разделов

Агент использует коллекцию разделов для ответа на вопросы в нужной предметной области. В этом руководстве агент содержит множество разделов, разделенных на **Пользовательские разделы** и **Системные разделы**.

> [!div class="mx-imgBorder"]
> ![Агент использует коллекцию разделов для ответа на вопросы в нужной предметной области. В этом руководстве агент содержит множество разделов, разделенных на **Пользовательские разделы** и **Системные разделы**.](../media/how-to-integrate-power-virtual-agent/power-virtual-agent-topics-provided.png)


## <a name="create-power-virtual-agents-system-fallback-topic"></a>Создание системного раздела возврата в Power Virtual Agent

Несмотря на то, что агент может подключаться к базе знаний из любого раздела, в этом руководстве используется системный раздел **Возврат**. Раздел "Возврат" используется в том случае, если агенту не удается найти ответ. Агент передает текст пользователя в API-интерфейс GenerateAnswer в QnA Maker, получает ответ из базы знаний и возвращает его пользователю в виде сообщения.

1. На портале [Power Virtual Agents](https://powerva.microsoft.com/#/) в правом верхнем углу окна навигации выберите страницу **Параметры**. Эта страница обозначена значком шестеренки. Выберите узел **System Fallback** (Системный возврат).

    > [!div class="mx-imgBorder"]
    > ![Элемент меню "Power Virtual Agent" в узле System Fallback (Системный возврат)](../media/how-to-integrate-power-virtual-agent/power-virtual-agent-settings-system-fallback.png)

1. Во всплывающем окне **Параметры** выберите команду **+ Add** (Добавить), чтобы добавить раздел "Системный возврат".

    > [!div class="mx-imgBorder"]
    > ![В окне "Параметры" добавьте раздел возврата.](../media/how-to-integrate-power-virtual-agent/power-virtual-agent-settings-add-fallback-topic.png)

1. После добавления раздела выберите команду **Go to Fallback topic** (Перейти к разделу возврата), чтобы создать раздел возврата на холсте разработки.

    > [!TIP]
    > Если вам нужно вернуться к разделу возврата, он доступен в разделе **Разделы** в составе группы **Системные**.

## <a name="use-authoring-canvas-to-add-an-action"></a>Использование конструктора разработки для добавления действия

Используйте холст для создания Power Virtual Agent, чтобы подключить раздел возврата к базе знаний. Раздел начинается с **нераспознанного пользовательского текста**. Добавьте действие, которое передает этот текст в QnA Maker, а затем отображает ответ в виде сообщения. Последний этап отображения ответа обрабатывается как [отдельный шаг](#add-solutions-flow-to-power-virtual-agent) далее в этом руководстве.

В этом разделе создается поток беседы раздела возврата.

1. Новое действие возврата уже может иметь элементы потока беседы. Удалите элемент **Передать**, выбрав меню "Параметры".

    > [!div class="mx-imgBorder"]
    > ![Запуск действия возврата с помощью триггерных фраз](../media/how-to-integrate-power-virtual-agent/power-virtual-agent-fallback-topic-delete-escalate.png)

1. Выберите соединитель **+** , переходящий из **Сообщения**, а затем выберите команду **Вызвать действие**.

    > [!div class="mx-imgBorder"]
    > ![Вызов действия](../media/how-to-integrate-power-virtual-agent/create-new-item-call-an-action.png)

1. Выберите элемент **Создать поток**. Этот процесс откроет другой, предназначенный для браузера, портал — **Power Automate**.

    > [!div class="mx-imgBorder"]
    > ![Вызов действия](../media/how-to-integrate-power-virtual-agent/create-a-flow.png)

## <a name="create-power-automate-flow-to-connect-to-your-knowledge-base"></a>Создание потока Power Automate для подключения к базе знаний

Следующая процедура создает поток **Power Automate**, который:
* принимает входящий пользовательский текст;
* отправляет его в QnA Maker;
* назначает лучший ответ в QnA Maker в переменную;
* отправляет переменную (лучший ответ) как ответ обратно в агент.

1. В **Power Automate** запускается **Шаблон потока**. В элементе потока **Power Virtual Agents** выберите пункт **Изменить**, чтобы настроить входную переменную, поступающую от агента в базу знаний. Входная текстовая переменная — это отправленный пользователем текстовый вопрос от агента.

    > [!div class="mx-imgBorder"]
    > ![Настройка входной переменной в виде текстовой строки](../media/how-to-integrate-power-virtual-agent/power-automate-configure-input-variable.png)

1. Добавьте входной текст, дайте переменной имя `InputText` и описание `IncomingUserQuestion`. Такое именование помогает отличать входной текст от выходного текста, который вы создадите позже.

    > [!div class="mx-imgBorder"]
    > ![Добавление входного текста и присвоение переменной имени "InputText" и описания "UserQuestion"](../media/how-to-integrate-power-virtual-agent/power-automate-configure-input-variable-name-and-description.png)

1. Выберите соединитель **+** , переходящий из **Power Virtual Agent**, чтобы вставить новый шаг в поток перед группой **Return value(s) to Power Virtual Agent** (Вернуть значения в Power Virtual Agent), а затем выберите команду **Добавить действие**.

1. Выполните поиск `Qna`, чтобы найти действия **QnA Maker**, а затем выберите команду **Generate answer** (Создать ответ).

    > [!div class="mx-imgBorder"]
    > ![Поиск по запросу "QnA", чтобы найти действия **QnA Maker**, а затем выбор команды **Generate answer** (Создать ответ).](../media/how-to-integrate-power-virtual-agent/generate-answer-action-selected.png)

    В параметрах действия отображаются три (3) обязательных параметра подключения для QnA Maker и вопрос из Power Virtual Agent.

    > [!div class="mx-imgBorder"]
    > ![Параметры подключения для QnA Maker отображаются в действии.](../media/how-to-integrate-power-virtual-agent/generate-answer-knowledge-base-settings.png)

1. Настройте действие с помощью идентификатора базы знаний, узла конечной точки и ключа конечной точки. Они находятся на странице **Параметры** базы знаний на портале QnA Maker.

    > [!div class="mx-imgBorder"]
    > ![Введите опубликованные параметры базы знаний на странице **Параметры** на портале [QnA Maker](https://www.qnamaker.ai/).](../media/how-to-integrate-power-virtual-agent/published-knowledge-base-settings.png)

1. Чтобы настроить**Вопрос**, выберите текстовое поле, а затем выберите `InputText` в списке.

1. Чтобы вставить новый шаг в поток, выберите соединитель **+** в поле действия **Generate answer** (Создать ответ), а затем выберите команду **Добавить действие**.

1. Чтобы добавить переменную для захвата текста ответа, возвращаемого из интерфейса GenerateAnswer, найдите и выберите действие `Initialize variable`.

    Присвойте переменной имя `OutgoingQnAAnswer` и выберите тип **String**. Не задавайте **Значение**.

    > [!div class="mx-imgBorder"]
    > ![Присвоение переменной имени "QnAAnswer" и выбор типа **String**.](../media/how-to-integrate-power-virtual-agent/initialize-output-variable-for-qna-answer.png)

1. Чтобы вставить новый шаг в поток, выберите соединитель **+** в поле действия **Инициализировать переменную**, а затем выберите команду **Добавить действие**.

1. Чтобы назначить в переменную весь ответ JSON из базы знаний, найдите и выберите действие `Apply to each`. Выберите GenerateAnswer `answers`.

1. Чтобы вернуть только лучший ответ, в том же поле **Применить к каждому**, выберите команду **Добавить действие**. Найдите и выберите элемент **Задание переменной**.

    В поле **Задание переменной** выберите текстовое поле для **Имя**, а затем выберите **OutgoingQnAAnswer** в списке.

    Выберите текстовое поле **Значение**, а затем в списке выберите значение **Answers Answer**.

    > [!div class="mx-imgBorder"]
    > ![Задание имени и значения для переменной ](../media/how-to-integrate-power-virtual-agent/power-automate-flow-apply-to-each-set-variable.png)

1. Чтобы вернуть переменную (и ее значение), выберите элемент потока **Return value(s) to Power Virtual Agent** (Вернуть значения в Power Virtual Agent), а затем выберите команду **Изменить**, затем — **Добавить выходные данные**. Выберите тип выходных данных **Текст**, а затем введите **Заголовок** в `FinalAnswer`. Выберите текстовое поле для параметра **Значение**, а затем выберите переменную `OutgoingQnAAnswer`.

    > [!div class="mx-imgBorder"]
    > ![Задание возвращаемого значения](../media/how-to-integrate-power-virtual-agent/power-automate-flow-return-value.png)

1. Нажмите кнопку **Сохранить**, чтобы сохранить поток.

## <a name="create-solution-and-add-flow"></a>Создание решения и добавление потока

Чтобы Power Virtual Agent мог находить поток и подключаться к нему, он должен быть включен в решение Power Automate.

1. На портале Power Automate, выберите **Решения** в области навигации слева.

1. Выберите команду **Создать решение**.

1. Введите отображаемое имя. Список решений содержит все решения в вашей организации или учебном заведении. Выберите соглашение об именовании, которое поможет отфильтровать только нужные решения, например указав адрес электронной почты в начале имени решения: `jondoe-power-virtual-agent-qnamaker-fallback`.

1. Выберите издателя в списке вариантов.

1. Примите значения по умолчанию для имени и версии.

1. Нажмите кнопку **Создать**, чтобы завершить процесс.

## <a name="add-flow-to-solution"></a>Добавление потока в решение

1. В списке решений выберите только что созданное решение. Оно должно находиться в верхней части списка. Если это не так, выполните поиск по адресу электронной почты, который является частью имени решения.

1. В решении выберите команду **Добавить существующий**, а затем в списке выберите **Поток**.

1. Найдите нужный поток, а затем нажмите кнопку **Добавить**, чтобы завершить процесс. Если потоков много, просмотрите столбец **Изменен**, чтобы найти самый последний поток.

## <a name="add-solutions-flow-to-power-virtual-agent"></a>Добавление потока решения в Power Virtual Agent

1. Вернитесь на вкладку браузера с открытым Power Virtual Agent. Созданный холст по-прежнему должен быть открыт.

1. Выберите соединитель **+** в поле действия **Сообщение**, чтобы вставить новый шаг в поток, а затем выберите команду **Вызвать действие**.

1. В новом действии выберите входное значение **UnrecognizedTriggerPhrase**. При этом текст будет передан из агента в поток.

    > [!div class="mx-imgBorder"]
    > ![В новом действии выберите входное значение **UnrecognizedTriggerPhrase**.](../media/how-to-integrate-power-virtual-agent/power-virtual-agent-select-unrecognized-trigger-phrase.png)

1. Выберите соединитель **+** в поле **Действие**, чтобы вставить новый шаг в поток, а затем выберите команду **Отобразить сообщение**.

1. Введите текст сообщения, `Your answer is:`, и выберите `FinalAnswer` в качестве переменной контекста с помощью функции панели инструментов.

    > [!div class="mx-imgBorder"]
    > ![Введите текст сообщения и "FinalAnswer" в потоке Power Automate.](../media/how-to-integrate-power-virtual-agent/power-virtual-agent-topic-authoring-canvas-show-message-final-answer.png)

1. Нажмите кнопку **Сохранить** на панели инструментов контекста, чтобы сохранить сведения о создании холста для раздела.

Окончательный холст показан ниже.

> [!div class="mx-imgBorder"]
> ![Окончательный холст агента](../media/how-to-integrate-power-virtual-agent/power-virtual-agent-topic-authoring-canvas-full-flow.png)

## <a name="test-power-virtual-agent"></a>Тестирование Power Virtual Agent

1. На панели тестирования установите переключатель **Track between topics** (Отслеживать по разделам). Это позволяет отслеживать ход выполнения по нескольким разделам как в одном разделе.

1. Протестируйте агент, введя пользовательский текст в указанном ниже порядке. На холсте разработки успешно выполненные шаги будут отмечены зеленой галочкой.

|Порядок вопросов|Тестовые вопросы|Назначение|
|--|--|--|
|1|Привет|Начало беседы|
|2|Время хранения|Образец раздела — настроен без каких-либо дополнительных усилий с вашей стороны.|
|3|Да|Ответ на `Did that answer your question?`|
|4|Высокая|Ответ на `Please rate your experience.`|
|5|Да|Ответ на `Can I help with anything else?`|
|6|Что представляет собой база знаний|Этот вопрос активирует действие возврата, которое отправляет текст в базу знаний для ответа, после чего отображается ответ. |

> [!div class="mx-imgBorder"]
> ![Окончательный холст агента](../media/how-to-integrate-power-virtual-agent/power-virtual-agent-test-tracked.png)

## <a name="publish-your-bot"></a>Публикация бота

Чтобы сделать агент доступным для всех участников учебного заведения или организации, его необходимо опубликовать.

1. Выберите элемент **Опубликовать** в области навигации слева, а затем на странице нажмите кнопку **Опубликовать**.

1. Попробуйте бота на демонстрационном веб-сайте, который доступен по ссылке под кнопкой **Опубликовать**.

    Откроется новая веб-страница с ботом. Задайте боту тот же тестовый вопрос: `What is a knowledge base?`

    > [!div class="mx-imgBorder"]
    > ![Окончательный холст агента](../media/how-to-integrate-power-virtual-agent/demo-chat-bot.png)

## <a name="share-your-bot"></a>Публикация своего бота

Чтобы предоставить общий доступ к демонстрационному веб-сайту, настройте его как канал.

1. В области навигации слева выберите последовательно **Управление**, а затем — **Каналы**.

1. В списке каналов выберите **Демонстрационный веб-сайт**.

1. Скопируйте ссылку и нажмите кнопку **Сохранить**. Вставьте ссылку на свой демонстрационный веб-сайт в сообщение электронной почты для пользователей в учебном заведении или организации.

## <a name="clean-up-resources"></a>Очистка ресурсов

Завершив работу с базой знаний, удалите ресурсы QnA Maker на портале Azure.

## <a name="next-step"></a>Следующий шаг

[Анализ базы знаний](../How-To/get-analytics-knowledge-base.md)

См. также:
* [Power Virtual Agents](https://docs.microsoft.com/power-virtual-agents/)
* [Power Automate](https://docs.microsoft.com/power-automate/)
* [Соединитель QnA Maker](https://us.flow.microsoft.com/connectors/shared_cognitiveservicesqnamaker/qna-maker/) и [настройки соединителя](https://docs.microsoft.com/connectors/cognitiveservicesqnamaker/)