---
title: Ресурсы Azure — QnA Maker
description: QnA Maker использует несколько источников Azure, каждый из которых имеет другую цель. Понимание того, как они используются отдельно, позволяет планировать и выбирать правильную ценовую категорию или знать, когда нужно изменить ценовую категорию. Понимание того, как они используются в сочетании, позволяет находить и устранять проблемы при их возникновении.
ms.service: cognitive-services
ms.subservice: qna-maker
ms.topic: conceptual
ms.date: 03/25/2020
ms.openlocfilehash: 62f627fb9765f2a86a373f74c33437680c9305af
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "91777060"
---
# <a name="azure-resources-for-qna-maker"></a>Ресурсы Azure для QnA Maker

QnA Maker использует несколько источников Azure, каждый из которых имеет другую цель. Понимание того, как они используются отдельно, позволяет планировать и выбирать правильную ценовую категорию или знать, когда нужно изменить ценовую категорию. Понимание того, как они используются _в сочетании_ , позволяет находить и устранять проблемы при их возникновении.

## <a name="resource-planning"></a>Планирование ресурсов

При первой разработке QnA Maker базы знаний на этапе прототипа обычно используется один QnA Maker ресурс для тестирования и производства.

При переходе на этап разработки проекта следует учитывать следующее.

* Сколько языков будет храниться система базы знаний
* Сколько регионов необходимо для базы знаний, чтобы быть доступными в/с
* Количество документов в каждом домене, на котором будет храниться система

Запланируйте, чтобы один ресурс QnA Maker содержал все базы знаний, имеющие одинаковый язык, один и тот же домен и одну комбинацию предметной области.

## <a name="pricing-tier-considerations"></a>Рекомендации по ценовым категориям

Обычно необходимо учитывать три параметра:

* **Требуемая пропускная способность службы**:
    * выберите соответствующий [план приложений](https://azure.microsoft.com/pricing/details/app-service/plans/) для службы приложений с учетом требований. Масштаб приложения можно [увеличить](https://docs.microsoft.com/azure/app-service/manage-scale-up) или уменьшить.
    * Это также должно повлиять на выбор SKU **когнитивный Поиск** Azure. Дополнительные сведения см. [здесь](https://docs.microsoft.com/azure/search/search-sku-tier). Кроме того, может потребоваться изменить [емкость](../../../search/search-capacity-planning.md) когнитивный Поиск с помощью реплик.

* **Размер и количество баз знаний**: выберите соответствующий номер [SKU Поиска Azure](https://azure.microsoft.com/pricing/details/search/) для вашего сценария. Как правило, выбор необходимого количества баз знаний зависит от количества разных доменов субъектов. Как только домен субъекта (для одного языка) должен находиться в одной базе знаний.

    На определенном уровне можно опубликовать N-1 баз знаний, где N — максимальное разрешенное на этом уровне количество индексов. Также проверьте максимальный размер и количество документов, разрешенные для каждого уровня.

    Например, если для уровня допускается 15 индексов, можно опубликовать 14 баз знаний (1 индекс для каждой опубликованной базы знаний). Пятнадцатый индекс используется для разработки и тестирования всех баз знаний.

* **Количество документов в качестве источников**: SKU службы управления QnA Maker ценовой категории "Бесплатный" разрешает управлять через портал и API-интерфейсы только тремя документами размером 1 МБ каждый. Номер SKU уровня "Стандартный"не имеет ограничений на число документов, которыми можно управлять. Дополнительные сведения см. [здесь](https://aka.ms/qnamaker-pricing).

В следующей таблице приведен ряд общих рекомендаций.

|                            | Управление службой QnA Maker | Служба приложений | Когнитивный поиск Azure | Ограничения                      |
| -------------------------- | -------------------- | ----------- | ------------ | -------------------------------- |
| **Экспериментирование**        | Номер SKU уровня "Бесплатный"             | Уровень "Бесплатный"   | Уровень "Бесплатный"    | Публикация до 2 баз знаний размером 50 Мбайт  |
| **Среда разработки и тестирования**   | SKU "Стандартный"         | Совмещаемая блокировка      | Basic        | Публикация до 14 баз знаний размером 2 ГБ    |
| **Рабочая среда** | SKU "Стандартный"         | Basic       | Standard     | Публикация до 49 баз знаний размером 25 Гбайт |

## <a name="recommended-settings"></a>Рекомендуемые параметры

|Целевой QPS | Служба приложений | Когнитивный поиск Azure |
| -------------------- | ----------- | ------------ |
| 3             | S1, 1 экземпляр   | S1, 1 экземпляр    |
| 50         | S3, 10 экземпляров       | Экземпляры S1, 12         |
| 80         | S3, 10 экземпляров      |  S3, 12 экземпляров  |
| 100         | P3V2, 10 экземпляров  | S3, 12 экземпляров, 3 раздела   |
| от 200 до 250         | P3V2, 20 экземпляров | S3, 12 экземпляров, 3 раздела    |

## <a name="when-to-change-a-pricing-tier"></a>Когда следует изменять ценовую категорию

|Обновление|Причина|
|--|--|
|[Обновление](../How-to/set-up-qnamaker-service-azure.md#upgrade-qna-maker-sku) SKU управления QnA Maker|В базе знаний требуется больше QnA пар или источников документов.|
|[Обновление](../How-to/set-up-qnamaker-service-azure.md#upgrade-app-service) SKU службы приложений и проверка уровня Когнитивный поиск и [Создание реплик когнитивный Поиск](../../../search/search-capacity-planning.md)|База знаний должна обслуживать больше запросов из клиентского приложения, например Bot чата.|
|[Обновление](../How-to/set-up-qnamaker-service-azure.md#upgrade-the-azure-cognitive-search-service) Служба Когнитивный поиск Azure|Вы планируете использовать множество баз знаний.|

Получите последние обновления среды выполнения, [обновив службу приложений в портал Azure](../how-to/set-up-qnamaker-service-azure.md#get-the-latest-runtime-updates).

## <a name="resource-naming-considerations"></a>Рекомендации по именованию ресурсов

Имя ресурса для QnA Maker ресурса, например `qna-westus-f0-b` , также используется для именования других ресурсов.

Окно портал Azure создание позволяет создать QnA Maker ресурс и выбрать ценовые категории для других ресурсов.

> [!div class="mx-imgBorder"]
> ![Снимок экрана портал Azure для создания ресурса QnA Maker](../media/concept-azure-resource/create-blade.png)

После создания ресурсов они имеют одно и то же имя, за исключением необязательного Application Insights ресурса, который постпендс символы в имя.

> [!div class="mx-imgBorder"]
> ![Снимок экрана портал Azure списка ресурсов](../media/concept-azure-resource/all-azure-resources-created-qnamaker.png)

> [!TIP]
> Создайте новую группу ресурсов при создании QnA Maker ресурса. Это позволяет просматривать все ресурсы, связанные с QnA Makerным ресурсом при поиске по группе ресурсов.

> [!TIP]
> Используйте соглашение об именовании, чтобы указать ценовые категории в имени ресурса или группы ресурсов. При возникновении ошибок при создании новой базы знаний или добавлении новых документов Когнитивный поиск ограничение ценовой категории является распространенной проблемой.

## <a name="resource-purposes"></a>Назначение ресурсов

Каждый ресурс Azure, созданный с QnA Maker, имеет определенную цель:

* Ресурс QnA Maker
* Ресурс Когнитивный поиск
* Служба приложений
* Служба плана приложений
* Служба Application Insights


### <a name="cognitive-search-resource"></a>Ресурс Когнитивный поиск

Ресурс [когнитивный Поиск](../../../search/index.yml) используется для:

* Хранение пар QnA
* Укажите начальное ранжирование (#1 ранжирования) для пар QnA во время выполнения

#### <a name="index-usage"></a>Использование индекса

Ресурс сохраняет один индекс в качестве тестового индекса, а оставшиеся индексы сопоставляются с одной опубликованной базой знаний.

Ресурс оплачивается для хранения 15 индексов, будет содержать 14 опубликованных баз знаний, а один индекс используется для тестирования всех баз знаний. Этот индекс теста секционируется по базе знаний, чтобы запрос, использующий интерактивную область тестирования, использовал тестовый индекс, но возвращал только результаты из определенной секции, связанной с определенной базой знаний.

#### <a name="language-usage"></a>Использование языка

Первая база знаний, созданная в ресурсе QnA Maker, используется для определения набора _единственных_ языков для когнитивный поискного ресурса и всех его индексов. Для службы QnA Maker можно использовать только _один языковой набор_ .

### <a name="qna-maker-resource"></a>Ресурс QnA Maker

Ресурс QnA Maker предоставляет доступ к API-интерфейсам создания и публикации, а также по второму уровню ранжирования (#2 ранжирования) на основе пар QnA во время выполнения.

Второй рейтинг применяет интеллектуальные фильтры, которые могут включать метаданные и дальнейшие подсказки.

#### <a name="qna-maker-resource-configuration-settings"></a>QnA Maker параметры конфигурации ресурсов

При создании новой базы знаний на [портале QnA Maker](https://qnamaker.ai)параметр **языка** является единственным параметром, который применяется на уровне ресурса. Язык выбирается при создании первой базы знаний для ресурса.

### <a name="app-service-and-app-service-plan"></a>Служба приложений и план службы приложений

[Служба приложений](../../../app-service/index.yml) используется вашим клиентским приложением для доступа к опубликованным базам знаний через конечную точку среды выполнения.

Для запроса опубликованной базы знаний все опубликованные базы знаний используют одну и ту же конечную точку URL-адреса, но указывают **идентификатор базы знаний** в маршруте.

`{RuntimeEndpoint}/qnamaker/knowledgebases/{kbId}/generateAnswer`

### <a name="application-insights"></a>Application Insights

[Application Insights](../../../azure-monitor/app/app-insights-overview.md) используется для сбора данных о журналах разговора и данных телеметрии. Ознакомьтесь с общими [запросами Kusto](../how-to/get-analytics-knowledge-base.md) для получения сведений о службе.

## <a name="share-services-with-qna-maker"></a>Совместное использование служб с QnA Maker

QnA Maker создает несколько ресурсов Azure. Чтобы упростить управление и воспользоваться преимуществами совместного использования затрат, используйте следующую таблицу, чтобы понять, что вы можете и не можете поделиться:

|Служба|Поделиться|Причина|
|--|--|--|
|Службы Cognitive Services|X|Невозможно по проекту|
|План службы приложений|✔|Фиксированное дисковое пространство, выделенное для плана службы приложений. Если другие приложения, использующие один план службы приложений, используют значительное место на диске, экземпляр службы приложений QnAMaker будет столкнуться с проблемами.|
|Служба приложений|X|Невозможно по проекту|
|Application Insights|✔|Может быть в общем доступе.|
|Служба поиска|✔|1. `testkb` является зарезервированным именем для службы QnAMaker; оно не может использоваться другими пользователями.<br>2. Сопоставление синонимов по имени `synonym-map` зарезервировано для службы QnAMaker.<br>3. количество опубликованных баз знаний ограничено уровнем службы поиска. Если доступны свободные индексы, они могут использоваться другими службами.|

### <a name="using-a-single-cognitive-search-service"></a>Использование одной службы Когнитивный поиск

Если вы создаете службу QnA и ее зависимости (например, поиск) на портале, служба поиска создается и связывается со службой QnA Maker. После создания этих ресурсов можно обновить параметр службы приложений, чтобы использовать ранее существующую службу поиска, и удалить только что созданную.

Узнайте, [как настроить](../How-To/set-up-qnamaker-service-azure.md#configure-qna-maker-to-use-different-cognitive-search-resource) QnA Maker для использования другого ресурса службы, отличного от того, который был создан как часть процесса создания ресурса QnA Maker.

## <a name="management-service-region"></a>Регион службы управления

Служба управления QnA Maker используется только для портала QnA Maker и для начальной обработки данных. Эта служба доступна только в регионе " **Западная часть США** ". В этой западной службе США не хранятся данные клиентов.

## <a name="keys-in-qna-maker"></a>Ключи в QnA Maker

Ваша служба QnA Maker работает с двумя типами ключей: **Создание ключей** и **ключи конечной точки запроса** , используемые со средой выполнения, размещенной в службе приложений.

Если вы ищете **ключ подписки**, [терминология изменилась](#subscription-keys).

Используйте эти ключи при выполнении запросов к службе через API-интерфейсы.

![Управление ключами](../media/qnamaker-how-to-key-management/key-management.png)

|Имя|Расположение|Назначение|
|--|--|--|
|Ключ разработки|[Портал Azure](https://azure.microsoft.com/free/cognitive-services/)|используются для доступа к [API службы управления QnA Maker](https://go.microsoft.com/fwlink/?linkid=2092179). Эти API позволяют изменять вопросы и ответы в базе знаний и публиковать базу знаний. Эти ключи создаются при создании новой службы QnA Maker.<br><br>Эти ключи находятся на **Cognitive Services** ресурсе на странице **ключи** .|
|Ключ конечной точки запроса|[Портал QnA Maker](https://www.qnamaker.ai)|Эти ключи используются для запроса конечной точки опубликованной базы знаний, чтобы получить ответ на пользовательский вопрос. Обычно эта конечная точка запроса используется в программе-роботе чата или в коде клиентского приложения, который подключается к службе QnA Maker. Эти ключи создаются при публикации базы знаний QnA Maker.<br><br>Эти ключи находятся на странице " **Параметры службы** ". Найдите эту страницу в меню пользователя в правой верхней части страницы в раскрывающемся меню.|

### <a name="subscription-keys"></a>Ключи подписки

Написание терминов и ключ конечной точки запроса являются правильными терминами. Предыдущий термин был **ключом подписки**. Если вы видите другую документацию, ссылающуюся на ключи подписки, они эквивалентны созданию ключей конечных точек и запросов (используемых в среде выполнения).

Чтобы узнать, какой ключ необходимо найти, необходимо знать, к чему обращается ключ, Управление базой знаний или запрос базы знаний.

## <a name="recommended-settings-for-network-isolation"></a>Рекомендуемые параметры для сетевой изоляции

* Защитите ресурс службы для переприятия из общего доступа, [настроив виртуальную сеть](https://docs.microsoft.com/azure/cognitive-services/cognitive-services-virtual-networks?tabs=portal).
* Защита службы приложений (среда выполнения QnA) от общего доступа:
    * Разрешать трафик только от исходящего IP-адреса службы. Они уже включены в тег службы "Когнитивесервицесманажемент". Это необходимо для создания API-интерфейсов (создания или обновления базы знаний), чтобы вызвать службу приложений и соответствующим образом обновить службу поиска Azure.
    * Убедитесь, что вы также разрешите другие точки входа, такие как Bot-служба, QnA Maker портал (может быть вашей корпоративной сети) и т. д. для доступа к API прогнозирования "Женератеансвер".
    * Ознакомьтесь с [дополнительными сведениями о тегах служб.](https://docs.microsoft.com/azure/virtual-network/service-tags-overview)

## <a name="next-steps"></a>Дальнейшие шаги

* Сведения о базе [знаний](knowledge-base.md) QnA Maker
* Общие сведения о [жизненном цикле базы знаний](development-lifecycle-knowledge-base.md)
* Проверка [ограничений](../limits.md) службы и базы знаний

