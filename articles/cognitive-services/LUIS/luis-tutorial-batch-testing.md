---
title: Руководство по Пакетное тестирование — LUIS
titleSuffix: Azure Cognitive Services
description: В этом руководстве показано, как использовать пакетное тестирование для поиска и устранения проблем с прогнозированием высказываний в приложении.
services: cognitive-services
author: diberry
manager: nitinme
ms.custom: seodec18
ms.service: cognitive-services
ms.subservice: language-understanding
ms.topic: tutorial
ms.date: 10/14/2019
ms.author: diberry
ms.openlocfilehash: ac88931d79df6c2527a2a5fd72b440baeb463115
ms.sourcegitcommit: c22327552d62f88aeaa321189f9b9a631525027c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2019
ms.locfileid: "73499061"
---
# <a name="tutorial-batch-test-data-sets"></a>Руководство по Пакетное тестирование наборов данных

В этом руководстве показано, как использовать пакетное тестирование для поиска и устранения проблем с прогнозированием высказываний в приложении.  

Пакетное тестирование позволяет проверить состояние активной, обученной модели с известным набором помеченных высказываний и сущностей. В пакетном файле в формате JSON добавьте высказывания и установите метки сущностей, которые нужно спрогнозировать внутри высказывания. 

Требования к пакетному тестированию.

* Не более 1000 высказываний за тест. 
* Без дубликатов. 
* Разрешенные типы сущностей: только машинно-обученные простые или составные сущности. Пакетное тестирование полезно только для машинно-обученных намерений и сущностей.

При использовании приложения, которое отличается от описанного в этом руководстве, *не* используйте примеры высказываний, которые уже добавлены в намерение. 

[!INCLUDE [Waiting for LUIS portal refresh](./includes/wait-v3-upgrade.md)]

**В этом руководстве рассмотрено, как выполнять следующие задачи.**

<!-- green checkmark -->
> [!div class="checklist"]
> * Импорт примера приложения
> * Создание файла пакетного теста 
> * Выполнение пакетного теста
> * Просмотр результатов теста
> * Исправление ошибок 
> * Повторное тестирование пакета

[!INCLUDE [LUIS Free account](../../../includes/cognitive-services-luis-free-key-short.md)]

## <a name="import-example-app"></a>Импорт примера приложения

Продолжите работу с приложением **HumanResources**, созданным в рамках последнего руководства. 

Выполните следующие действия.

1.  Загрузите и сохраните [JSON-файл приложения](https://github.com/Azure-Samples/cognitive-services-language-understanding/blob/master/documentation-samples/tutorials/custom-domain-review-HumanResources.json).

2. Импортируйте JSON-файл в новое приложение.

3. Из раздела **Управление** на вкладке **Версии** скопируйте версию и назовите ее `batchtest`. Клонирование — это отличный способ поэкспериментировать с различными функциями LUIS без влияния на исходную версию. Так как имя версии используется в маршруте URL-адреса, оно не может содержать символы, которые недопустимы в URL-адресе. 

4. Обучите приложение.

## <a name="batch-file"></a>Пакетный файл

1. Создайте файл `HumanResources-jobs-batch.json` в текстовом редакторе или [скачайте](https://github.com/Azure-Samples/cognitive-services-language-understanding/blob/master/documentation-samples/tutorials/HumanResources-jobs-batch.json) его. 

2. В пакетный файл в формате JSON добавьте высказывания с **намерением**, которое должно быть спрогнозировано в тесте. 

   [!code-json[Add the intents to the batch test file](~/samples-luis/documentation-samples/tutorials/HumanResources-jobs-batch.json "Add the intents to the batch test file")]

## <a name="run-the-batch"></a>Запуск пакетного теста

1. Нажмите кнопку **Test** (Тестировать) в верхней панели навигации. 

2. На правой панели щелкните ссылку **Batch testing panel** (Панель пакетного тестирования). 

    [![Снимок экрана приложения LUIS с выделенной ссылкой "Batch testing panel" (Панель пакетного тестирования)](./media/luis-tutorial-batch-testing/hr-batch-testing-panel-link.png)](./media/luis-tutorial-batch-testing/hr-batch-testing-panel-link.png#lightbox)

3. Нажмите кнопку **Import dataset** (Импортировать набор данных).

    [![Снимок экрана приложения LUIS с выделенной кнопкой "Import dataset" (Импортировать набор данных)](./media/luis-tutorial-batch-testing/hr-import-dataset-button.png)](./media/luis-tutorial-batch-testing/hr-import-dataset-button.png#lightbox)

4. Выберите расположение для файла `HumanResources-jobs-batch.json`.

5. Назовите набор данных `intents only` и выберите **Готово**.

    ![Выбор файла](./media/luis-tutorial-batch-testing/hr-import-new-dataset-ddl.png)

6. Нажмите кнопку **Запустить**. 

7. Щелкните **See results** (Просмотреть результаты).

8. Просмотрите результаты на диаграмме и в условных обозначениях.

    [![Снимок экрана приложения LUIS с результатами пакетного тестирования](./media/luis-tutorial-batch-testing/hr-intents-only-results-1.png)](./media/luis-tutorial-batch-testing/hr-intents-only-results-1.png#lightbox)

## <a name="review-batch-results"></a>Просмотр результатов пакетного тестирования

Пакетная диаграмма отображает четыре квадранта результатов. В правой части диаграммы находится фильтр. Фильтр содержит намерения и сущности. При выборе [раздела диаграммы](luis-concept-batch-test.md#batch-test-results) или точки внутри диаграммы соответствующие высказывания отображаются под диаграммой. 

При наведении курсора на диаграмму с помощью колеса мыши можно увеличить или уменьшить отображение. Это полезно в тех случаях, когда на диаграмме собрано много плотно сгруппированных точек. 

Диаграмма состоит из четырех квадрантов, два из которых выделены красным цветом. **Это разделы, требующие внимания**. 

### <a name="getjobinformation-test-results"></a>Результаты теста GetJobInformation

Результаты теста **GetJobInformation**, отображаемые в фильтре, показывают, что 2 из четырех прогнозов были успешными. Выберите имя **Ложный отрицательный результат** в нижнем левом квадранте, чтобы увидеть речевой фрагмент под диаграммой. 

Используйте сочетание клавиш CTRL + E для перехода к представлению меток, чтобы увидеть точный текст пользовательского речевого фрагмента. 

Речевой фрагмент `Is there a database position open in Los Colinas?` помечается как _GetJobInformation_, но текущая модель прогнозирует речевой фрагмент как _ApplyForJob_. 

Существует почти в три раза больше примеров для **ApplyForJob**, чем для **GetJobInformation**. Эта неравномерность примеров речевых фрагментов перевешивает в пользу **ApplyForJob**, вызывая неверный прогноз. 

Обратите внимание, что оба намерения имеют одинаковое количество ошибок. Неправильное прогнозирование в одном намерении также влияет на другое намерение. Они оба имеют ошибки, потому что высказывания были неправильно спрогнозированы для обоих намерений. 

<a name="fix-the-app"></a>

## <a name="how-to-fix-the-app"></a>Как исправить приложение

Цель этого раздела — правильно спрогнозировать все высказывания для **GetJobInformation**, исправляя приложение. 

По-видимому, быстрое исправление заключается в том, чтобы добавить эти высказывания пакетного файла к правильному намерению. Это не то, что нужно сделать. Нужно, чтобы служба LUIS правильно спрогнозировала эти высказывания, не добавляя их в качестве примеров. 

Могут также возникнуть вопросы об удалении высказываний из **ApplyForJob**, пока количество высказываний не будет таким же, как у **GetJobInformation**. Это может исправить результаты тестирования, но препятствует службе LUIS точно спрогнозировать это намерение в следующий раз. 

Способ исправления заключается в добавлении дополнительных речевых фрагментов в **GetJobInformation**. Не забывайте изменять длину речевых фрагментов, выбор слов и порядок слов, все еще ориентируясь на намерение найти информацию о работе, но _не_ применение для этой работы.

### <a name="add-more-utterances"></a>Добавление высказываний

1. Закройте панель пакетного тестирования, нажав кнопку **Test** (Тестирование) на верхней панели навигации. 

2. Выберите **GetJobInformation** из списка намерений. 

3. Добавьте дополнительные высказывания, которые различаются по длине, подбору и расположению слов, поэтому обязательно включайте термины `resume`, `c.v.` и `apply`.

    |Примеры высказываний для намерения **GetJobInformation**|
    |--|
    |Does the new job in the warehouse for a stocker require that I apply with a resume?|
    |Where are the roofing jobs today?|
    |I heard there was a medical coding job that requires a resume.|
    |I would like a job helping college kids write their c.v.s. |
    |Here is my resume, looking for a new post at the community college using computers.|
    |What positions are available in child and home care?|
    |Is there an intern desk at the newspaper?|
    |My C.v. shows I'm good at analyzing procurement, budgets, and lost money. Is there anything for this type of work?|
    |Where are the earth drilling jobs right now?|
    |I've worked 8 years as an EMS driver. Any new jobs?|
    |New food handling jobs require application?|
    |How many new yard work jobs are available?|
    |Is there a new HR post for labor relations and negotiations?|
    |I have a masters in library and archive management. Any new positions?|
    |Are there any babysitting jobs for 13 year olds in the city today?|

    Не отмечайте сущность **Job** в высказываниях. Этот раздел руководства ориентирован только на прогнозирование намерения.

4. Обучите приложение, выбрав **Train** (Обучать) в правом верхнем углу.

## <a name="verify-the-new-model"></a>Проверка новой модели

Чтобы проверить правильность прогнозирования высказываний пакетного тестирования, запустите пакетный тест еще раз.

1. Нажмите кнопку **Test** (Тестировать) в верхней панели навигации. Если результаты пакетного тестирования по-прежнему открыты, выберите **Назад к списку**.  

1. Нажмите кнопку многоточия (***...***) справа от имени пакета и выберите **Запустить**. Дождитесь завершения пакетного теста. Обратите внимание, что кнопка **See results** (Просмотреть результаты) теперь зеленого цвета. Это означает, что весь пакет успешно выполнен.

1. Щелкните **See results** (Просмотреть результаты). У всех намерений должны быть зеленые значки слева от имен. 

## <a name="create-batch-file-with-entities"></a>Создание пакетного файла с сущностями 

Чтобы проверить сущности в пакетном тесте, они должны быть помечены в пакетном файле в формате JSON. 

Изменение сущности для общего количества слов ([токенов](luis-glossary.md#token)) может повлиять на качество прогнозирования. Удостоверьтесь, что данные обучения, предоставленные намерению с помеченными высказываниями, включают в себя множество длин сущности. 

При первом написании и тестировании пакетных файлов лучше всего начать с нескольких высказываний и сущностей, которые, как вы знаете, работают, а также нескольких, которые, по вашему мнению, могут быть неправильно спрогнозированы. Это поможет быстро сосредоточиться на проблемных областях. После тестирования намерений **GetJobInformation** и **ApplyForJob** с использованием нескольких разных имен сущности Job, которые не были спрогнозированы, этот файл пакетного тестирования был разработан для того, чтобы увидеть, есть ли проблема с прогнозированием определенных значений для сущности **Job**. 

Значение сущности **задания**, представленное в тестовых высказываниях, обычно является одним или двумя словами, в нескольких примерах больше слов. Если _ваше собственное_ приложение по управлению персоналом обычно имеет имена заданий, составленные с нескольких слов, примеры высказываний с меткой **Job**  в этом приложении не будут работать хорошо.

1. Создайте файл `HumanResources-entities-batch.json` в текстовом редакторе, таком как [VSCode](https://code.visualstudio.com/), или [скачайте](https://github.com/Azure-Samples/cognitive-services-language-understanding/blob/master/documentation-samples/tutorials/HumanResources-entities-batch.json) этот файл.

2. В пакетном файле в формате JSON добавьте массив объектов, которые включают высказывания с **намерением**, которое необходимо спрогнозировать во время тестирования, а также местоположения любых сущностей в высказывании. Поскольку сущность основана на токенах, обязательно запускайте и останавливайте каждую сущность на символе. Не начинайте или заканчивайте высказывание пробелом. Это приводит к ошибке во время импорта пакетного файла.  

   [!code-json[Add the intents and entities to the batch test file](~/samples-luis/documentation-samples/tutorials/HumanResources-entities-batch.json "Add the intents and entities to the batch test file")]


## <a name="run-the-batch-with-entities"></a>Запустите пакетный тест с сущностями

1. Нажмите кнопку **Test** (Тестировать) в верхней панели навигации. 

2. На правой панели щелкните ссылку **Batch testing panel** (Панель пакетного тестирования). 

3. Нажмите кнопку **Import dataset** (Импортировать набор данных).

4. Выберите расположение файловой системы для файла `HumanResources-entities-batch.json`.

5. Назовите набор данных `entities` и выберите **Готово**.

6. Нажмите кнопку **Запустить**. Дождитесь завершения теста.

7. Щелкните **See results** (Просмотреть результаты).

## <a name="review-entity-batch-results"></a>Просмотр результатов пакетного тестирования сущностей

Диаграмма открывается со всеми намерениями, которые были правильно спрогнозированы. Прокрутите вниз в фильтре справа, чтобы найти прогнозирования сущностей с ошибками. 

1. Выберите сущность **Job** в фильтре.

    ![Прогнозирования сущностей с ошибкой в фильтре](./media/luis-tutorial-batch-testing/hr-entities-filter-errors.png)

    Диаграмма изменяется, чтобы отобразить прогнозирование сущностей. 

2. Выберите **False Negative** (Ложный отрицательный результат) в левом нижнем квадранте диаграммы. Затем нажмите клавиши CTRL + Е для переключения в представление токена. 

    [![Представление токена прогнозирования сущностей](./media/luis-tutorial-batch-testing/token-view-entities.png)](./media/luis-tutorial-batch-testing/token-view-entities.png#lightbox)
    
    При просмотре высказываний под диаграммой появляется непротиворечивая ошибка, когда имя задания включает `SQL`. Рассматривая примеры высказываний и список фраз Job, SQL используется только один раз и только как часть более крупного имени задания `sql/oracle database administrator`.

## <a name="fix-the-app-based-on-entity-batch-results"></a>Исправление приложения на основе результатов пакетного тестирования сущностей

Исправление приложения требует, чтобы служба LUIS правильно определяла варианты задания SQL. Существует несколько вариантов исправления. 

* Явным образом добавьте несколько примеров высказываний, которые используют SQL и помечают эти слова в качестве сущности Job. 
* Явным образом добавьте дополнительные задания SQL в список фраз

Эти задачи оставлены для вас.

Добавление [шаблона](luis-concept-patterns.md) до того, как сущность будет правильно спрогнозирована, не решит проблему. Это связано с тем, что шаблон не будет соответствовать, пока не будут обнаружены все сущности в шаблоне. 

## <a name="clean-up-resources"></a>Очистка ресурсов

[!INCLUDE [LUIS How to clean up resources](../../../includes/cognitive-services-luis-tutorial-how-to-clean-up-resources.md)]

## <a name="next-steps"></a>Дополнительная информация

В этом руководстве вы использовали пакетное тестирование для поиска проблем с текущей моделью. Вы исправили модель и провели повторное тестирование с использованием пакетного файла, чтобы убедиться в правильности изменения.

> [!div class="nextstepaction"]
> [Tutorial: Improve app with pattern roles](luis-tutorial-pattern.md) (Руководство. Улучшение приложения с ролями шаблонов)

