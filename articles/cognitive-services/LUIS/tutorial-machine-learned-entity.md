---
title: Руководство. Извлечение структурированных данных с помощью сущности, прошедшей машинное обучение (LUIS)
titleSuffix: Azure Cognitive Services
description: Извлечение структурированных данных из речевого фрагмента с помощью сущности, прошедшей машинное обучение. Чтобы увеличить точность извлечения, добавьте подкомпоненты с помощью дескрипторов и ограничений.
services: cognitive-services
author: diberry
manager: nitinme
ms.custom: seodec18
ms.service: cognitive-services
ms.subservice: language-understanding
ms.topic: tutorial
ms.date: 11/07/2019
ms.author: diberry
ms.openlocfilehash: 36b75f33b4fc9062d09fbc670a509594142f09bd
ms.sourcegitcommit: ac56ef07d86328c40fed5b5792a6a02698926c2d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/08/2019
ms.locfileid: "73828259"
---
# <a name="tutorial-extract-structured-data-with-machine-learned-entities-in-language-understanding-luis"></a>Руководство по Извлечение структурированных данных с помощью сущности, прошедшей машинное обучение, в службе "Распознавание речи" (LUIS)

Из этого руководства вы узнаете, как извлекать структурированные данные из речевого фрагмента с помощью сущности, прошедшей машинное обучение. 

Сущность, прошедшая машинное обучение, поддерживает [концепцию разложения модели на составные части](luis-concept-model.md#v3-authoring-model-decomposition), предоставляя сущности подкомпонентов с дескрипторами и ограничениями. 

[!INCLUDE [Uses preview portal](includes/uses-portal-preview.md)]

**В этом руководстве рассмотрено, как выполнять следующие задачи.**

> [!div class="checklist"]
> * Импортировать пример приложения
> * Добавление сущности, прошедшей машинное обучение. 
> * Добавление подкомпонента.
> * Добавление дескриптора подкомпонента.
> * Добавление ограничения подкомпонента.
> * Обучать приложения
> * Тестирование приложения.
> * Публикация приложения
> * Получение прогноза сущности из конечной точки.

[!INCLUDE [LUIS Free account](includes/quickstart-tutorial-use-free-starter-key.md)]


## <a name="why-use-a-machine-learned-entity"></a>Чем полезна сущность, прошедшая машинное обучение?

В этом руководстве добавляется сущность, прошедшая машинное обучение, для извлечения данных из речевого фрагмента. 

Сущность позволяет определить данные, которые будут извлекаться. Сюда входят такие параметры, как имя данных, тип (если возможно), правила разрешения на случай неоднозначности и точный текст, составляющий данные. 

Чтобы определить сущность, вам нужно создать ее и добавить метку к тексту, который представляет эту сущность в примере речевого фрагмента. Примеры с метками информируют LUIS о том, какая сущность используется и где ее можно найти в речевом фрагменте. 

## <a name="entity-decomposability-is-important"></a>Важность разложимости для сущности

Возможность разложить сущность на части очень важна как для прогнозирования намерений, так и для извлечения данных. 

Начните с сущности, прошедшей машинное обучение, которая станет первой сущностью верхнего уровня для извлечения данных. Затем разложите эту сущность на части, которые потребуются клиентскому приложению. 

В начале работы вы можете еще не знать, насколько подробная детализация сущности вам потребуется. Оптимальным подходом считается создание сущности, прошедшей машинное обучение, которую вы сможете раскладывать на подкомпоненты по мере разработки приложения.

В этом примере вы создадите сущность, прошедшую машинное обучение, которая будет представлять отдельный заказ в приложении для заказа пиццы. Этот заказ должен содержать все элементы, необходимые для его выполнения. В начале работы сущность будет содержать весь текст, относящийся к заказу, и извлекать из него размер и количество. 

Речевой фрагмент для `deliver one large cheese pizza` должен извлекать полный текст этого фрагмента в качестве заказа, а затем извлекать из него `1` и `large`. 

Вы можете дополнительно разложить текст на части, добавив типы начинок и коржей. После ознакомления с этим руководством вы сможете уверенно добавлять эти подкомпоненты к существующей сущности `Order`.

## <a name="import-example-json-to-begin-app"></a>Импорт примера JSON-файла для создания приложения

1.  Скачайте и сохраните [JSON-файл приложения](https://github.com/Azure-Samples/cognitive-services-language-understanding/blob/master/documentation-samples/tutorials/machine-learned-entity/pizza-intents-only.json).

1. На [портале LUIS (предварительная версия)](https://preview.luis.ai) выберите на странице **My apps** (Мои приложения) действие **Import** (Импортировать), а затем — **Import as JSON** (Импортировать в JSON-файл). Найдите JSON-файл, который вы сохранили на предыдущем шаге. Имя приложения можно не менять. Щелкните **Готово**.

1. В разделе **Управление** на вкладке **Версии** выберите нужную версию и щелкните **Клонировать**, затем присвойте копии имя `mach-learn`. Затем щелкните **Готово**, чтобы завершить процесс клонирования. Так как имя версии используется в маршруте URL-адреса, оно не может содержать символы, которые недопустимы в URL-адресе.

    > [!TIP] 
    > Мы рекомендуем всегда клонировать версию перед изменением приложения. Завершив работу с новой версией, экспортируйте ее в файл .json или .lu и зарегистрируйте этот файл в системе управления версиями.

1. Выберите **Сборка** и затем **Намерения**, чтобы просмотреть намерения, которые являются основными составными блоками приложения LUIS.

    ![Перейдите со страницы "Версии" на страницу "Намерения".](media/tutorial-machine-learned-entity/new-version-imported-app.png)

## <a name="label-text-as-entities-in-example-utterances"></a>Маркировка текста как сущностей в примерах речевых фрагментов

Чтобы извлечь сведения о заказе пиццы, создайте прошедшую машинное обучение сущность верхнего уровня `Order`.

1. На странице **Намерения** выберите намерение **OrderPizza**. 

1. В списке примеров речевых фрагментов выберите указанный ниже фрагмент. 

    |Пример речевого фрагмента заказа|
    |--|
    |`pickup a cheddar cheese pizza large with extra anchovies`|

    Выберите часть текста, начиная с левого края текста `pickup` (№ 1) и заканчивая сразу за правым краем `anchovies` (№ 2 — это завершает процесс создания метки). Откроется контекстное меню. В открывшемся поле введите имя сущности `Order` (№ 3). Теперь выберите из списка элемент `Order - Create new entity` (№ 4).

    ![Начало и конец текста метки для полного заказа](media/tutorial-machine-learned-entity/mark-complete-order.png)

    > [!NOTE]
    > Сущность не всегда будет соответствовать полному речевому фрагмент. В этом конкретном случае `pickup` указывает, как должен быть получен заказ, а значит, этот элемент нужно включить в помеченную сущность для этого заказа. 

1. В поле **Choose an entity type** (Выберите тип сущности) выберите **Add Structure** (Добавить структуру), а затем **Далее**. Структура необходима для поддержки подкомпонентов, таких как размер и количество.

    ![Добавление структуры в сущность](media/tutorial-machine-learned-entity/add-structure-to-entity.png)

1. В диалоговом окне **Create a machine learned entity** (Создание прошедшей машинное обучение сущности) внесите в поле **Structure** (Структура) значение `Size` и нажмите клавишу ВВОД. 
1. Чтобы добавить **дескриптор**, выберите значение `+` в области **Descriptors for Size** (Дескрипторы для размера), а затем щелкните **Create new phrase list** (Создать новый список фраз).

1. В поле **Create new phrase list descriptor** (Создать дескриптор списка фраз) введите имя `SizeDescriptor` и следующие значения: `small`, `medium` и `large`. Когда заполнится поле **Suggestions** (Предложения), выберите `extra large` и `xl`. Щелкните **Готово**, чтобы создать новый список фраз. 

    Этот дескриптор списка фраз позволяет подкомпоненту `Size` находить слова, связанные с размером, предоставив ему примеры соответствующих слов. Не обязательно включать в этот список все слова, имеющие отношение к размеру, но важно включить все слова, которые вы ожидаете в речевых фрагментах. 

    ![Создание дескриптора для подкомпонента размера](media/tutorial-machine-learned-entity/size-entity-size-descriptor-phrase-list.png)

1. В окне **Create a machine learned entity** (Создание прошедшей машинное обучение сущности) выберите **Create** (Создать), чтобы завершить создание подкомпонента `Size`.  

    Будет создана сущность `Order` с компонентом `Size`, но к речевому фрагменту пока применена только сущность `Order`. Теперь нужно пометить текст сущности `Size` в примере речевого фрагмента. 

1. В том же примере речевого фрагмента присвойте подкомпоненту размера **Size** метку `large`, выбрав слово, а затем сущность **Size** в раскрывающемся списке. 

    ![Присвойте метку сущности размера в тексте речевого фрагмента.](media/tutorial-machine-learned-entity/mark-and-create-size-entity.png)

    Под текстом появится сплошная линия, так как метка точно соответствует прогнозируемому совпадению, ведь мы только что явным образом указали эту метку для текста.

1. Присвойте метку сущности `Order` в остальных речевых фрагментах, где встречается сущность размера. Квадратные скобки в тексте обозначают помеченную сущность `Order` и сущность `Size` в ней.

    |Примеры речевых фрагментов заказов|
    |--|
    |`can i get [a pepperoni pizza and a can of coke] please`|
    |`can i get [a [small] pizza with onions peppers and olives]`|
    |`[delivery for a [small] pepperoni pizza]`|
    |`i need [2 [large] cheese pizzas 6 [large] pepperoni pizzas and 1 [large] supreme pizza]`|

    ![Создайте сущность и подкомпоненты во всех остальных примерах речевых фрагментов.](media/tutorial-machine-learned-entity/entity-subentity-labeled-not-trained.png)

    > [!CAUTION]
    > Как правильно обрабатывать подразумеваемые данные, например букву `a` для обозначения одной пиццы? Или отсутствие элементов `pickup` и `delivery`, обозначающих, где ожидается получение пиццы? Или отсутствие сведений о размере, позволяющее применить размер по умолчанию, например малый или большой? Постарайтесь возложить обработку подразумеваемых данных на бизнес-правила в клиентском приложении. 

1. Чтобы обучить приложение, щелкните **Обучение**. Обучение применяет к активной модели все изменения, например новые сущности и помеченные речевые фрагменты.

1. После обучения добавьте новый пример речевого фрагмента, чтобы понять, насколько хорошо LUIS понимает прошедшую машинное обучение сущность. 

    |Пример речевого фрагмента заказа|
    |--|
    |`pickup XL meat lovers pizza`|

    Здесь сущность самого верхнего уровня `Order` и подкомпонент `Size` обозначены пунктирными линиями. Это обозначает успешное прогнозирование. 

    ![Новый пример речевого фрагмента, спрогнозированный с помощью сущности](media/tutorial-machine-learned-entity/new-example-utterance-predicted-with-entity.png)

    Пунктирная линия обозначает прогноз. 

1. Чтобы преобразовать прогноз в помеченную сущность, выберите нужную строку и щелкните **Confirm entity predictions** (Подтвердить прогнозирование сущностей).

    ![Подтвердите прогноз, выбрав действие "Confirm entity predictions" (Подтвердить прогнозирование сущностей).](media/tutorial-machine-learned-entity/confirm-entity-prediction-for-new-example-utterance.png)

    На этом этапе прошедшая машинное обучение сущность успешно работает, то есть может находить сущность в новом примере речевого фрагмента. Если при добавлении очередного примера речевого фрагмента сущность не будет правильно спрогнозирована, вручную пометьте сущность и ее подкомпоненты. Если сущность спрогнозирована правильно, не забудьте подтвердить прогнозы. 

## <a name="add-prebuilt-number-to-app-to-help-extract-data"></a>Добавление предварительно заданного числа в приложение для извлечения данных

Сведения о заказе также должны включать информацию о количестве элементов (например, пицц) в этом заказе. Чтобы извлечь эти данные, нужно добавить в `Order` новый подкомпонент, прошедший машинное обучение, и создать для него ограничение в формате предварительно заданного числа. Когда вы ограничите сущность таким числом, она будет обнаруживать и извлекать числа, выраженные одной цифрой (`2`) или текстом (`two`).

Для начала добавьте в приложение предварительно заданное число. 

1. В меню слева выберите **Сущности**, а затем щелкните **+ Add prebuilt entity** (+ Добавить предварительно заданную сущность). 

1. В поле **Add prebuilt entities** (Добавить предварительно заданные сущности) выполните поиск по значению **number** (число), выберите найденный элемент и щелкните **Готово**. 

    ![Добавление предварительно созданной сущности](media/tutorial-machine-learned-entity/add-prebuilt-entity-as-constraint-to-quantity-subcomponent.png)

    Предварительно заданная сущность теперь добавлена в приложение, но пока не является ограничением. 

## <a name="create-subcomponent-entity-with-constraint-to-help-extract-data"></a>Создание сущности подкомпонента с ограничением для извлечения данных

Сущность `Order` должна включать подкомпонент `Quantity`, который будет определять количество элементов в заказе. Количество должно быть ограничено числом, чтобы извлеченные данные сразу были готовы к использованию в клиентском приложении. 

Ограничение применяется как текстовое совпадение с точным соответствием (например, сущность списка) или с помощью регулярных выражений (сущность регулярного выражения или предварительно заданная сущность). 

1. Щелкните **Сущности** и выберите сущность `Order`. 
1. Выберите **+ Add Component** (+ Добавить компонент) и введите имя `Quantity`, а затем нажмите клавишу ВВОД, чтобы добавить новую сущность в приложение.
1. Получив уведомление об успешном выполнении, выберите подкомпонент `Quantity` и щелкните значок ограничения (символ карандаша).
1. В раскрывающемся списке выберите предварительно заданное число. 

    ![Создайте сущность Quantity (количество) с предварительно заданным числом в качестве ограничения.](media/tutorial-machine-learned-entity/create-constraint-from-prebuilt-number.png)

    Это действие создает сущность с ограничением, но она пока не применена к примерам речевых фрагментов.

    > [!NOTE]
    > Подкомпоненты допускают вложенность до 5 уровней. В этой статье такая возможность не демонстрируется, но она доступна на портале и в API-интерфейсе.  

## <a name="label-example-utterance-with-subcomponent-for-quantity-to-teach-luis-about-the-entity"></a>Присвойте примеру речевого фрагмента метку подкомпонента количества, чтобы научить LUIS использовать эту сущность

1. Выберите **Intents** (Намерения) в области навигации слева, затем выберите намерение **OrderPizza**. В следующих речевых фрагментах помечены три числа, которые визуально отображаются под строкой сущности `Order`. Этот более низкий уровень означает, что найденные сущности не рассматриваются отдельно от сущности `Order`.

    ![Предварительно заданное число обнаруживается, но пока не рассматривается отдельно от сущности Order (Заказ).](media/tutorial-machine-learned-entity/prebuilt-number-not-part-of-order-entity.png)

1. Присвойте этим числам метку сущности `Quantity`, выбрав `2` в примере речевого фрагмента и выбрав `Quantity` из списка. Аналогичным образом пометьте `6` и `1` в том же примере речевого фрагмента.

    ![Присвойте тексту метку сущности Quantity.](media/tutorial-machine-learned-entity/mark-example-utterance-with-quantity-entity.png)  

## <a name="train-the-app-to-apply-the-entity-changes-to-the-app"></a>Обучение приложения для внесения изменений сущности в приложение

Щелкните **Обучить**, чтобы обучить приложение новым речевым фрагментам.

![Обучите приложение и снова проверьте примеры речевых фрагментов.](media/tutorial-machine-learned-entity/trained-example-utterances.png)

На этом этапе заказ уже содержит некоторые сведения, доступные для извлечения (размер, количество и весь текст заказа). Есть возможность дополнить сущность `Order` новыми сведениями, такими как начинки для пиццы, тип коржа и дополнительные продукты. Каждый из этих элементов следует создавать как подкомпонент сущности `Order`. 

## <a name="test-the-app-to-validate-the-changes"></a>Тестирование приложения для проверки изменений

Протестируйте приложение с помощью интерактивной панели **Тестирование**. Этот процесс позволяет ввести новый речевой фрагмент и просмотреть результаты прогнозирования, чтобы проверить работу запущенного и обученного приложения. Прогнозирование намерений должно быть достаточно уверенным (достоверность не ниже 70 %) и при извлечении должна выбираться по меньшей мере сущность `Order`. Сведения о сущности Order могут отсутствовать, так как пяти речевых фрагментов недостаточно для обработки всех возможных случаев.

1. Щелкните **Test** (Тестировать) в меню навигации сверху.
1. Введите речевой фрагмент `deliver a medium veggie pizza` и нажмите клавишу ВВОД. Активная модель прогнозирует правильное намерение с достоверностью более 70 %. 

    ![Введите новый речевой фрагмент, чтобы проверить намерение.](media/tutorial-machine-learned-entity/interactive-test-panel-with-first-utterance.png)

1. Щелкните **Проверить**, чтобы увидеть прогнозы сущности.

    ![Просмотрите прогнозы сущности на панели интерактивного тестирования.](media/tutorial-machine-learned-entity/interactive-test-panel-with-first-utterance-and-entity-predictions.png)

    Размер определен правильно. Не забывайте, что в примерах речевых фрагментов для намерения `OrderPizza` отсутствует вариант размера `medium`, но зато есть дескриптор списка фраз `SizeDescriptor`, куда входит средний размер.

    Количество спрогнозировано неправильно. Чтобы устранить эту проблему, можно добавить дополнительные примеры речевых фрагментов, в которых это слово обозначает количество, и присвоить этому слову метку сущности `Quantity`. 

## <a name="publish-the-app-to-access-it-from-the-http-endpoint"></a>Публикация приложения для доступа к нему через конечную точку HTTP

[!INCLUDE [LUIS How to Publish steps](includes/howto-publish.md)]

## <a name="get-intent-and-entity-prediction--from-http-endpoint"></a>Прогнозирование намерений и сущностей через конечную точку HTTP

1. [!INCLUDE [LUIS How to get endpoint first step](includes/howto-get-endpoint.md)]

1. Перейдите в конец URL-адреса в адресной строке и введите тот же запрос, который вы использовали на панели интерактивного тестирования. 

    `deliver a medium veggie pizza`

    Последний параметр строки запроса — `query`. Это **запрос** фразы. 

    ```json
    {
        "query": "deliver a medium veggie pizza",
        "prediction": {
            "topIntent": "OrderPizza",
            "intents": {
                "OrderPizza": {
                    "score": 0.7812769
                },
                "None": {
                    "score": 0.0314020254
                },
                "Confirm": {
                    "score": 0.009299271
                },
                "Greeting": {
                    "score": 0.007551549
                }
            },
            "entities": {
                "Order": [
                    {
                        "Size": [
                            "medium"
                        ],
                        "$instance": {
                            "Size": [
                                {
                                    "type": "Size",
                                    "text": "medium",
                                    "startIndex": 10,
                                    "length": 6,
                                    "score": 0.9955588,
                                    "modelTypeId": 1,
                                    "modelType": "Entity Extractor",
                                    "recognitionSources": [
                                        "model"
                                    ]
                                }
                            ]
                        }
                    }
                ],
                "$instance": {
                    "Order": [
                        {
                            "type": "Order",
                            "text": "a medium veggie pizza",
                            "startIndex": 8,
                            "length": 21,
                            "score": 0.7983857,
                            "modelTypeId": 1,
                            "modelType": "Entity Extractor",
                            "recognitionSources": [
                                "model"
                            ]
                        }
                    ]
                }
            }
        }
    }    
    ```
    

[!INCLUDE [LUIS How to clean up resources](includes/quickstart-tutorial-cleanup-resources.md)]

## <a name="related-information"></a>Связанные сведения

* [Руководство по намерениям](luis-quickstart-intents-only.md)
* [Концепция сущностей](luis-concept-entity-types.md) — основные сведения
* [Концепция функций](luis-concept-feature.md) — основные сведения
* [Обучение активной версии приложения LUIS](luis-how-to-train.md)
* [Как опубликовать предложение](luis-how-to-publish-app.md)
* [Тестирование приложения LUIS на портале LUIS](luis-interactive-test.md)

## <a name="next-steps"></a>Дополнительная информация

В этом руководстве приложение использует сущность, прошедшую машинное обучение, для определения намерений пользователя по речевому фрагменту и извлечения сведений из этого речевого фрагмента. Использование сущности, прошедшей машинное обучение, позволяет разложить сведения сущности на составные части.  

> [!div class="nextstepaction"]
> [Добавление готовой сущности keyPhrase](luis-quickstart-intent-and-key-phrase.md)
