---
title: Руководство. Извлечение структурированных данных с помощью сущности, прошедшей машинное обучение (LUIS)
description: Извлечение структурированных данных из речевого фрагмента с помощью сущности, прошедшей машинное обучение. Для повышения точности извлечения добавьте вложенные сущности с признаками.
ms.topic: tutorial
ms.date: 05/08/2020
ms.openlocfilehash: d1bc8fc6aac52e264cb4352ca05f9df45ccfc50e
ms.sourcegitcommit: bb0afd0df5563cc53f76a642fd8fc709e366568b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2020
ms.locfileid: "83588876"
---
# <a name="tutorial-extract-structured-data-from-user-utterance-with-machine-learned-entities-in-language-understanding-luis"></a>Руководство по извлечению структурированных данных из речевого фрагмента пользователя с помощью сущностей, прошедших машинное обучение, в службе "Распознавание речи" (LUIS)

Из этого руководства вы узнаете, как извлекать структурированные данные из речевого фрагмента с помощью сущности, прошедшей машинное обучение.

Сущность, прошедшая машинное обучение, поддерживает [концепцию разложения модели на составные части](luis-concept-model.md#v3-authoring-model-decomposition), предоставляя вложенные сущности с [признаками](luis-concept-feature.md).

**В этом руководстве рассмотрено, как выполнять следующие задачи.**

> [!div class="checklist"]
> * Импортировать пример приложения
> * Добавление сущности, прошедшей машинное обучение.
> * Добавление вложенной сущности и признака
> * Обучение, тестирование и публикация приложения
> * Получение прогноза сущности из конечной точки.

[!INCLUDE [LUIS Free account](includes/quickstart-tutorial-use-free-starter-key.md)]


## <a name="why-use-a-machine-learned-entity"></a>Чем полезна сущность, прошедшая машинное обучение?

В этом учебнике добавляется прошедшая машинное обучение сущность для извлечения данных из речевого фрагмента пользователя.

Сущность определяет данные, извлекаемые из речевого фрагмента. Сюда входят такие параметры, как имя данных, тип (если возможно), правила разрешения на случай неоднозначности и точный текст, составляющий данные.

Чтобы определить данные, необходимо сделать следующее.
* Создание сущности
* Добавьте метку к тексту в примерах речевых фрагментов, представляющему сущность. Примеры с метками информируют LUIS о том, какая сущность используется и где ее можно найти в речевом фрагменте.

## <a name="entity-decomposability-is-important"></a>Важность разложимости для сущности

Возможность декомпозиции сущности очень важна как для прогнозирования намерений, так и для извлечения данных из сущности.

Начните с сущности, прошедшей машинное обучение, которая станет первой сущностью верхнего уровня для извлечения данных. Затем разбейте сущность на вложенные сущности.

В начале работы вы можете еще не знать, насколько подробная детализация сущности вам потребуется. Оптимальным подходом считается создание сущности, прошедшей машинное обучение, которую вы сможете раскладывать на вложенные сущности по мере разработки приложения.

В этом учебнике рассказывается о том, как создать прошедшую машинное обучение сущность, которая будет представлять собой заказ в приложении для заказа пиццы. Сущность будет извлекать текст, связанный с заказом, а также данные о размере и количестве.

Речевой фрагмент `Please deliver one large cheese pizza to me` должен извлекать `one large cheese pizza` в качестве заказа, а затем — `1` в качестве количества и `large` в качестве размера.

## <a name="download-json-file-for-app"></a>Скачивание JSON-файла для приложения

Скачайте и сохраните [JSON-файл приложения](https://raw.githubusercontent.com/Azure-Samples/cognitive-services-language-understanding/master/documentation-samples/tutorials/machine-learned-entity/pizza-intents-only.json).

## <a name="import-json-file-for-app"></a>Импорт JSON-файла для приложения

[!INCLUDE [Import app steps](includes/import-app-steps.md)]

## <a name="label-text-as-entities-in-example-utterances"></a>Маркировка текста как сущностей в примерах речевых фрагментов

Чтобы извлечь сведения о заказе пиццы, создайте прошедшую машинное обучение сущность верхнего уровня `Order`.

1. На странице **Намерения** выберите намерение **OrderPizza**.

1. В списке примеров речевых фрагментов выберите указанный ниже фрагмент.

    |Пример речевого фрагмента заказа|
    |--|
    |`pickup a cheddar cheese pizza large with extra anchovies`|

    Выберите часть текста, начиная с левого края текста `pickup` (№ 1) и заканчивая сразу за правым краем `anchovies` (№ 2 — это завершает процесс создания метки). Откроется контекстное меню. В открывшемся поле введите имя сущности `Order` (№ 3). Теперь выберите из списка элемент `Order - Create new entity` (№ 4).

    ![Начало и конец текста метки для полного заказа](media/tutorial-machine-learned-entity/mark-complete-order.png)

    > [!NOTE]
    > Сущность не всегда будет соответствовать полному речевому фрагмент. В этом конкретном случае `pickup` указывает, как должен быть получен заказ. С концептуальной точки зрения `pickup` необходимо включить в помеченную сущность для этого заказа.

1. В поле **Choose an entity type** (Выберите тип сущности) выберите **Add Structure** (Добавить структуру), а затем **Далее**. Структура необходима для добавления вложенных сущностей, например размера и количества.

    ![Добавление структуры в сущность](media/tutorial-machine-learned-entity/add-structure-to-entity.png)

1. В диалоговом окне **Create a machine learned entity** (Создание прошедшей машинное обучение сущности) внесите в поле **Structure** (Структура) значение `Size` и нажмите клавишу ВВОД.
1. Чтобы добавить **признак**, выберите значение `+` в области **Features** (Признаки), а затем щелкните **Create new phrase list** (Создать новый список фраз).

1. В поле **Create new phrase list** (Создать новый список фраз) введите имя `SizeFeature` и следующие значения: `small`, `medium` и `large`. Когда заполнится поле **Suggestions** (Предложения), выберите `extra large` и `xl`. Щелкните **Готово**, чтобы создать новый список фраз.

    Эта возможность создания списка фраз позволяет вложенной сущности `Size` находить слова, связанные с размером, предоставляя примеры соответствующих слов. Не обязательно включать в этот список все слова, имеющие отношение к размеру, но важно включить все слова, которые вы ожидаете в речевых фрагментах.

    ![Создание признака для вложенной сущности size](media/tutorial-machine-learned-entity/size-entity-size-descriptor-phrase-list.png)

1. В окне **Create a machine learned entity** (Создание прошедшей машинное обучение сущности) выберите **Create** (Создать), чтобы завершить создание вложенной сущности `Size`.

    Будет создана сущность `Order` с сущностью `Size`, но к речевому фрагменту пока применена только сущность `Order`. Теперь нужно пометить текст сущности `Size` в примере речевого фрагмента.

1. В том же примере речевого фрагмента присвойте вложенной сущности **Size** метку `large`, выбрав слово, а затем сущность **Size** в раскрывающемся списке.

    ![Присвойте метку сущности размера в тексте речевого фрагмента.](media/tutorial-machine-learned-entity/mark-and-create-size-entity.png)

    Под текстом появится сплошная линия, так как метка точно соответствует прогнозируемому совпадению, ведь мы только что _явным образом_ указали эту метку для текста.

1. Присвойте метку сущности `Order` в остальных речевых фрагментах, где встречается сущность размера. Квадратные скобки в тексте обозначают помеченную сущность `Order` и сущность `Size` в ней.

    |Примеры речевых фрагментов заказов|
    |--|
    |`can i get [a pepperoni pizza and a can of coke] please`|
    |`can i get [a [small] pizza with onions peppers and olives]`|
    |`[delivery for a [small] pepperoni pizza]`|
    |`i need [2 [large] cheese pizzas 6 [large] pepperoni pizzas and 1 [large] supreme pizza]`|

    ![Создайте сущность и вложенные сущности во всех остальных примерах речевых фрагментов.](media/tutorial-machine-learned-entity/entity-subentity-labeled-not-trained.png)

    > [!CAUTION]
    > Как правильно обрабатывать подразумеваемые данные, например букву `a` для обозначения одной пиццы? Или отсутствие элементов `pickup` и `delivery`, обозначающих, где ожидается получение пиццы? Или отсутствие сведений о размере, позволяющее применить размер по умолчанию, например малый или большой? Постарайтесь возложить обработку подразумеваемых данных на бизнес-правила в клиентском приложении вместо или в дополнение к LUIS.

1. Чтобы обучить приложение, щелкните **Обучение**. Обучение применяет к активной модели все изменения, например новые сущности и помеченные речевые фрагменты.

1. После обучения добавьте новый пример речевого фрагмента к намерению, чтобы понять, насколько хорошо LUIS понимает прошедшую машинное обучение сущность.

    |Пример речевого фрагмента заказа|
    |--|
    |`pickup XL meat lovers pizza`|

    Здесь сущность самого верхнего уровня `Order` и вложенная строка `Size` обозначены пунктирными линиями.

    ![Новый пример речевого фрагмента, спрогнозированный с помощью сущности](media/tutorial-machine-learned-entity/new-example-utterance-predicted-with-entity.png)

    Пунктирная линия обозначает прогноз.

1. Чтобы преобразовать прогноз в помеченную сущность, выберите нужную строку и щелкните **Confirm entity predictions** (Подтвердить прогнозирование сущностей).

    ![Подтвердите прогноз, выбрав действие "Confirm entity predictions" (Подтвердить прогнозирование сущностей).](media/tutorial-machine-learned-entity/confirm-entity-prediction-for-new-example-utterance.png)

    На этом этапе прошедшая машинное обучение сущность успешно работает, то есть может находить сущность в новом примере речевого фрагмента. Если при добавлении очередного примера речевого фрагмента сущность не будет спрогнозирована правильно, вручную пометьте сущность и вложенные в нее сущности. Если сущность спрогнозирована правильно, не забудьте подтвердить прогнозы.


<a name="create-subcomponent-entity-with-constraint-to-help-extract-data"></a>

## <a name="add-subentity-with-feature-of-prebuilt-entity"></a>Добавление вложенной сущности с признаком предварительно созданной сущности

Сведения о заказе также должны включать информацию о количестве элементов (например, пицц) в этом заказе. Чтобы извлечь эти данные, нужно добавить в `Order` новую вложенную сущность, прошедшую машинное обучение. Этой вложенной сущности требуется обязательный признак предварительно созданной сущности number. При использовании признака предварительно созданной сущности number, сущность будет обнаруживать и извлекать числа, выраженные цифрами (`2`) или текстом (`two`).

## <a name="add-prebuilt-number-entity-to-app"></a>Добавление предварительно созданной сущности номера в приложение
Сведения о заказе также должны включать информацию о количестве элементов (например, пицц) в этом заказе. Чтобы извлечь эти данные, нужно добавить в `Order` новый подкомпонент, прошедший машинное обучение, и создать для него обязательный признак в формате предварительно заданного числа. Когда вы ограничите сущность таким числом, она будет обнаруживать и извлекать числа, выраженные одной цифрой (`2`) или текстом (`two`).

Для начала добавьте в приложение предварительно заданную сущность Number.

1. В меню слева выберите **Сущности**, а затем щелкните **+ Add prebuilt entity** (+ Добавить предварительно заданную сущность).

1. В поле **Add prebuilt entities** (Добавить предварительно заданные сущности) выполните поиск по значению **number** (число), выберите найденный элемент и щелкните **Готово**.

    ![Добавление предварительно созданной сущности](media/tutorial-machine-learned-entity/add-prebuilt-entity-as-constraint-to-quantity-subcomponent.png)

    Предварительно заданная сущность теперь добавлена в приложение, но пока не является признаком.

## <a name="create-subentity-entity-with-required-feature-to-help-extract-data"></a>Создание сущности во вложенной сущности с обязательным признаком для простоты извлечения данных

Сущность `Order` должна включать вложенную сущность `Quantity` для определения количества элементов в заказе. Чтобы извлеченные данные сразу были готовы к использованию в клиентском приложении и отсортированы по имени, для количества должен использоваться обязательный признак предварительно созданной сущности number.

Обязательный признак применяется в качестве текстового совпадения с точным соответствием (например, сущность списка) или с помощью регулярных выражений (сущность регулярного выражения или предварительно заданная сущность).

При использовании в качестве признака сущности, не прошедшей машинное обучение, извлекается только соответствующий текст.

1. Щелкните **Сущности** и выберите сущность `Order`.
1. Выберите **+ Add entity** (+ Добавить сущность) и введите имя `Quantity`, а затем нажмите клавишу ВВОД, чтобы добавить новую вложенную сущность в сущность `Order`.
1. Получив уведомление об успешном выполнении, в разделе **Advanced Options** (Дополнительные параметры) щелкните значок ограничения (символ карандаша).
1. В раскрывающемся списке выберите предварительно заданное число.

    ![Создайте сущность Quantity (количество) с предварительно заданным числом в качестве ограничения.](media/tutorial-machine-learned-entity/create-constraint-from-prebuilt-number.png)

    Сущность `Quantity` применяется, когда текст соответствует предварительно созданной сущности Number.

    При этом создается сущность с обязательным признаком, но она пока не применена к примерам речевых фрагментов.

    > [!NOTE]
    > Вложенная сущность поддерживает до 5 уровней вложения сущностей. В этой статье такая возможность не демонстрируется, но она доступна на портале и в API-интерфейсе.

## <a name="label-example-utterance-to-teach-luis-about-the-entity"></a>Присвоение примеру речевого фрагмента метки для обучения LUIS использованию сущности

1. Выберите **Intents** (Намерения) в области навигации слева, затем выберите намерение **OrderPizza**. В следующих речевых фрагментах помечены три числа, которые визуально отображаются под строкой сущности `Order`. Этот более низкий уровень означает, что найденные сущности не считаются частью сущности `Order`.

    ![Предварительно заданное число обнаруживается, но пока не рассматривается отдельно от сущности Order (Заказ).](media/tutorial-machine-learned-entity/prebuilt-number-not-part-of-order-entity.png)

1. Присвойте этим числам метку сущности `Quantity`, выбрав `2` в примере речевого фрагмента и выбрав `Quantity` из списка. Аналогичным образом пометьте `6` и `1` в том же примере речевого фрагмента.

    ![Присвойте тексту метку сущности Quantity.](media/tutorial-machine-learned-entity/mark-example-utterance-with-quantity-entity.png)

## <a name="train-the-app-to-apply-the-entity-changes-to-the-app"></a>Обучение приложения для внесения изменений сущности в приложение

Щелкните **Обучить**, чтобы обучить приложение новым речевым фрагментам. После обучения вложенная сущность `Quantity` правильно прогнозируется в сущности `Order`. Правильный прогноз обозначается сплошной линией.

![Обучите приложение и снова проверьте примеры речевых фрагментов.](media/tutorial-machine-learned-entity/trained-example-utterances.png)

На этом этапе заказ уже содержит некоторые сведения, доступные для извлечения (размер, количество и весь текст заказа). Есть возможность дополнить сущность `Order` новыми сведениями, такими как начинки для пиццы, тип коржа и дополнительные продукты. Каждый из этих элементов следует создавать как вложенную сущность сущности `Order`.

## <a name="test-the-app-to-validate-the-changes"></a>Тестирование приложения для проверки изменений

Протестируйте приложение с помощью интерактивной панели **Тестирование**. Этот процесс позволяет ввести новый речевой фрагмент и просмотреть результаты прогнозирования, чтобы проверить работу запущенного и обученного приложения. Прогнозирование намерений должно быть достаточно уверенным (достоверность не ниже 70 %) и при извлечении должна выбираться по меньшей мере сущность `Order`. Сведения о сущности Order могут отсутствовать, так как пяти речевых фрагментов недостаточно для обработки всех возможных случаев.

1. Щелкните **Test** (Тестировать) в меню навигации сверху.
1. Введите речевой фрагмент `deliver a medium veggie pizza` и нажмите клавишу ВВОД. Активная модель прогнозирует правильное намерение с достоверностью более 70 %.

    ![Введите новый речевой фрагмент, чтобы проверить намерение.](media/tutorial-machine-learned-entity/interactive-test-panel-with-first-utterance.png)

1. Щелкните **Проверить**, чтобы увидеть прогнозы сущности.

    ![Просмотрите прогнозы сущности на панели интерактивного тестирования.](media/tutorial-machine-learned-entity/interactive-test-panel-with-first-utterance-and-entity-predictions.png)

    Размер определен правильно. Не забывайте, что в примерах речевых фрагментов для намерения `OrderPizza` отсутствует вариант размера `medium`, но зато есть признак списка фраз `SizeFeature`, куда входит средний размер.

    Количество спрогнозировано неправильно. Вы можете исправить это в клиентском приложении, установив размер по умолчанию равным 1, если в прогнозе LUIS не будет возвращено ни одного размера.

## <a name="publish-the-app-to-access-it-from-the-http-endpoint"></a>Публикация приложения для доступа к нему через конечную точку HTTP

[!INCLUDE [LUIS How to Publish steps](includes/howto-publish.md)]

## <a name="get-intent-and-entity-prediction-from-http-endpoint"></a>Прогнозирование намерений и сущностей через конечную точку HTTP

1. [!INCLUDE [LUIS How to get endpoint first step](includes/howto-get-endpoint.md)]

1. В конце URL-адреса в адресной строке вместо _YOUR_QUERY_HERE_ введите тот же запрос, который вы использовали на панели интерактивного тестирования.

    `deliver a medium veggie pizza`

    Последний параметр строки запроса — `query`. Это **запрос** фразы.

    ```json
    {
        "query": "deliver a medium veggie pizza",
        "prediction": {
            "topIntent": "OrderPizza",
            "intents": {
                "OrderPizza": {
                    "score": 0.7812769
                },
                "None": {
                    "score": 0.0314020254
                },
                "Confirm": {
                    "score": 0.009299271
                },
                "Greeting": {
                    "score": 0.007551549
                }
            },
            "entities": {
                "Order": [
                    {
                        "Size": [
                            "medium"
                        ],
                        "$instance": {
                            "Size": [
                                {
                                    "type": "Size",
                                    "text": "medium",
                                    "startIndex": 10,
                                    "length": 6,
                                    "score": 0.9955588,
                                    "modelTypeId": 1,
                                    "modelType": "Entity Extractor",
                                    "recognitionSources": [
                                        "model"
                                    ]
                                }
                            ]
                        }
                    }
                ],
                "$instance": {
                    "Order": [
                        {
                            "type": "Order",
                            "text": "a medium veggie pizza",
                            "startIndex": 8,
                            "length": 21,
                            "score": 0.7983857,
                            "modelTypeId": 1,
                            "modelType": "Entity Extractor",
                            "recognitionSources": [
                                "model"
                            ]
                        }
                    ]
                }
            }
        }
    }
    ```


[!INCLUDE [LUIS How to clean up resources](includes/quickstart-tutorial-cleanup-resources.md)]

## <a name="related-information"></a>Дополнительные сведения

* [Руководство по намерениям](luis-quickstart-intents-only.md)
* [Концепция сущностей](luis-concept-entity-types.md) — основные сведения
* [Концепция функций](luis-concept-feature.md) — основные сведения
* [Обучение активной версии приложения LUIS](luis-how-to-train.md)
* [Как опубликовать предложение](luis-how-to-publish-app.md)
* [Тестирование приложения LUIS на портале LUIS](luis-interactive-test.md)

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве приложение использует сущность, прошедшую машинное обучение, для определения намерений пользователя по речевому фрагменту и извлечения сведений из этого речевого фрагмента. Использование сущности, прошедшей машинное обучение, позволяет разложить сведения сущности на составные части.

> [!div class="nextstepaction"]
> [Добавление готовой сущности keyPhrase](luis-quickstart-intent-and-key-phrase.md)
