---
title: Учебник по извлечению структурированных данных с помощью сущности, прошедшей машинное обучение (LUIS)
description: Извлечение структурированных данных из речевого фрагмента с помощью сущности, прошедшей машинное обучение. Для повышения точности извлечения добавьте вложенные сущности с признаками.
ms.topic: tutorial
ms.date: 05/08/2020
ms.openlocfilehash: f9a732d38d2d4557340080d9d1bbdcf789caea08
ms.sourcegitcommit: 50673ecc5bf8b443491b763b5f287dde046fdd31
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/20/2020
ms.locfileid: "83676172"
---
# <a name="tutorial-extract-structured-data-from-user-utterance-with-machine-learning-entities-in-language-understanding-luis"></a>Руководство по извлечению структурированных данных из речевого фрагмента пользователя с помощью сущностей, прошедших машинное обучение, в службе "Распознавание речи" (LUIS)

Из этого руководства вы узнаете, как извлекать структурированные данные из речевого фрагмента с помощью сущности, прошедшей машинное обучение.

Сущность, прошедшая машинное обучение, поддерживает [концепцию разложения модели на составные части](luis-concept-model.md#v3-authoring-model-decomposition), предоставляя вложенные сущности с [признаками](luis-concept-feature.md).

**В этом руководстве рассмотрено, как выполнять следующие задачи.**

> [!div class="checklist"]
> * Импортировать пример приложения
> * Добавление сущности машинного обучения
> * Добавление вложенной сущности и признака
> * Обучение, тестирование и публикация приложения
> * Получение прогноза сущности из конечной точки.

[!INCLUDE [LUIS Free account](includes/quickstart-tutorial-use-free-starter-key.md)]


## <a name="why-use-a-machine-learning-entity"></a>Чем полезна сущность, прошедшая машинное обучение?

В этом учебнике добавляется прошедшая машинное обучение сущность для извлечения данных из речевого фрагмента пользователя.

Сущность определяет данные, извлекаемые из речевого фрагмента. Сюда входят такие параметры, как имя данных, тип (если возможно), правила разрешения на случай неоднозначности и точный текст, составляющий данные.

Чтобы определить данные, необходимо сделать следующее.
* Создание сущности
* Добавьте метку к тексту в примерах речевых фрагментов, представляющему сущность. Примеры с метками информируют LUIS о том, какая сущность используется и где ее можно найти в речевом фрагменте.

## <a name="entity-decomposability-is-important"></a>Важность разложимости для сущности

Возможность декомпозиции сущности очень важна как для прогнозирования намерений, так и для извлечения данных из сущности.

Начните с прошедшей машинное обучение сущности, которая станет первой сущностью верхнего уровня для извлечения данных. Затем разбейте сущность на вложенные сущности.

В начале работы вы можете еще не знать, насколько подробная детализация сущности вам потребуется. Оптимальным подходом считается создание сущности, прошедшей машинное обучение, которую вы сможете раскладывать на вложенные сущности по мере разработки приложения.

В этом учебнике рассказывается о том, как создать прошедшую машинное обучение сущность, которая будет представлять собой заказ в приложении для заказа пиццы. Сущность будет извлекать текст, связанный с заказом, а также данные о размере и количестве.

Речевой фрагмент `Please deliver one large cheese pizza to me` должен извлекать `one large cheese pizza` в качестве заказа, а затем — `1` в качестве количества и `large` в качестве размера.

## <a name="download-json-file-for-app"></a>Скачивание JSON-файла для приложения

Скачайте и сохраните [JSON-файл приложения](https://raw.githubusercontent.com/Azure-Samples/cognitive-services-language-understanding/master/documentation-samples/tutorials/machine-learned-entity/pizza-intents-only.json).

## <a name="import-json-file-for-app"></a>Импорт JSON-файла для приложения

[!INCLUDE [Import app steps](includes/import-app-steps.md)]

## <a name="create-machine-learned-entity"></a>Создание прошедшей машинное обучение сущности

Чтобы извлечь сведения о заказе пиццы, создайте прошедшую машинное обучение сущность верхнего уровня `Order`.

1. На странице **Намерения** выберите намерение **OrderPizza**.

1. В списке примеров речевых фрагментов выберите указанный ниже фрагмент.

    |Пример речевого фрагмента заказа|
    |--|
    |`pickup a cheddar cheese pizza large with extra anchovies`|

    Выберите часть текста, начиная с левого края текста `pickup` (№ 1) и заканчивая сразу за правым краем `anchovies` (№ 2 — это завершает процесс создания метки). Откроется контекстное меню. В открывшемся поле введите имя сущности `Order` (№ 3). Теперь выберите из списка элемент `Order Create new entity` (№ 4).

    ![Начало и конец текста метки для полного заказа](media/tutorial-machine-learned-entity/mark-complete-order.png)

    > [!NOTE]
    > Сущность не всегда будет соответствовать полному речевому фрагмент. В этом конкретном случае `pickup` указывает, как должен быть получен заказ. С концептуальной точки зрения `pickup` необходимо включить в помеченную сущность для этого заказа.

1. В поле **Choose an entity type** (Выберите тип сущности) выберите **Add Structure** (Добавить структуру), а затем **Далее**. Структура необходима для добавления вложенных сущностей, например размера и количества.

    ![Добавление структуры в сущность](media/tutorial-machine-learned-entity/add-structure-to-entity.png)

1. В поле **Add subentities (optional)** (Добавить вложенные сущности (необязательно)) выберите **+** в строке `Order`, а затем добавьте в качестве вложенных сущностей `Size` и `Quantity` и нажмите кнопку **Create** (Создать).

    > [!div class="mx-imgBorder"]
    > ![Добавление структуры в сущность](media/tutorial-machine-learned-entity/add-subentities-when-creating-machine-learned-entity.png)

## <a name="edit-subentities-to-improve-extraction"></a>Изменение вложенных сущностей для улучшения извлечения

На предыдущих шагах была создана сущность и вложенная сущность. Чтобы улучшить извлечение, добавьте компоненты во вложенные сущности.

### <a name="improve-size-extraction-with-phrase-list"></a>Улучшение извлечения размера с помощью списка фраз

1. В меню слева выберите **Entities** (Сущности), а затем выберите сущность **Order**.

1. На вкладке **Schema and features** (Схема и компоненты) выберите вложенную сущность **Size**, а затем выберите **+ Add feature** (+ Добавить компонент).

1. В раскрывающемся меню выберите **Create new phrase list** (Создать список фраз).

1. В поле **Create new phrase list** (Создать новый список фраз) введите имя `SizePhraselist` и следующие значения: `small`, `medium` и `large`. Когда заполнится поле **Suggestions** (Предложения), выберите `extra large` и `xl`. Нажмите **Save** (Сохранить), чтобы создать новый список фраз.

    Эта возможность создания списка фраз позволяет вложенной сущности `Size` находить слова, связанные с размером, предоставляя примеры соответствующих слов. Не обязательно включать в этот список фраз все слова, имеющие отношение к размеру, но важно включить все слова, которые вы ожидаете в речевых фрагментах.

### <a name="add-sizelist-entity"></a>Добавление сущности SizeList

Добавление списка известных размеров, распознаваемых клиентским приложением, также упрощает процесс извлечения.

1. В меню слева выберите **Entities** (Сущности), а затем выберите **+ Create** (+ Создать).

1. Задайте имя сущности `SizeListentity`, чтобы ее можно было легко распознать при сравнении со списком `SizePhraselist`, создание которого описано в предыдущем разделе.

1. Добавьте размеры, которые ожидает клиентское приложение: `Small`, `Medium`, `Large` и `XLarge`, а затем добавьте для каждого из них синонимы. Синонимы должны быть терминами, которые пользователь вводит в чат-боте. Если сущность точно соответствует нормализованному значению или синонимам, она извлекается с сущностью list.

    |Нормализованное значение|Синонимы|
    |--|--|
    |Малый|малая, маленькая, крошечная, наименьшая, поменьше|
    |Средний|средняя, обычная, стандартная, типична|
    |большой|большая, побольше|
    |Очень большая|XL, огромная, гигантская, большущая|


    > [!div class="mx-imgBorder"]
    > ![Добавление структуры в сущность](media/tutorial-machine-learned-entity/size-list-entity-with-synonyms.png)

### <a name="add-feature-of-sizelist-entity"></a>Добавить компонент сущности SizeList

1. Выберите **Сущности** в меню слева, чтобы вернуться к списку сущностей.

1. Выберите **Order** из списка сущностей.

1. На вкладке **Schema and features** (Схема и компоненты) выберите сущность **Size**, а затем выберите **+ Add feature** (+ Добавить компонент).

1. Выберите **@ SizeList** в раскрывающемся списке.

<a name="add-prebuilt-number-entity-to-app"></a>

### <a name="add-prebuilt-number-entity"></a>Добавление предварительно созданной сущности number

Добавление предварительно созданной сущности number также упрощает процесс извлечения.

1. В меню слева выберите **Entities** (Сущности), а затем щелкните **+ Add prebuilt entity** (+ Добавить предварительно заданную сущность).

1. Выберите **Number** из списка, а затем щелкните **Done** (Готово).

1. Выберите **Сущности** в меню слева, чтобы вернуться к списку сущностей.

### <a name="add-feature-of-prebuilt-number-entity"></a>Добавление компонента предварительно созданной сущности number

1. Выберите **Order** из списка сущностей.

1. На вкладке **Schema and features** (Схема и компоненты) выберите сущность **Quantity**, а затем выберите **+ Добавить компонент**.

1. Выберите **@ number** в раскрывающемся списке.

<a name="create-subcomponent-entity-with-constraint-to-help-extract-data"></a>

## <a name="configure-required-features"></a>Настройка необходимых компонентов

На странице Entity detail (Сведения о сущности) для сущности **Order** выберите звездочку `*` для компонентов **@ SizeList** и **@ number**. Звездочка отображается в той же метке, что и имя компонента.

> [!div class="mx-imgBorder"]
> ![Добавление структуры в сущность](media/tutorial-machine-learned-entity/set-required-feature-on-subentity.png)

<a name="label-text-as-entities-in-example-utterances"></a>
<a name="label-example-utterance-to-teach-luis-about-the-entity"></a>

## <a name="label-example-utterances"></a>Добавление меток к примеру речевого фрагмента

Прошедшая машинное обучение сущность создана, а у вложенных сущностей имеются компоненты. Чтобы завершить улучшение извлечения, необходимо пометить пример речевого фрагмента вложенными сущностями.

1. Выберите **Intents** (Намерения) в области навигации слева, затем выберите намерение **OrderPizza**.

1. Чтобы открыть **палитру сущностей**, на контекстной панели инструментов выберите символ **@** .

1. Выбирая каждую строку сущности в палитре, выберите сущность с помощью курсора палитры в каждом примере речевого фрагмента. По завершении список сущностей должен выглядеть так, как на следующем рисунке.

    > [!div class="mx-imgBorder"]
    > ![Частичный снимок экрана настройки требуемого компонента](media/tutorial-machine-learned-entity/labeled-example-utterances-for-machine-learned-entity.png)

## <a name="train-the-app"></a>Обучение приложения

Чтобы обучить приложение, щелкните **Обучение**. Обучение применяет к активной модели все изменения, например новые сущности и помеченные речевые фрагменты.

## <a name="add-a-new-example-utterance"></a>Добавление нового примера речевого фрагмента

1. После обучения добавьте новый пример речевого фрагмента к намерению `OrderPizza`, чтобы понять, насколько хорошо LUIS понимает прошедшую машинное обучение сущность.

    |Пример речевого фрагмента заказа|
    |--|
    |`I need a large pepperoni pizza`|

    Здесь сущность самого верхнего уровня `Order` и вложенная строка `Size` обозначены пунктирными линиями.

    > [!div class="mx-imgBorder"]
    > ![Частичный снимок экрана с новым примером речевого фрагмента, спрогнозированным с помощью сущности](media/tutorial-machine-learned-entity/new-example-utterance-predicted-with-entity.png)

    Пунктирной линией показан прогноз на основе текущего обученного приложения.

1. Чтобы преобразовать прогноз в сущность с меткой, установите флажок в той же строке.

    > [!div class="mx-imgBorder"]
    > ![Частичный снимок экрана с новым примером речевого фрагмента, спрогнозированным с помощью сущности](media/tutorial-machine-learned-entity/confirm-entity-prediction-for-new-example-utterance-added.png)

    На этом этапе прошедшая машинное обучение сущность успешно работает, то есть может находить сущность в новом примере речевого фрагмента. Если при добавлении очередного примера речевого фрагмента сущность не будет спрогнозирована правильно, вручную пометьте сущность и вложенные в нее сущности. Если сущность спрогнозирована правильно, не забудьте подтвердить прогнозы.


## <a name="train-the-app-to-apply-the-entity-changes-to-the-app"></a>Обучение приложения для внесения изменений сущности в приложение

Щелкните **Train** (Обучить), чтобы обучить приложение новым речевым фрагментам.

На этом этапе заказ уже содержит некоторые сведения, доступные для извлечения (размер, количество и весь текст заказа). Есть возможность дополнить сущность `Order` новыми сведениями, такими как начинки для пиццы, тип коржа и дополнительные продукты. Каждый из этих элементов следует создавать как вложенную сущность сущности `Order`.

## <a name="test-the-app-to-validate-the-changes"></a>Тестирование приложения для проверки изменений

Протестируйте приложение с помощью интерактивной панели **Тестирование**. Этот процесс позволяет ввести новый речевой фрагмент и просмотреть результаты прогнозирования, чтобы проверить работу запущенного и обученного приложения. Прогнозирование намерений должно быть достаточно уверенным (достоверность не ниже 60 %) и при извлечении должна выбираться по меньшей мере сущность `Order`. Сведения о сущности Order могут отсутствовать, так как этих нескольких речевых фрагментов недостаточно для обработки всех возможных случаев.

1. Щелкните **Test** (Тестировать) в меню навигации сверху.
1. Введите речевой фрагмент `2 small cheese pizzas for pickup` и нажмите клавишу ВВОД. Активная модель прогнозирует правильное намерение с достоверностью более 60 %.


1. Щелкните **Проверить**, чтобы увидеть прогнозы сущности.

    > [!div class="mx-imgBorder"]
    > ![Частичный снимок экрана с предоставлением прогнозов сущности на панели интерактивного тестирования](media/tutorial-machine-learned-entity/interactive-test-panel-with-first-utterance-and-entity-predictions.png)

<a name="publish-with-sentiment-analysis"></a>

## <a name="publish-the-app-to-access-it-from-the-http-endpoint"></a>Публикация приложения для доступа к нему через конечную точку HTTP

Чтобы получить результат прогнозирования LUIS в чат-боте или другом приложении, необходимо опубликовать приложение в конечной точке.

1. Выберите **Опубликовать** на правой верхней панели навигации.

    ![Снимок экрана: кнопка публикации в конечной точке в правом верхнем меню на портале LUIS](./media/howto-publish/publish-button.png)

1. Выберите слот **Production** (Рабочий), затем выберите **Change settings** (Изменить параметры), щелкните **Sentiment Analysis** (Анализ тональности), а затем нажмите **Done** (Готово).

    > [!div class="mx-imgBorder"]
    > ![Снимок экрана: публикация в конечной точке с помощью LUIS](./media/tutorial-machine-learned-entity/publish-with-sentiment-analysis.png)

1. Перейдите по ссылке **Получить доступ к URL-адресам конечных точек** в уведомлении, чтобы открыть страницу **Ресурсы Azure**. URL-адреса конечных точек перечислены в **примере запроса**.

## <a name="get-intent-and-entity-prediction-from-http-endpoint"></a>Прогнозирование намерений и сущностей через конечную точку HTTP

1. [!INCLUDE [LUIS How to get endpoint first step](includes/howto-get-endpoint.md)]

1. В конце URL-адреса в адресной строке вместо _YOUR_QUERY_HERE_ введите тот же запрос, который вы использовали на панели интерактивного тестирования.

    `2 small cheese pizzas for pickup`

    Последний параметр строки запроса — `query`. Это **запрос** фразы.

    ```json
    {
        "query": "2 small cheese pizzas for pickup",
        "prediction": {
            "topIntent": "OrderPizza",
            "intents": {
                "OrderPizza": {
                    "score": 0.7812769
                },
                "None": {
                    "score": 0.0314020254
                },
                "Confirm": {
                    "score": 0.009299271
                },
                "Greeting": {
                    "score": 0.007551549
                }
            },
            "entities": {
                "Order": [
                    {
                        "Size": [
                            "small"
                        ],
                        "Quantity": [
                            2
                        ]
                    }
                ]
            }
        },
        "sentimentAnalysis":{
            "label":"neutral",
            "score":0.98
       }
    }
    ```


[!INCLUDE [LUIS How to clean up resources](includes/quickstart-tutorial-cleanup-resources.md)]

## <a name="related-information"></a>Дополнительные сведения

* [Руководство по намерениям](luis-quickstart-intents-only.md)
* [Концепция сущностей](luis-concept-entity-types.md) — основные сведения
* [Концепция функций](luis-concept-feature.md) — основные сведения
* [Обучение активной версии приложения LUIS](luis-how-to-train.md)
* [Как опубликовать предложение](luis-how-to-publish-app.md)
* [Тестирование приложения LUIS на портале LUIS](luis-interactive-test.md)

## <a name="next-steps"></a>Дальнейшие действия

Описанное в этом учебнике приложение использует сущность, прошедшую машинное обучение, для определения намерений пользователя по речевому фрагменту и извлечения сведений из этого речевого фрагмента. Использование прошедшей машинное обучение сущности позволяет разложить сведения сущности на составные части.

> [!div class="nextstepaction"]
> [Добавление готовой сущности keyPhrase](luis-quickstart-intent-and-key-phrase.md)
