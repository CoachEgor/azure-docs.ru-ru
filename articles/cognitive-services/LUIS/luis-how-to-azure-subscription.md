---
title: Как использовать ключи разработки и среды выполнения — LUIS
description: При первом использовании Language Understanding (LUIS) не нужно создавать ключ разработки. Если вы планируете опубликовать приложение, а затем используйте конечную точку среды выполнения, необходимо создать и назначить приложению ключ среды выполнения.
services: cognitive-services
ms.service: cognitive-services
ms.subservice: language-understanding
ms.topic: how-to
ms.date: 09/07/2020
ms.custom: devx-track-azurecli
ms.openlocfilehash: eecc93558625d3ae891ca589424aec218036adae
ms.sourcegitcommit: 8c7f47cc301ca07e7901d95b5fb81f08e6577550
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/27/2020
ms.locfileid: "92744706"
---
# <a name="create-luis-resources"></a>Создание ресурсов LUIS

Создание и запрос ресурсов среды выполнения прогнозирующих запросов обеспечивают проверку подлинности для приложения LUIS и конечной точки прогнозирования.

<a name="azure-resources-for-luis"></a>
<a name="programmatic-key" ></a>
<a name="endpoint-key"></a>
<a name="authoring-key"></a>

## <a name="luis-resources"></a>Ресурсы LUIS

LUIS позволяет выполнять три типа ресурсов Azure и один ресурс, не относящийся к Azure:

|Ресурс|Назначение|Служба для переприятия `kind`|Служба для переприятия `type`|
|--|--|--|--|
|Создание ресурса|Позволяет создавать, выполнять обучение, тестировать и публиковать приложения, а также управлять ими. [Создайте ресурс для создания Luis,](luis-how-to-azure-subscription.md#create-luis-resources-in-azure-portal) если вы планируете создавать приложения Luis програмтикалли или с портала Luis. Сначала необходимо [перенести учетную запись Luis](luis-migration-authoring.md#what-is-migration) , чтобы иметь возможность связать ресурсы разработки Azure с приложением. Вы можете управлять разрешениями на доступ к ресурсу, назначив пользователей [роли участника](#contributions-from-other-authors). <br><br> Существует один уровень, доступный для LUIS ресурсов разработки.<br> * **Бесплатный ресурс для создания F0** , который предоставляет 1 MБ бесплатных транзакций по созданию и 1000 бесплатных запросов на конечную точку прогнозирования. |`LUIS.Authoring`|`Cognitive Services`|
|Прогнозируемый ресурс| После публикации приложения LUIS используйте прогнозирующий ресурс или ключ для запроса конечной точки прогнозирования. Создайте ресурс прогноза LUIS, прежде чем клиентское приложение запросит прогнозы за пределами 1 000 запросов, предоставленных автором или начальным ресурсом. <br><br> Для прогнозирующего ресурса существует два уровня доступные:<br> * **Бесплатный F0ный ресурс** прогнозирования, который 10 000 предоставляет ежемесячные запросы к конечным точкам прогнозирования<br> * **Стандартный прогнозируемый ресурс S0** , который является платным уровнем. [Дополнительные сведения о ценах](https://azure.microsoft.com/pricing/details/cognitive-services/language-understanding-intelligent-services/)|`LUIS`|`Cognitive Services`|
|Начальный или пробный ресурс|Позволяет создавать, выполнять обучение, тестировать и публиковать приложения, а также управлять ими. Это действие создается с помощью деафулт, если при первом входе в систему TP LUIS был выбран параметр начальный ресурс. Однако начальный ключ в конечном итоге будет устаревшим, и все пользователи LUIS должны будут [перенести свои учетные записи](luis-migration-authoring.md#what-is-migration) и связать свои Luis приложения с ресурсом разработки. Этот ресурс не предоставляет разрешения на управление доступом на основе ролей Azure, например на ресурс создания. <br><br> Как и ресурс для разработки, начальный ресурс предоставляет 1 MБ бесплатных транзакций по созданию и 1000 бесплатных запросов на конечную точку прогнозирования.|-|Не является ресурсом Azure|
|[Ключ ресурса с несколькими службами для перекрывающего службы](../cognitive-services-apis-create-account-cli.md?tabs=windows#create-a-cognitive-services-resource)|Запросы конечной точки прогнозирования запросов, используемые совместно с LUIS и другими поддерживаемыми Cognitive Services.|`CognitiveServices`|`Cognitive Services`|


> [!Note]
> Существует два типа ресурсов F0 (Free уровня), предоставляемых LUIS. Один для создания транзакций и один для прогнозирующих транзакций. Если вы исчерпали квоту для прогнозирующих транзакций, убедитесь, что вы фактически используете F0ный ресурс прогнозирования, который предоставляет Вам ежемесячную сумму в 10 000 бесплатных транзакций, а не ресурс для разработки, который предоставляет 1000 прогнозирующих транзакций ежемесячно.

По завершении процесса создания ресурсов Azure [назначьте ресурс](#assign-a-resource-to-an-app) приложению на портале Luis.

Важно создавать приложения LUIS в [регионах](luis-reference-regions.md#publishing-regions) , где вы хотите публиковать и запрашивать.

## <a name="resource-ownership"></a>Владение ресурсом

Ресурс Azure, например LUIS, принадлежит подписке, содержащей ресурс.

Чтобы передавать владение ресурсом, можно выполнить одно из следующих действий.
* Перенос [владения](../../cost-management-billing/manage/billing-subscription-transfer.md) подпиской
* Экспортируйте приложение LUIS в виде файла, а затем импортируйте приложение в другую подписку. Экспорт доступен на странице " **Мои приложения** " на портале Luis.


## <a name="resource-limits"></a>Ограничения ресурсов

### <a name="authoring-key-creation-limits"></a>Ограничения на создание ключа создания ключей

Вы можете создать до 10 ключей создания для каждого региона на подписку.

См. [раздел ограничения ключей](luis-limits.md#key-limits) и [регионы Azure](luis-reference-regions.md).

Регионы публикации отличаются от регионов разработки. Убедитесь, что вы создали приложение в области разработки, соответствующей региону публикации, в котором должно располагаться клиентское приложение.

### <a name="key-usage-limit-errors"></a>Ошибки ограничения использования ключа

Ограничения использования основаны на ценовой категории.

При превышении квоты на количество транзакций в секунду вы получите ошибку HTTP 429. При превышении квоты на количество транзакций в месяц вы получите ошибку HTTP 403.


### <a name="reset-authoring-key"></a>Сброс ключа разработки

Для [создания перенесенных приложений ресурсов](luis-migration-authoring.md) . Если ваш ключ разработки скомпрометирован, сбросьте ключ в портал Azure на странице **ключи** для этого ресурса.

Для приложений, которые еще не перенесены: ключ сброшен для всех приложений на портале LUIS. Если вы разрабатываете приложения с помощью API-интерфейсов создания, необходимо изменить значение OCP-Apim-Subscription-Key на новый ключ.

### <a name="regenerate-azure-key"></a>Повторное создание ключа Azure

Повторно создайте ключи Azure из портал Azure на странице **ключи** .


<a name="securing-the-endpoint"></a>

## <a name="app-ownership-access-and-security"></a>Владение приложениями, доступ и безопасность

Приложение определяется ресурсами Azure, которое определяется подпиской владельца.

Вы можете переместить приложение LUIS. Используйте следующие ресурсы документации в портал Azure или Azure CLI.

* [Перемещение приложения между ресурсами по разработке LUIS](https://westus.dev.cognitive.microsoft.com/docs/services/5890b47c39e2bb17b84a55ff/operations/apps-move-app-to-another-luis-authoring-azure-resource)
* [Перемещение ресурса в новую группу ресурсов или подписку](../../azure-resource-manager/management/move-resource-group-and-subscription.md)
* [Переместить ресурс в пределах одной подписки или в рамках подписок](../../azure-resource-manager/management/move-limitations/app-service-move-limitations.md)


### <a name="contributions-from-other-authors"></a>Вклады других авторов

Для [создания переносимых ресурсов](luis-migration-authoring.md) приложения: _Участники_ управляются в портал Azure для ресурса разработки с помощью страницы **управления доступом (IAM)** . Узнайте, [как добавить пользователя](luis-how-to-collaborate.md), используя адрес электронной почты участника совместной работы и роль _участника_ .

Для приложений, которые еще не перенесены: все _Участники совместной работы_ управляются на ПОРТАЛе Luis на странице **совместной работы "Управление >** ".

### <a name="query-prediction-access-for-private-and-public-apps"></a>Доступ к прогнозирующим запросам для частных и общедоступных приложений

Для **частного** приложения доступ к среде выполнения прогнозирования запросов доступен для владельцев и участников. Для **общедоступного приложения доступ** к среде выполнения предоставляется всем, у кого есть собственный ресурс [службы](../cognitive-services-apis-create-account.md) "Поиск Azure" или "Среда выполнения [Luis](#create-resources-in-the-azure-portal) ", а также идентификатор общедоступного приложения.

В настоящее время каталог общедоступных приложений отсутствует.

### <a name="authoring-permissions-and-access"></a>Создание разрешений и доступ
Доступ к приложению с портала [Luis](luis-reference-regions.md#luis-website) или [API-интерфейсов разработки](https://go.microsoft.com/fwlink/?linkid=2092087) управляется ресурсом разработки Azure.

Владелец и все участники имеют доступ для создания приложения.

|Доступ к разработке включает в себя:|Примечания|
|--|--|
|Добавление или удалений ключей конечных точек||
|Экспорт версии||
|Экспорт журналов конечных точек||
|Импорт версии||
|Предоставление к приложению общего доступа|Если приложение является общедоступным, запросить его может любой пользователь с ключом разработки или ключом конечной точки.|
|Изменение модели|
|Публикация|
|Проверка высказываний конечной точки для [активного обучения](luis-how-to-review-endpoint-utterances.md)|
|Обучение|

<a name="prediction-endpoint-runtime-key"></a>

### <a name="prediction-endpoint-runtime-access"></a>Доступ к среде выполнения для конечной точки прогнозирования

Доступ к запросу конечной точки прогнозирования управляется параметром на странице **сведения о приложении** в разделе **Управление** .

|[Частная конечная точка](#runtime-security-for-private-apps)|[Общедоступная конечная точка](#runtime-security-for-public-apps)|
|:--|:--|
|Доступно для владельца и участников|Доступно для владельца, участников и других пользователей, которым известен идентификатор приложения|

Вы можете контролировать, кто видит ключ среды выполнения LUIS, вызывая его в среде "сервер-сервер". Если вы используете LUIS из бота, соединение между ботом и LUIS уже защищено. При вызове конечной точки LUIS напрямую следует создать серверный API (такой как [функция](https://azure.microsoft.com/services/functions/) Azure) с контролируемым доступом (таким как [AAD](https://azure.microsoft.com/services/active-directory/)). При вызове API на стороне сервера и проверке подлинности и авторизации, передайте вызов в LUIS. Хотя эта стратегия не мешает атакам типа "злоумышленник в середине", она скрывает ключ и URL-адрес конечной точки от пользователей, позволяет контролировать доступ и позволяет добавлять журнал ответов на конечные точки (например, [Application Insights](https://azure.microsoft.com/services/application-insights/)).

### <a name="runtime-security-for-private-apps"></a>Безопасность среды выполнения для частных приложений

Среда выполнения частного приложения доступна только для следующих приложений:

|Ключ и пользователь|Пояснение|
|--|--|
|Ключ разработки владельца| До 1000 обращений к конечной точке|
|Ключи для совместной работы и создания участников| До 1000 обращений к конечной точке|
|Любой ключ, назначенный LUIS автору или участнику совместной работы|В зависимости от уровня использования ключей|

### <a name="runtime-security-for-public-apps"></a>Безопасность среды выполнения для общедоступных приложений

После этого _любой_ допустимый ключ разработки или ключ конечной точки LUIS может выполнять запросы к приложению до тех пор, пока он не израсходует всю квоту конечной точки.

Пользователь, не являющийся владельцем или участником, может получить доступ к среде выполнения общедоступного приложения только при наличии идентификатора приложения. У LUIS нет общедоступного _магазина_ или других вариантов поиска общедоступных приложений.

Общедоступное приложение публикуется во всех регионах, чтобы пользователь с ключом ресурса LUIS для определенного региона смог получить доступ к приложению в том регионе, который связан с ключом ресурса.


### <a name="securing-the-query-prediction-endpoint"></a>Защита конечной точки прогнозирования запросов

Вы можете контролировать, кто может просматривать ключ конечной точки среды выполнения LUIS PREDICTION, вызывая его в среде "сервер-сервер". Если вы используете LUIS из бота, соединение между ботом и LUIS уже защищено. При вызове конечной точки LUIS напрямую следует создать серверный API (такой как [функция](https://azure.microsoft.com/services/functions/) Azure) с контролируемым доступом (таким как [AAD](https://azure.microsoft.com/services/active-directory/)). После вызова серверного API и прохождения авторизации и проверки подлинности нужно передать вызов в LUIS. Хотя эта стратегия не мешает атаке "злоумышленник в середине", она скрывает конечную точку от пользователей, позволяет контролировать доступ и позволяет добавлять журнал ответов на конечные точки (например, [Application Insights](https://azure.microsoft.com/services/application-insights/)).

<a name="starter-key"></a>

## <a name="sign-in-to-luis-portal-and-begin-authoring"></a>Войдите на портал LUIS и начните создание

1. Войдите на [портал Luis](https://www.luis.ai) и примите условия использования.
1. Чтобы начать работу с приложением LUIS, выберите свой ключ разработки Azure LUIS.

   ![Выбор типа ресурса для разработки в службе "Распознавание речи"](./media/luis-how-to-azure-subscription/sign-in-create-resource.png)

1. По завершении процесса выбора ресурсов [Создайте новое приложение](luis-how-to-start-new-app.md#create-new-app-in-luis).


<a name="create-azure-resources"></a>
<a name="create-resources-in-the-azure-portal"></a>

[!INCLUDE [Create LUIS resource in Azure portal](includes/create-luis-resource.md)]

### <a name="create-resources-in-azure-cli"></a>Создание ресурсов в Azure CLI

Используйте [Azure CLI](https://docs.microsoft.com/cli/azure/install-azure-cli?view=azure-cli-latest) , чтобы создать каждый ресурс по отдельности.

Ресурс `kind` :

* Работы `LUIS.Authoring`
* Прогнозирующее `LUIS`

1. Войдите в Azure CLI:

    ```azurecli
    az login
    ```

    Откроется браузер, позволяющий выбрать правильную учетную запись и обеспечить проверку подлинности.

1. Создайте ресурс для создания **Luis** , тип которого `LUIS.Authoring` `my-luis-authoring-resource` в _существующей_ группе ресурсов с именем `my-resource-group` для `westus` региона.

    ```azurecli
    az cognitiveservices account create -n my-luis-authoring-resource -g my-resource-group --kind LUIS.Authoring --sku F0 -l westus --yes
    ```

1. Создайте **ресурс Luis прогнозирующих точек** типа `LUIS` с именем `my-luis-prediction-resource` в _существующей_ группе ресурсов с именем `my-resource-group` для `westus` региона. Если требуется более высокая пропускная способность, чем уровень Free, измените `F0` на `S0` . Дополнительные сведения о [ценовых категориях и пропускной способности](luis-limits.md#key-limits).

    ```azurecli
    az cognitiveservices account create -n my-luis-prediction-resource -g my-resource-group --kind LUIS --sku F0 -l westus --yes
    ```

    > [!Note]
    > Эти ключи не используются порталом LUIS, пока они **не** назначены на ПОРТАЛе Luis в **ресурсах управления > Azure** .

<a name="assign-an-authoring-resource-in-the-luis-portal-for-all-apps"></a>

### <a name="assign-resource-in-the-luis-portal"></a>Назначение ресурса на портале LUIS

Вы можете назначить ресурс для создания отдельного приложения или для всех приложений в LUIS. Следующая процедура назначает всем приложениям один ресурс для создания.

1. Войдите на портал [LUIS](https://www.luis.ai).
1. На верхней панели навигации справа выберите учетную запись пользователя, а затем щелкните **Параметры** .
1. На странице **Параметры пользователя** выберите **Добавить ресурс для разработки** и выберите существующий ресурс разработки. Щелкните **Сохранить** .

## <a name="assign-a-resource-to-an-app"></a>Назначение ресурса для приложения

Обратите внимание, что если у вас нет подписки Azure, вы не сможете назначить или создать новый ресурс. Сначала необходимо пройти и создать [бесплатную пробную версию Azure](https://azure.microsoft.com/en-us/free/) , а затем вернуться к Luis, чтобы создать новый ресурс на портале.

Вы можете назначить или создать ресурс создания или прогнозирования для приложения с помощью следующей процедуры:

1. Войдите на [портал Luis](https://www.luis.ai), а затем выберите приложение из списка " **Мои приложения** ".
1. Перейдите на страницу " **Управление ресурсами Azure" >**

    ![Выберите ресурсы Azure "Управление >" на портале LUIS, чтобы назначить ресурс приложению.](./media/luis-how-to-azure-subscription/manage-azure-resources-prediction.png)

1. Выберите вкладку ресурсов прогноза или разработки, а затем нажмите кнопку **Добавить прогнозирующий ресурс** или **Добавить ресурс для создания ресурса** .
1. Выберите поля в форме, чтобы найти правильный ресурс, а затем нажмите кнопку **сохранить** .
1. Если у вас нет существующего ресурса, можно создать его, выбрав "создать новый ресурс LUIS?". в нижней части окна


### <a name="assign-query-prediction-runtime-resource-without-using-luis-portal"></a>Назначить ресурс среды выполнения прогнозирующих запросов без использования портала LUIS

В целях автоматизации, таких как конвейер CI/CD, может потребоваться автоматизировать назначение ресурса среды выполнения LUIS приложению LUIS. Для этого необходимо выполнить указанные ниже действия.

1. Запросите маркер Azure Resource Manager с этого [веб-сайта](https://resources.azure.com/api/token?plaintext=true). Срок действия этого маркера ограничен, поэтому его следует использовать сразу. По запросу возвращается маркер Azure Resource Manager.

    ![Запрашивание и получение маркера Azure Resource Manager](./media/luis-manage-keys/get-arm-token.png)

1. Используйте маркер, чтобы запросить ресурсы среды выполнения LUIS в подписках из [API-интерфейса получения Luis учетных записей Azure](https://westus.dev.cognitive.microsoft.com/docs/services/5890b47c39e2bb17b84a55ff/operations/5be313cec181ae720aa2b26c), к которому имеет доступ ваша учетная запись пользователя.

    Этот API POST принимает указанные ниже параметры.

    |Заголовок|Значение|
    |--|--|
    |`Authorization`|Значение `Authorization` равно `Bearer {token}`. Обратите внимание, что перед значением маркера должны находиться слово `Bearer` и пробел.|
    |`Ocp-Apim-Subscription-Key`|Ваш ключ разработки.|

    Этот API возвращает массив объектов JSON ваших подписок LUIS, включая идентификатор подписки, группу ресурсов и имя ресурса, возвращаемое в виде имени учетной записи. Найдите в массиве один элемент, соответствующий ресурсу LUIS, который требуется назначить приложению LUIS.

1. Назначьте маркер ресурсу LUIS с помощью функции [назначить Luis учетные записи Azure API приложения](https://westus.dev.cognitive.microsoft.com/docs/services/5890b47c39e2bb17b84a55ff/operations/5be32228e8473de116325515) .

    Этот API POST принимает указанные ниже параметры.

    |Тип|Параметр|Значение|
    |--|--|--|
    |Header|`Authorization`|Значение `Authorization` равно `Bearer {token}`. Обратите внимание, что перед значением маркера должны находиться слово `Bearer` и пробел.|
    |Header|`Ocp-Apim-Subscription-Key`|Ваш ключ разработки.|
    |Header|`Content-type`|`application/json`|
    |Строка запроса|`appid`|Идентификатор приложения LUIS.
    |Текст||{"AzureSubscriptionId":"ddda2925-af7f-4b05-9ba1-2155c5fe8a8e",<br>"ResourceGroup": "resourcegroup-2",<br>"AccountName": "luis-uswest-S0-2"}|

    При успешном выполнении этого API возвращается состояние "201 - created".

## <a name="unassign-resource"></a>Отменить присвоение ресурса

1. Войдите на [портал Luis](https://www.luis.ai), а затем выберите приложение из списка **Мои приложения** .
1. Перейдите на страницу **Управление ресурсами Azure >** .
1. Выберите вкладку ресурс прогноза или разработки, а затем нажмите кнопку **Отменить назначение ресурса** для ресурса.

При удалении ресурса он не удаляется из Azure. Он только потеряет связь из LUIS.


## <a name="delete-account"></a>Удалить учетную запись

Дополнительные сведения о том, какие данные удаляются при удалении учетной записи см. статью [Data storage and removal](luis-concept-data-storage.md#accounts) (Хранение и удаление данных).

## <a name="change-pricing-tier"></a>Смена ценовой категории

1.  В [Azure](https://portal.azure.com) найдите подписку LUIS. Выберите подписку LUIS.
    ![Найдите подписку LUIS](./media/luis-usage-tiers/find.png)
1.  Выберите **Ценовая категория** , чтобы просмотреть доступные ценовые категории.
    ![Просмотрите ценовые категории](./media/luis-usage-tiers/subscription.png)
1.  Выберите ценовую категорию и нажмите кнопку **Выбрать** , чтобы сохранить внесенные изменения.
    ![Измените ценовую категорию LUIS](./media/luis-usage-tiers/plans.png)
1.  После изменения ценовой категории появится всплывающее окно с новой ценовой категорией.
    ![Проверьте ценовую категорию LUIS](./media/luis-usage-tiers/updated.png)
1. Не забудьте [назначить этот ключ конечной точки](#assign-a-resource-to-an-app) на странице **публикации** и использовать его во всех запросах конечной точки.

## <a name="viewing-azure-resource-metrics"></a>Просмотр метрик ресурсов Azure

### <a name="viewing-azure-resource-summary-usage"></a>Просмотр сводных сведений об использовании ресурсов Azure
Вы можете просмотреть сведения об использовании службы LUIS в Azure. На странице **Обзор** отображаются последние сводные сведения, включая вызовы и ошибки. При отправке запроса конечной точки LUIS сведения об использовании на **странице обзора** отображаются в течение пяти минут.

![Просмотр сводки использования](./media/luis-usage-tiers/overview.png)

### <a name="customizing-azure-resource-usage-charts"></a>Настройка диаграмм использования ресурсов Azure
Метрики обеспечивают более подробное представление данных.

![Метрики по умолчанию](./media/luis-usage-tiers/metrics-default.png)

Для диаграмм метрик можно настроить тип метрики и период времени.

![Настраиваемые метрики](./media/luis-usage-tiers/metrics-custom.png)

### <a name="total-transactions-threshold-alert"></a>Оповещение о пороговом значении "Всего транзакций"
Если вы хотите знать, когда будет достигнуто определенное пороговое значение транзакций (например, 10 000), вы можете создать оповещение.

![Оповещения по умолчанию](./media/luis-usage-tiers/alert-default.png)

Добавьте оповещение для метрики **общее число вызовов** за определенный период времени. Добавьте адреса электронной почты всех пользователей, которые должны получать оповещение. Добавьте веб-привязки для всех систем, которые должны получать оповещения. При запуске оповещения также может выполняться приложение логики.

## <a name="next-steps"></a>Дальнейшие действия

* Узнайте [, как использовать версии](luis-how-to-manage-versions.md) для управления жизненным циклом приложения.
* Переход на новый [ресурс создания](luis-migration-authoring.md)
