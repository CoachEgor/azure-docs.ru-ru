---
title: Роли шаблонов — LUIS
titleSuffix: Azure Cognitive Services
description: Шаблоны используются для извлечения данных из хорошо отформатированных шаблонов речевых фрагментов. Высказывание шаблона использует простой объект и роли для извлечения связанных данных, таких как местоположение и место назначения.
ms.custom: seodec18
services: cognitive-services
author: diberry
manager: nitinme
ms.service: cognitive-services
ms.subservice: language-understanding
ms.topic: tutorial
ms.date: 07/16/2019
ms.author: diberry
ms.openlocfilehash: 7586a81eac95a2e4a08b045b3a2826132d9919f7
ms.sourcegitcommit: 7c4de3e22b8e9d71c579f31cbfcea9f22d43721a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/26/2019
ms.locfileid: "68560032"
---
# <a name="tutorial-extract-contextually-related-patterns-using-roles"></a>Руководство по Извлечение контекстуально связанных шаблонов с использованием ролей

В этом руководстве используйте шаблон для извлечения данных из хорошо отформатированного высказывания шаблона. Шаблон речевого фрагмента использует [простую сущность](luis-concept-entity-types.md#simple-entity) и [роли](luis-concept-roles.md) для извлечения связанных данных, таких как исходное и конечное расположения.  При использовании шаблонов для намерения требуется меньшее количество примеров высказываний.


**В этом руководстве рассмотрено, как выполнять следующие задачи.**

> [!div class="checklist"]
> * Импортировать пример приложения
> * Добавление новых сущностей
> * Создание нового намерения
> * Обучение
> * Публикация
> * Получать намерения и сущности из конечной точки.
> * Создавать шаблон с помощью ролей
> * Создавать список городов
> * Получать намерения и сущности из конечной точки.

[!INCLUDE [LUIS Free account](../../../includes/cognitive-services-luis-free-key-short.md)]

## <a name="using-roles-in-patterns"></a>Использовать роли в шаблонах

Назначение ролей — извлечь контекстно-зависимые сущности в речевом фрагменте. В высказывании `Move new employee Robert Williams from Sacramento and San Francisco` значения исходного города и города назначения связаны друг с другом и для указания каждого расположения используется общий язык. 


Имя нового сотрудника, Билли Патерсона, еще не является элементом сущности **Сотрудник**. Сначала извлекается имя нового сотрудника, чтобы отправить во внешнюю систему для создания учетных данных организации. После создания учетных данных организации учетные данные сотрудника добавляются в объект сущности **Сотрудник**.

Новый сотрудник с семьей должны быть перемещены из текущего города в город, где находится вымышленная компания. Новый сотрудник может прибыть из любого города, поэтому нужно учитывать расположение. Список набора, такой как сущность списка, не будет работать, так как будет извлекаться только название города.

Имена ролей, связанных с исходным городом и городом назначения, должны быть уникальными для всех сущностей. Чтобы убедиться, что роли являются уникальными, необходимо привязать их к содержащей сущности через стратегию именования. Сущность **NewEmployeeRelocation** является простой сущностью с двумя ролями — **NewEmployeeReloOrigin** и **NewEmployeeReloDestination**. "Relo" — сокращение от слова "relocation" (перемещение).

Поскольку пример выражения `Move new employee Robert Williams from Sacramento and San Francisco` имеет только машинно-обученные сущности, важно для намерения предоставить достаточное количество примерных высказываний, чтобы сущности были обнаружены.  

**Хотя шаблоны и помогают указать меньше примеров фраз, но если сущности не обнаруживаются, шаблоны не совпадают.**

Если возникают трудности с определением простой сущности, например названием города, рассмотрите возможность добавления списка высказываний с похожим значением. Это помогает определить название города, предоставляя API распознавания речи дополнительные данные об этом типе слова или фразы. Списки фраз только помогают шаблону. Они обнаруживают сущности, которые необходимы шаблону для сравнения. 

## <a name="import-example-app"></a>Импортировать пример приложения
Продолжите работу с приложением **HumanResources**, созданным в рамках последнего руководства. 

Выполните следующие действия.

1.  Загрузите и сохраните [JSON-файл приложения](https://github.com/Azure-Samples/cognitive-services-language-understanding/blob/master/documentation-samples/tutorials/custom-domain-patterns-HumanResources-v2.json).

2. Импортируйте JSON-файл в новое приложение.

3. Из раздела **Управление** на вкладке **Версии** скопируйте версию и назовите ее `roles`. Клонирование — это отличный способ поэкспериментировать с различными функциями LUIS без влияния на исходную версию. Так как имя версии используется в маршруте URL-адреса, оно не может содержать символы, которые недопустимы в URL-адресе.

## <a name="create-new-entities"></a>Добавление новых сущностей

1. [!INCLUDE [Start in Build section](../../../includes/cognitive-services-luis-tutorial-build-section.md)]

2. Выберите **Сущности** в меню навигации слева. 

3. Нажмите кнопку **Создать сущность**.

4. Во всплывающем окне введите `NewEmployee`**Простая** сущность.

5. Нажмите кнопку **Создать сущность**.

6. Во всплывающем окне введите `NewEmployeeRelocation`**Простая** сущность.

7. Выберите **NewEmployeeRelocation** из списка сущностей. 

8. Введите название первой роли как `NewEmployeeReloOrigin` и нажмите клавишу "ВВОД".

9. Введите название первой роли `NewEmployeeReloDestination` и нажмите клавишу "ВВОД".

## <a name="create-new-intent"></a>Создание нового намерения
Маркировка объектов на этих шагах может быть проще, если предварительно созданная сущность keyPhrase удаляется перед началом, а затем добавляется обратно после того, как закончится работа с шагами в этом разделе. 

1. В левой области навигации выберите **Intents** (Намерения).

2. Выберите **Create new intent**. (Создать намерение). 

3. Введите `NewEmployeeRelocationProcess` как название намерения во всплывающем диалоговом окне.

4. Введите следующие примеры высказываний, помечая новые сущности. Значения сущности и роли выделены жирным шрифтом. Не забудьте переключиться в режим **Просмотра маркеров безопасности**, чтобы было проще пометить текст. 

    Роль сущности не указывается при добавлении меток в намерение. Это можно сделать позже при создании шаблона. 

    |Фраза|NewEmployee|NewEmployeeRelocation|
    |--|--|--|
    |Переместить **Боба Джонса** из **Сиэтла** в **Лас Колинас**|Боб Джонс|Сиэтл, Лас Колинас|
    |Переместить **Дейва Купера** из **Редмонда** в **Нью-Йорк**|Дейв Купер|Редмонд, Нью-Йорк|
    |Переместить **Джима Смита** из **Торонто** в **Западный Ванкувер**|Джим Смит|Торонто, Западный Ванкувер|
    |Переместить **Дж. Бенсона** из **Бостона** в **Стейнз-на-Темзе**|Дж. Бенсон|Бостон, Стейнс|
    |Переместить **Тревиса** из **Кастело Бранко** в **Орландо**|Тревис|Кастело Бранко, Орландо|
    |Переместить **Тревор Ноттингтон III** из **Аранда де Дуеро** в **Буаз**|Тревор Ноттингтон III|Аранда де Дуеро, Буаз|
    |Переместить **доктора Грега Вильямса** из **Орландо** в  **Элликотт**|Dr. Грег Вильямс|Орландо, Элликотт-Сити|
    |Переместить **Роберта "Бобби" Грэгсон** из **Канзаса** **в Сан-Хуан Капистрано**|Роберт "Бобби" Грэгсон|Канзас, Сан-Хуан Капистрано|
    |Переместить **Марту Артемьеву** из **Бельвью** в **Рокфорд**|Марта Артемьева|Бельвью, Рокфорд|
    |Переместить **Джанет Бартлет** из **Тосканы** в **Санта-Фе**|Джанет Бартлет|Тоскана, Санта-Фе|

    Имя сотрудника сочетает в себе широкий набор префиксов, разное количество слов, синтаксиса и суффиксов. Для LUIS важно понимать варианты имен нового сотрудника. Названия городов также имеют разное количество слов и различный синтаксис. Такое разнообразие важно для обучения LUIS тому, как эти сущности могут выглядеть в речи пользователя. 
    
    Если бы каждый объект имел одно и то же количество слов без вариантов, можно обучить LUIS, что у этой сущности есть только это количество слов и никаких других вариантов. LUIS не сможет правильно предугадать более широкий набор вариантов, так как она не видела ни одного. 

    Если сущность keyPhrase была удалена, верните ее в приложение.

## <a name="train"></a>Обучение

[!INCLUDE [LUIS How to Train steps](../../../includes/cognitive-services-luis-tutorial-how-to-train.md)]

## <a name="publish"></a>Публикация

[!INCLUDE [LUIS How to Publish steps](../../../includes/cognitive-services-luis-tutorial-how-to-publish.md)]

## <a name="get-intent-and-entities-from-endpoint"></a>Получение намерения и сущностей из конечной точки

1. [!INCLUDE [LUIS How to get endpoint first step](../../../includes/cognitive-services-luis-tutorial-how-to-get-endpoint.md)] 

2. Перейдите в конец URL-адреса и введите `Move Wayne Berry from Miami to Mount Vernon`. Последний параметр строки запроса — `q`. Это **запрос** фразы. 

    ```json
    {
      "query": "Move Wayne Berry from Newark to Columbus",
      "topScoringIntent": {
        "intent": "NewEmployeeRelocationProcess",
        "score": 0.514479756
      },
      "intents": [
        {
          "intent": "NewEmployeeRelocationProcess",
          "score": 0.514479756
        },
        {
          "intent": "Utilities.Confirm",
          "score": 0.017118983
        },
        {
          "intent": "MoveEmployee",
          "score": 0.009982505
        },
        {
          "intent": "GetJobInformation",
          "score": 0.008637771
        },
        {
          "intent": "ApplyForJob",
          "score": 0.007115978
        },
        {
          "intent": "Utilities.StartOver",
          "score": 0.006120186
        },
        {
          "intent": "Utilities.Cancel",
          "score": 0.00452428637
        },
        {
          "intent": "None",
          "score": 0.00400899537
        },
        {
          "intent": "OrgChart-Reports",
          "score": 0.00240071164
        },
        {
          "intent": "Utilities.Help",
          "score": 0.001770991
        },
        {
          "intent": "EmployeeFeedback",
          "score": 0.001697356
        },
        {
          "intent": "OrgChart-Manager",
          "score": 0.00168116146
        },
        {
          "intent": "Utilities.Stop",
          "score": 0.00163952739
        },
        {
          "intent": "FindForm",
          "score": 0.00112958835
        }
      ],
      "entities": [
        {
          "entity": "wayne berry",
          "type": "NewEmployee",
          "startIndex": 5,
          "endIndex": 15,
          "score": 0.629158735
        },
        {
          "entity": "newark",
          "type": "NewEmployeeRelocation",
          "startIndex": 22,
          "endIndex": 27,
          "score": 0.638941
        }
      ]
    }  
    ```

Оценка прогноза намерений составляет только около 50 %. Если приложению требуется более высокое число, это необходимо исправить. Сущности не были прогнозируемыми.

Только одно из двух расположений было извлечено. 

Шаблоны помогут совершить оценку прогнозирования, тем не менее они должны быть правильно прогнозированными прежде, чем высказывание будет соответствовать шаблону. 

## <a name="pattern-with-roles"></a>Создание шаблона с помощью ролей

1. Выберите функцию **Сборка** в верхней панели навигации.

2. Выберите **Шаблоны** в меню навигации слева.

3. Выберите **NewEmployeeRelocationProcess** из раскрывающегося списка **Select an intent** (Выбрать намерение). 

4. Введите следующий шаблон: `move {NewEmployee} from {NewEmployeeRelocation:NewEmployeeReloOrigin} to {NewEmployeeRelocation:NewEmployeeReloDestination}[.]`

    Если вы тренируете, публикуете и делаете запрос на конечную точку, то будете разочарованы, если не увидите сущности, потому что прогнозирование не улучшилось и шаблон не совпал. Это является следствием того, что не хватает примеров высказываний с помеченными сущностями. Вместо добавления примеров добавьте список высказываний, чтобы устранить эту проблему.

## <a name="cities-phrase-list"></a>Список городов
Название городов, так же как имена людей, являются непростой задачей, потому что они могут состоять из любых сочетаний слов и знаков препинания. Названия городов в регионах и мире известны, поэтому, чтобы начать обучение, служба LUIS должна получить их список. 

1. Выберите **Список фраз** из раздела **Improve app performance** (Повысить производительность приложения) из меню слева. 

2. Назовите список `Cities` и добавьте в него следующие `values`.

    |Значения из списка фраз|
    |--|
    |Сиэтл;|
    |San Diego|
    |Нью-Йорк|
    |Лос-Анджелес|
    |Портленд|
    |Филадельфия|
    |Майами|
    |Даллас|

    Не добавляйте каждый город в мире или даже каждый город в регионе. LUIS должен уметь распознавать, что город из этого списка. Не забудьте сохранить выбранные **These values are interchangeable** (Взаимозаменяемые значения). Этот параметр означает, что слова из списка рассматриваются как синонимы. 

3. Обучите и опубликуйте приложение.

## <a name="get-intent-and-entities-from-endpoint"></a>Получение намерения и сущностей из конечной точки

1. [!INCLUDE [Start in Build section](../../../includes/cognitive-services-luis-tutorial-build-section.md)]

2. Перейдите в конец URL-адреса и введите `Move wayne berry from miami to mount vernon`. Последний параметр строки запроса — `q`. Это **запрос** фразы. 

    ```json
    {
      "query": "Move Wayne Berry from Miami to Mount Vernon",
      "topScoringIntent": {
        "intent": "NewEmployeeRelocationProcess",
        "score": 0.9999999
      },
      "intents": [
        {
          "intent": "NewEmployeeRelocationProcess",
          "score": 0.9999999
        },
        {
          "intent": "Utilities.Confirm",
          "score": 1.49678385E-06
        },
        {
          "intent": "MoveEmployee",
          "score": 8.240291E-07
        },
        {
          "intent": "GetJobInformation",
          "score": 6.3131273E-07
        },
        {
          "intent": "None",
          "score": 4.25E-09
        },
        {
          "intent": "OrgChart-Manager",
          "score": 2.8E-09
        },
        {
          "intent": "OrgChart-Reports",
          "score": 2.8E-09
        },
        {
          "intent": "EmployeeFeedback",
          "score": 1.64E-09
        },
        {
          "intent": "Utilities.StartOver",
          "score": 1.64E-09
        },
        {
          "intent": "Utilities.Help",
          "score": 1.48181822E-09
        },
        {
          "intent": "Utilities.Stop",
          "score": 1.48181822E-09
        },
        {
          "intent": "Utilities.Cancel",
          "score": 1.35E-09
        },
        {
          "intent": "FindForm",
          "score": 1.23846156E-09
        },
        {
          "intent": "ApplyForJob",
          "score": 5.692308E-10
        }
      ],
      "entities": [
        {
          "entity": "wayne berry",
          "type": "builtin.keyPhrase",
          "startIndex": 5,
          "endIndex": 15
        },
        {
          "entity": "miami",
          "type": "builtin.keyPhrase",
          "startIndex": 22,
          "endIndex": 26
        },
        {
          "entity": "wayne berry",
          "type": "NewEmployee",
          "startIndex": 5,
          "endIndex": 15,
          "score": 0.9410646,
          "role": ""
        },
        {
          "entity": "miami",
          "type": "NewEmployeeRelocation",
          "startIndex": 22,
          "endIndex": 26,
          "score": 0.9853915,
          "role": "NewEmployeeReloOrigin"
        },
        {
          "entity": "mount vernon",
          "type": "NewEmployeeRelocation",
          "startIndex": 31,
          "endIndex": 42,
          "score": 0.986044347,
          "role": "NewEmployeeReloDestination"
        }
      ],
      "sentimentAnalysis": {
        "label": "neutral",
        "score": 0.5
      }
   }
    ```

Оценка намерения теперь гораздо выше, и имена ролей являются частью ответа сущности.

## <a name="clean-up-resources"></a>Очистка ресурсов

[!INCLUDE [LUIS How to clean up resources](../../../includes/cognitive-services-luis-tutorial-how-to-clean-up-resources.md)]

## <a name="next-steps"></a>Дополнительная информация

Это руководство добавило сущность к ролям, а намерение — к примерам высказываний. Первое прогнозирование конечной точки с помощью сущности правильно спрогнозировало намерение, однако с низким показателем достоверности. Обнаружено только одну из двух сущностей. Затем руководство добавило шаблон, который использовал роли сущности и список фраз, чтобы повысить значение названий городов в высказываниях. Второе прогнозирование конечной точки возвратило оценку с высоким показателем достоверности и определило обе роли сущности. 

> [!div class="nextstepaction"]
> [Рекомендации](luis-concept-best-practices.md) по приложениям LUIS
