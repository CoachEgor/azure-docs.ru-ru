---
title: Справочник по API перевода текстов версии 3.0
titleSuffix: Azure Cognitive Services
description: Справочная документация для API перевода текстов версии 3.0. API перевода текстов версии 3 предоставляет современный веб-API на основе JSON.
services: cognitive-services
author: swmachan
manager: nitinme
ms.service: cognitive-services
ms.subservice: translator-text
ms.topic: reference
ms.date: 4/2/2020
ms.author: swmachan
ms.openlocfilehash: fcbaabac0961f1269a929fb4a56f81ac282bae29
ms.sourcegitcommit: bc738d2986f9d9601921baf9dded778853489b16
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/02/2020
ms.locfileid: "80619150"
---
# <a name="translator-text-api-v30"></a>API перевода текстов v3.0

## <a name="whats-new"></a>Новые возможности

API перевода текстов версии 3 предоставляет современный веб-API на основе JSON. Это улучшает удобство и производительность благодаря объединению существующих функций с меньшим количеством операций и предоставляет новые возможности.

 * Транслитерация для преобразования текста на одном языке из одного сценария в другой.
 * Преобразование на несколько языков в одном запросе.
 * Определение языка, перевод и транслитерация в одном запросе.
 * Словарь для поиска альтернативных переводов термина, чтобы найти обратные переводы и примеры, показывающие термины, используемые в контексте.
 * Более информативные результаты определения языка.

## <a name="base-urls"></a>Базовые URL-адреса

Microsoft Translator обслуживается несколькими центрами обработки данных. В настоящее время они расположены в 10 [регионах Лазурного региона:](https://azure.microsoft.com/global-infrastructure/regions)

* **Америка:** Восточная часть США, южная часть центрального США, Западная Центральная часть США и Запад США 2 
* **Азиатско-Тихоокеанский регион:** Корея южная, Япония Восток, юго-восточная Азия, и Австралия Восток
* **Европа:** Северная Европа и Западная Европа

Запросы к Microsoft API перевода текстов в большинстве случаев обрабатываются ближайшим к месту отправки запроса центром обработки данных. В случае сбоя центра обработки данных запрос может быть направлен за пределы географии Azure.

Чтобы заставить запрос обрабатываться определенной географией Azure, измените глобальную конечную точку в запросе API на нужную региональную конечную точку:

|Описание|Лазурная география|Базовый URL-адрес|
|:--|:--|:--|
|Azure|Глобальный (нерегиональный)|   api.cognitive.microsofttranslator.com|
|Azure|США|   api-nam.cognitive.microsofttranslator.com|
|Azure|Европа|  api-eur.cognitive.microsofttranslator.com|
|Azure|Азиатско-Тихоокеанский регион|    api-apc.cognitive.microsofttranslator.com|

## <a name="authentication"></a>Аутентификация

Подпишитесь на API-доступ текста переводчика или [многофункциональный сервис Cognitive Services](https://azure.microsoft.com/pricing/details/cognitive-services/) в Azure Cognitive Services и используйте ключ подписки (доступный на портале Azure) для проверки подлинности. 

Существуют три заголовка, которые можно использовать для проверки подлинности подписки. В этой таблице описывается, как используется каждая из них:

|Заголовки|Описание|
|:----|:----|
|Ocp-Apim-Subscription-Key|*Используйте подписку Cognitive Services, если вы передаете секретный ключ*.<br/>Значение — это секретный ключ Azure для вашей подписки на API перевода текстов.|
|Авторизация|*Используйте подписку Cognitive Services, если вы передаете токен аутентификации.*<br/>Значением является токен носителя: `Bearer <token>`.|
|Ocp-Apim-Subscription-Region|*Использование с multi-service-сервисными и региональными ресурсами когнитивных служб.*<br/>Значение представляет собой регион ресурса мультисервисных или региональных переводчиков. Это значение не является обязательным при использовании глобального ресурса переводчика.|

###  <a name="secret-key"></a>Секретный ключ
Первый вариант — выполнить проверку подлинности с помощью заголовка `Ocp-Apim-Subscription-Key`. Добавьте `Ocp-Apim-Subscription-Key: <YOUR_SECRET_KEY>` заголовок в свой запрос.

#### <a name="authenticating-with-a-global-resource"></a>Проверка подлинности с помощью глобального ресурса

При использовании [глобального ресурса переводчика](https://ms.portal.azure.com/#create/Microsoft.CognitiveServicesTextTranslation)необходимо включить один заголовок для вызова API переводчика.

|Заголовки|Описание|
|:-----|:----|
|Ocp-Apim-Subscription-Key| Значение — это секретный ключ Azure для вашей подписки на API перевода текстов.|

Вот пример запроса на вызов API переводчика с помощью глобального ресурса переводчика

```curl
// Pass secret key using headers
curl -X POST "https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&to=es" \
     -H "Ocp-Apim-Subscription-Key:<your-key>" \
     -H "Content-Type: application/json" \
     -d "[{'Text':'Hello, what is your name?'}]"
```

#### <a name="authenticating-with-a-regional-resource"></a>Проверка подлинности с помощью регионального ресурса

При использовании [регионального ресурса переводчика](https://ms.portal.azure.com/#create/Microsoft.CognitiveServicesTextTranslation).
Есть 2 заголовка, которые необходимо позвонить aPI переводчика.

|Заголовки|Описание|
|:-----|:----|
|Ocp-Apim-Subscription-Key| Значение — это секретный ключ Azure для вашей подписки на API перевода текстов.|
|Ocp-Apim-Subscription-Region| Значение — это область ресурса переводчика. |

Вот пример запроса на вызов API переводчика с помощью регионального ресурса переводчика

```curl
// Pass secret key and region using headers
curl -X POST "https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&to=es" \
     -H "Ocp-Apim-Subscription-Key:<your-key>" \
     -H "Ocp-Apim-Subscription-Region:<your-region>" \
     -H "Content-Type: application/json" \
     -d "[{'Text':'Hello, what is your name?'}]"
```

#### <a name="authenticating-with-a-multi-service-resource"></a>Проверка подлинности с помощью ресурса мультислужбы

При использовании мультисервисного ресурса Когнитивной службы. В этом случае вы сможете использовать единый секретный ключ для проверки подлинности запросов нескольких служб. 

При использовании секретного ключа нескольких служб необходимо включить в запрос два заголовка аутентификации. Есть 2 заголовка, которые необходимо позвонить aPI переводчика.

|Заголовки|Описание|
|:-----|:----|
|Ocp-Apim-Subscription-Key| Значение — секретный ключ Azure для ресурса мультислужбы.|
|Ocp-Apim-Subscription-Region| Значение является областью ресурса мультисервисов. |

Регион необходим для многофункциональной подписки Text API. Выбранный вами регион является единственным регионом, который можно использовать для текстового перевода при использовании ключа подписки с несколькими услугами, и должен быть тем же регионом, который вы выбрали при подписке на несколько сервисов через портал Azure.

Доступные `australiaeast` `brazilsouth`регионы, `centralindia` `centralus`, `centraluseuap` `eastasia` `eastus` `eastus2` `francecentral` `japaneast` `japanwest` `koreacentral` `northcentralus` `northeurope` `southcentralus` `southeastasia` `uksouth` `westcentralus` `westeurope` `westus`, `westus2`, , , , , , , , `southafricanorth`, , , , , , и . `canadacentral`

Если секретный ключ передается в строке запроса с параметром `Subscription-Key`, необходимо указать регион с параметром запроса `Subscription-Region`.

### <a name="authenticating-with-an-access-token"></a>Проверка подлинности с помощью токена доступа
Альтернативным вариантом является изменение секретного ключа для маркера доступа. Этот маркер входит в состав каждого запроса как заголовок `Authorization`. Чтобы получить токен авторизации, сделайте запрос `POST` по следующему URL-адресу.

| Тип ресурса     | Служба проверки подлинности URL-адреса                                |
|-----------------|-----------------------------------------------------------|
| Global          | `https://api.cognitive.microsoft.com/sts/v1.0/issueToken` |
| Региональный или мульти-сервис | `https://<your-region>.api.cognitive.microsoft.com/sts/v1.0/issueToken` |

Вот пример запросов для получения токена с секретным ключом.

```curl
// Pass secret key using header
curl --header 'Ocp-Apim-Subscription-Key: <your-key>' --data "" 'https://api.cognitive.microsoft.com/sts/v1.0/issueToken'

// Pass secret key using query string parameter
curl --data "" 'https://api.cognitive.microsoft.com/sts/v1.0/issueToken?Subscription-Key=<your-key>'
```

Успешный запрос возвращает закодированный токен доступа в виде обычного текста в тексте ответа. Допустимый токен передается в службу переводчика как маркер носителя авторизации.

```http
Authorization: Bearer <Base64-access_token>
```

Токен аутентификации допустимый в течение 10 минут. Токен следует использовать повторно при нескольких вызовах в AIS Translator. Однако, если ваша программа делает запросы в Translator API в течение длительного периода времени, то ваша программа должна запрашивать новый токен доступа через регулярные промежутки времени (например, каждые 8 минут).

## <a name="virtual-network-support"></a>Поддержка виртуальной сети

Служба переводчиков теперь доступна с возможностями Виртуальной `Central US EUAP` `global`сети в ограниченных регионах (,`WestUS2` `EastUS`, `SouthCentralUS`, `WestUS`, . Для включения виртуальной сети, пожалуйста, смотрите [Настройка Azure когнитивных услуг виртуальных сетей](https://docs.microsoft.com/azure/cognitive-services/cognitive-services-virtual-networks?tabs=portal). 

Как только вы включите эту возможность, необходимо использовать пользовательскую конечную точку для вызова API переводчика. Вы не можете использовать глобальную конечную точку переводчика ("api.cognitive.microsofttranslator.com"), и вы не можете проверить подлинность с помощью токена доступа.

Вы можете найти пользовательскую конечную точку, как только вы создаете [ресурс переводчика.](https://ms.portal.azure.com/#create/Microsoft.CognitiveServicesTextTranslation)

|Заголовки|Описание|
|:-----|:----|
|Ocp-Apim-Subscription-Key| Значение — это секретный ключ Azure для вашей подписки на API перевода текстов.|
|Ocp-Apim-Subscription-Region| Значение — это область ресурса переводчика. Это значение не является обязательным, если ресурс`global`|

Вот пример запроса на вызов API переводчика с помощью пользовательской конечный точки

```curl
// Pass secret key and region using headers
curl -X POST "https://<your-custom-domain>.cognitiveservices.azure.com/translator/text/v3.0/translate?api-version=3.0&to=es" \
     -H "Ocp-Apim-Subscription-Key:<your-key>" \
     -H "Ocp-Apim-Subscription-Region:<your-region>" \
     -H "Content-Type: application/json" \
     -d "[{'Text':'Hello, what is your name?'}]"
```

## <a name="errors"></a>ошибки

Стандартный ответ об ошибке — это объект JSON с парой имя и значение, названный `error`. Значение также является объектом JSON со следующими свойствами.

  * `code`. Код ошибки, определенный сервером.
  * `message`. Строка, дающая представление об ошибке в понятном для человека формате.

Например, клиент с бесплатной пробной подпиской получит следующую ошибку после исчерпания бесплатной квоты.

```json
{
  "error": {
    "code":403001,
    "message":"The operation is not allowed because the subscription has exceeded its free quota."
    }
}
```
Код ошибки представляет собой число из 6 знаков, первые 3 из которых являются кодом состояния HTTP, а оставшиеся 3 цифры определяют категорию ошибки. Коды распространенных ошибок:

| Код | Описание |
|:----|:-----|
| 400000| Недопустимые входные данные в запросе.|
| 400001| Недопустимый параметр "scope" (область).|
| 400002| Недопустимый параметр "category" (категория).|
| 400003| Спецификатор языка отсутствует или является недопустимым.|
| 400004| Спецификатор целевого сценария ("To script") отсутствует или является недопустимым.|
| 400005| Входной текст отсутствует или является недопустимым.|
| 400006| Недопустимая комбинация языка и сценария.|
| 400018| Спецификатор исходного сценария ("From script") отсутствует или является недопустимым.|
| 400019| Один из указанных языков не поддерживается.|
| 400020| Один из элементов в массиве входного текста недопустим.|
| 400021| Параметр версии API отсутствует или недопустим.|
| 400023| Один из заданной пары языков является недопустимым.|
| 400035| Исходный язык (поле "From") является недопустимым.|
| 400036| Целевой язык (поле "To") отсутствует или является недопустимым.|
| 400042| Один из указанных параметров (поле "Options") является недопустимым.|
| 400043| Идентификатор трассировки клиента (поле ClientTraceId или заголовок X-ClientTranceId) отсутствует или является недопустимым.|
| 400050| Входной текст является слишком длинным. Просмотр [лимитов запросов](../request-limits.md).|
| 400064| Параметр "translation" (перевод) отсутствует или недопустим.|
| 400070| Количество целевых сценариев (параметр "ToScript") не соответствует количеству целевых языков (параметр "To").|
| 400071| Значение не является допустимым для TextType.|
| 400072| В массиве входного текста слишком много элементов.|
| 400073| Недопустимый параметр сценария.|
| 400074| Текст запроса не соответствует формату JSON.|
| 400075| Сочетание категории и пары языков не является допустимым.|
| 400077| Превышен максимальный размер запроса. Просмотр [лимитов запросов](../request-limits.md).|
| 400079| Система, запрошенная для перевода между данными исходным и целевым языками, не существует.|
| 400080| Транслитерация не поддерживается для языка или скрипта.|
| 401000| Запрос не авторизован, так как учетные данные отсутствуют или являются недопустимыми.|
| 401015| "Указаны учетные данные для API распознавания речи. Этот запрос требует учетные данные для API текста. Используйте подписку на API текста переводчика."|
| 403000| Операция запрещена.|
| 403001| Операция запрещена, так как для подписки превышена бесплатная квота.|
| 405000| Метод запроса не поддерживается для запрошенного ресурса.|
| 408001| Запрашиваемый перевод системы готовится. Повторите попытку через несколько минут.|
| 408002| Запрос приурочен ожидания на входящий поток. Клиент не произвел запрос в течение времени, когда сервер был готов ждать. Клиент может повторить запрос без изменений в любое более позднее время.|
| 415000| Заголовок Content-Type отсутствует или является недопустимым.|
| 429000, 429001, 429002| Сервер отклонил запрос из-за превышения лимита запроса.|
| 500000| Произошла непредвиденная ошибка. Если ошибка сохраняется, передайте отчет о ней, включив следующие данные: дата и время ошибки, идентификатор запроса из заголовка ответа X-RequestId и идентификатор клиента из заголовка запроса X-ClientTraceId.|
| 503000| Служба временно недоступна. Повторите попытку. Если ошибка сохраняется, передайте отчет о ней, включив следующие данные: дата и время ошибки, идентификатор запроса из заголовка ответа X-RequestId и идентификатор клиента из заголовка запроса X-ClientTraceId.|

## <a name="metrics"></a>Метрики 
Метели позволяют просматривать информацию об использовании и доступности переводчика на портале Azure в разделе метрик, как показано на скриншоте ниже. Для получения дополнительной [информации см.](https://docs.microsoft.com/azure/azure-monitor/platform/data-platform-metrics)

![Переводчик Метрики](../media/translatormetrics.png)

В этой таблице перечислены доступные метрики с описанием того, как они используются для мониторинга вызовов API-перевода.

| Метрики | Описание |
|:----|:-----|
| TotalCalls| Общее число вызовов API.|
| TotalTokenCalls| Общее количество вызовов API через службу токенов с помощью токенов аутентификации.|
| SuccessfulCalls| Число успешных вызовов.|
| TotalErrors| Количество вызовов с ответом на ошибку.|
| BlockedCalls| Число вызовов, превысивших ограничение скорости или квоты.|
| ServerErrors| Количество вызовов с внутренней ошибкой сервера (5XX).|
| ClientErrors| Количество звонков с ошибкой стороны клиента (4XX).|
| Задержка| Продолжительность завершения запроса за миллисекунды.|
| CharactersTranslated| Общее количество символов во входящем текстовом запросе.|
