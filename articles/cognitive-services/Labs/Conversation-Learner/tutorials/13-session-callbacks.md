---
title: Использование обратных вызовов сеансов в модели Conversation Learner в Microsoft Cognitive Services | Документация Майкрософт
titleSuffix: Azure
description: Сведения об использовании обратных вызовов сеансов в модели Conversation Learner.
services: cognitive-services
author: nitinme
manager: nolachar
ms.service: cognitive-services
ms.subservice: conversation-learner
ms.topic: article
ms.date: 04/30/2018
ms.author: nitinme
ms.openlocfilehash: eeed0718a1feb170dbbaa783ec0a840c7829c02e
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "66390018"
---
# <a name="how-to-use-session-callbacks-with-a-conversation-learner-model"></a>Использование обратных вызовов сеансов в приложении Conversation Learner

В этом учебнике приведена информация о сеансах, о том, как они обрабатываются, и об обратных вызовах onSessionStart и onSessionEnd Conversation Learner.

## <a name="video"></a>Видео

[![Предварительная версия учебника об обратных вызовах сеансов](https://aka.ms/cl_Tutorial_v3_SessionCallbacks_Preview)](https://aka.ms/cl_Tutorial_v3_SessionCallbacks)

## <a name="requirements"></a>Требования
Для работы с этим руководством потребуется запустить бота tutorialSessionCallbacks.

    npm run tutorial-session-callbacks

## <a name="details"></a>Сведения
В этом руководстве объясняется концепция сеанса, правила обработки сеансов по умолчанию и переопределение этих правил.

В Conversation Learner сеанс представляет собой одно непрерывное интерактивное взаимодействие с ботом. Сеансы могут иметь несколько изменений хода диалога и программным образом завершаются, если прошло более тридцати минут.  Информация об изменении допустимой по умолчанию длительности времени ожидания в сеансе приводится на странице справки об ограничениях.

Это длительное бездействие вызовет создание нового сеанса и сброс рекуррентной нейронной сети в исходное состояние. По умолчанию будут сброшены все значения сущностей. Вы можете изменить это поведение по умолчанию, как показано ниже.

### <a name="load-the-demo-model"></a>Загрузка демонстрационной модели

В веб-интерфейсе щелкните "Импорт учебников" и выберите модель Tutorial-13-SessionCallbacks.

### <a name="code-for-the-callbacks"></a>Код для обратных вызовов

Пример кода для двух обратных вызовов этой модели можно найти в `c:\<installedpath>\src\demos\tutorialSessionCallbacks.ts`.

![](../media/tutorial11_code.PNG)

- Метод OnSessionStartCallback задает сущность BotName.
- Метод OnSessionEndCallback позволяет указать, какие данные нужно сохранять. Такой вариант очистит все данные сущностей, за исключением имени и телефона пользователя.

Каждый обратный вызов является необязательным.

### <a name="actions"></a>Действия

В модели определены четыре действия. Существующие действия отображаются в представлении сетки "Действия".

![](../media/tutorial11_actions.PNG)

### <a name="creating-an-end-session-action-for-callback-invocation"></a>Создание действия окончания сеанса (для обратного вызова)

1. На левой панели щелкните "Действия", а затем нажмите кнопку "Создать действие".
2. Установите значения ENDSESSION для параметра "Тип сущности".
3. В поле "Данные…" введите "Готово".
4. Нажмите кнопку "Создать".

### <a name="edit-an-existing-action"></a>Изменение имеющегося действия

1. Выберите действие "Итак, $UserName, вы находитесь в $UserLocation" в представлении сетки.
2. Снимите флажок "Ожидать ответа".
3. Нажмите кнопку "Сохранить".

### <a name="chaining-actions"></a>Объединение действий в цепочку

1. На левой панели щелкните "Обучающие диалоги" и нажмите кнопку "Создать обучающий диалог".
2. На панели чата, на которой отображается надпись "Введите текст сообщения...", введите hi (привет).
3. Нажмите кнопку "Оценить действия".
4. Выберите ответ Hi, I'm Botty. What's your name? (Здравствуйте, меня зовут Ботти. Как Вас зовут?).
5. На панели чата, на которой отображается надпись "Введите текст сообщения...", введите текст Lars (Ларс).
6. Выберите ответ Hi Lars. (Привет, Ларс). What is your phone number? (Какой у Вас номер телефона?)
7. На панели чата, на которой отображается надпись "Введите текст сообщения...", введите текст 555-555-5555.
8. Нажмите кнопку "Оценить действия".
9. Выберите ответ Can you tell Botty your location, Lars? (Ларс, можете ли Вы сообщить боту свое местоположение?).
10. На панели чата, на которой отображается надпись "Введите текст сообщения...", введите текст Seattle (Сиэтл).
11. Нажмите кнопку "Оценить действия".
12. Выберите ответ So, Lars, you are in Seattle (Итак, Ларс, Вы находитесь в Сиэтле).
13. Выберите ответ Done (Готово).
14. Нажмите кнопку "Сохранить".

### <a name="testing-the-model"></a>Тестирование модели

1. На левой панели щелкните "Записываемые диалоги" и нажмите кнопку "Создать записываемый диалог".
2. На панели чата, на которой отображается надпись "Введите текст сообщения...", введите hi (привет).
3. На панели чата, на которой отображается надпись "Введите текст сообщения...", введите текст Lars (Ларс).
4. На панели чата, на которой отображается надпись "Введите текст сообщения...", введите текст 555-555-5555.
5. На панели чата, на которой отображается надпись "Введите текст сообщения...", введите текст Seattle (Сиэтл).
    - На этом этапе все значения сущности за исключением расположения должны быть сохранены.
6. На панели чата, на которой отображается надпись "Введите текст сообщения...", введите текст hello (привет).
7. На панели чата, на которой отображается надпись "Введите текст сообщения...", введите текст Detroit (Детройт).
8. Нажмите кнопку "Время ожидания сеанса".
    - После нажатия этой кнопки выдается ответ бота для длительного периода бездействия.
9. Нажмите кнопку OK.
10. Нажмите кнопку Done Testing (Тестирование завершено).

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Вызовы API](./14-api-calls.md)
