---
title: Анализ тональности с помощью Анализа текста в Cognitive Services | Документация Майкрософт
description: Узнайте, как определить тональность с помощью REST API анализа текста.
services: cognitive-services
author: aahill
manager: nitinme
ms.service: cognitive-services
ms.subservice: text-analytics
ms.topic: sample
ms.date: 02/26/2019
ms.author: aahi
ms.openlocfilehash: e17b68dfd63952d0c8c81415b090b047c5808e2e
ms.sourcegitcommit: 66237bcd9b08359a6cce8d671f846b0c93ee6a82
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2019
ms.locfileid: "67797801"
---
# <a name="example-how-to-detect-sentiment-with-text-analytics"></a>Пример: как определить тональность в службе "Анализ текста"

[API анализа тональности](https://westcentralus.dev.cognitive.microsoft.com/docs/services/TextAnalytics-v2-1/operations/56f30ceeeda5650db055a3c9) вычисляет ввод текста и возвращает оценку тональности для каждого документа в диапазоне от 0 (отрицательное значение) до 1 (положительное значение).

Эта возможность нужна для обнаружения положительных и отрицательных тональностей в социальных сетях, отзывах клиентов и на форумах. Содержимое предоставляете вы, а модели и данные для обучения — служба.

В настоящий момент анализ тональности поддерживает английский, немецкий, испанский и французский языки. Другие языки находятся на этапе предварительной версии. Дополнительные сведения см. в [списке поддерживаемых языков](../text-analytics-supported-languages.md).

> [!TIP]
> API анализа текста также предоставляет образ контейнера Docker под управлением Linux для анализа тональности, поэтому вы можете [установить и запустить контейнер API анализа текста](text-analytics-how-to-install-containers.md) в непосредственной близости к своим данным.

## <a name="concepts"></a>Основные понятия

Анализ текста использует алгоритм классификации машинного обучения для создания оценки тональности от 0 до 1. Оценки, близкие к 1, указывают на позитивную тональность, а оценки, близкие к 0, — на негативную. Модель обучена с использованием обширного текста со связями тональности. В настоящее время нет возможности предоставления собственных данных для обучения. Модель использует сочетание техник во время анализа текста, включая обработку текста, анализа частей речи, размещения слов и связи между словами. Дополнительные сведения об алгоритме см. в статье [Introducing Text Analytics in the Azure ML Marketplace](https://blogs.technet.microsoft.com/machinelearning/2015/04/08/introducing-text-analytics-in-the-azure-ml-marketplace/) (Представление Анализа текста в Azure ML Marketplace).

Анализ тональности выполняется по всему документу, в отличие от извлечения тональностей для конкретного объекта в тексте. На практике имеется тенденция повышения оценки точности, когда документы содержат одно или два предложения, а не большой блок текста. На этапе оценки объективности модель определяет, является ли документ в целом объективным или содержит тональности. Документ, который в основном объективен, не продвигается к фразе обнаружения тональности, что приводит к оценке .50, без дальнейшей обработки. Для документов, продолжающих работу в конвейере, следующий этап формирует оценку выше или ниже .50, в зависимости от степени обнаружений тональности в документе.

## <a name="preparation"></a>Подготовка

Анализ тональности дает более качественный результат, когда ему передаются более мелкие блоки текста. Это является противоположностью извлечению ключевой фразы, которая выполняется лучше на более крупных блоках текста. Для получения наилучших результатов обеих операций советуем реструктуризировать входные данные соответствующим образом.

Необходимо иметь документы JSON в следующем формате: "идентификатор","текст","язык".

Документ должен содержать менее 5120 символов и иметь до 1000 элементов (идентификаторов) в коллекции. Коллекция передается в тексте запроса. Ниже приведен пример содержимого, который вы можете представить для анализа тональности.

```
    {
        "documents": [
            {
                "language": "en",
                "id": "1",
                "text": "We love this trail and make the trip every year. The views are breathtaking and well worth the hike!"
            },
            {
                "language": "en",
                "id": "2",
                "text": "Poorly marked trails! I thought we were goners. Worst hike ever."
            },
            {
                "language": "en",
                "id": "3",
                "text": "Everyone in my family liked the trail but thought it was too challenging for the less athletic among us. Not necessarily recommended for small children."
            },
            {
                "language": "en",
                "id": "4",
                "text": "It was foggy so we missed the spectacular views, but the trail was ok. Worth checking out if you are in the area."
            },                
            {
                "language": "en",
                "id": "5",
                "text": "This is my favorite trail. It has beautiful views and many places to stop and rest"
            }
        ]
    }
```

## <a name="step-1-structure-the-request"></a>Шаг 1. Структурирование запроса

Сведения об определении запроса можно найти в статье [How to call the Text Analytics REST API](text-analytics-how-to-call-api.md) (Способ вызова REST API анализа текста). Для удобства повторим следующие моменты.

+ Создайте запрос **POST**. Ознакомьтесь с документацию по API для этого запроса: [API для анализа тональности](https://westcentralus.dev.cognitive.microsoft.com/docs/services/TextAnalytics-v2-1/operations/56f30ceeeda5650db055a3c9)

+ Задайте конечную точку HTTP для анализа тональности с помощью ресурса API анализа текста в Azure или экземпляра [контейнера API анализа текста](text-analytics-how-to-install-containers.md). Она должна включать ресурс `/sentiment`: `https://westus.api.cognitive.microsoft.com/text/analytics/v2.1/sentiment`

+ Задайте заголовок запроса, чтобы включить ключ доступа для операций Анализа текста. Дополнительные сведения см. в статье [о поиске конечных точек и ключей доступа](text-analytics-how-to-access-key.md).

+ В тексте запроса укажите набор документов JSON, которые подготовлены для этого анализа.

> [!Tip]
> Используйте [Postman](text-analytics-how-to-call-api.md) или откройте **консоль тестирования API** в [документации](https://westcentralus.dev.cognitive.microsoft.com/docs/services/TextAnalytics-v2-1/operations/56f30ceeeda5650db055a3c9), чтобы структурировать запрос и передать его (используя метод POST) в службу.

## <a name="step-2-post-the-request"></a>Шаг 2. Передача запроса

Анализ выполняется при получении запроса. Сведения о размере и числе запросов, которые можно отправлять в минуту и секунду, см. в разделе об [ограничениях данных](../overview.md#data-limits).

Не забывайте, что эта служба работает без отслеживания состояния. Данные не хранятся в учетной записи. Результаты возвращаются немедленно в ответе.


## <a name="step-3-view-results"></a>Шаг 3. Просмотр результатов

Анализатор тональности позволяет классифицировать текст как преимущественно положительный или отрицательный, назначая оценку в диапазоне от 0 до 1. Значения, близкие к 0,5 — нейтральные или неопределенные. Оценка 0,5 указывает нейтральность. Если строку невозможно проанализировать на определение тональности или у нее нет тональности, показатель всегда является именно 0,5. Например, если передать строку на испанском языке с кодом английского языка, оценка будет 0,5.

Вывод возвращается немедленно. Можно выполнить потоковую передачу результатов в приложение, которое принимает JSON, или сохранить выходные данные в файле локальной системы, а затем импортировать их в приложение, которое дает возможность сортировки, поиска данных и управления ими.

В следующем примере показан ответ для коллекции документов в этой статье.

```json
{
    "documents": [
        {
            "score": 0.9999237060546875,
            "id": "1"
        },
        {
            "score": 0.0000540316104888916,
            "id": "2"
        },
        {
            "score": 0.99990355968475342,
            "id": "3"
        },
        {
            "score": 0.980544924736023,
            "id": "4"
        },
        {
            "score": 0.99996328353881836,
            "id": "5"
        }
    ],
    "errors": []
}
```

## <a name="sentiment-analysis-v3-public-preview"></a>Общедоступная предварительная версия 3 анализа тональности

Вышла [следующая общедоступная предварительная версия анализа тональности](https://westcentralus.dev.cognitive.microsoft.com/docs/services/TextAnalytics-v3-0-preview/operations/56f30ceeeda5650db055a3c9), в которой значительно улучшена точность и детализация функций API для классификации и оценки текста. 

> [!NOTE]
> * Формат запроса и [ограничения данных](../overview.md#data-limits) для версии 3 анализа тональности по сравнению с предыдущей версией не изменились.
> * Сейчас анализ тональности версии 3: 
>    * поддерживает только английский язык;  
>    * доступен в следующих регионах: `Central US`, `Central Canada`, `East Asia`. 

|Функция |ОПИСАНИЕ  |
|---------|---------|
|Повышенная точность     | Значительное улучшение механизма определения положительной, нейтральной, отрицательной и смешанной тональности в текстовых документах по сравнению с предыдущими версиями.           |
|Оценка тональности на уровне документа и предложения     | Тональность определяется как для всего документа, так и для отдельных предложений. Если в документе несколько предложений, каждому из них также присваивается оценка тональности.         |
|Оценка и категория тональности     | Теперь, кроме оценки, API возвращает для текста сведения о категории тональности (`positive`, `negative`, `neutral` или `mixed`).        |
| Усовершенствованные выходные данные | Анализ тональности возвращает сведения как обо всем текстовом документе, так и об отдельных предложениях. |

### <a name="sentiment-labeling"></a>Метки тональности

Анализ тональности версии 3 может возвращать оценки и метки (`positive`, `negative` и `neutral`) на уровне предложения и документа. На уровне документа может также возвращаться метка (но не оценка) тональности `mixed`. Тональность документа определяется путем агрегирования оценок всех его предложений.

| Тональность предложения                                                        | Полученная метка документа |
|---------------------------------------------------------------------------|----------------|
| По крайней мере одно предложение c положительной тональностью, остальные предложения — с нейтральной тональностью. | `positive`     |
| По крайней мере одно предложение c отрицательной тональностью, остальные предложения — с нейтральной тональностью.  | `negative`     |
| По крайней мере одно предложение c отрицательной тональностью и одно предложение c положительной тональностью.         | `mixed`        |
| Все предложения с нейтральной тональностью.                                                 | `neutral`      |

### <a name="sentiment-analysis-v3-example-request"></a>Пример запроса на анализ тональности версии 3

Ниже приведен пример запроса в формате JSON на анализ тональности новой версии. Формат запроса остался таким же, как и в предыдущей версии:

```json
{
  "documents": [
    {
      "language": "en",
      "id": "1",
      "text": "Hello world. This is some input text that I love."
    },
    {
      "language": "en",
      "id": "2",
      "text": "It's incredibly sunny outside! I'm so happy."
    }
  ]
}
```

### <a name="sentiment-analysis-v3-example-response"></a>Пример ответа от API анализа тональности версии 3

Хотя формат запроса по сравнению с предыдущей версией не изменился, формат ответа теперь другой. Ниже приведен пример ответа в формате JSON от новой версии API:

```json
{
    "documents": [
        {
            "id": "1",
            "sentiment": "positive",
            "documentScores": {
                "positive": 0.98570585250854492,
                "neutral": 0.0001625834556762,
                "negative": 0.0141316400840878
            },
            "sentences": [
                {
                    "sentiment": "neutral",
                    "sentenceScores": {
                        "positive": 0.0785155147314072,
                        "neutral": 0.89702343940734863,
                        "negative": 0.0244610067456961
                    },
                    "offset": 0,
                    "length": 12
                },
                {
                    "sentiment": "positive",
                    "sentenceScores": {
                        "positive": 0.98570585250854492,
                        "neutral": 0.0001625834556762,
                        "negative": 0.0141316400840878
                    },
                    "offset": 13,
                    "length": 36
                }
            ]
        },
        {
            "id": "2",
            "sentiment": "positive",
            "documentScores": {
                "positive": 0.89198976755142212,
                "neutral": 0.103382371366024,
                "negative": 0.0046278294175863
            },
            "sentences": [
                {
                    "sentiment": "positive",
                    "sentenceScores": {
                        "positive": 0.78401315212249756,
                        "neutral": 0.2067587077617645,
                        "negative": 0.0092281140387058
                    },
                    "offset": 0,
                    "length": 30
                },
                {
                    "sentiment": "positive",
                    "sentenceScores": {
                        "positive": 0.99996638298034668,
                        "neutral": 0.0000060341349126,
                        "negative": 0.0000275444017461
                    },
                    "offset": 31,
                    "length": 13
                }
            ]
        }
    ],
    "errors": []
}
```

### <a name="example-c-code"></a>Пример кода C#:

Пример приложения на C#, которое вызывает эту версию анализа тональности, можно найти на сайте [GitHub](https://github.com/Azure-Samples/cognitive-services-REST-api-samples/tree/master/dotnet/Language/SentimentV3.cs).

## <a name="summary"></a>Сводка

В этой статье рассматриваются основные понятия и рабочий процесс анализа тональности в службе Анализ текста Cognitive Services. В разделе "Сводка" сделайте следующее.

+ [API анализа тональности](https://westcentralus.dev.cognitive.microsoft.com/docs/services/TextAnalytics-v2-1/operations/56f30ceeeda5650db055a3c9) доступен для некоторых языков.
+ В тексте запроса передаются документы JSON, которые содержат идентификатор, текст и код языка.
+ Запрос POST передается в конечную точку `/sentiment`, используя личный [ключ доступа и конечную точку](text-analytics-how-to-access-key.md), допустимые для вашей подписки.
+ Выходные данные ответа, состоящие из оценки тональности для каждого идентификатора документа, могут передаваться в любое приложение, принимающее JSON, включая Excel и Power BI (лишь некоторые из них).

## <a name="see-also"></a>См. также 

 [Text Analytics overview](../overview.md) (Общие сведения об анализе текста)  
 [Часто задаваемые вопросы](../text-analytics-resource-faq.md)</br>
 [Анализ текста](//go.microsoft.com/fwlink/?LinkID=759712) 

## <a name="next-steps"></a>Дополнительная информация

> [!div class="nextstepaction"]
> [Извлечение ключевых фраз](text-analytics-how-to-keyword-extraction.md)
