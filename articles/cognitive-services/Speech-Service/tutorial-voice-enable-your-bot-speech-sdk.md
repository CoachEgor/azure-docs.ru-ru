---
title: 'Учебник: Голоса позволяют вашему боту с помощью речевого SDK - Служба речи'
titleSuffix: Azure Cognitive Services
description: В этом уроке вы создадите Echo Bot с помощью Microsoft Bot-Framework, разместите его в Azure и зарегистрируете на канале Bot-Framework Direct Line Speech. Затем вы наверпетируете пример клиентского приложения для Windows, которое позволяет вам говорить с вашим ботом и слышать, как он отвечает вам.
services: cognitive-services
author: trevorbye
manager: nitinme
ms.service: cognitive-services
ms.subservice: speech-service
ms.topic: conceptual
ms.date: 02/25/2020
ms.author: trbye
ms.openlocfilehash: b2c119f6552773bce7bb93a503c22324278ac0bc
ms.sourcegitcommit: b80aafd2c71d7366838811e92bd234ddbab507b6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81399473"
---
# <a name="tutorial-voice-enable-your-bot-using-the-speech-sdk"></a>Учебник: Голосовой включить бота с помощью речи SDK

Теперь вы можете использовать возможности службы speech, чтобы легко включить чат-бота.

В этом уроке вы создадите Echo Bot с помощью Microsoft Bot-Framework, разместите его в Azure и зарегистрируете на канале Bot-Framework Direct Line Speech. Затем вы наверпетируете пример клиентского приложения для Windows, которое позволяет вам говорить с вашим ботом и слышать, как он отвечает вам.

Этот учебник предназначен для разработчиков, которые только начинают свое путешествие с Azure, Бот-Framework ботов, Прямой линии речи, или речи SDK, и хотите быстро построить рабочую систему с ограниченным кодирования. Нет опыта или знакомства с этими услугами не требуется.

В конце этого упражнения вы навяжете систему, которая будет работать следующим образом:

1. Пример клиентского приложения настроен для подключения к каналу прямой линии речи и Echo Bot
1. Аудио записывается из микрофона по умолчанию на нажатии кнопки (или непрерывно записывается при активации пользовательского ключевого слова)
1. Дополнительно происходит пользовательское обнаружение ключевых слов, что ведет передачу аудио-трансляции в облако
1. Используя Speech SDK, приложение подключается к каналу Прямой линии речи и потоков аудио
1. Дополнительно, более высокая точность проверки ключевых слов происходит на службе
1. Аудио передается в службу распознавания речи и транскрибируется к тексту
1. Признанный текст передается на Echo-Bot как Рамочная деятельность Bot 
1. Текст ответа превращается в аудио службой Text-to-Speech (TTS) и передается обратно в клиентское приложение для воспроизведения

![диаграмма-тег](media/tutorial-voice-enable-your-bot-speech-sdk/diagram.png "Поток канала речи")

> [!NOTE]
> Шаги в этом учебнике не требуют платной услуги. Как новый пользователь Azure, вы сможете использовать кредиты из бесплатной пробной подписки Azure и бесплатного уровня службы Speech для завершения этого учебника.

Темы, рассматриваемые в этом руководстве:
> [!div class="checklist"]
> * Создание ресурсов Azure
> * Сборка, тестирование и развертывание образца Echo Bot в службе приложений Azure
> * Зарегистрируйте бота на канале "Прямая линия"
> * Создайте и запустите клиент голосового помощника Windows для взаимодействия с вашим Эхо Ботом
> * Добавление пользовательской активации ключевого слова
> * Научитесь менять язык признанной и устной речи

## <a name="prerequisites"></a>Предварительные требования

Вот что вам нужно, чтобы завершить этот учебник:

- Пк с Windows 10 с рабочим микрофоном и динамиками (или наушниками)
- [Визуальная студия 2017](https://visualstudio.microsoft.com/downloads/) или выше
- [Время выполнения рамочного забега .NET 4.6.1](https://dotnet.microsoft.com/download) или выше
- Учетная запись Azure. [Зарегистрируйтесь бесплатно](https://azure.microsoft.com/free/ai/).
- Учетная запись [GitHub](https://github.com/)
- [Git для Windows](https://git-scm.com/download/win)

## <a name="create-a-resource-group"></a>Создание группы ресурсов

Клиентское приложение, которое вы создадите в этом учебнике, использует несколько служб Azure. Чтобы сократить время в пути в оба конца для ответов от бота, необходимо убедиться, что эти службы находятся в том же регионе Azure. В этом разделе вы создадите группу ресурсов в **регионе Западного США.** Эта группа ресурсов будет использоваться при создании отдельных ресурсов для Bot-Framework, канала прямой линии и службы речи.

1. <a href="https://ms.portal.azure.com/#create/Microsoft.ResourceGroup" target="_blank">Создание группы ресурсов<span class="docon docon-navigate-external x-hidden-focus"></span></a>
1. Вам будет предложено предоставить некоторую информацию:
   * Установите **подписку** на **бесплатную пробную версию** (вы также можете использовать существующую подписку).
   * Введите имя для **группы ресурсов.** Мы рекомендуем **SpeechEchoBotTutorial-РесурсГруппа**.
   * Из **региона** падение вниз, выберите **Запад США**.
1. Щелкните **Проверка и создание**. Вы должны увидеть баннер, который читает **Валидация прошло**.
1. Нажмите кнопку **Создать**. Создание группы ресурсов может занять несколько минут.
1. Как и в отношении ресурсов, которые вы создадите позже в этом учебнике, рекомендуется прикрепить эту группу ресурсов к панели мониторинга для легкого доступа. Если вы хотите прикрепить эту группу ресурсов, нажмите значок контакта в правом верхнем углу панели мониторинга.

### <a name="choosing-an-azure-region"></a>Выбор региона Azure

Если вы хотите использовать другой регион для этого учебника эти факторы могут ограничить ваш выбор:

* Убедитесь, что вы используете [поддерживаемый регион Azure.](regions.md#voice-assistants)
* Канал «Прямая линия» использует услугу «текст в речь», которая имеет стандартные и нейронные голоса. Нейронные голоса [ограничены определенными регионами Azure.](regions.md#standard-and-neural-voices)
* Бесплатные пробные ключи могут быть ограничены определенным регионом.

Для получения дополнительной информации о регионах [см.](https://azure.microsoft.com/global-infrastructure/locations/)

## <a name="create-resources"></a>Создание ресурсов

Теперь, когда у вас есть группа ресурсов в поддерживаемом регионе, следующим шагом является создание индивидуальных ресурсов для каждой службы, которую вы будете использовать в этом учебнике.

### <a name="create-a-speech-service-resource"></a>Создание ресурса службы речевой речи

Следуйте этим инструкциям для создания ресурса Речи:

1. <a href="https://ms.portal.azure.com/#create/Microsoft.CognitiveServicesSpeechServices" target="_blank">Создание ресурса службы речевой речи<span class="docon docon-navigate-external x-hidden-focus"></span></a>
4. Вам будет предложено предоставить некоторую информацию:
   * Назовите **Name**ресурс. Мы рекомендуем **SpeechEchoBotTutorial-Речь**
   * Для **подписки**убедитесь, что **бесплатная пробная версия** выбрана.
   * Для **расположения,** выберите **Запад США**.
   * Для **уровня ценообразования,** выберите **F0**. Это бесплатный уровень.
   * Для **группы ресурсов**, выберите **SpeechEchoBotTutorial-Ресурсная группа**.
5. После ввода всей необходимой информации нажмите **«Создать».** Создание ресурса может занять несколько минут.
6. Позже в этом учебнике вам понадобятся ключи подписки для этой службы. Вы можете получить доступ к этим ключам в любое время из **обзора** вашего ресурса (Управлять ключами) или **ключами.**

На этом этапе убедитесь, что ваша группа ресурсов **(SpeechEchoBotTutorial-ResourceGroup)** имеет ресурс speech:

| Имя | Тип  | Расположение |
|------|-------|----------|
| SpeechEchoBotTutorial-Речь | Cognitive Services | западная часть США |

### <a name="create-an-azure-app-service-plan"></a>Создание плана службы приложений Azure

Следующим шагом является создание плана службы приложений. План службы приложений определяет набор вычислительных ресурсов, на которых выполняется веб-приложение.

1. <a href="https://ms.portal.azure.com/#create/Microsoft.AppServicePlanCreate" target="_blank">Создание плана службы приложений Azure<span class="docon docon-navigate-external x-hidden-focus"></span></a>
4. Вам будет предложено предоставить некоторую информацию:
   * Установите **подписку** на **бесплатную пробную версию** (вы также можете использовать существующую подписку).
   * Для **группы ресурсов**, выберите **SpeechEchoBotTutorial-Ресурсная группа**.
   * Назовите **Name**ресурс. Мы рекомендуем **SpeechEchoBotTutorial-AppServicePlan**
   * Для **операционной системы**выберите **Windows**.
   * Для **региона,** выберите **Запад США**.
   * Для **уровня ценообразования**убедитесь, что **стандартный S1** выбран. Это должно быть значение по умолчанию. Если это не так, убедитесь, что вы установите **операционную систему** для **Windows,** как описано выше.
5. Щелкните **Проверка и создание**. Вы должны увидеть баннер, который читает **Валидация прошло**.
6. Нажмите кнопку **Создать**. Создание группы ресурсов может занять несколько минут.

На этом этапе убедитесь, что ваша группа ресурсов **(SpeechEchoBotTutorial-ResourceGroup**) имеет два ресурса:

| Имя | Тип  | Расположение |
|------|-------|----------|
| SpeechEchoBotTutorial-AppServicePlan | План обслуживания приложения | западная часть США |
| SpeechEchoBotTutorial-Речь | Cognitive Services | западная часть США |

## <a name="build-an-echo-bot"></a>Построить Эхо Бот

Теперь, когда вы создали некоторые ресурсы, давайте создадим бота. Начнем с образца Echo Bot, который, как следует из названия, повторяет текст, который вы ввели в качестве ответа. Не волнуйтесь, образец кода готов для вас использовать без каких-либо изменений. Он настроен для работы с каналом Прямой линии речи, который мы подключим после развертывания бота в Azure.

> [!NOTE]
> Инструкции, которые следуют, а также дополнительную информацию о Echo Bot доступны в [README образца на GitHub](https://github.com/microsoft/BotBuilder-Samples/blob/master/samples/csharp_dotnetcore/02.echo-bot/README.md).

### <a name="run-the-bot-sample-on-your-machine"></a>Запустите образец бота на вашей машине

1. Клонировать репозиторий образцов:

   ```bash
   git clone https://github.com/Microsoft/botbuilder-samples.git
   ```

2. Запустите Visual Studio.
3. Из панели инструментов выберите **File** > **Open** > **Project/Solution**и откройте решение проекта Echo Bot:

   ```
   samples\csharp_dotnetcore\02.echo-bot\EchoBot.sln
   ```

4. После загрузки проекта нажмите <kbd>F5,</kbd> чтобы построить и запустить проект.
5. Браузер должен запустить, и вы увидите экран похожий на это.
    > [!div class="mx-imgBorder"]
    > [![эхобот-бег-на-местный хозяин](media/tutorial-voice-enable-your-bot-speech-sdk/echobot-running-on-localhost.png "EchoBot работает на localhost")](media/tutorial-voice-enable-your-bot-speech-sdk/echobot-running-on-localhost.png#lightbox)

### <a name="test-the-bot-sample-with-the-bot-framework-emulator"></a>Проверьте образец бота с помощью эмулятора Bot Framework

[Bot Framework Emulator](https://github.com/microsoft/botframework-emulator) — это настольное приложение, которое позволяет разработчикам ботов тестировать и отлажовать своих ботов локально или удаленно через туннель. Эмулятор поддерживает набранный текст в качестве ввода (не голос). Бот ответит текстом. Выполните следующие действия, чтобы использовать эмулятор Bot Framework для проверки вашего Echo Bot, работая локально, с ввозам текста и выходом текста. После развертывания бота в Azure мы протестируем его с помощью голосового ввода и голосового вывода.

1. Установка версии [Эмулятора Рамочной Bot](https://github.com/Microsoft/BotFramework-Emulator/releases/latest) 4.3.0 или больше
2. Запустите эмулятор bot Framework и откройте бота:
   * **Файл** -> **Открыть Бот**.
3. Введите URL-адрес для вашего бота. Пример:

   ```
   http://localhost:3978/api/messages
   ```
   и нажмите "Connect".
4. Бот должен немедленно приветствовать вас с "Привет и добро пожаловать!" . Введите любое текстовое сообщение и подтвердите, что получите ответ от бота.
5. Вот как может выглядеть обмен сообщениями с экземпляром Echo Bot: [ ![бот-рамочный эмулятор](media/tutorial-voice-enable-your-bot-speech-sdk/bot-framework-emulator.png "Эмулятор Бот-Рамочный")](media/tutorial-voice-enable-your-bot-speech-sdk/bot-framework-emulator.png#lightbox)

## <a name="deploy-your-bot-to-an-azure-app-service"></a>Развертывание бота в службе приложений Azure

Следующим шагом является развертывание Echo Bot в Azure. Есть несколько способов развертывания бота, но в этом учебнике мы сосредоточимся на публикации непосредственно из Visual Studio.

> [!NOTE]
> Кроме того, можно развернуть бота с помощью шаблонов [Azure CLI](https://docs.microsoft.com/azure/bot-service/bot-builder-deploy-az-cli) и [развертывания.](https://github.com/microsoft/BotBuilder-Samples/tree/master/experimental/directline-speech/csharp_dotnetcore/02.echo-bot/DeploymentTemplates)

1. Из Visual Studio, откройте Echo Bot, который был настроен для использования с каналом Прямой линии речи:

   ```
   samples\csharp_dotnetcore\02.echo-bot\EchoBot.sln
   ```

1. В **Solution Explorer**, правой кнопкой мыши проекта **EchoBot** и выберите **Опубликовать ...**
1. Откроется новое окно под названием **«Выбрать цель публикации».**
1. Выберите **службу приложений** из **навигации служб Azure,** выберите **Создать новый,** а затем нажмите **Создать профиль**.
1. При попадатся окно **службы приложений** Create:
   * Нажмите **Добавить учетную запись**и войти в систему с учетными данными учетной записи Azure. Если вы уже вошли, выберите нужную учетную запись из раскрывающегося списка.
   * Для **названия приложения**вам нужно ввести глобально уникальное имя для вашего Бота. Это имя используется для создания уникального URL-адреса бота. Значение по умолчанию будет заселено, включая дату и время (например: "EchoBot20190805125647"). Вы можете использовать имя по умолчанию для этого учебника.
   * Для **подписки,** установите его на **бесплатную пробную версию**
   * Для **группы ресурсов**, выберите **SpeechEchoBotTutorial-Ресурсная группа**
   * Для **хостинг-плана**, выберите **SpeechEchoBotTutorial-AppServicePlan**
   * Для **приложения Исследования**, оставить как **нет**
1. Нажмите кнопку **Создать**.
1. Вы должны увидеть сообщение об успехе в Visual Studio, которое выглядит следующим образом:

   ```
   Publish Succeeded.
   Web App was published successfully https://EchoBot20190805125647.azurewebsites.net/
   ```

1. Ваш браузер по умолчанию должен открыться и отобразить страницу с надписью: "Ваш бот готов!".
1. На этом этапе проверьте свою группу ресурсов **SpeechEchoBotTutorial-ResourceGroup** на портале Azure и подтвердите наличие трех ресурсов:

| Имя | Тип  | Расположение |
|------|-------|----------|
| EchoBot20190805125647 | Служба приложений | западная часть США |
| SpeechEchoBotTutorial-AppServicePlan | План службы приложений | западная часть США |
| SpeechEchoBotTutorial-Речь | Cognitive Services | западная часть США |

## <a name="enable-web-sockets"></a>Включение протокола WebSocket

Вам нужно будет сделать небольшое изменение конфигурации, так что ваш бот может общаться с каналом прямой линии речи с помощью веб-розеток. Выполните следующие действия, чтобы включить веб-розетки:

1. Перейдите на [портал Azure](https://portal.azure.com)и найдите службу приложений. Ресурс должен быть назван по аналогии с **EchoBot20190805125647** (ваше уникальное название приложения).
2. В навигации **служб Azure** под **настройками**нажмите **«Конфигурация».**
3. Выберите вкладку **Общие настройки.**
4. Найдите переключатель для **веб-разъемов** и установите его **на.**
5. Выберите команду **Сохранить**.

> [!TIP]
> Вы можете использовать элементы управления в верхней части страницы службы приложений Azure, чтобы остановить или перезапустить службу. Это может пригодиться при устранении неполадок.

## <a name="create-a-channel-registration"></a>Создание регистрации канала

Теперь, когда вы создали службу приложений Azure для размещения вашего бота, следующим шагом является создание **регистрации каналов ботов.** Создание регистрации канала является необходимым условием для регистрации вашего бота с каналами Bot-Framework, включая канал Прямой линии.

> [!NOTE]
> Если вы хотите узнать больше о том, как боты используют каналы, [см.](https://docs.microsoft.com/azure/bot-service/bot-service-manage-channels?view=azure-bot-service-4.0)


1. <a href="https://ms.portal.azure.com/#create/Microsoft.BotServiceConnectivityGalleryPackage" target="_blank">Создание регистрации каналов Лазурного бота<span class="docon docon-navigate-external x-hidden-focus"></span></a>
2. Вам будет предложено предоставить некоторую информацию:
   * Для **робота ручкой,** введите **SpeechEchoBotTutorial-BotРегистрация**.
   * Для **подписки**выберите **бесплатную пробную версию.**
   * Для **группы ресурсов**, выберите **SpeechEchoBotTutorial-Ресурсная группа**.
   * Для **расположения,** выберите **Запад США**.
     * Для **уровня ценообразования,** выберите **F0**.
     * Для **конечных сообщений**введите URL-адрес для веб-приложения с помощью `/api/messages` пути, придативого в конце. Например: если ваше глобально уникальное название приложения было **EchoBot20190805125647,** ваша конечная точка обмена сообщениями будет: `https://EchoBot20190805125647.azurewebsites.net/api/messages/`.
     * Для **получения информации о приложениях**вы можете настроить это на **Off.** Для получения дополнительной информации, [см.](https://docs.microsoft.com/azure/bot-service/bot-service-manage-analytics?view=azure-bot-service-4.0)
     * Игнорировать **Авто создать Идентификатор приложения и пароль**.
5. В нижней части лезвия **регистрации каналов Бот** нажмите **Создать**.

На этом этапе проверьте свою группу ресурсов **SpeechEchoBotTutorial-ResourceGroup** на портале Azure. Теперь он должен показать четыре ресурса:

| Имя | Тип  | Расположение |
|------|-------|----------|
| EchoBot20190805125647 | Служба приложений | западная часть США |
| SpeechEchoBotTutorial-AppServicePlan | План службы приложений | западная часть США |
| SpeechEchoBotTutorial-BotРегистрация | Регистрация бот-каналов | global |
| SpeechEchoBotTutorial-Речь | Cognitive Services | западная часть США |

> [!IMPORTANT]
> Ресурс регистрации каналов Бота покажет глобальный регион, даже если вы выбрали Запад США. Это ожидаемое поведение.

## <a name="register-the-direct-line-speech-channel"></a>Зарегистрируйте канал "Прямая линия"

Теперь пришло время зарегистрировать бота на канале Direct Line Speech. Этот канал — это то, что используется для создания связи между вашим эхо-ботом и клиентским приложением, составленным с помощью Speech SDK.

1. Найдите и откройте ресурс **SpeechEchoBotTutorial-BotRegistration** на [портале Azure.](https://portal.azure.com)
1. Из **навигации служб Azure** выберите **Каналы**.
   * Ищите **больше каналов,** найти и нажмите **Прямая линия речи**.
   * Просмотрите текст на странице под названием **Configure Прямая линия речи**, а затем расширить выпадающие меню с пометкой "Когнитивная учетная запись службы".
   * Выберите созданный ранее речевой ресурс (например, **SpeechEchoBotTutorial-Speech)** из меню, чтобы связать бота с ключом подписки на речь.
   * Выберите команду **Сохранить**.

1. Из навигации **управления Bot** нажмите **Настройки**.
   * Проверьте поле с пометкой **Enable Streaming Endpoint.** Это необходимо для включения коммуникационного протокола, построенного на веб-разъемах между вашим ботом и каналом прямой линии речи.
   * Выберите команду **Сохранить**.

> [!TIP]
> Если вы хотите узнать больше, [см.](https://docs.microsoft.com/azure/bot-service/bot-service-channel-connect-directlinespeech?view=azure-bot-service-4.0) Эта страница содержит дополнительную информацию и известные проблемы.

## <a name="run-the-windows-voice-assistant-client"></a>Выполнить клиент голосового помощника Windows

На этом этапе вы запустите клиент-помощник Windows. Клиент — это приложение Фонда презентации Windows (WPF), которое использует [Speech SDK](https://docs.microsoft.com/azure/cognitive-services/speech-service/speech-sdk) для управления общением с вашим ботом с помощью канала Прямой линии. Используйте его для взаимодействия с ботом и тестирования перед написанием пользовательского клиентского приложения. Это с открытым исходным кодом, так что вы можете либо скачать исполняемый и запустить его, или построить его самостоятельно.

Клиент голосового помощника Windows имеет простой интерфейс, который позволяет настроить соединение с вашим ботом, просматривать текстовые разговоры, просматривать действия Bot-Framework в формате JSON и отображать адаптивные карты. Он также поддерживает использование пользовательских ключевых слов. Вы будете использовать этот клиент, чтобы поговорить с вашим ботом и получить голосовой ответ.

Прежде чем двигаться дальше, убедитесь, что микрофон и динамики включены и работают.

1. Перейдите в репозиторий GitHub для [клиента голосового помощника Windows.](https://github.com/Azure-Samples/Cognitive-Services-Voice-Assistant/blob/master/clients/csharp-wpf/README.md)
1. Следуйте инструкциям, предоставленным там либо
   * загрузить пакет с зипом, содержащий исполняемый для запуска, или
   * построить исполняемый самостоятельно, клонируя репозиторий и построив проект.

1. Запустите клиентское приложение и назначаем его.
1. Нажмите **Reconnect** и убедитесь, что вы видите сообщение **Нажмите кнопку микрофона, или введите, чтобы начать говорить с вашим ботом.**
1. Давайте проверим это. Нажмите кнопку микрофона и произнесите несколько слов на английском языке. Признанный текст будет отображаться по мере того, как вы говорите. Когда вы закончите говорить, бот ответит своим голосом, говоря "эхо", а затем признанные слова.
1. Вы также можете использовать текст для общения с ботом. Просто введите текст в нижней панели. 

### <a name="troubleshooting-errors-in-windows-voice-assistant-client"></a>Ошибки устранения неполадок в клиенте голосового помощника Windows

Если вы получили сообщение об ошибке в главном окне приложения, используйте эту таблицу для выявления и устранения ошибок:

| Error | Что следует сделать? |
|-------|----------------------|
|Ошибка аутентификацииНеспособностьа: Обновление WebSocket не удалось с ошибкой проверки подлинности (401). Проверьте правильное ключ подписки (или токен авторизации) и название региона| На странице «Настройки» приложения убедитесь, что вы правильно ввели ключ подписки на речь и его область.<br>Убедитесь, что ваш ключ речи и ключевой регион были введены правильно. |
|Ошибка подключенияОтказ: Соединение было закрыто удаленным хостом. Код ошибки: 1011. Детали ошибки: Мы не могли подключиться к боту перед отправкой сообщения | Убедитесь, что вы [проверили поле "Включить потоковую точку конечной точки"](#register-the-direct-line-speech-channel) и/или [переключите **веб-розетки** ](#enable-web-sockets) на On.<br>Убедитесь, что служба приложений Azure работает. Если это так, попробуйте перезапустить службу приложений.|
|Ошибка подключенияОтказ: Соединение было закрыто удаленным хостом. Код ошибки: 1011. Детали ошибки: Код статуса ответа не указывает на успех: 500 (InternalServerError)| Бот указал нейронный голос в поле вывода Activity [Speak,](https://github.com/microsoft/botframework-sdk/blob/master/specs/botframework-activity/botframework-activity.md#speak) но область Azure, связанная с ключом подписки Speech, не поддерживает нейронные голоса. Смотрите [стандартные и нейронные голоса](https://docs.microsoft.com/azure/cognitive-services/speech-service/regions#standard-and-neural-voices).|
|Ошибка подключенияОтказ: Соединение было закрыто удаленным хостом. Код ошибки: 1000. Детали ошибки: Превышено максимальное соединение паутины простоя (> 300000 мс)| Это ожидаемая ошибка, когда подключение к каналу остается открытым и неактивным в течение более пяти минут. |

Если ваша проблема не рассматривается в таблице, [см.](faq-voice-assistants.md)

### <a name="view-bot-activities"></a>Просмотр действий ботов

Каждый бот отправляет и получает сообщения **Activity.** В окне **входа в журнал активности** клиента голосового помощника Windows вы увидите журналы с отметками времени с каждым действием, которое клиент получил от бота. Вы также можете увидеть действия, которые клиент [`DialogServiceConnector.SendActivityAsync`](https://docs.microsoft.com/dotnet/api/microsoft.cognitiveservices.speech.dialog.dialogserviceconnector.sendactivityasync) послал боту с помощью метода. При выборе элемента журнала будут отображаться детали связанного действия как JSON.

Вот пример json деятельности клиент получил:

```json
{
    "attachments":[],
    "channelData":{
        "conversationalAiData":{
             "requestInfo":{
                 "interactionId":"8d5cb416-73c3-476b-95fd-9358cbfaebfa",
                 "version":"0.2"
             }
         }
    },
    "channelId":"directlinespeech",
    "conversation":{
        "id":"129ebffe-772b-47f0-9812-7c5bfd4aca79",
        "isGroup":false
    },
    "entities":[],
    "from":{
        "id":"SpeechEchoBotTutorial-BotRegistration"
    },
    "id":"89841b4d-46ce-42de-9960-4fe4070c70cc",
    "inputHint":"acceptingInput",
    "recipient":{
        "id":"129ebffe-772b-47f0-9812-7c5bfd4aca79|0000"
    },
    "replyToId":"67c823b4-4c7a-4828-9d6e-0b84fd052869",
    "serviceUrl":"urn:botframework:websocket:directlinespeech",
    "speak":"<speak version='1.0' xmlns='https://www.w3.org/2001/10/synthesis' xml:lang='en-US'><voice name='Microsoft Server Speech Text to Speech Voice (en-US, AriaRUS)'>Echo: Hello and welcome.</voice></speak>",
    "text":"Echo: Hello and welcome.",
    "timestamp":"2019-07-19T20:03:51.1939097Z",
    "type":"message"
}
```

Чтобы узнать больше о том, что возвращается в выходе JSON, [см.](https://github.com/microsoft/botframework-sdk/blob/master/specs/botframework-activity/botframework-activity.md) Для целей этого учебника, вы можете сосредоточиться на [текст](https://github.com/microsoft/botframework-sdk/blob/master/specs/botframework-activity/botframework-activity.md#text) и [говорить](https://github.com/microsoft/botframework-sdk/blob/master/specs/botframework-activity/botframework-activity.md#speak) поля.

### <a name="view-client-source-code-for-calls-to-the-speech-sdk"></a>Просмотр исходного кода клиента для звонков в Speech SDK

Клиент голосового помощника Windows использует пакет NuGet [Microsoft.CognitiveServices.Speech](https://www.nuget.org/packages/Microsoft.CognitiveServices.Speech/), который содержит речь SDK. Хорошим местом для начала рассмотрения примера кода является метод InitSpeechConnector() в файле, [`VoiceAssistantClient\MainWindow.xaml.cs`](https://github.com/Azure-Samples/Cognitive-Services-Voice-Assistant/blob/master/clients/csharp-wpf/VoiceAssistantClient/MainWindow.xaml.cs)который создает эти два объекта речи SDK:
- [`DialogServiceConfig`](https://docs.microsoft.com/dotnet/api/microsoft.cognitiveservices.speech.dialog.dialogserviceconfig)- Для настроек конфигурации (например, ключ подписки на речевую речь, ключевой регион)
- [`DialogServiceConnector`](https://docs.microsoft.com/dotnet/api/microsoft.cognitiveservices.speech.dialog.dialogserviceconnector.-ctor)- Управлять подключением канала и событиями подписки клиента для обработки признанных речевых и бот-ответов.

## <a name="add-custom-keyword-activation"></a>Добавление пользовательской активации ключевого слова

Speech SDK поддерживает активацию пользовательских ключевых слов. Подобно "Эй Cortana" для помощника Microsoft, вы можете написать приложение, которое будет постоянно слушать ключевое слово по вашему выбору. Имейте в виду, что ключевое слово может быть одним словом или многословной фразой.

> [!NOTE]
> Термин *ключевое слово* часто используется взаимозаменяемо с термином *слово "поразиться",* и вы можете увидеть оба используемых в документации Майкрософт.

Обнаружение ключевых слов выполняется в клиентском приложении. При использовании ключевого слова звук передается на канал Direct Line Speech только в случае обнаружения ключевого слова. Канал прямой линии речи включает в себя компонент, называемый *проверки ключевых слов (KWV),* который делает более сложную обработку в облаке, чтобы убедиться, что ключевое слово, которое вы выбрали, находится в начале аудиопотока. Если проверка ключевого слова увенчается успехом, канал будет общаться с ботом.

Выполните следующие действия, чтобы создать модель ключевых слов, настроить клиент-помощник Windows голос, чтобы использовать эту модель, и, наконец, проверить его с вашим ботом.

1. Следуйте этим инструкциям, чтобы [создать пользовательское ключевое слово с помощью службы речи](https://docs.microsoft.com/azure/cognitive-services/speech-service/speech-devices-sdk-create-kws).
2. Отстегните файл модели, который вы загрузили на предыдущем этапе. Он должен быть назван в честь вашего ключевого слова. Вы ищете файл с `kws.table`именем .
3. В клиенте голосового помощника Windows найдите меню **«Настройки»** (ищите значок передачви в правом верхнем правом положении). Найдите **путь файла модели** и `kws.table` введите полное имя пути для файла со ступени 2.
4. Убедитесь в том, чтобы проверить окно помечены **включен.** Вы должны увидеть это сообщение рядом с флажкой: "Будет слушать ключевое слово при следующем подключении". Если вы предоставили неправильный файл или недействительный путь, вы должны увидеть сообщение об ошибке.
5. Введите **клавишу подписки**на речь, **ключевой регион подписки,** а затем нажмите **OK,** чтобы закрыть меню **настроек.**
6. Нажмите **Reconnect**. Вы должны увидеть сообщение, которое гласит: "Новый разговор начался - введите, нажмите кнопку микрофона, или сказать ключевое слово". Приложение теперь постоянно слушает.
7. Говорите любую фразу, которая начинается с вашего ключевого слова. Например:**«Ваше ключевое слово»,** в какое время оно?». Вам не нужно делать паузу после произнесения ключевого слова. Когда закончите, происходят две вещи:
   * Вы увидите транскрипцию того, что вы говорили
   * Вскоре после этого вы услышите ответ бота
8. Продолжайте экспериментировать с тремя типами ввода, которые поддерживает ваш бот:
   * Набранный текст в нижней панели
   * Нажатие значка микрофона и разговорная речь
   * Говорить фразу, которая начинается с вашего ключевого слова

### <a name="view-the-source-code-that-enables-keyword"></a>Просмотр исходного кода, позволяющего использовать ключевое слово

В исходном коде клиента Голосовый помощник Windows, взгляните на эти файлы, чтобы просмотреть код, который используется для обнаружения ключевых слов:

1. [`VoiceAssistantClient\Models.cs`](https://github.com/Azure-Samples/Cognitive-Services-Voice-Assistant/blob/master/clients/csharp-wpf/VoiceAssistantClient/Models.cs)включает вызов к методу [`KeywordRecognitionModel.fromFile()`](https://docs.microsoft.com/javascript/api/microsoft-cognitiveservices-speech-sdk/keywordrecognitionmodel?view=azure-node-latest#fromfile-string-)Speech SDK, который используется для мгновенного воспроизведения модели из локального файла на диске.
1. [`VoiceAssistantClient\MainWindow.xaml.cs`](https://github.com/Azure-Samples/Cognitive-Services-Voice-Assistant/blob/master/clients/csharp-wpf/VoiceAssistantClient/MainWindow.xaml.cs)включает в себя вызов к [`DialogServiceConnector.StartKeywordRecognitionAsync()`](https://docs.microsoft.com/dotnet/api/microsoft.cognitiveservices.speech.dialog.dialogserviceconnector.startkeywordrecognitionasync)методу речи SDK , который активирует непрерывное обнаружение ключевых слов.

## <a name="optional-change-the-language-and-bot-voice"></a>(Необязательно) Изменение языка и голоса бота

Созданный вами бот будет слушать и отвечать на английском языке, с голосом текста в речи по умолчанию. Тем не менее, вы не ограничены в использовании английского языка или голоса по умолчанию. В этом разделе вы узнаете, как изменить язык, который ваш бот будет слушать и отвечать. Вы также узнаете, как выбрать другой голос для этого языка.

### <a name="change-the-language"></a>Изменение языка

Вы можете выбрать любой из языков, упомянутых в таблице [от речи к тексту.](language-support.md#speech-to-text) В приведенном ниже примере мы изменим язык на немецкий.

1. Откройте приложение Для клиента голосового помощника Windows, нажмите на кнопку настройки (уидная правая значок передачи) и введите `de-de` поле Language (это значение Locale, упомянутое в таблице от речи к [тексту).](language-support.md#speech-to-text) Это устанавливает распознаваемый язык, `en-us`переопределяя значение по умолчанию. Это также поручает каналу прямой линии речи использовать немецкий голос по умолчанию для ответа Bot.
2. Закройте страницу настроек и нажмите на кнопку Reconnect, чтобы установить новое соединение с эхо-ботом.
3. Нажмите на кнопку микрофона и произнесите фразу по-немецки. Вы увидите признанный текст и эхо-бот, отвечающий немецким голосом по умолчанию.

### <a name="change-the-default-bot-voice"></a>Изменение голоса бота по умолчанию

Выбор голоса текста в речи и управление произношением может быть сделано, если Bot указывает ответ в виде [языка разметки синтеза речи](speech-synthesis-markup.md) (SSML) вместо простого текста. Эхо-бот не использует SSML, но мы можем легко изменить код, чтобы сделать это. В приведенном ниже примере мы добавляем SSML в ответ на эхо-бот, так что немецкий голос Стефана Аполлона (мужской голос) будет использоваться вместо женского голоса по умолчанию. Смотрите список [стандартных голосов](language-support.md#standard-voices) и [нейронных голосов, поддерживаемых](language-support.md#neural-voices) для вашего языка.

1. Начнем с открытия `samples\csharp_dotnetcore\02.echo-bot\echo-bot.cs`.
2. Найдите эти две строки:
    ```csharp
    var replyText = $"Echo: {turnContext.Activity.Text}";
    await turnContext.SendActivityAsync(MessageFactory.Text(replyText, replyText), cancellationToken);
    ```
3. Замените их:
    ```csharp
    var replyText = $"Echo: {turnContext.Activity.Text}";
    var replySpeak = @"<speak version='1.0' xmlns='https://www.w3.org/2001/10/synthesis' xml:lang='de-DE'>
                    <voice name='Microsoft Server Speech Text to Speech Voice (de-DE, Stefan, Apollo)'>" +
                    $"{replyText}" + "</voice></speak>";
    await turnContext.SendActivityAsync(MessageFactory.Text(replyText, replySpeak), cancellationToken);
    ```
4. Создайте свое решение в Visual Studio и исправьте любые ошибки сборки.

Второй аргумент в методе 'MessageFactory.Text' устанавливает [поле говорить активности](https://github.com/Microsoft/botframework-sdk/blob/master/specs/botframework-activity/botframework-activity.md#speak) в ответе бота. С вышеуказанным изменением, оно было заменено от просто текста к SSML для того чтобы указать не-по умолчанию немецкий голос.

### <a name="redeploy-your-bot"></a>Передислокация бота

Теперь, когда вы внесли необходимые изменения в бот, следующим шагом будет переиздание в службу приложений Azure и опробовать его:

1. В окне Solution Explorer нажмите правой кнопкой мыши на проект **EchoBot** и выберите **Publish**.
2. Предыдущая конфигурация развертывания уже загружена по умолчанию. Просто нажмите **Опубликовать** рядом с **EchoBot20190805125647 - Веб Развертывание**.
3. **Сообщение Publish Succeeded** появится в окне вывода Visual Studio, а веб-страница запустят сообщение «Ваш бот готов!».
4. Откройте приложение Для клиента голосового помощника Windows, нажмите на кнопку настройки `de-de` (вверху справа значок передачи) и убедитесь, что у вас все еще есть в поле языка.
5. Следуйте инструкциям в [Run The Voice Assistant Client,](#run-the-windows-voice-assistant-client) чтобы восстановить связь с недавно развернутым ботом, говорить на новом языке и слышать ответ на этом языке новым голосом.

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы не собираетесь продолжать использовать эхо-бот, развернутый в этом учебнике, вы можете удалить его и все связанные с ним ресурсы Azure, просто удалив группу ресурсов Azure **SpeechEchoBotTutorial-ResourceGroup.**

1. С [портала Azure](https://portal.azure.com)нажмите на **группы ресурсов** из **навигации служб Azure.**
2. Найти группу ресурсов под названием: **SpeechEchoBotTutorial-ResourceGroup**. Нажмите на три точки (...).
3. Выберите **Удалить группу ресурсов**.

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Создайте собственное клиентское приложение с помощью Речевого SDK](quickstart-voice-assistant-csharp-uwp.md)

## <a name="see-also"></a>См. также раздел

* Развертывание в [ближайшем регионе Azure,](https://azure.microsoft.com/global-infrastructure/locations/) чтобы увидеть улучшение времени отклика бота
* Развертывание в [регионе Azure, поддерживающем высококачественные нейронные голоса TTS](https://docs.microsoft.com/azure/cognitive-services/speech-service/regions#standard-and-neural-voices)
* Цены, связанные с каналом "Прямая линия":
  * [Расценки службы ботов](https://azure.microsoft.com/pricing/details/bot-service/)
  * [Речевой сервис](https://azure.microsoft.com/pricing/details/cognitive-services/speech-services/)
* Создание и развертывание собственного бота с поддержкой голоса:
  * Создайте [бот-рамки.](https://dev.botframework.com/) Зарегистрируйте его на [канале Direct Line Speech](https://docs.microsoft.com/azure/bot-service/bot-service-channel-connect-directlinespeech?view=azure-bot-service-4.0) и [настройте бот анабизировать для голосового](https://docs.microsoft.com/azure/bot-service/directline-speech-bot?view=azure-bot-service-4.0)
  * Изучите [существующие решения Bot-Framework:](https://microsoft.github.io/botframework-solutions/index)Создайте [виртуального помощника](https://microsoft.github.io/botframework-solutions/overview/virtual-assistant-solution/) и [расширьте его до прямой прямой речи](https://microsoft.github.io/botframework-solutions/clients-and-channels/tutorials/enable-speech/1-intro/)
