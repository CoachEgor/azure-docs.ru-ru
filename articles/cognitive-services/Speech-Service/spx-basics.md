---
title: Общие сведения об интерфейсе командной строки службы "Речь"
titleSuffix: Azure Cognitive Services
description: Узнайте, как использовать программу командной строки для работы со службой "Речь" без кода и с минимальной настройкой.
services: cognitive-services
author: trevorbye
manager: nitinme
ms.service: cognitive-services
ms.subservice: speech-service
ms.topic: quickstart
ms.date: 04/04/2020
ms.author: trbye
ms.openlocfilehash: 7ca290b7b7df9e4e03aec78b611361ba52942523
ms.sourcegitcommit: 7863fcea618b0342b7c91ae345aa099114205b03
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/03/2020
ms.locfileid: "93286687"
---
# <a name="learn-the-basics-of-the-speech-cli"></a>Основные сведения об интерфейсе командной строки службы "Речь"

В этой статье вы ознакомитесь с основными вариантами использования интерфейса командной строки службы "Речь" (программы, которая используется для работы с этой службой) без написания кода. Вы можете легко узнать, подходит ли служба "Речь" для вашего варианта использования, быстро протестировав ее основные возможности без создания среды разработки и написания кода. Кроме того, интерфейс командной строки службы "Речь" готов к использованию в рабочей среде и может применяться для автоматизации простых рабочих процессов в службе "Речь" с помощью `.bat` или скриптов оболочки.

[!INCLUDE [](includes/spx-setup.md)]

## <a name="basic-usage"></a>Базовое использование

В этом разделе описано несколько основных команд SPX, которые зачастую удобно использовать для первого тестирования и экспериментов. Начните работу с просмотра справки, встроенной в инструмент, выполнив следующую команду.

```shell
spx
```

Обратите внимание на **рекомендуемые** разделы справки, указанные справа от параметров команды. Вы можете ввести эти команды, чтобы получить подробную справку по подкомандам.

Вы также можете выполнить поиск по ключевому слову в разделах справки. Так, можно ввести следующую команду, чтобы просмотреть список примеров использования интерфейса командной строки службы "Речь":

```shell
spx help find --topics "examples"
```

Введите следующую команду, чтобы просмотреть параметры команды распознавания:

```shell
spx help recognize
```

Теперь воспользуйтесь службой "Речь", чтобы выполнить несколько операций распознавания речи с микрофона по умолчанию, выполнив следующую команду.

```shell
spx recognize --microphone
```

После ввода этой команды SPX начнет прослушивать звук на текущем активном устройстве ввода и остановится при нажатии клавиши `ENTER`. Затем записанная речь перевод распознается и преобразуется в текст в выходных данных консоли. Синтез текста из речи также легко выполнить с помощью интерфейса командной строки службы "Речь". 

Выполнение следующей команды приведет к использованию введенного текста в качестве входных данных и выводу синтезированной речи на текущее активное устройство вывода.

```shell
spx synthesize --text "Testing synthesis using the Speech CLI" --speakers
```

С помощью интерфейса командной строки службы "Речь" помимо распознавания и синтеза речи, можно также выполнить перевод речи. Как и в приведенной выше команде распознавания речи, выполните следующую команду, чтобы записать звук с микрофона по умолчанию и перевести полученный текст на целевой язык.

```shell
spx translate --microphone --source en-US --target ru-RU --output file C:\some\file\path\russian_translation.txt
```

В этой команде указываются оба языка: исходный (язык, **с** которого выполняется перевод) и целевой (язык, **на** который переводится текст). При использовании аргумента `--microphone` звук будет прослушиваться на текущем активном устройстве ввода, а при нажатии клавиши `ENTER` этот процесс остановится. Выходные данные — это переведенный на целевой язык текст, записанный в текстовый файл.

> [!NOTE]
> Список всех поддерживаемых языков с соответствующими кодами языков см. в [статье о языках и региональных параметрах](language-support.md).

### <a name="configuration-files-in-the-datastore"></a>Файлы конфигурации в хранилище данных

Интерфейс командной строки службы "Речь" определяется файлами конфигурации, на которые можно ссылаться в вызовах интерфейса командной строки службы "Речь" с помощью символа "@".
Интерфейс командной строки службы "Речь" сохраняет новый параметр в новом подкаталоге `./spx/data`, который создается в текущей рабочей папке.
При поиске значения конфигурации интерфейс командной строки службы "Речь" выполняет поиск в текущем рабочем каталоге, затем в хранилище данных по пути `./spx/data`, а затем в других хранилищах данных, в том числе в итоговом хранилище данных только для чтения в двоичном каталоге `spx`.
Ранее вы использовали хранилище данных для сохранения значений `@key` и `@region`, поэтому не нужно указывать их при каждом вызове командной строки.
Файлы конфигурации можно также использовать для хранения собственных параметров конфигурации или даже для передачи URL-адресов или другого динамического содержимого, созданного во время выполнения.

В этом разделе показано, как использовать файл конфигурации в локальном хранилище данных для хранения и получения параметров команды с помощью `spx config`, а также сохранения выходных данных из CLI службы "Речь", используя параметр `--output`.

В следующем примере очищается файл конфигурации `@my.defaults`, в файле добавляются пары "ключ-значение" для **key** и **region** , а также используется конфигурация при вызове `spx recognize`.

```shell
spx config @my.defaults --clear
spx config @my.defaults --add key 000072626F6E20697320636F6F6C0000
spx config @my.defaults --add region westus

spx config @my.defaults

spx recognize --nodefaults @my.defaults --file hello.wav
```

Динамическое содержимое также можно записать в файл конфигурации. Например, следующая команда создает пользовательскую модель речи и сохраняет URL-адрес новой модели в файле конфигурации. Следующая команда ожидает, пока модель по этому URL-адресу не будет готова к использованию, прежде чем вернуться.

```shell
spx csr model create --name "Example 4" --datasets @my.datasets.txt --output url @my.model.txt
spx csr model status --model @my.model.txt --wait
```

В следующем примере два URL-адреса записываются в файл конфигурации `@my.datasets.txt`.
В этом сценарии `--output` может включать дополнительное ключевое слово **add** , чтобы создать файл конфигурации или добавить к имеющемуся.


```shell
spx csr dataset create --name "LM" --kind Language --content https://crbn.us/data.txt --output url @my.datasets.txt
spx csr dataset create --name "AM" --kind Acoustic --content https://crbn.us/audio.zip --output add url @my.datasets.txt

spx config @my.datasets.txt
```

Для получения дополнительных сведений о файлах хранилища данных, включая использование файлов конфигурации по умолчанию (`@spx.default`, `@default.config` и `@*.default.config` для параметров по умолчанию конкретных команд), введите следующую команду:

```shell
spx help advanced setup
```

## <a name="batch-operations"></a>Пакетные операции

Команды в предыдущем разделе прекрасно подходят для быстрого ознакомления с работой службы "Речь". Однако чтобы определить, подходит ли она для вашего варианта использования, вам, скорее всего, потребуется выполнить пакетные операции по ряду уже имеющихся входных данных, чтобы увидеть, как служба справляется с различными сценариями. В этом разделе показано, как:

* выполнить пакетное распознавание речи в каталоге звуковых файлов;
* выполнить итерацию по файлу `.tsv` и запустить пакетный синтез текста из речи.

## <a name="batch-speech-recognition"></a>Пакетное распознавание речи

Если у вас есть каталог звуковых файлов, с помощью интерфейса командной строки службы "Речь" можно легко и быстро выполнить пакетное распознавание речи. Просто выполните следующую команду, указав каталог с помощью команды `--files`. В этом примере вы добавляете `\*.wav` к каталогу для распознавания всех имеющихся в нем файлов `.wav`. Кроме того, укажите аргумент `--threads`, чтобы запустить распознавание 10 параллельных потоков.

> [!NOTE]
> Аргумент `--threads` можно также использовать в следующем разделе для команд `spx synthesize`. Доступные потоки будут зависеть от ЦП и его текущей загрузки в процентах.

```shell
spx recognize --files C:\your_wav_file_dir\*.wav --output file C:\output_dir\speech_output.tsv --threads 10
```

Распознанная речь записывается в `speech_output.tsv` с помощью аргумента `--output file`. Ниже приведен пример файла структуры выходного файла.

```output
audio.input.id    recognizer.session.started.sessionid    recognizer.recognized.result.text
sample_1    07baa2f8d9fd4fbcb9faea451ce05475    A sample wave file.
sample_2    8f9b378f6d0b42f99522f1173492f013    Sample text synthesized.
```

## <a name="batch-text-to-speech-synthesis"></a>Пакетный синтез речи из текста

Самый простой способ выполнить пакетный синтез речи из текста — создать новый файл `.tsv` (с разделителями-табуляторами) и использовать команду `--foreach` в интерфейсе командной строки службы "Речь". Обратите внимание на следующий файл `text_synthesis.tsv`:

```output
audio.output    text
C:\batch_wav_output\wav_1.wav    Sample text to synthesize.
C:\batch_wav_output\wav_2.wav    Using the Speech CLI to run batch-synthesis.
C:\batch_wav_output\wav_3.wav    Some more text to test capabilities.
```

 Затем выполните команду, чтобы указать `text_synthesis.tsv`, выполните синтез для каждого поля `text` и запишите результат по соответствующему пути `audio.output` в виде файла `.wav`. 

```shell
spx synthesize --foreach in @C:\your\path\to\text_synthesis.tsv
```

Эта команда эквивалентна запуску **`spx synthesize --text Sample text to synthesize --audio output C:\batch_wav_output\wav_1.wav`для каждой** записи в файле `.tsv`. Обратите внимание на несколько моментов.

* Заголовки столбцов (`audio.output` и `text`) соответствуют аргументам командной строки `--audio output` и `--text` соответственно. Аргументы командной строки, содержащие несколько частей, например `--audio output`, должны быть отформатированы в файле без пробелов, начальных дефисов и точек, разделяющих строки, например `audio.output`. Все остальные имеющиеся аргументы командной строки можно добавить в файл в виде дополнительных столбцов с соблюдением данной структуры.
* Если файл отформатирован таким образом, для `--foreach` не требуется передавать дополнительные аргументы.
* Обязательно отделите каждое значение в `.tsv` **табуляцией**.

Однако заголовки столбцов вашего файла `.tsv` могут **не соответствовать** аргументам командной строки, как в следующем примере.

```output
wav_path    str_text
C:\batch_wav_output\wav_1.wav    Sample text to synthesize.
C:\batch_wav_output\wav_2.wav    Using the Speech CLI to run batch-synthesis.
C:\batch_wav_output\wav_3.wav    Some more text to test capabilities.
```

Эти имена полей можно переопределить надлежащим образом, используя следующий синтаксис в вызове `--foreach`. Это тот же вызов, что и выше.

```shell
spx synthesize --foreach audio.output;text in @C:\your\path\to\text_synthesis.tsv
```

## <a name="next-steps"></a>Дальнейшие действия

* Изучите краткое руководство по [распознаванию](get-started-speech-to-text.md?pivots=programmer-tool-spx) или [синтезу](get-started-text-to-speech.md?pivots=programmer-tool-spx) речи с помощью интерфейса командной строки службы "Речь".
