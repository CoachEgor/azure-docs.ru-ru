---
title: Ссылка на API речи к тексту (REST) - Речевой сервис
titleSuffix: Azure Cognitive Services
description: Узнайте, как использовать API РЕПЕТ РАО «Речи к тексту». Из этой статьи вы узнаете о вариантах авторизации, параметрах запроса, структуре запроса и получении ответа.
services: cognitive-services
author: IEvangelist
manager: nitinme
ms.service: cognitive-services
ms.subservice: speech-service
ms.topic: conceptual
ms.date: 03/16/2020
ms.author: dapine
ms.openlocfilehash: 759ea697e4093da5bfc1c082c886c6dfda636f42
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79474804"
---
# <a name="speech-to-text-rest-api"></a>REST API преобразования речи в текст;

В качестве альтернативы [Speech SDK](speech-sdk.md)служба Speech позволяет конвертировать речевой текст с помощью REST API. Каждая доступная конечная точка связана с регионом. Приложению нужен ключ подписки для конечной точки, которую вы планируете использовать. REST API очень ограничен, и он должен использоваться только в тех случаях, когда [речь SDK](speech-sdk.md) не может.

Прежде чем использовать РЕПЕТРЕЯ от речи к тексту, поймите:

* Запросы, которые используют REST API и передают аудио напрямую, могут содержать только до 60 секунд звука.
* REST API преобразования речи в текст возвращает только окончательные результаты. Частичные результаты не предоставляются.

Если отправка более длинного аудио является обязательным требованием для вашего приложения, рассмотрите возможность использования [Речевого SDK](speech-sdk.md) или файло-наосноветельного REST API, например, [пакетной транскрипции.](batch-transcription.md)

[!INCLUDE [](../../../includes/cognitive-services-speech-service-rest-auth.md)]

## <a name="regions-and-endpoints"></a>Регионы и конечные точки

Конечная точка для REST API имеет такой формат:

```
https://<REGION_IDENTIFIER>.stt.speech.microsoft.com/speech/recognition/conversation/cognitiveservices/v1
```

Замените `<REGION_IDENTIFIER>` идентификатор, соответствующий области подписки из этой таблицы:

[!INCLUDE [](../../../includes/cognitive-services-speech-service-region-identifier.md)]

> [!NOTE]
> К URL-адресу нужно добавить параметр языка, чтобы не возникало сообщение об ошибке HTTP 4xx. Например, выбор английского языка (США) с использованием конечной точки "Западная часть США" будет выглядеть так: `https://westus.stt.speech.microsoft.com/speech/recognition/conversation/cognitiveservices/v1?language=en-US`.

## <a name="query-parameters"></a>Параметры запроса

Следующие параметры можно включать в строку запроса REST.

| Параметр | Описание | Обязательный или необязательный |
|-----------|-------------|---------------------|
| `language` | Определяет распознаваемую устную речь. Посмотреть [поддерживаемые языки](language-support.md#speech-to-text). | Обязательно |
| `format` | Указывает формат результатов. Допустимые значения: `simple` и `detailed`. К простым результатам относятся `RecognitionStatus`, `DisplayText`, `Offset` и `Duration`. К подробным ответам относятся сложные результаты со значениями достоверности и четыре различных представления. Значение по умолчанию равно `simple`. | Необязательный |
| `profanity` | Указывает, как обрабатывать ненормативную лексику в результатах распознавания. Принятые `masked`значения, которые заменяют ненормативную лексику звездочками, `removed`которые удаляют всю ненормативную лексику из результата, или, `raw`которая включает в себя ненормативную лексику в результате. Значение по умолчанию равно `masked`. | Необязательный |
| `cid` | При использовании [портала Custom Speech](how-to-custom-speech.md) для создания пользовательских моделей можно использовать пользовательские модели через **идентификатор Endpoint,** найденный на странице **развертывания.** **Идентификатор Endpoint** в `cid` качестве аргумента к параметру строки запроса. | Необязательный |

## <a name="request-headers"></a>Заголовки запросов

В этой таблице перечислены обязательные и необязательные заголовки для запросов на преобразование речи в текст.

|Заголовок| Описание | Обязательный или необязательный |
|------|-------------|---------------------|
| `Ocp-Apim-Subscription-Key` | Ключ подписки службы "Речь". | Обязательный, если не предоставлен заголовок `Authorization`. |
| `Authorization` | Маркеру авторизации предшествует слово `Bearer`. Дополнительные сведения см. в разделе [Authenticate to the Speech API](#authentication) (Аутентификация в API речи). | Обязательный, если не предоставлен заголовок `Ocp-Apim-Subscription-Key`. |
| `Content-type` | Описывает формат и кодек предоставленных аудиоданных. Допустимые значения: `audio/wav; codecs=audio/pcm; samplerate=16000` и `audio/ogg; codecs=opus`. | Обязательно |
| `Transfer-Encoding` | Указывает, что отправляются фрагментированные аудиоданные, а не один файл. Используйте этот заголовок только при фрагментации аудиоданных. | Необязательный |
| `Expect` | Если используется блочная передача (в предыдущем параметре задано chunked), отправьте `Expect: 100-continue`. Служба "Речь" подтверждает первоначальный запрос и ожидает дополнительные данные.| Обязательный, если отправляются фрагментированные аудиоданные. |
| `Accept` | Если указан, этот заголовок должен иметь значение `application/json`. Служба речи предоставляет результаты в JSON. Некоторые платформы запросов предоставляют несовместимое значение по умолчанию. Это хорошая практика, `Accept`чтобы всегда включать . | Необязательный, но рекомендуется включать. |

## <a name="audio-formats"></a>Форматы аудио

Аудио отправляется в тексте HTTP-запроса `POST`. Аудиопоток должен иметь один из форматов, приведенных в следующей таблице:

| Формат | Кодек | Bitrate | Частота выборки  |
|--------|-------|---------|--------------|
| WAV    | PCM   | 16-разрядный  | 16 кГц, моно |
| OGG    | OPUS  | 16-разрядный  | 16 кГц, моно |

>[!NOTE]
>Вышеуказанные форматы поддерживаются через REST API и WebSocket в службе speech. [Речь SDK](speech-sdk.md) в настоящее время поддерживает формат WAV с PCM кодек, а также [другие форматы.](how-to-use-codec-compressed-audio-input-streams.md)

## <a name="sample-request"></a>Пример запроса

Приведенный ниже пример включает имя узла и обязательные заголовки. Важно отметить, что служба также ожидает передачи аудиоданных, которые не включены в этом примере. Как упоминалось ранее, фрагментация рекомендуется, но не обязательна.

```HTTP
POST speech/recognition/conversation/cognitiveservices/v1?language=en-US&format=detailed HTTP/1.1
Accept: application/json;text/xml
Content-Type: audio/wav; codecs=audio/pcm; samplerate=16000
Ocp-Apim-Subscription-Key: YOUR_SUBSCRIPTION_KEY
Host: westus.stt.speech.microsoft.com
Transfer-Encoding: chunked
Expect: 100-continue
```

## <a name="http-status-codes"></a>Коды состояния HTTP

Код состояния HTTP для каждого ответа указывает на успешное выполнение или возникновение распространенных ошибок.

| HTTP status code (Код состояния HTTP) | Описание | Возможная причина |
|------------------|-------------|-----------------|
| `100` | Continue | Первоначальный запрос принят. Перейдите к отправке данных, которые остались. (Используется с ломкой передачи) |
| `200` | OK | Запрос выполнен успешно; текст ответа представляет собой объект JSON. |
| `400` | Недопустимый запрос | Языковой код не предусмотрен, не поддерживается язык, недействительный аудио файл и т.д. |
| `401` | Не авторизовано | Ключ подписки или маркер авторизации является недопустимым в указанном регионе, или недопустимая конечная точка. |
| `403` | Запрещено | Отсутствует ключ подписки или маркер авторизации. |

## <a name="chunked-transfer"></a>Блочная передача

Chunked передачи (`Transfer-Encoding: chunked`) может помочь уменьшить задержку распознавания. Это позволяет службе speech начать обработку аудиофайла во время его передачи. REST API не поддерживает частичные или промежуточные результаты.

Этот пример кода показывает, как отправлять фрагментированное аудио. Только первый фрагмент данных должен содержать заголовок звукового файла. `request`является `HttpWebRequest` объектом, подключенным к соответствующей конечной точке REST. `audioFile` — путь к звуковому файлу на диске.

```csharp
var request = (HttpWebRequest)HttpWebRequest.Create(requestUri);
request.SendChunked = true;
request.Accept = @"application/json;text/xml";
request.Method = "POST";
request.ProtocolVersion = HttpVersion.Version11;
request.Host = host;
request.ContentType = @"audio/wav; codecs=audio/pcm; samplerate=16000";
request.Headers["Ocp-Apim-Subscription-Key"] = "YOUR_SUBSCRIPTION_KEY";
request.AllowWriteStreamBuffering = false;

using (var fs = new FileStream(audioFile, FileMode.Open, FileAccess.Read))
{
    // Open a request stream and write 1024 byte chunks in the stream one at a time.
    byte[] buffer = null;
    int bytesRead = 0;
    using (var requestStream = request.GetRequestStream())
    {
        // Read 1024 raw bytes from the input audio file.
        buffer = new Byte[checked((uint)Math.Min(1024, (int)fs.Length))];
        while ((bytesRead = fs.Read(buffer, 0, buffer.Length)) != 0)
        {
            requestStream.Write(buffer, 0, bytesRead);
        }

        requestStream.Flush();
    }
}
```

## <a name="response-parameters"></a>Параметры ответа

Результаты предоставляются в формате JSON. Формат `simple` включает эти поля верхнего уровня.

| Параметр | Описание  |
|-----------|--------------|
|`RecognitionStatus`|Состояние, например, `Success` в случае успешного распознавания. Ознакомьтесь со следующей таблицей.|
|`DisplayText`|Признанный текст после капитализации, пунктуации, обратной нормализации текста (преобразование разговорного текста в более короткие формы, такие как 200 для "двухсот" или "Доктор Смит" для "доктор Смит"), и ненормативной лексики маскировки. Появляется только в случае успешного распознавания.|
|`Offset`|Время (в единицах 100 нс), с которого в звуковом потоке начинается распознанная речь.|
|`Duration`|Длительность (в единицах 100 нс) распознанной речи в звуковом потоке.|

Поле `RecognitionStatus` может содержать следующие значения:

| Состояние | Описание |
|--------|-------------|
| `Success` | Речь распознана, и присутствует поле `DisplayText`. |
| `NoMatch` | В аудиопотоке был обнаружена речь, но не были сопоставлены слова в целевом языке. Обычно означает, что язык распознавания — это не тот язык, на котором разговаривает пользователь. |
| `InitialSilenceTimeout` | Начало аудиопотока содержит только тишину, и время ожидания на появление речи в службе истекло. |
| `BabbleTimeout` | Начало аудиопотока содержит только шум, и время ожидания на появление речи в службе истекло. |
| `Error` | Служба распознавания обнаружила внутреннюю ошибку и не может продолжить работу. Повторите попытку, если это возможно. |

> [!NOTE]
> Если звуковой файл содержит только ненормативную лексику, а параметр запроса `profanity` имеет значение `remove`, служба не возвращает результат распознавания речи.

Формат `detailed` включает в себя `simple` те же `NBest`данные, что и формат, а также список альтернативных интерпретаций того же результата распознавания. Эти результаты ранжируются с наиболее вероятной до наименее вероятной. Первая запись совпадает с основным результатом распознавания.  При использовании формата `detailed` параметр `DisplayText` указывается как `Display` для каждого результата в списке `NBest`.

Каждый объект в списке `NBest` включает:

| Параметр | Описание |
|-----------|-------------|
| `Confidence` | Оценка достоверности записи, от 0,0 (недостоверно) до 1,0 (полная достоверность) |
| `Lexical` | Лексическая форма распознанного текста: конкретные распознанные слова. |
| `ITN` | Форма распознанного текста после обратной нормализации ("каноническая" форма) с номерами телефонов, числами, сокращениями ("профессор Преображенский" до "проф. Преображенский") и другими выполненными преобразованиями. |
| `MaskedITN` | Форма ITN с применением маскировки ненормативной лексики, если запрашивалась. |
| `Display` | Отображаемая форма распознанного текста с расстановкой знаков препинания и прописных букв. Этот параметр совпадает с параметром `DisplayText`, если указан формат `simple`. |

## <a name="sample-responses"></a>Образцы ответов

Типичный ответ `simple` на признание:

```json
{
  "RecognitionStatus": "Success",
  "DisplayText": "Remind me to buy 5 pencils.",
  "Offset": "1236645672289",
  "Duration": "1236645672289"
}
```

Типичный ответ `detailed` на признание:

```json
{
  "RecognitionStatus": "Success",
  "Offset": "1236645672289",
  "Duration": "1236645672289",
  "NBest": [
      {
        "Confidence" : "0.87",
        "Lexical" : "remind me to buy five pencils",
        "ITN" : "remind me to buy 5 pencils",
        "MaskedITN" : "remind me to buy 5 pencils",
        "Display" : "Remind me to buy 5 pencils.",
      },
      {
        "Confidence" : "0.54",
        "Lexical" : "rewind me to buy five pencils",
        "ITN" : "rewind me to buy 5 pencils",
        "MaskedITN" : "rewind me to buy 5 pencils",
        "Display" : "Rewind me to buy 5 pencils.",
      }
  ]
}
```

## <a name="next-steps"></a>Дальнейшие действия

- [Пробная версия Cognitive Services](https://azure.microsoft.com/try/cognitive-services/)
- [Настройка акустических моделей](how-to-customize-acoustic-models.md)
- [Настройка языковых моделей](how-to-customize-language-model.md)
