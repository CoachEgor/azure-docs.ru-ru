---
title: Справочник по API для преобразования речи в текст (RESTFUL) — служба речи
titleSuffix: Azure Cognitive Services
description: Узнайте, как использовать REST API преобразования речи в текст. Из этой статьи вы узнаете о вариантах авторизации, параметрах запроса, структуре запроса и получении ответа.
services: cognitive-services
author: erhopf
manager: nitinme
ms.service: cognitive-services
ms.subservice: speech-service
ms.topic: conceptual
ms.date: 07/05/2019
ms.author: erhopf
ms.openlocfilehash: 6324c00d9b85a13ef6e69185e3b380b20f761f3b
ms.sourcegitcommit: 7c4de3e22b8e9d71c579f31cbfcea9f22d43721a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/26/2019
ms.locfileid: "68552963"
---
# <a name="speech-to-text-rest-api"></a>REST API преобразования речи в текст;

В качестве альтернативы речевому [пакету SDK](speech-sdk.md)службы речи позволяют преобразовывать речь в текст с помощью REST API. Каждая доступная конечная точка связана с регионом. Приложению нужен ключ подписки для конечной точки, которую вы планируете использовать.

Прежде чем использовать REST API преобразования речи в текст, изучите следующие сведения:
* Запросы, использующие REST API, могут содержать только 10 секунд записанного звука.
* REST API преобразования речи в текст возвращает только окончательные результаты. Частичные результаты не предоставляются.

Если в вашем приложении требуется отправлять более длинные аудиозаписи, используйте [Speech SDK](speech-sdk.md) или [пакетное транскрибирование](batch-transcription.md).

[!INCLUDE [](../../../includes/cognitive-services-speech-service-rest-auth.md)]

## <a name="regions-and-endpoints"></a>Регионы и конечные точки

Для транскрибирования речи в текст с помощью REST API поддерживаются следующие регионы. Выберите конечную точку, которая соответствует региону подписки.

[!INCLUDE [](../../../includes/cognitive-services-speech-service-endpoints-speech-to-text.md)]

## <a name="query-parameters"></a>Параметры запроса

Следующие параметры можно включать в строку запроса REST.

| Параметр | Описание | Обязательный или необязательный |
|-----------|-------------|---------------------|
| `language` | Определяет распознаваемую устную речь. См. сведения о [поддерживаемых языках](language-support.md#speech-to-text). | Обязательное значение |
| `format` | Указывает формат результатов. Допустимые значения: `simple` и `detailed`. К простым результатам относятся `RecognitionStatus`, `DisplayText`, `Offset` и `Duration`. К подробным ответам относятся сложные результаты со значениями достоверности и четыре различных представления. Значение по умолчанию — `simple`. | Необязательный |
| `profanity` | Указывает, как обрабатывать ненормативную лексику в результатах распознавания. Допустимые значения: `masked` — заменяет ненормативную лексику звездочками, `removed` — удаляет всю ненормативную лексику из результата, `raw` — включает ненормативную лексику в результат. Значение по умолчанию — `masked`. | Необязательный |

## <a name="request-headers"></a>Заголовки запросов

В этой таблице перечислены обязательные и необязательные заголовки для запросов на преобразование речи в текст.

|Header| Описание | Обязательный или необязательный |
|------|-------------|---------------------|
| `Ocp-Apim-Subscription-Key` | Ключ подписки на речевые службы. | Обязательный, если не предоставлен заголовок `Authorization`. |
| `Authorization` | Маркеру авторизации предшествует слово `Bearer`. Дополнительные сведения см. в разделе [Authenticate to the Speech API](#authentication) (Аутентификация в API речи). | Обязательный, если не предоставлен заголовок `Ocp-Apim-Subscription-Key`. |
| `Content-type` | Описывает формат и кодек предоставленных аудиоданных. Допустимые значения: `audio/wav; codecs=audio/pcm; samplerate=16000` и `audio/ogg; codecs=opus`. | Обязательное значение |
| `Transfer-Encoding` | Указывает, что отправляются фрагментированные аудиоданные, а не один файл. Используйте этот заголовок только при фрагментации аудиоданных. | Необязательный |
| `Expect` | Если используется блочная передача (в предыдущем параметре задано chunked), отправьте `Expect: 100-continue`. Речевые службы подтверждают первоначальный запрос и ожидают дополнительные данные.| Обязательный, если отправляются фрагментированные аудиоданные. |
| `Accept` | Если указан, этот заголовок должен иметь значение `application/json`. Службы речи предоставляют результаты в формате JSON. Некоторые платформы веб-запроса предоставляют несовместимое значение по умолчанию, если оно не указано, поэтому рекомендуется всегда включать `Accept`. | Необязательный, но рекомендуется включать. |

## <a name="audio-formats"></a>Форматы аудио

Аудио отправляется в тексте HTTP-запроса `POST`. Аудиопоток должен иметь один из форматов, приведенных в следующей таблице:

| Формат | Кодек | Bitrate | Частота выборки |
|--------|-------|---------|-------------|
| WAV | PCM | 16-разрядный | 16 кГц, моно |
| OGG | OPUS | 16-разрядный | 16 кГц, моно |

>[!NOTE]
>Приведенные выше форматы поддерживаются с помощью REST API и WebSocket в службах речи. [Пакет SDK службы "Речь"](speech-sdk.md) в настоящее время поддерживает только формат WAV кодека PCM.

## <a name="sample-request"></a>Пример запроса

Это типичный HTTP-запрос. Приведенный ниже пример включает имя узла и обязательные заголовки. Важно отметить, что служба также ожидает передачи аудиоданных, которые не включены в этом примере. Как упоминалось ранее, фрагментация рекомендуется, но не обязательна.

```HTTP
POST speech/recognition/conversation/cognitiveservices/v1?language=en-US&format=detailed HTTP/1.1
Accept: application/json;text/xml
Content-Type: audio/wav; codecs=audio/pcm; samplerate=16000
Ocp-Apim-Subscription-Key: YOUR_SUBSCRIPTION_KEY
Host: westus.stt.speech.microsoft.com
Transfer-Encoding: chunked
Expect: 100-continue
```

## <a name="http-status-codes"></a>Коды состояния HTTP

Код состояния HTTP для каждого ответа указывает на успешное выполнение или возникновение распространенных ошибок.

| HTTP status code (Код состояния HTTP) | Описание | Возможная причина |
|------------------|-------------|-----------------|
| 100 | Далее | Первоначальный запрос принят. Перейдите к отправке данных, которые остались. (Используется в случае блочной передачи.) |
| 200 | OK | Запрос выполнен успешно; текст ответа представляет собой объект JSON. |
| 400 | Ошибочный запрос | Код языка не указан или не поддерживается; недопустимый звуковой файл. |
| 401 | Неавторизованный | Ключ подписки или маркер авторизации является недопустимым в указанном регионе, или недопустимая конечная точка. |
| 403 | Запрещено | Отсутствует ключ подписки или маркер авторизации. |

## <a name="chunked-transfer"></a>Блочная передача

Поблочное перемещение`Transfer-Encoding: chunked`() может помочь снизить задержку при распознавании, поскольку позволяет речевым службам начать обработку звукового файла во время передачи. REST API не поддерживает частичные или промежуточные результаты. Этот параметр предназначен исключительно для повышения скорости реагирования.

Этот пример кода показывает, как отправлять фрагментированное аудио. Только первый фрагмент данных должен содержать заголовок звукового файла. `request` — это объект HTTPWebRequest, подключенный к соответствующей конечной точке REST. `audioFile` — путь к звуковому файлу на диске.

```csharp

    HttpWebRequest request = null;
    request = (HttpWebRequest)HttpWebRequest.Create(requestUri);
    request.SendChunked = true;
    request.Accept = @"application/json;text/xml";
    request.Method = "POST";
    request.ProtocolVersion = HttpVersion.Version11;
    request.Host = host;
    request.ContentType = @"audio/wav; codecs=audio/pcm; samplerate=16000";
    request.Headers["Ocp-Apim-Subscription-Key"] = args[1];
    request.AllowWriteStreamBuffering = false;

using (fs = new FileStream(audioFile, FileMode.Open, FileAccess.Read))
{
    /*
    * Open a request stream and write 1024 byte chunks in the stream one at a time.
    */
    byte[] buffer = null;
    int bytesRead = 0;
    using (Stream requestStream = request.GetRequestStream())
    {
        /*
        * Read 1024 raw bytes from the input audio file.
        */
        buffer = new Byte[checked((uint)Math.Min(1024, (int)fs.Length))];
        while ((bytesRead = fs.Read(buffer, 0, buffer.Length)) != 0)
        {
            requestStream.Write(buffer, 0, bytesRead);
        }

        // Flush
        requestStream.Flush();
    }
}
```

## <a name="response-parameters"></a>Параметры ответа

Результаты предоставляются в формате JSON. Формат `simple` включает эти поля верхнего уровня.

| Параметр | Описание  |
|-----------|--------------|
|`RecognitionStatus`|Состояние, например, `Success` в случае успешного распознавания. Ознакомьтесь со следующей таблицей.|
|`DisplayText`|Распознанный текст после расстановки прописных букв, знаков препинания, обратной нормализации текста (преобразование произносимого текста в более короткие формы, например 200 вместо "двести" или "проф. Преображенский" вместо "профессор Преображенский") и маскировки ненормативной лексики. Появляется только в случае успешного распознавания.|
|`Offset`|Время (в единицах 100 нс), с которого в звуковом потоке начинается распознанная речь.|
|`Duration`|Длительность (в единицах 100 нс) распознанной речи в звуковом потоке.|

Поле `RecognitionStatus` может содержать следующие значения:

| Сообщение о состоянии | Описание |
|--------|-------------|
| `Success` | Речь распознана, и присутствует поле `DisplayText`. |
| `NoMatch` | В аудиопотоке был обнаружена речь, но не были сопоставлены слова в целевом языке. Обычно означает, что язык распознавания — это не тот язык, на котором разговаривает пользователь. |
| `InitialSilenceTimeout` | Начало аудиопотока содержит только тишину, и время ожидания на появление речи в службе истекло. |
| `BabbleTimeout` | Начало аудиопотока содержит только шум, и время ожидания на появление речи в службе истекло. |
| `Error` | Служба распознавания обнаружила внутреннюю ошибку и не может продолжить работу. Повторите попытку, если это возможно. |

> [!NOTE]
> Если звуковой файл содержит только ненормативную лексику, а параметр запроса `profanity` имеет значение `remove`, служба не возвращает результат распознавания речи.

Этот формат включает те же данные, `simple` что и формат, а `NBest`также список альтернативных интерпретаций одного и того же результата распознавания. `detailed` Эти результаты имеют приоритет от наиболее вероятного к наименьшему. Первая запись совпадает с основным результатом распознавания.  При использовании формата `detailed` параметр `DisplayText` указывается как `Display` для каждого результата в списке `NBest`.

Каждый объект в списке `NBest` включает:

| Параметр | Описание |
|-----------|-------------|
| `Confidence` | Оценка достоверности записи, от 0,0 (недостоверно) до 1,0 (полная достоверность) |
| `Lexical` | Лексическая форма распознанного текста: конкретные распознанные слова. |
| `ITN` | Форма распознанного текста после обратной нормализации ("каноническая" форма) с номерами телефонов, числами, сокращениями ("профессор Преображенский" до "проф. Преображенский") и другими выполненными преобразованиями. |
| `MaskedITN` | Форма ITN с применением маскировки ненормативной лексики, если запрашивалась. |
| `Display` | Отображаемая форма распознанного текста с расстановкой знаков препинания и прописных букв. Этот параметр совпадает с параметром `DisplayText`, если указан формат `simple`. |

## <a name="sample-responses"></a>Образцы ответов

Ниже приведен типичный ответ для распознавания `simple`.

```json
{
  "RecognitionStatus": "Success",
  "DisplayText": "Remind me to buy 5 pencils.",
  "Offset": "1236645672289",
  "Duration": "1236645672289"
}
```

Ниже приведен типичный ответ для распознавания `detailed`.

```json
{
  "RecognitionStatus": "Success",
  "Offset": "1236645672289",
  "Duration": "1236645672289",
  "NBest": [
      {
        "Confidence" : "0.87",
        "Lexical" : "remind me to buy five pencils",
        "ITN" : "remind me to buy 5 pencils",
        "MaskedITN" : "remind me to buy 5 pencils",
        "Display" : "Remind me to buy 5 pencils.",
      },
      {
        "Confidence" : "0.54",
        "Lexical" : "rewind me to buy five pencils",
        "ITN" : "rewind me to buy 5 pencils",
        "MaskedITN" : "rewind me to buy 5 pencils",
        "Display" : "Rewind me to buy 5 pencils.",
      }
  ]
}
```

## <a name="next-steps"></a>Следующие шаги

- [Пробная версия Cognitive Services](https://azure.microsoft.com/try/cognitive-services/)
- [Настройка акустических моделей](how-to-customize-acoustic-models.md)
- [Настройка языковых моделей](how-to-customize-language-model.md)
