---
title: Обновление команды из клиентского приложения
titleSuffix: Azure Cognitive Services
description: обновление команды из клиентского приложения
services: cognitive-services
author: encorona-ms
manager: yetian
ms.service: cognitive-services
ms.subservice: speech-service
ms.topic: conceptual
ms.date: 10/20/2020
ms.author: encorona
ms.openlocfilehash: 1bffb09d0f49bbd0059e8a528d67bfe215f0650d
ms.sourcegitcommit: 8e7316bd4c4991de62ea485adca30065e5b86c67
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/17/2020
ms.locfileid: "94654353"
---
# <a name="update-a-command-from-the-client"></a>Обновление команды с клиента

Из этой статьи вы узнаете, как обновить текущую команду из клиентского приложения.

## <a name="prerequisites"></a>Предварительные требования
> [!div class = "checklist"]
> * Предварительно [созданное приложение Пользовательских голосовых команд](quickstart-custom-commands-application.md).

## <a name="update-the-state-of-a-command"></a>Обновление состояния команды

Если клиентскому приложению требуется обновить состояние текущей команды без речевого ввода, можно отправить событие для обновления команды.

Чтобы проиллюстрировать этот сценарий, чтобы обновить состояние текущей команды (Турнонофф), можно отправить следующее действие события. 

```json
{
  "type": "event",
  "name": "RemoteUpdate",
  "value": {
    "updatedCommand": {
      "name": "TurnOnOff",
      "updatedParameters": {
        "OnOff": "on"
      },
      "cancel": false
    },
    "updatedGlobalParameters": {},
    "processTurn": true
  }
}
```

Позволяет просматривать ключевые атрибуты этого действия.

| Атрибут | Пояснение |
| ---------------- | --------------------------------------------------------------------------------------------------------------------------- |
| **type** | Действие имеет тип "Event", а имя события должно быть "Ремотеупдате". |
| **value** | Атрибут "value" содержит атрибуты, необходимые для обновления текущей команды. |
| **упдатедкомманд** | Атрибут "Упдатедкомманд" содержит имя команды, "Упдатедпараметерс" — это Map с именем параметров и их обновленными значениями. |
| **cancel** | Если нужно отменить выполняемую команду, присвойте атрибуту Cancel значение true. |
| **упдатедглобалпараметерс** | Атрибут "Упдатедглобалпараметерс" также является картой, как и "Упдатедпараметерс", но используется для глобальных параметров. |
| **процесстурн** | Если требуется обработка после отправки действия, установите для атрибута «Процесстурн» значение true. |

Этот сценарий можно проверить на портале пользовательских команд.

1. Откройте созданное ранее приложение Пользовательских голосовых команд. 
1. Щелкните обучение, а затем — тест.
1. Отправить "включить".
1. Откройте боковую панель и щелкните Редактор действий.
1. Введите и отправьте событие Ремотекомманд, указанное в предыдущем разделе.
    > [!div class="mx-imgBorder"]
    > ![Отправить удаленную команду](media/custom-commands/send-remote-command-activity.png)

Обратите внимание, что для параметра "Онофф" было задано значение "on" с помощью действия клиента вместо речи или текста.

## <a name="update-the-catalog-of-the-parameter-for-a-command"></a>Обновление каталога параметра для команды

При настройке списка допустимых параметров для параметра значения для параметра определяются глобально для приложения. 

В нашем примере параметр Субжектдевице будет иметь фиксированный список поддерживаемых значений, независимо от диалога.

Если требуется добавить новые записи в каталог параметра для каждого диалога, можно отправить следующее действие.

```json
{
  "type": "event",
  "name": "RemoteUpdate",
  "value": {
    "catalogUpdate": {
      "commandParameterCatalogs": {
        "TurnOnOff": [
          {
            "name": "SubjectDevice",
            "values": {
              "stereo": [
                "cd player"
              ]
            }
          }
        ]
      }
    },
    "processTurn": false
  }
}
```
С этим действием мы добавили запись "стерео" в каталог параметра "Субжектдевице" в команде "Турнонофф".

> [!div class="mx-imgBorder"]
> :::image type="content" source="./media/custom-commands/update-catalog-with-remote-activity.png" alt-text="Каталог обновлений":::

Обратите внимание на несколько вещей.
1. Это действие необходимо отправить только один раз (в идеале сразу после начала подключения).
1. После отправки этого действия следует подождать, пока событие Параметеркаталогсупдатед будет отправлено клиенту.

## <a name="add-additional-context-from-the-client-application"></a>Добавление дополнительного контекста из клиентского приложения

Можно задать дополнительный контекст из клиентского приложения для каждого диалога, который позже можно будет использовать в приложении пользовательских команд. 

Например, подумайте о сценарии, в котором вы хотите отправить идентификатор и имя устройства, подключенного к приложению пользовательских команд.

Чтобы протестировать этот сценарий, давайте создадим новую команду в текущем приложении.
1. Создайте новую команду с именем Жетдевицеинфо.
1. Добавьте пример предложения с параметром "получить сведения об устройстве".
1. В правиле завершения "Готово" добавьте действие отправки речевого ответа, содержащее атрибуты clientContext.
    > ![Отправка речевого ответа с контекстом](media/custom-commands/send-speech-response-context.png)
1. Сохраните, обучите и протестируйте приложение.
1. В окне тестирование отправьте действие для обновления контекста клиента.
    > ```json
    >{
    >   "type": "event",
    >   "name": "RemoteUpdate",
    >   "value": {
    >     "clientContext": {
    >       "deviceId": "12345",
    >       "deviceName": "My device"
    >     },
    >     "processTurn": false
    >   }
    >}
    > ```
1. Отправьте текст "получение сведений об устройстве".
    > ![Отправка действия контекста клиента](media/custom-commands/send-client-context-activity.png)

Обратите внимание на несколько вещей.
1. Это действие необходимо отправить только один раз (в идеале сразу после начала подключения).
1. Для clientContext можно использовать сложные объекты.
1. Можно использовать clientContext в речевых ответах для отправки действий и вызова конечных веб-точек.

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Обновление команды из конечной точки в Интернете](./how-to-custom-commands-update-command-from-web-endpoint.md)
