---
title: Руководство. Разработка пользовательских команд приложения — речевая служба
titleSuffix: Azure Cognitive Services
description: В этом пошаговом окне вы узнаете, как разрабатывать и настраивать приложения с пользовательскими командами. Пользовательские команды упрощают создание приложений с богатыми голосовыми настройками, оптимизированных для взаимодействия с голосовым интерфейсом, и лучше всего подходит для выполнения задач, а также сценариев команд и элементов управления, особенно хорошо соответствующих для устройств "Интернет вещей" (IoT), внешних и бездисплейных устройств.
services: cognitive-services
author: trevorbye
manager: nitinme
ms.service: cognitive-services
ms.subservice: speech-service
ms.topic: conceptual
ms.date: 12/15/2020
ms.author: trbye
ms.openlocfilehash: 98c0459e0b67102458169147b1d39e98e2b3e2b1
ms.sourcegitcommit: 8c3a656f82aa6f9c2792a27b02bbaa634786f42d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/17/2020
ms.locfileid: "97632960"
---
# <a name="develop-custom-commands-applications"></a>Разработка приложений с пользовательскими командами

В этом пошаговом окне вы узнаете, как разрабатывать и настраивать приложения с пользовательскими командами. Пользовательские команды упрощают создание приложений с богатыми голосовыми настройками, оптимизированных для взаимодействия с голосовым интерфейсом, и лучше всего подходит для выполнения задач, а также сценариев команд и элементов управления, особенно хорошо соответствующих для устройств "Интернет вещей" (IoT), внешних и бездисплейных устройств.

В этой статье вы создадите приложение, которое может включать и выключать Телевизор, устанавливать температуру и задавать будильник. После создания этих основных команд рассматриваются следующие параметры настройки команд.

* Добавление параметров в команды
* Добавление конфигураций в параметры команды
* Создание правил взаимодействия
* Создание шаблонов создания языков для речевых ответов
* Использование пользовательского голоса 

## <a name="create-application-with-simple-commands"></a>Создание приложения с использованием простых команд

Сначала создайте пустое приложение пользовательских команд. Дополнительные сведения см. в [кратком руководстве](quickstart-custom-commands-application.md). На этот раз вместо импорта проекта создается пустой проект.

1. В поле **имя** введите имя проекта `Smart-Room-Lite` (или другое значение).
1. В списке **язык** выберите **Английский (США)**.
1. Выберите или создайте ресурс LUIS по своему усмотрению.

   > [!div class="mx-imgBorder"]
   > ![Создание проекта](media/custom-commands/create-new-project.png)

### <a name="update-luis-resources-optional"></a>Обновление ресурсов LUIS (необязательно)

Вы можете обновить ресурс разработки, выбранный в окне **Новый проект** , и задать ресурс прогнозирования. Ресурс прогнозирования используется для распознавания при публикации приложения пользовательских команд. Вам не нужен прогнозирующий ресурс на этапах разработки и тестирования.

### <a name="add-turnon-command"></a>Добавить команду Турнон

В пустой только что созданном приложении "пользовательские команды **Smart-Room-Lite** " добавьте простую команду, которая обрабатывает utterance, `turn on the tv` и реагирует на сообщение `Ok, turning the tv on` .

1. Создайте новую команду, выбрав **команду Создать** в верхней части левой панели. Откроется **новое командное** окно.
1. Укажите значение для поля **имени** как **Турнон**.
1. Нажмите кнопку **создания**.

В средней области перечислены различные свойства команды. Настройте следующие свойства команды. Чтобы получить описание всех свойств конфигурации команды, перейдите к разделу [ссылки](./custom-commands-references.md).

| Конфигурация            | Описание                                                                                                                 |
| ---------------- | --------------------------------------------------------------------------------------------------------------------------- |
| **Примеры предложений** | Пример фразы продолжительностью, который пользователь может сказать, чтобы активировать эту команду                                                                 |
| **Параметры**       | Сведения, необходимые для выполнения команды                                                                                |
| **Правила завершения** | Действия, выполняемые для выполнения команды. Например, для реагирования на пользователя или взаимодействия с другой веб-службой. |
| **Правила взаимодействия**   | Дополнительные правила для работы с более конкретными или сложными ситуациями                                                              |


> [!div class="mx-imgBorder"]
> ![Создание команды](media/custom-commands/add-new-command.png)

#### <a name="add-example-sentences"></a>Добавить примеры предложений

Начнем с раздела **примеров предложений** и рассмотрим пример того, что может сказать пользователь.

1. Выберите раздел **примеры предложений** в средней области.
1. В области справа добавьте примеры:

    ```
    turn on the tv
    ```

1.  Выберите **сохранить** в верхней части панели.

Сейчас у нас нет параметров, поэтому мы можем перейти к разделу **правила завершения** .

#### <a name="add-a-completion-rule"></a>Добавление правила завершения

Затем команда должна иметь правило завершения. Это правило сообщает пользователю о том, что предпринимается действие выполнения. Дополнительные сведения о правилах и правилах завершения см. в статье [ссылки](./custom-commands-references.md).

1. Выберите правило завершения по умолчанию **Готово** и измените его следующим образом:

    
    | Параметр    | Рекомендуемое значение                          | Описание                                        |
    | ---------- | ---------------------------------------- | -------------------------------------------------- |
    | **имя**;       | конфирматионреспонсе                  | Имя, описывающее назначение правила.          |
    | **Условия** | None                                     | Условия, определяющие, когда может выполняться правило    |
    | **Действия**    | Отправка речевого ответа > простого редактора > первом варианте > `Ok, turning the tv on` | Действие, выполняемое, если условие правила имеет значение true |

   > [!div class="mx-imgBorder"]
   > ![Создание речевого ответа](media/custom-commands/create-speech-response-action.png)

1. Нажмите кнопку **сохранить** , чтобы сохранить действие.
1. В разделе **правила завершения** нажмите кнопку **сохранить** , чтобы сохранить все изменения. 

    > [!NOTE]
    > Не обязательно использовать правило завершения по умолчанию, которое входит в состав команды. При необходимости можно удалить существующее правило завершения по умолчанию и добавить собственное правило.

### <a name="add-settemperature-command"></a>Добавить команду SetTemperature

Теперь добавьте еще одну команду **SetTemperature** , которая будет принимать один utterance, `set the temperature to 40 degrees` и реагировать на сообщение `Ok, setting temperature to 40 degrees` .

Выполните действия, описанные для команды **Турнон** , чтобы создать новую команду, используя пример предложения "**установить температуру в 40 градусов**".

Затем **измените существующие правила завершения,** как показано ниже.

| Параметр    | Рекомендуемое значение                          |
| ---------- | ---------------------------------------- |
| Имя  | конфирматионреспонсе                  |
| Условия | None                                     |
| Действия    | Отправка речевого ответа > простого редактора > первом варианте > `Ok, setting temperature to 40 degrees` |

Нажмите кнопку **сохранить** , чтобы сохранить все изменения, внесенные в команду.

### <a name="add-setalarm-command"></a>Добавить команду Сеталарм

Создайте новую команду **сеталарм** , используя пример предложения "**установить будильник для 9 завтра**". Затем **измените существующие правила завершения,** как показано ниже.

| Параметр    | Рекомендуемое значение                          |
| ---------- | ---------------------------------------- |
| Имя правила  | конфирматионреспонсе                  |
| Условия | None                                     |
| Действия    | Отправка речевого ответа > простого редактора > первом варианте >`Ok, setting an alarm for 9 am tomorrow` |

Нажмите кнопку **сохранить** , чтобы сохранить все изменения, внесенные в команду.

### <a name="try-it-out"></a>Попробуйте сейчас

Проверьте поведение с помощью панели "тест чата". В верхней части правой панели щелкните значок **обучения** . После завершения обучения выберите **тест**. Испытайте следующие примеры utterance с помощью голоса или текста:

- Введите: установите температуру в 40 градусов.
- Ожидаемый ответ: ОК, установка температуры в 40 градусов
- Введите: Включите телевизор.
- Ожидаемый ответ: ОК, включение ТВ
- Введите: задать оповещение для 9 завтра
- Ожидаемый ответ: ОК, Установка будильника для 9 завтра

> [!div class="mx-imgBorder"]
> ![Тестирование с помощью веб-разговора](media/custom-commands/create-basic-test-chat.png)

> [!TIP]
> На панели "тест" можно выбрать команду " **включить сведения** ", чтобы узнать, как обрабатывался этот ввод.

## <a name="add-parameters-to-commands"></a>Добавление параметров в команды

В этом разделе вы узнаете, как добавлять параметры в команды. Параметры — это сведения, необходимые командам для выполнения задачи. В сложных сценариях параметры также можно использовать для определения условий, которые активируют настраиваемые действия.

### <a name="configure-parameters-for-turnon-command"></a>Настройка параметров для команды Турнон

Начните с изменения существующей команды **Турнон** , чтобы включить и отключить несколько устройств.

1. Теперь, когда команда будет работать в сценариях включения и отключения, переименуйте команду в **турнонофф**.
   1. В левой области выберите команду **Турнон** , а затем нажмите кнопку с многоточием (...) рядом с **командой Создать** в верхней части панели.
   
   1. Выберите **Переименовать**. В окнах **команда переименования** измените **имя** на **турнонофф**.

1. Далее вы добавите в эту команду Новый параметр, который показывает, нужно ли включать или отключать устройство.
   1. Выберите  **Добавить** в верхней части средней области. В раскрывающемся списке выберите **параметр**.
   1. В области справа в разделе **Параметры** добавьте в поле **имя** значение **онофф**.
   1. Выберите **обязательный**. В окне **Добавление ответа для обязательного параметра** выберите **простой редактор**. В **первом варианте** добавьте
        ```
        On or Off?
        ```
   1. Выберите **Обновить**.

       > [!div class="mx-imgBorder"]
       > ![Создать ответ требуемого параметра](media/custom-commands/add-required-on-off-parameter-response.png)
   
   1. Теперь настройте свойства параметров. Чтобы получить описание всех свойств конфигурации команды, перейдите к разделу [ссылки](./custom-commands-references.md). Настройте свойства параметра следующим образом:
      

       | Конфигурация      | Рекомендуемое значение     | Описание                                                      |
       | ------------------ | ----------------| ---------------------------------------------------------------------|
       | Имя               | `OnOff`           | Описательное имя параметра                                                                           |
       | Является глобальным          | unchecked       | Флажок, указывающий, будет ли значение этого параметра глобально применено ко всем командам в приложении|
       | Обязательно           | checked         | Флажок, указывающий, требуется ли значение этого параметра перед выполнением команды |
       | Ответ на обязательный параметр      |Простой редактор > `On or Off?`      | Запрос на запрос значения этого параметра, если он неизвестен |
       | Тип               | Строка          | Тип параметра, например число, строка, Дата и время или география   |
       | Конфигурация      | Принять предопределенные входные значения из внутреннего каталога | Для строк это ограничивает входные значения набором возможных значений. |
       | Предопределенные входные значения     | `on`, `off`           | Набор возможных значений и их псевдонимов         |
       
        
   1. Для добавления предопределенных входных значений выберите **Добавить предопределенный ввод** и в окне **новый элемент**  введите **имя** , как указано в таблице выше. В этом случае псевдонимы не используются, поэтому вы можете оставить его пустым.
   
      > [!div class="mx-imgBorder"]
      > ![Создать параметр](media/custom-commands/create-on-off-parameter.png)

   1. Нажмите кнопку **сохранить** , чтобы сохранить все конфигурации параметра.
 
#### <a name="add-subjectdevice-parameter"></a>Добавить параметр Субжектдевице 

1. Затем нажмите кнопку **Добавить** еще раз, чтобы добавить второй параметр для представления имени устройств, которыми можно управлять с помощью этой команды. Используйте следующую конфигурацию.


    | Параметр            | Рекомендуемое значение       |
    | ------------------ | --------------------- |
    | Имя               | `SubjectDevice`         |
    | Является глобальным          | unchecked             |
    | Обязательно           | checked               |
    | Ответ на обязательный параметр     | Простой редактор > `Which device do you want to control?`    | 
    | Тип               | Строка                |          |
    | Конфигурация      | Принять предопределенные входные значения из внутреннего каталога | 
    | Предопределенные входные значения | `tv`, `fan`               |
    | Псевдонимы ( `tv` )      | `television`, `telly`     |

1. Нажмите кнопку **Сохранить**.

#### <a name="modify-example-sentences"></a>Изменение примеров предложений

Для команд с параметрами рекомендуется добавить примеры предложений, охватывающие все возможные сочетания. Пример:

* Полные сведения о параметрах — `turn {OnOff} the {SubjectDevice}`
* Сведения о частичном параметре- `turn it {OnOff}`
* Нет сведений о параметрах — `turn something`

Примеры предложений с различными сведениями позволяют приложению настраиваемых команд разрешать как однозначные разрешения, так и множественные разрешения с частичными сведениями.

Учитывая это, измените примеры предложений, чтобы использовать указанные ниже параметры.

```
turn {OnOff} the {SubjectDevice}
{SubjectDevice} {OnOff}
turn it {OnOff}
turn something {OnOff}
turn something
```

Нажмите кнопку **Сохранить**.

> [!TIP]
> В редакторе примеров предложений для ссылки на параметры используются фигурные скобки. - `turn {OnOff} the {SubjectDevice}` Используйте вкладку для автоматического завершения с помощью созданных ранее параметров.

#### <a name="modify-completion-rules-to-include-parameters"></a>Изменение правил завершения для включения параметров

Измените существующее правило завершения **конфирматионреспонсе**.

1. В разделе **условия** выберите **Добавить условие**.
1. В окне **новое условие** в списке **тип** выберите **обязательные параметры**. В списке ниже выберите и **онофф** , и **субжектдевице**.
1. Оставьте " **Global** " как снятый флажок.
1. Нажмите кнопку **создания**.
1. В разделе **действия** измените существующее действие **Отправка речевого ответа** , наведя указатель мыши на действие и нажав кнопку Изменить. На этот раз используйте только что созданные параметры **онофф** и **субжектдевице** .

    ```
    Ok, turning the {SubjectDevice} {OnOff}
    ```
1. Нажмите кнопку **Сохранить**.

Испытайте изменения, щелкнув значок **обучения** в верхней части правой панели. По завершении обучения выберите **тест**. Откроется окно **тестирования приложения** . Попробуйте выполнить следующие действия.

- Входные данные: отключение телевизора
- Выходные данные: ОК, отключение телевизора
- Входные данные: отключение телевизора
- Выходные данные: ОК, отключение телевизора
- Входные данные: отключить
- Выходные данные: какое устройство вы хотите контролировать?
- Входные данные: ТВ
- Выходные данные: ОК, отключение телевизора

### <a name="configure-parameters-for-settemperature-command"></a>Настройка параметров для команды SetTemperature

Измените команду **SetTemperature** , чтобы она установила температуру в соответствии с направлением пользователя.

Добавить новую **температуру** параметра со следующей конфигурацией

| Конфигурация      | Рекомендуемое значение     |
| ------------------ | ----------------|
| Имя               | `Temperature`           |
| Обязательно           | checked         |
| Ответ на обязательный параметр      | Простой редактор > `What temperature would you like?`
| Тип               | Число          |


Измените пример фразы продолжительностью на следующие значения.

```
set the temperature to {Temperature} degrees
change the temperature to {Temperature}
set the temperature
change the temperature
```

Измените существующие правила завершения в соответствии со следующей конфигурацией.

| Конфигурация      | Рекомендуемое значение     |
| ------------------ | ----------------|
| Условия         | Обязательный параметр >ная температура           |
| Действия           | Отправка речевого ответа > `Ok, setting temperature to {Temperature} degrees` |

### <a name="configure-parameters-to-the-setalarm-command"></a>Настройка параметров для команды Сеталарм

Добавьте параметр с именем **DateTime** со следующей конфигурацией.

   | Параметр                           | Рекомендуемое значение                     | 
   | --------------------------------- | ----------------------------------------|
   | Имя                              | `DateTime`                               |
   | Обязательно                          | checked                                 |
   | Ответ на обязательный параметр   | Простой редактор > `For what time?`            | 
   | Тип                              | DateTime                                |
   | Значения по умолчанию для даты                     | Если дата отсутствует, используйте сегодня            |
   | Значения времени по умолчанию                     | Если время отсутствует, используйте начало дня     |


> [!NOTE]
> В этой статье мы предоставили использование строк, чисел и типов параметров даты и времени. Список всех поддерживаемых типов параметров и их свойств см. в [ссылке](./custom-commands-references.md).


Измените пример фразы продолжительностью на следующие значения.

```
set an alarm for {DateTime}
set alarm {DateTime}
alarm for {DateTime}
```

Измените существующие правила завершения в соответствии со следующей конфигурацией.

   | Параметр    | Рекомендуемое значение                               |
   | ---------- | ------------------------------------------------------- |
   | Действия    | Отправка речевого ответа- `Ok, alarm set for {DateTime}`  |

Протестируйте все три команды вместе с помощью фразы продолжительностью, связанных с различными командами. Обратите внимание, что можно переключаться между различными командами.

- Входные данные: задать оповещение
- Выходные данные: сколько времени?
- Входные данные: включить телевизор
- Выходные данные: ОК, включение телевизора
- Входные данные: задать оповещение
- Выходные данные: сколько времени?
- Входные данные: 17:00
- Выходные данные: ОК, оповещение установлено для 2020-05-01 17:00:00

## <a name="add-configurations-to-commands-parameters"></a>Добавление конфигураций в параметры команд

В этом разделе вы узнаете больше о конфигурации расширенных параметров, включая:

 - Как значения параметров могут входить в набор, определенный извне, в приложение пользовательских команд
 - Добавление предложений проверки в значения параметров

### <a name="configure-parameter-as-external-catalog-entity"></a>Настройка параметра как сущности внешнего каталога

Пользовательские команды позволяют настроить параметры строкового типа для ссылки на внешние каталоги, размещенные в конечной веб-точке. Это позволяет независимо обновлять внешний каталог без внесения изменений в приложение пользовательских команд. Этот подход полезен в случаях, когда записи каталога могут быть большими в числе.

Повторно используйте параметр **субжектдевице** из команды **турнонофф** . Текущая конфигурация этого параметра **принимает предопределенные входные данные из внутреннего каталога**. Это относится к статическому списку устройств, как определено в конфигурации параметров. Мы хотим переместить это содержимое во внешний источник данных, который можно обновлять независимо.

Для этого сначала добавьте новую конечную точку веб-узла. Перейдите в раздел **конечные точки веб-** узлов на левой панели и добавьте новую веб-конечную точку со следующей конфигурацией.

| Параметр | Рекомендуемое значение |
|----|----|
| Имя | `getDevices` |
| URL-адрес | `https://aka.ms/speech/cc-sampledevices` |
| Метод | GET |


Если предлагаемое значение для URL-адреса не подходит для вас, необходимо настроить и разместить простую веб-конечную точку, которая возвращает код JSON, состоящий из списка устройств, которыми можно управлять. Конечная веб-точка должна вернуть JSON в формате:
    
```json
{
    "fan" : [],
    "refrigerator" : [
        "fridge"
    ],
    "lights" : [
        "bulb",
        "bulbs",
        "light"
        "light bulb"
    ],
    "tv" : [
        "telly",
        "television"
        ]
}

```

Затем перейдите на страницу параметров параметров **субжектдевице** и измените свойства на следующие.

| Параметр | Рекомендуемое значение |
| ----| ---- |
| Конфигурация | Принять предопределенные входные данные из внешнего каталога |                               
| Конечная точка каталога | Устройства |
| Метод | GET |

Затем нажмите кнопку **Сохранить**.

> [!IMPORTANT]
> Вы не увидите параметр, позволяющий настроить параметр для приема входных данных из внешнего каталога, если в разделе **веб-конечная точка** в левой области не задана конечная точка веб-сайта.

Попробуйте, выбрав **обучение** и дождитесь завершения обучения. После завершения обучения выберите **тест** и попробуйте несколько взаимодействий.

* Входные данные: включить
* Выходные данные: какое устройство вы хотите контролировать?
* Входные данные: индикаторы
* Выходные данные: ОК, включение освещения

> [!NOTE]
> Обратите внимание, как можно управлять всеми устройствами, размещенными в конечной веб-точке. Вам по-прежнему необходимо обучить приложение для тестирования новых изменений и повторной публикации приложения.

### <a name="add-validation-to-parameters"></a>Добавить проверку в параметры

**Проверки** — это конструкции, применимые к определенным типам параметров, которые позволяют настраивать ограничения для значения параметра и запрашивать исправление, если значения не должны находиться в пределах ограничений. Полный список типов параметров, расширяющих конструкцию проверки, см. в [ссылке](./custom-commands-references.md) .

Проверьте правильность проверки с помощью команды **SetTemperature** . Чтобы добавить проверку для параметра **температуры** , выполните следующие действия.

1. В левой области выберите команду **SetTemperature** .
1. Выберите  **температуру** в средней области.
1. Выберите **добавить проверку** , имеющуюся в правой области.
1. В окне **Новая проверка** настройте проверку следующим образом и нажмите кнопку **создать**.


    | Конфигурация параметров | Рекомендуемое значение | Описание |
    | ---- | ---- | ---- |
    | Минимальное значение | `60` | Для числовых параметров — минимальное значение, которое может предположить этот параметр. |
    | Максимальное значение | `80` | Для числовых параметров — максимальное значение, которое может предположить этот параметр. |
    | Неудачный ответ |  Простой редактор > первый вариант > `Sorry, I can only set temperature between 60 and 80 degrees. What temperature do you want?` | Запрашивать новое значение, если проверка не пройдена |

    > [!div class="mx-imgBorder"]
    > ![Добавление проверки диапазона](media/custom-commands/add-validations-temperature.png)

Попробуйте, щелкнув значок **обучения** в верхней части правой панели. После завершения обучения выберите **тест** и попробуйте несколько взаимодействий:

- Входные данные: установите температуру в 72 градусов.
- Выходные данные: ОК, установка температуры в 72 градусов
- Входные данные: установите температуру в 45 градусов.
- Выходные данные: можно установить только температуру между 60 и 80 градусов
- Входные данные: сделайте его 72 градусов
- Выходные данные: ОК, установка температуры в 72 градусов

## <a name="add-interaction-rules"></a>Добавление правил взаимодействия

Правила взаимодействия — это *Дополнительные правила* для решения конкретных или сложных ситуаций. Хотя вы можете создавать собственные пользовательские правила взаимодействия, в этом примере вы используете правила взаимодействия для следующих целевых сценариев:

* Подтверждение команд
* Добавление одноэтапного исправления в команды

Дополнительные сведения о правилах взаимодействия см. в разделе " [ссылки](./custom-commands-references.md) ".

### <a name="add-confirmations-to-a-command"></a>Добавление подтверждений для команды

Чтобы добавить подтверждение, используйте команду **SetTemperature** . Чтобы получить подтверждение, создайте правила взаимодействия, выполнив следующие действия.

1. Выберите команду **SetTemperature** в левой области.
1. Добавьте правила взаимодействия, выбрав **Добавить** в средней области. Затем выберите команду **правила взаимодействия**  >  **проверить**.

    Это действие добавляет три правила взаимодействия, которые запрашивают у пользователя подтверждение даты и времени оповещения и ожидает подтверждения (да/нет) для следующей активации.

    1. Измените правило взаимодействия **команды Confirm** согласно следующей конфигурации:
        1. Переименуйте **имя** , чтобы **подтвердить температуру**.
        1. Добавить новое условие в качестве **обязательных параметров**  >  **температура**.
        1. Добавить новое действие как **тип**  >  **Отправить речевой ответ**  >  **. Вы действительно хотите задать температуру как {температура} градусов?**
        1. Оставьте значение по умолчанию для параметра **ожидается подтверждение от пользователя** в разделе **ожидания** .
      
         > [!div class="mx-imgBorder"]
         > ![Создать ответ требуемого параметра](media/custom-speech-commands/add-validation-set-temperature.png)
    

    1. Измените правило взаимодействия **успешно подтверждено** , чтобы обрабатывалось успешное подтверждение (пользователь сказал да).
      
          1. Измените **имя** на « **температура подтверждения**».
          1. Оставить уже существующее **Подтверждение условие прошло успешно** .
          1. Добавьте новое условие в качестве **типа**  >  **обязательные параметры**  >  **температура**.
          1. Оставьте значение по умолчанию для **состояния после выполнения** в качестве **правил** выполнения.

    1. Изменение правила взаимодействия с **отклонением подтверждения** для выполнения сценариев при отказе в подтверждении (пользователь сказал No).

          1. Измените **имя** на " **температура подтверждения отклонено**".
          1. Оставить уже существующее **подтверждение отказа** .
          1. Добавьте новое условие в качестве **типа**  >  **обязательные параметры**  >  **температура**.
          1. Добавьте новое действие как **тип**  >  **Отправить речевое реагирование**  >  **проблема. Какова температура?**
          1. Оставьте значение по умолчанию для **состояния после выполнения** , **Дождитесь ввода данных пользователем**.

> [!IMPORTANT]
> В этой статье вы использовали встроенную функцию подтверждения. Можно также вручную добавить правила взаимодействия по одному.
   
Испытайте изменения, выбрав **обучение**, дождитесь завершения обучения и выберите **тест**.

- **Входные данные**: установите температуру в 80 градусов.
- **Выходные данные**: вы действительно хотите задать температуру как 80 градусов?
- **Входные данные**: нет
- **Выходные данные**: нет проблем. Какова температура?
- **Входные данные**: 72 градусов
- **Выходные данные**: вы действительно хотите задать температуру как 72 градусов?
- **Входные данные**: Да
- **Выходные данные**: ОК, установка температуры в 83 градусов

### <a name="implement-corrections-in-a-command"></a>Реализация исправлений в команде

В этом разделе вы настроите одношаговое исправление, которое будет использоваться после того, как действие выполнения уже будет выполнено. Вы также видите пример того, как исправление включено по умолчанию, если команда еще не выполнена. Чтобы добавить исправление, если команда не завершена, добавьте новый параметр **алармтоне**.

Выберите команду **сеталарм** в левой области и добавьте новый параметр **алармтоне**.
        
- **Имя**  >  **Алармтоне**
- **Тип**  >  **Строка**
- Значение по умолчанию   >  **Чимес**
- **Конфигурация**  >  **Принять предопределенные входные значения из внутреннего каталога**
- **Предопределенные входные значения**  >  **Чимес**, **позвякивание** и **echo** как отдельные предопределенные входные данные


Затем обновите ответ для параметра **DateTime** , чтобы **присвоить сигналу будильника значение {алармтоне}. За какое время?**. Затем измените правило завершения следующим образом:

1. Выберите существующее правило завершения **конфирматионреспонсе**.
1. На правой панели наведите указатель мыши на существующее действие и выберите **изменить**.
1. Обновите речевой ответ на "ОК", задали **оповещение для {DateTime}. Сигнал будильника — {Алармтоне}.**

> [!IMPORTANT]
> Сигнал будильника можно изменить без какой бы то ни было явной настройки в текущей команде, например, когда команда еще не была завершена. *По умолчанию исправление включено для всех параметров команды, независимо от числа включений, если команда еще не выполнена.*

#### <a name="correction-when-command-is-completed"></a>Исправление после завершения команды

Платформа пользовательских команд также предоставляет возможность одноэтапного исправления даже после завершения выполнения команды. Эта функция не включена по умолчанию. Он должен быть явно настроен. Чтобы настроить одношаговое исправление, выполните следующие действия.

1. В команде **сеталарм** добавьте правило взаимодействия для **команды Type Update Previous** , чтобы обновить ранее установленный сигнал. Переименуйте **имя** правила взаимодействия по умолчанию, чтобы **обновить предыдущий сигнал**.
1. Оставьте условие по умолчанию, а **Предыдущая команда должна быть обновлена** , как есть.
1. Добавьте новое условие в качестве **типа**  >  **обязательный параметр**  >  **DateTime**.
1. Добавить новое действие как **тип**  >  **Отправить речевой ответ**  >  **простой редактор**  >  **, обновляющий время предыдущего оповещения до {DateTime}.**
1. Оставьте значение по умолчанию для **состояния после выполнения** , так как **команда выполнена**.

Испытайте изменения, выбрав **обучение**, дождитесь завершения обучения и выберите **тест**.

- **Входные данные**: Установите оповещение.
- **Выходные данные**: готово к установке сигнала будильника как чимес. За какое время?
- **Входные данные**: установите будильник со значением позвякивание для 9 завтра.
- **Выходные данные**: ОК, оповещение установлено для 2020-05-21 09:00:00. Сигнал будильника — позвякивание.
- **Входные данные**: нет, 8 AM.
- **Выходные данные**: обновление предыдущего времени оповещения до 2020-05-29 08:00.

> [!NOTE]
> В реальном приложении в разделе **действия** этого правила исправления также необходимо отправить обратно клиенту действие или вызвать конечную точку HTTP, чтобы обновить время оповещения в системе. Это действие должно отвечать исключительно за обновление времени оповещения, а не любого другого атрибута команды. В этом случае это будет сигнал будильника.

## <a name="add-language-generation-templates-for-speech-responses"></a>Добавление шаблонов создания языков для речевых ответов

Шаблоны создания языка позволяют настроить отклики, отправляемые клиенту, и ввести дисперсию в ответах. Настройка создания языка может быть достигнута:

* Использование шаблонов создания языка
* Использование адаптивных выражений

Шаблоны пользовательских команд основаны на BotFramework [шаблонах LG](/azure/bot-service/file-format/bot-builder-lg-file-format#templates). Поскольку пользовательские команды при необходимости создают новый шаблон LG (то есть для речевых ответов в параметрах или действиях), указывать имя шаблона LG не требуется. Итак, вместо того, чтобы определять шаблон следующим образом:

 ```
    # CompletionAction
    - Ok, turning {OnOff} the {SubjectDevice}
    - Done, turning {OnOff} the {SubjectDevice}
    - Proceeding to turn {OnOff} {SubjectDevice}
 ```

Необходимо определить только текст шаблона без имени, как показано ниже.

> [!div class="mx-imgBorder"]
> ![Пример редактора шаблонов](./media/custom-commands/template-editor-example.png)


Это изменение представляет вариацию голосовых ответов, отправляемых клиенту. Таким образом, для того же utterance соответствующий речевой ответ будет случайно извлечен из предоставленных параметров.

Использование преимуществ шаблонов LG также позволяет определять сложные речевые ответы для команд с помощью адаптивных выражений. Дополнительные сведения можно найти в [формате шаблонов LG](/azure/bot-service/file-format/bot-builder-lg-file-format#templates) . По умолчанию пользовательские команды поддерживают все возможности со следующими незначительными различиями:

* В сущностях шаблонов LG представлены как $ {имя_объекта}. В пользовательских командах не используются сущности, но параметры можно использовать в качестве переменных с одним из следующих представлений: $ {parameterName} или {parameterName}
* Композиция и расширение шаблона не поддерживаются в пользовательских командах. Это происходит потому, что вы никогда не редактируете `.lg` файл напрямую, но только ответы автоматически созданных шаблонов.
* Пользовательские функции, добавленные LG, не поддерживаются в пользовательских командах. Стандартные функции по-прежнему поддерживаются.
* Параметры (replaceNull & Линебреакстиле) не поддерживаются в пользовательских командах.

### <a name="add-template-responses-to-turnonoff-command"></a>Добавление ответов шаблона в команду Турнонофф

Измените команду **турнонофф** , чтобы добавить новый параметр со следующей конфигурацией:

| Параметр            | Рекомендуемое значение       | 
| ------------------ | --------------------- | 
| Имя               | `SubjectContext`         | 
| Является глобальным          | unchecked             | 
| Обязательно           | unchecked               | 
| Тип               | Строка                |
| Значение по умолчанию      | `all` |
| Конфигурация      | Принять предопределенные входные значения из внутреннего каталога | 
| Предопределенные входные значения | `room`, `bathroom`, `all`|

#### <a name="modify-completion-rule"></a>Изменение правила завершения

Измените раздел **действия** существующего правила завершения **конфирматионреспонсе**. Во всплывающем окне **изменение действия** перейдите в **Редактор шаблонов** и замените текст следующим примером.

```
- IF: @{SubjectContext == "all" && SubjectDevice == "lights"}
    - Ok, turning all the lights {OnOff}
- ELSEIF: @{SubjectDevice == "lights"}
    - Ok, turning {OnOff} the {SubjectContext} {SubjectDevice}
- ELSE:
    - Ok, turning the {SubjectDevice} {OnOff}
    - Done, turning {OnOff} the {SubjectDevice}
```

**Обучить** и **протестируйте** приложение следующим образом. Обратите внимание на разновидность ответов из-за использования нескольких альтернативных вариантов значения шаблона, а также использование адаптивных выражений.

* Входные данные: включить телевизор
* Выходные данные: ОК, включение телевизора
* Входные данные: включить телевизор
* Выходные данные: готово, включен ТВ
* Входные данные: отключение индикаторов
* Выходные данные: ОК, отключение всех световых индикаторов
* Входные данные: отключение освещения комнаты
* Выходные данные: ОК, выключение освещения комнаты

## <a name="use-custom-voice"></a>Использование набора инструментов "Пользовательский голос"

Другим способом настройки ответов на пользовательские команды является выбор пользовательского выходного голоса. Для переключения голоса по умолчанию на пользовательский Voice выполните следующие действия.

1. В приложении "пользовательские команды" выберите **Параметры** в левой области.
1. Выберите **Пользовательский голосовое** значение в средней области.
1. Выберите нужный пользовательский или общедоступный голосовое значение из таблицы.
1. Нажмите кнопку **Сохранить**.

> [!div class="mx-imgBorder"]
> ![Примеры предложений с параметрами](media/custom-commands/select-custom-voice.png)

> [!NOTE]
> - Для **общих голосов** **типы нейронов** доступны только для конкретных регионов. Сведения о проверке доступности см. в статье [Стандартные и нейронные голоса по регионам и конечным точкам](./regions.md#standard-and-neural-voices).
> - Для **пользовательских голосов** их можно создать на странице настраиваемого голосового проекта. См. статью Начало [работы с пользовательским голосовым стандартом](./how-to-custom-voice.md).

Теперь приложение будет отвечать на выбранный голоса вместо голоса по умолчанию.

## <a name="next-steps"></a>Дальнейшие действия

* Узнайте, как [интегрировать приложение с пользовательскими командами](how-to-custom-commands-setup-speech-sdk.md) с клиентским приложением с помощью РЕЧЕВОГО пакета SDK.
* [Настройка непрерывного развертывания](how-to-custom-commands-deploy-cicd.md) для приложения настраиваемых команд с помощью Azure DevOps. 
                      