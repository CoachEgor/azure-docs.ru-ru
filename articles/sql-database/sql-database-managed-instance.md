---
title: Обзор управляемого экземпляра S'L
description: В этой статье описывается пример управляемой базы данных Azure S'L.
services: sql-database
ms.service: sql-database
ms.subservice: managed-instance
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: bonova
ms.author: bonova
ms.reviewer: sstein, carlrab, vanto
ms.date: 01/21/2020
ms.openlocfilehash: b9fdd1b25e53e1cdc8aa76564304a61adaa8d804
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79268786"
---
# <a name="what-is-azure-sql-database-managed-instance"></a>Что такое пример управляемой базой данных Azure S'L?

Управляемый экземпляр является новой моделью развертывания базы данных SQL Azure. Она обеспечивает практически полную совместимость с последним ядром СУБД локальной версии SQL Server (Enterprise Edition), предоставляя собственную реализацию [виртуальной сети](../virtual-network/virtual-networks-overview.md), устраняющую распространенные проблемы безопасности и [бизнес-модель](https://azure.microsoft.com/pricing/details/sql-database/), подходящую для клиентов локальной версии SQL Server. Модель развертывания "Управляемый экземпляр" позволяет существующим клиентам SQL Server переместить их локальные приложения в облако методом lift-and-shift с минимальными изменениями приложения и базы данных. При этом эта модель развертывания сохраняет все возможности PaaS (автоматическое исправление и обновление версии, [автоматическое резервное копирование](sql-database-automated-backups.md), [высокий уровень доступности](sql-database-high-availability.md)), что значительно снижает расходы на управление и совокупную стоимость владения.

> [!IMPORTANT]
> Список регионов, в которых в настоящее время доступен вариант развертывания "Управляемый экземпляр", см. в разделе [Поддерживаемые регионы](sql-database-managed-instance-resource-limits.md#supported-regions).

На следующем рисунке показаны основные возможности управляемого экземпляра:

![Основные возможности](./media/sql-database-managed-instance/key-features.png)

Модель развертывания в виде управляемого экземпляра предназначена для клиентов, которые хотят перенести большое количество приложений из локальной среды или среды IaaS, самостоятельно созданной среды или среды, предоставленной ISV, в полностью управляемую облачную среду PaaS с минимальными усилиями. Используя полностью автоматизированную [службу миграции данных (DMS)](../dms/tutorial-sql-server-to-managed-instance.md#create-an-azure-database-migration-service-instance) в Azure, клиенты могут поднять и перевести свой предприимчивый сервер S'L Server в управляемый экземпляр, который обеспечивает совместимость с s'L Server на месте и полную изоляцию экземпляров клиентов с помощью нативной поддержки VNet.  С помощью Software Assurance вы можете обменять существующие лицензии на дисконтированные ставки в управляемом экземпляре, используя [гибридную выгоду Azure для сервера S'L.](https://azure.microsoft.com/pricing/hybrid-benefit/)  Управляемый экземпляр — лучший целевой объект миграции в облаке для экземпляров SQL Server, требующих высокого уровня безопасности и расширенных возможностей программирования.

Вариант развертывания в виде управляемого экземпляра будет обеспечивать совместимость с последней версией локального SQL Server на уровне практически 100 % (предусмотрен многоэтапный план выпуска).

Чтобы выбрать между вариантом развертывания в виде отдельной базы данных, базы данных в пуле и управляемого экземпляра Базы данных SQL Azure, а также в SQL Server на виртуальной машине, ознакомьтесь со статьей [Выбор правильного варианта SQL Server в Azure — PaaS или IaaS](sql-database-paas-vs-sql-server-iaas.md).

## <a name="key-features-and-capabilities"></a>Основные функции и возможности

Управляемый экземпляр сочетает в себе лучшие функции, доступные в Базе данных SQL Azure и ядре СУБД SQL Server.

> [!IMPORTANT]
> Управляемый экземпляр поддерживает все функции последней версии SQL Server, включая операции в сети, автоматическое исправление планов и другие усовершенствования для повышения производительности организации. Сравнение доступных функций приведено в разделе [Сравнение функций Базы данных SQL Azure и SQL Server](sql-database-features.md).

| **Преимущества PaaS** | **Преемственность бизнеса** |
| --- | --- |
|Нет необходимости в приобретении оборудования и управления им <br>Отсутствие накладных расходов на управление базовой инфраструктурой <br>Быстрая подготовка и масштабирование службы <br>Автоматическое исправление и обновление версии <br>Интеграция с другими службами данных PaaS |Соглашение об уровне обслуживания с гарантией времени непрерывной работы 99,99 %.  <br>Встроенный [высокий уровень доступности](sql-database-high-availability.md) <br>Данные защищены путем [автоматического создания резервных копий](sql-database-automated-backups.md) <br>Период хранения резервных копий настраивается пользователем <br>Инициируемые пользователем [резервные копии](https://docs.microsoft.com/sql/t-sql/statements/backup-transact-sql?view=azuresqldb-mi-current) <br>Возможность [восстановления базы данных до точки во времени](sql-database-recovery-using-backups.md#point-in-time-restore) |
|**Безопасность и соответствие требованиям** | **Управление**|
|Изолированная среда[(интеграция VNet,](sql-database-managed-instance-connectivity-architecture.md)служба единого клиента, специализированные вычисления и хранение) <br>[Прозрачное шифрование данных (TDE)](https://docs.microsoft.com/sql/relational-databases/security/encryption/transparent-data-encryption-azure-sql)<br>[Проверка подлинности Azure AD](sql-database-aad-authentication.md), поддержка единого входа <br> <a href="/sql/t-sql/statements/create-login-transact-sql?view=azuresqldb-mi-current">Принципы серверов Azure AD (логины)</a>  <br>Соблюдение тех же стандартов соответствия, что и База данных SQL Azure <br>[Аудит SQL](sql-database-managed-instance-auditing.md) <br>[Расширенная защита от угроз](sql-database-managed-instance-threat-detection.md) |Программный интерфейс Azure Resource Manager для автоматизации подготовки и масштабирования службы <br>Функциональные возможности портала Azure для подготовки и масштабирования службы вручную <br>Служба миграции данных

> [!IMPORTANT]
> База данных Azure S'L (все варианты развертывания) сертифицирована в соответствии с рядом стандартов соответствия. Для получения дополнительной информации посетите [целевой центр Microsoft Azure Trust Center,](https://gallery.technet.microsoft.com/Overview-of-Azure-c1be3942) где можно найти наиболее актуальный список сертификатов соответствия требованиям базы данных S'L.

В следующей таблице показаны основные возможности управляемого экземпляра.

|Компонент | Описание|
|---|---|
| Версия и сборка SQL Server | Ядро СУБД SQL Server (последняя стабильная версия) |
| Управляемые, автоматически создаваемые резервные копии | Да |
| Встроенный мониторинг и метрики базы данных и экземпляра | Да |
| Автоматическое применение исправления программного обеспечения | Да |
| Новейшие функции ядра СУБД | Да |
| Число файлов данных (ROWS) в одной базе данных | Несколько |
| Число файлов журнала (LOG) в одной базе данных | 1 |
| Виртуальная сеть — развертывание Azure Resource Manager | Да |
| Виртуальная сеть — классическая модель развертывания | нет |
| Поддержка портала | Да|
| Встроенная служба интеграции (службы SSIS) | Нет. Службы SSIS входят в [PaaS Фабрики данных Azure](https://docs.microsoft.com/azure/data-factory/tutorial-deploy-ssis-packages-azure). |
| Встроенные службы Analysis Services (службы SSAS) | Нет. Службы SSAS являются отдельным решением [PaaS](https://docs.microsoft.com/azure/analysis-services/analysis-services-overview). |
| Встроенная служба отчетов (SSRS) | Нет. Используйте Power BI или IaaS SSRS. |
|||

## <a name="vcore-based-purchasing-model"></a>Модель приобретения на основе виртуальных ядер

[Модель приобретения на основе виртуальных ядер](sql-database-service-tiers-vcore.md) в управляемом экземпляре обеспечивает больше гибкости, контроля и прозрачности. Это простой способ перенести свои требования к локальной рабочей нагрузке в облако. Эта модель позволяет изменять ресурсы ЦП, памяти и хранилища с учетом потребностей рабочих нагрузок. Модель vCore также имеет право на экономию до 55 процентов с помощью [гибридной выгоды Azure для сервера S'L.](https://azure.microsoft.com/pricing/hybrid-benefit/)

В модели на основе виртуальных ядер можно выбрать поколение оборудования.

- **Gen4** Логические процессоры основаны на процессорах Intel E5-2673 v3 (Haswell) 2,4 ГГц, прикрепленных SSD, физических ядрах, 7-ГБ оперативной памяти на ядро и вычислительных размерах от 8 до 24 vCores.
- **Gen5** Логические процессоры основаны на процессорах Intel E5-2673 v4 (Broadwell) 2,3 ГГц и Процессоры Intel SP-8160 (Skylake), быстром NVMe SSD, гипер-резьбовом логическом ядре и вычислительных размерах от 4 до 80 ядер.

Узнайте больше о разнице между поколениями оборудования в [управляемых ресурсах экземпляра.](sql-database-managed-instance-resource-limits.md#hardware-generation-characteristics)

## <a name="managed-instance-service-tiers"></a>Уровни служб управляемого экземпляра

Управляемый экземпляр доступен на двух уровнях служб:

- **Общее назначение**: Предназначено для приложений с типичными требованиями к производительности и задержке исмоты.
- **Критически важный**для бизнеса: Предназначен для приложений с низкими требованиями к задержке и минимальным влиянием базовых операций по техническому обслуживанию на рабочую нагрузку.

Оба уровня служб гарантируют доступность на уровне 99,99 % и позволяют вам независимо выбирать размер хранилища и вычислительную емкость. Дополнительные сведения об архитектуре Базы данных SQL Azure с высоким уровнем доступности см. в статье [Высокая доступность и База данных SQL Azure](sql-database-high-availability.md).

### <a name="general-purpose-service-tier"></a>Уровень служб общего назначения

Ниже перечислены ключевые характеристики уровня служб общего назначения.

- Предназначен для большинства бизнес-приложений с обычными требованиями к производительности.
- Высокопроизводительное хранилище BLOB-объектов Azure (8 ТБ).
- Встроенный [высокий уровень доступности](sql-database-high-availability.md#basic-standard-and-general-purpose-service-tier-availability) на основе надежного хранилища BLOB-объектов Azure и [Azure Service Fabric](../service-fabric/service-fabric-overview.md).

Дополнительные сведения см. в статье об [уровне хранилища в ценовой категории "Общего назначения"](https://medium.com/azure-sqldb-managed-instance/file-layout-in-general-purpose-azure-sql-managed-instance-cf21fff9c76c), а также в статье с [рекомендациями по оптимизации производительности хранилища и вопросами, касающимися управляемых экземпляров (общего назначения)](https://blogs.msdn.microsoft.com/sqlcat/2018/07/20/storage-performance-best-practices-and-considerations-for-azure-sql-db-managed-instance-general-purpose/).

Узнайте больше о разнице между уровнями обслуживания в [ограниченных ресурсах управляемых экземпляров.](sql-database-managed-instance-resource-limits.md#service-tier-characteristics)

### <a name="business-critical-service-tier"></a>Уровень служб "Критически важный для бизнеса"

Уровень служб "Критически важный для бизнеса" предназначен для приложений с высокими требованиями к операциям ввода-вывода. Предлагает самую высокую отказоустойчивость к сбоям благодаря использованию нескольких изолированных реплик.

Ниже приведены основные характеристики уровня служб "Критически важный для бизнеса".

- Предназначен для бизнес-приложений с наибольшей производительностью и требованиями к высокой доступности
- поставляется со сверхбыстрым локальным SSD-хранилищем (до 1 ТБ при использовании поколения 4 и до 4 ТБ при использовании поколения 5);
- Встроенная [высокая доступность](sql-database-high-availability.md#premium-and-business-critical-service-tier-availability) основана на [группах всегда на доступности](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/always-on-availability-groups-sql-server) и [услугах Azure Fabric.](../service-fabric/service-fabric-overview.md)
- Встроенная дополнительная [копия базы данных только](sql-database-read-scale-out.md) для чтения, которая может быть использована для отчетности и других рабочих нагрузок только для чтения
- [Выполняющаяся в памяти OLTP](sql-database-in-memory.md), которую можно использовать для рабочей нагрузки с требованиями высокой производительности.  

Узнайте больше о разнице между уровнями обслуживания в [ограниченных ресурсах управляемых экземпляров.](sql-database-managed-instance-resource-limits.md#service-tier-characteristics)


## <a name="managed-instance-management-operations"></a>Управляемые операции по управлению экземплярами

База данных SQL Azure поддерживает операции управления, которые можно использовать для автоматического развертывания новых управляемых экземпляров и удаления ненужных, а также обновления их свойств. В этом разделе содержится информация об операциях управления и их типичных продолжительностях.

Для [поддержки развертывания в Azure Virtual Networks (VNets)](../virtual-network/virtual-network-for-azure-services.md#deploy-azure-services-into-virtual-networks) и обеспечения изоляции и безопасности для клиентов управляемый экземпляр опирается на [виртуальные кластеры,](sql-database-managed-instance-connectivity-architecture.md#high-level-connectivity-architecture)которые представляют собой специальный набор изолированных виртуальных машин, развернутых внутри виртуальной сетевой подсети клиента. По сути, каждое управляемое развертывание экземпляра в пустой подсети приводит к созданию нового виртуального кластера.

Последующие операции на развернутых управляемых экземплярах могут также иметь последствия для лежащего в его основе виртуального кластера. Это влияет на продолжительность операций управления, так как развертывание дополнительных виртуальных машин сопряжено с накладными передними, которые необходимо учитывать при планировании новых развертываний или обновлении существующих управляемых экземпляров.

Все операции управления можно классифицировать следующим образом:

- Развертывание экземпляров (создание нового экземпляра). 
- Обновление экземпляра (изменение свойств экземпляра, таких как vCores или зарезервированное хранилище.
- Удаление экземпляров.

Как правило, операции на виртуальных кластерах занимают больше всего времени. Продолжительность операций на виртуальных кластерах различается - ниже приведены значения, которые обычно можно ожидать, на основе существующих данных телеметрии службы:

- Виртуальное создание кластера. Это синхронный шаг в операциях управления экземплярами. **90% операций заканчиваются за 4 часа.**
- Виртуальное переразмерное увеличение кластера (расширение или сокращение). Расширение является синхронным шагом, в то время как сжатие выполняется асинхронно (без влияния на продолжительность операций управления экземплярами). **90% кластерных расширений заканчиваются менее чем за 2,5 часа.**
- Виртуальное удаление кластера. Удаление является асинхронным шагом, но оно также может быть [инициировано вручную](sql-database-managed-instance-delete-virtual-cluster.md) на пустом виртуальном кластере, и в этом случае оно выполняется синхронно. **90% виртуальных вылетов кластера заканчиваются за 1,5 часа.**

Кроме того, управление экземплярами может также включать одну из операций по размещенным базам данных, что приводит к более длительному продолжительности:

- Присоединение файлов базы данных из хранилища Azure. Это синхронный шаг, например, вычисление (vCore) или масштабирование или масштабирование хранилища вверх или вниз в уровне службы общего назначения. **90% этих операций заканчиваются за 5 минут.**
- Всегда на наличие группы посева. Это синхронный шаг, например, вычисление (vCore) или масштабирование хранилища на уровне службы Business Critical, а также изменение уровня обслуживания с общего назначения на критический для бизнеса (или наоборот). Продолжительность операции пропорциональна общему размеру базы данных, а также текущей активности базы данных (количество активных транзакций). Активность базы данных при обновлении экземпляра может привести к значительному отклонению от общей продолжительности. **90% из этих операций выполняются на 220 ГБ / час или выше.**

В следующей таблице кратко излагаются операции и типичные общие длительности:

|Категория  |Операция  |Долгосрочный сегмент  |Ожидаемая продолжительность  |
|---------|---------|---------|---------|
|**Развертывание** |Первый экземпляр в пустой подсети|Виртуальное создание кластера|90% операций заканчиваются за 4 часа|
|Развертывание |Первый экземпляр другого аппаратного поколения в непустой подсети (например, первый экземпляр Gen 5 в подсети с экземплярами Gen 4)|Создание виртуального кластера|90% операций заканчиваются за 4 часа|
|Развертывание |В первую очередь создание 4 vCores, в пустой или непустой подсети|Создание виртуального кластера|90% операций заканчиваются за 4 часа|
|Развертывание |Последующее создание экземпляра в непустой подсети (2-й, 3-й и т.д.)|Виртуальное переразмерное создание кластера|90% операций заканчиваются за 2,5 часа|
|**Обновление** |Изменение свойства экземпляра (пароль админа, логин AAD, флаг гибридных преимуществ Azure)|Недоступно|До 1 минуты|
|Update |Масштабирование экземпляров вверх/вниз (уровень службы общего назначения)|Присоединение файлов базы данных|90% операций заканчиваются за 5 минут|
|Update |Масштабирование экземпляров вверх/вниз (уровень обслуживания бизнес-критических)|- Виртуальная переразмерная величина кластера<br>- Всегда на наличие группы посева|90% операций заканчиваются за 2,5 часа и время, чтобы засеять все базы данных (220 ГБ/час)|
|Update |Вычислить экземпляра (vCores) масштабирование вверх и вниз (Общая цель)|- Виртуальная переразмерная величина кластера<br>- Присоединение файлов базы данных|90% операций заканчиваются за 2,5 часа|
|Update |Вычислить экземпляра (vCores) масштабирование вверх и вниз (Критический бизнес)|- Виртуальная переразмерная величина кластера<br>- Всегда на наличие группы посева|90% операций заканчиваются за 2,5 часа и время, чтобы засеять все базы данных (220 ГБ/час)|
|Update |Масштаб instanceа вниз до 4 vCores (Общая цель)|- Виртуальная резначитизация кластера (если это сделано в первый раз, это может потребовать создания виртуального кластера)<br>- Присоединение файлов базы данных|90% операций заканчиваются в 4 ч 5 мин|
|Update |Масштаб instanceа вниз до 4 vCores (Критический бизнес)|- Виртуальная резначитизация кластера (если это сделано в первый раз, это может потребовать создания виртуального кластера)<br>- Всегда на наличие группы посева|90% операций заканчиваются за 4 часа и время, чтобы засеять все базы данных (220 ГБ /час)|
|Update |Изменение уровня обслуживания экземпляров (Общая цель для критических для бизнеса и наоборот)|- Виртуальная переразмерная величина кластера<br>- Всегда на наличие группы посева|90% операций заканчиваются за 2,5 часа и время, чтобы засеять все базы данных (220 ГБ/час)|
|**Удаления**|Удаление экземпляра|Резервное копирование хвоста входа для всех баз данных|90% операций заканчиваются до 1 минуты.<br>Примечание: если последний экземпляр в подсети удален, эта операция запланирует удаление виртуального кластера через 12 часов.|
|Удаление|Виртуальное удаление кластера (как операция, инициированная пользователем)|Виртуальное удаление кластера|90% операций заканчиваются в течение 1,5 часов|

\*Виртуальный кластер строится на аппаратное поколение.

\*\*Вариант развертывания 4 vCores был выпущен в июне 2019 года и требует новой виртуальной кластерной версии. Если в целевой подсети были экземпляры, которые были созданы до 12 июня, новый виртуальный кластер будет автоматически развернут для размещения 4 экземпляров vCore.

\*\*\*12 часов — это текущая конфигурация, но она может измениться в будущем, так что не принимайте на нее твердую зависимость. Если вам нужно удалить виртуальный кластер раньше (например, для выпуска подсети), [см. Удалить подсеть после удаления управляемого экземпляра базы данных Azure S'L.](sql-database-managed-instance-delete-virtual-cluster.md)

### <a name="instance-availability-during-management"></a>Доступность инстанций во время управления

Управляемые экземпляры недоступны для клиентских приложений во время операций развертывания и удаления.

Управляемые экземпляры доступны во время операций обновления, но есть короткое время простоя, вызванное сбой, что происходит в конце обновления, которые обычно длится до 10 секунд. Исключением является обновление зарезервированного места для хранения в уровне службы общего назначения, которое не приводит к сбою и не влияет на доступность экземпляра.

> [!IMPORTANT]
> Продолжительность сбоя может значительно варьироваться в случае длительных транзакций, которые происходят в базах данных из-за [длительного времени восстановления.](sql-database-accelerated-database-recovery.md#the-current-database-recovery-process) Поэтому не рекомендуется масштабировать вычисление или хранение управляемой базы данных Azure s'L или менять уровень обслуживания одновременно с длительными транзакциями (импорт данных, задания обработки данных, восстановление индекса и т.д.). Сбой базы данных, который будет выполнен в конце операции, отменит текущие транзакции и приведет к длительному времени восстановления.

> [!TIP]
> Обновление зарезервированного места для хранения в уровне службы общего назначения не повлекает за собой сбой и не влияет на доступность экземпляра.

[Ускоренное восстановление базы данных](sql-database-accelerated-database-recovery.md) в настоящее время недоступно для управляемых экземпляров базы данных Azure S'L. После включения эта функция значительно снизит изменчивость сбоя времени, даже в случае длительных транзакций.

### <a name="canceling-management-operations"></a>Отмена управленческих операций

В следующей таблице кратко излагается возможность отмены конкретных операций управления и типичных общих длительностей:

Категория  |Операция  |Отменяемым  |Предполагаемая продолжительность отмены  |
|---------|---------|---------|---------|
|Развертывание |Создание экземпляров |нет |  |
|Update |Масштабирование экземпляров вверх/вниз (Общая цель) |нет |  |
|Update |Масштабирование экземпляров вверх/вниз (критический для бизнеса) |Да |90% операций заканчиваются за 5 минут |
|Update |Вычислить экземпляра (vCores) масштабирование вверх и вниз (Общая цель) |Да |90% операций заканчиваются за 5 минут |
|Update |Вычислить экземпляра (vCores) масштабирование вверх и вниз (Критический бизнес) |Да |90% операций заканчиваются за 5 минут |
|Update |Изменение уровня обслуживания экземпляров (Общая цель для критических для бизнеса и наоборот) |Да |90% операций заканчиваются за 5 минут |
|DELETE |Удаление экземпляра |нет |  |
|DELETE |Виртуальное удаление кластера (как операция, инициированная пользователем) |нет |  |

Для того, чтобы отменить операцию управления, перейдите на лезвие обзора и нажмите на поле уведомлений о текущей работе. С правой стороны появится экран с текущей операцией и будет кнопка для отмены операции. После первого клика вам будет предложено нажать еще раз и подтвердить, что вы хотите отменить операцию.

[![](./media/sql-database-managed-instance/canceling-operation.png)](./media/sql-database-managed-instance/canceling-operation.png#lightbox)

После того, как запрос на отмену был отправлен и обработан, вы получите уведомление, если отправка отмены была успешной или нет. 

В случае отмены успеха, работа управления будет отменена в течение нескольких минут, что приведет к сбою.

![отмена результата операции](./media/sql-database-managed-instance/canceling-operation-result.png)

Если сбой запроса на отмену или кнопка отмены не активна, это означает, что операция управления вошла не отменяемое состояние и что она завершится через пару минут. Управление будет продолжать выполняться до тех пор, пока она не будет завершена.

> [!IMPORTANT]
> Отмена операции в настоящее время поддерживается только в Portal.

## <a name="advanced-security-and-compliance"></a>Расширенный уровень безопасности и соответствие требованиям

Вариант развертывания в виде управляемого экземпляра сочетает в себе расширенные функции безопасности, предоставляемые облаком Azure и ядром СУБД SQL Server.

### <a name="managed-instance-security-isolation"></a>Обеспечение защиты управляемого экземпляра путем изоляции

Управляемый экземпляр предоставляет дополнительную защиту путем изоляции от других клиентов в облаке Azure. Для обеспечения защиты путем изоляции необходимо следующее.

- [Реализация виртуальной сети и](sql-database-managed-instance-connectivity-architecture.md) подключение к вашей предварительной среде с помощью Azure Express Route или VPN Gateway.
- В развертывании по умолчанию конечная точка S'L подвергается воздействию только через частный IP-адрес, что позволяет безопасно ещё подсажять частные сети Azure или гибридные сети.
- Отдельный клиент с выделенной базовой инфраструктурой (вычислений, хранения).

На следующей схеме показаны различные варианты подключения для приложений:

![высокий уровень доступности](./media/sql-database-managed-instance/application-deployment-topologies.png)  

Чтобы получить дополнительные сведения об интеграции виртуальной сети и политике сети на уровне подсети, ознакомьтесь со статьями [Архитектура подключения к Управляемому экземпляру Базы данных SQL Azure](sql-database-managed-instance-connectivity-architecture.md) и [Подключение приложения к Управляемому экземпляру Базы данных SQL](sql-database-managed-instance-connect-app.md).

> [!IMPORTANT]
> Поместите несколько управляемых экземпляров в той же подсети, везде, где это разрешено требованиями к безопасности, так как это создаст дополнительные преимущества. Выделение экземпляров в одной и той же подсети значительно упростит обслуживание сетевой инфраструктуры и сократит время подготовки экземпляра, так как длительное предоставление ресурсов связано с затратами на развертывание первого управляемого экземпляра в подсети.

### <a name="azure-sql-database-security-features"></a>Возможности безопасности Базы данных SQL Azure

База данных SQL Azure предоставляет набор расширенных функций безопасности, которые можно использовать для защиты данных.

- [Управляемый аудит экземпляра](sql-database-managed-instance-auditing.md) отслеживает события базы данных и записывает их в файл журнала аудита, размещенный в учетной записи хранения Azure. Аудит может помочь соблюдать стандарты, проанализировать работу с базой данных и получить представление о расхождениях и аномалиях, которые могут указывать на бизнес-проблемы или предполагаемые нарушения безопасности.
- Шифрование данных при передаче: управляемый экземпляр защищает данные, шифруя их при передаче с помощью протокола TLS. В дополнение к применению протокола TLS вариант развертывания в виде управляемого экземпляра обеспечивает защиту конфиденциальных данных в процессе использования, при хранении и во время обработки запроса с помощью функции [Always Encrypted](/sql/relational-databases/security/encryption/always-encrypted-database-engine). Функция Always Encrypted — первая в отрасли функция, которая предлагает непревзойденную защиту данных от взлома, включая кражу чрезвычайно важных данных. Например, функция Always Encrypted дает возможность всегда хранить в базе данных номера кредитных карт в зашифрованном виде, даже во время обработки запроса, позволяя авторизованному персоналу или обрабатывающему их приложению расшифровывать их только в момент использования.
- [Advanced Threat Protection](sql-database-managed-instance-threat-detection.md) дополняет [аудит, предоставляя](sql-database-managed-instance-auditing.md) дополнительный уровень безопасности, встроенный в службу, который обнаруживает необычные и потенциально опасные попытки получить доступ к базам данных или использовать их. Вы получаете оповещения о подозрительных действиях, потенциальных уязвимостях, атаках путем внедрения кода SQL и аномальных закономерностях в доступе к базам данных. Расширенные оповещения о защите угроз можно просматривать из [Центра безопасности Azure](https://azure.microsoft.com/services/security-center/) и предоставлять подробную информацию о подозрительной деятельности и рекомендовать действия по расследованию и уменьшению угрозы.  
- [Динамическое маскировка данных](/sql/relational-databases/security/dynamic-data-masking) ограничивает конфиденциальное воздействие данных, маскируя их для непривилегированных пользователей. Динамическое маскирование данных помогает предотвратить несанкционированный доступ к конфиденциальным данным, позволяя вам самостоятельно определить, какой объем конфиденциальных данных следует раскрывать с минимальным влиянием на уровне приложения. Эта функция безопасности на основе политики скрывает конфиденциальные данные в результирующем наборе запроса в заданных полях базы данных, а данные в базе данных не меняются.
- [Безопасность на уровне строк](/sql/relational-databases/security/row-level-security) позволяет управлять доступом к строкам в таблице базы данных в зависимости от характеристик пользователя, выполняющего запрос (например, членство в группе или контекст выполнения). Безопасность на уровне строк (RLS) упрощает проектирование и программирование безопасности в приложении. RLS позволяет реализовать ограничения доступа к строкам данных. Например, обеспечьте сотрудникам доступ только к тем строкам данных, которые имеют отношение к их отделу, или только к тем данным, которые относятся к ним.
- [Прозрачное шифрование данных (TDE)](https://docs.microsoft.com/sql/relational-databases/security/encryption/transparent-data-encryption-azure-sql) позволяет шифровать файлы данных управляемого экземпляра. Это называется шифрованием неактивных данных. Функция прозрачного шифрования данных выполняет шифрование и дешифрование ввода-вывода в реальном времени для файлов данных и журналов. При шифровании используется ключ шифрования базы данных (DEK), который хранится в загрузочной записи базы данных, где можно получить к нему доступ при восстановлении. Вы можете защитить все свои базы данных в управляемом экземпляре с помощью прозрачного шифрования данных. Прозрачное шифрование данных — это надежная технология шифрования данных на месте SQL Server, требуемая многими стандартами соответствия для защиты носителя данных от кражи.

Перемещение зашифрованной базы данных в управляемый экземпляр поддерживается через службу Azure Database Migration Service (DMS) или собственное восстановление. Если вы планируете перенести зашифрованную базу данных с помощью нативной восстановления, миграция существующего сертификата TDE с сервера S'L Server в виртуальном компьютере в управляемый экземпляр является необходимым шагом. Дополнительные сведения о параметрах перемещения см. в статье [Перенос экземпляра SQL Server в Управляемый экземпляр Базы данных SQL Azure](sql-database-managed-instance-migrate.md).

## <a name="azure-active-directory-integration"></a>Интеграция с Azure Active Directory

Вариант развертывания в виде управляемого экземпляра поддерживает стандартный вход СУБД SQL Server и вход, интегрированный с Azure Active Directory (AAD). Субъекты сервера (имена для входа) Azure AD (**предварительная версия**) представляют собой облачную версию Azure локальных имен для входа базы данных, которые вы используете в своей локальной среде. Принципы серверов AD Azure AD (логины) позволяют указывать пользователям и группам из вашего арендатора Active Directory Azure в качестве истинных основных принципов instance-scoped, способных выполнять любые операции на уровне экземпляров, включая запросы кросс-базы данных в рамках одного и того же управляемого Экземпляр.

Для создания принципов серверов Azure AD (логинов) **FROM EXTERNAL PROVIDER**вводится новый синтаксис. Для получения дополнительной информации о синтаксисе см. <a href="/sql/t-sql/statements/create-login-transact-sql?view=azuresqldb-mi-current">CREATE LOGIN</a>и [просмотрении положения об элементе управления Active Directory Azure для вашей статьи управляемого экземпляра.](sql-database-aad-authentication-configure.md#provision-an-azure-active-directory-administrator-for-your-managed-instance)

### <a name="azure-active-directory-integration-and-multi-factor-authentication"></a>Интеграция Azure Active Directory и Многофакторная идентификация

Вариант развертывания в виде управляемого экземпляра позволяет централизованно управлять удостоверениями пользователя базы данных и другими службами Майкрософт с помощью [интеграции Azure Active Directory](sql-database-aad-authentication.md). Эта возможность упростила управление разрешениями и повысила уровень безопасности. Azure Active Directory поддерживает [Многофакторную идентификацию](sql-database-ssms-mfa-authentication-configure.md) (MFA) для повышения безопасности данных и приложений, поддерживая процесс единого входа.

### <a name="authentication"></a>Проверка подлинности

В процессе проверки подлинности управляемого экземпляра пользователям предлагается подтвердить их личность при подключении к базе данных. База данных SQL поддерживает два типа аутентификации:  

- **Проверка подлинности СЗЛ**:

  Это метод аутентификации с использованием имени пользователя и пароля.
- **Активная аутентификация каталогов Azure**:

  Это метод аутентификации с использованием удостоверений, контролируемых Azure Active Directory, которая поддерживается управляемыми и интегрированными доменами. [По возможности](https://docs.microsoft.com/sql/relational-databases/security/choose-an-authentication-mode) используйте проверку подлинности Active Directory (встроенная безопасность).

### <a name="authorization"></a>Авторизация

Процесс проверки подлинности включает в себя набор действий, которые пользователь может выполнять в базе данных SQL Azure. Этот набор действий определяется принадлежностью учетной записи пользователя к ролям базы данных и разрешениями на уровне объектов. Управляемый экземпляр имеет такие же возможности авторизации, что и SQL Server 2017.

## <a name="database-migration"></a>Перенос баз данных

Вариант развертывания в виде управляемого экземпляра предназначен для пользовательских сценариев, требующих массового переноса баз данных из реализаций локальной базы данных или базы данных IaaS. Управляемый экземпляр поддерживает несколько вариантов переноса базы данных.

### <a name="back-up-and-restore"></a>Резервное копирование и восстановление  

При перемещении используются резервные копии SQL, сохраненные в хранилище BLOB-объектов Azure. Резервные копии, хранимые в хранилище BLOB-объектов Azure, можно восстановить непосредственно в управляемый экземпляр с помощью [команды T-SQL RESTORE](https://docs.microsoft.com/sql/t-sql/statements/restore-statements-transact-sql?view=azuresqldb-mi-current).

- Для быстрого запуска, показывающего, как восстановить файл резервного копирования wide World - Standard database, [см.](sql-database-managed-instance-get-started-restore.md) Этот быстрый запуск показывает, что вы должны загрузить файл резервного копирования в хранилище Azure blob и защитить его с помощью ключа общей подписи доступа (SAS).
- Сведения о восстановлении из URL-адреса см. в разделе [Исходное восстановление из URL-адреса](sql-database-managed-instance-migrate.md#native-restore-from-url).

> [!IMPORTANT]
> Резервные копии из управляемого экземпляра можно восстановить только в другом управляемом экземпляре. Их нельзя восстановить на локальном сервере SQL Server или в отдельной базе данных или эластичном пуле.

### <a name="data-migration-service"></a>Служба миграции данных

Azure Database Migration Service — это полностью управляемая служба, которая выполняет непрерывную миграцию из множества источников баз данных на платформы данных Azure с минимальным временем простоя. Эта служба упрощает выполнение задач, необходимых для перемещения имеющихся сторонних баз данных и баз данных SQL Server в Базу данных SQL Azure (отдельные базы данных, базы данных в эластичных пулах и экземпляры баз данных в управляемом экземпляре) и SQL Server на виртуальной машине Azure. Дополнительные сведения см. статье [Руководство. Перенос SQL Server в Управляемый экземпляр Базы данных SQL Azure с помощью DMS в автономном режиме](https://aka.ms/migratetoMIusingDMS).

## <a name="sql-features-supported"></a>Поддерживаемые функции SQL

До выхода общедоступной версии службы вариант развертывания в виде управляемого экземпляра будет предоставлять совместимость с локальным SQL Server на уровне практически 100 %. Эта совместимость будет реализовываться поэтапно. Для списка функций и сравнения см. [сравнение функций базы данных,](sql-database-features.md)а также список различий в управляемых экземплярах по сравнению с сервером [S-L,](sql-database-managed-instance-transact-sql-information.md)см.

Вариант развертывания в виде управляемого экземпляра поддерживает обратную совместимость с базами данных SQL 2008. Поддерживается прямой перенос из серверов баз данных SQL 2005. Уровень совместимости для перенесенных баз данных SQL 2005 обновлен до версии SQL 2008.
  
На следующей схеме показана совместимость в управляемом экземпляре.  

![Миграция](./media/sql-database-managed-instance/migration.png)

### <a name="key-differences-between-sql-server-on-premises-and-in-a-managed-instance"></a>Основные различия между локальным SQL Server и управляемым экземпляром

Вариант развертывания в виде управляемого экземпляра всегда обновлен в облаке. Это означает, что некоторые компоненты локального SQL Server могут быть устаревшими, снятыми с учета или же вместо них можно использовать альтернативные варианты. Есть конкретные случаи, когда инструменты должны признать, что та или иная функция работает несколько иначе или что служба работает в среде, которую вы не полностью контролируете:

- Высокий уровень доступности встроен и предварительно настроен с помощью технологии, аналогичной [группам доступности AlwaysOn](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/always-on-availability-groups-sql-server).
- Автоматическое резервное копирование и восстановление состояния системы до определенной точки во времени. Клиент может инициировать резервные копирования `copy-only`, которые не препятствуют работе автоматической цепочки резервных копий.
- Управляемый экземпляр не позволяет указывать полные физические пути, поэтому все соответствующие сценарии должны поддерживаться по-разному: RESTORE DB не поддерживает С ИМУЭ, CREATE DB не разрешает физические пути, BULK INSERT работает только с Azure Blobs и т.д.
- Управляемый экземпляр поддерживает [аутентификацию Azure AD](sql-database-aad-authentication.md) как альтернативу проверке подлинности Windows.
- Управляемый экземпляр автоматически управляет файловыми группами и файлами с механизмом XTP для баз данных, содержащих объекты выполняющейся в памяти OLTP.
- Управляемый экземпляр поддерживает службы интеграции серверов S'L Server (SSIS) и может размещать каталог SSIS (SSISDB), который хранит пакеты SSIS, но они выполняются на управляемом Runtime интеграции Azure-SSIS (IR) на фабрике данных Azure (ADF), [см. Создать Azure-SSIS IR в ADF.](https://docs.microsoft.com/azure/data-factory/create-azure-ssis-integration-runtime) Для сравнения функций SSIS в базе данных S'L [см. Сравнить единую базу данных базы данных Azure S'L, эластичный пул и управляемый экземпляр.](../data-factory/create-azure-ssis-integration-runtime.md#comparison-of-a-sql-database-single-database-elastic-pool-and-managed-instance)

### <a name="managed-instance-administration-features"></a>Возможности администрирования управляемого экземпляра

Вариант развертывания в виде управляемого экземпляра позволяет системному администратору тратить меньше времени на административные задачи, так как служба Базы данных SQL либо выполняет их за вас, либо значительно упрощает эти задачи. Например, [установка и исправление OS/ RDBMS,](sql-database-high-availability.md) [динамическое изгабадирование и конфигурация экземпляра,](sql-database-single-database-scale.md) [резервное копирование,](sql-database-automated-backups.md) [репликация баз данных](replication-with-sql-database-managed-instance.md) (включая системные базы данных), [конфигурация высокой доступности](sql-database-high-availability.md)и конфигурация потоков данных мониторинга работоспособности и [производительности.](../azure-monitor/insights/azure-sql.md)

> [!IMPORTANT]
> Список поддерживаемых, частично поддерживаемых и неподдерживаемых функций см. в статье [Сравнение функций Базы данных SQL Azure и SQL Server](sql-database-features.md). Для списка различий в т-СЗЛ в управляемых [managed instance T-SQL differences from SQL Server](sql-database-managed-instance-transact-sql-information.md) экземплярах по сравнению с сервером S'L см.

### <a name="how-to-programmatically-identify-a-managed-instance"></a>Программное определение управляемого экземпляра

В таблице ниже приведены некоторые свойства, доступные в Transact SQL, которые можно использовать, чтобы определить, работает ли приложение с управляемым экземпляром, а также узнать важные свойства.

|Свойство|Значение|Комментарий|
|---|---|---|
|`@@VERSION`|Microsoft SQL Azure (RTM) - 12.0.2000.8 2018-03-07 Copyright (C) 2018 Microsoft Corporation.|Это значение совпадает со значением в базе данных SQL. Это **не указывает** на версию двигателя 12 сsL (S'L Server 2014). Управляемый экземпляр всегда запускает последнюю стабильную версию двигателя S'L, которая равна или выше, чем последняя доступная версия RTM сервера S'L.  |
|`SERVERPROPERTY ('Edition')`|SQL Azure|Это значение совпадает со значением в базе данных SQL.|
|`SERVERPROPERTY('EngineEdition')`|8|Данное значение уникально идентифицирует управляемый экземпляр.|
|`@@SERVERNAME`, `SERVERPROPERTY ('ServerName')`|Полное DNS-имя экземпляра в формате `<instanceName>`.`<dnsPrefix>`.database.windows.net, где `<instanceName>` — имя, предоставленное клиентом, а `<dnsPrefix>` — автоматически формируемая часть имени, гарантируемая уникальность глобального DNS-имени (например, "wcus17662feb9ce98").|Пример: my-managed-instance.wcus17662feb9ce98.database.windows.net|

## <a name="next-steps"></a>Дальнейшие действия

- Чтобы узнать, как создать свой [Quickstart guide](sql-database-managed-instance-get-started.md)первый управляемый экземпляр, см.
- Сведения о функциях и список сравнения см. в статье [Сравнение функций Базы данных SQL Azure и SQL Server](sql-database-features.md).
- Для получения дополнительной информации [managed instance VNet configuration](sql-database-managed-instance-connectivity-architecture.md)о конфигурации VNet см.
- Для быстрого запуска, который создает управляемый экземпляр и восстанавливает базу [create a managed instance](sql-database-managed-instance-get-started.md)данных из файла резервного копирования, см.
- В учебнике, используемом миграционной службой базы данных Azure (DMS) для миграции, [см.](../dms/tutorial-sql-server-to-managed-instance.md)
- Для расширенного мониторинга производительности управляемой базы данных экземпляров со встроенным интеллектом для устранения неполадок [см.](../azure-monitor/insights/azure-sql.md)
- Для получения информации о ценах [см.](https://azure.microsoft.com/pricing/details/sql-database/managed/)
