---
title: Общие сведения об управляемом экземпляре SQL
description: В этой статье описывается управляемый экземпляр базы данных SQL Azure.
services: sql-database
ms.service: sql-database
ms.subservice: managed-instance
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: bonova
ms.author: bonova
ms.reviewer: sstein, carlrab, vanto
ms.date: 01/21/2020
ms.openlocfilehash: b9fdd1b25e53e1cdc8aa76564304a61adaa8d804
ms.sourcegitcommit: 333af18fa9e4c2b376fa9aeb8f7941f1b331c11d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/13/2020
ms.locfileid: "77201600"
---
# <a name="what-is-azure-sql-database-managed-instance"></a>Что такое управляемый экземпляр базы данных SQL Azure?

Управляемый экземпляр является новой моделью развертывания базы данных SQL Azure. Она обеспечивает практически полную совместимость с последним ядром СУБД локальной версии SQL Server (Enterprise Edition), предоставляя собственную реализацию [виртуальной сети](../virtual-network/virtual-networks-overview.md), устраняющую распространенные проблемы безопасности и [бизнес-модель](https://azure.microsoft.com/pricing/details/sql-database/), подходящую для клиентов локальной версии SQL Server. Модель развертывания "Управляемый экземпляр" позволяет существующим клиентам SQL Server переместить их локальные приложения в облако методом lift-and-shift с минимальными изменениями приложения и базы данных. При этом эта модель развертывания сохраняет все возможности PaaS (автоматическое исправление и обновление версии, [автоматическое резервное копирование](sql-database-automated-backups.md), [высокий уровень доступности](sql-database-high-availability.md)), что значительно снижает расходы на управление и совокупную стоимость владения.

> [!IMPORTANT]
> Список регионов, в которых в настоящее время доступен вариант развертывания "Управляемый экземпляр", см. в разделе [Поддерживаемые регионы](sql-database-managed-instance-resource-limits.md#supported-regions).

На следующем рисунке показаны основные возможности управляемого экземпляра:

![Основные возможности](./media/sql-database-managed-instance/key-features.png)

Модель развертывания в виде управляемого экземпляра предназначена для клиентов, которые хотят перенести большое количество приложений из локальной среды или среды IaaS, самостоятельно созданной среды или среды, предоставленной ISV, в полностью управляемую облачную среду PaaS с минимальными усилиями. С помощью полностью автоматизированной службы [Data Migration Service (DMS)](../dms/tutorial-sql-server-to-managed-instance.md#create-an-azure-database-migration-service-instance) в Azure клиенты могут методом lift-and-shift переносить локальный экземпляр SQL Server на управляемый экземпляр, который обеспечивает совместимость с SQL Server в локальной среде и полную изоляцию экземпляров клиента с поддержкой собственной виртуальной сети.  С помощью программы Software Assurance вы можете обмениваться существующими лицензиями для использования со скидками на управляемом экземпляре, используя [преимущество гибридного использования Azure для SQL Server](https://azure.microsoft.com/pricing/hybrid-benefit/).  Управляемый экземпляр — лучший целевой объект миграции в облаке для экземпляров SQL Server, требующих высокого уровня безопасности и расширенных возможностей программирования.

Вариант развертывания в виде управляемого экземпляра будет обеспечивать совместимость с последней версией локального SQL Server на уровне практически 100 % (предусмотрен многоэтапный план выпуска).

Чтобы выбрать между вариантом развертывания в виде отдельной базы данных, базы данных в пуле и управляемого экземпляра Базы данных SQL Azure, а также в SQL Server на виртуальной машине, ознакомьтесь со статьей [Выбор правильного варианта SQL Server в Azure — PaaS или IaaS](sql-database-paas-vs-sql-server-iaas.md).

## <a name="key-features-and-capabilities"></a>Основные функции и возможности

Управляемый экземпляр сочетает в себе лучшие функции, доступные в Базе данных SQL Azure и ядре СУБД SQL Server.

> [!IMPORTANT]
> Управляемый экземпляр поддерживает все функции последней версии SQL Server, включая операции в сети, автоматическое исправление планов и другие усовершенствования для повышения производительности организации. Сравнение доступных функций приведено в разделе [Сравнение функций Базы данных SQL Azure и SQL Server](sql-database-features.md).

| **Преимущества PaaS** | **Непрерывность бизнес-процессов** |
| --- | --- |
|Нет необходимости в приобретении оборудования и управления им <br>Отсутствие накладных расходов на управление базовой инфраструктурой <br>Быстрая подготовка и масштабирование службы <br>Автоматическое исправление и обновление версии <br>Интеграция с другими службами данных PaaS |Соглашение об уровне обслуживания с гарантией времени непрерывной работы 99,99 %.  <br>Встроенный [высокий уровень доступности](sql-database-high-availability.md) <br>Данные защищены путем [автоматического создания резервных копий](sql-database-automated-backups.md) <br>Период хранения резервных копий настраивается пользователем <br>Инициируемые пользователем [резервные копии](https://docs.microsoft.com/sql/t-sql/statements/backup-transact-sql?view=azuresqldb-mi-current) <br>Возможность [восстановления базы данных до точки во времени](sql-database-recovery-using-backups.md#point-in-time-restore) |
|**Безопасность и соответствие требованиям** | **Управление**|
|Изолированная среда ([интеграция виртуальной сети](sql-database-managed-instance-connectivity-architecture.md), клиентская служба, выделенные ресурсы вычисления и хранилище) <br>[Прозрачное шифрование данных (TDE)](https://docs.microsoft.com/sql/relational-databases/security/encryption/transparent-data-encryption-azure-sql)<br>[Проверка подлинности Azure AD](sql-database-aad-authentication.md), поддержка единого входа <br> <a href="/sql/t-sql/statements/create-login-transact-sql?view=azuresqldb-mi-current">Участники сервера Azure AD (имена для входа)</a>  <br>Соблюдение тех же стандартов соответствия, что и База данных SQL Azure <br>[Аудит SQL](sql-database-managed-instance-auditing.md) <br>[Расширенная защита от угроз](sql-database-managed-instance-threat-detection.md) |Программный интерфейс Azure Resource Manager для автоматизации подготовки и масштабирования службы <br>Функциональные возможности портала Azure для подготовки и масштабирования службы вручную <br>Служба миграции данных

> [!IMPORTANT]
> База данных SQL Azure (все варианты развертывания) сертифицирована по рядам стандартов соответствия. Дополнительные сведения см. в [центре управления безопасностью Microsoft Azure](https://gallery.technet.microsoft.com/Overview-of-Azure-c1be3942) , где можно найти самый актуальный список сертификатов соответствия базы данных SQL.

В следующей таблице показаны основные возможности управляемого экземпляра.

|Компонент | Описание|
|---|---|
| Версия и сборка SQL Server | Ядро СУБД SQL Server (последняя стабильная версия) |
| Управляемые, автоматически создаваемые резервные копии | Да |
| Встроенный мониторинг и метрики базы данных и экземпляра | Да |
| Автоматическое применение исправления программного обеспечения | Да |
| Новейшие функции ядра СУБД | Да |
| Число файлов данных (ROWS) в одной базе данных | Несколько |
| Число файлов журнала (LOG) в одной базе данных | 1 |
| Виртуальная сеть — развертывание Azure Resource Manager | Да |
| Виртуальная сеть — классическая модель развертывания | Нет |
| Поддержка портала | Да|
| Встроенная служба интеграции (службы SSIS) | Нет. Службы SSIS входят в [PaaS Фабрики данных Azure](https://docs.microsoft.com/azure/data-factory/tutorial-deploy-ssis-packages-azure). |
| Встроенные службы Analysis Services (службы SSAS) | Нет. Службы SSAS являются отдельным решением [PaaS](https://docs.microsoft.com/azure/analysis-services/analysis-services-overview). |
| Встроенная служба отчетов (SSRS) | Нет. Используйте Power BI или IaaS SSRS. |
|||

## <a name="vcore-based-purchasing-model"></a>Модель приобретения на основе виртуальных ядер

[Модель приобретения на основе виртуальных ядер](sql-database-service-tiers-vcore.md) в управляемом экземпляре обеспечивает больше гибкости, контроля и прозрачности. Это простой способ перенести свои требования к локальной рабочей нагрузке в облако. Эта модель позволяет изменять ресурсы ЦП, памяти и хранилища с учетом потребностей рабочих нагрузок. Модель Виртуальное ядро также может сэкономить до 55% на [Преимущество гибридного использования Azure SQL Server](https://azure.microsoft.com/pricing/hybrid-benefit/).

В модели на основе виртуальных ядер можно выбрать поколение оборудования.

- **Го поколения** Логические процессоры основаны на процессорах Intel 2673 v3 (Haswell) с частотой 2,4 ГГц, подключенном SSD, физических ядрах, 7 ГБ ОЗУ на ядро и вычислении размеров от 8 до 24 виртуальных ядер.
- **Го поколения** Логические процессоры основаны на процессорах Intel, 2673 V4 (Broadwell) 2,3-ГГц и Intel SP-8160 (Skylake), быстром SSD NVMe, логическом ядре с технологией Hyper-Threading и размерах вычислений от 4 до 80 ядер.

Дополнительные сведения о различиях между поколениями оборудования приведены в разделе [Характеристики поколения оборудования](sql-database-managed-instance-resource-limits.md#hardware-generation-characteristics).

## <a name="managed-instance-service-tiers"></a>Уровни служб управляемого экземпляра

Управляемый экземпляр доступен на двух уровнях служб:

- **Общее назначение**: предназначено для приложений с типичными требованиями к производительности и задержкам ввода-вывода.
- **Критически важный для бизнеса**: предназначен для приложений с низкими требованиями к задержкам ввода-вывода и минимальным влиянием базовых операций обслуживания на рабочую нагрузку.

Оба уровня служб гарантируют доступность на уровне 99,99 % и позволяют вам независимо выбирать размер хранилища и вычислительную емкость. Дополнительные сведения об архитектуре Базы данных SQL Azure с высоким уровнем доступности см. в статье [Высокая доступность и База данных SQL Azure](sql-database-high-availability.md).

### <a name="general-purpose-service-tier"></a>Уровень служб общего назначения

Ниже перечислены ключевые характеристики уровня служб общего назначения.

- Предназначен для большинства бизнес-приложений с обычными требованиями к производительности.
- Высокопроизводительное хранилище BLOB-объектов Azure (8 ТБ).
- Встроенный [высокий уровень доступности](sql-database-high-availability.md#basic-standard-and-general-purpose-service-tier-availability) на основе надежного хранилища BLOB-объектов Azure и [Azure Service Fabric](../service-fabric/service-fabric-overview.md).

Дополнительные сведения см. в статье об [уровне хранилища в ценовой категории "Общего назначения"](https://medium.com/azure-sqldb-managed-instance/file-layout-in-general-purpose-azure-sql-managed-instance-cf21fff9c76c), а также в статье с [рекомендациями по оптимизации производительности хранилища и вопросами, касающимися управляемых экземпляров (общего назначения)](https://blogs.msdn.microsoft.com/sqlcat/2018/07/20/storage-performance-best-practices-and-considerations-for-azure-sql-db-managed-instance-general-purpose/).

Дополнительные сведения о различиях между уровнями служб см. в разделе [Характеристики уровней служб](sql-database-managed-instance-resource-limits.md#service-tier-characteristics).

### <a name="business-critical-service-tier"></a>Уровень служб "Критически важный для бизнеса"

Уровень служб "Критически важный для бизнеса" предназначен для приложений с высокими требованиями к операциям ввода-вывода. Предлагает самую высокую отказоустойчивость к сбоям благодаря использованию нескольких изолированных реплик.

Ниже приведены основные характеристики уровня служб "Критически важный для бизнеса".

- Предназначен для бизнес-приложений с наибольшей производительностью и требованиями к высокой доступности
- поставляется со сверхбыстрым локальным SSD-хранилищем (до 1 ТБ при использовании поколения 4 и до 4 ТБ при использовании поколения 5);
- встроенный [высокий уровень доступности](sql-database-high-availability.md#premium-and-business-critical-service-tier-availability) на основе [групп доступности AlwaysOn](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/always-on-availability-groups-sql-server) и [Azure Service Fabric](../service-fabric/service-fabric-overview.md);
- встроенная дополнительная [реплика базы данных только для чтения](sql-database-read-scale-out.md), которую можно использовать для задач отчетности и других рабочих нагрузок только для чтения;
- [Выполняющаяся в памяти OLTP](sql-database-in-memory.md), которую можно использовать для рабочей нагрузки с требованиями высокой производительности.  

Дополнительные сведения о различиях между уровнями служб см. в разделе [Характеристики уровней служб](sql-database-managed-instance-resource-limits.md#service-tier-characteristics).


## <a name="managed-instance-management-operations"></a>Операции управления управляемыми экземплярами

База данных SQL Azure поддерживает операции управления, которые можно использовать для автоматического развертывания новых управляемых экземпляров и удаления ненужных, а также обновления их свойств. В этом разделе содержатся сведения об операциях управления и их типичных длительностей.

Для поддержки [развертываний в виртуальных сетях Azure (виртуальных сетей)](../virtual-network/virtual-network-for-azure-services.md#deploy-azure-services-into-virtual-networks) и обеспечения изоляции и безопасности для клиентов управляемый экземпляр использует [виртуальные кластеры](sql-database-managed-instance-connectivity-architecture.md#high-level-connectivity-architecture), которые представляют выделенный набор изолированных виртуальных машин, развернутых внутри подсети клиента. По сути, каждое развертывание управляемого экземпляра в пустой подсети приводит к созданию нового виртуального кластера.

Последующие операции с развернутыми управляемыми экземплярами также могут иметь влияние на его базовый виртуальный кластер. Это влияет на длительность операций управления, так как развертывание дополнительных виртуальных машин сопровождается накладными расходами, которые необходимо учитывать при планировании новых развертываний или обновлений существующих управляемых экземпляров.

Все операции управления можно классифицировать следующим образом:

- Развертывание экземпляра (создание нового экземпляра). 
- Обновление экземпляра (изменение свойств экземпляра, например виртуальных ядер или зарезервированное хранилище).
- Удаление экземпляра.

Как правило, операции с виртуальными кластерами имеют наибольшее значение. Длительность операций в виртуальных кластерах различается — ниже приведены значения, которые обычно можно рассчитывать на основе существующих данных телеметрии службы:

- Создание виртуального кластера. Это синхронный шаг в операциях управления экземпляром. **90% операций завершено за 4 часа**.
- Изменение размера виртуального кластера (расширение или сжатие). Расширение — это синхронный шаг, а сжатие выполняется асинхронно (без влияния на длительность операций управления экземпляром). **90% расширения кластера заканчиваются менее чем на 2,5 часов**.
- Удаление виртуального кластера. Удаление — это асинхронный шаг, но его также можно [инициировать вручную](sql-database-managed-instance-delete-virtual-cluster.md) в пустом виртуальном кластере. в этом случае он выполняется синхронно. **90% операций удаления виртуальных кластеров заканчивается через 1,5 часов**.

Кроме того, управление экземплярами может также включать одну из операций в размещенных базах данных, что приводит к более длительным длительностьм:

- Присоединение файлов базы данных из службы хранилища Azure. Это синхронный шаг, например вычисление (Виртуальное ядро) или масштабирование хранилища на уровне служб общего назначения. **90% этих операций завершается за 5 минут**.
- Always On заполнения группы доступности. Это синхронный шаг, например вычисление (Виртуальное ядро) или масштабирование хранилища на уровне служб критически важный для бизнеса, а также изменение уровня службы с общего назначения на критически важный для бизнеса (или наоборот). Длительность этой операции пропорциональна общему размеру базы данных, а также текущей активности базы данных (число активных транзакций). Операция базы данных при обновлении экземпляра может значительно отклонить общую длительность. **90% этих операций выполняется с 220 ГБ/ч или выше**.

В следующей таблице перечислены операции и типичные общие длительности.

|Категория  |Операция  |Долгосрочный сегмент  |Оценка длительности  |
|---------|---------|---------|---------|
|**Deployment** |Первый экземпляр в пустой подсети|Создание виртуального кластера|90% операций завершено за 4 часа|
|Развертывание |Первый экземпляр другого поколения оборудования в непустой подсети (например, первый экземпляр поколения 5 в подсети с экземплярами поколения 4)|Создание виртуального кластера *|90% операций завершено за 4 часа|
|Развертывание |Первое создание экземпляра 4 виртуальных ядер в пустой или непустой подсети|Создание виртуального кластера * *|90% операций завершено за 4 часа|
|Развертывание |Последующее создание экземпляра в непустой подсети (2-й, третий и т. д. экземпляр)|Изменение размера виртуального кластера|90% операций завершено за 2,5 ч|
|**Update** |Изменение свойства экземпляра (пароль администратора, имя входа AAD, флаг Преимущество гибридного использования Azure)|Н/Д|До 1 минуты|
|Обновить |Масштабирование хранилища экземпляров (уровень служб общего назначения)|Присоединение файлов базы данных|90% операций завершено за 5 минут|
|Обновить |Масштабирование хранилища экземпляров (уровень служб критически важный для бизнеса)|-Изменение размера виртуального кластера<br>-Always On заполнение группы доступности|90% операций завершено за 2,5 часов + время для заполнения всех баз данных (220 ГБ/ч)|
|Обновить |Вычисление экземпляра (виртуальных ядер) увеличение и уменьшение масштаба (общего назначения)|-Изменение размера виртуального кластера<br>— Присоединение файлов базы данных|90% операций завершено за 2,5 ч|
|Обновить |Вычисление экземпляра (виртуальных ядер) увеличение и уменьшение масштаба (критически важный для бизнеса)|-Изменение размера виртуального кластера<br>-Always On заполнение группы доступности|90% операций завершено за 2,5 часов + время для заполнения всех баз данных (220 ГБ/ч)|
|Обновить |Масштабирование экземпляра до 4 виртуальных ядер (общего назначения)|— Изменение размера виртуального кластера (если это сделано в первый раз, может потребоваться создание виртуального кластера * *)<br>— Присоединение файлов базы данных|90% операций завершено в 4 ч 5 мин * *|
|Обновить |Масштабирование экземпляра до 4 виртуальных ядер (критически важный для бизнеса)|— Изменение размера виртуального кластера (если это сделано в первый раз, может потребоваться создание виртуального кластера * *)<br>-Always On заполнение группы доступности|90% операций завершено за 4 часа + время на заполнение всех баз данных (220 Гб/час)|
|Обновить |Изменение уровня служб экземпляра (общего назначения для критически важный для бизнеса и наоборот)|-Изменение размера виртуального кластера<br>-Always On заполнение группы доступности|90% операций завершено за 2,5 часов + время для заполнения всех баз данных (220 ГБ/ч)|
|**Лежащие**|Удаление экземпляра|Резервное копирование заключительного фрагмента журнала для всех баз данных|90% операций завершается до 1 минуты.<br>Примечание. при удалении последнего экземпляра в подсети эта операция планирует удаление виртуального кластера через 12 часов * * *|
|Удаление|Удаление виртуального кластера (в качестве операции, инициированной пользователем)|Удаление виртуального кластера|90% операций завершено до 1,5 часов|

\* виртуальный кластер строится для каждого создания оборудования.

\*\* параметр развертывания 4 виртуальных ядер был выпущен в июне 2019 и требует новой версии виртуального кластера. Если у вас есть экземпляры в целевой подсети, которые были созданы до 12 июня, новый виртуальный кластер будет автоматически развернут для размещения 4 экземпляров Виртуальное ядро.

\*\*\* 12 часов — это текущая конфигурация, но это может измениться в будущем, поэтому не следует зависеть от нее. Если необходимо удалить виртуальный кластер ранее (например, освободить подсеть), см. раздел [Удаление подсети после удаления управляемого экземпляра базы данных SQL Azure](sql-database-managed-instance-delete-virtual-cluster.md).

### <a name="instance-availability-during-management"></a>Доступность экземпляра во время управления

Управляемые экземпляры недоступны для клиентских приложений во время операций развертывания и удаления.

Управляемые экземпляры доступны во время операций обновления, но существуют небольшие простои, вызванные отработкой отказа, которая происходит в конце обновлений, обычно длится до 10 секунд. Исключением является обновление зарезервированного пространства хранилища на уровне служб общего назначения, которое не вызывает отработку отказа и не влияет на доступность экземпляра.

> [!IMPORTANT]
> Длительность отработки отказа может значительно варьироваться в случае длительных транзакций, происходящих в базах данных из-за [длительного времени восстановления](sql-database-accelerated-database-recovery.md#the-current-database-recovery-process). Поэтому не рекомендуется масштабировать вычислительные ресурсы или хранилище управляемого экземпляра базы данных SQL Azure, а также изменять уровень служб одновременно с длительными транзакциями (импорт данных, задания обработки данных, перестроение индекса и т. д.). Отработка отказа базы данных, которая будет выполнена в конце операции, приведет к отмене текущих транзакций и приведет к длительному времени восстановления.

> [!TIP]
> Обновление зарезервированного пространства хранилища на уровне служб общего назначения не вызывает отработку отказа и не влияет на доступность экземпляра.

[Ускоренное восстановление базы данных](sql-database-accelerated-database-recovery.md) в настоящее время недоступно для управляемых экземпляров базы данных SQL Azure. После включения эта функция значительно сокращает изменчивость времени отработки отказа даже в случае долго выполняющихся транзакций.

### <a name="canceling-management-operations"></a>Отмена операций управления

В следующей таблице перечислены возможности отмены конкретных операций управления и типичных общих длительностей.

Категория  |Операция  |Отменяемого  |Предполагаемая длительность отмены  |
|---------|---------|---------|---------|
|Развертывание |Создание экземпляра |Нет |  |
|Обновить |Увеличение/уменьшение масштаба хранилища экземпляров (общего назначения) |Нет |  |
|Обновить |Увеличение/уменьшение масштаба хранилища экземпляров (критически важный для бизнеса) |Да |90% операций завершено за 5 минут |
|Обновить |Вычисление экземпляра (виртуальных ядер) увеличение и уменьшение масштаба (общего назначения) |Да |90% операций завершено за 5 минут |
|Обновить |Вычисление экземпляра (виртуальных ядер) увеличение и уменьшение масштаба (критически важный для бизнеса) |Да |90% операций завершено за 5 минут |
|Обновить |Изменение уровня служб экземпляра (общего назначения для критически важный для бизнеса и наоборот) |Да |90% операций завершено за 5 минут |
|Удаление |Удаление экземпляра |Нет |  |
|Удаление |Удаление виртуального кластера (в качестве операции, инициированной пользователем) |Нет |  |

Чтобы отменить операцию управления, перейдите в колонку "Обзор" и щелкните поле уведомления текущей операции. С правой стороны появится экран с текущей операцией, и появится кнопка для отмены операции. После первого щелчка вам будет предложено снова нажать кнопку и подтвердить, что вы хотите отменить операцию.

[![](./media/sql-database-managed-instance/canceling-operation.png)](./media/sql-database-managed-instance/canceling-operation.png#lightbox)

После отправки и обработки запроса на отмену будет получено уведомление, если отправка отменена успешно. 

В случае отмены операция управления будет отменена за несколько минут, что приведет к сбою.

![результат операции отмены](./media/sql-database-managed-instance/canceling-operation-result.png)

Если кнопка отменить запрос завершается сбоем или отмена неактивна, это означает, что операция управления перешла в состояние не отменяется и что она завершится за несколько минут. Операция управления продолжит выполнение до ее завершения.

> [!IMPORTANT]
> Операция отмены операции сейчас поддерживается только на портале.

## <a name="advanced-security-and-compliance"></a>Расширенный уровень безопасности и соответствие требованиям

Вариант развертывания в виде управляемого экземпляра сочетает в себе расширенные функции безопасности, предоставляемые облаком Azure и ядром СУБД SQL Server.

### <a name="managed-instance-security-isolation"></a>Обеспечение защиты управляемого экземпляра путем изоляции

Управляемый экземпляр предоставляет дополнительную защиту путем изоляции от других клиентов в облаке Azure. Для обеспечения защиты путем изоляции необходимо следующее.

- [Собственная реализованная виртуальная сеть](sql-database-managed-instance-connectivity-architecture.md) и подключение к локальной среде с помощью Azure Express Route или VPN-шлюза.
- В развертывании по умолчанию конечная точка SQL предоставляется только через частный IP-адрес, что обеспечивает возможность безопасного подключения из частных или гибридных сетей Azure.
- Отдельный клиент с выделенной базовой инфраструктурой (вычислений, хранения).

На следующей схеме показаны различные варианты подключения для приложений:

![высокий уровень доступности](./media/sql-database-managed-instance/application-deployment-topologies.png)  

Чтобы получить дополнительные сведения об интеграции виртуальной сети и политике сети на уровне подсети, ознакомьтесь со статьями [Архитектура подключения к Управляемому экземпляру Базы данных SQL Azure](sql-database-managed-instance-connectivity-architecture.md) и [Подключение приложения к Управляемому экземпляру Базы данных SQL](sql-database-managed-instance-connect-app.md).

> [!IMPORTANT]
> Поместите несколько управляемых экземпляров в той же подсети, везде, где это разрешено требованиями к безопасности, так как это создаст дополнительные преимущества. Выделение экземпляров в одной и той же подсети значительно упростит обслуживание сетевой инфраструктуры и сократит время подготовки экземпляра, так как длительное предоставление ресурсов связано с затратами на развертывание первого управляемого экземпляра в подсети.

### <a name="azure-sql-database-security-features"></a>Возможности безопасности Базы данных SQL Azure

База данных SQL Azure предоставляет набор расширенных функций безопасности, которые можно использовать для защиты данных.

- [Аудит управляемого экземпляра](sql-database-managed-instance-auditing.md) позволяет отслеживать события базы данных и записывать их в файл журнала аудита, размещенный в учетной записи хранения Azure. Аудит может помочь соблюдать стандарты, проанализировать работу с базой данных и получить представление о расхождениях и аномалиях, которые могут указывать на бизнес-проблемы или предполагаемые нарушения безопасности.
- Шифрование данных при передаче: управляемый экземпляр защищает данные, шифруя их при передаче с помощью протокола TLS. В дополнение к применению протокола TLS вариант развертывания в виде управляемого экземпляра обеспечивает защиту конфиденциальных данных в процессе использования, при хранении и во время обработки запроса с помощью функции [Always Encrypted](/sql/relational-databases/security/encryption/always-encrypted-database-engine). Функция Always Encrypted — первая в отрасли функция, которая предлагает непревзойденную защиту данных от взлома, включая кражу чрезвычайно важных данных. Например, функция Always Encrypted дает возможность всегда хранить в базе данных номера кредитных карт в зашифрованном виде, даже во время обработки запроса, позволяя авторизованному персоналу или обрабатывающему их приложению расшифровывать их только в момент использования.
- [Расширенная защита от угроз](sql-database-managed-instance-threat-detection.md) дополняет [Аудит](sql-database-managed-instance-auditing.md) , предоставляя дополнительный уровень логики безопасности, встроенный в службу, которая обнаруживает необычные и потенциально опасные попытки доступа к базам данных или их использования. Вы получаете оповещения о подозрительных действиях, потенциальных уязвимостях, атаках путем внедрения кода SQL и аномальных закономерностях в доступе к базам данных. Оповещения Advanced Threat Protection можно просмотреть в [центре безопасности Azure](https://azure.microsoft.com/services/security-center/) и предоставить сведения о подозрительной активности и получить рекомендации по исследованию и устранению угрозы.  
- [Динамическое маскирование данных](/sql/relational-databases/security/dynamic-data-masking) ограничивает возможность раскрытия конфиденциальных данных, маскируя их для обычных пользователей. Динамическое маскирование данных помогает предотвратить несанкционированный доступ к конфиденциальным данным, позволяя вам самостоятельно определить, какой объем конфиденциальных данных следует раскрывать с минимальным влиянием на уровне приложения. Эта функция безопасности на основе политики скрывает конфиденциальные данные в результирующем наборе запроса в заданных полях базы данных, а данные в базе данных не меняются.
- [Безопасность на уровне строк](/sql/relational-databases/security/row-level-security) позволяет управлять доступом к строкам в таблице базы данных в зависимости от характеристик пользователя, выполняющего запрос (например, членство в группе или контекст выполнения). Безопасность на уровне строк (RLS) упрощает проектирование и программирование безопасности в приложении. RLS позволяет реализовать ограничения доступа к строкам данных. Например, обеспечьте сотрудникам доступ только к тем строкам данных, которые имеют отношение к их отделу, или только к тем данным, которые относятся к ним.
- [Прозрачное шифрование данных (TDE)](https://docs.microsoft.com/sql/relational-databases/security/encryption/transparent-data-encryption-azure-sql) позволяет шифровать файлы данных управляемого экземпляра. Это называется шифрованием неактивных данных. Функция прозрачного шифрования данных выполняет шифрование и дешифрование ввода-вывода в реальном времени для файлов данных и журналов. При шифровании используется ключ шифрования базы данных (DEK), который хранится в загрузочной записи базы данных, где можно получить к нему доступ при восстановлении. Вы можете защитить все свои базы данных в управляемом экземпляре с помощью прозрачного шифрования данных. Прозрачное шифрование данных — это надежная технология шифрования данных на месте SQL Server, требуемая многими стандартами соответствия для защиты носителя данных от кражи.

Перемещение зашифрованной базы данных в управляемый экземпляр поддерживается через службу Azure Database Migration Service (DMS) или собственное восстановление. Если планируется миграция зашифрованной базы данных с помощью собственного восстановления, то необходимо выполнить миграцию существующего сертификата TDE из SQL Server локального или SQL Server на виртуальной машине в управляемый экземпляр. Дополнительные сведения о параметрах перемещения см. в статье [Перенос экземпляра SQL Server в Управляемый экземпляр Базы данных SQL Azure](sql-database-managed-instance-migrate.md).

## <a name="azure-active-directory-integration"></a>Интеграция с Azure Active Directory

Вариант развертывания в виде управляемого экземпляра поддерживает стандартный вход СУБД SQL Server и вход, интегрированный с Azure Active Directory (AAD). Субъекты сервера (имена для входа) Azure AD (**предварительная версия**) представляют собой облачную версию Azure локальных имен для входа базы данных, которые вы используете в своей локальной среде. Участники сервера Azure AD (имена входа) позволяют указывать пользователей и группы из клиента Azure Active Directory как истинные участники уровня экземпляра, способные выполнять любые операции на уровне экземпляра, включая запросы между базами данных в пределах одного управляемого вхождение.

Новый синтаксис вводится для создания участников сервера Azure AD (имен входа) **из внешнего поставщика**. Дополнительные сведения о синтаксисе см. в статье <a href="/sql/t-sql/statements/create-login-transact-sql?view=azuresqldb-mi-current">CREATE LOGIN (Transact-SQL)</a> и в статье [Подготовка администратора Azure Active Directory для управляемого экземпляра](sql-database-aad-authentication-configure.md#provision-an-azure-active-directory-administrator-for-your-managed-instance).

### <a name="azure-active-directory-integration-and-multi-factor-authentication"></a>Интеграция Azure Active Directory и Многофакторная идентификация

Вариант развертывания в виде управляемого экземпляра позволяет централизованно управлять удостоверениями пользователя базы данных и другими службами Майкрософт с помощью [интеграции Azure Active Directory](sql-database-aad-authentication.md). Эта возможность упростила управление разрешениями и повысила уровень безопасности. Azure Active Directory поддерживает [Многофакторную идентификацию](sql-database-ssms-mfa-authentication-configure.md) (MFA) для повышения безопасности данных и приложений, поддерживая процесс единого входа.

### <a name="authentication"></a>Аутентификация

В процессе проверки подлинности управляемого экземпляра пользователям предлагается подтвердить их личность при подключении к базе данных. База данных SQL поддерживает два типа аутентификации:  

- **Аутентификация SQL**.

  Это метод аутентификации с использованием имени пользователя и пароля.
- **Аутентификация Azure Active Directory**.

  Это метод аутентификации с использованием удостоверений, контролируемых Azure Active Directory, которая поддерживается управляемыми и интегрированными доменами. [По возможности](https://docs.microsoft.com/sql/relational-databases/security/choose-an-authentication-mode) используйте проверку подлинности Active Directory (встроенная безопасность).

### <a name="authorization"></a>Авторизация

Процесс проверки подлинности включает в себя набор действий, которые пользователь может выполнять в базе данных SQL Azure. Этот набор действий определяется принадлежностью учетной записи пользователя к ролям базы данных и разрешениями на уровне объектов. Управляемый экземпляр имеет такие же возможности авторизации, что и SQL Server 2017.

## <a name="database-migration"></a>Перенос баз данных

Вариант развертывания в виде управляемого экземпляра предназначен для пользовательских сценариев, требующих массового переноса баз данных из реализаций локальной базы данных или базы данных IaaS. Управляемый экземпляр поддерживает несколько вариантов переноса базы данных.

### <a name="back-up-and-restore"></a>Резервное копирование и восстановление  

При перемещении используются резервные копии SQL, сохраненные в хранилище BLOB-объектов Azure. Резервные копии, хранимые в хранилище BLOB-объектов Azure, можно восстановить непосредственно в управляемый экземпляр с помощью [команды T-SQL RESTORE](https://docs.microsoft.com/sql/t-sql/statements/restore-statements-transact-sql?view=azuresqldb-mi-current).

- Краткое руководство по восстановлению стандартного файла резервной копии базы данных Wide World Importers см. в статье [Краткое руководство. Восстановление базы данных в Управляемый экземпляр](sql-database-managed-instance-get-started-restore.md). В этом кратком руководстве показано, как передать файл резервной копии в хранилище BLOB-объектов Azure и защитить его с помощью ключа подписанного URL-адрес (SAS).
- Сведения о восстановлении из URL-адреса см. в разделе [Исходное восстановление из URL-адреса](sql-database-managed-instance-migrate.md#native-restore-from-url).

> [!IMPORTANT]
> Резервные копии из управляемого экземпляра можно восстановить только в другом управляемом экземпляре. Их нельзя восстановить на локальном сервере SQL Server или в отдельной базе данных или эластичном пуле.

### <a name="data-migration-service"></a>Служба миграции данных

Azure Database Migration Service — это полностью управляемая служба, которая выполняет непрерывную миграцию из множества источников баз данных на платформы данных Azure с минимальным временем простоя. Эта служба упрощает выполнение задач, необходимых для перемещения имеющихся сторонних баз данных и баз данных SQL Server в Базу данных SQL Azure (отдельные базы данных, базы данных в эластичных пулах и экземпляры баз данных в управляемом экземпляре) и SQL Server на виртуальной машине Azure. Дополнительные сведения см. статье [Руководство. Перенос SQL Server в Управляемый экземпляр Базы данных SQL Azure с помощью DMS в автономном режиме](https://aka.ms/migratetoMIusingDMS).

## <a name="sql-features-supported"></a>Поддерживаемые функции SQL

До выхода общедоступной версии службы вариант развертывания в виде управляемого экземпляра будет предоставлять совместимость с локальным SQL Server на уровне практически 100 %. Эта совместимость будет реализовываться поэтапно. Список отличий T-SQL между управляемыми экземплярами и SQL Server см. в [этой](sql-database-features.md) статье, а сравнение функций Базы данных SQL Azure и SQL Server доступно в [этой](sql-database-managed-instance-transact-sql-information.md) статье.

Вариант развертывания в виде управляемого экземпляра поддерживает обратную совместимость с базами данных SQL 2008. Поддерживается прямой перенос из серверов баз данных SQL 2005. Уровень совместимости для перенесенных баз данных SQL 2005 обновлен до версии SQL 2008.
  
На следующей схеме показана совместимость в управляемом экземпляре.  

![перенос](./media/sql-database-managed-instance/migration.png)

### <a name="key-differences-between-sql-server-on-premises-and-in-a-managed-instance"></a>Основные различия между локальным SQL Server и управляемым экземпляром

Вариант развертывания в виде управляемого экземпляра всегда обновлен в облаке. Это означает, что некоторые компоненты локального SQL Server могут быть устаревшими, снятыми с учета или же вместо них можно использовать альтернативные варианты. Существуют особые случаи, когда средствам необходимо определить, что конкретный компонент работает немного иначе или что служба работает в среде, которую вы не полностью контролируете:

- Высокий уровень доступности встроен и предварительно настроен с помощью технологии, аналогичной [группам доступности AlwaysOn](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/always-on-availability-groups-sql-server).
- Автоматическое резервное копирование и восстановление состояния системы до определенной точки во времени. Клиент может инициировать резервные копирования `copy-only`, которые не препятствуют работе автоматической цепочки резервных копий.
- Управляемый экземпляр не позволяет указывать полные физические пути, поэтому все соответствующие сценарии должны поддерживаться по-разному: инструкция RESTORE DB не поддерживает перемещение, создание базы данных не допускает физические пути, BULK INSERT работает только с большими двоичными объектами Azure и т. д.
- Управляемый экземпляр поддерживает [проверку подлинности Azure AD](sql-database-aad-authentication.md) в качестве облачной альтернативы проверке подлинности Windows.
- Управляемый экземпляр автоматически управляет файловыми группами и файлами с механизмом XTP для баз данных, содержащих объекты выполняющейся в памяти OLTP.
- Управляемый экземпляр поддерживает службы SQL Server Integration Services (SSIS). Он может размещать каталог SSIS (SSISDB), в котором хранятся пакеты SSIS, но эти пакеты выполняются в управляемой среде Azure SSIS Integration Runtime (IR) в службе "Фабрика данных Azure" (ADF) (см. руководство по [созданию Azure SSIS IR в ADF](https://docs.microsoft.com/azure/data-factory/create-azure-ssis-integration-runtime)). Сведения о сравнении функций служб SSIS в базе данных SQL см. в статье [Сравнение отдельной базы данных SQL Azure, эластичного пула и управляемого экземпляра](../data-factory/create-azure-ssis-integration-runtime.md#comparison-of-a-sql-database-single-database-elastic-pool-and-managed-instance).

### <a name="managed-instance-administration-features"></a>Возможности администрирования управляемого экземпляра

Вариант развертывания в виде управляемого экземпляра позволяет системному администратору тратить меньше времени на административные задачи, так как служба Базы данных SQL либо выполняет их за вас, либо значительно упрощает эти задачи. Например, [установка или исправление ОС и реляционной СУБД](sql-database-high-availability.md), [динамическое изменение размера и конфигурация экземпляра](sql-database-single-database-scale.md), [резервное копирование](sql-database-automated-backups.md), [репликация базы данных](replication-with-sql-database-managed-instance.md) (включая системные базы данных), [конфигурация высокого уровня доступности](sql-database-high-availability.md), конфигурация работоспособности и [наблюдение за производительностью](../azure-monitor/insights/azure-sql.md) потоков данных.

> [!IMPORTANT]
> Список поддерживаемых, частично поддерживаемых и неподдерживаемых функций см. в статье [Сравнение функций Базы данных SQL Azure и SQL Server](sql-database-features.md). Список отличий T-SQL между управляемыми экземплярами и SQL Server см. в [этой](sql-database-managed-instance-transact-sql-information.md) статье.

### <a name="how-to-programmatically-identify-a-managed-instance"></a>Программное определение управляемого экземпляра

В таблице ниже приведены некоторые свойства, доступные в Transact SQL, которые можно использовать, чтобы определить, работает ли приложение с управляемым экземпляром, а также узнать важные свойства.

|Свойство|Значение|Комментарий|
|---|---|---|
|`@@VERSION`|Microsoft SQL Azure (RTM) - 12.0.2000.8 2018-03-07 Copyright (C) 2018 Microsoft Corporation.|Это значение совпадает со значением в базе данных SQL. Это **не** означает, что ядро СУБД SQL версии 12 (SQL Server 2014). Управляемый экземпляр всегда запускает последнюю стабильную версию ядра SQL, которая равна или выше последней доступной RTM-версии SQL Server.  |
|`SERVERPROPERTY ('Edition')`|SQL Azure|Это значение совпадает со значением в базе данных SQL.|
|`SERVERPROPERTY('EngineEdition')`|8|Данное значение уникально идентифицирует управляемый экземпляр.|
|`@@SERVERNAME`, `SERVERPROPERTY ('ServerName')`|Полное DNS-имя экземпляра в формате `<instanceName>`.`<dnsPrefix>`.database.windows.net, где `<instanceName>` — имя, предоставленное клиентом, а `<dnsPrefix>` — автоматически формируемая часть имени, гарантируемая уникальность глобального DNS-имени (например, "wcus17662feb9ce98").|Пример: my-managed-instance.wcus17662feb9ce98.database.windows.net|

## <a name="next-steps"></a>Следующие шаги

- Сведения о создании первого управляемого экземпляра см. в [этом руководстве по началу работы](sql-database-managed-instance-get-started.md).
- Сведения о функциях и список сравнения см. в статье [Сравнение функций Базы данных SQL Azure и SQL Server](sql-database-features.md).
- Дополнительные сведения о настройке виртуальной сети для управляемого экземпляра базы данных SQL Azure см. в [этой статье](sql-database-managed-instance-connectivity-architecture.md).
- Сведения о создании управляемого экземпляра и восстановлении базы данных из файла резервной копии см. в [этой статье](sql-database-managed-instance-get-started.md).
- Сведения об использовании Azure Database Migration Service (DMS) для миграции см. в статье о [миграции SQL Server в управляемый экземпляр базы данных SQL Azure](../dms/tutorial-sql-server-to-managed-instance.md).
- Дополнительные сведения о производительности базы данных управляемого экземпляра с помощью встроенных средств аналитики по устранению неполадок см. в статье [мониторинг базы данных SQL Azure с использованием аналитика SQL Azure](../azure-monitor/insights/azure-sql.md).
- Информацию о ценах см. на странице [цен на управляемый экземпляр Базы данных SQL Azure](https://azure.microsoft.com/pricing/details/sql-database/managed/).
