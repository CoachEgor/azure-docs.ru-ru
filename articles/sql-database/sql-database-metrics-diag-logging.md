---
title: Настройка потокового экспорта метрик и журналов ресурсов
description: Узнайте, как настроить потоковое экспорт метрик и журналов ресурсов, включая интеллектуальный диагностический анализ из базы данных Azure S'L в пункт назначения по вашему выбору для хранения информации об использовании ресурсов и статистике выполнения запросов.
services: sql-database
ms.service: sql-database
ms.subservice: performance
ms.custom: seoapril2019
ms.devlang: ''
ms.topic: conceptual
author: danimir
ms.author: danil
ms.reviewer: jrasnik, carlrab
ms.date: 04/06/2020
ms.openlocfilehash: 9c9f069ad38c65aa0bbfdcde9eef3fed32585d9e
ms.sourcegitcommit: 441db70765ff9042db87c60f4aa3c51df2afae2d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2020
ms.locfileid: "80756415"
---
# <a name="configure-streaming-export-of-azure-sql-database-diagnostic-telemetry"></a>Настройка потокового экспорта диагностической телеметрии базы данных Azure S'L

В этой статье вы узнаете о метриках производительности и журналах ресурсов для базы данных Azure S'L, которые можно экспортировать в один из нескольких направлений для анализа. Вы узнаете, как настроить потоковое экспорт этой диагностической телеметрии через портал Azure, PowerShell, Azure CLI, REST API и шаблоны менеджера ресурсов Azure.

Вы также узнаете о направлениях, в которые вы можете передавать эту диагностическую телеметрию и как выбрать среди этих вариантов. Варианты назначения включают в себя:

- [Аналитика журналов и аналитика S'L](#stream-into-sql-analytics)
- [Центры событий](#stream-into-event-hubs)
- [Хранилище Azure](#stream-into-azure-storage)

## <a name="diagnostic-telemetry-for-export-for-azure-sql-database"></a>Диагностическая телеметрия для экспорта для базы данных Azure S'L

Наиболее важным среди диагностической телеметрии, которую можно экспортировать, является журнал Интеллектуальных Анализов (S'LInsights). [Intelligent Insights](sql-database-intelligent-insights.md) использует встроенный интеллект для непрерывного мониторинга использования баз данных с помощью искусственного интеллекта и обнаружения разрушительных событий, которые приводят к низкой производительности. После обнаружения проводится подробный анализ, который генерирует журнал Intelligent Insights с интеллектуальной оценкой проблемы. Эта оценка состоит из анализа первопричин проблемы с производительностью базы данных и возможных рекомендаций по повышению производительности. Необходимо настроить потоковый экспорт этого журнала для просмотра его содержимого.

В дополнение к потоковой передаче экспорта журнала Intelligent Insights, вы также можете экспортировать различные метрики производительности и дополнительные журналы баз данных S'L. В следующей таблице описаны показатели производительности и журналы ресурсов, которые можно настроить для потокового экспорта в один из нескольких направлений. Эта диагностическая телеметрия может быть настроена для отдельных баз данных, эластичных пулов и объединенных баз данных, а также для управляемых экземпляров и баз данных экземпляров.

| Диагностическая телеметрия для баз данных | Поддержка отдельной базы данных и базы данных в пуле | Поддержка базы данных управляемых экземпляров |
| :------------------- | ----- | ----- |
| [Основные метрики](#basic-metrics): Содержит процент DTU/CPU, предел DTU/CPU, процент чтения физических данных, процент записи журнала, успешный/неудавшийся/заблокированный соединениями брандмауэра, процент сеансов, процент работников, память, процент хранения данных и процент хранения XTP. | Да | нет |
| [Instance и App Advanced](#advanced-metrics): Содержит данные базы данных системы tempdb и размер файла журнала и используемый файл журнала tempdb процентов. | Да | нет |
| [QueryStoreRuntimeStatistics](#query-store-runtime-statistics): Содержит информацию о статистике выполнения запроса, такой как использование процессора и статистика продолжительности запроса. | Да | Да |
| [QueryStoreWaitStatistics](#query-store-wait-statistics): Содержит информацию о статистике ожидания запроса (то, что ваши запросы ждали), такие как процессор, LOG и LOCKING. | Да | Да |
| [Ошибки](#errors-dataset): Содержит информацию об ошибках в базе данных. | Да | Да |
| [DatabaseWaitStatistics](#database-wait-statistics-dataset) содержит статистику по значениям времени ожидания различных типов для базы данных. | Да | нет |
| [Тайм-ауты](#time-outs-dataset): Содержит информацию о тайм-аутах в базе данных. | Да | нет |
| [Блоки](#blockings-dataset): Содержит информацию о блокировке событий в базе данных. | Да | нет |
| [Взаимоблокировки](#deadlocks-dataset): Содержит информацию о событиях тупика в базе данных. | Да | нет |
| [AutomaticTuning](#automatic-tuning-dataset): Содержит информацию об рекомендациях по автоматической настройке для базы данных. | Да | нет |
| [S'LInsights](#intelligent-insights-dataset): Содержит интеллектуальные исследования производительности для базы данных. Дополнительные сведения см. в статье об [Intelligent Insights](sql-database-intelligent-insights.md). | Да | Да |

> [!NOTE]
> Диагностические настройки не могут быть настроены для **баз данных системы,** такие как мастер, msdb, модель, ресурс и базы данных tempdb.

## <a name="streaming-export-destinations"></a>Направление потокового экспорта

Эта диагностическая телеметрия может передаваться на один из следующих ресурсов Azure для анализа.

- **[Рабочее пространство аналитики журнала](#stream-into-sql-analytics)**:

  Данные, перевостриженные в [рабочее пространство log Analytics,](../azure-monitor/platform/resource-logs-collect-workspace.md) могут быть использованы с помощью [S'L Analytics.](../azure-monitor/insights/azure-sql.md) СЗЛ Аналитика — это только облачное решение для мониторинга, обеспечивающее интеллектуальный мониторинг баз данных, включающий отчеты о производительности, оповещения и рекомендации по снижению производительности. Данные, перетекаемые в рабочее пространство Log Analytics, могут быть проанализированы с помощью других собранных данных мониторинга, а также позволяют использовать другие функции Azure Monitor, такие как оповещения и визуализации
- **[Концентраторы событий Azure](#stream-into-event-hubs)**:

  Данные, перевозимые в [концентратор событий Azure,](../azure-monitor/platform/resource-logs-stream-event-hubs.md)предоставляют следующие функциональные возможности:

  - **Поток журналов для систем четных и телеметрических**систем третьей стороны: Поток всех ваших метрик и журналов ресурсов в единый концентратор событий для данных журнала трубы к стороннему инструменту SIEM или аналитике журнала.
  - **Создайте пользовательскую телеметрию и платформу регистрации:** высокомасштабируемый характер концентраторов событий позволяет гибко глотать метрики и журналы ресурсов в пользовательскую платформу телеметрии. Подробнее о [проектировании и подчете платформы телеметрии глобального масштаба можно узнать на концентрах Azure Event.](https://azure.microsoft.com/documentation/videos/build-2015-designing-and-sizing-a-global-scale-telemetry-platform-on-azure-event-Hubs/)
  - **Просматривайте работоспособность служб, перенаправляя данные в Power BI:** Используйте концентраторы событий, stream Analytics и Power BI для преобразования данных диагностики в практически данные в режиме реального времени в службах Azure. [См. Stream Analytics и Power BI: Панель мониторинга аналитики в режиме реального времени для потоковой передачи данных](https://docs.microsoft.com/azure/stream-analytics/stream-analytics-power-bi-dashboard) для получения подробной информации об этом решении.
- **[Хранение azure](#stream-into-azure-storage)**:

  Данные, перевозимые в [Azure Storage,](../azure-monitor/platform/resource-logs-collect-storage.md) позволяют архивировать огромное количество диагностической телеметрии за долю от стоимости двух предыдущих вариантов потоковой передачи.

Эта диагностическая телеметрия, перетекаемые в один из этих пунктов назначения, может использоваться для оценки использования ресурсов и статистики выполнения запросов для облегчения мониторинга производительности.

![Architecture](./media/sql-database-metrics-diag-logging/architecture.png)

## <a name="enable-and-configure-the-streaming-export-of-diagnostic-telemetry"></a>Включить и настроить потоковое экспорт диагностической телеметрии

Вы можете включить и управлять метриками и журналом диагностической телеметрии, используя один из следующих методов:

- Портал Azure
- PowerShell
- Azure CLI
- REST API Azure Monitor
- Шаблон Azure Resource Manager

> [!NOTE]
> Для обеспечения потоковой передачи телеметрии безопасности в журнале «Телеметрия безопасности» для просмотра журналов безопасности и [аудита журналов Azure Monitor и концентраторов событий Azure](https://techcommunity.microsoft.com/t5/Azure-SQL-Database/SQL-Audit-logs-in-Azure-Log-Analytics-and-Azure-Event-Hubs/ba-p/386242)см. [Set up auditing for your database](sql-database-auditing.md#setup-auditing)

## <a name="configure-the-streaming-export-of-diagnostic-telemetry"></a>Настройка потокового экспорта диагностической телеметрии

Вы можете использовать меню **настроек Диагностики** на портале Azure для включения и настройки потоковой передачи диагностической телеметрии. Кроме того, для настройки потоковой передачи диагностической телеметрии можно использовать шаблоны PowerShell, Azure CLI, [REST API](https://docs.microsoft.com/rest/api/monitor/diagnosticsettings)и [ресурсного менеджера.](../azure-monitor/platform/diagnostic-settings-template.md) Для потоковой передачи диагностической телеметрии можно установить следующие направления: журналы Azure Storage, Azure Event Hubs и журналы Azure Monitor.

> [!IMPORTANT]
> Потоковый экспорт диагностической телеметрии не включен по умолчанию.

Выберите одну из следующих вкладок для пошагового руководства для настройки потокового экспорта диагностической телеметрии на портале Azure и для скриптов для достижения того же с PowerShell и Azure CLI.

# <a name="azure-portal"></a>[Портал Azure](#tab/azure-portal)

### <a name="elastic-pools"></a>Эластичные пулы

Можно настроить эластичный ресурс пула для сбора следующей диагностической телеметрии:

| Ресурс | Мониторинг телеметрии |
| :------------------- | ------------------- |
| **Упругий бассейн** | [Основные метрики](sql-database-metrics-diag-logging.md#basic-metrics) содержат процент eDTU/CPU, лимит eDTU/CPU, процент чтения физических данных, процент записи в журнале, процент сеансов, процент работников, процент хранения, процент хранения, лимит хранения и процент хранения XTP. |

Для настройки потоковой передачи диагностической телеметрии для эластичных пулов и объединенных баз данных необходимо отдельно настроить каждую отдельно:

- Включить потоковую передачу диагностической телеметрии для эластичного пула
- Включить потоковую передачу диагностической телеметрии для каждой базы данных в эластичном пуле

Упругий контейнер для пула имеет собственную телеметрию, отдельную от телеметрии каждой отдельной объединенной базы данных.

Для обеспечения потоковой передачи диагностической телеметрии для эластичного ресурса пула выполните следующие действия:

1. Перейдите на ресурс **эластичного пула** на портале Azure.
2. Выберите **Параметры диагностики**.
3. Выберите **Включить диагностику**, если предыдущие параметры отсутствуют, или **Настройка параметра**, чтобы изменить предыдущий параметр.

   ![Включение диагностики для эластичных пулов](./media/sql-database-metrics-diag-logging/diagnostics-settings-container-elasticpool-enable.png)

4. Введите имя настройки для вашей собственной ссылки.
5. Выберите ресурс назначения для данных потоковой диагностики: **Архив для учетной записи хранения,** **Поток к концентратору событий**или Отправить в Log **Analytics.**
6. Для анализа журналов выберите **настройку** и создайте новое рабочее пространство, выбрав **«Создать новое рабочее пространство»** или выбрать существующее рабочее пространство.
7. Выберите флажок для упругой пульт диагностической телеметрии: **Основные** метрики.
   ![Настройка диагностики для эластичных пулов](./media/sql-database-metrics-diag-logging/diagnostics-settings-container-elasticpool-selection.png)

8. Щелкните **Сохранить**.
9. Кроме того, настроить потоковую передачу диагностической телеметрии для каждой базы данных в эластичной пуле, которую вы хотите контролировать, выполняя следующие шаги, описанные в следующем разделе.

> [!IMPORTANT]
> В дополнение к настройке диагностической телеметрии для эластичного пула, необходимо также настроить диагностическую телеметрию для каждой базы данных в эластичной пуле.

### <a name="single-or-pooled-database"></a>Единая или объединенная база данных

Можно настроить единый или объединенный ресурс базы данных для сбора следующей диагностической телеметрии:

| Ресурс | Мониторинг телеметрии |
| :------------------- | ------------------- |
| **Единая или объединенная база данных** | [Основные метрики](sql-database-metrics-diag-logging.md#basic-metrics) содержат процент DTU, DTU, dTU limit, процент процессора, процент чтения физических данных, процент записи журнала, Успешный/Неудавшийся/Заблокированный соединениями брандмауэра, процент сеансов, процент работников, память, процент хранения, процент хранения XTP и взаимоблокировки. |

Для обеспечения потоковой передачи диагностической телеметрии для одной или объединенной базы данных выполните следующие действия:

1. Перейдите на ресурс базы данных Azure **S'L.**
2. Выберите **Параметры диагностики**.
3. Выберите **Включить диагностику**, если предыдущие параметры отсутствуют, или **Настройка параметра**, чтобы изменить предыдущий параметр. Можно создать до трех параллельных соединений для потоковой диагностической телеметрии.
4. Выберите **Диагностическую настройку,** чтобы настроить параллельную потоковую передачу диагностических данных на несколько ресурсов.

   ![Включить диагностику для единых и объединенных баз данных](./media/sql-database-metrics-diag-logging/diagnostics-settings-database-sql-enable.png)

5. Введите имя настройки для вашей собственной ссылки.
6. Выберите ресурс назначения для данных потоковой диагностики: **Архив для учетной записи хранения,** **Поток к концентратору событий**или Отправить в Log **Analytics.**
7. Для стандартного, событийного опыта мониторинга, выберите следующие флажки для диагностики баз данных журнал телеметрии: **S'LInsights**, **AutomaticTuning**, **QueryStoreRuntimeStatistics**, **queryStoreWaitStatistics**, **Ошибки**, **DatabaseWaitStatistics**, **Тайм-ауты**, **блоки**, и **deadlocks**.
8. Для расширенного, одноминутного мониторинга выберите флажок для **основных** метрик.

   ![Настройка диагностики для отдельных баз данных, баз данных в пуле или баз данных экземпляров](./media/sql-database-metrics-diag-logging/diagnostics-settings-database-sql-selection.png)
9. Щелкните **Сохранить**.
10. Повторите эти шаги для каждой базы данных, которые вы хотите контролировать.

> [!TIP]
> Повторите эти шаги для каждой отдельной и объединенной базы данных, под нислякйую базу данных, которая требуется для мониторинга.

### <a name="managed-instance"></a>управляемый экземпляр

Можно настроить управляемый ресурс экземпляра для сбора следующей диагностической телеметрии:

| Ресурс | Мониторинг телеметрии |
| :------------------- | ------------------- |
| **управляемый экземпляр** | [ResourceUsageStats](#resource-usage-stats-for-managed-instances) содержит количество виртуальных ядер, средний процент использования ЦП, а также сведения о запросах ввода-вывода, прочитанных и записанных байтах, зарезервированном и используемом дисковом пространстве. |

Для настройки потоковой передачи диагностической телеметрии для управляемых баз данных экземпляров и экземпляров необходимо отдельно настроить каждую из них:

- Включить потоковую передачу диагностической телеметрии для управляемого экземпляра
- Включить потоковую передачу диагностической телеметрии для каждой базы данных экземпляров

Контейнер управляемого экземпляра имеет свою собственную телеметрию, отдельную от телеметрии каждой базы данных экземпляра.

Для обеспечения потоковой передачи диагностической телеметрии для управляемого ресурса экземпляра выполните следующие действия:

1. Перейдите на управляемый ресурс **экземпляра** на портале Azure.
2. Выберите **Параметры диагностики**.
3. Выберите **Включить диагностику**, если предыдущие параметры отсутствуют, или **Настройка параметра**, чтобы изменить предыдущий параметр.

   ![Включение диагностики для управляемого экземпляра](./media/sql-database-metrics-diag-logging/diagnostics-settings-container-mi-enable.png)

4. Введите имя настройки для вашей собственной ссылки.
5. Выберите ресурс назначения для данных потоковой диагностики: **Архив для учетной записи хранения,** **Поток к концентратору событий**или Отправить в Log **Analytics.**
6. Для анализа журналов выберите **настройку** и создайте новое рабочее пространство, выбрав **«Создать новое рабочее пространство»** или использовать существующее рабочее пространство.
7. Выберите флажок, например диагностическую телеметрию: **ResourceUsageStats**.

   ![Настройка диагностики для управляемого экземпляра](./media/sql-database-metrics-diag-logging/diagnostics-settings-container-mi-selection.png)

8. Щелкните **Сохранить**.
9. Кроме того, настроить потоковую передачу диагностической телеметрии для каждой базы данных экземпляра в управляемом экземпляре, который требуется контролировать, следуя шагам, описанным в следующем разделе.

> [!IMPORTANT]
> В дополнение к настройке диагностической телеметрии для управляемого экземпляра, необходимо также настроить диагностическую телеметрию для каждой базы данных экземпляра.

### <a name="instance-database"></a>База данных экземпляра

Можно настроить ресурс базы данных экземпляров для сбора следующей диагностической телеметрии:

| Ресурс | Мониторинг телеметрии |
| :------------------- | ------------------- |
| **База данных экземпляра** | [ResourceUsageStats](#resource-usage-stats-for-managed-instances) содержит количество виртуальных ядер, средний процент использования ЦП, а также сведения о запросах ввода-вывода, прочитанных и записанных байтах, зарезервированном и используемом дисковом пространстве. |

Для обеспечения потоковой передачи диагностической телеметрии для базы данных экземпляров выполните следующие действия:

1. Перейдите к ресурсу **базы данных экземпляров** в управляемом экземпляре.
2. Выберите **Параметры диагностики**.
3. Выберите **Включить диагностику**, если предыдущие параметры отсутствуют, или **Настройка параметра**, чтобы изменить предыдущий параметр.
   - Можно создать до трех (3) параллельных соединений для потоковой диагностической телеметрии.
   - Выберите **+Add diagnostic setting** (+ Добавить параметр диагностики), чтобы настроить параллельную потоковую передачу данных диагностики на несколько ресурсов.

   ![Включение диагностики для баз данных экземпляров](./media/sql-database-metrics-diag-logging/diagnostics-settings-database-mi-enable.png)

4. Введите имя настройки для вашей собственной ссылки.
5. Выберите ресурс назначения для данных потоковой диагностики: **Архив для учетной записи хранения,** **Поток к концентратору событий**или Отправить в Log **Analytics.**
6. Выберите флажки для диагностической телеметрии базы данных: **S'LInsights**, **queryStoreRuntimeStatistics**, **queryStoreWaitStatistics**, и **Ошибки**.
   ![Настройка диагностики для баз данных экземпляров](./media/sql-database-metrics-diag-logging/diagnostics-settings-database-mi-selection.png)
7. Щелкните **Сохранить**.
8. Повторите эти действия для каждой базы данных экземпляра, под ней вы хотите контролировать.

> [!TIP]
> Повторите эти действия для каждой базы данных экземпляра, под ней вы хотите контролировать.

# <a name="powershell"></a>[PowerShell](#tab/azure-powershell)

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

> [!IMPORTANT]
> Модуль PowerShell Azure Resource Manager по-прежнему поддерживается базой данных Azure S'L, но все будущие разработки предназначены для модуля Az.Sql. Для этих cmdlets, см [AzureRM.Sql](https://docs.microsoft.com/powershell/module/AzureRM.Sql/). Аргументы для команд в модуле Az и в модулях Azrm существенно идентичны.

Включить ведение журналов метрик и диагностики можно с помощью PowerShell.

- Для хранения метрик и журналов ресурсов в учетной записи хранилища используйте эту команду:

  ```powershell
  Set-AzDiagnosticSetting -ResourceId [your resource id] -StorageAccountId [your storage account id] -Enabled $true
  ```

  Идентификатор учетной записи хранения представляет собой идентификатор ресурса целевой учетной записи хранения.

- Для включения потоковой передачи метрик и журналов ресурсов в концентратор событий используйте эту команду:

  ```powershell
  Set-AzDiagnosticSetting -ResourceId [your resource id] -ServiceBusRuleId [your service bus rule id] -Enabled $true
  ```

  Идентификатор правила служебной шины Azure — это строка в формате:

  ```powershell
  {service bus resource ID}/authorizationrules/{key name}
  ```

- Для отправки метрик и журналов ресурсов в рабочее пространство Log Analytics используйте эту команду:

  ```powershell
  Set-AzDiagnosticSetting -ResourceId [your resource id] -WorkspaceId [resource id of the log analytics workspace] -Enabled $true
  ```

- Идентификатор ресурса рабочей области Log Analytics можно получить с помощью следующей команды:

  ```powershell
  (Get-AzOperationalInsightsWorkspace).ResourceId
  ```

Можно объединять эти параметры, чтобы получить несколько вариантов вывода.

**Настройка нескольких ресурсов Azure**

Чтобы обеспечить поддержку нескольких подписок, используйте сценарий PowerShell. Дополнительные сведения см. в статье [Enable Azure resource metrics logging using PowerShell](https://blogs.technet.microsoft.com/msoms/20../../enable-azure-resource-metrics-logging-using-powershell/) (Включение ведения журнала метрик ресурсов Azure с помощью PowerShell).

Укажите идентификатор ресурса рабочей области \<$WSID\> в качестве параметра при выполнении скрипта `Enable-AzureRMDiagnostics.ps1` для отправки данных диагностики из нескольких ресурсов в рабочую область.

- Чтобы получить идентификатор рабочей области \<$WSID\> места назначения для ваших диагностических данных, используйте следующий сценарий:

  ```powershell
  $WSID = "/subscriptions/<subID>/resourcegroups/<RG_NAME>/providers/microsoft.operationalinsights/workspaces/<WS_NAME>"
  .\Enable-AzureRMDiagnostics.ps1 -WSID $WSID
  ```

  Замените \<subID\> идентификатором подписки, \<RG_NAME\> именем группы ресурсов, а \<WS_NAME\> — именем рабочей области.

# <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

Можно включить ведение журналов метрик и диагностики с помощью Azure CLI.

> [!IMPORTANT]
> Сценарии для включения в систему регистрации диагностических средств поддерживаются для Azure CLI v1.0. Azure CLI v2.0 в настоящее время не поддерживается.

- Для хранения метрик и журналов ресурсов в учетной записи хранилища используйте эту команду:

  ```azurecli-interactive
  azure insights diagnostic set --resourceId <resourceId> --storageId <storageAccountId> --enabled true
  ```

  Идентификатор учетной записи хранения представляет собой идентификатор ресурса целевой учетной записи хранения.

- Для включения потоковой передачи метрик и журналов ресурсов в концентратор событий используйте эту команду:

  ```azurecli-interactive
  azure insights diagnostic set --resourceId <resourceId> --serviceBusRuleId <serviceBusRuleId> --enabled true
  ```

  Идентификатор правила служебной шины — это строка в формате:

  ```azurecli-interactive
  {service bus resource ID}/authorizationrules/{key name}
  ```

- Для отправки метрик и журналов ресурсов в рабочее пространство Log Analytics используйте эту команду:

  ```azurecli-interactive
  azure insights diagnostic set --resourceId <resourceId> --workspaceId <resource id of the log analytics workspace> --enabled true
  ```

Можно объединять эти параметры, чтобы получить несколько вариантов вывода.

---

## <a name="stream-into-sql-analytics"></a>Поток в аналитику S'L

Метрики базы данных и журналы ресурсов, которые передаются в рабочее пространство log Analytics, могут быть использованы аналитикой Azure S'L. Azure S'L Analytics — это облачное решение, которое отслеживает производительность отдельных баз данных, эластичных пулов и объединенных баз данных, а также управляемых экземпляров и баз данных экземпляров в масштабе и в нескольких подписях. Решение поможет собирать и визуализировать показатели производительности Базы данных SQL Azure, а также обладает встроенными интеллектуальными возможностями для устранения неполадок производительности.

![Обзор службы "Аналитика SQL Azure"](../azure-monitor/insights/media/azure-sql/azure-sql-sol-overview.png)

### <a name="installation-overview"></a>Обзор установки

Вы можете контролировать коллекцию баз данных Azure S'L с помощью аналитики Azure S'L, выполняя следующие действия:

1. Создайте решение "Аналитика SQL Azure" из Azure Marketplace.
2. Создайте рабочее пространство для анализа журналов в решении.
3. Настройка баз данных для потоковой передачи диагностической телеметрии в рабочее пространство.

Вы можете настроить потоковое экспорт этой диагностической телеметрии с помощью встроенной опции **Send to Log Analytics** во вкладке настройки диагностики на портале Azure. Вы также можете включить потоковую передачу в рабочее пространство log Analytics, используя настройки диагностики с помощью [смдлетов PowerShell,](sql-database-metrics-diag-logging.md?tabs=azure-powershell#configure-the-streaming-export-of-diagnostic-telemetry) [Azure CLI,](sql-database-metrics-diag-logging.md?tabs=azure-cli#configure-the-streaming-export-of-diagnostic-telemetry) [API Azure Monitor REST](https://docs.microsoft.com/rest/api/monitor/diagnosticsettings)или [шаблонов менеджера ресурсов.](../azure-monitor/platform/diagnostic-settings-template.md)

### <a name="create-an-azure-sql-analytics-resource"></a>Создание ресурса аналитики Azure S'L Analytics

1. Выполните поиск по запросу "Аналитика SQL Azure" в Azure Marketplace и выберите найденное решение.

   ![Поиск службы Аналитика SQL Azure на портале](./media/sql-database-metrics-diag-logging/sql-analytics-in-marketplace.png)

2. Выберите **Создать** на экране обзора решения.

3. В форме "Аналитика SQL Azure" введите необходимые дополнительные сведения: имя рабочей области, подписку, группу ресурсов, расположение и ценовую категорию.

   ![Настройка службы "Аналитика SQL Azure" на портале](./media/sql-database-metrics-diag-logging/sql-analytics-configuration-blade.png)

4. Нажмите **ОК** для подтверждения, а затем выберите **Создать**.

### <a name="configure-the-resource-to-record-metrics-and-resource-logs"></a>Настройка ресурса для записи метрик и журналов ресурсов

Необходимо отдельно настроить потоковую диагностическую телеметрию для отдельных и объединенных баз данных, эластичных пулов, управляемых экземпляров и баз данных экземпляров. Самый простой способ настроить, где показатели записи ресурсов — это с помощью портала Azure. Для получения подробных шагов [см.](sql-database-metrics-diag-logging.md?tabs=azure-portal#configure-the-streaming-export-of-diagnostic-telemetry)

### <a name="use-azure-sql-analytics-for-monitoring-and-alerting"></a>Используйте аналитику Azure S'L для мониторинга и оповещения

Для просмотра ресурсов базы данных S'L можно использовать s'L Analytics в качестве иерархической панели мониторинга.

- Чтобы узнать, как использовать аналитику [Monitor SQL Database by using SQL Analytics](../log-analytics/log-analytics-azure-sql.md)Azure S'L, см.
- Чтобы узнать, как настроить оповещения для в S'L Analytics, [см. Создание оповещений для базы данных, эластичных пулов и управляемых экземпляров.](../azure-monitor/insights/azure-sql.md#analyze-data-and-create-alerts)

## <a name="stream-into-event-hubs"></a>Потоковая передача в Центры событий

В центр ездовые данные и журналы ресурсов можно передавать в концентратор ы событий, используя встроенный поток в **опцию концентратора событий** на портале Azure. Вы также можете включить идентификатор правил службы bus, используя настройки диагностики через cmdlets PowerShell, Azure CLI или API REST Azure Monitor.

### <a name="what-to-do-with-metrics-and-resource-logs-in-event-hubs"></a>Что делать с метриками и журналами ресурсов в концентрах событий

Выполнив потоковую передачу выбранных данных в Центры событий, вы становитесь на один шаг ближе к включению дополнительных сценариев мониторинга. Центры событий выступают в качестве "двери" для конвейера событий. После сбора данных в концентраторе событий их можно преобразовывать и сохранять с помощью поставщика аналитики в реальном времени или адаптера хранения. Центры событий отделяют производство потока событий от потребления этих событий. Таким образом потребители событий могут получать доступ к событиям по собственному расписанию. Дополнительные сведения о Центрах событий см. в следующих статьях:

- [Что такое Центры событий?](../event-hubs/event-hubs-what-is-event-hubs.md)
- [Приступая к работе с Центрами событий](../event-hubs/event-hubs-csharp-ephcs-getstarted.md)

Потоковые метрики в Центрах событий можно использовать для следующих целей:

- **Просмотр работоспособности службы путем потоковой передачи данных по горячему пути в Power BI**

  С помощью Центров событий, Stream Analytics и Power BI можно в близком к реальному времени получать аналитическую информацию о службах Azure на основе метрик и диагностических данных. Обзор настройки концентраторов событий, обработки данных в Stream Analytics и вывода информации через Power BI см. в статье [Stream Analytics и Power BI. Панель мониторинга для анализа потоковой передачи данных](../stream-analytics/stream-analytics-power-bi-dashboard.md).

- **Потоков журналов к сторонним лесозаготовкам и телеметрическим потокам**

  С помощью потоковой передачи event Hubs вы можете получить свои метрики и журналы ресурсов в различные сторонние решения для мониторинга и анализа журналов.

- **Создание пользовательской телеметрии и платформы для ведения журнала**

  У вас уже есть платформа телеметрии, созданная на заказ, или вы планируете ее создать? Высоко масштабируемый характер публикаций и подписки event Hubs позволяет гибко глотать метрики и журналы ресурсов. Ознакомьтесь с [руководством Дэна Росановы (Dan Rosanova) по использованию Центров событий для глобальной платформы телеметрии](https://azure.microsoft.com/documentation/videos/build-2015-designing-and-sizing-a-global-scale-telemetry-platform-on-azure-event-Hubs/).

## <a name="stream-into-azure-storage"></a>Потоковая передача в службу хранилища Azure

Вы можете хранить метрики и журналы ресурсов в Хранилище Azure, используя встроенный **архив для опции учетной записи хранилища** на портале Azure. Вы также можете включить хранилище, используя настройки диагностики через смдлеты PowerShell, Azure CLI или API Rest Azure Monitor.

### <a name="schema-of-metrics-and-resource-logs-in-the-storage-account"></a>Схема метрик и журналов ресурсов в учетной записи хранилища

После настройки метрик и сбора журналов ресурсов в выбранной учетной записи хранилища создается контейнер для хранения данных, выбранный при наличии первых строк данных. Вот как выглядит структура большого двоичного объекта:

```powershell
insights-{metrics|logs}-{category name}/resourceId=/SUBSCRIPTIONS/{subscription ID}/ RESOURCEGROUPS/{resource group name}/PROVIDERS/Microsoft.SQL/servers/{resource_server}/ databases/{database_name}/y={four-digit numeric year}/m={two-digit numeric month}/d={two-digit numeric day}/h={two-digit 24-hour clock hour}/m=00/PT1H.json
```

Или даже еще проще:

```powershell
insights-{metrics|logs}-{category name}/resourceId=/{resource Id}/y={four-digit numeric year}/m={two-digit numeric month}/d={two-digit numeric day}/h={two-digit 24-hour clock hour}/m=00/PT1H.json
```

Например, имя капли для основных метрик может быть:

```powershell
insights-metrics-minute/resourceId=/SUBSCRIPTIONS/s1id1234-5679-0123-4567-890123456789/RESOURCEGROUPS/TESTRESOURCEGROUP/PROVIDERS/MICROSOFT.SQL/ servers/Server1/databases/database1/y=2016/m=08/d=22/h=18/m=00/PT1H.json
```

Имя BLOB-объекта для хранения данных из эластичного пула выглядит следующим образом:

```powershell
insights-{metrics|logs}-{category name}/resourceId=/SUBSCRIPTIONS/{subscription ID}/ RESOURCEGROUPS/{resource group name}/PROVIDERS/Microsoft.SQL/servers/{resource_server}/ elasticPools/{elastic_pool_name}/y={four-digit numeric year}/m={two-digit numeric month}/d={two-digit numeric day}/h={two-digit 24-hour clock hour}/m=00/PT1H.json
```

## <a name="data-retention-policy-and-pricing"></a>Политика хранения данных и цены

Если выбрать Центры событий или учетную запись хранения, можно указать политику хранения. Эта политика удаляет данные, которые хранятся дольше выбранного периода времени. При указании Log Analytics политика хранения определяется на основании выбранной ценовой категории. В этом случае предоставляемые бесплатные единицы приема данных позволяют выполнять бесплатный мониторинг нескольких баз данных каждый месяц. Любое потребление диагностической телеметрии сверх свободных единиц может повлечь за собой расходы.

> [!IMPORTANT]
> Активные базы данных с более тяжелыми рабочими нагрузками, глотающие больше данных, чем простаивающие базы данных. Для получения дополнительной информации, см [Журнал аналитики ценообразования](https://azure.microsoft.com/pricing/details/monitor/).

Если вы используете аналитику Azure S'L, вы можете контролировать потребление данных, выбрав **рабочее пространство OMS** в меню навигации аналитики Azure s'L, а затем выбрав **расходы** на использование и **смету.**

## <a name="metrics-and-logs-available"></a>Доступные метрики и журналы

В этом разделе статьи документируется телеметрия мониторинга, доступного для отдельных баз данных, объединенных баз данных, эластичных пулов, управляемых экземпляров и баз данных экземпляров. Собранная телеметрия мониторинга внутри S'L Analytics может быть использована для собственного пользовательского анализа и разработки приложений с помощью языка [запросов журналов Azure Monitor.](https://docs.microsoft.com/azure/log-analytics/query-language/get-started-queries)

### <a name="basic-metrics"></a>Основные метрики

Обратитесь к следующим таблицам для получения подробной информации об основных метриках по ресурсам.

> [!NOTE]
> Базовый вариант метрик ранее был известен как Все метрики. Внесенное изменение было только в именования, и не было никаких изменений в метрики контролируется. Это изменение было инициировано для того, чтобы в будущем внедрить дополнительные метрические категории.

#### <a name="basic-metrics-for-elastic-pools"></a>Основные метрики для эластичных бассейнов

|**Ресурс**|**Метрики**|
|---|---|
|Эластичный пул|Сведения о проценте использования DTU, используемых единицах DTU, ограничении DTU, проценте использования ЦП, проценте чтения физических данных, проценте записей в журнал, проценте сеансов, проценте рабочих ролей, хранилище, проценте хранилища, ограничении хранилища, проценте хранилища XTP. |

#### <a name="basic-metrics-for-single-and-pooled-databases"></a>Основные метрики для отдельных и объединенных баз данных

|**Ресурс**|**Метрики**|
|---|---|
|Единая и объединенная база данных|Сведения о проценте использования DTU, используемых единицах DTU, ограничении DTU, проценте использования ЦП, проценте чтения физических данных, проценте записей в журнал, проценте успешных, неудачных или заблокированных подключений брандмауэра, проценте сеансов, проценте рабочих ролей, хранилище, проценте хранилища, проценте хранилища XTP и взаимоблокировках. |

### <a name="advanced-metrics"></a>Расширенные метрики

Обратитесь к следующей таблице для получения подробной информации о расширенных метриках.

|**Метрика**|**Отображаемое имя метрики**|**Описание**|
|---|---|---|
|sqlserver_process_core_percent<sup>1</sup>|Основные проценты основных процессов сервера Сервера|Процент использования процессора для процесса S'L Server, измеряемый операционной системой.|
|sqlserver_process_memory_percent<sup>1</sup> |Процент памяти процесса обработки серверов S'L|Процент использования памяти для процесса S'L Server, измеряемый операционной системой.|
|tempdb_data_size<sup>2</sup>| Темпб данных файл размер килобайт |Темп файла данных Размер килобайт.|
|tempdb_log_size<sup>2</sup>| Tempdb журнал файл размер килобайт |Tempdb журнал файл размер килобайт.|
|tempdb_log_used_percent<sup>2</sup>| Tempdb Процент Журнала Используется |Tempdb Процент Журнала Используется.|

<sup>1</sup> Эта метрика доступна для баз данных, использующих модель покупки vCore с 2 vCores и выше, или 200 DTU и выше для DTU на основе моделей покупки. 

<sup>2</sup> Эта метрика доступна для баз данных с использованием модели покупки vCore с 2 vCores и выше, или 200 DTU и выше для DTU на основе моделей покупки. Эта метрика в настоящее время недоступна для баз данных Hyperscale или складов данных.

### <a name="basic-logs"></a>Основные журналы

Подробная информация о телеметрии, доступная для всех журналов, задокументирована в следующих таблицах. Просмотрите [поддерживаемую диагностическую телеметрию,](#diagnostic-telemetry-for-export-for-azure-sql-database) чтобы понять, какие журналы поддерживаются для определенного вкуса базы данных - одной, объединенной или мистиковой базы данных Azure S-L.

#### <a name="resource-usage-stats-for-managed-instances"></a>Статистика использования ресурсов для управляемых экземпляров

|Свойство|Описание|
|---|---|
|TenantId|Идентификатор клиента |
|SourceSystem|Всегда: Azure.|
|TimeGenerated [UTC]|Метка времени, когда был записан журнал |
|Type|Всегда: AzureDiagnostics. |
|ResourceProvider|Имя поставщика ресурсов. Всегда: MICROSOFT.SQL. |
|Категория|Имя категории. Всегда: ResourceUsageStats |
|Ресурс|Имя ресурса. |
|ResourceType|Имя типа ресурса. Всегда: MANAGEDINSTANCES |
|SubscriptionId|GUID подписки для базы данных |
|ResourceGroup|Имя группы ресурсов для базы данных |
|LogicalServerName_s|Имя управляемого экземпляра |
|ResourceId|Универсальный код ресурса (URI) |
|SKU_s|Номер SKU продукта управляемого экземпляра |
|virtual_core_count_s|Доступное количество виртуальных ядер |
|avg_cpu_percent_s|Average CPU percentage (Средний процент использования ЦП) |
|reserved_storage_mb_s|Зарезервированная емкость хранилища в управляемом экземпляре |
|storage_space_used_mb_s|Использованный объем хранилища в управляемом экземпляре |
|io_requests_s|Количество операций ввода-вывода |
|io_bytes_read_s|Количество считанных байтов операций ввода-вывода |
|io_bytes_written_s|Количество записанных байтов операций ввода-вывода |

#### <a name="query-store-runtime-statistics"></a>Статистика среды выполнения хранилища запросов

|Свойство|Описание|
|---|---|
|TenantId|Идентификатор клиента |
|SourceSystem|Всегда: Azure. |
|TimeGenerated [UTC]|Метка времени, когда был записан журнал |
|Type|Всегда: AzureDiagnostics. |
|ResourceProvider|Имя поставщика ресурсов. Всегда: MICROSOFT.SQL. |
|Категория|Имя категории. Всегда: QueryStoreRuntimeStatistics. |
|OperationName|Имя операции. Всегда: QueryStoreRuntimeStatisticsEvent. |
|Ресурс|Имя ресурса. |
|ResourceType|Имя типа ресурса. Всегда: SERVERS/DATABASES. |
|SubscriptionId|GUID подписки для базы данных |
|ResourceGroup|Имя группы ресурсов для базы данных |
|LogicalServerName_s|Имя сервера для базы данных |
|ElasticPoolName_s|Имя эластичного пула для базы данных (при наличии) |
|DatabaseName_s|Имя базы данных. |
|ResourceId|Универсальный код ресурса (URI) |
|query_hash_s|Хэш запроса. |
|query_plan_hash_s|Хэш плана запроса. |
|statement_sql_handle_s|Дескриптор SQL инструкции. |
|interval_start_time_d|Начальное значение datetimeoffset интервала в тактах с 01.01.1900 |
|interval_end_time_d|Конечное значение datetimeoffset интервала в тактах с 01.01.1900 |
|logical_io_writes_d|Общее число логических операций записи ввода-вывода |
|max_logical_io_writes_d|Максимальное число логических операций записи ввода-вывода при выполнении каждого запроса |
|physical_io_reads_d|Общее число физических операций чтения ввода-вывода |
|max_physical_io_reads_d|Максимальное число логических операций чтения ввода-вывода при выполнении каждого запроса |
|logical_io_reads_d|Общее число логических операций чтения ввода-вывода |
|max_logical_io_reads_d|Максимальное число логических операций чтения ввода-вывода при выполнении каждого запроса |
|execution_type_d|Тип выполнения. |
|count_executions_d|Число выполнений запроса |
|cpu_time_d|Общее процессорное время, затраченное на выполнение запроса, в микросекундах |
|max_cpu_time_d|Максимальное потребление процессорного времени на выполнение одного запроса в микросекундах |
|dop_d|Сумма степеней параллелизма |
|max_dop_d|Максимальная степень параллелизма, используемая для выполнения одного запроса |
|rowcount_d|Общее число возвращаемых строк |
|max_rowcount_d|Максимальное число строк, возвращаемых при выполнении одного запроса |
|query_max_used_memory_d|Общий объем используемой памяти в килобайтах |
|max_query_max_used_memory_d|Максимальный объем памяти, используемой при выполнении одного запроса, в килобайтах |
|duration_d|Общее время выполнения запроса в миллисекундах |
|max_duration_d|Максимальное время выполнения одного запроса |
|num_physical_io_reads_d|Общее число физических операций чтения |
|max_num_physical_io_reads_d|Максимальное число физических операций чтения при выполнении каждого запроса |
|log_bytes_used_d|Общий объем записанного журнала в байтах |
|max_log_bytes_used_d|Максимальное число байтов журнала, используемых при выполнения каждого запроса |
|query_id_d|Идентификатор запроса в хранилище запросов |
|plan_id_d|Идентификатор плана в хранилище запросов |

Подробнее о [статистике статистики выполнения хранилища запросов.](https://docs.microsoft.com/sql/relational-databases/system-catalog-views/sys-query-store-runtime-stats-transact-sql)

#### <a name="query-store-wait-statistics"></a>Статистика времени ожидания хранилища запросов

|Свойство|Описание|
|---|---|
|TenantId|Идентификатор клиента |
|SourceSystem|Всегда: Azure. |
|TimeGenerated [UTC]|Метка времени, когда был записан журнал |
|Type|Всегда: AzureDiagnostics. |
|ResourceProvider|Имя поставщика ресурсов. Всегда: MICROSOFT.SQL. |
|Категория|Имя категории. Всегда: QueryStoreWaitStatistics. |
|OperationName|Имя операции. Всегда: QueryStoreWaitStatisticsEvent. |
|Ресурс|Имя ресурса. |
|ResourceType|Имя типа ресурса. Всегда: SERVERS/DATABASES. |
|SubscriptionId|GUID подписки для базы данных |
|ResourceGroup|Имя группы ресурсов для базы данных |
|LogicalServerName_s|Имя сервера для базы данных |
|ElasticPoolName_s|Имя эластичного пула для базы данных (при наличии) |
|DatabaseName_s|Имя базы данных. |
|ResourceId|Универсальный код ресурса (URI) |
|wait_category_s|Категория времени ожидания |
|is_parameterizable_s|Указывает, подлежит ли запрос параметризации |
|statement_type_s|Тип инструкции |
|statement_key_hash_s|Хэш ключа инструкции |
|exec_type_d|Типа выполнения. |
|total_query_wait_time_ms_d|Общее время ожидания запроса в определенной категории времени ожидания |
|max_query_wait_time_ms_d|Максимальное время ожидания запроса при отдельном выполнении в определенной категории времени ожидания. |
|query_param_type_d|0 |
|query_hash_s|Хэш запроса в хранилище запросов |
|query_plan_hash_s|Хэш плана запроса в хранилище запросов. |
|statement_sql_handle_s|Дескриптор инструкции в хранилище запросов. |
|interval_start_time_d|Начальное значение datetimeoffset интервала в тактах с 01.01.1900 |
|interval_end_time_d|Конечное значение datetimeoffset интервала в тактах с 01.01.1900 |
|count_executions_d|Количество выполнений запроса. |
|query_id_d|Идентификатор запроса в хранилище запросов |
|plan_id_d|Идентификатор плана в хранилище запросов |

Дополнительные сведения о [статистических данных времени ожидания хранилища запросов](https://docs.microsoft.com/sql/relational-databases/system-catalog-views/sys-query-store-wait-stats-transact-sql).

#### <a name="errors-dataset"></a>Набор данных ошибок

|Свойство|Описание|
|---|---|
|TenantId|Идентификатор клиента |
|SourceSystem|Всегда: Azure. |
|TimeGenerated [UTC]|Метка времени, когда был записан журнал |
|Type|Всегда: AzureDiagnostics. |
|ResourceProvider|Имя поставщика ресурсов. Всегда: MICROSOFT.SQL. |
|Категория|Имя категории. Всегда: Errors. |
|OperationName|Имя операции. Всегда: ErrorEvent. |
|Ресурс|Имя ресурса. |
|ResourceType|Имя типа ресурса. Всегда: SERVERS/DATABASES. |
|SubscriptionId|GUID подписки для базы данных |
|ResourceGroup|Имя группы ресурсов для базы данных |
|LogicalServerName_s|Имя сервера для базы данных |
|ElasticPoolName_s|Имя эластичного пула для базы данных (при наличии) |
|DatabaseName_s|Имя базы данных. |
|ResourceId|Универсальный код ресурса (URI) |
|Сообщение|Сообщение об ошибке в виде обычного текста. |
|user_defined_b|Указывает, установлен ли бит ошибки пользователем. |
|error_number_d|Код ошибки |
|Severity|Серьезность ошибки. |
|state_d|Состояние ошибки. |
|query_hash_s|Хэш запроса, завершившегося сбоем (при наличии) |
|query_plan_hash_s|Хэш плана запроса для запроса, завершившегося сбоем (при наличии) |

Дополнительные сведения о [сообщениях об ошибках SQL Server](https://docs.microsoft.com/sql/relational-databases/errors-events/database-engine-events-and-errors?view=sql-server-ver15).

#### <a name="database-wait-statistics-dataset"></a>Набор данных статистики времени ожидания базы данных

|Свойство|Описание|
|---|---|
|TenantId|Идентификатор клиента |
|SourceSystem|Всегда: Azure. |
|TimeGenerated [UTC]|Метка времени, когда был записан журнал |
|Type|Всегда: AzureDiagnostics. |
|ResourceProvider|Имя поставщика ресурсов. Всегда: MICROSOFT.SQL. |
|Категория|Имя категории. Всегда: DatabaseWaitStatistics. |
|OperationName|Имя операции. Всегда: DatabaseWaitStatisticsEvent. |
|Ресурс|Имя ресурса. |
|ResourceType|Имя типа ресурса. Всегда: SERVERS/DATABASES. |
|SubscriptionId|GUID подписки для базы данных |
|ResourceGroup|Имя группы ресурсов для базы данных |
|LogicalServerName_s|Имя сервера для базы данных |
|ElasticPoolName_s|Имя эластичного пула для базы данных (при наличии) |
|DatabaseName_s|Имя базы данных. |
|ResourceId|Универсальный код ресурса (URI) |
|wait_type_s|Имя типа времени ожидания. |
|start_utc_date_t [UTC]|Время начала измеренного периода |
|end_utc_date_t [UTC]|Время окончания измеренного периода |
|delta_max_wait_time_ms_d|Максимальное время ожидания при выполнении одного запроса. |
|delta_signal_wait_time_ms_d|Общее время ожидания сигнала |
|delta_wait_time_ms_d|Общее время ожидания в течение периода. |
|delta_waiting_tasks_count_d|Число ожидающих задач. |

Дополнительные сведения о [статистике времени ожидания базы данных](https://docs.microsoft.com/sql/relational-databases/system-dynamic-management-views/sys-dm-os-wait-stats-transact-sql).

#### <a name="time-outs-dataset"></a>Набор данных времени ожидания

|Свойство|Описание|
|---|---|
|TenantId|Идентификатор клиента |
|SourceSystem|Всегда: Azure. |
|TimeGenerated [UTC]|Метка времени, когда был записан журнал |
|Type|Всегда: AzureDiagnostics. |
|ResourceProvider|Имя поставщика ресурсов. Всегда: MICROSOFT.SQL. |
|Категория|Имя категории. Всегда: Timeouts. |
|OperationName|Имя операции. Всегда: TimeoutEvent. |
|Ресурс|Имя ресурса. |
|ResourceType|Имя типа ресурса. Всегда: SERVERS/DATABASES. |
|SubscriptionId|GUID подписки для базы данных |
|ResourceGroup|Имя группы ресурсов для базы данных |
|LogicalServerName_s|Имя сервера для базы данных |
|ElasticPoolName_s|Имя эластичного пула для базы данных (при наличии) |
|DatabaseName_s|Имя базы данных. |
|ResourceId|Универсальный код ресурса (URI) |
|error_state_d|Код состояния ошибки. |
|query_hash_s|Хэш запроса, если он доступен |
|query_plan_hash_s|Хэш плана запроса, если он доступен |

#### <a name="blockings-dataset"></a>Набор данных блокировки

|Свойство|Описание|
|---|---|
|TenantId|Идентификатор клиента |
|SourceSystem|Всегда: Azure. |
|TimeGenerated [UTC]|Метка времени, когда был записан журнал |
|Type|Всегда: AzureDiagnostics. |
|ResourceProvider|Имя поставщика ресурсов. Всегда: MICROSOFT.SQL. |
|Категория|Имя категории. Всегда: Blocks. |
|OperationName|Имя операции. Всегда: BlockEvent. |
|Ресурс|Имя ресурса. |
|ResourceType|Имя типа ресурса. Всегда: SERVERS/DATABASES. |
|SubscriptionId|GUID подписки для базы данных |
|ResourceGroup|Имя группы ресурсов для базы данных |
|LogicalServerName_s|Имя сервера для базы данных |
|ElasticPoolName_s|Имя эластичного пула для базы данных (при наличии) |
|DatabaseName_s|Имя базы данных. |
|ResourceId|Универсальный код ресурса (URI) |
|lock_mode_s|Режим блокировки, используемый для запроса. |
|resource_owner_type_s|Владелец блокировки |
|blocked_process_filtered_s|Отчет о заблокированных процессах в формате XML |
|duration_d|Длительность блокировки в микросекундах |

#### <a name="deadlocks-dataset"></a>Набор данных взаимоблокировки

|Свойство|Описание|
|---|---|
|TenantId|Идентификатор клиента |
|SourceSystem|Всегда: Azure. |
|TimeGenerated [UTC] |Метка времени, когда был записан журнал |
|Type|Всегда: AzureDiagnostics. |
|ResourceProvider|Имя поставщика ресурсов. Всегда: MICROSOFT.SQL. |
|Категория|Имя категории. Всегда: Deadlocks. |
|OperationName|Имя операции. Всегда: DeadlockEvent. |
|Ресурс|Имя ресурса. |
|ResourceType|Имя типа ресурса. Всегда: SERVERS/DATABASES. |
|SubscriptionId|GUID подписки для базы данных |
|ResourceGroup|Имя группы ресурсов для базы данных |
|LogicalServerName_s|Имя сервера для базы данных |
|ElasticPoolName_s|Имя эластичного пула для базы данных (при наличии) |
|DatabaseName_s|Имя базы данных. |
|ResourceId|Универсальный код ресурса (URI) |
|deadlock_xml_s|Отчет о взаимоблокировке в формате XML |

#### <a name="automatic-tuning-dataset"></a>Набор данных автоматической настройки

|Свойство|Описание|
|---|---|
|TenantId|Идентификатор клиента |
|SourceSystem|Всегда: Azure. |
|TimeGenerated [UTC]|Метка времени, когда был записан журнал |
|Type|Всегда: AzureDiagnostics. |
|ResourceProvider|Имя поставщика ресурсов. Всегда: MICROSOFT.SQL. |
|Категория|Имя категории. Всегда: AutomaticTuning. |
|Ресурс|Имя ресурса. |
|ResourceType|Имя типа ресурса. Всегда: SERVERS/DATABASES. |
|SubscriptionId|GUID подписки для базы данных |
|ResourceGroup|Имя группы ресурсов для базы данных |
|LogicalServerName_s|Имя сервера для базы данных |
|LogicalDatabaseName_s|Имя базы данных. |
|ElasticPoolName_s|Имя эластичного пула для базы данных (при наличии) |
|DatabaseName_s|Имя базы данных. |
|ResourceId|Универсальный код ресурса (URI) |
|RecommendationHash_s|Уникальный хэш рекомендаций по автоматической настройке |
|OptionName_s|Операция автоматической настройки |
|Schema_s|Схема базы данных |
|Table_s|Затронутая таблица |
|IndexName_s|Имя индекса |
|IndexColumns_s|Имя столбца |
|IncludedColumns_s|Включенные столбцы |
|EstimatedImpact_s|Предполагаемое влияние JSON-файла рекомендаций по автоматической настройке |
|Event_s|Тип события автоматической настройки |
|Timestamp_t|Метка времени последнего обновления |

#### <a name="intelligent-insights-dataset"></a>Набор данных Intelligent Insights

Дополнительные сведения о [формате журнала Intelligent Insights](sql-database-intelligent-insights-use-diagnostics-log.md).

## <a name="next-steps"></a>Дальнейшие действия

Чтобы научиться включать ведение журнала и узнать, какие метрики и категории журналов поддерживаются различными службами Azure, ознакомьтесь со следующими статьями:

- [Обзор метрик в Microsoft Azure](../monitoring-and-diagnostics/monitoring-overview-metrics.md)
- [Общие сведения о журналах платформы Azure](../azure-monitor/platform/platform-logs-overview.md)

Дополнительные сведения о Центрах событий см. в статье:

- [Что такое Центры событий Azure?](../event-hubs/event-hubs-what-is-event-hubs.md)
- [Приступая к работе с Центрами событий](../event-hubs/event-hubs-csharp-ephcs-getstarted.md)

Чтобы узнать, как настроить оповещения на основе телеметрии из журналов аналитики см.:

- [Создание оповещений для базы данных S'L и управляемого экземпляра](../azure-monitor/insights/azure-sql.md#analyze-data-and-create-alerts)
