---
title: Модели приобретения
description: Сведения о моделях приобретения, доступных для базы данных SQL Azure.
services: sql-database
ms.service: sql-database
ms.subservice: service
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: stevestein
ms.author: sstein
ms.reviewer: carlrab
ms.date: 03/09/2020
ms.openlocfilehash: 97ce402045cfd2c990b457c5d4d06888cda632d5
ms.sourcegitcommit: 8f4d54218f9b3dccc2a701ffcacf608bbcd393a6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/09/2020
ms.locfileid: "78945605"
---
# <a name="choose-between-the-vcore-and-the-dtu-purchasing-models"></a>Выбор между Виртуальное ядро и моделями приобретения DTU

База данных SQL Azure позволяет легко приобрести полностью управляемое ядро СУБД под управлением платформы как услуги (PaaS), удовлетворяющее требованиям к производительности и затратам. В зависимости от модели развертывания, выбранной для базы данных SQL Azure, можно выбрать модель приобретения, которая будет работать для вас:

- [Модель приобретения на основе виртуальных ядер (Виртуальное ядро)](sql-database-service-tiers-vcore.md) (рекомендуется). Эта модель приобретения предоставляет возможность выбора между подготовленным уровнем вычислений и бессерверным уровнем вычислений. Используя подготовленный уровень вычислений, вы выбираете точный объем ресурсов вычислений, которые всегда подготавливаются для рабочей нагрузки. На уровне бессерверных вычислений вы указываете автоматическое масштабирование ресурсов вычислений через настраиваемый диапазон вычислений. С помощью этой категории вычислений можно также автоматически приостанавливать и возобновлять работу базы данных на основе действий рабочей нагрузки. Цена единицы Виртуальное ядро на единицу времени меньше на подготовленном уровне вычислений, чем на уровне бессерверных вычислений.
- [Модель приобретения на основе единиц транзакций базы данных (DTU)](sql-database-service-tiers-dtu.md). Эта модель приобретения предоставляет Объединенные пакеты вычислений и хранилища, сбалансированные для распространенных рабочих нагрузок.

Для различных моделей развертывания базы данных SQL Azure доступны различные модели приобретения:

- Для [отдельных баз данных](sql-database-single-databases-manage.md) и [эластичных пулов](sql-database-elastic-pool.md) в [Базе данных SQL Azure](sql-database-technical-overview.md) предусмотрены две модели приобретения: на основе [единиц DTU](sql-database-service-tiers-dtu.md) и [виртуальных ядер](sql-database-service-tiers-vcore.md).
- Параметр развертывания [управляемого экземпляра](sql-database-managed-instance.md) в базе данных SQL Azure предлагает только [модель приобретения на основе виртуальное ядро](sql-database-service-tiers-vcore.md).
- [Уровень службы "линейка](sql-database-service-tier-hyperscale.md) " доступен для отдельных баз данных, использующих [модель приобретения на основе виртуальное ядро](sql-database-service-tiers-vcore.md).

В следующей таблице и диаграмме сравниваются и отличаются модели приобретения на основе виртуальное ядро и DTU:

|**Модель приобретения**|**Описание**|**Оптимально для**|
|---|---|---|
|Модель приобретения на основе единиц DTU|Эта модель основана на наборе показателей ресурсов вычислений, хранения и ввода-вывода. Размеры вычислений выражаются в DTU для отдельных баз данных и в единицах транзакций эластичной базы данных (Edtu) для эластичных пулов. Дополнительные сведения о DTU и Edtu см. в разделе [что такое DTU и edtu?](sql-database-purchase-models.md#dtu-based-purchasing-model).|Лучше подходит для клиентов, которые хотят использовать простые предварительно настроенные параметры ресурсов.|
|Модель приобретения на основе виртуальных ядер|Эта модель позволяет независимо выбрать ресурсы вычисления и хранилища. Модель приобретения на основе виртуальных ядер также позволяет применять [Преимущество гибридного использования Azure для SQL Server](https://azure.microsoft.com/pricing/hybrid-benefit/), чтобы добиться снижения затрат.|Для клиентов, которые ценят гибкость, контроль и прозрачность.|
||||  

![Сравнение моделей ценообразования](./media/sql-database-service-tiers/pricing-model.png)

## <a name="compute-costs"></a>Затраты на вычислительные ресурсы

### <a name="provisioned-compute-costs"></a>Подготовленные затраты на вычисление

В подготовленном уровне вычислений стоимость вычислений отражает общую емкость вычислений, подготовленную для приложения.

Для уровня служб "Критически важный для бизнеса" автоматически выделяется как минимум 3 реплики. Для отражения этого дополнительного выделения ресурсов вычислений Цена в модели приобретения на основе виртуальное ядро составляет примерно 2.7 x выше на уровне служб критически важный для бизнеса, чем на уровне служб общего назначения. Аналогичным образом, более высокая стоимость хранилища на ГБ на уровне служб критически важный для бизнеса отражает более высокие ограничения на операции ввода-вывода и более низкую задержку хранилища SSD.

Стоимость хранилища службы архивации одинакова для уровня служб критически важный для бизнеса и общего назначения уровня служб, так как оба уровня используют хранилище класса Standard для резервного копирования.

### <a name="serverless-compute-costs"></a>Затраты на бессерверные вычислений

Описание того, как определяется емкость вычислений и рассчитываются затраты на бессерверный уровень вычислений, см. в статье [сервер базы данных SQL](sql-database-serverless.md).

## <a name="storage-costs"></a>Затраты на хранение

Модель выставления счетов зависит от типа хранилища. Для хранилища данных плата наследуется за подготовленное хранилище на основе выбранного максимального размера базы данных или пула. Затраты изменяются только при уменьшении или увеличении максимального значения. Хранилище резервных копий связано с автоматическими резервными копиями экземпляра и выделяется автоматически. Увеличение срока хранения резервных копий увеличивает объем хранилища резервных копий, используемого экземпляром.

По умолчанию автоматическое резервное копирование баз данных в течение 7 дней копируется в стандартную учетную запись хранения BLOB-объектов хранилища с доступом для чтения (RA-GRS). Это хранилище используется еженедельными полными резервными копиями, ежедневными разностными резервными копиями и резервными копиями журналов транзакций, которые копируются каждые 5 минут. Размер журналов транзакций зависит от скорости изменения базы данных. Минимальный объем хранилища, равный 100% от размера базы данных, предоставляется без дополнительной платы. Плата за дополнительное пространство хранилища резервных копий будет взиматься с расчетом ГБ в месяц.

Дополнительные сведения о ценах на службу хранилища см. на странице [Обзор цен на хранилище Azure](https://azure.microsoft.com/pricing/details/sql-database/single/).

## <a name="vcore-based-purchasing-model"></a>Модель приобретения на основе виртуальных ядер

Виртуальное ядро (Виртуальное ядро) представляет собой логический ЦП и предлагает возможность выбора между поколениями оборудования и физическими характеристиками оборудования (например, число ядер, объем памяти и размер хранилища). Модель приобретения на основе виртуальное ядро обеспечивает гибкость, контроль, прозрачность использования отдельных ресурсов и простой способ перевода локальных требований к рабочей нагрузке в облако. Эта модель позволяет выбирать ресурсы для вычислений, памяти и хранения данных в зависимости от потребностей рабочей нагрузки.

В модели приобретения на основе виртуальное ядро можно выбрать между уровнями служб [общего назначения](sql-database-high-availability.md#basic-standard-and-general-purpose-service-tier-availability) и [критически важный для бизнеса](sql-database-high-availability.md#premium-and-business-critical-service-tier-availability) для [отдельных баз данных](sql-database-single-database-scale.md), [эластичных пулов](sql-database-elastic-pool.md)и [управляемых экземпляров](sql-database-managed-instance.md). Для отдельных баз данных можно также выбрать [уровень службы "масштабирование](sql-database-service-tier-hyperscale.md)".

Модель приобретения на основе виртуальное ядро позволяет независимо выбирать ресурсы вычислений и хранения, сопоставлять локальную производительность и оптимизировать цену. В модели приобретения на основе виртуальное ядро вы платите:

- Ресурсы вычислений (уровень служб + количество виртуальных ядер и объем памяти + поколение оборудования).
- Тип и объем хранилища данных и журнала.
- Хранилище резервных копий (RA-GRS).

> [!IMPORTANT]
> Для вычислений с ресурсами, вводом-выводом и хранилищем журналов выставляются счета за базу данных или эластичный пул. За хранилище резервных копий начислена каждая база данных. Дополнительные сведения о затратах на управляемый экземпляр см. в [этой статье](sql-database-managed-instance.md).
> **Ограничения области:** Текущий список поддерживаемых регионов см. в разделе [продукты, доступные по регионам](https://azure.microsoft.com/global-infrastructure/services/?products=sql-database&regions=all). Чтобы создать управляемый экземпляр в регионе, который сейчас не поддерживается, [отправьте запрос в службу поддержки через портал Azure](quota-increase-request.md).

Если одна база данных или эластичный пул использует более 300 DTU, то преобразование в модель приобретения на основе виртуальное ядро может снизить затраты. Вы можете преобразовать с помощью используемого API или портал Azure, не прерывая работу. Однако преобразование не требуется и не выполняется автоматически. Если модель приобретения на основе единиц DTU соответствует вашим требованиям к производительности и бизнес-требованиям, продолжайте использовать ее.

Чтобы преобразовать модель приобретения на основе DTU в модель приобретения на основе виртуальное ядро, выберите размер вычислений, используя следующие правила типа Thumb:

- Каждые 100 DTU на уровне Standard требуется по крайней мере 1 Виртуальное ядро на уровне служб общего назначения.
- Каждые 125 DTU на уровне Premium требуется по крайней мере 1 Виртуальное ядро на уровне служб критически важный для бизнеса.

> [!NOTE]
> Требования к размерам DTU для Виртуальное ядро приблизительны и предоставляются для помощи в начальной оценке целевой цели службы базы данных. Оптимальная конфигурация целевой базы данных зависит от рабочей нагрузки. 
> 
> Достижение оптимального соотношения цены и производительности может потребовать использования гибкости модели Виртуальное ядро для настройки количества виртуальных ядер, [создания оборудования](sql-database-service-tiers-vcore.md#hardware-generations), уровней [обслуживания](sql-database-service-tiers-vcore.md#service-tiers) и [вычислений](sql-database-service-tiers-vcore.md#compute-tiers) , а также настройки других параметров конфигурации базы данных, таких как [Максимальная степень параллелизма](https://docs.microsoft.com/sql/relational-databases/query-processing-architecture-guide#parallel-query-processing).

## <a name="dtu-based-purchasing-model"></a>Модель приобретения на основе единиц DTU

Единица транзакции базы данных (DTU) представляет собой смешанную меру ЦП, памяти, операций чтения и записи. Модель приобретения на основе единиц DTU предлагает ряд предварительно настроенных пакетов вычислительных ресурсов и включенный объем хранилища для обеспечения различных уровней производительности приложений. Если вы предпочитаете упростить предварительно настроенный пакет и фиксированные платежи каждый месяц, то модель на основе DTU может быть более подходящей для ваших потребностей.

В модели приобретения на основе DTU можно выбрать один из уровней служб "базовый", "Стандартный" и "Премиум" как для [отдельных баз данных](sql-database-single-database-scale.md) , так и для [эластичных пулов](sql-database-elastic-pool.md). Модель приобретения на основе DTU недоступна для [управляемых экземпляров](sql-database-managed-instance.md).

### <a name="database-transaction-units-dtus"></a>Единицы транзакций базы данных (DTU)

Для отдельной базы данных с определенным размером вычислений в пределах [уровня службы](sql-database-single-database-scale.md)Корпорация Майкрософт гарантирует определенный уровень ресурсов для этой базы данных (независимо от любой другой базы данных в облаке Azure). Эта гарантия обеспечивает предсказуемый уровень производительности. Объем ресурсов, выделенных для базы данных, вычисляется как число DTU и представляет собой объединенный показатель ресурсов вычислений, хранения и ввода-вывода.

Отношение между этими ресурсами изначально определяется [рабочей нагрузкой производительности оперативной обработки транзакций (OLTP)](sql-database-benchmark-overview.md) , которая является типичной для реальных рабочих нагрузок OLTP. Если Рабочая нагрузка превышает объем какого-либо из этих ресурсов, пропускная способность регулируется, что приводит к снижению производительности и времени ожидания.

Ресурсы, используемые рабочей нагрузкой, не влияют на ресурсы, доступные для других баз данных SQL в облаке Azure. Аналогичным образом ресурсы, используемые другими рабочими нагрузками, не влияют на ресурсы, доступные для базы данных SQL.

![ограничивающая рамка](./media/sql-database-what-is-a-dtu/bounding-box.png)

DTU наиболее полезны для понимания относительных ресурсов, выделенных для баз данных SQL Azure с различными размерами вычислений и уровнями служб. Пример:

- Удвоение количества DTU путем увеличения размера вычислений базы данных равно удвоению набора ресурсов, доступных этой базе данных.
- База данных P11 уровня службы Premium с 1750 DTU предоставляет 350x больше мощности вычислений DTU, чем базовая база данных уровня службы с 5 DTU.  

Чтобы получить более подробные сведения о потреблении ресурсов (DTU) рабочей нагрузки, используйте [аналитические сведения о производительности запросов](sql-database-query-performance.md) в следующих случаях:

- Выявление запросов с наибольшим количеством ресурсов ЦП, длительности и выполнений, которые могут быть настроены для повышения производительности. Например, запрос с интенсивным вводом-выводом может получить преимущество от [методов оптимизации в памяти](sql-database-in-memory.md) , чтобы лучше использовать доступную память на определенном уровне служб и в вычислительном размере.
- Детализируйте сведения о запросе, чтобы просмотреть его текст и историю использования ресурсов.
- Доступ к рекомендациям по настройке производительности, которые показывают действия, выполняемые [Помощник по базам данных SQL](sql-database-advisor.md).

### <a name="elastic-database-transaction-units-edtus"></a>Единицы транзакций эластичной базы данных (Edtu)

Для баз данных SQL, которые всегда доступны, вместо предоставления выделенного набора ресурсов (DTU), которые не всегда требуются, эти базы данных можно поместить в [эластичный пул](sql-database-elastic-pool.md). Базы данных в эластичном пуле находятся на одном сервере базы данных SQL Azure и используют пул ресурсов.

Общие ресурсы в эластичном пуле измеряются единицами транзакций эластичной базы данных (Edtu). Эластичные пулы предоставляют простое и экономичное решение для управления целями производительности для нескольких баз данных с широко изменяющимися и непредсказуемыми шаблонами использования. Эластичный пул гарантирует, что все ресурсы не могут быть использованы в одной базе данных в пуле, в то время как гарантируется, что каждая база данных в пуле всегда будет иметь минимальный объем необходимых ресурсов.

Пулу предоставляется заданное количество единиц eDTU по фиксированной цене. В эластичном пуле отдельные базы данных могут автоматически масштабироваться в пределах настроенных границ. База данных с более плотной нагрузкой будет потреблять больше Edtu для удовлетворения спроса. Базы данных с более светлыми нагрузками будут потреблять меньше Edtu. Базы данных без нагрузки не будут потреблять eDTU. Так как ресурсы подготавливаются для всего пула, а не для каждой базы данных, эластичные пулы упрощают задачи управления и предоставляют Прогнозируемый бюджет для пула.

Можно добавить дополнительные Edtu в существующий пул без простоя базы данных и без влияния на базы данных в пуле. Аналогичным образом, если дополнительные Edtu больше не требуются, удалите их из существующего пула в любое время. Кроме того, в любое время можно добавлять базы данных в пул или вычитать их из пула. Чтобы зарезервировать Edtu для других баз данных, ограничьте число Edtu, которое может использовать база данных при интенсивной нагрузке. Если база данных постоянно использует ресурсы, переместите ее из пула и настройте в качестве отдельной базы данных с прогнозируемым объемом требуемых ресурсов.

### <a name="determine-the-number-of-dtus-needed-by-a-workload"></a>Определение числа единиц DTU, требуемых для рабочей нагрузки

Если вы хотите перенести существующую локальную или SQL Server рабочую нагрузку виртуальной машины в базу данных SQL Azure, используйте [Калькулятор DTU](https://dtucalculator.azurewebsites.net/) , чтобы приблизительно указать необходимое количество DTU. Для существующей рабочей нагрузки базы данных SQL Azure используйте [аналитические сведения о производительности запросов](sql-database-query-performance.md) , чтобы понять, как потребление ресурсов базы данных (DTU) и получить более подробные сведения для оптимизации рабочей нагрузки. Динамическое административное представление [sys. dm_db_resource_stats](https://docs.microsoft.com/sql/relational-databases/system-dynamic-management-views/sys-dm-db-resource-stats-azure-sql-database) позволяет просматривать потребление ресурсов за последний час. Представление каталога [sys. resource_stats](https://docs.microsoft.com/sql/relational-databases/system-catalog-views/sys-resource-stats-azure-sql-database) отображает потребление ресурсов за последние 14 дней, но с более низким уровнем точности в среднем за пять минут.

### <a name="determine-dtu-utilization"></a>Определение использования DTU

Чтобы определить средний процент использования DTU/eDTU относительно ограничения DTU/eDTU базы данных или эластичного пула, используйте следующую формулу:

`avg_dtu_percent = MAX(avg_cpu_percent, avg_data_io_percent, avg_log_write_percent)`

Входные значения для этой формулы можно получить из представлений [sys. dm_db_resource_stats](https://docs.microsoft.com/sql/relational-databases/system-dynamic-management-views/sys-dm-db-resource-stats-azure-sql-database), [sys. resource_stats](https://docs.microsoft.com/sql/relational-databases/system-catalog-views/sys-resource-stats-azure-sql-database)и [sys. elastic_pool_resource_stats](https://docs.microsoft.com/sql/relational-databases/system-catalog-views/sys-elastic-pool-resource-stats-azure-sql-database) DMV. Иными словами, чтобы определить процент использования DTU/eDTU в отношении ограничения DTU/eDTU базы данных или пула эластичных БД, выберите наибольшее процентное значение из следующих: `avg_cpu_percent`, `avg_data_io_percent`и `avg_log_write_percent` в определенный момент времени.

> [!NOTE]
> Ограничение DTU базы данных определяется ЦП, операциями чтения, записи и памятью, доступной базе данных. Тем не менее, поскольку ядро СУБД SQL Server обычно использует всю доступную память для кэша данных, чтобы повысить производительность, значение `avg_memory_usage_percent` обычно будет близко к 100% независимо от текущей нагрузки на базу данных. Таким образом, несмотря на то, что память косвенно влияет на предел DTU, она не используется в формуле использования DTU.
>

### <a name="workloads-that-benefit-from-an-elastic-pool-of-resources"></a>Рабочие нагрузки, для которых эффективно используется эластичный пул ресурсов

Пулы хорошо подходят для баз данных с низким средним использованием ресурсов и относительно редких пиков нагрузки. Дополнительные сведения см. [в разделе когда следует использовать эластичный пул базы данных SQL?](sql-database-elastic-pool.md).

### <a name="hardware-generations-in-the-dtu-based-purchasing-model"></a>Поколения оборудования в модели приобретения на основе DTU

В модели приобретения на основе DTU клиенты не могут выбрать поколение оборудования, используемое для баз данных. Хотя данная база данных обычно остается в определенном аппаратном создании оборудования в течение длительного времени (обычно за несколько месяцев), существуют определенные события, которые могут привести к перемещению базы данных в другое поколение оборудования.

Например, база данных может быть перемещена в другое поколение оборудования, если она масштабируется до другой цели обслуживания или если текущая инфраструктура в центре обработки данных приближается к ограничениям емкости или если используемое в настоящее время оборудование списано из-за ее окончания жизни.

Если база данных перемещается на другое оборудование, производительность рабочей нагрузки может измениться. Модель DTU гарантирует, что пропускная способность и время отклика рабочей нагрузки [производительности DTU](https://docs.microsoft.com/azure/sql-database/sql-database-service-tiers-dtu#dtu-benchmark) будут значительно совпадать, так как база данных переходит на другое поколение оборудования, если его цель обслуживания (число DTU) остается неизменной. 

Однако в широком спектре рабочих нагрузок клиента, выполняемых в базе данных SQL Azure, влияние использования различных аппаратных средств для одной цели обслуживания может быть более продолжено. Различные рабочие нагрузки будут использовать разные аппаратные конфигурации и функции. Таким образом, для рабочих нагрузок, отличных от производительности DTU, можно увидеть различия в производительности, если база данных перемещается из одного поколения оборудования в другое.

Например, приложение, чувствительное к задержке в сети, может повысить производительность го поколения оборудования и го поколения из-за использования ускорения сети в го поколения, но приложение, использующее интенсивные операции ввода-вывода, может более эффективно работать с го поколения оборудованием и го поколения коэффициент увеличения объема памяти на ядро в го поколения.

Клиенты с рабочими нагрузками, которые чувствительны к изменениям оборудования или клиентам, желающим управлять выбором оборудования для своей базы данных, могут использовать модель [Виртуальное ядро](https://docs.microsoft.com/azure/sql-database/sql-database-service-tiers-vcore) для выбора предпочтительного поколения оборудования во время создания и масштабирования базы данных. В модели Виртуальное ядро ограничения ресурсов каждой цели обслуживания в каждом формировании оборудования задокументированы как для [отдельных баз данных](https://docs.microsoft.com/azure/sql-database/sql-database-vcore-resource-limits-single-databases) , так и для [эластичных пулов](https://docs.microsoft.com/azure/sql-database/sql-database-vcore-resource-limits-elastic-pools). Дополнительные сведения о поколениях оборудования в модели Виртуальное ядро см. в разделе [поколения оборудования](https://docs.microsoft.com/azure/sql-database/sql-database-service-tiers-vcore#hardware-generations).

## <a name="frequently-asked-questions-faqs"></a>Часто задаваемые вопросы (FAQ)

### <a name="do-i-need-to-take-my-application-offline-to-convert-from-a-dtu-based-service-tier-to-a-vcore-based-service-tier"></a>Нужно ли переводить приложение в автономный режим для преобразования из уровня служб на основе DTU на уровень служб на основе виртуальное ядро?

Нет. Перевести приложение в автономный режим не требуется. Новые уровни служб предлагают простой метод интерактивного преобразования, похожий на существующий процесс обновления баз данных со Standard до уровня служб Premium и наоборот. Это преобразование можно начать с помощью портал Azure, PowerShell, Azure CLI, T-SQL или REST API. Ознакомьтесь со статьями [Управление ресурсами отдельной базы данных в Базе данных SQL Azure](sql-database-single-database-scale.md) и [Управление несколькими базами данных SQL Azure и их масштабирование с помощью эластичных пулов](sql-database-elastic-pool.md).

### <a name="can-i-convert-a-database-from-a-service-tier-in-the-vcore-based-purchasing-model-to-a-service-tier-in-the-dtu-based-purchasing-model"></a>Можно ли преобразовать базу данных из уровня службы в модели приобретения на основе виртуальное ядро в уровень служб в модели приобретения на основе DTU?

Да, можно легко преобразовать базу данных в любую поддерживаемую цель производительности с помощью портал Azure, PowerShell, Azure CLI, T-SQL или REST API. Ознакомьтесь со статьями [Управление ресурсами отдельной базы данных в Базе данных SQL Azure](sql-database-single-database-scale.md) и [Управление несколькими базами данных SQL Azure и их масштабирование с помощью эластичных пулов](sql-database-elastic-pool.md).

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о модели приобретения на основе виртуальное ядро см. в разделе [модель приобретения на основе виртуальное ядро](sql-database-service-tiers-vcore.md).
- Дополнительные сведения о модели приобретения на основе DTU см. в разделе [модель приобретения на основе DTU](sql-database-service-tiers-dtu.md).
