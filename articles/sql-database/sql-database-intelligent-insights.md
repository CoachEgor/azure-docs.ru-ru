---
title: Мониторинг производительности базы данных с помощью интеллектуальных анализов
description: База данных SQL Azure Intelligent Insights использует встроенный аналитический механизм базы данных постоянного отслеживания использования базы данных с помощью искусственного интеллекта и обнаружения аварийных событий, снижающих производительность.
services: sql-database
ms.service: sql-database
ms.subservice: performance
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: danimir
ms.author: danil
ms.reviewer: jrasnik, carlrab
ms.date: 03/10/2020
ms.openlocfilehash: d7b9ada17871dc7882209b7a8a449a8edcd61a94
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79214071"
---
# <a name="intelligent-insights-using-ai-to-monitor-and-troubleshoot-database-performance-preview"></a>Интеллектуальные исследования с использованием ИИ для мониторинга и устранения неполадок в базе данных (Предварительный просмотр)

Intelligent Insights базы данных SQL Azure позволяет узнать, что происходит с производительностью базы данных.

Intelligent Insights использует встроенный аналитический механизм базы данных постоянного отслеживания использования базы данных с помощью искусственного интеллекта и обнаружения аварийных событий, снижающих производительность. После обнаружения проводится подробный анализ, который генерирует журнал ресурсов Intelligent Insights (называемый S'LInsights) с интеллектуальной оценкой проблемы. Эта оценка состоит из анализа первопричин проблемы с производительностью базы данных и возможных рекомендаций по повышению производительности.

## <a name="what-can-intelligent-insights-do-for-you"></a>Что Intelligent Insights может сделать для вас?

Intelligent Insights — уникальная функция встроенного аналитического механизма Azure, который предлагает следующие возможности:

- Упреждающий мониторинг
- специализированная аналитика производительности;
- заблаговременное выявление снижения производительности базы данных;
- анализ первопричин обнаруженных проблем;
- рекомендации по повышению производительности;
- возможность развертывания сотен тысяч баз данных;
- положительное влияние на ресурсы DevOps и совокупную стоимость владения.

## <a name="how-does-intelligent-insights-work"></a>Как работает Intelligent Insights?

Intelligent Insights анализирует производительность базы данных и сравнивает ее рабочую нагрузку за последний час с базовыми показателями рабочей нагрузки за последние семь дней. Рабочая нагрузка базы данных состоит из запросов, которые считаются наиболее важными для производительности базы данных, такие как наиболее повторяющиеся запросы и запросы наибольшего размера. Поскольку каждая база данных уникальна в зависимости от своей структуры, данных, использования и приложения, каждая базовая рабочая нагрузка является специфической и уникальной для этой рабочей нагрузки. Независимо от базовых показателей рабочей нагрузки Intelligent Insights также отслеживает абсолютные рабочие пороговые значения и обнаруживает проблемы, связанные с повышенным временем ожидания, критическими исключениями и параметризацией запросов, которые могут негативно повлиять на производительность.

После обнаружения проблемы снижения производительности в нескольких наблюдаемых метриках с помощью искусственного интеллекта выполняется анализ. Его результаты записываются в журнал диагностики. Они содержат ценную аналитику по операциям с базой данных. Intelligent Insights позволяет легко отслеживать проблемы с производительностью базы данных с момента их выявления и до устранения. Каждая обнаруженная проблема отслеживается по всему жизненному циклу — от изначального обнаружения проблемы и проверки улучшения производительности до ее решения.

![Рабочий процесс анализа производительности базы данных](./media/sql-database-intelligent-insights/intelligent-insights-concept.png)

Метрики, используемые для измерения и обнаружения проблем с производительностью базы данных, основаны на длительности запроса, запросов с истекшим временем ожидания, повышенном времени ожидания и запросах с ошибками. Для получения дополнительной [информации](#detection-metrics)о метриках см.

Выявленные деградации производительности базы данных S'L записываются в журнал s'LInsights с интеллектуальными записями, которые состоят из следующих свойств:

| Свойство | Сведения |
| :------------------- | ------------------- |
| сведения о базе данных; | Метаданные базы данных, для которой была обнаружена аналитика. Например, URI ресурса. |
| Наблюдаемый диапазон времени | Время начала и окончания периода обнаруженной аналитики. |
| Затронутые метрики | Метрики, вызвавшие создание аналитики: <ul><li>Увеличение длительности запросов [с].</li><li>Повышенное время ожидания [с].</li><li>Запросы, время ожидания которых истекло [процент].</li><li>Запросы, завершившиеся сбоем [процент].</li></ul>|
| Значение последствий | Значение измеренной метрики. |
| Затронутые запросы и коды ошибок | Хэш запроса или код ошибки. Их можно легко сопоставить с затронутыми запросами. Предоставляются метрики увеличения продолжительности запросов, времени ожидания, счетчиков времени ожидания или кодов ошибок. |
| Обнаружения | Проблема обнаруживается в базе данных во время события. Существуют 15 шаблонов обнаружения. Дополнительные сведения см. в статье [Устранение проблем с производительностью базы данных SQL Azure с помощью Intelligent Insights](sql-database-intelligent-insights-troubleshoot-performance.md). |
| Анализ первопричин | Анализ первопричин обнаруженной проблемы в понятном для понимания формате. Некоторые аналитические данные могут содержать рекомендации по улучшению производительности, если это возможно. |
|||

Для практического обзора использования интеллектуальных анализов с azure S'L Analytics и для типичных сценариев использования смотрите это видео:

> [!VIDEO https://channel9.msdn.com/Shows/Azure-Friday/Get-Intelligent-Insights-for-Improving-Azure-SQL-Database-Performance/player]
>

Intelligent Insights является непревзойденным решением для обнаружения и устранения проблем производительности базы данных SQL. Для того, чтобы использовать Intelligent Insights для устранения неполадок в работе базы данных, см. [проблемы с производительностью базы данных Troubleshoot Azure S'L с помощью Intelligent Insights.](sql-database-intelligent-insights-troubleshoot-performance.md)

## <a name="intelligent-insights-options"></a>Интеллектуальные варианты исследования

Варианты интеллектуальных анализов, доступные в базе данных Azure S'L:

| Вариант интеллектуальных взглядов | Поддержка отдельной базы данных и базы данных в пуле | Поддержка базы данных инстанций |
| :----------------------------- | ----- | ----- |
| **Наймите интеллектуальные исследования** - налаживайте анализ интеллектуальных анализов для баз данных. | Да | Да |
| **Информация о стримейте информацию об аналитике Azure S'L** - Stream-идеи для мониторинга мониторинга Azure S'L Analytics для базы данных Azure S'L. | Да | Да |
| **Поток идеи для событий концентратор** - поток идеи для событий концентраторов для дальнейшей пользовательской интеграции. | Да | Да |
| **Поток информации для хранения Azure** - Поток идеи для хранения Azure для дальнейшего анализа и долгосрочного архива. | Да | Да |

## <a name="configure-the-export-of-the-intelligent-insights-log"></a>Настройка экспорта журнала Intelligent Insights

Выход интеллектуальных анализов можно передавать в один из нескольких направлений для анализа:

- Выход, перетекаемый в рабочее пространство log Analytics, может использоваться с помощью [azure S'L Analytics](https://docs.microsoft.com/azure/log-analytics/log-analytics-azure-sql) для просмотра информации через пользовательский интерфейс портала Azure. Это интегрированное решение Azure, а также наиболее типичный способ просмотра аналитических сведений.
- Выход, перетекающий в концентраторы событий Azure, может использоваться для разработки сценариев пользовательского мониторинга и оповещения
- Выход, перетекаемый в Azure Storage, может использоваться для разработки пользовательских приложений, например, для пользовательских отчетов, долгосрочных архивов данных и так далее.

Интеграция Azure S'L Analytics, Azure Event Hub, Azure Storage или сторонних продуктов для потребления осуществляется сначала с помощью включения в систему интеллектуальных поисков Insights (журнал "S'LInsights") в лезвии диагностических настроек базы данных, а затем настройка данных журнала Intelligent Insights для потоковой передачи в один из этих направлений.

Для получения дополнительной [информации](sql-database-metrics-diag-logging.md)о том, как включить журнал интеллектуальных поисков Insights и настроить метрические данные и данные журнала ресурсов, которые будут передаваться в потребляющий продукт, см.

### <a name="set-up-with-azure-sql-analytics"></a>Настройка для использования с Аналитикой SQL Azure

Решение Azure S'L Analytics предоставляет графический пользовательский интерфейс, отчетность и оповещение о производительности базы данных, используя данные журнала интеллектуальных взглядов.

Добавьте аналитику Azure S'L в панель мониторинга портала Azure с рынка и создайте рабочее пространство, [см.](../azure-monitor/insights/azure-sql.md#configuration)

Чтобы использовать Intelligent Insights с Аналитикой SQL Azure, настройте потоковую передачу данных журнала Intelligent Insights в рабочую область Аналитики SQL Azure, которую вы создали на предыдущем этапе, как описано в статье [Ведение журналов метрик и диагностики Базы данных SQL Azure](sql-database-metrics-diag-logging.md).

Ниже приведен пример просмотра данных Intelligent Insights в Аналитике SQL Azure:

![Отчет Intelligent Insights](./media/sql-database-intelligent-insights/intelligent-insights-azure-sql-analytics.png)

### <a name="set-up-with-event-hubs"></a>Настройка для использования с Центрами событий

Чтобы использовать интеллектуальные исследования с концентраторами событий, найдите данные журнала Intelligent Insights, которые будут передаваться в концентраторы событий, см. [метрики базы данных и диагностики Azure S'L,](sql-database-metrics-diag-logging.md) а также [журналы диагностики Stream Azure в концентрах событий.](../azure-monitor/platform/resource-logs-stream-event-hubs.md)

Сведения об использовании Центров событий для настраиваемого мониторинга и оповещений см. в разделе [Метрики и журналы диагностики базы данных SQL Azure](sql-database-metrics-diag-logging.md#what-to-do-with-metrics-and-resource-logs-in-event-hubs).

### <a name="set-up-with-azure-storage"></a>Настройка для использования со службой хранилища Azure

Чтобы использовать интеллектуальные исследования с хранилищем, найдите данные журнала Intelligent Insights, которые будут передаваться [Stream into Azure Storage](sql-database-metrics-diag-logging.md#stream-into-azure-storage)в хранилище, [см.](sql-database-metrics-diag-logging.md)

### <a name="custom-integrations-of-intelligent-insights-log"></a>Настраиваемая интеграция журнала Intelligent Insights

Чтобы использовать Intelligent Insights с инструментами сторонних производителей или для разработки настраиваемых оповещений и мониторинга, ознакомьтесь с разделом [Использование журнала диагностики производительности Intelligent Insights для базы данных SQL Azure](sql-database-intelligent-insights-use-diagnostics-log.md).

## <a name="detection-metrics"></a>Метрики обнаружения

Метрики, используемые в моделях обнаружения, создаваемых Intelligent Insights, отслеживают:

- Query duration (Длительность запросов)
- Запросы, время ожидания которых истекло
- повышенное время ожидания;
- запросы, завершившиеся сбоем.

Метрики длительности запросов и времени ожидания запросов используются в качестве основных моделей для обнаружения проблем, связанных с производительностью рабочей нагрузки базы данных. Причина этого состоит в том, что они непосредственно измеряют рабочую нагрузку. Для обнаружения всех возможных вариантов снижения производительности рабочей нагрузки в качестве дополнительных моделей используются метрики повышенного времени ожидания и запросов, завершенных сбоем. Это позволяет выявлять проблемы, влияющие на производительность рабочей нагрузки.

Система автоматически учитывает изменения рабочей нагрузки и числа запросов к базе данных, чтобы динамически определять нормальные и ненормальные пороговые значения производительности базы данных.

Все метрики учитываются вместе в различных сочетаниях благодаря научной модели данных, позволяющей классифицировать каждую обнаруженную проблему с производительностью. Intelligent Insight предоставляет следующие сведения:

- сведения об обнаруженной проблеме с производительностью;
- анализ первопричин обнаруженных проблем;
- рекомендации по улучшению производительности отслеживаемой базы данных SQL, если это возможно.

## <a name="query-duration"></a>Query duration (Длительность запросов)

Модель снижения производительности из-за повышения длительности запросов анализирует отдельные запросы и выявляет увеличение времени, необходимого для компиляции и выполнения запроса, по сравнению с базовыми показателями производительности.

Если встроенный аналитический механизм базы данных SQL обнаруживает существенное увеличение времени, затрачиваемого на компиляцию или выполнение запросов, что негативно влияет на производительность рабочей нагрузки, такие запросы помечаются как снижающие производительность из-за увеличения длительности.

Журнал диагностики Intelligent Insights содержит хэш запроса, снижающего производительность, который указывает, связано ли это снижение с увеличением времени компиляции или выполнения запроса. Он также содержит увеличенную длительность запроса.

## <a name="timeout-requests"></a>Запросы, время ожидания которых истекло

Модель снижения производительности из-за истечения времени ожидания запросов анализирует отдельные запросы и выявляет увеличение числа случаев истечения времени ожидания на уровне выполнения запроса, а также общее число случаев истечения времени ожидания запросов на уровне базы данных по сравнению с периодом базовых показателей производительности.

Некоторые из запросов могут истекать даже до того, как достигнут этапа исполнения. Встроенный аналитический механизм базы данных SQL также измеряет и анализирует (сравнивая прерванные рабочие роли и отправленные запросы) все запросы, которые достигли базы данных, вне зависимости от того, достигли ли они этапа выполнения.

Как только число выполненных запросов, время ожидания которых истекло, или число прерванных рабочих ролей запросов превысит системное пороговое значение, журнал диагностики заполнится ценной аналитикой.

Созданная аналитика содержит число запросов, время ожидания которых истекло. Снижение производительности связано с увеличением числа запросов, время ожидания которых истекло на этапе выполнения, или с увеличением числа запросов, время ожидания которых истекло на общем уровне базы данных. Если увеличение числа запросов, время ожидания которых истекло, является существенным для производительности базы данных, то эти запросы помечаются как снижающие производительность из-за истечения времени ожидания.

## <a name="excessive-wait-times"></a>Повышенное время ожидания

Модель повышенного времени ожидания отслеживает отдельные запросы к базе данных. Она выявляет необычно высокие значения статистики по времени ожидания запросов, превышающие абсолютные пороговые значения, управляемые системой. Ниже приведены метрики запросов с повышенным временем ожидания, отслеживаемые с помощью нового компонента SQL Server, Query Store Wait Stats, отображающего статистику времени ожидания из хранилища запросов (sys.query_store_wait_stats):

- достижение лимитов ресурсов;
- достижение лимитов ресурсов эластичного пула;
- чрезмерное количество рабочих потоков или потоков сеансов;
- чрезмерная блокировка базы данных;
- нехватка памяти;
- прочая статистика времени ожидания.

Достижение лимитов ресурсов или лимитов ресурсов эластичных пулов означает, что потребление доступных ресурсов подписки или эластичного пула превысило абсолютный порог. Это является признаком снижения производительности рабочей нагрузки. Чрезмерное количество рабочих потоков или потоков сеансов указывает, что число инициализированных рабочих потоков или сеансов достигло абсолютного порога. Это является признаком снижения производительности рабочей нагрузки.

Чрезмерная блокировка базы данных указывает, что счетчик блокировок в базе данных достиг абсолютного порога. Эта статистика указывает на снижение производительности рабочей нагрузки. Нехватка памяти — это условие, при котором количество потоков, запрашивающих временно предоставляемый буфер памяти, достигло абсолютного порога. Эта статистика указывает на снижение производительности рабочей нагрузки.

Прочая статистика времени ожидания указывает, что различные метрики, измеряемые с помощью компонента Query Store Wait Stats, превысили абсолютное пороговое значение. Это является признаком снижения производительности рабочей нагрузки.

После обнаружения повышенного времени ожидания, в зависимости от доступных данных, в журнал диагностики Intelligent Insights записываются хэши запросов, снижающих производительность, и запросов, производительность которых понизилась. В него также добавляются сведения о метриках, выявивших запросы с повышенным временем ожидания выполнения и измеривших это время.

## <a name="errored-requests"></a>Запросы с ошибками

Модель снижения производительности из-за запросов с ошибками отслеживает отдельные запросы и выявляет увеличение количества запросов с ошибками по сравнению с периодом базовых показателей. Эта модель также отслеживает критические исключения, которые достигли абсолютных пороговых значений, которыми управляет встроенный аналитический механизм базы данных SQL. Система автоматически учитывает количество запросов к базе данных и изменения рабочей нагрузки за отслеживаемый период.

Когда измеряемое увеличение запросов с ошибками относительно общего количества выполняемых запросов становится значительным и влияет на производительность рабочей нагрузки, затронутые запросы помечаются как снижающие производительность из-за запросов с ошибками.

Журнал Intelligent Insights выводит количество запросов с ошибками. Указывает, связано ли снижение производительности с увеличением запросов с ошибками или достижением порога отслеживаемого критического исключения. Он также содержит измеренное время снижения производительности.

Если какое-либо из отслеживаемых критических исключений превышает абсолютное пороговое значение, управляемое системой, создается ценная аналитика, содержащая сведения о критическом исключении.

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте, как [отслеживать базу данных SQL с помощью SQL Analytics](../azure-monitor/insights/azure-sql.md).
- Узнайте, как [устранять проблемы с производительностью базы данных SQL с помощью Intelligent Insights](sql-database-intelligent-insights-troubleshoot-performance.md).
