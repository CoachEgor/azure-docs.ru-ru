---
title: 'Управляемый экземпляр базы данных SQL: вопросы и ответы | Документация Майкрософт'
description: Часто задаваемые вопросы об управляемом экземпляре базы данных SQL
services: sql-database
ms.service: sql-database
ms.subservice: managed-instance
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: jovanpop-msft
ms.author: jovanpop
ms.reviewer: sstein, carlrab
ms.date: 07/16/2019
ms.openlocfilehash: 7e341cf8a4ff2a18e44e36d73ad5dbc642582802
ms.sourcegitcommit: c22327552d62f88aeaa321189f9b9a631525027c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2019
ms.locfileid: "73496279"
---
# <a name="sql-database-managed-instance-frequently-asked-questions-faq"></a>Часто задаваемые вопросы об управляемом экземпляре базы данных SQL

Эта статья содержит множество наиболее часто встречающихся вопросов об [управляемом экземпляре базы данных SQL](sql-database-managed-instance.md).

## <a name="where-can-i-find-a-list-of-features-supported-on-managed-instance"></a>Где можно найти список возможностей, поддерживаемых управляемым экземпляром?

Список поддерживаемых функций в управляемом экземпляре см. в разделе [база данных SQL Azure и SQL Server](sql-database-features.md).

Различия в синтаксисе и поведении между управляемым экземпляром базы данных SQL Azure и локальными SQL Serverми см. в разделе [отличия T-SQL от SQL Server](sql-database-managed-instance-transact-sql-information.md).


## <a name="where-can-i-find-technical-characteristics-and-resource-limits-for-managed-instance"></a>Где можно найти технические характеристики и ограничения ресурсов для управляемого экземпляра?

Сведения о доступных характеристиках создания оборудования см. [в разделе технические различия в поколениях оборудования](sql-database-managed-instance-resource-limits.md#hardware-generation-characteristics).
Сведения о доступных уровнях служб и их характеристиках см. в статье [технические различия между уровнями служб](sql-database-managed-instance-resource-limits.md#service-tier-characteristics).

## <a name="where-can-i-find-known-issues-and-bugs"></a>Где можно найти известные проблемы и ошибки?

Об ошибках и известных проблемах см. в статье [Известные проблемы](sql-database-managed-instance-transact-sql-information.md#Issues).

## <a name="where-can-i-find-latest-features-and-the-features-in-public-preview"></a>Где можно найти новейшие функции и функции в общедоступной предварительной версии?

Для новых и предварительных версий функций см. [заметки о выпуске](/azure/sql-database/sql-database-release-notes?tabs=managed-instance).

## <a name="how-much-time-takes-to-create-or-update-instance-or-to-restore-a-database"></a>Сколько времени занимает создание или обновление экземпляра или восстановление базы данных?

Ожидаемое время создания нового управляемого экземпляра или изменения уровня служб (виртуальных ядер, хранилище) зависит от нескольких факторов. Ознакомьтесь с [операциями управления](/azure/sql-database/sql-database-managed-instance#managed-instance-management-operations) 

## <a name="can-a-managed-instance-have-the-same-name-as-on-premises-sql-server"></a>Может ли управляемый экземпляр иметь то же имя, что и локальная SQL Server?

Имя управляемого экземпляра должно заканчиваться на *Database.Windows.NET*. Чтобы использовать другую зону DNS вместо значения по умолчанию, например **MI-Name**. contoso.com: 
- Используйте Кликонфиг для определения псевдонима. Это средство является просто оболочкой параметров реестра, поэтому ее можно выполнить с помощью групповой политики или сценария.
- Используйте *CNAME* с параметром *TrustServerCertificate = true* .

## <a name="how-can-i-move-database-from-managed-instance-back-to-sql-server-or-azure-sql-database"></a>Как переместить базу данных из управляемого экземпляра обратно в SQL Server или базу данных SQL Azure?

Можно [экспортировать базу данных в BACPAC](sql-database-export.md) , а затем [импортировать BACPAC-файл]( sql-database-import.md). Этот подход рекомендуется, если размер базы данных меньше 100 ГБ.

Репликацию транзакций можно использовать, если все таблицы в базе данных имеют первичные ключи.

Резервные копии машинного `COPY_ONLY`, созданные из управляемого экземпляра, не могут быть восстановлены в SQL Server, так как для управляемого экземпляра выше по сравнению с SQL Server.

## <a name="how-can-i-migrate-my-instance-database-to-a-single-azure-sql-database"></a>Как перенести базу данных экземпляра в отдельную базу данных SQL Azure?

Один из вариантов — [экспортировать базу данных в BACPAC](sql-database-export.md) , а затем [импортировать BACPAC-файл](sql-database-import.md). 

Этот подход рекомендуется, если размер базы данных меньше 100 ГБ. Репликацию транзакций можно использовать, если все таблицы в базе данных имеют первичные ключи.

## <a name="how-do-i-choose-between-gen-4-and-gen-5-hardware-generation-for-managed-instance"></a>Разделы справки выбрать между созданием оборудования GEN 4 и Gen 5 для управляемого экземпляра?

Это зависит от рабочей нагрузки, так как какое-либо создание оборудования лучше для определенных типов рабочих нагрузок, чем в другом. Хотя тема производительности довольно сложна для упрощения, следующие различия между поколениями оборудования, влияющими на производительность рабочей нагрузки:
- Gen 4 обеспечивает лучшую поддержку вычислений, так как она основана на физических процессорах, а также на Gen 5, основанном на процессорах Виртуальное ядро. Это может быть более выгодно для ресурсоемких рабочих нагрузок.
- Gen 5 поддерживает ускоренную работу сети, что приводит к повышению пропускной способности ввода-вывода в удаленное хранилище. Это может быть выгодно для интенсивных рабочих нагрузок операций ввода-вывода на общего назначения уровнях служб. В Gen 5 используются более быстрые локальные диски SSD по сравнению с GEN 4. Это может быть выгодно для интенсивных рабочих нагрузок операций ввода-вывода на критически важных для бизнеса уровнях обслуживания.

Настоятельно рекомендуется протестировать производительность фактических рабочих нагрузок, предназначенных для рабочей среды, прежде чем начать работу, чтобы определить, какое аппаратное поколение будет работать лучше в конкретном случае.

## <a name="can-i-switch-my-managed-instance-hardware-generation-between-gen-4-and-gen-5-online"></a>Можно ли переключить создание оборудования управляемого экземпляра между GEN 4 и Gen 5 Online? 

Автоматическое переключение в оперативный режим между поколениями оборудования возможно, если оба поколения оборудования доступны в регионе, где подготовлен управляемый экземпляр. В этом случае можно использовать [сценарий из записи блога](https://techcommunity.microsoft.com/t5/Azure-SQL-Database/Change-hardware-generation-on-Managed-Instance/ba-p/699824) , объясняющие, как переключаться между поколениями оборудования.

Это длительная операция, так как новый управляемый экземпляр будет подготовлен в фоновом режиме, и базы данных автоматически переносятся между старым и новым экземплярами с помощью быстрой отработки отказа в конце процесса. 

Если оба поколения оборудования не поддерживаются в одном регионе, изменение создания оборудования возможно, но необходимо выполнить вручную. Для этого необходимо подготавливать новый экземпляр в регионе, где доступно необходимое поколение оборудования, и вручную выполнять резервное копирование и восстановление данных между старым и новым экземплярами.


## <a name="how-do-i-tune-performance-of-my-managed-instance"></a>Разделы справки настроить производительность своего управляемого экземпляра? 

Общего назначения управляемый экземпляр использует удаленное хранилище из-за того, какой размер файлов данных и журналов имеет значение для производительности. Дополнительные сведения см. [в разделе влияние размера файла журнала на общего назначения управляемый экземпляр производительности](https://medium.com/azure-sqldb-managed-instance/impact-of-log-file-size-on-general-purpose-managed-instance-performance-21ad170c823e).

Для рабочих нагрузок с интенсивным вводом-выводом можно использовать оборудование поколения 5, а для ресурсоемких рабочих нагрузок — GEN 4. Дополнительные сведения см. в разделе [разделы справки выбор между GEN 4 и Gen 5](#how-do-i-choose-between-gen-4-and-gen-5-hardware-generation-for-managed-instance).

Если Рабочая нагрузка состоит из большого количества небольших транзакций, рассмотрите возможность переключения типа подключения с прокси на режим перенаправления.

## <a name="what-is-the-maximum-storage-size-for-managed-instance"></a>Каков максимальный размер хранилища для управляемого экземпляра? 

Размер хранилища для управляемого экземпляра зависит от выбранного уровня служб (общего назначения или критически важный для бизнеса). Ограничения хранилища этих уровней служб см. в статье [характеристики уровня служб](sql-database-service-tiers-general-purpose-business-critical.md).

## <a name="is-the-backup-storage-deducted-from-my-managed-instance-storage"></a>Вычитается ли хранилище резервных копий из хранилища управляемых экземпляров? 

Нет, хранилище резервных копий не вычитается из пространства хранилища управляемого экземпляра. Хранилище резервных копий не зависит от места хранения экземпляров и не ограничивается размером. Хранилище резервных копий ограничено периодом времени, в течение которого будет храниться резервная копия баз данных экземпляра, настраиваемая с 7 до 35 дней. Дополнительные сведения см. в разделе [Автоматическое резервное копирование](https://docs.microsoft.com/azure/sql-database/sql-database-automated-backups).
  
## <a name="how-can-i-set-inbound-nsg-rules-on-management-ports"></a>Как настроить входящие правила NSG на портах управления?

Встроенная функция брандмауэра настраивает брандмауэр Windows на всех виртуальных машинах в кластере, чтобы разрешить входящие подключения из диапазонов IP-адресов, связанных только с компьютерами по управлению и развертыванию (Майкрософт), и защищенные рабочие станции администрирования эффективно препятствуют вторжение через сетевой уровень.

Вот какие порты используются для:

Порты 9000 и 9003 используются Service Fabric инфраструктурой. Service Fabric первичной роли — обеспечение работоспособности виртуального кластера и сохранение состояния цели с точки зрения количества реплик компонентов.

Порты 1438, 1440 и 1452 используются агентом узла. Агент узла — это приложение, которое работает внутри кластера и используется плоскостью управления для выполнения команд управления.

Помимо встроенного брандмауэра на уровне сети, Обмен данными также защищается сертификатами.
  
Дополнительные сведения и о том, как проверить встроенный брандмауэр, см. [в разделе встроенный брандмауэр управляемого экземпляра базы данных SQL Azure](sql-database-managed-instance-management-endpoint-verify-built-in-firewall.md).


## <a name="how-can-i-mitigate-networking-risks"></a>Как устранить риски с сетью? 

Чтобы уменьшить риски с сетью, пользователям рекомендуется применить набор параметров безопасности и элементов управления.

- Включите [прозрачное шифрование данных (TDE)](https://docs.microsoft.com/azure/sql-database/transparent-data-encryption-azure-sql) во всех базах данных.
- Выключите среду CLR. Это также рекомендуется и в локальной среде.
- Используйте только проверку подлинности Azure Active Directory (AAD).
- Экземпляр доступа с учетной записью администратора с низким уровнем привилегий.
- Настройка доступа к JiT-Jumpbox для учетной записи sysadmin.
- Включите [аудит SQL](https://docs.microsoft.com/sql/relational-databases/security/auditing/sql-server-audit-database-engine)и интегрируйте его с механизмами предупреждений.
- Включите [обнаружение угроз](https://docs.microsoft.com/azure/sql-database/sql-database-threat-detection) в пакете [расширенной защиты данных (ADS)](https://docs.microsoft.com/azure/sql-database/sql-database-advanced-data-security) .


## <a name="where-can-i-find-use-cases-and-resulting-cost-savings-with-managed-instance"></a>Где можно найти варианты использования и сократить расходы с помощью управляемого экземпляра?

Примеры использования управляемого экземпляра:

- [коматсу](https://customers.microsoft.com/story/komatsu-australia-manufacturing-azure)
- [кмд](https://customers.microsoft.com/en-ca/story/kmd-professional-services-azure-sql-database)
- [повердетаилс](https://customers.microsoft.com/story/powerdetails-partner-professional-services-azure-sql-database-managed-instance)
- [Аллскриптс](https://customers.microsoft.com/story/allscripts-partner-professional-services-azure)   
Чтобы получить более полное представление о преимуществах, затратах и рисках, связанных с развертыванием управляемого экземпляра базы данных SQL Azure, также можно изучить Forrester: [Общее экономическое воздействие на MI](https://azure.microsoft.com/resources/forrester-tei-sql-database-managed-instance).


## <a name="can-i-do-dns-refresh"></a>Можно ли выполнить обновление DNS? 
  
Сейчас мы не предоставляем функцию для обновления конфигурации DNS-сервера для управляемого экземпляра.

В конечном итоге обновляется конфигурация DNS:

- По истечении срока аренды DHCP.
- При обновлении платформы.

В качестве обходного решения понизить управляемый экземпляр до 4 Виртуальное ядро и снова обновить его. Это оказывает побочный результат обновления конфигурации DNS.


## <a name="can-a-managed-instance-have-a-static-ip-address"></a>Может ли управляемый экземпляр иметь статический IP-адрес?

В редких, но необходимых ситуациях может потребоваться выполнить оперативную миграцию управляемого экземпляра в новый виртуальный кластер. При необходимости эта миграция обусловлена изменениями в нашем технологическом стеке, предназначенным для повышения безопасности и надежности службы. Миграция в новый виртуальный кластер приводит к изменению IP-адреса, сопоставленного с именем узла управляемого экземпляра. Служба управляемого экземпляра не требует поддержки статических IP-адресов и оставляет за собой право менять ее без уведомления в рамках регулярных циклов обслуживания.

По этой причине мы настоятельно рекомендуем полагаться на неизменность IP-адреса, так как это может привести к ненужному простою.

## <a name="can-i-move-a-managed-instance-or-its-vnet-to-another-resource-group"></a>Можно ли переместить управляемый экземпляр или его виртуальную сеть в другую группу ресурсов?

Нет, это ограничение текущей платформы. После создания управляемого экземпляра перемещение управляемого экземпляра или виртуальной сети в другую группу ресурсов или подписку не поддерживается.

## <a name="can-i-change-the-time-zone-for-an-existing-managed-instance"></a>Можно ли изменить часовой пояс для существующего управляемого экземпляра?

Настройка часового пояса может быть установлена при первой инициализации управляемого экземпляра. Изменение часового пояса существующего управляемого экземпляра не поддерживается. Дополнительные сведения см. в разделе [ограничения часовых поясов](sql-database-managed-instance-timezone.md#limitations).

К обходным решениям относятся создание нового управляемого экземпляра с соответствующим часовым поясом, а затем выполнение резервного копирования и восстановления вручную, а также рекомендации по выполнению [восстановления на момент времени между экземплярами](https://blogs.msdn.microsoft.com/sqlserverstorageengine/2018/06/07/cross-instance-point-in-time-restore-in-azure-sql-database-managed-instance/).


## <a name="how-do-i-resolve-performance-issues-with-my-managed-instance"></a>Разделы справки устранить проблемы с производительностью управляемого экземпляра

Для сравнения производительности между управляемым экземпляром и SQL Server хорошей отправной точкой являются рекомендации [по сравнению производительности между управляемым экземпляром SQL Azure и SQL Serverной](https://techcommunity.microsoft.com/t5/Azure-SQL-Database/The-best-practices-for-performance-comparison-between-Azure-SQL/ba-p/683210) статьей.

Загрузка данных часто замедляется на управляемом экземпляре, чем в SQL Server из-за обязательной модели полного восстановления и [ограничений](https://docs.microsoft.com/azure/sql-database/sql-database-managed-instance-resource-limits#service-tier-characteristics) пропускной способности записи в журнал транзакций. Иногда это можно обойти, загружая временные данные в базу данных tempdb, а не пользовательскую, либо используя кластеризованные индексы columnstore или оптимизированные для памяти таблицы.


## <a name="can-i-restore-my-encrypted-database-to-managed-instance"></a>Можно ли восстановить зашифрованную базу данных на управляемый экземпляр?

Да, вам не нужно расшифровывать базу данных, чтобы ее можно было восстановить в управляемом экземпляре. Необходимо предоставить сертификат или ключ, используемый в качестве предохранителя ключа шифрования в исходной системе для управляемого экземпляра, чтобы иметь возможность считывать данные из зашифрованного файла резервной копии. Это можно осуществить двумя путями:

- *Передача предохранителя сертификата в управляемый экземпляр*. Это можно сделать только с помощью PowerShell. [Пример скрипта](https://docs.microsoft.com/azure/sql-database/sql-database-managed-instance-migrate-tde-certificate) описывает весь процесс.
- *Передача асимметричного предохранителя ключа в Azure Key Vault (AKV) и управляемый экземпляр Point*. Этот подход похож на вариант использования TDE с собственным ключом (BYOK), который также использует интеграцию AKV для хранения ключа шифрования. Если вы не хотите использовать ключ в качестве предохранителя ключа шифрования и просто хотите сделать ключ доступным для управляемого экземпляра для восстановления зашифрованных баз данных, следуйте инструкциям по [настройке BYOK TDE](https://docs.microsoft.com/azure/sql-database/transparent-data-encryption-azure-sql#manage-transparent-data-encryption)и не устанавливайте флажок, чтобы *сделать выбранный ключ средство защиты TDE по умолчанию*.

После того как средство защиты шифрования доступно для управляемого экземпляра, можно продолжить стандартную процедуру восстановления базы данных.

## <a name="how-can-i-migrate-from-azure-sql-database-single-or-elastic-pool-to-managed-instance"></a>Как выполнить миграцию из одного или эластичного пула базы данных SQL Azure в управляемый экземпляр? 

Управляемый экземпляр предлагает те же уровни производительности для вычислений и размера хранилища, что и другие варианты развертывания базы данных SQL Azure. Если необходимо консолидировать данные в одном экземпляре или требуется только функция, поддерживаемая исключительно в управляемом экземпляре, можно перенести данные с помощью функции экспорта и импорта (BACPAC).
