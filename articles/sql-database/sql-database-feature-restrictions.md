---
title: Ограничения функции базы данных SQL Azure | Документация Майкрософт
description: Ограничения функции базы данных SQL Azure позволяет повысить безопасность базы данных за счет ограничения возможностей базы данных, которые могут быть злоумышленниками для получения доступа к их данным.
services: sql-database
ms.service: sql-database
ms.subservice: security
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: vainolo
ms.author: arib
ms.reviewer: vanto
manager: craigg
ms.date: 03/22/2019
ms.openlocfilehash: ac7a074e78def504a10b4daa07971f919f414a88
ms.sourcegitcommit: 25a60179840b30706429c397991157f27de9e886
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/28/2019
ms.locfileid: "66259457"
---
# <a name="azure-sql-database-feature-restrictions"></a>Ограничения функции базы данных SQL Azure

Одним из общих источников атак SQL Server — через веб-приложений, которые обращаются к базе данных, где используются различные виды атак путем внедрения кода SQL, чтобы собрать сведения о базе данных.  В идеале код приложения разрабатывается, поэтому он не поддерживает наличие внедрений кода SQL.  Тем не менее в крупных-базах кода, которые включают прежних версий и внешний код, никогда не можно убедиться, что были разрешены все случаи, поэтому факт, у нас есть для защиты от атак типа SQL injection.  Функциональные ограничения предназначена для предотвращения некоторые виды путем внедрения кода SQL, от утечки сведений о базе данных, даже в том случае, если путем внедрения кода SQL выполнена успешно.

## <a name="enabling-feature-restrictions"></a>Включение функциональных ограничений

Включение функциональных ограничений выполняется с помощью `sp_add_feature_restriction` хранимой процедуры следующим образом:

```sql
EXEC sp_add_feature_restriction <feature>, <object_class>, <object_name>
```

Следующие функции могут быть ограничены:

| Компонент          | Описание |
|------------------|-------------|
| N'ErrorMessages | При ограничения, будут замаскированы какие-либо данные в сообщении об ошибке. См. в разделе [сообщения об ошибках компонентов ограниченного использования программ](#error-messages-feature-restriction) |
| N'Waitfor "       | Когда ограничена, команда вернет сразу без задержки. См. в разделе [WAITFOR функция ограничения](#waitfor-feature-restriction) |

Значение `object_class` может быть либо `N'User'` или `N'Role'` для обозначения ли `object_name` — имя пользователя или имя роли в базе данных.

Следующий пример вызывает все сообщения об ошибках для пользователя `MyUser` маскированию:

```sql
EXEC sp_add_feature_restriction N'ErrorMessages', N'User', N'MyUser'
```

## <a name="disabling-feature-restrictions"></a>Отключение функциональных ограничений

Выполняется отключение функциональных ограничений с помощью `sp_drop_feature_restriction` хранимой процедуры следующим образом:

```sql
EXEC sp_drop_feature_restriction <feature>, <object_class>, <object_name>
```

В следующем примере отключается маски ошибка сообщение для пользователя `MyUser`:

```sql
EXEC sp_drop_feature_restriction N'ErrorMessages', N'User', N'MyUser'
```

## <a name="viewing-feature-restrictions"></a>Просмотр функциональных ограничений

`sys.sql_feature_restrictions` Представление представляет все определенные функциональные ограничения в базе данных. Он содержит следующие столбцы:

| Имя столбца | Тип данных | Описание |
|-------------|-----------|-------------|
| class       | nvarchar(128) | Класс объекта, к которому применяется ограничение |
| object      | nvarchar(256) | Имя объекта, к которому применяется ограничение |
| Функция     | nvarchar(128) | Компонент, который является ограниченным |

## <a name="feature-restrictions"></a>Функциональные ограничения

### <a name="error-messages-feature-restriction"></a>Ошибка сообщения функция ограничения

Одним из обычных способов атаки путем внедрения кода SQL — для вставки кода, которая вызывает ошибку.  Изучив сообщение об ошибке, злоумышленнику узнать сведения о системе, включение дополнительных более целенаправленных атак.  Эта атака может быть особенно полезным, где приложение не отображает результаты запроса, но отображения сообщений об ошибках.

Рассмотрим приложение с запроса в виде:

```html
http://www.contoso.com/employee.php?id=1
```

Которая выполняет следующий запрос к базе данных:

```sql
SELECT Name FROM EMPLOYEES WHERE Id=$EmpId
```

Если значение, переданное в качестве `id` параметр для запроса веб-приложения копируется для замены $EmpId в запросе к базе данных, злоумышленник может сделать следующий запрос:

```html
http://www.contoso.com/employee.php?id=1 AND CAST(DB_NAME() AS INT)=0
```

И ниже будет возвращена ошибка, что позволит злоумышленнику узнать имя базы данных:

```sql
Conversion failed when converting the nvarchar value 'HR_Data' to data type int.
```

После включения сообщения об ошибках возможности, ограничения для пользователя приложения в базе данных, таким образом, чтобы не внутренние сведения о базе данных происходит утечка маскировки возвращаемое сообщение об ошибке:

```sql
Conversion failed when converting the ****** value '******' to data type ******.
```

Аналогичным образом злоумышленник может сделать следующий запрос:

```html
http://www.contoso.com/employee.php?id=1 AND CAST(Salary AS TINYINT)=0
```

И ниже будет возвращена ошибка, что позволит злоумышленнику узнать заработной платы сотрудника:

```sql
Arithmetic overflow error for data type tinyint, value = 140000.
```

Ошибка сообщения компонент ограничение возвратят базы данных:

```sql
Arithmetic overflow error for data type ******, value = ******.
```

### <a name="waitfor-feature-restriction"></a>Ограничения функции WAITFOR

Людей с нарушениями зрения внедрения кода SQL — приложение не предоставляет злоумышленнику с результатами внедренного SQL или с сообщением об ошибке, когда злоумышленник может получить сведения из базы данных, создав условный запрос, в котором два условных ветвей занимают много разных время выполнения. Сравнивая время отклика, злоумышленник может знать, какую ветвь была выполнена и тем самым Дополнительные сведения о системе. Самый простой вариант подобной атаки используется `WAITFOR` инструкции для введения задержки.

Рассмотрим приложение с запроса в виде:

```html
http://www.contoso.com/employee.php?id=1
```

которая выполняет следующий запрос к базе данных:

```sql
SELECT Name FROM EMPLOYEES WHERE Id=$EmpId
```

Если значение, переданное в качестве параметра идентификатор приложения на веб-запросы копируется для замены $EmpId в запросе к базе данных, злоумышленник может сделать следующий запрос:

```html
http://www.contoso.com/employee.php?id=1; IF SYSTEM_USER='sa' WAITFOR DELAY '00:00:05'
```

И запрос будет принимать дополнительные 5 секунд, если `sa` учетная запись использовалась. Если `WAITFOR` ограничение компонент отключен в базе данных, `WAITFOR` будет игнорироваться инструкции и сведения не происходит утечка с помощью этой атаки.