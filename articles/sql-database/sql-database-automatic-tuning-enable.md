---
title: Включение автоматической настройки
description: Вы можете легко включить автоматическую настройку для базы данных SQL Azure.
services: sql-database
ms.service: sql-database
ms.subservice: performance
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: danimir
ms.author: danil
ms.reviewer: jrasnik, carlrab
ms.date: 12/03/2019
ms.openlocfilehash: eed839c277156046ff9b7d97c6e87636a0822889
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "79299334"
---
# <a name="enable-automatic-tuning-to-monitor-queries-and-improve-workload-performance"></a>Включение автоматической настройки для отслеживания запросов и повышения производительности рабочей нагрузки

База данных SQL Azure — это автоматически управляемая служба данных, которая постоянно отслеживает запросы и определяет действия, которые вы можете выполнять для повышения производительности рабочей нагрузки. Вы можете просматривать рекомендации и вручную применять их, или позволить базе данных SQL Azure автоматически применять действия по исправлению, что известно как **режим автоматической настройки**.

Автоматическую настройку можно включить на уровне сервера или базы данных с помощью [портала Azure](sql-database-automatic-tuning-enable.md#azure-portal), вызовов [REST API](sql-database-automatic-tuning-enable.md#rest-api) или команд [T-SQL](https://docs.microsoft.com/sql/t-sql/statements/alter-database-transact-sql-set-options?view=azuresqldb-current).

> [!NOTE]
> Для Управляемый экземпляр поддерживаемый параметр FORCE_LAST_GOOD_PLAN можно настроить только с помощью [T-SQL](https://azure.microsoft.com/blog/automatic-tuning-introduces-automatic-plan-correction-and-t-sql-management) . Параметры настройки на основе портала и автоматическая настройка индекса, описанные в этой статье, не применяются к Управляемый экземпляр.

> [!NOTE]
> Настройка параметров автоматической настройки с помощью шаблона ARM (Azure Resource Manager) в настоящее время не поддерживается.

## <a name="enable-automatic-tuning-on-server"></a>Включение автоматической настройки на сервере

На уровне сервера можно выбрать или отключить наследование автоматической настройки конфигурации из значений Azure по умолчанию. Значения Azure по умолчанию: FORCE_LAST_GOOD_PLAN включено, CREATE_INDEX включено, а DROP_INDEX отключено.

> [!IMPORTANT]
> По состоянию на март 2020 изменения в Azure по умолчанию для автоматической настройки вступят в силу следующим образом.
>
> - Новые значения по умолчанию для Azure будут FORCE_LAST_GOOD_PLAN = Enabled, CREATE_INDEX = Disabled и DROP_INDEX = Disabled.
> - Существующие серверы, у которых нет настроенных параметров автоматической настройки, будут автоматически настроены для НАСЛЕДОВАНия новых значений по умолчанию Azure. Это относится ко всем клиентам, которые в настоящее время имеют параметры сервера для автоматической настройки в неопределенном состоянии.
> - Новые созданные серверы будут автоматически настроены для НАСЛЕДОВАНия новых параметров Azure по умолчанию (в отличие от предыдущих, когда автоматическая настройка находилась в неопределенном состоянии после создания нового сервера).

### <a name="azure-portal"></a>Портал Azure

Чтобы включить автоматическую настройку на логическом **сервере** Базы данных SQL Azure, перейдите на сервер на портале Azure, а затем выберите в меню **Автонастройка**.

![Server (Сервер)](./media/sql-database-automatic-tuning-enable/server.png)

> [!NOTE]
> Обратите внимание, что **DROP_INDEX** параметр в настоящее время несовместим с приложениями, использующими переключение секций и указаниями индекса, и в таких случаях включать не следует. Удаление неиспользуемых индексов не поддерживается для уровней обслуживания "Премиум" и "критически важный для бизнеса".
>

Выберите параметры автоматической настройки, которые необходимо включить, и нажмите кнопку **Применить**.

Параметры автоматической настройки на сервере применяются ко всем базам данных на сервере. По умолчанию все базы данных наследуют конфигурацию из родительского сервера, но ее можно переопределить, а также указать отдельно для каждой базы данных.

### <a name="rest-api"></a>REST API

Дополнительные сведения о включении автоматической настройки на сервере с помощью REST API см. в разделе, посвященном [методам HTTP UPDATE и GET для автонастройки SQL Server](https://docs.microsoft.com/rest/api/sql/serverautomatictuning).

## <a name="enable-automatic-tuning-on-an-individual-database"></a>Включение автоматической настройки для отдельной базы данных

База данных SQL Azure позволяет отдельно указать конфигурацию автоматической настройки для каждой базы данных. На уровне базы данных можно включить наследование автоматической настройки конфигурации из родительского сервера, значений Azure по умолчанию либо отключить наследование конфигурации. Значения Azure по умолчанию: FORCE_LAST_GOOD_PLAN включено, CREATE_INDEX включено, а DROP_INDEX отключено.

> [!TIP]
> Общая рекомендация заключается в том, чтобы управлять конфигурацией автоматической настройки на **уровне сервера** , чтобы можно было автоматически применять одни и те же параметры конфигурации к каждой базе данных. Настройте автоматические параметры для отдельной базы данных, если вам нужно, чтобы ее параметры отличались от параметров других баз на одном сервере.
>

### <a name="azure-portal"></a>Портал Azure

Чтобы включить автоматическую настройку для **отдельной базы данных**, перейдите в базу данных на портале Azure, а затем выберите **Автонастройка**.

Отдельные параметры автоматической настройки можно настроить отдельно для каждой базы данных. Можно вручную настроить отдельные параметры автоматической настройки или указать, что параметр наследует параметры с сервера.

![База данных](./media/sql-database-automatic-tuning-enable/database.png)

Обратите внимание, что параметр DROP_INDEX сейчас не поддерживается в приложениях, использующих переключения секций и подсказки индекса. В этих случаях его следует отключить.

После выбора соответствующей конфигурации щелкните **Применить**.

### <a name="rest-api"></a>Rest API

Дополнительные сведения о включении автоматической настройки в отдельной базе данных с помощью REST API см. в разделе, посвященном [методам HTTP UPDATE и GET для автонастройки базы данных SQL](https://docs.microsoft.com/rest/api/sql/databaseautomatictuning).

### <a name="t-sql"></a>T-SQL

Чтобы включить автоматическую настройку в одной базе данных через T-SQL, подключитесь к базе данных и выполните следующий запрос.

```SQL
ALTER DATABASE current SET AUTOMATIC_TUNING = AUTO | INHERIT | CUSTOM
```

Если установить для автоматической настройки значение AUTO, будут применяться значения Azure по умолчанию. Если установить значение INHERIT, автоматическая настройка конфигурации будет унаследована от родительского сервера. Если установить значение CUSTOM, автоматическую настройку необходимо будет настраивать вручную.

Для настройки отдельных параметров автоматической настройки через T-SQL подключитесь к базе данных и выполните запрос, подобный следующему.

```SQL
ALTER DATABASE current SET AUTOMATIC_TUNING (FORCE_LAST_GOOD_PLAN = ON, CREATE_INDEX = DEFAULT, DROP_INDEX = OFF)
```

Если задать для отдельного параметра настройки значение ON, это переопределит наследуемое значение базы данных и включит параметр настройки. Если задать значение OFF, это также переопределит наследуемое значение базы данных и отключит параметр настройки. Параметр автоматической настройки, для которого задано значение по умолчанию, будет наследовать конфигурацию автоматической настройки из параметров уровня сервера.  

> [!IMPORTANT]
> В случае активной георепликации нужно настроить автоматическую настройку только на базу данных-источник, подробнее см. в [этой статье](sql-database-auto-failover-group.md). Действия по настройке, которые применяются автоматически, например создание индекса или удаление, будут автоматически реплицированы в дополнение только для чтения. При попытке включения автоматической настройки с помощью T-SQL для дополнения только для чтения произойдет сбой, поскольку для него не поддерживаются различные конфигурации настроек.
>

Дополнительные сведения о параметрах T-SQL для конфигурации автонастройки см. в статье [Параметры ALTER DATABASE SET (Transact-SQL) для сервера Базы данных SQL](https://docs.microsoft.com/sql/t-sql/statements/alter-database-transact-sql-set-options?view=azuresqldb-current).

## <a name="disabled-by-the-system"></a>Отключено системой

Автоматическая настройка контролирует все действия, которые она выполняет в базе данных, и в некоторых случаях может определить, что автоматическая настройка в базе данных работает не должным образом. В этом случае параметр настройки будет отключен системой. В большинстве случаев это происходит потому, что хранилище запросов отключено или доступно только для чтения в определенной базе данных.

## <a name="permissions"></a>Разрешения

Для использования функции автоматической настройки в Azure необходимо использовать встроенные роли RBAC в Azure. Использование только проверки подлинности SQL не будет достаточным для использования этой функции из портал Azure.

Чтобы использовать автоматическую настройку, минимально необходимым разрешением для предоставления пользователю является встроенная роль [участника базы данных SQL](../role-based-access-control/built-in-roles.md#sql-db-contributor) в Azure. Вы также можете использовать более высокие роли прав доступа, такие как SQL Server участник, участник и владелец.

## <a name="configure-automatic-tuning-e-mail-notifications"></a>Настройка уведомлений по электронной почте об автоматической настройке

См. раздел Guide по [автоматической настройке уведомлений по электронной почте](sql-database-automatic-tuning-email-notifications.md) .

## <a name="next-steps"></a>Дальнейшие шаги

* Дополнительные сведения об автоматической настройке и о том, как она повышает производительность, см. в [этой статье](sql-database-automatic-tuning.md).
* Общие сведения о рекомендациях по производительности базы данных SQL Azure см. в статье [Помощник по работе с базами данных SQL](sql-database-advisor.md).
* См. статью [Анализ производительности запросов базы данных Azure SQL](sql-database-query-performance.md), чтобы узнать о том, как просмотреть влияние на производительность основных запросов.
