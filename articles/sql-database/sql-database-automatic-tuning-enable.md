---
title: Включение автоматической настройки
description: Вы можете легко включить автоматическую настройку для базы данных SQL Azure.
services: sql-database
ms.service: sql-database
ms.subservice: performance
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: danimir
ms.author: danil
ms.reviewer: jrasnik, carlrab
ms.date: 12/03/2019
ms.openlocfilehash: eed839c277156046ff9b7d97c6e87636a0822889
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79299334"
---
# <a name="enable-automatic-tuning-to-monitor-queries-and-improve-workload-performance"></a>Включение автоматической настройки для отслеживания запросов и повышения производительности рабочей нагрузки

База данных SQL Azure — это автоматически управляемая служба данных, которая постоянно отслеживает запросы и определяет действия, которые вы можете выполнять для повышения производительности рабочей нагрузки. Вы можете просматривать рекомендации и вручную применять их, или позволить базе данных SQL Azure автоматически применять действия по исправлению, что известно как **режим автоматической настройки**.

Автоматическую настройку можно включить на уровне сервера или базы данных с помощью [портала Azure](sql-database-automatic-tuning-enable.md#azure-portal), вызовов [REST API](sql-database-automatic-tuning-enable.md#rest-api) или команд [T-SQL](https://docs.microsoft.com/sql/t-sql/statements/alter-database-transact-sql-set-options?view=azuresqldb-current).

> [!NOTE]
> Для Управляемого экземпляра поддерживаемая опция FORCE_LAST_GOOD_PLAN может быть настроена только через [T-S'SL.](https://azure.microsoft.com/blog/automatic-tuning-introduces-automatic-plan-correction-and-t-sql-management) Конфигурация на основе портала и параметры автоматической настройки индекса, описанные в данной статье, не применяются к Управляемой инстанции.

> [!NOTE]
> Настройка параметров автоматической настройки через шаблон ARM (Azure Resource Manager) в настоящее время не поддерживается.

## <a name="enable-automatic-tuning-on-server"></a>Включение автоматической настройки на сервере

На уровне сервера можно выбрать или отключить наследование автоматической настройки конфигурации из значений Azure по умолчанию. Значения Azure по умолчанию: FORCE_LAST_GOOD_PLAN включено, CREATE_INDEX включено, а DROP_INDEX отключено.

> [!IMPORTANT]
> С марта 2020 года изменения в azure по умолчанию для автоматической настройки вступят в силу следующим образом:
>
> - Новые по умолчанию Azure будут FORCE_LAST_GOOD_PLAN включены, CREATE_INDEX отключены, а DROP_INDEX отключены.
> - Существующие серверы без настройки автоматической настройки настройки будут автоматически настроены на INHERIT новых по умолчанию Azure. Это относится ко всем клиентам, которые в настоящее время имеют настройки сервера для автоматической настройки в неопределенном состоянии.
> - Новые созданные серверы будут автоматически настроены на INHERIT новых по умолчанию Azure (в отличие от ранее, когда автоматическая настройка конфигурации была в неопределенном состоянии при создании нового сервера).

### <a name="azure-portal"></a>Портал Azure

Чтобы включить автоматическую настройку на логическом **сервере** Базы данных SQL Azure, перейдите на сервер на портале Azure, а затем выберите в меню **Автонастройка**.

![Сервер](./media/sql-database-automatic-tuning-enable/server.png)

> [!NOTE]
> Обратите внимание, что **DROP_INDEX** опция в настоящее время не совместима с приложениями, использующими переключение разделов и подсказки индекса, и не должна быть включена в этих случаях. Удаление неиспользованных индексов не поддерживается для уровней premium и Business Critical.
>

Выберите параметры автоматической настройки, которые вы хотите включить, и выберите **Apply.**

Параметры автоматической настройки на сервере применяются ко всем базам данных на сервере. По умолчанию все базы данных наследуют конфигурацию из родительского сервера, но ее можно переопределить, а также указать отдельно для каждой базы данных.

### <a name="rest-api"></a>REST API

Дополнительные сведения о включении автоматической настройки на сервере с помощью REST API см. в разделе, посвященном [методам HTTP UPDATE и GET для автонастройки SQL Server](https://docs.microsoft.com/rest/api/sql/serverautomatictuning).

## <a name="enable-automatic-tuning-on-an-individual-database"></a>Включение автоматической настройки для отдельной базы данных

База данных SQL Azure позволяет отдельно указать конфигурацию автоматической настройки для каждой базы данных. На уровне базы данных можно включить наследование автоматической настройки конфигурации из родительского сервера, значений Azure по умолчанию либо отключить наследование конфигурации. Значения Azure по умолчанию: FORCE_LAST_GOOD_PLAN включено, CREATE_INDEX включено, а DROP_INDEX отключено.

> [!TIP]
> Общая рекомендация заключается в управлении автоматической конфигурацией настройки на **уровне сервера,** чтобы те же настройки конфигурации могли быть автоматически применены к каждой базе данных. Настройте автоматические параметры для отдельной базы данных, если вам нужно, чтобы ее параметры отличались от параметров других баз на одном сервере.
>

### <a name="azure-portal"></a>Портал Azure

Чтобы включить автоматическую настройку для **отдельной базы данных**, перейдите в базу данных на портале Azure, а затем выберите **Автонастройка**.

Отдельные параметры автоматической настройки можно настроить отдельно для каждой базы данных. Можно вручную настроить отдельные параметры автоматической настройки или указать, что параметр наследует параметры с сервера.

![База данных](./media/sql-database-automatic-tuning-enable/database.png)

Обратите внимание, что параметр DROP_INDEX сейчас не поддерживается в приложениях, использующих переключения секций и подсказки индекса. В этих случаях его следует отключить.

После выбора соответствующей конфигурации щелкните **Применить**.

### <a name="rest-api"></a>Rest API

Дополнительные сведения о включении автоматической настройки в отдельной базе данных с помощью REST API см. в разделе, посвященном [методам HTTP UPDATE и GET для автонастройки базы данных SQL](https://docs.microsoft.com/rest/api/sql/databaseautomatictuning).

### <a name="t-sql"></a>T-SQL

Чтобы включить автоматическую настройку в одной базе данных через T-SQL, подключитесь к базе данных и выполните следующий запрос.

```SQL
ALTER DATABASE current SET AUTOMATIC_TUNING = AUTO | INHERIT | CUSTOM
```

Если установить для автоматической настройки значение AUTO, будут применяться значения Azure по умолчанию. Если установить значение INHERIT, автоматическая настройка конфигурации будет унаследована от родительского сервера. Если установить значение CUSTOM, автоматическую настройку необходимо будет настраивать вручную.

Для настройки отдельных параметров автоматической настройки через T-SQL подключитесь к базе данных и выполните запрос, подобный следующему.

```SQL
ALTER DATABASE current SET AUTOMATIC_TUNING (FORCE_LAST_GOOD_PLAN = ON, CREATE_INDEX = DEFAULT, DROP_INDEX = OFF)
```

Если задать для отдельного параметра настройки значение ON, это переопределит наследуемое значение базы данных и включит параметр настройки. Если задать значение OFF, это также переопределит наследуемое значение базы данных и отключит параметр настройки. Опция автоматической настройки, для которой указано DEFAULT, унаследует конфигурацию автоматической настройки от настроек уровня сервера.  

> [!IMPORTANT]
> В случае активной георепликации нужно настроить автоматическую настройку только на базу данных-источник, подробнее см. в [этой статье](sql-database-auto-failover-group.md). Действия по настройке, которые применяются автоматически, например создание индекса или удаление, будут автоматически реплицированы в дополнение только для чтения. При попытке включения автоматической настройки с помощью T-SQL для дополнения только для чтения произойдет сбой, поскольку для него не поддерживаются различные конфигурации настроек.
>

Дополнительные сведения о параметрах T-SQL для конфигурации автонастройки см. в статье [Параметры ALTER DATABASE SET (Transact-SQL) для сервера Базы данных SQL](https://docs.microsoft.com/sql/t-sql/statements/alter-database-transact-sql-set-options?view=azuresqldb-current).

## <a name="disabled-by-the-system"></a>Отключено системой

Автоматическая настройка контролирует все действия, которые она выполняет в базе данных, и в некоторых случаях может определить, что автоматическая настройка в базе данных работает не должным образом. В этом случае параметр настройки будет отключен системой. В большинстве случаев это происходит потому, что хранилище запросов отключено или доступно только для чтения в определенной базе данных.

## <a name="permissions"></a>Разрешения

Поскольку автоматическая настройка является функцией Azure, для ее использования необходимо использовать встроенные роли RBAC Azure. Использование только функции проверки подлинности СЗЛ будет недостаточным для использования функции с портала Azure.

Для автоматической настройки минимальное необходимое разрешение, необходимое для предоставления пользователю, является встроенной ролью вкладчика Azure в [S'L DB.](../role-based-access-control/built-in-roles.md#sql-db-contributor) Можно также рассмотреть возможность использования более высоких ролей привилегий, таких как вкладчик, автор и владелец сервера S'L.

## <a name="configure-automatic-tuning-e-mail-notifications"></a>Настройка уведомлений по электронной почте об автоматической настройке

Смотрите руководство по [автоматической настройке уведомлений по электронной почте.](sql-database-automatic-tuning-email-notifications.md)

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения об автоматической настройке и о том, как она повышает производительность, см. в [этой статье](sql-database-automatic-tuning.md).
* Общие сведения о рекомендациях по производительности базы данных SQL Azure см. в статье [Помощник по работе с базами данных SQL](sql-database-advisor.md).
* См. статью [Анализ производительности запросов базы данных Azure SQL](sql-database-query-performance.md), чтобы узнать о том, как просмотреть влияние на производительность основных запросов.
