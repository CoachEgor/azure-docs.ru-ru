---
title: 'Служба Базы данных SQL: модель на основе виртуальных ядер | Документация Майкрософт'
description: Модель приобретения на основе виртуальных ядер позволяет независимо масштабировать вычислительные ресурсы и ресурсы хранилища, обеспечивать производительность на уровне локальной среды и оптимизировать затраты.
services: sql-database
ms.service: sql-database
ms.subservice: service
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: stevestein
ms.author: sstein
ms.reviewer: sashan, moslake, carlrab
manager: craigg
ms.date: 05/06/2019
ms.openlocfilehash: 981198063b8e0951d4a4a4c4627d4b7966f34154
ms.sourcegitcommit: f6ba5c5a4b1ec4e35c41a4e799fb669ad5099522
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65148983"
---
# <a name="choose-among-the-vcore-service-tiers-and-migrate-from-dtu-service-tiers"></a>Выбрать один из уровней служб виртуальное и перенос с уровней обслуживания DTU

Модель приобретения на основе виртуальных ядер позволяет независимо масштабировать вычислительные ресурсы и ресурсы хранилища, обеспечивать производительность на уровне локальной среды и оптимизировать затраты. Она также позволяет выбрать поколение аппаратного обеспечения:

- 4-е поколение — до 24 логических ЦП на базе процессоров Intel E5-2673 v3 (Haswell) с частотой 2,4 ГГц, виртуальное ядро = 1 PP (физическое ядро), 7 ГБ на ядро, подключенные SSD
- 5-е поколение — до 80 логических ЦП на базе процессоров Intel E5-2673 v4 (Broadwell) с частотой 2,3 ГГц, виртуальное ядро = 1 LP (hyper-thread), 5,1 ГБ на ядро, быстрый накопитель SSD eNVM


Аппаратное обеспечение 4-го поколения предлагает значительно больше памяти на одно виртуальное ядро. Однако аппаратное обеспечение 5-го поколения позволяет значительно увеличивать масштаб вычислительных ресурсов.

> [!NOTE]
> Дополнительные сведения об уровнях служб на основе DTU см. в статье [Выбор уровня служб на основе DTU, объема вычислительных ресурсов и ресурсов хранилища](sql-database-service-tiers-dtu.md). Дополнительные сведения об уровнях служб на основе единиц DTU и на основе виртуальных ядер см. в статье [Ресурсы и модели приобретения для базы данных SQL Azure](sql-database-purchase-models.md).

## <a name="service-tier-characteristics"></a>Характеристики уровней служб

Модель виртуального ядра предоставляет три уровня служб: "Общего назначения", "Гипермасштабирование" и "Критически важный для бизнеса". Уровни служб отличаются диапазоном объемов вычислительных ресурсов, структурой для обеспечения высокого уровня доступности, способом обеспечения изоляции от сбоев, типами и размерами хранилища и диапазоном операций ввода-вывода. Необходимо отдельно настроить необходимое хранилище и период хранения резервных копий. На портале Azure перейдите на сервер (не в базу данных) и выберите "Managed Backups (Управляемые резервные копии) > Configure Policy (Настройка политики) > Конфигурация восстановления до точки во времени > 7–35 days (7–35 дней)".

В следующей таблице представлены различия между этими тремя уровнями.

||**Общего назначения**|**Критически важный для бизнеса**|**Гипермасштабируемый**|
|---|---|---|---|
|Оптимально для|Большинства рабочих нагрузок. Предлагает бюджетные сбалансированные и масштабируемые варианты ресурсов вычисления и хранилища.|Бизнес-приложений с высокими требованиями к операциям ввода-вывода. Предлагает самую высокую отказоустойчивость к сбоям благодаря использованию нескольких изолированных реплик.|Большинство рабочих нагрузок с требованиями к высокомасштабируемому хранилищу и масштабированию для чтения|
|Среда выполнения приложений|**Подготовка вычислительных**:<br/>4-е поколение: от 1 до 24 виртуальных ядер<br/>5-е поколение: Виртуальное ядро 2 до 80<br/>**Бессерверных вычислений**<br/>5-е поколение: 0,5 - 4 виртуальных ядер|**Подготовка вычислительных**:<br/>4-е поколение: от 1 до 24 виртуальных ядер<br/>5-е поколение: Виртуальное ядро 2 до 80|**Подготовка вычислительных**:<br/>4-е поколение: от 1 до 24 виртуальных ядер<br/>5-е поколение: Виртуальное ядро 2 до 80|
|Память|**Подготовка вычислительных**:<br/>4-е поколение: 7 ГБ на виртуальное ядро<br/>5-е поколение: 5,1 ГБ на виртуальное ядро<br/>**Бессерверных вычислений**<br/>5-е поколение: 3 ГБ на виртуальное ядро|**Подготовка вычислительных**:<br/>4-е поколение: 7 ГБ на виртуальное ядро<br/>5-е поколение: 5,1 ГБ на виртуальное ядро |**Подготовка вычислительных**:<br/>4-е поколение: 7 ГБ на виртуальное ядро<br/>5-е поколение: 5,1 ГБ на виртуальное ядро|
|Хранилище|Используется удаленное хранилище:<br/>**Отдельная база данных подготовленных вычислительных**:<br/>От 5 ГБ до 4 ТБ<br/>**Отдельная база данных бессерверных вычислений**:<br/>5 ГБ — 1 ТБ<br/>**Управляемый экземпляр**: от 32 ГБ до 8 ТБ |Используется локальное хранилище на SSD-накопителях:<br/>**Отдельная база данных подготовленных вычислительных**:<br/>От 5 ГБ до 4 ТБ<br/>**Управляемый экземпляр**:<br/>от 32 ГБ до 4 ТБ |Гибкое, при необходимости автоматическое увеличение хранилища. Поддерживает хранилища размером до 100 ТБ и более. Локальное хранилище на SSD-накопителях для кэша локального буферного пула и локального хранилища данных. Удаленное хранилище Azure как окончательное долгосрочное хранилище данных. |
|Память|4-е поколение: 7 ГБ на ядро<br>5-е поколение: 5,1 ГБ на ядро | 4-е поколение: 7 ГБ на ядро<br>5-е поколение: 5,1 ГБ на ядро |5-е поколение: 5,1 ГБ на ядро|
|Хранилище|Используется удаленное хранилище:<br/>Отдельная база данных: От 5 ГБ до 4 ТБ<br/>Управляемый экземпляр: от 32 ГБ до 8 ТБ |Используется локальное хранилище на SSD-накопителях:<br/>Отдельная база данных: От 5 ГБ до 4 ТБ<br/>Управляемый экземпляр: от 32 ГБ до 4 ТБ |Гибкое, при необходимости автоматическое увеличение хранилища. Поддерживает хранилища размером до 100 ТБ и более. Локальное хранилище на SSD-накопителях для кэша локального буферного пула и локального хранилища данных. Удаленное хранилище Azure как окончательное долгосрочное хранилище данных. |
|Пропускная способность ввода-вывода (приблизительно)|Отдельная база данных: 500 операций ввода-вывода в секунду на виртуальное ядро с максимальным количеством 7000</br>Управляемый экземпляр: Зависит от [размера файла](../virtual-machines/windows/premium-storage-performance.md#premium-storage-disk-sizes)|5 000 операций ввода-вывода в секунду на виртуальное ядро с максимальным количеством 200 000|ПОДЛЕЖИТ УТОЧНЕНИЮ|
|Доступность|1 реплика, отсутствие возможности масштабирования для чтения|3 реплики, 1 [реплика чтения и масштабирования](sql-database-read-scale-out.md),<br/>Высокая доступность, избыточная в пределах зоны|1 операция чтения/записи реплики, а также от 0 до 4 [реплик для чтения и масштабирования](sql-database-read-scale-out.md)|
|Резервные копии|[RA-GRS](../storage/common/storage-designing-ha-apps-with-ragrs.md), 7–35 дней (7 дней по умолчанию)|[RA-GRS](../storage/common/storage-designing-ha-apps-with-ragrs.md), 7–35 дней (7 дней по умолчанию)|Резервное копирование на основе моментальных снимков в удаленном хранилище Azure и быстрое восстановление на основе этих моментальных снимков. Резервное копирование выполняется практически мгновенно и не влияет на производительность операций ввода-вывода службы вычислений. Восстановление выполняются очень быстро и поэтому не зависит от масштаба операцией с данными (занимает минуты, а не часы или дни).|
|В памяти|Не поддерживается|Поддерживаются|Не поддерживается|
|||

> [!NOTE]
> Вы можете получить бесплатную базу данных Azure SQL на уровень обслуживания Basic, в сочетании с бесплатной учетной записью Azure для изучения Azure. Сведения см. в разделе [Создание управляемой облачной базы данных с помощью бесплатной учетной записи Azure](https://azure.microsoft.com/free/services/sql-database/).

- Дополнительные сведения см. в статье [Ограничения ресурсов для отдельной базы данных в Базе данных SQL Azure при использовании модели приобретения на основе виртуальных ядер](sql-database-vcore-resource-limits-single-databases.md) и в разделе [Модель покупки на основе числа виртуальных ядер](sql-database-managed-instance.md#vcore-based-purchasing-model).
- Дополнительные сведения об уровнях служб см. в статье [Уровни служб общего назначения и "Критически важный для бизнеса"](sql-database-service-tiers-general-purpose-business-critical.md).
- Дополнительные сведения об уровне служб "Гипермасштабирование" см. в статье [Уровень служб "Гипермасштабирование" размером до 100 ТБ (предварительная версия)](sql-database-service-tier-hyperscale.md).  

## <a name="azure-hybrid-benefit"></a>Преимущество гибридного использования Azure

В модели приобретения на основе виртуальных ядер на уровне подготавливаемый компьютер, можно обменять имеющиеся лицензии, получить сниженные тарифы на базу данных SQL с помощью [Преимущество гибридного использования Azure для SQL Server](https://azure.microsoft.com/pricing/hybrid-benefit/). При этом благодаря локальным лицензиям SQL Server и подписке Software Assurance вы сможете сэкономить до 30 % на базу данных SQL Azure.

![цены](./media/sql-database-service-tiers/pricing.png)

С помощью Преимущества гибридного использования Azure вы можете платить только за базовую инфраструктуру Azure, используя имеющуюся лицензию SQL Server для ядра СУБД SQL (**BasePrice**), или платить за базовую инфраструктуру и лицензию SQL Server (**LicenseIncluded**).


Модель лицензирования можно выбрать или изменить с помощью портала Azure или одного из указанных ниже интерфейсов API.

- Чтобы установить или обновить тип лицензии с помощью PowerShell, можно использовать:

  - [New-AzSqlDatabase](https://docs.microsoft.com/powershell/module/az.sql/new-azsqldatabase)
  - [Set-AzSqlDatabase](https://docs.microsoft.com/powershell/module/az.sql)
  - [New-AzSqlInstance](https://docs.microsoft.com/powershell/module/az.sql/new-azsqlinstance)
  - [Set-AzSqlInstance](https://docs.microsoft.com/powershell/module/az.sql)

- Чтобы установить или обновить тип лицензии с помощью Azure CLI, можно использовать команды:

  - [az sql db create](https://docs.microsoft.com/cli/azure/sql/db#az-sql-db-create)
  - [az sql db update](https://docs.microsoft.com/cli/azure/sql/db#az-sql-db-update)
  - [az sql mi create](https://docs.microsoft.com/cli/azure/sql/mi#az-sql-mi-create)
  - [az sql mi update](https://docs.microsoft.com/cli/azure/sql/mi#az-sql-mi-update)

- Чтобы установить или обновить тип лицензии с помощью REST API, воспользоваться следующими инструкциями:

  - [Базы данных: создание или обновление](https://docs.microsoft.com/rest/api/sql/databases/createorupdate)
  - [Базы данных: обновление](https://docs.microsoft.com/rest/api/sql/databases/update)
  - [Управляемые экземпляры. Создание или обновление](https://docs.microsoft.com/rest/api/sql/managedinstances/createorupdate)
  - [Управляемые экземпляры. Обновление](https://docs.microsoft.com/rest/api/sql/managedinstances/update)

## <a name="migration-from-dtu-model-to-vcore-model"></a>Переход с модели DTU на модель с виртуальными ядрами

### <a name="migration-of-a-database"></a>Миграция базы данных

Миграция базы данных из модели приобретения на основе единиц DTU в модель приобретения на основе виртуальных ядер аналогична повышению или понижению уровня между базами данных уровня "Стандартный" и "Премиум" в модели приобретения на основе единиц передачи данных.

### <a name="migration-of-databases-with-geo-replication-links"></a>Перемещение баз данных со связями георепликации

Переход с модели на основе единиц DTU на модель на основе виртуальных ядер аналогичен повышению или понижению уровня связей георепликации между базами данных уровня "Стандартный" и "Премиум". При этом не нужно завершать георепликацию, однако пользователь должен соблюдать правила последовательности. При повышении сначала повысьте уровень производительности базы данных-получателя, а затем — уровень базы данных-источника. При понижении следует действовать в обратном порядке: сначала нужно понизить уровень производительности базы данных-источника, а после этого — базы данных-получателя.

При использовании георепликации между двумя эластичными пулами рекомендуем указать один пул как первичный, а другой — как вторичный. В этом случае при перемещении эластичных пулов следует учитывать такую конфигурацию.  Однако технически возможно, что эластичный пул содержит как первичные, так и вторичные базы данных. В таком случае для правильного перемещения вы должны рассматривать пул с более высоким показателем использования как "первичный" и соответствующим образом следовать правилам последовательности.  

В следующей таблице приведены рекомендации для конкретных сценариев перемещения:

|Текущий уровень служб|Целевой уровень служб|Тип перемещения|Действия пользователя|
|---|---|---|---|
|Стандартная|Универсальные|Горизонтальный|Можно выполнять перемещение в любом порядке, но необходимо обеспечить соответствующий размер виртуального ядра*|
|Премиум|Критически важный для бизнеса|Горизонтальный|Можно выполнять миграцию в любом порядке, но необходимо обеспечить соответствующий размер виртуального ядра*|
|Стандартная|Критически важный для бизнеса|Обновление|Сначала необходимо перенести базу данных-получатель|
|Критически важный для бизнеса|Стандартная|Понижение уровня|Сначала необходимо перенести базу данных-источник|
|Премиум|Универсальные|Понижение уровня|Сначала необходимо перенести базу данных-источник|
|Универсальные|Премиум|Обновление|Сначала необходимо перенести базу данных-получатель|
|Критически важный для бизнеса|Универсальные|Понижение уровня|Сначала необходимо перенести базу данных-источник|
|Универсальные|Критически важный для бизнеса|Обновление|Сначала необходимо перенести базу данных-получатель|
||||

\* Для каждых 100 единиц DTU уровня "Стандартный" и каждых 125 единиц DTU уровня "Премиум" требуется по меньшей мере 1 виртуальное ядро.

### <a name="migration-of-failover-groups"></a>Перемещение групп отработки отказа

Перемещение групп отработки отказа с несколькими базами данных требует отдельного перемещения базы данных-источника и базы данных-получателя. Во время этого процесса применяются те же рекомендации и правила последовательности. После перевода базы данных на модель на основе виртуальных ядер в группе отработки отказа останутся те же параметры политики.

### <a name="creation-of-a-geo-replication-secondary"></a>Создание базы данных-получателя георепликации

Вы можете создать базу данных-получателя георепликации, используя тот же уровень служб, что и у базы данных-источника. Для базы данных с высокой скоростью создания журналов рекомендуется создавать базу данных-получатель с таким же объемом вычислительных ресурсов, как у базы данных-источника. Если вы создаете базу данных-получатель георепликации в эластичном пуле для отдельной базы данных-источника, рекомендуем настроить для пула параметр `maxVCore`, который соответствует объему вычислительных ресурсов базы данных-источника. При создании базы данных-получателя георепликации в одном эластичном пуле для базы данных-источника в другом эластичном пуле рекомендуется настроить для пулов одинаковые параметры `maxVCore`.

### <a name="using-database-copy-to-convert-a-dtu-based-database-to-a-vcore-based-database"></a>Использование копии базы данных для перевода базы данных с модели на основе единиц DTU на модель на основе виртуальных ядер

Вы можете скопировать любую базу данных с объемом вычислительных ресурсов на основе DTU в базу данных с объемом вычислительных ресурсов на основе виртуальных ядер без ограничений или соблюдения специальной последовательности, если целевой объем вычислительных ресурсов поддерживает максимальный размер базы данных-источника. Это связано с тем, что копия базы данных создает моментальный снимок данных на момент начала операции копирования и не выполняет синхронизацию данных между источником и целевым объектом.

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о конкретных объемах вычислительных ресурсов и доступных размерах хранилища для отдельной базы данных см. в статье [Ограничения ресурсов для отдельной базы данных в Базе данных SQL Azure при использовании модели приобретения на основе виртуальных ядер](sql-database-vcore-resource-limits-single-databases.md)
- Дополнительные сведения о конкретных объемах вычислительных ресурсов и доступных размерах хранилища для эластичных пулов см. в статье [Ограничения для эластичных пулов в службе "База данных SQL Azure" в модели приобретения на основе виртуальных ядер](sql-database-vcore-resource-limits-elastic-pools.md#general-purpose-service-tier-storage-sizes-and-compute-sizes).
