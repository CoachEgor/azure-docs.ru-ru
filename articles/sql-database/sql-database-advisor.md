---
title: Рекомендации по производительности базы данных SQL Azure | Документация Майкрософт
description: База данных SQL Azure предоставляет рекомендации для баз данных SQL, которые могут повысить текущую производительность запросов.
services: sql-database
ms.service: sql-database
ms.subservice: monitor
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: danimir
ms.author: danil
ms.reviewer: jrasnik
manager: craigg
ms.date: 12/19/2018
ms.openlocfilehash: d09adbfa7cb2782d710ef3116cbd7bc68ee247b7
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "61417589"
---
# <a name="performance-recommendations-for-sql-database"></a>Рекомендации по производительности для базы данных SQL

База данных SQL Azure развивается и адаптируется вместе с вашим приложением. Она предоставляет пользовательские рекомендации, которые позволяют максимально увеличить производительность баз данных SQL. База данных SQL постоянно оценивает и анализирует журнал использования баз данных SQL. Предоставляемые рекомендации основаны на уникальном шаблоне рабочей нагрузки базы данных и помогают повысить ее производительность.

> [!TIP]
> [Автоматическая настройка](sql-database-automatic-tuning.md) — рекомендуемый способ для автоматического разрешения некоторых наиболее распространенных проблем производительности баз данных. [Анализ производительности запросов](sql-database-query-performance.md) — рекомендуемый способ для решения основных потребностей мониторинга производительности баз данных SQL в Azure. [Аналитика SQL Azure](../azure-monitor/insights/azure-sql.md) — рекомендуемый способ для расширенного масштабного мониторинга производительности баз данных со встроенными средствами аналитики для автоматического устранения неполадок, связанных с производительностью.
>

## <a name="create-index-recommendations"></a>Рекомендации по созданию индексов
База данных SQL непрерывно отслеживает выполняемые запросы и определяет индексы, которые могут повысить производительность. После того как система удостоверится в отсутствии определенного индекса, создается новая рекомендация **Создание индекса**.

 База данных SQL Azure определяет это, оценивая рост производительности, который со временем обеспечит индекс. В зависимости от предполагаемого роста производительности рекомендации классифицируются как "Высокий", "Средний" и "Низкий". 

Индексы, созданные с помощью рекомендаций, всегда помечаются как созданные автоматически. Узнать, какие индексы созданы автоматически, можно, просмотрев представление sys.indexes. Автоматически созданные индексы не блокируют команды ALTER и RENAME. 

Если вы попытаетесь удалить столбец, по которому был автоматически создан индекс, команда будет выполнена. Автоматически созданный индекс также будет удален. Обычные индексы блокируют команду ALTER или RENAME, выполняемую для индексированных столбцов.

После применения рекомендации по созданию индекса база данных SQL Azure сравнивает производительность запросов с базовой производительностью. Если новый индекс улучшит производительность, рекомендация будет отмечена как успешная и будет создан отчет о результатах. Если индекс не повысил производительность, он автоматически отменяется. База данных SQL использует этот процесс, чтобы гарантировать, что рекомендации улучшают производительность базы данных.

У любой рекомендации по **созданию индекса** есть политика отхода, которая не позволит применить рекомендацию при высоком уровне использования базы данных или пула. Эта политика учитывает такие метрики, как загрузка ЦП, операции ввода-вывода данных и журнала, а также доступный объем хранилища. 

Если ресурсы ЦП, операции ввода-вывода данных или журнала использовались более чем на 80 % за предыдущие 30 минут, рекомендация на создание индекса будет отложена. Если после создания индекса доступный объем хранилища будет ниже 10 %, рекомендация перейдет в состояние ошибки. Если по прошествии нескольких дней служба автонастройки снова определит, что создание индекса полезно, процесс запустится повторно. 

Этот процесс будет повторяться, пока объем хранилища не будет достаточным для создания индекса или пока индекс не будет считаться полезным.

## <a name="drop-index-recommendations"></a>Рекомендации по удалению индексов
Помимо обнаружения недостающего индекса, база данных SQL постоянно анализирует производительность имеющихся индексов. Если индекс не используется, база данных SQL Azure порекомендует удалить его. Удаление индекса рекомендуется в двух случаях:
* индекс является дубликатом другого индекса (созданного на основе того же столбца, схемы секций и фильтров);
* индекс не использовался в течение длительного времени (93 дня).

Рекомендации по удалению индексов также проходят проверку после применения. Если производительность повысилась, будет создан отчет о результатах. Если производительность снизилась, будет выполнен откат рекомендации.


## <a name="parameterize-queries-recommendations"></a>Рекомендации по параметризации запросов
Рекомендации по *параметризации запросов* появляются при наличии одного или нескольких запросов, которые постоянно перекомпилируются, но в результате для них создается одинаковый план выполнения запроса. Это дает возможность применить принудительную параметризацию, которая позволит кэшировать планы запросов и повторно использовать их в будущем, повышая производительность и снижая использование ресурсов. 

Каждый запрос, отправленный в SQL Server, сначала должен быть скомпилирован для формирования плана выполнения. Каждый создаваемый план добавляется в кэш планов и может быть использован повторно при последующем выполнении этого запроса, устраняя необходимость в дополнительной компиляции. 

Запросы, которые содержат непараметризованные значения, могут привести к снижению производительности, так как для каждого такого запроса с различными значениями параметров план выполнения компилируется заново. Во многих случаях для одинаковых запросов с отличными значениями параметров создаются одинаковые планы выполнения, но эти планы по-прежнему добавляются в кэш планов по отдельности. 

Этот процесс перекомпиляции планов операций использует ресурсы базы данных, увеличивает длительность запроса и переполняет кэш планов, что приводит к исключению планов из него. Такое поведение SQL Server можно изменить, задав параметр принудительной параметризации для базы данных. 

Чтобы было проще оценить влияние этой рекомендации, вам будет предоставлено сравнение фактического и предполагаемого потребления ресурсов ЦП (после применения рекомендации). Эта рекомендация позволяет сэкономить ресурсы ЦП. Она также может помочь уменьшить длительность запроса и переполнение кэша планов, а это означает, что в кэше может оставаться больше планов, которые можно повторно использовать. Вы можете быстро применить эту рекомендацию, выбрав команду **Применить**. 

Через несколько минут после применения этой рекомендации для вашей базы будет принудительно включена параметризация и запущен мониторинг, который длится примерно 24 часа. По истечении этого периода будет создан отчет о проверке, содержащий информацию об использовании ресурсов ЦП для базы данных за 24 часа до и через 24 часа после применения рекомендации. Помощник по базам данных SQL имеет механизм безопасности, который автоматически отменит примененную рекомендацию, если будет обнаружено снижение производительности.

## <a name="fix-schema-issues-recommendations-preview"></a>Рекомендации по устранению ошибок схемы (предварительная версия)

> [!IMPORTANT]
> Корпорация Майкрософт в данный момент не поддерживает рекомендации по устранению ошибок схемы. Мы рекомендуем использовать [Intelligent Insights](sql-database-intelligent-insights.md) для мониторинга проблем с производительностью базы данных, включая проблемы схемы, которые рассматривались ранее в рекомендациях по устранению ошибки схемы.
> 

Рекомендации по **устранению ошибок схемы** появляются, когда служба базы данных SQL обнаруживает аномальное количество относящихся к схеме ошибок SQL, которые возникают в вашей базе данных SQL. Эта рекомендация обычно появляется, когда в базе данных возникает несколько связанных со схемой ошибок (недопустимое имя столбца, недопустимое имя объекта и т. д.) в течение часа.

"Ошибки схемы" относятся к классу синтаксических ошибок в SQL Server. Они происходят, когда определение запроса SQL и определение схемы базы данных не согласованы. Например, один из столбцов, ожидаемых запросом, может отсутствовать в целевой таблице или наоборот. 

Рекомендация по устранению ошибок схемы появляется, когда служба "База данных SQL Azure" обнаруживает аномальное количество относящихся к схеме ошибок SQL, которые возникают в базе данных SQL. В следующей таблице показаны ошибки, которые относятся к схеме.

| Код ошибки SQL | `Message` |
| --- | --- |
| 201 |Процедура или функция " *" ожидает параметр "* ", который не был указан. |
| 207 |Недопустимое имя столбца "*". |
| 208 |Недопустимое имя объекта "*". |
| 213 |Имя столбца или число предоставленных значений не соответствует определению таблицы. |
| 2812 |Не удалось найти хранимую процедуру "*". |
| 8144 |Для процедуры или функции * указано слишком много аргументов. |

## <a name="custom-applications"></a>Пользовательские приложения

Разработчики могут рассмотрите возможность разработки пользовательских приложений с помощью рекомендаций по производительности для базы данных SQL Azure. Все рекомендации, указанные на портале для базы данных может осуществляться через [Get AzSqlDatabaseRecommendedAction](https://docs.microsoft.com/powershell/module/az.sql/get-azsqldatabaserecommendedaction) API.

## <a name="next-steps"></a>Дальнейшие действия
Отслеживайте рекомендации и продолжайте применять их для повышения производительности. Рабочие нагрузки базы данных являются динамическими и меняются непрерывно. Помощник по работе с базами данных SQL продолжает отслеживать работу и давать рекомендации, которые могут повысить производительность базы данных. 

* Дополнительные сведения об автоматической настройке индексов базы данных и планов выполнения запросов см. в статье [Автоматическая настройка в Базе данных SQL Azure](sql-database-automatic-tuning.md).
* Дополнительные сведения о мониторинге производительности базы данных с помощью автоматической диагностики и анализа первопричин проблем с производительностью см. в статье [Intelligent Insights](sql-database-intelligent-insights.md).
*  Дополнительные сведения об использовании рекомендаций производительности на портале Azure см. в статье [Поиск и применение рекомендаций по производительности](sql-database-advisor-portal.md).
* См. статью [Анализ производительности запросов базы данных Azure SQL](sql-database-query-performance.md), чтобы узнать о том, как просмотреть влияние на производительность основных запросов.


