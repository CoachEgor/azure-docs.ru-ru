---
title: Рекомендации по повышению производительности базы данных для отдельных баз данных и пулов
description: База данных SQL Azure предоставляет рекомендации для отдельных баз данных и пулов, которые могут повысить производительность запросов в базе данных SQL Azure.
services: sql-database
ms.service: sql-database
ms.subservice: performance
ms.custom: fasttrack-edit
ms.devlang: ''
ms.topic: conceptual
author: danimir
ms.author: danil
ms.reviewer: jrasnik, carlrab
ms.date: 03/10/2020
ms.openlocfilehash: f5b0aeec851c8f514492e32792f48e955597ced5
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "82096577"
---
# <a name="database-advisor-performance-recommendations-for-single-and-pooled-databases"></a>Помощник по базам данных рекомендации по производительности для баз данных в одной и в составе пула

База данных SQL Azure развивается и адаптируется вместе с вашим приложением. Для баз данных одной и нескольких групп база данных SQL имеет ряд помощников по базам данных, которые предоставляют настраиваемые рекомендации, позволяющие максимально повысить производительность. Эти помощники по базам данных постоянно оценивают и анализируют историю использования и предоставляют рекомендации на основе шаблонов рабочих нагрузок, помогающих повысить производительность.

## <a name="performance-overview"></a>Обзор производительности

Обзор производительности содержит сводку производительности базы данных и помогает в настройке и устранении неполадок производительности.

![Обзор производительности для базы данных SQL Azure](./media/sql-database-performance/performance-overview-annotated.png)

- Элемент **Рекомендации** содержит разбор рекомендаций по настройке базы данных (если рекомендаций много, отображаются только первые три). При щелчке этой плитки вы переходите к **[параметрам рекомендации по повышению производительности](sql-database-advisor-portal.md#viewing-recommendations)**.
- Элемент **Действие настройки** содержит сводные данные о текущих и выполненных действиях настройки базы данных и позволяет быстро получить представление об истории действий настройки. Щелчок по этой плитке открывает полную историю настройки вашей базы данных.
- На плитке **автонастройки** отображается **[Конфигурация автоматической](sql-database-automatic-tuning-enable.md)** настройки базы данных (параметры настройки, автоматически применяемые к базе данных). Щелкнув по этой плитке, вы откроете диалоговое окно настройки автоматизации.
- На элементе **Запросы к базе данных** отображаются сводные данные о производительности запросов к вашей базе данных (общий объем использования DTU и наиболее ресурсоемкие запросы). Если щелкнуть этот элемент, отобразится страница **[Анализ производительности запросов](sql-database-query-performance.md)**.

## <a name="performance-recommendation-options"></a>Параметры рекомендации по производительности

Параметры рекомендации по производительности, доступные для одной базы данных и в составе пула в базе данных SQL Azure:

| Рекомендации по производительности | Поддержка отдельной базы данных и базы данных в пуле | Поддержка базы данных экземпляра |
| :----------------------------- | ----- | ----- |
| **Рекомендации по созданию индексов** — рекомендации по созданию индексов, которые могут повысить производительность рабочей нагрузки. | Да | Нет |
| **Рекомендации по удалению индексов** . рекомендуется ежедневно удалять избыточные и повторяющиеся индексы, за исключением уникальных индексов и индексов, которые не использовались в течение длительного времени (>90 дней). Обратите внимание, что эта функция несовместима с приложениями, которые используют переключения секций и подсказки индекса. Удаление неиспользуемых индексов не поддерживается для уровней обслуживания "Премиум" и "критически важный для бизнеса". | Да | Нет |
| **Рекомендации по параметризации запросов (Предварительная версия)** — рекомендация принудительной параметризации в случаях, когда имеется один или несколько запросов, которые постоянно перекомпилируются, но в итоге используется тот же план выполнения запроса. | Да | Нет |
| **Рекомендации по устранению ошибок схемы (Предварительная версия)** . рекомендации по исправлению схемы появляются, когда служба базы данных SQL обнаруживает аномалию в количестве ошибок SQL, связанных со схемой, которые происходят в базе данных SQL. Корпорация Майкрософт в данный момент не поддерживает рекомендации по устранению ошибок схемы. | Да | Нет |

![Рекомендации по производительности для базы данных SQL Azure](./media/sql-database-performance/performance-recommendations-annotated.png)

Сведения о применении рекомендаций по производительности см. в разделе [применение рекомендаций](sql-database-advisor-portal.md#applying-recommendations). Чтобы просмотреть состояние рекомендаций, см. раздел [мониторинг операций](sql-database-advisor-portal.md#monitoring-operations).

Кроме того, вам доступен полный журнал действий по настройке, которые были применены ранее.

## <a name="create-index-recommendations"></a>Рекомендации по созданию индексов

База данных SQL Azure постоянно отслеживает выполняемые запросы и определяет индексы, которые могут повысить производительность. После того как система удостоверится в отсутствии определенного индекса, создается новая рекомендация **Создание индекса**.

База данных SQL Azure определяет это, оценивая рост производительности, который со временем обеспечит индекс. В зависимости от предполагаемого роста производительности рекомендации классифицируются как "Высокий", "Средний" и "Низкий".

Индексы, созданные с помощью рекомендаций, всегда помечаются как созданные автоматически. Можно увидеть, какие индексы создаются с помощью автоматического создания, просмотрев [представление sys. indexes](https://docs.microsoft.com/sql/relational-databases/system-catalog-views/sys-indexes-transact-sql). Автоматические созданные индексы не блокируют команды ALTER/Rename.

Если вы попытаетесь удалить столбец, по которому был автоматически создан индекс, команда будет выполнена. Автоматически созданный индекс также будет удален. Обычные индексы блокируют команду ALTER или RENAME, выполняемую для индексированных столбцов.

После применения рекомендации по созданию индекса база данных SQL Azure сравнивает производительность запросов с базовой производительностью. Если новый индекс улучшит производительность, рекомендация будет отмечена как успешная и будет создан отчет о результатах. Если индекс не улучшил производительность, он будет автоматически отменен. База данных SQL Azure использует этот процесс, чтобы обеспечить повышение производительности базы данных.

У любой рекомендации по **созданию индекса** есть политика отхода, которая не позволит применить рекомендацию при высоком уровне использования базы данных или пула. Эта политика учитывает такие метрики, как загрузка ЦП, операции ввода-вывода данных и журнала, а также доступный объем хранилища.

Если ЦП, операции ввода-вывода данных или журнала имеют значение выше 80% за последние 30 минут, то рекомендация создать индекс будет отложена. Если после создания индекса доступный объем хранилища будет ниже 10 %, рекомендация перейдет в состояние ошибки. Если по прошествии нескольких дней служба автонастройки снова определит, что создание индекса полезно, процесс запустится повторно.

Этот процесс будет повторяться, пока объем хранилища не будет достаточным для создания индекса или пока индекс не будет считаться полезным.

## <a name="drop-index-recommendations"></a>Рекомендации по удалению индексов

Помимо обнаружения отсутствующих индексов, база данных SQL Azure непрерывно анализирует производительность существующих индексов. Если индекс не используется, база данных SQL Azure порекомендует удалить его. Удаление индекса рекомендуется в двух случаях:

- индекс является дубликатом другого индекса (созданного на основе того же столбца, схемы секций и фильтров);
- индекс не использовался в течение длительного времени (93 дня).

Рекомендации по удалению индексов также проходят проверку после применения. Если производительность повысилась, будет создан отчет о результатах. Если производительность снизилась, будет выполнен откат рекомендации.

## <a name="parameterize-queries-recommendations-preview"></a>Рекомендации по параметризации запросов (Предварительная версия)

Рекомендации по *параметризации запросов* появляются при наличии одного или нескольких запросов, которые постоянно перекомпилируются, но в результате для них создается одинаковый план выполнения запроса. Это дает возможность применить принудительную параметризацию, которая позволит кэшировать планы запросов и повторно использовать их в будущем, повышая производительность и снижая использование ресурсов.

Каждый запрос, отправленный в SQL Server, сначала должен быть скомпилирован для формирования плана выполнения. Каждый создаваемый план добавляется в кэш планов и может быть использован повторно при последующем выполнении этого запроса, устраняя необходимость в дополнительной компиляции.

Запросы, которые содержат непараметризованные значения, могут привести к снижению производительности, так как для каждого такого запроса с различными значениями параметров план выполнения компилируется заново. Во многих случаях для одинаковых запросов с отличными значениями параметров создаются одинаковые планы выполнения, но эти планы по-прежнему добавляются в кэш планов по отдельности.

Этот процесс перекомпиляции планов операций использует ресурсы базы данных, увеличивает длительность запроса и переполняет кэш планов, что приводит к исключению планов из него. Такое поведение SQL Server можно изменить, задав параметр принудительной параметризации для базы данных.

Чтобы было проще оценить влияние этой рекомендации, вам будет предоставлено сравнение фактического и предполагаемого потребления ресурсов ЦП (после применения рекомендации). Эта рекомендация позволяет сэкономить ресурсы ЦП. Она также может помочь уменьшить длительность запроса и переполнение кэша планов, а это означает, что в кэше может оставаться больше планов, которые можно повторно использовать. Вы можете быстро применить эту рекомендацию, выбрав команду **Применить**.

Через несколько минут после применения этой рекомендации для вашей базы будет принудительно включена параметризация и запущен мониторинг, который длится примерно 24 часа. По истечении этого периода будет создан отчет о проверке, содержащий информацию об использовании ресурсов ЦП для базы данных за 24 часа до и через 24 часа после применения рекомендации. Помощник по базам данных SQL имеет механизм безопасности, который автоматически отменит примененную рекомендацию, если будет обнаружено снижение производительности.

## <a name="fix-schema-issues-recommendations-preview"></a>Рекомендации по устранению ошибок схемы (предварительная версия)

> [!IMPORTANT]
> Корпорация Майкрософт в данный момент не поддерживает рекомендации по устранению ошибок схемы. Мы рекомендуем использовать [Intelligent Insights](sql-database-intelligent-insights.md) для мониторинга проблем с производительностью базы данных, включая проблемы схемы, которые рассматривались ранее в рекомендациях по устранению ошибки схемы.

Рекомендации по **устранению ошибок схемы** отображаются, когда служба базы данных SQL Azure обнаруживает аномалию в количестве ошибок SQL, связанных со схемой, происходящих в базе данных SQL. Эта рекомендация обычно появляется, когда в базе данных возникает несколько связанных со схемой ошибок (недопустимое имя столбца, недопустимое имя объекта и т. д.) в течение часа.

"Проблемы схемы" — это класс синтаксических ошибок в SQL Server. Они происходят, когда определение запроса SQL и определение схемы базы данных не согласованы. Например, один из столбцов, ожидаемых запросом, может отсутствовать в целевой таблице или наоборот.

Рекомендация по исправлению ошибки схемы появляется, когда служба базы данных SQL Azure обнаруживает аномалию в количестве ошибок SQL, связанных со схемой, происходящих в базе данных SQL. В следующей таблице показаны ошибки, которые относятся к схеме.

| Код ошибки SQL | Сообщение |
| --- | --- |
| 201 |Процедура или функция "*" ожидает параметр "*", который не был указан. |
| 207 |Недопустимое имя столбца "*". |
| 208 |Недопустимое имя объекта "*". |
| 213 |Имя столбца или число переданных значений не соответствует определению таблицы. |
| 2812 |Не удалось найти хранимую процедуру "*". |
| 8144 |Для процедуры или функции * указано слишком много аргументов. |

## <a name="custom-applications"></a>Пользовательские приложения

Разработчики могут рассмотреть возможность разработки пользовательских приложений, используя рекомендации по повышению производительности для базы данных SQL Azure. Все рекомендации, перечисленные на портале для базы данных, можно получить с помощью API [Get-азсклдатабасерекоммендедактион](https://docs.microsoft.com/powershell/module/az.sql/get-azsqldatabaserecommendedaction) .

## <a name="next-steps"></a>Дальнейшие шаги

- Дополнительные сведения об автоматической настройке индексов базы данных и планов выполнения запросов см. в статье [Автоматическая настройка в Базе данных SQL Azure](sql-database-automatic-tuning.md).
- Дополнительные сведения о мониторинге производительности базы данных с помощью автоматической диагностики и анализа первопричин проблем с производительностью см. в статье [Intelligent Insights](sql-database-intelligent-insights.md).
- См. статью [Анализ производительности запросов базы данных Azure SQL](sql-database-query-performance.md), чтобы узнать о том, как просмотреть влияние на производительность основных запросов.
