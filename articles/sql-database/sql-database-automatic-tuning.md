---
title: Общие сведения об автоматической настройке
description: База данных SQL анализирует SQL-запрос и автоматически подстраивается под рабочую нагрузку пользователей.
services: sql-database
ms.service: sql-database
ms.subservice: performance
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: danimir
ms.author: danil
ms.reviewer: jrasnik, carlrab
ms.date: 03/10/2020
ms.openlocfilehash: d4762c86268353ff0464ff3919250cd86f0038d4
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79214101"
---
# <a name="automatic-tuning-in-azure-sql-database"></a>Автоматическая настройка в Базе данных SQL Azure

Автоматическая настройка базы данных Azure S'L обеспечивает максимальную производительность и стабильные рабочие нагрузки за счет непрерывной настройки производительности на основе ИИ и машинного обучения.

Автоматическая настройка — это полностью управляемая интеллектуальная служба производительности, которая непрерывно отслеживает выполняемые в базе данных запросы с помощью встроенной системы аналитики и автоматически повышает их производительность. Это достигается за счет динамической адаптации базы данных к изменениям рабочих нагрузок и применения рекомендаций по настройке. Автоматическая настройка горизонтально изучает все базы данных Azure с помощью механизма искусственного интеллекта и динамически улучшает действия настройки. Чем дольше работает база данных с автоматической настройкой, тем лучше она работает.

Автоматическая настройка базы данных Azure S'L может быть одной из наиболее важных функций, которые можно обеспечить стабильные и пиковые рабочие нагрузки базы данных.

## <a name="what-can-automatic-tuning-do-for-you"></a>Что может сделать автоматическая настройка для вас

- Автоматическая оптимизация производительности баз данных SQL Azure.
- Автоматическая проверка прироста производительности.
- Автоматический откат и самостоятельное восстановление.
- Журнал настройки
- Настройка T-SQL-скриптов для развертывания вручную.
- Упреждающий мониторинг производительности рабочей нагрузки.
- возможность развертывания сотен тысяч баз данных;
- положительное влияние на ресурсы DevOps и совокупную стоимость владения.

## <a name="safe-reliable-and-proven"></a>Безопасность и надежность

Операции тюнинга, применяемые к базам данных в базе данных Azure S'L, полностью безопасны для выполнения наиболее интенсивных рабочих нагрузок. Система была разработана с осторожностью, чтобы предотвратить воздействие на рабочие нагрузки пользователя. Автоматические рекомендации по настройке применяются только во время недостаточной нагрузки. Система также может временно отключать автоматические операции по настройке, чтобы защитить производительность рабочей нагрузки. В этом случае сообщение «Отключено системой» будет отображаться на портале Azure. Автоматическая настройка относится к рабочим нагрузкам с наивысшим приоритетом ресурсов.

Автоматические механизмы настройки отлажены и были усовершенствованы на нескольких миллионах баз данных, работающих в Azure. Автоматические операции настройки проверяются автоматически, чтобы обеспечить положительное улучшение производительности рабочей нагрузки. Регрессионные рекомендации по производительности динамически обнаруживаются и оперативно отменяются. Журнал выполнения настройки позволяет отслеживать улучшения, реализованные механизмом настройки для каждой базы данных SQL Azure.

![Как работает автоматическая настройка](./media/sql-database-automatic-tuning/how-does-automatic-tuning-work.png)

Автоматическая настройка базы данных Azure S'L совместно с автоматическим тюнингом S'L Server делится своей основной логикой с автоматическим тюнинг-движком S'L Server. Дополнительные технические сведения о встроенном механизме настройки см. в статье [Automatic tuning](https://docs.microsoft.com/sql/relational-databases/automatic-tuning/automatic-tuning) (Автоматическая настройка).

В приведенном ниже видео представлены принципы работы автоматической настройки и типичные сценарии использования.

> [!VIDEO https://channel9.msdn.com/Shows/Azure-Friday/Improve-Azure-SQL-Database-Performance-with-automatic-tuning/player]

## <a name="enable-automatic-tuning"></a>Включение автоматической настройки

Можно [включить автоматическую настройку для единых и объединенных баз данных на портале Azure](sql-database-automatic-tuning-enable.md) или с помощью оператора [ALTER DATABASE](https://docs.microsoft.com/sql/t-sql/statements/alter-database-transact-sql-set-options?view=azuresqldb-current) T-S'L. Вы позволяетавтоматическо подготавливать например базы данных в управляемом развертывании экземпляров с помощью оператора [ALTER DATABASE](https://docs.microsoft.com/sql/t-sql/statements/alter-database-transact-sql-set-options?view=azuresqldb-mi-current) T-S'L.

## <a name="automatic-tuning-options"></a>Параметры автоматической настройки

Параметры автоматической настройки, доступные в базе данных SQL Azure:

| Вариант автоматической настройки | Поддержка отдельной базы данных и базы данных в пуле | Поддержка базы данных инстанций |
| :----------------------------- | ----- | ----- |
| **CREATE INDEX** - Определяет индексы, которые могут повысить производительность рабочей нагрузки, создает индексы и автоматически проверяет, что производительность запросов улучшилась. | Да | нет |
| **DROP INDEX** - Определяет избыточные и дублирующие индексы ежедневно, за исключением уникальных индексов и индексов, которые не использовались в течение длительного времени (>90 дней). Обратите внимание, что эта функция несовместима с приложениями, которые используют переключения секций и подсказки индекса. Удаление неиспользованных индексов не поддерживается для уровней premium и Business Critical. | Да | нет |
| **FORCE LAST GOOD PLAN** (автоматическая коррекция плана) - Определяет запросы СЗЛ с использованием плана выполнения, который медленнее предыдущего хорошего плана, и запросы с использованием последнего известного хорошего плана вместо регрессированного плана. | Да | Да |

### <a name="automatic-tuning-for-single-and-pooled-databases"></a>Автоматическая настройка для единых и объединенных баз данных

Автоматическая настройка для отдельных и объединенных баз данных использует РЕКОМЕНДАЦИи консультанта по базам данных **CREATE INDEX,** **DROP INDEX**и FORCE LAST **GOOD PLAN** для оптимизации производительности базы данных. Для получения дополнительной информации смотрите [рекомендации консультанта по базам данных на портале Azure,](sql-database-advisor-portal.md)в [PowerShell](https://docs.microsoft.com/powershell/module/az.sql/get-azsqldatabaserecommendedaction)и в [REST API](https://docs.microsoft.com/rest/api/sql/serverautomatictuning).

Вы можете либо вручную применять рекомендации настройки с помощью портала Azure, либо позволить автоматическому тюнингу автономно применять рекомендации по настройке для вас. Преимущество автономного системного применения рекомендаций по настройке заключается в том, что система автоматически проверяет возможность увеличить производительность рабочей нагрузки. Если значительное повышение производительности не обнаружено, система автоматически вернется к рекомендации по настройке. Обратите внимание, что в случае запросов, на которые могут повлиять рекомендации по настройке, выполняемые нечасто, этап проверки может занять до 72 часов.

В случае, если вы применяете рекомендации по настройке через T-S'S, автоматическая проверка производительности и механизмы разворота отсутствуют. Рекомендации, применяемые таким образом, останутся активными и будут отображаться в перечне рекомендаций по настройке на 24-48 часов. до того, как система автоматически изымает их. Если вы хотите удалить рекомендацию раньше, вы можете отказаться от нее с портала Azure.

Параметры автоматической настройки можно включать и отключать отдельно для каждой базы данных, а также их можно настроить на серверах Базы данных SQL и применять для каждой базы данных, которая наследует параметры сервера. Серверы базы данных S'L могут наследовать по умолчанию Azure для автоматических настроек настройки настройки. Поддерживаемые сейчас значения Azure по умолчанию: FORCE_LAST_GOOD_PLAN включено, CREATE_INDEX включено, а DROP_INDEX отключено.

> [!IMPORTANT]
> С марта 2020 года изменения в azure по умолчанию для автоматической настройки вступят в силу следующим образом:
>
> - Новые по умолчанию Azure будут FORCE_LAST_GOOD_PLAN включены, CREATE_INDEX отключены, а DROP_INDEX отключены.
> - Существующие серверы без настройки автоматической настройки настройки будут автоматически настроены на INHERIT новых по умолчанию Azure. Это относится ко всем клиентам, которые в настоящее время имеют настройки сервера для автоматической настройки в неопределенном состоянии.
> - Новые созданные серверы будут автоматически настроены на INHERIT новых по умолчанию Azure (в отличие от ранее, когда автоматическая настройка конфигурации была в неопределенном состоянии при создании нового сервера).

Настройка параметров автоматической настройки на сервере и наследования настроек для баз данных, принадлежащих родительскому серверу, является рекомендуемым методом настройки автоматической настройки, поскольку он упрощает управление параметрами автоматической настройки для большого числа баз данных.

Чтобы узнать о создании уведомлений по электронной почте для рекомендаций автоматической настройки, [см.](sql-database-automatic-tuning-email-notifications.md)

### <a name="automatic-tuning-for-instance-databases"></a>Автоматическая настройка, например, баз данных

Автоматическая настройка, например, баз данных в управляемом развертывании экземпляров поддерживает только **FORCE LAST GOOD PLAN.** Для получения дополнительной информации о настройке параметров автоматической настройки через T-S'L [см. Автоматическая настройка вводит автоматическую коррекцию плана](https://azure.microsoft.com/blog/automatic-tuning-introduces-automatic-plan-correction-and-t-sql-management/) и [автоматическую коррекцию плана.](https://docs.microsoft.com/sql/relational-databases/automatic-tuning/automatic-tuning?view=sql-server-ver15#automatic-plan-correction)

## <a name="next-steps"></a>Дальнейшие действия

- Чтобы узнать о встроенном интеллекте, используемом в автоматической настройке, [см.](https://azure.microsoft.com/blog/artificial-intelligence-tunes-azure-sql-databases/)
