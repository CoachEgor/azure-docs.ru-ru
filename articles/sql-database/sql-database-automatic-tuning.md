---
title: Автоматическая настройка базы данных SQL Azure
description: База данных SQL анализирует SQL-запрос и автоматически подстраивается под рабочую нагрузку пользователей.
services: sql-database
ms.service: sql-database
ms.subservice: performance
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: danimir
ms.author: danil
ms.reviewer: jrasnik, carlrab
ms.date: 03/06/2019
ms.openlocfilehash: bfac5a0eba68469d912efd02699624e1335e40e5
ms.sourcegitcommit: 609d4bdb0467fd0af40e14a86eb40b9d03669ea1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/06/2019
ms.locfileid: "73691112"
---
# <a name="automatic-tuning-in-azure-sql-database"></a>Автоматическая настройка в Базе данных SQL Azure

Автоматическая настройка базы данных SQL Azure обеспечивает наилучшую производительность и стабильность рабочих нагрузок благодаря механизму непрерывной оптимизации производительности на основе искусственного интеллекта и машинного обучения.

Автоматическая настройка — это полностью управляемая интеллектуальная служба производительности, которая непрерывно отслеживает выполняемые в базе данных запросы с помощью встроенной системы аналитики и автоматически повышает их производительность. Это достигается за счет динамической адаптации базы данных к изменениям рабочих нагрузок и применения рекомендаций по настройке. Автоматическая настройка горизонтально изучает все базы данных Azure с помощью механизма искусственного интеллекта и динамически улучшает действия настройки. Чем дольше база данных SQL Azure выполняется с включенной автоматической настройкой, тем лучше она работает.

Автоматическая настройка в Базе данных SQL Azure — возможно, одна из самых важных функций, позволяющая обеспечить выполнение рабочих нагрузок при стабильной и пиковой работе.

## <a name="what-can-automatic-tuning-do-for-you"></a>Возможности автоматической настройки

- Автоматическая оптимизация производительности баз данных SQL Azure.
- Автоматическая проверка прироста производительности.
- Автоматический откат и самостоятельное восстановление.
- Журнал настройки
- Настройка T-SQL-скриптов для развертывания вручную.
- Упреждающий мониторинг производительности рабочей нагрузки.
- возможность развертывания сотен тысяч баз данных;
- положительное влияние на ресурсы DevOps и совокупную стоимость владения.

## <a name="safe-reliable-and-proven"></a>Безопасность и надежность

Операции настройки, применяемые к базам данных SQL Azure, полностью безопасны для выполнения самых интенсивных рабочих нагрузок. Система была разработана с осторожностью, чтобы предотвратить воздействие на рабочие нагрузки пользователя. Автоматические рекомендации по настройке применяются только во время недостаточной нагрузки. Система также может временно отключать автоматические операции по настройке, чтобы защитить производительность рабочей нагрузки. В этом случае на портале Azure появится сообщение "Disabled by the system" (Отключено системой). Автоматическая настройка относится к рабочим нагрузкам с наивысшим приоритетом ресурсов.

Автоматические механизмы настройки отлажены и были усовершенствованы на нескольких миллионах баз данных, работающих в Azure. Автоматические операции настройки проверяются автоматически, чтобы обеспечить положительное улучшение производительности рабочей нагрузки. Регрессионные рекомендации по производительности динамически обнаруживаются и оперативно отменяются. Журнал выполнения настройки позволяет отслеживать улучшения, реализованные механизмом настройки для каждой базы данных SQL Azure. 

![Как работает автоматическая настройка](./media/sql-database-automatic-tuning/how-does-automatic-tuning-work.png)

Автоматическая настройка базы данных SQL Azure использует основную логику совместно с механизмом автоматической настройки SQL Server. Дополнительные технические сведения о встроенном механизме настройки см. в статье [Automatic tuning](https://docs.microsoft.com/sql/relational-databases/automatic-tuning/automatic-tuning) (Автоматическая настройка).

## <a name="use-automatic-tuning"></a>Использование автоматической настройки

Автоматическая настройка должна быть включена в подписке. Чтобы узнать, как включить автоматическую настройку с помощью портала Azure, см. статью [Включение автоматической настройки](sql-database-automatic-tuning-enable.md).

Автоматическая настройка может работать автономно путем автоматического применения рекомендаций по настройке, включая проверки прироста производительности. 

Для большего контроля можно отключить автоматическое применение рекомендаций по настройке и применять их вручную с помощью портала Azure. Можно также использовать решение только для просмотра автоматических рекомендаций по настройке и применять их вручную, используя скрипты и средства по своему усмотрению. 

В приведенном ниже видео представлены принципы работы автоматической настройки и типичные сценарии использования.


> [!VIDEO https://channel9.msdn.com/Shows/Azure-Friday/Improve-Azure-SQL-Database-Performance-with-Automatic-Tuning/player]
>

## <a name="automatic-tuning-options"></a>Параметры автоматической настройки

Параметры автоматической настройки, доступные в базе данных SQL Azure:

| Параметр автоматической настройки | Поддержка отдельной базы данных и базы данных в пуле | Поддержка базы данных экземпляра |
| :----------------------------- | ----- | ----- |
| **Создание индекса** — определяет индексы, которые могут повысить производительность рабочей нагрузки, создает индексы и автоматически проверяет производительность запросов. | Да | Нет | 
| **DROP INDEX** — ежедневно идентифицирует избыточные и повторяющиеся индексы, за исключением уникальных индексов и индексов, которые не использовались в течение длительного времени (> 90 дней). Обратите внимание, что эта функция несовместима с приложениями, которые используют переключения секций и подсказки индекса. Удаление неиспользуемых индексов не поддерживается для уровней обслуживания "Премиум" и "критически важный для бизнеса". | Да | Нет |
| **Принудительный последний хороший план** (автоматическое исправление плана) — определяет запросы SQL с использованием плана выполнения, который медленнее предыдущего, и запросов, использующих Последний известный план, а не регрессивный план. | Да | Да |

Автоматическая настройка идентифицирует рекомендации для использования параметров **Создать индекс**, **Удалить индекс** и **Force last good plan** (Принудительное выполнение последнего хорошего плана), с помощью которых можно оптимизировать производительность базы данных, и отображает их на [портале Azure](sql-database-advisor-portal.md). Получить эти параметры можно с помощью [T-SQL](https://docs.microsoft.com/sql/t-sql/statements/alter-database-transact-sql-set-options?view=azuresqldb-current) и [REST API](https://docs.microsoft.com/rest/api/sql/serverautomatictuning). Дополнительные сведения о ПРИНУДИТЕЛЬном последнем УДАЧном плане и настройке параметров автоматической настройки с помощью T-SQL см. в разделе [Автоматическая настройка содержит автоматическое исправление плана](https://azure.microsoft.com/blog/automatic-tuning-introduces-automatic-plan-correction-and-t-sql-management/).

Вы можете вручную применить рекомендации по настройке с помощью портала или разрешить автоматической настройке автономно применять эти рекомендации. Преимущество автономного системного применения рекомендаций по настройке заключается в том, что система автоматически проверяет возможность увеличить производительность рабочей нагрузки. Если значительное повышение производительности не обнаружено, система автоматически вернется к рекомендации по настройке. Обратите внимание, что в случае запросов, на которые могут повлиять рекомендации по настройке, выполняемые нечасто, этап проверки может занять до 72 часов.

В случае применения рекомендаций по настройке с помощью T-SQL, автоматическая проверка производительности и механизмы реверсирования недоступны. Рекомендации, применяемые таким образом, остаются активными и отображаются в списке рекомендаций по настройке в течение 24-48 часов. перед тем, как система автоматически отбудет их снять. Если вы хотите удалить рекомендацию раньше, вы можете отказаться от портал Azure.

Параметры автоматической настройки можно включать и отключать отдельно для каждой базы данных, а также их можно настроить на серверах Базы данных SQL и применять для каждой базы данных, которая наследует параметры сервера. Серверы Базы данных SQL могут наследовать значения Azure по умолчанию для параметров автоматической настройки. Поддерживаемые сейчас значения Azure по умолчанию: FORCE_LAST_GOOD_PLAN включено, CREATE_INDEX включено, а DROP_INDEX отключено.

Советуем настроить параметры автоматической настройки на сервере и задать наследование параметров от родительского сервера, так как это упрощает управление этими параметрами для большого количества баз данных.

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о том, как включить автоматическую настройку в базе данных SQL Azure, чтобы управлять рабочей нагрузкой, см. в статье [Включение автоматической настройки](sql-database-automatic-tuning-enable.md).
- Дополнительные сведения о том, как вручную проверить и применить рекомендации автоматической настройки, см. в статье [Поиск и применение рекомендаций по производительности](sql-database-advisor-portal.md).
- Сведения о том, как использовать T-SQL для применения и просмотра рекомендаций по автоматической настройке, см. в этой [записи](https://azure.microsoft.com/blog/automatic-tuning-introduces-automatic-plan-correction-and-t-sql-management/) блога.
- См. дополнительные сведения о [создании уведомлений по электронной почте для рекомендаций по автоматической настройке ](sql-database-automatic-tuning-email-notifications.md).
- Дополнительные сведения о встроенном механизме аналитики, используемом для автоматической настройки, см. в записи блога [Artificial Intelligence tunes Azure SQL Databases](https://azure.microsoft.com/blog/artificial-intelligence-tunes-azure-sql-databases/) (Механизм искусственного интеллекта настраивает базы данных SQL Azure).
- Дополнительные сведения о том, как автоматическая настройка работает в Базе данных SQL Azure и SQL Server 2017, см. в [этой статье](https://docs.microsoft.com/sql/relational-databases/automatic-tuning/automatic-tuning).
