---
title: Настроить общедоступную конечную точку - Azure базы данных SQL управляемого экземпляра | Документация Майкрософт
description: Узнайте, как настроить общедоступную конечную точку для управляемого экземпляра
services: sql-database
ms.service: sql-database
ms.subservice: security
ms.custom: ''
ms.topic: conceptual
author: srdan-bozovic-msft
ms.author: srbozovi
ms.reviewer: vanto, carlrab
manager: craigg
ms.date: 05/07/2019
ms.openlocfilehash: d3e68a5287e59c576f85491e6e5eba33fac080ca
ms.sourcegitcommit: e6d53649bfb37d01335b6bcfb9de88ac50af23bd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/09/2019
ms.locfileid: "65465183"
---
# <a name="configure-public-endpoint-in-azure-sql-database-managed-instance"></a>Настроить общедоступную конечную точку в управляемый экземпляр базы данных SQL Azure

Общедоступную конечную точку для [управляемый экземпляр](https://docs.microsoft.com/azure/sql-database/sql-database-managed-instance-index) включает доступ к управляемому экземпляру из за пределами [виртуальной сети](../virtual-network/virtual-networks-overview.md). Вы сможете получить доступ к управляемому экземпляру из нескольких клиентов служб Azure, как Power BI, службы приложений Azure или локальной сети. С помощью общедоступной конечной точки на управляемом экземпляре, вы не обязательно должны использовать VPN, которые помогут избежать проблем с пропускной способности VPN.

В этой статье вы узнаете, как:

> [!div class="checklist"]
> - Включить общедоступную конечную точку для управляемого экземпляра на портале Azure
> - Включить общедоступную конечную точку для управляемого экземпляра с помощью PowerShell
> - Настроить группу безопасности сети в управляемый экземпляр, чтобы разрешить трафик в общедоступную конечную точку для управляемого экземпляра
> - Получение строки подключения конечной точки с общедоступным управляемого экземпляра

## <a name="permissions"></a>Разрешения

Из-за уровня конфиденциальности данных в управляемый экземпляр конфигурацию, чтобы включить управляемый экземпляр общедоступной конечной точки требуется в два этапа. Эта мера безопасности соответствует разделения обязанностей (SoD):

- Включение общедоступную конечную точку на управляемом экземпляре необходимо сделать администратором. управляемый экземпляр Администратор управляемого экземпляра можно найти на **Обзор** странице SQL управляемого экземпляра ресурса.
- Разрешает трафик с помощью группы безопасности сети, которую необходимо сделать, сетевому администратору. Дополнительные сведения см. в разделе [сетевой группе безопасности разрешения](../virtual-network/manage-network-security-group.md#permissions).

## <a name="enabling-public-endpoint-for-a-managed-instance-in-the-azure-portal"></a>Включение общедоступную конечную точку для управляемого экземпляра на портале Azure

1. Запустите портал Azure <https://portal.azure.com/.>
1. Откройте группу ресурсов с управляемым экземпляром и выберите **управляемый экземпляр SQL** вы хотите настроить общедоступную конечную точку.
1. На **безопасности** параметров и нажмите кнопку **виртуальная сеть** вкладки.
1. На странице конфигурации виртуальной сети выберите **включить** и затем **Сохранить** значок, чтобы обновить конфигурацию.

![mi-vnet-config.png](media/sql-database-managed-instance-public-endpoint-configure/mi-vnet-config.png)

## <a name="enabling-public-endpoint-for-a-managed-instance-using-powershell"></a>Включение общедоступную конечную точку для управляемого экземпляра с помощью PowerShell

### <a name="enable-public-endpoint"></a>Включить общедоступную конечную точку

Выполните приведенные ниже команды PowerShell. Замените **ИД_ПОДПИСКИ** своим идентификатором подписки. Кроме того, замените **rg-name** с группой ресурсов для управляемого экземпляра, а **mi имя** с именем управляемого экземпляра.

```powershell
Install-Module -Name Az

Import-Module Az.Accounts
Import-Module Az.Sql

Connect-AzAccount

# Use your subscription ID in place of subscription-id below

Select-AzSubscription -SubscriptionId {subscription-id}

# Replace rg-name with the resource group for your managed instance, and replace mi-name with the name of your managed instance

$mi = Get-AzSqlInstance -ResourceGroupName {rg-name} -Name {mi-name}

$mi = $mi | Set-AzSqlInstance -PublicDataEndpointEnabled $true -force
```

### <a name="disable-public-endpoint"></a>Отключить общедоступную конечную точку

Чтобы отключить общедоступную конечную точку, с помощью PowerShell, вы бы выполните следующую команду (и также не забудьте закрыть NSG для входящего порта 3342, если он настроен):

```powershell
Set-AzSqlInstance -PublicDataEndpointEnabled $false -force
```

## <a name="allow-public-endpoint-traffic-on-the-network-security-group"></a>Разрешить трафик в общедоступную конечную точку в группу безопасности сети

1. Если у вас на страницу настройки управляемого экземпляра, который все еще открыто, перейдите к **Обзор** вкладки. В противном случае вернитесь к вашей **управляемый экземпляр SQL** ресурсов. Выберите **виртуальную сеть и подсеть** ссылку, которая перенаправит вас на страницу конфигурации виртуальной сети.

    ![mi overview.png](media/sql-database-managed-instance-public-endpoint-configure/mi-overview.png)

1. Выберите **подсетей** вкладку на панели слева конфигурации виртуальной сети и запишите **группы безопасности** для управляемого экземпляра.

    ![mi-vnet-subnet.png](media/sql-database-managed-instance-public-endpoint-configure/mi-vnet-subnet.png)

1. Вернитесь к группе ресурсов, содержащий управляемому экземпляру. Вы должны увидеть **группы безопасности сети** имя указано выше. Выберите имя, чтобы перейти на страницу конфигурации группы безопасности сети.

1. Выберите **правила безопасности для входящего трафика** вкладке и **добавить** правило, которое имеет более высокий приоритет, чем **deny_all_inbound** правило со следующими параметрами: </br> </br>

    |Параметр  |Предлагаемое значение  |Описание  |
    |---------|---------|---------|
    |**Source**     |Любой IP-адреса или тег службы         |<ul><li>Для служб Azure, таких как Power BI выберите тег Azure облачной службы</li> <li>Для компьютера или виртуальной Машины Azure используйте IP-адрес NAT</li></ul> |
    |**Диапазоны исходных портов**     |*         |Оставьте для * (any) как исходные порты, обычно динамически выделяемый и как таковой, непредсказуемыми. |
    |**Назначение**     |Все         |Создание назначения как какой-либо чтобы разрешить трафик в подсети управляемого экземпляра |
    |**Диапазоны портов назначения**     |3342         |Порт назначения области для 3342, который является управляемым экземпляром, общедоступной конечной точки TDS |
    |**Протокол**     |TCP         |Управляемый экземпляр использует TCP-протокол для потока табличных данных |
    |**Действие**     |Allow         |Разрешить входящий трафик в управляемый экземпляр через общедоступную конечную точку |
    |**Приоритет**     |1300         |Убедитесь, что это правило имеет более высокий приоритет, чем **deny_all_inbound** правило |

    ![mi-nsg-rules.png](media/sql-database-managed-instance-public-endpoint-configure/mi-nsg-rules.png)

    > [!NOTE]
    > Порт 3342 используется для общедоступной конечной точки подключения для управляемого экземпляра и не может быть изменено на этом этапе.

## <a name="obtaining-the-managed-instance-public-endpoint-connection-string"></a>Получение строки подключения конечной точки с общедоступным управляемый экземпляр

1. Перейдите на страницу настройки управляемого экземпляра SQL, разрешенное для общедоступной конечной точки. Выберите **строки подключения** открыть, выбрав вкладку **параметры** конфигурации.
1. Обратите внимание на то, что имя узла конечной точки с общедоступным поставляется в формате < mi_name >. **открытый**. < dns_zone >. database.windows.net, и что порт, используемый для соединения является 3342.

    ![mi — открытого endpoint-conn-string.png](media/sql-database-managed-instance-public-endpoint-configure/mi-public-endpoint-conn-string.png)

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о [с помощью базы данных SQL управляемого экземпляра безопасно с общедоступной конечной точки](sql-database-managed-instance-public-endpoint-securely.md).