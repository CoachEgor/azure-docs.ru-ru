---
title: Настройка оповещений и уведомлений для Управляемый экземпляр (портал Azure)
description: Используйте портал Azure для создания предупреждений SQL Управляемый экземпляр, которые могут активировать уведомления или автоматизацию при выполнении указанных условий.
services: sql-database
ms.service: sql-database
ms.subservice: performance
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: danimir
ms.author: danil
ms.reviewer: jrasnik, carlrab
ms.date: 05/04/2020
ms.openlocfilehash: 0e7c4cde684f393fd98ada46393948c5a62efa2f
ms.sourcegitcommit: c8a0fbfa74ef7d1fd4d5b2f88521c5b619eb25f8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/05/2020
ms.locfileid: "82800863"
---
# <a name="create-alerts-for-azure-sql-managed-instance-using-the-azure-portal"></a>Создание оповещений для Управляемый экземпляр Azure SQL с помощью портал Azure

## <a name="overview"></a>Обзор

В этой статье показано, как настроить оповещения для баз данных в базе данных SQL Управляемый экземпляр Azure с помощью портал Azure. Оповещения могут отправить вам сообщение электронной почты, вызвать веб-перехватчик, выполнить функцию Azure, Runbook, вызвать внешнюю систему, совместимую с ITSM, позвонить на телефон или отправить текстовое сообщение, когда определенная метрика, например размер хранилища экземпляров или загрузка ЦП, достигнет предопределенного порогового значения. В этой статье также приведены рекомендации по настройке периодов оповещений.

Вы можете получать оповещения на основе отслеживания метрик или событий в службах Azure.

* **Значения метрик**. Оповещение активируется, когда значение указанной метрики выходит за рамки заданного порогового значения. То есть сначала оно активируется, когда условие выполняется, а затем — когда условие перестает выполняться.

Для оповещения можно настроить действие, выполняемое при активации оповещения:

* Отправка уведомлений по электронной почте администратору службы и соадминистраторам
* отправка уведомления на указанные дополнительные электронные адреса;
* Вызов номера телефона с голосовым запросом
* Отправить текстовое сообщение на номер телефона
* Вызов webhook.
* Вызов функции Azure
* Вызов Runbook Azure
* Вызов внешней системы, совместимой с ITSM

Вы можете настроить и получить сведения о правилах генерации оповещений с помощью следующих интерфейсов:

* [Портал Azure](../monitoring-and-diagnostics/insights-alerts-portal.md)
* [PowerShell](../azure-monitor/platform/alerts-classic-portal.md)
* [Интерфейс командной строки (CLI)](../azure-monitor/platform/alerts-classic-portal.md)
* [Azure Monitor REST API](https://msdn.microsoft.com/library/azure/dn931945.aspx)

## <a name="alerting-metrics-available-for-managed-instance"></a>Метрики предупреждений, доступные для управляемого экземпляра

> [!IMPORTANT]
> Метрики предупреждений доступны только для управляемого экземпляра. Метрики предупреждений для отдельных баз данных в управляемом экземпляре недоступны. Данные телеметрии диагностики базы данных находятся в другой части, доступной в виде [журналов диагностики](sql-database-metrics-diag-logging.md#diagnostic-telemetry-for-export-for-azure-sql-database). Оповещения о журналах диагностики можно настроить в продукте [SQL Analytics](../azure-monitor/insights/azure-sql.md) с помощью [сценариев оповещения журнала](../azure-monitor/insights/azure-sql.md#creating-alerts-for-managed-instances) для управляемого экземпляра.

Для конфигурации предупреждений доступны следующие метрики управляемого экземпляра:

| Метрика | Описание | Единица измерения — возможные значения |
| :--------- | --------------------- | ----------- |
| Average CPU percentage (Средний процент использования ЦП) | Средний процент использования ЦП за выбранный период времени. | 0-100 (в процентах) |
| Количество считанных байт ввода-вывода | Количество байтов ввода-вывода, считанных за выбранный период времени. | Байты |
| Количество записанных байт ввода-вывода | Байты ввода-вывода, записанные за выбранный период времени. | Байты |
| IO requests count (Количество запросов ввода-вывода) | Число запросов ввода-вывода за выбранный период времени. | числовые; |
| Зарезервированное дисковое пространство | Текущий максимум. дисковое пространство, зарезервированное для управляемого экземпляра. Изменения с операцией масштабирования ресурсов. | МБ (МБ) |
| Использованное дисковое пространство | Дисковое пространство, используемое в выбранном периоде. Изменения с потреблением хранилища базами данных и экземпляром. | МБ (МБ) |
| Virtual core count (Число виртуальных ядер) | Виртуальных ядер, подготовленный для управляемого экземпляра. Изменения с операцией масштабирования ресурсов. | 4-80 (виртуальных ядер) |

## <a name="create-an-alert-rule-on-a-metric-with-the-azure-portal"></a>Создание правила генерации оповещений на основе метрики с помощью портала Azure

1. На [портале](https://portal.azure.com/)Azure перейдите к управляемому ЭКЗЕМПЛЯРу SQL, который вас интересует, и выберите его.

2. Выберите пункт меню **метрик** в разделе Мониторинг.

   ![Наблюдение](media/sql-database-managed-instance-alerts/mi-alerting-menu-annotated.png)
  
3. В раскрывающемся меню выберите одну из метрик, для которых вы хотите настроить оповещение (в примере используется используемое дисковое пространство).

4. Выберите период агрегирования — средний, минимальный или максимальный предел в заданный период времени (AVG, min или Max). 

5. Выберите **новое правило генерации оповещений**

6. На панели Создание правила генерации оповещений щелкните **имя условия** (в примере показано используемое дисковое пространство).

   ![Определение условия](media/sql-database-managed-instance-alerts/mi-create-metrics-alert-smaller-annotated.png)

7. На панели Настройка логики сигнала укажите оператор, тип агрегирования и пороговое значение.

   * Параметры типа оператора больше, равны и меньше (пороговое значение)
   * Параметры типа агрегирования — min, Max или Average (в период гранулярности статистической обработки)
   * Пороговое значение — это значение предупреждения, которое будет оцениваться на основе оператора и критериев статистической обработки.
   
   ![Configure_signal_logic](media/sql-database-managed-instance-alerts/mi-configure-signal-logic-annotated.png)
   
   В примере, показанном на снимке экрана, используется значение 1840876 МБ, представляющее пороговое значение 1,8 ТБ. Так как оператор в примере имеет значение больше, предупреждение будет создано, если объем хранилища, потребляемый управляемым экземпляром, превышает 1,8 ТБ. Обратите внимание, что пороговое значение для метрик дискового пространства должно быть выражено в МБ.

8. Задайте период оценки — гранулярность статистической обработки в минутах и частоту вычисления. Частота вычисления будет заметка времени, в течение которого система предупреждений будет периодически проверять, было ли выполнено условие порогового значения.

9. Выберите группу действий. Отобразится область группы действий, с помощью которой вы сможете выбрать существующую или создать новое действие. Это действие определяет, что произойдет при активации оповещения (например, при отправке электронной почты, вызове вами по телефону, выполнении веб-перехватчика, функции Azure или Runbook).

   ![Select_action_group](media/sql-database-managed-instance-alerts/mi-select-action-group-smaller-annotated.png)

   * Чтобы создать новую группу действий, выберите **+ создать группу действий** .

      ![Create_action_group_alerts](media/sql-database-managed-instance-alerts/mi-create-alert-action-group-smaller-annotated.png)
   
   * Укажите способ оповещения: введите имя группы действий, краткое имя, имя действия и тип действия. Тип действия определяет, будете ли вы получать уведомления по электронной почте, текстовому сообщению, голосовому вызову или, если возможно, веб-перехватчику, функции Azure, Runbook или ITSM-запрос будет создан в совместимой системе.

      ![Define_how_to_be_alerted](media/sql-database-managed-instance-alerts/mi-add-alerts-action-group-annotated.png)

10. Заполните сведения о правиле генерации оповещений для записей, выберите тип серьезности.

      ![Rule_description](media/sql-database-managed-instance-alerts/mi-rule-details-complete-smaller-annotated.png)

   * Завершите создание правила оповещения, нажав кнопку **создать правило генерации оповещений** .

Новое правило генерации оповещений станет активным в течение нескольких минут и будет активировано на основе ваших параметров.

## <a name="verifying-alerts"></a>Проверка предупреждений

> [!NOTE]
> Сведения о том, как скрывать предупреждения, см. в разделе [интервал of Alerts using Rule Actions](../azure-monitor/platform/alerts-action-rules.md#suppression-of-alerts).

После настройки правила предупреждения убедитесь, что вы удовлетворены триггером предупреждения и его частотой. В примере, приведенном на этой странице, для настройки предупреждения об используемом пространстве хранилища, если параметр оповещения был электронной почтой, вы можете получить сообщение электронной почты, как показано ниже.

   ![alert_example](media/sql-database-managed-instance-alerts/mi-email-alert-example-smaller-annotated.png)

В сообщении электронной почты отображается имя оповещения, сведения о пороговом значении и причины срабатывания оповещения, помогающие в проверке и устранении неполадок с оповещением. Чтобы просмотреть оповещение, полученное по электронной почте в портал Azure, можно воспользоваться кнопкой " **см. в портал Azure** ". 

## <a name="view-suspend-activate-modify-and-delete-existing-alert-rules"></a>Просмотр, приостановка, активация, изменение и удаление существующих правил генерации оповещений

> [!NOTE]
> Существующие оповещения должны быть управляемыми из меню предупреждений на панели мониторинга портал Azure. Существующие оповещения нельзя изменить из колонки Управляемый экземпляр ресурсов.

Для просмотра, приостановки, активации, изменения и удаления существующих оповещений:

1. Поиск оповещений с помощью портал Azure поиска. Щелкните оповещения.

   ![find_alerts](media/sql-database-managed-instance-alerts/mi-manage-alerts-browse-smaller-annotated.png)

   Кроме того, можно также щелкнуть оповещения на панели навигации Azure, если она настроена.

2. В области оповещения выберите Управление правилами оповещений.

   ![modify_alerts](media/sql-database-managed-instance-alerts/mi-manage-alert-rules-smaller-annotated.png)

   Отобразится список существующих предупреждений. Выберите отдельное существующее правило генерации оповещений для управления. Существующие активные правила могут быть изменены и настроены в предпочтениях. Активные правила также могут быть приостановлены без удаления. 

## <a name="next-steps"></a>Следующие шаги

* Дополнительные сведения о Azure Monitor системе предупреждений см. [в разделе Обзор оповещений в Microsoft Azure](../azure-monitor/platform/alerts-overview.md)
* Дополнительные сведения об оповещениях метрик см. в статье Общие сведения о [работе оповещений метрик в Azure Monitor](../azure-monitor/platform/alerts-metric-overview.md)
* Сведения о настройке веб-перехватчика в оповещениях см. в разделе [вызов веб-перехватчика с классическим оповещением метрики](../azure-monitor/platform/alerts-webhooks.md) .
* Дополнительные сведения о настройке оповещений и управлении ими с помощью PowerShell см. в разделе [правила действий](https://docs.microsoft.com/powershell/module/az.monitor/add-azmetricalertrulev2) .
* Дополнительные сведения о настройке оповещений и управлении ими с помощью API см. в [справочнике по Azure Monitor REST API](https://docs.microsoft.com/rest/api/monitor/) 
