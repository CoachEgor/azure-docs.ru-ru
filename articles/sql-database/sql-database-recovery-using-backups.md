---
title: Восстановление базы данных SQL Azure из резервной копии | Документация Майкрософт
description: Узнайте о восстановлении до точки во времени, которое позволяет выполнить откат базы данных SQL Azure до 35 дней.
services: sql-database
ms.service: sql-database
ms.subservice: backup-restore
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: anosov1960
ms.author: sashan
ms.reviewer: mathoma, carlrab, danil
ms.date: 09/26/2019
ms.openlocfilehash: f316f77d0f4ca3132a2ae77d807e2dd66ba62a43
ms.sourcegitcommit: 15e3bfbde9d0d7ad00b5d186867ec933c60cebe6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/03/2019
ms.locfileid: "71846277"
---
# <a name="recover-an-azure-sql-database-by-using-automated-database-backups"></a>Восстановление базы данных SQL Azure с помощью автоматически создаваемых резервных копий базы данных

По умолчанию резервные копии базы данных SQL Azure хранятся в геореплицированном хранилище BLOB-объектов. Для восстановления базы данных доступны следующие параметры с помощью автоматически создаваемых [резервных копий базы данных](sql-database-automated-backups.md). Можно выполнить следующие действия:

- Создайте новую базу данных на том же сервере базы данных SQL, восстановленную до указанной точки во времени в течение срока хранения.
- Создайте базу данных на том же сервере базы данных SQL, восстановленную до времени удаления для удаленной базы данных.
- Создайте новую базу данных на любом сервере базы данных SQL в том же регионе, восстановленном до момента последнего резервного копирования.
- Создайте новую базу данных на любом сервере базы данных SQL в любом другом регионе, восстановленной до момента последнего реплицированного резервного копирования.

Если вы настроили [долгосрочное хранение резервных копий](sql-database-long-term-retention.md), можно также создать новую базу данных на основе любой долгосрочной резервной копии хранения на любом сервере базы данных SQL.

> [!IMPORTANT]
> Невозможно перезаписать существующую базу данных во время восстановления.

Если вы используете уровни служб "Стандартный" или "Премиум", восстановление базы данных может привести к дополнительным затратам на хранение. Дополнительные затраты создаются, если максимальный размер восстанавливаемой базы данных превышает объем хранилища, включенный в уровень служб и производительности целевой базы данных. Сведения о ценах на дополнительное хранилище см. на [странице цен на Базу данных SQL](https://azure.microsoft.com/pricing/details/sql-database/). Если фактический объем используемого пространства меньше, чем Включенный объем хранилища, можно избежать этой дополнительной платы, установив максимальный размер базы данных в включенном объеме.

> [!NOTE]
> При создании [копии базы данных](sql-database-copy.md)используются [автоматические резервные копии базы данных](sql-database-automated-backups.md).

## <a name="recovery-time"></a>Время восстановления

Время восстановления базы данных с помощью автоматически создаваемых резервных копий зависит от ряда факторов.

- Размер базы данных.
- Размер вычислений базы данных.
- Количество задействованных журналов транзакций.
- Объем действий, которые необходимо воспроизвести для восстановления до точки восстановления.
- Пропускная способность сети, если восстановление происходит в другой регион.
- количество одновременных запросов на восстановление, обрабатываемых в целевом регионе.

Для большой или очень активной базы данных восстановление может занять несколько часов. Если в регионе есть длительный сбой, возможно, существует большое количество запросов на геовосстановление, обрабатываемых другими регионами. При наличии большого числа запросов время восстановления может увеличиваться для баз данных в этом регионе. В большинстве случаев на восстановление базы данных требуется менее 12 часов.

Для одной подписки существуют ограничения на количество одновременных запросов на восстановление.  Эти ограничения применяются к любому сочетанию восстановления на момент времени, георепликации и восстановления из резервной копии долгосрочного хранения.

| | **Максимальное количество одновременно обрабатываемых запросов** | **Максимальное количество одновременно отправляемых запросов** |
| :--- | --: | --: |
|Отдельная база данных (на подписку)|10|60|
|Эластичный пул (на пул)|4|200|
||||

Нет встроенного метода для восстановления всего сервера. Пример выполнения этой задачи см. в разделе База данных SQL [Azure: Полное восстановление сервера @ no__t-0.

> [!IMPORTANT]
> Для восстановления с помощью автоматически создаваемых резервных копий необходимо быть членом роли участника SQL Server в подписке или владельцем подписки. Дополнительные сведения см. в статье [Встроенные роли для управления доступом на основе ролей в Azure](../role-based-access-control/built-in-roles.md). Восстановление можно выполнить с помощью портал Azure, PowerShell или REST API. Нельзя использовать Transact-SQL.

## <a name="point-in-time-restore"></a>Восстановление до точки во времени

Вы можете восстановить изолированную базу данных, которая находится в пуле или экземпляре, до более ранней точки во времени с помощью портал Azure, [PowerShell](https://docs.microsoft.com/powershell/module/az.sql/restore-azsqldatabase)или [REST API](https://docs.microsoft.com/rest/api/sql/databases). Запрос может указывать любой уровень служб или размер вычислений для восстанавливаемой базы данных. Убедитесь в наличии достаточного количества ресурсов на сервере, на котором выполняется восстановление базы данных. По завершении инструкция RESTORE создает новую базу данных на том же сервере, что и исходная база данных. В восстановленной базе данных оплаты начисляются по нормальным тарифам, исходя из уровня служб и размера вычислений. Плата не взимается, пока восстановление базы данных не будет завершено.

Обычно база данных восстанавливается до более ранней точки во времени. Восстановленную базу данных можно считать заменой исходной базы данных или использовать ее в качестве источника данных для обновления исходной базы данных.

- **Замена базы данных**

  Если восстанавливаемая база данных планируется заменить исходной базой данных, следует указать размер вычислений и уровень служб исходной базы данных. Затем можно переименовать исходную базу данных и присвоить восстановленной базе данных исходное имя с помощью команды [ALTER DATABASE](/sql/t-sql/statements/alter-database-azure-sql-database) в T-SQL.

- **Восстановление данных**

  Если планируется получение данных из восстановленной базы данных для восстановления после ошибки пользователя или приложения, необходимо написать и выполнить сценарий восстановления данных, который извлекает данные из восстановленной базы данных и применяется к исходной базе данных. Несмотря на то, что операция восстановления может занять много времени, восстанавливаемая база данных будет отображаться в списке баз данных на протяжении всего процесса. Если удалить базу данных во время восстановления, операция восстановления будет отменена, и не будет взиматься дополнительная стоимость базы данных, которая не выполнила восстановление.
  
### <a name="point-in-time-restore-by-using-azure-portal"></a>Восстановление до точки во времени с помощью портал Azure

Вы можете восстановить отдельную базу данных SQL или базу данных экземпляра до точки во времени из колонки обзора базы данных, которую необходимо восстановить в портал Azure.

#### <a name="single-azure-sql-database"></a>Отдельная база данных SQL Azure

Чтобы восстановить отдельную базу данных или в составе пула на момент времени с помощью портал Azure, откройте страницу Обзор базы данных и выберите **восстановить** на панели инструментов. Выберите источник резервного копирования и выберите точку резервного копирования на момент времени, из которой будет создана новая база данных. 

  ![Снимок экрана параметров восстановления базы данных](./media/sql-database-recovery-using-backups/pitr-backup-sql-database-annotated.png)

#### <a name="managed-instance-database"></a>База данных управляемого экземпляра

Чтобы восстановить базу данных управляемого экземпляра до точки во времени с помощью портал Azure, откройте страницу Обзор базы данных и выберите **восстановить** на панели инструментов. Выберите точку резервного копирования на момент времени, из которой будет создана новая база данных. 

  ![Снимок экрана параметров восстановления базы данных](./media/sql-database-recovery-using-backups/pitr-backup-managed-instance-annotated.png)

> [!TIP]
> Сведения о программном восстановлении базы данных из резервной копии см. в разделе [программное выполнение восстановления с помощью автоматических резервных копий](sql-database-recovery-using-backups.md)

## <a name="deleted-database-restore"></a>Восстановление удаленной базы данных

Можно восстановить удаленную базу данных до времени удаления или более ранней точки во времени на том же сервере базы данных SQL или в том же управляемом экземпляре. Это можно сделать с помощью портал Azure, [PowerShell](https://docs.microsoft.com/powershell/module/az.sql/restore-azsqldatabase)или [остальных (CreateMode = Restore)](https://docs.microsoft.com/rest/api/sql/databases/createorupdate). Чтобы восстановить удаленную базу данных, создайте новую базу данных из резервной копии.

> [!IMPORTANT]
> При удалении сервера базы данных SQL Azure или управляемого экземпляра все его базы данных также удаляются и не могут быть восстановлены. Нельзя восстановить удаленный сервер или управляемый экземпляр.

### <a name="deleted-database-restore-by-using-the-azure-portal"></a>Восстановление базы данных удалено с помощью портал Azure

Удаленные базы данных восстанавливаются из портал Azure из ресурса сервера и экземпляра.

#### <a name="single-azure-sql-database"></a>Отдельная база данных SQL Azure

Чтобы восстановить одну или только что удаленную базу данных с помощью портал Azure, откройте страницу Обзор сервера и выберите **Удаленные базы данных**. Выберите удаленную базу данных, которую требуется восстановить, и введите имя новой базы данных, которая будет создана с помощью данных, восстановленных из резервной копии.

  ![Снимок экрана параметров удаленных баз данных](./media/sql-database-recovery-using-backups/restore-deleted-sql-database-annotated.png)

#### <a name="managed-instance-database"></a>База данных управляемого экземпляра

Нельзя использовать портал Azure для восстановления удаленной базы данных на управляемом экземпляре. Для этой цели можно использовать PowerShell. 

### <a name="deleted-database-restore-by-using-powershell"></a>Восстановление базы данных удалено с помощью PowerShell

Используйте приведенные ниже примеры сценариев для восстановления удаленной базы данных для базы данных SQL Azure и управляемого экземпляра с помощью PowerShell.

#### <a name="single-azure-sql-database"></a>Отдельная база данных SQL Azure

Пример сценария PowerShell, показывающий, как восстановить удаленную базу данных SQL Azure, см. в статье [Восстановление базы данных SQL с помощью PowerShell](scripts/sql-database-restore-database-powershell.md).

#### <a name="managed-instance-database"></a>База данных управляемого экземпляра

Пример сценария PowerShell, демонстрирующий восстановление удаленной базы данных экземпляра, см. в разделе [Восстановление удаленной базы данных на управляемом экземпляре с помощью PowerShell](https://blogs.msdn.microsoft.com/sqlserverstorageengine/20../../recreate-dropped-database-on-azure-sql-managed-instance). 

> [!TIP]
> Сведения о программном восстановлении удаленной базы данных см. в разделе [программное выполнение восстановления с помощью автоматических резервных копий](sql-database-recovery-using-backups.md).

## <a name="geo-restore"></a>Геовосстановление

Вы можете восстановить базу данных SQL на любой сервер в любом регионе Azure из последней геореплицированной резервной копии. При геовосстановлении используется геореплицированная резервная копия в качестве источника. Вы можете запрашивать геовосстановление, даже если база данных или Datacenter недоступны из-за сбоя.

Геовосстановление является параметром восстановления по умолчанию, если база данных недоступна из-за инцидента в регионе размещения. Базу данных можно восстановить на сервере в любом другом регионе. Между созданием резервной копии и ее георепликацией в большой двоичный объект Azure в другом регионе существует задержка. В результате восстановленная база данных может иметь один час за исходной базой данных. На следующем рисунке показана восстановление базы данных из последней доступной резервной копии в другом регионе.

![Рисунок географического восстановления](./media/sql-database-geo-restore/geo-restore-2.png)

### <a name="geo-restore-by-using-the-azure-portal"></a>Геовосстановление с помощью портал Azure

На портал Azure создайте новую базу данных с одним или управляемым экземпляром и выберите доступную резервную копию геовосстановления. Созданная база данных содержит данные географической резервной копии.

#### <a name="single-azure-sql-database"></a>Отдельная база данных SQL Azure

Чтобы выполнить геовосстановление отдельной базы данных SQL из портал Azure в выбранном регионе и сервере, выполните следующие действия.

1. На **панели мониторинга**выберите **Добавить** > **создать базу данных SQL**. На вкладке **основные** сведения введите необходимые данные.
2. Выберите **Дополнительные параметры**.
3. Для **использования существующих данных**выберите **резервное копирование**.
4. В поле **резервное копирование**выберите резервную копию из списка доступных резервных копий геовосстановления.

    ![Снимок экрана: Создание параметров базы данных SQL](./media/sql-database-recovery-using-backups/geo-restore-azure-sql-database-list-annotated.png)

Завершите процесс создания новой базы данных. При создании отдельной базы данных SQL Azure она содержит восстановленную резервную копию геовосстановления.

#### <a name="managed-instance-database"></a>База данных управляемого экземпляра

Для геовосстановления базы данных управляемого экземпляра из портал Azure в существующий управляемый экземпляр в выбранном регионе выберите управляемый экземпляр, на котором нужно восстановить базу данных. Выполните следующие действия.

1. Выберите **создать базу данных**.
2. Введите имя нужной базы данных.
3. В разделе **использовать существующие данные**выберите **резервное копирование**.
4. Выберите резервную копию из списка доступных резервных копий геовосстановления.

    ![Снимок экрана: параметры новой базы данных](./media/sql-database-recovery-using-backups/geo-restore-sql-managed-instance-list-annotated.png)

Завершите процесс создания новой базы данных. При создании базы данных экземпляра она содержит восстановленную резервную копию геовосстановления.

### <a name="geo-restore-by-using-powershell"></a>Геовосстановление с помощью PowerShell

#### <a name="single-azure-sql-database"></a>Отдельная база данных SQL Azure

Сценарий PowerShell, демонстрирующий выполнение геовосстановления для отдельной базы данных SQL, см. в статье [восстановление отдельной базы данных SQL Azure до более ранней точки во времени с помощью PowerShell](scripts/sql-database-restore-database-powershell.md).

#### <a name="managed-instance-database"></a>База данных управляемого экземпляра

Сценарий PowerShell, который показывает, как выполнить геовосстановление для базы данных управляемого экземпляра, см. в статье [Использование PowerShell для восстановления базы данных управляемого экземпляра в другой географическую область](scripts/sql-managed-instance-restore-geo-backup.md).

### <a name="geo-restore-considerations"></a>Рекомендации относительно географического восстановления

Невозможно выполнить восстановление на момент времени в базе данных-получателе с георепликацией. Это можно сделать только в базе данных-источнике. Дополнительные сведения об использовании геовосстановления для восстановления после сбоя см. в статье [Восстановление базы данных SQL Azure или переход на базу данных-получатель при отказе](sql-database-disaster-recovery.md).

> [!IMPORTANT]
> Геовосстановление — это базовое решение для аварийного восстановления, доступное в базе данных SQL. Он использует автоматически созданные геореплицированные резервные копии с целевой точкой восстановления (RPO), равным 1 часу, и оценочным временем восстановления до 12 часов. Это не гарантирует, что целевой регион будет иметь емкость для восстановления баз данных после регионального сбоя, так как, скорее всего, будет резко возрастать потребность. Если приложение использует относительно небольшие базы данных и не является критически важным для бизнеса, геовосстановление является подходящим решением для аварийного восстановления. Для критически важных для бизнеса приложений, которые используют большие базы данных и должны обеспечивать непрерывность бизнес-процессов, следует использовать [группы автоматической отработки отказа](sql-database-auto-failover-group.md). Она предлагает более низкие целевые значения RPO и времени восстановления, и емкость всегда гарантирована. Дополнительные сведения о непрерывности бизнес-процессов см. в [обзоре обеспечения непрерывности бизнес-процессов](sql-database-business-continuity.md).

## <a name="programmatically-performing-recovery-by-using-automated-backups"></a>Программное выполнение восстановления с помощью автоматически создаваемых резервных копий

Для восстановления можно также использовать Azure PowerShell или REST API. В приведенных ниже таблицах описан доступный для этого набор команд.

### <a name="powershell"></a>PowerShell

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]
> [!IMPORTANT]
> Модуль PowerShell Azure Resource Manager по-прежнему поддерживается базой данных SQL Azure, но вся будущая разработка предназначена для модуля AZ. SQL. Эти командлеты см. в разделе [AzureRM. SQL](https://docs.microsoft.com/powershell/module/AzureRM.Sql/). Аргументы для команд в модуле AZ и в модулях AzureRm находятся в отличном экстенте.

#### <a name="single-azure-sql-database"></a>Отдельная база данных SQL Azure

Сведения о восстановлении изолированной базы данных или в составе пула см. в разделе [RESTORE-азсклдатабасе](/powershell/module/az.sql/restore-azsqldatabase).

  | Командлет | Описание |
  | --- | --- |
  | [Get-AzSqlDatabase](/powershell/module/az.sql/get-azsqldatabase) |Получает одну или несколько баз данных. |
  | [Get-AzSqlDeletedDatabaseBackup](/powershell/module/az.sql/get-azsqldeleteddatabasebackup) | Получает удаленную базу данных, которую можно восстановить. |
  | [Get-AzSqlDatabaseGeoBackup](/powershell/module/az.sql/get-azsqldatabasegeobackup) |Получает геоизбыточную резервную копию базы данных. |
  | [Restore-AzSqlDatabase](/powershell/module/az.sql/restore-azsqldatabase) |Восстанавливает базу данных SQL. |

  > [!TIP]
  > Пример сценария PowerShell, который показывает, как выполнить восстановление базы данных на момент времени, см. в разделе [Восстановление базы данных SQL с помощью PowerShell](scripts/sql-database-restore-database-powershell.md).

#### <a name="managed-instance-database"></a>База данных управляемого экземпляра

Сведения о восстановлении базы данных управляемого экземпляра см. в разделе [RESTORE-азсклинстанцедатабасе](/powershell/module/az.sql/restore-azsqlinstancedatabase).

  | Командлет | Описание |
  | --- | --- |
  | [Get-AzSqlInstance](/powershell/module/az.sql/get-azsqlinstance) |Возвращает один или несколько управляемых экземпляров. |
  | [Get-Азсклинстанцедатабасе](/powershell/module/az.sql/get-azsqlinstancedatabase) | Возвращает базу данных экземпляра. |
  | [Restore-AzSqlInstanceDatabase](/powershell/module/az.sql/restore-azsqlinstancedatabase) |Восстанавливает базу данных экземпляра. |

### <a name="rest-api"></a>REST API

Для восстановления отдельной базы данных или в составе пула с помощью REST API:

| API | Описание |
| --- | --- |
| [REST (createMode=Recovery)](https://docs.microsoft.com/rest/api/sql/databases) |Восстанавливает базу данных. |
| [Получение, создание или обновление состояния базы данных](https://docs.microsoft.com/rest/api/sql/operations) |Возвращает состояние во время операции восстановления. |

### <a name="azure-cli"></a>Azure CLI

#### <a name="single-azure-sql-database"></a>Отдельная база данных SQL Azure

Инструкции по восстановлению отдельной базы данных или в составе пула с помощью Azure CLI см. в разделе [AZ SQL DB Restore](/cli/azure/sql/db#az-sql-db-restore).

#### <a name="managed-instance-database"></a>База данных управляемого экземпляра

Инструкции по восстановлению базы данных управляемого экземпляра с помощью Azure CLI см. в разделе [AZ SQL функция MidB Restore](/cli/azure/sql/midb#az-sql-midb-restore).

## <a name="summary"></a>Сводка

Создаваемые автоматически резервные копии позволяют защитить базы данных от ошибок пользователей и приложений, случайного удаления базы данных и длительных простоев. Эта встроенная возможность доступна для всех уровней служб и объемов вычислительных ресурсов.

## <a name="next-steps"></a>Следующие шаги

- [Общие сведения о непрерывности бизнес-процессов](sql-database-business-continuity.md)
- [Общие сведения об автоматическом резервном копировании базы данных SQL](sql-database-automated-backups.md)
- [Длительное хранение](sql-database-long-term-retention.md)
- Чтобы узнать о более быстрых вариантах восстановления, ознакомьтесь со сведениями об [активной георепликации](sql-database-active-geo-replication.md) и [группах автоматической отработки отказа](sql-database-auto-failover-group.md).
