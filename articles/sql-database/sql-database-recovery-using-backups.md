---
title: Восстановление базы данных из резервного копирования
description: Узнайте о восстановлении времени, которое позволяет откатить базу данных Azure s-L до 35 дней.
services: sql-database
ms.service: sql-database
ms.subservice: backup-restore
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: anosov1960
ms.author: sashan
ms.reviewer: mathoma, carlrab, danil
ms.date: 09/26/2019
ms.openlocfilehash: b98331a9cdb359aeefac5db1546f3a15b54010ba
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79268747"
---
# <a name="recover-an-azure-sql-database-by-using-automated-database-backups"></a>Восстановление базы данных Azure S'L с помощью автоматизированного резервного копирования базы данных

По умолчанию резервные копии базы данных Azure S'L хранятся в геореплицируемом хранилище капли (тип хранения RA-GRS). Следующие варианты доступны для восстановления базы данных с помощью [автоматизированного резервного копирования базы данных.](sql-database-automated-backups.md) Вы можете:

- Создайте новую базу данных на том же сервере базы данных S'L, восстановленную к указанному моменту времени в течение периода удержания.
- Создайте базу данных на том же сервере базы данных S'L, восстановленную к времени удаления для удаленной базы данных.
- Создайте новую базу данных на любом сервере базы данных S'L в том же регионе, восстановленном в точке последних резервных копирований.
- Создайте новую базу данных на любом сервере базы данных s'L в любом другом регионе, восстановленном до точки последних реплицированных резервных копирований.

Если вы настроили [резервное копирование долгосрочного удержания,](sql-database-long-term-retention.md)вы также можете создать новую базу данных из любого долгосрочного резервного копирования на любом сервере базы данных S'L.

> [!IMPORTANT]
> Во время восстановления нельзя перезаписать существующую базу данных.

При использовании уровней обслуживания Standard или Premium восстановление базы данных может повлечь за собой дополнительные расходы на хранение. Дополнительные затраты появляются в том случае, если максимальный размер восстановленной базы данных превышает объем хранилища, включенный в уровень обслуживания и производительность целевой базы данных. Сведения о ценах на дополнительное хранилище см. на [странице цен на Базу данных SQL](https://azure.microsoft.com/pricing/details/sql-database/). Если фактическое количество используемого пространства меньше, чем объем включенного хранилища, можно избежать этих дополнительных затрат, установив максимальный размер базы данных на включенную сумму.

## <a name="recovery-time"></a>Время восстановления

Время восстановления базы данных с помощью автоматизированного резервного копирования базы данных зависит от нескольких факторов:

- Размер базы данных.
- Размер вычисления базы данных.
- Количество вовлеченных журналов транзакций.
- Объем действия, который необходимо переиграть, чтобы восстановить точку восстановления.
- Пропускная способность сети, если восстановление находится в другом регионе.
- количество одновременных запросов на восстановление, обрабатываемых в целевом регионе.

Для большой или очень активной базы данных восстановление может занять несколько часов. При длительном отключении в регионе не исключено, что для аварийного восстановления будет инициировано большое количество запросов на геовосстановление. При наличии большого количества запросов время восстановления отдельных баз данных может увеличиться. В большинстве случаев на восстановление базы данных требуется менее 12 часов.

Для одной подписки существуют ограничения на количество одновременных запросов на восстановление. Эти ограничения применяются к любой комбинации точечных восстановлений, геовосстановления и восстановления из долгосрочного резервного копирования.

| | **Максимальное количество одновременно обрабатываемых запросов** | **Максимальное количество одновременно отправляемых запросов** |
| :--- | --: | --: |
|Отдельная база данных (на подписку)|10|60|
|Эластичный пул (на пул)|4|200|
||||

Для восстановления всего сервера нет встроенного метода. Например, как выполнить эту [Azure SQL Database: Full Server Recovery](https://gallery.technet.microsoft.com/Azure-SQL-Database-Full-82941666)задачу, см.

> [!IMPORTANT]
> Чтобы восстановиться с помощью автоматизированного резервного копирования, необходимо быть участником роли участника программы s'L Server или быть владельцем подписки. Для получения дополнительной [RBAC: Built-in roles](../role-based-access-control/built-in-roles.md)информации см. Восстановить можно с помощью портала Azure, PowerShell или API REST. Вы не можете использовать Transact-S'L.

## <a name="point-in-time-restore"></a>Восстановление на момент времени

Восстановить автономную, объединенную или экземплярную базу данных на более ранний момент времени с помощью портала Azure, [PowerShell](https://docs.microsoft.com/powershell/module/az.sql/restore-azsqldatabase)или [API REST.](https://docs.microsoft.com/rest/api/sql/databases) Запрос может указывать любой уровень обслуживания или размер вычисления для восстановленной базы данных. Убедитесь, что у вас достаточно ресурсов на сервере, на котором вы восстанавливаете базу данных. После завершения восстановления на том же сервере, что и исходная база данных, создается новая база данных. Восстановленная база данных заряжается по обычной ставке, в зависимости от ее уровня обслуживания и размера вычислений. Вы не несете плату до тех пор, пока восстановление базы данных не будет завершено.

Обычно база данных восстанавливается до более ранней точки во времени. Восстановленную базу данных можно рассматривать как замену исходной базы данных или использовать ее в качестве источника данных для обновления исходной базы данных.

- **Замена базы данных**

  Если восстановленная база данных должна быть заменой исходной базы данных, следует указать размер и уровень обслуживания исходной базы данных. Затем можно переименовать исходную базу данных и дать восстановленной базе данных исходное имя, используя команду [ALTER DATABASE](/sql/t-sql/statements/alter-database-azure-sql-database) в T-S'L.

- **Восстановление данных**

  Если вы планируете получить данные из восстановленной базы данных для восстановления после ошибки пользователя или приложения, необходимо написать и выполнить скрипт восстановления данных, который извлекает данные из восстановленной базы данных и применяется к исходной базе данных. Несмотря на то, что операция восстановления может занять много времени, восстанавливаемая база данных будет отображаться в списке баз данных на протяжении всего процесса. Если вы удалите базу данных во время восстановления, операция восстановления будет отменена, и вы не будете платить за базу данных, которая не завершила восстановление.
  
### <a name="point-in-time-restore-by-using-azure-portal"></a>Восстановление момента с помощью портала Azure

Можно восстановить единую базу данных или базу данных экземпляров в точку времени из поляка обзора базы данных, который вы хотите восстановить на портале Azure.

#### <a name="single-azure-sql-database"></a>Единая база данных Azure S'L

Чтобы восстановить единую или объединенную базу данных в точку времени с помощью портала Azure, откройте страницу обзора базы данных и выберите **Восстановление** на панели инструментов. Выберите источник резервного копирования и выберите точку резервного копирования, из которой будет создана новая база данных. 

  ![Скриншот вариантов восстановления базы данных](./media/sql-database-recovery-using-backups/pitr-backup-sql-database-annotated.png)

#### <a name="managed-instance-database"></a>База данных управляемых экземпляров

Чтобы восстановить базу данных управляемых экземпляров в точку времени с помощью портала Azure, откройте страницу обзора базы данных и выберите **Восстановление** на панели инструментов. Выберите точку резервного копирования, из которой будет создана новая база данных. 

  ![Скриншот вариантов восстановления базы данных](./media/sql-database-recovery-using-backups/pitr-backup-managed-instance-annotated.png)

> [!TIP]
> Для программного восстановления базы данных из резервного копирования см. [Программно выполняя восстановление с помощью автоматизированных резервных ups.](sql-database-recovery-using-backups.md)

## <a name="deleted-database-restore"></a>Восстановление удаленной базы данных

Можно восстановить удаленную базу данных в время удаления или на более ранней точке времени, на том же сервере базы данных S'L или в том же управляемом экземпляре. Вы можете сделать это через портал Azure, [PowerShell](https://docs.microsoft.com/powershell/module/az.sql/restore-azsqldatabase), или [REST (createMode -Восстановление)](https://docs.microsoft.com/rest/api/sql/databases/createorupdate). Вы восстанавливаете удаленную базу данных, создавая новую базу данных из резервного копирования.

> [!IMPORTANT]
> При удалении сервера базы данных Azure s-L или управляемого экземпляра все его базы данных также удаляются и не могут быть восстановлены. Нельзя восстановить удаленный сервер или управляемый экземпляр.

### <a name="deleted-database-restore-by-using-the-azure-portal"></a>Удаленная база данных восстанавливается с помощью портала Azure

Вы восстанавливаете удаленные базы данных с портала Azure с сервера и ресурса экземпляров.

#### <a name="single-azure-sql-database"></a>Единая база данных Azure S'L

Чтобы восстановить единую или объединенную удаленную базу данных во время удаления с помощью портала Azure, откройте страницу обзора сервера и выберите **удаленные базы данных.** Выберите удаленную базу данных, которую необходимо восстановить, и введите имя для новой базы данных, которая будет создана с данными, восстановленными из резервного копирования.

  ![Скриншот восстановленной удаленной базы данных Azure S'L](./media/sql-database-recovery-using-backups/restore-deleted-sql-database-annotated.png)

#### <a name="managed-instance-database"></a>База данных управляемых экземпляров

Чтобы восстановить управляемую базу данных с помощью портала Azure, откройте страницу обзора управляемого экземпляра и выберите **удаленные базы данных.** Выберите удаленную базу данных, которую необходимо восстановить, и введите имя для новой базы данных, которая будет создана с данными, восстановленными из резервного копирования.

  ![Скриншот восстановленной удаленной базы данных экземпляров Azure S'L](./media/sql-database-recovery-using-backups/restore-deleted-sql-managed-instance-annotated.png)

### <a name="deleted-database-restore-by-using-powershell"></a>Удаленная база данных восстанавливается с помощью PowerShell

Используйте следующие примеры скриптов для восстановления удаленной базы данных для базы данных Azure S'L и управляемого экземпляра с помощью PowerShell.

#### <a name="single-azure-sql-database"></a>Единая база данных Azure S'L

Для примера сценария PowerShell, показывающего, как восстановить удаленную базу данных Azure S'L, [см.](scripts/sql-database-restore-database-powershell.md)

#### <a name="managed-instance-database"></a>База данных управляемых экземпляров

Для примера сценария PowerShell, показывающего, как восстановить удаленную базу данных экземпляров, [см. Восстановление удаленной базы данных на управляемом экземпляре с помощью PowerShell](sql-database-managed-instance-point-in-time-restore.md#restore-a-deleted-database)

> [!TIP]
> Для программного восстановления удаленной [Programmatically performing recovery using automated backups](sql-database-recovery-using-backups.md)базы данных см.

## <a name="geo-restore"></a>геовосстановлением;

Вы можете восстановить базу данных SQL на любой сервер в любом регионе Azure из последней геореплицированной резервной копии. Геовосстановление использует гео-реплицированную резервную часть в качестве источника. Вы можете запросить геовосстановление, даже если база данных или центр обработки данных недоступны из-за простоя.

Геовосстановление — это параметр восстановления по умолчанию, когда база данных недоступна из-за инцидента в регионе хостинга. Базу данных можно восстановить на сервере в любом другом регионе. Между созданием резервной копии и ее георепликацией в большой двоичный объект Azure в другом регионе существует задержка. В результате восстановленная база данных может отставать от исходной базы данных на один час. На следующей иллюстрации показана восстановленная база данных из последнего доступного резервного копирования в другом регионе.

![Графика геовосстановления](./media/sql-database-geo-restore/geo-restore-2.png)

### <a name="geo-restore-by-using-the-azure-portal"></a>Геовосстановление с помощью портала Azure

С портала Azure вы создаете новую единую или управляемую базу данных экземпляров и выбираете доступную резервную базу геовосстановления. Недавно созданная база данных содержит геовосстановленные данные резервного копирования.

#### <a name="single-azure-sql-database"></a>Единая база данных Azure S'L

Для геовосстановления единой базы данных S'L с портала Azure в регионе и сервера по вашему выбору выполните следующие действия:

1. Из **панели мониторинга**выберите **Добавить** > **Создать базу данных S'L**. На вкладке **"Основы"** введите необходимую информацию.
2. выберите **Дополнительные параметры**;
3. Для **использования существующих данных**выберите **резервное копирование.**
4. Для **резервного копирования**выберите резервную приготовительный лист из списка доступных геовосстановления резервных upups.

    ![Скриншот вариантов создания базы данных S'L](./media/sql-database-recovery-using-backups/geo-restore-azure-sql-database-list-annotated.png)

Завершите процесс создания новой базы данных из резервного копирования. При создании единой базы данных Azure S'L она содержит восстановленное резервное копирование геовосстановления.

#### <a name="managed-instance-database"></a>База данных управляемых экземпляров

Чтобы геовосстановить базу данных управляемых экземпляров с портала Azure в существующий управляемый экземпляр в выбранном регионе, выберите управляемый экземпляр, на котором требуется восстановление базы данных. Выполните следующие действия.

1. Выберите **новую базу данных**.
2. Введите желаемое имя базы данных.
3. При **использовании существующих данных**выберите **резервное копирование.**
4. Выберите резервную пристанииз из списка доступных геовосстановления резервных данных.

    ![Скриншот новых вариантов базы данных](./media/sql-database-recovery-using-backups/geo-restore-sql-managed-instance-list-annotated.png)

Завершите процесс создания новой базы данных. При создании базы данных экземпляров она содержит восстановленное резервное копирование геовосстановления.

### <a name="geo-restore-by-using-powershell"></a>Геовосстановление с помощью PowerShell

#### <a name="single-azure-sql-database"></a>Единая база данных Azure S'L

Для скрипта PowerShell, который показывает, как выполнять геовосстановление для одной базы данных S'L, [см.](scripts/sql-database-restore-database-powershell.md)

#### <a name="managed-instance-database"></a>База данных управляемых экземпляров

Для скрипта PowerShell, который показывает, как выполнять геовосстановление для управляемой базы данных экземпляров, [см. Использование PowerShell для восстановления базы данных управляемых экземпляров в другой георегион.](scripts/sql-managed-instance-restore-geo-backup.md)

### <a name="geo-restore-considerations"></a>Соображения геовосстановления

Вы не можете выполнить временную восстановление в гео-вторичной базе данных. Это можно сделать только в основной базе данных. Дополнительные сведения об использовании геовосстановления для восстановления после сбоя см. в статье [Восстановление базы данных SQL Azure или переход на базу данных-получатель при отказе](sql-database-disaster-recovery.md).

> [!IMPORTANT]
> Геовосстановление — это самое основное решение для аварийного восстановления, доступное в базе данных S'L. Он опирается на автоматически созданные гео-реплицированные резервные копирования с целью точки восстановления (RPO), равными 1 часу, и расчетным временем восстановления до 12 часов. Это не гарантирует, что целевой регион будет иметь возможность восстановить базы данных после регионального простоя, потому что вероятно резкое увеличение спроса. Если приложение использует относительно небольшие базы данных и не имеет критического значение для бизнеса, геовосстановление является подходящим решением для аварийного восстановления. Для критически важных для бизнеса приложений, которые требуют больших баз данных и должны обеспечить непрерывность бизнеса, используйте [группы автоматического отказа.](sql-database-auto-failover-group.md) Он предлагает гораздо более низкую цель RPO и времени восстановления, и емкость всегда гарантирована. Дополнительные сведения о непрерывности бизнес-процессов см. в [обзоре обеспечения непрерывности бизнес-процессов](sql-database-business-continuity.md).

## <a name="programmatically-performing-recovery-by-using-automated-backups"></a>Программное выполнение восстановления с помощью автоматизированного резервного копирования

Вы также можете использовать Azure PowerShell или REST API для восстановления. В приведенных ниже таблицах описан доступный для этого набор команд.

### <a name="powershell"></a>PowerShell

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]
> [!IMPORTANT]
> Модуль PowerShell Azure Resource Manager по-прежнему поддерживается базой данных Azure S'L, но все будущие разработки предназначены для модуля Az.Sql. Для этих cmdlets, см [AzureRM.Sql](https://docs.microsoft.com/powershell/module/AzureRM.Sql/). Аргументы для команд в модулях Az и в модулях Azrm в значительной степени идентичны.

#### <a name="single-azure-sql-database"></a>Единая база данных Azure S'L

Для восстановления автономной или объединенной базы данных см. [Restore-AzSqlDatabase](/powershell/module/az.sql/restore-azsqldatabase).

  | Командлет | Описание |
  | --- | --- |
  | [Get-AzSqlDatabase](/powershell/module/az.sql/get-azsqldatabase) |Получает одну или несколько баз данных. |
  | [Get-AzSqlDeletedDatabaseBackup](/powershell/module/az.sql/get-azsqldeleteddatabasebackup) | Получает удаленную базу данных, которую можно восстановить. |
  | [Get-AzSqlDatabaseGeoBackup](/powershell/module/az.sql/get-azsqldatabasegeobackup) |Получает геоизбыточную резервную копию базы данных. |
  | [Restore-AzSqlDatabase](/powershell/module/az.sql/restore-azsqldatabase) |Восстанавливает базу данных SQL. |

  > [!TIP]
  > Для примера сценария PowerShell, который показывает, как выполнить точечное восстановление базы [данных, см.](scripts/sql-database-restore-database-powershell.md)

#### <a name="managed-instance-database"></a>База данных управляемых экземпляров

Для восстановления базы данных управляемых экземпляров см. [Restore-AzSqlInstanceDatabase.](/powershell/module/az.sql/restore-azsqlinstancedatabase)

  | Командлет | Описание |
  | --- | --- |
  | [Get-AzSqlInstance](/powershell/module/az.sql/get-azsqlinstance) |Получает один или несколько управляемых экземпляров. |
  | [Get-AzSqlInstanceDatabase](/powershell/module/az.sql/get-azsqlinstancedatabase) | Получает базу данных экземпляров. |
  | [Restore-AzSqlInstanceDatabase](/powershell/module/az.sql/restore-azsqlinstancedatabase) |Восстанавливает базу данных экземпляров. |

### <a name="rest-api"></a>REST API

Для восстановления единой или объединенной базы данных с помощью REST API:

| API | Описание |
| --- | --- |
| [REST (createMode=Recovery)](https://docs.microsoft.com/rest/api/sql/databases) |Восстанавливает базу данных. |
| [Получение, создание или обновление состояния базы данных](https://docs.microsoft.com/rest/api/sql/operations) |Возвращает состояние во время операции восстановления. |

### <a name="azure-cli"></a>Azure CLI

#### <a name="single-azure-sql-database"></a>Единая база данных Azure S'L

Для восстановления единой или объединенной базы данных [az sql db restore](/cli/azure/sql/db#az-sql-db-restore)с помощью Azure CLI см.

#### <a name="managed-instance-database"></a>База данных управляемых экземпляров

Для восстановления базы данных управляемых экземпляров [az sql midb restore](/cli/azure/sql/midb#az-sql-midb-restore)с помощью Azure CLI см.

## <a name="summary"></a>Сводка

Создаваемые автоматически резервные копии позволяют защитить базы данных от ошибок пользователей и приложений, случайного удаления базы данных и длительных простоев. Эта встроенная возможность доступна для всех уровней служб и объемов вычислительных ресурсов.

## <a name="next-steps"></a>Дальнейшие действия

- [Общие сведения о непрерывности бизнес-процессов](sql-database-business-continuity.md)
- [Общие сведения об автоматическом резервном копировании базы данных SQL](sql-database-automated-backups.md)
- [Длительное хранение](sql-database-long-term-retention.md)
- Чтобы узнать о более быстрых вариантах восстановления, ознакомьтесь со сведениями об [активной георепликации](sql-database-active-geo-replication.md) и [группах автоматической отработки отказа](sql-database-auto-failover-group.md).
