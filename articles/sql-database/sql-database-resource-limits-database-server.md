---
title: Ограничения ресурсов для сервера базы данных SQL Azure
description: Статья представляет обзор ограничения ресурсов сервера Базы данных SQL Azure для отдельных баз данных и эластичных пулов. Здесь также содержится информация о том, что происходит, когда эти ограничения ресурсов соответствуют или превышают допустимые нормы.
services: sql-database
ms.service: sql-database
ms.subservice: single-database
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: stevestein
ms.author: sstein
ms.reviewer: sashan,moslake,josack
ms.date: 04/18/2019
ms.openlocfilehash: b358e69df1df579e91a9098c120c7e6b4e3f2ead
ms.sourcegitcommit: 609d4bdb0467fd0af40e14a86eb40b9d03669ea1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/06/2019
ms.locfileid: "73687485"
---
# <a name="sql-database-resource-limits-for-azure-sql-database-server"></a>Ограничения ресурсов для сервера Базы данных SQL Azure

Статья представляет обзор ограничения ресурсов для сервера Базы данных SQL, который управляет отдельными базами данных и эластичными пулами. Здесь также содержится информация о том, что происходит, когда эти ограничения ресурсов соответствуют или превышают допустимые нормы.

> [!NOTE]
> Ограничения управляемых экземпляров см. в статье [Общие сведения об ограничениях ресурсов Управляемого экземпляра Базы данных SQL Azure](sql-database-managed-instance-resource-limits.md).

## <a name="maximum-resource-limits"></a>Максимальное ограничение ресурсов

| Ресурс | Ограничение |
| :--- | :--- |
| Баз данных на сервер | 5000 |
| Количество серверов по умолчанию на одну подписку в любом регионе | 20 |
| Максимальное количество серверов на одну подписку в любом регионе | 200 |  
| Квота DTU или eDTU на сервер | 54 000 |  
| Квота виртуальных ядер на сервер или экземпляр | 540 |
| Максимальное число пулов на сервер | ограничено числом DTU или виртуальных ядер Например, если каждый пул поддерживает 1000 DTU, тогда один сервер может поддерживать 54 пула.|
|||

> [!NOTE]
> Чтобы увеличить квоту DTU или eDTU, квоту виртуальных ядер либо число серверов по умолчанию, отправьте запрос в службу поддержки на портале Azure для подписки, выбрав тип проблемы "Квота". Квота DTU или eDTU и предельное число баз данных на сервер ограничивают количество эластичных пулов на сервер.
> [!IMPORTANT]
> По мере приближения количества баз данных к пороговому значению для сервера Базы данных SQL может произойти следующее:
> - Увеличение задержки при выполнении запросов к базе данных master.  Сюда входят представления статистических данных использования ресурсов, такие как sys.resource_stats.
> - Увеличение задержки при управлении и отображении для точек наблюдения портала, включая перечисление баз данных на сервере.

### <a name="storage-size"></a>Размер хранилища
- Для отдельных баз данных раурцес см. ограничения [ресурсов на основе DTU](sql-database-dtu-resource-limits-single-databases.md) или ограничения на [ресурсы на основе виртуальное ядро](sql-database-vcore-resource-limits-single-databases.md) для ограничения размера хранилища на ценовую категорию.

## <a name="what-happens-when-database-resource-limits-are-reached"></a>Что происходит при достижении ограничения ресурсов базы данных?

### <a name="compute-dtus-and-edtus--vcores"></a>Вычислительные ресурсы (DTU и eDTU/виртуальные ядра)

Когда использование вычислений базы данных (измеряемое DTU и Edtu или виртуальных ядер) становится высоким, задержка запросов увеличивается и может даже исключаться. В этих условиях запросы могут помещаться в очередь службой и предоставлять ресурсы для выполнения, так как ресурс становится свободным.
При интенсивном использовании вычислительных ресурсов возможны следующие варианты предотвращения последствий:

- Увеличение объема вычислительных ресурсов базы данных или эластичного пула для предоставления базе данных дополнительных вычислительных ресурсов. См. разделы [Масштабирование ресурсов отдельной базы данных](sql-database-single-database-scale.md) и [Масштабирование ресурсов эластичного пула](sql-database-elastic-pool-scale.md).
- Оптимизация запросов для уменьшения использования ресурсов каждым запросом. Дополнительные сведения см. в разделе [Настройка запросов и указания на них](sql-database-performance-guidance.md#query-tuning-and-hinting).

### <a name="storage"></a>Хранилище

Когда используемое пространство базы данных достигает максимального размера, операции вставки и обновления, увеличивающие размер данных, завершаются сбоем и клиенты получают [сообщение об ошибке](sql-database-develop-error-messages.md). Операции SELECT и DELETE с базой данных продолжают успешно выполняться.

При интенсивном использовании пространства возможны следующие варианты предотвращения последствий:

- Увеличение максимального размера базы данных или эластичного пула или увеличение объема хранилища. См. разделы [Масштабирование ресурсов отдельной базы данных](sql-database-single-database-scale.md) и [Масштабирование ресурсов эластичного пула](sql-database-elastic-pool-scale.md).
- Если база данных находится в эластичном пуле, то в качестве альтернативы ее можно переместить за пределы пула, чтобы ее дисковое пространство не использовалось совместно с другими базами данных.
- Сжатие базы данных для освобождения неиспользуемого пространства. Дополнительные сведения см. в статье об [управлении файловым пространством в Базе данных SQL Azure](sql-database-file-space-management.md).

### <a name="sessions-and-workers-requests"></a>Сеансы и рабочие роли (запросы)

Максимальное количество сеансов и рабочих ролей определяется уровнем служб и объемом вычислительных ресурсов (DTU и eDTU). При достижении ограничения числа сеансов или рабочих ролей новые запросы отклоняются, а клиенты получают сообщение об ошибке. Хотя приложение может управлять числом доступных подключений, число параллельных рабочих ролей зачастую существенно труднее оценивать и контролировать. Это особенно сильно проявляется в периоды пиковой нагрузки, когда достигаются ограничения ресурсов базы данных и рабочие роли накапливаются из-за увеличенной длительности выполнения запросов.

При интенсивном использовании сеансов и рабочих ролей возможны следующие варианты предотвращения последствий:

- Повышение уровня служб или объема вычислительных ресурсов базы данных или эластичного пула. См. разделы [Масштабирование ресурсов отдельной базы данных](sql-database-single-database-scale.md) и [Масштабирование ресурсов эластичного пула](sql-database-elastic-pool-scale.md).
- Оптимизация запросов для сокращения использования ресурсов, необходимых каждому запросу, если причиной повышенного использования рабочих ролей является состязание за вычислительные ресурсы. Дополнительные сведения см. в разделе [Настройка запросов и указания на них](sql-database-performance-guidance.md#query-tuning-and-hinting).

## <a name="transaction-log-rate-governance"></a>Управление частотой ведения журнала транзакций 
Управление скоростью журнала транзакций — это процесс в базе данных SQL Azure, который используется для ограничения высоких скоростей приема рабочих нагрузок, таких как массовая вставка, выбор в и построение индекса. Эти ограничения отправляются и применяются на уровне за секунду к частоте создания записей журнала, ограничивая пропускную способность независимо от того, сколько IOs может быть выдано для файлов данных.  Скорость создания журнала транзакций в настоящее время масштабируется линейно до точки, зависящей от оборудования, с максимальной частотой ведения журнала 96 МБ/с в модели приобретения Виртуальное ядро. 

> [!NOTE]
> Фактическая физическая операция ввода/вывода с файлами журнала транзакций не регулируется или ограничена. 

Скорость ведения журнала задается таким, что их можно достигать и поддерживать в различных сценариях, в то время как вся система может поддерживать свои функции с минимальным влиянием на нагрузку пользователей. Управление частотой ведения журнала гарантирует, что резервные копии журналов транзакций остаются в рамках опубликованных соглашений об уровне обслуживания для восстановления.  Эта система управления также предотвращает чрезмерную невыполненную работу на вторичных репликах.

По мере создания записей журнала каждая операция оценивается и оценивается на необходимость задержки, чтобы поддерживать максимальную требуемую скорость ведения журнала (МБ/с в секунду). Задержки не добавляются, когда записи журнала записываются в хранилище, а в процессе создания частоты журнала применяется управление скоростью журнала.

Фактические частоты создания журналов, накладываемые во время выполнения, могут также повлиять на механизмы обратной связи, временно сокращая допустимые скорости ведения журнала, чтобы система могла стабилизировать работу системы. Управление местом в файле журнала, что позволяет избежать появления пространства журнала, а механизмы репликации группы доступности временно снижают общие системные ограничения. 

Формирование трафика регулятора скорости ведения журнала осуществляется через следующие типы ожидания (представленные в динамическом административном [представлении sys. DM _db_wait_stats](https://docs.microsoft.com/sql/relational-databases/system-dynamic-management-views/sys-dm-db-wait-stats-azure-sql-database) ):

| Тип ожидания | Примечания |
| :--- | :--- |
| LOG_RATE_GOVERNOR | Ограничение базы данных |
| POOL_LOG_RATE_GOVERNOR | Ограничение пула |
| INSTANCE_LOG_RATE_GOVERNOR | Ограничение уровня экземпляра |  
| HADR_THROTTLE_LOG_RATE_SEND_RECV_QUEUE_SIZE | Элемент управления обратной связи, физическая репликация группы доступности в категории "Премиум/критически важный для бизнеса" не содержаться |  
| HADR_THROTTLE_LOG_RATE_LOG_SIZE | Элемент управления обратной связи, ограничивающий тариф, чтобы избежать возникновения нехватки пространства журнала |
|||

При возникновении ограничения скорости ведения журнала, которое ограничивает требуемую масштабируемость, рассмотрите следующие варианты.
- Увеличьте масштаб до более крупного уровня, чтобы получить максимальную частоту записи в журнал 96 МБ/с. 
- Если загружаемые данные являются временными, т. е. промежуточные данные в процессе ETL, их можно загрузить в базу данных tempdb (с минимальным протоколированием). 
- Для аналитических сценариев загрузите в таблицу, охваченную кластеризованным индексом columnstore. Это сокращает необходимую частоту ведения журнала из-за сжатия. Этот метод увеличивает загрузку ЦП и применяется только к наборам данных, которые используют преимущества кластеризованных индексов columnstore. 

## <a name="next-steps"></a>Дальнейшие действия

- Сведения об общих ограничениях Azure см. в разделе [Подписка Azure, границы, квоты и ограничения службы](../azure-subscription-service-limits.md).
- Сведения о DTU и eDTU см. в разделе [Общие сведения об обычных единицах передачи данных (DTU) и единицах передачи данных в эластичной базе данных (eDTU)](sql-database-purchase-models.md#dtu-based-purchasing-model).
- Сведения об ограничениях на размер базы данных tempdb см. в [этом разделе](https://docs.microsoft.com/sql/relational-databases/databases/tempdb-database#tempdb-database-in-sql-database).
