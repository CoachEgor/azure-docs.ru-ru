---
title: Переход от сервера S'L к управляемому экземпляру
description: Узнайте, как перенести базу данных из экземпляра сервера S'L в базу данных Azure S-L - Управляемый экземпляр.
services: sql-database
ms.service: sql-database
ms.subservice: migration
ms.custom: seo-lt-2019
ms.devlang: ''
ms.topic: conceptual
author: bonova
ms.author: bonova
ms.reviewer: douglas, carlrab
ms.date: 07/11/2019
ms.openlocfilehash: 6bae9e871be2a5d56d057d2a077de53329b8c3ec
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79208942"
---
# <a name="sql-server-instance-migration-to-azure-sql-database-managed-instance"></a>Перенос экземпляра SQL Server в управляемый экземпляр Базы данных SQL Azure

В этой статье вы узнаете о методах переноса экземпляра SQL Server 2005 или более поздней версии в [управляемый экземпляр Базы данных SQL Azure](sql-database-managed-instance.md). Дополнительные сведения см. в разделе о [миграции в отдельную базу данных или эластичный пул](sql-database-cloud-migrate.md). Сведения о миграции из других платформ см. [здесь](https://datamigration.microsoft.com/).

> [!NOTE]
> Если вы хотите быстро начать и попробовать Управляемый экземпляр, вы можете перейти к [руководству быстрого запуска](sql-database-managed-instance-quickstart-guide.md) вместо этой страницы. 

В общем процесс переноса базы данных выглядит примерно так:

![процесс переноса](./media/sql-database-managed-instance-migration/migration-process.png)

- [Оцените совместимость управляемых экземпляров,](#assess-managed-instance-compatibility) где следует убедиться, что нет проблем блокировки, которые могут предотвратить миграцию.
  - Этот шаг также включает в себя создание [базовой производительности](#create-performance-baseline) для определения использования ресурсов на исходной инстанции Сервера S'L. Этот шаг необходим, если вы хотите развернуть управляемый экземпляр правильного размера и убедиться, что производительность после миграции не затрагивается.
- [Выберите параметры подключения приложений](sql-database-managed-instance-connect-app.md)
- [Развертывание в оптимально-размерный управляемый экземпляр,](#deploy-to-an-optimally-sized-managed-instance) где вы будете выбирать технические характеристики (количество vCores, количество памяти) и уровень производительности (Business Critical, General Purpose) вашего Управляемого instanceа.
- [Выберите метод миграции и мигрируйте,](#select-migration-method-and-migrate) где вы мигрируете с помощью автономной миграции (родное резервное копирование/восстановление, импорт/экспорт баз данных) или онлайн-миграция (Служба миграции данных, транзакционная репликация).
- [Мониторинг приложений,](#monitor-applications) чтобы убедиться, что вы ожидали производительности.

> [!NOTE]
> Сведения о переносе отдельной базы данных в базу данных или эластичный пул см. в статье [Перенос базы данных SQL Server в базу данных SQL Azure](sql-database-single-database-migrate.md).

## <a name="assess-managed-instance-compatibility"></a>Оценка совместимости управляемого экземпляра

Сначала определите, соответствует ли управляемый экземпляр требованиям базы данных вашего приложения. Вариант развертывания управляемого экземпляра предназначен для обеспечения простого переноса методом lift-and-shift для большинства имеющихся приложений, которые используют SQL Server локально или на виртуальных машинах. Однако иногда вам могут потребоваться еще не поддерживаемые функции или возможности, а затраты на реализацию обходного пути слишком высоки.

Используйте [Data Migration Assistant (DMA)](https://docs.microsoft.com/sql/dma/dma-overview) для выявления потенциальных проблем совместимости, влияющих на функциональность базы данных в службе "База данных SQL Azure". DMA еще не поддерживает управляемый экземпляр в качестве назначения миграции, однако мы рекомендуем выполнить оценку базы данных SQL Azure, внимательно просмотреть список обнаруженных проблем равенства функций и совместимости, сравнивая с документацией по продукту. Большинство блокирующих проблем, препятствующих переносу в Базу данных SQL Azure, были устранены с помощью управляемого экземпляра. Сведения об этом см. в статье [Сравнение возможностей службы "База данных SQL Azure" и SQL Server](sql-database-features.md). Например, в управляемых экземплярах доступны такие функции, как запросы и транзакции между базами данных в одном экземпляре, связывание сервера с другими источниками SQL, поддержка общеязыковой среды выполнения (CLR), глобальные временные таблицы, представления уровня экземпляра и Service Broker.

Если некоторые блокирующие проблемы не устранены с помощью варианта развертывания, рекомендуем рассмотреть альтернативный вариант, например [Использование SQL Server на виртуальных машинах](https://azure.microsoft.com/services/virtual-machines/sql-server/). Ниже приведены некоторые примеры:

- Если вам необходим прямой доступ к ОС или файловой системе, например, для установки сторонних или настраиваемых агентов на одной и той же виртуальной машине с SQL Server.
- Если у вас есть строгая зависимость от функций, которые все еще не поддерживаются, например FileStream или FileTable, PolyBase и транзакции между несколькими экземплярами.
- Если абсолютно необходимо остановиться в конкретной версии сервера S'L (2012, например).
- Если ваши требования к вычислению намного ниже предлагаемых управляемым экземпляром (например, одно виртуальное ядро), а консолидация базы данных неприемлема.

Если вы устранили все выявленные блокировщики миграции и продолжили миграцию в Управляемый instance, обратите внимание, что некоторые изменения могут повлиять на производительность рабочей нагрузки:
- Обязательная модель полного восстановления и регулярное автоматизированное расписание резервного копирования могут повлиять на производительность рабочей нагрузки или действия по техническому обслуживанию/ETL, если вы периодически использовали простую/быковую модель или остановили резервное копирование по требованию.
- Различные конфигурации уровня сервера или базы данных, такие как флаги следов или уровни совместимости
- Новые функции, которые вы используете, такие как прозрачное шифрование базы данных (TDE) или группы автоматического отказа, могут повлиять на использование процессора и io.

Управляемые экземпляры гарантируют доступность 99,99% даже в критических сценариях, поэтому накладные расходы, вызванные этими функциями, не могут быть отключены. Для получения дополнительной информации [ознакомьтесь с основными причинами, которые могут привести к разной производительности на сервере s и Управляемом экземпляре.](https://azure.microsoft.com/blog/key-causes-of-performance-differences-between-sql-managed-instance-and-sql-server/)

### <a name="create-performance-baseline"></a>Создание базовой линии производительности

Если вам нужно сравнить производительность рабочей нагрузки на Управляемом экземпляре с исходной рабочей нагрузкой, работакоторой на сервере S'L, необходимо создать базовый уклад производительности, который будет использоваться для сравнения. 

Базовая линия производительности представляет собой набор параметров, таких как среднее/максимальное использование процессора, средняя/максимальная задержка IO диска, пропускная способность, IOPS, средняя/максимальная продолжительность жизни страницы, средний максимальный размер tempdb. Вы хотели бы иметь аналогичные или даже лучшие параметры после миграции, поэтому важно измерить и записать базовые значения для этих параметров. В дополнение к параметрам системы, вам нужно будет выбрать набор репрезентативных запросов или наиболее важных запросов в рабочей нагрузке и измерить мин/средняя/максимальная продолжительность, использование процессора для выбранных запросов. Эти значения позволят сравнить производительность рабочей нагрузки, работающей на Управляемом экземпляре, с исходным значениям на исходном сервере S'L Server.

Некоторые параметры, которые необходимо измерить в экземпляре сервера S'L: 
- [Мониторинг использования процессора в экземпляре сервера S'L](https://techcommunity.microsoft.com/t5/Azure-SQL-Database/Monitor-CPU-usage-on-SQL-Server/ba-p/680777#M131) и запись среднего и пикового использования процессора.
- [Мониторинг использования памяти в экземпляре сервера S'L](https://docs.microsoft.com/sql/relational-databases/performance-monitor/monitor-memory-usage) и определить объем памяти, используемой различными компонентами, такими как пул буфера, кэш плана, пул хранения столбцов, [OLTP in-memory](https://docs.microsoft.com/sql/relational-databases/in-memory-oltp/monitor-and-troubleshoot-memory-usage?view=sql-server-2017)и т.д. Кроме того, необходимо найти средние и пиковые значения счетчика производительности памяти Page Life Expectancy.
- Мониторинг использования диска IO на исходном экземпляре [сервера S'L, используя sys.dm_io_virtual_file_stats](https://docs.microsoft.com/sql/relational-databases/system-dynamic-management-views/sys-dm-io-virtual-file-stats-transact-sql) просмотра или [счетчики производительности.](https://docs.microsoft.com/sql/relational-databases/performance-monitor/monitor-disk-usage)
- Мониторинг рабочей нагрузки и производительности запроса или экземпляра сервера S'L, изучая динамические представления управления или магазин запросов, если вы мигрируете из версии S'L Server 2016. Определите среднюю продолжительность и использование наиболее важных запросов в рабочей нагрузке, чтобы сравнить их с запросами, которые работают в Управляемой инстанции.

> [!Note]
> Если вы заметили какую-либо проблему с рабочей нагрузкой на сервере S'L, например, высокое использование процессора, постоянное давление памяти, проблемы с параметром, вы должны попытаться решить их в исходном экземпляре сервера, прежде чем принимать базовый уровень и миграцию. Миграция знать проблемы с любой новой системой migh привести к неожиданным результатам и недействительным любого сравнения производительности.

В результате этого действия необходимо задокументировать средние и пиковые значения для процессора, памяти и использования итогового явки в исходной системе, а также среднюю и максимальную продолжительность и использование процессора доминирующих и наиболее важных запросов в рабочей нагрузке. Эти значения следует использовать позже для сравнения производительности рабочей нагрузки в управляемом экземпляре с базовой производительностью рабочей нагрузки на исходном сервере S'L Server.

## <a name="deploy-to-an-optimally-sized-managed-instance"></a>Развертывание в управляемый экземпляр оптимального размера

Управляемый экземпляр предназначен для локальных рабочих нагрузок, которые планируется перенести в облако. Он представляет [новую модель приобретения](sql-database-service-tiers-vcore.md), которая обеспечивает большую гибкость при выборе правильного уровня ресурсов для рабочих нагрузок. В локальной среде вы, вероятно, изменяли размер этих рабочих нагрузок с помощью физических ядер и пропускной способности ввода-вывода. Модель приобретения для управляемого экземпляра основана на виртуальных ядрах, а дополнительное хранилище и операции ввода-вывода доступны отдельно. Модель на основе виртуального ядра — это более простой способ понять требования к вычислению в облаке по сравнению с используемым в локальной среде. Эта новая модель позволяет выбирать оптимальный размер целевой среды в облаке. Некоторые общие руководящие принципы, которые могут помочь вам выбрать правильный уровень обслуживания и характеристики описаны здесь:
- Основываясь на базовом использовании процессора, вы можете предоставить Управляемую инстанцию, которая соответствует количеству ядер, которые вы используете на сервере S'L, имея в виду, что характеристики процессора, возможно, потребуется масштабировать в соответствии с [характеристиками VM, где установлена Управляемая инстанция.](sql-database-managed-instance-resource-limits.md#hardware-generation-characteristics)
- На основе базового использования памяти выберите [уровень обслуживания, который имеет соответствующую память.](sql-database-managed-instance-resource-limits.md#hardware-generation-characteristics) Сумма памяти не может быть выбрана непосредственно, поэтому вам нужно будет выбрать Управляемый Экземпляр с количеством vCores, который имеет соответствующую память (например, 5,1 ГБ/vCore в Gen5). 
- На основе базовой задержки IO подсистемы выберите между общим назначением (задержка более 5 мс) и бизнес-критическими уровнями обслуживания (задержка менее 3 мс).
- На основе базовой пропускной способности предварительно распределить размер данных или файлов журнала, чтобы получить ожидаемую производительность io.

Вы можете выбрать ресурсы вычислений и хранения во время развертывания, а затем изменить их, не вводя время простоя для приложения с помощью [портала Azure:](sql-database-scale-resources.md)

![изменение размера управляемого экземпляра](./media/sql-database-managed-instance-migration/managed-instance-sizing.png)

Сведения о создании инфраструктуры виртуальной сети и управляемого экземпляра см. в статье [Краткое руководство. Создание Управляемого экземпляра Базы данных SQL Azure](sql-database-managed-instance-get-started.md).

> [!IMPORTANT]
> Важно, чтобы целевая виртуальная сеть и подсеть всегда соответствовали [требованиям к виртуальной сети управляемого экземпляра](sql-database-managed-instance-connectivity-architecture.md#network-requirements). Любая несовместимость может помешать созданию новых экземпляров или использованию созданных. Узнайте подробнее о [создании сетей](sql-database-managed-instance-create-vnet-subnet.md) и [настройке имеющихся](sql-database-managed-instance-configure-vnet-subnet.md).

## <a name="select-migration-method-and-migrate"></a>Выбор метода переноса и выполнение переноса

Вариант развертывания в виде управляемого экземпляра предназначен для пользовательских сценариев, требующих массового переноса баз данных из реализаций локальной базы данных или базы данных IaaS. Они являются оптимальным выбором, если вам нужно выполнить перенос методом lift-and-shift для серверной части приложение, которая регулярно используют уровень экземпляра и (или) межбазовые функции. В этом случае вы можете переместить весь экземпляр в соответствующую среду в Azure без необходимости изменять архитектуру приложений.

Чтобы переместить экземпляры SQL, необходимо тщательно спланировать следующее:

- Перенос всех баз данных, которые должны быть размещены совместно (те, которые выполняются в одном экземпляре).
- Перенос объектов уровня экземпляра, от которых зависит ваше приложение, включая имена для входа, учетные данные, операторы и задания агентов SQL, а также триггеры уровня сервера.

Управляемый экземпляр — это управляемая служба, позволяющая выполнять некоторые из обычных действий администратора базы данных на платформе, так как они встроены. Поэтому некоторые данные уровня экземпляра не нужно переносить (например, задания обслуживания для регулярных резервных копий или конфигурацию Always On). [Высокий уровень доступности](sql-database-high-availability.md) обеспечивается по умолчанию.

Управляемый экземпляр поддерживает следующие варианты переноса базы данных (сейчас это единственные поддерживаемые методы переноса).

- Azure Database Migration Service — миграция выполняется практически без простоев.
- Исходная `RESTORE DATABASE FROM URL` использует исходные резервные копии из SQL Server. Использование этого метода сопряжено с некоторым простоем.

### <a name="azure-database-migration-service"></a>Azure Database Migration Service

[Azure Database Migration Service (DMS)](../dms/dms-overview.md) — это полностью управляемая служба, которая выполняет непрерывную миграцию из множества источников баз данных на платформы данных Azure с минимальным временем простоя. Эта служба упрощает выполнение задач, необходимых для перемещения имеющихся сторонних баз данных и баз данных SQL Server в Azure. Варианты развертывания в общедоступной предварительной версии включают базы данных SQL Azure и SQL Server на виртуальной машине Azure. DMS — это рекомендуемый метод переноса для корпоративных рабочих нагрузок.

Если вы используете службы SQL Server Integration Services (SSIS) на своем локальном экземпляре SQL Server, учтите, что DMS пока не поддерживает перенос каталога SSIS (SSISDB), в котором хранятся пакеты SSIS. Но вы можете подготовить среду Azure SSIS Integration Runtime (IR) в службе "Фабрика данных Azure" (ADF), чтобы создать SSISDB в управляемом экземпляре, а затем повторно развернуть свои пакеты там (см. статью [Создание среды выполнения интеграции Azure-SSIS в фабрике данных Azure](https://docs.microsoft.com/azure/data-factory/create-azure-ssis-integration-runtime)).

Дополнительные сведения об этом сценарии и шагах настройки для DMS см. в статье [Руководство. Перенос SQL Server в Управляемый экземпляр Базы данных SQL Azure с помощью DMS в автономном режиме](../dms/tutorial-sql-server-to-managed-instance.md).  

### <a name="native-restore-from-url"></a>Исходное восстановление из URL-адреса

Восстановление исходных резервных копий (BAK-файлов), взятых из локального SQL Server или [SQL Server на виртуальных машинах](https://azure.microsoft.com/services/virtual-machines/sql-server/), доступно в [службе хранилища Azure](https://azure.microsoft.com/services/storage/). Это одна из ключевых возможностей варианта развертывания в управляемом экземпляре. Она обеспечивает быстрое и простое перемещение базы данных в автономном режиме.

На следующей схеме представлен общий обзор процесса:

![поток переноса](./media/sql-database-managed-instance-migration/migration-flow.png)

В следующей таблице представлена дополнительная информация о методах, которые вы можете использовать в зависимости от используемой исходной версии SQL Server.

|Шаг|Ядро и версия SQL|Метод резервного копирования и восстановления|
|---|---|---|
|Помещение резервной копии в службу хранилища Azure|Версия до SQL 2012 SP1 CU2|Переча BAK-файла непосредственно в службу хранилища Azure|
||От 2012 SP1 CU2 до 2016|Прямое резервное копирование с использованием устаревшего синтаксиса [WITH CREDENTIAL](https://docs.microsoft.com/sql/t-sql/statements/restore-statements-transact-sql)|
||2016 и более поздние версии|Прямое резервное копирование с использованием синтаксиса [WITH SAS CREDENTIAL](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-backup-to-url)|
|Восстановление из службы хранилища Azure в управляемый экземпляр|[Восстановление на основе URL-адреса с помощью учетных данных SAS](sql-database-managed-instance-get-started-restore.md)|

> [!IMPORTANT]
> - При миграции базы данных, защищенной с помощью [прозрачного шифрования данных (TDE)](transparent-data-encryption-azure-sql.md), в управляемый экземпляр с использованием параметра собственного восстановления необходимо перед восстановлением базы данных перенести соответствующий сертификат из локального или IaaS SQL Server. Пошаговая процедура приведена в статье [Перенос сертификата защищенной TDE базы данных в Управляемый экземпляр Базы данных SQL Azure](sql-database-managed-instance-migrate-tde-certificate.md).
> - Восстановление системных баз данных не поддерживается. Чтобы перенести объекты уровня экземпляра (хранящиеся в базах данных master или msdb), рекомендуем создать для них скрипт и запустить скрипты T-SQL в экземпляре среды назначения.

Сведения о восстановлении резервной копии базы данных в управляемый экземпляр с использованием учетных данных SAS см. в [этой статье](sql-database-managed-instance-get-started-restore.md).

> [!VIDEO https://www.youtube.com/embed/RxWYojo_Y3Q]


## <a name="monitor-applications"></a>Мониторинг приложений

После завершения миграции в Управляемый instance следует отслеживать поведение приложения и производительность рабочей нагрузки. Этот процесс включает в себя следующие действия:
- [Сравните производительность рабочей нагрузки, работакоторой на Управляемой инстанции,](#compare-performance-with-the-baseline) с [базовым уровнем производительности, созданным на исходном сервере S'L Server.](#create-performance-baseline)
- Постоянно [отслеживайте производительность рабочей нагрузки](#monitor-performance) для выявления потенциальных проблем и улучшения.

### <a name="compare-performance-with-the-baseline"></a>Сравните производительность с базовым уровнем

Первое действие, которое необходимо принять сразу после успешной миграции, состоит в сравнении производительности рабочей нагрузки с базовым производительностью рабочей нагрузки. Цель юаней состоит в том, чтобы подтвердить, что производительность рабочей нагрузки в управляемой инстанции отвечает вашим потребностям. 

Миграция баз данных в Управляемый instance сохраняет настройки базы данных и ее первоначальный уровень совместимости в большинстве случаев. Исходные настройки сохраняются там, где это возможно, чтобы снизить риск некоторых ухудшений производительности по сравнению с исходным сервером S'L Server. Если уровень совместимости пользовательской базы данных до переноса был равен 100 или выше, он остается неизменным после переноса. Если он был равен 90, в обновленной базе данных уровень совместимости будет равен 100. Это самый низкий уровень совместимости в управляемом экземпляре. Уровень совместимости системных баз данных равен 140. Поскольку миграция в Управляемый Instance фактически переносится на последнюю версию системы баз данных S'L Server Engine, необходимо знать, что необходимо повторно протестировать производительность рабочей нагрузки, чтобы избежать некоторых удивительных проблем с производительностью.

В качестве предварительного условия убедитесь, что вы выполнили следующие действия:
- Выровняйте настройки в управляемой инстанции с настройками из исходного экземпляра s-L Server, исследуя различные экземпляры, базы данных, настройки temdb и конфигурации. Убедитесь, что вы не изменили настройки, такие как уровни совместимости или шифрование перед запуском первого сравнения производительности, или примите риск того, что некоторые из новых функций, которые вы включили, могут повлиять на некоторые запросы. Чтобы уменьшить риски, связанные с переносом, измените уровень совместимости базы данных только после мониторинга производительности.
- Внедрить [руководящие принципы наилучшей практики хранения для общего назначения,](https://techcommunity.microsoft.com/t5/DataCAT/Storage-performance-best-practices-and-considerations-for-Azure/ba-p/305525) такие как предварительное распределение размера файлов, чтобы получить лучшую производительность.
- Узнайте о [ключевых различиях в среде, которые могут привести к различиям в производительности между управляемой инстанцией и сервером S'L,]( https://azure.microsoft.com/blog/key-causes-of-performance-differences-between-sql-managed-instance-and-sql-server/) и определите риски, которые могут повлиять на производительность.
- Убедитесь, что вы храните включенный магазин запросов и автоматическую настройку на управляемом экземпляре. Эти функции позволяют измерять производительность рабочей нагрузки и автоматически фиксировать потенциальные проблемы с производительностью. Узнайте, как использовать Магазин запросов в качестве оптимального инструмента для получения информации о производительности рабочей нагрузки до и после изменения уровня совместимости базы данных, как это объясняется в [«Держите стабильность производительности» во время обновления до более новой версии S'L Server.](https://docs.microsoft.com/sql/relational-databases/performance/query-store-usage-scenarios#CEUpgrade)
После того как вы подготовили среду, которая сопоставима как можно больше с вашей среде, вы можете начать работать с рабочей нагрузкой и измерить производительность. Процесс измерения должен включать те же параметры, которые вы измерили [при создании базовой производительности показателей рабочей нагрузки на исходном сервере S'L Server.](#create-performance-baseline)
В результате следует сопоставить параметры производительности с базовым уровнем и определить критические различия.

> [!NOTE]
> Во многих случаях вы не сможете получить точное соответствие производительности на Управляемом сервере и сервере S'L. Managed Instance — это движок базы данных S'L Server, но инфраструктура и конфигурация высокой доступности в Управляемом экземпляре могут внести некоторую разницу. Можно ожидать, что некоторые запросы будут быстрее, в то время как некоторые другие могут быть медленнее. Цель сравнения состоит в том, чтобы убедиться, что производительность рабочей нагрузки в Управляемом экземпляре соответствует производительности на сервере S'L (в среднем), и определить, есть ли критические запросы с производительностью, которые не соответствуют исходной производительности.

Результатом сравнения производительности может быть:
- Производительность рабочей нагрузки в управляемом экземпляре выравнивается или лучше выравнивается, чем производительность рабочей нагрузки на сервере S'L. В этом случае вы успешно подтвердили, что миграция успешна.
- Большинство параметров производительности и запросов в рабочей нагрузке работают отлично, за некоторыми исключениями с ухудшивсуществующей производительностью. В этом случае необходимо определить различия и их важность. Если есть некоторые важные запросы с ухудшаемым производительности, следует исследовать, изменяются ли основные планы S'L или запросы бьют некоторые ограничения ресурсов. Смягчение в этом случае может заключаться в применении некоторых подсказок на критических запросах (например, измененный уровень совместимости, оценку устаревшей кардинальности) либо напрямую, либо с помощью руководств по плану, перестроить или создать статистику и индексы, которые могут повлиять на планы. 
- Большинство запросов медленнее на управляемой инстанции по сравнению с вашим исходным сервером S'L Server. В этом случае попробуйте определить коренные причины разницы, такие как [достижение определенного предела ресурсов,]( sql-database-managed-instance-resource-limits.md#service-tier-characteristics) таких как пределы исправления, предел памяти, предел частоты регистров экземпляра и т.д. Если нет ограничений ресурсов, которые могут привести к разнице, попробуйте изменить уровень совместимости базы данных или изменить настройки базы данных, такие как оценка кардинальности наследия и перезапустить тест. Просмотрите рекомендации, предоставленные представлениями Управляемой инстанции или Магазина запросов, чтобы определить запросы, которые регрессировали производительность.

> [!IMPORTANT]
> Managed Instance имеет встроенную функцию автоматической коррекции плана, которая включена по умолчанию. Эта функция гарантирует, что запросы, которые работали нормально в пасте не будет ухудшаться в будущем. Убедитесь, что эта функция включена и что вы выполнили рабочую нагрузку достаточно долго со старыми настройками, прежде чем изменить новые настройки, чтобы позволить Управляемой инстанции узнать о базовой производительности и планах.

Визуируйте параметры или модернизируйте уровни обслуживания, чтобы сойтись с оптимальной конфигурацией до тех пор, пока вы не получите производительность рабочей нагрузки, которая соответствует вашим потребностям.

### <a name="monitor-performance"></a>Мониторинг производительности

Managed Instance предоставляет множество передовых инструментов для мониторинга и устранения неполадок, и вы должны использовать их для мониторинга производительности на вашем экземпляре. Некоторые из параметров, которые вам нужно будет контролировать:
- Использование процессора в экземпляре для определения количества vCores, которое вы подготовили, соответствует вашей рабочей нагрузке.
- Продолжительность жизни страницы на управляемом экземпляре, чтобы определить, [нужна ли дополнительная память.](https://techcommunity.microsoft.com/t5/Azure-SQL-Database/Do-you-need-more-memory-on-Azure-SQL-Managed-Instance/ba-p/563444)
- Подождите `INSTANCE_LOG_GOVERNOR` статистику, как или `PAGEIOLATCH` что скажет у вас есть проблемы с хранением IO, особенно на уровне общего назначения, где вам может понадобиться предварительно выделить файлы, чтобы получить лучшую производительность io.

## <a name="leverage-advanced-paas-features"></a>Использование расширенных функций PaaS

После того, как вы находитесь на полностью управляемой платформе, и вы проверили, что производительность рабочей нагрузки соответствует производительности рабочей нагрузки сервера S'L Server, возьмите преимущества, которые предоставляются автоматически в рамках службы базы данных S'L. 

Даже если вы не внесете некоторые изменения в управляемый экземпляр во время миграции, есть высокие шансы, что вы включите некоторые из новых функций, пока вы работаете ваш экземпляр, чтобы воспользоваться преимуществами последних улучшений движка базы данных. Некоторые изменения включены только после [изменения уровня совместимости базы данных.](https://docs.microsoft.com/sql/relational-databases/databases/view-or-change-the-compatibility-level-of-a-database)


Например, вам не нужно будет создавать резервные копии в управляемом экземпляре — служба автоматически выполняет резервное копирование. Вам больше не нужно будет контролировать планирование, создание резервных копий и управление ими. Благодаря возможности [восстановления на определенный момент времени](sql-database-recovery-using-backups.md#point-in-time-restore) управляемый экземпляр позволяет восстанавливать данные на любой момент времени в пределах этого срока хранения. Кроме того, вам не нужно будет настраивать высокой уровень доступности, так как [он](sql-database-high-availability.md) встроен.

Для повышения безопасности рассмотрите возможность использования [azure Active Directory Authentication,](sql-database-security-overview.md) [аудита,](sql-database-managed-instance-auditing.md) [обнаружения угроз,](sql-database-advanced-data-security.md) [безопасности на уровне строк](https://docs.microsoft.com/sql/relational-databases/security/row-level-security)и [динамической маскировки данных.](https://docs.microsoft.com/sql/relational-databases/security/dynamic-data-masking)

В дополнение к передовым функциям управления и безопасности, Managed Instance предоставляет набор передовых инструментов, которые могут помочь вам [контролировать и настраивать рабочую нагрузку.](sql-database-monitor-tune-overview.md) [Аналитика Azure S'L](https://docs.microsoft.com/azure/azure-monitor/insights/azure-sql) позволяет отслеживать большой набор управляемых экземпляров и централизовать мониторинг большого числа экземпляров и баз данных. [Автоматическая настройка](https://docs.microsoft.com/sql/relational-databases/automatic-tuning/automatic-tuning#automatic-plan-correction) в Управляемом Экземпляре непрерывно отслеживает производительность статистики выполнения плана S'L и автоматически фиксирует выявленные проблемы с производительностью.

## <a name="next-steps"></a>Дальнейшие действия

- Сведения об управляемом экземпляре см. в статье [Использование Управляемого экземпляра Базы данных SQL с виртуальными сетями и почти полной совместимостью](sql-database-managed-instance.md).
- Руководство со сведениями о восстановлении из резервной копии см. в статье [Краткое руководство. Создание Управляемого экземпляра Базы данных SQL Azure](sql-database-managed-instance-get-started.md).
- Руководство по миграции с помощью DMS см. в статье [Руководство. Перенос SQL Server в Управляемый экземпляр Базы данных SQL Azure с помощью DMS в автономном режиме](../dms/tutorial-sql-server-to-managed-instance.md).  
