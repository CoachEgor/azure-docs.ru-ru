---
title: Перенос базы данных из экземпляра SQL Server в базе данных SQL Azure — управляемый экземпляр | Документация Майкрософт
description: Узнайте, как перенести базу данных из экземпляра SQL Server в базу данных SQL Azure — управляемый экземпляр.
services: sql-database
ms.service: sql-database
ms.subservice: migration
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: bonova
ms.author: bonova
ms.reviewer: douglas, carlrab
manager: craigg
ms.date: 11/07/2019
ms.openlocfilehash: 7cf54b79fac87905117e321574571890c59315e6
ms.sourcegitcommit: 441e59b8657a1eb1538c848b9b78c2e9e1b6cfd5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2019
ms.locfileid: "67827078"
---
# <a name="sql-server-instance-migration-to-azure-sql-database-managed-instance"></a>Перенос экземпляра SQL Server в управляемый экземпляр Базы данных SQL Azure

В этой статье вы узнаете о методах переноса экземпляра SQL Server 2005 или более поздней версии в [управляемый экземпляр Базы данных SQL Azure](sql-database-managed-instance.md). Дополнительные сведения см. в разделе о [миграции в отдельную базу данных или эластичный пул](sql-database-cloud-migrate.md). Сведения о миграции из других платформ см. [здесь](https://datamigration.microsoft.com/).

> [!NOTE]
> Если вы хотите быстро запустить и поработайте с управляемым экземпляром, может потребоваться перейти к [руководство по быстрому запуску](/sql-database-managed-instance-quickstart-guide.md) вместо этой страницы. 

В общем процесс переноса базы данных выглядит примерно так:

![процесс переноса](./media/sql-database-managed-instance-migration/migration-process.png)

- [Оценка совместимости управляемого экземпляра](#assess-managed-instance-compatibility) где вы должны убедиться, что не препятствия, которые могут помешать миграции.
  - Этот шаг также включает в себя создание [базовых показателей производительности](#create-performance-baseline) для определения использования ресурсов на ваш исходный экземпляр SQL Server. Этот шаг необходим в том случае, если вы хотите, чтобы o развертывание недостаточный размер управляемого экземпляра и убедитесь, что производительность после миграции не затрагиваются.
- [Выберите возможности подключения приложения](sql-database-managed-instance-connect-app.md)
- [Развертывание в управляемый экземпляр оптимального размера](#deploy-to-an-optimally-sized-managed-instance) где вы выберете, технические характеристики (количество виртуальных ядер, объем памяти) и уровня производительности (критически важный для бизнеса, общего назначения) управляемого экземпляра.
- [Выбор метода переноса и перенести](#select-migration-method-and-migrate) перехода баз данных с помощью автономной миграции (собственного резервного копирования и восстановления, importe/Экспорт базы данных) или миграции в режиме онлайн (Data Migration Service, репликация транзакций).
- [Мониторинг приложений](#monitor-applications) чтобы убедиться, что ожидаемая производительность.

> [!NOTE]
> Сведения о переносе отдельной базы данных в базу данных или эластичный пул см. в статье [Перенос базы данных SQL Server в базу данных SQL Azure](sql-database-single-database-migrate.md).

## <a name="assess-managed-instance-compatibility"></a>Оценка совместимости управляемого экземпляра

Сначала определите, соответствует ли управляемый экземпляр требованиям базы данных вашего приложения. Вариант развертывания управляемого экземпляра предназначен для обеспечения простого переноса методом lift-and-shift для большинства имеющихся приложений, которые используют SQL Server локально или на виртуальных машинах. Однако иногда вам могут потребоваться еще не поддерживаемые функции или возможности, а затраты на реализацию обходного пути слишком высоки.

Используйте [Data Migration Assistant (DMA)](https://docs.microsoft.com/sql/dma/dma-overview) для выявления потенциальных проблем совместимости, влияющих на функциональность базы данных в службе "База данных SQL Azure". DMA еще не поддерживает управляемый экземпляр в качестве назначения миграции, однако мы рекомендуем выполнить оценку базы данных SQL Azure, внимательно просмотреть список обнаруженных проблем равенства функций и совместимости, сравнивая с документацией по продукту. Большинство блокирующих проблем, препятствующих переносу в Базу данных SQL Azure, были устранены с помощью управляемого экземпляра. Сведения об этом см. в статье [Сравнение возможностей службы "База данных SQL Azure" и SQL Server](sql-database-features.md). Например, в управляемых экземплярах доступны такие функции, как запросы и транзакции между базами данных в одном экземпляре, связывание сервера с другими источниками SQL, поддержка общеязыковой среды выполнения (CLR), глобальные временные таблицы, представления уровня экземпляра и Service Broker.

Если некоторые блокирующие проблемы не устранены с помощью варианта развертывания, рекомендуем рассмотреть альтернативный вариант, например [Использование SQL Server на виртуальных машинах](https://azure.microsoft.com/services/virtual-machines/sql-server/). Далее приводятся некоторые примеры.

- Если вам необходим прямой доступ к ОС или файловой системе, например, для установки сторонних или настраиваемых агентов на одной и той же виртуальной машине с SQL Server.
- Если у вас есть строгая зависимость от функций, которые все еще не поддерживаются, например FileStream или FileTable, PolyBase и транзакции между несколькими экземплярами.
- Если абсолютно должны остаться в определенной версии SQL Server (2012, например).
- Если ваши требования к вычислению намного ниже предлагаемых управляемым экземпляром (например, одно виртуальное ядро), а консолидация базы данных неприемлема.

Если Вы устранили все идентифицировать проблемы, препятствующие миграции и продолжать миграцию в управляемый экземпляр, обратите внимание, что некоторые изменения могут повлиять на производительность рабочей нагрузки.
- Обязательный полной модели восстановления и регулярное расписание автоматического резервного копирования могут повлиять на производительность рабочей нагрузки или действий обслуживания/ETL, если у вас периодически использовать простой/модели неполного протоколирования или останавливать резервные копии по запросу.
- Другой сервер или базу данных конфигурации уровня например флаги трассировки или уровни совместимости
- Новые возможности, которые вы используете, например прозрачное шифрование базы данных (TDE) или автоматической отработки отказа групп может повлиять на использование ЦП и ввода-ВЫВОДА.

Управляемый экземпляр гарантирует 99,99% доступность даже в критически важных сценариях. Поэтому нагрузку, вызванную эти функции не может быть отключено. Дополнительные сведения см. в разделе [основных причин, которые могут привести различные производительности в SQL Server и управляемый экземпляр](https://azure.microsoft.com/blog/key-causes-of-performance-differences-between-sql-managed-instance-and-sql-server/).

### <a name="create-performance-baseline"></a>Создание базовых показателей производительности

Если вам нужно сравнить эффективность выполнения рабочей нагрузки в управляемом экземпляре с исходной рабочей нагрузки на сервере SQL Server, вам потребовалось бы создать базовых показателей производительности, который будет использоваться для сравнения. 

Базовый уровень производительности — это набор параметров, таких как среднее и максимальное использование ЦП, среднее и максимальное число дисковых задержка ввода-ВЫВОДА, пропускной способности, операций ввода-ВЫВОДА, ожидаемый срок жизни страницы среднее и максимальное, среднее, максимальный размер базы данных tempdb. Вы бы хотели иметь аналогичные или еще лучше параметров после миграции, поэтому очень важно для измерения и записывать значения базовых показателей для этих параметров. В дополнение к параметрам системы необходимо выбрать набор репрезентативных запросов или наиболее важных запросов в вашей рабочей нагрузки и меру среднее/максимальных и длительность, об использовании ЦП для выбранных запросов. Эти значения позволяет сравнить производительность рабочей нагрузки в управляемом экземпляре исходные значения для исходного SQL Server.

Ниже приведены некоторые из параметров, которые необходимы для измерения в экземпляре SQL Server. 
- [Мониторинг использования ЦП в экземпляре SQL Server](https://techcommunity.microsoft.com/t5/Azure-SQL-Database/Monitor-CPU-usage-on-SQL-Server/ba-p/680777#M131) и запишите среднее значение и пиковой нагрузки ЦП.
- [Мониторинга использования памяти на экземпляр SQL Server](https://docs.microsoft.com/sql/relational-databases/performance-monitor/monitor-memory-usage) и определить объем памяти, используемой различных компонентов, таких как буферный пул, кэш пула хранилища столбцов планов [In-memory OLTP](https://docs.microsoft.com/sql/relational-databases/in-memory-oltp/monitor-and-troubleshoot-memory-usage?view=sql-server-2017)и т. д. Кроме того вы должны найти среднее и пиковые значения счетчика производительности памяти ожидаемый срок жизни страницы.
- Мониторинг использования операций ввода-ВЫВОДА диска на экземпляр SQL Server источника с помощью [sys.dm_io_virtual_file_stats](https://docs.microsoft.com/sql/relational-databases/system-dynamic-management-views/sys-dm-io-virtual-file-stats-transact-sql) представления или [счетчики производительности](https://docs.microsoft.com/sql/relational-databases/performance-monitor/monitor-disk-usage).
- Мониторинг рабочей нагрузки и производительности запросов или экземпляр SQL Server с помощью проверки динамические административные представления или запроса Store, если выполняется миграция с версии SQL Server 2016 +. Определите, Средняя продолжительность и ЦП для наиболее важных запросов в рабочей нагрузке, чтобы сравнить их с запросами, которые запущены на управляемом экземпляре.

> [!Note]
> Если вы заметили проблемы с вашей рабочей нагрузкой на сервере SQL Server, такие как высокая загрузка ЦП, нехватка памяти константы, базы данных tempdb или параметризация проблемы, попробуйте их устранения перед созданием базовых показателей и миграции на исходный экземпляр SQL Server. Миграция известные проблемы для любой новой migh системы, привести к непредвиденным результатам и сделать недействительным любого сравнения производительности.

Как результат этого действия вы должен разработать документацию среднее и пиковые значения для ЦП, памяти и использования операций ввода-ВЫВОДА в исходной системе, а также Средняя и Максимальная длительность и ЦП поиска доминантного и наиболее важных запросов в рабочей нагрузке. Позже эти значения следует использовать для сравнения производительности рабочей нагрузки в управляемом экземпляре с базовой производительностью рабочей нагрузки на исходном SQL Server.

## <a name="deploy-to-an-optimally-sized-managed-instance"></a>Развертывание в управляемый экземпляр оптимального размера

Управляемый экземпляр предназначен для локальных рабочих нагрузок, которые планируется перенести в облако. Он представляет [новую модель приобретения](sql-database-service-tiers-vcore.md), которая обеспечивает большую гибкость при выборе правильного уровня ресурсов для рабочих нагрузок. В локальной среде вы, вероятно, изменяли размер этих рабочих нагрузок с помощью физических ядер и пропускной способности ввода-вывода. Модель приобретения для управляемого экземпляра основана на виртуальных ядрах, а дополнительное хранилище и операции ввода-вывода доступны отдельно. Модель на основе виртуального ядра — это более простой способ понять требования к вычислению в облаке по сравнению с используемым в локальной среде. Эта новая модель позволяет выбирать оптимальный размер целевой среды в облаке. Здесь описываются некоторые общие рекомендации, которые могут помочь выбрать уровень служб и характеристики:
- Основываясь на базовых показателей использования ЦП, вы можете подготовить управляемый экземпляр, который совпадает с количеством ядер, которые используются на сервере SQL Server, имеющих в виду, что характеристики ЦП может потребоваться масштабировать в соответствии с [характеристик виртуальной Машины, где находится управляемый экземпляр установить](sql-database-managed-instance-resource-limits.md#hardware-generation-characteristics).
- На основе использования памяти базовых показателей выберите [уровень служб, который имеет соответствующий памяти](sql-database-managed-instance-resource-limits.md#hardware-generation-characteristics). Объем памяти, нельзя выбрать напрямую, поэтому вам потребовалось бы выбрать управляемый экземпляр с объемом виртуальных ядер, которое имеет сопоставления памяти (например 5.1 ГБ/виртуальное 5-го поколения). 
- На основе на базовых операций ввода-ВЫВОДА задержки файл подсистемы выбирать между общего назначения (задержка больше 5 мс) "и" критически важный для бизнеса уровни служб (задержки менее 3 мс).
- На основе базовых показателей пропускной способности предварительное выделение объема данных или файлов журнала для получения ожидаемая производительность операций ввода-ВЫВОДА.

Вы можете вычислений, а также ресурсов хранилища во время развертывания, время и затем изменить их без простоя для приложения с помощью [портала Azure](sql-database-scale-resources.md):

![изменение размера управляемого экземпляра](./media/sql-database-managed-instance-migration/managed-instance-sizing.png)

Сведения о создании инфраструктуры виртуальной сети и управляемого экземпляра см. в статье [Краткое руководство. Создание Управляемого экземпляра Базы данных SQL Azure](sql-database-managed-instance-get-started.md).

> [!IMPORTANT]
> Важно, чтобы целевая виртуальная сеть и подсеть всегда соответствовали [требованиям к виртуальной сети управляемого экземпляра](sql-database-managed-instance-connectivity-architecture.md#network-requirements). Любая несовместимость может помешать созданию новых экземпляров или использованию созданных. Узнайте подробнее о [создании сетей](sql-database-managed-instance-create-vnet-subnet.md) и [настройке имеющихся](sql-database-managed-instance-configure-vnet-subnet.md).

## <a name="select-migration-method-and-migrate"></a>Выбор метода переноса и выполнение переноса

Вариант развертывания в виде управляемого экземпляра предназначен для пользовательских сценариев, требующих массового переноса баз данных из реализаций локальной базы данных или базы данных IaaS. Они являются оптимальным выбором, если вам нужно выполнить перенос методом lift-and-shift для серверной части приложение, которая регулярно используют уровень экземпляра и (или) межбазовые функции. В этом случае вы можете переместить весь экземпляр в соответствующую среду в Azure без необходимости изменять архитектуру приложений.

Чтобы переместить экземпляры SQL, необходимо тщательно спланировать следующее:

- Перенос всех баз данных, которые должны быть размещены совместно (те, которые выполняются в одном экземпляре).
- Перенос объектов уровня экземпляра, от которых зависит ваше приложение, включая имена для входа, учетные данные, операторы и задания агентов SQL, а также триггеры уровня сервера.

Управляемый экземпляр — это управляемая служба, позволяющая выполнять некоторые из обычных действий администратора базы данных на платформе, так как они встроены. Поэтому некоторые данные уровня экземпляра не нужно переносить (например, задания обслуживания для регулярных резервных копий или конфигурацию Always On). [Высокий уровень доступности](sql-database-high-availability.md) обеспечивается по умолчанию.

Управляемый экземпляр поддерживает следующие варианты переноса базы данных (сейчас это единственные поддерживаемые методы переноса).

- Azure Database Migration Service — миграция выполняется практически без простоев.
- Исходная `RESTORE DATABASE FROM URL` использует исходные резервные копии из SQL Server. Использование этого метода сопряжено с некоторым простоем.

### <a name="azure-database-migration-service"></a>Azure Database Migration Service

[Azure Database Migration Service (DMS)](../dms/dms-overview.md) — это полностью управляемая служба, которая выполняет непрерывную миграцию из множества источников баз данных на платформы данных Azure с минимальным временем простоя. Эта служба упрощает выполнение задач, необходимых для перемещения имеющихся сторонних баз данных и баз данных SQL Server в Azure. Варианты развертывания в общедоступной предварительной версии включают базы данных SQL Azure и SQL Server на виртуальной машине Azure. DMS — это рекомендуемый метод переноса для корпоративных рабочих нагрузок.

Если вы используете службы SQL Server Integration Services (SSIS) на своем локальном экземпляре SQL Server, учтите, что DMS пока не поддерживает перенос каталога SSIS (SSISDB), в котором хранятся пакеты SSIS. Но вы можете подготовить среду Azure SSIS Integration Runtime (IR) в службе "Фабрика данных Azure" (ADF), чтобы создать SSISDB в управляемом экземпляре, а затем повторно развернуть свои пакеты там (см. статью [Создание среды выполнения интеграции Azure-SSIS в фабрике данных Azure](https://docs.microsoft.com/azure/data-factory/create-azure-ssis-integration-runtime)).

Дополнительные сведения об этом сценарии и шагах настройки для DMS см. в статье [Руководство. Перенос SQL Server в Управляемый экземпляр Базы данных SQL Azure с помощью DMS в автономном режиме](../dms/tutorial-sql-server-to-managed-instance.md).  

### <a name="native-restore-from-url"></a>Исходное восстановление из URL-адреса

Восстановление исходных резервных копий (BAK-файлов), взятых из локального SQL Server или [SQL Server на виртуальных машинах](https://azure.microsoft.com/services/virtual-machines/sql-server/), доступно в [службе хранилища Azure](https://azure.microsoft.com/services/storage/). Это одна из ключевых возможностей варианта развертывания в управляемом экземпляре. Она обеспечивает быстрое и простое перемещение базы данных в автономном режиме.

На следующей схеме представлен общий обзор процесса:

![последовательность переноса](./media/sql-database-managed-instance-migration/migration-flow.png)

В следующей таблице представлена дополнительная информация о методах, которые вы можете использовать в зависимости от используемой исходной версии SQL Server.

|Шаг|Ядро и версия SQL|Метод резервного копирования и восстановления|
|---|---|---|
|Помещение резервной копии в службу хранилища Azure|Версия до SQL 2012 SP1 CU2|Переча BAK-файла непосредственно в службу хранилища Azure|
||От 2012 SP1 CU2 до 2016|Прямое резервное копирование с использованием устаревшего синтаксиса [WITH CREDENTIAL](https://docs.microsoft.com/sql/t-sql/statements/restore-statements-transact-sql)|
||2016 и более поздние версии|Прямое резервное копирование с использованием синтаксиса [WITH SAS CREDENTIAL](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-backup-to-url)|
|Восстановление из службы хранилища Azure в управляемый экземпляр|[Восстановление на основе URL-адреса с помощью учетных данных SAS](sql-database-managed-instance-get-started-restore.md)|

> [!IMPORTANT]
> - При миграции базы данных, защищенной с помощью [прозрачного шифрования данных (TDE)](transparent-data-encryption-azure-sql.md), в управляемый экземпляр с использованием параметра собственного восстановления необходимо перед восстановлением базы данных перенести соответствующий сертификат из локального или IaaS SQL Server. Пошаговая процедура приведена в статье [Перенос сертификата защищенной TDE базы данных в Управляемый экземпляр Базы данных SQL Azure](sql-database-managed-instance-migrate-tde-certificate.md).
> - Восстановление системных баз данных не поддерживается. Чтобы перенести объекты уровня экземпляра (хранящиеся в базах данных master или msdb), рекомендуем создать для них скрипт и запустить скрипты T-SQL в экземпляре среды назначения.

Сведения о восстановлении резервной копии базы данных в управляемый экземпляр с использованием учетных данных SAS см. в [этой статье](sql-database-managed-instance-get-started-restore.md).

> [!VIDEO https://www.youtube.com/embed/RxWYojo_Y3Q]


## <a name="monitor-applications"></a>Мониторинг приложений

После завершения миграции в управляемый экземпляр должен отслеживать поведение приложения и производительность рабочей нагрузки. Этот процесс включает следующие действия:
- [Сравнение производительности рабочей нагрузки, выполняющейся на управляемом экземпляре](#compare-performance-with-the-baseline) с [базовых показателей производительности, созданная для исходного SQL Server](#create-performance-baseline).
- Постоянно [отслеживать производительность рабочей нагрузки](#monitor-performance) для выявления потенциальных проблем и улучшения.

### <a name="compare-performance-with-the-baseline"></a>Сравнение производительности с базовыми показателями

Первым действием, необходимо выполнить сразу же после успешной миграции заключается в сравнении производительности рабочей нагрузки с базовой производительностью рабочей нагрузки. Это действие предназначена для того, чтобы убедиться, что производительность рабочей нагрузки для управляемого экземпляра соответствует вашим потребностям. 

Миграция базы данных в управляемый экземпляр сохраняет параметры базы данных и первоначальный уровень совместимости в большинстве случаев. Исходные параметры сохраняются в том случае, если это возможно, чтобы снизить риск возникновения некоторых снижения производительности по сравнению с исходного SQL Server. Если уровень совместимости пользовательской базы данных до переноса был равен 100 или выше, он остается неизменным после переноса. Если он был равен 90, в обновленной базе данных уровень совместимости будет равен 100. Это самый низкий уровень совместимости в управляемом экземпляре. Уровень совместимости системных баз данных равен 140. После миграции в управляемый экземпляр фактического переноса до последней версии SQL Server Database Engine, следует помнить, что требуется для повторного тестирования производительности рабочей нагрузки, чтобы избежать неожиданные проблемы производительности.

Перед началом убедитесь, что выполнены следующие действия:
- Выравнивание в настройках на управляемом экземпляре с параметрами на исходный экземпляр SQL Server, изучив различных экземпляра, базы данных, temdb параметров и конфигураций. Убедитесь, что не были изменены параметры, такие как уровни совместимости или шифрования до запуска первого сравнения производительности или принять риск, что некоторые из новых функций, которые вы включили может повлиять на некоторые запросы. Чтобы уменьшить риски, связанные с переносом, измените уровень совместимости базы данных только после мониторинга производительности.
- Реализуйте [хранилища рекомендациям для общего назначения](https://techcommunity.microsoft.com/t5/DataCAT/Storage-performance-best-practices-and-considerations-for-Azure/ba-p/305525) например предварительное выделение размер файлов, чтобы повысить производительность.
- Дополнительные сведения о [основные различия среды, которые могут вызвать разницу в производительности между управляемый экземпляр и SQL Server]( https://azure.microsoft.com/blog/key-causes-of-performance-differences-between-sql-managed-instance-and-sql-server/) и определить риски, которые могут повлиять на производительность.
- Убедитесь, что не включена Store запроса и автоматическую настройку для управляемого экземпляра. Эти функции позволяют измерять производительность рабочей нагрузки и автоматически устранять потенциальные проблемы с производительностью. Сведения об использовании запросов Store как оптимальное средство для получения сведений о производительности рабочей нагрузки до и после изменения уровня совместимости базы данных, как описано в [поддержание стабильной производительности во время обновления до новой версии SQL Server](https://docs.microsoft.com/sql/relational-databases/performance/query-store-usage-scenarios#CEUpgrade).
После подготовки среды, которая сопоставима максимально с вашей локальной среде, можно запустить выполнения рабочих нагрузок и измерения производительности. Процесс измерения должен включать те же параметры, которые вы измеряется [на исходном SQL Server создавать базовые показатели производительности вашей рабочей нагрузки мер](#create-performance-baseline).
Таким образом следует сравнить параметров производительности с базовыми показателями и определить важные различия.

> [!NOTE]
> Во многих случаях вы не сможет получить точно соответствующую производительность на управляемый экземпляр и SQL Server. Управляемый экземпляр — это ядро СУБД SQL Server, но инфраструктуры и конфигурации высокого уровня доступности в управляемом экземпляре может вызвать некоторые различия. Можно предположить, что некоторые запросы будет быстрее, при каком-либо другом могут работать медленнее. Цель сравнения — убедиться, что производительность рабочей нагрузки в управляемом экземпляре соответствует производительности на сервере SQL Server (в среднем) и определить существуют важные запросы с производительностью, которые не соответствуют исходной производительность.

Результат операции сравнения производительности может быть:
- Производительность рабочей нагрузки в управляемом экземпляре выравнивается или более высокий уровень, производительность рабочей нагрузки на сервере SQL Server. В этом случае успешно подтверждения того, что миграция выполнена успешно.
- Большинство параметров производительности и запросов в работу нормально, за некоторыми исключениями, снижение производительности рабочей нагрузки. В этом случае необходимо определить различия и их важности. Если имеются некоторые важные запросы с низкой производительности, следует изучить изменения базовых планов SQL или запросы сталкиваются с серьезными некоторые ограничения ресурсов. Устранение рисков в этом случае можно применить некоторые ссылки на важные запросы (например измененные уровень совместимости, унаследованной кратности) либо напрямую или с помощью структур планов, rebuild или create statistics и индексы, которые могут повлиять на планы. 
- Большинство запросов выполняются медленнее в управляемом экземпляре, по сравнению с исходного SQL Server. В этом случае при попытке определить основные причины разницы, такие как [достижения некоторые ограничения ресурсов]( sql-database-managed-instance-resource-limits.md#instance-level-resource-limits) , такие как ограничения операций ввода-ВЫВОДА, предел памяти, ограничение скорости журнала экземпляра и т. д. Если отсутствуют ограничения ресурсов, которые могут вызвать разницу, попробуйте изменить уровень совместимости базы данных или изменить параметры базы данных, такие как оценка унаследованной кратности и повторно запустить тест. Просмотрите рекомендации, предоставляемые представления управляемого экземпляра или Store запроса для определения запросов, производительность была снижена производительность.

> [!IMPORTANT]
> Управляемый экземпляр включает встроенные автоматическая функция редактирования плана, включенный по умолчанию. Эта функция гарантирует, что запросы, которые работали нормально в вставки бы снижают в будущем. Убедитесь, что эта функция включена и что вы выполнили рабочей нагрузки, достаточно длинный с старые параметры перед изменением новые параметры для включения управляемого экземпляра узнать о базовых показателей производительности и планы.

Измените параметры или обновления уровня обслуживания для достижения оптимальной конфигурации вы получаете производительность рабочей нагрузки, который соответствует вашим потребностям.

### <a name="monitor-performance"></a>Мониторинг производительности

Управляемый экземпляр предоставляет массу расширенные средства для мониторинга и устранения неполадок и их следует использовать для наблюдения за производительностью в экземпляре. Некоторые параметры, ваш потребуется отслеживать являются:
- Использование ЦП для экземпляра, чтобы определить, выполняет, количество виртуальных ядер, которое вы подготовили — оптимальное соответствие для рабочей нагрузки.
- Ожидаемый срок жизни страницы для управляемого экземпляра для определения [нужна дополнительная память](https://techcommunity.microsoft.com/t5/Azure-SQL-Database/Do-you-need-more-memory-on-Azure-SQL-Managed-Instance/ba-p/563444).
- Подождите, статистические данные, например `INSTANCE_LOG_GOVERNOR` или `PAGEIOLATCH` это поможет определить, у вас есть проблемы ввода-ВЫВОДА хранилища, особенно на уровне общего назначения, где может потребоваться предварительное выделение файлы, чтобы повысить производительность операций ввода-ВЫВОДА.

## <a name="leverage-advanced-paas-features"></a>Используйте расширенные возможности PaaS

После того как вы используете это полностью управляемая платформа и вы убедились, что производительность рабочей нагрузки соответствуют производительность рабочей нагрузки SQL Server, все преимущества, которые предоставляются автоматически как часть службы базы данных SQL. 

Даже если не внести некоторые изменения в управляемый экземпляр во время миграции, существует высокая вероятность был годен на некоторые из новых функций, пока вы работаете в свой экземпляр, чтобы воспользоваться преимуществами последних усовершенствованиях ядра базы данных. Некоторые изменения включаются только один раз [уровень совместимости базы данных был изменен](https://docs.microsoft.com/sql/relational-databases/databases/view-or-change-the-compatibility-level-of-a-database).


Например, вам не нужно будет создавать резервные копии в управляемом экземпляре — служба автоматически выполняет резервное копирование. Вам больше не нужно будет контролировать планирование, создание резервных копий и управление ими. Благодаря возможности [восстановления на определенный момент времени](sql-database-recovery-using-backups.md#point-in-time-restore) управляемый экземпляр позволяет восстанавливать данные на любой момент времени в пределах этого срока хранения. Кроме того, вам не нужно будет настраивать высокой уровень доступности, так как [он](sql-database-high-availability.md) встроен.

Чтобы повысить уровень безопасности, рассмотрите возможность использования [аутентификации Azure Active Directory](sql-database-security-overview.md), [аудит](sql-database-managed-instance-auditing.md), [обнаружение угроз](sql-database-advanced-data-security.md), [безопасностинауровнестрок](https://docs.microsoft.com/sql/relational-databases/security/row-level-security), и [динамическое маскирование данных](https://docs.microsoft.com/sql/relational-databases/security/dynamic-data-masking) ).

Помимо расширенного управления и функции безопасности, управляемый экземпляр предоставляет набор дополнительных средств, которые помогут [наблюдение и настройка рабочей нагрузки](sql-database-monitor-tune-overview.md). [Аналитика SQL Azure](https://docs.microsoft.com/azure/azure-monitor/insights/azure-sql) позволяет отслеживать большой набор управляемых экземпляров и централизации мониторинга большое количество экземпляров и баз данных. [Автоматическая настройка](https://docs.microsoft.com/sql/relational-databases/automatic-tuning/automatic-tuning#automatic-plan-correction) в управляемом экземпляре постоянно отслеживать производительность статистики выполнения плана SQL и автоматически устранить проблемы с производительностью, идентифицированные.

## <a name="next-steps"></a>Следующие шаги

- Сведения об управляемом экземпляре см. в статье [Использование Управляемого экземпляра Базы данных SQL с виртуальными сетями и почти полной совместимостью](sql-database-managed-instance.md).
- Руководство со сведениями о восстановлении из резервной копии см. в статье [Краткое руководство. Создание Управляемого экземпляра Базы данных SQL Azure](sql-database-managed-instance-get-started.md).
- Руководство по миграции с помощью DMS см. в статье [Руководство. Перенос SQL Server в Управляемый экземпляр Базы данных SQL Azure с помощью DMS в автономном режиме](../dms/tutorial-sql-server-to-managed-instance.md).  
