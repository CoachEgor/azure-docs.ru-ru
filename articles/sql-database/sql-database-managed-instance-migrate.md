---
title: Миграция базы данных из экземпляра SQL Server в управляемый экземпляр базы данных SQL Azure | Документация Майкрософт
description: Узнайте, как перенести базу данных из экземпляра SQL Server в управляемый экземпляр базы данных SQL Azure.
services: sql-database
ms.service: sql-database
ms.subservice: migration
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: bonova
ms.author: bonova
ms.reviewer: douglas, carlrab
ms.date: 11/07/2019
ms.openlocfilehash: 19a7f749ffb1af4f712d23abcd52d91653ad4544
ms.sourcegitcommit: 7c4de3e22b8e9d71c579f31cbfcea9f22d43721a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/26/2019
ms.locfileid: "68567379"
---
# <a name="sql-server-instance-migration-to-azure-sql-database-managed-instance"></a>Перенос экземпляра SQL Server в управляемый экземпляр Базы данных SQL Azure

В этой статье вы узнаете о методах переноса экземпляра SQL Server 2005 или более поздней версии в [управляемый экземпляр Базы данных SQL Azure](sql-database-managed-instance.md). Дополнительные сведения см. в разделе о [миграции в отдельную базу данных или эластичный пул](sql-database-cloud-migrate.md). Сведения о миграции из других платформ см. [здесь](https://datamigration.microsoft.com/).

> [!NOTE]
> Если вы хотите быстро начать работу с Управляемый экземпляр, вместо этой страницы можно перейти к [руководству](sql-database-managed-instance-quickstart-guide.md) по быстрому запуску. 

В общем процесс переноса базы данных выглядит примерно так:

![процесс переноса](./media/sql-database-managed-instance-migration/migration-process.png)

- [Оцените совместимость управляемого экземпляра](#assess-managed-instance-compatibility) , чтобы убедиться в отсутствии блокирующих проблем, которые могут препятствовать миграции.
  - Этот шаг также включает создание [базовых показателей производительности](#create-performance-baseline) для определения использования ресурсов на исходном экземпляре SQL Server. Этот шаг необходим, если требуется развернуть правильно размер Управляемый экземпляр и убедиться, что производительность после миграции не затрагиваются.
- [Выбор параметров подключения приложения](sql-database-managed-instance-connect-app.md)
- Выполните [развертывание в управляемом экземпляре с оптимальным размером, чтобы](#deploy-to-an-optimally-sized-managed-instance) выбрать технические характеристики (количество виртуальных ядер, объем памяти) и уровень производительности (критически важный для бизнеса, общего назначения) управляемый экземпляр.
- [Выберите метод миграции и выполните миграцию](#select-migration-method-and-migrate) , где выполняется миграция баз данных с помощью автономной миграции (собственная архивация, восстановление, импорт и экспорт базы данных) или оперативная миграция (служба миграции данных, репликация транзакций).
- [Мониторинг приложений](#monitor-applications) для обеспечения ожидаемой производительности.

> [!NOTE]
> Сведения о переносе отдельной базы данных в базу данных или эластичный пул см. в статье [Перенос базы данных SQL Server в базу данных SQL Azure](sql-database-single-database-migrate.md).

## <a name="assess-managed-instance-compatibility"></a>Оценка совместимости управляемого экземпляра

Сначала определите, соответствует ли управляемый экземпляр требованиям базы данных вашего приложения. Вариант развертывания управляемого экземпляра предназначен для обеспечения простого переноса методом lift-and-shift для большинства имеющихся приложений, которые используют SQL Server локально или на виртуальных машинах. Однако иногда вам могут потребоваться еще не поддерживаемые функции или возможности, а затраты на реализацию обходного пути слишком высоки.

Используйте [Data Migration Assistant (DMA)](https://docs.microsoft.com/sql/dma/dma-overview) для выявления потенциальных проблем совместимости, влияющих на функциональность базы данных в службе "База данных SQL Azure". DMA еще не поддерживает управляемый экземпляр в качестве назначения миграции, однако мы рекомендуем выполнить оценку базы данных SQL Azure, внимательно просмотреть список обнаруженных проблем равенства функций и совместимости, сравнивая с документацией по продукту. Большинство блокирующих проблем, препятствующих переносу в Базу данных SQL Azure, были устранены с помощью управляемого экземпляра. Сведения об этом см. в статье [Сравнение возможностей службы "База данных SQL Azure" и SQL Server](sql-database-features.md). Например, в управляемых экземплярах доступны такие функции, как запросы и транзакции между базами данных в одном экземпляре, связывание сервера с другими источниками SQL, поддержка общеязыковой среды выполнения (CLR), глобальные временные таблицы, представления уровня экземпляра и Service Broker.

Если некоторые блокирующие проблемы не устранены с помощью варианта развертывания, рекомендуем рассмотреть альтернативный вариант, например [Использование SQL Server на виртуальных машинах](https://azure.microsoft.com/services/virtual-machines/sql-server/). Далее приводятся некоторые примеры.

- Если вам необходим прямой доступ к ОС или файловой системе, например, для установки сторонних или настраиваемых агентов на одной и той же виртуальной машине с SQL Server.
- Если у вас есть строгая зависимость от функций, которые все еще не поддерживаются, например FileStream или FileTable, PolyBase и транзакции между несколькими экземплярами.
- Если необходимо остаться в определенной версии SQL Server (например, 2012).
- Если ваши требования к вычислению намного ниже предлагаемых управляемым экземпляром (например, одно виртуальное ядро), а консолидация базы данных неприемлема.

Если вы разрешили все идентифицированные блокировки миграции и продолжите миграцию на Управляемый экземпляр, обратите внимание, что некоторые изменения могут повлиять на производительность рабочей нагрузки:
- Обязательная модель полного восстановления и регулярное автоматическое расписание архивации могут повлиять на производительность рабочей нагрузки или действий по обслуживанию и ETL, если вы периодически использовали модель простого или неполного протоколирования или остановили резервное копирование по запросу.
- Различные конфигурации уровня сервера или базы данных, такие как флаги трассировки или уровни совместимости.
- Новые функции, которые вы используете, например прозрачное шифрование базы данных (TDE) или группы автоматической отработки отказа, могут влиять на использование ЦП и операций ввода-вывода.

Управляемый экземпляр гарантирует доступность 99,99% даже в критических сценариях, поэтому издержки, вызванные этими функциями, не могут быть отключены. Дополнительные сведения см. в описании [основных причин, которые могут привести к различным характеристикам SQL Server и управляемый экземпляр](https://azure.microsoft.com/blog/key-causes-of-performance-differences-between-sql-managed-instance-and-sql-server/).

### <a name="create-performance-baseline"></a>Создание базового показателя производительности

Если необходимо сравнить производительность рабочей нагрузки на Управляемый экземпляр с исходной рабочей нагрузкой, работающей на SQL Server, необходимо создать базовый уровень производительности, который будет использоваться для сравнения. 

Базовые показатели производительности — это набор параметров, таких как средняя и максимальная загрузка ЦП, средняя скорость операций ввода-вывода на диск, пропускная способность, число операций ввода/вывода в секунду, ожидаемое время существования страницы, среднее значение максимального размера базы данных tempdb. Вы хотели бы иметь аналогичные или даже более лучшие параметры после миграции, поэтому важно измерять и записывать базовые значения для этих параметров. Помимо системных параметров, необходимо выбрать набор репрезентативных запросов или наиболее важных запросов в рабочей нагрузке и оценить минимальное/среднее/максимальное значение длительности использования ЦП для выбранных запросов. Эти значения позволяют сравнить производительность рабочей нагрузки, выполняемой на Управляемый экземпляр, с исходными значениями на исходном SQL Server.

Ниже приведены некоторые параметры, которые необходимо измерять в экземпляре SQL Server. 
- [Отслеживайте использование ЦП на экземпляре SQL Server](https://techcommunity.microsoft.com/t5/Azure-SQL-Database/Monitor-CPU-usage-on-SQL-Server/ba-p/680777#M131) и записывайте среднюю и пиковую загрузку ЦП.
- [Отслеживайте использование памяти на экземпляре SQL Server](https://docs.microsoft.com/sql/relational-databases/performance-monitor/monitor-memory-usage) и определите объем памяти, используемый различными компонентами, такими как буферный пул, кэш планов, пул хранилища столбцов, выполняющаяся [в памяти OLTP](https://docs.microsoft.com/sql/relational-databases/in-memory-oltp/monitor-and-troubleshoot-memory-usage?view=sql-server-2017)и т. д. Кроме того, вы должны найти средние и пиковые значения счетчика производительности "ожидаемая память страницы".
- Мониторинг использования дискового ввода-вывода на экземпляре SQL Server источника с помощью представления [sys. DM _io_virtual_file_stats](https://docs.microsoft.com/sql/relational-databases/system-dynamic-management-views/sys-dm-io-virtual-file-stats-transact-sql) или [счетчиков производительности](https://docs.microsoft.com/sql/relational-databases/performance-monitor/monitor-disk-usage).
- Отслеживайте производительность рабочей нагрузки и запросов или экземпляр SQL Server, проверив динамические административные представления или хранилище запросов при миграции с SQL Server 2016 + версии. Выявление средней длительности и загрузки ЦП наиболее важных запросов в рабочей нагрузке для сравнения с запросами, выполняемыми на Управляемый экземпляр.

> [!Note]
> При возникновении проблем с рабочей нагрузкой на SQL Server, таких как высокая загрузка ЦП, постоянная нехватка памяти, tempdb или параметризатион, следует попытаться разрешить их на исходном экземпляре SQL Server перед получением базовых показателей и миграции. Миграция известных проблем в любой новый системный мигх приводит к непредвиденным результатам и делает недействительным сравнение производительности.

В результате этого действия вы должны были задокументированы средние и пиковые значения использования ЦП, памяти и операций ввода-вывода в исходной системе, а также среднюю и максимальную продолжительность и использование ЦП главным и наиболее важными запросами в рабочей нагрузке. Эти значения следует использовать позже, чтобы сравнить производительность рабочей нагрузки на Управляемый экземпляр с базовой производительностью рабочей нагрузки на исходном SQL Server.

## <a name="deploy-to-an-optimally-sized-managed-instance"></a>Развертывание в управляемый экземпляр оптимального размера

Управляемый экземпляр предназначен для локальных рабочих нагрузок, которые планируется перенести в облако. Он представляет [новую модель приобретения](sql-database-service-tiers-vcore.md), которая обеспечивает большую гибкость при выборе правильного уровня ресурсов для рабочих нагрузок. В локальной среде вы, вероятно, изменяли размер этих рабочих нагрузок с помощью физических ядер и пропускной способности ввода-вывода. Модель приобретения для управляемого экземпляра основана на виртуальных ядрах, а дополнительное хранилище и операции ввода-вывода доступны отдельно. Модель на основе виртуального ядра — это более простой способ понять требования к вычислению в облаке по сравнению с используемым в локальной среде. Эта новая модель позволяет выбирать оптимальный размер целевой среды в облаке. Ниже приведены некоторые общие рекомендации, которые могут помочь вам выбрать правильный уровень служб и характеристики.
- В зависимости от базового использования ЦП можно подготавливать Управляемый экземпляр, которые соответствуют количеству ядер, используемому в SQL Server, учитывая, что характеристики ЦП могут быть масштабированы в соответствии с [характеристиками виртуальных машин, где установлена управляемый экземпляр ](sql-database-managed-instance-resource-limits.md#hardware-generation-characteristics).
- На основе базового использования памяти выберите [уровень служб, который соответствует памяти](sql-database-managed-instance-resource-limits.md#hardware-generation-characteristics). Объем памяти нельзя выбрать напрямую, поэтому необходимо выбрать Управляемый экземпляр с количеством виртуальных ядер, имеющим соответствующий объем памяти (например, 5,1 ГБ/Виртуальное ядро в го поколения). 
- В зависимости от базовой задержки операций ввода-вывода для файловой системы выберите между общего назначения (задержка больше 5 мс) и критически важный для бизнеса уровнями служб (задержка менее 3 мс).
- На основе базовой пропускной способности предварительно выделяется размер файлов данных или журналов для получения ожидаемой производительности ввода-вывода.

Во время развертывания можно выбрать ресурсы для вычислений и хранения, а затем изменить их, не вводя время простоя приложения с помощью [портал Azure](sql-database-scale-resources.md):

![изменение размера управляемого экземпляра](./media/sql-database-managed-instance-migration/managed-instance-sizing.png)

Сведения о создании инфраструктуры виртуальной сети и управляемого экземпляра см. в статье [Краткое руководство. Создание Управляемого экземпляра Базы данных SQL Azure](sql-database-managed-instance-get-started.md).

> [!IMPORTANT]
> Важно, чтобы целевая виртуальная сеть и подсеть всегда соответствовали [требованиям к виртуальной сети управляемого экземпляра](sql-database-managed-instance-connectivity-architecture.md#network-requirements). Любая несовместимость может помешать созданию новых экземпляров или использованию созданных. Узнайте подробнее о [создании сетей](sql-database-managed-instance-create-vnet-subnet.md) и [настройке имеющихся](sql-database-managed-instance-configure-vnet-subnet.md).

## <a name="select-migration-method-and-migrate"></a>Выбор метода переноса и выполнение переноса

Вариант развертывания в виде управляемого экземпляра предназначен для пользовательских сценариев, требующих массового переноса баз данных из реализаций локальной базы данных или базы данных IaaS. Они являются оптимальным выбором, если вам нужно выполнить перенос методом lift-and-shift для серверной части приложение, которая регулярно используют уровень экземпляра и (или) межбазовые функции. В этом случае вы можете переместить весь экземпляр в соответствующую среду в Azure без необходимости изменять архитектуру приложений.

Чтобы переместить экземпляры SQL, необходимо тщательно спланировать следующее:

- Перенос всех баз данных, которые должны быть размещены совместно (те, которые выполняются в одном экземпляре).
- Перенос объектов уровня экземпляра, от которых зависит ваше приложение, включая имена для входа, учетные данные, операторы и задания агентов SQL, а также триггеры уровня сервера.

Управляемый экземпляр — это управляемая служба, позволяющая выполнять некоторые из обычных действий администратора базы данных на платформе, так как они встроены. Поэтому некоторые данные уровня экземпляра не нужно переносить (например, задания обслуживания для регулярных резервных копий или конфигурацию Always On). [Высокий уровень доступности](sql-database-high-availability.md) обеспечивается по умолчанию.

Управляемый экземпляр поддерживает следующие варианты переноса базы данных (сейчас это единственные поддерживаемые методы переноса).

- Azure Database Migration Service — миграция выполняется практически без простоев.
- Исходная `RESTORE DATABASE FROM URL` использует исходные резервные копии из SQL Server. Использование этого метода сопряжено с некоторым простоем.

### <a name="azure-database-migration-service"></a>Служба миграции баз данных Azure

[Azure Database Migration Service (DMS)](../dms/dms-overview.md) — это полностью управляемая служба, которая выполняет непрерывную миграцию из множества источников баз данных на платформы данных Azure с минимальным временем простоя. Эта служба упрощает выполнение задач, необходимых для перемещения имеющихся сторонних баз данных и баз данных SQL Server в Azure. Варианты развертывания в общедоступной предварительной версии включают базы данных SQL Azure и SQL Server на виртуальной машине Azure. DMS — это рекомендуемый метод переноса для корпоративных рабочих нагрузок.

Если вы используете службы SQL Server Integration Services (SSIS) на своем локальном экземпляре SQL Server, учтите, что DMS пока не поддерживает перенос каталога SSIS (SSISDB), в котором хранятся пакеты SSIS. Но вы можете подготовить среду Azure SSIS Integration Runtime (IR) в службе "Фабрика данных Azure" (ADF), чтобы создать SSISDB в управляемом экземпляре, а затем повторно развернуть свои пакеты там (см. статью [Создание среды выполнения интеграции Azure-SSIS в фабрике данных Azure](https://docs.microsoft.com/azure/data-factory/create-azure-ssis-integration-runtime)).

Дополнительные сведения об этом сценарии и шагах настройки для DMS см. в статье [Руководство. Перенос SQL Server в Управляемый экземпляр Базы данных SQL Azure с помощью DMS в автономном режиме](../dms/tutorial-sql-server-to-managed-instance.md).  

### <a name="native-restore-from-url"></a>Исходное восстановление из URL-адреса

Восстановление исходных резервных копий (BAK-файлов), взятых из локального SQL Server или [SQL Server на виртуальных машинах](https://azure.microsoft.com/services/virtual-machines/sql-server/), доступно в [службе хранилища Azure](https://azure.microsoft.com/services/storage/). Это одна из ключевых возможностей варианта развертывания в управляемом экземпляре. Она обеспечивает быстрое и простое перемещение базы данных в автономном режиме.

На следующей схеме представлен общий обзор процесса:

![последовательность переноса](./media/sql-database-managed-instance-migration/migration-flow.png)

В следующей таблице представлена дополнительная информация о методах, которые вы можете использовать в зависимости от используемой исходной версии SQL Server.

|Шаг|Ядро и версия SQL|Метод резервного копирования и восстановления|
|---|---|---|
|Помещение резервной копии в службу хранилища Azure|Версия до SQL 2012 SP1 CU2|Переча BAK-файла непосредственно в службу хранилища Azure|
||От 2012 SP1 CU2 до 2016|Прямое резервное копирование с использованием устаревшего синтаксиса [WITH CREDENTIAL](https://docs.microsoft.com/sql/t-sql/statements/restore-statements-transact-sql)|
||2016 и более поздние версии|Прямое резервное копирование с использованием синтаксиса [WITH SAS CREDENTIAL](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-backup-to-url)|
|Восстановление из службы хранилища Azure в управляемый экземпляр|[Восстановление на основе URL-адреса с помощью учетных данных SAS](sql-database-managed-instance-get-started-restore.md)|

> [!IMPORTANT]
> - При миграции базы данных, защищенной с помощью [прозрачного шифрования данных (TDE)](transparent-data-encryption-azure-sql.md), в управляемый экземпляр с использованием параметра собственного восстановления необходимо перед восстановлением базы данных перенести соответствующий сертификат из локального или IaaS SQL Server. Пошаговая процедура приведена в статье [Перенос сертификата защищенной TDE базы данных в Управляемый экземпляр Базы данных SQL Azure](sql-database-managed-instance-migrate-tde-certificate.md).
> - Восстановление системных баз данных не поддерживается. Чтобы перенести объекты уровня экземпляра (хранящиеся в базах данных master или msdb), рекомендуем создать для них скрипт и запустить скрипты T-SQL в экземпляре среды назначения.

Сведения о восстановлении резервной копии базы данных в управляемый экземпляр с использованием учетных данных SAS см. в [этой статье](sql-database-managed-instance-get-started-restore.md).

> [!VIDEO https://www.youtube.com/embed/RxWYojo_Y3Q]


## <a name="monitor-applications"></a>Мониторинг приложений

После завершения миграции на Управляемый экземпляр следует отрегулировать поведение приложения и производительность рабочей нагрузки. Этот процесс включает следующие действия.
- [Сравните производительность рабочей нагрузки, выполняемой на управляемый экземпляр](#compare-performance-with-the-baseline) , с [базовыми показателями производительности, созданными на исходном SQL Server](#create-performance-baseline).
- Постоянное [Отслеживание производительности рабочей нагрузки](#monitor-performance) для выявления потенциальных проблем и улучшений.

### <a name="compare-performance-with-the-baseline"></a>Сравнение производительности с базовыми показателями

Первое действие, которое необходимо выполнить сразу после успешной миграции, — это сравнение производительности рабочей нагрузки с базовой производительностью рабочей нагрузки. Цель этого действия — убедиться, что производительность рабочей нагрузки на Управляемый экземпляр соответствует вашим потребностям. 

Миграция базы данных на Управляемый экземпляр сохраняет параметры базы данных и ее исходный уровень совместимости в большинстве случаев. Исходные параметры сохраняются там, где это возможно, чтобы снизить риск снижения производительности по сравнению с исходными SQL Server. Если уровень совместимости пользовательской базы данных до переноса был равен 100 или выше, он остается неизменным после переноса. Если он был равен 90, в обновленной базе данных уровень совместимости будет равен 100. Это самый низкий уровень совместимости в управляемом экземпляре. Уровень совместимости системных баз данных равен 140. Так как миграция на Управляемый экземпляр на самом деле переносится на последнюю версию SQL Server ядро СУБД, следует иметь в виду, что необходимо повторно проверить производительность рабочей нагрузки, чтобы избежать некоторых неудивительных проблем с производительностью.

В качестве необходимого компонента убедитесь, что выполнены следующие действия.
- Выровняйте параметры на Управляемый экземпляр с параметрами из экземпляра источника SQL Server, изучая различные параметры экземпляра, базы данных, каталогов temdb и конфигурации. Перед запуском первого сравнения производительности убедитесь, что вы не изменили такие параметры, как уровни совместимости или шифрование, или примите риск того, что некоторые из новых включенных функций могут повлиять на некоторые запросы. Чтобы уменьшить риски, связанные с переносом, измените уровень совместимости базы данных только после мониторинга производительности.
- Реализуйте рекомендации по [использованию хранилища для общего назначения](https://techcommunity.microsoft.com/t5/DataCAT/Storage-performance-best-practices-and-considerations-for-Azure/ba-p/305525) , таких как предварительное выделение размера файлов для повышения производительности.
- Узнайте о различиях в [среде, которые могут вызвать различия в производительности между управляемый экземпляр и SQL Server]( https://azure.microsoft.com/blog/key-causes-of-performance-differences-between-sql-managed-instance-and-sql-server/) и выявление рисков, которые могут повлиять на производительность.
- Убедитесь, что в Управляемый экземпляр включено хранилище запросов и автоматическая настройка. Эти функции позволяют измерять производительность рабочей нагрузки и автоматически устраняют потенциальные проблемы с производительностью. Узнайте, как использовать хранилище запросов в качестве оптимального средства для получения сведений о производительности рабочей нагрузки до и после изменения уровня совместимости базы данных, как описано в статье [обеспечение стабильной производительности во время обновления до более новой версии SQL Server](https://docs.microsoft.com/sql/relational-databases/performance/query-store-usage-scenarios#CEUpgrade).
После подготовки среды, сравнимой по мере возможности с локальной средой, можно приступить к выполнению рабочей нагрузки и измерению производительности. Процесс измерения должен включать те же параметры, которые вы измеряете [при создании базовых показателей производительности рабочей нагрузки на исходном SQL Server](#create-performance-baseline).
В результате следует сравнить параметры производительности с базовыми показателями и выделить критические различия.

> [!NOTE]
> Во многих случаях вы не сможете получить точную согласованность производительности на Управляемый экземпляр и SQL Server. Управляемый экземпляр является SQL Server ядром СУБД, но конфигурация инфраструктуры и высокого уровня доступности на Управляемый экземпляр может привести к некоторым различиям. Вы можете ожидать, что некоторые запросы будут выполняться быстрее, а другие могут быть медленнее. Цель сравнения заключается в том, чтобы убедиться, что производительность рабочей нагрузки в Управляемый экземпляр соответствует производительности SQL Server (в среднем), а также определить, есть ли критически важные запросы с производительностью, не соответствующей исходной производительности.

Результат сравнения производительности может быть следующим:
- Производительность рабочей нагрузки на Управляемый экземпляр выстраивается или повышается, так как производительность рабочей нагрузки SQL Server. В этом случае вы успешно подтвердили, что миграция выполнена успешно.
- Большая часть параметров производительности и запросов в рабочей нагрузке работают нормально, с некоторыми исключениями, имеющими снижение производительности. В этом случае необходимо найти различия и их важность. Если имеются важные запросы, которые приводят к снижению производительности, следует изучить изменения, внесенные в базовые планы SQL, или если запросы имеют ограничения на ресурсы. В этом случае можно применить некоторые указания по критическим запросам (например, измененный уровень совместимости, механизм оценки количества элементов) либо напрямую, либо с помощью структур планов, перестроение или создание статистики и индексов, которые могут повлиять на планы. 
- Большинство запросов выполняются медленнее Управляемый экземпляр по сравнению с исходным SQL Server. В этом случае попытайтесь выяснить основные причины разницы, например [достижение некоторого предела ресурсов]( sql-database-managed-instance-resource-limits.md#instance-level-resource-limits) , такого как ограничения операций ввода-вывода, ограничение объема памяти, ограничение частоты обращения к журналу экземпляра и т. д. Если ограничения ресурсов, которые могут вызвать разницу, отсутствуют, попробуйте изменить уровень совместимости базы данных или измените параметры базы данных, такие как устаревшая Оценка кратности, и повторно запустите тест. Ознакомьтесь с рекомендациями, предоставляемыми Управляемый экземпляр или представлениями хранилища запросов, чтобы выявление запросов с высокой производительностью.

> [!IMPORTANT]
> Управляемый экземпляр имеет встроенную функцию автоматического исправления плана, которая включена по умолчанию. Эта функция гарантирует, что запросы, которые работали в процессе вставки, не будут понижаться в будущем. Убедитесь, что эта функция включена и что вы выполнили рабочую нагрузку достаточно долго для старых параметров, прежде чем изменять новые параметры, чтобы Управляемый экземпляр ознакомиться с базовыми показателями производительности и планами.

Измените параметры или обновите уровни служб, чтобы выполнить согласование с оптимальной конфигурацией до тех пор, пока не будет выводится производительность рабочей нагрузки, соответствующая вашим потребностям.

### <a name="monitor-performance"></a>Мониторинг производительности

Управляемый экземпляр предоставляет множество дополнительных средств для мониторинга и устранения неполадок, и их следует использовать для наблюдения за производительностью экземпляра. Ниже приведены некоторые параметры, которые необходимо отслеживать.
- Использование ЦП на экземпляре для определения, соответствует ли подготовленное число виртуальных ядер, подходит для вашей рабочей нагрузки.
- Ожидаемый срок жизни страницы на Управляемый экземпляр для определения [необходимости дополнительной памяти](https://techcommunity.microsoft.com/t5/Azure-SQL-Database/Do-you-need-more-memory-on-Azure-SQL-Managed-Instance/ba-p/563444).
- Такие статистические `INSTANCE_LOG_GOVERNOR` данные `PAGEIOLATCH` , как или, будут сообщать о проблемах ввода-вывода хранилища, особенно на общего назначения уровне, где может потребоваться предварительное выделение файлов для повышения производительности ввода-вывода.

## <a name="leverage-advanced-paas-features"></a>Использование дополнительных функций PaaS

После того, как вы настроили полностью управляемую платформу и проверили, что Рабочая нагрузка производительность в соответствии с SQL Server производительностью рабочей нагрузки, воспользуйтесь преимуществами, предоставляемыми автоматически в рамках службы базы данных SQL. 

Даже если вы не вносите некоторые изменения в управляемый экземпляр во время миграции, существует большая вероятность того, что вы включите некоторые из новых функций, пока вы используете экземпляр, чтобы воспользоваться преимуществами последних улучшений ядра СУБД. Некоторые изменения включаются только после [изменения уровня совместимости базы данных](https://docs.microsoft.com/sql/relational-databases/databases/view-or-change-the-compatibility-level-of-a-database).


Например, вам не нужно будет создавать резервные копии в управляемом экземпляре — служба автоматически выполняет резервное копирование. Вам больше не нужно будет контролировать планирование, создание резервных копий и управление ими. Благодаря возможности [восстановления на определенный момент времени](sql-database-recovery-using-backups.md#point-in-time-restore) управляемый экземпляр позволяет восстанавливать данные на любой момент времени в пределах этого срока хранения. Кроме того, вам не нужно будет настраивать высокой уровень доступности, так как [он](sql-database-high-availability.md) встроен.

Чтобы усилить безопасность, рассмотрите возможность использования [Azure Active Directory проверки](sql-database-security-overview.md)подлинности, [аудита](sql-database-managed-instance-auditing.md), [обнаружения угроз](sql-database-advanced-data-security.md), [безопасности на уровне строк](https://docs.microsoft.com/sql/relational-databases/security/row-level-security)и [динамического маскирования данных](https://docs.microsoft.com/sql/relational-databases/security/dynamic-data-masking) ).

Помимо функций расширенного управления и безопасности Управляемый экземпляр предоставляет набор дополнительных средств, которые могут помочь в [мониторинге и настройке рабочей нагрузки](sql-database-monitor-tune-overview.md). [Аналитика SQL Azure](https://docs.microsoft.com/azure/azure-monitor/insights/azure-sql) позволяет отслеживать большой набор управляемых экземпляров и централизовать мониторинг большого количества экземпляров и баз данных. [Автоматическая настройка](https://docs.microsoft.com/sql/relational-databases/automatic-tuning/automatic-tuning#automatic-plan-correction) в управляемый экземпляр постоянно отслеживать производительность статистики выполнения плана SQL и автоматически устранять выявленные проблемы с производительностью.

## <a name="next-steps"></a>Следующие шаги

- Сведения об управляемом экземпляре см. в статье [Использование Управляемого экземпляра Базы данных SQL с виртуальными сетями и почти полной совместимостью](sql-database-managed-instance.md).
- Руководство со сведениями о восстановлении из резервной копии см. в статье [Краткое руководство. Создание Управляемого экземпляра Базы данных SQL Azure](sql-database-managed-instance-get-started.md).
- Руководство по миграции с помощью DMS см. в статье [Руководство. Перенос SQL Server в Управляемый экземпляр Базы данных SQL Azure с помощью DMS в автономном режиме](../dms/tutorial-sql-server-to-managed-instance.md).  
