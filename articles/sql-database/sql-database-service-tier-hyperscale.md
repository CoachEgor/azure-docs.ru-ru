---
title: Обзор уровня служб "Гипермасштабирование" Базы данных SQL Azure | Документация Майкрософт
description: В этой статье описывается уровень служб ценовой категории "Гипермасштабирование" в рамках модели приобретения на основе виртуальных ядер в службе "База данных SQL Azure" и объясняется, как он отличается от уровней служб ценовых категорий "Общего назначения" и "Критически важный для бизнеса".
services: sql-database
ms.service: sql-database
ms.subservice: ''
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: stevestein
ms.author: sstein
ms.reviewer: ''
ms.date: 05/06/2019
ms.openlocfilehash: ce6fc5d32fc9e17499a56cec7f4db2849370a1ec
ms.sourcegitcommit: 7c4de3e22b8e9d71c579f31cbfcea9f22d43721a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/26/2019
ms.locfileid: "68566718"
---
# <a name="hyperscale-service-tier-for-up-to-100-tb"></a>Уровень службы "горизонтальное масштабирование" до 100 ТБ

База данных SQL Azure основана на архитектуре ядра СУБД SQL Server, которая соответствует облачной среде, чтобы даже в случае сбоя инфраструктуры обеспечить доступность на уровне 99,99 %. Существует три модели архитектуры, которые используются в Базе данных SQL Azure.
- уровни "Общего назначения" или "Стандартный"; 
-  Гипермасштабирование
-  уровни "Критически важный для бизнеса" или "Премиум";

Уровень служб "Гипермасштабирование" в Базе данных SQL Azure — это новейший уровень в рамках модели приобретения на основе виртуальных ядер. Этот высокомасштабируемый уровень производительности ресурсов хранения и вычислений, который использует архитектуру Azure для масштабирования этих ресурсов для службы "База данных SQL Azure" за пределы, доступные для уровней служб "Общего назначения" и "Критически важный для бизнеса".

> 
> [!NOTE]
> См. подробнее об уровнях служб [Общего назначения](sql-database-service-tier-general-purpose.md) и [Критически важный для бизнеса](sql-database-service-tier-business-critical.md) в рамках модели приобретения на основе виртуальных ядер. Сравнение модели приобретения на основе виртуальных ядер и DTU см. в статье [Ресурсы и модели приобретения для Базы данных SQL Azure](sql-database-service-tiers.md).


## <a name="what-are-the-hyperscale-capabilities"></a>Каковы возможности ценовой категории "Гипермасштабирование"?

Уровень служб "Гипермасштабирование" в службе "База данных SQL Azure" предоставляет следующие дополнительные возможности:

- Поддержка размера базы данных до 100 ТБ.
- Почти мгновенное резервное копирование базы данных (на основе моментальных снимков файлов, хранящихся в хранилище BLOB-объектов Azure) независимо от размера без влияния ввода-вывода на ресурсы вычислений  
- Быстрое восстановление баз данных (на основе файлов моментальных снимков) за несколько минут, а не часов или дней (вне зависимости от размера операции с данными).
- Более высокая общая производительность благодаря высокой пропускной способности ведения журнала и ускоренному выполнению транзакций независимо от объемов данных.
- Быстрое горизонтальное масштабирование. Вы можете подготовить один или несколько узлов только для чтения, чтобы переносить на них рабочие нагрузки чтения и использовать эти узлы в качестве узлов горячей замены.
- Быстрое увеличение масштаба. Вы можете постоянно увеличивать масштаб вычислительных ресурсов, чтобы размещать крупные рабочие нагрузки по мере необходимости, а затем уменьшать их масштаб, когда они не нужны.

Уровень служб "Гипермасштабирование" устраняет многие практические ограничения, традиционно наблюдаемые в облачных базах данных. В то время как большинство других баз данных ограничены ресурсами, доступными на одном узле, базы данных на уровне служб "Гипермасштабирование" не имеют таких ограничений. Благодаря гибкой архитектуре хранилища его объем растет по мере необходимости. На самом деле базы данных уровня "Гипермасштабирование" не создаются с определенным максимальным размером. База данных уровня "Гипермасштабирование" растет по мере необходимости, поэтому плата взимается только за ту емкость, которую вы используете. Для рабочих нагрузок интенсивного чтения уровень служб "Гипермасштабирование" обеспечивает быстрое горизонтальное масштабирование путем подготовки дополнительных реплик чтения при необходимости перенести рабочие нагрузки.

Кроме того, время, необходимое для создания резервных копий базы данных или увеличения/уменьшения масштаба, больше не привязано к объему данных в базе данных. Резервные копии баз данных уровня "Гипермасштабирование" могут создаваться практически мгновенно. Увеличивать или уменьшать масштаб баз данных с десятками терабайт данных можно за считаные минуты. Вы больше не ограничены первоначальными вариантами конфигурации.

Дополнительные сведения о размерах вычислительных ресурсов для уровня служб "Гипермасштабирование" см. в разделе [Характеристики уровней служб](sql-database-service-tiers-vcore.md#service-tier-characteristics).

## <a name="who-should-consider-the-hyperscale-service-tier"></a>Кому рекомендуется использовать уровень служб "Гипермасштабирование"

Уровень служб "Гипермасштабирование" в первую очередь предназначен для клиентов с большими локальными базами данных, которые хотят модернизировать свои приложения, перейдя в облако, или для клиентов, которые уже находятся в облаке и ограничены максимальным размером базы данных (1–4 ТБ). Он также предназначен для клиентов, которым нужна высокая производительность и высокая масштабируемость для хранения и вычисления.

Уровень служб "Гипермасштабирование" поддерживает все рабочие нагрузки SQL Server, но в первую очередь он оптимизирован для OLTP. Он также поддерживает гибридные и аналитические (киоск данных) рабочие нагрузки.

> [!IMPORTANT]
> Эластичные пулы не поддерживают уровень служб "Гипермасштабирование".

## <a name="hyperscale-pricing-model"></a>Модель ценообразования для ценовой категории "Гипермасштабирование"

Уровень служб "Гипермасштабирование" доступен только в [модели на основе виртуальных ядер](sql-database-service-tiers-vcore.md). Ввиду новой архитектуры модель ценообразования несколько отличается от уровней служб "Общего назначения" или "Критически важный для бизнеса".

- **Среда выполнения приложений**

  Цена за единицу вычислений ценовой категории "Гипермасштабирование" на реплику. Цена [Преимущества гибридного использования Azure](https://azure.microsoft.com/pricing/hybrid-benefit/) автоматически применяется к репликам с масштабированием для чтения. По умолчанию создается первичная реплика и одна реплика только для чтения на каждую базу данных масштаба.  Пользователи могут изменять общее число реплик, включая первичную версию с 1-5.

- **Хранилище**

  Указывать максимальный объем данных при настройке базы данных ценовой категории "Гипермасштабирование" не нужно. На уровне служб ценовой категории "Гипермасштабирование" счета за использование хранилища для базы данных выставляются в зависимости от фактического использования. Размер хранилища автоматически выделяется от 10 ГБ до 100 ТБ, с приращениями, которые динамически корректируются между 10 ГБ и 40 ГБ.  

Дополнительные сведения о ценах категории "Гипермасштабирование" см. в разделе [цен на Базу данных SQL Azure](https://azure.microsoft.com/pricing/details/sql-database/single/).

## <a name="distributed-functions-architecture"></a>Архитектура распределенных функций

В отличие от традиционных ядер СУБД, в которых все функции управления данными централизованы в одном месте или процессе (даже в так называемых распределенных базах данных есть несколько копий монолитного механизма обработки данных), база данных уровня "Гипермасштабирование" отделяет механизм обработки запросов, где семантики различных модулей обработки данных расходятся, от компонентов, которые обеспечивают долговременное хранение и устойчивость данных. Таким образом, емкость хранилища может быть плавно масштабирована по мере необходимости (исходная цель составляет 100 ТБ). Реплики только для чтения используют одни и те же компоненты хранилища, поэтому копирование данных для новой доступной для чтения реплики не требуется. 

На следующей схеме представлены различные типы узлов в базе данных уровня "Гипермасштабирование".

![архитектура](./media/sql-database-hyperscale/hyperscale-architecture.png)

Ниже описаны типы узлов, содержащиеся в базе данных уровня "Гипермасштабирование".

### <a name="compute-node"></a>Вычислительный узел

На вычислительном узле расположен реляционный модуль, поэтому там находятся все элементы языка, операции обработки запросов и прочее. Все взаимодействия пользователя с базой данных уровня "Гипермасштабирование" происходят через эти вычислительные узлы. На вычислительных узлах выполняется кэширование на основе дисков SSD (именуемое на предыдущей схеме как RBPEX — отказоустойчивое расширение пула), чтобы минимизировать количество круговых путей в сети, необходимых для получения страницы данных. Существует один первичный вычислительный узел, где обрабатываются все транзакции и рабочие нагрузки чтения и записи. При этом есть один или несколько вторичных вычислительных узлов, которые выступают в качестве резервных узлов на случай отработки отказа, а также действуют как вычислительные узлы только для чтения для переноса рабочих нагрузок чтения (если эта функция необходима).

### <a name="page-server-node"></a>Узел сервера страниц

Серверы страниц — это системы, представляющие горизонтально масштабируемую подсистему хранилища.  Каждый сервер страниц отвечает за подмножество страниц в базе данных.  В номинальной мере каждый сервер страниц управляется данными между 128 ГБ и 1 ТБ. Данные совместно размещаются только на одном сервере страниц (за пределами реплик, созданных для обеспечения избыточности и доступности). Задача сервера страниц заключается в том, чтобы предоставлять страницы базы данных для вычислительных узлов по требованию и обновлять страницы, когда транзакции обновляют данные. Актуальность данных на серверах страниц обеспечивается за счет воспроизведения записей журнала из службы журналов. Серверы страниц также поддерживают кэширование на основе диска SSD, чтобы повысить производительность. Для обеспечения дополнительной надежности за долгосрочное хранение страниц данных отвечает служба хранилища Azure.

### <a name="log-service-node"></a>Узел службы журнала

Узел службы журнала принимает записи журнала из первичного вычислительного узла, сохраняет их в надежном кэше и отправляет на остальные вычислительные узлы (чтобы они могли обновить свои кэши), а также соответствующие серверы страниц для обновления данных. Таким образом, все изменения данных с основного вычислительного узла распространяются через службу журнала на все вторичные вычислительные узлы и серверы страниц. Наконец, записи журнала вытесняются на долгосрочное хранение в службу хранилища Azure, которая представляет собой неограниченный репозиторий. Этот механизм устраняет необходимость в частом усечении журнала. Служба журнала также имеет локальный кэш, ускоряющий доступ.

### <a name="azure-storage-node"></a>Узел хранилища Azure

Узел хранилища Azure является конечным пунктом назначения данных, полученных с серверов страниц. Это хранилище используется для целей резервного копирования, а также для репликации между регионами Azure. Резервные копии состоят из моментальных снимков файлов данных. На основе этих моментальных снимков быстро выполняются операции восстановления, и данные могут быть восстановлены в любой момент времени.

## <a name="backup-and-restore"></a>Резервное копирование и восстановление

Резервные копии основаны на моментальных снимках файлов, поэтому они почти мгновенные. Благодаря разделению хранения и вычисления можно перенести операции резервного копирования или восстановления на уровень хранения, чтобы снизить нагрузку на основной узел вычислений. В результате резервное копирование большой базы данных не влияет на производительность первичного вычислительного узла. Аналогичным образом восстановление выполняется путем копирования моментального снимка файла и поэтому не является объемной операцией с данными. Операция восстановления в той же учетной записи хранения выполняется быстро.

## <a name="scale-and-performance-advantages"></a>Преимущества масштабирования и производительности

Благодаря возможности быстро развертывать и свертывать дополнительные вычислительные узлы, предназначенные только для чтения, архитектура уровня "Гипермасштабирование" предоставляет значительные возможности масштабирования для чтения и также может освобождать первичный вычислительный узел для обслуживания большего количества запросов на запись. Кроме того, вычислительные узлы можно быстро увеличивать или уменьшать в масштабе благодаря архитектуре уровня "Гипермасштабирование" с общим хранилищем.

## <a name="create-a-hyperscale-database"></a>Создание базы данных ценовой категории "Гипермасштабирование"

Базу данных ценовой категории "Гипермасштабирование" можно создать с использованием [портала Azure](https://portal.azure.com), [T-SQL](https://docs.microsoft.com/sql/t-sql/statements/create-database-transact-sql?view=azuresqldb-current), [PowerShell](https://docs.microsoft.com/powershell/module/azurerm.sql/new-azurermsqldatabase) или [интерфейса командной строки](https://docs.microsoft.com/cli/azure/sql/db#az-sql-db-create). Базы данных ценовой категории "Гипермасштабирование"доступны только при использовании [модели приобретения на основе виртуальных ядер](sql-database-service-tiers-vcore.md).

Следующая команда T-SQL создает базу данных ценовой категории "Гипермасштабирование". Необходимо указать целевые выпуск и службу в инструкции `CREATE DATABASE`. Список допустимых целей обслуживания см. в разделе [ограничения ресурсов](https://docs.microsoft.com/azure/sql-database/sql-database-vcore-resource-limits-single-databases#hyperscale-service-tier) .

```sql
-- Create a HyperScale Database
CREATE DATABASE [HyperScaleDB1] (EDITION = 'HyperScale', SERVICE_OBJECTIVE = 'HS_Gen5_4');
GO
```
При этом будет создана база данных для масштабирования на го поколения оборудовании с 4 ядрами.

## <a name="migrate-an-existing-azure-sql-database-to-the-hyperscale-service-tier"></a>Перенос имеющейся базы данных Azure SQL на уровень служб ценовой категории "Гипермасштабирование"

Можно переместить существующие базы данных SQL Azure на уровень служб ценовой категории "Гипермасштабирование" с помощью [портала Azure](https://portal.azure.com), [T-SQL](https://docs.microsoft.com/sql/t-sql/statements/alter-database-transact-sql?view=azuresqldb-current), [PowerShell](https://docs.microsoft.com/powershell/module/azurerm.sql/set-azurermsqldatabase) или [интерфейса командной строки](https://docs.microsoft.com/cli/azure/sql/db#az-sql-db-update). В настоящее время это односторонняя миграция. Невозможно переместить базы данных с уровня служб "Гипермасштабирование" на другой уровень служб. Мы рекомендуем сделать копию ваших рабочих баз данных и выполнить перенос на уровень "Гипермасштабирование" для подтверждения концепции.

Следующие команды T-SQL перемещает базу данных на уровень служб ценовой категории "Гипермасштабирование". Необходимо указать целевые выпуск и службу в инструкции `ALTER DATABASE`.

```sql
-- Alter a database to make it a HyperScale Database
ALTER DATABASE [DB2] MODIFY (EDITION = 'HyperScale', SERVICE_OBJECTIVE = 'HS_Gen5_4');
GO
```

## <a name="connect-to-a-read-scale-replica-of-a-hyperscale-database"></a>Подключение к реплике базы данных ценовой категории "Гипермасштабирование", доступной только для чтения

В базах данных ценовой категории "Гипермасштабирование" передаваемый клиентом аргумент `ApplicationIntent` в строке подключения определяет, куда направляется подключение: к реплике для записи или к вторичной реплике только для чтения. Если параметру `ApplicationIntent` присвоено значение `READONLY` и у базы данных нет вторичной реплике, подключение будет направляться к первичной реплике в режиме по умолчанию `ReadWrite`.

```cmd
-- Connection string with application intent
Server=tcp:<myserver>.database.windows.net;Database=<mydatabase>;ApplicationIntent=ReadOnly;User ID=<myLogin>;Password=<myPassword>;Trusted_Connection=False; Encrypt=True;
```
## <a name="disaster-recovery-for-hyperscale-databases"></a>Аварийное восстановление для баз данных с масштабированием
### <a name="restoring-a-hyperscale-database-to-a-different-geography"></a>Восстановление базы данных с помощью масштабирования в другую географию
Если необходимо восстановить базу данных SQL Azure с помощью службы масштабирования в регионе, отличном от того, на котором она размещена в, в рамках операции аварийного восстановления или детализации, перемещения или любой другой причины, основной метод заключается в выполнении географического восстановления базы данных.  Это включает в себя те же действия, что и при восстановлении любой другой базы данных SQL AZURE в другом регионе.
1. Создайте сервер базы данных SQL в целевом регионе, если у вас еще нет соответствующего сервера.  Этот сервер должен принадлежать той же подписке, что и исходный (исходный) сервер.
2. Следуйте инструкциям в разделе географическое [Восстановление](https://docs.microsoft.com/azure/sql-database/sql-database-recovery-using-backups#geo-restore) на странице Восстановление баз данных SQL Azure из автоматически создаваемых резервных копий.

> [!NOTE]
> Так как исходный и целевой объекты находятся в разных регионах, база данных не может совместно использовать хранилище моментальных снимков с базой данных-источником, как и в случае географического восстановления, что выполняется очень быстро.  В случае географического восстановления базы данных с масштабированием это будет операция с размером данных, даже если целевой объект находится в парной области геореплицированного хранилища.  Это означает, что выполнение геовосстановления займет некоторое время, пропорциональное размеру восстанавливаемой базы данных.  Если целевой объект находится в парном регионе, копия будет находиться в центре обработки данных, что будет значительно быстрее, чем копия с длинным расстоянием по Интернету, но все биты все равно будут скопированы.

## <a name=regions></a>Доступные регионы

Уровень масштабирования базы данных SQL Azure в настоящее время доступен в следующих регионах:

- Восточная Австралия
- Юго-восточная Австралия
- Южная Бразилия
- Центральная Канада
- Центральная часть США
- Восточный Китай 2
- Северный Китай 2
- Восточная Азия
- East US
- Восточная часть США 2
- Центральная Франция
- Восточная Япония
- Западная Япония
- Центральная Корея
- Республика Корея, южный регион
- Центрально-северная часть США
- Северная Европа
- северная часть ЮАР
- Центрально-южная часть США
- Юго-Восточная Азия
- Южная часть Соединенного Королевства
- Западная часть Соединенного Королевства
- Западная Европа
- Западная часть США
- Западная часть США 2

Если вы хотите создать базу данных для масштабирования в регионе, который не указан как поддерживаемый, можно отправить запрос на подключение с помощью портал Azure. Мы работаем над тем, чтобы расширить список поддерживаемых регионов, поэтому вернитесь к списку последних регионов.

Чтобы запросить возможность создания баз данных для масштабирования в регионах, не перечисленных в списке, выполните следующие действия.

1. Перейдите в [колонку "Справка и поддержка Azure](https://portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/overview) "

2. Щелкните [ **новый запрос в службу поддержки**](https://ms.portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/newsupportrequest)

    ![Колонка "Справка и поддержка Azure"](media/sql-database-service-tier-hyperscale/whitelist-request-screen-1.png)

3. Для **типа проблемы**выберите **пределы служб и подписок (квоты)** .

4. Выберите подписку, которая будет использоваться для создания баз данных

5. Для **типа квоты**выберите **база данных SQL** .

6. Щелкните **Далее: Решения**

1. Щелкните **указать подробности** .

    ![Сведения о проблеме](media/sql-database-service-tier-hyperscale/whitelist-request-screen-2.png)

8. Выберите **тип квоты базы данных SQL**: **Другой запрос квоты**

9. Заполните следующий шаблон:

    ![Сведения о квотах](media/sql-database-service-tier-hyperscale/whitelist-request-screen-3.png)

    В шаблоне укажите следующие сведения.

    > Запрос на создание базы данных SQL Azure Scale в новом регионе<br/> Регион: [заполните запрошенный регион]  <br/>
    > Расчет SKU/общее число ядер, включая доступные для чтения реплики <br/>
    > Предполагаемое количество ТБ 
    >

10. Выберите **Уровень серьезности C**.

11. Выберите подходящий метод связи и заполните подробные сведения.

12. Нажмите кнопку **сохранить** и **продолжить** .

## <a name="known-limitations"></a>Известные ограничения
Это текущие ограничения для уровня службы "линейка" в общедоступной версии.  Мы активно работаем над удалением максимально возможного множества этих ограничений.

| Проблемы | Описание |
| :---- | :--------- |
| Панель "Управление резервными копиями" для логического сервера не показывает, что базы данных с таким масштабированием будут отфильтрованы из SQL Server  | У меня есть отдельный метод для управления резервными копиями, и, как это долгосрочное хранение и параметры хранения резервных копий на момент времени, не применяются или становятся недействительными. Следовательно, базы данных ценовой категории "Гипермасштабирование" не отображаются в области "Управление резервными копиями". |
| Восстановление до точки во времени | После переноса базы данных на уровень службы "масштабирование" восстановление до точки во времени до миграции не поддерживается.|
| Восстановление базы данных, отличной от Хипсерскале, и наоборот | Невозможно восстановить базу данных с масштабированием в базу данных, не отменяя возможности масштабирования, а также восстановить базу данных без возможности масштабирования в базу данных для масштабирования.|
| Если файл базы данных увеличивается во время переноса из-за активной рабочей нагрузкой и превышает максимальный размер файла, равный 1 ТБ, происходит сбой. | Устранение рисков: <br> Если это возможно, перенесите базу данных при отсутствии активных рабочих нагрузок.<br> Повторите попытку переноса. Она будет успешной, если во время переноса не будет превышен максимальный размер фа1ла, равный 1 ТБ.|
| Управляемый экземпляр | Управляемый экземпляр Базы данных SQL Azure в настоящее время не поддерживается в базах данных с поддержкой масштабирования. |
| Пулы эластичных БД |  В настоящее время эластичные пулы не поддерживаются при масштабировании базы данных SQL.|
| Сейчас переход на ценовую категорию "Гипермасштабирование" является необратимой операцией. | После переноса базы данных на уровень служб ценовой категории "Гипермасштабирование" ее невозможно перенести непосредственно на другой уровень служб. Сейчас единственным способом перенести базу данных с уровня служб ценовой категории "Гипермасштабирование" на другой уровень служб является ее экспорт и импорт с помощью BACPAC-файла.|
| Миграция баз данных с постоянными объектами в памяти | Масштабирование поддерживает только непостоянные объекты в памяти (типы таблиц, собственные SPs и функции).  Постоянные таблицы в памяти и другие объекты должны быть удалены и воссозданы как объекты, не являющиеся объектами в памяти, перед переносом базы данных на уровень служб с поддержкой службы "масштабирование".|
| Отслеживание измененных данных | Вы не сможете использовать отслеживание измененных данных в базах данных с использованием масштабирования. |
| Георепликация  | Вы еще не можете настроить георепликацию для масштабирования базы данных SQL Azure.  Вы можете выполнять геовосстановление (восстановление базы данных в другой географии, для аварийного восстановления или в других целях). |
| Интеграция TDE и AKV | Прозрачное шифрование базы данных с помощью Azure Key Vault (которое обычно называется "TDE" с собственным ключом или BYOK) еще не поддерживается для функции масштабирования базы данных SQL Azure, однако с ключами, управляемыми службой, полностью поддерживается. |
|Интеллектуальные функции баз данных | 1. Создание индекса и удаление моделей с рекомендациями по индексам не обучены для баз данныхов в масштабах. <br/>2. Проблемы с схемой. Недавно добавленные Дбпараметеризатион не поддерживаются для базы данных с поддержкой масштабирования.|



## <a name="next-steps"></a>Следующие шаги

- Вопросы и ответы о ценовой категории "Гипермасштабирование" приведены в разделе [часто задаваемых вопросов о ценовой категории "Гипермасштабирование"](sql-database-service-tier-hyperscale-faq.md).
- Сведения об уровнях служб см. в статье [Ресурсы и модели приобретения для базы данных SQL Azure](sql-database-service-tiers.md).
- Сведения об ограничениях на уровнях сервера и подписки см. в статье [SQL Database resource limits for single and pooled databases on a logical server](sql-database-resource-limits-logical-server.md) (Ограничения ресурсов Базы данных SQL для отдельных баз данных и баз данных в пуле на логическом сервере).
- Ограничения моделей приобретения для отдельной базы данных описаны в разделе [Ограничения ресурсов для отдельной базы данных в Базе данных SQL Azure при использовании модели приобретения на основе виртуальных ядер](sql-database-vcore-resource-limits-single-databases.md).
- Сведения о функциях и список сравнения см. в статье [Сравнение функций Базы данных SQL Azure и SQL Server](sql-database-features.md).
