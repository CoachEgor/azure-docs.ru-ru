---
title: Рекомендации по обеспечению безопасности сборник тренировочных заданий для базы данных SQL Azure | Документация Майкрософт
description: В этой статье приводятся общие рекомендации по обеспечению безопасности в базе данных SQL Azure.
ms.service: sql-database
ms.subservice: security
author: VanMSFT
ms.author: vanto
ms.topic: article
ms.date: 12/23/2019
ms.reviewer: ''
ms.openlocfilehash: f93ab61fcba53ebf39adf8ad56137f4a1df7d5fd
ms.sourcegitcommit: 003e73f8eea1e3e9df248d55c65348779c79b1d6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/02/2020
ms.locfileid: "75615022"
---
# <a name="azure-sql-database-security-best-practices-playbook"></a>Рекомендации по обеспечению безопасности базы данных SQL Azure сборник тренировочных заданий

## <a name="overview"></a>Обзор

В этом документе содержатся рекомендации по решению общих требований к безопасности для новых или существующих приложений, использующих базу данных SQL Azure. Он упорядочен по областям безопасности высокого уровня. Сведения об устранении конкретных угроз см. в разделе [Общие угрозы безопасности и возможные способы их устранения](#common-security-threats-and-potential-mitigations) . Хотя некоторые из представленных рекомендаций применимы при переносе приложений из локальной среды в Azure, сценарии миграции не касаются этого документа.

### <a name="azure-sql-database-deployment-offers-covered-in-this-guide"></a>Предложения по развертыванию базы данных SQL Azure, описанные в этом разделе

- [Базы данных SQL](https://docs.microsoft.com/azure/sql-database/sql-database-single-index): [отдельные базы данных](sql-database-single-database.md) и [эластичные ПУЛЫ](sql-database-elastic-pool.md) на [серверах базы данных SQL Azure](sql-database-servers.md)
- [Управляемые экземпляры](https://docs.microsoft.com/azure/sql-database/sql-database-managed-instance-index)

### <a name="sql-deployment-offers-not-covered-in-this-guide"></a>Предложения по развертыванию SQL, не описываемые в этом разделе

- Хранилище данных SQL Azure
- Виртуальные машины SQL Azure (IaaS)
- Локальный сервер SQL Server

### <a name="audience"></a>Аудитория

Целевыми аудиторами для этого руководства являются клиенты, которые задают вопросы о том, как защитить базу данных SQL Azure. Роли, заинтересованные в этой рекомендации, включают в себя, но не только:

- Архитекторы системы безопасности
- Диспетчеры безопасности
- Должностные лица по соответствию
- Сотрудники по конфиденциальности
- Инженеры по безопасности

### <a id="using"></a>Использование этого руководством

Этот документ предназначен для дополнения к существующей документации по [безопасности базы данных SQL Azure](sql-database-security-overview.md) .

Если не указано иное, для достижения соответствующей цели или требования рекомендуется следовать всем рекомендациям, перечисленным в каждом разделе. В соответствии с определенными стандартами соответствия требованиям безопасности или рекомендациями важные средства контроля соответствия нормативным требованиям перечислены в разделе требования или цели, где это применимо. Ниже приведены стандарты безопасности и нормативные положения, упоминаемые в этом документе.

- [FedRAMP](https://www.fedramp.gov/documents/): AC-04, AC-06
- [SoC](https://www.aicpa.org/interestareas/frc/assuranceadvisoryservices/sorhome.html): cm-3, SDL-3
- [ISO/IEC 27001](https://www.iso27001security.com/html/27001.html): контроль доступа, шифрование
- [Рекомендации по работе с Microsoft Operation Security Assurance (OSA)](https://www.microsoft.com/en-us/securityengineering/osa/practices): упражнения #1-6 и #9
- [Специальные средства управления безопасностью публикации 800-53](https://nvd.nist.gov/800-53): AC-5, AC-6
- [PCI DSS](https://www.pcisecuritystandards.org/document_library): 6.3.2, 6.4.2

### <a name="feedback"></a>Обратная связь

Мы планируем продолжить обновление рекомендаций и рекомендаций, перечисленных здесь. Укажите входные данные или любые исправления для этого документа, используя ссылку **отзыва** в нижней части этой статьи.

## <a name="authentication"></a>Проверка подлинности

Аутентификацией называют процесс подтверждения личности пользователя. База данных SQL Azure поддерживает два типа аутентификации:

- Проверка подлинности SQL
- Проверка подлинности Azure Active Directory

### <a name="central-management-for-identities"></a>Централизованное управление удостоверениями

Централизованное управление удостоверениями обеспечивает следующие преимущества.

- Управление учетными записями групп и управление разрешениями пользователей без дублирования имен входа между серверами и базами данных SQL Azure.
- Упрощенное и гибкое управление разрешениями.
- Управление масштабируемыми приложениями.

**Как реализовать**:

- Используйте проверку подлинности Azure Active Directory (Azure AD) для централизованного управления удостоверениями.

**Рекомендация**.

- Создание клиента Azure AD и [Создание пользователей](../active-directory/fundamentals/add-users-azure-active-directory.md) для представления пользователей и создание [субъектов-служб](../active-directory/develop/app-objects-and-service-principals.md) для представления приложений, служб и средств автоматизации. Субъекты-службы эквивалентны учетным записям служб в Windows и Linux. 

- Назначение прав доступа к ресурсам участникам Azure AD с помощью назначения групп: создание групп Azure AD, предоставление доступа к группам и Добавление отдельных членов в группы. В базе данных создайте пользователей автономной базы данных, которые сопоставляют группы Azure AD. 
  - См. статьи, [Настройка проверки подлинности Azure Active Directory и управление ею с помощью SQL](sql-database-aad-authentication-configure.md) и [Использование Azure AD для проверки подлинности с помощью SQL](sql-database-aad-authentication.md).
  > [!NOTE]
  > В управляемом экземпляре можно также создать имена входа, которые сопоставляются с субъектами Azure AD в базе данных master. См. [инструкции по созданию имени входа (Transact-SQL)](https://docs.microsoft.com/sql/t-sql/statements/create-login-transact-sql?view=azuresqldb-mi-current).

- Использование групп Azure AD упрощает управление разрешениями и владельцем группы, а владелец ресурса может добавлять или удалять членов группы. 

- Создайте отдельную группу для администратора Azure AD для серверов базы данных SQL.

  - См. статью [о подготовке администратора Azure Active Directory для сервера базы данных SQL Azure](sql-database-aad-authentication-configure.md#provision-an-azure-active-directory-administrator-for-your-azure-sql-database-server).

- Отслеживайте изменения членства в группах Azure AD с помощью отчетов по действиям аудита Azure AD. 

- Для управляемого экземпляра требуется отдельный шаг для создания администратора Azure AD. 
  - См. статью [о подготовке администратора Azure Active Directory для управляемого экземпляра](sql-database-aad-authentication-configure.md#provision-an-azure-active-directory-administrator-for-your-managed-instance). 

> [!NOTE]
> - Проверка подлинности Azure AD записывается в журналы аудита SQL Azure, но не в журналы входа Azure AD.
> - Разрешения RBAC, предоставленные в Azure, не применяются к разрешениям базы данных SQL Azure. Такие разрешения должны создаваться и сопоставляться вручную в базе данных SQL с использованием существующих разрешений SQL.
> - Для аутентификации Azure AD на стороне клиента требуется доступ к Интернету или через определенный пользователем маршрут (UDR) к виртуальной сети.
> - Маркер доступа Azure AD кэшируется на стороне клиента, и его время существования зависит от конфигурации токена. См. статью Настройка [времени жизни маркеров в Azure Active Directory](../active-directory/develop/active-directory-configurable-token-lifetimes.md)

### <a name="multi-factor-authentication-mfa"></a>Многофакторная идентификация (MFA)

> [!NOTE]
> Упоминалось в: упражнения #2, контроль доступа ISO (AC)

Многофакторная идентификация Azure (MFA) помогает повысить безопасность, запросив более одной формы проверки подлинности.

**Как реализовать**:

- [Включение MFA](../active-directory/authentication/concept-mfa-howitworks.md) в Azure AD с помощью условного доступа и использование интерактивной проверки подлинности. 

- Альтернативой является включение MFA для всего домена Azure AD или AD.

**Рекомендация**.

- Активация условного доступа в Azure AD (требуется подписка уровня "Премиум"). 
  - См. статью об [условном доступе в Azure AD](../active-directory/conditional-access/overview.md).  

- Создайте группы Azure AD и включите политику MFA для выбранных групп с помощью условного доступа Azure AD. 
  - См. статью [Планирование развертывания условного доступа](../active-directory/conditional-access/plan-conditional-access.md). 

- MFA можно включить для всей службы Azure AD или для всей Active Directory Федеративной с Azure AD. 

- Используйте режим интерактивной проверки подлинности Azure AD для базы данных SQL, где пароль запрашивается в интерактивном режиме, после чего используется проверка подлинности MFA:      
  - Используйте универсальную проверку подлинности в SSMS. См. статью [Использование многофакторной проверки подлинности AAD с базой данных SQL Azure и хранилищем данных SQL Azure (поддержка SSMS для MFA)](sql-database-ssms-mfa-authentication.md).
  - Используйте поддержку интерактивной проверки подлинности в SQL Server Data Tools (SSDT). См. статью [Azure Active Directory поддержка в SQL Server Data Tools (SSDT)](https://docs.microsoft.com/sql/ssdt/azure-active-directory?view=azuresqldb-current).
  - Используйте другие средства SQL, поддерживающие MFA. 
    - Поддержка мастера SSMS для экспорта, извлечения и развертывания базы данных  
    - [SqlPackage. exe](https://docs.microsoft.com/sql/tools/sqlpackage): параметр "/УА" 
    - [программа sqlcmd](https://docs.microsoft.com/sql/tools/sqlcmd-utility): параметр-G (интерактивный)
    - [программа bcp](https://docs.microsoft.com/sql/tools/bcp-utility): параметр-G (интерактивный) 

- Реализуйте приложения для подключения к базе данных SQL Azure с помощью интерактивной проверки подлинности с поддержкой MFA. 
  - См. статью [Подключение к базе данных SQL Azure с помощью многофакторной идентификации Azure](active-directory-interactive-connect-azure-sql-db.md). 
  > [!NOTE]
  > Для этого режима проверки подлинности требуются удостоверения на основе пользователя. В случаях, когда используется надежная модель удостоверений, которая обходит индивидуальную проверку подлинности пользователя Azure AD (например, использование управляемого удостоверения для ресурсов Azure), MFA не применяется.

### <a name="minimize-the-use-of-password-based-authentication-for-users"></a>Сокращение использования проверки подлинности на основе пароля для пользователей

> [!NOTE]
> Упоминалось в: упражнения #4, контроль доступа ISO (AC)

Методы проверки подлинности на основе пароля являются более слабой формой проверки подлинности. Учетные данные могут быть скомпрометированы или ошибочно переданы.

**Как реализовать**:

- Используйте встроенную проверку подлинности Azure AD, которая исключает использование паролей.

**Рекомендация**.

- Используйте проверку подлинности единого входа, используя учетные данные Windows. Включите в Федерацию локальный домен AD с Azure AD и используйте встроенную проверку подлинности Windows (для компьютеров, присоединенных к домену, с помощью Azure AD).
  - См. статью [Поддержка SSMS для встроенной проверки подлинности Azure AD](sql-database-aad-authentication-configure.md#active-directory-integrated-authentication).

### <a name="minimize-the-use-of-password-based-authentication-for-applications"></a>Сокращение использования проверки подлинности на основе пароля для приложений 

> [!NOTE]
> Упоминалось в: упражнения #4, контроль доступа ISO (AC)

**Как реализовать**:

- Включите управляемое удостоверение Azure. Можно также использовать встроенную проверку подлинности или аутентификацию на основе сертификатов. 

**Рекомендация**.

- Используйте [управляемые удостоверения для ресурсов Azure](../active-directory/managed-identities-azure-resources/overview.md).
  - [Управляемое удостоверение, назначенное системой](../active-directory/managed-identities-azure-resources/tutorial-windows-vm-access-sql.md) 
  - [Управляемое удостоверение, назначенное пользователем](../active-directory/managed-identities-azure-resources/how-to-manage-ua-identity-portal.md)
  - [Использование базы данных SQL Azure из службы приложений с управляемым удостоверением (без изменений кода)](https://github.com/Azure-Samples/app-service-msi-entityframework-dotnet)

- Использование проверки подлинности на основе сертификатов для приложения. 
  - См. Этот [пример кода](https://github.com/Microsoft/sql-server-samples/tree/master/samples/features/security/azure-active-directory-auth/token). 

- Используйте проверку подлинности Azure AD для интегрированного федеративного домена и компьютера, присоединенного к домену (см. раздел выше).
  - См. [пример приложения для встроенной проверки подлинности](https://github.com/Microsoft/sql-server-samples/tree/master/samples/features/security/azure-active-directory-auth/integrated).

### <a name="protect-passwords-and-secrets"></a>Защита паролей и секретов

В случаях, когда пароли не могут быть устранены, убедитесь, что они защищены.

**Как реализовать**:

- Используйте Azure Key Vault для хранения паролей и секретов. При необходимости используйте MFA для базы данных SQL Azure с пользователями Azure AD.

**Рекомендация**.

- Если не удается избежать паролей или секретов, Храните пароли пользователей и секреты приложений в Azure Key Vault и управляйте доступом с помощью политик доступа Key Vault. 

- Различные платформы разработки приложений также могут предлагать механизмы для защиты секретов в приложении. Например: [ASP.NET Core App](https://docs.microsoft.com/aspnet/core/security/app-secrets?view=aspnetcore-2.1&tabs=windows).

### <a name="use-sql-authentication-for-legacy-applications"></a>Использовать проверку подлинности SQL для устаревших приложений 

Проверка подлинности SQL означает проверку подлинности пользователя при подключении к базе данных SQL Azure с помощью имени пользователя и пароля. Имя входа необходимо создать на каждом сервере базы данных SQL или управляемом экземпляре, а также создать пользователя в каждой базе данных.

**Как реализовать**:

- Использовать проверку подлинности SQL.

**Рекомендация**.

- Создайте имена входа и пользователей в качестве администратора сервера. Если пользователи автономной базы данных не используют пароли, все пароли хранятся в базе данных master.
  - См. статью Управление доступом к базе данных [SQL и хранилище данных SQL и предоставление доступа к ним](sql-database-manage-logins.md).

- Следуйте рекомендациям по управлению паролями:
  - Укажите сложный пароль, состоящий из латинских прописных и строчных букв, цифр (0-9) и символов, отличных от алфавитно-цифровых (например, $,!, # или%).
  - Используйте более длинные парольные фразы вместо коротких случайных случайно выбранных символов.
  - Принудительное изменение пароля вручную по крайней мере каждые 90 дней.

## <a name="access-management"></a>Управление доступом

Управление доступом — это процесс управления доступом и привилегиями полномочных пользователей к базе данных SQL Azure и управления ими.

### <a name="implement-principle-of-least-privilege"></a>Принцип реализации наименьших привилегий

> [!NOTE]
> Упоминается в: FedRamp Controls AC-06, NIST: AC-6, практика OSA #3

Принцип наименьших привилегий указывает, что пользователи не должны иметь больше прав, чем требовалось для выполнения своих задач. Дополнительные сведения см. в статье [достаточное администрирование](https://docs.microsoft.com/powershell/scripting/learn/remoting/jea/overview).

**Как реализовать**:

Назначьте только необходимые [разрешения](https://docs.microsoft.com/sql/relational-databases/security/permissions-database-engine) для выполнения необходимых задач:

- В плоскости данных SQL: 
    - Используйте детализированные разрешения и определяемые пользователем роли базы данных (или роли сервера в MI): 
        1. Создание необходимых ролей
            - [CREATE ROLE](https://docs.microsoft.com/sql/t-sql/statements/create-role-transact-sql)
            - [СОЗДАНИЕ РОЛИ СЕРВЕРА](https://docs.microsoft.com/sql/t-sql/statements/create-server-role-transact-sql)
        1. Создание необходимых пользователей
            - [CREATE USER](https://docs.microsoft.com/sql/t-sql/statements/create-user-transact-sql)
        1. Добавление пользователей в качестве членов ролей 
            - [ALTER ROLE](https://docs.microsoft.com/sql/t-sql/statements/alter-role-transact-sql)
            - [ALTER SERVER ROLE](https://docs.microsoft.com/sql/t-sql/statements/alter-server-role-transact-sql)
        1. Затем назначьте разрешения ролям. 
            - [GRANT](https://docs.microsoft.com/sql/t-sql/statements/grant-transact-sql) 
    - Не следует назначать пользователям ненужные роли.

- В Azure Resource Manager:
  - Используйте встроенные роли, если доступны или пользовательские роли RBAC, и назначьте необходимые разрешения.
    - [Встроенные роли для Azure](../role-based-access-control/built-in-roles.md) 
    - [Пользовательские роли для ресурсов Azure](../role-based-access-control/custom-roles.md)

**Рекомендация**.

Следующие рекомендации являются необязательными, но приводят к лучшей управляемости и поддержке стратегии безопасности: 

- Если это возможно, начните с минимально возможного набора разрешений и приступите к добавлению разрешений один за другим, если есть реальная потребность (и обоснование), в отличие от противоположного подхода: не отменяйте разрешения пошагово. 

- Не следует назначать разрешения отдельным пользователям. Вместо этого следует использовать роли (роли базы данных или сервера). Роли помогают в значительной мере создавать отчеты и разрешения на устранение неполадок. (В Azure RBAC поддерживается только назначение разрешений через роли.) 

- Используйте встроенные роли, если разрешения ролей точно соответствуют необходимым для пользователя разрешениям. Можно назначить пользователей нескольким ролям. 

- Создавайте и используйте пользовательские роли, если встроенные роли предоставляют слишком много или недостаточно разрешений. Типичные роли, используемые на практике: 
  - Развертывание системы безопасности 
  - Администратор 
  - Developer 
  - Персонал службы поддержки 
  - Аудитор 
  - Автоматизированные процессы 
  - Конечный пользователь 

- Помните, что разрешения в SQL Server ядро СУБД могут быть применены к следующим областям. Чем меньше область, тем меньше воздействие предоставленных разрешений: 
  - Сервер базы данных SQL Azure (специальные роли в базе данных master) 
  - База данных 
  - Схема (также см. [структуру схемы для SQL Server: рекомендации по проектированию схем с](http://andreas-wolter.com/en/schema-design-for-sql-server-recommendations-for-schema-design-with-security-in-mind/)учетом безопасности)
  - Объект (таблица, представление, процедура и т. д.) 
  > [!NOTE]
  > Не рекомендуется применять разрешения на уровне объектов, так как этот уровень добавляет ненужную сложность в общую реализацию. Если вы решили использовать разрешения уровня объектов, они должны быть четко документированы. То же относится и к разрешениям уровня столбца, что еще менее рекомендовано по тем же причинам. Стандартные правила для [Deny](https://docs.microsoft.com/sql/t-sql/statements/deny-object-permissions-transact-sql) не применяются к столбцам.

- Выполните обычные проверки, используя [оценку уязвимостей (ва)](https://docs.microsoft.com/sql/relational-databases/security/sql-vulnerability-assessment) для проверки наличия слишком большого количества разрешений.

### <a name="implement-separation-of-duties"></a>Реализация разделения обязанностей

> [!NOTE]
> Упоминалось в: FedRamp: AC-04, NIST: AC-5, ISO: A. 6.1.2, PCI 6.4.2, SOC: CM-3, SDL-3

Разделение обязанностей, также называемое разделением обязанностей, описывает требование разбиения конфиденциальных задач на несколько задач, назначенных разным пользователям, обычно для предотвращения нарушений данных.

**Как реализовать**:

- Определяет требуемый уровень разделения обязанностей. Примеры. 
  - Между средой разработки и тестирования и рабочими средами 
  - Задачи на уровне управления, ориентированные на безопасность и администраторы баз данных (DBA), и задачи разработчика. 
    - Примеры: аудитория, создание политики безопасности для безопасности на уровне ролей (RLS), реализация объектов базы данных SQL с помощью DDL-разрешений.

- Выявление комплексной иерархии пользователей (и автоматизированных процессов), обращающихся к системе.

- Создайте роли в соответствии с необходимыми группами пользователей и назначьте разрешения ролям. 
  - Для задач уровня управления в портал Azure или с помощью автоматизации PowerShell используйте роли RBAC. Либо найдите встроенную роль, соответствующую требованию, либо создайте настраиваемую роль RBAC с помощью доступных разрешений. 
  - Создание ролей сервера для задач на уровне сервера (создание новых имен входа, баз данных) в управляемом экземпляре. 
  - Создание ролей базы данных для задач уровня базы данных.

- Для некоторых конфиденциальных задач рекомендуется создавать специальные хранимые процедуры, подписанные сертификатом, для выполнения задач от имени пользователей. 
  - Пример: [учебник. Подписывание хранимых процедур с помощью сертификата](https://docs.microsoft.com/sql/relational-databases/tutorial-signing-stored-procedures-with-a-certificate) 

- Реализуйте прозрачное шифрование данных (TDE) с ключами, управляемыми клиентом, в Azure Key Vault, чтобы обеспечить разделение обязанностей между владельцем данных и владельцем безопасности. 
  - См. статью [Настройка ключей, управляемых клиентом, для шифрования службы хранилища Azure из портал Azure](../storage/common/storage-encryption-keys-portal.md). 

- Чтобы администратор базы данных не мог видеть данные, которые считаются строго конфиденциальными и по-прежнему могут выполнять задачи администратора, можно использовать Always Encrypted с разделением ролей. 
  - См. статьи [Обзор управления ключами для Always encrypted](https://docs.microsoft.com/sql/relational-databases/security/encryption/overview-of-key-management-for-always-encrypted), [подготовки ключей с разделением ролей](https://docs.microsoft.com/sql/relational-databases/security/encryption/configure-always-encrypted-keys-using-powershell#KeyProvisionWithRoles)и [смены главного ключа столбца с разделением ролей](https://docs.microsoft.com/sql/relational-databases/security/encryption/rotate-always-encrypted-keys-using-powershell#column-master-key-rotation-with-role-separation). 

- В тех случаях, когда это не является целесообразным, не требуя значительных затрат и усилий, которые могут привести к невозможности использования системы в ближайшем будущем, компромиссы могут быть сделаны и устранены с помощью компенсирующих элементов управления, таких как: 
  - Вмешательство человека в процессах. 
  - Журналы аудита — дополнительные сведения об аудите см. в разделе [Аудит критических событий безопасности](#audit-critical-security-events).

**Рекомендация**.

- Убедитесь, что для разработки, тестирования и рабочей среды используются разные учетные записи. Разные учетные записи помогают в соответствии с разделением тестовых & рабочих систем.

- Не следует назначать разрешения отдельным пользователям. Вместо этого следует использовать роли (роли базы данных или сервера). Наличие ролей позволяет значительно упростить создание отчетов и разрешение на их устранение.

- Используйте встроенные роли, если разрешения точно совпадают с необходимыми разрешениями. Если объединение всех разрешений из нескольких встроенных ролей приводит к совпадению 100%, можно одновременно назначить несколько ролей. 

- Создавайте и используйте пользовательские роли, если встроенные роли предоставляют слишком много разрешений или не имеют достаточных разрешений. 

- Назначения ролей также можно временно выполнять, также называемых динамическим разделением обязанностей (DSD), в шагах задания агента SQL в T-SQL или с помощью Azure PIM для ролей RBAC. 

- Убедитесь, что у администраторов баз данных нет доступа к ключам шифрования или хранилищам ключей и администраторам безопасности, у которых доступ к этим ключам нет в очереди. 

- Всегда убедитесь, что у вас есть журнал аудита для действий, связанных с безопасностью. 

- Вы можете получить определение встроенных ролей RBAC, чтобы просмотреть используемые разрешения и создать настраиваемую роль на основе фрагментов и кумулатионс их с помощью PowerShell. 

- Поскольку любой член роли базы данных db_owner может изменить такие параметры безопасности, как прозрачное шифрование данных (TDE), или изменить цель уровня обслуживания, это членство следует предоставлять с осторожностью. С другой стороны, многие задачи, такие как изменение параметров базы данных, такие как изменение настроек БД, требуют db_owner привилегий. Аудит играет ключевую роль в любом решении.

- Невозможно предотвратить просмотр db_owner данных пользователя только с разрешениями. Если в базе данных есть данные с высокой степенью секретности, Always Encrypted можно использовать для безопасного предотвращения просмотра db_owners или любых других администраторов.

> [!NOTE]
> Достижение разделения обязанностей (разделения обязанностей) является сложной задачей для задач, связанных с безопасностью или устранения неполадок. Другие области, такие как разработка и роли конечных пользователей, проще разделять. Большинство элементов управления, связанных с соответствием требованиям, позволяют использовать альтернативные функции управления, такие как аудит, если другие решения нецелесообразны.

Для читателей, которые хотят глубже углубиться в разделения обязанностей, мы рекомендуем использовать следующие ресурсы: 

- Для базы данных SQL Azure  
  - [Управление доступом к базе данных SQL и хранилищем данных SQL и предоставление им доступа к ним](sql-database-manage-logins.md)
  - [Разделение обязанностей ядер для разработчика приложения](https://docs.microsoft.com/previous-versions/sql/sql-server-2008/cc974525(v=sql.100)) 
  - [Разделение обязанностей в SQL Server 2014](https://www.microsoft.com/download/details.aspx?id=39269)
  - [Подписывание хранимых процедур в SQL Server](https://docs.microsoft.com/dotnet/framework/data/adonet/sql/signing-stored-procedures-in-sql-server)

- Для управления ресурсами Azure:
  - [Встроенные роли для Azure](../role-based-access-control/built-in-roles.md) 
  - [Пользовательские роли для ресурсов Azure](../role-based-access-control/custom-roles.md)
  - [Использование Azure AD Privileged Identity Management для повышения прав доступа](https://www.microsoft.com/en-us/itshowcase/using-azure-ad-privileged-identity-management-for-elevated-access)

### <a name="perform-regular-code-reviews"></a>Выполнение регулярных проверок кода

> [!NOTE]
> Упоминалось в: PCI: 6.3.2, SOC: SDL-3 

Разделение обязанностей не ограничивается данными в базе данных, но включает код приложения. Вредоносный код потенциально может обходить средства управления безопасностью. Перед развертыванием пользовательского кода в рабочей среде важно проверить, что развертывается.

**Как реализовать**:

- Используйте средство базы данных, например Azure Data Studio, поддерживающее систему управления версиями. 

- Реализация процесса развертывания с разделением кода.

- Перед фиксацией в основной ветви человек (отличный от автора самого кода) должен проверять код на предмет потенциальных повышенных привилегий, а также вносить изменения в вредоносные данные, чтобы защититься от мошенничества и фальшивого доступа. Это можно сделать с помощью механизмов управления версиями.

**Рекомендация**.

- Стандартизация. она позволяет реализовать стандартную процедуру, которая будет выполняться при любых обновлениях кода. 

- Оценка уязвимостей содержит правила, которые проверяют наличие избыточных разрешений, использование старых алгоритмов шифрования и другие проблемы безопасности в схеме базы данных. 

- Дальнейшие проверки можно выполнить в среде контроля качества или тестирования с помощью Advanced Threat Protection, которая сканирует код, который уязвим для внедрения кода SQL.

- Примеры того, что следует искать: 
  - Создание пользователя или изменение параметров безопасности из автоматизированного развертывания обновления SQL-кода. 
  - Хранимая процедура, которая, в зависимости от предоставленных параметров, обновляет денежное значение в ячейке несоответствием образом. 

- Убедитесь, что пользователь, проходящий проверку, является отдельным автором, отличным от автора исходного кода, и знания о проверке кода и безопасном программировании.

- Обязательно изучите все источники изменений кода: код может быть в скриптах T-SQL. Это могут быть нерегламентированные команды для выполнения или развертывания в виде представлений, функций, триггеров и хранимых процедур. Он также может быть частью определений заданий агента SQL (шагов), которые выполняются в пакетах служб SSIS, фабрике данных Azure и других службах.

## <a name="data-protection"></a>Защита данных

Защита данных — это набор возможностей для защиты важной информации от компрометации путем шифрования или запутывания.

> [!NOTE]
> Корпорация Майкрософт подтверждает соответствие базы данных SQL Azure стандарту FIPS 140-2 уровня 1. Это делается после проверки полного использования допустимых алгоритмов FIPS 140-2 уровня 1 и проверенных экземпляров FIPS 140-2 уровня 1, включая согласованность с требуемыми длинами ключей, управлением ключами, созданием ключей и хранением ключей. Эта аттестация предназначена для того, чтобы наши клиенты отвечали на потребность или требование использования проверенных экземпляров FIPS 140-2 уровня 1 при обработке данных или доставке систем или приложений. Мы определяем термины «FIPS 140-2 Level 1 совместимо» и «соответствие FIPS 140-2 уровня 1», использованное в приведенной выше инструкции, чтобы продемонстрировать их предполагаемую применимость в США и канадском правительственном использовании другого термина «FIPS 140-2 Level 1 Validated». 


### <a name="encrypt-data-in-transit"></a>Шифрование данных при передаче

> [!NOTE]
> Упоминалось в: упражнения #6, семейство элементов управления ISO: криптография

Защищает данные при перемещении данных между клиентом и сервером. См. статью [безопасность сети](#network-security).

### <a name="encrypt-data-at-rest"></a>Шифрование неактивных данных

> [!NOTE]
> Упоминалось в: упражнения #6, семейство элементов управления ISO: криптография

Шифрование неактивных данных — это криптографическая защита, которая сохраняется в файлах базы данных, журнала и резервных копий.

**Как реализовать**:

- [Прозрачное шифрование базы данных (TDE)](transparent-data-encryption-azure-sql.md) с ключами, управляемыми службой, по умолчанию включено для всех баз данных, созданных после 2017 в базе данных SQL Azure.
- В управляемом экземпляре, если база данных создается в результате операции восстановления с локального сервера, будет учитываться параметр TDE исходной базы данных. Если в исходной базе данных не включена TDE, рекомендуется вручную включить TDE для управляемого экземпляра.

**Рекомендация**.

- Не храните данные, для которых требуется шифрование неактивных данных в базе данных master. База данных master не может быть зашифрована с помощью TDE.

- Используйте управляемые клиентом ключи в Azure Key Vault, если требуется увеличить прозрачность и детальное управление защитой TDE. Azure Key Vault позволяет отменять разрешения в любое время для отображения базы данных в недоступном состоянии. Вы можете централизованно управлять предохранителями TDE вместе с другими ключами или переключать средство защиты TDE по собственному расписанию с помощью Azure Key Vault.

- Если вы используете ключи, управляемые клиентом, в Azure Key Vault, следуйте статьям, [руководству по настройке TDE с помощью Azure Key Vault](transparent-data-encryption-byok-azure-sql.md#recommendations-when-configuring-akv) и [настройке географического DR с помощью Azure Key Vault](transparent-data-encryption-byok-azure-sql.md#geo-dr-and-customer-managed-tde).

### <a name="protect-sensitive-data-in-use-from-high-privileged-unauthorized-users"></a>Защита конфиденциальных данных, используемых пользователями с высоким уровнем привилегий и неавторизованных пользователей

Используемые данные — это данные, хранящиеся в памяти системы базы данных во время выполнения SQL-запросов. Если в базе данных хранятся конфиденциальные данные, Организация может потребовать, чтобы пользователи с высоким уровнем привилегий, такие как операторы или Администраторы администраторов в Организации, не могли извлечь данные из памяти процесса SQL Server и не смогли для просмотра данных в виде открытого текста при запросе к базе данных.

**Как реализовать**:

- Используйте [Always encrypted](https://docs.microsoft.com/sql/relational-databases/security/encryption/always-encrypted-database-engine) , чтобы гарантировать, что конфиденциальные данные не отображаются в виде открытого текста в базе данных SQL Azure, даже в используемой памяти. Это защищает данные от администраторов баз данных и администраторов облака (или от неавторизованных лиц, которые могут олицетворять пользователей с высоким уровнем привилегий) и предоставляет вам больший контроль над тем, кто может получать доступ к данным.

**Рекомендация**.

- Always Encrypted не является заменой для шифрования неактивных данных (TDE) или передачи (SSL/TLS) и не следует использовать для неконфиденциальных данных, чтобы свести к минимуму влияние на производительность и функциональность. Использование Always Encrypted в сочетании с TDE и TLS рекомендуется для обеспечения полной защиты неактивных, транзитных и используемых данных. 

- Управление ключами Always Encrypted с помощью разделения ролей, если вы используете Always Encrypted для защиты данных от вредоносных администраторов. При использовании разделения ролей администратор безопасности создает физические ключи, а администратор базы данных создает главный ключ столбца и объекты метаданных ключа шифрования столбца, описывающие физические ключи в базе. Во время этого процесса администратору безопасности не требуется доступ к базе данных, и АДМИНИСТРАТОРу базы прав не требуется доступ к физическим ключам в виде открытого текста. 
  - Дополнительные сведения см. в статье [Управление ключами с разделением ролей](https://docs.microsoft.com/sql/relational-databases/security/encryption/overview-of-key-management-for-always-encrypted#managing-keys-with-role-separation) . 

- Храните главные ключи столбцов в Azure Key Vault для простоты управления. Избегайте использования хранилища сертификатов Windows (и в общем случае распределенных решений хранилища ключей, в отличие от решений для управления центральными ключами), которые делают управление ключами жестким. 

- Подумайте о компромиссах использования нескольких ключей (ключей шифрования столбцов или главных ключей). Чтобы сократить затраты на управление ключами, сократите количество ключей. Один главный ключ столбца и один ключ шифрования столбца для одной базы данных обычно достаточно в средах стабильного состояния (не в середине смены ключа), если у вас нет разных групп пользователей, каждый из которых использует разные ключи и обращаются к разным данным.  

- Поворачивайте главные ключи столбцов в соответствии с требованиями к соответствию. Если необходимо также поворачивать ключи шифрования столбцов, рекомендуется использовать оперативное шифрование, чтобы сократить время простоя приложения. 
  - См. статью, [сведения о производительности и доступности](https://docs.microsoft.com/sql/relational-databases/security/encryption/configure-column-encryption-using-powershell#performance-and-availability-considerations). 

- Используйте детерминированное шифрование, если необходимо поддерживать вычисления (на равенство) данных. В противном случае используйте случайное шифрование. Избегайте использования детерминированного шифрования для наборов данных с низким уровнем энтропии или наборов данных с открытым известным распределением. 

- Если вы беспокоитесь о том, что сторонние лица обращаются к данным по закону без вашего согласия, убедитесь, что все приложения и средства, имеющие доступ к ключам и данным в виде открытого текста, выполняются вне Microsoft Azure облака. Без доступа к ключам третьим лицам не удастся расшифровать данные, если только они не обходят шифрование.

- Always Encrypted не поддерживает предоставление временного доступа к ключам (и защищенным данным). Например, если необходимо предоставить общий доступ к ключам администратор базы данных, чтобы администратор базы данных выполнил некоторые операции очистки с конфиденциальными и зашифрованными данными, единственным способом обеспечения надежности является возможность смены ключей шифрования столбцов и выд. главные ключи MN защищают данные, что является дорогостоящей операцией. 

- Чтобы получить доступ к значениям открытого текста в зашифрованных столбцах, пользователь должен иметь доступ к CMK, защищая столбцы, которые настроены в хранилище ключей, где находится CMK. Кроме того, пользователь должен иметь определение любого СТОЛБЦА с главным ключом и просматривать любые разрешения базы данных для определения ключа шифрования СТОЛБЦА.

### <a name="control-access-of-application-users-to-sensitive-data-through-encryption"></a>Управление доступом пользователей приложений к конфиденциальным данным с помощью шифрования

Шифрование можно использовать как способ гарантировать, что только определенные пользователи приложения, имеющие доступ к криптографическим ключам, могут просматривать или обновлять данные.

**Как реализовать**:

- Используйте шифрование на уровне ячеек (CLE). Дополнительные сведения см. в статье [Шифрование столбца данных](https://docs.microsoft.com/sql/relational-databases/security/encryption/encrypt-a-column-of-data) . 
- Кроме того, рекомендуется использовать Always Encrypted, но помните о его ограничении, приведенном ниже.

**Рекомендации**

При использовании CLE:

- Управление доступом к ключам с помощью разрешений и ролей SQL. 

- Для шифрования данных используйте алгоритм AES (рекомендуется использовать AES 256). Алгоритмы, такие как RC4, DES и TripleDES, являются устаревшими и не должны использоваться из-за известных уязвимостей. 

- Защитите симметричные ключи с помощью асимметричных ключей и сертификатов (не паролей), чтобы избежать использования 3DES. 

- Будьте внимательны при переносе базы данных с помощью шифрования на уровне ячейки с помощью экспорта и импорта (файлы BACPAC). 
  - См. статью [рекомендации по использованию шифрования на уровне ячеек в базе данных SQL Azure](https://blogs.msdn.microsoft.com/sqlsecurity/2015/05/12/recommendations-for-using-cell-level-encryption-in-azure-sql-database/) о том, как предотвратить использование ключей разрыва при переносе данных, а также о других рекомендациях.

При использовании Always Encrypted следует помнить, что Always Encrypted в основном предназначен для защиты конфиденциальных данных, используемых пользователями базы данных SQL Azure с высоким уровнем привилегий (операторы облака, DBA). см. раздел [Защита конфиденциальных данных, используемых с высоким уровнем привилегий и неавторизованными пользователями](#protect-sensitive-data-in-use-from-high-privileged-unauthorized-users). При использовании Always Encrypted для защиты данных от пользователей приложений учитывайте следующие проблемы.

- После предоставления пользователю доступа к конфиденциальным данным, предоставив пользователю разрешения на доступ к ключу шифрования столбца и главному ключу столбца, чтобы обеспечить надежную отмену доступа, необходимо поворачивать ключ шифрования столбца, что является дорогостоящей операцией, требующей повторное шифрование всех столбцов обеспечивает защиту ключа шифрования столбца. 

- По умолчанию все драйверы клиента Майкрософт, поддерживающие Always Encrypted, поддерживают кэш глобальных (по одному приложению) ключей шифрования столбцов. Когда драйвер клиента получает ключ шифрования столбца с открытым текстом, обратившись к хранилищу ключей, в котором хранится главный ключ столбца, ключ шифрования столбца в виде открытого текста кэшируется, что позволяет изолировать данные от пользователей приложения с несколькими пользователями. Если приложение олицетворяет конечных пользователей при взаимодействии с хранилищем ключей (например, Azure Key Vault), после заполнения пользователем кэша ключом шифрования столбца последующий запрос, требующий тот же ключ, но запущенный другим пользователем, будет использовать кэшированный ключ. Драйвер не будет вызывать хранилище ключей, и он не будет проверять, имеет ли второй пользователь разрешение на доступ к ключу шифрования столбца. В результате пользователь сможет видеть зашифрованные данные, даже если у пользователя нет доступа к ключам. Чтобы достичь изоляции пользователей в приложении с несколькими пользователями, может потребоваться отключить кэширование ключей шифрования столбцов, что приведет к дополнительным издержкам в производительности, так как драйверу потребуется связаться с хранилищем ключей для каждого шифрования или расшифровки данных. операцию.

### <a name="protect-data-against-unauthorized-viewing-by-application-users-while-preserving-data-format"></a>Защита данных от несанкционированного просмотра пользователями приложений с сохранением формата данных
Другой способ предотвращения неавторизованных пользователей при просмотре данных заключается в маскировке или маскировании данных с сохранением типов и форматов данных, чтобы обеспечить возможность по-прежнему обрабатывать и отображать данные в пользовательских приложениях.

**Как реализовать**:

- Используйте [Динамическое маскирование данных](https://docs.microsoft.com/sql/relational-databases/security/dynamic-data-masking) для маскировки столбцов таблицы.

> [!NOTE]
> Always Encrypted не работает с динамическое маскирование данных. Невозможно зашифровать и замаскировать один и тот же столбец, что означает необходимость определения приоритетов для защиты данных, используемых в Visual Studio, и Маскирование данных для пользователей приложения с помощью динамическое маскирование данных.

**Рекомендация**.

> [!NOTE]
> Динамическое маскирование данных нельзя использовать для защиты данных от пользователей с высоким уровнем привилегий. Политики маскировки не применяются к пользователям с административным доступом, например db_owner.

- Не разрешайте пользователям приложений выполнять нерегламентированные запросы (так как они могут обойти динамическое маскирование данных).  
  - Дополнительные сведения см. в статье [обход маскировки с помощью вывода или приемов подбора](https://docs.microsoft.com/sql/relational-databases/security/dynamic-data-masking#security-note-bypassing-masking-using-inference-or-brute-force-techniques) .  

- Используйте правильную политику контроля доступа (с помощью разрешений SQL, ролей и RLS), чтобы ограничить разрешения пользователей на внесение обновлений в маскированные столбцы. Создание маски для столбца не запрещает обновление этого столбца. Таким образом, хотя пользователи получают маскированные данные при запросе маскированного столбца, одни и те же пользователи могут обновлять данные, если у них есть разрешения на запись.    

-  Динамическое маскирование данных не сохраняет статистические свойства маскированных значений, что может повлиять на результаты запроса (например, запросы, содержащие предикаты фильтрации или объединения с маскированными данными).

## <a name="network-security"></a>Безопасность сети
Сетевая безопасность относится к элементам управления доступом и рекомендациям по защите данных при передаче в базу данных SQL Azure.

### <a name="configure-my-client-to-connect-securely-to-azure-sql-database"></a>Настройка клиента для безопасного подключения к базе данных SQL Azure 
Предотвращение подключения клиентских компьютеров и приложений к базе данных SQL Azure от известных уязвимостей из-за зависимости от более старых протоколов и комплектов шифров.

**Как реализовать**:

- Убедитесь, что клиентские компьютеры, подключающиеся к базе данных SQL Azure, используют протокол [TLS](sql-database-security-overview.md#transport-layer-security-tls-encryption-in-transit).

**Рекомендация**.

- Настройка всех приложений и средств для подключения к базе данных SQL с включенным шифрованием 
  - Encrypt = on, TrustServerCertificate = Off (или эквивалентно драйверу сторонних производителей). 

- Если приложение использует драйвер, который не поддерживает TLS или поддерживает более старую версию TLS, замените драйвер, если это возможно. Если это невозможно, тщательно оцените риски безопасности. 

- Сократите направления атак с помощью уязвимостей в SSL 2,0, SSL 3,0, TLS 1,0 и TLS 1,1, отключив их на клиентских компьютерах, подключающихся к базе данных SQL Azure на основе [параметров реестра TLS](https://docs.microsoft.com/windows-server/security/tls/tls-registry-settings#tls-10). 

- Проверьте наборы шифров, доступные на клиенте для каждого [комплекта шифров в TLS/SSL (Schannel SSP)](https://docs.microsoft.com/windows/desktop/SecAuthN/cipher-suites-in-schannel) , а в частности Отключите алгоритм 3Des для [настройки порядка комплектов шифров TLS](https://docs.microsoft.com/windows-server/security/tls/manage-tls#configuring-tls-cipher-suite-order). 

- Если используется управляемый экземпляр, используйте тип подключения **прокси-сервера** (по умолчанию), так как это обеспечивает шифрование со стороны сервера. Тип подключения **перенаправления** сейчас не поддерживает принудительное шифрование и доступен только для частных IP-подключений. 
  - Дополнительные сведения см. в статье [Архитектура подключения SQL Azure — политика подключения](sql-database-connectivity-architecture.md#connection-policy).
  - Шифрование применяется как для прокси-сервера, так и для типов подключений перенаправления. 

### <a name="minimize-attack-surface"></a>Уменьшение уязвимой зоны
Сократите число функций, которые могут быть атакованы злоумышленниками, путем реализации элементов управления доступом к сети для базы данных SQL Azure.

> [!NOTE]
> Упоминалось в: упражнения #5

**Как реализовать**:

На сервере базы данных SQL Azure (который содержит одноэлементные базы данных или эластичные пулы):
- Установите для параметра Разрешить доступ к службам Azure значение Выкл.

- Используйте конечные точки службы виртуальной сети и правила брандмауэра виртуальной сети.

- Используйте частную ссылку (Предварительная версия).

В управляемом экземпляре:
- Следуйте указаниям в [требованиях к сети](sql-database-managed-instance-connectivity-architecture.md#network-requirements). 

**Рекомендация**.

- Ограничьте доступ к базе данных SQL Azure, подключившись к частной конечной точке (например, используя закрытый путь к данным): 
  - Управляемый экземпляр может быть изолирован внутри виртуальной сети, чтобы предотвратить внешний доступ. Приложения и средства, расположенные в одной или в одноранговой виртуальной сети в одном регионе, могут обращаться к нему напрямую. Приложения и средства, которые находятся в разных регионах, могут использовать подключение между виртуальными сетями или пиринг канала ExpressRoute для установления соединения. Клиент должен использовать группы безопасности сети (NSG), чтобы ограничить доступ через порт 1433 только к ресурсам, которым требуется доступ к управляемому экземпляру. 
  - Для сервера базы данных SQL (содержащего отдельные базы данных или эластичные пулы) используйте функцию [частного канала](sql-database-private-endpoint-overview.md) , которая предоставляет выделенный частный IP-адрес для сервера базы данных SQL в виртуальной сети. Вы также можете использовать [конечные точки службы виртуальной сети с правилами брандмауэра виртуальной сети](sql-database-vnet-service-endpoint-rule-overview.md) , чтобы ограничить доступ к серверам базы данных SQL.
  - Мобильные пользователи должны использовать VPN-подключения типа "точка — сеть" для подключения по пути к данным.
  - Пользователи, подключенные к локальной сети, должны использовать VPN-подключение типа "сеть — сеть" или ExpressRoute для подключения по пути к данным.

- Доступ к базе данных SQL Azure можно получить, подключившись к общедоступной конечной точке (например, используя путь к общедоступным данным). Следует учитывать следующие рекомендации: 
  - Для сервера базы данных SQL используйте [правила брандмауэра IP-адресов](sql-database-firewall-configure.md) , чтобы ограничить доступ только РАЗРЕШЕННЫМИ IP-адресами.
  - Для управляемого экземпляра используйте группы безопасности сети (NSG), чтобы ограничить доступ через порт 3342 только к необходимым ресурсам. Дополнительные сведения см. в статье [безопасное использование управляемого экземпляра базы данных SQL Azure с общедоступными конечными точками](sql-database-managed-instance-public-endpoint-securely.md). 

> [!NOTE]
> Общедоступная конечная точка управляемого экземпляра не включена по умолчанию и должна быть явно включена. Если политика компании запрещает использование общедоступных конечных точек, используйте [политику Azure](../governance/policy/overview.md) , чтобы предотвратить включение общедоступных конечных точек в первую очередь.

- Настройка сетевых компонентов Azure: 
  - Следуйте рекомендациям [Azure по безопасности сети](../security/fundamentals/network-best-practices.md).
  - Запланируйте конфигурацию виртуальной сети (VNet) для рекомендаций, описанных в разделе часто задаваемые [вопросы о виртуальной сети Azure](../virtual-network/virtual-networks-faq.md) и о плане. 
  - Разделите виртуальную сеть на несколько подсетей и назначьте ресурсы для аналогичной роли в одной подсети (например, клиентские ресурсы с внешними и внутренними ресурсами).
  - Используйте [группы безопасности сети (группы безопасности сети)](../virtual-network/security-overview.md) для управления трафиком между подсетями в границах виртуальной сети Azure.
  - Включите [наблюдатель за сетями Azure](../network-watcher/network-watcher-monitoring-overview.md) для подписки, чтобы отслеживать входящий и исходящий сетевой трафик.

### <a name="configure-power-bi-for-secure-connections-to-azure-sql-database"></a>Настройка Power BI для безопасных подключений к базе данных SQL Azure

**Рекомендация**.

- Для Power BI Desktop используйте путь к частным данным везде, где это возможно. 

- Убедитесь, что Power BI Desktop подключается с помощью TLS 1.2, задав раздел реестра на клиентском компьютере в соответствии с параметрами реестра [TLS](https://docs.microsoft.com/windows-server/security/tls/tls-registry-settings) . 

- Ограничьте доступ к данным для конкретных пользователей [, используя безопасность на уровне строк (RLS) с Power BI](https://docs.microsoft.com/power-bi/service-admin-rls). 

- Для Power BIной службы используйте [локальный шлюз данных](https://docs.microsoft.com/power-bi/service-gateway-onprem), учитывая [ограничения и особенности](https://docs.microsoft.com/power-bi/service-gateway-deployment-guidance#installation-considerations-for-the-on-premises-data-gateway).

### <a name="configure-app-service-for-secure-connections-to-azure-sql-database"></a>Настройка службы приложений для безопасных подключений к базе данных SQL Azure

**Рекомендация**.

- Для простого веб-приложения для подключения через общедоступную конечную точку требуется параметр **Разрешить службы Azure** . 

- [Интегрируйте приложение с виртуальной сетью Azure](../app-service/web-sites-integrate-with-vnet.md) для подключения частного пути к данным к управляемому экземпляру. При необходимости можно также развернуть веб-приложение с помощью [сред службы приложений (ASE)](../app-service/environment/intro.md). 

- Для веб-приложения с интегрированным веб-приложением ASE или VNet, которое подключается к базе данных на сервере базы данных SQL, вы можете использовать [конечные точки службы виртуальной сети и правила брандмауэра виртуальной](sql-database-vnet-service-endpoint-rule-overview.md) сети, чтобы ограничить доступ к определенной сети и подсетью, а затем установить параметр **Разрешить службы Azure** отключить. Можно также подключить ASE к управляемому экземпляру по пути к закрытым данным.  

- Убедитесь, что ваше веб-приложение настроено в соответствии со статьей, рекомендации [по защите веб-и мобильных приложений PaaS с помощью службы приложений Azure](../security/security-paas-applications-using-app-services.md). 

- Установите [брандмауэр веб-приложения (WAF)](../application-gateway/waf-overview.md) , чтобы защитить веб-приложение от распространенных эксплойтов и уязвимостей.

### <a name="configure-azure-vm-hosting-for-secure-connections-to-azure-sql-database"></a>Настройка размещения виртуальных машин Azure для безопасного подключения к базе данных SQL Azure

**Рекомендация**.

- Используйте сочетание правил allow и Deny в группы безопасности сети виртуальных машин Azure, чтобы контролировать, к каким регионам можно получить доступ из виртуальной машины.

- Убедитесь, что ваша виртуальная машина настроена для каждой статьи, [рекомендации по обеспечению безопасности для рабочих нагрузок IaaS в Azure](../security/azure-security-iaas.md).

- Убедитесь, что все виртуальные машины связаны с определенной виртуальной сетью и подсетью. 

- Оцените, нужен ли маршрут по умолчанию 0.0.0.0/Интернет в рекомендации по [принудительному туннелированию](../vpn-gateway/vpn-gateway-forced-tunneling-rm.md#about-forced-tunneling). 
  - Если да — например, в интерфейсной подсети, то сохраните маршрут по умолчанию.
  - Если нет — например, средний уровень или подсеть внутренней сети, включите принудительное туннелирование, чтобы трафик не перенаправлялся через Интернет в локальную среду (a. k. распределенная). 

- Реализуйте [необязательные маршруты по умолчанию](../virtual-network/virtual-networks-udr-overview.md#optional-default-routes) , если вы используете пиринг или подключаетесь к локальной среде. 

- Реализуйте [определяемые пользователем маршруты](../virtual-network/virtual-networks-udr-overview.md#user-defined) , если необходимо отправить весь трафик из виртуальной сети в сетевой виртуальный модуль для проверки пакетов. 

- Используйте [конечные точки службы виртуальной сети](sql-database-vnet-service-endpoint-rule-overview.md) для безопасного доступа к службам PaaS, таким как служба хранилища Azure через магистральную сеть Azure. 

### <a name="protect-against-distributed-denial-of-service-ddos-attacks"></a>Защита от распределенных атак типа "отказ в обслуживании" (от атак DDoS)
Распределенные атаки типа "отказ в обслуживании" (от атак DDoS) — это попытки злонамеренного пользователя отправить переполнение сетевого трафика в базу данных SQL Azure с целью перегрузки инфраструктуры Azure и появлению отклонения допустимых имен входа и рабочей нагрузки.

> [!NOTE]
> Упоминалось в: упражнения #9

**Как реализовать**:

Защита от атак DDoS автоматически включается в составе платформы Azure. Он включает мониторинг трафика в реальном времени и устранение атак на уровне сети в общедоступных конечных точках. 

- Используйте [Azure от атак DDoS Protection](../virtual-network/ddos-protection-overview.md) для мониторинга общедоступных IP-адресов, связанных с ресурсами, развернутыми в виртуальных сетях.

- Используйте [расширенную защиту от угроз для базы данных SQL Azure](sql-database-threat-detection-overview.md) , чтобы обнаружить атаки типа "отказ в обслуживании" (DOS) для баз данных.

**Рекомендация**.

- Следуйте рекомендациям, описанным в статье [Уменьшение уязвимой зоны](#minimize-attack-surface) , чтобы снизить угрозы от атак DDoS атак. 

- Оповещение об **учетных данных SQL** с расширенной защитой угроз позволяет обнаруживать атаки методом подбора. В некоторых случаях предупреждение может даже отличать рабочие нагрузки тестирования на проникновение. 

- Для виртуальных машин Azure, на которых выполняется подключение к базе данных SQL: 
  - Следуйте рекомендациям, чтобы ограничить доступ через подключенные к Интернету конечные точки в центре безопасности Azure. 
  - Используйте масштабируемые наборы виртуальных машин для запуска нескольких экземпляров приложения на виртуальных машинах Azure. 
  - Отключите RDP и SSH из Интернета, чтобы предотвратить атаку методом подбора. 

## <a name="monitoring-logging-and-auditing"></a>Мониторинг, ведение журнала и аудит  
Этот раздел относится к возможностям, помогающим обнаруживать аномальные действия, указывающие на необычные и потенциально опасные попытки доступа к базам данных или их использования. Здесь также описываются рекомендации по настройке аудита базы данных для отслеживания и записи событий базы данных.

### <a name="protect-databases-against-attacks"></a>Защита баз данных от атак 
Расширенная защита от угроз позволяет обнаруживать потенциальные угрозы и реагировать на них по мере их возникновения, предоставляя оповещения системы безопасности о аномальных действиях.

**Как реализовать**:

- Используйте [расширенную защиту от угроз для SQL](sql-database-threat-detection-overview.md#advanced-threat-protection-alerts) , чтобы обнаружить необычные и потенциально опасные попытки доступа к базам данных или их использования, в том числе:
  - Атака путем внедрения кода SQL.
  - Кража или утечка учетных данных.
  - Нарушение прав доступа.
  - Утечка данных.

**Рекомендация**.

- Настройка [расширенной безопасности данных](sql-database-advanced-data-security.md#getting-started-with-ads) для базы данных SQL Azure для конкретного сервера базы данных SQL или управляемого экземпляра или для всех серверов баз данных SQL и управляемых экземпляров в подписке путем переключения на [уровень "Стандартный" центра безопасности Azure](../security-center/security-center-pricing.md). 

- Для полного исследования рекомендуется включить [Аудит базы данных SQL](sql-database-auditing.md) , чтобы отслеживать события базы данных и записывать их в журнал аудита в учетной записи хранения Azure или в рабочей области Azure log Analytics. 

### <a name="audit-critical-security-events"></a>Аудит критических событий безопасности
Отслеживание событий базы данных помогает понять активность базы данных и получить представление о расхождениях и аномалиях, которые могут указывать на бизнес-проблемы или потенциальные нарушения безопасности. Он также обеспечивает соблюдение стандартов соответствия требованиям. 

**Как реализовать**:

- Включите [Аудит базы данных SQL](sql-database-auditing.md) , чтобы отслеживать события базы данных и записывать их в журнал аудита в учетной записи хранения Azure, log Analytics рабочей области (Предварительная версия) или концентраторы событий (Предварительная версия). 

- Журналы аудита можно записывать в учетную запись хранения Azure, в Log Analytics рабочую область для использования с помощью Azure Monitor журналов или в концентратор событий для использования концентратора событий. Вы также можете настроить любое сочетание этих вариантов, и журналы аудита будут записываться в каждый из них. 

**Рекомендация**.

- Настроив [Аудит базы данных SQL](sql-database-auditing.md) на сервере базы данных для аудита событий, аудит всех существующих и вновь созданных баз данных на этом сервере будет выполняться.
- По умолчанию политика аудита включает все действия (запросы, хранимые процедуры и успешные и неудачные попытки входа) для баз данных, что может привести к большому объему журналов аудита. Пользователям рекомендуется [настраивать аудит для различных типов действий и групп действий с помощью PowerShell](sql-database-auditing.md#subheading-7), управлять количеством действий, прошедшие аудит, и сокращать риск потери событий. Это позволит клиентам записывать только действительно необходимые данные аудита.
- Журналы аудита можно использовать непосредственно в [портал Azure](https://portal.azure.com/)или в расположении хранилища, которое было настроено. 


> [!NOTE]
> Включение аудита в Log Analytics приведет к затратам на основе ставок приема. Изучите связанные затраты с помощью этого [параметра](https://azure.microsoft.com/pricing/details/monitor/)или Храните журналы аудита в учетной записи хранения Azure. 

**Дополнительные ресурсы**:

- [Аудит базы данных SQL](sql-database-auditing.md)
- [Аудит SQL Server](https://docs.microsoft.com/sql/relational-databases/security/auditing/sql-server-audit-database-engine) 

### <a name="secure-audit-logs"></a>Защита журналов аудита
Для поддержки разделения обязанностей и разделения баз данных-администраторов от аудиторов следует принять меры для ограничения доступа к учетной записи хранения. 

**Как реализовать**:

- При сохранении журналов аудита в службе хранилища Azure убедитесь, что доступ к учетной записи хранения ограничен минимальными принципами безопасности с помощью управления доступом к учетной записи хранения.

- Дополнительные сведения см. [в статье авторизация доступа к службе хранилища Azure](../storage/common/storage-auth.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json).

**Рекомендация**.

- Управление доступом к цели аудита является ключевой концепцией отделения администраторов от аудиторов. 

- При аудите доступа к конфиденциальным данным рассмотрите возможность защиты данных с помощью шифрования данных во избежание утечки информации аудитору. Дополнительные сведения см. в разделе [Защита конфиденциальных данных, используемых с помощью неавторизованных пользователей с высоким уровнем привилегий](#protect-sensitive-data-in-use-from-high-privileged-unauthorized-users).

## <a name="security-management"></a>Управление безопасностью

В этом разделе описываются различные аспекты и рекомендации по управлению безопасностью баз данных. Он содержит рекомендации по обеспечению настройки баз данных в соответствии со стандартами безопасности, обнаружения и классификации и отслеживания доступа к потенциально конфиденциальным данным в базах данных. 

### <a name="ensure-that-the-databases-are-configured-to-meet-security-best-practices"></a>Убедитесь, что базы данных настроены в соответствии с рекомендациями по обеспечению безопасности 

Заблаговременно улучшайте безопасность базы данных за счет обнаружения и устранения потенциальных уязвимостей базы данных.

**Как реализовать**:

- Включите [оценку уязвимости SQL](https://docs.microsoft.com/sql/relational-databases/security/sql-vulnerability-assessment) (ва), чтобы проверить базу данных на наличие проблем безопасности и автоматически выполнять ее периодически в базах данных.

**Рекомендация**.

- Сначала следует запустить ва в базах данных и выполнить итерацию, устранения неудачные проверки, в отличие от рекомендаций по обеспечению безопасности, и настроить базовые показатели для приемлемых конфигураций до тех пор, пока проверка не будет получена "очистить" (все проверки пройдены).  

- Настройте периодическое повторение проверок для однократного запуска в течение недели и настройте соответствующее лицо для получения сводных сообщений электронной почты. 

- Просмотрите сводку по ва после каждой еженедельной проверки. Для всех обнаруженных уязвимостей следует оценить смещение от предыдущего результата проверки и определить, следует ли разрешить проверку, или если есть веская причина изменения конфигурации.   

- Разрешите проверки и базовые показатели обновлений, если это уместно, или создайте элементы билетов для разрешения действий и их отслеживания до тех пор, пока они не будут разрешены. 

**Дополнительные ресурсы**:

- [Оценка уязвимостей SQL](https://docs.microsoft.com/sql/relational-databases/security/sql-vulnerability-assessment) 
- [Служба оценки уязвимостей SQL помогает выявление уязвимостей базы данных](sql-vulnerability-assessment.md)

### <a name="identify-and-tag-sensitive-data"></a>Выявление и маркировка конфиденциальных данных 

Обнаружение столбцов, которые потенциально содержат конфиденциальные данные. Классификация столбцов для использования расширенных сценариев аудита и защиты на основе чувствительности. 

**Как реализовать**:

- Используйте [Обнаружение и классификацию данных SQL](sql-database-data-discovery-and-classification.md) для обнаружения, классификации, добавления меток и защиты конфиденциальных данных в базах данных. 
  - Просмотрите рекомендации по классификации, созданные средством автоматического обнаружения на панели мониторинга обнаружение и классификация данных SQL, и примите соответствующие классификации, чтобы конфиденциальные данные были постоянно помечены с помощью классификации. сигнатур. 
  - Вручную добавьте классификации для любых дополнительных полей конфиденциальных данных, которые не были обнаружены автоматическим механизмом. 
- Дополнительные сведения см. в разделе [Обнаружение данных SQL & классификация](https://docs.microsoft.com/sql/relational-databases/security/sql-data-discovery-and-classification).

**Рекомендация**.

- Регулярно Отслеживайте панель мониторинга классификации для точной оценки состояния классификации базы данных. Отчет по состоянию классификации базы данных можно экспортировать или распечатать для использования в целях обеспечения соответствия требованиям и аудита.

- Непрерывно Отслеживайте состояние рекомендуемых конфиденциальных данных в оценке уязвимости SQL, отслеживая правило обнаружения конфиденциальных данных и выявляя любое смещение в рекомендуемых столбцах для классификации.  

- Используйте классификацию способом, адаптированным к конкретным потребностям Организации. Настройте политику Information Protection (метки чувствительности, типы сведений, логику обнаружения) в политике [SQL Information Protection](../security-center/security-center-info-protection-policy.md) в центре безопасности Azure. 

### <a name="track-access-to-sensitive-data"></a>Контроль доступа к конфиденциальным данным 
Следите за тем, кто обращается к конфиденциальным данным и собирает запросы к конфиденциальным данным в журналах аудита.

**Как реализовать**:

- Используйте аудит SQL и классификацию данных в сочетании. 
  - В журнале [аудита базы данных SQL](sql-database-auditing.md) можно отслеживать доступ к конфиденциальным данным и просматривать такие сведения, как данные, к которым осуществлялся доступ, а также их метки конфиденциальности (см. раздел [Аудит доступа к конфиденциальным данным](sql-database-data-discovery-and-classification.md#subheading-3)). 

**Рекомендация**.

- Ознакомьтесь с рекомендациями по разделу аудит и классификация данных: 
  - [Аудит критических событий безопасности](#audit-critical-security-events) 
  - [Выявление и маркировка конфиденциальных данных](#identify-and-tag-sensitive-data) 

### <a name="visualize-security-and-compliance-status"></a>Визуализация состояния безопасности и соответствия требованиям 

Используйте единую систему управления безопасностью инфраструктуры, которая позволяет усилить безопасность центров обработки данных (включая базы данных SQL). Просмотрите список рекомендаций, касающихся безопасности баз данных и состояния соответствия.

**Как реализовать**:

- Отслеживайте связанные с SQL рекомендации по безопасности и активные угрозы в [центре безопасности Azure](https://azure.microsoft.com/documentation/services/security-center/).

## <a name="common-security-threats-and-potential-mitigations"></a>Распространенные угрозы безопасности и потенциальные способы их устранения

Этот раздел поможет вам найти меры безопасности для защиты от определенных направлений атак. Предполагается, что большинство мер по устранению рисков можно получить, следуя одному или нескольким рекомендациям по безопасности, описанным выше.

### <a name="security-threat-data-exfiltration"></a>Угроза безопасности: утечка данных

Утечка данных является несанкционированным копированием, передачей или извлечением данных с компьютера или сервера. См. определение [утечка данных](https://en.wikipedia.org/wiki/Data_exfiltration) в Википедии.

Подключение к серверу базы данных SQL Azure через общедоступную конечную точку представляет риск утечка данных, так как он требует, чтобы клиенты открывали свои брандмауэры на общедоступных IP-адресах.  

**Сценарий 1**. приложение на виртуальной машине Azure подключается к базе данных на сервере базы данных SQL Azure. Фальшивый субъект получает доступ к виртуальной машине и нарушает его. В этом сценарии утечка данных означает, что внешняя сущность, использующая фальшивую виртуальную машину, подключается к базе данных, копирует личные данные и сохраняет их в хранилище BLOB-объектов или в другой базе данных SQL в другой подписке.

**Сценарий 2**. Rouge DBA. Этот сценарий часто вызывается клиентами, учитывающими безопасность, от регулируемых отраслей. В этом сценарии пользователь с высоким уровнем прав может копировать данные из базы данных SQL Azure в другую подписку, не управляемую владельцем данных.

**Возможные способы устранения рисков**:

Сейчас база данных SQL Azure предлагает следующие методы для устранения угроз утечка данных: 

- Используйте сочетание правил allow и Deny в группы безопасности сети виртуальных машин Azure, чтобы контролировать, к каким регионам можно получить доступ из виртуальной машины. 
- Если используется сервер базы данных SQL Azure (содержащий одноэлементные базы данных или эластичные пулы), установите следующие значения:
  - Разрешить службы Azure в OFF.
  - Разрешите только трафик из подсети, содержащей виртуальную машину Azure, настроив правило брандмауэра виртуальной сети.
  - Использовать [закрытую ссылку](sql-database-private-endpoint-overview.md)
- Для управляемого экземпляра использование частного IP-доступа по умолчанию решает первую утечкау данных о незаконной виртуальной машине. Включите функцию делегирования подсети в подсети, которая будет обслуживаться, чтобы автоматически задать наиболее ограниченную политику в подсети управляемого экземпляра.
- Несанкционированная роль администратора базы данных более наглядна с управляемым экземпляром, так как она имеет более крупную контактную зону и сетевые требования видны клиентам. Лучшим решением этой проблемы является применение всех рекомендаций из этого руководств по безопасности, чтобы предотвратить случайный сценарий DBA (не только для утечка данных). Always Encrypted — это один из методов защиты конфиденциальных данных путем их шифрования и поддержания доступа к ключу для базы данных-администратора.

## <a name="security-aspects-of-business-continuity-and-availability"></a>Аспекты обеспечения безопасности непрерывности бизнес-процессов и доступности

Большинство стандартов безопасности ориентированы на доступность данных с точки зрения непрерывности работы, что достигается благодаря реализации избыточности и возможной отработки отказа во избежание единой точки отказа. Для аварийных ситуаций рекомендуется регулярно создавать резервные копии файлов данных и журналов. В следующем разделе представлен общий обзор возможностей, встроенных в Azure, а также дополнительные параметры, которые можно настроить в соответствии с конкретными потребностями. 

- Azure предлагает встроенные возможности высокого уровня доступности [и базы данных SQL Azure](sql-database-high-availability.md) . 

- Критически важный для бизнеса уровень включает группы отработки отказа, зоны множественной доступности, полные и разностные резервные копии журналов, а также резервные копии на момент времени, включенные по умолчанию.  
  - [Высокая доступность и база данных SQL Azure — конфигурация с избыточностью зоны](sql-database-high-availability.md#zone-redundant-configuration)
  - [Автоматическое резервное копирование](sql-database-automated-backups.md)
  - [Восстановление базы данных SQL Azure с помощью автоматических резервных копий базы данных — восстановление до точки во времени](sql-database-recovery-using-backups.md#point-in-time-restore)

- Дополнительные функции обеспечения непрерывности бизнес-процессов, такие как группы автоматической отработки отказа в различных геообъектовах Azure, можно настроить, как описано здесь: [Обзор непрерывности бизнес-процессов с помощью базы данных SQL Azure](sql-database-business-continuity.md) .

## <a name="next-steps"></a>Дальнейшие действия

- См. [Обзор возможностей безопасности базы данных SQL Azure](sql-database-security-overview.md) .