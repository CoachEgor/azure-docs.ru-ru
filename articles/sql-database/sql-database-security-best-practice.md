---
title: Playbook для решения общих требований безопасности (ru) Документы Майкрософт
titleSuffix: Azure SQL Database
description: В этой статье приведены общие требования к безопасности и рекомендации по базе данных Azure S'L.
ms.service: sql-database
ms.subservice: security
author: VanMSFT
ms.author: vanto
ms.topic: article
ms.date: 02/20/2020
ms.reviewer: ''
ms.openlocfilehash: c18e1b1a1feba5c528a692b7d63287b3751b62cf
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "77506225"
---
# <a name="playbook-for-addressing-common-security-requirements-with-azure-sql-database"></a>Playbook для решения общих требований безопасности с базой данных Azure S'L

> [!NOTE]
> В этом документе представлены рекомендации по решению общих требований безопасности. Не все требования применимы ко всем средам, и вам следует проконсультироваться с базой данных и группой безопасности, на которых следует реализовать функции.

## <a name="solving-common-security-requirements"></a>Решение общих требований безопасности

В этом документе содержатся рекомендации по решению общих требований к безопасности для новых или существующих приложений с использованием базы данных Azure S'L. Она организована в зонах безопасности высокого уровня. Для устранения конкретных угроз обратитесь к разделу [«Общие угрозы безопасности» и «Потенциальные меры по смягчению последствий».](#common-security-threats-and-potential-mitigations) Хотя некоторые из представленных рекомендаций применимы при переносе приложений из находиных в Azure, сценарии миграции не находятся в центре внимания этого документа.

### <a name="azure-sql-database-deployment-offers-covered-in-this-guide"></a>Развертывание базы данных Azure S'L, охватываемое в данном руководстве

- [Базы данных S'L:](https://docs.microsoft.com/azure/sql-database/sql-database-single-index) [единичные базы данных](sql-database-single-database.md) и [эластичные пулы](sql-database-elastic-pool.md) на [серверах базы данных Azure S'L](sql-database-servers.md)
- [Управляемые экземпляры](https://docs.microsoft.com/azure/sql-database/sql-database-managed-instance-index)

### <a name="sql-deployment-offers-not-covered-in-this-guide"></a>Предложения по развертыванию S'L, не охватываемые в данном руководстве

- Хранилище данных SQL Azure
- Вазум СЗЛ ВМ (IaaS)
- Локальный сервер SQL Server

### <a name="audience"></a>Аудитория

Предполагаемые аудитории для этого руководства – это клиенты, которые сталкиваются с вопросами о том, как обеспечить безопасность базы данных Azure S'L. Роли, заинтересованные в этой лучшей практике статьи включают, но не ограничивайся:

- Архитекторы безопасности
- Менеджеры по безопасности
- Сотрудники по соблюдению
- Сотрудники по вопросам конфиденциальности
- Инженеры по безопасности

### <a name="using-this-guide"></a><a id="using"></a>Использование этого руководства

Этот документ предназначен в качестве компаньона к нашей существующей [документации по безопасности базы данных Azure S'L.](sql-database-security-overview.md)

Если не указано иное, мы рекомендуем вам следовать всем рекомендациям, перечисленным в каждом разделе для достижения соответствующей цели или требования. Для соответствия конкретным стандартам безопасности или передовым методам важные меры контроля за соблюдением нормативных требований перечислены в разделе Требования или цели, где это применимо. Таковы стандарты и правила безопасности, которые упоминаются в настоящем документе:

- [FedRAMP](https://www.fedramp.gov/documents/): AC-04, AC-06
- [SOC](https://www.aicpa.org/interestareas/frc/assuranceadvisoryservices/sorhome.html): CM-3, SDL-3
- [ISO/IEC 27001](https://www.iso27001security.com/html/27001.html): Контроль доступа, Криптография
- [Практики microsoft Operational Security Assurance (OSA):](https://www.microsoft.com/en-us/securityengineering/osa/practices)Практика #1-6 и #9
- [NiST Специальная публикация 800-53 Контроль безопасности](https://nvd.nist.gov/800-53): AC-5, AC-6
- [PCI DSS](https://www.pcisecuritystandards.org/document_library): 6.3.2, 6.4.2

### <a name="feedback"></a>Отзывы

Мы планируем продолжать обновлять рекомендации и рекомендации, перечисленные здесь. Предоставьте ввод или любые исправления для этого документа, используя ссылку **обратной связи** в нижней части этой статьи.

## <a name="authentication"></a>Проверка подлинности

Аутентификацией называют процесс подтверждения личности пользователя. База данных SQL Azure поддерживает два типа аутентификации:

- Проверка подлинности SQL
- Аутентификация Azure Active Directory

> [!NOTE]
> Активная аутентификация Azure Active Directory может поддерживаться не для всех инструментов и приложений третьих сторон.

### <a name="central-management-for-identities"></a>Центральное управление удостоверениями личности

Центральное управление идентификацией предлагает следующие преимущества:

- Управление групповыми учетными записями и управление пользовательскими разрешениями без дублирования логинов на серверах и базах данных базы данных Azure S'L.
- Упрощенное и гибкое управление разрешением.
- Управление приложениями в масштабе.

**Как реализовать:**

- Используйте активную каталог Azure (Azure AD) проверку подлинности для централизованного управления удостоверениями.

**Лучшие практики**:

- Создайте арендатор Azure AD и [создайте пользователей](../active-directory/fundamentals/add-users-azure-active-directory.md) для представления интересов пользователей и создания [основ служб](../active-directory/develop/app-objects-and-service-principals.md) для представления приложений, служб и инструментов автоматизации. Принципы обслуживания эквивалентны учетным записям служб в Windows и Linux. 

- Назначайте права доступа к ресурсам к принципам Azure AD через групповое назначение: создавайте группы Azure AD, предоставляете доступ к группам и добавляют отдельных членов в группы. В базе данных создайте содержащиеся пользователи баз данных, которые сопожат группы Azure AD. Чтобы назначить разрешения внутри базы данных, поместите пользователей в роли базы данных с соответствующими разрешениями.
  - Просматривайте статьи, [направляйте и управляйте аутентификацией активных каталогов Azure с помощью S'L](sql-database-aad-authentication-configure.md) и [используйте Azure AD для проверки подлинности с помощью S'L.](sql-database-aad-authentication.md)
  > [!NOTE]
  > В управляемом экземпляре можно также создать логины, которые отображали принципы Azure AD в основной базе данных. Смотрите [CREATE LOGIN (Трансакт-СЗЛ)](https://docs.microsoft.com/sql/t-sql/statements/create-login-transact-sql?view=azuresqldb-mi-current).

- Использование групп Azure AD упрощает управление разрешениями и как владельцем группы, так и владельцем ресурса, который может добавлять/удалять членов в/из группы. 

- Создайте отдельную группу для администратора Azure AD для серверов S'L DB.

  - Смотрите статью [«Предоставление администратора активного каталога Azure для сервера базы данных Azure S'L».](sql-database-aad-authentication-configure.md#provision-an-azure-active-directory-administrator-for-your-azure-sql-database-server)

- Мониторинг членства группы Azure AD с помощью отчетов о деятельности аудита Azure AD. 

- Для управляемого экземпляра требуется отдельный шаг для создания админ-админ Azure AD. 
  - Смотрите статью [«Предоставить администратору активного каталога Azure для управляемого экземпляра—](sql-database-aad-authentication-configure.md#provision-an-azure-active-directory-administrator-for-your-managed-instance)это средство. 

> [!NOTE]
> - Аутентификация Azure AD записывается в журналах аудита Azure S'L, но не в журналах регистрации Azure AD.
> - Разрешения RBAC, выданные в Azure, не распространяются на разрешения Azure S'L DB. Такие разрешения должны создаваться/отображаться вручную в S'L DB с использованием существующих разрешений S'L.
> - На клиентской стороне Azure AD аутентификация нуждается в доступе к Интернету или через пользовательский маршрут (UDR) к VNet.
> - Токен доступа Azure AD кэшируется на стороне клиента, и его срок службы зависит от конфигурации маркера. Смотрите статью [«Настраиваемые сроки службы маркеров» в active-каталоге Azure](../active-directory/develop/active-directory-configurable-token-lifetimes.md)
> - Для получения рекомендаций по устранению неполадок Azure AD Аутентификация вопросов, см.<https://techcommunity.microsoft.com/t5/azure-sql-database/troubleshooting-problems-related-to-azure-ad-authentication-with/ba-p/1062991>

### <a name="multi-factor-authentication-mfa"></a>Многофакторная идентификация (MFA)

> Упомянутые в: ПРАКТИКА OSA #2, ISO Контроль доступа (AC)

Multi-Factor Authentication (MFA) помогает обеспечить дополнительную безопасность, требуя более одной формы аутентификации.

**Как реализовать:**

- [Включите МИД](../active-directory/authentication/concept-mfa-howitworks.md) в Azure AD с помощью условного доступа и используйте интерактивную аутентификацию. 

- Альтернативой является включение МИД для всего домена Azure AD или AD.

**Лучшие практики**:

- Активируйте условный доступ в Azure AD (требует подписки Premium). 
  - Смотрите статью [«Условный доступ в Azure AD](../active-directory/conditional-access/overview.md)».  

- Создайте группу Azure AD (ы) и включите политику МИД для отдельных групп, использующих условный доступ Azure AD. 
  - Смотрите статью, [План условного развертывания доступа](../active-directory/conditional-access/plan-conditional-access.md). 

- МИД может быть включен для всего Azure AD или для всего Active Directory, федеративного с помощью Azure AD. 

- Используйте режим интерактивной аутентификации Azure AD для S'L DB, где пароль запрашивается в интерактивном режиме, а затем за аутентификацией МИД:      
  - Используйте универсальную аутентификацию в SSMS. См. статью [«Использование многофакторной аутентификации AAD с базой данных Azure S'L» и хранилищем данных Azure S'L (поддержка SSMS для МИД).](sql-database-ssms-mfa-authentication.md)
  - Используйте интерактивную аутентификацию, поддерживаемую в инструментах данных серверов S'L (SSDT). Смотрите статью поддержки [Active Directory Azure в s'L Server Data Tools (SSDT)](https://docs.microsoft.com/sql/ssdt/azure-active-directory?view=azuresqldb-current).
  - Используйте другие инструменты S'L, поддерживающие МИД. 
    - Поддержка SSMS Wizard для базы данных экспорта/экстракта/развертывания  
    - [sqlpackage.exe](https://docs.microsoft.com/sql/tools/sqlpackage): вариант '/ua' 
    - [sqlcmd Утилита](https://docs.microsoft.com/sql/tools/sqlcmd-utility): вариант -G (интерактивный)
    - [bcp Утилита](https://docs.microsoft.com/sql/tools/bcp-utility): вариант -G (интерактивный) 

- Реализуйте приложения для подключения к базе данных Azure S'L с помощью интерактивной аутентификации с поддержкой МИД. 
  - Смотрите статью [«Подключитесь к базе данных Azure S'L с помощью многофакторной аутентификации Azure](active-directory-interactive-connect-azure-sql-db.md)». 
  > [!NOTE]
  > Этот режим проверки подлинности требует пользовательских идентификаций. В тех случаях, когда используется доверенная модель идентификации, которая обойдя индивидуальную аутентификацию пользователя Azure AD (например, с использованием управляемой идентификации для ресурсов Azure), MFA не применяется.

### <a name="minimize-the-use-of-password-based-authentication-for-users"></a>Свести к минимуму использование проверки подлинности на основе паролей для пользователей

> Упомянутые в: ПРАКТИКА OSA #4, ISO Контроль доступа (AC)

Методы проверки подлинности на основе паролей являются более слабой формой проверки подлинности. Учетные данные могут быть скомпрометированы или ошибочно отданы.

**Как реализовать:**

- Используйте интегрированную аутентификацию Azure AD, которая исключает использование паролей.

**Лучшие практики**:

- Используйте единую проверку подлинности с использованием учетных данных Windows. Федеративизируй домен AD с Azure AD и используйте интегрированную аутентификацию Windows (для доменных машин с Azure AD).
  - Смотрите статью [SSMS-поддержки интегрированной аутентификации Azure AD.](sql-database-aad-authentication-configure.md#active-directory-integrated-authentication)

### <a name="minimize-the-use-of-password-based-authentication-for-applications"></a>Свести к минимуму использование проверки подлинности на основе паролей для приложений 

> Упомянутые в: ПРАКТИКА OSA #4, ISO Контроль доступа (AC)

**Как реализовать:**

- Включите управляемую идентификацию Azure. Вы также можете использовать интегрированную или сертификатную аутентификацию. 

**Лучшие практики**:

- Используйте [управляемые идентификаторы для ресурсов Azure.](../active-directory/managed-identities-azure-resources/overview.md)
  - [Система назначенных управляемых итог](../active-directory/managed-identities-azure-resources/tutorial-windows-vm-access-sql.md) 
  - [Управляемая имиличность, назначенная пользователем](../active-directory/managed-identities-azure-resources/how-to-manage-ua-identity-portal.md)
  - [Используйте базу данных Azure S'L из службы приложений с управляемой идентификацией (без изменений кода)](https://github.com/Azure-Samples/app-service-msi-entityframework-dotnet)

- Используйте проверку подлинности на основе сертификата для приложения. 
  - Смотрите этот [пример кода](https://github.com/Microsoft/sql-server-samples/tree/master/samples/features/security/azure-active-directory-auth/token). 

- Используйте аутентификацию Azure AD для интегрированного федеративного домена и машины, присоединенных к домену (см. раздел выше).
  - Смотрите [пример приложения для комплексной аутентификации.](https://github.com/Microsoft/sql-server-samples/tree/master/samples/features/security/azure-active-directory-auth/integrated)

### <a name="protect-passwords-and-secrets"></a>Защита паролей и секретов

В случаях, когда пароли не можно избежать, убедитесь, что они защищены.

**Как реализовать:**

- Используйте Azure Key Vault для хранения паролей и секретов. Когда это применимо, используйте МИД для базы данных Azure s'L с пользователями Azure AD.

**Лучшие практики**:

- Если избежать паролей или секретов невозможно, храните пароли пользователей и секреты приложений в Azure Key Vault и управляйте доступом через политики доступа Key Vault. 

- Различные платформы разработки приложений могут также предлагать механизмы защиты секретов в приложении. Например: [ASP.NET основное приложение](https://docs.microsoft.com/aspnet/core/security/app-secrets?view=aspnetcore-2.1&tabs=windows).

### <a name="use-sql-authentication-for-legacy-applications"></a>Используйте проверку подлинности S'L для устаревших приложений 

Проверка подлинности СЗЛ относится к аутентификации пользователя при подключении к базе данных Azure S'L с использованием имени пользователя и пароля. На каждом сервере базы данных или в управляемом экземпляре необходимо будет создать логин, а в каждой базе данных — пользователя.

**Как реализовать:**

- Используйте проверку подлинности S'L.

**Лучшие практики**:

- Как администратор сервера, создавайте логины и пользователей. Если не использовать содержащиеся пользователи базы данных с паролями, все пароли хранятся в основной базе данных.
  - Ознакомьтесь со статьей [«Управление и предоставление доступа к базе данных» и хранилищам данных S'L.](sql-database-manage-logins.md)

## <a name="access-management"></a>Управление доступом

Управление доступом — это процесс управления и управления доступом авторизованных пользователей и привилегиями к базе данных Azure S'L.

### <a name="implement-principle-of-least-privilege"></a>Реализация принципа наименьших привилегий

> Упомянутые в: FedRamp контролирует AC-06, NIST: AC-6, OSA Практика #3

Принцип наименьших привилегий гласит, что пользователи не должны иметь больше привилегий, чем необходимо для выполнения своих задач. Для получения дополнительной информации, [см.](https://docs.microsoft.com/powershell/scripting/learn/remoting/jea/overview)

**Как реализовать:**

Назначайте только необходимые разрешения для выполнения [необходимых](https://docs.microsoft.com/sql/relational-databases/security/permissions-database-engine) задач:

- В плоскости данных S'L: 
    - Используйте детальные разрешения и определенные пользователями роли базы данных (или роли сервера в MI): 
        1. Создание требуемых ролей
            - [CREATE ROLE](https://docs.microsoft.com/sql/t-sql/statements/create-role-transact-sql)
            - [CREATE SERVER ROLE](https://docs.microsoft.com/sql/t-sql/statements/create-server-role-transact-sql)
        1. Создание необходимых пользователей
            - [СОЗДАНИЕ ПОЛЬЗОВАТЕЛЯ](https://docs.microsoft.com/sql/t-sql/statements/create-user-transact-sql)
        1. Добавление пользователей в качестве членов в роли 
            - [ALTER ROLE](https://docs.microsoft.com/sql/t-sql/statements/alter-role-transact-sql)
            - [ИЗМЕНИТЬ РОЛЬ СЕРВЕРА](https://docs.microsoft.com/sql/t-sql/statements/alter-server-role-transact-sql)
        1. Затем назначайте разрешения на роли. 
            - [Предоставить](https://docs.microsoft.com/sql/t-sql/statements/grant-transact-sql) 
    - Убедитесь в том, чтобы не назначать пользователям ненужные роли.

- В менеджере ресурсов Azure:
  - Используйте встроенные роли, если они доступны или пользовательские роли RBAC и назначайте необходимые разрешения.
    - [Встроенные роли для Azure](../role-based-access-control/built-in-roles.md) 
    - [Пользовательские роли для ресурсов Azure](../role-based-access-control/custom-roles.md)

**Лучшие практики**:

Следующие рекомендации не являются обязательными, но приведут к лучшей управляемости и поддержке вашей стратегии безопасности: 

- Если возможно, начните с наименее возможного набора разрешений и начните добавлять разрешения один за другой, если есть реальная необходимость (и обоснование) - в отличие от противоположного подхода: принятие разрешений шаг за шагом. 

- Воздержитесь от назначения разрешений отдельным пользователям. Вместо этого используйте роли (базы данных или роли сервера). Роли в значительной степени помогают с отчетами и разрешениями по устранению неполадок. (Azure RBAC поддерживает назначение разрешений только через роли.) 

- Создавайте и используйте пользовательские роли с нужными разрешениями. Типичные роли, которые используются на практике: 
  - Развертывание безопасности 
  - Администратор 
  - Разработчик 
  - Вспомогательный персонал 
  - Аудитор 
  - Автоматизированные процессы 
  - Конечный пользователь 
  
- Используйте встроенные роли только тогда, когда разрешения ролей точно совпадают с необходимыми разрешениями для пользователя. Можно назначить пользователям несколько ролей. 

- Помните, что разрешения в движке базы данных сервера S'L могут быть применены на следующих областях. Чем меньше область, тем меньше влияние выданных разрешений: 
  - Сервер базы данных Azure S'L (специальные роли в главной базе данных) 
  - База данных 
  - схема
      - Лучше всего использовать схемы для предоставления разрешений внутри базы данных. (также см.: [Схема-дизайн для сервера S'L: рекомендации по дизайну Schema с учетом безопасности)](http://andreas-wolter.com/en/schema-design-for-sql-server-recommendations-for-schema-design-with-security-in-mind/)
  - Объект (таблица, вид, процедура и т.д.) 
  > [!NOTE]
  > Не рекомендуется применять разрешения на уровне объекта, поскольку этот уровень добавляет ненужную сложность общей реализации. Если вы решили использовать разрешения на уровне объектов, они должны быть четко задокументированы. То же самое относится и к разрешениям уровня столбцов, которые еще менее рекомендуемы по тем же причинам. Также имейте в виду, что по умолчанию [ДЕНИ](https://docs.microsoft.com/sql/t-sql/statements/deny-object-permissions-transact-sql) на уровне таблицы не перекрывает ГРАНТ уровня столбцов. Это потребует активации [общей конфигурации сервера соответствия общим критериям.](https://docs.microsoft.com/sql/database-engine/configure-windows/common-criteria-compliance-enabled-server-configuration-option)

- Выполняйте регулярные проверки с помощью [оценки уязвимости (VA)](https://docs.microsoft.com/sql/relational-databases/security/sql-vulnerability-assessment) для проверки слишком большого количества разрешений.

### <a name="implement-separation-of-duties"></a>Осуществление разделения обязанностей

> Упомянутые в: FedRamp: AC-04, NIST: AC-5, ISO: A.6.1.2, PCI 6.4.2, SOC: CM-3, SDL-3

Разделение обязанностей, также называемое Сегрегацией обязанностей, описывает требование разделить конфиденциальные задачи на несколько задач, которые назначаются разным пользователям. Разделение обязанностей помогает предотвратить утечку данных.

**Как реализовать:**

- Определить необходимый уровень разделения обязанностей. Примеры: 
  - Между средами разработки/испытаний и производства 
  - Чувствительные задачи, учитывающие безопасность, против задач управления администратором базы данных (DBA) против задач разработчика. 
    - Примеры: Аудитор, создание политики безопасности для безопасности уровня ролей (RLS), реализация объектов базы данных СЗЛ с dDL-разрешениями.

- Определите всеобъемлющую иерархию пользователей (и автоматизированных процессов), которые получают доступ к системе.

- Создавайте роли в соответствии с необходимыми группами пользователей и присваивая разрешения роянам. 
  - Для задач на уровне управления на портале Azure или через PowerShell-автоматизацию используются роли RBAC. Либо найти встроенную роль, соответствующую требованию, либо создать пользовательскую роль RBAC с использованием доступных разрешений 
  - Создавайте роли сервера для задач, высылаемых на сервере (создание новых логинов, баз данных) в управляемом экземпляре. 
  - Создавайте роли баз данных для задач уровня базы данных.

- Для некоторых чувствительных задач рассмотрите возможность создания специальных сохраненных процедур, подписанных сертификатом, для выполнения задач от имени пользователей. 
  - Пример: [Учебник: Подписание сохраненных процедур с сертификатом](https://docs.microsoft.com/sql/relational-databases/tutorial-signing-stored-procedures-with-a-certificate) 

- Внедрение прозрачного шифрования данных (TDE) с ключами, управляемыми клиентами, в Azure Key Vault, чтобы обеспечить разделение обязанностей между владельцем данных и владельцем безопасности. 
  - Смотрите статью [«Нанастройка управляемых клиентом ключей для шифрования хранилища Azure» с портала Azure.](../storage/common/storage-encryption-keys-portal.md) 

- Чтобы гарантировать, что dBA не может видеть данные, которые считаются очень чувствительными и могут выполнять задачи dBA, можно использовать Always Encrypted с разделением ролей. 
  - Смотрите статьи, [Обзор управления ключами для всегда зашифрованных](https://docs.microsoft.com/sql/relational-databases/security/encryption/overview-of-key-management-for-always-encrypted), [Ключевые Обеспечение с разделением ролей](https://docs.microsoft.com/sql/relational-databases/security/encryption/configure-always-encrypted-keys-using-powershell#KeyProvisionWithRoles), и [колонка Мастер ключ вращения с разделением ролей](https://docs.microsoft.com/sql/relational-databases/security/encryption/rotate-always-encrypted-keys-using-powershell#column-master-key-rotation-with-role-separation). 

- В тех случаях, когда это невозможно, по крайней мере, не без серьезных затрат и усилий, которые могут сделать систему почти непригоденной, компромиссы могут быть сделаны и смягчены с помощью компенсационных средств контроля, таких как: 
  - Вмешательство человека в процессы. 
  - Аудит тропы - для получения дополнительной информации о аудите, см., [Аудит критических событий безопасности](#audit-critical-security-events).

**Лучшие практики**:

- Убедитесь, что различные учетные записи используются для сред разработки/тестирования и производства. Различные учетные записи помогают соблюдать разделение систем Test & Production.

- Воздержитесь от назначения разрешений отдельным пользователям. Вместо этого используйте роли (базы данных или роли сервера). Наличие ролей в значительной степени помогает с разрешениями отчетности и устранения неполадок.

- Используйте встроенные роли, когда разрешения точно совпадают с необходимыми разрешениями – если объединение всех разрешений от нескольких встроенных ролей приводит к сотворифику 100%, можно назначить несколько ролей одновременно. 

- Создавайте и используйте пользовательские роли, когда встроенные роли предоставляют слишком много разрешений или недостаточно ею. 

- Назначения ролей также могут быть выполнены временно, также известный как динамическое разделение обязанностей (DSD), либо в рамках шагов по работе с агентом S'L в T-S'L, либо с помощью Azure PIM для ролей RBAC. 

- Убедитесь, что администраторы баз данных не имеют доступа к ключам шифрования или ключевым магазинам, а администраторы безопасности, которые по очереди не имеют доступа к базе данных. 

- Всегда убедитесь, что у него есть аудиторский след для действий, связанных с безопасностью. 

- Вы можете получить определение встроенных ролей RBAC, чтобы увидеть используемые разрешения и создать пользовательскую роль, основанную на выдержках и кумуляциях этих с помощью PowerShell.

- Поскольку любой член db_owner роли базы данных может изменить параметры безопасности, такие как Transparent Data Encryption (TDE), или изменить SLO, это членство должно быть предоставлено с осторожностью. Однако существует множество задач, требующих db_owner привилегий. Такая задача, как изменение любой настройки базы данных, такие как изменение параметров DB. Аудит играет ключевую роль в любом решении.

- Нельзя ограничивать разрешения db_owner и, следовательно, препятствовать просмотру данных пользователей административной учетной записью. Если в базе данных есть высокочувствительные данные, всегда шифрованные могут быть использованы для безопасного предотвращения просмотра db_owners или любой другой базой данных.

> [!NOTE]
> Достижение разделения обязанностей (SoD) является сложной задачей для задач, связанных с безопасностью или устранением неполадок. Другие области, такие как разработка и роли конечных пользователей, легче сегрегировать. Большинство элементов управления, связанных с соответствием требованиям, позволяют использовать альтернативные функции управления, такие как аудит, когда другие решения не практичны.

Для читателей, которые хотят погрузиться глубже в SoD, мы рекомендуем следующие ресурсы: 

- Для базы данных SQL Azure  
  - [Контроль и предоставление доступа к базе данных SQL и хранилищу данных SQL](sql-database-manage-logins.md)
  - [Разделение обязанностей двигателя для разработчика приложений](https://docs.microsoft.com/previous-versions/sql/sql-server-2008/cc974525(v=sql.100)) 
  - [Разделение обязанностей в сервере S'L 2014](https://www.microsoft.com/download/details.aspx?id=39269)
  - [Подписывание хранимых процедур в SQL Server](https://docs.microsoft.com/dotnet/framework/data/adonet/sql/signing-stored-procedures-in-sql-server)

- Для управления ресурсами Azure:
  - [Встроенные роли для Azure](../role-based-access-control/built-in-roles.md) 
  - [Пользовательские роли для ресурсов Azure](../role-based-access-control/custom-roles.md)
  - [Использование управления привилегированным удостоверением личности Azure AD для повышенного доступа](https://www.microsoft.com/en-us/itshowcase/using-azure-ad-privileged-identity-management-for-elevated-access)

### <a name="perform-regular-code-reviews"></a>Регулярно выполнять обзоры кода

> Упомянутые в: PCI: 6.3.2, SOC: SDL-3 

Разделение обязанностей не ограничивается данными в базе данных, но включает в себя код приложения. Вредоносный код потенциально может обойти элементы управления безопасностью. Прежде чем развертывать пользовательский код в производство, необходимо просмотреть развертывание.

**Как реализовать:**

- Используйте инструмент базы данных, такой как Azure Data Studio, который поддерживает элемент управления исходным управлением. 

- Реализация сегрегированного процесса развертывания кода.

- Прежде чем совершить в основной ветви, человек (кроме автора самого кода) должен проверить код на предмет потенциального повышения рисков привилегий, а также вредоносных изменений данных для защиты от мошенничества и мошеннического доступа. Это можно сделать с помощью механизмов управления исходом.

**Лучшие практики**:

- Стандартизация: Это помогает реализовать стандартную процедуру, которая должна следовать для любых обновлений кода. 

- Оценка уязвимости содержит правила, которые проверяют наличие чрезмерных разрешений, использование старых алгоритмов шифрования и другие проблемы безопасности в схеме базы данных. 

- Дальнейшие проверки могут быть проведены в среде проверки контроля над КА или тестированием с помощью Advanced Threat Protection, который сканирует код, уязвимый для инъекций S'L.

- Примеры того, на что обратить внимание: 
  - Создание пользователя или изменение параметров безопасности в рамках автоматизированного развертывания обновления кода S'L. 
  - Сохраненная процедура, которая, в зависимости от предоставленных параметров, обновляет денежную стоимость в ячейке несоответствующим образом. 

- Убедитесь, что лицо, проводящее обзор, является человеком, не исходящей от автора кода, и знающим в код-обзорах и безопасном кодировании.

- Обязательно знайте все источники кодовых изменений. Код может быть в скриптах T-S'L. Это могут быть специальные команды, которые должны выполняться или развертываться в формах представлений, функций, триггеров и сохраненных процедур. Она может быть частью определений работы агента (Steps). Он также может быть выполнен из пакетов SSIS, Фабрики данных Azure и других служб.

## <a name="data-protection"></a>Защита данных

Защита данных — это набор возможностей для защиты важной информации от компрометации путем шифрования или запутывания.

> [!NOTE]
> Корпорация Майкрософт подтверждает, что база данных Azure S'L соответствует требованиям FIPS 140-2 Уровня 1. Это делается после проверки строгого использования приемлемых алгоритмов FIPS 140-2 Level 1 и проверенных экземпляров FIPS 140-2 Level 1 этих алгоритмов, включая согласованность с требуемой длиной ключа, управление ключами, генерацией ключей и хранением ключей. Эта аттестация предназначена для того, чтобы позволить нашим клиентам реагировать на необходимость или требование использования FIPS 140-2 Уровня 1 проверенных экземпляров при обработке данных или доставке систем или приложений. Мы определяем термины "FIPS 140-2 Уровень 1 совместимый" и "FIPS 140-2 Уровень 1 соответствия", используемые в вышеупомянутом заявлении, чтобы продемонстрировать их предполагаемое применение к США и Канаде правительство использовать различные термины "FIPS 140-2 Уровень 1 проверены". 


### <a name="encrypt-data-in-transit"></a>Шифрование данных в пути

> Упомянутые в: ПРАКТИКА OSA #6, ISO Управление Семьи: Криптография

Защищает ваши данные во время перемещения данных между клиентом и сервером. Ссылайтесь на [сетевую безопасность](#network-security).

### <a name="encrypt-data-at-rest"></a>Шифрование неактивных данных

> Упомянутые в: ПРАКТИКА OSA #6, ISO Управление Семьи: Криптография

Шифрование в состоянии покоя — это криптографическая защита данных, когда они сохраняются в файлах базы данных, журналов и резервных копий.

**Как реализовать:**

- [Прозрачное шифрование баз данных (TDE)](transparent-data-encryption-azure-sql.md) с управляемыми ключами службы включено по умолчанию для любых баз данных, созданных после 2017 года в базе данных Azure S'L.
- В управляемом экземпляре, если база данных создается из операции восстановления с помощью внутреннего сервера, настройка TDE исходной базы данных будет выполнена. Если в исходной базе данных нет включенного TDE, мы рекомендуем включать TDE вручную для управляемого экземпляра.

**Лучшие практики**:

- Не храните данные, требующие шифрования на отдыхе в основной базе данных. Мастер-база данных не может быть зашифрована с помощью TDE.

- Используйте управляемые клиентами ключи в Azure Key Vault, если вам необходимо повысить прозрачность и детальный контроль над защитой TDE. Azure Key Vault позволяет отозвать разрешения в любое время, чтобы сделать базу данных недоступной. Вы можете централизованно управлять протекторами TDE вместе с другими ключами или поворачивать протектор TDE в своем собственном графике с помощью Azure Key Vault.

- Если вы используете управляемые клиентами ключи в Azure Key Vault, следуйте статьям, [Рекомендациям по настройке TDE с Azure Key Vault](transparent-data-encryption-byok-azure-sql.md#recommendations-when-configuring-akv) и [как настроить Geo-DR с Azure Key Vault.](transparent-data-encryption-byok-azure-sql.md#geo-dr-and-customer-managed-tde)

### <a name="protect-sensitive-data-in-use-from-high-privileged-unauthorized-users"></a>Защита конфиденциальных данных, использоваемых от пользователей с высоким уровнем привилегий, неавторизованных

Используются данные, хранящиеся в памяти системы баз данных во время выполнения запросов S'L. Если база данных хранит конфиденциальные данные, ваша организация может быть обязана гарантировать, что пользователи с высоким и привилегированным уровнем не могут просматривать конфиденциальные данные в вашей базе данных. Пользователи с высокими привилегиями, такие как операторы Майкрософт или администраторы баз данных в вашей организации, должны иметь возможность управлять базой данных, но не допускать просмотра и потенциального изъятия конфиденциальных данных из памяти процесса сервера S'L или запроса базы данных.

Политики, определяющие, какие данные являются конфиденциальными и должны ли конфиденциальные данные быть зашифрованы в памяти и недоступны для администраторов в простом тексте, специфичны для вашей организации и правил соответствия требованиям, которых вы должны соблюдать. Пожалуйста, ознакомьтесь с соответствующим требованием: [Определить и пометить конфиденциальные данные](#identify-and-tag-sensitive-data).

**Как реализовать:**

- Используйте [Always Encrypted,](https://docs.microsoft.com/sql/relational-databases/security/encryption/always-encrypted-database-engine) чтобы обеспечить, чтобы конфиденциальные данные не были выставлены в простом тексте в базе данных Azure S'L, даже в памяти/в использовании. Всегда зашифрованное защищает данные от администраторов баз данных (DBA) и облачных администраторов (или плохих субъектов, которые могут выдавать себя за высокопривилегированных, но несанкционированных пользователей) и дает вам больше контроля над тем, кто может получить доступ к вашим данным.

**Лучшие практики**:

- Всегда зашифрованные не заменяет для шифрования данных в состоянии покоя (TDE) или в пути (SSL/TLS). Всегда зашифрованные не должны использоваться для нечувствительных данных, чтобы свести к минимуму влияние на производительность и функциональность. Использование всегда зашифрованное совместно с TDE и безопасности транспортного уровня (TLS) рекомендуется для всесторонней защиты данных на отдыхе, в пути и в использовании. 

- Оцените влияние шифрования идентифицированных столбцов конфиденциальных данных перед развертыванием Всегда зашифрованных в производственной базе данных. В общем, всегда зашифрованные уменьшает функциональность запросов на зашифрованных столбцах и имеет другие ограничения, перечисленные в [Всегда зашифрованные - Детали функции](https://docs.microsoft.com/sql/relational-databases/security/encryption/always-encrypted-database-engine#feature-details). Таким образом, может потребоваться реагектора приложения для повторной реализации функциональности, запрос не поддерживает, на стороне клиента или / и рефакторинг схемы базы данных, в том числе определения сохраненных процедур, функций, представлений и триггеров. Существующие приложения не могут работать с зашифрованными столбцов, если они не соответствуют ограничениям и ограничениям Всегда зашифрованных. В то время как экосистема инструментов, продуктов и услуг Майкрософт, поддерживающих always Encrypted, растет, некоторые из них не работают с зашифрованными столбцов. Шифрование столбца также может повлиять на производительность запроса в зависимости от характеристик рабочей нагрузки. 

- Управляйте всегда зашифрованными ключами с разделением ролей, если вы используете Always Encrypted для защиты данных от вредоносных би-би-с. При разделении ролей админ безопасности создает физические ключи. DBA создает в базе данных элементы метаданных ключа ключа столбца и столбцовых ключей, описывающие физические клавиши. Во время этого процесса администрированию безопасности не требуется доступ к базе данных, а DBA не требует доступа к физическим ключам в простом тексте. 
  - Смотрите статью [«Управление ключами с разделением ролей»](https://docs.microsoft.com/sql/relational-databases/security/encryption/overview-of-key-management-for-always-encrypted#managing-keys-with-role-separation) для получения подробной информации. 

- Храните основные ключи столбца в Хранилище ключей Azure для удобства управления. Избегайте использования Магазина сертификатов Windows (и в целом, распределенных ключевых решений магазина, в отличие от решений управления центральными ключами), которые затрудняют управление ключами. 

- Тщательно продумайте компромиссы с использованием нескольких ключей (клавиши шифрования столбца или клавиши шифрования столбцов). Держите количество ключей небольшим, чтобы снизить затраты на управление ключами. Один ключ ключа-колонки и один ключ шифрования столбца в базе данных, как правило, достаточно в средах устойчивого состояния (не в середине вращения ключа). Вам могут понадобиться дополнительные ключи, если у вас есть разные группы пользователей, каждая из которых использует различные ключи и получает доступ к различным данным.  

- Поверните мастер-клавиши столбца в соответствии с требованиями соответствия требованиям. Если вам также необходимо повернуть ключи шифрования столбцов, рассмотрите возможность использования онлайн-шифрования для минимизации простоя приложения. 
  - Смотрите статью [,Производительность и доступность соображения](https://docs.microsoft.com/sql/relational-databases/security/encryption/configure-column-encryption-using-powershell#performance-and-availability-considerations). 

- Используйте детерминированное шифрование, если вычисления (равенство) данных должны быть поддержаны. В противном случае используйте рандомизированное шифрование. Избегайте использования детерминированного шифрования для наборов данных с низким уровнем энтропии или наборов данных с общеизвестным распространением. 

- Если вы обеспокоены тем, что сторонний получает доступ к вашим данным на законных основаниях без вашего согласия, убедитесь, что все приложения и инструменты, имеющие доступ к ключам и данным в простом тексте, будут работать за пределами Microsoft Azure Cloud. Без доступа к ключам третья сторона не сможет расшифровать данные, если они не обходят шифрование.

- Всегда зашифрованное не легко поддерживает предоставление временного доступа к ключам (и защищенным данным). Например, если вам нужно поделиться ключами с базой данных, чтобы позволить dBA выполнять некоторые операции по очистке конфиденциальных и зашифрованных данных. Единственным способом отменить доступ к данным из dBA будет ротация как ключей шифрования столбца, так и ключей главного столбца, защищающих данные, что является дорогостоящей операцией. 

- Чтобы получить доступ к значениям простого текста в зашифрованных столбцах, пользователю необходимо иметь доступ к CMK, который защищает столбцы, настроенный в хранилище ключей, держащий CMK. Пользователь также должен иметь **VIEW ANY COLUMN MASTER KEY DEFINITION** и VIEW ANY COLUMN ENCRYPTION KEY **DEFINITION** разрешения на базу данных.

### <a name="control-access-of-application-users-to-sensitive-data-through-encryption"></a>Контроль доступа пользователей приложений к конфиденциальным данным с помощью шифрования

Шифрование может быть использовано как способ гарантировать, что только конкретные пользователи приложения, которые имеют доступ к криптографическим ключам, могут просматривать или обновлять данные.

**Как реализовать:**

- Используйте шифрование на уровне ячейки (CLE). Смотрите статью, [шифрование колонки данных](https://docs.microsoft.com/sql/relational-databases/security/encryption/encrypt-a-column-of-data) для получения подробной информации. 
- Используйте Всегда зашифровано, но имейте в виду его ограничение. Ограничения перечислены ниже.

**Рекомендации**

При использовании CLE:

- Контролируйте доступ к ключам с помощью разрешений и ролей S'L. 

- Используйте AES (рекомендуется AES 256) для шифрования данных. Алгоритмы, такие как RC4, DES и TripleDES, унижаются и не должны использоваться из-за известных уязвимостей. 

- Защитите симметричные ключи асимметричными ключами/сертификатами (не паролями), чтобы избежать использования 3DES. 

- Будьте осторожны при миграции базы данных с использованием шифрования cell-Level через экспорт/импорт (файлы bacpac). 
  - Ознакомьтесь с статьей [«Рекомендации по использованию шифрования уровня ячеек» в базе данных Azure S'L](https://blogs.msdn.microsoft.com/sqlsecurity/2015/05/12/recommendations-for-using-cell-level-encryption-in-azure-sql-database/) о том, как предотвратить потерю ключей при миграции данных, а также о других рекомендациях по наилучшей практике.

Имейте в виду, что Always Encrypted в первую очередь предназначен для защиты конфиденциальных данных, использоваемых от пользователей с высокими привилегиями базы данных Azure S (облачные операторы, DBAs) - [см. Защита конфиденциальных данных, использоваемых от высокопривилегированных, несанкционированных пользователей.](#protect-sensitive-data-in-use-from-high-privileged-unauthorized-users) Будьте в курсе следующих проблем при использовании Always Encrypted для защиты данных от пользователей приложений:

- По умолчанию все драйверы клиентов Майкрософт, поддерживающие Always Encrypted, сохраняют глобальный (по одному в приложении) кэш ключей шифрования столбцов. Как только водитель клиента приобретает ключ шифрования столбца простого текста, связавшись с ключевым магазином, держащим клавишу колонки, ключ шифрования столбцов plaintext кэшируется. Это делает изоляцию данных от пользователей многопользовательского приложения сложной задачей. Если приложение выдает себя за конечных пользователей при взаимодействии с ключевым хранилищем (например, Azure Key Vault), после того, как запрос пользователя заполняет кэш ключом шифрования столбца, последующий запрос, требующий того же ключа, но срабатывающий другим пользователем, будет использовать кэшированный ключ. Водитель не будет звонить в хранилище ключей и не проверяет, имеет ли второй пользователь разрешение на доступ к ключу шифрования столбца. В результате пользователь сможет увидеть зашифрованные данные, даже если пользователь не имеет доступа к ключам. Для достижения изоляции пользователей в многопользовательском приложении можно отключить кэширование ключа шифрования столбцов. Отключение кэширования приведет к дополнительным накладным расходам на производительность, так как водителю необходимо будет связаться с хранилищем ключей для каждого шифрования данных или операции по расшифровке.

### <a name="protect-data-against-unauthorized-viewing-by-application-users-while-preserving-data-format"></a>Защита данных от несанкционированного просмотра пользователями приложений при сохранении формата данных
Другой метод предотвращения несанкционированного просмотра данных заключается в том, чтобы запутать или замаскировать данные, сохраняя при этом типы и форматы данных, чтобы гарантировать, что пользовательские приложения могут продолжать обрабатывать и отображать данные.

**Как реализовать:**

- Используйте [динамические маскировки данных](https://docs.microsoft.com/sql/relational-databases/security/dynamic-data-masking) для запутываний столбцов таблиц.

> [!NOTE]
> Всегда зашифрованный не работает с динамической маскировки данных. Невозможно шифровать и маскировать один и тот же столбец, что означает, что необходимо расставить приоритеты в области защиты данных, наданных по сравнению с маскировкой данных для пользователей приложения с помощью динамической маскировки данных.

**Лучшие практики**:

> [!NOTE]
> Динамическая маскировка данных не может использоваться для защиты данных от пользователей с высокими привилегиями. Политики маскировки не распространяются на пользователей с административным доступом, например, db_owner.

- Не разрешают пользователям приложений запускать специальные запросы (поскольку они могут работать с динамической маскировкой данных).  
  - Смотрите статью, [обход маскировки с помощью выводов или грубой силы методы](https://docs.microsoft.com/sql/relational-databases/security/dynamic-data-masking#security-note-bypassing-masking-using-inference-or-brute-force-techniques) для деталей.  

- Используйте надлежащую политику управления доступом (через разрешения, роли, RLS, RLS) для ограничения пользовательских разрешений для обновления в замаскированных столбцах. Создание маски на столбце не препятствует обновлению этой колонки. Пользователи, которые получают замаскированные данные при запросе в замаскированную колонку, могут обновлять данные, если у них есть разрешения на запись.    

-  Динамический маскировка данных не сохраняет статистические свойства замаскированных значений. Это может повлиять на результаты запросов (например, запросы, содержащие фильтрацию предикатов или соединения с замаскированными данными).

## <a name="network-security"></a>Безопасность сети
Сетевая безопасность относится к элементам управления доступом и передовым методам защиты данных в пути к базе данных Azure S'L.

### <a name="configure-my-client-to-connect-securely-to-azure-sql-database"></a>Наверстойная настройка моего клиента для безопасного подключения к базе данных Azure S'L 
Рекомендации по предотвращению подключения клиентских машин и приложений с хорошо известными уязвимостями (например, с использованием старых протоколов TLS и наборов шифров) в базе данных Azure S'L.

**Как реализовать:**

- Убедитесь, что клиентские машины, подключающиеся к базе данных Azure S'L, используют [систему безопасности транспортного уровня (TLS).](sql-database-security-overview.md#transport-layer-security-tls-encryption-in-transit)

**Лучшие практики**:

- Нанастройка всех приложений и инструментов для подключения к S'L DB с включенным шифрованием 
  - Шифрование , TrustServerCertificate - Off (или эквивалент с не-драйверов Microsoft). 

- Если ваше приложение использует драйвер, который не поддерживает TLS или поддерживает старую версию TLS, замените драйвер, если это возможно. Если это невозможно, тщательно оцените риски безопасности. 

- Уменьшите вектор атак с помощью уязвимостей в SSL 2.0, SSL 3.0, TLS 1.0 и TLS 1.1, отключив их на клиентских машинах, подключающихся к базе данных Azure S'L, в [настройках безопасности транспортного слоя (TLS).](https://docs.microsoft.com/windows-server/security/tls/tls-registry-settings#tls-10) 

- Проверьте наборы шифров, доступные на клиенте: [Cipher Suites в TLS/SSL (Schannel SSP).](https://docs.microsoft.com/windows/desktop/SecAuthN/cipher-suites-in-schannel) В частности, отключить 3DES за [настройку TLS Cipher Suite Order.](https://docs.microsoft.com/windows-server/security/tls/manage-tls#configuring-tls-cipher-suite-order) 

- Для базы данных Azure S'L шифрование обеспечивается как для типов прокси-серверов, так и для перенаправления соединений. Если вы используете управляемый экземпляр, используйте тип соединения **Прокси** (по умолчанию), поскольку это обеспечивает шифрование со стороны сервера. Тип **соединения Redirect** в настоящее время не поддерживает шифрование и доступен только на частных IP-соединениях. 

- Для получения дополнительной информации посетите [архитектуру подключения Azure S'L - политика подключения](sql-database-connectivity-architecture.md#connection-policy).


### <a name="minimize-attack-surface"></a>Минимизация поверхности атаки
Свести к минимуму количество функций, которые могут быть атакованы злоумышленником. Осуществлять элементы управления доступом к сети для базы данных Azure S'L.

> Упомянутые в: OSA Практика #5

**Как реализовать:**

На сервере базы данных Azure S'L (содержащий однотонную базу данных или эластичные пулы):
- Установите разрешить доступ к службам Azure для OFF.

- Используйте конечные точки службы VNet и правила брандмауэра VNet.

- Используйте частную ссылку (предварительный просмотр).

В управляемом экземпляре:
- Следуйте рекомендациям в [требованиях Сети](sql-database-managed-instance-connectivity-architecture.md#network-requirements). 

**Лучшие практики**:

- Ограничение доступа к базе данных Azure S'L путем подключения на частной конечной точке (например, с помощью частного пути данных): 
  - Управляемый экземпляр может быть изолирован внутри VNet для предотвращения внешнего доступа. Приложения и инструменты, которые находятся в одном и том же vNet или загляну в одном регионе, могут получить к нему прямой доступ. Приложения и инструменты, которые находятся в разных регионах, могут использовать соединение VNet-to-VNet или пиринг схемы ExpressRoute для установления соединения. Клиент должен использовать группы сетевой безопасности (NSG) для ограничения доступа через порт 1433 только к ресурсам, требующим доступа к управляемому экземпляру 
  - Для сервера базы данных S'L (содержащего отдельные базы данных или эластичные пулы) используйте функцию [Private Link,](sql-database-private-endpoint-overview.md) которая предоставляет специальный частный IP-адрес для сервера базы данных S'L внутри ВСети. Вы также можете использовать [конечные точки VNet Service с правилами VNet Firewall,](sql-database-vnet-service-endpoint-rule-overview.md) чтобы ограничить доступ к серверам базы данных S'L.
  - Мобильные пользователи должны использовать VPN-соединения от точки к сайту для подключения по пути передачи данных.
  - Пользователи, подключенные к своей собственной сети, должны использовать VPN-соединение от места к сайту или ExpressRoute для подключения по пути передачи данных.

- Вы можете получить доступ к базе данных Azure S'L, подключившись к общедоступной конечной точке (например, используя общедоступный путь данных). Следует рассмотреть следующие рекомендации: 
  - Для сервера базы данных S'L используйте [правила IP-брандмауэра,](sql-database-firewall-configure.md) чтобы ограничить доступ только к авторизованным IP-адресам.
  - Для управляемого экземпляра используйте группы сетевой безопасности (NSG) для ограничения доступа через порт 3342 только для требуемых ресурсов. Для получения дополнительной информации [см.](sql-database-managed-instance-public-endpoint-securely.md) 

> [!NOTE]
> Общедоступный конечный момент управляемого экземпляра не включен по умолчанию, и он и должен быть явно включен. Если политика компании запрещает использование общедоступных конечных точек, используйте [политику Azure,](../governance/policy/overview.md) чтобы предотвратить включение общедоступных конечных точек в первую очередь.

- Настройка компонентов сети Azure: 
  - Следите за [рекомендациями Azure по сетевой безопасности.](../security/fundamentals/network-best-practices.md)
  - План виртуальная сеть (VNet) конфигурации на лучшие практики, изложенные в [Azure Виртуальная сеть часто задают вопросы (часто задаваемые вопросы (часто)](../virtual-network/virtual-networks-faq.md) и план. 
  - Сегментируйте VNet на несколько подсетей и назначаем ресурсы для аналогичной роли одной и той же подсети (например, фронт-энд против ресурсов бэк-энда).
  - Используйте [группы сетевой безопасности (НСГ)](../virtual-network/security-overview.md) для управления трафиком между подсетями внутри границы Azure VNet.
  - Включите [Azure Network Watcher](../network-watcher/network-watcher-monitoring-overview.md) для подписки для мониторинга входящего и исходящего сетевого трафика.

### <a name="configure-power-bi-for-secure-connections-to-azure-sql-database"></a>Налажить Power BI для безопасных подключений к базе данных Azure S'L

**Лучшие практики**:

- Для Power BI Desktop, по возможности используйте личный путь передачи данных. 

- Убедитесь, что Power BI Desktop подключается с помощью TLS1.2, устанавливая ключ реестра на клиентской машине в зависимости от настроек реестра [Transport Layer Security (TLS).](https://docs.microsoft.com/windows-server/security/tls/tls-registry-settings) 

- Ограничьте доступ к данным для конкретных пользователей с помощью [безопасности уровня строки (RLS) с помощью Power BI.](https://docs.microsoft.com/power-bi/service-admin-rls) 

- Для службы Power BI используйте [шлюз данных,](https://docs.microsoft.com/power-bi/service-gateway-onprem)имея в виду [ограничения и соображения.](https://docs.microsoft.com/power-bi/service-gateway-deployment-guidance#installation-considerations-for-the-on-premises-data-gateway)

### <a name="configure-app-service-for-secure-connections-to-azure-sql-database"></a>Настройка службы приложений для безопасных подключений к базе данных Azure S'L

**Лучшие практики**:

- Для простого Web App подключение к общедоступной конечной точке требует настройки **Allow Azure Services** для ON. 

- [Интегрируйте приложение с виртуальной сетью Azure](../app-service/web-sites-integrate-with-vnet.md) для подключения к конфиденциальному пути передачи данных в управляемый экземпляр. Дополнительно можно также развернуть веб-приложение с [средой службы приложений (ASE).](../app-service/environment/intro.md) 

- Для Web App с ASE или VNet Integrated Web App, соединяющимся с базой данных на сервере базы данных S'L, вы можете использовать [конечные точки VNet Service и правила VNet Firewall](sql-database-vnet-service-endpoint-rule-overview.md) для ограничения доступа из определенной VNet и подсети. Затем **установите услуги Разрешить Azure** для OFF. Можно также подключить ASE к управляемому экземпляру по пути конфиденциальной передачи данных.  

- Убедитесь, что ваше веб-приложение настроено в статью, [рекомендации по обеспечению безопасности Web-приложений PaaS и мобильных приложений с помощью Azure App Service.](../security/security-paas-applications-using-app-services.md) 

- Установите [веб-приложение Firewall (WAF)](../application-gateway/waf-overview.md) для защиты веб-приложения от распространенных уязвимостей и уязвимостей.

### <a name="configure-azure-vm-hosting-for-secure-connections-to-azure-sql-database"></a>Наймите vM-хостинг Azure для безопасных подключений к базе данных Azure S'L

**Лучшие практики**:

- Используйте комбинацию правил Разрешить и отрицание на Нски VMs Azure, чтобы контролировать, к каким регионам можно получить доступ из VM.

- Убедитесь, что ваш VM настроен в статье, [рекомендации по безопасности для рабочих нагрузок IaaS в Azure.](../security/azure-security-iaas.md)

- Убедитесь, что все vMs связаны с определенными VNet и подсетью. 

- Оцените, нужен ли вам маршрут по умолчанию 0.0.0.0/Internet в руководстве примерно при [принудительном туннелировании.](../vpn-gateway/vpn-gateway-forced-tunneling-rm.md#about-forced-tunneling) 
  - Если да - например, передняя подсеть - то сохранить маршрут по умолчанию.
  - Если нет - например, среднего уровня или бэк-энд подсети - то включить силу туннелирования, чтобы никакой трафик идет через Интернет, чтобы достичь на территории (ака кросс-прелести). 

- Реализация [дополнительных маршрутов по умолчанию,](../virtual-network/virtual-networks-udr-overview.md#optional-default-routes) если вы используете пиринг или подключение к наместера. 

- Реализация [пользовательских определенных маршрутов,](../virtual-network/virtual-networks-udr-overview.md#user-defined) если вам нужно отправить весь трафик в VNet в сеть Виртуальный прибор для проверки пакетов. 

- Используйте [конечные точки Службы VNet](sql-database-vnet-service-endpoint-rule-overview.md) для безопасного доступа к службам PaaS, таким как Azure Storage через магистральные сети Azure. 

### <a name="protect-against-distributed-denial-of-service-ddos-attacks"></a>Защита от атак распределенного отказа в обслуживании (DDoS)
Распределенные атаки типа «отказ в обслуживании» (DDoS) — это попытки злоумышленника отправить поток сетевого трафика в базу данных Azure S'L database с целью захлестнуть инфраструктуру Azure и заставить ее отклонить допустимые логины и рабочую нагрузку.

> Упомянутые в: ПРАКТИКА ОСА #9

**Как реализовать:**

DDoS-защита автоматически включается как часть платформы Azure. Она включает в себя постоянное мониторинг трафика и смягчение атак на уровне сети на общедоступные конечные точки в режиме реального времени. 

- Используйте [DDoS-защиту Azure](../virtual-network/ddos-protection-overview.md) для мониторинга общедоступных IP-адресов, связанных с ресурсами, развернутыми в VNets.

- Используйте [расширенную защиту угроз для базы данных Azure S'L](sql-database-threat-detection-overview.md) для обнаружения атак отказов в обслуживании (DoS) в отношении баз данных.

**Лучшие практики**:

- Следовать описанным методам, описанным в [«Минимизации поверхности атаки»,](#minimize-attack-surface) можно свести к минимуму угрозы DDoS-атак. 

- Расширенная защита от угрозы **Brute силы S'L учетные данные** оповещения помогает обнаружить атаки грубой силы. В некоторых случаях оповещение может даже различать рабочие нагрузки тестирования на проникновение. 

- Для хостинговых приложений Azure VM, подключающихся к базе данных S'L: 
  - Следуйте рекомендациям ограничить доступ через конечные точки доступа в Интернет в Центре безопасности Azure. 
  - Используйте виртуальные наборы масштабов машин для выполнения нескольких экземпляров приложения на MMs Azure. 
  - Отойти от RDP и SSH от Интернета, чтобы предотвратить атаку грубой силы. 

## <a name="monitoring-logging-and-auditing"></a>Мониторинг, ведение журнала и аудит  
В этом разделе говорится о возможностях, помогая обнаруживать аномальные действия, указывающие на необычные и потенциально опасные попытки получить доступ к базам данных или использовать их. В нем также описаны рекомендации по настройке аудита баз данных для отслеживания и захвата событий базы данных.

### <a name="protect-databases-against-attacks"></a>Защита баз данных от атак 
Расширенная защита от угроз позволяет обнаруживать потенциальные угрозы и реагировать на них, предоставляя оповещения о безопасности в аномальных действиях.

**Как реализовать:**

- Используйте [Расширенную защиту угроз для S'L для](sql-database-threat-detection-overview.md#advanced-threat-protection-alerts) обнаружения необычных и потенциально опасных попыток доступа к базам данных или эксплуатации, в том числе:
  - Инъекционная атака СЗЛ.
  - Кража/утечка верительных данных.
  - Привилегии злоупотребления.
  - Эксфильтрация данных.

**Лучшие практики**:

- Нанастройка [расширенной безопасности данных (ADS)](sql-database-advanced-data-security.md#getting-started-with-ads) для базы данных Azure S'L для конкретного сервера базы данных S'L или управляемого экземпляра. Вы также можете настроить ADS для всех серверов базы данных S'L и управляемые экземпляры в подписке, переключившись на [стандартный уровень Azure Security Center.](../security-center/security-center-pricing.md) 

- Для получения полного опыта исследования рекомендуется включить [аудит базы данных S'L.](sql-database-auditing.md) С помощью аудита можно отслеживать события базы данных и записывать их в журнал аудита в учетной записи хранения Azure или в рабочей области Analytics журналов Azure. 

### <a name="audit-critical-security-events"></a>Аудит критических событий безопасности
Отслеживание событий базы данных помогает понять активность базы данных. Вы можете получить представление о несоответствиях и аномалиях, которые могут указывать на бизнес-проблемы или предполагаемые нарушения безопасности. Это также позволяет и облегчает соблюдение стандартов соответствия. 

**Как реализовать:**

- Позволяет [аудиту базы данных для отслеживания](sql-database-auditing.md) событий базы данных и записи их в журнал аудита в учетной записи хранения Azure, рабочей области анализа журналов (предварительный просмотр) или концентрах событий (предварительный просмотр). 

- Журналы аудита могут быть записаны в учетную запись хранилища Azure, в рабочее пространство для анализа журналов Azure Monitor или в концентратор событий для потребления с помощью концентратора событий. Вы также можете настроить любое сочетание этих вариантов, и журналы аудита будут записываться в каждый из них. 

**Лучшие практики**:

- Настраивая [аудит базы данных s'L](sql-database-auditing.md) на сервере базы данных для аудита событий, все существующие и вновь созданные базы данных на этом сервере будут проверены.
- По умолчанию политика аудита включает в себя все действия (запросы, сохраненные процедуры и успешные и неудачные логины) против баз данных, что может привести к большому объему журналов аудита. Клиентам рекомендуется [настроить аудит для различных типов действий и групп действий с использованием PowerShell.](sql-database-auditing.md#subheading-7) Настройка этого поможет контролировать количество проверенных действий и минимизировать риск потери события. Пользовательская конфигурация аудита позволяет клиентам фиксировать только необходимые данные аудита.
- Системы аудита можно использовать непосредственно на [портале Azure](https://portal.azure.com/)или из настроенного места хранения. 


> [!NOTE]
> Включение аудита в Log Analytics понесет затраты на основе коэффициентов приема. Пожалуйста, имейте в виду связанные с этим расходы на использование этой [опции](https://azure.microsoft.com/pricing/details/monitor/)или подумайте о хранении журналов аудита в учетной записи хранения Azure. 

**Дополнительные ресурсы**:

- [Аудит базы данных СЗЛ](sql-database-auditing.md)
- [Подсистема аудита SQL Server](https://docs.microsoft.com/sql/relational-databases/security/auditing/sql-server-audit-database-engine) 

### <a name="secure-audit-logs"></a>Безопасные журналы аудита
Ограничьте доступ к учетной записи хранилища для поддержки разделения обязанностей и отделения администраторов баз данных от аудиторов. 

**Как реализовать:**

- При сохранении журналов аудита в Хранилище Azure убедитесь, что доступ к учетной записи хранилища ограничен минимальными принципами безопасности. Контролируйте, кто имеет доступ к учетной записи хранилища.
    - Для получения дополнительной [Authorizing access to Azure Storage](../storage/common/storage-auth.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json)информации см.

**Лучшие практики**:

- Контроль доступа к целевому аудиту является ключевой концепцией в отделении DBA от аудиторов. 

- При проверке доступа к конфиденциальным данным следует закреплять данные с помощью шифрования данных, чтобы избежать утечки информации аудитору. Для получения дополнительной информации смотрите раздел [Защита конфиденциальных данных, использоваемых от высокопривилегированных, неавторизованных пользователей.](#protect-sensitive-data-in-use-from-high-privileged-unauthorized-users)

## <a name="security-management"></a>Управление безопасностью

В этом разделе описаны различные аспекты и рекомендации по управлению позицией безопасности баз данных. Она включает в себя лучшие практики для обеспечения настройки баз данных в соответствии со стандартами безопасности, для обнаружения и классификации и отслеживания доступа к потенциально конфиденциальным данным в базах данных. 

### <a name="ensure-that-the-databases-are-configured-to-meet-security-best-practices"></a>Убедитесь, что база данных (ы) настроены на соответствие рекомендациям по обеспечению безопасности 

Проактивно повысить безопасность базы данных, обнаруживая и исправления потенциальных уязвимостей базы данных.

**Как реализовать:**

- Включите [оценку уязвимости](https://docs.microsoft.com/sql/relational-databases/security/sql-vulnerability-assessment) (VA) для сканирования базы данных на вопросы безопасности и для автоматического выполнения периодически в ваших базах данных.

**Лучшие практики**:

- Первоначально, запустить В. А. на базах данных и итерировать путем устранения неудачных проверок, которые противоречат безопасности передового опыта. Настройка базовых линий для приемлемых конфигураций до тех пор, пока сканирование не выйдет _чистым_или не пройдено все проверки.  

- Налаживайте периодические периодические сканирование для выполнения один раз в неделю и настраивайте соответствующего человека для получения сводного письма. 

- Просмотрите резюме Va после каждого еженедельного сканирования. Для любых обнаруженных уязвимостей оцените дрейф от предыдущего результата сканирования и определите, следует ли разрешить проверку. Просмотрите, есть ли законная причина для изменения конфигурации.   

- Разрешить проверки и обновить базовые линии, где это уместно. Создавайте элементы билетов для решения действий и отслеживайте их до тех пор, пока они не будут устранены. 

**Дополнительные ресурсы**:

- [Оценка уязвимостей SQL](https://docs.microsoft.com/sql/relational-databases/security/sql-vulnerability-assessment) 
- [Служба оценки уязвимости SQL помогает определить уязвимость базы данных](sql-vulnerability-assessment.md)

### <a name="identify-and-tag-sensitive-data"></a>Определение и метка конфиденциальных данных 

Откройте для себя столбцы, которые потенциально содержат конфиденциальные данные. То, что считается конфиденциальными данными, в значительной степени зависит от клиента, регулирования соответствия и т.д., и должно быть оценено пользователями, ответственными за эти данные. Классифицировать столбцы для использования расширенных сценариев аудита и защиты на основе чувствительности. 

**Как реализовать:**

- Используйте [обнаружение и классификацию данных и классификацию данных s'L](sql-database-data-discovery-and-classification.md) для обнаружения, классификации, маркировки и защиты конфиденциальных данных в базах данных. 
  - Ознакомьтесь с рекомендациями по классификации, созданными автоматизированным открытием, в панели мониторинга и классификации данных S'L. Примите соответствующие классификации, таким образом, что ваши конфиденциальные данные постоянно помечены классификационными метками. 
  - Вручную добавляйте классификации для любых дополнительных чувствительных полей данных, которые не были обнаружены автоматизированным механизмом. 
- Для получения более подробной информации [&](https://docs.microsoft.com/sql/relational-databases/security/sql-data-discovery-and-classification)см.

**Лучшие практики**:

- Мониторинг панели мониторинга на регулярной основе для точной оценки состояния классификации базы данных. Отчет о состоянии классификации базы данных может быть экспортирован или напечатан для обмена для целей соответствия и аудита.

- Постоянно отслеживайте состояние рекомендуемых конфиденциальных данных в оценке уязвимости в S'L. Отслеживайте правило обнаружения конфиденциальных данных и идентифицируйте любой дрейф в рекомендуемых столбцах для классификации.  

- Используйте классификацию таким образом, чтобы она учитывалась специфические потребности организации. Настройте политику защиты информации (метки чувствительности, типы информации, логику обнаружения) в политике [защиты информации](../security-center/security-center-info-protection-policy.md) в Центре безопасности Azure. 

### <a name="track-access-to-sensitive-data"></a>Отслеживание доступа к конфиденциальным данным 
Мониторинг доступа к конфиденциальным данным и сбора запросов на конфиденциальные данные в журналах аудита.

**Как реализовать:**

- Используйте аудит и классификацию данных в комбинации. 
  - В журнале [аудита базы данных S'L](sql-database-auditing.md) можно отслеживать доступ конкретно к конфиденциальным данным. Вы также можете просматривать информацию, такую как данные, которые были доступны, а также ее метку чувствительности. Для получения дополнительной [информации см.](sql-database-data-discovery-and-classification.md#subheading-3) 

**Лучшие практики**:

- Ознакомьтесь с рекомендациями в разделах аудита и классификации данных: 
  - [Аудит критических событий безопасности](#audit-critical-security-events) 
  - [Определение и метка конфиденциальных данных](#identify-and-tag-sensitive-data) 

### <a name="visualize-security-and-compliance-status"></a>Визуализация состояния безопасности и соответствия требованиям 

Используйте единую систему управления безопасностью инфраструктуры, которая укрепляет безопасность центров обработки данных (в том числе баз данных S'L). Просмотр списка рекомендаций, касающихся безопасности баз данных и состояния соответствия требованиям.

**Как реализовать:**

- Мониторинг рекомендаций по безопасности, связанных с S'L, и активных угроз в [Центре безопасности Azure.](https://azure.microsoft.com/documentation/services/security-center/)

## <a name="common-security-threats-and-potential-mitigations"></a>Общие угрозы безопасности и потенциальные меры по смягчению последствий

Этот раздел поможет вам найти меры безопасности для защиты от определенных векторов атак. Ожидается, что большинство мер по смягчению последствий может быть достигнуто путем выполнения одного или нескольких руководящих принципов безопасности выше.

### <a name="security-threat-data-exfiltration"></a>Угроза безопасности: эксфильтрация данных

Эксфильтрация данных — это несанкционированное копирование, передача или извлечение данных с компьютера или сервера. Смотрите определение [эксфильтрации данных](https://en.wikipedia.org/wiki/Data_exfiltration) в Википедии.

Подключение к серверу базы данных Azure S'L через общедоступную конечную точку создает риск эксфильтрации данных, поскольку требует от клиентов открывать свои брандмауэры для общедоступных IP-карт.  

**Сценарий 1**: Приложение на Azure VM подключается к базе данных на сервере базы данных Azure S'L. Изгоев актер получает доступ к ВМ и компрометирует его. В этом сценарии эксфильтрация данных означает, что внешняя сущность, использующая изгоев VM, подключается к базе данных, копирует персональные данные и хранит их в хранилище каблики или другой базе данных S'L в другой подписке.

**Сценарий 2**: Руж DBA. Этот сценарий часто возникает чувствительными к безопасности клиентами из регулируемых отраслей. В этом случае пользователь с высокой привилегией может копировать данные из базы данных Azure S'L в другую подписку, не контролируемую владельцем данных.

**Потенциальные меры по смягчению последствий:**

На сегодняшний день база данных Azure S'L предлагает следующие методы смягчения угроз эксфильтрации данных: 

- Используйте комбинацию правил Разрешить и отрицание на Нски VMs Azure, чтобы контролировать, к каким регионам можно получить доступ из VM. 
- При использовании сервера базы данных Azure S'L Database (содержащего однотонные базы данных или эластичные пулы) установите следующие параметры:
  - Разрешить службы Azure ДЛЯ OFF.
  - Разрешайте трафик из подсети, содержащей ваш Azure VM, устанавливая правило VNet Firewall.
  - Использование [частной ссылки](sql-database-private-endpoint-overview.md)
- Для управляемого экземпляра использование частного IP-доступа по умолчанию рассматривает первую проблему эксфильтрации данных изгоев VM. Включите функцию делегирования подсети в подсети, чтобы автоматически настроить наиболее ограничительную политику в подсети управляемого экземпляра.
- Концерн Rogue DBA более подвержен управляемому экземпляру, так как он имеет большую площадь поверхности, и требования к сети видны клиентам. Наилучшим смягчением для этого является применение всех методов в этом руководстве по безопасности для предотвращения сценария Rogue DBA в первую очередь (не только для эксфильтрации данных). Всегда зашифрованный является одним из методов защиты конфиденциальных данных путем шифрования и сохранения ключа недоступным для dBA.

## <a name="security-aspects-of-business-continuity-and-availability"></a>Аспекты безопасности непрерывности и доступности бизнеса

Большинство стандартов безопасности учитывают доступность данных с точки зрения непрерывности работы, достигаемый за счет внедрения избыточных и неудачных возможностей, чтобы избежать отдельных точек сбоя. Для сценариев стихийных бедствий обычно сохраняется резервное копирование файлов Data и Log.Следующий раздел содержит обзор возможностей высокого уровня, встроенных в Azure. Он также предоставляет дополнительные опции, которые могут быть настроены для удовлетворения конкретных потребностей: 

- Azure предлагает встроенную базу данных с высокой доступностью: [высокодоступность и базу данных Azure S'L](sql-database-high-availability.md) 

- Бизнес-критический уровень включает в себя группы сбоев, зоны с несколькими доступностьми, полные и дифференциальные резервные копии журнала, а также резервные копии, включенные по умолчанию:  
  - [Высокодоступность и база данных Azure S'L - Избыточную конфигурацию зоны](sql-database-high-availability.md#zone-redundant-configuration)
  - [Автоматизированное резервное копирование](sql-database-automated-backups.md)
  - [Восстановление базы данных Azure S'L с помощью автоматизированного резервного копирования базы данных - восстановление point-in-time](sql-database-recovery-using-backups.md#point-in-time-restore)

- Дополнительные функции непрерывности бизнеса, такие как группы автоматического отказа в различных геомоты Azure, могут быть настроены в описанном здесь: [Обзор непрерывности бизнеса с базой данных Azure S'L](sql-database-business-continuity.md)

## <a name="next-steps"></a>Дальнейшие действия

- [См. обзор возможностей безопасности базы данных Azure S'L](sql-database-security-overview.md)
