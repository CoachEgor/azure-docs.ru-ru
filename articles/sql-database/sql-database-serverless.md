---
title: База данных SQL Azure — бессерверные вычисления (предварительная версия) | Документация Майкрософт
description: В этой статье описан новый уровень бессерверных вычислений, который сравнивается с существующим уровнем подготовленных вычислений
services: sql-database
ms.service: sql-database
ms.subservice: service
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: oslake
ms.author: moslake
ms.reviewer: sstein, carlrab
manager: craigg
ms.date: 05/11/2019
ms.openlocfilehash: ba79e2b9552f0c27ac11501b2b125a126e40eb1d
ms.sourcegitcommit: f013c433b18de2788bf09b98926c7136b15d36f1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/13/2019
ms.locfileid: "65551625"
---
# <a name="sql-database-serverless-preview"></a>База данных SQL Azure — бессерверные вычисления (предварительная версия)

## <a name="what-is-the-serverless-compute-tier"></a>Общие сведения об уровне бессерверных вычислений

Бессерверные вычисления Базы данных SQL (предварительная версия) — это уровень вычислений с платой за объем вычислительных ресурсов, используемых отдельной базой данных в секунду. Бессерверные вычисления — это рентабельное и оптимизированное для высокой производительности решение для отдельных баз данных с нестабильным и непредсказуемым использованием, для которых допустима некоторая задержка при подготовке вычислительных ресурсов после периодов простоя.

Базы данных уровня бессерверных вычислений параметризованы с учетом диапазона используемых вычислений и задержки автоматической приостановки.

![Выставление счетов за бессерверные вычисления](./media/sql-database-serverless/serverless-billing.png)

### <a name="performance"></a>Производительность

- `MinVcore` и `MaxVcore` — это настраиваемые параметры, которые определяют диапазон доступных вычислений для базы данных. Ограничения памяти и операций ввода-вывода пропорциональны указанному диапазону виртуальных ядер.  
- Задержка автоматической приостановки — это настраиваемый параметр, который определяет период времени, в течение которого база данных будет неактивна, прежде чем она будет автоматически приостановлена. Работа базы данных возобновится автоматически при следующем входе.

### <a name="pricing"></a>Цены

- Общая сумма в счете за бессерверную базу данных включает плату за вычисления и хранение.
Выставление счетов за вычислительные ресурсы зависит от количества используемых виртуальных ядер и объема памяти, используемой в секунду.
- Минимальная плата учитывает минимальное количество используемых виртуальных ядер и минимальный объем используемой памяти.
- Во время приостановки базы данных оплачивается только хранилище.

## <a name="scenarios"></a>Сценарии

Бессерверные вычисления — это рентабельное и оптимизированное для высокой производительности решение для отдельных баз данных с нестабильным и непредсказуемым использованием, для которых допустима некоторая задержка при подготовке вычислительных ресурсов после периодов простоя. В отличие от них, уровень подготовленных вычислений — это рентабельное и оптимизированное для высокой производительности решение для отдельных баз данных или баз данных в составе пула с большей средней загрузкой, для которых задержка при подготовке вычислительных ресурсов недопустима.

### <a name="scenarios-well-suited-for-serverless-compute"></a>Сценарии использования бессерверных вычислений

- Отдельные базы данных с нестабильным и непредсказуемым использованием с периодами бездействия, для которых более экономным вариантом будет выставление счетов за использование вычислительных ресурсов в секунду.
- Отдельные базы данных с высокими требованиями к ресурсам, которые сложно предсказать, и клиенты, которые хотят делегировать масштабирование вычислительных ресурсов службе.
- Отдельные базы данных на уровне подготовленных вычислений, уровни производительности которых часто меняются.

### <a name="scenarios-well-suited-for-provisioned-compute"></a>Сценарии использования подготовленных вычислений

- Отдельные базы данных с более равномерным и значительным использованием вычислительных ресурсов в течение длительного периода времени.
- Базы данных, для которых недопустимо снижение производительности за счет частого ограничения ресурсов памяти или задержек автоматического возобновления работы из приостановленного состояния.
- Нескольких баз данных с непостоянным и непрогнозируемым использованием, которые можно объединить на одном сервере в эластичный пул для оптимизации затрат.

## <a name="comparison-with-provisioned-compute-tier"></a>Сравнение с уровнем подготовленных вычислений

В следующей таблице перечислены различия между уровнями бессерверных вычислений и подготовленных вычислений:

| | **Бессерверные вычисления** | **Подготовленные вычисления** |
|:---|:---|:---|
|**Обычный сценарий использования**| Базы данных с непостоянным и непрогнозируемым использованием, перемежающимся периодами бездействия. | Базы данных или эластичные пулы с более стабильным использованием.|
| **Затраты на управление производительностью** |Низкие|Высокие|
|**Масштабирование вычислительных ресурсов**|Автоматический|Руководство|
|**Скорость включения вычислительных ресурсов**|Низкая после периодов бездействия|Немедленно|
|**Тарификация**|Посекундная|Почасовая|

## <a name="purchasing-model-and-service-tier"></a>Модель приобретения и уровень служб

Бессерверная База данных SQL сейчас поддерживается только на уровне общего назначения платформы 5-го поколения в рамках модели приобретения виртуальных ядер.

## <a name="autoscaling"></a>Автомасштабирование

### <a name="scaling-responsiveness"></a>Скорость масштабирования

Как правило, базы данных выполняются на компьютере с емкостью, которая удовлетворяет требованиям к ресурсам без прерывания для любого объема запросов на вычисления в пределах, определенных значением `maxVcores`. В некоторых случаях автоматически выполняется балансировка нагрузки, если компьютер не может удовлетворить потребность в ресурсах в течение нескольких минут. База данных остается доступной по сети во время балансировки нагрузки, кроме непродолжительного периода в конце операции, когда подключение прерывается.

### <a name="memory-management"></a>Управление памятью

Память для бессерверных баз данных освобождается чаще, чем для подготовленных баз данных. Это важно для контроля над затратами при бессерверных вычислениях. В отличие от подготовленных вычислений память из кэша SQL освобождается при использовании бессерверной базы данных при низком уровне использования ЦП и кэша.

## <a name="autopause-and-autoresume"></a>Автоматические приостановка и возобновление работы

### <a name="autopause"></a>Автоматическая приостановка работы

Автоматическая приостановка выполняется, если соблюдены все следующие условия:

- количество сеансов — 0;
- ресурсы ЦП — 0 (для пользовательской рабочей нагрузки, выполняемой в пуле пользователя).

При необходимости автоматическую приостановку можно отключить.

### <a name="autoresume"></a>Автоматическое возобновление работы

Автоматическое возобновление выполняется, если соблюдено любое из следующих условий (в любое время):

|Функция|Триггер автоматического возобновления|
|---|---|
|Аутентификация и авторизация|Вход|
|Обнаружение угроз|Включение и отключение параметров обнаружения угроз на уровне базы данных или сервера.<br>Изменение параметров обнаружения угроз на уровне базы данных или сервера.|
|Обнаружение и классификация данных|Добавление, изменение, удаление или просмотр меток конфиденциальности.|
|Аудит|Просмотр записей аудита.<br>Обновление или просмотр политик аудита.|
|Маскирование данных|Добавление, изменение, удаление или просмотр правил маскирования данных.|
|Прозрачное шифрование данных|Просмотр состояния прозрачного шифрования данных.|
|Запросы к хранилищу данных (производительность)|Изменение или просмотр параметров хранилища запросов; автоматическая настройка.|
|Автоматическая настройка|Применение и проверка рекомендаций по автоматической настройке, включая автоматическое индексирование.|
|Копирование базы данных|Создание базы данных как копии.<br>Экспорт в BACPAC-файл.|
|Синхронизация данных SQL|Синхронизация между центральной и рядовыми базами данных, которая запускается по настраиваемому расписанию или вручную.|
|Изменение некоторых метаданных базы данных|Добавление новых тегов базы данных.<br>Изменение максимального и минимального количества виртуальных ядер, настройка задержки автоматической приостановки работы.|
|SQL Server Management Studio (SSMS);|Открыв с помощью SSMS версии 18 новое окно запроса для любой базы данных на сервере, вы возобновите работу любой автоматически приостановленной базы данных на том же сервере. При использовании SSMS версии 17.9.1 с отключенной функцией IntelliSense такое поведение недоступно.|

### <a name="connectivity"></a>Соединение

Если бессерверная база данных приостановлена, при первом входе ее работа будет возобновлена. При этом отобразится сообщение с кодом ошибки 40613 о том, что база данных недоступна. Когда работа базы данных будет возобновлена, нужно повторно выполнить вход, чтобы установить подключение. Клиенты базы данных, для которых поддерживается логика повторных попыток подключения, не нужно изменять.

### <a name="latency"></a>Latency

Задержка автоматических приостановки или возобновления работы бессерверных баз данных обычно составляет около 1 минуты.

### <a name="feature-support"></a>Поддержка компонентов и функций

Следующие компоненты и функции не поддерживают автоматические приостановку и возобновление работы. То есть, при использовании любых из перечисленных компонентов и функций база данных будет оставаться подключенной независимо от периода ее бездействия:

- георепликация (активная георепликация и группы автоматической отработки отказа);
- долгосрочное хранение резервных копий (LTR);
- база данных синхронизации, используемая при синхронизации данных SQL.


## <a name="on-boarding-into-the-serverless-compute-tier"></a>Подключение к уровню бессерверных вычислений

Создание новой базы данных или перемещение существующей базы данных на уровень бессерверных вычислений выполняется аналогично созданию новой базы данных на уровне подготовленных вычислений. Этот процесс включает два этапа:

1. Определение описательного имени службы. Описательное имя определяет уровень службы, поколение оборудования и максимальное количество виртуальных ядер. В таблице ниже приведены возможные варианты.

   |Описательное имя службы|Уровень служб|Поколение оборудования|Максимальное количество виртуальных ядер|
   |---|---|---|---|
   |GP_S_Gen5_1|Общего назначения|5-го поколения|1|
   |GP_S_Gen5_2|Общего назначения|5-го поколения|2|
   |GP_S_Gen5_4|Общего назначения|5-го поколения|4.|

2. При необходимости укажите минимальное количество виртуальных ядер и задержку автоматической приостановки, чтобы изменить значения по умолчанию. В таблице ниже показаны доступные значения для этих параметров.

   |Параметр|Варианты значений|Значение по умолчанию|
   |---|---|---|---|
   |Минимальное количество виртуальных ядер|Любое из значений {0,5, 1, 2, 4}, которое не превышает максимальное количество виртуальных ядер|0,5 виртуального ядра|
   |Задержка автоматической приостановки работы|Минимум: 360 минут (6 часов)<br>Максимум: 10 080 минут (7 дней)<br>Шаг приращения 60 минут<br>Отключение автоматической приостановки: -1|360 минут|

> [!NOTE]
> Сейчас нельзя использовать T-SQL для перемещения существующей базы данных на уровень бессерверных вычислений или изменения объема вычислительных ресурсов. Но это можно сделать с помощью портала Azure или PowerShell.

### <a name="create-new-database-using-the-azure-portal"></a>Создание новой базы данных с помощью портала Azure

См. [Краткое руководство. Создание отдельной базы данных в Базе данных SQL с помощью портала Azure](sql-database-single-database-get-started.md).

### <a name="create-new-database-using-powershell"></a>Создание новой базы данных с помощью PowerShell

В следующем примере создается новая база данных на уровне бессерверных вычислений с описательным именем GP_S_Gen5_4 и со значениями по умолчанию для минимального количества виртуальных ядер и задержки автоматической приостановки.

Для создания такой базы данных требуется одна из последних версий PowerShell. Ее сейчас нет в коллекции, поэтому выполните `Update-Module Az.Sql`, чтобы получить последнюю версию командлетов с поддержкой бессерверных решений.

```powershell
New-AzSqlDatabase `
  -ResourceGroupName $resourceGroupName `
  -ServerName $serverName `
  -DatabaseName $databaseName `
  -ComputeModel Serverless `
  -Edition GeneralPurpose `
  -ComputeGeneration Gen5 `
  -MinVcore 0.5 `
  -MaxVcore 2 `
  -AutoPauseDelay 720
```

### <a name="move-existing-database-into-the-serverless-compute-tier"></a>Перемещение существующей базы данных на уровень бессерверных вычислений

В следующем примере существующая база данных перемещается с уровня подготовленных вычислений на уровень бессерверных вычислений. В этом примере явно указываются такие параметры, как минимальное и максимальное количество виртуальных ядер и задержка автоматический приостановки.

```powershell
Set-AzSqlDatabase
  -ResourceGroupName $resourceGroupName `
  -ServerName $serverName `
  -DatabaseName $databaseName `
  -Edition GeneralPurpose `
  -ComputeModel Serverless `
  -ComputeGeneration Gen5 `
  -MinVcore 1 `
  -MaxVcore 4 `
  -AutoPauseDelay 1440
```

### <a name="move-a-database-out-of-the-serverless-compute-tier"></a>Перемещение существующей базы данных с уровня бессерверных вычислений

Перемещение бессерверной базы данных на уровень подготовленных вычислений выполняется так же, как и перемещение подготовленной базы данных на уровень бессерверных вычислений.

## <a name="modify-serverless-configuration-parameters"></a>Изменение параметров для бессерверных вычислений

### <a name="maximum-vcores"></a>Максимальное количество виртуальных ядер

Изменение максимального количества виртуальных ядер выполняется с помощью команды [Set-AzSqlDatabase](https://docs.microsoft.com/powershell/module/az.sql/set-azsqldatabase) в PowerShell с использованием аргумента `MaxVcore`.

### <a name="minimum-vcores"></a>Минимальное количество виртуальных ядер

Изменение минимального количества виртуальных ядер выполняется с помощью команды [Set-AzSqlDatabase](https://docs.microsoft.com/powershell/module/az.sql/set-azsqldatabase) в PowerShell с использованием аргумента `MinVcore`.

### <a name="autopause-delay"></a>Задержка автоматической приостановки работы

Изменение задержки автоматической приостановки выполняется с помощью команды [Set-AzSqlDatabase](https://docs.microsoft.com/powershell/module/az.sql/set-azsqldatabase) в PowerShell с использованием аргумента `AutoPauseDelay`.

## <a name="monitor-serverless-database"></a>Мониторинг бессерверной базы данных

### <a name="resources-used-and-billed"></a>Используемые и тарифицируемые ресурсы

Ресурсы бессерверных баз данных инкапсулируются в следующие сущности:

#### <a name="app-package"></a>Пакет приложения

Пакет приложения представляет внешнюю границу управления для большинства ресурсов базы данных, независимо от того, на каком уровне находится база данных (бессерверные или подготовленные вычисления). Пакет приложения содержит экземпляр SQL и внешние службы, которые вместе определяют область применения всех пользовательских и системных ресурсов, используемых базой данных в Базе данных SQL. Внешние службы включают компоненты R и функцию полнотекстового поиска. Экземпляр SQL обычно управляет общим использованием ресурсов в пакете приложения.

#### <a name="user-resource-pool"></a>Пул пользовательских ресурсов

Пул пользовательских ресурсов представляет внутреннюю границу управления для большинства ресурсов базы данных, независимо от того, на каком уровне находится база данных (бессерверные или подготовленные вычисления). Пул пользовательских ресурсов определяет область применения ресурсов ЦП и операций ввода-вывода для пользовательских нагрузок, создаваемых запросами DDL (например CREATE, ALTER и др.) и DML (например SELECT, INSERT, UPDATE, DELETE, и др.). Эти запросы обычно представляют самые распространенные операции, потребляющие ресурсы в пакете приложения.

### <a name="metrics"></a>Метрики

|Сущность|Метрика|ОПИСАНИЕ|Units|
|---|---|---|---|
|Пакет приложения|app_cpu_percent|Количество виртуальных ядер, используемых в приложении относительно максимального количества виртуальных ядер, которое можно использовать в приложении.|Процент|
|Пакет приложения|app_cpu_billed|Объем вычислительных ресурсов, тарифицируемых для приложения в отчетный период. Сумма, которая насчитывается за этот период, является произведением этого показателя и стоимости виртуального ядра. <br><br>Значение этого показателя вычисляется с учетом потребления максимального количества ресурсов ЦП и памяти в каждую секунду. Если используемые количество виртуальных ядер и объем ресурсов памяти меньше, чем минимальный подготовленный объем, плата взимается за подготовленные ресурсы. Чтобы сравнить, как взимается плата за ресурсы ЦП и памяти, представьте, что объем памяти нормализуется с учетом виртуальных ядер путем преобразования объема памяти в ГБ в количество виртуальных ядер по 3 ГБ.|Время использования виртуальных ядер в секундах|
|Пакет приложения|app_memory_percent|Объем памяти, используемый в приложении, относительно максимального объема памяти, который можно использовать в приложении.|Процент|
|Пользовательский пул|cpu_percent|Количество виртуальных ядер, используемых пользовательской рабочей нагрузкой, относительно максимального количества виртуальных ядер, которое можно использовать в пользовательской рабочей нагрузке.|Процент|
|Пользовательский пул|data_IO_percent|Количество операций ввода-вывода, используемых пользовательской рабочей нагрузкой, относительно максимального количества операций ввода-вывода, которое можно использовать в пользовательской рабочей нагрузке.|Процент|
|Пользовательский пул|log_IO_percent|Количество записанных в журнал МБ/с, используемых пользовательской рабочей нагрузкой, относительно максимального количества записанных в журнал МБ/с, которое можно использовать в пользовательской рабочей нагрузке.|Процент|
|Пользовательский пул|workers_percent|Количество рабочих ролей, используемых пользовательской рабочей нагрузкой, относительно максимального количества рабочих ролей, которое можно использовать в пользовательской рабочей нагрузке.|Процент|
|Пользовательский пул|sessions_percent|Количество сеансов, используемых пользовательской рабочей нагрузкой, относительно максимального количества сеансов, которое можно использовать в пользовательской рабочей нагрузке.|Процент|
____

> [!NOTE]
> Метрики на портале Azure доступны в области базы данных для отдельной базы данных в разделе **Мониторинг**.

### <a name="pause-and-resume-status"></a>Состояние приостановки и возобновления работы

На портале Azure состояние базы данных отображается в разделе "Обзор" для сервера, содержащего список баз данных. Состояние базы данных также отображается в разделе "Обзор" для базы данных.

Просмотреть состояние приостановки и возобновления работы базы данных можно с помощью следующей команды PowerShell:

```powershell
Get-AzSqlDatabase `
  -ResourceGroupName $resourcegroupname `
  -ServerName $servername `
  -DatabaseName $databasename `
  | Select -ExpandProperty "Status"
```

## <a name="resource-limits"></a>Ограничения ресурсов

См. подробнее об [ограничениях ресурсов уровня бессерверных вычислений](sql-database-vCore-resource-limits-single-databases.md#serverless-compute-tier).

## <a name="billing"></a>Выставление счетов

Объем оплачиваемых вычислительных ресурсов зависит от максимального объема ресурсов ЦП и памяти, используемых каждую секунду. Если используемый объем ЦП и памяти меньше, чем минимальный подготовленный объем, плата взимается за подготовленные ресурсы. Чтобы сравнить, как взимается плата за ресурсы ЦП и памяти, представьте, что объем памяти нормализуется с учетом виртуальных ядер путем преобразования объема памяти в ГБ в количество виртуальных ядер по 3 ГБ.

- **Выставление счетов за ресурсы**: ЦП и память
- **Тарифицируемый объем ($)**: цена за виртуальное ядро * максимальный объем ресурсов (минимальное количество виртуальных ядер, используемое количество виртуальных ядер, минимальный объем памяти в ГБ * 1/3, используемый объем памяти в ГБ * 1/3). 
- **Периодичность выставления счетов**: посекундно.

Плата за виртуальное ядро в плате за каждое виртуальное ядро в секунду. См. подробнее на [странице с ценами на Базу данных SQL Azure](https://azure.microsoft.com/pricing/details/sql-database/single/), где приведены цены за потребленные единицы ресурсов в заданном регионе.

Объем тарифицируемых вычислительных ресурсов определяется следующим показателем:

- **Показатель**: app_cpu_billed (виртуальное ядро в секунду).
- **Определение**: максимальный объем ресурсов (минимальное количество виртуальных ядер, используемое количество виртуальных ядер, минимальный объем памяти в ГБ * 1/3, используемый объем памяти в ГБ * 1/3).
- **Частота обращения**: поминутно.

Это количество вычисляется каждую секунду и суммируется за 1 минуту.

**Пример**: Рассмотрим базу данных GP_S_Gen5_4 со следующими характеристиками использования за 1 час:

|Время (часы:минуты)|app_cpu_billed (виртуальное ядро в секунду)|
|---|---|
|0:01|63|
|0:02|123|
|0:03|95|
|0:04|54|
|0:05|41|
|0:06 –1:00|1255|
||Всего: 1631|

Предположим, что цена за единицу вычислений составляет 0,000073 долл. США/виртуальное ядро/секунда. Таким образом, плата за вычислительные ресурсы, потребленные за этот час, определяется по следующей формуле: **0,000073 долл. США/виртуальное ядро/секунда * 1631 секунд использования виртуального ядра = 0,1191 долл. США**.

## <a name="available-regions"></a>Доступные регионы

Уровень бессерверных вычислений доступен во всех регионах, кроме следующих: Центральная Австралия, Восточный Китай, Северный Китай, Южная Франция, Центральная Германия,Северо-Восточная Германия, Западная Индия, Республика Корея (южный регион), Западная часть ЮАР, северная часть Соединенного Королевства, южная часть Соединенного Королевства, западная часть Соединенного Королевства, центрально-западная часть США.

## <a name="next-steps"></a>Дополнительная информация

- Чтобы начать работу, см. [краткое руководство по созданию отдельной базы данных в Базе данных SQL с помощью портала Azure](sql-database-single-database-get-started.md).
- См. подробнее об [ограничениях ресурсов уровня бессерверных вычислений](sql-database-vCore-resource-limits-single-databases.md#serverless-compute-tier).