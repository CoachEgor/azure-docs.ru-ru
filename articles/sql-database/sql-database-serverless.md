---
title: База данных SQL Azure — бессерверные вычисления (предварительная версия) | Документация Майкрософт
description: В этой статье описан новый уровень бессерверных вычислений, который сравнивается с существующим уровнем подготовленных вычислений
services: sql-database
ms.service: sql-database
ms.subservice: service
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: oslake
ms.author: moslake
ms.reviewer: sstein, carlrab
manager: craigg
ms.date: 06/05/2019
ms.openlocfilehash: b39d2c839444e3cad60d5ff08e117282ecc04d7a
ms.sourcegitcommit: 4cdd4b65ddbd3261967cdcd6bc4adf46b4b49b01
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/06/2019
ms.locfileid: "66734778"
---
# <a name="sql-database-serverless-preview"></a>База данных SQL Azure — бессерверные вычисления (предварительная версия)

## <a name="serverless-compute-tier"></a>Уровень бессерверных вычислений

База данных SQL без сервера (Предварительная версия) — это уровень вычислений отдельной базы данных, что автоматически масштабируется, вычисления и выставляет счета объема вычислений, используемый в секунду. 

Базы данных уровня бессерверных вычислений параметризованы с учетом диапазона используемых вычислений и задержки автоматической приостановки.

![Выставление счетов за бессерверные вычисления](./media/sql-database-serverless/serverless-billing.png)

### <a name="performance"></a>Производительность

- Количество виртуальных ядер минимальное и максимальное количество виртуальных ядер, настраиваемые параметры, которые определяют область доступной емкости вычислений для базы данных. Ограничения памяти и операций ввода-вывода пропорциональны указанному диапазону виртуальных ядер.  
- Задержка автоматической приостановки — это настраиваемый параметр, который определяет период времени, в течение которого база данных будет неактивна, прежде чем она будет автоматически приостановлена. Работа базы данных возобновится автоматически при следующем входе.

### <a name="pricing"></a>Цены

- Общая сумма в счете за бессерверную базу данных включает плату за вычисления и хранение.
Выставление счетов за вычислительные ресурсы зависит от количества используемых виртуальных ядер и объема памяти, используемой в секунду.
- Минимальная плата учитывает минимальное количество используемых виртуальных ядер и минимальный объем используемой памяти.
- Во время приостановки базы данных оплачивается только хранилище.

## <a name="scenarios"></a>Сценарии

Бессерверные вычисления — это рентабельное и оптимизированное для высокой производительности решение для отдельных баз данных с нестабильным и непредсказуемым использованием, для которых допустима некоторая задержка при подготовке вычислительных ресурсов после периодов простоя. Напротив подготовленных вычислительных ресурсов уровня — цены и производительности, оптимизированный для отдельных баз данных или нескольких баз данных в эластичных пулах с высоким среднее время использования, не должны отключаться задержек в период прогрева вычислений.

### <a name="scenarios-well-suited-for-serverless-compute"></a>Сценарии использования бессерверных вычислений

- Отдельные базы данных с нестабильным, непредсказуемыми закономерностей смешивается с периоды бездействия и низкой загрузки среднее вычислений со временем.
- Отдельные базы данных на уровне подготовленных вычислительных ресурсов, который часто являются повторно нормализованы и клиенты, которые хотите делегировать вычислений, масштабирование, чтобы служба.
- Новый отдельных баз данных без использования журнала, где изменения размера вычислительных трудно или невозможно для оценки перед их развертыванием в базе данных SQL.

### <a name="scenarios-well-suited-for-provisioned-compute"></a>Сценарии использования подготовленных вычислений

- Использование со временем вычислительных отдельные базы данных с нескольких обычных и прогнозируемую закономерностей и выше среднего.
- Базы данных, для которых недопустимо снижение производительности за счет частого ограничения ресурсов памяти или задержек автоматического возобновления работы из приостановленного состояния.
- Несколько баз данных с нестабильным, непредсказуемыми закономерностей, которые могут быть объединены в пулы эластичных БД для более качественной оптимизации цены и производительности.

## <a name="comparison-with-provisioned-compute-tier"></a>Сравнение с уровнем подготовленных вычислений

В следующей таблице перечислены различия между уровнями бессерверных вычислений и подготовленных вычислений:

| | **Бессерверные вычисления** | **Подготовленные вычисления** |
|:---|:---|:---|
|**Шаблона использования базы данных**| Использование временные, непредсказуемыми с низкой загрузки среднее вычислений со временем. |  Использование по времени или несколько баз данных, использующих эластичные пулы вычислительных несколько обычных шаблонов использования с более поздней версии среднее значение.|
| **Затраты на управление производительностью** |Низкие|Высокие|
|**Масштабирование вычислительных ресурсов**|Автоматический|Руководство|
|**Скорость включения вычислительных ресурсов**|Низкая после периодов бездействия|Немедленно|
|**Тарификация**|Посекундная|Почасовая|

## <a name="purchasing-model-and-service-tier"></a>Модель приобретения и уровень служб

Бессерверная База данных SQL сейчас поддерживается только на уровне общего назначения платформы 5-го поколения в рамках модели приобретения виртуальных ядер.

## <a name="autoscale"></a>Автомасштабирование

### <a name="scaling-responsiveness"></a>Скорость масштабирования

В общем случае бессерверных баз данных выполняются на компьютере с емкостью, достаточной для удовлетворения требований к ресурсам без прерывания для любого объема вычислений, запрошенный в пределах, определяется значением максимальное количество виртуальных ядер. В некоторых случаях автоматически выполняется балансировка нагрузки, если компьютер не может удовлетворить потребность в ресурсах в течение нескольких минут. Например если требований к ресурсам — 4 виртуальных ядра, но доступны только 2 виртуальных ядра, затем он может занять несколько минут для балансировки нагрузки, прежде чем предоставляются 4 виртуальных ядра. База данных остается доступной по сети во время балансировки нагрузки, кроме непродолжительного периода в конце операции, когда подключение прерывается.

### <a name="memory-management"></a>Управление памятью

Происходит освобождение памяти для бессерверных баз данных чаще, чем для баз данных, подготовленных вычислительных ресурсов. Это важно для контроля затрат в бессерверной и может повлиять на производительность.

#### <a name="cache-reclamation"></a>Освобождение кэша

В отличие от подготовленных вычислительных ресурсов базы данных, из кэша SQL происходит освобождение памяти из базы данных без сервера при низком уровне использования ЦП и кэша.

- Использование кэша считается низкая, если общий размер наиболее недавно использованные кэша записи опускается ниже порогового значения в течение заданного времени.
- При активации освобождение кэша, целевой размер кэша постепенно уменьшается до небольшую часть первоначальный размер и только освобождение продолжается, если использование остается низким.
- Когда происходит освобождение кэша, политика для выбора записей кэша, чтобы исключить находится ту же политику выбора, как и для баз данных подготовленных вычислительных ресурсов при высокой нехватки памяти.
- Размер кэша никогда не уменьшается ниже заданного предела памяти min согласно минимальное количество виртуальных ядер, который можно настроить.

В бессерверной и подготовленных вычислительных баз данных, кэша, которые могут быть удалены записи, если использовать всю доступную память.

#### <a name="cache-hydration"></a>Расконсервации кэша

Кэш-памяти SQL по мере данные извлекаются с диска в так же, как и с той же скоростью, что и для подготовленных баз данных. Если база данных занята, кэш может расти без ограничений, ограничение: максимальный объем памяти.

## <a name="autopause-and-autoresume"></a>Автоматические приостановка и возобновление работы

### <a name="autopause"></a>Автоматическая приостановка работы

Autopausing срабатывает в том случае, если все следующие условия верны для длительность задержки autopause:

- количество сеансов — 0;
- ЦП = 0 для пользователя рабочую нагрузку, выполняемую в пуле пользователя

Чтобы отключить autopausing, при необходимости, предусмотрен специальный параметр.

Следующие функции не поддерживают autopausing.  То есть если используются любые из следующих компонентов, затем в оперативном независимо от простоя базы данных:

- Георепликация (активной георепликации и автоматической отработки отказа группы).
- Долгосрочное хранение резервных копий (LTR).
- база данных синхронизации, используемая при синхронизации данных SQL.

Autopausing временно блокируется во время развертывания некоторые обновления службы, которые требуют, базы данных находились в сети.  В таких случаях autopausing становится может снова после завершения обновления.

### <a name="autoresume"></a>Автоматическое возобновление работы

Autoresuming активируется в том случае, если выполняется любое из следующих условий в любое время:

|Компонент|Триггер автоматического возобновления|
|---|---|
|Аутентификация и авторизация|Вход|
|Обнаружение угроз|Включение и отключение настройки обнаружения угроз на уровне базы данных или сервера.<br>Изменение настройки обнаружения угроз на уровне базы данных или сервера.|
|Обнаружение и классификация данных|Добавление, изменение, удаление или просмотр меток конфиденциальности.|
|Аудит|Просмотр записей аудита.<br>Обновление или Просмотр политики аудита.|
|Маскирование данных|Добавление, изменение, удаление или просмотр правил маскирования данных.|
|Прозрачное шифрование данных|Просмотр состояния прозрачного шифрования данных.|
|Запросы к хранилищу данных (производительность)|Изменение или просмотр параметров хранилища запросов; автоматическая настройка.|
|Автоматическая настройка|Применение и проверка рекомендаций по автоматической настройке, включая автоматическое индексирование.|
|Копирование базы данных|Создание базы данных в качестве копии.<br>Экспорт в bacpac-файл.|
|Синхронизация данных SQL|Синхронизация между центральной и рядовыми базами данных, которая запускается по настраиваемому расписанию или вручную.|
|Изменение некоторых метаданных базы данных|Добавление новых тегов базы данных.<br>Изменение максимальное количество виртуальных ядер, минимальное количество виртуальных ядер или autopause задержки.|
|SQL Server Management Studio (SSMS)|Открыв с помощью SSMS версии 18 новое окно запроса для любой базы данных на сервере, вы возобновите работу любой автоматически приостановленной базы данных на том же сервере. При использовании SSMS версии 17.9.1 с отключенной функцией IntelliSense такое поведение недоступно.|

Autoresuming также активируется во время развертывания некоторые обновления службы, которые требуют, базы данных находились в сети.

### <a name="connectivity"></a>Соединение

Если приостанавливается база данных без сервера, первый вход в систему возобновите базу данных и возвращать сообщение о том, что база данных недоступна с кодом ошибки 40613. Когда работа базы данных будет возобновлена, нужно повторно выполнить вход, чтобы установить подключение. Клиенты базы данных, для которых поддерживается логика повторных попыток подключения, не нужно изменять.

### <a name="latency"></a>Задержка

Задержка autoresume и autopause данных бессерверных баз данных обычно является порядок 1 минуту, чтобы autoresume и 1 – 10 минут, чтобы autopause.

## <a name="onboarding-into-serverless-compute-tier"></a>Подключение на уровень бессерверных вычислений

Создание новой базы данных или перемещение существующей базы данных на уровень бессерверных вычислений выполняется аналогично созданию новой базы данных на уровне подготовленных вычислений. Этот процесс включает два этапа:

1. Определение описательного имени службы. Цель обслуживания предписывает уровень служб, поколение оборудования и максимальное количество виртуальных ядер. В таблице ниже приведены возможные варианты.

   |Описательное имя службы|Уровень служб|Поколение оборудования|Максимальное количество виртуальных ядер|
   |---|---|---|---|
   |GP_S_Gen5_1|Общего назначения|5-го поколения|1|
   |GP_S_Gen5_2|Общего назначения|5-го поколения|2|
   |GP_S_Gen5_4|Общего назначения|5-го поколения|4.|

2. При необходимости укажите задержку виртуальных ядер и autopause мин. Чтобы изменить значения по умолчанию. В таблице ниже показаны доступные значения для этих параметров.

   |Параметр|Варианты значений|Значение по умолчанию|
   |---|---|---|---|
   |Минимальное количество виртуальных ядер|Любое из значений {0,5, 1, 2, 4}, которое не превышает максимальное количество виртуальных ядер|0,5 виртуального ядра|
   |Задержка автоматической приостановки работы|Минимум: 360 минут (6 часов)<br>Максимум: 10 080 минут (7 дней)<br>Шаг приращения 60 минут<br>Отключение автоматической приостановки: -1|360 минут|

> [!NOTE]
> Сейчас нельзя использовать T-SQL для перемещения существующей базы данных на уровень бессерверных вычислений или изменения объема вычислительных ресурсов. Но это можно сделать с помощью портала Azure или PowerShell.

### <a name="create-new-serverless-database-using-azure-portal"></a>Создать новую базу данных без сервера, с помощью портала Azure

См. [Краткое руководство. Создание отдельной базы данных в Базе данных SQL с помощью портала Azure](sql-database-single-database-get-started.md).

### <a name="create-new-serverless-database-using-powershell"></a>Создать новую базу данных без сервера, с помощью PowerShell

В следующем примере создается новая база данных на уровне бессерверных вычислений с описательным именем GP_S_Gen5_4 и со значениями по умолчанию для минимального количества виртуальных ядер и задержки автоматической приостановки.

```powershell
New-AzSqlDatabase `
  -ResourceGroupName $resourceGroupName `
  -ServerName $serverName `
  -DatabaseName $databaseName `
  -ComputeModel Serverless `
  -Edition GeneralPurpose `
  -ComputeGeneration Gen5 `
  -MinVcore 0.5 `
  -MaxVcore 2 `
  -AutoPauseDelayInMinutes 720
```

### <a name="move-provisioned-compute-database-into-serverless-compute-tier"></a>Перемещение базы данных подготовленных вычислительных ресурсов на уровень бессерверных вычислений

В следующем примере существующая база данных перемещается с уровня подготовленных вычислений на уровень бессерверных вычислений. В этом примере явно указываются такие параметры, как минимальное и максимальное количество виртуальных ядер и задержка автоматический приостановки.

```powershell
Set-AzSqlDatabase
  -ResourceGroupName $resourceGroupName `
  -ServerName $serverName `
  -DatabaseName $databaseName `
  -Edition GeneralPurpose `
  -ComputeModel Serverless `
  -ComputeGeneration Gen5 `
  -MinVcore 1 `
  -MaxVcore 4 `
  -AutoPauseDelayInMinutes 1440
```

### <a name="move-serverless-database-into-provisioned-compute-tier"></a>Перемещение данных бессерверных баз данных на уровень подготовленных вычислительных ресурсов

Перемещение бессерверной базы данных на уровень подготовленных вычислений выполняется так же, как и перемещение подготовленной базы данных на уровень бессерверных вычислений.

## <a name="modifying-serverless-configuration"></a>Изменения конфигурации без сервера

### <a name="maximum-vcores"></a>Максимальное количество виртуальных ядер

Изменение максимальное количество виртуальных ядер выполняется с помощью [набора AzSqlDatabase](https://docs.microsoft.com/powershell/module/az.sql/set-azsqldatabase) команду в PowerShell с помощью `MaxVcore` аргумент.

### <a name="minimum-vcores"></a>Минимальное количество виртуальных ядер

Изменение минимального выполняется с помощью [набора AzSqlDatabase](https://docs.microsoft.com/powershell/module/az.sql/set-azsqldatabase) команду в PowerShell с помощью `MinVcore` аргумент.

### <a name="autopause-delay"></a>Задержка автоматической приостановки работы

Изменение задержки autopause выполняется с помощью [набора AzSqlDatabase](https://docs.microsoft.com/powershell/module/az.sql/set-azsqldatabase) команду в PowerShell с помощью `AutoPauseDelayInMinutes` аргумент.

## <a name="monitoring"></a>Мониторинг

### <a name="resources-used-and-billed"></a>Используемые и тарифицируемые ресурсы

Ресурсы бессерверных баз данных инкапсулируются в следующие сущности:

#### <a name="app-package"></a>Пакет приложения

Пакет приложения представляет внешнюю границу управления для большинства ресурсов базы данных, независимо от того, на каком уровне находится база данных (бессерверные или подготовленные вычисления). Пакет приложения содержит экземпляр SQL и внешние службы, которые вместе определяют область применения всех пользовательских и системных ресурсов, используемых базой данных в Базе данных SQL. Внешние службы включают компоненты R и функцию полнотекстового поиска. Экземпляр SQL обычно управляет общим использованием ресурсов в пакете приложения.

#### <a name="user-resource-pool"></a>Пул пользовательских ресурсов

Пул пользовательских ресурсов представляет внутреннюю границу управления для большинства ресурсов базы данных, независимо от того, на каком уровне находится база данных (бессерверные или подготовленные вычисления). Пользователь пула области действия ресурсов ЦП и ввода-ВЫВОДА для пользователя рабочую нагрузку, создаваемую запросами DDL, например запросы CREATE и ALTER и DML, такие как выбор, вставка, обновление и удаление. Эти запросы обычно представляют самые распространенные операции, потребляющие ресурсы в пакете приложения.

### <a name="metrics"></a>metrics

|Сущность|Метрика|Описание|Units|
|---|---|---|---|
|Пакет приложения|app_cpu_percent|Количество виртуальных ядер, используемых в приложении относительно максимального количества виртуальных ядер, которое можно использовать в приложении.|Процент|
|Пакет приложения|app_cpu_billed|Объем вычислительных ресурсов, тарифицируемых для приложения в отчетный период. Сумма, которая насчитывается за этот период, является произведением этого показателя и стоимости виртуального ядра. <br><br>Значение этого показателя вычисляется с учетом потребления максимального количества ресурсов ЦП и памяти в каждую секунду. Если используемые количество виртуальных ядер и объем ресурсов памяти меньше, чем минимальный подготовленный объем, плата взимается за подготовленные ресурсы. Чтобы сравнить, как взимается плата за ресурсы ЦП и памяти, представьте, что объем памяти нормализуется с учетом виртуальных ядер путем преобразования объема памяти в ГБ в количество виртуальных ядер по 3 ГБ.|Время использования виртуальных ядер в секундах|
|Пакет приложения|app_memory_percent|Объем памяти, используемый в приложении, относительно максимального объема памяти, который можно использовать в приложении.|Процент|
|Пользовательский пул|cpu_percent|Количество виртуальных ядер, используемых пользовательской рабочей нагрузкой, относительно максимального количества виртуальных ядер, которое можно использовать в пользовательской рабочей нагрузке.|Процент|
|Пользовательский пул|data_IO_percent|Количество операций ввода-вывода, используемых пользовательской рабочей нагрузкой, относительно максимального количества операций ввода-вывода, которое можно использовать в пользовательской рабочей нагрузке.|Процент|
|Пользовательский пул|log_IO_percent|Количество записанных в журнал МБ/с, используемых пользовательской рабочей нагрузкой, относительно максимального количества записанных в журнал МБ/с, которое можно использовать в пользовательской рабочей нагрузке.|Процент|
|Пользовательский пул|workers_percent|Количество рабочих ролей, используемых пользовательской рабочей нагрузкой, относительно максимального количества рабочих ролей, которое можно использовать в пользовательской рабочей нагрузке.|Процент|
|Пользовательский пул|sessions_percent|Количество сеансов, используемых пользовательской рабочей нагрузкой, относительно максимального количества сеансов, которое можно использовать в пользовательской рабочей нагрузке.|Процент|
____

> [!NOTE]
> Метрики на портале Azure доступны в области базы данных для отдельной базы данных в разделе **Мониторинг**.

### <a name="pause-and-resume-status"></a>Состояние приостановки и возобновления работы

На портале Azure состояние базы данных отображается в разделе "Обзор" для сервера, содержащего список баз данных. Состояние базы данных также отображается в разделе "Обзор" для базы данных.

Просмотреть состояние приостановки и возобновления работы базы данных можно с помощью следующей команды PowerShell:

```powershell
Get-AzSqlDatabase `
  -ResourceGroupName $resourcegroupname `
  -ServerName $servername `
  -DatabaseName $databasename `
  | Select -ExpandProperty "Status"
```

## <a name="resource-limits"></a>Ограничения ресурсов

См. подробнее об [ограничениях ресурсов уровня бессерверных вычислений](sql-database-vCore-resource-limits-single-databases.md#serverless-compute-tier).

## <a name="billing"></a>Выставление счетов

Объем оплачиваемых вычислительных ресурсов зависит от максимального объема ресурсов ЦП и памяти, используемых каждую секунду. Если используемый объем ЦП и памяти меньше, чем минимальный подготовленный объем, плата взимается за подготовленные ресурсы. Чтобы сравнить, как взимается плата за ресурсы ЦП и памяти, представьте, что объем памяти нормализуется с учетом виртуальных ядер путем преобразования объема памяти в ГБ в количество виртуальных ядер по 3 ГБ.

- **Выставление счетов за ресурсы**: ЦП и память
- **Сумма к оплате**: цена за единицу виртуальное * max (минимальное количество виртуальных ядер, используемый виртуальных ядер, память min ГБ * 1/3, память используется в ГБ * 1/3) 
- **Периодичность выставления счетов**: посекундно.

Цена за единицу виртуальное в затратах на виртуальное ядро в секунду. См. подробнее на [странице с ценами на Базу данных SQL Azure](https://azure.microsoft.com/pricing/details/sql-database/single/), где приведены цены за потребленные единицы ресурсов в заданном регионе.

Объем тарифицируемых вычислительных ресурсов определяется следующим показателем:

- **Показатель**: app_cpu_billed (виртуальное ядро в секунду).
- **Определение**: максимальный объем ресурсов (минимальное количество виртуальных ядер, используемое количество виртуальных ядер, минимальный объем памяти в ГБ * 1/3, используемый объем памяти в ГБ * 1/3).
- **Частота обращения**: поминутно.

Это количество вычисляется каждую секунду и суммируется за 1 минуту.

Рассмотрим базу данных без сервера настроены 1 мин виртуальных ядер и 4 максимальное количество виртуальных ядер.  Это соответствует примерно 3 ГБ памяти min и максимальной памятью 12 ГБ.  Предположим, что задержка автоматической приостановки равна 6 часов и ее рабочую нагрузку, активные в течение первых 2 часов из 24-часовой период и в противном случае неактивные.    

В этом случае базы данных выставляется за вычислительные ресурсы и хранилище в течение первых 8 часов.  Несмотря на то, что база данных находится в неактивные начиная со второго часа, по-прежнему взимается за вычислительные ресурсы за последующие 6 часов, в соответствии с минимальным количеством вычислительных, подготовлены база данных находится в сети.  Только для хранения тарифицируется за оставшуюся часть 24-часового периода после приостановки базы данных.

Точнее спецификации вычислений в этом примере вычисляется следующим образом:

|Интервал времени|использовать каждую секунду виртуальных ядер|ГБ в секунду|Вычисления измерений выставлен счет|секунд виртуальное выставлен счет за интервал времени|
|---|---|---|---|---|
|0:00-1:00|4.|9|использовать число виртуальных ядер|4 виртуальных ядра * 3600 секунд = 14400 виртуальное секунд|
|1:00-2:00|1|12|Память, используемая|12 ГБ * 1/3 * 3600 секунд: 14400 виртуальное секунд|
|2:00-8:00|0|0|Подготовленной памяти Min|3 ГБ * 1/3 * 21600 секунд = 21600 виртуальное секунд|
|8:00-24:00|0|0|Нет вычислений взимается, пока выполнение приостановлено|Виртуальное ядро 0 секунд|
|Общее виртуальное секунд выставлен счет за 24 часа||||Виртуальное ядро 50400 секунд|

Предположим, что цена за единицу вычислений составляет 0,000073 долл. США/виртуальное ядро/секунда.  Затем вычислений, выставлен счет за этот 24-часового периода — это совокупность вычислений цен и виртуальное секунды единицы выставления счетов: $0.000073/vCore/second * 50400 секунд виртуальное = $3,68

## <a name="available-regions"></a>Доступные регионы

На уровне бессерверных вычислений доступно по всему миру за исключением следующих: Восточная Австралия Central, Китай, Северной части Китая, Южная Франция, Германия центральная Германия, Западная Индия, Южная Корея, ЮАР, Запад, Северная часть соединенного Королевства, Южная часть соединенного Королевства, Западная часть соединенного Королевства и западно-Центральная часть США.

## <a name="next-steps"></a>Дальнейшие действия

- Чтобы начать работу, см. [краткое руководство по созданию отдельной базы данных в Базе данных SQL с помощью портала Azure](sql-database-single-database-get-started.md).
- См. подробнее об [ограничениях ресурсов уровня бессерверных вычислений](sql-database-vCore-resource-limits-single-databases.md#serverless-compute-tier).
