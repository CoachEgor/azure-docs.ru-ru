---
title: Масштабирование ресурсов отдельной базы данных SQL Azure | Документация Майкрософт
description: В этой статье описано масштабирование вычислительных ресурсов и ресурсов хранилища, предоставляемых отдельной базе данных в Базе данных SQL Azure.
services: sql-database
ms.service: sql-database
ms.subservice: performance
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: stevestein
ms.author: sstein
ms.reviewer: carlrab
manager: craigg
ms.date: 04/26/2019
ms.openlocfilehash: 4288eb7d051c44149a6f1970430dc8c409ca957d
ms.sourcegitcommit: 44a85a2ed288f484cc3cdf71d9b51bc0be64cc33
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "64572866"
---
# <a name="scale-single-database-resources-in-azure-sql-database"></a>Масштабирование ресурсов отдельной базы данных в Базе данных SQL Azure

В этой статье описывается, как масштабировать вычислительные ресурсы и хранилище ресурсов, доступных для отдельной базы данных на уровне подготовленных вычислительных ресурсов. 

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]
> [!IMPORTANT]
> Модуль PowerShell Azure Resource Manager по-прежнему поддерживается базой данных SQL Azure, но все будущие разработки — для модуля Az.Sql. Для этих командлетов см. в разделе [AzureRM.Sql](https://docs.microsoft.com/powershell/module/AzureRM.Sql/). Аргументы для команд в модуле Az и в модуле AzureRm практически идентичны.

## <a name="change-compute-size-vcores-or-dtus"></a>Изменение размера вычислений (количество виртуальных ядер или Dtu)

Изначально выбрав количество виртуальных ядер и Dtu, можно масштабировать отдельную базу данных вверх или вниз динамически на основе фактического использования с помощью [портала Azure](sql-database-single-databases-manage.md#manage-an-existing-sql-database-server), [Transact-SQL](https://docs.microsoft.com/sql/t-sql/statements/alter-database-transact-sql?view=azuresqldb-current#examples-1), [ PowerShell](/powershell/module/az.sql/set-azsqldatabase), [Azure CLI](/cli/azure/sql/db#az-sql-db-update), или [REST API](https://docs.microsoft.com/rest/api/sql/databases/update).

В следующем видео показано динамическое изменение уровня служб и объема вычислительных ресурсов для увеличения количества доступных единиц DTU отдельной базы данных.

> [!VIDEO https://channel9.msdn.com/Blogs/Azure/Azure-SQL-Database-dynamically-scale-up-or-scale-down/player]
>

> [!IMPORTANT]
> Иногда требуется сжать базу данных, чтобы освободить неиспользуемое пространство. Дополнительные сведения см. в статье об [управлении файловым пространством в Базе данных SQL Azure](sql-database-file-space-management.md).

### <a name="impact-of-changing-service-tier-or-rescaling-compute-size"></a>Связанные с изменением размера службы уровня или при изменении масштаба вычислений

Изменение службы уровня или вычислений, что размер отдельной базы данных в основном включает в себя службу, выполнив следующие действия:

1. Создайте новый экземпляр вычислений для базы данных  

    Новый экземпляр вычислений для базы данных создается с уровня запрошенную службу и объем вычислений. Для некоторых комбинаций уровень служб и изменение размеров вычислительных реплики базы данных должны создаваться в новом экземпляре вычислений, который включает в себя копирование данных и строго могут повлиять на общую задержку. Независимо от того на этом этапе база данных остается в сети и подключений по-прежнему должны направляться в базу данных на исходном экземпляре вычислений.

2. Переключение Маршрутизация подключения к новой вычислительный экземпляр

    Существующие подключения к базе данных на исходном экземпляре вычислений, удаляются. Все новые подключения к базе данных в новом экземпляре вычислений. Для некоторых комбинаций уровень служб и изменение размеров вычислительных файлы базы данных отсоединить и присоединить повторно во время переключения.  В любом случае коммутатор может привести к краткому перерыву при база данных недоступна, обычно для менее чем за 30 секунд и часто для всего несколько секунд. Если есть длительные транзакции, выполняемые при подключения прерываются, продолжительность этого шага может занять больше времени для восстановления прерванных транзакций. [Ускорение восстановления базы данных](sql-database-accelerated-database-recovery.md) могут уменьшить воздействие из прерывания длительных транзакций.

> [!IMPORTANT]
> Данные не будут утеряны при какой-либо шаг в рабочем процессе.

### <a name="latency-of-changing-service-tier-or-rescaling-compute-size"></a>Задержка изменения размера службы уровня или при изменении масштаба вычислений

Задержка для изменения уровня обслуживания или изменения размера вычислительных отдельной базы данных или эластичного пула параметризован следующим образом:

|Уровень служб|Основные отдельной базы данных</br>Standard (S0-S1)|Основные эластичного пула</br>Стандартный (S2 – S12) </br>Гипермасштабируемый, </br>Общие цели отдельной базы данных или эластичного пула|"Премиум" или критически важный для отдельной базы данных или эластичного пула|
|:---|:---|:---|:---|
|**Основные отдельной базы данных,</br> Standard (S0-S1)**|&bull; &nbsp;Время задержки независимых используемого дискового пространства</br>&bull; &nbsp;Как правило, меньше 5 минут|&bull; &nbsp;Задержка пропорционально занятое пространство базы данных из-за копирование данных</br>&bull; &nbsp;Как правило, меньше 1 мин на ГБ используемого дискового пространства|&bull; &nbsp;Задержка пропорционально занятое пространство базы данных из-за копирование данных</br>&bull; &nbsp;Как правило, меньше 1 мин на ГБ используемого дискового пространства|
|**Основные эластичного пула, </br>Standard (S2 – S12) </br>Гипермасштабируемого, </br>общего назначения одной базы данных или эластичного пула**|&bull; &nbsp;Задержка пропорционально занятое пространство базы данных из-за копирование данных</br>&bull; &nbsp;Как правило, меньше 1 мин на ГБ используемого дискового пространства|&bull; &nbsp;Время задержки независимых используемого дискового пространства</br>&bull; &nbsp;Как правило, меньше 5 минут|&bull; &nbsp;Задержка пропорционально занятое пространство базы данных из-за копирование данных</br>&bull; &nbsp;Как правило, меньше 1 мин на ГБ используемого дискового пространства|
|**"Премиум" или критически важный для отдельной базы данных или эластичного пула**|&bull; &nbsp;Задержка пропорционально занятое пространство базы данных из-за копирование данных</br>&bull; &nbsp;Как правило, меньше 1 мин на ГБ используемого дискового пространства|&bull; &nbsp;Задержка пропорционально занятое пространство базы данных из-за копирование данных</br>&bull; &nbsp;Как правило, меньше 1 мин на ГБ используемого дискового пространства|&bull; &nbsp;Задержка пропорционально занятое пространство базы данных из-за копирование данных</br>&bull; &nbsp;Как правило, меньше 1 мин на ГБ используемого дискового пространства|

> [!TIP]
> Для отслеживания выполняемых операций см. разделы [Управление операциями с помощью SQL REST API](https://docs.microsoft.com/rest/api/sql/operations/list), [Управление операциями с помощью интерфейса командной строки](/cli/azure/sql/db/op), [Отслеживание операций с помощью T-SQL](/sql/relational-databases/system-dynamic-management-views/sys-dm-operation-status-azure-sql-database) и следующие две команды PowerShell: [Get-AzSqlDatabaseActivity](/powershell/module/az.sql/get-azsqldatabaseactivity) и [Stop AzSqlDatabaseActivity](/powershell/module/az.sql/stop-azsqldatabaseactivity).

### <a name="cancelling-service-tier-changes-or-compute-rescaling-operations"></a>Отмена изменения уровня службы или вычислений, при изменении масштаба операций

Уровень службы, изменить или вычислений при изменении масштаба операции могут быть отменены.

#### <a name="azure-portal"></a>Портал Azure

В колонке обзора базы данных, перейдите к **уведомления** и щелкните плитку, уведомляющее о текущей операции:

![Текущие операции](media/sql-database-single-database-scale/ongoing-operations.png)

Затем щелкните кнопку с надписью **отменить эту операцию**.

![Отменить текущую операцию](media/sql-database-single-database-scale/cancel-ongoing-operation.png)

#### <a name="powershell"></a>PowerShell

Из командной строки PowerShell, установите `$ResourceGroupName`, `$ServerName`, и `$DatabaseName`, а затем выполните следующую команду:

```PowerShell
$OperationName = (az sql db op list --resource-group $ResourceGroupName --server $ServerName --database $DatabaseName --query "[?state=='InProgress'].name" --out tsv)
if(-not [string]::IsNullOrEmpty($OperationName))
    {
        (az sql db op cancel --resource-group $ResourceGroupName --server $ServerName --database $DatabaseName --name $OperationName)
        "Operation " + $OperationName + " has been canceled"
    }
    else
    {
        "No service tier change or compute rescaling operation found"
    }
```

### <a name="additional-considerations-when-changing-service-tier-or-rescaling-compute-size"></a>Дополнительные соображения при изменении службы уровня или при изменении масштаба объем вычислений

- При переходе к более высокому уровню служб или объему вычислительных ресурсов максимальный размер базы данных не увеличивается, если явно не указать для него большее значение (maxsize).
- При понижении уровня базы данных используемое ею пространство не должно превышать максимальный допустимый размер целевых уровня служб и объема вычислительных ресурсов.
- При понижении уровня служб **Премиум** до уровня **Стандартный** дополнительная плата взимается, если максимальный размер базы данных поддерживается в целевом объеме вычислительных ресурсов и превышает объем включенного хранилища целевого объема вычислительных ресурсов. Например, если уровень базы данных P1 с максимальным размером в 500 ГБ понижается до уровня S3, то взимается плата за дополнительное хранилище, так как S3 поддерживает максимальный размер в 500 ГБ, а его включенный объем хранилища составляет только 250 ГБ. Поэтому дополнительный объем хранилища равен 500 – 250 = 250 ГБ. Чтобы узнать о ценах на дополнительное хранилище, ознакомьтесь с [ценами на Базу данных SQL](https://azure.microsoft.com/pricing/details/sql-database/). Если фактический объем пространства, которое используется, меньше, чем включенный объем хранилища, то этих дополнительных затрат можно избежать, уменьшив максимальный размер базы данных до включенного объема.
- Если вы повышаете уровень базы данных со включенной [георепликацией](sql-database-geo-replication-portal.md), перед повышением уровня базы данных-источника сначала обновите базы данных-получатели до требуемого уровня служб и объема вычислительных ресурсов (общая рекомендация для оптимальной производительности). Чтобы выполнить обновление до другого выпуска, сначала необходимо обновить базу данных-получатель.
- Если вы понижаете уровень базы данных со включенной [георепликацией](sql-database-geo-replication-portal.md), перед понижением уровня базы данных-получателя сначала понизьте категорию ее базы данных-источника до требуемого уровня служб и объема вычислительных ресурсов (общая рекомендация для оптимальной производительности). Чтобы понизить уровень до другого выпуска, сначала необходимо понизить уровень базы данных-получателя.
- Предложения службы восстановления отличаются для разных уровней служб. При понижении до уровня **Базовый** уменьшится период хранения резервной копии. Ознакомьтесь со статьей [Подробнее об автоматически создаваемых резервных копиях в базе данных SQL](sql-database-automated-backups.md).
- Новые свойства базы данных не применяются до тех пор, пока изменение не завершится.

### <a name="billing-during-compute-rescaling"></a>Выставление счетов во время вычислений при изменении масштаба

Плата взимается за каждый час существования базы данных с учетом самого высокого уровня служб и объема вычислительных ресурсов, которые использовались в течение этого часа, даже если база данных использовалась или была активна менее часа. Например, если вы создадите отдельную базу данных и через 5 минут удалите ее, вам будет выставлен счет за 1 час использования базы данных.

## <a name="change-storage-size"></a>Изменение размера хранилища

### <a name="vcore-based-purchasing-model"></a>Модель покупки на основе числа виртуальных ядер

- Хранилище может быть расширено до максимально возможного размера с шагом приращения в 1 ГБ. Минимальный настраиваемый размер хранилища данных составляет 5 ГБ.
- Хранилище для отдельной базы данных можно подготовить, увеличив или уменьшив ее максимальный размер с помощью [портала Azure](https://portal.azure.com), [Transact-SQL](https://docs.microsoft.com/sql/t-sql/statements/alter-database-transact-sql?view=azuresqldb-current#examples-1), [PowerShell](/powershell/module/az.sql/set-azsqldatabase), [Azure CLI](/cli/azure/sql/db#az-sql-db-update) или [REST API](https://docs.microsoft.com/rest/api/sql/databases/update).
- База данных SQL автоматически выделяет 30 % доступного места для хранения файлов журнала и 32 ГБ на виртуальное ядро для базы данных tempdb, но при этом их суммарный объем не должен превышать 384 ГБ. База данных tempdb находится на подключенном диске SSD на всех уровнях служб.
- Стоимость хранилища для отдельной базы данных равна суммарному объему хранилища данных и журналов, умноженному на цену единицы хранения для этого уровня служб. Стоимость базы данных tempdb включена в стоимость виртуального ядра. Сведения о цене на дополнительное хранилище см. на [странице цен на Базу данных SQL](https://azure.microsoft.com/pricing/details/sql-database/).

> [!IMPORTANT]
> Иногда требуется сжать базу данных, чтобы освободить неиспользуемое пространство. Дополнительные сведения см. в статье об [управлении файловым пространством в Базе данных SQL Azure](sql-database-file-space-management.md).

### <a name="dtu-based-purchasing-model"></a>Модель приобретения на основе единиц DTU

- Цена DTU для отдельной базы данных включает в себя определенный объем хранилища, не требующий дополнительной платы. Дополнительный объем хранилища, сверх включенного, можно подготовить за дополнительную плату в пределах максимального допустимого размера с шагом в 250 ГБ при объеме хранилища до 1 ТБ и с шагом в 256 ГБ — при объеме более 1 ТБ. Сведения о включенном объеме хранилища и ограничениях максимального размера см. в разделе [Отдельная база данных: размеры хранилищ и объемы вычислительных ресурсов](sql-database-dtu-resource-limits-single-databases.md#single-database-storage-sizes-and-compute-sizes).
- Дополнительное хранилище для отдельной базы данных можно подготовить, увеличив ее максимальный размер с помощью портала Azure, [Transact-SQL](https://docs.microsoft.com/sql/t-sql/statements/alter-database-transact-sql?view=azuresqldb-current#examples-1), [PowerShell](/powershell/module/az.sql/set-azsqldatabase), [Azure CLI](/cli/azure/sql/db#az-sql-db-update) или [REST API](https://docs.microsoft.com/rest/api/sql/databases/update).
- Стоимость дополнительного хранилища для отдельной базы данных равна его объему, умноженному на цену единицы хранения этого хранилища для уровня служб. Сведения о цене на дополнительное хранилище см. на [странице цен на Базу данных SQL](https://azure.microsoft.com/pricing/details/sql-database/).

> [!IMPORTANT]
> Иногда требуется сжать базу данных, чтобы освободить неиспользуемое пространство. Дополнительные сведения см. в статье об [управлении файловым пространством в Базе данных SQL Azure](sql-database-file-space-management.md).

## <a name="p11-and-p15-constraints-when-max-size-greater-than-1-tb"></a>Ограничения P11 и P15, если максимальный размер больше 1 ТБ

В настоящее время на уровне Premium предоставляется более 1 ТБ хранилища, за исключением следующих регионов: Восточный Китай, Северный Китай, Центральная Германия, Северо-Восточная Германия, центрально-западная часть США, регионы US DoD и центральная часть для государственных организаций США. В этих регионах максимальный объем хранилища категории "Премиум" ограничен 1 ТБ. Ниже приведены рекомендации и ограничения для баз данных P11 и P15 с максимальным размером, превышающим 1 ТБ.

- Если максимальный размер для базы данных P11 или P15 была когда-либо значение больше 1 ТБ, то можно его только восстановить или копируются в базу данных P11 или P15.  Как следствие базы данных можно преобразована шкала для размер различных вычислительных предоставляемый объем пространства, выделенного во время операции при изменении масштаба не превышает максимальный размер ограничений размера вычислений.
- Для сценариев активной георепликации:
  - Настройка отношения георепликации: если используется база данных-источник P11 или P15, уровень баз данных — получателей также должен быть P11 или P15. Базы данных с более низким объемом вычислительных ресурсов отклоняются, так как они не поддерживают максимальный размер больше 1 ТБ.
  - Обновление базы данных — источника в отношениях георепликации: при изменении максимального размера и указании значения больше 1 ТБ в базе данных — источнике такие же изменения произойдут в базе данных — получателе. Чтобы изменения в базе данных-источнике вступили в силу, оба обновления должны быть успешными. При этом применяются ограничения по регионам для максимального размера больше 1 ТБ. Если база данных-получатель находится в регионе, не поддерживающем максимальный размер больше 1 TB, то база данных-источник не обновляется.
- Использование службы импорта и экспорта для загрузки баз данных P11 и P15 с максимальным размером больше 1 ТБ не поддерживается. Для [импорта](sql-database-import.md) и [экспорта](sql-database-export.md) данных используйте файл SqlPackage.exe.

## <a name="next-steps"></a>Дальнейшие действия

Сведения об общих ограничениях ресурсов см. в статьях [Ограничения ресурсов для отдельной базы данных в Базе данных SQL Azure при использовании модели приобретения на основе виртуальных ядер (предварительная версия)](sql-database-vcore-resource-limits-single-databases.md) и [SQL Database DTU-based resource limits - elastic pools](sql-database-dtu-resource-limits-single-databases.md) (Ограничения ресурсов для эластичных пулов в Базе данных SQL при использовании модели приобретения на основе единиц DTU).
