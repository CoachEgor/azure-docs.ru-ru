---
title: Масштабирование ресурсов отдельной базы данных
description: В этой статье описано масштабирование вычислительных ресурсов и ресурсов хранилища, предоставляемых отдельной базе данных в Базе данных SQL Azure.
services: sql-database
ms.service: sql-database
ms.subservice: performance
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: stevestein
ms.author: sstein
ms.reviewer: carlrab
ms.date: 03/10/2020
ms.openlocfilehash: 84846e642fa102045b89eb12dbc85b0995867a3e
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80061596"
---
# <a name="scale-single-database-resources-in-azure-sql-database"></a>Масштабирование ресурсов отдельной базы данных в Базе данных SQL Azure

В этой статье описывается, как масштабировать ресурсы вычислений и хранения данных, доступные для базы данных Azure S'L на уровне подготовленных вычислений. Кроме того, [без серверный вычислительный уровень](sql-database-serverless.md) обеспечивает автоматическое масштабирование вычислений и счета в секунду для используемых вычислений.

После первоначального выбора количества vCores или DTUs, вы можете масштабировать единую базу данных вверх или вниз динамически на основе фактического опыта с помощью [портала Azure](sql-database-single-databases-manage.md#manage-an-existing-sql-database-server), [Transact-S'L](https://docs.microsoft.com/sql/t-sql/statements/alter-database-transact-sql?view=azuresqldb-current#examples-1), [PowerShell](/powershell/module/az.sql/set-azsqldatabase), [Azure CLI](/cli/azure/sql/db#az-sql-db-update), или [REST API.](https://docs.microsoft.com/rest/api/sql/databases/update)

В следующем видео показано динамическое изменение уровня служб и объема вычислительных ресурсов для увеличения количества доступных единиц DTU отдельной базы данных.

> [!VIDEO https://channel9.msdn.com/Blogs/Azure/Azure-SQL-Database-dynamically-scale-up-or-scale-down/player]

> [!IMPORTANT]
> Иногда требуется сжать базу данных, чтобы освободить неиспользуемое пространство. Для получения дополнительной информации смотрите [пространство файла Управления в базе данных Azure S'L.](sql-database-file-space-management.md)

## <a name="impact"></a>Влияние

Изменение уровня обслуживания или размера вычислений в основном включает в себя службу, выполняющую следующие действия:

1. Создание нового экземпляра вычислений для базы данных  

    Создается новый экземпляр вычислений с запрашиваемым уровнем обслуживания и размером вычислений. Для некоторых комбинаций изменений уровня обслуживания и вычислений в новом экземпляре вычислений должна быть создана копия базы данных, которая включает копирование данных и может сильно повлиять на общую задержку. Несмотря на это, база данных остается в сети во время этого шага, и соединения продолжают направляться в базу данных в исходном экземпляре вычислений.

2. Переключение перекачивания подключений к новому экземпляру вычислений

    Существующие соединения с базой данных в исходном экземпляре вычислений отброшены. Любые новые подключения устанавливаются в базу данных в новом экземпляре вычислений. Для некоторых комбинаций изменений уровня обслуживания и вычислений файлы базы данных отсоединяются и прикрепляются во время коммутатора.  Несмотря на это, коммутатор может привести к краткому перерыву службы, когда база данных недоступна, как правило, менее 30 секунд и часто в течение нескольких секунд. Если при удалении транзакций длительное время выполнения соединений продолжительность этого шага может занять больше времени для восстановления прерванных транзакций. [Ускоренное восстановление базы данных](sql-database-accelerated-database-recovery.md) может уменьшить влияние прерывания длительных транзакций.

> [!IMPORTANT]
> Во время любого этапа рабочего процесса данные не теряются. Убедитесь, что вы внедрили некоторую [логику повторной попытки](sql-database-connectivity-issues.md) в приложениях и компонентах, использующих базу данных Azure S'L, в то время как уровень обслуживания изменяется.

## <a name="latency"></a>Задержка 

Предполагаемая задержка для изменения уровня обслуживания или перемасштабирования размера вычислений одной базы данных или эластичного пула параметры:

|Уровень служб|Базовая единая база данных,</br>Стандарт (S0-S1)|Базовый эластичный бассейн,</br>Стандарт (S2-S12), </br>Гипермасштаб, </br>Единая база данных общего назначения или эластичный пул|Премиум или бизнес-критическая единая база данных или эластичный пул|
|:---|:---|:---|:---|
|**Базовая единая база данных,</br> Стандарт (S0-S1)**|&bull;&nbsp;Постоянная задержка времени независимо от используемого пространства</br>&bull;&nbsp;Как правило, менее 5 минут|&bull;&nbsp;Задержка, пропорциональная пространству базы данных, используемому в связи с копированием данных</br>&bull;&nbsp;Как правило, менее 1 минуты на ГБ используемого пространства|&bull;&nbsp;Задержка, пропорциональная пространству базы данных, используемому в связи с копированием данных</br>&bull;&nbsp;Как правило, менее 1 минуты на ГБ используемого пространства|
|**Базовый эластичный пул, </br>Стандартный (S2-S12), </br>Hyperscale, </br>единая база данных общего назначения или эластичный пул**|&bull;&nbsp;Задержка, пропорциональная пространству базы данных, используемому в связи с копированием данных</br>&bull;&nbsp;Как правило, менее 1 минуты на ГБ используемого пространства|&bull;&nbsp;Постоянная задержка времени независимо от используемого пространства</br>&bull;&nbsp;Как правило, менее 5 минут|&bull;&nbsp;Задержка, пропорциональная пространству базы данных, используемому в связи с копированием данных</br>&bull;&nbsp;Как правило, менее 1 минуты на ГБ используемого пространства|
|**Премиум или бизнес-критическая единая база данных или эластичный пул**|&bull;&nbsp;Задержка, пропорциональная пространству базы данных, используемому в связи с копированием данных</br>&bull;&nbsp;Как правило, менее 1 минуты на ГБ используемого пространства|&bull;&nbsp;Задержка, пропорциональная пространству базы данных, используемому в связи с копированием данных</br>&bull;&nbsp;Как правило, менее 1 минуты на ГБ используемого пространства|&bull;&nbsp;Задержка, пропорциональная пространству базы данных, используемому в связи с копированием данных</br>&bull;&nbsp;Как правило, менее 1 минуты на ГБ используемого пространства|

> [!TIP]
> Для мониторинга незавершенных операций см.: [Управление операциями с помощью API S'L REST,](https://docs.microsoft.com/rest/api/sql/operations/list) [Управление операциями с использованием CLI,](/cli/azure/sql/db/op) [Мониторинг операций с использованием T-S'L](/sql/relational-databases/system-dynamic-management-views/sys-dm-operation-status-azure-sql-database) и этих двух команд PowerShell: [Get-AzSqlDatabaseActivity](/powershell/module/az.sql/get-azsqldatabaseactivity) и [Stop-AzSqlDatabaseActivity](/powershell/module/az.sql/stop-azsqldatabaseactivity).

## <a name="cancelling-changes"></a>Отмена изменений

Изменение уровня службы или операция вычислений может быть отменена.

#### <a name="azure-portal"></a>Портал Azure

В лезвии обзора базы данных перейдите к **Уведомлениям** и нажмите на плитку, указывающую на текущую операцию:

![Текущая эксплуатация](media/sql-database-single-database-scale/ongoing-operations.png)

Далее нажмите на кнопку с пометкой **Отмена этой операции.**

![Отмена текущей работы](media/sql-database-single-database-scale/cancel-ongoing-operation.png)

#### <a name="powershell"></a>PowerShell

Из запроса команды PowerShell `$resourceGroupName` `$serverName`установите `$databaseName`, и , а затем запустить следующую команду:

```azurecli
$operationName = (az sql db op list --resource-group $resourceGroupName --server $serverName --database $databaseName --query "[?state=='InProgress'].name" --out tsv)
if (-not [string]::IsNullOrEmpty($operationName)) {
    (az sql db op cancel --resource-group $resourceGroupName --server $serverName --database $databaseName --name $operationName)
        "Operation " + $operationName + " has been canceled"
}
else {
    "No service tier change or compute rescaling operation found"
}
```

## <a name="additional-considerations"></a>Дополнительные сведения

- При переходе к более высокому уровню служб или объему вычислительных ресурсов максимальный размер базы данных не увеличивается, если явно не указать для него большее значение (maxsize).
- При понижении уровня базы данных используемое ею пространство не должно превышать максимальный допустимый размер целевых уровня служб и объема вычислительных ресурсов.
- При понижении уровня служб **Премиум** до уровня **Стандартный** дополнительная плата взимается в следующих случаях: 1) максимальный размер базы данных поддерживается в целевом объеме вычислительных ресурсов; 2) максимальный размер превышает включенный объем хранилища целевого объема вычислительных ресурсов. Например, если база данных P1 с максимальным размером 500 ГБ уменьшена до S3, то применяется дополнительная стоимость хранения, поскольку S3 поддерживает максимальный размер 1 ТБ, а включенное в него количество хранилища составляет всего 250 ГБ. Поэтому дополнительный объем хранилища равен 500 – 250 = 250 ГБ. Чтобы узнать о ценах на дополнительное хранилище, ознакомьтесь с [ценами на Базу данных SQL](https://azure.microsoft.com/pricing/details/sql-database/). Если фактический объем пространства, которое используется, меньше, чем включенный объем хранилища, то этих дополнительных затрат можно избежать, уменьшив максимальный размер базы данных до включенного объема.
- Если вы повышаете уровень базы данных со включенной [георепликацией](sql-database-geo-replication-portal.md), перед повышением уровня базы данных-источника сначала обновите базы данных-получатели до требуемого уровня служб и объема вычислительных ресурсов (общая рекомендация для оптимальной производительности). При переходе в другое издание необходимо сначала обновить вторичную базу данных.
- Если вы понижаете уровень базы данных со включенной [георепликацией](sql-database-geo-replication-portal.md), перед понижением уровня базы данных-получателя сначала понизьте категорию ее базы данных-источника до требуемого уровня служб и объема вычислительных ресурсов (общая рекомендация для оптимальной производительности). При понижении рейтинга до другого издания необходимо сначала понизить первую базу данных.
- Предложения службы восстановления отличаются для разных уровней служб. При понижении до уровня **Базовый** уменьшится период хранения резервной копии. Ознакомьтесь со статьей [Подробнее об автоматически создаваемых резервных копиях в Базе данных SQL](sql-database-automated-backups.md).
- Новые свойства базы данных не применяются до тех пор, пока изменение не завершится.

## <a name="billing"></a>Выставление счетов 

Плата взимается за каждый час существования базы данных с учетом самого высокого уровня служб и объема вычислительных ресурсов, которые использовались в течение этого часа, даже если база данных использовалась или была активна менее часа. Например, если вы создадите отдельную базу данных и через 5 минут удалите ее, вам будет выставлен счет за 1 час использования базы данных.

## <a name="change-storage-size"></a>Изменение размера хранилища

### <a name="vcore-based-purchasing-model"></a>Модель приобретения на основе виртуальных ядер

- Хранение может быть подготовлено до предела максимального размера хранилища данных с использованием 1 ГБ приращений. Минимальное настраиваемое хранилище данных составляет 1 ГБ. Просматривайте страницы документации с ограничением ресурсов для [отдельных баз данных](sql-database-vcore-resource-limits-single-databases.md) и [эластичных пулов](sql-database-vcore-resource-limits-elastic-pools.md) для хранения данных максимальных пределов размера в каждой цели службы.
- Хранение данных для одной базы данных может быть подготовлено путем увеличения или уменьшения ее максимального размера с помощью [портала Azure,](https://portal.azure.com) [Трансакт-СЗЛ,](https://docs.microsoft.com/sql/t-sql/statements/alter-database-transact-sql?view=azuresqldb-current#examples-1) [PowerShell,](/powershell/module/az.sql/set-azsqldatabase) [Azure CLI](/cli/azure/sql/db#az-sql-db-update)или [REST API.](https://docs.microsoft.com/rest/api/sql/databases/update) Если значение максимального размера указано в байтах, оно должно быть кратным 1 ГБ (1073741824 байтов).
- Объем данных, которые могут храниться в файлах данных базы данных, ограничен настроенным размером хранилища данных. В дополнение к этому хранилищу база данных S'L автоматически выделяет на 30% больше хранилища для журнала транзакций.
- База данных S'L автоматически выделяет 32 ГБ на vCore для `tempdb` базы данных. `tempdb`находится на локальном хранении SSD во всех уровнях обслуживания.
- Цена хранения для одной базы данных или эластичного пула — это сумма объемов хранения данных и хранения журналов транзакций, умноженных на цену единицы хранения уровня обслуживания. Стоимость включена `tempdb` в стоимость. Для получения подробной информации о цене хранилища, [см.](https://azure.microsoft.com/pricing/details/sql-database/)

> [!IMPORTANT]
> Иногда требуется сжать базу данных, чтобы освободить неиспользуемое пространство. Для получения дополнительной информации смотрите [пространство файла Управления в базе данных Azure S'L.](sql-database-file-space-management.md)

### <a name="dtu-based-purchasing-model"></a>Модель приобретения на основе единиц DTU

- Цена DTU для отдельной базы данных включает в себя определенный объем хранилища, не требующий дополнительной платы. Дополнительный объем хранилища, сверх включенного, можно подготовить за дополнительную плату в пределах максимального допустимого размера с шагом в 250 ГБ при объеме хранилища до 1 ТБ и с шагом в 256 ГБ — при объеме более 1 ТБ. Сведения о включенном объеме хранилища и ограничениях максимального размера см. в разделе [Отдельная база данных: размеры хранилища и объемы вычислительных ресурсов](sql-database-dtu-resource-limits-single-databases.md#single-database-storage-sizes-and-compute-sizes).
- Дополнительное хранилище для одной базы данных может быть подготовлено путем увеличения ее максимального размера с помощью портала Azure, [Transact-S,](https://docs.microsoft.com/sql/t-sql/statements/alter-database-transact-sql?view=azuresqldb-current#examples-1) [PowerShell,](/powershell/module/az.sql/set-azsqldatabase) [Azure CLI](/cli/azure/sql/db#az-sql-db-update)или [REST API.](https://docs.microsoft.com/rest/api/sql/databases/update)
- Стоимость дополнительного хранилища для отдельной базы данных равна объему хранилища, умноженному на цену единицы хранения этого хранилища для уровня служб. Сведения о цене на дополнительное хранилище см. на [странице цен на Базу данных SQL](https://azure.microsoft.com/pricing/details/sql-database/).

> [!IMPORTANT]
> Иногда требуется сжать базу данных, чтобы освободить неиспользуемое пространство. Для получения дополнительной информации смотрите [пространство файла Управления в базе данных Azure S'L.](sql-database-file-space-management.md)

### <a name="geo-replicated-database"></a>Гео-реплицированная база данных

Чтобы изменить размер базы данных реплицируемой вторичной базы данных, измените размер первичной базы данных. Затем это изменение будет реплицироваться и внедряться и осуществляться в вторичную базу данных. 

## <a name="p11-and-p15-constraints-when-max-size-greater-than-1-tb"></a>Ограничения P11 и P15, когда максимальный размер превышает 1 ТБ

Более 1 ТБ хранения в Премиум-уровне в настоящее время доступна во всех регионах, за исключением: Китай Восток, Китай Север, Германия Центральной, Германия Северо-Восток, Западно-Центральный США, США Министерство по юаней регионов, и правительство США Центральной. В этих регионах максимальный объем хранилища категории "Премиум" ограничен 1 ТБ. Ниже приведены рекомендации и ограничения для баз данных P11 и P15 с максимальным размером, превышающим 1 ТБ.

- Если максимальный размер базы данных P11 или P15 когда-либо устанавливался на значение, превышающее 1 ТБ, то она может быть восстановлена или скопирована только в базу данных P11 или P15.  Впоследствии база данных может быть перемасштабирована до другого размера вычисления при условии, что объем пространства, выделенного на момент операции перемасштабирования, не превышает максимальных пределов размера нового размера вычисления.
- Для сценариев активной георепликации:
  - Настройка отношения георепликации. Если используется база данных-источник P11 или P15, уровень баз данных-получателей также должен быть P11 или P15. Базы данных с более низким объемом вычислительных ресурсов отклоняются, так как они не поддерживают максимальный размер больше 1 ТБ.
  - Обновление базы данных-источника в отношениях георепликации. При изменении максимального размера и указании значения больше 1 ТБ в базе данных-источнике такие же изменения произойдут в базе данных-получателе. Чтобы изменения в базе данных-источнике вступили в силу, оба обновления должны быть успешными. При этом применяются ограничения по регионам для максимального размера больше 1 ТБ. Если база данных-получатель находится в регионе, не поддерживающем максимальный размер больше 1 TB, то база данных-источник не обновляется.
- Использование службы импорта и экспорта для загрузки баз данных P11 и P15 с максимальным размером больше 1 ТБ не поддерживается. Для [импорта](sql-database-import.md) и [экспорта](sql-database-export.md) данных используйте файл SqlPackage.exe.

## <a name="next-steps"></a>Дальнейшие действия

Сведения об общих ограничениях ресурсов см. в статьях [Ограничения ресурсов для отдельной базы данных в Базе данных SQL Azure при использовании модели приобретения на основе виртуальных ядер (предварительная версия)](sql-database-vcore-resource-limits-single-databases.md) и [SQL Database DTU-based resource limits - elastic pools](sql-database-dtu-resource-limits-single-databases.md) (Ограничения ресурсов для эластичных пулов в Базе данных SQL при использовании модели приобретения на основе единиц DTU).
