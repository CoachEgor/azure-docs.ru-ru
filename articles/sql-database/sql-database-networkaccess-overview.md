---
title: Управление доступом к сети для базы данных SQL Azure и хранилища данных | Документация Майкрософт
description: Обзор управления доступом к сети для базы данных и хранилища данных SQL Azure для управления доступом и настройки отдельной базы данных или в составе пула.
services: sql-database
ms.service: sql-database
ms.subservice: security
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: rohitnayakmsft
ms.author: rohitna
ms.reviewer: vanto
ms.date: 08/05/2019
ms.openlocfilehash: 4722cda0506493671ff872d75e7376f3de74b1b8
ms.sourcegitcommit: aa042d4341054f437f3190da7c8a718729eb675e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/09/2019
ms.locfileid: "68886654"
---
# <a name="azure-sql-database-and-data-warehouse-network-access-controls"></a>Управление доступом к сети для базы данных SQL Azure и хранилища данных

> [!NOTE]
> Эта статья относится к Azure SQL Server, а также к базам данных SQL и хранилища данных SQL, создаваемым на сервере SQL Azure. Для простоты база данных SQL используется как для базы данных SQL, так и для хранилища данных SQL.

> [!IMPORTANT]
> Эта статья *не* относится к **Управляемому экземпляру Базы данных SQL Azure**. Дополнительные сведения о конфигурации сети см. в разделе [Подключение к управляемый экземпляр](sql-database-managed-instance-connect-app.md) .

При создании нового SQL Server Azure [из портал Azure](sql-database-single-database-get-started.md)результат представляет собой общедоступную конечную точку в формате *yourservername.Database.Windows.NET*. По проекту доступ к общедоступной конечной точке запрещен. Затем можно использовать следующие элементы управления доступом к сети, чтобы выборочно разрешить доступ к базе данных SQl через общедоступную конечную точку.
- Разрешить службы Azure. Если задано значение ON, другие ресурсы в границах Azure, например виртуальная машина Azure, могут получить доступ к базе данных SQL.

- Правила брандмауэра IP-адресов: — Используйте эту функцию, чтобы явно разрешить подключения с определенного IP-адреса, например с локальных компьютеров.

- Правила брандмауэра виртуальной сети: Используйте эту функцию, чтобы разрешить трафик из определенной виртуальной сети в границах Azure.


## <a name="allow-azure-services"></a>Разрешить службы Azure 
При создании нового SQL Server Azure [из портал Azure](sql-database-single-database-get-started.md)этот параметр остается неустановленным.

 ![Снимок экрана создания нового сервера][1]

Этот параметр можно также изменить через панель брандмауэра после создания SQL Server Azure, как показано ниже.
  
 ![Снимок экрана: Управление брандмауэром сервера][2]

Если задано значение **в** SQL Server Azure, обеспечивается передача данных из всех ресурсов в пределах границы Azure, которые могут быть или не входить в вашу подписку.

Во многих случаях параметр **On** имеет больше разрешений, чем требуется большинству клиентов. Им может потребоваться установить значение **Off** и заменить его на более ограниченные правила брандмауэра IP-адресов или правила брандмауэра виртуальной сети. Это влияет на следующие функции:

### <a name="import-export-service"></a>Служба импорта и экспорта

Служба импорта и экспорта базы данных SQL Azure выполняется на виртуальных машинах в Azure. Эти виртуальные машины не находятся в вашей виртуальной сети и поэтому получают IP-адрес Azure при подключении к базе данных. После удаления параметра **Разрешить службам Azure доступ к серверу** эти виртуальные машины не смогут получить доступ к базам данных.
Чтобы обойти эту проблему, можно выполнить импорт BACPAC-файла или экспортировать его непосредственно в код с помощью API DACFx.

### <a name="sql-database-query-editor"></a>Редактор запросов базы данных SQL

Редактор запросов базы данных SQL Azure развертывается на виртуальных машинах в Azure. Эти виртуальные машины не находятся в вашей виртуальной сети. Поэтому они получают IP-адрес Azure при подключении к базе данных. После удаления параметра **Разрешить службам Azure доступ к серверу** эти виртуальные машины не смогут получить доступ к базам данных.

### <a name="table-auditing"></a>Аудит таблиц

В настоящее время существует два способа включения аудита для базы данных SQL. Аудит таблицы завершается сбоем после включения конечных точек службы на сервере Azure SQL Server. Чтобы устранить риски, используйте аудит больших двоичных объектов.

### <a name="impact-on-data-sync"></a>Влияние на синхронизацию данных

Компонент "Синхронизация данных" в Базе данных SQL Azure подключается к базам данных через IP-адреса Azure. При использовании конечных точек службы вы отключаете **разрешение служб Azure на** доступ к серверу базы данных SQL, и функция синхронизации данных будет нарушена.

## <a name="ip-firewall-rules"></a>Правила брандмауэра для IP-адресов
Брандмауэр на основе IP-адреса — это функция SQL Server Azure, которая предотвращает доступ к серверу базы данных до тех пор, пока вы явно не [добавите IP-адреса](sql-database-server-level-firewall-rule.md) клиентских компьютеров.


## <a name="virtual-network-firewall-rules"></a>Правила брандмауэра виртуальной сети

Кроме правил IP, брандмауэр SQL Server Azure позволяет определять *правила виртуальной сети*.  
Чтобы узнать больше, ознакомьтесь с разделом [Использование конечных точек служб и правил виртуальной сети для базы данных SQL Azure](sql-database-vnet-service-endpoint-rule-overview.md).

 ### <a name="azure-networking-terminology"></a>Терминология сети Azure  
При просмотре правил брандмауэра виртуальной сети учитывайте следующие термины сети Azure.

**Виртуальная сеть**. С подпиской Azure могут быть связаны виртуальные сети. 

**Подсеть**. Виртуальная сеть содержит **подсети**. Все ваши виртуальные машины Azure назначены в подсети. Одна подсеть может содержать несколько виртуальных машин или других вычислительных узлов. Вычислительные узлы, которые находятся вне вашей виртуальной сети, не имеют доступа к ней, если только не настроить систему безопасности таким образом, чтобы предоставить им доступ.

**Конечная точка службы для виртуальной сети.** [Конечная точка службы виртуальной сети] [VM-Virtual-Network-Service-Endpoints-Overview-649d] — это подсеть, значения свойств которой включают одно или несколько формальных имен типов служб Azure. В этой статье мы рассмотрим тип **Microsoft.Sql**, который относится к службе Azure, которая называется Базой данных SQL.

**Правило виртуальной сети.** Правило виртуальной сети для сервера Базы данных SQL — это подсеть, которая указана в списке управления доступом сервера Базы данных SQL. Для включения в ACL для базы данных SQL подсеть должна содержать имя типа **Microsoft.Sql**. Правило виртуальной сети предписывает серверу Базы данных SQL принимать подключения от всех узлов, находящихся в подсети.


## <a name="ip-vs-virtual-network-firewall-rules"></a>Сравнение IP и Правила брандмауэра виртуальной сети

Брандмауэр SQL Server Azure позволяет указать диапазоны IP-адресов, из которых сообщения принимаются в базу данных SQL. Эта методика хорошо подходит для постоянных IP-адресов, которые находятся за пределами частной сети Azure. Однако виртуальные машины в частной сети Azure настроены с использованием *динамических* IP-адресов. Динамические IP-адреса могут измениться после перезапуска виртуальной машины и, в свою очередь, сделать недействительным правило брандмауэра на основе IP-адресов. Было бы неразумно указывать динамический IP-адрес в правиле брандмауэра в рабочей среде.

Это ограничение можно обойти, получая *статический* IP-адрес для виртуальной машины. Дополнительные сведения см. в статье [Настройка частных IP-адресов для виртуальной машины с помощью портал Azure] [VM-configure-частный-IP-Addresses-для-a-Virtual-Machine-using-the-Azure-Portal-321w]. Тем не менее, подход статического IP-адреса может стать трудным для управления, и при масштабировании он является дорогостоящим. 

Правила виртуальной сети проще устанавливать и управлять доступом из определенной подсети, содержащей ваши виртуальные машины.

> [!NOTE]
> Пока еще невозможно разместить базу данных SQL в подсети. Если сервер Базы данных SQL Azure был узлом в подсети виртуальной сети, то все узлы в этой виртуальной сети могли взаимодействовать с базой данных SQL. В этом случае виртуальные машины могли взаимодействовать с базой данных SQL без необходимости в каких-либо правилах виртуальной сети или правилах фильтрации IP-адресов.

## <a name="next-steps"></a>Следующие шаги

- Краткое руководство по созданию правила брандмауэра IP на уровне сервера см. в статье [Создание базы данных SQL Azure](sql-database-single-database-get-started.md).

- Краткое руководство по созданию правила брандмауэра виртуальной сети на уровне сервера см. в статье [конечные точки и правила службы виртуальных сетей для базы данных SQL Azure](sql-database-vnet-service-endpoint-rule-overview.md).

- Дополнительные сведения о подключении к базе данных SQL Azure из приложений с открытым кодом или сторонними приложениями см. [в статье примеры кода для быстрого запуска клиента в базе данных SQL](https://msdn.microsoft.com/library/azure/ee336282.aspx).

- Сведения о дополнительных портах, которые, возможно, потребуется открыть, см. в разделе **Снаружи или внутри** статьи [Порты для ADO.NET 4.5, отличные от порта 1433](sql-database-develop-direct-route-ports-adonet-v12.md).

- Общие сведения о подключении к базе данных SQL Azure см. в статье [Архитектура подключения к SQL Azure](sql-database-connectivity-architecture.md) .

- Общие сведения о методах защиты в Базе данных SQL Azure см. в [этой статье](sql-database-security-overview.md).

<!--Image references-->
[1]: ./media/sql-database-get-started-portal/new-server2.png
[2]: ./media/sql-database-get-started-portal/manage-server-firewall.png
