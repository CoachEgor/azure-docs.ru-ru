---
title: Средства контроля сетевого доступа
description: Обзор элементов управления доступом к сети для базы данных Azure S'L и хранилища данных для управления доступом и настройки единой или объединенной базы данных.
services: sql-database
ms.service: sql-database
ms.subservice: security
titleSuffix: Azure SQL Database and SQL Data Warehouse
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: rohitnayakmsft
ms.author: rohitna
ms.reviewer: vanto
ms.date: 03/09/2020
ms.openlocfilehash: 8b4ee679b21d904f997f727f5f26275c86acc9c5
ms.sourcegitcommit: b80aafd2c71d7366838811e92bd234ddbab507b6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81414415"
---
# <a name="azure-sql-database-and-data-warehouse-network-access-controls"></a>Контроль доступа к сети лазурных данных и хранилища данных

> [!NOTE]
> Эта статья относится к Azure SQL Server, а также к базам данных SQL и хранилища данных SQL, создаваемым на сервере SQL Azure. Для простоты база данных SQL используется как для базы данных SQL, так и для хранилища данных SQL.

> [!IMPORTANT]
> Эта статья *не* относится к **Управляемому экземпляру Базы данных SQL Azure**. для получения дополнительной информации о конфигурации сети [см. подключение к управляемой инстанции](sql-database-managed-instance-connect-app.md) .

При создании нового сервера Azure S'L Server с [портала Azure](sql-database-single-database-get-started.md)результатом является общедоступной конечная точка в формате, *yourservername.database.windows.net*.

Вы можете использовать следующие элементы управления доступом к сети, чтобы выборочно разрешить доступ к базе данных S'L через общедоступную точку:
- Разрешить службы Azure: При установке на ON другие ресурсы в пределах границы Azure, например виртуальная машина Azure, могут получить доступ к базе данных S'L

- Правила IP-брандмауэра: Используйте эту функцию, чтобы явно разрешить соединения с определенного IP-адреса, например, из штатных машин

Вы также можете разрешить частный доступ к базе данных S'L от [виртуальных сетей](../virtual-network/virtual-networks-overview.md) через:
- Правила брандмауэра виртуальной сети: Используйте эту функцию, чтобы разрешить трафик из определенной виртуальной сети в пределах границы Azure

- Частная ссылка: Используйте эту функцию для создания частной конечной точки для сервера Azure S'L в определенной виртуальной сети



Смотрите ниже видео для высокого уровня объяснение этих элементов доступа и что они делают:
> [!VIDEO https://channel9.msdn.com/Shows/Data-Exposed/Data-Exposed--SQL-Database-Connectivity-Explained/player?WT.mc_id=dataexposed-c9-niner]


## <a name="allow-azure-services"></a>Разрешить службы Azure 
Во время создания нового сервера Azure S'L Server [с портала Azure](sql-database-single-database-get-started.md)эта настройка остается неконтролируемой.



Вы также можете изменить эту настройку через панель брандмауэра после создания сервера Azure S'L Server следующим образом.
  
 ![Скриншот брандмауэра управления сервером][2]

При установке **на ON** Azure S'L Server обеспечивается связь со всех ресурсов, натерритории Azure, которые могут быть или не быть частью вашей подписки.

Во многих случаях настройка **ON** является более разрешительной, чем то, что большинство клиентов хотят. Они могут захотеть настроить эту настройку для **OFF** и заменить его более ограничительными правилами IP-брандмауэра или правилами брандмауэра Виртуальной сети. Это влияет на следующие функции, которые работают на вс-чатах в Azure, которые не являются частью вашей VNet и, следовательно, подключаются к базе данных Sql через IP-адрес Azure.

### <a name="import-export-service"></a>Служба импорта и экспорта
Служба экспорта импорта не работает, когда **доступ к службам Azure** установлен на **OFF.** Однако вы можете обойти проблему, [вручную запустив sqlpackage.exe из Azure VM или выполняя экспорт](https://docs.microsoft.com/azure/sql-database/import-export-from-vm) непосредственно в коде, используя API DACFx.

### <a name="data-sync"></a>Синхронизация данных
Для использования функции синхронизации данных с **разрешить доступ к службам Azure,** установленным для **OFF,** необходимо создать отдельные записи правил брандмауэра, чтобы [добавить IP-адреса](sql-database-server-level-firewall-rule.md) из **тега службы Sql** для региона, вмещающего базу данных **концентратора.**
Добавьте эти правила брандмауэра уровня сервера к логическим серверам, в которых размещается базы данных **как концентратора,** так и базы данных **членов** (которые могут быть в разных регионах)

Используйте следующий скрипт PowerShell для создания IP-адресов, соответствующих тегу услуг Sql для региона Западной США
```powershell
PS C:\>  $serviceTags = Get-AzNetworkServiceTag -Location eastus2
PS C:\>  $sql = $serviceTags.Values | Where-Object { $_.Name -eq "Sql.WestUS" }
PS C:\> $sql.Properties.AddressPrefixes.Count
70
PS C:\> $sql.Properties.AddressPrefixes
13.86.216.0/25
13.86.216.128/26
13.86.216.192/27
13.86.217.0/25
13.86.217.128/26
13.86.217.192/27
```

> [!TIP]
> Get-AzNetworkServiceTag возвращает глобальный диапазон для тега обслуживания Sql, несмотря на указание параметра местоположения. Обязательно отфильтруйте его в регионе, где размещена база данных концентратора, используемая вашей группой синхронизации

Обратите внимание, что выход скрипта PowerShell находится в обозначении Classless Inter-Domain Routing (CIDR), и это должно быть преобразовано в формат IP-адреса Start and End с помощью [Get-IPrangeStartEnd.ps1,](https://gallery.technet.microsoft.com/scriptcenter/Start-and-End-IP-addresses-bcccc3a9) как это
```powershell
PS C:\> Get-IPrangeStartEnd -ip 52.229.17.93 -cidr 26                                                                   
start        end
-----        ---
52.229.17.64 52.229.17.127
```

Сделайте следующие дополнительные шаги для преобразования всех IP-адресов из формата CIDR в формат Start и End IP-адресов.

```powershell
PS C:\>foreach( $i in $sql.Properties.AddressPrefixes) {$ip,$cidr= $i.split('/') ; Get-IPrangeStartEnd -ip $ip -cidr $cidr;}                                                                                                                
start          end
-----          ---
13.86.216.0    13.86.216.127
13.86.216.128  13.86.216.191
13.86.216.192  13.86.216.223
```
Теперь их можно добавить в качестве отдельных правил брандмауэра, а затем установить **«Разрешить службам Azure» получить доступ к серверу** к OFF.


## <a name="ip-firewall-rules"></a>Правила брандмауэра для IP-адресов
Брандмауэр на основе ip является особенностью Azure S'L Server, которая предотвращает доступ к серверу базы данных до тех пор, пока вы не [добавите IP-адреса](sql-database-server-level-firewall-rule.md) клиентских машин.


## <a name="virtual-network-firewall-rules"></a>Правила брандмауэра виртуальной сети

В дополнение к правилам IP, брандмауэр Azure S'L Server позволяет определить *виртуальные сетевые правила.*  
Чтобы узнать больше, смотрите [конечные точки и правила службы Виртуальной сети для базы данных Azure S'L](sql-database-vnet-service-endpoint-rule-overview.md) или посмотрите это видео:

> [!VIDEO https://channel9.msdn.com/Shows/Data-Exposed/Data-Exposed--Demo--Vnet-Firewall-Rules-for-SQL-Database/player?WT.mc_id=dataexposed-c9-niner]

 ### <a name="azure-networking-terminology"></a>Терминология сети Azure  
Будьте в курсе следующих терминов Сети Azure при изучении правил брандмауэра виртуальной сети

**Виртуальная сеть:** С подпиской Azure можно иметь виртуальные сети 

**Подсеть**. Виртуальная сеть содержит **подсети**. Все ваши виртуальные машины Azure назначены в подсети. Одна подсеть может содержать несколько виртуальных машин или других вычислительных узлов. Вычислительные узлы, которые находятся вне вашей виртуальной сети, не имеют доступа к ней, если только не настроить систему безопасности таким образом, чтобы предоставить им доступ.

**Конечная точка службы для виртуальной сети**. [Конечная точка службы для виртуальной сети](../virtual-network/virtual-network-service-endpoints-overview.md) — это подсеть, значения свойств которой включают в себя одно или несколько формальных имен типов службы Azure. В этой статье мы рассмотрим тип **Microsoft.Sql**, который относится к службе Azure, которая называется Базой данных SQL.

**Правило виртуальной сети**. Правило виртуальной сети для сервера Базы данных SQL — это подсеть, которая указана в списке управления доступом (ACL) сервера Базы данных SQL. Для включения в ACL для базы данных SQL подсеть должна содержать имя типа **Microsoft.Sql**. Правило виртуальной сети предписывает серверу Базы данных SQL принимать подключения от всех узлов, находящихся в подсети.


## <a name="ip-vs-virtual-network-firewall-rules"></a>IP против правил брандмауэра виртуальной сети

Брандмауэр Azure S'L Server позволяет указывать диапазоны IP-адресов, от которых сообщения принимаются в базу данных S'L. Эта методика хорошо подходит для постоянных IP-адресов, которые находятся за пределами частной сети Azure. Однако виртуальные машины (Виртуальные) в частной сети Azure настроены с *динамическими* IP-адресами. Динамические IP-адреса могут меняться при перезапущени VM и, в свою очередь, аннулировать правило брандмауэра на основе IP. Было бы неразумно указывать динамический IP-адрес в правиле брандмауэра в рабочей среде.

Вы можете обойти это ограничение, получив *статический* IP-адрес для вашего VM. Дополнительные сведения см. в разделе [Настройка частных IP-адресов для виртуальной машины с помощью портала Azure](../virtual-network/virtual-networks-static-private-ip-arm-pportal.md). Однако применение статических IP-адресов может усложнить управление и создать дополнительные расходы при увеличении масштаба среды. 

Правила виртуальной сети являются более простой альтернативой для установления и управления доступом из определенной подсети, содержащей ваши виртуальные технологии.

> [!NOTE]
> Пока еще невозможно разместить базу данных SQL в подсети. Если сервер Базы данных SQL Azure был узлом в подсети виртуальной сети, то все узлы в этой виртуальной сети могли взаимодействовать с базой данных SQL. В этом случае виртуальные машины могли взаимодействовать с базой данных SQL без необходимости в каких-либо правилах виртуальной сети или правилах фильтрации IP-адресов.

## <a name="private-link"></a>Приватный канал 
Частная ссылка позволяет подключиться к Серверу Azure s'L через **частную конечную точку.** Частной конечней точкой является частный IP-адрес в конкретной [виртуальной сети](../virtual-network/virtual-networks-overview.md) и Subnet.

## <a name="next-steps"></a>Дальнейшие действия

- Для быстрого запуска для создания правила IP-брандмауэра на уровне сервера [см.](sql-database-single-database-get-started.md)

- Для быстрого запуска для создания правила брандмауэра Vnet на уровне сервера [см.](sql-database-vnet-service-endpoint-rule-overview.md)

- Для получения помощи при подключении к базе данных Azure [Client quickstart code samples to SQL Database](https://msdn.microsoft.com/library/azure/ee336282.aspx)S'L из приложений с открытым исходным кодом или сторонних приложений см.

- Дополнительные сведения о портах, которые, возможно, потребуется открыть, см. в разделе **Снаружи или внутри** статьи [Порты для ADO.NET 4.5, отличные от порта 1433](sql-database-develop-direct-route-ports-adonet-v12.md).

- Для получения обзора подключения к базе данных Azure S'L [см. Архитектуру подключения Azure S'L](sql-database-connectivity-architecture.md)

- Общие сведения о методах защиты в Базе данных SQL Azure см. в [этой статье](sql-database-security-overview.md).

<!--Image references-->
[1]: ./media/sql-database-get-started-portal/new-server2.png
[2]: ./media/sql-database-get-started-portal/manage-server-firewall.png

