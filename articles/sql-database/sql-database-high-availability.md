---
title: Высокая доступность службы Базы данных SQL Azure | Документация Майкрософт
description: Узнайте о возможностях и функциях высокой доступности службы Базы данных SQL Azure
services: sql-database
ms.service: sql-database
ms.subservice: high-availability
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: jovanpop-msft
ms.author: sashan
ms.reviewer: carlrab, sashan
ms.date: 06/10/2019
ms.openlocfilehash: 226b0c1cb11fc872cb7759e0d0e49275b9c2d9bf
ms.sourcegitcommit: 7c4de3e22b8e9d71c579f31cbfcea9f22d43721a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/26/2019
ms.locfileid: "68568154"
---
# <a name="high-availability-and-azure-sql-database"></a>Высокая доступность и база данных SQL Azure

Цель архитектуры высокого уровня доступности в базе данных SQL Azure — гарантировать, что ваша база данных будет работать в 99,99% времени, не беспокоясь о влиянии операций обслуживания и простоев. Azure автоматически обрабатывает критически важные задачи обслуживания, такие как исправления, резервные копии, обновления Windows и SQL, а также незапланированные события, такие как оборудование, программное обеспечение или сбои сети.  При отправке или отработки отказа базового экземпляра SQL время простоя не заметно, если в приложении [используется логика повторных попыток](sql-database-develop-overview.md#resiliency) . Базу данных SQL Azure можно быстро восстановить даже в самых критических обстоятельствах, что гарантирует постоянную доступность ваших данных.

Решение высокой доступности предназначено для того, чтобы гарантировать, что зафиксированные данные никогда не будут потеряны из-за сбоев, операции обслуживания не затрагивают рабочую нагрузку и что база данных не будет единственной точкой отказа в архитектуре программного обеспечения. Периоды обслуживания и простой, из-за которых нужно остановить рабочую нагрузку во время обновления или обслуживания базы данных, отсутствуют. 

В базе данных SQL Azure есть две архитектурные модели с высоким уровнем доступности:

- Стандартная модель доступности, основанная на разделении вычислений и хранилища.  Он полагается на высокий уровень доступности и надежности удаленного уровня хранилища. Эта архитектура предназначена для ориентированных на бюджет бизнес-приложений, которые могут допускать снижение производительности во время действий по обслуживанию.
- Модель доступности уровня "Премиум", основанная на кластере процессов ядра СУБД. Это зависит от того факта, что всегда существует кворум доступных узлов ядра СУБД. Эта архитектура предназначена для критически важных приложений с высокой производительностью операций ввода-вывода, высокой частотой транзакций и гарантирует минимального воздействия на производительность рабочей нагрузки во время операций обслуживания.

База данных SQL Azure работает на последней стабильной версии SQL Server ядро СУБД и ОС Windows, и большинство пользователей не заметят, что обновления выполняются непрерывно.

## <a name="basic-standard-and-general-purpose-service-tier-availability"></a>Доступность уровня служб для ценовых категорий "Базовый", "Стандартный" и "Общего назначения"

Эти уровни служб используют стандартную архитектуру доступности. На следующем рисунке показаны четыре разных узла с раздельными уровнями вычислений и хранилища.

![Разделение уровней вычисления и хранения](media/sql-database-high-availability/general-purpose-service-tier.png)

Стандартная модель доступности включает два уровня:

- Уровень вычислений без отслеживания состояния, который запускает `sqlserver.exe` процесс и содержит только временные и кэшированные данные на подключенном SSD, например tempdb, базу данных model, кэш планов, буферный пул и пул хранилища столбцов. Этот узел работает Service Fabric Azure, который инициализирует `sqlserver.exe`, управляет работоспособностью узла и выполняет отработку отказа на другой узел, если это необходимо.
- Уровень данных с отслеживанием состояния с файлами базы данных (MDF/LDF), которые хранятся в хранилище BLOB-объектов Azure. Хранилище BLOB-объектов Azure имеет встроенную возможность обеспечения доступности и избыточности данных. Гарантируется, что каждая запись в файле журнала или странице в файле данных будет сохранена даже в случае сбоя SQL Server процесса.

При обновлении ядра СУБД или операционной системы или при обнаружении сбоя Azure Service Fabric переместит процесс SQL Server без отслеживания состояния на другой узел вычислений без отслеживания состояния с достаточной свободной емкостью. Перемещение не влияет на данные в хранилище BLOB-объектов Azure, а файлы данных и журналов присоединяются к вновь инициализированному SQL Server процессу. Этот процесс гарантирует доступность 99,99%, но при этом большая рабочая нагрузка может вызвать некоторое снижение производительности во время перехода, так как новый экземпляр SQL Server начинается с холодного кэша.

## <a name="premium-and-business-critical-service-tier-availability"></a>Доступность уровня служб ценовых категорий "Премиум" и "Критически важный для бизнеса"

Уровни служб "Премиум" и "критически важный для бизнеса" используют модель доступности уровня "Премиум", которая интегрирует ресурсы вычислений (SQL Server ядро СУБД процесс) и хранилище (локально подключен SSD) на одном узле. Высокий уровень доступности достигается за счет репликации вычислений и хранилища на дополнительные узлы с созданием кластера из трех и четырех узлов. 

![Кластер узлов ядра СУБД](media/sql-database-high-availability/business-critical-service-tier.png)

Файлы базы данных (MDF/LDF) помещаются в подключенное хранилище SSD, чтобы обеспечить очень низкую задержку в рабочей нагрузке. Высокий уровень доступности реализуется с помощью технологии, подобной SQL Server [группам доступности Always on](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server). Кластер включает одну первичную реплику (SQL Server процесс), доступную для рабочих нагрузок чтения и записи, а также до трех вторичных реплик (вычислений и хранения), содержащих копии данных. Основной узел постоянно передает изменения на вторичные узлы по порядку и гарантирует, что данные синхронизируются по крайней мере с одной вторичной репликой перед фиксацией каждой транзакции. Этот процесс гарантирует, что если основной узел аварийно завершает работу по какой-либо причине, всегда существует полностью синхронизированный узел для отработки отказа. Отработка отказа инициируется Service Fabricом Azure. После того как вторичная реплика станет новым основным узлом, создается другая вторичная реплика, чтобы убедиться, что кластер имеет достаточное количество узлов (набор кворума). После завершения отработки отказа подключения SQL автоматически перенаправляются на новый первичный узел.

В качестве дополнительного преимущества модель доступности Premium включает возможность перенаправлять подключения SQL только для чтения на одну из вторичных реплик. Эта функция называется горизонтальным масштабированием для [чтения](sql-database-read-scale-out.md). Она предоставляет 100% дополнительной мощности вычислений без дополнительной платы, чтобы отключить загрузку операций только для чтения, таких как аналитические рабочие нагрузки, из первичной реплики.

## <a name="zone-redundant-configuration"></a>Конфигурация с избыточностью в пределах зоны

По умолчанию кластер узлов для модели доступности уровня "Премиум" создается в одном центре обработки данных. С появлением [зоны доступности Azure](../availability-zones/az-overview.md)база данных SQL может разместить разные реплики в кластере в разных зонах доступности в одном регионе. Чтобы исключить единую точку сбоя, круг управления также дублируется в нескольких зонах в виде трех кругов шлюзов. Маршрутизацией для конкретного круга шлюза управляет [диспетчер трафика Azure](../traffic-manager/traffic-manager-overview.md) (ATM). Так как конфигурация избыточности в зонах на уровнях "Премиум" или "критически важный для бизнеса" не создает дополнительную избыточность базы данных, ее можно включить без дополнительных затрат. Выбрав конфигурацию с избыточностью зоны, можно сделать базы данных уровня "Премиум" или "критически важный для бизнеса" устойчивыми к большому набору сбоев, включая разрушительные простои центра обработки данных, без каких-либо изменений в логике приложения. Можно также преобразовать любые существующие базы данных или пулы уровня "Премиум" или "Критически важный для бизнеса" в конфигурацию с избыточностью в пределах зоны.

Поскольку базы данных, избыточные в пределах зоны, имеют реплики в разных центрах обработки с определенным расстоянием между ними, увеличенная задержка сети может увеличить время фиксации и, таким же, повлиять на производительность некоторых рабочих нагрузок OLTP. Вы всегда можете вернуться к конфигурации с одной зоной, отключив параметр избыточности в пределах зоны. Этот процесс представляет собой оперативную операцию, аналогичную регулярному обновлению уровня служб. В конце этого процесса база данных или пул переносится из круга с избыточностью в пределах зоны в круг с одной зоной, или наоборот.

> [!IMPORTANT]
> В настоящее время избыточные базы данных и пулы эластичных БД поддерживаются только на уровнях служб "Премиум" и "критически важный для бизнеса" в области выбора. При использовании уровня критически важный для бизнеса конфигурация с избыточностью зоны доступна только при выборе оборудования для вычислений го поколения. Актуальные сведения о регионах, поддерживающих избыточные базы данных в пределах зоны, см. в разделе [Поддержка служб по регионам](../availability-zones/az-overview.md#services-support-by-region).  

На следующей схеме показана версия архитектуры с высоким уровнем доступности и избыточностью в пределах зоны.

![Архитектура с высоким уровнем доступности и избыточностью в пределах зоны](./media/sql-database-high-availability/zone-redundant-business-critical-service-tier.png)

## <a name="accelerated-database-recovery-adr"></a>Ускоренное восстановление базы данных (ADR)

[Ускоренное восстановление базы данных (ADR)](sql-database-accelerated-database-recovery.md) — это новая функция ядра СУБД SQL, которая значительно улучшает доступность базы данных, особенно при наличии длительных транзакций. В настоящее время функция ADR доступна для отдельных баз данных, эластичных пулов и Хранилища данных SQL Azure.

## <a name="conclusion"></a>Заключение

База данных SQL Azure включает встроенное решение высокого уровня доступности, которое тесно интегрировано с платформой Azure. Это зависит от Service Fabric для обнаружения сбоев и восстановления, в хранилище BLOB-объектов Azure для защиты данных, а также на Зоны доступности для повышения отказоустойчивости. Кроме того, база данных SQL Azure использует технологию группы доступности Always On из SQL Server для репликации и отработки отказа. Сочетание этих технологий позволяет приложениям полностью реализовать преимущества модели смешанного хранения и поддерживать наиболее ресурсоемкие соглашения об уровне обслуживания.

## <a name="next-steps"></a>Следующие шаги

- Узнайте больше о [зонах доступности Azure](../availability-zones/az-overview.md).
- Дополнительные сведения о [Service Fabric](../service-fabric/service-fabric-overview.md).
- Дополнительные сведения о [диспетчере трафика Azure](../traffic-manager/traffic-manager-overview.md).
- Чтобы изучить дополнительные возможности обеспечения высокой доступности и аварийного восстановления, ознакомьтесь с [непрерывностью бизнес-процессов](sql-database-business-continuity.md).
