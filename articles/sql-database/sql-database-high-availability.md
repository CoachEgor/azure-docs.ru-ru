---
title: Высокий уровень доступности
description: Узнайте о возможностях и функциях высокой доступности службы Базы данных SQL Azure
services: sql-database
ms.service: sql-database
ms.subservice: high-availability
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: sashan
ms.author: sashan
ms.reviewer: carlrab, sashan
ms.date: 10/14/2019
ms.openlocfilehash: b560cee23855d1c0e8a7b3c2cb9d82c184a1ebf6
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79269657"
---
# <a name="high-availability-and-azure-sql-database"></a>Высокая доступность и база данных SQL Azure

Цель архитектуры высокой доступности в базе данных Azure S'L Database состоит в том, чтобы гарантировать, что ваша база данных работает минимум 99,99% времени (для получения дополнительной информации о конкретных SLA для различных уровней, пожалуйста, направьте [SLA для базы данных Azure S'L),](https://azure.microsoft.com/support/legal/sla/sql-database/)не беспокоясь о влиянии операций по техническому обслуживанию и простоев. Azure автоматически обрабатывает критически важные задачи обслуживания, такие как исправление, резервное копирование, обновление Windows и S'L, а также незапланированные события, такие как базовое оборудование, программное обеспечение или сбои в работе сети.  При исправлении или сбоя в работе базового экземпляра S'L время простоя не заметно, если в приложении [используется логика повторной работы.](sql-database-develop-overview.md#resiliency) Базу данных SQL Azure можно быстро восстановить даже в самых критических обстоятельствах, что гарантирует постоянную доступность ваших данных.

Решение высокой доступности предназначено для обеспечения того, чтобы зафиксированные данные никогда не терялись из-за сбоев, что операции по техническому обслуживанию не влияют на рабочую нагрузку и что база данных не будет ни одной точкой сбоя в архитектуре программного обеспечения. Периоды обслуживания и простой, из-за которых нужно остановить рабочую нагрузку во время обновления или обслуживания базы данных, отсутствуют. 

В базе данных Azure S'L, которые используются две архитектурные модели с высокой доступностью:

- Стандартная модель доступности, основанная на разделении вычислений и хранения данных.  Он опирается на высокую доступность и надежность удаленного уровня хранения данных. Эта архитектура ориентирована на бюджетные бизнес-приложения, которые могут допускать некоторое снижение производительности во время работ по техническому обслуживанию.
- Модель доступности премиум-класса, основанная на кластере процессов движка базы данных. Он опирается на тот факт, что всегда существует кворум доступных узлов движка базы данных. Эта архитектура нацелена на критически важные приложения миссии с высокой производительностью и высокой частотой транзакций и гарантирует минимальное влияние на рабочую нагрузку во время работы по техническому обслуживанию.

База данных Azure S'L работает на последней стабильной версии системы баз данных сервера s'L и Windows OS, и большинство пользователей не заметят, что обновления выполняются непрерывно.

## <a name="basic-standard-and-general-purpose-service-tier-availability"></a>Доступность уровня служб для ценовых категорий "Базовый", "Стандартный" и "Общего назначения"

Эти уровни обслуживания используют стандартную архитектуру доступности. На следующем рисунке показаны четыре различных узла с разделенными слоями вычислений и хранения.

![Разделение уровней вычисления и хранения](media/sql-database-high-availability/general-purpose-service-tier.png)

Стандартная модель доступности включает в себя два слоя:

- Уровень вычислений без состояния, который запускает `sqlservr.exe` процесс и содержит только переходные и кэшированные данные, такие как TempDB, базы данных моделей на прилагаемом SSD и план кэша, буферный пул и пул столбцов в памяти. Этот узел без состояния управляется Azure Service `sqlservr.exe`Fabric, который инициализирует, контролирует работоспособность узла и при необходимости выполняет сбой в другой узел.
- Слой данных с файлами базы данных (.mdf/.ldf), которые хранятся в хранилище Azure Blob. Хранилище Azure blob имеет встроенную функцию доступности данных и избыточности. Это гарантирует, что каждая запись в файле журнала или странице в файле данных будет сохранена, даже если процесс S'L Server выходит из строя.

Всякий раз, когда двигатель базы данных или операционная система обновляются или обнаруживается сбой, Azure Service Fabric переведет процесс сервера без состояния s'L Server в другой вычислительный узел без состояния с достаточной свободной емкостью. Перемещение данных в хранилище Azure Blob не влияет на него, а файлы данных/журнала прикрепляются к недавно инициализированному процессу сервера S'L. Этот процесс гарантирует доступность 99,99%, но большая рабочая нагрузка может столкнуться с некоторым ухудшением производительности во время перехода, так как новый экземпляр S'L Server начинается с холодного кэша.

## <a name="premium-and-business-critical-service-tier-availability"></a>Доступность уровня служб ценовых категорий "Премиум" и "Критически важный для бизнеса"

Уровни обслуживания Премиум и Бизнес-Критические используют модель доступности Premium, которая интегрирует вычислительные ресурсы (процесс баз данных сервера S'L Server Engine) и хранение (локально прикрепленный SSD) на одном узле. Высокая доступность достигается путем репликации как вычислений, так и хранения дополнительных узлов, создавая кластер из трех-четырех узлов. 

![Кластер узлов ядра СУБД](media/sql-database-high-availability/business-critical-service-tier.png)

Базовые файлы базы данных (.mdf/.ldf) размещаются на прилагаемом хранилище SSD, чтобы обеспечить очень низкую задержку истогового вашего рабочей нагрузки. Высокая доступность внедряется с использованием технологии, аналогичной s'L Server [Always On Availability Groups.](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server) Кластер включает в себя единую первичную реплику (процесс сервера S'L), которая доступна для рабочих нагрузок клиента с читальной записью, и до трех вторичных реплик (вычислять и хранить), содержащих копии данных. Основной узлы постоянно толкают изменения в вторичные узлы в порядке и гарантирует, что данные синхронизированы по крайней мере с одной вторичной репликой перед совершением каждой транзакции. Этот процесс гарантирует, что если первичный узла выходит из строя по какой-либо причине, всегда есть полностью синхронизированный узла, чтобы не перейти к. Сбой инициирован тканью службы Azure. Как только вторичная реплика становится новым первичным узлам, создается еще одна второстепенная реплика, чтобы обеспечить кластер достаточно мулям (набор кворума). После завершения сбоя соединения S'L автоматически перенаправляются на новый основной узл.

В качестве дополнительного преимущества, модель доступности премиум включает в себя возможность перенаправить только для чтения соединения S'L на одну из вторичных реплик. Эта функция называется [Read Scale-Out](sql-database-read-scale-out.md). Он обеспечивает 100% дополнительную вычислительную емкость без дополнительной платы для разгрузки только для чтения операций, таких как аналитические рабочие нагрузки, от первичной реплики.

## <a name="hyperscale-service-tier-availability"></a>Доступность гипермасштабного уровня обслуживания

Архитектура уровня обслуживания Hyperscale описана в [архитектуре распределенных функций.](https://docs.microsoft.com/azure/sql-database/sql-database-service-tier-hyperscale#distributed-functions-architecture) 

![Гипермасштабная функциональная архитектура](./media/sql-database-hyperscale/hyperscale-architecture.png)

Модель доступности в Hyperscale включает в себя четыре слоя:

- Уровень вычислений без состояния, который запускает `sqlservr.exe` процессы и содержит только переходные и кэшированные данные, такие как непокрывающие кэш RBPEX, TempDB, база данных моделей и т.д. на присоединенном SSD и план кэш, буферный пул и пул столбцов в памяти. Этот слой без состояния включает в себя первичную реплику вычислений и опционально ряд вторичных вычислительных реплик, которые могут служить целями неудачи.
- Слой хранения без состояния, сформированный серверами страниц. Этот слой является распределенным `sqlservr.exe` механизмом хранения процессов, работающих на вычислительных репликах. Каждый сервер страницы содержит только переходные и кэшированные данные, такие как покрытие кэша RBPEX на прилагаемом SSD, а страницы данных, кэшированные в памяти. Каждый сервер страницы имеет парный сервер страницы в активной активной конфигурации, чтобы обеспечить балансировку нагрузки, избыточность и высокую доступность.
- Упорный слой хранения журналов транзакций, образованный вычислительным узлами, работающим в процессе службы журнала, зоне посадки журнала транзакций и долгосрочном хранении журнала транзакций. Зона посадки и долгосрочное хранение используют Azure Storage, который обеспечивает доступность и [избыточность](https://docs.microsoft.com/azure/storage/common/storage-redundancy) для журнала транзакций, обеспечивая долговечность данных для совершенных транзакций.
- Упорный уровень хранения данных с файлами базы данных (.mdf/.ndf), которые хранятся в Хранилище Azure и обновляются на страницах серверов. Этот слой использует функции доступности и [избыточности](https://docs.microsoft.com/azure/storage/common/storage-redundancy) данных хранилища Azure. Это гарантирует, что каждая страница в файле данных будет сохранена, даже если процессы в других слоях сбоя архитектуры Hyperscale или если вычислительные узлы выйдут из строя.

Вычислите узлы во всех слоях Hyperscale, запускаемых на Azure Service Fabric, который контролирует работоспособность каждого узла и при необходимости выполняет сбой доступных здоровых узлов.

Для получения дополнительной информации о высокой доступности в Hyperscale [см.](https://docs.microsoft.com/azure/sql-database/sql-database-service-tier-hyperscale#database-high-availability-in-hyperscale)

## <a name="zone-redundant-configuration"></a>Конфигурация с избыточностью в пределах зоны

По умолчанию кластер узлов для модели доступности премиум-класса создается в том же центре обработки данных. С введением [зон доступности Azure](../availability-zones/az-overview.md)база данных может размещать различные реплики базы данных бизнес-критиков в различных зонах доступности в одном регионе. Чтобы исключить единую точку сбоя, круг управления также дублируется в нескольких зонах в виде трех кругов шлюзов. Маршрутизацией для конкретного круга шлюза управляет [диспетчер трафика Azure](../traffic-manager/traffic-manager-overview.md) (ATM). Поскольку избыток конфигурации зоны в уровнях обслуживания Premium или Business Critical не создает дополнительной избыточности базы данных, можно включить ее без дополнительной платы. Выбрав излишую конфигурацию зоны, можно сделать базы данных Premium или Business Critical устойчивыми к гораздо большему набору сбоев, включая катастрофические перебои в работе центра обработки данных, без каких-либо изменений в логике приложения. Можно также преобразовать любые существующие базы данных или пулы уровня "Премиум" или "Критически важный для бизнеса" в конфигурацию с избыточностью в пределах зоны.

Поскольку избыточные базы данных зон имеют реплики в различных центрах обработки данных с некоторым расстоянием между ними, увеличение задержки сети может увеличить время совершения и тем самым повлиять на производительность некоторых рабочих нагрузок OLTP. Вы всегда можете вернуться к конфигурации с одной зоной, отключив параметр избыточности в пределах зоны. Этот процесс представляет собой онлайн-операцию, аналогичную обычному обновлению уровня обслуживания. В конце этого процесса база данных или пул переносится из круга с избыточностью в пределах зоны в круг с одной зоной, или наоборот.

> [!IMPORTANT]
> Избыточные базы данных зон и эластичные пулы в настоящее время поддерживаются только в уровнях обслуживания Premium и Business Critical в некоторых регионах. При использовании уровня Business Critical избыток избыточной конфигурации зоны доступен только при выборе вычислительного оборудования Gen5. Для получения актуальной информации об регионах, поддерживающих [Services support by region](../availability-zones/az-overview.md#services-support-by-region)избыточные базы данных зон, см.  
> Эта функция недоступна в примере Управляемых.

На следующей схеме показана версия архитектуры с высоким уровнем доступности и избыточностью в пределах зоны.

![Архитектура с высоким уровнем доступности и избыточностью в пределах зоны](./media/sql-database-high-availability/zone-redundant-business-critical-service-tier.png)

## <a name="accelerated-database-recovery-adr"></a>Ускоренное восстановление базы данных (ADR)

[Ускоренное восстановление базы данных (ADR)](sql-database-accelerated-database-recovery.md) — это новая функция движка базы данных S'L, которая значительно повышает доступность баз данных, особенно при наличии длительных транзакций. В настоящее время функция ADR доступна для отдельных баз данных, эластичных пулов и Хранилища данных SQL Azure.

## <a name="testing-application-fault-resiliency"></a>Тестирование устойчивости неисправностей приложения

Высокая доступность является фундаментальной частью платформы базы данных Azure S'L Database, которая работает прозрачно для приложения базы данных. Тем не менее, мы признаем, что вы можете проверить, как автоматические операции сбоя, начатые во время запланированных или незапланированных событий, повлияют на приложение перед развертыванием его в производство. Вы можете вызвать специальный API для перезапуска базы данных или эластичного пула, что, в свою очередь, вызовет сбой. В случае избыточной базы данных зоны или эластичного пула вызов API приведет к перенаправлению клиентских подключений к новой основной в зоне доступности, отличающейся от зоны доступности старого элемента. Таким образом, в дополнение к тестированию того, как сбой влияет на существующие сеансы базы данных, можно также проверить, изменяет ли он сквозную производительность из-за изменений в задержке сети. Поскольку операция перезагрузки является интрузивной и большое число из них может подчеркнуть платформу, каждые 30 минут разрешается только один вызов для выполнения перезапуска для каждой базы данных или эластичного пула. 

Сбой может быть инициирован с помощью REST API или PowerShell. Для REST API см. [Сбой базы данных](https://docs.microsoft.com/rest/api/sql/databases(failover)/failover) и [отказ в упругом пуле.](https://docs.microsoft.com/rest/api/sql/elasticpools(failover)/failover) Для PowerShell, [см. Invoke-AzSqlDatabaseFailover](https://docs.microsoft.com/powershell/module/az.sql/invoke-azsqldatabasefailover) и [Invoke-AzSqlElasticPoolFailover](https://docs.microsoft.com/powershell/module/az.sql/invoke-azsqlelasticpoolfailover). Вызовы REST API также могут быть сделаны из Azure CLI с помощью команды [az rest.](https://docs.microsoft.com/cli/azure/reference-index?view=azure-cli-latest#az-rest)

> [!IMPORTANT]
> Команда Failover в настоящее время недоступна на уровне службы Hyperscale и в управляемом экземпляре.

## <a name="conclusion"></a>Заключение

База данных Azure S'L имеет встроенное решение с высокой доступностью, которое глубоко интегрировано с платформой Azure. Он зависит от системы обслуживания для обнаружения и восстановления сбоев, от хранения Azure Blob для защиты данных и от зон доступности для более высокой допуски к неисправности. Кроме того, база данных Azure S'L использует технологию Always On Availability Group с сервера S'L Для репликации и сбоя. Сочетание этих технологий позволяет приложениям в полной мере реализовать преимущества смешанной модели хранения данных и поддерживать самые требовательные SL.

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте больше о [зонах доступности Azure](../availability-zones/az-overview.md).
- Узнайте больше о [сервисной ткани](../service-fabric/service-fabric-overview.md)
- Дополнительные сведения о [диспетчере трафика Azure](../traffic-manager/traffic-manager-overview.md).
- Чтобы изучить дополнительные возможности обеспечения высокой доступности и аварийного восстановления, ознакомьтесь с [непрерывностью бизнес-процессов](sql-database-business-continuity.md).
