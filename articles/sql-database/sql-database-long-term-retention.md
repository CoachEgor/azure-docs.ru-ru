---
title: Долгосрочное хранение резервных копий
description: Узнайте, как база данных Azure S'L поддерживает хранение полных резервных данных на срок до 10 лет с помощью долгосрочной политики удержания.
services: sql-database
ms.service: sql-database
ms.subservice: backup-restore
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: anosov1960
ms.author: sashan
ms.reviewer: mathoma, carlrab
ms.date: 05/18/2019
ms.openlocfilehash: d015eea21bcfa499d6751e024a882a7316b7f1a5
ms.sourcegitcommit: ea006cd8e62888271b2601d5ed4ec78fb40e8427
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81380765"
---
# <a name="azure-sql-database-long-term-retention"></a>Принципы работы долгосрочного хранения базы данных SQL

В соответствии с нормативными требованиями, стандартами соответствия или бизнес-задачами многие приложения должны хранить резервные копии баз данных более 7–35 дней, то есть дольше, чем при [автоматическом резервном копировании](sql-database-automated-backups.md) базы данных SQL Azure. Используя функцию долгосрочного удержания (LTR), вы можете хранить в хранилище данных Azure Blob полные резервные копии базы данных S'L с георезервным хранилищем для чтения доступа на срок до 10 лет. Впоследствии любую резервную копию можно восстановить как новую базу данных. Для получения дополнительной информации об избыточности хранилища Azure [см.](../storage/common/storage-redundancy.md) 

Длительное время хранения может быть включено для отдельных и объединенных баз данных, и в ограниченном общедоступном предварительном просмотре для экземпляров управляемых баз данных Azure S'L. 

> [!NOTE]
> Задания агентов SQL можно использовать для планирования [резервных копий только для копирования базы данных](https://docs.microsoft.com/sql/relational-databases/backup-restore/copy-only-backups-sql-server) как альтернативу LTR за 35 дней.


## <a name="how-sql-database-long-term-retention-works"></a>Принципы работы долгосрочного хранения базы данных SQL

При долгосрочном хранении (LTR) резервных копий используются полные резервные копии базы данных, которые [создаются автоматически](sql-database-automated-backups.md) для восстановления до точки во времени (PITR). Если настроена политика LTR, эти резервные копии копируются в различные капли для долгосрочного хранения. Копия — это фоновое задание, которое не влияет на рабочую нагрузку базы данных. Политика LTR для каждой базы данных S'L также может указывать, как часто создаются резервные отсылки LTR.

Для включения LTR можно определить политику, используя комбинацию из четырех параметров: еженедельное сохранение резервного копирования (W), ежемесячное сохранение резервного копирования (M), ежегодное сохранение резервного копирования (Y) и неделя года (WeekOfYear). Если указать W, одна резервная копия каждую неделю будет копироваться для долгосрочного хранения. Если указать M, первая резервная копия каждого месяца будет скопирована на долгосрочное хранение. Если указать Y, одна резервная копия в течение недели года, указанной в параметре WeekOfYear, копируется для долгосрочного хранения. Если указанный WeekOfYear находится в прошлом, когда настроена политика, первая резервная поддержка LTR будет создана в следующем году. Каждое резервное копирование будет храниться в долгосрочном хранилище в соответствии с параметрами политики, настроенных при создании резервного копирования LTR.

> [!NOTE]
> Любое изменение политики LTR распространяется только на будущие резервные копирования. Например, если еженедельное сохранение резервного копирования (W), ежемесячное сохранение резервного копирования (M) или ежегодное сохранение резервного копирования (Y) изменяется, новая настройка удержания будет применяться только к новым резервным капотам. Сохранение существующих резервных ups не будет изменено. Если вы намереваетесь удалить старые резервные копирования LTR до истечения срока их хранения, вам нужно будет [вручную удалить резервные жидкости.](https://docs.microsoft.com/azure/sql-database/sql-database-long-term-backup-retention-configure#delete-ltr-backups)
> 

Примеры политики LTR:

-  W = 0, M = 0, Y = 5, WeekOfYear = 3

   Третий полный резервный отправления каждый год будет храниться в течение пяти лет.
   
- W = 0, M = 3, Y = 0

   Первая полная резервная часть каждого месяца будет храниться в течение трех месяцев.

- W = 12, M = 0, Y = 0

   Каждая полная недельная резервная копия хранится в течение 12 недель.

- W = 6, M = 12, Y = 10, WeekOfYear = 16

   Каждая еженедельная полная резервная часть будет храниться в течение шести недель. За исключением первой полной месячной резервной копии, которая подлежит хранению в течение 12 месяцев. За исключением полной резервной копии, сделанной на 16-ю неделю года, которая подлежит хранению в течение 10 лет. 

В следующей таблице приведена периодичность и сроки долгосрочного хранения резервных копий согласно следующей политике:

W = 12 недель (84 дня), M = 12 месяцев (365 дней), Y = 10 лет (3650 дней), WeekOfYear = 15 (неделя после 15 апреля)

   ![Пример долгосрочного хранения](./media/sql-database-long-term-retention/ltr-example.png)



Если вы измените приведенную выше политику и установите W'0 (нет еженедельных резервных копий), каденция резервных копий изменится, как показано в приведенной выше таблице, по выделенным датам. Объем хранилища, необходимый для хранения этих резервных копий, сократится соответственно. 

> [!IMPORTANT]
> Время отдельных резервных отправления LTR контролируется базой данных Azure S'L. Вы не можете вручную создать резервное копирование LTR или управлять временем создания резервного копирования. После настройки политики LTR может пройти до 7 дней, прежде чем первая резервная поддержка LTR появится в списке доступных резервных ups.  
> 

## <a name="geo-replication-and-long-term-backup-retention"></a>Георепликация и долгосрочное хранение резервных копий

Если вы используете активные группы георепликации или неудачных программ в качестве решения для непрерывности бизнеса, следует подготовиться к возможным неудачам и настроить ту же политику LTR в геовторичную базу данных. Стоимость хранения LTR не увеличится, так как резервные копии не генерируются из второстепенных. Резервные копии будут создаваться только когда вторичная база данных становится первичной. Это обеспечивает бесперебойное генерирующее резервное копирование LTR при срабатывании и первичном переходе во второстепенный регион. 

> [!NOTE]
> Когда исходная первичная база данных восстанавливается после сбоя, вызвавшего сбой, она станет новой вторичной. Таким образом создание резервной копии не будет возобновлено, и существующая политика LTR не вступит в силу, пока она снова станет первичной. 

## <a name="managed-instance-support"></a>Поддержка Управляемого экземпляра

Использование долгосрочного удержания резервного копирования с помощью управляемых экземпляров базы данных Azure S'L имеет следующие ограничения:

- **Ограниченный публичный предварительный просмотр** - Этот предварительный просмотр доступен только для подписок EA и CSP и ограничен в наличии.  
- [**PowerShell только**](sql-database-managed-instance-long-term-backup-retention-configure.md) - В настоящее время нет поддержки портала Azure. LTR должен быть включен с помощью PowerShell. 

Чтобы запросить регистрацию, создайте [билет поддержки Azure](https://azure.microsoft.com/support/create-ticket/) под темой поддержки **Резервное копирование, восстановление и непрерывность бизнеса / Долгосрочное сохранение резервного копирования.**


## <a name="configure-long-term-backup-retention"></a>Настройка долгосрочного хранения резервных копий

Чтобы узнать, как настроить долгосрочное удержание с помощью портала Azure или PowerShell, [см.](sql-database-long-term-backup-retention-configure.md)

## <a name="restore-database-from-ltr-backup"></a>Восстановление базы данных из резервного копирования LTR

Восстановление базы данных из хранилища долгосрочного хранения (LTR) можно выполнить, выбрав необходимую резервную копию по метке времени. Базу данных можно восстановить на любой доступный сервер с той же подпиской, что и у исходной базы данных. Чтобы узнать, как восстановить базу данных из резервного копирования LTR, с помощью портала Azure или PowerShell, [см.](sql-database-long-term-backup-retention-configure.md)

## <a name="next-steps"></a>Следующие шаги

Поскольку резервные копии базы данных защищают данные от случайного повреждения или удаления, они являются важной частью любой стратегии непрерывности бизнес-процессов и аварийного восстановления. Дополнительные сведения о других решениях для базы данных SQL, обеспечивающих непрерывность бизнес-процессов, см. в статье [Обзор обеспечения непрерывности бизнес-процессов с помощью базы данных SQL Azure](sql-database-business-continuity.md).
