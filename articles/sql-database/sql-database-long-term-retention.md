---
title: Хранение резервных копий базы данных SQL Azure до 10 лет | Документы Майкрософт
description: Узнайте, как база данных SQL Azure поддерживает хранение полных резервных копий базы данных в течение 10 лет.
services: sql-database
ms.service: sql-database
ms.subservice: backup-restore
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: anosov1960
ms.author: sashan
ms.reviewer: mathoma, carlrab
manager: craigg
ms.date: 04/23/2019
ms.openlocfilehash: 0f764ebbad53185f46c7166011e05493ed261d6a
ms.sourcegitcommit: 44a85a2ed288f484cc3cdf71d9b51bc0be64cc33
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "64696643"
---
# <a name="store-azure-sql-database-backups-for-up-to-10-years"></a>Хранение резервных копий базы данных SQL Azure до 10 лет

В соответствии с нормативными требованиями, стандартами соответствия или бизнес-задачами многие приложения должны хранить резервные копии баз данных более 7–35 дней, то есть дольше, чем при [автоматическом резервном копировании](sql-database-automated-backups.md) базы данных SQL Azure. Используя возможность долгосрочного хранения (LTR), можно хранить полные резервные копии указанной базы данных SQL в хранилище BLOB-объектов [RA-GRS](../storage/common/storage-redundancy-grs.md#read-access-geo-redundant-storage) сроком до 10 лет. Впоследствии любую резервную копию можно восстановить как новую базу данных.

> [!NOTE]
> LTR можно включать для отдельных и находящихся в пуле баз данных. Эта функция пока недоступна для баз данных экземпляров в управляемых экземплярах. Задания агентов SQL можно использовать для планирования [резервных копий только для копирования базы данных](https://docs.microsoft.com/sql/relational-databases/backup-restore/copy-only-backups-sql-server) как альтернативу LTR за 35 дней.
> 

## <a name="how-sql-database-long-term-retention-works"></a>Принципы работы долгосрочного хранения базы данных SQL

При долгосрочном хранении (LTR) резервных копий используются полные резервные копии базы данных, которые [создаются автоматически](sql-database-automated-backups.md) для восстановления до точки во времени (PITR). Если настройки политики LTR эти резервные копии копируются в различных больших двоичных объектов для долговременного хранения. Операция копирования не фоновое задание, которое никак не влияет на производительность рабочей нагрузки базы данных. Резервных копий LTR, сохраняются в течение времени, установленного с помощью политики LTR. Политики LTR для каждой базы данных SQL можно также указать, как часто создаются резервные копии LTR. Для обеспечения подобной гибкости можно определить политику с помощью комбинации четырех параметров: еженедельное хранение резервных копий (W), ежемесячные хранения резервных копий (M), ежегодное хранение резервных копий (Y) и неделя года (WeekOfYear). Если указать W, одна резервная копия каждую неделю будет копироваться для долгосрочного хранения. Если указать M, в первую неделю каждого месяца одна резервная копия копируется для долгосрочного хранения. Если указать Y, одна резервная копия в течение недели года, указанной в параметре WeekOfYear, копируется для долгосрочного хранения. Каждая резервная копия хранится в хранилище долгосрочного хранения в течение срока, заданного в соответствующих параметрах. Любое изменение политики LTR применяется для будущих архиваций. Например если указанный WeekOfYear находится в прошлом, когда политика настроена, первой резервной копии LTR будет создан следующий год. 

Примеры политики LTR.

-  W = 0, M = 0, Y = 5, WeekOfYear = 3

   Третий полная резервная копия каждого года будет хранится в течение пяти лет.
   
- W = 0, M = 3, Y = 0

   Первой полной резервной копии каждый месяц будут храниться в течение трех месяцев.

- W = 12, M = 0, Y = 0

   Каждая полная недельная резервная копия хранится в течение 12 недель.

- W = 6, M = 12, Y = 10, WeekOfYear = 16

   Каждая полная Недельная резервная копия хранится в течение шести недель. За исключением первой полной месячной резервной копии, которая подлежит хранению в течение 12 месяцев. За исключением полной резервной копии, сделанной на 16-ю неделю года, которая подлежит хранению в течение 10 лет. 

В следующей таблице приведена периодичность и сроки долгосрочного хранения резервных копий согласно следующей политике:

W = 12 недель (84 дня), M = 12 месяцев (365 дней), Y = 10 лет (3650 дней), WeekOfYear = 15 (неделя после 15 апреля)

   ![Пример долгосрочного хранения](./media/sql-database-long-term-retention/ltr-example.png)



Если изменить приведенную выше политику и W = 0 (Отмена еженедельных резервных копий), периодичность набор резервных копий изменятся, как показано в приведенной выше таблице на указанные сроки. Объем хранилища, необходимый для хранения этих резервных копий, сократится соответственно. 

> [!NOTE]
> База данных SQL Azure управляет временем отдельных резервных копий LTR. Нельзя вручную создать резервную копию LTR или управлять временем создания резервной копии.
> 

## <a name="geo-replication-and-long-term-backup-retention"></a>Георепликация и долгосрочное хранение резервных копий

При использовании активной георепликации или группы отработки отказа, как решения, следует подготовиться к итоговой отработки отказа и настроить одну и ту же политику LTR на базе данных-получателя георепликации. Стоимость хранилища LTR не увеличивается по мере резервные копии не создаются из баз данных-получателей. Резервные копии будут создаваться только когда вторичная база данных становится первичной. Это гарантирует создание резервных копий LTR не прерывается, при отработка отказа и перемещается в дополнительном регионе. 

> [!NOTE]
> При исходной базы данных-источника восстанавливается после сбоя, который вызвал отработку отказа, то он становится новым получателем. Таким образом создание резервной копии не будет возобновлено, и существующая политика LTR не вступит в силу, пока она снова станет первичной. 

## <a name="configure-long-term-backup-retention"></a>Настройка долгосрочного хранения резервных копий

Сведения о настройке долгосрочного хранения с помощью портала Azure или PowerShell, см. в разделе [долгосрочного хранения резервных копий базы данных SQL Azure управлять](sql-database-long-term-backup-retention-configure.md).

## <a name="restore-database-from-ltr-backup"></a>Восстановление базы данных из резервной копии LTR

Восстановление базы данных из хранилища долгосрочного хранения (LTR) можно выполнить, выбрав необходимую резервную копию по метке времени. Базу данных можно восстановить на любой доступный сервер с той же подпиской, что и у исходной базы данных. Чтобы узнать, как восстановить базу данных из резервной копии LTR, с помощью портала Azure или PowerShell, см. в разделе [долгосрочного хранения резервных копий базы данных SQL Azure управлять](sql-database-long-term-backup-retention-configure.md).

## <a name="next-steps"></a>Дальнейшие действия

Поскольку резервные копии базы данных защищают данные от случайного повреждения или удаления, они являются важной частью любой стратегии непрерывности бизнес-процессов и аварийного восстановления. Дополнительные сведения о других решениях для базы данных SQL, обеспечивающих непрерывность бизнес-процессов, см. в статье [Обзор обеспечения непрерывности бизнес-процессов с помощью базы данных SQL Azure](sql-database-business-continuity.md).
