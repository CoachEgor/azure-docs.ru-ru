---
title: Хранение резервных копий базы данных SQL Azure до 10 лет
description: Узнайте, как база данных SQL Azure поддерживает хранение полных резервных копий базы данных в течение 10 лет.
services: sql-database
ms.service: sql-database
ms.subservice: backup-restore
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: anosov1960
ms.author: sashan
ms.reviewer: mathoma, carlrab
ms.date: 05/18/2019
ms.openlocfilehash: 5d6f0797802a622ada1916752bc35c1bae2cde9f
ms.sourcegitcommit: 609d4bdb0467fd0af40e14a86eb40b9d03669ea1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/06/2019
ms.locfileid: "73689517"
---
# <a name="store-azure-sql-database-backups-for-up-to-10-years"></a>Хранение резервных копий базы данных SQL Azure до 10 лет

В соответствии с нормативными требованиями, стандартами соответствия или бизнес-задачами многие приложения должны хранить резервные копии баз данных более 7–35 дней, то есть дольше, чем при [автоматическом резервном копировании](sql-database-automated-backups.md) базы данных SQL Azure. Используя возможность долгосрочного хранения (LTR), можно хранить полные резервные копии указанной базы данных SQL в хранилище BLOB-объектов [RA-GRS](../storage/common/storage-redundancy-grs.md#read-access-geo-redundant-storage) сроком до 10 лет. Впоследствии любую резервную копию можно восстановить как новую базу данных.

> [!NOTE]
> LTR можно включать для отдельных баз данных и баз данных в пуле. Эта функция пока недоступна для баз данных экземпляров в управляемых экземплярах. Задания агентов SQL можно использовать для планирования [резервных копий только для копирования базы данных](https://docs.microsoft.com/sql/relational-databases/backup-restore/copy-only-backups-sql-server) как альтернативу LTR за 35 дней.
> 

## <a name="how-sql-database-long-term-retention-works"></a>Принципы работы долгосрочного хранения базы данных SQL

При долгосрочном хранении (LTR) резервных копий используются полные резервные копии базы данных, которые [создаются автоматически](sql-database-automated-backups.md) для восстановления до точки во времени (PITR). Если настроена политика LTR, эти резервные копии копируются в разные большие двоичные объекты для долгосрочного хранения. Операция копирования является фоновым заданием, которое не влияет на производительность рабочей нагрузки базы данных. Резервные копии на LTR хранятся в течение периода времени, установленного политикой LTR. Политика LTR для каждой базы данных SQL также может указывать, как часто создаются резервные копии LTR. Чтобы обеспечить такую гибкость, можно определить политику, используя сочетание четырех параметров: еженедельное хранение резервных копий (W), ежемесячное хранение резервных копий (M), ежегодное хранение резервных копий (Y) и неделю года (WeekOfYear). Если указать W, одна резервная копия каждую неделю будет копироваться для долгосрочного хранения. Если указать M, в первую неделю каждого месяца одна резервная копия копируется для долгосрочного хранения. Если указать Y, одна резервная копия в течение недели года, указанной в параметре WeekOfYear, копируется для долгосрочного хранения. Каждая резервная копия хранится в хранилище долгосрочного хранения в течение срока, заданного в соответствующих параметрах. Любое изменение политики LTR применяется к будущим резервным копиям. Например, если указанное значение WeekOfYear находится в прошлом при настройке политики, то в следующем году будет создана первая резервная копия LTR. 

Примеры политики LTR:

-  W = 0, M = 0, Y = 5, WeekOfYear = 3

   Третья полная резервная копия каждого года будет храниться в течение пяти лет.
   
- W = 0, M = 3, Y = 0

   Первая полная резервная копия каждого месяца будет храниться в течение трех месяцев.

- W = 12, M = 0, Y = 0

   Каждая полная недельная резервная копия хранится в течение 12 недель.

- W = 6, M = 12, Y = 10, WeekOfYear = 16

   Каждая еженедельная полная резервная копия будет храниться в течение шести недель. За исключением первой полной месячной резервной копии, которая подлежит хранению в течение 12 месяцев. За исключением полной резервной копии, сделанной на 16-ю неделю года, которая подлежит хранению в течение 10 лет. 

В следующей таблице приведена периодичность и сроки долгосрочного хранения резервных копий согласно следующей политике:

W = 12 недель (84 дня), M = 12 месяцев (365 дней), Y = 10 лет (3650 дней), WeekOfYear = 15 (неделя после 15 апреля)

   ![Пример долгосрочного хранения](./media/sql-database-long-term-retention/ltr-example.png)



Если изменить указанную выше политику и установить W = 0 (без еженедельных резервных копий), ритмичность резервных копий изменится, как показано в приведенной выше таблице на выделенные даты. Объем хранилища, необходимый для хранения этих резервных копий, сократится соответственно. 

> [!IMPORTANT]
> Время создания отдельных резервных копий на LTR управляется базой данных SQL Azure. Нельзя вручную создать резервную копию LTR или управлять временем создания резервной копии. После настройки политики LTR может пройти до 7 дней, прежде чем первая резервная копия будет отображаться в списке доступных резервных копий.  
> 

## <a name="geo-replication-and-long-term-backup-retention"></a>Георепликация и долгосрочное хранение резервных копий

Если вы используете активную георепликацию или группы отработки отказа в качестве решения непрерывности бизнес-процессов, необходимо подготовиться к окончательным переходам на другой ресурс и настроить ту же политику LTR в базе данных Geo-Secondary. Стоимость хранения на LTR не увеличится, так как резервные копии не будут создаваться из баз данных-получателей. Резервные копии будут создаваться только когда вторичная база данных становится первичной. Он обеспечивает непрерванное создание резервных копий на LTR, когда запускается отработка отказа и основное перемещение в дополнительный регион. 

> [!NOTE]
> Когда исходная база данных-источник восстанавливается из-за сбоя, вызвавшего отработку отказа, он становится новым получателем. Таким образом создание резервной копии не будет возобновлено, и существующая политика LTR не вступит в силу, пока она снова станет первичной. 

## <a name="configure-long-term-backup-retention"></a>Настройка долгосрочного хранения резервных копий

Сведения о настройке долгосрочного хранения с помощью портал Azure или PowerShell см. в статье [Управление долгосрочным хранением резервных копий базы данных SQL Azure](sql-database-long-term-backup-retention-configure.md).

## <a name="restore-database-from-ltr-backup"></a>Восстановление базы данных из резервной копии слева направо

Восстановление базы данных из хранилища долгосрочного хранения (LTR) можно выполнить, выбрав необходимую резервную копию по метке времени. Базу данных можно восстановить на любой доступный сервер с той же подпиской, что и у исходной базы данных. Сведения о восстановлении базы данных из резервной копии LTR с помощью портал Azure или PowerShell см. в статье [Управление долгосрочным хранением резервных копий базы данных SQL Azure](sql-database-long-term-backup-retention-configure.md).

## <a name="next-steps"></a>Дальнейшие действия

Поскольку резервные копии базы данных защищают данные от случайного повреждения или удаления, они являются важной частью любой стратегии непрерывности бизнес-процессов и аварийного восстановления. Дополнительные сведения о других решениях для базы данных SQL, обеспечивающих непрерывность бизнес-процессов, см. в статье [Обзор обеспечения непрерывности бизнес-процессов с помощью базы данных SQL Azure](sql-database-business-continuity.md).
