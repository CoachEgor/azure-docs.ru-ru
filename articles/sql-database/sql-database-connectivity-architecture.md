---
title: Архитектура связи
description: В этом документе объясняется архитектура подключения Azure S'L для подключения к базе данных из Azure или за пределами Azure.
services: sql-database
ms.service: sql-database
ms.subservice: development
ms.custom: fasttrack-edit
titleSuffix: Azure SQL Database and SQL Data Warehouse
ms.devlang: ''
ms.topic: conceptual
author: rohitnayakmsft
ms.author: rohitna
ms.reviewer: carlrab, vanto
ms.date: 03/09/2020
ms.openlocfilehash: 2028aac9c01aedc4baa568d370c9f7d21c920647
ms.sourcegitcommit: b80aafd2c71d7366838811e92bd234ddbab507b6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81419269"
---
# <a name="azure-sql-connectivity-architecture"></a>Архитектура подключения к SQL Azure
> [!NOTE]
> Эта статья относится к Azure SQL Server, а также к базам данных SQL и хранилища данных SQL, создаваемым на сервере SQL Azure. Для простоты база данных SQL используется как для базы данных SQL, так и для хранилища данных SQL.

> [!IMPORTANT]
> Эта статья *не* относится к **Управляемому экземпляру Базы данных SQL Azure**. Обратитесь к [архитектуре Connectivity для управляемого экземпляра.](sql-database-managed-instance-connectivity-architecture.md)

В этой статье объясняется архитектура различных компонентов, которые направляют сетевой трафик в базу данных Azure S'L или хранилище данных S'L. В нем также объясняются различные политики подключения и влияние на клиентов, подключенных из Azure, и клиентов, подключенных из-за пределов Azure. 

## <a name="connectivity-architecture"></a>Архитектура подключения

На следующей схеме показана общая архитектура подключений к базе данных SQL Azure.

![Общий вид архитектуры](./media/sql-database-connectivity-architecture/connectivity-overview.png)

Следующие шаги описывают, как установить подключение к базе данных SQL Azure:

- Клиенты подключаются к шлюзу, который использует общедоступный IP-адрес и ожидает передачи данных через порт 1433.
- Шлюз, в зависимости от действующей политики подключения, перенаправляет или проксирует трафик к правильному кластеру баз данных.
- В кластере баз данных трафик перенаправляется в соответствующую базу данных SQL Azure.

## <a name="connection-policy"></a>Политика подключения

База данных SQL Azure поддерживает следующие три варианта для параметра политики подключения сервера Базы данных SQL.

- **Перенаправление (рекомендуется):** Клиенты устанавливают соединения непосредственно с узлами, размещаемыми в базе данных, что приводит к снижению задержки и улучшению пропускной связи. Для подключения для использования этого режима, клиенты должны:
   - Разрешить исходящие сообщения от клиента на все IP-адреса Azure S'L в регионе в портах в диапазоне 11000 11999. Для облегчения управления используйте теги служб для S'L.  
   - Разрешить исходящие сообщения от клиента до IP-адресов шлюза шлюза базы данных Azure S'L на порту 1433.

- **Прокси:** В этом режиме все соединения проксируются через шлюзы базы данных Azure S'L Database, что приводит к увеличению задержки и уменьшенной пропускной связи. Для использования этого режима соединениями клиентам необходимо разрешить исходящие коммуникации от клиента до IP-адресов шлюза базы данных Azure S'L на порте 1433.

- **По умолчанию:** Это политика подключения, дейная на всех серверах после создания, `Proxy` `Redirect`если вы явно не измените политику соединения на любой или . Политика по`Redirect` умолчанию предназначена для всех клиентских соединений, происходящих внутри `Proxy`Azure (например, из виртуальной машины Azure) и для всех клиентских соединений, происходящих извне (например, соединения с локальной рабочей станции).

 Мы настоятельно `Redirect` рекомендуем политику `Proxy` подключения по политике подключения для самой низкой задержки и самой высокой пропускной связи. Тем не менее, вам нужно будет выполнить дополнительные требования для обеспечения сетевого трафика, как указано выше. Если клиент является виртуальной машиной Azure, вы можете сделать это с помощью групп сетевой безопасности (NSG) с [тегами обслуживания.](../virtual-network/security-overview.md#service-tags) Если клиент подключается к рабочей станции на месте, то вам может понадобиться работать с вашим веб-админ, чтобы сетевой трафик через корпоративный брандмауэр.

## <a name="connectivity-from-within-azure"></a>Подключение из Azure

Для подключений из Azure по умолчанию действует политика подключения `Redirect`. Политика подключения `Redirect` означает, что после установления сеанса TCP с базой данных SQL Azure сеанс клиента перенаправляется в правильный кластер баз данных с измененным виртуальным IP-адресом назначения, то есть вместо адреса шлюза Базы данных SQL Azure указывается адрес кластера. После этого все последующие пакеты передаются непосредственно через кластер, минуя шлюз Базы данных SQL Azure. Этот поток трафика представлен на схеме ниже.

![Общий вид архитектуры](./media/sql-database-connectivity-architecture/connectivity-azure.png)

## <a name="connectivity-from-outside-of-azure"></a>Подключение извне Azure

Для подключений извне Azure по умолчанию действует политика подключения `Proxy`. Политика `Proxy` означает, что устанавливается сеанс TCP через шлюз Базы данных SQL Azure и все последующие пакеты проходят через этот шлюз. Этот поток трафика представлен на схеме ниже.

![Общий вид архитектуры](./media/sql-database-connectivity-architecture/connectivity-onprem.png)

> [!IMPORTANT]
> Дополнительно открытые порты 14000-14999, чтобы [соединиться с DAC](https://docs.microsoft.com/sql/database-engine/configure-windows/diagnostic-connection-for-database-administrators?view=sql-server-2017#connecting-with-dac)


## <a name="azure-sql-database-gateway-ip-addresses"></a>IP-адреса шлюза Базы данных SQL Azure

В таблице ниже перечислены IP-адреса шлюзов по регионам. Для подключения к базе данных Azure S'L необходимо разрешить сетевому трафику & со **всех** шлюзов в регионе.

Подробная информация о том, как трафик должен быть перенесен на новые шлюзы в определенных регионах, приведена в следующей статье: [миграция трафика базы данных Azure S'L на новые шлюзы](sql-database-gateway-migration.md)


| Имя региона          | IP-адреса шлюза |
| --- | --- |
| Центральная Австралия    | 20.36.105.0 |
| Австралия Сентрал2   | 20.36.113.0 |
| Восточная Австралия       | 13.75.149.87, 40.79.161.1 |
| Юго-Восточная Австралия | 191.239.192.109, 13.73.109.251 |
| Южная Бразилия         | 104.41.11.5, 191.233.200.14 |
| Центральная Канада       | 40.85.224.249      |
| Восточная Канада          | 40.86.226.166      |
| Центральная часть США           | 13.67.215.62, 52.182.137.15, 23.99.160.139, 104.208.16.96, 104.208.21.1 | 
| Восточный Китай           | 139.219.130.35     |
| Восточный Китай 2         | 40.73.82.1         |
| Северный Китай          | 139.219.15.17      |
| Северный Китай 2        | 40.73.50.0         |
| Восточная Азия            | 191.234.2.139, 52.175.33.150, 13.75.32.4 |
| Восточная часть США              | 40.121.158.30, 40.79.153.12, 191.238.6.43, 40.78.225.32 |
| восточная часть США 2            | 40.79.84.180, 52.177.185.181, 52.167.104.0, 191.239.224.107, 104.208.150.3 | 
| Центральная Франция       | 40.79.137.0, 40.79.129.1 |
| Центральная Германия      | 51.4.144.100       |
| Северо-восточная Германия   | 51.5.144.179       |
| Центральная Индия        | 104.211.96.159     |
| Южная Индия          | 104.211.224.146    |
| Западная Индия           | 104.211.160.80     |
| Восточная Япония           | 13.78.61.196, 40.79.184.8, 13.78.106.224, 191.237.240.43, 40.79.192.5 | 
| Западная Япония           | 104.214.148.156, 40.74.100.192, 191.238.68.11, 40.74.97.10 | 
| Республика Корея, центральный регион        | 52.231.32.42       |
| Республика Корея, южный регион          | 52.231.200.86      |
| Центрально-северная часть США     | 23.96.178.199, 23.98.55.75, 52.162.104.33 |
| Северная Европа         | 40.113.93.91, 191.235.193.75, 52.138.224.1 | 
| Восточная Норвегия;          | 51.120.96.0        |
| Норвегия Запад          | 51.120.216.0       |
| Северная часть ЮАР;   | 102.133.152.0      |
| Западная часть Африки    | 102.133.24.0       |
| Центрально-южная часть США     | 13.66.62.124, 23.98.162.75, 104.214.16.32   | 
| Юго-Восточная Азия      | 104.43.15.0, 23.100.117.95, 40.78.232.3   | 
| Центральная часть ОАЭ.          | 20.37.72.64        |
| Северная часть ОАЭ;            | 65.52.248.0        |
| южная часть Соединенного Королевства             | 51.140.184.11      |
| западная часть Соединенного Королевства              | 51.141.8.11        |
| центрально-западная часть США      | 13.78.145.25       |
| Западная Европа          | 40.68.37.158, 191.237.232.75, 104.40.168.105  |
| западная часть США              | 104.42.238.205, 23.99.34.75, 13.86.216.196   |
| западная часть США 2            | 13.66.226.202      |
|                      |                    |



## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о том, как изменить политику подключения Базы данных SQL Azure для сервера Базы данных SQL Azure, см. в статье о команде [conn-policy](https://docs.microsoft.com/cli/azure/sql/server/conn-policy).
- Сведения о поведении подключения к базе данных SQL Azure клиентов, использующих ADO.NET 4.5 или более поздней версии, см. в разделе [Порты для ADO.NET 4.5, отличные от порта 1433](sql-database-develop-direct-route-ports-adonet-v12.md).
- Общая информация о разработке приложений приведена в разделе [Обзор разработки приложений баз данных SQL](sql-database-develop-overview.md).
