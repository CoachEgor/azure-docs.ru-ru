---
title: Группы отработки отказа
description: Группы автоматической отработки отказа являются возможностью Базы данных SQL, которая позволяет управлять репликацией и автоматической или согласованной отработкой отказа группы баз данных на сервере Базы данных SQL или во всех базах данных в управляемом экземпляре.
services: sql-database
ms.service: sql-database
ms.subservice: high-availability
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: anosov1960
ms.author: sashan
ms.reviewer: mathoma, carlrab
ms.date: 2/10/2020
ms.openlocfilehash: 6d87d3373711d12df3f2cced26ef35ae951ad41e
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79269839"
---
# <a name="use-auto-failover-groups-to-enable-transparent-and-coordinated-failover-of-multiple-databases"></a>Использование групп автоматической отработки отказа для включения прозрачной и согласованной отработки отказа в нескольких базах данных

Группа автоматического отказа — это функция базы данных S'L, которая позволяет управлять репликацией и отказом группы баз данных на сервере базы данных S'L или всех баз данных в управляемом экземпляре в другой регион. Это декларативная абстракция поверх существующей [функции активной георепликации,](sql-database-active-geo-replication.md) предназначенная для упрощения развертывания и управления геореплицированными базами данных в масштабе. Вы можете запустить отработку отказа вручную или делегировать службе Базы данных SQL, используя определяемую пользователем политику. Последний вариант позволяет автоматически восстановить несколько связанных баз данных в дополнительном регионе после катастрофических сбоев или других незапланированных событий, которые приводят к полной или частичной потере доступности службы Базы данных SQL в основном регионе. Группа неудач может включать одну или несколько баз данных, обычно используемых одним и тем же приложением. Кроме того, клиенты могут использовать доступные для чтения базы данных-получатели для разгрузки рабочих нагрузок запросов, доступных только для чтения. Так как группы автоматической отработки отказа включают в себя несколько баз данных, базы данных необходимо настроить на сервере-источнике. Группы автоматической отработки отказа поддерживают репликацию всех баз данных в группе только на один сервер-получатель в другом регионе.

> [!NOTE]
> Если при работе с отдельными базами данных или с базами данных в пуле на сервере базы данных SQL вы хотите создать несколько вторичных реплик в одном или в разных регионах, используйте [активную георепликацию](sql-database-active-geo-replication.md). 

Во время работы с группами автоматической отработки отказа с политикой автоматической отработки отказа любой сбой, который влияет на одну или на несколько баз данных в группе, приведет к автоматической отработке отказа. Как правило, это инциденты, которые не могут быть самосмеятся встроенной автоматической высокой доступности операций. Примеры триггеров failover включают инцидент, вызванный кольцом арендатора или кольцом управления, который был отключен из-за утечки памяти ядра ОС на нескольких вычислительных узлах, или инцидент, вызванный тем, что один или несколько кольцев арендатора был отключен, потому что неправильный сетевой кабель был вырезан во время регулярного вывода из эксплуатации оборудования.  Для получения дополнительной [информации, см.](sql-database-high-availability.md)

Кроме того, группы автоматической отработки отказа предоставляют конечные точки прослушивателя только для чтения и для чтения-записи, которые во время отработки отказа не изменяются. Независимо от того, используете ли вы активацию вручную или автоматическую активацию отработки отказа, отработка отказа переключит все базы данных-получатели в группе в базу данных-источник. После выполнения автоматической отработки отказа базы данных запись DNS автоматически обновляется, чтобы перенаправить конечные точки в новый регион. Конкретные сведения о RPO и RTO можно найти в [обзоре обеспечения непрерывности бизнес-процессов](sql-database-business-continuity.md).

Во время работы с группами автоматической отработки отказа с политикой автоматической отработки отказа любой сбой, который влияет на базы данных на сервере Базы данных SQL или в управляемом экземпляре, приведет к автоматической отработки отказа. Управляйте группами автоматической отработки отказа используя:

- [Портал Azure](sql-database-implement-geo-distributed-database.md)
- [Azure CLI: Failover Group](scripts/sql-database-add-single-db-to-failover-group-cli.md)
- [PowerShell: группу отработки отказа](scripts/sql-database-add-single-db-to-failover-group-powershell.md);
- [REST API: группу отработки отказа](/rest/api/sql/failovergroups).

После отработки отказа убедитесь, что для новой базы данных-источника настроены требования аутентификации ваших сервера и базы данных. Дополнительные сведения см. в разделе [Безопасность базы данных SQL после аварийного восстановления](sql-database-geo-replication-security-config.md).

Добавление избыточности баз данных между центрами обработки данных — только часть решения для достижения настоящей непрерывности бизнес-процессов. Для комплексного восстановления приложения (службы) после катастрофического сбоя необходимо восстановить все компоненты, из которых состоит служба и все зависимые службы. К примерам этих компонентов относятся клиентское программное обеспечение (например, браузер с пользовательским кодом JavaScript), интерфейсные веб-серверы, хранилище и DNS. Очень важно, чтобы все компоненты были устойчивы к одинаковым сбоям и становились доступными в соответствии с целевым временем восстановления (RTO) вашего приложения. Следовательно, необходимо определить все зависимые службы и получить сведения о гарантиях и возможностях, которые они предоставляют. Затем необходимо выполнить соответствующие действия, чтобы обеспечить работу службы во время отработки отказа служб, от которых она зависит. Для получения дополнительной информации о разработке решений для аварийного восстановления [см.](sql-database-designing-cloud-solutions-for-disaster-recovery.md)

## <a name="auto-failover-group-terminology-and-capabilities"></a>Терминология и способности группы автоматической отработки отказа

- **Группа Failover (FOG)**

  Группа failover — это именованная группа баз данных, управляемых одним сервером базы данных S'L или в пределах одного управляемого экземпляра, который может выйти из строя как единое целое в другой регион в случае, если все или некоторые первичные базы данных станут недоступными из-за сбоя в первичном регионе. При создании для управляемых экземпляров группа failover содержит все базы данных пользователей в экземпляре, и поэтому только одна группа failover может быть настроена на экземпляре.
  
  > [!IMPORTANT]
  > Имя группы failover должно быть глобально `.database.windows.net` уникальным в домене.

- **Серверы базы данных S'L**

     С помощью серверов Базы данных SQL можно разместить некоторые или все пользовательские базы данных с отдельного сервера Базы данных SQL в группе отработки отказа. Сервер Базы данных SQL также поддерживает несколько групп отработки отказа на отдельном сервере Базы данных SQL.

- **Первичный**

  Сервер базы данных S'L или управляемый экземпляр, в котором размещается основные базы данных в группе failover.

- **Вторичная**

  Сервер базы данных s'L или управляемый экземпляр, в котором размещается вторичные базы данных в группе failover. Источники и получатели не могут находиться в одном и том же регионе.

- **Добавление отдельных баз данных в группу отработки отказа**

  Вы можете разместить несколько отдельных баз данных на одном сервере Базы данных SQL в одной группе отработки отказа. Если вы добавите отдельную базу данных в группу отработки отказа, она автоматически создаст базу данных-получатель, используя тот же выпуск и объем вычислительных ресурсов на сервере-получателе.  Этот сервер следует указать при создании группы отработки отказа. Если вы добавите базу данных, у которой уже есть база данных-получатель на сервере-получателе, эта ссылка на георепликацию наследуется группой. Во время добавления базы данных, у которой уже есть база данных-получатель на сервере, которая не является частью группы отработки отказа, на этом сервере-получателе будет создана новая база данных-получатель.

  > [!IMPORTANT]
  > Убедитесь, что вторичный сервер не имеет базы данных с тем же именем, если это не существующая второстепенная база данных. В группах failover для управляемого экземпляра все базы данных пользователей реплицируются. Нельзя выбирать подмножество для репликации пользовательских баз данных в группе отработки отказа.

- **Добавление баз данных в эластичный пул в группе отработки отказа**

  Вы можете разместить несколько баз данных или их все в эластичном пуле в одну группу отработки отказа. Если база данных-источник расположена в эластичном пуле, в нем автоматически создается база данных-получатель с тем же именем (вторичный пул). Необходимо убедиться, что сервер-получатель содержит эластичный пул с тем же именем и имеет достаточную емкость для размещения баз данных-получателей, которые будут созданы группой отработки отказа. Если вы добавите базу данных в пул, у которого уже есть база данных-получатель на вторичном пуле, эта ссылка на георепликацию наследуется группой. Во время добавления базы данных, у которой уже есть база данных-получатель на сервере, которая не является частью группы отработки отказа, в этом вторичном пуле будет создана новая база данных-получатель.
  
- **Первоначальный посев** 

  При добавлении баз данных, эластичных пулов или управляемых экземпляров в группу failover, существует начальная фаза посева до начала репликации данных. Начальная фаза посева является самой длинной и дорогостоящей операцией. После завершения первоначального посева данные синхронизируются, а затем реплицируются только последующие изменения данных. Время, необходимое для завершения первоначального семени, зависит от размера данных, количества реплицированных баз данных и скорости связи между сущностями в группе failover. При нормальных обстоятельствах, типичная скорость посева составляет 50-500 ГБ в час для одной базы данных или эластичного пула, и 18-35 ГБ в час для управляемого экземпляра. Посев выполняется для всех баз данных параллельно. Вы можете использовать заявленную скорость посева, а также количество баз данных и общий размер данных, чтобы оценить, сколько времени займет начальная фаза посева до начала репликации данных.

  В управляемых экземплярах при оценке времени начальной фазы посева также необходимо учитывать скорость соединения экспресс-маршрута между этими двумя экземплярами. Если скорость связи между этими двумя экземплярами медленнее, чем это необходимо, то время для семени, вероятно, будет заметно затронуто. Вы можете использовать заявленную скорость посева, количество баз данных, общий размер данных и скорость соединения, чтобы оценить, сколько времени займет начальная фаза посева до начала репликации данных. Например, для одной базы данных 100 ГБ начальная фаза семян займет от 2,8 до 5,5 часов, если ссылка способна проталкивать 35 ГБ в час. Если ссылка может передавать только 10 ГБ в час, то посев 100 ГБ базы данных займет около 10 часов. При репликации нескольких баз данных посев будет осуществляться параллельно, и в сочетании с медленной скоростью связи начальная фаза посева может занять значительно больше времени, особенно если параллельный посев данных из всех баз данных превышает имеющиеся пропускной способности связи. Если пропускная способность сети между двумя экземплярами ограничена, и вы добавляете несколько управляемых экземпляров в группу failover, подумайте о добавлении нескольких управляемых экземпляров в группу failover последовательно, один за одним.

  
- **Зона DNS**

  Уникальный идентификатор, автоматически генерируемый при создании нового экземпляра. Для этого экземпляра предоставляется сертификат мультидомена (SAN) для проверки подлинности клиентских подключений к любому экземпляру в той же зоне DNS. Два управляемых экземпляра в одной и той же группе failover должны совместно с зоной DNS.
  
  > [!NOTE]
  > Идентификатор зоны DNS не требуется для групп, созданных для серверов базы данных S'L.

- **Прослушиватель чтения и записи для группы отработки отказа**

  Запись DNS CNAME, которая указывает на URL текущего основного. Он создается автоматически при создании группы failover и позволяет рабочей нагрузке на чтение S'L прозрачно подключаться к основной базе данных при изменении первичных изменений после сбоя. При создании группы failover на сервере базы данных S'L, запись DNS CNAME для URL-адреса слушателя формируется как `<fog-name>.database.windows.net`. При создании группы failover в управляемом экземпляре формируется запись DNS `<fog-name>.zone_id.database.windows.net`CNAME для URL-адреса слушателя как .

- **Прослушиватель только для чтения для группы отработки отказа**

  Формируется запись DNS CNAME, которая указывает на прослушиватель только для чтения, указывающий на URL-адрес получателя. Он создается автоматически при создании группы failover и позволяет рабочей нагрузке только для чтения S'L прозрачно подключаться к вторичному, используя указанные правила балансировки нагрузки. При создании группы failover на сервере базы данных S'L, запись DNS CNAME для URL-адреса слушателя формируется как `<fog-name>.secondary.database.windows.net`. При создании группы failover в управляемом экземпляре формируется запись DNS `<fog-name>.zone_id.secondary.database.windows.net`CNAME для URL-адреса слушателя как .

- **Политика автоматической отработки отказа**

  По умолчанию группа отработки отказа настроена с помощью политики автоматической отработки отказа. Служба базы данных SQL запускает отработку отказа после обнаружения сбоя и истечения льготного периода. Системе необходимо убедиться, что сбой нельзя устранить с помощью встроенной [инфраструктуры обеспечения высокой доступности Службы базы данных SQL](sql-database-high-availability.md) из-за масштаба влияния. Если вы хотите управлять рабочим процессом отработки отказа из приложения, вы можете отключить автоматическую отработку отказа.
  
  > [!NOTE]
  > Поскольку проверка масштабов сбоя и того, как быстро он может быть смягчен, связана с действиями человека, льготная группа не может быть установлена ниже одного часа.  Это ограничение распространяется на все базы данных в группе failover, независимо от состояния синхронизации данных. 

- **Политика отработки отказа только для чтения**

  По умолчанию группа отработки отказа только для чтения отключена. Это гарантирует, что производительность базы данных-источника не изменится, если база данных-получателя отключена. Тем не менее, это также означает, что невозможно будет активировать сеансы только для чтения, пока база данных-получателя не восстановится. Если вы не можете терпеть простои для только для чтения сессий и ок временно использовать основной как для чтения только и читать-запись трафика за счет потенциальной деградации `AllowReadOnlyFailoverToPrimary` производительности основной, вы можете включить failover для чтения только слушателя путем настройки свойства. В этом случае трафик только для чтения будет автоматически перенаправлен на основной, если вторичный недоступен.

- **Запланированный сбой**

   Плановая отработка отказа выполняет полную синхронизацию между базой данных-источник и базой данных-получатель, прежде чем база данных-получатель переключится на основную роль. Такая отработка отказа гарантирует отсутствие потери данных. Плановая отработка отказа используется в следующих сценариях.

  - Тестирование аварийного восстановления (DR) в рабочей среде в случае, если потеря данных неприемлема.
  - Перемещение баз данных в другой регион.
  - Возвращение баз данных в основной регион после устранения сбоя (восстановление размещения).

- **Незапланированный сбой**

   При незапланированной или принудительной отработке отказа база данных-получатель немедленно переключается на основную роль без какой-либо синхронизации с базой данных-источником. Эта операция приведет к потере данных. Незапланированная отработка отказа используется в качестве метода восстановления при сбоях, когда база данных-источник недоступна. Когда исходный основной возвращается в онлайн, он автоматически подключается без синхронизации и становится новым вторичным.

- **Ручной сбой**

  Вы можете запустить отработку отказа вручную в любое время, независимо от настройки автоматической отработки отказа. Если политика автоматической отработки отказа не настроена, для восстановления баз данных в группе отработки отказа в получателя требуется отработка отказа вручную. Вы можете запустить принудительную отработку отказа или адаптированную (с полной синхронизацией данных). Адаптированная отработка отказа может использоваться для перемещения источника в дополнительный регион. После завершения отработки отказа записи DNS автоматически обновляются для установления подключения к новому источнику.

- **Льготный период с потерей данных**

  Так как база данных-источник и база данных-получатель синхронизированы с помощью асинхронной репликации, отработка отказа может привести к потере данных. Вы можете настроить политику автоматической отработки отказа, чтобы представить устойчивость приложения к потере данных. Настраивая, `GracePeriodWithDataLossHours`вы можете контролировать, как долго система ждет, прежде чем начать сбой, что может привести к потере данных.

- **Несколько групп отработки отказа**

  Вы можете настроить несколько групп отработки отказа для одной пары серверов, чтобы управлять масштабом отработок отказа. Каждая группа выполняет отработку отказа независимо от других групп. Если ваше мультитенантное приложение использует эластичные пулы, вы можете воспользоваться этой возможностью, чтобы объединить базу данных-источник и базу данных-получатель в каждом пуле. Таким образом вы сможете снизить последствия сбоя для половины клиентов.

  > [!NOTE]
  > Управляемый экземпляр не поддерживает несколько групп отработки отказа.
  
## <a name="permissions"></a>Разрешения

Разрешения для группы failover управляются с [помощью элемента управления доступом на основе ролей (RBAC).](../role-based-access-control/overview.md) Роль [вкладчика сервера S'L](../role-based-access-control/built-in-roles.md#sql-server-contributor) имеет все необходимые разрешения для управления группами сбоев.

### <a name="create-failover-group"></a>Создание группы отработки отказа

Чтобы создать группу failover, вам необходимо RBAC написать доступ как к основным, так и к вторичным серверам, а также ко всем базам данных в группе failover. Для управляемого экземпляра необходимо, чтобы RBAC записывал доступ как к основному, так и к вторичному управляемому экземпляру, но разрешения в отдельных базах данных не имеют значения, поскольку отдельные базы данных управляемых экземпляров не могут быть добавлены или удалены из группы failover. 

### <a name="update-a-failover-group"></a>Обновление группы неудач

Для обновления группы failover необходимо, чтобы RBAC записывал доступ к группе failover и всем базам данных на текущем первичном сервере или управляемом экземпляре.  

### <a name="failover-a-failover-group"></a>Failover failover группа failover

Чтобы потерпеть неудачу из-за группы неудач, необходимо, чтобы RBAC записывал доступ к группе failover на новом первичном сервере или управляемом экземпляре.

## <a name="best-practices-of-using-failover-groups-with-single-databases-and-elastic-pools"></a>Рекомендации по использованию групп отработки отказа с отдельными базами данных и эластичными пулами

Группу автоматической отработки отказа необходимо настроить на сервере-источнике Базы данных SQL и подключить к серверу-получателю Базы данных SQL в другом регионе Azure. Группы могут содержать все или некоторые базы данных на этих серверах. На следующей схеме показана типичная конфигурация геоизбыточного облачного приложения, использующего несколько баз данных и активную георепликацию.

![автоматическая отработка отказа](./media/sql-database-auto-failover-group/auto-failover-group.png)

> [!NOTE]
> [См. Добавить единую базу данных в группу неудачников](sql-database-single-database-failover-group-tutorial.md) для детального пошагового учебника, добавляя единую базу данных в группу неудачников.

При разработке службы с обеспечением непрерывности бизнес-процессов придерживайтесь следующих рекомендаций.

### <a name="using-one-or-several-failover-groups-to-manage-failover-of-multiple-databases"></a>Использование одной или нескольких групп failover для управления сбой нескольких баз данных

Вы можете создать одну или несколько групп отработки отказа между двумя серверами в различных регионах (для основного сервера и сервера-получателя). Каждая группа может содержать одну или несколько баз данных, которые восстанавливаются единым блоком в случае, когда все или часть баз данных-источников становятся недоступными из-за сбоя в основном регионе. Группа отработки отказа создает базу данных-получатель в дополнительном географическом регионе с таким же целевым уровнем служб, который указан для базы данных-источника. При добавлении существующей связи георепликации к группе отработки отказа убедитесь, что база данных-получатель геореплицируемых данных настроена с тем же уровнем служб и объемом вычислительных ресурсов, что и база данных-источник.
  
> [!IMPORTANT]
> Создание групп failover между двумя серверами в разных подписях в настоящее время не поддерживается для отдельных баз данных и эластичных пулов. Если вы переведете основной или вторичный сервер на другую подписку после создания группы failover, это может привести к сбоям запросов на сбой и другим операциям.

### <a name="using-read-write-listener-for-oltp-workload"></a>Использование слушателя чтения для рабочей нагрузки OLTP

При выполнении операций OLTP используйте `<fog-name>.database.windows.net` в качестве URL-адреса сервера, чтобы все подключения автоматически перенаправлялись на сервер-источник. Этот URL-адрес не будет изменяться после отработки отказа. Обратите внимание на то, что отработка отказа включает в себя обновление DNS-записи, поэтому клиентские подключения будут перенаправляться на новый сервер-источник только после обновления кэша DNS на стороне клиента.

### <a name="using-read-only-listener-for-read-only-workload"></a>Использование только для чтения слушателя для работы только для чтения

Если вы используете логически изолированную рабочую нагрузку в режиме только для чтения, устойчивую к некоторым задержкам в обновлении данных, в приложении можно использовать базу данных-получатель. Для сеансов с доступом только для чтения используйте `<fog-name>.secondary.database.windows.net` в качестве URL-адреса сервера, чтобы подключение автоматически перенаправлялось на сервер-получатель. Также рекомендуется указывать в строке соединения `ApplicationIntent=ReadOnly`прочитанную цель с помощью . Если вы хотите убедиться, что рабочая нагрузка только для чтения может восстановить связь после сбоя `AllowReadOnlyFailoverToPrimary` или в случае, если вторичный сервер перейдет в автономный режим, не забудьте настроить свойство политики неудачи.

### <a name="preparing-for-performance-degradation"></a>Подготовка к ухудшению производительности

Типичное приложение Azure использует несколько служб Azure и состоит из нескольких компонентов. Автоматизированный сбой группы failover срабатывает на основе состояния только компонентов Azure S'L. Другие службы Azure в основном регионе могут не быть затронуты отключением, и их компоненты могут по-прежнему доступны в этом регионе. Как только первичные базы данных переключаются в область DR, задержка между зависимыми компонентами может увеличиться. Чтобы избежать влияния более высокой задержки на производительность приложения, обеспечьте избыточность всех компонентов приложения в регионе DR и следуйте этим [рекомендациям по безопасности сети.](#failover-groups-and-network-security)

### <a name="preparing-for-data-loss"></a>Подготовка к потере данных

При обнаружении сбота сбой ждет указанный `GracePeriodWithDataLossHours`вами период. Значение этого свойства по умолчанию – 1 час. Если вы не можете позволить `GracePeriodWithDataLossHours` себе потерю данных, убедитесь, что установить на достаточно большое количество, например, 24 часов. Используйте группу ручной отработки отказа для восстановления размещения из получателя в источник.

> [!IMPORTANT]
> Эластичные пулы с 800 DTU или менее и более чем 250 базами данных, использующими георепликацию, могут испытывать проблемы, включая более длительные плановые операции отработки отказа и снижение производительности.  Эти проблемы чаще всего возникают из-за рабочих нагрузок, интенсивно записывающих данные, если конечные точки георепликации физически находятся далеко друг от друга или если используется несколько дополнительных конечных точек для каждой базы данных.  Симптомы этих проблем проявляются при увеличении задержки георепликации с течением времени.  Эту задержку можно отслеживать с помощью [sys.dm_geo_replication_link_status](/sql/relational-databases/system-dynamic-management-views/sys-dm-geo-replication-link-status-azure-sql-database).  Если эти проблемы возникли, к возможным способам их устранения относятся увеличение числа DTU пула или уменьшение количества геореплицируемых баз данных в одном пуле.

### <a name="changing-secondary-region-of-the-failover-group"></a>Изменение вторичной области группы неудач

Чтобы проиллюстрировать последовательность изменений, мы предположим, что сервер А является основным сервером, сервер B — существующим вторичным сервером, а сервер C — новым вторичным в третьем регионе.  Чтобы совершить переход, выполните следующие действия:

1.  Создавайте дополнительные второстепенные базы данных на сервере А на сервере С с помощью [активной георепликации.](sql-database-active-geo-replication.md) Каждая база данных на сервере А будет иметь два второстепенных, один на сервере B и один на сервере C. Это гарантирует, что первичные базы данных остаются защищенными в течение переходного периода.
2.  Удалите группу неудач. На этом этапе логины будут неудавшихся. Это связано с тем, что псевдонимы S'L для слушателей группы failover были удалены, и шлюз не распознает имя группы failover.
3.  Воссоздание группы failover с одинаковым именем между серверами A и C. На этом этапе логины перестанут выходить из строя.
4.  Добавьте все основные базы данных на сервере А в новую группу неудач.
5.  Падение сервера B. Все базы данных на B будут удалены автоматически. 


### <a name="changing-primary-region-of-the-failover-group"></a>Изменение первичной области группы failover

Чтобы проиллюстрировать последовательность изменений, мы предположим, что сервер А является основным сервером, сервер B — существующим вторичным сервером, а сервер C — новым первичным в третьем регионе.  Чтобы совершить переход, выполните следующие действия:

1.  Выполните запланированный отказ для переключения основного сервера на B. Server A станет новым вторичным сервером. Сбой может привести к нескольким минутам простоя. Фактическое время будет зависеть от размера группы неудачи.
2.  Создайте дополнительные второстепенные данные каждой базы данных на сервере B для сервера C с помощью [активной георепликации.](sql-database-active-geo-replication.md) Каждая база данных на сервере B будет иметь два второстепенных, один на сервере А и один на сервере С. Это гарантирует, что первичные базы данных остаются защищенными в течение переходного периода.
3.  Удалите группу неудач. На этом этапе логины будут неудавшихся. Это связано с тем, что псевдонимы S'L для слушателей группы failover были удалены, и шлюз не распознает имя группы failover.
4.  Воссоздание группы failover с одинаковым именем между серверами A и C. На этом этапе логины перестанут выходить из строя.
5.  Добавьте все первичные базы данных на B в новую группу failover. 
6.  Выполните запланированный сбой группы неудачдляв для переключения B и C. Теперь сервер C станет первичным, а B - вторичным. Все вторичные базы данных на сервере А будут автоматически связаны с праймериз на C. Как и в шаге 1, сбой может привести к нескольким минутах простоя.
6.  Бросьте сервер А. Все базы данных на A будут удалены автоматически.

> [!IMPORTANT]
> При удалении группы failover записи DNS для конечных точек слушателя также удаляются. В этот момент существует ненулевая вероятность того, что кто-то другой создат группу сбоев или псевдоним сервера с тем же именем, что помешает вам снова использовать его. Чтобы свести к минимуму риск, не используйте общие имена групп failover.

## <a name="best-practices-of-using-failover-groups-with-managed-instances"></a>Рекомендации по использованию групп failover с управляемыми экземплярами

Группы автоматической отработки отказа должны быть настроены на экземпляре источника и подключены к экземпляру получателя в другом регионе Azure.  Все базы данных в экземпляре будут реплицированы в экземпляр получателя.

На следующей схеме показана типичная конфигурация геоизбыточного облачного приложения, использующего несколько управляемых экземпляров и активную георепликацию.

![автоматическая отработка отказа](./media/sql-database-auto-failover-group/auto-failover-group-mi.png)

> [!NOTE]
> [См. Добавить управляемый экземпляр в группу неудач](sql-database-managed-instance-failover-group-tutorial.md) для детального пошагового учебника, добавляя управляемый экземпляр для использования группы failover.

Если приложение использует управляемый экземпляр в качестве уровня данных, следуйте этим общим рекомендациям при проектировании непрерывности бизнеса:

### <a name="creating-the-secondary-instance"></a>Создание вторичного экземпляра 

Чтобы обеспечить беспрерывное подключение к экземпляру источника после отработки отказа, экземпляры и источника, и получателя должны находиться в одной зоне DNS. Это гарантирует, что один и тот же сертификат мультидоменов (SAN) может быть использован для проверки подлинности клиентских подключений к одному из двух экземпляров группы failover. После подготовки вашего приложения к рабочему развертыванию создайте экземпляр получателя в другом регионе и убедитесь, что он использует ту же зону DNS, что и экземпляр источника. Это можно сделать, `DNS Zone Partner` указав дополнительный параметр с помощью портала Azure, PowerShell или REST API.

> [!IMPORTANT]
> Первая инстанция, созданная в подсети, определяет зону DNS для всех последующих экземпляров в одной подсети. Это означает, что два экземпляра из одной и той же подсети не могут принадлежать к разным зонам DNS.

Для получения дополнительной информации о создании вторичного экземпляра в той же зоне DNS, что и в основной экземпляре, [см.](sql-database-managed-instance-failover-group-tutorial.md#3---create-a-secondary-managed-instance)

### <a name="enabling-replication-traffic-between-two-instances"></a>Включение трафика репликации между двумя экземплярами

Поскольку каждый экземпляр изолирован в своей виртуальной сети, двусторонний трафик между этими виртуальными сетями должен быть разрешен. См. [VPN-шлюзы Azure](../vpn-gateway/vpn-gateway-about-vpngateways.md)

### <a name="creating-a-failover-group-between-managed-instances-in-different-subscriptions"></a>Создание группы сбоев между управляемыми экземплярами в разных подписках

Можно создать группу failover между управляемыми экземплярами в двух разных подписках. При использовании PowerShell API вы можете `PartnerSubscriptionId` сделать это, указав параметр для вторичного экземпляра. При использовании REST API каждый `properties.managedInstancePairs` идентификатор экземпляра, включенный в параметр, может иметь свой собственный идентификатор.
  
> [!IMPORTANT]
> Портал Azure не поддерживает создание групп сбоев в различных подписках. Кроме того, для существующих групп failover в различных группах подписки и/или групп ресурсов, failover не может быть инициирован вручную через портал из основного экземпляра. Вместо этого инициируйте его из геовторичного экземпляра.

### <a name="managing-failover-to-secondary-instance"></a>Управление сбой в вторичном экземпляре

Группа отработки отказа будет управлять отработкой отказа всех баз данных в экземпляре. При создании группы каждая база данных в экземпляре будет автоматически геореплицироваться в экземпляр получателя. Вы не можете использовать группы отработки отказа для запуска частичной отработки отказа подмножества баз данных.

> [!IMPORTANT]
> Если база данных удалена из экземпляра источника, то она также будет автоматически удалена из экземпляра геополучателя.

### <a name="using-read-write-listener-for-oltp-workload"></a>Использование слушателя чтения для рабочей нагрузки OLTP

При выполнении операций OLTP используйте `<fog-name>.zone_id.database.windows.net` в качестве URL-адреса сервера, чтобы все подключения автоматически перенаправлялись на сервер-источник. Этот URL-адрес не будет изменяться после отработки отказа. Отработка отказа включает в себя обновление DNS-записи, поэтому клиентские подключения будут перенаправляться на новый сервер-источник только после обновления кэша DNS на стороне клиента. Поскольку вторичный экземпляр разделяет зону DNS с основной, клиентское приложение сможет повторно подключиться к нему с помощью того же сертификата SAN.

### <a name="using-read-only-listener-to-connect-to-the-secondary-instance"></a>Использование слушателя только для чтения для подключения к вторичному экземпляру

Если вы используете логически изолированную рабочую нагрузку в режиме только для чтения, устойчивую к некоторым задержкам в обновлении данных, в приложении можно использовать базу данных-получатель. Для прямого подключения к георепликации получателя используйте `server.secondary.zone_id.database.windows.net` в качестве URL-сервера.

> [!NOTE]
> На некоторых уровнях служб База данных SQL Azure поддерживает использование [реплик только для чтения](sql-database-read-scale-out.md) для балансировки рабочих нагрузок запросов только для чтения, используя возможности одной реплики и параметра `ApplicationIntent=ReadOnly` в строке соединения. После настройки георепликации получателя вы можете использовать эту возможность для соединения с репликой только для чтения либо в основном расположении, либо в геореплицированном расположении.
> - Для подключения к реплике только для чтения в основном расположении используйте `<fog-name>.zone_id.database.windows.net`.
> - Для подключения к реплике только для чтения `<fog-name>.secondary.zone_id.database.windows.net`во вторичном месте используйте.

### <a name="preparing-for-performance-degradation"></a>Подготовка к ухудшению производительности

Типичное приложение Azure использует несколько служб Azure и состоит из нескольких компонентов. Автоматизированный сбой группы failover срабатывает на основе состояния только компонентов Azure S'L. Другие службы Azure в основном регионе могут не быть затронуты отключением, и их компоненты могут по-прежнему доступны в этом регионе. Как только первичные базы данных переключаются в область DR, задержка между зависимыми компонентами может увеличиться. Чтобы избежать влияния более высокой задержки на производительность приложения, обеспечьте избыточность всех компонентов приложения в регионе DR и следуйте этим [рекомендациям по безопасности сети.](#failover-groups-and-network-security)

### <a name="preparing-for-data-loss"></a>Подготовка к потере данных

При обнаружении сбоя SQL автоматически активирует отработку отказа с чтением и записью, если потери данных нулевые, насколько нам известно. В противном случае он ожидает в течение периода, указанного в `GracePeriodWithDataLossHours`. Если вы указали `GracePeriodWithDataLossHours`, будьте готовы к потере данных. Во время сбоев Azure, как правило, повышает доступность. Если вы не можете позволить себе потерю данных, установите для параметра GracePeriodWithDataLossHours достаточно большое количество времени, например 24 часа.

После запуска отработки отказа DNS обновления прослушивателя чтения и записи произойдут автоматически. Эта операция не приведет к потере данных. Однако процесс смены ролей баз данных в обычных условиях может занять до 5 минут. До окончания этого процесса некоторые базы данных в новом экземпляре источника будут оставаться в режиме только для чтения. Если сбой инициируется с помощью PowerShell, вся операция синхронна. Если он инициирован с помощью портала Azure, uI укажет состояние завершения. Если она инициируется с помощью REST API, то используйте стандартный механизм опроса Azure Resource Manager для мониторинга выполнения.

> [!IMPORTANT]
> Используйте группу ручной отработки отказа для перемещения источников в исходное расположение. После устранения сбоя, вызвавшего отработку отказа, вы можете переместить базы данных-источники в исходное расположение. Для этого вам следует инициировать ручную отработку отказа группы.
  
### <a name="changing-secondary-region-of-the-failover-group"></a>Изменение вторичной области группы неудач

Предположим, что экземпляр A является основной инстанцией, экземпляр B — существующим вторичным экземпляром, а экземпляр C — новым вторичным экземпляром в третьем регионе.  Чтобы совершить переход, выполните следующие действия:

1.  Создавайте экземпляр C с таким же размером, как и A, и в той же зоне DNS. 
2.  Удалите группу неудач между экземплярами A и B. На этом этапе логины будут неудавшиеся, потому что псевдонимы S'L для слушателей группы failover были удалены, и шлюз не распознает имя группы failover. Вторичные базы данных будут отключены от праймериз и станут базами чтения. 
3.  Создайте группу неудач с тем же именем между экземплярами A и C. Следуйте инструкциям в [группе failover с управляемым учебником экземпляра.](sql-database-managed-instance-failover-group-tutorial.md) Это операция по размеру данных, которая завершится, когда все базы данных из экземпляра А будут посеяны и синхронизированы.
4.  Удалите экземпляр B, если не нужно, чтобы избежать ненужных платежей.

> [!NOTE]
> После шага 2 и до завершения шага 3 базы данных, например, А будут оставаться незащищенными от катастрофического сбоя экземпляра A.

### <a name="changing-primary-region-of-the-failover-group"></a>Изменение первичной области группы failover

Предположим, что пример A является основной инстанцией, экземпляр B — существующим вторичным экземпляром, а экземпляр C — новым первичным экземпляром в третьем регионе.  Чтобы совершить переход, выполните следующие действия:

1.  Создавайте экземпляр C с таким же размером, как И Б, и в той же зоне DNS. 
2.  Подключитесь к экземпляру B и вручную не переключите для переключения основной экземпляр на B. Instance A автоматически станет новым вторичным экземпляром.
3.  Удалите группу неудач между экземплярами A и B. На этом этапе логины будут неудавшиеся, потому что псевдонимы S'L для слушателей группы failover были удалены, и шлюз не распознает имя группы failover. Вторичные базы данных будут отключены от праймериз и станут базами чтения. 
4.  Создайте группу неудач с тем же именем между экземплярами A и C. Следуйте инструкциям в [группе failover с управляемым учебником экземпляра.](sql-database-managed-instance-failover-group-tutorial.md) Это операция по размеру данных, которая завершится, когда все базы данных из экземпляра А будут посеяны и синхронизированы.
5.  Удалить экземпляр А, если не требуется, чтобы избежать ненужных платежей.

> [!NOTE] 
> После шага 3 и до завершения шага 4 базы данных, например, А будут оставаться незащищенными от катастрофического сбоя экземпляра A.

> [!IMPORTANT]
> При удалении группы failover записи DNS для конечных точек слушателя также удаляются. В этот момент существует ненулевая вероятность того, что кто-то другой создат группу сбоев или псевдоним сервера с тем же именем, что помешает вам снова использовать его. Чтобы свести к минимуму риск, не используйте общие имена групп failover.

## <a name="failover-groups-and-network-security"></a>Группы отработки отказа и сетевая безопасность

Для некоторых приложений правила безопасности требуют, чтобы доступ сети к уровню данных ограничивался определенным компонентом или компонентами, такими как VM, веб-сервис и т.д. Это требование создает некоторые проблемы для проектирования непрерывности бизнеса и использования групп failover. Рассмотрим следующие варианты при реализации такого ограниченного доступа.

### <a name="using-failover-groups-and-virtual-network-rules"></a>Использование групп отработки отказа и правил виртуальной сети

Если вы используете [конечные точки служб и правила виртуальной сети](sql-database-vnet-service-endpoint-rule-overview.md) для ограничения доступа к базе данных SQL, помните, что каждая конечная точка службы для виртуальной сети применяется только к одному региону Azure. Конечная точка не поддерживает прием подключений из подсети в других регионах. Таким образом, только клиентские приложения, развернутые в одном регионе, могут подключаться к базе данных-источнику. Так как результаты отработки отказа в сеансах клиента SQL пересылаются на сервер в другом (дополнительном) регионе, эти сеансы завершатся сбоем, если будут исходить из клиента за пределами этого региона. По этой причине политику автоматической отработки отказа невозможно включить, если на серверы-участники распространяются правила виртуальной сети. Для поддержки перехода на другой ресурс вручную выполните следующие действия:

1. Подготовьте избыточные копии интерфейсных компонентов приложения (веб-службы, виртуальные машины и т. д.) в дополнительном регионе.
2. Настройте [правила виртуальной сети](sql-database-vnet-service-endpoint-rule-overview.md) по отдельности для основного и дополнительного сервера.
3. Включите [отработку отказа внешнего интерфейса с помощью конфигурации диспетчера трафика](sql-database-designing-cloud-solutions-for-disaster-recovery.md#scenario-1-using-two-azure-regions-for-business-continuity-with-minimal-downtime).
4. Инициируйте отработку отказа вручную при обнаружении сбоя. Этот параметр оптимизирован для приложений, требующих последовательной задержки между внешним интерфейсом и уровнем данных, и поддерживает восстановление после сбоя внешнего интерфейса уровня данных или их обоих.

> [!NOTE]
> При использовании **прослушивателя только для чтения** для балансировки рабочей нагрузки только для чтения убедитесь, что эта рабочая нагрузка выполняется на виртуальной машине или в другом ресурсе в дополнительном регионе, чтобы прослушиватель мог подключаться к базе данных-получателю.

### <a name="using-failover-groups-and-sql-database-firewall-rules"></a>Использование групп отработки отказа и правил брандмауэра базы данных SQL

Если для плана обеспечения непрерывности бизнес-процессов требуется отработка отказа с помощью групп с автоматической отработкой отказа, можно ограничить доступ к базе данных SQL с помощью традиционных правил брандмауэра. Для поддержки автоматического перехода на другой ресурс выполните следующие действия:

1. [Создание общедоступного IP-адреса](../virtual-network/virtual-network-public-ip-address.md#create-a-public-ip-address)
2. [создайте общедоступный балансировщик нагрузки](../load-balancer/quickstart-load-balancer-standard-public-portal.md) и назначьте ему общедоступный IP-адрес;
3. [создайте виртуальную сеть и виртуальные машины](../load-balancer/quickstart-load-balancer-standard-public-portal.md) для интерфейсных компонентов;
4. [создайте группу безопасности сети](../virtual-network/security-overview.md) и настройте входящие подключения.
5. Убедитесь, что исходящие подключения открыты для базы данных SQL Azure с помощью [тега службы](../virtual-network/security-overview.md#service-tags) "Sql".
6. Создайте [правило брандмауэра базы данных SQL](sql-database-firewall-configure.md), чтобы разрешить входящий трафик из общедоступного IP-адреса, созданного на этапе 1.

Дополнительные сведения о том, как настроить исходящий доступ и какой IP-адрес нужно использовать в правилах брандмауэра, см. в статье [Исходящие подключения в Azure](../load-balancer/load-balancer-outbound-connections.md).

Приведенная выше конфигурация гарантирует, что автоматический переход на другой ресурс не будет блокировать подключения из интерфейсных компонентов, и предполагает, что приложение может выдержать более длительную задержку между интерфейсном и уровнем данных.

> [!IMPORTANT]
> Для обеспечения непрерывности бизнес-процессов при региональных сбоях должна присутствовать географическая избыточность интерфейсных компонентов и баз данных.

## <a name="enabling-geo-replication-between-managed-instances-and-their-vnets"></a>Включение георепликации между управляемыми экземплярами и их VNets

При настройке группы сбоев между первичными и вторичными управляемыми экземплярами в двух разных регионах каждый экземпляр изолируется с помощью независимой виртуальной сети. Для обеспечения выполнения этих предварительных условий между этими VNets, позволяющий трафик репликации:

1. Два управляемых экземпляра должны находиться в разных регионах Azure.
2. Два управляемых экземпляра должны быть одного и того же уровня обслуживания и иметь один и тот же размер хранилища.
3. Ваш вторичный управляемый экземпляр должен быть пустым (без пользовательских баз данных).
4. Виртуальные сети, используемые управляемыми экземплярами, должны быть подключены через [VPN Шлюз](../vpn-gateway/vpn-gateway-about-vpngateways.md) или [Express Route.](../expressroute/expressroute-howto-circuit-portal-resource-manager.md) Когда две виртуальные сети подключаются через локальная сеть, убедитесь, что нет правила брандмауэра, блокирующего порты 5022 и 11000-11999. Пиринг глобальной виртуальной сети не поддерживается.
5. Два управляемых экземпляра VNets не могут иметь перекрывающихся IP-адресов.
6. Необходимо настроить группы сетевой безопасности (NSG) таким образом, чтобы порты 5022 и диапазон 11000-12000 открыты для входящих и исходящих для подключения из подсети другого управляемого экземпляра. Это позволяет репликации трафика между экземплярами.

   > [!IMPORTANT]
   > Неправильная настройка правил безопасности NSG приводит к задержке операций копирования баз данных.

7. Вторичный экземпляр настроен с правильным идентификатором зоны DNS. DNS зона является свойством управляемого экземпляра и виртуального кластера, и его идентификатор включен в адрес имени хоста. Идентификатор зоны генерируется как случайная строка, когда первый управляемый экземпляр создается в каждом VNet и тот же идентификатор назначается всем другим экземплярам в той же подсети. После присвоения зона DNS не может быть изменена. Управляемые экземпляры, включенные в одну и ту же группу failover, должны совместно с зоной DNS. Вы выполняете это, передавая идентификатор зоны первичного экземпляра в качестве значения параметра Dns'onePartner при создании вторичного экземпляра. 

   > [!NOTE]
   > Подробный учебник по настройке групп failover с управляемым экземпляром [см.](sql-database-managed-instance-failover-group-tutorial.md)

## <a name="upgrading-or-downgrading-a-primary-database"></a>Повышение или понижение уровня производительности базы данных-источника

Вы можете повышать или понижать объем вычислительных ресурсов базы данных-источника (в рамках одного уровня служб, а не между уровнем общего назначения и критически важным для бизнеса) без отключения каких-либо баз данных-получателей. При обновлении мы рекомендуем сначала обновить все вторичные базы данных, а затем обновить первичную. При понижении рейтинга отмените порядок: сначала понизите первичный, а затем понизите все вторичные базы данных. Когда вы повышаете или понижаете базу данных до следующего уровня служб, особенно важно выполнять рекомендацию выше.

Эта последовательность рекомендуется специально, чтобы избежать проблемы, когда вторичные на более низком SKU получает перегружены и должны быть повторно посеяны во время обновления или понижения процесса. Вы также можете избежать проблемы, сделав первичное чтение только, за счет воздействия всех считывания нагрузок на основной.

> [!NOTE]
> Если вы создали базу данных-получатель как часть конфигурации группы отработки отказа, понижение ее уровня не рекомендуется. Это необходимо, чтобы обеспечить достаточную емкость уровня данных для обработки регулярных рабочих нагрузок после активации отработки отказа.

## <a name="preventing-the-loss-of-critical-data"></a>Предотвращение потери важных данных

Из-за высокой задержки глобальных сетей непрерывная копия использует механизм асинхронной репликации. Ввиду асинхронной репликации потеря данных в случае сбоя неизбежна. Тем не менее для некоторых приложений терять данные недопустимо. Чтобы защитить эти критические обновления, разработчик приложения сразу же после фиксации транзакции может вызывать системную процедуру [sp_wait_for_database_copy_sync](/sql/relational-databases/system-stored-procedures/active-geo-replication-sp-wait-for-database-copy-sync). Вызов `sp_wait_for_database_copy_sync` блокирует поток вызова до тех пор, пока последняя транзакция не была передана во вторичную базу данных. Но вызов не дожидается воспроизведения и фиксации переданных транзакций в базе данных-получателе. `sp_wait_for_database_copy_sync`присоединена к конкретной непрерывной ссылке копии. Эту процедуру может вызвать любой пользователь с правами подключения к базе данных-источнику.

> [!NOTE]
> `sp_wait_for_database_copy_sync`предотвращает потерю данных после сбоя, но не гарантирует полную синхронизацию для доступа к чтению. Задержка, вызванная `sp_wait_for_database_copy_sync` вызовом процедуры, может быть значительной и зависит от размера журнала транзакции на момент вызова.

## <a name="failover-groups-and-point-in-time-restore"></a>Группы отработки отказа и восстановление до точки во времени

Сведения об использовании восстановления до точки во времени с группами отработки отказа см. в разделе [Восстановление до точки во времени (PITR)](sql-database-recovery-using-backups.md#point-in-time-restore).

## <a name="limitations-of-failover-groups"></a>Ограничения групп неудач

Следует учитывать следующие ограничения.

- Группа Failover не может быть создана между двумя серверами или экземплярами в одних и тех же регионах Azure.
- Группа Failover не может быть переименована. Вам нужно будет удалить группу и воссоздать ее с другим именем. 
- Переименование базы данных не поддерживается для экземпляров в группе failover. Для переименования базы данных необходимо временно удалить группу failover.

## <a name="programmatically-managing-failover-groups"></a>Программное управление группами отработки отказа

Как уже говорилось ранее, группами автоматической отработки отказа и активной георепликацией можно также управлять программно с помощью Azure PowerShell и REST API. В приведенных ниже таблицах описан доступный для этого набор команд. Активная георепликация включает в себя набор API-интерфейсов Azure Resource Manager для управления, в том числе [REST API Базы данных SQL Azure](https://docs.microsoft.com/rest/api/sql/) и [командлеты Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview). Эти интерфейсы API требуют использования групп ресурсов и поддерживают безопасность на основе ролей (RBAC). Для получения дополнительной информации о [Azure Role-Based Access Control](../role-based-access-control/overview.md)том, как реализовать роли доступа, см.

# <a name="powershell"></a>[PowerShell](#tab/azure-powershell)

### <a name="manage-sql-database-failover-with-single-databases-and-elastic-pools"></a>Управление отработкой отказа баз данных SQL с отдельными базами данных и эластичными пулами

| Командлет | Описание |
| --- | --- |
| [New-AzSqlDatabaseFailoverGroup](/powershell/module/az.sql/new-azsqldatabasefailovergroup) |Создает группу отработки отказа и регистрирует ее на основном сервере и сервере-получателе.|
| [Удалить-AzSqlDatabaseFailoverGroup](/powershell/module/az.sql/remove-azsqldatabasefailovergroup) | Удаляет группу сбоя с сервера |
| [Get-AzSqlDatabaseFailoverGroup](/powershell/module/az.sql/get-azsqldatabasefailovergroup) | Извлекает конфигурацию группы failover |
| [Set-AzSqlDatabaseFailoverGroup](/powershell/module/az.sql/set-azsqldatabasefailovergroup) |Изменяет конфигурацию группы неудач |
| [Switch-AzSqlDatabaseFailoverGroup](/powershell/module/az.sql/switch-azsqldatabasefailovergroup) | Триггеры сбой из группы failover на вторичном сервере |
| [Add-AzSqlDatabaseToFailoverGroup](/powershell/module/az.sql/add-azsqldatabasetofailovergroup)|Добавляет одну или несколько баз данных в группу failover|

### <a name="manage-sql-database-failover-groups-with-managed-instances"></a>Управление группами сбоя в базе данных с управляемыми экземплярами

| Командлет | Описание |
| --- | --- |
| [New-AzSqlDatabaseInstanceFailoverGroup](/powershell/module/az.sql/new-azsqldatabaseinstancefailovergroup) |Эта команда создает группу неудач и регистрирует ее как в первичных, так и на второстепенных экземплярах|
| [Set-AzSqlDatabaseInstanceOverGroup](/powershell/module/az.sql/set-azsqldatabaseinstancefailovergroup) |Изменяет конфигурацию группы неудач|
| [Get-AzSqlDatabaseInstanceFailoverGroup](/powershell/module/az.sql/get-azsqldatabaseinstancefailovergroup) |Извлекает конфигурацию группы failover|
| [Switch-AzSqlDatabaseInstanceFailoverGroup](/powershell/module/az.sql/switch-azsqldatabaseinstancefailovergroup) |Триггеры failover группы failover к вторичному экземпляру|
| [Удалить-AzSqlDatabaseInstanceOverGroup](/powershell/module/az.sql/remove-azsqldatabaseinstancefailovergroup) | Удаляет группу отработки отказа.|

# <a name="azure-cli"></a>[Лазурный CLI](#tab/azure-cli)

### <a name="manage-sql-database-failover-with-single-databases-and-elastic-pools"></a>Управление отработкой отказа баз данных SQL с отдельными базами данных и эластичными пулами

| Команда | Описание |
| --- | --- |
| [az sql failover-group create](/cli/azure/sql/failover-group#az-sql-failover-group-create) |Создает группу отработки отказа и регистрирует ее на основном сервере и сервере-получателе.|
| [az sql failover-группа удалить](/cli/azure/sql/failover-group#az-sql-failover-group-delete) | Удаляет группу сбоя с сервера |
| [az sql failover-group show](/cli/azure/sql/failover-group#az-sql-failover-group-show) | Извлекает конфигурацию группы failover |
| [az sql failover-группы обновление](/cli/azure/sql/failover-group#az-sql-failover-group-update) |Изменяет конфигурацию группы failover и/или добавляет одну или несколько баз данных в группу failover|
| [az sql failover-group set-primary](/cli/azure/sql/failover-group#az-sql-failover-group-set-primary) | Триггеры сбой из группы failover на вторичном сервере |

### <a name="manage-sql-database-failover-groups-with-managed-instances"></a>Управление группами сбоя в базе данных с управляемыми экземплярами

| Команда | Описание |
| --- | --- |
| [az sql экземпляр-failover-группа создать](/cli/azure/sql/instance-failover-group#az-sql-instance-failover-group-create) | Эта команда создает группу неудач и регистрирует ее как в первичных, так и на второстепенных экземплярах |
| [az sql экземпляр-failover-группа обновления](/cli/azure/sql/instance-failover-group#az-sql-instance-failover-group-update) | Изменяет конфигурацию группы неудач|
| [az sql экземпляр-failover-группа шоу](/cli/azure/sql/instance-failover-group#az-sql-instance-failover-group-show) | Извлекает конфигурацию группы failover|
| [az sql экземпляр-failover-группа set-primary](/cli/azure/sql/instance-failover-group#az-sql-instance-failover-group-set-primary) | Триггеры failover группы failover к вторичному экземпляру|
| [az sql экземпляр-failover-группа удаления](/cli/azure/sql/instance-failover-group#az-sql-instance-failover-group-delete) | Удаляет группу отработки отказа. |

* * *

> [!IMPORTANT]
> Пример сценария см. в статье [Use PowerShell to configure an active geo-replication failover group for a single Azure SQL database](scripts/sql-database-add-single-db-to-failover-group-powershell.md) (Использование PowerShell для настройки группы отработки отказа активной георепликации для отдельной базы данных SQL Azure).

### <a name="rest-api-manage-sql-database-failover-groups-with-single-and-pooled-databases"></a>REST API: Управление группами сбоя в базе данных S'L с едиными и объединенными базами данных

| API | Описание |
| --- | --- |
| [Создание или обновление группы отработки отказа](https://docs.microsoft.com/rest/api/sql/failovergroups/createorupdate) | Создает или обновляет группу отработки отказа. |
| [Удаление группы отработки отказа](https://docs.microsoft.com/rest/api/sql/failovergroups/delete) | Удаляет группу сбоя с сервера |
| [Плановая отработка отказа](https://docs.microsoft.com/rest/api/sql/failovergroups/failover) | Триггеры перетекают с текущего основного сервера на вторичный сервер с полной синхронизацией данных.|
| [Принудительная отработка отказа (возможна потеря данных)](https://docs.microsoft.com/rest/api/sql/failovergroups/forcefailoverallowdataloss) | Триггеры перетекают с текущего основного сервера на вторичный сервер без синхронизации данных. Эта операция может привести к потере данных. |
| [Получение группы отработки отказа](https://docs.microsoft.com/rest/api/sql/failovergroups/get) | Извлекает конфигурацию группы failover. |
| [Вывод списка групп отработки отказа с фильтрацией по серверу](https://docs.microsoft.com/rest/api/sql/failovergroups/listbyserver) | Списки групп failover на сервере. |
| [Обновление группы отработки отказа](https://docs.microsoft.com/rest/api/sql/failovergroups/update) | Обновление конфигурации группы неудачи. |

### <a name="rest-api-manage-failover-groups-with-managed-instances"></a>REST API: Управление группами неудач с управляемыми инстанциями

| API | Описание |
| --- | --- |
| [Создание или обновление группы отработки отказа](https://docs.microsoft.com/rest/api/sql/instancefailovergroups/createorupdate) | Создает или обновляет конфигурацию группы неудач |
| [Удаление группы отработки отказа](https://docs.microsoft.com/rest/api/sql/instancefailovergroups/delete) | Удаляет группу сбоя из экземпляра |
| [Плановая отработка отказа](https://docs.microsoft.com/rest/api/sql/instancefailovergroups/failover) | Триггеры сбой от текущего первичного экземпляра к данному экземпляру с полной синхронизацией данных. |
| [Принудительная отработка отказа (возможна потеря данных)](https://docs.microsoft.com/rest/api/sql/instancefailovergroups/forcefailoverallowdataloss) | Триггеры перекрываются от текущего первичного экземпляра к вторичному экземпляру без синхронизации данных. Эта операция может привести к потере данных. |
| [Получение группы отработки отказа](https://docs.microsoft.com/rest/api/sql/instancefailovergroups/get) | получает конфигурацию группы failover. |
| [Перечисление групп отработки отказа – Перечисление по расположению](https://docs.microsoft.com/rest/api/sql/instancefailovergroups/listbylocation) | Перечисляет группы отработки отказа в расположении. |

## <a name="next-steps"></a>Дальнейшие действия

- Подробные учебники см.
    - [Добавление единой базы данных в группу failover](sql-database-single-database-failover-group-tutorial.md)
    - [Добавление эластичного пула в группу отработки отказа](sql-database-elastic-pool-failover-group-tutorial.md)
    - [Добавление управляемого экземпляра в группу failover](sql-database-managed-instance-failover-group-tutorial.md)
- Ознакомьтесь с примерами скриптов в следующих статьях:
  - [Настройка активной георепликации для отдельной базы данных в Базе данных SQL Azure с помощью PowerShell](scripts/sql-database-setup-geodr-and-failover-database-powershell.md)
  - [Настройка активной георепликации для базы данных в пуле в Базе данных SQL Azure с помощью PowerShell](scripts/sql-database-setup-geodr-and-failover-pool-powershell.md)
  - [Добавление отдельной базы данных в службе "База данных SQL Azure" в группу отработки отказа с помощью PowerShell](scripts/sql-database-add-single-db-to-failover-group-powershell.md)
- Сведения об обеспечении непрерывности бизнес-процессов и возможные сценарии описаны в [обзоре непрерывности бизнес-процессов](sql-database-business-continuity.md)
- Чтобы узнать о автоматизированных резервных отстах базы данных Azure S'L, [см.](sql-database-automated-backups.md)
- Чтобы узнать об использовании автоматизированных резервных ups для восстановления, [см.](sql-database-recovery-using-backups.md)
- Дополнительные сведения о требованиях к проверке подлинности для новых сервера-источника и базы данных-источника см. в статье [Безопасность базы данных SQL после аварийного восстановления](sql-database-geo-replication-security-config.md).
