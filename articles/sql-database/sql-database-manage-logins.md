---
title: Авторизация доступа к серверу и базе данных с помощью имен входа и учетных записей пользователей
description: Узнайте, как база данных SQL Azure и Azure синапсе Analytics проверяют подлинность пользователей для доступа с помощью имен входа и учетных записей пользователей. Также Узнайте, как роли базы данных и явные разрешения на авторизацию имен входа и пользователей выполнять действия и запрашивать данные.
keywords: безопасность баз данных SQL, управление безопасностью баз данных, защита входа в систему, безопасность баз данных, доступ к базе данных
services: sql-database
ms.service: sql-database
ms.subservice: security
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: VanMSFT
ms.author: vanto
ms.reviewer: carlrab
ms.date: 03/23/2020
ms.openlocfilehash: 0f1611e6d3524cc78fc20fed9d1aac6f3fd453fa
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "82106446"
---
# <a name="authorizing-database-access-to-authenticated-users-to-sql-database-and-azure-synapse-analytics-using-logins-and-user-accounts"></a>Авторизация доступа к базе данных для пользователей, прошедших аутентификацию, в базе данных SQL и Azure синапсе Analytics с помощью имен входа и учетных записей пользователей

В этой статье вы узнаете о следующих возможностях:

- Параметры для настройки базы данных SQL Azure и Azure синапсе Analytics (прежнее хранилище данных SQL Azure) позволяют пользователям выполнять административные задачи и доступ к данным, хранящимся в этих базах данных.
- Настройка доступа и авторизации после первоначального создания новой базы данных SQL Azure
- Добавление имен входа и учетных записей пользователей в базу данных master и учетные записи пользователей, а затем предоставление этих учетных записей разрешений администратора
- Добавление учетных записей пользователей в пользовательские базы данных, связанных с именами входа или содержащимися в них учетными записями пользователей
- Настройка учетных записей пользователей с правами в пользовательских базах данных с помощью ролей базы данных и явных разрешений

> [!IMPORTANT]
> Базы данных в базе данных SQL Azure и Azure синапсе Analytics (ранее — хранилище данных SQL Azure) называются в оставшейся части этой статьи как базы данных или Azure SQL (для простоты).

## <a name="authentication-and-authorization"></a>Аутентификация и авторизация

[**Проверка подлинности**](sql-database-security-overview.md#authentication) — это процесс проверки пользователя на то, что он заказывает. Пользователь подключается к базе данных с помощью учетной записи пользователя.
Когда пользователь пытается подключиться к базе данных, он предоставляет учетную запись пользователя и сведения о проверке подлинности. Проверка подлинности пользователя выполняется с помощью одного из следующих двух методов проверки подлинности:

- [Проверка подлинности SQL](https://docs.microsoft.com/sql/relational-databases/security/choose-an-authentication-mode#connecting-through-sql-server-authentication).

  При использовании этого метода проверки подлинности пользователь отправляет имя учетной записи пользователя и связанный пароль для установления соединения. Этот пароль хранится в базе данных master для учетных записей пользователей, связанных с именем входа, или хранится в базе данных, содержащей учетные записи пользователей, *не* связанные с именем входа.
- [Аутентификация Azure Active Directory](sql-database-aad-authentication.md)

  При использовании этого метода проверки подлинности пользователь отправляет имя учетной записи пользователя и запрашивает, что служба использует учетные данные, хранящиеся в Azure Active Directory.

**Имена входа и пользователи**. в SQL Azure учетная запись пользователя в базе данных может быть связана с именем входа, хранящимся в базе данных master, или именем пользователя, хранящимся в отдельной базе данных.

- **Имя входа** — это отдельная учетная запись в базе данных master, с которой может быть связана учетная запись пользователя в одной или нескольких базах данных. Используя имя входа, учетные данные учетной записи пользователя сохраняются с именем входа.
- **Учетная запись пользователя** — это отдельная учетная запись в любой базе данных, которая может быть не связана с именем входа. Если учетная запись пользователя не связана с именем входа, то учетные данные сохраняются с учетной записью пользователя.

[**Авторизация**](sql-database-security-overview.md#authorization) для доступа к данным и выполнения различных действий управляется с помощью ролей базы данных и явных разрешений. Авторизация относится к разрешениям, назначенным пользователю, и определяет, что разрешено выполнять пользователю. Авторизация контролируется [членством в роли](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/database-level-roles) базы данных пользователя и [разрешениями уровня объектов](https://docs.microsoft.com/sql/relational-databases/security/permissions-database-engine). Обычно пользователям рекомендуется предоставлять наименьшие необходимые привилегии.

## <a name="existing-logins-and-user-accounts-after-creating-a-new-database"></a>Существующие имена входа и учетные записи пользователей после создания новой базы данных

При создании первого развертывания SQL Azure вы указываете имя входа администратора и соответствующий пароль для этого имени входа. Эта административная учетная запись называется **администратором сервера**. Следующая конфигурация имен входа и пользователей в базах данных master и User происходит во время развертывания:

- Имя входа SQL с правами администратора создается с использованием указанного имени входа. [Имя входа](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/principals-database-engine#sa-login) — это учетная запись отдельного пользователя для входа в базу данных SQL.
- Этому имени входа предоставляются полные административные разрешения на все базы данных в качестве [участника уровня сервера](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/principals-database-engine). Это имя входа имеет все доступные разрешения в базе данных SQL и не может быть ограничено. В управляемом экземпляре это имя входа добавляется к [предопределенной роли сервера sysadmin](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/server-level-roles) (эта роль не существует в одной или в составе пулов баз данных).
- Для этого имени входа `dbo` в каждой пользовательской базе данных создается [учетная запись пользователя](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/getting-started-with-database-engine-permissions#database-users) с именем. У пользователя [dbo](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/principals-database-engine) есть все разрешения базы данных, и он сопоставлен с `db_owner` предопределенной ролью базы данных. Дополнительные предопределенные роли базы данных обсуждаются далее в этой статье.

Чтобы найти учетные записи администратора для базы данных, откройте портал Azure и перейдите на вкладку **Свойства** сервера или управляемого экземпляра.

![Администраторы SQL Server](media/sql-database-manage-logins/sql-admins.png)

![Администраторы SQL Server](media/sql-database-manage-logins/sql-admins2.png)

> [!IMPORTANT]
> Имя для входа администратора нельзя изменить после его создания. Чтобы сбросить пароль администратора логического сервера, перейдите в [портал Azure](https://portal.azure.com), выберите **серверы SQL Server**, выберите сервер из списка и нажмите кнопку **сбросить пароль**. Чтобы сбросить пароль для сервера управляемого экземпляра, перейдите в портал Azure, щелкните экземпляр и нажмите кнопку **сбросить пароль**. Можно также использовать PowerShell или Azure CLI.

## <a name="create-additional-logins-and-users-having-administrative-permissions"></a>Создание дополнительных учетных записей и пользователей, имеющих административные разрешения

На этом этапе экземпляр SQL Azure настроен для доступа только с помощью одного имени входа SQL и учетной записи пользователя. Для создания дополнительных учетных записей с полными или частичными административными разрешениями доступны следующие варианты (в зависимости от режима развертывания).

- **Создание учетной записи администратора Azure Active Directory с полными правами администратора**

  Включите проверку подлинности Azure Active Directory и создайте учетную запись администратора Azure AD. Одну учетную запись Azure Active Directory можно настроить в качестве администратора для развертывания базы данных SQL с полными разрешениями администратора. Эта учетная запись может быть отдельной учетной записью или группой безопасности. Администратор Azure AD **должен** быть настроен, если вы хотите использовать учетные записи Azure AD для подключения к базе данных SQL. Подробные сведения о включении проверки подлинности Azure AD для всех типов развертывания базы данных SQL см. в следующих статьях:

  - [Использование аутентификации Azure Active Directory для аутентификации с помощью SQL](sql-database-aad-authentication.md)
  - [Настройка и администрирование аутентификации Azure Active Directory с помощью SQL](sql-database-aad-authentication-configure.md)

- **В развертывании управляемого экземпляра Создайте имена входа SQL с полными разрешениями администратора.**

  - Создание дополнительного имени входа SQL Server в управляемом экземпляре
  - Добавьте имя входа к [предопределенной роли сервера sysadmin](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/server-level-roles) с помощью инструкции [ALTER Server Role](https://docs.microsoft.com/sql/t-sql/statements/alter-server-role-transact-sql) . Это имя для входа будет иметь полные административные разрешения.
  - Кроме того, можно создать [имя входа Azure AD](sql-database-aad-authentication-configure.md?tabs=azure-powershell#new-azure-ad-admin-functionality-for-mi) с помощью синтаксиса <a href="/sql/t-sql/statements/create-login-transact-sql?view=azuresqldb-mi-current">CREATE LOGIN</a> .

- **В одном развертывании или в составе пула Создайте имена входа SQL с ограниченными правами администратора.**

  - Создание дополнительного имени входа SQL в базе данных master для одного или для развертывания базы данных в составе пула или развертывания управляемого экземпляра
  - Создание учетной записи пользователя в базе данных master, связанной с новым именем входа
  - Добавьте учетную запись пользователя в `dbmanager`, `loginmanager` роль или в обе в `master` базе данных с помощью инструкции [ALTER Server Role](https://docs.microsoft.com/sql/t-sql/statements/alter-server-role-transact-sql) (для Azure синапсе Analytics используйте инструкцию [sp_addrolemember](https://docs.microsoft.com/sql/relational-databases/system-stored-procedures/sp-addrolemember-transact-sql) ).

  > [!NOTE]
  > `dbmanager`роли `loginmanager` и **не** относятся к развертываниям управляемого экземпляра.

  Члены этих [специальных ролей главной базы данных](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/database-level-roles#special-roles-for--and-) для баз данных в одной или в составе пула позволяют пользователям иметь право создавать базы данных и управлять ими, а также создавать имена для входа и управлять ими. В базах данных, созданных пользователем, который является членом `dbmanager` роли, член сопоставляется с `db_owner` предопределенной ролью базы данных и может входить в эту базу данных и управлять ею `dbo` с помощью учетной записи пользователя. Эти роли не имеют явных разрешений вне базы данных master.

  > [!IMPORTANT]
  > Нельзя создать дополнительное имя входа SQL с полными правами администратора в одной базе данных или в составе пула.

## <a name="create-accounts-for-non-administrator-users"></a>Создание учетных записей для пользователей без прав администратора

Учетные записи для пользователей, не имеющих прав администратора, можно создать одним из двух способов:

- **Создает вход**

  Создайте имя входа SQL в базе данных master. Затем создайте учетную запись пользователя в каждой базе данных, к которой пользователю требуется доступ, и свяжите учетную запись пользователя с этим именем входа. Этот подход предпочтителен, если пользователь должен получить доступ к нескольким базам данных и вы хотите синхронизировать пароли. Однако этот подход имеет сложности при использовании георепликации, так как имя входа должно быть создано как на сервере-источнике, так и на вторичном сервере (серверах). Дополнительные сведения см. в статье [Настройка безопасности базы данных SQL Azure для геовосстановления или отработки отказа](sql-database-geo-replication-security-config.md).
- **Создание учетной записи пользователя**

  Создайте учетную запись пользователя в базе данных, к которой пользователю требуется доступ (также называемый [автономным пользователем](https://docs.microsoft.com/sql/relational-databases/security/contained-database-users-making-your-database-portable)).

  - В одной базе данных или в составе пула можно всегда создавать учетную запись этого типа.
  - В базе данных управляемого экземпляра, не поддерживающей [субъекты сервера Azure AD](sql-database-aad-authentication-configure.md?tabs=azure-powershell#create-contained-database-users-in-your-database-mapped-to-azure-ad-identities), можно создать только этот тип учетной записи пользователя в [автономной базе данных](https://docs.microsoft.com/sql/relational-databases/databases/contained-databases). Используя управляемый экземпляр, поддерживающий [субъекты-серверы Azure AD](sql-database-aad-authentication-configure.md?tabs=azure-powershell#create-contained-database-users-in-your-database-mapped-to-azure-ad-identities), можно создать учетные записи пользователей для проверки подлинности в управляемом экземпляре, не требуя создания пользователей базы данных в качестве пользователя автономной базы данных.

  При таком подходе сведения о проверке подлинности пользователя хранятся в каждой базе данных и автоматически реплицируются в геореплицированные базы данных. Однако если одна и та же учетная запись существует в нескольких базах данных и используется проверка подлинности SQL, пароли необходимо синхронизировать вручную. Кроме того, если у пользователя есть учетная запись в разных базах данных с разными паролями, помните, что эти пароли могут стать проблемой.

> [!IMPORTANT]
> Чтобы создать автономных пользователей, сопоставленных с удостоверениями Azure AD, необходимо войти в систему с помощью учетной записи Azure AD, которая является администратором в базе данных SQL. В управляемом экземпляре имя входа SQL `sysadmin` с разрешениями также может создавать имя входа или пользователя Azure AD.

Примеры, демонстрирующие создание имен входа и пользователей, см. в следующих статьях:

- [Создание имени входа для баз данных в одной или в составе пула](https://docs.microsoft.com/sql/t-sql/statements/create-login-transact-sql?view=azuresqldb-current#examples-1)
- [Создание имени входа для базы данных управляемого экземпляра](https://docs.microsoft.com/sql/t-sql/statements/create-login-transact-sql?view=azuresqldb-mi-current#examples-2)
- [Создание имени входа для базы данных Azure синапсе Analytics](https://docs.microsoft.com/sql/t-sql/statements/create-login-transact-sql?view=azure-sqldw-latest#examples-3)
- [Создание пользователя](https://docs.microsoft.com/sql/t-sql/statements/create-user-transact-sql#examples)
- [Создание пользователей, содержащихся в Azure AD](sql-database-aad-authentication-configure.md#create-contained-database-users-in-your-database-mapped-to-azure-ad-identities)

> [!TIP]
> Руководство по безопасности, включающее создание SQL Server автономных пользователей в одной базе данных или в составе пула, см. в разделе [учебник. обеспечение безопасности отдельной базы данных или в составе пула](sql-database-security-tutorial.md).

## <a name="using-fixed-and-custom-database-roles"></a>Использование фиксированных и пользовательских ролей базы данных

После создания учетной записи пользователя в базе данных на основе имени входа или автономного пользователя можно авторизовать этого пользователя для выполнения различных действий и доступа к данным в определенной базе данных. Для авторизации доступа можно использовать следующие методы:

- **Предопределенные роли базы данных**

  Добавьте учетную запись пользователя к [предопределенной роли базы данных](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/database-level-roles). Существует 9 фиксированных ролей базы данных, каждый из которых имеет определенный набор разрешений. Наиболее распространенные предопределенные роли базы данных: **db_owner**, **db_ddladmin**, **db_datawriter**, **db_datareader**, **db_denydatawriter**и **db_denydatareader**. Роль **db_owner** обычно используется для предоставления полных прав ограниченному числу пользователей. Другие фиксированные роли можно использовать для быстрого получения простых баз данных при разработке, но их не рекомендуется использовать для большинства рабочих баз данных. Например, предопределенная роль базы данных **db_datareader** предоставляет доступ на чтение к каждой таблице в базе данных, что более строго требуется.

  - Чтобы добавить пользователя к предопределенной роли базы данных, выполните следующие действия.

    - В базе данных SQL Azure используйте инструкцию [ALTER ROLE](https://docs.microsoft.com/sql/t-sql/statements/alter-role-transact-sql) . Примеры см. в разделе [ALTER ROLE examples](https://docs.microsoft.com/sql/t-sql/statements/alter-role-transact-sql#examples) .
    - Azure синапсе Analytics используйте инструкцию [sp_addrolemember](https://docs.microsoft.com/sql/relational-databases/system-stored-procedures/sp-addrolemember-transact-sql) . Примеры см. в разделе [sp_addrolemember примеры](https://docs.microsoft.com/sql/t-sql/statements/alter-role-transact-sql).

- **Пользовательская роль базы данных**

  Создайте пользовательскую роль базы данных с помощью инструкции [CREATE ROLE](https://docs.microsoft.com/sql/t-sql/statements/create-role-transact-sql) . Настраиваемая роль позволяет создавать собственные пользовательские роли базы данных и тщательно предоставлять каждой роли минимальные разрешения, необходимые для нужд бизнеса. Затем можно добавить пользователей в пользовательскую роль. Если пользователь является участником нескольких ролей, то ему предоставлены разрешения всех этих ролей.
- **Предоставление разрешений напрямую**

  Предоставьте [разрешения](https://docs.microsoft.com/sql/relational-databases/security/permissions-database-engine) учетной записи пользователя напрямую. Существует более 100 разрешений, которые можно по отдельности предоставлять или отменять в базе данных SQL. Многие эти разрешения являются частью других разрешений. Например, разрешение `UPDATE` на схеме включает в себя разрешение `UPDATE` для каждой таблицы в этой схеме. Как и в большинстве систем разрешений, отмена разрешения переопределяет предоставление. Так как некоторые разрешения включены в другие разрешения и их достаточно много, необходимо внимательно изучить их, чтобы спроектировать соответствующую систему разрешений, которая будет надежно защищать базу данных. Изучите список разрешений на [этой странице](https://docs.microsoft.com/sql/relational-databases/security/permissions-database-engine) и ознакомьтесь с [графическим представлением](https://docs.microsoft.com/sql/relational-databases/security/media/database-engine-permissions.png) разрешений.

## <a name="using-groups"></a>Использование групп

Эффективное управление доступом использует разрешения, назначенные Active Directory группам безопасности, фиксированным или пользовательским ролям, а не отдельным пользователям.

- При использовании Azure Active Directory проверки подлинности помещайте Azure Active Directory пользователей в группу безопасности Azure Active Directory. Создайте пользователя автономной базы данных для группы. Поместите одного или нескольких пользователей базы данных в пользовательскую роль базы данных с конкретными разрешениями, соответствующими этой группе пользователей.

- При использовании проверки подлинности SQL создайте пользователей автономной базы данных в базе данных. Поместите одного или нескольких пользователей базы данных в пользовательскую роль базы данных с конкретными разрешениями, соответствующими этой группе пользователей.

  > [!NOTE]
  > Можно также использовать группы для пользователей неавтономной базы данных.

Ознакомьтесь со следующими возможностями, которые можно использовать, чтобы ограничить или расширить права:

- Чтобы безопасно временно повысить уровень разрешений, можно использовать [олицетворение](https://docs.microsoft.com/dotnet/framework/data/adonet/sql/customizing-permissions-with-impersonation-in-sql-server) и [подписание модулей](https://docs.microsoft.com/dotnet/framework/data/adonet/sql/signing-stored-procedures-in-sql-server).
- [Безопасности на уровне строк](https://docs.microsoft.com/sql/relational-databases/security/row-level-security) может использоваться, чтобы ограничить доступ пользователя к строкам.
- [Маскирование данных](sql-database-dynamic-data-masking-get-started.md) позволяет снизить уязвимость конфиденциальных данных.
- [хранимые процедуры](https://docs.microsoft.com/sql/relational-databases/stored-procedures/stored-procedures-database-engine) .

## <a name="next-steps"></a>Дальнейшие шаги

Обзор всех функций защиты в базе данных SQL см. в [этой статье](sql-database-security-overview.md).
