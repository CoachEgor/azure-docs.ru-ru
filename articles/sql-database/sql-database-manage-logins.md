---
title: Разрешить доступ к серверу и базе данных с помощью логинов и учетных записей пользователей
description: Узнайте о том, как база данных Azure S'L и Azure Synapse Analytics проверяет аутентификации пользователей для доступа с помощью логинов и учетных записей пользователей. Также узнайте, как создать роли баз данных и явные разрешения на разрешение логинов и пользователей выполнять действия и данные запросов.
keywords: безопасность баз данных SQL, управление безопасностью баз данных, защита входа в систему, безопасность баз данных, доступ к базе данных
services: sql-database
ms.service: sql-database
ms.subservice: security
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: VanMSFT
ms.author: vanto
ms.reviewer: carlrab
ms.date: 03/23/2020
ms.openlocfilehash: 98c15fe11b64e8c177e60a2ea1eb7c50eaf69353
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80124810"
---
# <a name="authorizing-database-access-to-authenticated-users-to-sql-database-and-azure-synapse-analytics-using-logins-and-user-accounts"></a>Разрешение доступа к базе данных для аутентифицированных пользователей к базе данных S'L и Azure Synapse Analytics с использованием логинов и учетных записей пользователей

В этой статье вы узнаете о:

- Варианты настройки базы данных Azure S'L и аналитики Azure Synapse (ранее Хранилище данных Azure S'L), позволяющие пользователям выполнять административные задачи и получать доступ к данным, хранящимся в этих базах данных.
- Конфигурация доступа и авторизации после первоначального создания новой базы данных Azure S'L
- Как добавить логины и учетные записи пользователей в основной базе данных и учетные записи пользователей, а затем предоставить этим учетным записям административные разрешения
- Как добавить учетные записи пользователей в базы данных пользователей, связанных с логинами или как содержащиеся учетные записи пользователей
- Настройка учетных записей пользователей с разрешениями в базах данных пользователей с помощью ролей баз данных и явных разрешений

> [!IMPORTANT]
> Базы данных в базе данных Azure S'L и Azure Synapse Analytics (ранее хранилище данных Azure S'L) в оставшейся части этой статьи называются либо базами данных, либо лазурным газом (для простоты).

## <a name="authentication-and-authorization"></a>Аутентификация и авторизация

[**Аутентификация**](sql-database-security-overview.md#authentication) — это процесс доказательства того, кем он себя выружат. Пользователь подключается к базе данных с помощью учетной записи пользователя.
Когда пользователь пытается подключиться к базе данных, он предоставляет учетную запись пользователя и информацию о проверке подлинности. Пользователь проверяется с помощью одного из следующих двух методов проверки подлинности:

- [Проверка подлинности S'L](https://docs.microsoft.com/sql/relational-databases/security/choose-an-authentication-mode#connecting-through-sql-server-authentication).

  С помощью этого метода проверки подлинности пользователь отправляет имя учетной записи пользователя и связанный с ним пароль для установления соединения. Этот пароль хранится в основной базе данных для учетных записей пользователей, связанных с логином или хранящихся в базе данных, содержащей учетную запись пользователя для учетных записей пользователей, не связанных с логином.
- [проверка подлинности Azure Active Directory](sql-database-aad-authentication.md);

  С помощью этого метода проверки подлинности пользователь отправляет имя учетной записи пользователя и просит службу использовать информацию о учетных данных, хранящуюся в Active Directory Azure.

**Логины и пользователи:** в Azure S'L учетная запись пользователя в базе данных может быть связана с логином, который хранится в основной базе данных или может быть именем пользователя, которое хранится в отдельной базе данных.

- **Логин** — это индивидуальная учетная запись в основной базе данных, к которой может быть связана учетная запись пользователя в одной или нескольких базах данных. С помощью входа информация о учетных данных учетной записи пользователя хранится с помощью входа.
- **Учетная запись пользователя** — это индивидуальная учетная запись в любой базе данных, которая может быть, но не должна быть связана с логином. С учетной записью пользователя, которая не связана с логином, информация о учетных данных хранится в учетной записи пользователя.

[**Авторизация**](sql-database-security-overview.md#authorization) доступа к данным и выполнения различных действий управляется с использованием ролей базы данных и явных разрешений. Авторизация относится к разрешениям, назначенным пользователю, и определяет, что этот пользователь может делать. Авторизация контролируется [членством в роли учетной](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/database-level-roles) записи пользователя и [разрешениями на уровне объектов.](https://docs.microsoft.com/sql/relational-databases/security/permissions-database-engine) Обычно пользователям рекомендуется предоставлять наименьшие необходимые привилегии.

## <a name="existing-logins-and-user-accounts-after-creating-a-new-database"></a>Существующие логины и учетные записи пользователей после создания новой базы данных

При создании первого развертывания Azure S'L указывается логин для админ-и связанный пароль для этого входа. Эта административная учетная запись называется **Администратором сервера.** Следующая конфигурация логинов и пользователей в базе данных мастер и пользователя происходит во время развертывания:

- С помощью указанного вами имени входа создается логин с административными привилегиями. [Логин](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/principals-database-engine#sa-login) — это индивидуальный учетный записи пользователя для входа в базу данных S'L.
- Этот логин предоставляется полные административные разрешения на все базы данных в качестве [основного сервера.](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/principals-database-engine) Этот логин имеет все доступные разрешения в базе данных S'L и не может быть ограничен. В управляемом экземпляре этот логин добавляется к [фиксированной роли сервера sysadmin](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/server-level-roles) (эта роль не существует с отдельными или объединенными базами данных).
- Учетная запись `dbo` [пользователя](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/getting-started-with-database-engine-permissions#database-users) называется создается для этого входа в каждую базу данных пользователей. Пользователь [dbo](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/principals-database-engine) имеет все разрешения базы данных в `db_owner` базе данных и отображается в фиксированной роли базы данных. Дополнительные роли фиксированной базы данных обсуждаются позднее в этой статье.

Чтобы определить учетные записи администратора для базы данных, откройте портал Azure и перейдите на вкладку **«Свойства»** вашего сервера или управляемого экземпляра.

![Администраторы SQL Server](media/sql-database-manage-logins/sql-admins.png)

![Администраторы SQL Server](media/sql-database-manage-logins/sql-admins2.png)

> [!IMPORTANT]
> Имя входа в систему admin не может быть изменено после его создания. Чтобы сбросить пароль для администратора логического сервера, перейдите на [портал Azure,](https://portal.azure.com)щелкните **серверы S'L,** выберите сервер из списка, а затем нажмите **Sset Password.** Чтобы сбросить пароль для управляемого сервера экземпляра, перейдите на портал Azure, нажмите на экземпляр и нажмите **пароль Спрочки.** Вы также можете использовать PowerShell или Azure CLI.

## <a name="create-additional-logins-and-users-having-administrative-permissions"></a>Создание дополнительных логинов и пользователей, имеющих административные разрешения

На этом этапе экземпляр Azure S'L настроен только для доступа с помощью одного входа в систему и учетной записи пользователя. Для создания дополнительных логинов с полными или частичными административными разрешениями у вас есть следующие параметры (в зависимости от режима развертывания):

- **Создание учетной записи администратора активных каталогов Azure с полными административными разрешениями**

  Включите активную проверку каталога Azure и создайте логин администратора Azure AD. Одна учетная запись Active Directory Azure может быть настроена как администратор развертывания базы данных с полными административными разрешениями. Эта учетная запись может быть как индивидуальным, так и учетной записью группы безопасности. Администратор Azure AD **должен** быть настроен, если вы хотите использовать учетные записи Azure AD для подключения к базе данных S'L. Подробную информацию о включении аутентификации Azure AD для всех типов развертывания базы данных S'L можно узнать в следующих статьях:

  - [Использование аутентификации Azure Active Directory для аутентификации с помощью SQL](sql-database-aad-authentication.md)
  - [Настройка и администрирование аутентификации Azure Active Directory с помощью SQL](sql-database-aad-authentication-configure.md)

- **В управляемом развертывании экземпляра создайте логины S'L с полными административными разрешениями**

  - Создание дополнительного входа в систему S'L Server в управляемом экземпляре
  - Добавьте логин в [сисадмин с фиксированной ролью сервера](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/server-level-roles) с помощью оператора [ALTER SERVER ROLE.](https://docs.microsoft.com/sql/t-sql/statements/alter-server-role-transact-sql) Этот логин будет иметь полные административные разрешения.
  - Кроме того, создайте [логин Azure AD](sql-database-aad-authentication-configure.md?tabs=azure-powershell#new-azure-ad-admin-functionality-for-mi) с помощью синтаксиса <a href="/sql/t-sql/statements/create-login-transact-sql?view=azuresqldb-mi-current">CREATE LOGIN.</a>

- **В одном или объединенном развертывании создавайте логины S'L, имеющие ограниченные административные разрешения**

  - Создание дополнительного входа в веб-базу для создания основной базы данных для развертывания единой или объединенной базы данных или управляемого развертывания экземпляра
  - Создание учетной записи пользователя в основной базе данных, связанной с этим новым логином
  - Добавьте учетную `dbmanager`запись `loginmanager` пользователя в эту `master` роль или оба в базе данных с помощью оператора [ALTER SERVER ROLE](https://docs.microsoft.com/sql/t-sql/statements/alter-server-role-transact-sql) (для Azure Synapse Analytics, используйте [sp_addrolemember](https://docs.microsoft.com/sql/relational-databases/system-stored-procedures/sp-addrolemember-transact-sql) заявление).

  > [!NOTE]
  > `dbmanager`и `loginmanager` роли **не** относятся к управляемым развертываниям экземпляров.

  Члены этих [специальных ролей мастер-базы данных](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/database-level-roles#special-roles-for--and-) для отдельных или объединенных баз данных позволяют пользователям иметь право создавать и управлять базами данных или создавать и управлять логинами. В базах данных, созданных пользователем, который является `dbmanager` членом `db_owner` роли, участник отображается на определенную `dbo` роль базы данных и может войти в эту базу данных и управлять ею с помощью учетной записи пользователя. Эти роли не имеют явных разрешений за пределами основной базы данных.

  > [!IMPORTANT]
  > Вы не можете создать дополнительный логин с полными административными разрешениями в единой или объединенной базе данных.

## <a name="create-accounts-for-non-administrator-users"></a>Создание учетных записей для пользователей, не являющихся администраторами

Вы можете создавать учетные записи для неадминистративных пользователей с помощью одного из двух методов:

- **Создание входа**

  Создайте логин в основной базе данных. Затем создайте учетную запись пользователя в каждой базе данных, к которой этот пользователь нуждается в доступе, и связывайте учетную запись пользователя с этим логином. Этот подход является предпочтительным, когда пользователь должен получить доступ к нескольким базам данных, и вы хотите сохранить пароли синхронизированы. Однако этот подход имеет сложности при использовании с георепликацией, поскольку логин должен быть создан как на основном сервере, так и на вторичном сервере (ы). Для получения дополнительной информации [см. Налажнете и управляйте безопасностью базы данных Azure s'L для геовосстановления или сбоя.](sql-database-geo-replication-security-config.md)
- **Создание учетной записи пользователя**

  Создайте учетную запись пользователя в базе данных, к которой пользователь нуждается в доступе (также называемый [содержащимся пользователем).](https://docs.microsoft.com/sql/relational-databases/security/contained-database-users-making-your-database-portable)

  - С помощью единой или объединенной базы данных всегда можно создать этот тип учетной записи пользователя.
  - С помощью управляемой базы данных экземпляров, которая не поддерживает [принципы серверов Azure AD,](sql-database-aad-authentication-configure.md?tabs=azure-powershell#create-contained-database-users-in-your-database-mapped-to-azure-ad-identities)можно создать этот тип учетной записи пользователя только в [содержащейся базе данных.](https://docs.microsoft.com/sql/relational-databases/databases/contained-databases) С управляемым экземпляром, поддерживающим [принципы сервера Azure AD,](sql-database-aad-authentication-configure.md?tabs=azure-powershell#create-contained-database-users-in-your-database-mapped-to-azure-ad-identities)можно создавать учетные записи пользователей для проверки подлинности управляемого экземпляра, не требуя, чтобы пользователи базы данных создавались как пользователь, содержащийся в базе данных.

  При таком подходе информация о проверке подлинности пользователя хранится в каждой базе данных и автоматически реплицируется в геореплицированные базы данных. Однако, если одна и та же учетная запись существует в нескольких базах данных, и вы используете проверку подлинности S'L, вы должны синхронизировать пароли вручную. Кроме того, если у пользователя есть учетная запись в разных базах данных с разными паролями, запоминание этих паролей может стать проблемой.

> [!IMPORTANT]
> Для создания содержащихся пользователей, отображаемых в идентификаторах Azure AD, необходимо войти в систему с помощью учетной записи Azure AD, которая является администратором в базе данных S'L. В управляемом экземпляре логин `sysadmin` с разрешениями может также создать логин или пользователя Azure AD.

Например, можно найти логины и пользователей:

- [Создание входа для отдельных или объединенных баз данных](https://docs.microsoft.com/sql/t-sql/statements/create-login-transact-sql?view=azuresqldb-current#examples-1)
- [Создание входа для базы данных управляемых экземпляров](https://docs.microsoft.com/sql/t-sql/statements/create-login-transact-sql?view=azuresqldb-mi-current#examples-2)
- [Создание входа в базу данных Azure Synapse Analytics](https://docs.microsoft.com/sql/t-sql/statements/create-login-transact-sql?view=azure-sqldw-latest#examples-3)
- [Создание пользователя](https://docs.microsoft.com/sql/t-sql/statements/create-user-transact-sql#examples)
- [Создание Azure AD содержало пользователей](sql-database-aad-authentication-configure.md#create-contained-database-users-in-your-database-mapped-to-azure-ad-identities)

> [!TIP]
> Для руководства по безопасности, включающего создание s'L Server, содержащихся в единой или объединенной базе [данных, см.](sql-database-security-tutorial.md)

## <a name="using-fixed-and-custom-database-roles"></a>Использование фиксированных ролей в базе данных и пользовательских данных

После создания учетной записи пользователя в базе данных, либо на основе входа или в качестве содержащегося пользователя, вы можете разрешить этому пользователю выполнять различные действия и получать доступ к данным в определенной базе данных. Вы можете использовать следующие методы для авторизации доступа:

- **Фиксированные роли базы данных**

  Добавьте учетную запись пользователя в [роль фиксированной базы данных.](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/database-level-roles) Имеется 9 фиксированных ролей базы данных, каждая из которых имеет определенный набор разрешений. Наиболее распространенными ролями фиксированной базы данных являются: **db_owner,** **db_ddladmin,** **db_datawriter,** **db_datareader,** **db_denydatawriter**и **db_denydatareader.** Роль **db_owner** обычно используется для предоставления полных прав ограниченному числу пользователей. Другие фиксированные роли можно использовать для быстрого получения простых баз данных при разработке, но их не рекомендуется использовать для большинства рабочих баз данных. Например, **db_datareader** фиксированной роли базы данных предоставляет доступ к каждой таблице в базе данных, что больше, чем строго необходимо.

  - Чтобы добавить пользователя к фиксированной роли базы данных:

    - В базе данных Azure S'L используйте заявление [ALTER ROLE.](https://docs.microsoft.com/sql/t-sql/statements/alter-role-transact-sql) Например, [см.](https://docs.microsoft.com/sql/t-sql/statements/alter-role-transact-sql#examples)
    - Спользуйте [sp_addrolemember-](https://docs.microsoft.com/sql/relational-databases/system-stored-procedures/sp-addrolemember-transact-sql) Например, [смsp_addrolemember примерах](https://docs.microsoft.com/sql/t-sql/statements/alter-role-transact-sql).

- **Роль пользовательской базы данных**

  Создайте роль пользовательской базы данных с помощью оператора [CREATE ROLE.](https://docs.microsoft.com/sql/t-sql/statements/create-role-transact-sql) Пользовательская роль позволяет создавать собственные роли базы данных, определяемые пользователями, и тщательно предоставлять каждой роли наименьшие разрешения, необходимые для необходимости бизнеса. Затем можно добавить пользователей к пользовательской роли. Если пользователь является участником нескольких ролей, то ему предоставлены разрешения всех этих ролей.
- **Разрешения на гранты напрямую**

  Напрямую предоставь разрешения учетной [записи](https://docs.microsoft.com/sql/relational-databases/security/permissions-database-engine) пользователя. Существует более 100 разрешений, которые можно по отдельности предоставлять или отменять в базе данных SQL. Многие эти разрешения являются частью других разрешений. Например, разрешение `UPDATE` на схеме включает в себя разрешение `UPDATE` для каждой таблицы в этой схеме. Как и в большинстве систем разрешений, отмена разрешения переопределяет предоставление. Так как некоторые разрешения включены в другие разрешения и их достаточно много, необходимо внимательно изучить их, чтобы спроектировать соответствующую систему разрешений, которая будет надежно защищать базу данных. Изучите список разрешений на [этой странице](https://docs.microsoft.com/sql/relational-databases/security/permissions-database-engine) и ознакомьтесь с [графическим представлением](https://docs.microsoft.com/sql/relational-databases/security/media/database-engine-permissions.png) разрешений.

## <a name="using-groups"></a>Использование групп

Эффективное управление доступом использует разрешения, присвоенные группам безопасности Active Directory, и фиксированные или пользовательские роли, а не отдельным пользователям.

- При использовании проверки подлинности Active Directory Azure поместите пользователей Active Directory Azure в группу безопасности Active Directory Azure. Создайте пользователя автономной базы данных для группы. Поместите одного или нескольких пользователей баз данных в определенную роль базы данных с конкретными разрешениями, подходящими этой группе пользователей.

- При использовании проверки подлинности S'L создавайте содержащиеся в базе данных пользователи базы данных. Поместите одного или нескольких пользователей баз данных в определенную роль базы данных с конкретными разрешениями, подходящими этой группе пользователей.

  > [!NOTE]
  > Вы также можете использовать группы для несодержащих пользователей баз данных.

Ознакомьтесь со следующими возможностями, которые можно использовать, чтобы ограничить или расширить права:

- Чтобы безопасно временно повысить уровень разрешений, можно использовать [олицетворение](https://docs.microsoft.com/dotnet/framework/data/adonet/sql/customizing-permissions-with-impersonation-in-sql-server) и [подписание модулей](https://docs.microsoft.com/dotnet/framework/data/adonet/sql/signing-stored-procedures-in-sql-server).
- [Безопасности на уровне строк](https://docs.microsoft.com/sql/relational-databases/security/row-level-security) может использоваться, чтобы ограничить доступ пользователя к строкам.
- [Маскирование данных](sql-database-dynamic-data-masking-get-started.md) позволяет снизить уязвимость конфиденциальных данных.
- [хранимые процедуры](https://docs.microsoft.com/sql/relational-databases/stored-procedures/stored-procedures-database-engine) .

## <a name="next-steps"></a>Дальнейшие действия

Обзор всех функций защиты в базе данных SQL см. в [этой статье](sql-database-security-overview.md).
