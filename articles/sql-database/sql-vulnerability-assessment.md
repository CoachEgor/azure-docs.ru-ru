---
title: Оценка уязвимостей SQL
description: Узнайте, как настроить оценку уязвимостей SQL в базе данных SQL Azure и интерпретировать отчеты об оценке.
services: sql-database
ms.service: sql-database
ms.subservice: security
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: mibar
ms.author: mibar
ms.reviewer: vanto, carlrab
ms.date: 04/19/2020
tags: azure-synapse
ms.openlocfilehash: 80629898b56f81fc738cb30df63766ea39adea6d
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "81684253"
---
# <a name="sql-vulnerability-assessment-helps-you-identify-database-vulnerabilities"></a>Оценка уязвимостей SQL позволяет обнаруживать уязвимости базы данных

Оценка уязвимостей SQL — это простая в настройке служба, которая может обнаруживать, записывать и помогать устранять потенциальные уязвимости базы данных. Используйте его, чтобы с упреждением повышать безопасность своей базы данных.

Оценка уязвимостей является частью [расширенного предложения по обеспечению безопасности данных](sql-database-advanced-data-security.md) , который является единым пакетом для расширенных возможностей обеспечения безопасности SQL. Доступ к оценке уязвимостей и управление ими можно получить с помощью центрального портала расширенной защиты данных SQL.

> [!NOTE]
> Оценка уязвимостей поддерживается для базы данных SQL Azure, управляемого экземпляра базы данных SQL Azure и Azure синапсе Analytics. Чтобы было проще, в этой статье База данных SQL используется при обращении к любой из этих служб управляемых баз данных.

## <a name="vulnerability-assessment"></a>Оценка уязвимости

Оценка уязвимостей SQL — это служба, которая обеспечивает видимость состояния безопасности. Оценка уязвимостей включает действия по устранению проблем безопасности и повышению уровня безопасности базы данных. Эта служба может помочь в выполнении следующих задач: 

- соблюдение нормативных требований, требующих отчетов о проверке базы данных;
- соблюдение стандартов конфиденциальности данных;
- мониторинг динамической среды базы данных, в которой сложно отслеживать изменения.

Оценка уязвимостей — это служба сканирования, встроенная в базу данных SQL Azure. Служба использует базу знаний правил, которые помечают уязвимости безопасности. Он выделяет отклонения от рекомендаций, таких как непредусмотренные настройки, чрезмерные разрешения и незащищенные конфиденциальные данные.

Правила основаны на рекомендациях корпорации Майкрософт и сосредоточены на вопросах безопасности, представляющих наибольшую опасность для базы данных и ее ценных данных. Они охватывают проблемы уровня базы данных и проблемы безопасности на уровне сервера, такие как параметры брандмауэра сервера и разрешения уровня сервера. В этих правилах также представлены многие требования различных контролирующих органов, что позволяет соблюдать стандарты соответствия.

Результаты проверки включают в себя практические действия по устранению каждой проблемы, а также настроенные скрипты исправления, если их можно применить. Вы можете настроить отчет об оценке для своей среды, установив допустимый базовый план для:
* Конфигурации разрешений.
* Конфигурации компонентов.
* Параметры базы данных.

## <a name="implement-vulnerability-assessment"></a>Реализация оценки уязвимостей

Следующие шаги реализуют оценку уязвимости в базе данных SQL.

### <a name="1-run-a-scan"></a>1. Запуск проверки

В области база данных SQL Azure под заголовком **Безопасность** выберите пункт **Расширенная защита данных**. Затем щелкните **выбрать хранилище** на панели " **Оценка уязвимостей** ", чтобы открыть панель параметров оценки уязвимостей для всего SQL Server.

Настройте учетную запись хранения, в которой будут храниться результаты проверки для всех баз данных на сервере. Дополнительные сведения об учетных записях хранения см. в разделе [Об учетных записях хранения Azure](../storage/common/storage-create-storage-account.md). После настройки хранилища выберите **Сканировать** , чтобы проверить базу данных на наличие уязвимостей.

![Проверка базы данных](./media/sql-vulnerability-assessment/pp_va_initialize.png)

  > [!NOTE]
  > Проверка безопасна и не требует большого количества ресурсов. Выполнение займет несколько секунд и полностью доступно только для чтения. Изменения в базе данных не вносятся.

### <a name="2-view-the-report"></a>2. Просмотр отчета

После завершения проверки отчет о проверке автоматически отображается в портал Azure. В отчете представлен обзор состояния безопасности. В нем указывается, сколько обнаруженных проблем и их серьезность. Результаты включают предупреждения о отклонениях от рекомендаций и моментальный снимок параметров безопасности, таких как субъекты и роли базы данных и связанные с ними разрешения. Отчет о сканировании также содержит карту конфиденциальных данных, обнаруженных в базе данных. Он включает рекомендации по классификации данных с помощью [обнаружения и классификации данных](sql-database-data-discovery-and-classification.md).

![Просмотр отчета](./media/sql-vulnerability-assessment/pp_main_getstarted.png)

### <a name="3-analyze-the-results-and-resolve-issues"></a>3. Анализ результатов и устранение проблем

Просмотрите результаты и определите, какие проблемы в отчете действительно нарушают безопасность в вашей среде. Изучите подробные сведения о каждой проблеме, чтобы понять, как она влияет на безопасность и почему проверка безопасности не пройдена. Используйте практические рекомендации по исправлению, представленные в отчете, чтобы устранить проблему.

![Анализ отчета](./media/sql-vulnerability-assessment/pp_fail_rule_show_remediation.png)

### <a name="4-set-your-baseline"></a>4. Задание базового уровня

При проверке результатов оценки можно пометить конкретные результаты как приемлемые *базовые показатели* в вашей среде. Базовые показатели — важные параметры, влияющие на содержимое отчета о проверке. При следующих проверках результаты, которые соответствуют базовым показателям, будут рассматриваться как прошедшие проверку. После того как вы установили базовое состояние безопасности, Оценка уязвимостей будет сообщать только об отклонениях от базовых показателей. Таким образом вы можете сосредоточиться на соответствующих проблемах.

![Настройка базовых показателей](./media/sql-vulnerability-assessment/pp_fail_rule_show_baseline.png)

### <a name="5-run-a-new-scan-to-see-your-customized-tracking-report"></a>5. Выполните новую проверку, чтобы просмотреть настроенный отчет об отслеживании

После завершения настройки **базовых показателей правил**запустите новую проверку, чтобы просмотреть настроенный отчет. Оценка уязвимостей теперь сообщает только о проблемах безопасности, которые отличаются от утвержденного базового состояния.

![Просмотр настраиваемого отчета](./media/sql-vulnerability-assessment/pp_pass_main_with_baselines.png)

Теперь службу оценки уязвимостей можно использовать, чтобы постоянно отслеживать безопасность базы данных и обеспечивать ее высокий уровень, а также следить за соблюдением политик организации. Если требуются отчеты о соответствии требованиям, можно использовать отчеты об оценке уязвимостей для упрощения процесса обеспечения соответствия.

### <a name="6-set-up-periodic-recurring-scans"></a>6. Настройка периодических повторяющихся проверок

Перейдите к параметрам оценки уязвимостей, чтобы включить **периодические повторяющиеся проверки**. Этот параметр настраивает оценку уязвимостей для автоматического запуска проверки базы данных в течение недели. Сводка результатов проверки отправляется на указанные вами адреса электронной почты.

![Просмотр настраиваемого отчета](./media/sql-vulnerability-assessment/pp_recurring_scans.png)

### <a name="7-export-an-assessment-report"></a>7. Экспорт отчета об оценке

Выберите **экспортировать результаты проверки** , чтобы создать загружаемый отчет Excel о результатах проверки. Этот отчет содержит сводную вкладку, в которой отображается сводка оценки. Отчет содержит все неудачные проверки. Она также содержит вкладку **результаты** , содержащую полный набор результатов проверки. Результаты включают все выполненные проверки и подробные сведения о результатах для каждого из них.

### <a name="8-view-scan-history"></a>8. Просмотр журнала сканирования

В области Оценка уязвимостей выберите **журнал сканирования** , чтобы просмотреть журнал всех проверок, ранее запущенных в этой базе данных. Выберите определенное сканирование из списка, чтобы просмотреть подробные результаты.

Теперь службу оценки уязвимостей можно использовать, чтобы постоянно отслеживать безопасность базы данных и обеспечивать ее высокий уровень, а также следить за соблюдением политик организации. Если требуются отчеты о соответствии требованиям, можно использовать отчеты об оценке уязвимостей для упрощения процесса обеспечения соответствия.

## <a name="manage-vulnerability-assessments-by-using-azure-powershell"></a>Управление оценками уязвимостей с помощью Azure PowerShell

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]
> [!IMPORTANT]
> Модуль PowerShell Azure Resource Manager по-прежнему поддерживается базой данных SQL Azure, но вся будущая разработка предназначена для модуля AZ. SQL. Эти командлеты см. в разделе [AzureRM. SQL](https://docs.microsoft.com/powershell/module/AzureRM.Sql/). Аргументы для команд в модуле AZ и в модулях AzureRm существенно идентичны.

Для программного управления оценками уязвимостей можно использовать командлеты Azure PowerShell. Поддерживаемые командлеты:

| Имя командлета в качестве ссылки | Описание |
| :-------------------- | :---------- |
| [Clear-Азсклдатабасевулнерабилитяссессментрулебаселине](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Очищает базовый план правила оценки уязвимостей.<br/>Сначала установите базовый план, прежде чем использовать этот командлет для его очистки. |
| [Clear-Азсклдатабасевулнерабилитяссессментсеттинг](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting) | Очищает параметры оценки уязвимостей базы данных. |
| [Convert-Азсклдатабасевулнерабилитяссессментскан](https://docs.microsoft.com/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan) | Результаты сканирования оценки уязвимостей преобразуются в файл Excel. |
| [Get-Азсклдатабасевулнерабилитяссессментрулебаселине](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Получает базовый план правила оценки уязвимости для данного правила. |
| [Get-Азсклдатабасевулнерабилитяссессментсканрекорд](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord) | Возвращает все записи просмотра оценки уязвимостей, связанные с заданной базой данных. |
| [Get-Азсклдатабасевулнерабилитяссессментсеттинг](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting) | Возвращает параметры оценки уязвимостей базы данных. |
| [Set-Азсклдатабасевулнерабилитяссессментрулебаселине](https://docs.microsoft.com/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Задает базовый план правила оценки уязвимостей. |
| [Start-Азсклдатабасевулнерабилитяссессментскан](https://docs.microsoft.com/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan) | Активирует запуск сканирования оценки уязвимостей. |
| [Update-Азсклдатабасевулнерабилитяссессментсеттинг](https://docs.microsoft.com/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting) | Обновляет параметры оценки уязвимостей базы данных. |
| &nbsp; | &nbsp; |

Пример сценария см. в разделе [Azure SQL Vulnerability Assessment PowerShell support](https://blogs.msdn.microsoft.com/sqlsecurity/20../../azure-sql-vulnerability-assessment-now-with-powershell-support/) (Поддержка PowerShell для оценки уязвимостей Azure SQL).

## <a name="manage-vulnerability-assessment-baseline-rules-by-using-resource-manager-templates"></a>Управление базовыми правилами оценки уязвимостей с помощью шаблонов диспетчер ресурсов

Чтобы настроить базовые показатели оценки уязвимостей с помощью шаблонов Azure Resource Manager, используйте `Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines` тип.

Перед добавлением базовых показателей `vulnerabilityAssessments` убедитесь, что на компьютере, на котором работает SQL Server, включен.

Ниже приведен пример определения базового правила VA2065 для Master и VA1143 в UserDB в качестве ресурсов в шаблоне диспетчер ресурсов.

```json
   "resources": [
      {
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "FirewallRuleName3",
                     "StartIpAddress",
                     "EndIpAddress"
                  ]
               },
               {
                  "result": [
                     "FirewallRuleName4",
                     "62.92.15.68",
                     "62.92.15.68"
                  ]
               }
            ]
         },
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
         "dependsOn": [
            "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
         ],
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "dbo"
                  ]
               }
            ]
         }
      }
   ]
```

Имена ресурсов для базы данных master и пользовательской базы данных определяются по-разному:

* База данных master-"имя": "[Concat (параметры (" server_name "),"/", параметры (" database_name "),"/default/VA2065/<b>master</b>")]",
* Пользовательская база данных-"имя": "[Concat (параметры (" server_name "),"/", параметры (" database_name "),"/default/VA2065/<b>Default</b>")]",
 
 
 Для управления логическими типами как true или false установите базовый результат с двоичным входом, например "1"/"0".
 
```json
   {
      "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
      "apiVersion": "2018-06-01-preview",
      "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",

      "dependsOn": [
         "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
      ],

      "properties": {
         "baselineResults": [
            {
               "result": [
                  "1"
               ]
            }
         ]
      }

   }
```

## <a name="next-steps"></a>Дальнейшие шаги  

- Дополнительные сведения о [расширенной защите данных](sql-database-advanced-data-security.md).
- Дополнительные сведения об [обнаружении и классификации данных](sql-database-data-discovery-and-classification.md).
