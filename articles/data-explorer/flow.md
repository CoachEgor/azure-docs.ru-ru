---
title: Разъем потока исследователя данных Microsoft Azure (Предварительный просмотр)
description: Узнайте об использовании разъема Microsoft Flow для создания потоков автоматически запланированных или срабатывающих задач.
author: orspod
ms.author: orspodek
ms.reviewer: dorcohen
ms.service: data-explorer
ms.topic: conceptual
ms.date: 03/25/2020
ms.openlocfilehash: 198b78d5bab15057fdb6c7f6d4e8fff9f77d496e
ms.sourcegitcommit: 632e7ed5449f85ca502ad216be8ec5dd7cd093cb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2020
ms.locfileid: "80397089"
---
# <a name="microsoft-flow-connector-preview"></a>Разъем потока Microsoft (Предварительный просмотр)

Разъем потока Azure Data Explorer позволяет Azure Data Explorer использовать [возможности потока Microsoft Power Automate](https://flow.microsoft.com/) для автоматического выполнения запросов и команд Kusto в рамках запланированной или срабатывающей задачи.

Общие сценарии использования включают в себя:

* Отправка ежедневных отчетов, содержащих таблицы и диаграммы
* Настройка уведомлений на основе результатов запроса
* Команды управления планированием кластеров
* Экспорт и импорт данных между Azure Data Explorer и другими базами данных 

Для получения дополнительной информации смотрите [примеры использования разъема Microsoft Flow.](flow-usage.md)

##  <a name="log-in"></a>Вход в систему 

1. Войти в [Microsoft Power Automate](https://flow.microsoft.com/).

1. При подключении в первый раз, вам будет предложено войти в систему.

1. Выберите **Вход** и введите свои учетные данные.

![Диалоговое окно входа](./media/flow/flow-signin.png)

## <a name="authentication"></a>Аутентификация

Вы можете проверить подлинность с помощью учетных данных пользователей или приложения AAD.

> [!Note]
> Убедитесь, что приложение является [приложением AAD](https://docs.microsoft.com/azure/kusto/management/access-control/how-to-provision-aad-app) и уполномочено выполнять запросы в кластере.

1. Выберите три точки в правом верхнем ряде ![разъема Microsoft Flow: Добавить соединение](./media/flow/flow-addconnection.png)

1. Выберите **Добавить новое соединение,** а затем выберите **Связаться с основным сервисом.**
![Войти в диалог](./media/flow/flow-signin.png)

1. Введите необходимые сведения:
    * Имя подключения: описательное и значимое имя для нового соединения
    * Идентификатор клиента: Идентификатор приложения
    * Секрет клиента: Ваш ключ приложения
    * Арендатор: Идентификатор каталога AAD, в котором вы создали приложение. Например, идентификатор арендатора Microsoft: 72f988bf-86f1-41af-91ab-2d7cd011db47

![Проверка подлинности приложения](./media/flow/flow-appauth.png)

Когда проверка подлинности будет завершена, вы увидите, что ваш поток использует недавно добавленное соединение.

![Завершенная аутентификация приложения](./media/flow/flow-appauthcomplete.png)

Отныне этот поток будет работать с использованием этих учетных данных приложений.

## <a name="find-the-azure-kusto-connector"></a>Найти разъем Azure Kusto

Чтобы использовать разъем Microsoft Flow, необходимо сначала добавить триггер. Триггер может быть определен на основе повторяющихся периодов времени или как ответ на предыдущее действие потока.

1. [Создайте новый поток](https://flow.microsoft.com/manage/flows/new) или, с главной страницы, выберите действие **My Flows,** а затем выберите **новый**.

    ![Создание потока](./media/flow/flow-newflow.png)

1. Добавить запланированный из пустой.

    ![Новый запланированный поток](./media/flow/flow-scheduled-from-blank.png)

1. Введите требуемую информацию на страницу запланированного потока сборки.
    ![Создание запланированного потока](./media/flow/flow-build-scheduled-flow.png)
1. Нажмите кнопку **создания**.
1. Выберите **новый шаг**.
1. В поле поиска введите "Кусто".

    ![Выберите действия потока](./media/flow/flow-actions.png)

1. Выберите **Azure Data Explorer**.

## <a name="flow-actions"></a>Действия потока

При открытии разъема Azure Data Explorer существует три возможных действия, которые можно добавить в поток.

В этом разделе описаны возможности и параметры для каждого действия Microsoft Flow.

![Действия Исследователя данных потока](./media/flow/flow-adx-actions.png)

### <a name="run-control-command-and-visualize-results"></a>Выполнить команду управления и визуализировать результаты

Используйте команду управления Run и визуализировать действия результатов для выполнения [команды управления.](https://docs.microsoft.com/azure/kusto/management/index)

1. Укажите URL кластера. Например https://clusterName.eastus.kusto.windows.net.
1. Введите имя базы данных.
1. Укажите команду управления:
    * Выберите динамическое содержимое из приложений и разъемов, используемых в потоке
    * Добавление выражения в доступ, преобразование и сравнение значений
1. Чтобы отправить результаты этого действия по электронной почте в виде таблицы или диаграммы, укажите тип диаграммы, который может быть:
    * Таблица HTML
    * Круговая диаграмма
    * Диаграмма времени
    * Диаграмма бара

![Выполнить команду управления потоком](./media/flow/flow-runcontrolcommand.png)

> [!IMPORTANT]
> В поле *названия кластера* введите URL кластера.

### <a name="run-query-and-list-results"></a>Запуск запроса и список результатов

> [!Note]
> Если ваш запрос начинается с точки (имеется в виду, что это [команда управления),](https://docs.microsoft.com/azure/kusto/management/index)используйте [команду управления Run и визуализировать результаты.](#run-control-command-and-visualize-results)

Это действие отправляет запрос в кластер Kusto. Действия, которые добавляются после этого итерации по каждой строке результатов запроса.

Следующий пример запускает запрос каждую минуту и отправляет электронное письмо на основе результатов запроса. Запрос проверяет количество строк в базе данных, а затем отправляет электронное письмо только в том случае, если количество строк превышает 0. 

![Выполнить результаты списка запросов](./media/flow/flow-runquerylistresults-2.png)

> [!Note]
> Если столбец имеет несколько строк, разъем будет работать для каждой строки в столбце.

### <a name="run-query-and-visualize-results"></a>Запуск запроса и визуализации результатов
        
> [!Note]
> Если ваш запрос начинается с точки (имеется в виду, что это [команда управления),](https://docs.microsoft.com/azure/kusto/management/index)используйте [команду управления Run и визуализировать результаты.](#run-control-command-and-visualize-results)
        
Используйте запрос Run и визуализировать действия результатов, чтобы визуализировать результат запроса Kusto как таблицу или диаграмму. Например, используйте этот поток для получения ежедневных отчетов ICM по электронной почте. 
    
В этом примере результаты запроса возвращаются в виде таблицы HTML.
            
![Запуск запроса и визуализации результатов](./media/flow/flow-runquery.png)

> [!IMPORTANT]
> В поле *названия кластера* введите URL кластера.

## <a name="email-kusto-query-results"></a>Результаты запроса Kusto по электронной почте

Вы можете включить шаг в любой поток для отправки сообщений по электронной почте на любой адрес электронной почты. 

1. Выберите **новый шаг,** чтобы добавить новый шаг к вашему потоку.
1. В поле поиска введите Office 365 и выберите **Office 365 Outlook**.
1. Выберите **Отправить электронное письмо (V2).**
1. Введите адрес электронной почты, где вы хотите отправить отчет по электронной почте.
1. Введите тему электронной почты.
1. Выберите **представление кода**.
1. Поместите курсор в поле *тела* и выберите **Добавить динамическое содержимое.**
1. Выберите **BodyHtml**.
    ![Отправка электронной почты](./media/flow/flow-send-email.png)
1. Выберите **Показать расширенные параметры**.
1. В поле *Приложения Name -1* выберите **Имя присоединения.**
1. В поле *приложения Содержимое* выберите **Содержимое присоединения**.
1. При необходимости добавьте больше вложений. 
1. При необходимости установите уровень важности.
1. Щелкните **Сохранить**.

![Отправка электронной почты](./media/flow/flow-add-attachments.png)

## <a name="check-if-your-flow-succeeded"></a>Проверьте, удалось ли вашему потоку

Чтобы проверить, удалось ли потоку, просмотрите историю выполнения потока:
1. Перейдите на [домашнюю страницу Microsoft Flow.](https://flow.microsoft.com/)
1. Из основного меню выберите [Мои потоки.](https://flow.microsoft.com/manage/flows)
    ![Страница "Мои потоки"](./media/flow/flow-myflows.png)
1. В строке потока, который вы хотите исследовать, выберите значок «больше команд», а затем **запустите историю.**

    ![Выполнить меню истории](./media/flow//flow-runhistory.png)

    Все запуски потока перечислены с временем начала, продолжительностью и состоянием.
    ![Выполнить страницу результатов истории](./media/flow/flow-runhistoryresults.png)

    Для получения подробной информации о потоке на странице [Мои потоки](https://flow.microsoft.com/manage/flows) выберите поток, который вы хотите исследовать.

    ![Выполнить полную страницу результатов истории](./media/flow/flow-fulldetails.png) 

Чтобы узнать, почему запуск не удался, выберите время запуска. Поток появляется, и шаг потока, который не удалось указывается красным восклицательным знаком. Расширьте неудачный шаг, чтобы просмотреть его детали. Праворукое стекло содержит информацию о сбое, так что вы можете устранить его.

![Ошибка потока](./media/flow/flow-error.png)

## <a name="timeout-exceptions"></a>Исключения тайм-аута

Ваш поток может выйти из строя и вернуть исключение "RequestTimeout", если он работает более семи минут.

Узнайте больше об [ограничениях потока Microsoft.](#limitations)
    
Тот же запрос может успешно работать в Azure Data Explorer, где время не ограничено и может быть изменено.
            
Исключение "RequestTimeout" отображается на рисунке ниже:
    
![Ошибка исключения тайм-аута потока](./media/flow/flow-requesttimeout.png)
    
Чтобы устранить проблему тайм-аута, постарайтесь сделать запрос более эффективным, чтобы он работает быстрее, или разделить его на куски. Каждый фрагмент может работать на другой части запроса.

Для получения дополнительной информации, прочитайте о [рекомендациях запроса](https://docs.microsoft.com/azure/kusto/query/best-practices).

## <a name="limitations"></a>Ограничения

* Результаты, возвращенные клиенту, ограничены 500 000 записей. Общая память этих записей не может превышать 64 МБ и семиминутное время выполнения.
* Разъем не поддерживает [операторы вилки](https://docs.microsoft.com/azure/kusto/query/forkoperator) и [граней.](https://docs.microsoft.com/azure/kusto/query/facetoperator)
* Поток лучше всего работает на Microsoft Edge и Chrome.

## <a name="next-steps"></a>Следующие шаги

Узнайте о [разъеме Microsoft Azure Explorer Logic App,](https://docs.microsoft.com/azure/kusto/tools/logicapps) который является еще одним способом автоматического выполнения запросов и команд Kusto в рамках запланированной или срабатывающей задачи.
