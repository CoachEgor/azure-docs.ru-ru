---
title: Основные понятия потоковой трансляции с использованием Служб мультимедиа Azure — события и выходные данные прямой трансляции | Документация Майкрософт
description: В этой статье содержатся общие сведения об основных понятиях потоковой трансляции с использованием Служб мультимедиа Azure версии 3.
services: media-services
documentationcenter: ''
author: Juliako
manager: femila
editor: ''
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: ne
ms.topic: article
ms.date: 06/19/2019
ms.author: juliako
ms.openlocfilehash: f26467a250314fa8a6fe401f4ec1d6a999b6bb4d
ms.sourcegitcommit: 2d3b1d7653c6c585e9423cf41658de0c68d883fa
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/20/2019
ms.locfileid: "67296210"
---
# <a name="live-events-and-live-outputs"></a>События и выходные данные прямой трансляции

Службы мультимедиа Azure дают возможность предоставлять клиентам события прямой трансляции в облаке Azure. Для настройки динамических потоковой передачи событий в версии 3 службы мультимедиа, необходимо понимать концепции, описанные в этой статье.

> [!TIP]
> Для клиентов, переходящих с помощью интерфейсов API служб мультимедиа версии 2 **событие прямой трансляции** заменяет сущность **канал** в версии 2 и **Live вывода** заменяет **программы**.

## <a name="live-events"></a>Динамические события

[События потоковой трансляции](https://docs.microsoft.com/rest/api/media/liveevents) отвечают за прием и обработку видеопотоков. При создании события Live входную конечную точку основного и дополнительного создается, можно использовать для отправки источник сигнала от удаленного кодировщика. Удаленный динамический кодировщик отправляет вклад веб-канал, входную конечную точку, с помощью [RTMP](https://www.adobe.com/devnet/rtmp.html) или [Smooth Streaming](https://msdn.microsoft.com/library/ff469518.aspx) (фрагментированный MP4) входного протокола. Для протокола приема RTMP, содержимое передаются в незашифрованном виде (`rtmp://`) или надежно зашифрованных по сети (`rtmps://`). Для протокола приема Smooth Streaming поддерживаются следующие схемы URL-адресов: `http://` или `https://`.  

## <a name="live-event-types"></a>Типы событий потоковой трансляции

Есть два типа [событий потоковой трансляции](https://docs.microsoft.com/rest/api/media/liveevents): сквозной режим и кодирование в реальном времени. Типы устанавливаются во время создания с помощью [LiveEventEncodingType](https://docs.microsoft.com/rest/api/media/liveevents/create#liveeventencodingtype):

* **LiveEventEncodingType.None** -локальный динамический кодировщик передает несколько скоростью потока. Переданные потоки проходят через событие прямой трансляции без дальнейшей обработки. 
* **LiveEventEncodingType.Standard** — это локальный динамический кодировщик передает односкоростной поток в событие прямой трансляции и служб мультимедиа создает несколько потоков битрейтов. Если веб-канала вклад 720p или более высокого разрешения **Default720p** Предустановка кодируют набор пар 6 битрейтах в разрешение.
* **LiveEventEncodingType.Premium1080p** — это локальный динамический кодировщик передает односкоростной поток в событие прямой трансляции и служб мультимедиа создает несколько потоков битрейтов. Предустановка Default1080p Указывает выходной набор пар битрейтах в разрешение. 

### <a name="pass-through"></a>Сквозной режим

![Сквозной режим](./media/live-streaming/pass-through.svg)

При использовании сквозного режима **потоковой трансляции** локальный динамический кодировщик генерирует многоскоростной видеопоток и передает его как исходный в трансляцию с помощью протокола RTMP или фрагментированного MP4. Затем событие потоковой трансляции передает входящие видеопотоки без какой-либо дальнейшей обработки. Такие сквозной Live событие оптимизирован для событий в прямом эфире длительных или 24 часа 365 линейной динамической потоковой передачи. Создавая событие потоковой трансляции такого типа, укажите значение None (LiveEventEncodingType.None).

При этом исходный поток передается с разрешением до 4K и частотой 60 кадров в секунду при помощи видеокодеков H.264/AVC или H.265/HEVC, а также аудиокодека AAC (AAC-LC, HE-AACv1 или HE-AACv2).  Дополнительные сведения см. в статье, посвященной [сравнительным характеристикам и ограничениям типов событий потоковой трансляции](live-event-types-comparison.md).

> [!NOTE]
> Метод сквозной доставки — наиболее экономичный способ осуществления потоковой передачи в режиме реального времени, если передается ряд событий за длительный период времени и у вас уже есть локальные кодировщики. См. сведения о [ценах](https://azure.microsoft.com/pricing/details/media-services/).
> 

См. пример кода .NET в [MediaV3LiveApp](https://github.com/Azure-Samples/media-services-v3-dotnet-core-tutorials/blob/master/NETCore/Live/MediaV3LiveApp/Program.cs#L126).

### <a name="live-encoding"></a>Кодирование в реальном времени  

![Кодирование в реальном времени](./media/live-streaming/live-encoding.svg)

При использовании кодирования в реальном времени с помощью Служб мультимедиа ваш локальный динамический кодировщик передает односкоростной видеопоток в качестве исходного в событие потоковой трансляции (с помощью протоколов RTMP или фрагментированного MP4). Можно затем настроить интерактивное событие, чтобы он кодирует входящий односкоростной, потоковую передачу в [несколько видеопоток скоростью](https://en.wikipedia.org/wiki/Adaptive_bitrate_streaming)и делает выходные данные доступными для доставки для воспроизведения устройств через протоколы, как MPEG-DASH, HLS и Smooth Потоковая передача.

При использовании кодирования в реальном времени, вы можете отправить вклад веб-канала только с разрешением 1080p разрешение частотой кадров 30 кадров/во-вторых, с помощью видеокодека H.264/AVC и AAC (AAC-LC, HE-AACv1 или HE-AACv2) аудиокодек. Обратите внимание на то, что сквозной Live события могут поддерживать разрешения до 4 K — 60 кадров в секунду. Дополнительные сведения см. в статье, посвященной [сравнительным характеристикам и ограничениям типов событий потоковой трансляции](live-event-types-comparison.md).

Стиль определяется разрешений и скоростей, содержащихся в выходных данных из динамического кодировщика. При использовании **стандартный** live encoder (LiveEventEncodingType.Standard), а затем *Default720p* Предустановка определяет набор 6 пар скорость разрешение/бит, передаваемых с разрешением 720 p 3.5Mbps до 192 p 200 Кбит/с. В противном случае, если с помощью **Premium1080p** live encoder (LiveEventEncodingType.Premium1080p), а затем *Default1080p* Предустановка определяет набор 6 пар скорость разрешение/бит, начиная от 1080 p в 3.5Mbps до 180 p 200 Кбит/с. Дополнительные сведения см. в разделе о [системных предустановках](live-event-types-comparison.md#system-presets).

> [!NOTE]
> Если вам нужно настроить динамическую предустановку кодирования, отправьте запрос в службу поддержки через портал Azure. Следует указать нужную таблицу с разрешениями и скоростями. Убедитесь, что имеется только один слой на 720p (если запрос предустановку для динамического кодировщика — стандартный) или на 1080p (при запросе предустановку кодировщика Premium1080p), а не более 6 слоев.

## <a name="live-event-creation-options"></a>Параметры создания событий потоковой трансляции

При создании события потоковой трансляции можно указать следующие параметры.

* Протокол потоковой передачи для событий потоковой трансляции (сейчас поддерживаются протоколы RTMP и Smooth Streaming).<br/>Изменить протокол во время работы события потоковой трансляции или связанных с ним выходных данных потоковой трансляции нельзя. Если вам нужны другие протоколы потоковой передачи, создайте отдельное событие потоковой трансляции для каждого из них.  
* Ограничения по IP-адресам для приема и предварительного просмотра. Вы можете определить IP-адреса, с которых событие потоковой трансляции будет принимать видео. Можно указать отдельный допустимый IP-адрес (например, 10.0.0.1), или диапазон IP-адресов, используя IP-адрес и маску подсети CIDR (например, 10.0.0.1/22), или IP-адрес и маску подсети с точками (например, 10.0.0.1(255.255.252.0)).<br/>Если IP-адреса не указаны и правила не заданы, ни один IP-адрес не разрешен. Чтобы разрешить все IP-адреса, создайте правило и задайте адрес 0.0.0.0/0.<br/>IP-адреса должны быть представлены в одном из следующих форматов: IPv4-адрес с 4 цифрами, диапазон адресов CIDR.
* Для создаваемого события можно настроить автоматический запуск. <br/>Если для автозапуска задано значение true, событие прямой трансляции будет запущено после создания. Плата начисляется сразу же после запуска трансляции. Чтобы остановить начисление оплаты, нужно явно вызвать функцию Stop (Остановить) для ресурса события потоковой трансляции. Кроме того, событие можно запустить, когда вы будете готовы начать потоковую передачу. 

    Дополнительные сведения см. в статье [Состояния компонента LiveEvent и выставление счетов за его использование](live-event-states-billing.md).

## <a name="live-event-ingest-urls"></a>URL-адреса приема событий потоковой трансляции

После создания события потоковой трансляции можно получить URL-адреса приема, которые необходимо передать локальному динамическому кодировщику. Он использует эти адреса для передачи потоковой трансляции. Дополнительные сведения см. в статье о [рекомендуемых локальных динамических кодировщиках](recommended-on-premises-live-encoders.md). 

Можно использовать запоминающиеся и незапоминающиеся URL-адреса. 

> [!NOTE] 
> Для приема URL-адрес, чтобы спрогнозировать, задайте режим «личный».

* Незапоминающийся URL-адрес

    URL-адрес личного не является режимом по умолчанию в версии 3 службы мультимедиа. Таким образом, вы можете быстро получить событие потоковой трансляции, но URL-адрес приема будет известен только после запуска события. URL-адрес изменится, если вы остановите или запустите событие потоковой трансляции. <br/>Незапоминающиеся URL-адреса полезны в сценариях, когда пользователь хочет транслировать поток с помощью приложения максимально быстро и имеющийся динамический URL-адрес приема не является проблемой.
    
    Если клиентское приложение не должно, чтобы заранее создать URL-адрес приема до события Live создается, просто оставить служб мультимедиа для автоматического создания токена доступа для события прямой трансляции.
* Запоминающийся URL-адрес

    Режим запоминающихся URL-адресов является предпочтительным для крупных медиа-вещателей, которые используют аппаратные широковещательные кодировщики и не хотят повторно их настраивать при запуске события потоковой трансляции. Им нужен прогнозируемый URL-адрес приема, который не будет изменяется со временем.
    
    Чтобы указать этот режим, необходимо задать `vanityUrl` для `true` во время создания (значение по умолчанию — `false`). Необходимо также передать маркер доступа (`LiveEventInput.accessToken`) во время создания. Можно указать значение маркера, чтобы избежать случайного токен в URL-адрес. Маркер доступа должен быть допустимой строкой идентификатора GUID (с или без дефисов). Когда используется режим ее нельзя обновить.

    Маркер доступа должно быть уникальным в вашем центре обработки данных. Если приложение должно использовать запоминающемся URL-АДРЕСЕ, рекомендуется всегда создавать новый экземпляр GUID для токена доступа (а не повторно использовать любой существующий GUID). 

    Использовать следующие API-интерфейсы для включения Запоминающемся URL-АДРЕСЕ и задать значение маркера доступа является допустимым идентификатором GUID (например `"accessToken": "1fce2e4b-fb15-4718-8adc-68c6eb4c26a7"`).  
    
    |Язык|Включить запоминающемся URL-АДРЕСЕ|Задание маркера доступа.|
    |---|---|---|
    |REST|[properties.vanityUrl](https://docs.microsoft.com/rest/api/media/liveevents/create#liveevent)|[LiveEventInput.accessToken](https://docs.microsoft.com/rest/api/media/liveevents/create#liveeventinput)|
    |Интерфейс командной строки|[--именного-URL-адрес](https://docs.microsoft.com/cli/azure/ams/live-event?view=azure-cli-latest#az-ams-live-event-create)|[--маркер доступа](https://docs.microsoft.com/cli/azure/ams/live-event?view=azure-cli-latest#optional-parameters)|
    |.NET|[LiveEvent.VanityUrl](https://docs.microsoft.com/dotnet/api/microsoft.azure.management.media.models.liveevent.vanityurl?view=azure-dotnet#Microsoft_Azure_Management_Media_Models_LiveEvent_VanityUrl)|[LiveEventInput.AccessToken](https://docs.microsoft.com/dotnet/api/microsoft.azure.management.media.models.liveeventinput.accesstoken?view=azure-dotnet#Microsoft_Azure_Management_Media_Models_LiveEventInput_AccessToken)|
    
### <a name="live-ingest-url-naming-rules"></a>Правила именования URL-адресов динамического приема

* *Случайная* строка ниже представляет собой 128-разрядное шестнадцатеричное число (состоящее из 32 знаков: 0–9 и a–f).
* *маркер доступа* -допустимым строка идентификатора GUID, задайте при использовании в собственном режиме. Например, `"1fce2e4b-fb15-4718-8adc-68c6eb4c26a7"`.
* *имя потока* -указывает имя потока для определенного подключения. По динамическому кодировщику, используемого обычно добавляется значение имени потока. Можно настроить динамический кодировщик, чтобы использовать любое имя для описания соединения, например: «video1_audio1», «video2_audio1», «поток».

#### <a name="non-vanity-url"></a>Незапоминающийся URL-адрес

##### <a name="rtmp"></a>RTMP

`rtmp://<random 128bit hex string>.channel.media.azure.net:1935/live/<auto-generated access token>/<stream name>`<br/>
`rtmp://<random 128bit hex string>.channel.media.azure.net:1936/live/<auto-generated access token>/<stream name>`<br/>
`rtmps://<random 128bit hex string>.channel.media.azure.net:2935/live/<auto-generated access token>/<stream name>`<br/>
`rtmps://<random 128bit hex string>.channel.media.azure.net:2936/live/<auto-generated access token>/<stream name>`<br/>

##### <a name="smooth-streaming"></a>Smooth Streaming

`http://<random 128bit hex string>.channel.media.azure.net/<auto-generated access token>/ingest.isml/streams(<stream name>)`<br/>
`https://<random 128bit hex string>.channel.media.azure.net/<auto-generated access token>/ingest.isml/streams(<stream name>)`<br/>

#### <a name="vanity-url"></a>Запоминающийся URL-адрес

##### <a name="rtmp"></a>RTMP

`rtmp://<live event name>-<ams account name>-<region abbrev name>.channel.media.azure.net:1935/live/<your access token>/<stream name>`<br/>
`rtmp://<live event name>-<ams account name>-<region abbrev name>.channel.media.azure.net:1936/live/<your access token>/<stream name>`<br/>
`rtmps://<live event name>-<ams account name>-<region abbrev name>.channel.media.azure.net:2935/live/<your access token>/<stream name>`<br/>
`rtmps://<live event name>-<ams account name>-<region abbrev name>.channel.media.azure.net:2936/live/<your access token>/<stream name>`<br/>

##### <a name="smooth-streaming"></a>Smooth Streaming

`http://<live event name>-<ams account name>-<region abbrev name>.channel.media.azure.net/<your access token>/ingest.isml/streams(<stream name>)`<br/>
`https://<live event name>-<ams account name>-<region abbrev name>.channel.media.azure.net/<your access token>/ingest.isml/streams(<stream name>)`<br/>

## <a name="live-event-preview-url"></a>URL-адрес для предварительного просмотра событий потоковой трансляции

Как только **событие потоковой трансляции** начинает принимать исходный поток, можно использовать конечную точку предварительного просмотра, чтобы перед публикацией убедиться, что вы принимаете потоковую трансляцию в реальном времени. После проверки того, что поток предварительного просмотра подходит, можно использовать событие прямой трансляции для предоставления обновляющегося потока для доставки через одну или несколько (предварительно созданные) **конечными точками потоковой передачи**. Для этого создайте [выходные данные потоковой трансляции](https://docs.microsoft.com/rest/api/media/liveoutputs) в **событии потоковой трансляции**. 

> [!IMPORTANT]
> Прежде чем продолжить, убедитесь, что видео правильно передается на URL-адрес предварительного просмотра.

## <a name="live-event-long-running-operations"></a>Динамические события длительных операций

Дополнительные сведения см. в разделе [длительных операций](media-services-apis-overview.md#long-running-operations)

## <a name="live-outputs"></a>Динамичесие выходные данные

Настроив передачу потока данных в событие потоковой трансляции, можно запустить событие потоковой передачи, создав [ресурс](https://docs.microsoft.com/rest/api/media/assets), [выходные данные потоковой трансляции](https://docs.microsoft.com/rest/api/media/liveoutputs) и [указатель потоковой передачи](https://docs.microsoft.com/rest/api/media/streaminglocators). Выходные данные потоковой трансляции запустят архивирование потока и предложат его зрителям через [конечную точку потоковой передачи](https://docs.microsoft.com/rest/api/media/streamingendpoints).  

> [!NOTE]
> Выходные данные потоковой трансляции запускаются при создании и останавливаются при удалении. При удалении выходных данных потоковой трансляции базовый ресурс и его содержимое не удаляются. 

Отношения между **событием потоковой трансляции** и соответствующими **выходными данными** похожи на традиционное телевещание, когда канал (**событие потоковой трансляции**) передает постоянный поток видео, а запись (**выходные данные потоковой трансляции**) ограничивается определенным периодом времени (например, вечерние новости с 18:30 до 19:00). Телевизионные передачи можно записывать с помощью устройства записи цифрового видео (DVR). Аналогичная функция в событиях потоковой трансляции управляется с помощью свойства **ArchiveWindowLength**. Это длительность временного диапазона ISO-8601 (например, PTHH:MM:SS), задающая объем DVR. Для нее можно задать значение от 3 минут до 25 часов.

Объект **выходных данных потоковой трансляции** действует, как магнитофон: захватывает трансляцию и записывает ее в ресурс Asset в вашей учетной записи Служб мультимедиа. Записанное содержимое сохраняется в учетной записи хранения Azure, подключенной к вашей учетной записи, в контейнере, определенном ресурсом Asset. **Выходные данные потоковой трансляции** дают возможность управлять свойствами исходящей потоковой трансляции, в частности тем, какая ее часть хранится в архивной записи (объем DVR в облаке) и могут ли зрители начать просмотр трансляции. Архив на диске — это циклическое архивное "окно", которое пропускает только тот объем содержимого, который указан в свойстве **archiveWindowLength** **выходных данный потоковой трансляции**. Содержимое, выходящее за рамки этого окна, автоматически удаляется из контейнера хранилища и не подлежит восстановлению. В **событии потоковой трансляции** можно создать несколько объектов **выходных данных потоковой трансляции** (до трех) с разными длиной и параметрами архивации.  

После публикации **ресурса** **выходных данных потоковой трансляции** с использованием **указателя потоковой передачи** **событие потоковой трансляции** (до длины окна DVR) будет доступно для просмотра до истечения срока действия или удаления указателя потоковой передачи, в зависимости от того, какое действие произойдет первым.

Дополнительные сведения см. в статье [Использование средства цифровой видеозаписи в облаке](live-event-cloud-dvr.md).

## <a name="ask-questions-give-feedback-get-updates"></a>Получение справки, отправка отзывов, получение обновлений

Прочитайте статью [сообщества Служб мультимедиа Azure](media-services-community.md), чтобы узнать, как задавать вопросы, оставлять отзывы и получать новости о Службах мультимедиа.

## <a name="next-steps"></a>Дальнейшие действия

[Руководство по потоковой трансляции](stream-live-tutorial-with-api.md)
