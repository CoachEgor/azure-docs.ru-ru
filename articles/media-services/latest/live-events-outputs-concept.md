---
title: Динамические события и динамические выходные данные в службах мультимедиа
titleSuffix: Azure Media Services
description: Общие сведения о динамических событиях и динамических выходах в службах мультимедиа Azure v3.
services: media-services
documentationcenter: ''
author: Juliako
manager: femila
editor: ''
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: ne
ms.topic: article
ms.date: 09/30/2019
ms.author: juliako
ms.openlocfilehash: d2f0689dd1f1b5fbe349478ad885b76eb79d91a0
ms.sourcegitcommit: f4d8f4e48c49bd3bc15ee7e5a77bee3164a5ae1b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2019
ms.locfileid: "73569665"
---
# <a name="live-events-and-live-outputs-in-media-services"></a>Динамические события и динамические выходные данные в службах мультимедиа

Службы мультимедиа Azure позволяют предоставлять клиентам интерактивные мероприятия в облаке Azure. Чтобы настроить события динамической потоковой передачи в службах мультимедиа v3, необходимо ознакомиться с основными понятиями, обсуждаемыми в этой статье.

> [!TIP]
> Для клиентов, выполняющих миграцию из API-интерфейсов служб мультимедиа версии 2, активная сущность **события** заменяет **канал** в v2 и **выходные данные в реальном времени** заменяет **программу**.

## <a name="live-events"></a>Динамические события

[События потоковой трансляции](https://docs.microsoft.com/rest/api/media/liveevents) отвечают за прием и обработку видеопотоков. При создании интерактивного события создается первичная и вторичная входная конечная точка, которую можно использовать для отправки сигнала в реальном времени с удаленного кодировщика. Удаленный динамический кодировщик отправляет канал вклада в эту входную конечную точку с помощью протокола ввода [RTMP](https://www.adobe.com/devnet/rtmp.html) или [Smooth Streaming](https://msdn.microsoft.com/library/ff469518.aspx) (фрагментированного MP4). Для протокола приема RTMP содержимое может быть отправлено в виде очистки (`rtmp://`) или безопасно зашифровано в сети (`rtmps://`). Для протокола приема Smooth Streaming поддерживаются следующие схемы URL-адресов: `http://` или `https://`.  

## <a name="live-event-types"></a>Типы событий потоковой трансляции

[Событие в реальном времени](https://docs.microsoft.com/rest/api/media/liveevents) может быть одним из двух типов: сквозная или динамическая кодировка. Типы задаются во время создания с помощью [лививентенкодингтипе](https://docs.microsoft.com/rest/api/media/liveevents/create#liveeventencodingtype):

* **Лививентенкодингтипе. None**: локальный динамический кодировщик отправляет поток с несколькими скоростями. Принимающий поток проходит через событие Live без дальнейшей обработки. 
* **Лививентенкодингтипе. Standard**. локальный динамический кодировщик отправляет односкоростной поток в Live Event, а службы мультимедиа — несколько потоков с несколькими скоростями. Если веб-канал публикации имеет 720p или более высокое разрешение, Предустановка **Default720p** кодирует набор из 6 пар "разрешение/скорость".
* **Лививентенкодингтипе. Premium1080p**. локальный динамический кодировщик отправляет односкоростной поток в Live Event, а службы мультимедиа — несколько потоков с несколькими скоростями. Предустановка Default1080p указывает выходной набор пар "разрешение-скорость".

### <a name="pass-through"></a>Сквозной режим

![Примерная схема для сквозного мероприятия с помощью служб мультимедиа](./media/live-streaming/pass-through.svg)

При использовании сквозного режима **потоковой трансляции** локальный динамический кодировщик генерирует многоскоростной видеопоток и передает его как исходный в трансляцию с помощью протокола RTMP или фрагментированного MP4. Затем событие потоковой трансляции передает входящие видеопотоки без какой-либо дальнейшей обработки. Такое событие сквозной передачи оптимизировано для долго выполняющихся интерактивных событий или 24x365 линейной потоковой передачи. Создавая событие потоковой трансляции такого типа, укажите значение None (LiveEventEncodingType.None).

При этом исходный поток передается с разрешением до 4K и частотой 60 кадров в секунду при помощи видеокодеков H.264/AVC или H.265/HEVC, а также аудиокодека AAC (AAC-LC, HE-AACv1 или HE-AACv2). Дополнительные сведения см. в разделе [Сравнение типов динамических событий](live-event-types-comparison.md).

> [!NOTE]
> Использование сквозного метода — это самый экономичный способ выполнения потоковой передачи при выполнении нескольких событий в течение длительного периода времени и уже включенных в локальные кодировщики. См. сведения о [ценах](https://azure.microsoft.com/pricing/details/media-services/).
>

См. пример кода .NET в [MediaV3LiveApp](https://github.com/Azure-Samples/media-services-v3-dotnet-core-tutorials/blob/master/NETCore/Live/MediaV3LiveApp/Program.cs#L126).

### <a name="live-encoding"></a>Кодирование в реальном времени  

![Пример схемы кодирования в реальном времени с помощью служб мультимедиа](./media/live-streaming/live-encoding.svg)

При использовании кодирования в реальном времени с помощью служб мультимедиа вы настраиваете локальный динамический кодировщик для отправки односкоростного видео в реальном времени в интерактивное событие (с использованием протокола RTMP или фрагментированного MP4). Затем вы настроите событие в реальном времени, чтобы оно было закодировано в [потоке видео с несколькими](https://en.wikipedia.org/wiki/Adaptive_bitrate_streaming)скоростями, а выходные данные доступны для доставки, чтобы воспроизводить устройства с помощью таких протоколов, как MPEG-ТИРЕ, HLS и Smooth Streaming.

При использовании кодирования в реальном времени можно отправить веб-канал передачи данных только с разрешением до 1080p с частотой 30 кадров в секунду, с видеокодеком H. 264/AVC и AAC (AAC-LC, HE-AACv1 или HE-AACv2) аудиокодеком. Обратите внимание, что передаваемые в реальном времени события могут поддерживать разрешение до 4000 КБ в 60 кадрах/сек. Дополнительные сведения см. в разделе [Сравнение типов динамических событий](live-event-types-comparison.md).

Разрешения и скорости, содержащиеся в выходных данных кодировщика Live Encoder, определяются предустановкой. Если используется **стандартный** динамический кодировщик (Лививентенкодингтипе. Standard), то Предустановка *Default720p* задает набор из шести пар "разрешение/скорость передачи", начиная с 720P с 3,5 Мбит/с до 192p в 200 кбит/с. В противном случае, если используется динамический кодировщик **Premium1080p** (Лививентенкодингтипе. Premium1080p), то Предустановка *Default1080p* задает набор из шести пар "разрешение/скорость передачи", начиная с "1080P" в 3,5 Мбит/с до 180p с 200 кбит/с. Дополнительные сведения см. в разделе о [системных предустановках](live-event-types-comparison.md#system-presets).

> [!NOTE]
> Если вам нужно настроить стандарт для кодирования в реальном времени, отправьте запрос в службу поддержки через портал Azure. Укажите нужную таблицу разрешения и скорость. Убедитесь, что существует только один слой в 720p (при запросе предустановки для стандартного динамического кодировщика) или в режиме 1080p (если запрашивается предустановка для кодировщика Premium1080p Live) и 6 уровней.

## <a name="creating-live-events"></a>Создание событий Live

### <a name="options"></a>Параметры

При создании события потоковой трансляции можно указать следующие параметры.

* Протокол потоковой передачи для событий потоковой трансляции (сейчас поддерживаются протоколы RTMP и Smooth Streaming).<br/>Невозможно изменить параметр протокола, пока выполняется активное событие или связанные с ним динамические выходные данные. Если требуются разные протоколы, создайте отдельное событие Live для каждого протокола потоковой передачи.  
* Для создаваемого события можно настроить автоматический запуск. <br/>Если для автозапуска задано значение true, событие прямой трансляции будет запущено после создания. Плата начисляется сразу же после запуска трансляции. Чтобы остановить начисление оплаты, нужно явно вызвать функцию Stop (Остановить) для ресурса события потоковой трансляции. Кроме того, вы можете запустить событие, когда будете готовы начать потоковую передачу.

    Дополнительные сведения см. в статье [Состояния компонента LiveEvent и выставление счетов за его использование](live-event-states-billing.md).

* Ограничения по IP-адресам для приема и предварительного просмотра. Вы можете определить IP-адреса, с которых событие потоковой трансляции будет принимать видео. Можно указать отдельный допустимый IP-адрес (например, 10.0.0.1), или диапазон IP-адресов, используя IP-адрес и маску подсети CIDR (например, 10.0.0.1/22), или IP-адрес и маску подсети с точками (например, 10.0.0.1(255.255.252.0)).<br/>Если IP-адреса не указаны и правила не заданы, ни один IP-адрес не разрешен. Чтобы разрешить все IP-адреса, создайте правило и задайте адрес 0.0.0.0/0.<br/>IP-адреса должны иметь один из следующих форматов: IpV4-адрес с четырьмя числами или диапазоном адресов CIDR.

    Если вы хотите разрешить определенные IP-адреса в собственных брандмауэрах или хотите ограничить входные данные для своих интерактивных событий в IP адресах Azure, скачайте файл JSON из [диапазона IP-адресов центра обработки данных Azure](https://www.microsoft.com/download/details.aspx?id=41653). Для получения сведений об этом файле выберите раздел **сведения** на странице.

### <a name="naming-rules"></a>Правила именования

* Максимальное имя события в реальном времени — 32 символов.
* Имя должно соответствовать этому шаблону [регулярного выражения](https://docs.microsoft.com/dotnet/standard/base-types/regular-expression-language-quick-reference) : `^[a-zA-Z0-9]+(-*[a-zA-Z0-9])*$`.

См. также [правила именования конечных точек потоковой передачи](streaming-endpoint-concept.md#naming-convention).

> [!TIP]
> Чтобы гарантировать уникальность имени события Live, можно создать идентификатор GUID, а затем удалить все дефисы и фигурные скобки (если они есть). Строка будет уникальной для всех активных событий и ее длина гарантированно будет 32.

## <a name="live-event-ingest-urls"></a>URL-адреса приема событий потоковой трансляции

После создания события Live можно получить URL-адреса приема, которые вы будете предоставлять в реальном локальном кодировщике. Он использует эти адреса для передачи потоковой трансляции. Дополнительные сведения см. в статье о [рекомендуемых локальных динамических кодировщиках](recommended-on-premises-live-encoders.md).

Можно использовать запоминающиеся и незапоминающиеся URL-адреса.

> [!NOTE] 
> Чтобы URL-адрес был прогнозируемым, необходимо использовать режим запоминающихся адресов.

* Незапоминающийся URL-адрес

    По умолчанию в службах мультимедиа v3 используется не именного URL-адрес. Таким образом, вы можете быстро получить событие потоковой трансляции, но URL-адрес приема будет известен только после запуска события. URL-адрес изменится, если вы остановите или запустите событие потоковой трансляции. <br/>Именного используется в сценариях, когда конечному пользователю требуется выполнить потоковую передачу с помощью приложения, в котором приложение хочет получить ASAP о событии, а динамический URL-адрес приема не является проблемой.

    Если клиентскому приложению не требуется предварительно создавать URL-адрес приема перед созданием события Live, позвольте службам мультимедиа автоматически создать маркер доступа для события Live.

* Запоминающийся URL-адрес

    Режим именного является предпочтительным для больших трансляций мультимедиа, использующих кодировщики аппаратной рассылки и не требующих перенастройки кодировщиков при запуске интерактивного мероприятия. Им требуется прогнозируемый URL-адрес приема, который не меняется со временем.

    Чтобы указать этот режим, задайте для `vanityUrl` значение `true` во время создания (по умолчанию — `false`). Также необходимо передать собственный маркер доступа (`LiveEventInput.accessToken`) во время создания. Вы указываете значение токена, чтобы избежать случайного токена в URL-адресе. Маркер доступа должен быть допустимой строкой GUID (с дефисами или без них). После установки режима он не может быть обновлен.

    Маркер доступа должен быть уникальным в центре обработки данных. Если приложению требуется использовать URL-адрес именного, рекомендуется всегда создавать новый экземпляр GUID для маркера доступа (вместо повторного использования существующего идентификатора GUID).

    Используйте следующие интерфейсы API, чтобы включить URL-адрес именного и задать для маркера доступа допустимый идентификатор GUID (например, `"accessToken": "1fce2e4b-fb15-4718-8adc-68c6eb4c26a7"`).  

    |язык|Включить URL-адрес именного|Задание маркера доступа.|
    |---|---|---|
    |REST|[Properties. Ванитюрл](https://docs.microsoft.com/rest/api/media/liveevents/create#liveevent)|[Лививентинпут. accessToken](https://docs.microsoft.com/rest/api/media/liveevents/create#liveeventinput)|
    |Интерфейс командной строки|[--именного — URL-адрес](https://docs.microsoft.com/cli/azure/ams/live-event?view=azure-cli-latest#az-ams-live-event-create)|[--Access — токен](https://docs.microsoft.com/cli/azure/ams/live-event?view=azure-cli-latest#optional-parameters)|
    |.NET|[Лививент. Ванитюрл](https://docs.microsoft.com/dotnet/api/microsoft.azure.management.media.models.liveevent.vanityurl?view=azure-dotnet#Microsoft_Azure_Management_Media_Models_LiveEvent_VanityUrl)|[Лививентинпут. AccessToken](https://docs.microsoft.com/dotnet/api/microsoft.azure.management.media.models.liveeventinput.accesstoken?view=azure-dotnet#Microsoft_Azure_Management_Media_Models_LiveEventInput_AccessToken)|
    
### <a name="live-ingest-url-naming-rules"></a>Правила именования URL-адресов динамического приема

* *Случайная* строка ниже представляет собой 128-разрядное шестнадцатеричное число (состоящее из 32 знаков: 0–9 и a–f).
* *маркер доступа*: допустимая строка GUID, заданная при использовании режима именного. Пример: `"1fce2e4b-fb15-4718-8adc-68c6eb4c26a7"`.
* *имя потока*: указывает имя потока для конкретного соединения. Значение имени потока обычно добавляется используемым динамическим кодировщиком. Можно настроить динамический кодировщик для использования любого имени для описания соединения, например "video1_audio1", "video2_audio1", "Stream".

#### <a name="non-vanity-url"></a>Незапоминающийся URL-адрес

##### <a name="rtmp"></a>RTMP

`rtmp://<random 128bit hex string>.channel.media.azure.net:1935/live/<auto-generated access token>/<stream name>`<br/>
`rtmp://<random 128bit hex string>.channel.media.azure.net:1936/live/<auto-generated access token>/<stream name>`<br/>
`rtmps://<random 128bit hex string>.channel.media.azure.net:2935/live/<auto-generated access token>/<stream name>`<br/>
`rtmps://<random 128bit hex string>.channel.media.azure.net:2936/live/<auto-generated access token>/<stream name>`<br/>

##### <a name="smooth-streaming"></a>Smooth Streaming

`http://<random 128bit hex string>.channel.media.azure.net/<auto-generated access token>/ingest.isml/streams(<stream name>)`<br/>
`https://<random 128bit hex string>.channel.media.azure.net/<auto-generated access token>/ingest.isml/streams(<stream name>)`<br/>

#### <a name="vanity-url"></a>Запоминающийся URL-адрес

##### <a name="rtmp"></a>RTMP

`rtmp://<live event name>-<ams account name>-<region abbrev name>.channel.media.azure.net:1935/live/<your access token>/<stream name>`<br/>
`rtmp://<live event name>-<ams account name>-<region abbrev name>.channel.media.azure.net:1936/live/<your access token>/<stream name>`<br/>
`rtmps://<live event name>-<ams account name>-<region abbrev name>.channel.media.azure.net:2935/live/<your access token>/<stream name>`<br/>
`rtmps://<live event name>-<ams account name>-<region abbrev name>.channel.media.azure.net:2936/live/<your access token>/<stream name>`<br/>

##### <a name="smooth-streaming"></a>Smooth Streaming

`http://<live event name>-<ams account name>-<region abbrev name>.channel.media.azure.net/<your access token>/ingest.isml/streams(<stream name>)`<br/>
`https://<live event name>-<ams account name>-<region abbrev name>.channel.media.azure.net/<your access token>/ingest.isml/streams(<stream name>)`<br/>

## <a name="live-event-preview-url"></a>URL-адрес для предварительного просмотра событий потоковой трансляции

Когда событие Live начнет получать канал вклада, вы можете использовать его конечную точку предварительной версии для предварительного просмотра и проверки того, что вы получаете динамический поток перед дальнейшей публикацией. Убедившись в том, что поток предварительной версии является хорошим, можно использовать событие Live, чтобы сделать поток доступным для доставки через одну или несколько конечных точек потоковой передачи. Чтобы сделать это, создайте новый [динамический выход](https://docs.microsoft.com/rest/api/media/liveoutputs) для события Live.

> [!IMPORTANT]
> Прежде чем продолжить, убедитесь, что видео правильно передается на URL-адрес предварительного просмотра.

## <a name="live-event-long-running-operations"></a>Активные операции с длительными событиями

Дополнительные сведения см. в разделе [длительные операции](media-services-apis-overview.md#long-running-operations).

## <a name="live-outputs"></a>Динамичесие выходные данные

Настроив передачу потока данных в событие потоковой трансляции, можно запустить событие потоковой передачи, создав [ресурс](https://docs.microsoft.com/rest/api/media/assets), [выходные данные потоковой трансляции](https://docs.microsoft.com/rest/api/media/liveoutputs) и [указатель потоковой передачи](https://docs.microsoft.com/rest/api/media/streaminglocators). Выходные данные потоковой трансляции запустят архивирование потока и предложат его зрителям через [конечную точку потоковой передачи](https://docs.microsoft.com/rest/api/media/streamingendpoints).  

Подробные сведения о динамических выходных данных см. в разделе [Использование DVR для облака](live-event-cloud-dvr.md).

## <a name="ask-questions-give-feedback-get-updates"></a>Получение справки, отправка отзывов, получение обновлений

Прочитайте статью [сообщества Служб мультимедиа Azure](media-services-community.md), чтобы узнать, как задавать вопросы, оставлять отзывы и получать новости о Службах мультимедиа.

## <a name="next-steps"></a>Дальнейшие действия

[Руководство по потоковой трансляции](stream-live-tutorial-with-api.md)
