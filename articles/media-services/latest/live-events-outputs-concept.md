---
title: Основные понятия потоковой трансляции с использованием Служб мультимедиа Azure — события и выходные данные прямой трансляции | Документация Майкрософт
description: В этой статье содержатся общие сведения об основных понятиях потоковой трансляции с использованием Служб мультимедиа Azure версии 3.
services: media-services
documentationcenter: ''
author: Juliako
manager: femila
editor: ''
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: ne
ms.topic: article
ms.date: 04/21/2019
ms.author: juliako
ms.openlocfilehash: 87620cb0c7aafb78b2c8fe610f42ad092313d305
ms.sourcegitcommit: f6ba5c5a4b1ec4e35c41a4e799fb669ad5099522
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65153486"
---
# <a name="live-events-and-live-outputs"></a>События и выходные данные прямой трансляции

Службы мультимедиа Azure дают возможность предоставлять клиентам события прямой трансляции в облаке Azure. Для настройки динамических потоковой передачи событий в версии 3 службы мультимедиа, необходимо понимать концепции, описанные в этой статье. <br/>Список разделов, отображается в правой части страницы.

## <a name="live-events"></a>Динамические события

[События потоковой трансляции](https://docs.microsoft.com/rest/api/media/liveevents) отвечают за прием и обработку видеопотоков. При создании события потоковой трансляции формируется входная конечная точка, которая используется для передачи сигнала с удаленного кодировщика в реальном времени. Удаленный динамический кодировщик транслирует в эту точку канал доставки, используя протокол [RTMP](https://www.adobe.com/devnet/rtmp.html) или [Smooth Streaming](https://msdn.microsoft.com/library/ff469518.aspx) (фрагментированный MP4). Для протокола приема Smooth Streaming поддерживаются следующие схемы URL-адресов: `http://` или `https://`. Для протокола приема RTMP поддерживаются следующие схемы URL-адресов: `rtmp://` или `rtmps://`. 

## <a name="live-event-types"></a>Типы событий потоковой трансляции

Есть два типа [событий потоковой трансляции](https://docs.microsoft.com/rest/api/media/liveevents): сквозной режим и кодирование в реальном времени. 

### <a name="pass-through"></a>Сквозной режим

![Сквозной режим](./media/live-streaming/pass-through.svg)

При использовании сквозного режима **потоковой трансляции** локальный динамический кодировщик генерирует многоскоростной видеопоток и передает его как исходный в трансляцию с помощью протокола RTMP или фрагментированного MP4. Затем событие потоковой трансляции передает входящие видеопотоки без какой-либо дальнейшей обработки. Такой сквозной режим оптимизирован для длительно выполняющихся событий прямой трансляции или непрерывной круглогодичной линейной потоковой трансляции. Создавая событие потоковой трансляции такого типа, укажите значение None (LiveEventEncodingType.None).

При этом исходный поток передается с разрешением до 4K и частотой 60 кадров в секунду при помощи видеокодеков H.264/AVC или H.265/HEVC, а также аудиокодека AAC (AAC-LC, HE-AACv1 или HE-AACv2).  Дополнительные сведения см. в статье, посвященной [сравнительным характеристикам и ограничениям типов событий потоковой трансляции](live-event-types-comparison.md).

> [!NOTE]
> Метод сквозной доставки — наиболее экономичный способ осуществления потоковой передачи в режиме реального времени, если передается ряд событий за длительный период времени и у вас уже есть локальные кодировщики. См. сведения о [ценах](https://azure.microsoft.com/pricing/details/media-services/).
> 

См. пример кода .NET в [MediaV3LiveApp](https://github.com/Azure-Samples/media-services-v3-dotnet-core-tutorials/blob/master/NETCore/Live/MediaV3LiveApp/Program.cs#L126).

### <a name="live-encoding"></a>Кодирование в реальном времени  

![Кодирование в реальном времени](./media/live-streaming/live-encoding.svg)

При использовании кодирования в реальном времени с помощью Служб мультимедиа ваш локальный динамический кодировщик передает односкоростной видеопоток в качестве исходного в событие потоковой трансляции (с помощью протоколов RTMP или фрагментированного MP4). Событие потоковой трансляции кодирует этот входящий односкоростной поток в [многоскоростной видеопоток](https://en.wikipedia.org/wiki/Adaptive_bitrate_streaming) и делает его доступным для доставки на устройства воспроизведения с помощью протоколов MPEG-DASH, HLS и Smooth Streaming. Создавая событие потоковой трансляции такого типа, укажите тип кодирования **Standard** (LiveEventEncodingType.Standard).

Исходный поток передается с разрешением до 1080p и частотой 30 кадров в секунду при помощи видеокодека H.264/AVC и аудиокодека AAC (AAC-LC, HE-AACv1 или HE-AACv2). Дополнительные сведения см. в статье, посвященной [сравнительным характеристикам и ограничениям типов событий потоковой трансляции](live-event-types-comparison.md).

Если используется кодирование в реальном времени (для параметра "Событие прямой трансляции" задано значение **Стандартное**), в предустановке кодирования определено, как кодируется входящий поток с использованием нескольких скоростей или слоев. Дополнительные сведения см. в разделе о [системных предустановках](live-event-types-comparison.md#system-presets).

> [!NOTE]
> *Default720p* — единственное предустановленное значение, которое сейчас допускается для события прямой трансляции стандартного типа. Если вам нужно использовать пользовательскую предустановку для кодирования в реальном времени, обратитесь по адресу amshelp@microsoft.com. Следует указать нужную таблицу с разрешениями и скоростями. Убедитесь, что имеется только один слой 720p и не более 6 слоев.

## <a name="live-event-creation-options"></a>Параметры создания событий потоковой трансляции

При создании события потоковой трансляции можно указать следующие параметры.

* Протокол потоковой передачи для событий потоковой трансляции (сейчас поддерживаются протоколы RTMP и Smooth Streaming).<br/>Изменить протокол во время работы события потоковой трансляции или связанных с ним выходных данных потоковой трансляции нельзя. Если вам нужны другие протоколы потоковой передачи, создайте отдельное событие потоковой трансляции для каждого из них.  
* Ограничения по IP-адресам для приема и предварительного просмотра. Вы можете определить IP-адреса, с которых событие потоковой трансляции будет принимать видео. Можно указать отдельный допустимый IP-адрес (например, 10.0.0.1), или диапазон IP-адресов, используя IP-адрес и маску подсети CIDR (например, 10.0.0.1/22), или IP-адрес и маску подсети с точками (например, 10.0.0.1(255.255.252.0)).<br/>Если IP-адреса не указаны и правила не заданы, ни один IP-адрес не разрешен. Чтобы разрешить все IP-адреса, создайте правило и задайте адрес 0.0.0.0/0.<br/>IP-адреса должны быть представлены в одном из следующих форматов: IPv4-адрес с 4 цифрами, диапазон адресов CIDR.
* Для создаваемого события можно настроить автоматический запуск. <br/>Если для автозапуска задано значение true, событие прямой трансляции будет запущено после создания. Плата начисляется сразу же после запуска трансляции. Чтобы остановить начисление оплаты, нужно явно вызвать функцию Stop (Остановить) для ресурса события потоковой трансляции. Кроме того, событие можно запустить, когда вы будете готовы начать потоковую передачу. 

    Дополнительные сведения см. в статье [Состояния компонента LiveEvent и выставление счетов за его использование](live-event-states-billing.md).

## <a name="live-event-ingest-urls"></a>URL-адреса приема событий потоковой трансляции

После создания события потоковой трансляции можно получить URL-адреса приема, которые необходимо передать локальному динамическому кодировщику. Он использует эти адреса для передачи потоковой трансляции. Дополнительные сведения см. в статье о [рекомендуемых локальных динамических кодировщиках](recommended-on-premises-live-encoders.md). 

Можно использовать запоминающиеся и незапоминающиеся URL-адреса. 

* Незапоминающийся URL-адрес

    Незапоминающиеся URL-адреса — это режим по умолчанию в AMS версии 3. Таким образом, вы можете быстро получить событие потоковой трансляции, но URL-адрес приема будет известен только после запуска события. URL-адрес изменится, если вы остановите или запустите событие потоковой трансляции. <br/>Незапоминающиеся URL-адреса полезны в сценариях, когда пользователь хочет транслировать поток с помощью приложения максимально быстро и имеющийся динамический URL-адрес приема не является проблемой.
* Запоминающийся URL-адрес

    Режим запоминающихся URL-адресов является предпочтительным для крупных медиа-вещателей, которые используют аппаратные широковещательные кодировщики и не хотят повторно их настраивать при запуске события потоковой трансляции. Им нужен прогнозируемый URL-адрес приема, который не будет изменяется со временем.

> [!NOTE] 
> Чтобы URL-адрес был прогнозируемым, необходимо использовать режим запоминающихся адресов и передать собственный маркер доступа (чтобы избежать случайного маркера в URL-адресе).

### <a name="live-ingest-url-naming-rules"></a>Правила именования URL-адресов динамического приема

*Случайная* строка ниже представляет собой 128-разрядное шестнадцатеричное число (состоящее из 32 знаков: 0–9 и a–f).<br/>
*Маркер доступа*, приведенный ниже, — это то, что вам нужно указать для фиксированного URL-адреса. Он также является 128-разрядным шестнадцатеричным числом.

#### <a name="non-vanity-url"></a>Незапоминающийся URL-адрес

##### <a name="rtmp"></a>RTMP

`rtmp://<random 128bit hex string>.channel.media.azure.net:1935/<access token>`
`rtmp://<random 128bit hex string>.channel.media.azure.net:1936/<access token>`
`rtmps://<random 128bit hex string>.channel.media.azure.net:2935/<access token>`
`rtmps://<random 128bit hex string>.channel.media.azure.net:2936/<access token>`

##### <a name="smooth-streaming"></a>Smooth Streaming

`http://<random 128bit hex string>.channel.media.azure.net/<access token>/ingest.isml`
`https://<random 128bit hex string>.channel.media.azure.net/<access token>/ingest.isml`

#### <a name="vanity-url"></a>Запоминающийся URL-адрес

##### <a name="rtmp"></a>RTMP

`rtmp://<live event name>-<ams account name>-<region abbrev name>.channel.media.azure.net:1935/<access token>`
`rtmp://<live event name>-<ams account name>-<region abbrev name>.channel.media.azure.net:1936/<access token>`
`rtmps://<live event name>-<ams account name>-<region abbrev name>.channel.media.azure.net:2935/<access token>`
`rtmps://<live event name>-<ams account name>-<region abbrev name>.channel.media.azure.net:2936/<access token>`

##### <a name="smooth-streaming"></a>Smooth Streaming

`http://<live event name>-<ams account name>-<region abbrev name>.channel.media.azure.net/<access token>/ingest.isml`
`https://<live event name>-<ams account name>-<region abbrev name>.channel.media.azure.net/<access token>/ingest.isml`

## <a name="live-event-preview-url"></a>URL-адрес для предварительного просмотра событий потоковой трансляции

Как только **событие потоковой трансляции** начинает принимать исходный поток, можно использовать конечную точку предварительного просмотра, чтобы перед публикацией убедиться, что вы принимаете потоковую трансляцию в реальном времени. Убедившись, что предварительный просмотр транслируется нормально, используйте компонент LiveEvent, чтобы сделать потоковую трансляцию доступной для доставки через одну или несколько предварительно созданных точек **StreamingEndpoint**. Для этого создайте [выходные данные потоковой трансляции](https://docs.microsoft.com/rest/api/media/liveoutputs) в **событии потоковой трансляции**. 

> [!IMPORTANT]
> Прежде чем продолжить, убедитесь, что видео правильно передается на URL-адрес предварительного просмотра.

## <a name="live-event-long-running-operations"></a>Динамические события длительных операций

Дополнительные сведения см. в разделе [длительных операций](media-services-apis-overview.md#long-running-operations)

## <a name="live-outputs"></a>Динамичесие выходные данные

Настроив передачу потока данных в событие потоковой трансляции, можно запустить событие потоковой передачи, создав [ресурс](https://docs.microsoft.com/rest/api/media/assets), [выходные данные потоковой трансляции](https://docs.microsoft.com/rest/api/media/liveoutputs) и [указатель потоковой передачи](https://docs.microsoft.com/rest/api/media/streaminglocators). Выходные данные потоковой трансляции запустят архивирование потока и предложат его зрителям через [конечную точку потоковой передачи](https://docs.microsoft.com/rest/api/media/streamingendpoints).  

> [!NOTE]
> Выходные данные потоковой трансляции запускаются при создании и останавливаются при удалении. При удалении выходных данных потоковой трансляции базовый ресурс и его содержимое не удаляются. 

Отношения между **событием потоковой трансляции** и соответствующими **выходными данными** похожи на традиционное телевещание, когда канал (**событие потоковой трансляции**) передает постоянный поток видео, а запись (**выходные данные потоковой трансляции**) ограничивается определенным периодом времени (например, вечерние новости с 18:30 до 19:00). Телевизионные передачи можно записывать с помощью устройства записи цифрового видео (DVR). Аналогичная функция в событиях потоковой трансляции управляется с помощью свойства **ArchiveWindowLength**. Это длительность временного диапазона ISO-8601 (например, PTHH:MM:SS), задающая объем DVR. Для нее можно задать значение от 3 минут до 25 часов.

Объект **выходных данных потоковой трансляции** действует, как магнитофон: захватывает трансляцию и записывает ее в ресурс Asset в вашей учетной записи Служб мультимедиа. Записанное содержимое сохраняется в учетной записи хранения Azure, подключенной к вашей учетной записи, в контейнере, определенном ресурсом Asset. **Выходные данные потоковой трансляции** дают возможность управлять свойствами исходящей потоковой трансляции, в частности тем, какая ее часть хранится в архивной записи (объем DVR в облаке) и могут ли зрители начать просмотр трансляции. Архив на диске — это циклическое архивное "окно", которое пропускает только тот объем содержимого, который указан в свойстве **archiveWindowLength** **выходных данный потоковой трансляции**. Содержимое, выходящее за рамки этого окна, автоматически удаляется из контейнера хранилища и не подлежит восстановлению. В **событии потоковой трансляции** можно создать несколько объектов **выходных данных потоковой трансляции** (до трех) с разными длиной и параметрами архивации.  

После публикации **ресурса** **выходных данных потоковой трансляции** с использованием **указателя потоковой передачи** **событие потоковой трансляции** (до длины окна DVR) будет доступно для просмотра до истечения срока действия или удаления указателя потоковой передачи, в зависимости от того, какое действие произойдет первым.

Дополнительные сведения см. в статье [Использование средства цифровой видеозаписи в облаке](live-event-cloud-dvr.md).

## <a name="ask-questions-give-feedback-get-updates"></a>Задавайте вопросы, отзыв, получить обновления

Прочитайте статью [сообщества Служб мультимедиа Azure](media-services-community.md), чтобы узнать, как задавать вопросы, оставлять отзывы и получать новости о Службах мультимедиа.

## <a name="next-steps"></a>Дальнейшие действия

[Руководство по потоковой трансляции](stream-live-tutorial-with-api.md)
