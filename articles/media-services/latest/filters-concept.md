---
title: Определение фильтров в Службах мультимедиа Microsoft Azure
description: В этом разделе описывается создание фильтров, с помощью которых клиент может передавать определенные секции потока. Для достижения такой выборочной потоковой передачи службы мультимедиа создают динамические манифесты.
services: media-services
documentationcenter: ''
author: Juliako
manager: femila
editor: ''
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: ne
ms.topic: article
ms.date: 05/23/2019
ms.author: juliako
ms.openlocfilehash: fdf29924da31db0347938df89e698cb258c2336b
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79251470"
---
# <a name="filters"></a>Фильтры

При доставке содержимого клиентам (события Live Streaming или Video on Demand) вашему клиенту может потребоваться больше гибкости, чем то, что описано в файле актива по умолчанию. Служба мультимедиа Azure предлагает [динамические манифесты](filters-dynamic-manifest-overview.md) на основе заранее определенных фильтров. 

Фильтры — это серверные правила, с помощью которых пользователи могут выполнять различные действия, в том числе перечисленные ниже. 

- Воспроизведение только части видео (вместо воспроизведения видео целиком). Пример:
  - Сокращение манифеста для отображения субклипа текущего события ("фильтрация субклипов") или
  - Обрезка начала видео ("обрезка видео").
- Доставка только указанных представлений и/или языковых дорожек, поддерживаемых устройством, на котором воспроизводится содержимое ("фильтрация представлений"). 
- Настройка окна представления (DVR) для предоставления ограниченной длительности окна DVR в проигрывателе ("настройка окна представления").

Медиа-сервисы позволяют создавать **фильтры учетных записей** и **активы** для вашего контента. Кроме того, вы можете связать предварительно созданные фильтры с **потоковым locator.**

## <a name="defining-filters"></a>Определение фильтров

Существует два типа фильтров: 

* [Фильтры учетных записей](https://docs.microsoft.com/rest/api/media/accountfilters) (глобальные) — применимы к любому ресурсу в учетной записи Служб мультимедиа Azure и действуют в течение всего времени ее существования.
* [Фильтры ресурсов](https://docs.microsoft.com/rest/api/media/assetfilters) (локальные) — применимы только к тому ресурсу, с которым фильтр был связан при создании, и действуют в течение времени существования ресурса. 

**Фильтры учетных записей** и **типы фильтров активов** имеют точно такие же свойства для определения/описания фильтра. Во всех случаях, кроме создания **фильтра ресурса**, необходимо указать имя ресурса, с которым требуется связать фильтр.

В зависимости от сценария, вы выбираете наиболее подходящий тип фильтра (фильтр ресурса или учетной записи). Фильтры учетных записей подходят для профилей устройств (фильтрация представлений), в то время как фильтры ресурсов можно использовать для обрезки определенного ресурса.

Для описания фильтров можно использовать указанные ниже свойства. 

|name|Описание|
|---|---|
|firstQuality|Первая качественная скорость фильтра.|
|presentationTimeRange|Диапазон времени презентации. Это свойство используется для фильтрации начальной и конечной точек манифеста, длины окна презентации и начального положения прямой трансляции. <br/>Дополнительные сведения см. в разделе [PresentationTimeRange](#presentationtimerange).|
|tracks|Условия выбора дорожек. Дополнительные сведения см. в разделе [tracks](#tracks).|

### <a name="presentationtimerange"></a>presentationTimeRange

Это свойство используется с **фильтрами ресурсов**. Не рекомендуем задавать это свойство для **фильтров учетных записей**.

|name|Описание|
|---|---|
|**endTimestamp**|Применяется для видео по запросу (VoD).<br/>Для презентации Live Streaming она бесшумно игнорируется и применяется, когда презентация заканчивается и поток становится VoD.<br/>Это длинное значение, которое представляет собой абсолютную конечную точку презентации, округленную к самому близкому следующему старту GOP. Устройство является шкалой времени, так что endTimestamp 180000000000 будет в течение 3 минут.<br/>Используйте startTimestamp и endTimestamp для обрезки фрагментов, которые будут находиться в плейлисте (манифест).<br/>Например, startTimestamp-400000000 и endTimestamp 10000000000 с использованием шкалы времени по умолчанию будут генерировать плейлист, содержащий фрагменты от 4 секунд до 10 секунд презентации VoD. Если фрагмент выходит за границы, он будет включен в манифест целиком.|
|**forceEndTimestamp**|Применяется только к потоковой передаче в реальном времени.<br/>Указывает, должно ли присутствовать свойство endTimestamp. Если это правда, необходимо указать endTimestamp или вернуть плохой код запроса.<br/>Допустимые значения: false, true.|
|**liveBackoffDuration**|Применяется только к потоковой передаче в реальном времени.<br/> Это значение определяет последнюю живую позицию, к которой может стремиться клиент.<br/>Используя это свойство, можно отсрочить положение воспроизведения в реальном времени и создать буфер на стороне сервера для игроков.<br/>Единица для этого свойства является временной шкалой (см. ниже).<br/>Максимальная продолжительность жизни отсутсвия 300 секунд (300000000000).<br/>Например, значение 20000000000 означает, что последний доступный контент отсрочен на 20 секунд от реального живого края.|
|**presentationWindowDuration**|Применяется только к потоковой передаче в реальном времени.<br/>Используйте presentationDuration для нанесения раздвижного окна фрагментов для включения в плейлист.<br/>Единица для этого свойства является временной шкалой (см. ниже).<br/>Например, задайте значение presentationWindowDuration = 1200000000, чтобы применить двухминутное скользящее окно. В список воспроизведения будут включены данные мультимедиа за две минуты до крайней позиции прямой трансляции. Если фрагмент выходит за границы, он будет включен в список воспроизведения целиком. Минимальная продолжительность окна презентации составляет 60 секунд.|
|**startTimestamp**|Применяется к видео по требованию (VoD) или потоковой передаче в реальном времени.<br/>Это длинное значение, которое представляет собой абсолютную отправную точку потока. Оно округляется до начала ближайшей из следующих групп изображений. Устройство является шкалой времени, так что startTimestamp 150000000 будет в течение 15 секунд.<br/>Используйте startTimestamp и endTimestampp, чтобы обрезать фрагменты, которые будут в плейлисте (манифест).<br/>Например, startTimestamp-400000000 и endTimestamp 10000000000 с использованием шкалы времени по умолчанию будут генерировать плейлист, содержащий фрагменты от 4 секунд до 10 секунд презентации VoD. Если фрагмент выходит за границы, он будет включен в манифест целиком.|
|**timescale**|Применяется ко всем отметкам времени и длительности в диапазоне времени представления, указанном как количество приращений в одну секунду.<br/>По умолчанию 10000000 - десять миллионов шагом в одну секунду, где каждый прирост будет 100 наносекунд длиной.<br/>Например, если вы хотите установить startTimestamp на 30 секунд, при использовании шкалы времени по умолчанию будет использоваться значение 3000000000.|

### <a name="tracks"></a>Дорожки

Вы указываете список условий свойства отслеживания фильтров (FilterTrackPropertyConditions), на основе которых треки вашего потока (Live Streaming или Video on Demand) должны быть включены в динамически созданный манифест. Фильтры объединяются с помощью логических операций **AND** и **OR**.

Условия фильтрации свойств дорожек описывают типы дорожек, значения (приведенные в таблице ниже) и операции (Equal, NotEqual). 

|name|Описание|
|---|---|
|**Bitrate**|Фильтрация по скорости дорожки.<br/><br/>Рекомендуемое значение — диапазон скоростей (в битах в секунду). Пример: "0-2427000".<br/><br/>Примечание: можно использовать конкретное значение скорости, например 250000 (бит в секунду), но такой подход не рекомендуется, так как точная скорость может меняться от ресурса к ресурсу.|
|**FourCC**|Фильтрация по значению FourCC дорожки.<br/><br/>Это значение является первым элементом формата кодеков согласно стандарту [RFC 6381](https://tools.ietf.org/html/rfc6381). Сейчас поддерживаются перечисленные ниже кодеки. <br/>Для видео: "avc1", "hev1", "hvc1"<br/>Для звука: "mp4a", "ec-3"<br/><br/>Чтобы определить значения FourCC для дорожек в ресурсе, получите и просмотрите файл манифеста.|
|**Язык**|Фильтрация по языку дорожки.<br/><br/>Это значение представляет собой тег языка, который требуется включить, как указано в стандарте RFC 5646. Например, en.|
|**Название**|Фильтрация по имени дорожки.|
|**Тип**|Фильтрация по типу дорожки.<br/><br/>Допускаются следующие значения: "video", "audio" и "text".|

### <a name="example"></a>Пример

Следующий пример определяет фильтр потоковой передачи в реальном времени: 

```json
{
  "properties": {
    "presentationTimeRange": {
      "startTimestamp": 0,
      "endTimestamp": 170000000,
      "presentationWindowDuration": 9223372036854776000,
      "liveBackoffDuration": 0,
      "timescale": 10000000,
      "forceEndTimestamp": false
    },
    "firstQuality": {
      "bitrate": 128000
    },
    "tracks": [
      {
        "trackSelections": [
          {
            "property": "Type",
            "operation": "Equal",
            "value": "Audio"
          },
          {
            "property": "Language",
            "operation": "NotEqual",
            "value": "en"
          },
          {
            "property": "FourCC",
            "operation": "NotEqual",
            "value": "EC-3"
          }
        ]
      },
      {
        "trackSelections": [
          {
            "property": "Type",
            "operation": "Equal",
            "value": "Video"
          },
          {
            "property": "Bitrate",
            "operation": "Equal",
            "value": "3000000-5000000"
          }
        ]
      }
    ]
  }
}
```

## <a name="associating-filters-with-streaming-locator"></a>Связь фильтров с потоковым локатором

Вы можете указать список [фильтров активов или учетных записей](filters-concept.md) на [потоковом locator.](https://docs.microsoft.com/rest/api/media/streaminglocators/create#request-body) [Динамический packager](dynamic-packaging-overview.md) применяет этот список фильтров вместе с теми, которые ваш клиент указывает в URL. Эта комбинация генерирует [динамический манифест,](filters-dynamic-manifest-overview.md)который основан на фильтрах в фильтрах URL, которые вы указываете на потоковом локаторе. 

См. следующие примеры.

* [Ассоциированные фильтры с потоковым локатором - .NET](filters-dynamic-manifest-dotnet-howto.md#associate-filters-with-streaming-locator)
* [Ассоциированные фильтры с потоковым локатором - CLI](filters-dynamic-manifest-cli-howto.md#associate-filters-with-streaming-locator)

## <a name="updating-filters"></a>Обновление фильтров
 
**Потоковые локаторы** не обновляются, в то время как фильтры могут быть обновлены. 

Не рекомендуется обновлять определение фильтров, связанных с активно публикуемым **Streaming Locator,** особенно при включении CDN. Потоковые серверы и CD-коды могут иметь внутренние кэши, которые могут привести к возврату устаревших кэшированных данных. 

Если определение фильтра необходимо изменить, подумайте о создании нового фильтра и добавлении его в **URL-адрес потокового locator** или о публикации нового **потокового locator,** который напрямую ссылается на фильтр.

## <a name="next-steps"></a>Дальнейшие действия

В указанных ниже статьях показано, как создавать фильтры программным способом.  

- [Create filters with REST APIs](filters-dynamic-manifest-rest-howto.md) (Создание фильтров с помощью интерфейсов REST API)
- [Создание фильтров с помощью .NET](filters-dynamic-manifest-dotnet-howto.md)
- [Create filters with CLI](filters-dynamic-manifest-cli-howto.md) (Создание фильтров с помощью .NET)

