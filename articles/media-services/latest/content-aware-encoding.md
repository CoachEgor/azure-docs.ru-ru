---
title: Предустановленная для кодирования кодирования контента - Медиа-сервисы Azure
description: В этой статье обсуждается кодирование контента в Microsoft Azure Media Services v3.
services: media-services
documentationcenter: ''
author: Juliako
manager: femila
editor: ''
ms.service: media-services
ms.workload: ''
ms.topic: article
ms.date: 01/24/2020
ms.author: juliako
ms.custom: ''
ms.openlocfilehash: 3ea6c4226a59ba020a477cc5811033ff3dc3c2e9
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "76772079"
---
# <a name="use-the-content-aware-encoding-preset-to-find-the-optimal-bitrate-value-for-a-given-resolution"></a>Используйте предварительное кодирование кодирования содержимого, чтобы найти оптимальное значение битрата для данного разрешения

Для того, чтобы подготовить контент для доставки [адаптивной битрат потоковой передачи,](https://en.wikipedia.org/wiki/Adaptive_bitrate_streaming)видео должно быть закодировано на нескольких бит-курсов (от высоких до низких). Это обеспечивает изящную деградацию качества, так как битрат снижается так же разрешение видео. Такое многократное кодирование бит-курса использует так называемую кодирующую лестницу - таблицу разрешений и битратов, см. [Медиа-сервисы, встроенные в кодирование пресетов.](https://docs.microsoft.com/rest/api/media/transforms/createorupdate#encodernamedpreset)

Вы должны быть осведомлены о содержимом, который вы обрабатываете, и настроить / настроить кодирование лестницы к сложности отдельного видео. В каждом разрешении есть битрат, за которым любое повышение качества не является проницательным - кодер работает на этом оптимальном значении битрата. Следующим уровнем оптимизации является выбор резолюций на основе содержания - например, видео презентации PowerPoint не выигрывает от ниже 720p. Идя дальше, кодер может быть поставлена задача оптимизировать настройки для каждого выстрела в видео. 

Предустановленная настройка [адаптивной потоковой передачи](autogen-bitrate-ladder.md) от Microsoft частично решает проблему изменчивости качества и разрешения исходных видео. Наши клиенты имеют различное сочетание содержания, некоторые на 1080p, другие на 720p, и несколько на SD и более низких разрешений. Кроме того, не все исходные материалы являются высококачественными мезонинами кино- или телестудий. Адаптивная потоковая предустановка решает эти проблемы, гарантируя, что битратная лестница никогда не превышает разрешение или средний битрат мезонина ввода. Однако эта предустановка не исследует свойства источника, кроме разрешения и битра.

## <a name="the-content-aware-encoding"></a>Кодирование, осведомленное о содержании 

Содержимое кодирования пресет расширяет "адаптивный битрат потокового" механизм, путем включения пользовательской логики, которая позволяет кодере искать оптимальное значение битрат для данного разрешения, но не требуя обширного вычислительного анализа. Эта предустановка производит набор GOP-выровненных MP4s. Учитывая любое содержимое ввода, служба выполняет первоначальный легкий анализ содержимого ввода и использует результаты для определения оптимального количества слоев, соответствующих настроек битра и разрешения для доставки с помощью адаптивной потоковой передачи. Эта предустановка особенно эффективна для видео с низкой и средней сложностью, где выходные файлы будут находиться на более низких битратах, чем предустановленная адаптивная потоковая передача, но при качестве, которое по-прежнему обеспечивает хороший опыт для зрителей. Выход будет содержать файлы MP4 с видео- и аудиопереплетенными

Следующие графики образца показывают сравнение с использованием показателей качества, таких как [PSNR](https://en.wikipedia.org/wiki/Peak_signal-to-noise_ratio) и [VMAF](https://en.wikipedia.org/wiki/Video_Multimethod_Assessment_Fusion). Источник был создан путем concatenating короткие клипы высокой сложности выстрелов из фильмов и телевизионных шоу, предназначенных для стресса кодера. По определению, эта предустановка дает результаты, которые варьируются от содержания к содержанию - это также означает, что для некоторых содержание, не может быть значительного сокращения битрата или улучшения качества.

![Кривая искажения ставок (RD) с помощью PSNR](media/content-aware-encoding/msrv1.png)

**Рисунок 1: Кривая искажения ставок (RD) с использованием метрики PSNR для источника высокой сложности**

![Кривая искажения скорости (RD) с помощью VMAF](media/content-aware-encoding/msrv2.png)

**Рисунок 2: Кривая искажения ставок (RD) с использованием метрики VMAF для источника высокой сложности**

Ниже приведены результаты для другой категории исходного содержимого, где кодер был в состоянии определить, что вход был низкого качества (многие артефакты сжатия из-за низкого битра). Обратите внимание, что с содержанием осведомлены предустановленных, кодер решил производить только один выходной слой - на достаточно низком битре, так что большинство клиентов смогут играть в потоке без срыва.

![Кривая RD с использованием PSNR](media/content-aware-encoding/msrv3.png)

**Рисунок 3: КРИвая RD с использованием PSNR для некачественного ввода (на 1080p)**

![КРИвая RD с использованием VMAF](media/content-aware-encoding/msrv4.png)

**Рисунок 4: КРИвая RD с использованием VMAF для некачественного ввода (на 1080p)**

## <a name="how-to-use-the-content-aware-encoding-preset"></a>Как использовать предварительное кодирование кодирования содержимого 

Можно создать преобразования, которые используют этот предустановленный набор следующим образом. 

> [!TIP]
> Смотрите раздел [«Следующие шаги»](#next-steps) для учебников, в которые используются трансформные выходы. Выходный актив может быть доставлен из потоковых конечных точек Media Services в таких протоколах, как MPEG-DASH и HLS (как показано в учебниках).


```csharp
TransformOutput[] output = new TransformOutput[]
{
   new TransformOutput
   {
      // The preset for the Transform is set to one of Media Services built-in sample presets.
      // You can customize the encoding settings by changing this to use "StandardEncoderPreset" class.
      Preset = new BuiltInStandardEncoderPreset()
      {
         // This sample uses the new preset for content-aware encoding
         PresetName = EncoderNamedPreset.ContentAwareEncoding
      }
   }
};
```

> [!NOTE]
> Задания кодирования с `ContentAwareEncoding` использованием предустановленного набора выставляются на основе выходных минут. 

## <a name="next-steps"></a>Дальнейшие действия

* [Учебник: Загрузка, кодирование и потоковое видео с медиа-сервисами v3](stream-files-tutorial-with-api.md)
* [Учебник: Кодирование удаленного файла на основе URL и потоковое видео - REST](stream-files-tutorial-with-rest.md)
* [Учебник: Кодирование удаленного файла на основе URL и потоковое видео - CLI](stream-files-cli-quickstart.md)
* [Учебник: Кодирование удаленного файла на основе URL и потоковое видео - .NET](stream-files-dotnet-quickstart.md)
* [Учебник: Кодирование удаленного файла на основе URL и потоковое видео - Node.js](stream-files-nodejs-quickstart.md)
