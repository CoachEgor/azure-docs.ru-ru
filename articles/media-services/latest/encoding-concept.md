---
title: Кодирование видео и аудио с помощью медиа-услуг
titleSuffix: Azure Media Services
description: В этой статье рассказывается о кодировании видео и аудио с помощью Медиа-сервисов Azure.
services: media-services
documentationcenter: ''
author: Juliako
manager: femila
editor: ''
ms.service: media-services
ms.workload: ''
ms.topic: article
ms.date: 09/10/2019
ms.author: juliako
ms.custom: seodec18
ms.openlocfilehash: 6e1c9aa5c2e049d5fc1ebd8bf745417f56d232ec
ms.sourcegitcommit: 07d62796de0d1f9c0fa14bfcc425f852fdb08fb1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "80366568"
---
# <a name="encoding-video-and-audio-with-media-services"></a>Кодирование видео и аудио с помощью медиа-услуг

Термин кодирование в Media Services применяется к процессу преобразования файлов, содержащих цифровое видео и/или аудио из одного стандартного формата в другой, с целью а) сокращения размера файлов и/или (b) создания формата, совместимого с широким спектром устройств и приложений. Этот процесс также называют сжатием видео или транскодированием. Смотрите [сжатие данных](https://en.wikipedia.org/wiki/Data_compression) и [что такое кодирование и транскодирование?](https://www.streamingmedia.com/Articles/Editorial/What-Is-/What-Is-Encoding-and-Transcoding-75025.aspx) для дальнейшего обсуждения концепций.

Видео обычно доставляются на устройства и приложения [путем прогрессивной загрузки](https://en.wikipedia.org/wiki/Progressive_download) или через [адаптивную потоковую передачу биттратов.](https://en.wikipedia.org/wiki/Adaptive_bitrate_streaming)

> [!IMPORTANT]
> Службы мультимедиа не выставляют счета за отмененные или ошибочными задания. Например, задание, которое достигло 50% прогресса и отменено, не выставляется на 50% протоколов работы. С вас взимается плата только за готовые работы.

* Для постепенной загрузки можно использовать медиасервисAzну для преобразования цифрового медиафайла (мезонина) в файл [MP4,](https://en.wikipedia.org/wiki/MPEG-4_Part_14) который содержит видео, которое было закодировано кодеком [H.264,](https://en.wikipedia.org/wiki/H.264/MPEG-4_AVC) и аудио, которое было закодировано кодеем [AAC.](https://en.wikipedia.org/wiki/Advanced_Audio_Coding) Этот файл MP4 записывается в актив в вашей учетной записи хранения. Для непосредственной загрузки файла можно использовать ApIs-системы хранения Azure или SDK (например, [API Storage REST](../../storage/common/storage-rest-api-auth.md) или [.NET SDK).](../../storage/blobs/storage-quickstart-blobs-dotnet.md) Если вы создали выходный актив с определенным именем контейнера в хранилище, используйте это место. В противном случае можно использовать медиа-сервисы для [рассылки URL-адресов контейнера активов.](https://docs.microsoft.com/rest/api/media/assets/listcontainersas) 
* Чтобы подготовить содержимое для доставки с помощью адаптивной потоковой передачи битрата, файл мезонина должен быть закодирован на нескольких битратах (от от высокого до низкого). Для обеспечения изящного перехода качества, разрешение видео снижается, как битрат снижается. Это приводит к так называемой кодирования лестницы-таблица резолюций и битратов [(см. автоматически генерируемых адаптивной битрат лестницы](autogen-bitrate-ladder.md)). Службы мультимедиа можно использовать для кодирования файлов мезонина на нескольких битратах. При этом вы получите набор файлов MP4 и связанных с ними файлов конфигурации потоковой передачи, написанных на актив в учетной записи хранилища. Затем вы можете использовать возможность [динамической упаковки](dynamic-packaging-overview.md) в службах мультимедиа для доставки видео с помощью потоковых протоколов, таких как [MPEG-DASH](https://en.wikipedia.org/wiki/Dynamic_Adaptive_Streaming_over_HTTP) и [HLS.](https://en.wikipedia.org/wiki/HTTP_Live_Streaming) Это требует создания [потокового локатора](streaming-locators-concept.md) и создания потоковых URL-адресов, соответствующих поддерживаемым протоколам, которые затем могут быть переданы устройствам/приложениям на основе их возможностей.

На следующей диаграмме показан рабочий процесс кодирования по требованию с динамической упаковкой.

![Рабочий процесс для кодирования по требованию с динамической упаковкой](./media/dynamic-packaging-overview/media-services-dynamic-packaging.svg)

В этой статье содержатся рекомендации о том, как закодировать содержимое с помощью Служб мультимедиа версии 3.

## <a name="transforms-and-jobs"></a>Преобразования и задания

Чтобы закодировать с помощью Media Services v3, необходимо создать [Преобразование](https://docs.microsoft.com/rest/api/media/transforms) и [Вакансия.](https://docs.microsoft.com/rest/api/media/jobs) Преобразование определяет рецепт для настроек и выходов кодирования; работа является экземпляром рецепта. Для получения дополнительной [информации см.](transforms-jobs-concept.md)

При кодировании с помощью Служб мультимедиа используются предустановки. На их основе кодировщик обрабатывает входные файлы мультимедиа. В Media Services v3 вы используете Стандартный кодер для кодирования файлов. Например, можно указать разрешение видео и число аудиоканалов для закодированного содержимого.

Можно быстро приступить к работе, используя одну из рекомендуемых встроенных предустановок, основанных на передовых отраслевых рекомендациях. Можно также создать пользовательскую предустановку в соответствии с требованиями сценария или устройства. Дополнительные сведения см. в статье [Кодирование с помощью пользовательского преобразования](customize-encoder-presets-how-to.md).

Начиная с января 2019 года, при кодировании со стандартным encoder для производства файла MP4 (ы), новый файл .mpi генерируется и добавляется к выходному активу. Этот MPI-файл предназначен для повышения производительности [динамической упаковки](dynamic-packaging-overview.md) и потоковой передачи.

> [!NOTE]
> Вы не должны изменять или удалять файл MPI или принимать какие-либо зависимости в вашей службе на существование (или нет) такого файла.

### <a name="creating-job-input-from-an-https-url"></a>Создание ввода задания с URL HTTPS

При отправке вакансий для обработки видео необходимо сообщить Службам массовой информации, где найти входном видео. Одним из вариантов является определение URL HTTPS в качестве ввода задания. В настоящее время Media Services v3 не поддерживает кодирование передачи через URL-адреса HTTPS.

#### <a name="examples"></a>Примеры

* [Кодирование с URL HTTPS с помощью .NET](stream-files-dotnet-quickstart.md)
* [Закодирование из URL HTTPS с ПОМОЩЬю REST](stream-files-tutorial-with-rest.md)
* [Кодирование из URL HTTPS с CLI](stream-files-cli-quickstart.md)
* [Закодирование из URL HTTPS с помощью Node.js](stream-files-nodejs-quickstart.md)

### <a name="creating-job-input-from-a-local-file"></a>Создание ввода рабочих мест из локального файла

Это видео может храниться как ресурс Служб мультимедиа. В этом случае необходимо создать входной ресурс на основе файла, который хранится локально в хранилище BLOB-объектов Azure.

#### <a name="examples"></a>Примеры

[Кодирование локального файла с помощью встроенных пресетов](job-input-from-local-file-how-to.md)

### <a name="creating-job-input-with-subclipping"></a>Создание ввода задания с подобрезанием

При кодировании видео можно указать также обрезать или обрезать исходный файл и произвести выход, который имеет только нужную часть входного видео. Эта функциональность работает [Transform](https://docs.microsoft.com/rest/api/media/transforms) с любым преобразованием, который построен с использованием либо presets [builtInEnCoder,](https://docs.microsoft.com/rest/api/media/transforms/createorupdate#builtinstandardencoderpreset) либо пресетов [StandardEnCoderPreset.](https://docs.microsoft.com/rest/api/media/transforms/createorupdate#standardencoderpreset)

Можно указать для создания [вакансии](https://docs.microsoft.com/rest/api/media/jobs/create) с одним клипом видео по запросу или живого архива (записанное событие). Вход задания может быть активом или URL HTTPS.

> [!TIP]
> Если вы хотите поток субфл вашего видео без повторного кодирования видео, рассмотреть возможность использования [предварительной фильтрации манифестов с динамическим Packager](filters-dynamic-manifest-overview.md).

#### <a name="examples"></a>Примеры

Смотрите примеры:

* [Подклип видео с .NET](subclip-video-dotnet-howto.md)
* [Подклип видео с REST](subclip-video-rest-howto.md)

## <a name="built-in-presets"></a>Встроенные предустановки

Media Services поддерживает следующие встроенные пресеты кодирования:  

### <a name="builtinstandardencoderpreset"></a>BuiltInStandardEncoderPreset

[BuiltInStandardEncoderPreset](https://docs.microsoft.com/rest/api/media/transforms/createorupdate#builtinstandardencoderpreset) задает встроенную предустановку для кодирования входящего видео с помощью кодировщика категории "Стандартный".

В настоящее время поддерживаются приведенные ниже предустановки.

- **EncoderNamedPreset.AACGood'qualityAudio**: производит один файл MP4, содержащий только стерео аудио, закодированное на 192 кбит/с.
- **EncoderNamedPreset.AdaptiveStreaming** (рекомендуется): Для получения дополнительной [информации, см.](autogen-bitrate-ladder.md)
- **EncoderNamedPreset.ContentAwareEncodingExperimental**: предоставляет экспериментальную предустановленную для кодирования контента. Учитывая любой входный контент, служба пытается автоматически определить оптимальное количество слоев, а также соответствующие настройки битраита и разрешения для доставки с помощью адаптивной потоковой передачи. Основные алгоритмы будут продолжать развиваться с течением времени. Выход будет содержать файлы MP4 с видео и аудио переплетены. Для получения дополнительной информации [см.](content-aware-encoding.md)
- **EncoderNamedPreset.H264MultipleBitrate1080p**: производит набор из восьми GOP-выровненных файлов MP4, от 6000 кбит/с до 400 кбит/с, и стерео AAC аудио. Разрешение — 360–1080 пикселей.
- **EncoderNamedPreset.H264MultipleBitrate720p**: производит набор из шести GOP-выровненных файлов MP4, от 3400 кбит/с до 400 кбит/с, и стерео AAC аудио. Разрешение — 360–720 пикселей.
- **EncoderNamedPreset.H264MultipleBitrateD**: производит набор из пяти GOP-выровненных файлов MP4, от 1600 кбит/с до 400 кбит/с, и стерео AAC аудио. Разрешение — 360–480 пикселей.
- **EncoderNamedPreset.H264SingleBitrate1080p**: производит файл MP4, где видео кодируется кодеком H.264 на 6750 кбит/с и высотой изображения 1080 пикселей, а стерео-аудио кодируется кодеком AAC-LC на 64 кбит/с.
- **EncoderNamedPreset.H264SingleBitrate720p**: производит файл MP4, где видео кодируется кодеком H.264 на 4500 кбит/с и высота изображения 720 пикселей, и стерео-аудио кодируется с AAC-LC кодек на 64 кбит/с.
- **EncoderNamedPreset.H264SingleBitrateD**: производит файл MP4, где видео кодируется кодеком H.264 на 2200 кбит/с и высотой изображения 480 пикселей, а стерео-аудио кодируется кодовым кодом AAC-LC на 64 кбит/с.

Чтобы увидеть самый актуальный список пресетов, см. встроенные [пресеты, которые будут использоваться для кодирования видео.](https://docs.microsoft.com/rest/api/media/transforms/createorupdate#encodernamedpreset)

Чтобы узнать, как используются пресеты, [см.](stream-files-tutorial-with-api.md)

### <a name="standardencoderpreset"></a>StandardEncoderPreset

[StandardEncoderPreset](https://docs.microsoft.com/rest/api/media/transforms/createorupdate#standardencoderpreset) описывает параметры, используемые при кодировании входящего видео с помощью кодировщика категории "Стандартный". Эту предустановку следует использовать при настройке предустановок преобразования.

#### <a name="considerations"></a>Рекомендации

При создании пользовательских пресетов применяются следующие соображения:

- Все значения для высоты и ширины содержимого AVC должны быть кратными четырем.
- В Azure Media Services v3 все бираты кодирования кодируются по биту в секунду. Это отличается от пресетов с нашими v2 AIS, которые использовали килобиты в секунду в качестве устройства. Например, если битрат в v2 был указан как 128 (килобит в секунду), то в v3 он будет установлен до 128000 (бит в секунду).

### <a name="customizing-presets"></a>Настройка пресетов

Службы мультимедиа полностью поддерживают настройку всех значений в предустановках в соответствии с конкретными требованиями к кодированию. Например, как настроить пресеты кодера, смотрите список ниже:

#### <a name="examples"></a>Примеры

- [Настройка пресетов с помощью .NET](customize-encoder-presets-how-to.md)
- [Настройка пресетов с помощью CLI](custom-preset-cli-howto.md)
- [Настройка пресетов с помощью REST](custom-preset-rest-howto.md)

## <a name="preset-schema"></a>Предустановленная схема

В Media Services v3 пресеты являются сильно набранными сущностями в самом API. Вы можете найти определение "схема" для этих объектов в [Open API спецификации (или Swagger)](https://github.com/Azure/azure-rest-api-specs/tree/master/specification/mediaservices/resource-manager/Microsoft.Media/stable/2018-07-01). Вы также можете просмотреть предустановленные определения **(например, StandardEncoderPreset)** в [REST API](https://docs.microsoft.com/rest/api/media/transforms/createorupdate#standardencoderpreset), [.NET SDK](https://docs.microsoft.com/dotnet/api/microsoft.azure.management.media.models.standardencoderpreset?view=azure-dotnet) (или других справочной документации Media Services v3 SDK).

## <a name="scaling-encoding-in-v3"></a>Масштабирование кодирования в версии 3

Для масштабирования обработки мультимедиа [см. Масштаб с помощью CLI.](media-reserved-units-cli-how-to.md)

## <a name="billing"></a>Выставление счетов

Службы мультимедиа не выставляют счета за отмененные или ошибочными задания. Например, задание, которое достигло 50% прогресса и отменено, не выставляется на 50% протоколов работы. С вас взимается плата только за готовые работы.

Для получения дополнительной информации [см.](https://azure.microsoft.com/pricing/details/media-services/)

## <a name="ask-questions-give-feedback-get-updates"></a>Получение справки, отправка отзывов, получение обновлений

Прочитайте статью [сообщества Служб мультимедиа Azure](media-services-community.md), чтобы узнать, как задавать вопросы, оставлять отзывы и получать новости о Службах мультимедиа.

## <a name="next-steps"></a>Дальнейшие действия

* [Загрузка, кодирование и потоковая трансляция с помощью медиа-сервисов.](stream-files-tutorial-with-api.md)
* [Закодировать из URL HTTPS с помощью встроенных пресетов.](job-input-from-http-how-to.md)
* [Закодировать локальный файл с помощью встроенных пресетов.](job-input-from-local-file-how-to.md)
* [Создайте пользовательский предустановленный набор для таргетинга на конкретный сценарий или требования к устройству.](customize-encoder-presets-how-to.md)
