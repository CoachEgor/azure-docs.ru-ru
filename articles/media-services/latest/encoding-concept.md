---
title: Кодирование в облаке с помощью Служб мультимедиа — Azure | Документация Майкрософт
description: В этой статье описывается процесс кодирования при использовании Служб мультимедиа Azure
services: media-services
documentationcenter: ''
author: Juliako
manager: femila
editor: ''
ms.service: media-services
ms.workload: ''
ms.topic: article
ms.date: 05/10/2019
ms.author: juliako
ms.custom: seodec18
ms.openlocfilehash: 25b3209bed98ea217db9e414caa6f08cee6d8c89
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "65761886"
---
# <a name="encoding-with-media-services"></a>Кодирование с помощью Служб мультимедиа

Термин кодирования в службах мультимедиа применяется к процессу преобразования файлов, содержащий цифрового видео или аудио из одного стандартного формата в другой, с целью (a) уменьшения размера файлов и/или (б) создание формате, который совместим с широкий спектр устройств и приложений. Этот процесс также называется сжатия видео или перекодировки. См. в разделе [сжатие данных](https://en.wikipedia.org/wiki/Data_compression) и [что такое кодирование и перекодировка?](https://www.streamingmedia.com/Articles/Editorial/What-Is-/What-Is-Encoding-and-Transcoding-75025.aspx) более подробное описание понятий.

Видео обычно доставляются устройств и приложений с [последовательную загрузку](https://en.wikipedia.org/wiki/Progressive_download) или с помощью [потоковой передачи с переменной скоростью](https://en.wikipedia.org/wiki/Adaptive_bitrate_streaming). 

* Для доставки по последовательной загрузки, можно использовать службы мультимедиа Azure для преобразования цифрового файла мультимедиа (расширения) в [MP4](https://en.wikipedia.org/wiki/MPEG-4_Part_14) файл, который содержит видео, которая была закодирована с [H.264](https://en.wikipedia.org/wiki/H.264/MPEG-4_AVC) кодек, и аудио, которая была закодирована с [AAC](https://en.wikipedia.org/wiki/Advanced_Audio_Coding) кодека. Этот файл MP4 записывается ресурс в вашей учетной записи хранения. Вы можете использовать API службы хранилища Azure или пакетов SDK (например, [REST API службы хранилища](../../storage/common/storage-rest-api-auth.md), [пакета SDK для JAVA](../../storage/blobs/storage-quickstart-blobs-java-v10.md), или [пакета SDK для .NET](../../storage/blobs/storage-quickstart-blobs-dotnet.md)) для загрузки файла напрямую. Если вы создали выходные данные ресурс с именем конкретного контейнера в хранилище, использовать это расположение. В противном случае можно использовать службы мультимедиа для [список URL-адреса контейнера активов](https://docs.microsoft.com/rest/api/media/assets/listcontainersas). 
* Для подготовки содержимого для доставки путем потоковой передачи с переменной скоростью, мезонинный файл должен быть закодирован в нескольких скоростей (от большего к меньшему). Чтобы нормальные перехода качества, как скорость уменьшается, так это разрешение видео. Это приводит к так называемые кодирования лестница — таблицу разрешений и частот дискретизации (см. в разделе [автоматически генерируемым адаптивной скоростей](autogen-bitrate-ladder.md)). Службы мультимедиа позволяют кодировать мезонинные файлы в нескольких скоростей — таким образом, вы получите набор MP4-файлов и связанных потоковой передачи файлов конфигурации, запись ресурс в вашей учетной записи хранения. Затем можно использовать [динамической упаковки](dynamic-packaging-overview.md) возможность в службах мультимедиа для доставки видео с помощью протоколов, таких как streaming [MPEG-DASH](https://en.wikipedia.org/wiki/Dynamic_Adaptive_Streaming_over_HTTP) и [HLS](https://en.wikipedia.org/wiki/HTTP_Live_Streaming). Это требует создания [указатель потоковой передачи](streaming-locators-concept.md) и построения потоковой передачи URL-адреса, соответствующие поддерживаемые протоколы, которые затем может быть передан для устройств и приложений на основе их возможностей.

В примере ниже показан рабочий процесс для кодирования по запросу с помощью динамической упаковки.

![Динамическая упаковка](./media/dynamic-packaging-overview/media-services-dynamic-packaging.png)

В этой статье содержатся рекомендации о том, как закодировать содержимое с помощью Служб мультимедиа версии 3.

## <a name="transforms-and-jobs"></a>Преобразования и задания

Для кодирования с помощью Служб мультимедиа версии 3 необходимо создать [преобразование](https://docs.microsoft.com/rest/api/media/transforms) и [задание](https://docs.microsoft.com/rest/api/media/jobs). Преобразование определяет способ кодирования параметров и выходных данных; Задание — это копия рецепт. Дополнительные сведения см. в статье [Преобразования и задания](transforms-jobs-concept.md).

При кодировании с помощью Служб мультимедиа используются предустановки. На их основе кодировщик обрабатывает входные файлы мультимедиа. Например, можно указать разрешение видео и число аудиоканалов для закодированного содержимого. 

Можно быстро приступить к работе, используя одну из рекомендуемых встроенных предустановок, основанных на передовых отраслевых рекомендациях. Можно также создать пользовательскую предустановку в соответствии с требованиями сценария или устройства. Дополнительные сведения см. в статье [Кодирование с помощью пользовательского преобразования](customize-encoder-presets-how-to.md). 

Начиная с января 2019 г., при кодировании с помощью Media Encoder Standard для создания файлов MP4 создается и добавляется в выходной ресурс новый MPI-файл. Этот MPI-файл предназначен для повышения производительности [динамической упаковки](dynamic-packaging-overview.md) и потоковой передачи.

> [!NOTE]
> Не следует изменять или удалять MPI-файл, а также ваша служба не должна зависеть от существования (или отсутствия) такого файла.

## <a name="built-in-presets"></a>Встроенные предустановки

В настоящее время Службы мультимедиа поддерживают следующие встроенные предустановки кодирования:  

### <a name="builtinstandardencoderpreset-preset"></a>Предустановка BuiltInStandardEncoderPreset

[BuiltInStandardEncoderPreset](https://docs.microsoft.com/rest/api/media/transforms/createorupdate#builtinstandardencoderpreset) задает встроенную предустановку для кодирования входящего видео с помощью кодировщика категории "Стандартный". 

В настоящее время поддерживаются приведенные ниже предустановки.

- **EncoderNamedPreset.AACGoodQualityAudio**. Данная предустановка создает один MP4-файл, содержащий только закодированный стереозвук со скоростью 192 Кбит/с.
- **EncoderNamedPreset.AdaptiveStreaming** (рекомендуется). Дополнительные сведения см. в статье [Кодирование с помощью автоматически созданной схемы скоростей](autogen-bitrate-ladder.md).
- **EncoderNamedPreset.ContentAwareEncodingExperimental** -предоставляет экспериментальный предустановку для кодирования содержимого с поддержкой. Учитывая все входное содержимое, служба пытается автоматически определить оптимальное количество слои, соответствующие скоростью и параметры разрешения для доставки с адаптивной потоковой передачи. Базовых алгоритмов, будут со временем. Выходные данные будут помещены файлы MP4 с чередованием аудио и видео. Дополнительные сведения см. в разделе [экспериментальные предустановку для кодирования содержимого с поддержкой](cae-experimental.md).
- **EncoderNamedPreset.H264MultipleBitrate1080p**. Данная предустановка создает набор из 8 MP4-файлов с одинаковыми группами GOP, скоростями 400–6000 Кбит/с и стереофоническим звуком в формате AAC. Разрешение — 360–1080 пикселей.
- **EncoderNamedPreset.H264MultipleBitrate720p**. Данная предустановка создает набор из 6 MP4-файлов с одинаковыми группами GOP, скоростями 400–3400 Кбит/с и стереофоническим звуком в формате AAC. Разрешение — 360–720 пикселей.
- **EncoderNamedPreset.H264MultipleBitrateSD**. Данная предустановка создает набор из 5 MP4-файлов с одинаковыми группами GOP, скоростями 400–1600 Кбит/с и стереофоническим звуком в формате AAC. Разрешение — 360–480 пикселей.
- **EncoderNamedPreset.H264SingleBitrate1080p** -создает MP4-файла где видео кодируется с кодеком H.264 6750 Кбит/с и высота рисунка 1080 пикселей и стерео аудио кодируется с помощью кодека AAC-LC 64 Кбит/с.
- **EncoderNamedPreset.H264SingleBitrate720p** -создает MP4-файла где видео кодируется с кодеком H.264 4500 Кбит/с и высотой 720 пикселей изображение и стерео аудио кодируется с помощью кодека AAC-LC 64 Кбит/с.
- **EncoderNamedPreset.H264SingleBitrateSD** -создает MP4-файла где видео кодируется с кодеком H.264 2200 Кбит/с и высота рисунка 480 пикселей и стерео аудио кодируется с помощью кодека AAC-LC 64 Кбит/с.

Последнюю версию списка предустановок см. в разделе [встроенные стили, используемый для кодирования видео](https://docs.microsoft.com/rest/api/media/transforms/createorupdate#encodernamedpreset).

Чтобы увидеть, как используются стили, просмотрите [отправки, кодирование и потоковая передача файлов](stream-files-tutorial-with-api.md).

### <a name="standardencoderpreset-preset"></a>Предустановка StandardEncoderPreset

[StandardEncoderPreset](https://docs.microsoft.com/rest/api/media/transforms/createorupdate#standardencoderpreset) описывает параметры, используемые при кодировании входящего видео с помощью кодировщика категории "Стандартный". Эту предустановку следует использовать при настройке предустановок преобразования. 

#### <a name="considerations"></a>Рекомендации

Создавая пользовательские предустановки, следующие соображения.

- Все значения высоты и ширины в содержимом AVC, должны быть кратна 4.
- В Azure Media Services v3 все кодировки скоростей, в битах в секунду. Это отличается от предустановки с наши API версии 2, который используется в качестве единицы килобит в секунду. Например если скорости в версии 2 было указано как 128 (килобит в секунду), в версии 3 он устанавливается для 128000 (бит/с).

#### <a name="examples"></a>Примеры

Службы мультимедиа полностью поддерживают настройку всех значений в предустановках в соответствии с конкретными требованиями к кодированию. Примеры, показывающие, как настроить предустановки кодировщика см. в разделе:

- [Настройка предустановок с помощью .NET](customize-encoder-presets-how-to.md)
- [Настройка предустановок с интерфейсом командной строки](custom-preset-cli-howto.md)
- [Настройка предустановок с помощью REST](custom-preset-rest-howto.md)

## <a name="preset-schema"></a>Схемы предустановленного набора

В версии 3 службы мультимедиа стили являются строго типизированных сущностей в API. Определение «schema» для этих объектов можно найти [спецификации Openapi (или Swagger)](https://github.com/Azure/azure-rest-api-specs/tree/master/specification/mediaservices/resource-manager/Microsoft.Media/stable/2018-07-01). Вы также можете просмотреть существующие определения (например **StandardEncoderPreset**) в [REST API](https://docs.microsoft.com/rest/api/media/transforms/createorupdate#standardencoderpreset), [пакета SDK для .NET](https://docs.microsoft.com/dotnet/api/microsoft.azure.management.media.models.standardencoderpreset?view=azure-dotnet) (или других справочная документация служб мультимедиа v3 SDK).

## <a name="scaling-encoding-in-v3"></a>Масштабирование кодирования в версии 3

Масштабирование обработки мультимедиа см. в разделе [масштабирование с помощью CLI](media-reserved-units-cli-how-to.md).

## <a name="ask-questions-give-feedback-get-updates"></a>Получение справки, отправка отзывов, получение обновлений

Прочитайте статью [сообщества Служб мультимедиа Azure](media-services-community.md), чтобы узнать, как задавать вопросы, оставлять отзывы и получать новости о Службах мультимедиа.

## <a name="next-steps"></a>Дальнейшие действия

* [Кодирование из URL-адрес HTTPS, используя встроенные стили](job-input-from-http-how-to.md)
* [Кодирование локальный файл, используя встроенные стили](job-input-from-local-file-how-to.md)
* [Создать пользовательскую предустановку для конкретных требований сценария или устройства](customize-encoder-presets-how-to.md)
* [Руководство. Отправка, кодирование и потоковая передача видео с помощью API](stream-files-tutorial-with-api.md)
