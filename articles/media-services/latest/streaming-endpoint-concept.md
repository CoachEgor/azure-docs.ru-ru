---
title: Конечные точки потоковой передачи (источник)
titleSuffix: Azure Media Services
description: Сведения о конечных точках потоковой передачи (источник), динамической упаковке и службе потоковой передачи, которая доставляет содержимое непосредственно в клиентское приложение проигрывателя или в сеть доставки содержимого (CDN).
services: media-services
documentationcenter: ''
author: Juliako
manager: femila
editor: ''
ms.service: media-services
ms.workload: ''
ms.topic: article
ms.date: 07/11/2019
ms.author: juliako
ms.openlocfilehash: c8901dccb67e91c608e999f823cf7d2e757da08b
ms.sourcegitcommit: dbde4aed5a3188d6b4244ff7220f2f75fce65ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/19/2019
ms.locfileid: "74186021"
---
# <a name="streaming-endpoints-origin-in-azure-media-services"></a>Конечные точки потоковой передачи (источник) в службах мультимедиа Azure

В Cлужбы мультимедиа Microsoft Azure [Конечная точка потоковой передачи](https://docs.microsoft.com/rest/api/media/streamingendpoints) представляет собой динамическую (JIT) упаковку и службу-источник, которые могут доставлять содержимое в реальном времени и по запросу непосредственно в приложение клиентского проигрывателя, используя один из распространенных протоколов потокового мультимедиа (HLS или тире). Кроме того, **Конечная точка потоковой передачи** обеспечивает динамическое (JIT) шифрование для ведущих DRM в отрасли.

Когда вы создаете учетную запись Служб мультимедиа, конечная точка потоковой передачи **по умолчанию** создается в остановленном состоянии. Вы не можете удалить конечную точку потоковой передачи **по умолчанию** . В учетной записи можно создать больше конечных точек потоковой передачи (см. раздел [квоты и ограничения](limits-quotas-constraints.md)).

> [!NOTE]
> Чтобы начать потоковую передачу видео, вам потребуется запустить **конечную точку потоковой передачи**, из которой предполагается транслировать видео.
>
> Счет выставляется, только если конечная точка потоковой передачи находится в состоянии выполняется.

## <a name="naming-convention"></a>Соглашение об именовании

Формат имени узла для URL-адреса потоковой передачи: `{servicename}-{accountname}-{regionname}.streaming.media.azure.net`, где `servicename` = имя конечной точки потоковой передачи или имя события в реальном времени.

При использовании конечной точки потоковой передачи по умолчанию `servicename` пропускается, поэтому URL-адрес имеет следующее значение: `{accountname}-{regionname}.streaming.azure.net`.

### <a name="limitations"></a>Ограничения

* Максимальное значение имени конечной точки потоковой передачи — 24 символа.
* Имя должно соответствовать этому шаблону [регулярного выражения](https://docs.microsoft.com/dotnet/standard/base-types/regular-expression-language-quick-reference) : `^[a-zA-Z0-9]+(-*[a-zA-Z0-9])*$`.

## <a name="types"></a>Типы

Существует два типа **конечных точек потоковой передачи** : **Standard** (Предварительная версия) и **Premium**. Тип определяется по количеству единиц масштабирования (`scaleUnits`), выделенных для конечной точки потоковой передачи.

В таблице ниже описаны типы.

|введите|Единицы масштабирования|ОПИСАНИЕ|
|--------|--------|--------|  
|**Стандартный**|0|Конечной точкой потоковой передачи по умолчанию является **стандартный** тип — ее можно изменить на тип Premium, изменив `scaleUnits`.|
|**Премиальный**|>0|**Premium** Конечные точки потоковой передачи подходят для расширенных рабочих нагрузок и обеспечивают выделенную и масштабируемую пропускную способность. Вы переходите к типу **Premium** , настраивая `scaleUnits` (единицы потоковой передачи). `scaleUnits` предоставляют определенную выходную пропускную способность, которую можно приобрести с шагом приращения 200 Мбит/с. При использовании типа " **премиум** " Каждая включенная единица обеспечивает дополнительную пропускную способность для приложения. |

> [!NOTE]
> Для клиентов, желающих доставлять содержимое в крупную аудиторию Интернета, рекомендуется включить CDN в конечной точке потоковой передачи.

Сведения об уровне обслуживания см. в разделе [цены и соглашение об уровне обслуживания](https://azure.microsoft.com/pricing/details/media-services/).

## <a name="comparing-streaming-types"></a>Сравнение типов потоковой передачи

Функция|Standard|Премиальный
---|---|---
Пропускная способность |До 600 Мбит/с и может обеспечить более эффективную пропускную способность при использовании CDN.|200 Мбит/с на единицу потоковой передачи. Может обеспечить более эффективную пропускную способность при использовании CDN.
CDN|Azure CDN, CDN сторонней сети или нет CDN.|Azure CDN, CDN сторонней сети или нет CDN.
Пропорциональное выставление счетов| Ежедневно|Ежедневно
Динамическое шифрование|Yes|Yes
динамическую упаковку|Yes|Yes
Масштаб|Автоматически масштабируется до целевой пропускной способности.|Дополнительные службы SUs
IP-фильтрация/G20/пользовательский узел <sup>1</sup>|Yes|Yes
Прогрессивное скачивание|Yes|Yes
Рекомендуемый способ использования |Рекомендуется для большинства сценариев потоковой передачи.|Специализированное использование.

<sup>1</sup> используется только непосредственно в конечной точке потоковой передачи, если CDN не включен в конечной точке.<br/>

## <a name="properties"></a>свойства

В этом разделе приводятся сведения о некоторых свойствах конечной точки потоковой передачи. Примеры создания новой конечной точки потоковой передачи и описания всех свойств см. в [этой статье](https://docs.microsoft.com/rest/api/media/streamingendpoints/create).

- `accessControl`: используется для настройки следующих параметров безопасности для этой конечной точки потоковой передачи: ключи проверки подлинности заголовка подписи Akamai и IP-адреса, разрешенные для подключения к этой конечной точке. Это свойство можно задать, только если `cdnEnabled` имеет значение false.

- `cdnEnabled`: указывает, включена ли интеграция Azure CDN для этой конечной точки потоковой передачи (по умолчанию отключена). Если задать для `cdnEnabled` значение true, следующие конфигурации интеграции отключаются: `customHostNames` и `accessControl`.

    Не все центры обработки данных поддерживают интеграцию Azure CDN. Чтобы проверить, доступна ли интеграция Azure CDN в центре обработки данных, выполните следующие действия.

  - Попробуйте задать для `cdnEnabled` значение true.
  - Проверьте возвращенный результат для `HTTP Error Code 412` (PreconditionFailed) с сообщением "свойство CdnEnabled конечной точки потоковой передачи не может иметь значение true, так как возможность CDN недоступна в текущем регионе".

    При возникновении этой ошибки центр обработки данных его не поддерживает. Попробуйте использовать другой центр обработки данных.

- `cdnProfile`. Если `cdnEnabled` имеет значение true, можно также передавать значения `cdnProfile`. `cdnProfile` — имя профиля CDN, в котором будет создана конечная точка CDN. Вы можете предоставить имеющийся cdnProfile или создать его. Если значение равно NULL, а `cdnEnabled` — true, используется значение по умолчанию (AzureMediaStreamingPlatformCdnProfile). Если параметр `cdnProfile` уже предоставлен, с его использованием создается конечная точка. Если профиль не существует, автоматически создается новый профиль.
- `cdnProvider`: Если сеть CDN включена, можно также передавать значения `cdnProvider`. `cdnProvider` определяет, какой поставщик будет использоваться. Сейчас поддерживаются три значения: StandardVerizon, PremiumVerizon и StandardAkamai. Если значение не указано, а `cdnEnabled` имеет значение true, используется "Стандардверизон" (это значение по умолчанию).
- `crossSiteAccessPolicies`: используется для указания политик межсайтового доступа для различных клиентов. Дополнительные сведения см. в статьях [Спецификация файла междоменной политики](https://www.adobe.com/devnet/articles/crossdomain_policy_file_spec.html) и [Настройка доступности службы на границах домена](https://msdn.microsoft.com/library/cc197955\(v=vs.95\).aspx). Параметры применяются только к Smooth Streaming.
- `customHostNames`: используется для настройки конечной точки потоковой передачи для приема трафика, направленного на пользовательское имя узла. Это свойство допустимо для конечных точек потоковой передачи уровня "Стандартный" и "Премиум" и может быть задано при `cdnEnabled`: false.

    Владение доменным именем должно быть подтверждено службами мультимедиа. Службы мультимедиа проверяют принадлежность доменного имени, запросив запись `CName`, содержащую идентификатор учетной записи служб мультимедиа, в качестве компонента, добавляемого в используемый домен. Например, чтобы использовать sports.contoso.com в качестве пользовательского имени узла для конечной точки потоковой передачи, запись для `<accountId>.contoso.com` необходимо настроить для указания одного из имен узлов проверки Служб мультимедиа. Имя узла проверки состоит из verifydns.\<зона_DNS_Служб_мультимедиа>.

    Ниже перечислены ожидаемые зоны DNS, которые будут использоваться в записи проверки для различных регионов Azure.
  
  - Северная Америка, Европа, Сингапур, Гонконг (САР), Япония:

    - `media.azure.net`
    - `verifydns.media.azure.net`

  - Китай:

    - `mediaservices.chinacloudapi.cn`
    - `verifydns.mediaservices.chinacloudapi.cn`

    Например, запись `CName`, которая сопоставляет "945a4c4e-28ea-45cd-8ccb-a519f6b700ad.contoso.com" с "verifydns.media.azure.net", подтверждает, что у службы мультимедиа с ИДЕНТИФИКАТОРом 945a4c4e-28ea-45cd-8ccb-a519f6b700ad есть право владения доменом contoso.com, что позволяет использовать любое имя в contoso.com в качестве пользовательского имени узла для конечной точки потоковой передачи в этой учетной записи. Чтобы найти значение идентификатора службы мультимедиа, перейдите на [портал Azure](https://portal.azure.com/) и выберите свою учетную запись службы мультимедиа. **Идентификатор учетной записи** отображается в правом верхнем углу страницы.

    Если предпринимается попытка задать имя пользовательского узла без соответствующей проверки записи `CName`, то ответ DNS завершится ошибкой, а затем будет кэшироваться в течение некоторого времени. После получения соответствующей записи повторная проверка кэшированного ответа может занять некоторое время. В зависимости от поставщика DNS для личного домена это может занять от нескольких минут до часа для повторной проверки записи.

    Помимо `CName`, которая сопоставляет `<accountId>.<parent domain>` с `verifydns.<mediaservices-dns-zone>`, необходимо создать еще один `CName`, который сопоставляет имя пользовательского узла (например, `sports.contoso.com`) с именем узла конечной точки потоковой передачи служб мультимедиа (например, `amstest-usea.streaming.media.azure.net`).

    > [!NOTE]
    > Конечные точки потоковой передачи, расположенные в одном центре обработки данных, не могут использовать одно и то же имя пользовательского узла.

    В настоящее время службы мультимедиа не поддерживают SSL с пользовательскими доменами.

- `maxCacheAge` — переопределяет заданный по умолчанию заголовок управления для кэша HTTP max-age, заданный конечной точкой потоковой передачи для фрагментов мультимедиа и манифестов по требованию. Это значение задается в секундах.
- `resourceState` -

    - Остановлено: начальное состояние конечной точки потоковой передачи после создания
    - Запуск: переходит в состояние выполнения
    - Работает: поддерживает потоковую передачу содержимого клиентам
    - Масштабирование: единицы масштабирования увеличиваются или уменьшаются.
    - Остановка: переходит в остановленное состояние
    - Удаляется: удаляется

- `scaleUnits`. Предоставьте выделенную емкость исходящего трафика, которая может быть приобретена с шагом в 200 Мбит/с. Если вам нужно выполнить переход к типу **Премиум**, настройте параметр `scaleUnits`.

## <a name="working-with-cdn"></a>Работа с CDN

В большинстве случаев необходимо включить CDN. Однако если вы ожидаете максимальную степень параллелизма меньше 500 зрителей, рекомендуется отключить CDN, так как CDN масштабируется наилучшим образом с параллелизмом.

### <a name="considerations"></a>Рекомендации

* Конечная точка потоковой передачи `hostname`, а URL-адрес потоковой передачи остается неизменным независимо от того, включена ли сеть CDN.
* Если вам нужна возможность протестировать содержимое с CDN или без него, создайте другую конечную точку потоковой передачи, которая не включена в CDN.

### <a name="detailed-explanation-of-how-caching-works"></a>Подробное описание выполнения кэширования

При добавлении CDN отсутствует значение пропускной способности, так как объем пропускной способности, необходимый для конечной точки потоковой передачи, поддерживающей CDN, изменяется. Многие из них зависят от типа содержимого, от того, насколько популярны это, скорость и протоколы. CDN кэширует только запрашиваемые сведения. Это означает, что популярное содержимое будет обслуживаться непосредственно из CDN — при условии, что фрагмент видео кэшируется. При просмотре в режиме реального времени содержимое с большой вероятностью кэшируется, так как обычно у вас есть много людей, наблюдающих за одними данными. Содержимое по запросу может быть немного сложнее, так как у вас может быть некоторое содержимое, которое не является популярным. Если у вас есть миллионы видеоресурсов, которые не являются популярными (только один или два средства просмотра за неделю), но тысячи людей отслеживают все различные видеоролики, CDN значительно менее эффективен. С этим промахом в кэше увеличивается нагрузка на конечную точку потоковой передачи.

Необходимо также учитывать, как работает адаптивная потоковая передача. Все отдельные фрагменты видео кэшируются как его сущности. Например, представьте себе первый раз, когда будет отслеживаться определенное видео. Если средство просмотра пропускает лишь несколько секунд и там есть только фрагменты видео, связанные с тем, что наблюдаемый пользователь получает кэширование в CDN. При использовании адаптивной потоковой передачи можно применять от 5 до 7 разных скоростей передачи видео. Если один человек наблюдает за одной скоростью, и другой человек смотрит другую скорость, каждый из них кэшируется отдельно в CDN. Даже если два человека проводят одну и ту же скорость, они могут выполнять потоковую передачу по различным протоколам. Все протоколы (HLS, MPEG-DASH, Smooth Streaming) кэшируются отдельно. Таким образом, каждая скорость и протокол кэшируются отдельно и кэшируются только запрашиваемые фрагменты видео.

### <a name="enable-azure-cdn-integration"></a>Включить интеграцию Azure CDN

После того как конечная точка потоковой передачи подготовлена с включенной сетью CDN, в службах мультимедиа задается определенное время ожидания, прежде чем будет выполнено обновление DNS, чтобы подключить конечную точку потоковой передачи к конечной точке CDN.

Если позже вы захотите отключить или включить CDN, конечную точку потоковой передачи нужно перевести в состояние **Остановлена**. Включение интеграции Azure CDN и активация изменений по всем расположениям POP CDN может занять до двух часов. Однако вы можете запустить конечную точку потоковой передачи и поток без прерываний от конечной точки потоковой передачи и после завершения интеграции поток доставляется из CDN. В течение периода подготовки конечная точка потоковой передачи будет находиться в **начальном** состоянии и может наблюдаться снижение производительности.

При создании стандартной конечной точки потоковой передачи она по умолчанию настраивается со стандартным Verizon. Вы можете настроить поставщиков Akamai Premium Verizon или Standard с помощью API-интерфейсов RESTFUL.

Интеграция CDN включена во всех центрах обработки данных Azure, за исключением Китая и регионов федерального правительства США.

> [!IMPORTANT]
> Для конечных точек потоковой передачи уровня "Стандартный" интеграция служб мультимедиа Azure с Azure CDN реализуется на базе **Azure CDN от Verizon**. Конечные точки потоковой передачи уровня "Премиум" можно настроить, используя все **ценовые категории и поставщики Azure CDN**. Дополнительные сведения о возможностях Azure CDN см. в [этом обзоре](../../cdn/cdn-overview.md).

### <a name="determine-if-dns-change-was-made"></a>Определить, было ли сделано изменение DNS

Можно определить, было ли изменено DNS в конечной точке потоковой передачи (трафик направляется в Azure CDN) с помощью https://www.digwebinterface.com. Если результаты имеют azureedge.net имена доменов, трафик теперь указывает на сеть CDN.

## <a name="ask-questions-give-feedback-get-updates"></a>Получение справки, отправка отзывов, получение обновлений

Прочитайте статью [сообщества Служб мультимедиа Azure](media-services-community.md), чтобы узнать, как задавать вопросы, оставлять отзывы и получать новости о Службах мультимедиа.

## <a name="next-steps"></a>Дополнительная информация

[В этом репозитории](https://github.com/Azure-Samples/media-services-v3-dotnet-quickstarts/blob/master/AMSV3Quickstarts/EncodeAndStreamFiles/Program.cs) предоставлен пример запуска стандартной конечной точки потоковой передачи с помощью .NET.
