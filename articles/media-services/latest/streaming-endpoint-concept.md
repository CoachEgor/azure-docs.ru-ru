---
title: Конечные точки потоковой передачи (источник) в службах мультимедиа Azure | Документация Майкрософт
description: В службах мультимедиа Azure конечная точка потоковой передачи (источник) представляет собой динамическую службу упаковки и потоковой передачи, которая может доставлять содержимое непосредственно в клиентское приложение проигрывателя или в сеть доставки содержимого (CDN) для дальнейшего распространения.
services: media-services
documentationcenter: ''
author: Juliako
manager: femila
editor: ''
ms.service: media-services
ms.workload: ''
ms.topic: article
ms.date: 07/11/2019
ms.author: juliako
ms.openlocfilehash: cd1dc7b55060e8262b300022f5ffd1b4da5f7922
ms.sourcegitcommit: 7f6d986a60eff2c170172bd8bcb834302bb41f71
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71350343"
---
# <a name="streaming-endpoints"></a>Потоковые конечные точки 

В Cлужбы мультимедиа Microsoft Azure конечная [точка потоковой передачи](https://docs.microsoft.com/rest/api/media/streamingendpoints) представляет собой динамическую (JIT) упаковку и службу-источник, которые могут доставлять содержимое в реальном времени и по запросу непосредственно в клиентское приложение проигрывателя, используя один из распространенных потоковых носителей. протоколы (HLS или ТИРЕ). Кроме того, **Конечная точка потоковой передачи** обеспечивает динамическое (JIT) шифрование для ведущих DRM в отрасли.

Когда вы создаете учетную запись Служб мультимедиа, конечная точка потоковой передачи **по умолчанию** создается в остановленном состоянии. Удалить **стандартную** конечную точку потоковой передачи нельзя. В учетной записи можно создавать дополнительные конечные точки потоковой передачи (см. раздел [квоты и ограничения](limits-quotas-constraints.md)). 

> [!NOTE]
> Чтобы начать потоковую передачу видео, вам потребуется запустить **конечную точку потоковой передачи**, из которой предполагается транслировать видео. 
>  
> Счет выставляется, только если конечная точка потоковой передачи находится в состоянии выполняется.

## <a name="naming-convention"></a>Соглашение об именовании

Формат имени узла для URL-адреса потоковой передачи: `{servicename}-{accountname}-{regionname}.streaming.media.azure.net`, где `servicename` = имя конечной точки потоковой передачи или имя события в реальном времени. 

При использовании конечной точки потоковой передачи по умолчанию `servicename` опускается, поэтому URL-адрес: `{accountname}-{regionname}.streaming.azure.net`. 

### <a name="limitations"></a>Ограничения

* Максимальное значение имени конечной точки потоковой передачи — 24 символа.
* Имя должно соответствовать этому шаблону [регулярного выражения](https://docs.microsoft.com/dotnet/standard/base-types/regular-expression-language-quick-reference) : `^[a-zA-Z0-9]+(-*[a-zA-Z0-9])*$`.

## <a name="types"></a>Типы  

Есть два типа **конечных точек потоковой передачи**: **Стандартный выпуск** (Предварительная версия) и **Premium**. Тип определяется по количеству единиц масштабирования (`scaleUnits`), выделенных для конечной точки потоковой передачи. 

В таблице ниже описаны типы.  

|Type|Единицы масштабирования|Описание|
|--------|--------|--------|  
|**Стандартный**|0|Конечной точкой потоковой передачи по умолчанию является **стандартный** тип, которую можно изменить на тип Premium `scaleUnits`, изменив.|
|**Премиальный**|>0|**Premium** Конечные точки потоковой передачи подходят для расширенных рабочих нагрузок, предоставляя выделенный и масштабируемый объем пропускной способности. Вы переходите к типу **Premium** , настраивая `scaleUnits` (единицы потоковой передачи). `scaleUnits` предоставляют определенную выходную пропускную способность, которую можно приобрести с шагом приращения 200 Мбит/с. При использовании типа **Премиум** каждая включенная единица обеспечивает приложению дополнительную пропускную способность. |

> [!NOTE]
> Для клиентов, желающих доставлять содержимое в крупную аудиторию Интернета, рекомендуется включить CDN в конечной точке потоковой передачи.

Сведения об уровне обслуживания см. в разделе [цены и соглашение об уровне обслуживания](https://azure.microsoft.com/pricing/details/media-services/).

## <a name="comparing-streaming-types"></a>Сравнение типов потоковой передачи

Компонент|Стандарт|Премиум
---|---|---
Пропускная способность |До 600 Мбит/с и может обеспечить более эффективную пропускную способность при использовании CDN.|200 Мбит/с на единицу потоковой передачи. Может обеспечить более эффективную пропускную способность при использовании CDN.
Сеть кэширующих серверов (CDN)|Azure CDN, CDN сторонних поставщиков или без CDN.|Azure CDN, CDN сторонних поставщиков или без CDN.
Пропорциональное выставление счетов| Ежедневно|Ежедневно
Динамическое шифрование|Да|Да
Динамическая упаковка|Да|Да
Масштаб|Автоматически масштабируется до целевой пропускной способности.|Дополнительные службы SUs
IP-фильтрация/G20/пользовательский узел <sup>1</sup>|Да|Да
Прогрессивное скачивание|Да|Да
Рекомендуемый способ использования |Рекомендуется для большинства сценариев потоковой передачи.|Специализированное использование.

<sup>1</sup> используется только непосредственно в конечной точке потоковой передачи, если сеть CDN не включена в конечной точке.<br/>

## <a name="properties"></a>Свойства 

В этом разделе приводятся сведения о некоторых свойствах конечной точки потоковой передачи. Примеры создания новой конечной точки потоковой передачи и описания всех свойств см. в [этой статье](https://docs.microsoft.com/rest/api/media/streamingendpoints/create). 

- `accessControl`— Используется для настройки следующих параметров безопасности для этой конечной точки потоковой передачи: ключи проверки подлинности заголовка подписи Akamai и IP-адреса, которые могут подключаться к этой конечной точке.<br />Это свойство может быть задано, `cdnEnabled` только если имеет значение false.
- `cdnEnabled`— Указывает, включена ли интеграция Azure CDN для этой конечной точки потоковой передачи (по умолчанию отключена). Если задать для `cdnEnabled` значение true, следующие конфигурации интеграции отключаются: `customHostNames` и `accessControl`.
  
    Не все центры обработки данных поддерживают интеграцию Azure CDN. Чтобы проверить, имеется ли доступная интеграция Azure CDN в центре обработки данных, выполните следующие действия.
 
  - Попробуйте установить `cdnEnabled` значение true.
  - Проверьте возвращенный результат для `HTTP Error Code 412` (PreconditionFailed) с сообщением "свойство конечной точки потоковой передачи не может быть установлено в значение true, так как возможность CDN недоступна в текущем регионе". 

    Если вы получаете эту ошибку, данная интеграция не поддерживается в этом центре обработки данных. Попробуйте использовать другой центр обработки данных.
- `cdnProfile`-Если `cdnEnabled` задано значение true, можно также передавать `cdnProfile` значения. `cdnProfile` — имя профиля CDN, в котором будет создана конечная точка CDN. Вы можете предоставить имеющийся cdnProfile или создать его. Если значение равно NULL, а `cdnEnabled` — true, используется значение по умолчанию (AzureMediaStreamingPlatformCdnProfile). Если параметр `cdnProfile` уже предоставлен, с его использованием создается конечная точка. Если профиль не существует, автоматически создается новый профиль.
- `cdnProvider`— Если сеть CDN включена, можно также передавать `cdnProvider` значения. `cdnProvider` определяет, какой поставщик будет использоваться. В настоящее время поддерживаются три значения: StandardVerizon, PremiumVerizon и StandardAkamai. Если значение не указано и `cdnEnabled` имеет значение true, используется "стандардверизон" (это значение по умолчанию).
- `crossSiteAccessPolicies`— Используется для указания политик межсайтового доступа для различных клиентов. Дополнительные сведения см. в статьях [Спецификация файла междоменной политики](https://www.adobe.com/devnet/articles/crossdomain_policy_file_spec.html) и [Настройка доступности службы на границах домена](https://msdn.microsoft.com/library/cc197955\(v=vs.95\).aspx).<br/>Параметры применяются только к Smooth Streaming.
- `customHostNames`— Используется для настройки конечной точки потоковой передачи для приема трафика, направленного на пользовательское имя узла.  Это свойство допустимо для конечных точек потоковой передачи уровня "Стандартный" и `cdnEnabled`"Премиум" и может быть задано, когда: false.
    
    Владение доменным именем должно быть подтверждено службами мультимедиа. Службы мультимедиа проверяют принадлежность доменного имени, `CName` запросив запись, содержащую идентификатор учетной записи служб мультимедиа, в качестве компонента, добавляемого в используемый домен. Например, чтобы использовать sports.contoso.com в качестве пользовательского имени узла для конечной точки потоковой передачи, запись для `<accountId>.contoso.com` необходимо настроить для указания одного из имен узлов проверки Служб мультимедиа. Имя узла проверки состоит из verifydns.\<зона_DNS_Служб_мультимедиа>. 

    Ниже перечислены ожидаемые зоны DNS, которые будут использоваться в записи проверки для различных регионов Azure.
  
  - Северная Америка, Европа, Сингапур, Гонконг (САР), Япония:
      
    - `media.azure.net`
    - `verifydns.media.azure.net`
      
  - Китай:
        
    - `mediaservices.chinacloudapi.cn`
    - `verifydns.mediaservices.chinacloudapi.cn`
        
    Например, `CName` запись, которая сопоставляет "945a4c4e-28ea-45cd-8ccb-a519f6b700ad.contoso.com" с "verifydns.Media.Azure.NET", подтверждает, что у службы мультимедиа с идентификатором 945a4c4e-28ea-45cd-8ccb-a519f6b700ad есть владение доменом contoso.com, поэтому Включение любого имени в contoso.com для использования в качестве пользовательского имени узла для конечной точки потоковой передачи в этой учетной записи. Чтобы найти значение идентификатора службы мультимедиа, перейдите на [портал Azure](https://portal.azure.com/) и выберите свою учетную запись службы мультимедиа. **Идентификатор учетной записи** отображается в правом верхнем углу страницы.
        
    При попытке задать пользовательское имя узла без надлежащей проверки записи `CName` ответ DNS не будет получен, после чего в течение некоторого времени будет выполняться кэширование. После получения соответствующей записи повторная проверка кэшированного ответа может занять некоторое время. В зависимости от поставщика DNS пользовательского домена повторная проверка записи может занять от нескольких минут до часа.
        
    `CName` В дополнение к, которое сопоставляется `verifydns.<mediaservices-dns-zone>` `<accountId>.<parent domain>` с, необходимо создать другую `CName` , которая сопоставляет имя пользовательского узла (например, `sports.contoso.com`) с именем узла конечной точки потоковой передачи служб мультимедиа (например, `amstest-usea.streaming.media.azure.net`).
 
    > [!NOTE]
    > Конечные точки потоковой передачи, расположенные в одном центре обработки данных, не могут совместно использовать одно и то же имя пользовательского узла.

    В настоящее время службы мультимедиа не поддерживают SSL с пользовательскими доменами. 
    
- `maxCacheAge`— Переопределяет заданный по умолчанию заголовок управления для кэша HTTP max-age, заданный конечной точкой потоковой передачи для фрагментов мультимедиа и манифестов по требованию. Это значение задается в секундах.
- `resourceState` -

    - Остановлено — начальное состояние конечной точки потоковой передачи после создания
    - Started — переход в состояние выполнения
    - Работает — может выполнять потоковую передачу содержимого клиентам
    - Масштабирование — единицы масштабирования увеличиваются или уменьшаются.
    - Остановка — переход в остановленное состояние
    - Удаление — удаляется
    
- `scaleUnits`— Укажите объем выделенной исходящего трафика, который можно приобрести с шагом в 200 Мбит/с. Если вам нужно выполнить переход к типу **Премиум**, настройте параметр `scaleUnits`.

## <a name="working-with-cdn"></a>Работа с CDN

В большинстве случаев необходимо включить CDN. Тем не менее, если вы ожидаете максимального уровня параллелизма меньше 500 зрителей, рекомендуется отключить сеть CDN, так как она лучше масштабируется при высоком параллелизме.

### <a name="considerations"></a>Рекомендации

* Конечная точка потоковой передачи `hostname`, а URL-адрес потоковой передачи остается неизменным независимо от того, включена ли сеть CDN.
* Если вам нужна возможность протестировать содержимое с CDN или без него, можно создать другую конечную точку потоковой передачи, которая не включена в CDN.

### <a name="detailed-explanation-of-how-caching-works"></a>Подробное описание выполнения кэширования

При добавлении CDN нет определенного значения пропускной способности, так как необходимый объем пропускной способности для конечной точки потоковой передачи с включенной CDN различается. Многое зависит от типа содержимого, его популярности, скоростей передачи и протоколов. CDN выполняет только запрашиваемое кэширование. Это означает, что популярное содержимое будет предоставляться непосредственно из сети CDN (до тех пор, пока кэшируется фрагмент видео). При просмотре в режиме реального времени содержимое с большой вероятностью кэшируется, так как обычно у вас есть много людей, наблюдающих за одними данными. С содержимым по запросу может быть немного сложнее, так как популярность некоторого содержимого может отличаться. Если у вас есть миллионы непопулярных видеофайлов (только 1 или 2 зрителя в неделю) и тысячи людей, просматривающих разные видео, CDN становится менее эффективной. С этим промахом в кэше увеличивается нагрузка на конечную точку потоковой передачи.
 
Необходимо также учитывать, как работает адаптивная потоковая передача. Все отдельные фрагменты видео кэшируются как его сущности. Например, если определенное видео просматривается впервые и пользователь пропускает его, увидев всего несколько секунд, в CDN кэшируются только фрагменты видео, связанные с пользователем. При использовании адаптивной потоковой передачи можно применять от 5 до 7 разных скоростей передачи видео. Если пользователи используют разные скорости передачи, каждый из них кэшируются в сети CDN отдельно. Даже если два пользователя используют одинаковую скорость передачи, они могут применять разные протоколы. Все протоколы (HLS, MPEG-DASH, Smooth Streaming) кэшируются отдельно. Таким образом, каждая скорость и протокол кэшируются отдельно и кэшируются только запрашиваемые фрагменты видео.

### <a name="enable-azure-cdn-integration"></a>Включить интеграцию Azure CDN

После подготовки конечной точки потоковой передачи с включенной CDN в службах мультимедиа существует определенное время ожидания, прежде чем обновление DNS будет выполнено для отображения конечной точки потоковой передачи в конечной точке CDN.

Если позже вы захотите отключить или включить CDN, конечную точку потоковой передачи нужно перевести в состояние **Остановлена**. Включение интеграции Azure CDN и активация изменений по всем расположениям POP CDN может занять до двух часов. Тем не менее вы можете запустить конечную точку потоковой передачи и поток из нее без прерываний. По завершении интеграции поток доставляется из сети CDN. В течение периода подготовки конечная точка потоковой передачи будет находиться в **начальном** состоянии и может наблюдаться снижение производительности.

При создании стандартной конечной точки потоковой передачи она настраивается по умолчанию со стандартным Verizon. Вы можете настроить поставщиков Akamai Premium Verizon или Standard с помощью API-интерфейсов RESTFUL. 

Интеграция CDN включена во всех центрах обработки данных Azure, за исключением Китая и регионов федерального правительства США.

> [!IMPORTANT]
> Для конечных точек потоковой передачи уровня "Стандартный" интеграция служб мультимедиа Azure с Azure CDN реализуется на базе **Azure CDN от Verizon**. Конечные точки потоковой передачи уровня "Премиум" можно настроить, используя все **ценовые категории и поставщики Azure CDN**. Дополнительные сведения о возможностях Azure CDN см. в [этом обзоре](../../cdn/cdn-overview.md).

### <a name="determine-if-dns-change-has-been-made"></a>Определение, были ли сделаны изменения DNS

Можно определить, было ли изменено DNS на конечной точке потоковой передачи (трафик направляется в Azure CDN) с помощью https://www.digwebinterface.com. Если результаты имеют azureedge.net имена доменов, трафик теперь указывает на сеть CDN.

## <a name="ask-questions-give-feedback-get-updates"></a>Получение справки, отправка отзывов, получение обновлений

Прочитайте статью [сообщества Служб мультимедиа Azure](media-services-community.md), чтобы узнать, как задавать вопросы, оставлять отзывы и получать новости о Службах мультимедиа.

## <a name="next-steps"></a>Следующие шаги

[В этом репозитории](https://github.com/Azure-Samples/media-services-v3-dotnet-quickstarts/blob/master/AMSV3Quickstarts/EncodeAndStreamFiles/Program.cs) предоставлен пример запуска стандартной конечной точки потоковой передачи с помощью .NET.

