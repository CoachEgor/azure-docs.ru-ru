---
title: Часто задаваемые вопросы о Службах мультимедиа Azure версии 3 | Документация Майкрософт
description: В этой статье предоставлены ответы на часто задаваемые вопросы о Службах мультимедиа Azure версии 3
services: media-services
documentationcenter: ''
author: Juliako
manager: femila
editor: ''
ms.service: media-services
ms.workload: ''
ms.topic: article
ms.date: 04/07/2020
ms.author: juliako
ms.openlocfilehash: a4f4bd6eaa07907dd672abe068b515b5127adac9
ms.sourcegitcommit: d187fe0143d7dbaf8d775150453bd3c188087411
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80886829"
---
# <a name="media-services-v3-frequently-asked-questions"></a>Медиа Услуги v3 часто задают вопросы

В этой статье предоставлены ответы на часто задаваемые вопросы о Службах мультимедиа Azure (AMS) версии 3.

## <a name="general"></a>Общие сведения

### <a name="what-azure-roles-can-perform-actions-on-azure-media-services-resources"></a>Какие роли Azure могут выполнять действия на ресурсах мультимедиа Azure? 

Смотрите [элемент управления доступом на основе ролей (RBAC) для учетных записей Медиа-услуг.](rbac-overview.md)

### <a name="how-do-you-stream-to-apple-ios-devices"></a>Как осуществляется потоковая передача на устройства Apple iOS?

Убедитесь, что у вас есть "(format'm3u8-aapl)" в конце пути (после "/явной" части URL), чтобы сказать потоковому серверу происхождения, чтобы вернуть обратно HLS-контент для потребления на нативных устройствах Apple iOS (для деталей, [см. доставку контента).](dynamic-packaging-overview.md)

### <a name="how-do-i-configure-media-reserved-units"></a>Как настроить зарезервированные единицы мультимедиа?

Для заданий анализа аудио и видео, которые активируют Службы мультимедиа версии 3 или Индексатор видео, настоятельно рекомендуется подготовить к работе вашу учетную запись с помощью 10 единиц MRU S3. Если вам требуется более 10 единиц MRU S3, отправьте запрос в службу поддержки с помощью [портала Azure](https://portal.azure.com/).

Дополнительные сведения см. в разделе [Масштабирование при обработке мультимедиа](media-reserved-units-cli-how-to.md).

### <a name="what-is-the-recommended-method-to-process-videos"></a>Что такое рекомендуемый метод для обработки видео?

[Преобразования](https://docs.microsoft.com/rest/api/media/transforms) можно использовать для настройки общих задач кодирования или анализа видеоматериалов. Каждое **преобразование** описывает набор инструкций (или рабочий процесс задач) для обработки видео- и аудиофайлов. [Работа](https://docs.microsoft.com/rest/api/media/jobs) — это фактический запрос в Службу средств массовой информации на применение **Преобразования** к данному вхотворного видео или аудиоконтенту. После создания преобразования можно отправлять задания с помощью API Служб мультимедиа или любого из опубликованных пакетов SDK. Дополнительные сведения см. в статье [Преобразования и задания](transforms-jobs-concept.md).

### <a name="i-uploaded-encoded-and-published-a-video-what-would-be-the-reason-the-video-does-not-play-when-i-try-to-stream-it"></a>Видео отправлено, закодировано и опубликовано. Почему видео не воспроизводится?

Чаще всего это вызвано отсутствием конечной точки потоковой передачи, из которой выполняется попытка воспроизведения в состоянии Выполняется.

### <a name="how-does-pagination-work"></a>Как работает разбиение на страницы?

При использовании разбиения на страницы для перечисления коллекции всегда нужно использовать следующую ссылку, которая не зависит от конкретного размера страницы. Дополнительные сведения и примеры см. в [этой статье о фильтрации, упорядочении и разбиении на страницы](entities-overview.md).

### <a name="what-features-are-not-yet-available-in-azure-media-services-v3"></a>Какие функции пока не доступны в Azure Media Services v3?

Для получения подробной информации [см.](media-services-v2-vs-v3.md#feature-gaps-with-respect-to-v2-apis)

### <a name="what-is-the-process-of-moving-a-media-services-account-between-subscriptions"></a>Каков процесс перемещения учетной записи Медиа-услуг между подписками?  

Для получения подробной информации см. [Перемещение учетной записи медиа-услуг между подписками.](media-services-account-concept.md)

## <a name="live-streaming"></a>Потоковая передача в реальном времени 

### <a name="how-to-stop-the-live-stream-after-the-broadcast-is-done"></a>Как остановить прямую трансляцию после трансляции?

Вы можете подойти к нему со стороны клиента или сервера.

#### <a name="client-side"></a>Сторона клиента

Ваше веб-приложение должно подсказать пользователю, если он хочет прекратить трансляцию, если он закрывает браузер. Это событие браузера, с которым может справиться ваше веб-приложение.

#### <a name="server-side"></a>На сервере

Вы можете следить за событиями в реальном времени, подписывавшись на события Event Grid. Для получения дополнительной информации смотрите [схему событий Eventgrid](media-services-event-schemas.md#live-event-types).

* Вы можете [подписаться](reacting-to-media-services-events.md) на уровень потока [Microsoft.Media.LiveEventEncoderDisconnected](media-services-event-schemas.md#liveeventencoderdisconnected) и контролировать, что никакие соединения не приходят на некоторое время, чтобы остановить и удалить ваше живое событие.
* Или, вы можете [подписаться на](reacting-to-media-services-events.md) трек уровне [событий сердцебиения.](media-services-event-schemas.md#liveeventingestheartbeat) Если все треки имеют входящие битрат снижается до 0; или последняя метка времени больше не увеличивается, то вы также можете безопасно закрыть живое событие. События сердцебиения приходят в каждые 20 секунд для каждого трека, так что это может быть немного многословным.

###  <a name="how-to-insert-breaksvideos-and-image-slates-during-live-stream"></a>Как вставлять паузы, видео или баннеры во время передачи динамического потока?

Функция кодирования в реальном времени в Службах мультимедиа версии 3 не поддерживает вставку видео или баннеров во время передачи динамического потока. 

Можно использовать [локальный динамический кодировщик](recommended-on-premises-live-encoders.md), чтобы переключать исходное видео. Многие приложения дают возможность переключения источников, включая Telestream Wirecast, Switcher Studio (в iOS), OBS Studio (бесплатное приложение) и многие другие.

## <a name="content-protection"></a>Защита содержимого

### <a name="should-i-use-an-aes-128-clear-key-encryption-or-a-drm-system"></a>Должен ли я использовать шифрование ключей AES-128 или систему DRM?

Клиенты часто интересуются, следует ли им использовать шифрование AES или систему DRM. Основное различие между двумя системами заключается в том, что с помощью шифрования AES ключ содержимого передается клиенту через TLS, чтобы ключ шифровался в пути, но без дополнительного шифрования ("в ясном виде"). В результате ключ, используемый для расшифровки содержимого, доступен для игрока-клиента и может быть просмотрен в сетевом следе на клиенте простым текстом. Шифрование четкого ключа AES-128 подходит для использования в тех случаях, когда зритель является доверенным лицом (например, шифрование корпоративных видео, распространяемых в компании для просмотра сотрудниками).

Системы DRM, такие как PlayReady, Widevine и FairPlay, обеспечивают дополнительный уровень шифрования на ключе, используемом для расшифровки содержимого по сравнению с четким ключом AES-128. Ключ содержимого зашифрован на ключ, защищенный временем выполнения DRM в дополнение к шифрованию транспортного уровня, предоставляемому TLS. Кроме того, расшифровка выполняется в защищенной среде на уровне операционной системы, где злоумышленнику труднее атаковать. Мы рекомендуем использовать DRM в случаях, когда зритель не может быть доверенным лицом, и вам нужен самый высокий уровень безопасности.

### <a name="how-to-show-a-video-only-to-users-who-have-a-specific-permission-without-using-azure-ad"></a>Как показать видео только пользователям, имеющим определенное разрешение, без использования Azure AD?

Вам не нужно использовать какого-либо конкретного поставщика токенов (например, Azure AD). Вы можете создать свой собственный поставщик [JWT](https://jwt.io/) (так называемый STS, Secure Token Service), используя асимметричное шифрование ключей. В пользовательский STS вы можете добавлять утверждения, основанные на бизнес-логике.

Убедитесь, что эмитент, аудитория и претензии все совпадают точно между тем, что находится в JWT и ContentKeyPolicyRestriction используется в ContentKeyPolicy.

Для получения дополнительной информации [см.](content-protection-overview.md)

### <a name="how-and-where-to-get-jwt-token-before-using-it-to-request-license-or-key"></a>Где и как получить токен JWT, чтобы использовать его для запроса лицензии или ключа?

1. Для производства необходимо иметь службу безопасных токенов (STS) (веб-сервис), который выдает токен JWT по запросу HTTPS. Для тестирования можно использовать код, показанный в методе **GetTokenAsync**, который определен в файле [Program.cs](https://github.com/Azure-Samples/media-services-v3-dotnet-tutorials/blob/master/AMSV3Tutorials/EncryptWithDRM/Program.cs).
2. После выполнения проверки подлинности пользователя проигрывателю необходимо будет выполнить запрос к службе безопасности токенов на получение такого токена и присвоить его как значение токена. Можно использовать [API решения "Проигрыватель мультимедиа Azure"](https://amp.azure.net/libs/amp/latest/docs/).

* Например, работает STS, с симметричным и асимметричным [https://aka.ms/jwt](https://aka.ms/jwt)ключом, пожалуйста, см. 
* На примере игрока, основанного на медиаплеере Azure, [https://aka.ms/amtest](https://aka.ms/amtest) использующем такой токен JWT, см. (расширьте ссылку "player_settings" для просмотра ввода маркера.

### <a name="how-do-you-authorize-requests-to-stream-videos-with-aes-encryption"></a>Как вы авторизуете запросы на потоковую передачу видео с помощью шифрования AES?

Правильный подход заключается в использовании STS (службы токенов безопасности).

В службе токенов безопасности, в зависимости от профиля пользователя, добавьте разные утверждения (например, "Пользователь (ценовая категория "Премиум")", "Пользователь (ценовая категория "Базовый")", "Пользователь бесплатной пробной версии"). С различными утверждениями в JWT пользователь может видеть разное содержимое. Конечно, для разного содержимого или ресурса параметр ContentKeyPolicyRestriction будет иметь соответствующие утверждения RequiredClaims.

Используйте API-аДИ Мультимедиа-сервисов Azure для настройки доставки лицензии/ключа и шифрования ваших активов (как показано в [этом примере).](https://github.com/Azure-Samples/media-services-v3-dotnet-tutorials/blob/master/AMSV3Tutorials/EncryptWithAES/Program.cs)

Дополнительные сведения см. в разделе:

- [Обзор системы защиты содержимого](content-protection-overview.md)
- [Проектирование системы для защиты содержимого с несколькими подсистемами DRM и управлением доступом](design-multi-drm-system-with-access-control.md)

### <a name="http-or-https"></a>HTTP или HTTPS?
Приложение проигрывателя ASP.NET MVC, которое мы разработали, должно поддерживать следующее:

* Проверку подлинности пользователя через Azure AD, который должен находиться в разделе HTTPS.
* Обмен маркерами JWT между клиентом и Azure AD, который находится в разделе HTTPS.
* Приобретение лицензий DRM клиентом, который должен находиться в разделе HTTPS, если доставка лицензий осуществляется Службами мультимедиа. Набор продуктов PlayReady не требует HTTPS для доставки лицензий. Если ваш сервер лицензирования PlayReady находится за пределами Служб мультимедиа, можно использовать HTTP или HTTPS.

Приложение проигрывателя ASP.NET использует рекомендуемый протокол HTTPS, поэтому проигрыватель находится на странице в разделе HTTPS. Тем не менее, для потоковой передачи предпочтительно использовать HTTP, поэтому следует обратить внимание на проблему смешанного содержимого.

* Браузер запрещает смешанное содержимое. Однако подключаемые модули, например Silverlight и OSMF для бесперебойной работы и DASH, разрешают. Смешанное содержимое является угрозой безопасности — это происходит из-за возможности вставить вредоносные JavaScript, что может подвергнуть риску данные клиента. Браузеры по умолчанию блокируют эту возможность. На данный момент единственным способом обойти это на стороне сервера (источника) — разрешить все домены (и HTTPS, и HTTP). Это, скорее всего, тоже не самая лучшая идея.
* Не следует использовать смешанное содержимое. Приложение проигрывателя и Проигрыватель мультимедиа должны использовать HTTP или HTTPS. При воспроизведении смешанного содержимого технология silverlightSS требует удаления предупреждения о смешанном содержимом. Технология flashSS обрабатывает смешанное содержимое без предупреждения о смешанном содержимом.
* Если конечная точка потоковой передачи была создана до августа 2014 г., она не будет поддерживать протокол HTTPS. В этом случае создайте и используйте новую конечную точку потоковой передачи для использования протокола HTTPS.

### <a name="what-about-live-streaming"></a>Как насчет динамической потоковой передачи?

Вы можете использовать точно такую же структуру и реализацию для защиты динамической потоковой передачи в службах мультимедиа, рассматривая ресурс, связанный с программой, как ресурс VOD. Чтобы обеспечить мульти-DRM защиту живого контента, примените ту же настройку/обработку к активу, как если бы это был актив VOD, прежде чем связать актив с Live Output.

### <a name="what-about-license-servers-outside-media-services"></a>Как насчет серверов лицензирования за пределами служб мультимедиа?

Часто пользователи могли вложить средства в ферму серверов лицензирования в собственном центре обработки данных или у поставщика услуг DRM. Система защиты содержимого Служб мультимедиа дает возможность работы в гибридном режиме. Содержимое размещается и динамически защищается в Службах мультимедиа, в то же время лицензии DRM доставляются серверами за пределами Служб мультимедиа. В этом случае обратите внимание на следующие изменения:

* Служба маркеров безопасности должна выдавать маркеры, которые являются допустимыми и могут быть проверены на ферме серверов лицензий. Например, серверы лицензий Widevine, предоставляемые Axinom, требуют определенного маркера JWT, который содержит сообщение о правах. Таким образом, необходимо иметь STS для издания такого маркера JWT. 
* Настройка службы доставки лицензий в Службах мультимедиа больше не требуется. Вам нужно предоставить URL-адреса приобретения лицензии (для PlayReady, Widevine и FairPlay) при настройке ContentKeyPolicies.

> [!NOTE]
> Widevine — это служба, которая предоставляется компанией Google Inc. и подпадает под условия предоставления услуг и политику конфиденциальности Google Inc.

## <a name="media-services-v2-vs-v3"></a>Сравнение версий 2 и 3 Служб мультимедиа 

### <a name="can-i-use-the-azure-portal-to-manage-v3-resources"></a>Могу ли я использовать портал Azure для управления ресурсами версии 3?

В настоящее время вы можете использовать [портал Azure](https://portal.azure.com/) для:

* управлять медиа-сервисами v3 [Live Events,](live-events-outputs-concept.md) 
* просмотр (не управлять) v3 [Активы](assets-concept.md), 
* [получить информацию о доступе к AIS](access-api-portal.md). 

Для всех других задач управления (например, [Transforms and Jobs](transforms-jobs-concept.md) and [Content protection)](content-protection-overview.md)используйте [REST API,](https://docs.microsoft.com/rest/api/media/) [CLI](https://aka.ms/ams-v3-cli-ref)или один из поддерживаемых [SDK.](media-services-apis-overview.md#sdks)

### <a name="is-there-an-assetfile-concept-in-v3"></a>Существует элемент AssetFile в версии 3?

Элементы AssetFiles были удалены из API AMS, чтобы отделить Службы мультимедиа от зависимости пакета SDK службы хранилища. Теперь служба хранилища, а не службы мультимедиа, сохраняет данные, которые относятся к службе хранилища. 

Дополнительные сведения см. в разделе [Руководство по миграции из версии 2 в версию 3 Служб мультимедиа](media-services-v2-vs-v3.md).

### <a name="where-did-client-side-storage-encryption-go"></a>Где происходит шифрование хранилища на стороне клиента?

Сейчас рекомендуется использовать шифрование хранилища на стороне сервера (которое включено по умолчанию). Дополнительные сведения см. в статье [Шифрование службы хранилища Azure для неактивных данных (предварительная версия)](https://docs.microsoft.com/azure/storage/common/storage-service-encryption).

## <a name="offline-streaming"></a>Оффлайн-потоковая передача

### <a name="fairplay-streaming-for-ios"></a>Потоковая передача FairPlay для iOS

Следующие часто задаваемые вопросы обеспечивают помощь в устранении неполадок в автономном режиме FairPlay потокового для iOS:

#### <a name="why-does-only-audio-play-but-not-video-during-offline-mode"></a>Почему в автономном режиме воспроизводится только звук, но нет видео?

Такое поведение, по-видимому, связано с дизайном примера приложения. При подоплеке альтернативной звуковой дорожки (что относится к HLS) в автономном режиме, по умолчанию по умолчанию по являются альтернативные звуковые дорожки iOS 10 и iOS 11. Чтобы компенсировать это поведение в автономном режиме FPS, удалите альтернативный звуковой трек из потока. Чтобы сделать это для служб мультимедиа, добавьте динамический фильтр манифеста audio-only=false. Другими словами URL-адрес HLS оканчивается на .ism/manifest(format=m3u8-aapl,audio-only=false). 

#### <a name="why-does-it-still-play-audio-only-without-video-during-offline-mode-after-i-add-audio-onlyfalse"></a>Почему после добавления audio-only=false в автономном режиме по-прежнему воспроизводится аудио без видео?

Содержимое может быть кэшировано в зависимости от структуры ключа кэша сети доставки содержимого (CDN). Очистите кэш.

#### <a name="is-fps-offline-mode-also-supported-on-ios-11-in-addition-to-ios-10"></a>Режим автономной работы FPS также поддерживается на iOS 11 в дополнение к iOS 10?

Да. Автономный режим FPS поддерживается в iOS 10 и в iOS 11.

#### <a name="why-cant-i-find-the-document-offline-playback-with-fairplay-streaming-and-http-live-streaming-in-the-fps-server-sdk"></a>Почему я не могу найти документ автономного воспроизведения с помощью потоковой передачи FairPlay и HTTP Live Streaming в пакете SDK сервера FPS?

Начиная с 4-й версии пакета SDK сервера FPS, этот документ был объединен с руководством по потоковому программированию FairPlay.

#### <a name="what-is-the-downloadedoffline-file-structure-on-ios-devices"></a>Какова структура скачанного или автономного файла на устройствах iOS?

Структура скачанного файла на устройстве iOS выглядит как на следующем снимке экрана. В папке `_keys` хранятся скачанные лицензии FPS, один файл хранилища для каждого узла службы лицензий. В папке `.movpkg` хранится аудио- и видеосодержимое. Первая папка, имя которой заканчивается дефисом с числами, содержит видео. Числовое значение равно значению PeakBandwidth для представлений видео. Вторая папка с именем, заканчивающимся тире, за которым следует 0, содержит аудио. Третья папка с именем "Данные" содержит главный список воспроизведения содержимого FPS. Наконец, boot.xml предоставляет полное описание содержимого папки `.movpkg`. 

![Структура файла примера приложения автономного FairPlay iOS](media/offline-fairplay-for-ios/offline-fairplay-file-structure.png)

Пример файла boot.xml:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<HLSMoviePackage xmlns:xsi="https://www.w3.org/2001/XMLSchema-instance" xmlns="http://apple.com/IMG/Schemas/HLSMoviePackage" xsi:schemaLocation="http://apple.com/IMG/Schemas/HLSMoviePackage /System/Library/Schemas/HLSMoviePackage.xsd">
  <Version>1.0</Version>
  <HLSMoviePackageType>PersistedStore</HLSMoviePackageType>
  <Streams>
    <Stream ID="1-4DTFY3A3VDRCNZ53YZ3RJ2NPG2AJHNBD-0" Path="1-4DTFY3A3VDRCNZ53YZ3RJ2NPG2AJHNBD-0" NetworkURL="https://willzhanmswest.streaming.mediaservices.windows.net/e7c76dbb-8e38-44b3-be8c-5c78890c4bb4/MicrosoftElite01.ism/QualityLevels(127000)/Manifest(aac_eng_2_127,format=m3u8-aapl)">
      <Complete>YES</Complete>
    </Stream>
    <Stream ID="0-HC6H5GWC5IU62P4VHE7NWNGO2SZGPKUJ-310656" Path="0-HC6H5GWC5IU62P4VHE7NWNGO2SZGPKUJ-310656" NetworkURL="https://willzhanmswest.streaming.mediaservices.windows.net/e7c76dbb-8e38-44b3-be8c-5c78890c4bb4/MicrosoftElite01.ism/QualityLevels(161000)/Manifest(video,format=m3u8-aapl)">
      <Complete>YES</Complete>
    </Stream>
  </Streams>
  <MasterPlaylist>
    <NetworkURL>https://willzhanmswest.streaming.mediaservices.windows.net/e7c76dbb-8e38-44b3-be8c-5c78890c4bb4/MicrosoftElite01.ism/manifest(format=m3u8-aapl,audio-only=false)</NetworkURL>
  </MasterPlaylist>
  <DataItems Directory="Data">
    <DataItem>
      <ID>CB50F631-8227-477A-BCEC-365BBF12BCC0</ID>
      <Category>Playlist</Category>
      <Name>master.m3u8</Name>
      <DataPath>Playlist-master.m3u8-CB50F631-8227-477A-BCEC-365BBF12BCC0.data</DataPath>
      <Role>Master</Role>
    </DataItem>
  </DataItems>
</HLSMoviePackage>
```

### <a name="widevine-streaming-for-android"></a>Широкая потоковая передача для Android

#### <a name="how-can-i-deliver-persistent-licenses-offline-enabled-for-some-clientsusers-and-non-persistent-licenses-offline-disabled-for-others-do-i-have-to-duplicate-the-content-and-use-separate-content-key"></a>Как можно предоставить постоянные лицензии (с поддержкой автономного режима) для некоторых клиентов или пользователей и непостоянные лицензии (без поддержки автономного режима) для остальных пользователей? Нужно ли дублировать содержимое и использовать отдельный ключ содержимого?

Поскольку версия 3 Службы мультимедиа позволяет активу иметь несколько указателей потоковой передачи. Вы можете иметь:

* Один ContentKeyPolicy с license_type = "persistent", ContentKeyPolicyRestriction с утверждением "persistent" и его StreamingLocator.
* Другой ContentKeyPolicy с license_type="nonpersistent", ContentKeyPolicyRestriction с утверждением "nonpersistent" и его StreamingLocator.
* Оба эти указатели имеют различные ContentKey.

В зависимости от бизнес-логики пользовательской службы маркеров безопасности публикуются разные заявки в маркере JWT. С маркером возможно получить только соответствующие лицензии и воспроизводить только соответствующие URL-адреса.

#### <a name="what-is-the-mapping-between-the-widevine-and-media-services-drm-security-levels"></a>Что такое сопоставление между уровнями безопасности Widevine и Media Services DRM?

Google в "Widevine DRM Архитектура Обзор" определяет три различных уровней безопасности. Однако в [документации по службам мультимедиа Azure в шаблоне лицензии Widevine](widevine-license-template-overview.md) описаны пять различных уровней безопасности. В этом разделе объясняется, как отображают уровни безопасности.

Google в "Widevine DRM Архитектура Обзор" документ определяет следующие три уровня безопасности:

* Уровень безопасности 1. Вся обработка, шифрование содержимого и управление им выполняется в доверенной среде выполнения (TEE). В некоторых моделях реализации обработка безопасности может выполняться в разных микросхемах.
* Уровень безопасности 2. Шифрование выполняется (но не обработка видео) в TEE: расшифрованные буферы возвращаются в домен приложения и обрабатываются с помощью отдельного аппаратного или программного обеспечения видео. На уровне 2 данные шифрования по-прежнему обрабатываются только в пределах TEE.
* Уровень безопасности 3. На устройстве нет TEE. Для защиты сведений шифрования и расшифрованного содержимого в операционной системе узла можно предпринять соответствующие меры. Реализация уровня 3 может также включать механизм шифрования оборудования, но при этом повышается только уровень производительности, а не безопасность.

В то же время в [документации по службам мультимедиа Azure в шаблоне лицензии Widevine](widevine-license-template-overview.md) свойство security_level объекта content_key_specs может иметь пять различных значений (требования к надежности клиента для воспроизведения):

* Программное обеспечение на основе белого ящика крипто требуется.
* Требуется шифрование ПО и скрытый декодер.
* Материал ключа и операции шифрования должны быть выполнены в резервной TEE оборудования.
* Операции шифрования и расшифровки содержимого должны быть выполнены в резервной TEE оборудования.
* Шифрование, расшифровка и обработка всех носителей (сжатых и несжатых) должны быть выполнены в резервной TEE оборудования.

Оба уровня безопасности определяются с помощью Google Widevine. Разница заключается в уровнях использования: уровень архитектуры или уровень API. В API Widevine используется пять уровней безопасности. Объект content_key_specs, который содержит свойство security_level, десериализуется и передается службе глобальной доставки Widevine с помощью службы лицензий Widevine служб мультимедиа Azure. В следующей таблице показано сопоставление между двумя наборами уровней безопасности.

| **Уровни безопасности, определенные в архитектуре Widevine** |**Уровни безопасности, используемые в API Widevine**|
|---|---| 
| **Уровень безопасности 1**: Все обработки контента, криптография и контроль выполняются в среде надежного выполнения (TEE). В некоторых моделях реализации обработка безопасности может выполняться в разных микросхемах.|**security_level=5**. Шифрование, расшифровка и обработка всех носителей (сжатых и несжатых) должны быть выполнены в резервной TEE оборудования.<br/><br/>**security_level=4**. Операции шифрования и расшифровки содержимого должны быть выполнены в резервной TEE оборудования.|
**Уровень безопасности 2**. Шифрование выполняется (но не обработка видео) в TEE: расшифрованные буферы возвращаются в домен приложения и обрабатываются с помощью отдельного аппаратного или программного обеспечения видео. На уровне 2 данные шифрования по-прежнему обрабатываются только в пределах TEE.| **security_level=3**. Материал ключа и операции шифрования должны быть выполнены в резервной TEE оборудования. |
| **Уровень безопасности 3**. На устройстве нет TEE. Для защиты сведений шифрования и расшифрованного содержимого в операционной системе узла можно предпринять соответствующие меры. Реализация уровня 3 может также включать механизм шифрования оборудования, но при этом повышается только уровень производительности, а не безопасность. | **security_level No2**: Требуется криптографическое программное обеспечение и запутанный декодер.<br/><br/>**security_level No1**: Требуется криптовалюта на основе программного обеспечения.|

#### <a name="why-does-content-download-take-so-long"></a>Почему для загрузки содержимого требуется так много времени?

Увеличить скорости загрузки можно двумя способами.

* Включите CDN, чтобы пользователи с большей долей вероятности нажимали CDN вместо источника или конечной точки потоковой передачи для загрузки содержимого. Если пользователь нажимает конечную точку потоковой передачи, каждый сегмент HLS или фрагмент DASH динамически упаковывается и зашифровывается. Хотя эта задержка измеряется в миллисекундах для каждого сегмента или фрагмента, если длительность видео составляет один час, суммарная задержка может быть большой, из-за чего увеличивается время загрузки.
* Предоставьте пользователям возможность загружать отдельные уровни качества видео и звуковые дорожки, а не все содержимое. Для автономного режима нет смысла загружать все уровни качества. Это достигается двумя способами.

   * Управляется клиентом: пользователь выбирает уровень качества видео и звуковые дорожки для загрузки либо в проигрывателе приложения это происходит автоматически.
   * Управляется службой: в службах мультимедиа Azure можно использовать функцию динамического манифеста, чтобы создать (глобальный) фильтр, который ограничивает список воспроизведения HLS или DASH MPD до одного уровня качества видео и выбранных звуковых дорожек. URL-адрес загрузки, предоставленный пользователям, будет содержать этот фильтр.

## <a name="next-steps"></a>Дальнейшие действия

[Что такое Службы мультимедиа Azure версии 3?](media-services-overview.md)
