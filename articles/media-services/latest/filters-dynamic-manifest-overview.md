---
title: Фильтр овцы с помощью Dynamic Packager
titleSuffix: Azure Media Services
description: Узнайте, как создавать фильтры с помощью Dynamic Packager для фильтрации и выборочного потока манифестов.
services: media-services
documentationcenter: ''
author: Juliako
manager: femila
editor: ''
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: ne
ms.topic: article
ms.date: 07/11/2019
ms.author: juliako
ms.openlocfilehash: cd955f97a2f26543f799d95b7dc0b1de235333c5
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "74186215"
---
# <a name="filter-your-manifests-using-dynamic-packager"></a>Фильтр овцы с помощью Dynamic Packager

Когда вы доставляете адаптивное содержимое потоковой передачи битрата на устройства, иногда требуется опубликовать несколько версий манифеста, нацеленного на определенные возможности устройства или доступную пропускную способность сети. [Dynamic Packager](dynamic-packaging-overview.md) позволяет указывать фильтры, которые могут отфильтровывать определенные кодеки, разрешения, битраты и комбинации звуковых дорожек на лету. Эта фильтрация устраняет необходимость создания нескольких копий. Вам просто необходимо опубликовать новый URL-адрес с определенным набором фильтров, настроенных на целевые устройства (iOS, Android, SmartTV или браузеры) и сетевые возможности (высокой пропускной способностью, мобильным или низкой пропускной способностью сценариев). В этом случае клиенты могут манипулировать потоком содержимого через строку запроса (указывая доступные [фильтры активов или фильтры учетной записи)](filters-concept.md)и использовать фильтры для потоковой передачи определенных разделов потока.

Некоторые сценарии доставки требуют, чтобы вы убедитесь, что клиент не может получить доступ к определенным трекам. Например, возможно, вы не хотите публиковать манифест, содержащий HD треки на определенном уровне абонента. Или, может быть, вы хотите удалить конкретные адаптивные бистрата (ABR) треки, чтобы уменьшить стоимость доставки на конкретное устройство, которое не выиграло бы от дополнительных треков. В этом случае можно связать список предварительно созданных фильтров с [потоковым локатором](streaming-locators-concept.md) при создании. Клиенты не могут манипулировать тем, как потокируется контент, потому что он определяется **потоковой locator.**

Вы можете объединить фильтрацию через указание [фильтров на потоковом Locator](filters-concept.md#associating-filters-with-streaming-locator) - дополнительные фильтры для конкретных устройств, которые клиент указывает в URL-. Эта комбинация полезна для ограничения дополнительных треков, таких как метаданные или потоки событий, аудио языки или описательные звуковые дорожки.

Эта возможность указывать различные фильтры в потоке обеспечивает мощное решение для манипуляций **Dynamic Manifest** для таргетинга на несколько сценариев использования для целевых устройств. В этой теме рассматриваются концепции, связанные с **динамическими манифестами,** и приводятся примеры сценариев, в которых можно использовать эту функцию.

> [!NOTE]
> Динамические манифесты не меняют актив и манифест дефолта для этого актива.

## <a name="overview-of-manifests"></a>Обзор манифестов

Медиасервисы Azure поддерживают протоколы HLS, MPEG DASH и Smooth Streaming. В рамках [динамической упаковки,](dynamic-packaging-overview.md)потоковое клиента манифесты (HLS Master Плейлист, DASH Media Презентация Описание »MPD» и плавная потоковая передача) динамически генерируются на основе селектора формата в URL. Для получения дополнительной информации см. [Common on-demand workflow](dynamic-packaging-overview.md#delivery-protocols)

### <a name="get-and-examine-manifest-files"></a>Получение и просмотр файлов манифестов

Вы указываете список условий свойства отслеживания фильтров, на основе которых треки вашего потока (живой или видео по требованию ) должны быть включены в динамически созданный манифест. Чтобы получить и просмотреть свойства дорожек, необходимо сначала загрузить манифест Smooth Streaming.

[Файлы upload, кодирования и потоковой передачи с](stream-files-tutorial-with-api.md#get-streaming-urls) помощью учебника .NET показывает, как создавать потоковые URL-адреса с помощью .NET. Если запустить приложение, один из URL-адресов будет указывать на манифест Smooth Streaming: `https://amsaccount-usw22.streaming.media.azure.net/00000000-0000-0000-0000-0000000000000/ignite.ism/manifest`.<br/> Скопируйте и вставьте URL-адрес в адресную строку браузера. Файл будет скачан. Вы можете открыть его в любом текстовом редакторе.

Например, НА примере REST [см. Загружать, кодировать и передавать файлы с помощью REST.](stream-files-tutorial-with-rest.md#list-paths-and-build-streaming-urls)

### <a name="monitor-the-bitrate-of-a-video-stream"></a>Отслеживание скорости видеопотока

Для отслеживания скорости видеопотока можно использовать [страницу с демонстрацией Проигрывателя мультимедиа Azure](https://aka.ms/azuremediaplayer). Демо-страница отображает информацию о диагностике на вкладке **Диагностика:**

![Диагностика Проигрывателя мультимедиа Azure Media Player][amp_diagnostics]

### <a name="examples-urls-with-filters-in-query-string"></a>Примеры: URL-адреса с фильтрами в строке запроса

Вы можете применить фильтры к протоколам потоковой передачи ABR: HLS, MPEG-DASH и Smooth Streaming. В представленной ниже таблице приводятся некоторые примеры URL-адресов с фильтрами.

|Протокол|Пример|
|---|---|
|HLS|`https://amsv3account-usw22.streaming.media.azure.net/fecebb23-46f6-490d-8b70-203e86b0df58/bigbuckbunny.ism/manifest(format=m3u8-aapl,filter=myAccountFilter)`|
|MPEG DASH|`https://amsv3account-usw22.streaming.media.azure.net/fecebb23-46f6-490d-8b70-203e86b0df58/bigbuckbunny.ism/manifest(format=mpd-time-csf,filter=myAssetFilter)`|
|Smooth Streaming|`https://amsv3account-usw22.streaming.media.azure.net/fecebb23-46f6-490d-8b70-203e86b0df58/bigbuckbunny.ism/manifest(filter=myAssetFilter)`|

## <a name="rendition-filtering"></a>Фильтрация представлений

Вы можете закодировать свой актив в нескольких профилях кодирования (H.264 Baseline, H.264 High, AACL, AACH, Dolby Digital Plus) и нескольких битратах качества. Однако не все клиентские устройства будут поддерживать все профили и скорости потока вашего актива. Например, старые Android-устройства поддерживают только H.264 Базовый-AACL. Отправка более высоких битратов на устройство, которое не может получить преимущества отходов пропускной способности и вычислений устройства. Такое устройство должно расшифровать всю данную информацию, только чтобы масштабировать ее для отображения.

С помощью Dynamic Manifest можно создавать профили устройств (например, мобильные, консольные или HD/SD) и включать треки и качества, которые вы хотите быть частью каждого профиля. Это называется фильтрацией выдачи. На следующей диаграмме показан пример.

![Пример фильтрации выдачи с помощью Dynamic Manifest][renditions2]

В следующем примере использовался кодировщик для кодирования промежуточного актива в семь MP4-видеофайлов стандарта ISO (с разрешением от 180p до 1080p). Закодированный актив может быть [динамически упакован](dynamic-packaging-overview.md) в любой из следующих потоковых протоколов: HLS, MPEG DASH и Smooth.

В верхней части следующей диаграммы показан манифест HLS для актива без фильтров. (Он содержит все семь выдач.)  В левом нижнем нижнем варианте диаграмма показывает манифест HLS, к которому был применен фильтр под названием "ott". Фильтр "ott" определяет удаление всех битратов ниже 1 Мбит/с, поэтому два нижних уровня качества были удалены в ответ. В правом нижнем правом, диаграмма показывает манифест HLS, к которому был применен фильтр под названием "мобильный". "Мобильный" фильтр определяет удаление выдач, где разрешение больше, чем 720p, так что два 1080p выдачи были удалены.

![Фильтрация выдачи с помощью динамического манифеста][renditions1]

## <a name="removing-language-tracks"></a>Удаление языковых дорожек
Ваши активы могут включать несколько аудиоязыков, таких как английский, испанский, французский и так далее. Обычно Player SDK управляет выбором звуковых треков по умолчанию и доступными звуковыми дорожками на выбор пользователя.

Разработка таких SDK-игроков является сложной задачей, поскольку она требует различных реализаций в рамках определенных устройств. Кроме того, на некоторых платформах AIS Player ограничены и не включают функцию выбора звука, в которой пользователи не могут выбрать или изменить звуковую дорожку по умолчанию. С помощью фильтров активов вы можете управлять поведением, создавая фильтры, которые включают только желаемые языки звука.

![Фильтрация языковых треков с помощью Dynamic Manifest][language_filter]

## <a name="trimming-the-start-of-an-asset"></a>Обрезка начала актива

При большинстве событий потоковой трансляции в реальном времени операторы проводят процедуры тестирования до фактического события. Например, они могут включать в себя сланец, как это до начала мероприятия: "Программа начнется на мгновение".

При архивировании программы данные проверок и заставок также будут архивированы и включены в представление. Однако эта информация не должна показываться клиентам. С помощью динамического манифеста можно создать фильтр времени начала и удалить ненужные данные из манифеста.

![Обрезка начала актива с помощью dynamic Manifest][trim_filter]

## <a name="creating-subclips-views-from-a-live-archive"></a>Создание субклипов (представлений) из текущего архива

Многие текущие события являются длительными, и их текущий архив может включать в себя несколько событий. После окончания текущего события вещателям может потребоваться разбить текущий архив на логические последовательности начала и остановки программ.

Вы можете публиковать эти виртуальные программы отдельно, не обрабатывая живой архив и не создавая отдельных ресурсов (которые не получают выгоды от существующих кэшированных фрагментов в CDN). Примерами таких виртуальных программ являются четверти при игре в американский футбол или баскетбол, иннинги в бейсболе или отдельные события любой программы о спорте.

С помощью Dynamic Manifest вы можете создавать фильтры, используя время начала/конца и создавать виртуальные представления поверх живого архива.

![Фильтр подклипа с динамическим манифестом][subclip_filter]

Вот отфильтрованный актив:

![Отфильтрованный актив с динамическим манифестом][skiing]

## <a name="adjusting-the-presentation-window-dvr"></a>Настройка окна презентации (DVR)

В настоящее время Служба мультимедиа Azure предлагает круговой архив, продолжительность которых может быть настроена от 1 минуты до 25 часов. Фильтрация манифеста позволяет создать скользящее окно DVR поверх архива, без удаления медиаданных. Есть множество сценариев, где вещателям требуется предоставить ограниченное окно DVR, которое перемещается вместе с текущей границей, и в то же время поддерживать более крупное окно архивации. Вещатель может захотеть использовать данные, которые находятся вне окна DVR, чтобы выделить клипы, или они могут захотеть предоставить различные окна DVR для различных устройств. Например, большинство мобильных устройств не обрабатывает большие окна DVR (для мобильных устройств можно установить окно DVR продолжительностью в две минуты, а для настольных клиентов — один час).

![Окно DVR с динамическим манифестом][dvr_filter]

## <a name="adjusting-livebackoff-live-position"></a>Настройка LiveBackoff (динамической позиции)

Фильтрация манифеста позволяет удалить несколько секунд с динамической границы текущей программы. Фильтрация позволяет вещателям смотреть презентацию на точке предварительного издания и создавать точки вставки рекламы до того, как зрители получат поток (поддерживаемый на 30 секунд). Вещатели могут затем нажать эти объявления на своих клиентских рамок во времени для них, чтобы получить и обработать информацию до возможности рекламы.

В дополнение к рекламной поддержке, настройка обратного отсчета в реальном времени может быть использована для корректировки положения зрителей таким образом, чтобы, когда клиенты дрейфовали и попали в живой край, они все еще могут получить фрагменты с сервера. Таким образом, клиенты не получат ошибку HTTP 404 или 412.

![Фильтр для живого бэк-офф с динамическим манифестом][livebackoff_filter]

## <a name="combining-multiple-rules-in-a-single-filter"></a>Объединение нескольких правил в одном фильтре

В одном фильтре можно объединить несколько правил фильтрации. Например, можно определить "правило диапазона", чтобы удалить сланцевые шиферы из живого архива, а также отфильтровать доступные битраты. При применении нескольких правил фильтрации конечным результатом является пересечение всех правил.

![Несколько правил фильтрации с динамическим манифестом][multiple-rules]

## <a name="combining-multiple-filters-filter-composition"></a>Объединение нескольких фильтров (сложение фильтров)

Кроме того, вы можете объединять несколько фильтров в одном URL-адресе. В следующем сценарии показано, для чего могут потребоваться подобные фильтры:

1. Вам необходимо фильтровать свои качества видео для мобильных устройств, таких как Android или iPad (для того, чтобы ограничить качество видео). Чтобы удалить нежелательные качества, вы создадите фильтр учетной записи, подходящий для профилей устройства. Вы можете использовать фильтры учетных записей для всех своих активов в одной учетной записи Media Services без какой-либо дополнительной ассоциации.
1. При необходимости обрезать время начала и окончания ресурс-контейнера. Чтобы сделать обрезку, вы создадите фильтр активов и установите время начала/конца.
1. Вы хотите объединить оба этих фильтра. Без комбинации, вам нужно будет добавить качественную фильтрацию в фильтр отделки, что сделает использование фильтра более трудным.

Чтобы объединить фильтры, установите имена фильтров в URL-адрес манифеста/плейлиста в формате, делемым заполон. Допустим, у вас есть фильтр под названием *MyMobileDevice,* который фильтрует качества, и у вас есть другой названный *MyStartTime,* чтобы установить определенное время начала. Вы можете объединить до трех фильтров.

Для получения дополнительной информации, смотрите [этот блог](https://azure.microsoft.com/blog/azure-media-services-release-dynamic-manifest-composition-remove-hls-audio-only-track-and-hls-i-frame-track-support/).

## <a name="considerations-and-limitations"></a>Рекомендации и ограничения

- Значения для **forceEndTimestamp,** **презентацииWindowDuration**и **liveBackoffDuration** не должны устанавливаться для фильтра VOD. Они используются только для сценариев живого фильтра.
- Динамический манифест работает в границах GOP (ключевые кадры), поэтому обрезка имеет точность GOP.
- Вы можете использовать одно и то же имя фильтра для фильтров учетной записи и активов. Фильтры активов имеют более высокий приоритет и переопределяют фильтры учетных записей.
- При обновлении фильтра для обновления правил для потоковой точки может пройти до 2 минут. Если вы использовали фильтры для обслуживания содержимого (и вы кэшировать содержимое в прокси-итаки и CDN кэши), обновление этих фильтров может привести к сбоям игрока. Мы рекомендуем очистить кэш после обновления фильтра. Если эта опция невозможна, рассмотрите возможность использования другого фильтра.
- Клиенты должны вручную загрузить манифест и разобрать точную отметку времени начала и шкалу времени.

    - Чтобы определить свойства треков в активе, [получите и изучите файл манифеста.](#get-and-examine-manifest-files)
    - Формула для установки свойств фильтра активов является: <br/>startTimestamp &lt;- время запуска&gt; +  &lt;в манифесте&gt; ожидаемого времени запуска фильтра в секундах

## <a name="next-steps"></a>Дальнейшие действия

Следующие статьи показывают, как создавать фильтры программно:  

- [Create filters with REST APIs](filters-dynamic-manifest-rest-howto.md) (Создание фильтров с помощью интерфейсов REST API)
- [Создание фильтров с помощью .NET](filters-dynamic-manifest-dotnet-howto.md)
- [Create filters with CLI](filters-dynamic-manifest-cli-howto.md) (Создание фильтров с помощью .NET)

[renditions1]: ./media/filters-dynamic-manifest-overview/media-services-rendition-filter.png
[renditions2]: ./media/filters-dynamic-manifest-overview/media-services-rendition-filter2.png

[rendered_subclip]: ./media/filters-dynamic-manifests/media-services-rendered-subclip.png
[timeline_trim_event]: ./media/filters-dynamic-manifests/media-services-timeline-trim-event.png
[timeline_trim_subclip]: ./media/filters-dynamic-manifests/media-services-timeline-trim-subclip.png

[multiple-rules]:./media/filters-dynamic-manifest-overview/media-services-multiple-rules-filters.png

[subclip_filter]: ./media/filters-dynamic-manifest-overview/media-services-subclips-filter.png
[trim_event]: ./media/filters-dynamic-manifests/media-services-timeline-trim-event.png
[trim_subclip]: ./media/filters-dynamic-manifests/media-services-timeline-trim-subclip.png
[trim_filter]: ./media/filters-dynamic-manifest-overview/media-services-trim-filter.png
[redered_subclip]: ./media/filters-dynamic-manifests/media-services-rendered-subclip.png
[livebackoff_filter]: ./media/filters-dynamic-manifest-overview/media-services-livebackoff-filter.png
[language_filter]: ./media/filters-dynamic-manifest-overview/media-services-language-filter.png
[dvr_filter]: ./media/filters-dynamic-manifest-overview/media-services-dvr-filter.png
[skiing]: ./media/filters-dynamic-manifest-overview/media-services-skiing.png
[amp_diagnostics]: ./media/filters-dynamic-manifest-overview/amp_diagnostics.png
