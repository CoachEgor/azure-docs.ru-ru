---
title: Фильтры и динамические манифесты Служб мультимедиа Azure | Документация Майкрософт
description: В этом разделе описывается создание фильтров, с помощью которых клиент может передавать определенные секции потока. Для достижения такой выборочной потоковой передачи службы мультимедиа создают динамические манифесты.
services: media-services
documentationcenter: ''
author: Juliako
manager: femila
editor: ''
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: ne
ms.topic: article
ms.date: 07/11/2019
ms.author: juliako
ms.openlocfilehash: ee0200f7c007b437a27b8e9d0f36becc13b8f611
ms.sourcegitcommit: 64798b4f722623ea2bb53b374fb95e8d2b679318
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2019
ms.locfileid: "67835821"
---
# <a name="pre-filtering-manifests-by-using-dynamic-packager"></a>Предварительная фильтрация манифестов с помощью динамического упаковщика

При доставке с переменной скоростью потоковой передачи контента на устройства, часто требуется опубликовать нескольких версий манифеста возможности целевого конкретное устройство или доступной пропускной способности сети. [Для работы динамического упаковщика](dynamic-packaging-overview.md) можно указать фильтры, которые можно отфильтровать определенные кодеки, способы их устранения, скоростей и аудио отслеживать сочетания в режиме реального времени не нужно создать несколько копий. Вам нужно опубликовать новый URL-адрес с определенным набором фильтров, настроенные для целевых устройств (iOS, Android, инициативе SmartTV или браузеры) и сетевые характеристики (сценарии высокой пропускной способностью, мобильных или низкой пропускной способностью). Таким образом, клиенты могут управлять потоковой передачи содержимого через строку запроса (путем указания доступных [фильтров ресурсов-контейнеров или фильтров учетных записей](filters-concept.md)) и использовать фильтры, определенные секции потока.

В некоторых сценариях доставки требуется, убедиться в том, что клиент не сможет получить доступ к определенной записи. Например может потребоваться опубликовать манифест, содержащий HD дорожек на уровень конкретного подписчика. Или, может потребоваться удалить отслеживает определенные с переменной скоростью (ABR) по снижению стоимости доставки конкретного устройства, не получают преимущества от других дорожек. В этом случае можно было связать список предварительно созданных фильтров с вашей [указатель потоковой передачи](streaming-locators-concept.md) при создании. В этом случае клиенты не может управлять, как выполняется потоковая передача содержимого, она определяется **указатель потоковой передачи**.

Вы можете объединить фильтрацию с помощью указания [фильтры на указатель потоковой передачи](filters-concept.md#associating-filters-with-streaming-locator) + специальные фильтры устройств, которые клиент указывает в URL-адрес. Это может быть полезно для ограничения дополнительных отслеживает как метаданные или события потоков, языки для воспроизведения аудио или описательное звуковых дорожек. 

Эта возможность указать различные фильтры на потока, предоставляет мощный **динамического манифеста** манипуляции проектов для нескольких сценариев вариантов использования для целевых устройств. В этом разделе объясняются понятия, связанные с **динамическими манифестами**, и приводятся примеры сценариев, в которых может потребоваться эта функция.

> [!NOTE]
> Динамические манифесты не меняют актив и его манифест по умолчанию. 
> 

##  <a name="overview-of-manifests"></a>Общие сведения о манифестов

Службы мультимедиа Azure поддерживают протоколы HLS, MPEG DASH и Smooth Streaming. Как часть [динамической упаковки](dynamic-packaging-overview.md), потоковой передачи клиентских манифестов (списка воспроизведения HLS Master DASH Media Presentation Description [MPD] и Smooth Streaming) создаются динамически в зависимости от выбора формата в URL-адрес. См. в разделе протоколы доставки в [общий рабочий процесс по запросу](dynamic-packaging-overview.md#delivery-protocols). 

### <a name="get-and-examine-manifest-files"></a>Получение и просмотр файлов манифестов

Укажите список условий свойство отслеживания фильтра, зависимости от того, какие записи потока (динамический или видео по запросу [VOD]) должны быть включены в динамически созданный манифест. Чтобы получить и просмотреть свойства дорожек, необходимо сначала загрузить манифест Smooth Streaming.

[Передачи, кодирование и потоковую передачу файлов с помощью .NET](stream-files-tutorial-with-api.md#get-streaming-urls) руководстве показано, как создать URL-адресов потоковой передачи с помощью .NET. Если запустить приложение, один из URL-адресов будет указывать на манифест Smooth Streaming: `https://amsaccount-usw22.streaming.media.azure.net/00000000-0000-0000-0000-0000000000000/ignite.ism/manifest`.<br/> Скопируйте и вставьте URL-адрес в адресную строку браузера. Файл будет скачан. Вы можете открыть его в текстовом редакторе по своему усмотрению.

Пример REST, см. в разделе [передачи, кодирование и потоковую передачу файлов с помощью REST](stream-files-tutorial-with-rest.md#list-paths-and-build-streaming-urls).

### <a name="monitor-the-bitrate-of-a-video-stream"></a>Отслеживание скорости видеопотока

Для отслеживания скорости видеопотока можно использовать [страницу с демонстрацией Проигрывателя мультимедиа Azure](http://aka.ms/azuremediaplayer). Демонстрационная страница отображает сведения о диагностике на **диагностики** вкладке:

![Диагностика Проигрывателя мультимедиа Azure Media Player][amp_diagnostics]
 
### <a name="examples-urls-with-filters-in-query-string"></a>Примеры: URL-адреса с фильтрами в строке запроса

Фильтры можно применять к ABR протоколы потоковой передачи: HLS, MPEG-DASH и Smooth Streaming. В представленной ниже таблице приводятся некоторые примеры URL-адресов с фильтрами.

|Протокол|Пример|
|---|---|
|HLS|`https://amsv3account-usw22.streaming.media.azure.net/fecebb23-46f6-490d-8b70-203e86b0df58/bigbuckbunny.ism/manifest(format=m3u8-aapl,filter=myAccountFilter)`|
|MPEG DASH|`https://amsv3account-usw22.streaming.media.azure.net/fecebb23-46f6-490d-8b70-203e86b0df58/bigbuckbunny.ism/manifest(format=mpd-time-csf,filter=myAssetFilter)`|
|Smooth Streaming|`https://amsv3account-usw22.streaming.media.azure.net/fecebb23-46f6-490d-8b70-203e86b0df58/bigbuckbunny.ism/manifest(filter=myAssetFilter)`|

## <a name="rendition-filtering"></a>Фильтрация представлений

Вы можете закодировать актив в несколько профилей кодирования (H.264 Baseline, H.264 High, AACL, AACH, Dolby Digital Plus) и нескольких скоростей качества. Однако не все клиентские устройства будут поддерживать все профили и скорости потока вашего актива. Например старые устройства Android поддерживают только H.264 Baseline + AACL. Отправка высоких скоростей потока на устройство, которому не удается получить преимущества впустую пропускной способности и вычислительных ресурсов устройства. Такое устройство должно декодировать всю заданную информацию только для того, чтобы уменьшать ее масштаб для отображения.

С помощью динамического манифеста можно создать профили устройств (например мобильных устройств, консоли или HD/SD) и включать дорожек и качеств, которые вы хотите быть частью каждого профиля. Устанавливаем Фильтрация представлений. В примере ниже показан пример такого.

![Пример Фильтрация представлений][renditions2]

В следующем примере использовался кодировщик для кодирования промежуточного актива в семь MP4-видеофайлов стандарта ISO (с разрешением от 180p до 1080p). Закодированный ресурс может быть [динамически упаковывается](dynamic-packaging-overview.md) в любой из следующих потоковых протоколов: HLS, MPEG DASH и Smooth. 

В верхней части диаграммы показывают, что HLS манифеста для актива без фильтров. (Он содержит все семь представлений).  В нижней левой части на диаграмме показан манифест HLS, к которому был применен фильтр с именем «ott». Фильтр «ott» указывает удаление все варианты скорости потока ниже 1 Мбит/с, поэтому двух нижних уровней качества были отброшены в ответе. В правом нижнем углу показан манифест HLS, к которому был применен фильтр с именем «мобильными». Фильтр «мобильные» указывает удаление представлений, где разрешение больше 720p, чтобы два 1080 p представления были отброшены.

![Фильтрация представлений][renditions1]

## <a name="removing-language-tracks"></a>Удаление языковых дорожек
Активы могут содержать аудиодорожки на нескольких языках, например английском, испанском, французском и т. д. Как правило, пакет SDK проигрывателя управляет выбором аудиодорожки по умолчанию и доступными на выбор пользователя аудиодорожками.

Разработка таких пакетов SDK проигрывателя сложной задачей, так как они требуют разных реализаций платформ проигрывателя конкретного устройства. Кроме того на некоторых платформах API-интерфейсы проигрывателей ограничены и не включают функции выбора звука, где пользователи не могут выбрать или изменить по умолчанию звуковую дорожку. С помощью фильтров активов можно управлять поведением проигрывателей, создавая фильтры с включением только нужных языков аудио.

![Фильтрация языковых дорожек][language_filter]

## <a name="trimming-the-start-of-an-asset"></a>Обрезка начала актива

При большинстве событий потоковой трансляции в реальном времени операторы проводят процедуры тестирования до фактического события. Например, перед началом события они могут включить заставку: «Программа начнется очень скоро». 

При архивировании программы данные проверок и заставок также будут архивированы и включены в представление. Однако эту информацию не следует отображать клиентам. С помощью динамического манифеста можно создать фильтр времени начала и удалить ненужные данные из манифеста.

![Начало обрезки][trim_filter]

## <a name="creating-subclips-views-from-a-live-archive"></a>Создание субклипов (представлений) из текущего архива

Многие текущие события являются длительными, и их текущий архив может включать в себя несколько событий. После окончания текущего события вещателям может потребоваться разбить текущий архив на логические последовательности начала и остановки программ. 

Вы можете опубликовать эти виртуальные программы отдельно без последующей обработки текущего архива и без создания отдельных активов (что не пользуются преимуществами существующих кэшированных фрагментов в CDN). Примерами таких виртуальных программ являются четверти при игре в американский футбол или баскетбол, иннинги в бейсболе или отдельные события любой программы о спорте.

С помощью динамического манифеста можно создавать фильтры с помощью времени начала и окончания и создавать виртуальные представления поверх текущего архива. 

![Фильтр субклипа][subclip_filter]

Вот фильтрованный архив:

![Лыжный спорт][skiing]

## <a name="adjusting-the-presentation-window-dvr"></a>Настройка окна презентации (DVR)

В настоящее время службы мультимедиа Azure поддерживают циклический архив, где можно настроить длительность от 5 минут до 25 часов. Фильтрация манифеста позволяет создать скользящее окно DVR поверх архива, без удаления медиаданных. Есть множество сценариев, где вещателям требуется предоставить ограниченное окно DVR, которое перемещается вместе с текущей границей, и в то же время поддерживать более крупное окно архивации. Вещателю может понадобиться использовать данные, находящиеся за пределами окна DVR, для выделения клипов, или же предоставлять разные окна DVR для различных устройств. Например большинство мобильных устройств не обрабатывает большие окна DVR (для настольных клиентов можно установить 2-минутное окно DVR для мобильных устройств и 1 час).

![Окно DVR][dvr_filter]

## <a name="adjusting-livebackoff-live-position"></a>Настройка LiveBackoff (динамической позиции)

Фильтрация манифеста позволяет удалить несколько секунд с динамической границы текущей программы. Фильтрация позволяет вещателям просматривать представление в точке предварительной публикации и создавать точки вставки рекламы до как зрители получат поток (поддерживаемый 30 секунд). Вещателям можно затем передавать рекламу на клиентские платформы времени для их для получения и обработки информации до появления возможности.

Помимо поддержки рекламы параметр динамической переключения в пассивный режим можно использовать для изменения положения слушателей, таким образом, если клиенты переместятся и достигнут текущей границы, они по-прежнему получать фрагменты с сервера. Таким образом, клиенты не будут получать HTTP 404 или 412.

![Фильтр для динамического переключения в пассивный режим][livebackoff_filter]

## <a name="combining-multiple-rules-in-a-single-filter"></a>Объединение нескольких правил в одном фильтре

В одном фильтре можно объединить несколько правил фильтрации. В качестве примера можно определить правило диапазона для удаления заставок из текущего архива, а также для фильтрации доступных скоростей потока. Когда вы присваиваете нескольких правил фильтрации, конечный результат представляет собой пересечение всех правил.

![Несколько правил фильтрации][multiple-rules]

## <a name="combining-multiple-filters-filter-composition"></a>Объединение нескольких фильтров (сложение фильтров)

Кроме того, вы можете объединять несколько фильтров в одном URL-адресе. В следующем сценарии показано, для чего могут потребоваться подобные фильтры:

1. При необходимости отфильтровать качество видео для мобильных устройств, например Android или iPad (для ограничения качества видео). Чтобы удалить содержимое нежелательного качества, вы создадите учетную запись фильтра подходит для профилей устройств. Фильтры учетной записи можно использовать для всех ресурсов в одну и ту же учетную запись служб мультимедиа без каких-либо дополнительных связей.
1. При необходимости обрезать время начала и окончания ресурс-контейнера. Для этого будет создать фильтр активов и задайте время начала и окончания. 
1. Нужно объединить оба этих фильтра. Без объединения вам потребуется добавить фильтрацию качества в фильтр обрезки, что может затруднить использование фильтра.


Для объединения фильтров необходимо указать их имена для манифеста или списка воспроизведения URL-адрес в формате, разделенных точкой с запятой. Предположим, у вас есть фильтр с именем *MyMobileDevice* , фильтрующее качества, а другой с именем *MyStartTime* для задания конкретного времени начала. Вы можете объединить до трех фильтров. 

Дополнительные сведения см. в [этой записи блога](https://azure.microsoft.com/blog/azure-media-services-release-dynamic-manifest-composition-remove-hls-audio-only-track-and-hls-i-frame-track-support/).

## <a name="considerations-and-limitations"></a>Ограничения и рекомендации

- Значения для **forceEndTimestamp**, **presentationWindowDuration**, и **liveBackoffDuration** не следует задавать для видео по Запросу фильтра. Они используются только для сценариев динамического фильтра. 
-  Динамический манифест работает в границы GOP (ключевые кадры), поэтому Обрезка производится с точностью GOP.
-  Можно использовать одно и то же имя фильтра для учетной записи и активов фильтры. Фильтров активов, имеют более высокий приоритет и переопределяет фильтры учетной записи.
- При обновлении фильтра может занять до 2 минут на обновление правил конечной точки. Если вы использовали фильтры для предоставления содержимого (и кэширование содержимого в прокси-серверы и CDN кэширует), обновление этих фильтров может привести к сбою проигрывателя. Рекомендуется очистить кэш, после обновления фильтра. Если этот параметр невозможно, рассмотрите возможность использования другого фильтра.
- Клиенты должны вручную загрузить манифест и проанализировать отметку времени начала точное и шкалу времени.
    
    - Чтобы определить свойства дорожек в активе, [получить и просмотрите файл манифеста](#get-and-examine-manifest-files).
    - Формула для задания свойств ресурса фильтра штампа времени имеет вид: <br/>startTimestamp = &lt;время начала в манифесте&gt; +  &lt;ожидаемое время начала фильтра в секундах&gt; * шкалы времени

## <a name="next-steps"></a>Следующие шаги

В следующих статьях описывается, как создавать фильтры программным способом:  

- [Create filters with REST APIs](filters-dynamic-manifest-rest-howto.md) (Создание фильтров с помощью интерфейсов REST API)
- [Создание фильтров с помощью .NET](filters-dynamic-manifest-dotnet-howto.md)
- [Create filters with CLI](filters-dynamic-manifest-cli-howto.md) (Создание фильтров с помощью .NET)

[renditions1]: ./media/filters-dynamic-manifest-overview/media-services-rendition-filter.png
[renditions2]: ./media/filters-dynamic-manifest-overview/media-services-rendition-filter2.png

[rendered_subclip]: ./media/filters-dynamic-manifests/media-services-rendered-subclip.png
[timeline_trim_event]: ./media/filters-dynamic-manifests/media-services-timeline-trim-event.png
[timeline_trim_subclip]: ./media/filters-dynamic-manifests/media-services-timeline-trim-subclip.png

[multiple-rules]:./media/filters-dynamic-manifest-overview/media-services-multiple-rules-filters.png

[subclip_filter]: ./media/filters-dynamic-manifest-overview/media-services-subclips-filter.png
[trim_event]: ./media/filters-dynamic-manifests/media-services-timeline-trim-event.png
[trim_subclip]: ./media/filters-dynamic-manifests/media-services-timeline-trim-subclip.png
[trim_filter]: ./media/filters-dynamic-manifest-overview/media-services-trim-filter.png
[redered_subclip]: ./media/filters-dynamic-manifests/media-services-rendered-subclip.png
[livebackoff_filter]: ./media/filters-dynamic-manifest-overview/media-services-livebackoff-filter.png
[language_filter]: ./media/filters-dynamic-manifest-overview/media-services-language-filter.png
[dvr_filter]: ./media/filters-dynamic-manifest-overview/media-services-dvr-filter.png
[skiing]: ./media/filters-dynamic-manifest-overview/media-services-skiing.png
[amp_diagnostics]: ./media/filters-dynamic-manifest-overview/amp_diagnostics.png
