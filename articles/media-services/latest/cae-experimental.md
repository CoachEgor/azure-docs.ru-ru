---
title: Экспериментальная предустановка для кодирования с поддержкой содержимого в Azure | Документация Майкрософт
description: В этой статье рассматривается кодировка с учетом содержимого в Cлужбы мультимедиа Microsoft Azure v3.
services: media-services
documentationcenter: ''
author: Juliako
manager: femila
editor: ''
ms.service: media-services
ms.workload: ''
ms.topic: article
ms.date: 04/05/2019
ms.author: juliako
ms.custom: ''
ms.openlocfilehash: 9389466b6291542563c068706479bf981c5880da
ms.sourcegitcommit: 8bd85510aee664d40614655d0ff714f61e6cd328
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/06/2019
ms.locfileid: "74896142"
---
# <a name="experimental-preset-for-content-aware-encoding"></a>Экспериментальная предустановка для кодировки с учетом содержимого

Чтобы подготовить содержимое для доставки с помощью [потоковой передачи с адаптивной скоростью](https://en.wikipedia.org/wiki/Adaptive_bitrate_streaming), видео необходимо закодировать на несколько битовых ставок (от высокого до низкого). Чтобы обеспечить плавное ухудшение качества, так как скорость понижается, так что это разрешение видео. Это приводит к последовательному вызову кодировки — таблице разрешений и скорости; см. [встроенные предустановки кодирования](https://docs.microsoft.com/rest/api/media/transforms/createorupdate#encodernamedpreset)служб мультимедиа.

## <a name="overview"></a>Краткое описание

Поинтересимся к переходу за пределы одного предустановленного подхода, который после публикации [блога](https://medium.com/netflix-techblog/per-title-encode-optimization-7e99442b62a2) Netflix в декабре 2015. С этого момента в Marketplace были выпущены несколько решений для кодирования с поддержкой содержимого. Общие сведения см. в [этой статье](https://www.streamingmedia.com/Articles/Editorial/Featured-Articles/Buyers-Guide-to-Per-Title-Encoding-130676.aspx) . Идея заключается в том, чтобы узнать содержимое — настроить или настроить кодирование, чтобы повысить сложность отдельного видео. При каждом решении скорость работы выше, чем увеличение качества, не перцептиве — кодировщик работает с этим оптимальным значением скорости. Следующий уровень оптимизации — выбор разрешений, основанных на содержимом. Например, видео презентации PowerPoint не имеет смысла переходить к следующему 720p. В дальнейшем кодировщик может быть назначен для оптимизации параметров для каждого снимка в видео. Netflix описан [такой подход](https://medium.com/netflix-techblog/optimized-shot-based-encodes-now-streaming-4b9464204830) в 2018.

На ранних 2017 Корпорация Майкрософт выпустила предустановку [адаптивной потоковой передачи](autogen-bitrate-ladder.md) для решения проблемы изменчивости качества и разрешения исходных видеороликов. Наши клиенты имели разную комбинацию содержимого, некоторые на 1080p, другие по адресу 720p и некоторые в SD и более низких решениях. Кроме того, не все исходные материалы были высококачественными для кинофильмов или ТЕЛЕПЕРЕДАЧ Studios. Предустановка адаптивной потоковой передачи решает эти проблемы, гарантируя, что лестница с скоростью никогда не превысит разрешение или среднюю скорость входного набора.

Экспериментальная Предустановка кодирования расширяет этот механизм, включая пользовательскую логику, которая позволяет кодировщику найти оптимальное значение скорости для заданного разрешения, но без тщательного анализа вычислений. В итоге, эта новая Предустановка создает выходные данные с более низкой скоростью, чем Предустановка адаптивной потоковой передачи, но с более высоким качеством. См. следующие образцы диаграмм, в которых показано сравнение с помощью метрик качества, таких как [пснр](https://en.wikipedia.org/wiki/Peak_signal-to-noise_ratio) и [вмаф](https://en.wikipedia.org/wiki/Video_Multimethod_Assessment_Fusion). Источник был создан путем сцепления коротких клипов с высоким уровнем сложности от фильмов и ТЕЛЕПЕРЕДАЧ, предназначенных для нагрузки кодировщика. По определению эта Предустановка позволяет получить результаты, отличающиеся от содержимого к содержимому — это также означает, что для некоторого содержимого может не быть существенного снижения скорости или улучшения качества.

![Кривая с частотой искажения (RD) с использованием ПСНР](media/cae-experimental/msrv1.png)

**Рисунок 1. кривая с интенсивным искажением (RD) с использованием метрики ПСНР для источника высокой сложности**

![Кривая с частотой искажения (RD) с использованием ВМАФ](media/cae-experimental/msrv2.png)

**Рисунок 2. кривая с частотой искажения (RD) с использованием метрики ВМАФ для источника высокой сложности**

В настоящее время Предустановка настроена на высокую сложность, видео с высоким качеством (фильмы, телепередачи). Работа выполняется для адаптации к содержимому с низкой степенью сложности (например, презентациям PowerPoint), а также к ухудшению качества видео. Эта Предустановка также использует тот же набор разрешений, что и конфигурация адаптивной потоковой передачи. Корпорация Майкрософт работает над методами выбора минимального набора разрешений на основе содержимого. Как показано ниже, это результаты для другой категории исходного содержимого, где кодировщику удалось определить, что входные данные были низким качеством (многие артефакты сжатия связаны с низкой скоростью). Обратите внимание, что в экспериментальной предустановке кодировщик решил создать только один выходной слой с низкой скоростью, чтобы большинство клиентов могли воспроизводить поток без ожидания.

![Кривая удаленных рабочих столов с помощью ПСНР](media/cae-experimental/msrv3.png)

**Рис. 3. кривая удаленных рабочих столов с использованием ПСНР для ввода низкого качества (в 1080p)**

![Кривая удаленных рабочих столов с помощью ВМАФ](media/cae-experimental/msrv4.png)

**Рис. 4. кривая удаленных рабочих столов с использованием ВМАФ для ввода низкого качества (в 1080p)**

## <a name="use-the-experimental-preset"></a>Использование экспериментальной предустановки

Вы можете создать преобразования, использующие эту предустановку, как показано ниже. Если вы используете такой [учебник,](stream-files-tutorial-with-api.md)можно обновить код следующим образом:

```csharp
TransformOutput[] output = new TransformOutput[]
{
   new TransformOutput
   {
      // The preset for the Transform is set to one of Media Services built-in sample presets.
      // You can customize the encoding settings by changing this to use "StandardEncoderPreset" class.
      Preset = new BuiltInStandardEncoderPreset()
      {
         // This sample uses the new experimental preset for content-aware encoding
         PresetName = EncoderNamedPreset.ContentAwareEncodingExperimental
      }
   }
};
```

> [!NOTE]
> Префикс "экспериментальный" используется здесь для сигнализации о том, что базовые алгоритмы по-прежнему развиваются. С течением времени можно и будет изменять логику, используемую для создания понизкой скорости, с целью согласования алгоритма, который является надежным, и адаптироваться к различным входным условиям. Для заданий кодирования, использующих эту предустановку, будет взиматься плата за исходящие минуты, а выходной ресурс может быть передан из конечных точек потоковой передачи в таких протоколах, как ТИРЕ и HLS.

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы узнали о новом варианте оптимизации видео, мы приглашаем вас попробовать его. Вы можете отправить нам отзыв по ссылкам в конце этой статьи или обратиться к нам более подробно по адресу <amsved@microsoft.com>.
