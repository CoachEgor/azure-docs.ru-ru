---
title: Протокол расширения HTTP (Azure)
description: Из этой статьи вы узнаете об использовании протокола расширения HTTP для отправки сообщений между модулем службы "Аналитика видеотрансляций" и модулем для искусственного интеллекта или компьютерного зрения.
ms.topic: overview
ms.date: 09/14/2020
ms.openlocfilehash: bfc8672185d284abc8f2985b44cea92000bc73db
ms.sourcegitcommit: eb6bef1274b9e6390c7a77ff69bf6a3b94e827fc
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/05/2020
ms.locfileid: "89448093"
---
# <a name="http-extension-protocol"></a>Протокол расширения HTTP

Из этой статьи вы узнаете об использовании протокола расширения HTTP для отправки сообщений между модулем службы "Аналитика видеотрансляций" и модулем для искусственного интеллекта или компьютерного зрения.

Контракт HTTP определяется между следующими двумя компонентами:

* HTTP-сервер;
* службой "Аналитика видеотрансляций" в модуле IoT Edge, выступающей в роли HTTP-клиента.

## <a name="request"></a>Запрос

Запросы, отправляемые из модуля Аналитики видеотрансляций HTTP-серверу, будут выглядеть следующим образом.

|Ключ|Значение|
|---|---|
|POST|`https://hostname/optional-path?optional-query`|
|Принять|application/json, */*|
|Авторизация|Basic, Digest, Bearer (благодаря поддержке настраиваемых заголовков)|
|Content-Type|image/jpeg<br/>image/png<br/>image/bmp<br/>image/x-raw|
|Content-Length — длина текста в байтах|
|User-Agent|Службы мультимедиа Azure|
|Текст|Байты изображения в двоичной кодировке для одного из поддерживаемых типов содержимого.|

### <a name="example"></a>Пример

```
POST http://localhost:8080/inference HTTP/1.1
Host: localhost:8080
x-ms-client-request-id: d6050cd4-c9f2-42d3-9adc-53ba7e440f17
Content-Type: image/bmp
Content-Length: 519222

(Image Binary Content)
```

## <a name="response"></a>Ответ

Ответы, отправляемые из вашего модуля в модуль Аналитики видеотрансляций, должны выглядеть следующим образом.

|Ключ|Значение|
|---|---|
|Коды состояний|200 ОК — найдены результирующие выводы<br/>204 Нет содержимого — искусственный интеллект не нашел содержимое<br/>400 Неверный запрос — непредвиденный ответ<br/>500 Внутренняя ошибка сервера — непредвиденный ответ<br/>503 Сервер занят — в Службах мультимедиа Azure будет использоваться задержка, соответствующая заголовку "Retry-After", а при его отсутствии — заданному по умолчанию промежутку времени.|
|Content-Type|приложение/json|
|Content-Length|Длина текста в байтах|
|Текст|Объект JSON с одним свойством "inferences".|

### <a name="example"></a>Пример

```
HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 468
Server: Microsoft-HTTPAPI/2.0
Date: Fri, 17 Apr 2020 04:44:01 GMT

{
  "inferences": [
    {
      "type": "entity",
      "entity": {
        "tag": { "value": "car", "confidence": 0.9048132 },
        "box": { "l": 0.42681578, "t": 0.47660735, "w": 0.019501392, "h": 0.020954132 }
      }
    },
    {
      "type": "entity",
      "entity": {
        "tag": { "value": "car", "confidence": 0.8953932 },
        "box": { "l": 0.55083525, "t": 0.4843858, "w": 0.046550274, "h": 0.046502113 }
      }
    }    
  ]
}
```

Настоятельно рекомендуется использовать для возврата ответов допустимые документы JSON, соответствующие предварительно установленной схеме, определенной ниже. Это улучшит совместимость с другими компонентами и возможностями, которые могут быть добавлены в модуль Аналитики видеотрансляций в будущем.

Если модуль возвращает ответ с типом содержимого, отличным от "application/json", то Аналитика видеотрансляций будет кодировать сообщение как содержимое Base64 и сериализовать его как непрозрачные полезные данные JSON.

Если модуль возвращает ответ с типом содержимого "application/json", но схема JSON не соответствует описанной ниже схеме метаданных выводов, полезные данные сообщения будут перенаправлены через конвейер, но возможности взаимодействия будут ограничены.

> [!NOTE]
> Если модуль не создает никаких результатов, он должен вернуть код состояния HTTP 204 (нет содержимого) с пустым текстом ответа. Аналитика видеотрансляций поймет это как пустой результат и не будет передавать событие по конвейеру.

## <a name="data-contracts---class-hierarchy"></a>Контракты данных — иерархия классов

![иерархия классов](./media/http-extension-protocol/class-hierarchy.png)

## <a name="next-steps"></a>Дальнейшие шаги

[Контракт данных gRPC](grpc-data-contract.md)
