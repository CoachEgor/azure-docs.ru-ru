---
title: Понятие графа мультимедиа — Azure
description: Граф мультимедиа позволяет определить, откуда следует записывать носитель, как он должен обрабатываться и куда должны доставляться результаты. В этой статье приводится подробное описание концепции графа мультимедиа.
ms.topic: conceptual
ms.date: 05/01/2020
ms.openlocfilehash: 02e960e917a059afdb0d688c7429d27d8e8a48eb
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "84300813"
---
# <a name="media-graph"></a>Граф мультимедиа

## <a name="suggested-pre-reading"></a>Рекомендуемые материалы для предварительного ознакомления

* [Аналитика видеотрансляций в IoT Edge: обзор](overview.md)
* [Аналитика видеотрансляции в IoT Edge: терминология](terminology.md)

## <a name="overview"></a>Обзор

Граф мультимедиа позволяет определить, откуда следует записывать носитель, как он должен обрабатываться и куда должны доставляться результаты. Это достигается путем подключения компонентов или узлов нужным образом. На схеме ниже представлено графическое представление графа мультимедиа.  

![Графическое представление графа мультимедиа](./media/media-graph/overview.png)

Интерактивная аналитика видео на IoT Edge поддерживает различные типы источников, процессоров и приемников.

* **Исходные узлы** обеспечивают запись мультимедиа в граф мультимедиа. Носитель в этом контексте, по сути, может быть звуковым потоком, видеопотоком, потоком данных или потоком, в котором объединены аудио, видео и (или) данные в одном потоке.
* **Узлы процессора** позволяют обрабатывать носители в графе мультимедиа.
* **Узлы приемника** позволяют предоставлять результаты обработки службам и приложениям за пределами графа мультимедиа.

## <a name="media-graph-topologies-and-instances"></a>Топологии и экземпляры графа мультимедиа 

Интерактивная аналитика видео на IoT Edge позволяет управлять графами мультимедиа с помощью двух концепций: "топология графа" и "экземпляр Graph". Топология графа позволяет определить схему графа с параметрами в качестве заполнителей для значений. Топология определяет, какие узлы используются в графе мультимедиа, и как они соединяются в графе мультимедиа. Например, если вы хотите записать канал с камеры, потребуется граф с исходным узлом, который получает видео, и узел приемника, записывающий видео.

Значения параметров в топологии указываются при создании экземпляров графа, ссылающихся на топологию. Это позволяет создать несколько экземпляров, ссылающихся на одну и ту же топологию, но с разными значениями для параметров, указанных в топологии. В приведенном выше примере можно было использовать параметры для представления IP-адреса камеры и имя записанного видео. Можно создать несколько экземпляров графов с такой топологией — один экземпляр для каждой камеры в здании, возможно, каждый с конкретным IP-адресом и конкретным именем.

## <a name="media-graph-states"></a>Состояния графа мультимедиа  

Граф мультимедиа может находиться в одном из следующих состояний:

* Неактивное — представляет состояние, в котором граф мультимедиа настроен, но не активен.
* Активация — состояние, когда создается экземпляр графа мультимедиа (т. е. состояние перехода между неактивным и активным).
* Активный — состояние, когда граф мультимедиа активен. 

    > [!NOTE]
    >  Граф мультимедиа может быть активным без перебора данных (например, источник входного видео переходит в режим «вне сети»).
* Деактивация — это состояние при переходе графа мультимедиа из активного в неактивное.

На схеме ниже показан конечный автомат Media Graph.

![Конечный автомат медиа Graph](./media/media-graph/media-graph-state-machine.png)

## <a name="sources-processors-and-sinks"></a>Источники, процессоры и приемники  

Интерактивная аналитика видео на IoT Edge поддерживает следующие типы узлов в графе мультимедиа:

### <a name="sources"></a>Источники 

#### <a name="rtsp-source"></a>Источник RTSP 

Узел источника RTSP позволяет принимать носители из [RTSP] ( https://tools.ietf.org/html/rfc2326 сервер. С помощью наблюдения и камер на основе IP данные передаются по протоколу RTSP (в режиме реального времени — Streaming-Protocol), который отличается от устройств других типов, таких как телефоны и видеокамеры. Этот протокол используется для установки и управления сеансами мультимедиа между сервером (камерой) и клиентом. Узел источника данных RTSP в графе мультимедиа выступает в качестве клиента и может установить сеанс с сервером RTSP. Многие устройства, например большинство [IP-камер](https://en.wikipedia.org/wiki/IP_camera) , имеют встроенный сервер RTSP. [Онвиф](https://www.onvif.org/) требует, чтобы протокол RTSP поддерживался в определении [профилей G, S & T,](https://www.onvif.org/wp-content/uploads/2019/12/ONVIF_Profile_Feature_overview_v2-3.pdf) соответствующих требованиям. Исходный узел RTSP требует указать URL-адрес RTSP вместе с учетными данными, чтобы включить проверку подлинности подключения.

#### <a name="iot-hub-message-source"></a>Источник сообщения центра Интернета вещей 

Как и другие [модули IOT Edge](../../iot-edge/iot-edge-glossary.md#iot-edge-module), интерактивная аналитика видео в модуле IOT Edge может принимать сообщения через [центр IOT Edge](../../iot-edge/iot-edge-glossary.md#iot-edge-hub). Эти сообщения могут отправляться из других модулей или из приложений, выполняющихся на пограничном устройстве или в облаке. Такие сообщения доставляются (маршрутизируются) в [именованный вход](../../iot-edge/module-composition.md#sink) в модуле. Исходный узел сообщения центра Интернета вещей позволяет таким сообщениям достигать графа мультимедиа. Эти сообщения или сигналы могут использоваться внутренне в графе мультимедиа, как правило, для активации сигнальных шлюзов (см. [шлюзы сигналов](#signal-gate-processor) ниже). 

Например, у вас может быть модуль IoT Edge, создающий сообщение при открытии дверцы. Сообщение из этого модуля можно направить в центр IoT Edge, откуда его можно перенаправить в источник сообщений центра Интернета вещей в графе мультимедиа. В графе мультимедиа источник сообщения центра Интернета вещей может передать событие обработчику сигнального шлюза, который затем может включить запись видео из источника RTSP в файл. 

### <a name="processors"></a>Процессоры  

#### <a name="motion-detection-processor"></a>Процессор обнаружения движения 

Узел процессор обнаружения движения позволяет обнаруживать движение в реальном видео. Он проверяет входящие кадры видео и определяет, есть ли в видео перемещение. При обнаружении движения он передается на видеокадры в нисходящий компонент и создает событие. Узел процессора обнаружения движения (в сочетании с другими узлами) можно использовать для активации записи входящего видео при обнаружении движения.

#### <a name="frame-rate-filter-processor"></a>Обработчик фильтра частоты кадров  

Узел обработчика частоты кадров позволяет выполнять выборку кадров из входящего видеопотока с заданной скоростью. Это позволяет уменьшить число кадров, отправленных в компоненты нижнего уровня (например, узел процессора расширения HTTP) для дальнейшей обработки.

#### <a name="http-extension-processor"></a>Обработчик расширений HTTP

Узел обработчика расширений HTTP позволяет подключать собственный модуль IoT Edge к графу мультимедиа. Этот узел принимает декодированные видеоматериалы в качестве входных данных и передает такие кадры в конечную точку HTTP, предоставляемую вашим модулем. При необходимости этот узел может проходить проверку подлинности с помощью конечной точки RESTFUL. Кроме того, узел имеет встроенный модуль форматирования изображений для масштабирования и кодирования видеокадров до их ретрансляции в конечную точку RESTFUL. В средстве масштабирования есть параметры для сохранения, заполнения или растяжения пропорций изображения. Кодировщик изображений поддерживает форматы JPEG, PNG или BMP.

#### <a name="signal-gate-processor"></a>Обработчик сигнальных шлюзов  

Узел сигнальный обработчик шлюза позволяет условно пересылать носители с одного узла на другой. Он также выступает в качестве буфера, что позволяет синхронизировать мультимедиа и события. Типичный вариант использования заключается в вставке узла процессора сигнального шлюза между исходным узлом RTSP и узлом приемника ресурса и использованием выходных данных узла процессора детектора движения для активации шлюза. Благодаря такому графу мультимедиа вы записываете видео только при обнаружении движения.

### <a name="sinks"></a>Приемники  

#### <a name="asset-sink"></a>Приемник актива  

Узел приемника актива позволяет записывать данные мультимедиа (видео и/или аудио) в ресурс служб мультимедиа Azure. В графе мультимедиа может быть только один узел приемника актива. Дополнительные сведения о ресурсах и их роли при записи и воспроизведении мультимедиа см. в разделе [ресурс](terminology.md#asset) . Чтобы узнать, как используются свойства этого узла, см. статью [Непрерывная запись видео](continuous-video-recording-concept.md) .

#### <a name="file-sink"></a>Приемник файла  

Узел приемника файлов позволяет записывать данные мультимедиа (видео и/или аудио) в расположение локальной файловой системы устройства IoT Edge. В графе мультимедиа может быть только один узел приемника файлов, который должен быть расположен в узле процессора сигнального шлюза. Это ограничивает продолжительность выходных файлов значениями, указанными в свойствах узла обработчика сигналов шлюза.

#### <a name="iot-hub-message-sink"></a>Приемник сообщений центра Интернета вещей  

Узел приемника сообщений центра Интернета вещей позволяет публиковать события в центре IoT Edge. Затем концентратор IoT Edge может перенаправлять данные в другие модули или приложения на пограничном устройстве или в центр Интернета вещей в облаке (на маршруты, указанные в манифесте развертывания). Узел приемника сообщений центра Интернета вещей может принимать события от вышестоящего обработчика, такого как узел процессора обнаружения движения, или из внешней службы вывода с помощью узла обработчика расширений HTTP.

## <a name="rules-on-the-use-of-nodes"></a>Правила использования узлов

Дополнительные правила использования различных узлов в графе мультимедиа см. в разделе [квоты](quotas-limitations.md#limitations-on-graph-topologies-at-preview) .

## <a name="scenarios"></a>Сценарии

Используя сочетание источников, процессоров и приемников, определенных выше, можно создавать графы мультимедиа для различных сценариев, включающих анализ живого видео. Примеры сценариев:

* [Непрерывная запись видео](continuous-video-recording-concept.md)
* [Запись видео на основе событий](event-based-video-recording-concept.md)
* [Аналитика видеотрансляции без записи видео](analyze-live-video-concept.md)

## <a name="next-steps"></a>Дальнейшие действия

Сведения о том, как выполнить обнаружение движения в реальном видеоканале, см. в разделе [Краткое руководство. Запуск интерактивной аналитики видео с помощью собственной модели](use-your-model-quickstart.md).
