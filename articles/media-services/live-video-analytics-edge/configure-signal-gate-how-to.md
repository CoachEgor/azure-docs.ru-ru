---
title: Настройка шлюза сигнала для записи видео на основе событий — Azure
description: В этой статье содержатся рекомендации по настройке шлюза сигналов в графе мультимедиа.
ms.topic: how-to
ms.date: 11/3/2020
ms.openlocfilehash: 4204a43915f9c79cae7dfe82b37e741fee89fb4a
ms.sourcegitcommit: 0d171fe7fc0893dcc5f6202e73038a91be58da03
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/05/2020
ms.locfileid: "93380241"
---
# <a name="configure-a-signal-gate-for-event-based-video-recording"></a>Настройка шлюза сигнала для записи видео на основе событий

В графе мультимедиа [узел процессора сигнального шлюза](media-graph-concept.md#signal-gate-processor) позволяет пересылать носители с одного узла на другой, когда шлюз активируется событием. При активации шлюза открывается и позволяет потоку мультимедиа проходить через определенное время. В случае отсутствия событий для активации шлюза он закроется и носитель прекратит перейдет. Обработчик сигнальных шлюзов применяется для записи видео на основе событий.
В этой статье вы узнаете о настройке процессора сигнального шлюза.

## <a name="suggested-pre-reading"></a>Рекомендуемые материалы для предварительного ознакомления
-   [Граф мультимедиа](media-graph-concept.md)
-   [Запись видео на основе событий](event-based-video-recording-concept.md)


## <a name="problem"></a>Проблема
Пользователю может потребоваться начать запись определенного времени до или после того, как шлюз был активирован событием. Пользователь знает допустимую задержку в своей системе, поэтому пользователь хочет указать задержку процессора сигнального шлюза. Пользователь хочет указать самое короткое и самое длинное время, в течение которого запись может быть вне зависимости от того, сколько новых событий получено.
 
### <a name="use-case-scenario"></a>Сценарий использования
Предположим, вы хотите записать видео каждый раз, когда откроется Передняя дверца здания. Необходимо **X** секунд до открытия дверцы, входящей в запись. Если дверца еще не открыта, запись должна быть в последний раз не менее **Y** секунд. Вы хотите, чтобы запись записывалась в последнюю **глубину в Z** секунды, если дверца будет многократно открыта. Вы понимаете, что датчик двери имеет задержку в **килобайтах** и хочет уменьшить вероятность невозможности возникновения событий ("опоздание"), поэтому для получения событий необходимо разрешить не менее **K** секунд.


## <a name="solution"></a>Решение

**_Изменение параметров процессора сигнального шлюза_* _

Обработчик шлюза сигналов настраивается четырьмя параметрами:
- _ *окно оценки активации**
- **смещение сигнала активации**
- **Минимальное окно активации**
- **Максимальное окно активации**. 

При активации процессора шлюза сигнала он остается открытым в течение минимального времени. Событие активации начинается с отметки времени для самого раннего события, а также от смещения сигнала активации. Если обработчик шлюза сигнала запускается снова, когда он открыт, таймер сбрасывается и шлюз остается открытым по крайней мере для минимального времени активации. Процессор шлюза сигнала никогда не будет оставаться открытым дольше, чем максимальное время активации. Событие **(событие 1)** , которое происходит перед другим событием **(событие 2)** на основе отметок времени носителя, считается недопустимым, если система находится в состоянии несоблюдения, а **событие 1** — обработчику шлюза сигнала после **события 2**. Если **событие 1** не поступает между поступлением **события 2** и **окна оценки активации** , **событие 1** будет игнорироваться и не передаваться через обработчик шлюза сигнала. Идентификаторы корреляции задаются для каждого события. Эти идентификаторы задаются исходя из начального события и помещаются последовательно для каждого следующего события.

> [!IMPORTANT]
> Время носителя основано на метке времени носителя при возникновении события на носителе. Последовательность событий, поступающих в сигнальный шлюз, может не отражать последовательность событий, поступающих в медиа время.


### <a name="parameters-based-on-when-events-arrive-in-physical-time-to-the-signal-gate"></a>Параметры: (на основе времени прибытия событий в шлюз сигнала)

* **минимумактиватионтиме (самая короткая возможная длительность записи)** = минимальное время в секундах, в течение которого обработчик шлюза сигнала остается открытым после запуска для получения новых событий, если не прервано **максимумактиватионтиме**
* **максимумактиватионтиме (наибольшая возможная длительность записи)** = максимальное число секунд от начального события, по истечении которого обработчик шлюза сигнала остается открытым после запуска для получения новых событий, независимо от того, какие события получены.
* **активатионсигналоффсет** = количество секунд между активацией процессора шлюза сигнала и началом записи видео, обычно это значение отрицательное, чтобы начать запись перед срабатыванием события.
* **активатионевалуатионвиндов** = число секунд, начиная с события первоначального запуска, в котором событие, произошедшее перед начальным событием в течение времени мультимедиа, должно поступать на процессор шлюза сигнала, прежде чем он не будет учитываться и считаться "опозданием".

> [!NOTE]
> Позднее прибытие — это любое событие, которое прибывает после того, как окно оценки активации прошло, но это событие пришло до первоначального события в Media Time.

### <a name="limits-of-parameters"></a>Ограничения параметров

* **Активатионевалуатионвиндов: от 0 секунд до 10 секунд**

* **Активатионсигналоффсет: от-1 минуты до 1 минуты**

* **Минимумактиватионтиме: от 1 секунды до 1 часа**

* **Максимумактиватионтиме: от 1 секунды до 1 часа**


В зависимости от варианта использования параметры будут установлены следующим образом:

* **Активатионевалуатионвиндов = K с**
* **Активатионсигналоффсет =-X с**
* **Минимумактиватионвиндов = Y с**
* **Максимумактиватионвиндов = Z с**


Ниже приведен пример того, как раздел узла процессора сигнального шлюза должен в топологии Media Graph для следующих значений параметров:
* **Активатионевалуатионвиндов = 1 секунда**
* **Активатионсигналоффсет =-5 секунд**
* **Минимумактиватионтиме = 20 секунд**
* **Максимумактиватионтиме = 40 с**

> [!IMPORTANT]
> Для каждого значения параметра ожидается [формат длительности ISO 8601](https://en.wikipedia.org/wiki/ISO_8601#Durations
) . 
**Пример: PT1S = 1 секунда**


```
"processors":              
[
          {
            "@type": "#Microsoft.Media.MediaGraphSignalGateProcessor",
            "name": "signalGateProcessor",
            "inputs": [
              {
                "nodeName": "iotMessageSource"
              },
              {
                "nodeName": "rtspSource"
              }
            ],
            "activationEvaluationWindow": "PT1S",
            "activationSignalOffset": "-PT5S",
            "minimumActivationTime": "PT20S",
            "maximumActivationTime": "PT40S"
          }
]
```


Давайте рассмотрим, как эта конфигурация процессора сигнального шлюза будет работать в различных сценариях записи.


**1 событие из источника 1 ( *нормальная активация* )**

Обработчик шлюза сигнала, получающий одно событие, приведет к записи, запускающей "смещение сигнала активации" (5) секунд до поступления события в шлюз. Оставшаяся часть записи — "минимальное время активации" (20) секунд, так как никакие другие события до завершения минимального времени активации не выполняются для повторного запуска шлюза.

Пример диаграммы:
> [!div class="mx-imgBorder"]
> :::image type="content" source="./media/configure-signal-gate-how-to/normal-activation.svg" alt-text="Нормальная активация":::

* Длительность записи =-offset + Минимумактиватионтиме = [E1 + offset, E1 + Минимумактиватионтиме]


**2 события из одного источника ( *активирована активация* )**

Обработчик шлюза сигнала, получающий два события, приведет к записи, запускающей "смещение сигнала активации" (пять) секунд до поступления первого события в шлюз. Второе событие прибывает пять секунд после первого события, которое предшествует «минимальное время активации» (20) секунд от первого события, поэтому шлюз повторно активируется, чтобы оставаться открытым. Оставшаяся часть записи — это "минимальное время активации" (20) секунд, так как никакие другие события не поступают до тех пор, пока не завершится минимальное время активации второго события, чтобы снова запустить шлюз.

Пример диаграммы:
> [!div class="mx-imgBorder"]
> :::image type="content" source="./media/configure-signal-gate-how-to/retriggering-activation.svg" alt-text="Активация активирована":::

* Продолжительность записи =-Offset + (прибытие 2-го события) + Минимумактиватионтиме


**N событий из 1 источника ( *Максимальная активация* )**

Обработчик шлюза сигнала, получающий N событий, приведет к записи, запускающей "смещение сигнала активации" (5) секунд до поступления первого события в шлюз. По мере поступления каждого события перед завершением "минимального времени активации" (20) секунд от предыдущего события, шлюз будет непрерывно срабатывать и оставаться открытым до "наибольшего времени активации" (40) секунд после первого события, в котором шлюз закрылся и больше не будет принимать новые события.

Пример диаграммы:
> [!div class="mx-imgBorder"]
> :::image type="content" source="./media/configure-signal-gate-how-to/maximum-activation.svg" alt-text="Максимальная активация":::
 
* Продолжительность записи =-offset + Максимумактиватионтиме

> [!IMPORTANT]
> На схемах предполагается, что каждое событие прибывает в одном и том же экземпляре в физическом и медиа время. (Без поздних появления)

## <a name="next-steps"></a>Дальнейшие шаги

### <a name="try-it-out"></a>Попробуйте

[Руководство по записи видео на основе событий](event-based-video-recording-tutorial.md)

Используя учебник по записи видео на основе событий, измените [topology.jsна](https://raw.githubusercontent.com/Azure/live-video-analytics/master/MediaGraph/topologies/evr-hubMessage-assets/topology.json), измените параметры для узла сигналгатепроцессор, а затем следуйте оставшейся части этого руководства. Проверьте записи видео для анализа влияния параметров.



