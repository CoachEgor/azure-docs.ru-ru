---
title: Развертывание и администрирование топологий Apache Storm в Azure HDInsight
description: Узнайте, как развертывать, контролировать и управлять топологиАми Apache Storm с помощью приборной панели Storm на основе Linux HDInsight. Использование инструментов Hadoop для Visual Studio.
author: hrasheed-msft
ms.author: hrasheed
ms.reviewer: jasonh
ms.service: hdinsight
ms.topic: conceptual
ms.custom: hdinsightactive
ms.date: 12/18/2019
ms.openlocfilehash: e890289230b3215bd102d8c5a78dca4f1b7b90f8
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79271906"
---
# <a name="deploy-and-manage-apache-storm-topologies-on-azure-hdinsight"></a>Развертывание и администрирование топологий Apache Storm в Azure HDInsight

С помощью этого документа вы ознакомитесь с основами управления и мониторинга топологий [Apache Storm](https://storm.apache.org/), работающих в Storm в кластерах HDInsight.

## <a name="prerequisites"></a>Предварительные требования

* Кластер Apache Storm в HDInsight. Ознакомьтесь со статьей [Create Linux-based clusters in HDInsight by using the Azure portal](../hdinsight-hadoop-create-linux-clusters-portal.md) (Создание кластеров под управлением Linux в HDInsight с помощью портала Azure) и выберите **Storm** для параметра **Тип кластера**.

* (Необязательно) Знакомство с безопасной оболочкой (SSH) и безопасной копией (SCP). Дополнительные сведения см. в руководстве по [подключению к HDInsight (Apache Hadoop) с помощью SSH](../hdinsight-hadoop-linux-use-ssh-unix.md).

* (Необязательно) Visual Studio, Azure SDK 2.5.1 или newer, и Data Lake Tools for Visual Studio. Для получения дополнительной информации, [см. Apache Hadoop & Visual Studio Data Lake Tools](../hadoop/apache-hadoop-visual-studio-tools-get-started.md).

## <a name="submit-a-topology-using-visual-studio"></a>Отправить топологию с помощью Visual Studio

Инструменты Data Lake Tools для Visual Studio можно использовать для отправки c-образных или гибридных топологий в кластер Storm. Далее используется пример приложения. Для получения информации о создании топологии с помощью инструментов Data Lake Tools [см.](apache-storm-develop-csharp-visual-studio-topology.md)

1. Если вы еще не установили последнюю версию инструментов Data Lake для Visual Studio, [см.](../hadoop/apache-hadoop-visual-studio-tools-get-started.md)

    > [!NOTE]  
    > Ранее Инструменты Azure Data Lake и Stream Analytics назывались ИНСТРУМЕНТАМи HDInsight для визуальной студии.
    >
    > Azure Data Lake и Stream Analytics Tools for Visual Studio включены в рабочую нагрузку по **разработке Azure** для Visual Studio 2019.

1. Запустите среду Visual Studio.

1. В окне **Начало работы** выберите **Создать проект**.

1. В **новом** окне проекта выберите окно поиска `Storm`и введите. Затем выберите **Storm Sample** из списка результатов и выберите **Следующий.**

1. В **новом** окне проекта введите **имя проекта**и перейдите или создайте **место,** чтобы сохранить новый проект. Затем выберите **Создать**.

    ![Наверскакните новое окно проекта, Visual Studio](./media/apache-storm-deploy-monitor-topology-linux/apache-storm-sample1.png)

1. От **Server Explorer,** нажмите правой кнопкой мыши **Azure** и выберите **Подключитесь к подписке Microsoft Azure...**

1. От **solution Explorer**, правой кнопкой мыши проекта, и выберите Отправить в Storm на **HDInsight**.

    > [!NOTE]  
    > При появлении запроса введите учетные данные входа для своей подписки Azure. Если у вас несколько подписок, воспользуйтесь той, что содержит ваш кластер Storm в HDInsight.

1. В диалоговом поле **Submit Topology** под списком выпадающих кластеров **Storm,** выберите Storm в кластере HDInsight, а затем выберите **Отправить.** Вы можете контролировать, является ли представление успешным, просматривая панель **вывода.**

## <a name="submit-a-topology-using-ssh-and-the-storm-command"></a>Отправить топологию с помощью SSH и команды Storm

1. Используйте [команду ssh](../hdinsight-hadoop-linux-use-ssh-unix.md) для подключения к кластеру. Отоверьте приведенную ниже команду, заменив CLUSTERNAME на имя кластера, а затем введите команду:

    ```cmd
    ssh sshuser@CLUSTERNAME-ssh.azurehdinsight.net
    ```

1. Из сеанса ssh используйте следующую команду, чтобы начать топологию примера **WordCount:**

    ```bash
    storm jar /usr/hdp/current/storm-client/contrib/storm-starter/storm-starter-topologies-*.jar org.apache.storm.starter.WordCountTopology WordCount
    ```

    Эта команда запускает пример топологии WordCount в кластере. Эта топология произвольно создает предложения, а затем подсчитывает число вхождений каждого слова в предложениях.

    > [!NOTE]  
    > При отправке топологии в кластер необходимо сначала скопировать файл .jar, содержащий кластер, перед использованием `storm` команды. Чтобы скопировать файл в кластер, можно использовать команду `scp`. Например, введите `scp FILENAME.jar USERNAME@CLUSTERNAME-ssh.azurehdinsight.net:FILENAME.jar`.
    >
    > Пример *WordCount* и другие примеры стартовых штормов `/usr/hdp/current/storm-client/contrib/storm-starter/`уже включены в кластер в .

## <a name="submit-a-topology-programmatically"></a>Отправить топологию программно

Топологию можно развернуть программными средствами с помощью службы Nimbus. [https://github.com/Azure-Samples/hdinsight-java-deploy-storm-topology](https://github.com/Azure-Samples/hdinsight-java-deploy-storm-topology)приводит пример Java-приложения, демонстрируя, как развертывать и запускать топологию через службу Nimbus.

## <a name="monitor-and-manage-a-topology-in-visual-studio"></a>Мониторинг и управление топологией в Visual Studio

При отправке топологии с помощью Visual Studio появляется окно **Storm Topologies View.** Выберите топологию в списке, чтобы просмотреть информацию о выполняемой топологии.

![Монитор топологии, Шторм Топологии Просмотр окна, Visual Studio](./media/apache-storm-deploy-monitor-topology-linux/visual-studio-monitor.png)

> [!NOTE]  
> **Топологии Storm** можно также просмотреть в **обозревателе сервера**. Расширьте **Azure** > **HDInsight**, нажмите правой кнопкой мыши Storm на кластере HDInsight, а затем выберите **Просмотр топологий Storm.**

Выделите компонент spout или bolt, чтобы просмотреть информацию о нем. Для выбранного элемента отображается набор инструментов с информацией о компонентах.

### <a name="deactivate-and-reactivate-a-topology"></a>Деактивировать и реактивировать топологию

Деактивация топологии приостанавливает его до тех пор, пока топология не будет убита или активирована. Для проведения этих операций используйте кнопки **«Деактивация»** и **«Реактивация»** в области **действий** в верхней части окна **Storm Topologies View.**

### <a name="rebalance-a-topology"></a>Перебалансировка топологии

Повторная балансировка топологии позволяет системе пересмотреть параллелизм топологии. Например, если вы переосделали кластер, чтобы добавить больше заметок, ребалансировка позволяет топологии увидеть новые узлы.

Чтобы сбалансировать топологию, используйте кнопку **Rebalance** в области **действий** окна **Storm Topologies View.**

> [!WARNING]  
> Перебалансировка топологии деактивирует топологию, равномерно распределяет работников по всему кластеру, а затем возвращает топологию в состояние, в каком она находилась до того, как произошла ребалансировка. Если топология была активна, она снова становится активной. Если топология была деактивирована, она остается деактивированной.

### <a name="kill-a-running-topology"></a>Завершение запущенной топологии

Топологии шторма продолжают работать до тех пор, пока они не будут остановлены или кластер не будет удален. Чтобы остановить топологию, используйте кнопку **Kill** в области **действий.**

## <a name="monitor-and-manage-a-topology-using-ssh-and-the-storm-command"></a>Мониторинг и управление топологией с помощью sSH и команды Storm

Программа `storm` позволяет работать с запущенными топологиями из командной строки. Чтобы вывести полный список команд, воспользуйтесь `storm -h` .

### <a name="list-topologies"></a>Вывод списка топологий

Чтобы просмотреть список всех запущенных топологий, используйте следующую команду:

```shell
storm list
```

Эта команда возвращает сведения аналогичные следующим:

```shell
Topology_name        Status     Num_tasks  Num_workers  Uptime_secs
-------------------------------------------------------------------
WordCount            ACTIVE     29         2            263
```

### <a name="deactivate-and-reactivate-a-topology"></a>Деактивировать и реактивировать топологию

Деактивация топологии приостанавливает его до тех пор, пока топология не будет убита или активирована. Используйте следующие команды для деактивации или реактивации:

```shell
storm Deactivate TOPOLOGYNAME
```

```shell
storm Activate TOPOLOGYNAME
```

### <a name="kill-a-running-topology"></a>Завершение запущенной топологии

Топологии Storm после запуска продолжают работать до тех пор, пока не будут остановлены. Для завершения топологии введите следующую команду:

```shell
storm kill TOPOLOGYNAME
```

### <a name="rebalance-a-topology"></a>Перебалансировка топологии

Повторная балансировка топологии позволяет системе пересмотреть параллелизм топологии. Например, если вы переосделали кластер, чтобы добавить больше заметок, ребалансировка позволяет топологии увидеть новые узлы.

> [!WARNING]  
> Перебалансировка топологии деактивирует топологию, равномерно распределяет работников по всему кластеру, а затем возвращает топологию в состояние, в каком она находилась до того, как произошла ребалансировка. Если топология была активна, она снова становится активной. Если она была отключена, то останется таковой.

```shell
storm rebalance TOPOLOGYNAME
```

## <a name="monitor-and-manage-a-topology-using-the-storm-ui"></a>Мониторинг и управление топологией с помощью разбитого веком Storm

Интерфейс Storm предоставляет веб-интерфейс для работы с запущенными топологиями, и он включен в кластер HDInsight. Чтобы открыть пользовательский интерфейс Storm, в веб-браузере перейдите по адресу `https://CLUSTERNAME.azurehdinsight.net/stormui`, где *CLUSTERNAME* — это имя вашего кластера.

> [!NOTE]  
> Если вас просят уговорить имя пользователя и пароль, введите имя пользователя и пароль администратора кластера, которые вы использовали при создании кластера.

### <a name="storm-ui-main-page"></a>Шторм UI главная страница

На главной странице пользовательского интерфейса Storm отображается следующая информация.

| Section | Описание |
| --- | --- |
| Сводная информация о кластере| Основная информация о кластере Storm. |
| Нимбус резюме | Список основных информации Nimbus. |
| Topology summary | Список запущенных топологий. Чтобы просмотреть дополнительную информацию о конкретной топологии, выберите ее ссылку в столбце **«Имя».** |
| Резюме руководителя | Информация о контролере Storm. Чтобы увидеть ресурсы работника, связанные с определенным руководителем, выберите его ссылку в столбце **Host** или **Id.** |
| Конфигурация Нимбуса | Конфигурация Nimbus для кластера. |

Главная страница разбивки в испуге Storm выглядит так же, как эта веб-страница:

![Главная страница, Storm UI, Apache Storm topologies, Azure](./media/apache-storm-deploy-monitor-topology-linux/apache-storm-web-ui-main-page.png)

#### <a name="topology-summary"></a>Topology summary

При выборе ссылки в разделе **Topology summary** (Сводка по топологиям) отображается следующая информация о топологии.

| Section | Описание |
| --- | --- |
| Topology summary | Общие сведения о топологии. |
| Действия топологии| Действия управления, которые вы можете сделать для топологии. Доступные действия описаны позднее в этом разделе. |
| Статистика топологии | Статистика по топологии. Чтобы установить временные рамки для входа в этом разделе, выберите его ссылку в столбце **Window.** |
| Носики *(временные рамки)* | Используемые в топологии источники данных, которые называются воронками. Чтобы просмотреть дополнительную информацию о конкретном носике, выберите его ссылку в столбце **Id.** |
| Болты *(временные рамки)* | Используемые в топологии обработчики данных, которые называются ситами. Чтобы просмотреть дополнительную информацию о конкретном болте, выберите его ссылку в столбце **Id.** |
| Рабочие ресурсы | Список ресурсов работников. Чтобы просмотреть дополнительную информацию о конкретном ресурсе работника, выберите его ссылку в столбце **Host.** |
| Визуализация топологии | Кнопка **визуализации шоу,** отображая визуализацию топологии. |
| Конфигурация топологии | Конфигурация выбранной топологии. |

Сводная страница топологии Storm выглядит похоже на эту веб-страницу:

![Страница резюме Topology, Разбивка шторма, Шторм Apache, Azure](./media/apache-storm-deploy-monitor-topology-linux/apache-storm-web-ui-topology-summary.png)

В разделе **Действия Topology** можно выбрать следующие кнопки для выполнения действия:

| Кнопка | Описание |
| --- | --- |
| Активировать | Возобновление обработки отключенной топологии. |
| Отключение | Приостановка выполняемой топологии. |
| Повторная балансировка | Корректировка параллелизма топологии. Необходимо сбалансировать работающие топологии после изменения количества узлов в кластере. Эта операция позволяет топологии настроить параллелизм, чтобы компенсировать дополнительное или уменьшенное количество узлов в кластере.<br/><br/>Дополнительные сведения см. в статье о <a href="https://storm.apache.org/documentation/Understanding-the-parallelism-of-a-Storm-topology.html" target="_blank">параллелизме топологии Apache Storm</a>.
| Завершить | Останавливает выполнение топологии Storm по истечении заданного времени ожидания. |
| Отладка | Начинается сеанс отладки для запущенной топологии. |
| Остановить дебаг | Завершает сеанс отладки для запущенной топологии. |
| Уровень журнала изменения | Изменяет уровень журнала отладки. |

##### <a name="spout-and-bolt-summary"></a>Носик и болт резюме

При выборе воронки в разделе **Spouts** (Воронки) или **Bolts** (Сита) отображается следующая информация о выбранном элементе.

| Section | Описание |
| --- | --- |
| Сводка по компоненту | Основная информация о воронке или сите. |
| Действия компонента | **Кнопки отнажатия** и **остановки отогина.** |
| Статистика носик или статистика болтов | Статистика по воронке или ситу. Чтобы установить временные рамки для входа в этом разделе, выберите его ссылку в столбце **Window.** |
| (Только для болтов)<br/>Статистика ввода *(временные рамки)* | Информация о входных потоках, проходящих через сито. |
| Статистика вывода *(временные рамки)* | Информация о потоках, создаваемых компонентами воронки или сита. |
| Профилирование и отладка | Элементы управления для профилирования и отладки компонентов на этой странице. Вы можете установить значение **Status / Timeout (Минуты),** и вы можете выбрать кнопки для **JStack,** **Перезагрузка работника**и **кучи**. |
| Исполнители *(временные рамки)* | Информация об экземплярах воронки или сита. Для просмотра журнала диагностической информации, подготовленной для данного экземпляра, выберите запись **порта** для конкретного исполнителя. Вы также можете увидеть ресурсы работы, связанные с определенным исполнителем, выбрав его ссылку в столбце **Host.** |
| ошибки | Информация об ошибках для компонентов воронки или сита. |

Страница резюме болт шторм выглядит похоже на эту веб-страницу:

![Страница резюме Болта, Storm UI, Apache Storm, Azure](./media/apache-storm-deploy-monitor-topology-linux/apache-storm-web-ui-bolt-summary.png)

## <a name="monitor-and-manage-the-topology-using-the-rest-api"></a>Мониторинг и управление топологией с помощью REST API

Разбитое storm построено поверх REST API, так что вы можете выполнять аналогичные задачи управления и мониторинга с помощью REST API. С помощью REST API можно создать пользовательские средства для отслеживания топологий Storm и управления ими.

Дополнительные сведения см. в статье о [REST API пользовательского интерфейса Apache Storm](https://storm.apache.org/releases/current/STORM-UI-REST-API.html). Следующая информация касается использования REST API с Apache Storm в HDInsight.

> [!IMPORTANT]  
> API Storm REST не является общедоступным через Интернет. Он должен быть доступен с помощью туннеля SSH к головному узлам кластера HDInsight. Для получения информации о создании и использовании туннеля SSH [см.](../hdinsight-linux-ambari-ssh-tunnel.md)

### <a name="base-uri"></a>Базовый универсальный код ресурса

Базовая URI для REST API на linux-группах HDInsight `https://HEADNODEFQDN:8744/api/v1/`доступна по адресу URL, где вы заменяете *HEADNODEF-DN* головным узлам. Доменное имя головного узла генерируется при создании кластера и не является статичным.

Вы можете найти полностью квалифицированное доменное имя (ФЗДН) для головного узла кластера несколькими способами:

| Метод обнаружения ФЗЛН | Описание |
| --- | --- |
| Сессия SSH | Из сеанса SSH в кластер примените команду `headnode -f`. |
| Веб-интерфейс Ambari | На веб-странице кластера`https://CLUSTERNAME.azurehdinsight.net`Ambari ( , выберите **Услуги** из верхней части страницы, а затем выберите **Storm**. На вкладке **Summary** (Сводка) выберите **Storm UI Server** (Сервер пользовательского интерфейса Storm). Полное доменное имя узла, на котором размещены пользовательский интерфейс Storm и REST API, отображено в верхней части страницы. |
| Ambari REST API | Используйте команду `curl -u admin -G "https://CLUSTERNAME.azurehdinsight.net/api/v1/clusters/CLUSTERNAME/services/STORM/components/STORM_UI_SERVER"`, чтобы получить сведения об узле с выполняемыми пользовательскими интерфейсами Storm и REST API. Замените два экземпляра *CLUSTERNAME* на имя кластера. Когда вам будет предложено, введите пароль для учетной записи пользователя (админ). В ответе запись "host_name" выхода JSON содержит ФЗН узла. |

### <a name="authentication"></a>Проверка подлинности

Запросы на REST API должны использовать *базовую аутентификацию,* поэтому необходимо использовать имя администратора и пароль для кластера HDInsight.

> [!NOTE]  
> Так как при обычной проверке подлинности данные отправляются открытым текстом, следует *всегда* использовать HTTPS для защиты связи с кластером.

### <a name="return-values"></a>Возвращаемые значения

Сведения, возвращаемые из REST API, могут использоваться только в пределах кластера. Например, полностью квалифицированное доменное имя (ФЗДН), возвращенное для серверов [Apache zooKeeper,](https://zookeeper.apache.org/) недоступно из Интернета.

## <a name="next-steps"></a>Дальнейшие действия

См. дополнительные сведения о [разработке топологий на основе Java с помощью Apache Maven](apache-storm-develop-java-topology.md).

Список дополнительных примеров топологий [см.](apache-storm-example-topology.md)
