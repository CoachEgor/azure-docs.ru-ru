---
title: Исключение при запуске запросов от Apache Ambari Hive View в Azure HDInsight
description: Устранение неполадок при запуске запросов Apache Hive через Apache Ambari Hive View в Azure HDInsight.
author: hrasheed-msft
ms.author: hrasheed
ms.reviewer: jasonh
ms.service: hdinsight
ms.topic: troubleshooting
ms.date: 12/23/2019
ms.openlocfilehash: 809b2e383eb57b730fd76ec2194764178aa810c0
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75895051"
---
# <a name="exception-when-running-queries-from-apache-ambari-hive-view-in-azure-hdinsight"></a>Исключение при запуске запросов от Apache Ambari Hive View в Azure HDInsight

В этой статье описаны шаги устранения неполадок и возможные решения проблем при взаимодействии с кластерами Azure HDInsight.

## <a name="issue"></a>Проблема

При запуске запроса Apache Hive от Apache Ambari Hive View вы периодически получаете следующее сообщение об ошибке:

```error
Cannot create property 'errors' on string '<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'>
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
<title>IIS 8.5 Detailed Error - 502.3 - Bad Gateway</title>
```

## <a name="cause"></a>Причина

Тайм-аут шлюза.

Значение тайм-аута шлюза составляет 2 минуты. Запросы от Ambari Hive View `/hive2` передаются в конечную точку через шлюз. После успешной компиляции и принятия запроса `queryid`HiveServer возвращает сярприз. Затем клиенты продолжают опрос для получения статуса запроса. Во время этого процесса, если HiveServer не возвращает ответ HTTP в течение 2 минут, ШЛюз HDI бросает 502.3 ошибка тайм-аута шлюза вызывающему абоненту. Ошибки могут произойти, когда запрос отправлен для обработки (скорее всего), а также в вызове статуса get (менее вероятно). Пользователи могли видеть любой из них.

Поток обработчика http должен быть быстрым: `queryid`подготовить работу и вернуть . Однако, по нескольким причинам, все потоки обработчика могут быть заняты, что приводит к тайм-аутам для новых запросов и вызовам статуса.

### <a name="responsibilities-of-the-http-handler-thread"></a>Обязанности потока обработчика HTTP

Когда клиент отправляет запрос в HiveServer, он выполняет следующие данные в потоке переднего плана:

* Разобрать запрос, сделать семантической проверки
* Приобрести блокировку
* Метамагазин поиска, если это необходимо
* Составить запрос (DDL или DML)
* Подготовка плана запросов
* Выполнение авторизации (Запуск всех применимых политик рейнджеров в защищенных кластерах)

## <a name="resolution"></a>Решение

Некоторые общие рекомендации для улучшения ситуации:

* При использовании внешнего метамагазина улья проверьте метрики DB и убедитесь, что база данных не перегружена. Рассмотрим масштабирование слоя базы данных metastore.

* Убедитесь, что параллельные операции включены (это позволяет потокам обработчика HTTP работать параллельно). Чтобы проверить значение, запустите [Apache Ambari](../hdinsight-hadoop-manage-ambari.md) и перейдите на **Hive** > **Configs** > **Advanced** > Custom**hive-сайт.** Значение должно `hive.server2.parallel.ops.in.session` быть `true`.

* Убедитесь, что VM SKU кластера не слишком мал для нагрузки. Рассмотрите возможность разделения работы на несколько кластеров. Для получения дополнительной информации [см.](../hdinsight-capacity-planning.md#choose-a-cluster-type)

* Если Ranger установлен на кластере, пожалуйста, проверьте, есть ли слишком много политик Ranger, которые должны быть оценены для каждого запроса. Ищите дубликаты или ненужные политики.

* Проверьте значение **Размера кучи HiveServer2** от Ambari. Перейдите к**оптимизации****настройки настройки** >  **Hive** > **Configs.** >  Убедитесь, что значение больше, чем 10 ГБ. Отрегулируйте по мере необходимости для оптимизации производительности.

* Убедитесь, что запрос Hive хорошо настроен. Для получения дополнительной информации смотрите [запросы Оптимизированных Apache Hive в Azure HDInsight](../hdinsight-hadoop-optimize-hive-query.md).

## <a name="next-steps"></a>Дальнейшие действия

Если вы не видите своего варианта проблемы или вам не удается ее устранить, дополнительные сведения можно получить, посетив один из следующих каналов.

* Получите ответы от экспертов Azure через [поддержку сообщества Azure.](https://azure.microsoft.com/support/community/)

* Связаться [@AzureSupport](https://twitter.com/azuresupport) с - официальная учетная запись Microsoft Azure для улучшения обслуживания клиентов. Подключение сообщества Azure к нужным ресурсам: ответы, поддержка и эксперты.

* Если вам нужна дополнительная помощь, вы можете отправить запрос на поддержку с [портала Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade/). Выберите **поддержку** из бара меню или откройте концентратор **поддержки Справка и.** Для получения более подробной информации просмотрите [Как создать запрос поддержки Azure.](https://docs.microsoft.com/azure/azure-portal/supportability/how-to-create-azure-support-request) Доступ к управлению подпиской и поддержке выставления счетов включен в подписку Microsoft Azure, а техническая поддержка обеспечивается через один из [планов поддержки Azure.](https://azure.microsoft.com/support/plans/)
