---
title: Использование туннелирования SSH для доступа к Azure HDInsight
description: Узнайте, как безопасно просматривать веб-ресурсы, размещенные на узлах HDInsight под управлением Linux, с помощью туннеля SSH.
author: hrasheed-msft
ms.reviewer: jasonh
ms.service: hdinsight
ms.custom: hdinsightactive
ms.topic: conceptual
ms.date: 05/28/2019
ms.author: hrasheed
ms.openlocfilehash: 943bf0f4bba014c31a11bb30bf8d3b6a7c11a343
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "66299350"
---
# <a name="use-ssh-tunneling-to-access-apache-ambari-web-ui-jobhistory-namenode-apache-oozie-and-other-web-uis"></a>Использование туннелирования SSH для доступа к пользовательскому веб-интерфейсу Apache Ambari, JobHistory, NameNode, Apache Oozie и другим пользовательским веб-интерфейсам

Кластеры HDInsight предоставляют доступ к веб-интерфейсу Apache Ambari через Интернет, но для некоторых компонентов требуется туннель SSH. Например, пользовательский веб-интерфейс для службы Apache Oozie недоступен через Интернет без туннеля SSH.

## <a name="why-use-an-ssh-tunnel"></a>Причины для использования туннеля SSH

Некоторые меню в Ambari работают только через туннель SSH. Для этих меню используются веб-сайты и службы, выполняющиеся на узлах других типов, например рабочих узлах.

Туннель SSH требуется для следующих пользовательских веб-интерфейсов:

* Журнал заданий
* узел имен;
* стеки потоков;
* веб-интерфейс Oozie
* веб-интерфейс главного узла и журналов HBase

При использовании действий скриптов для настройки кластера туннель SSH требуется для всех служб и программ, которые вы установили для доступа к веб-службе. Например, если вы установили Hue с помощью действия сценария, для доступа к веб-интерфейсу Hue потребуется туннель SSH.

> [!IMPORTANT]  
> Если у вас есть прямой доступ к HDInsight через виртуальную сеть, то вам не нужно использовать туннели SSH. Пример прямого доступа к HDInsight через виртуальную сеть см. в статье о [подключении HDInsight к локальной сети](connect-on-premises-network.md).

## <a name="what-is-an-ssh-tunnel"></a>Что такое туннель SSH?

С помощью [туннелирования Secure Shell (SSH)](https://en.wikipedia.org/wiki/Tunneling_protocol#Secure_Shell_tunneling) порт на локальном компьютере подключается к головному узлу в HDInsight. Трафик, отправленный в локальный порт, маршрутизируется по SSH-подключению к головному узлу. на котором запрос разрешается так же, как если бы он был создан на головном узле. Ответ рабочей станции отправляется обратно через туннель.

## <a name="prerequisites"></a>Технические условия

* Клиент SSH. Дополнительные сведения см. в руководстве по [подключению к HDInsight (Apache Hadoop) с помощью SSH](hdinsight-hadoop-linux-use-ssh-unix.md).

* Веб-браузер, который можно настроить на использование прокси-сервера SOCKS5.

    > [!WARNING]  
    > Встроенная в параметры Интернета в Windows поддержка прокси-сервера SOCKS не применяется к SOCKS5 и не работает при выполнении действий в этом документе. Следующие браузеры используют параметры прокси-сервера Windows и в настоящее время не будут работать при выполнении действий в этом документе.
    >
    > * Microsoft Edge
    > * Microsoft Internet Explorer
    >
    > Google Chrome также использует параметры прокси-сервера Windows. Но можно установить расширения, которые поддерживают SOCKS5. Рекомендуется использовать [FoxyProxy Standard](https://chrome.google.com/webstore/detail/foxyproxy-standard/gcknhkkoolaabfmlnjonogaaifnjlfnp).

## <a name="usessh"></a>Создание туннеля с помощью команды SSH

Используйте следующую команду для создания туннеля SSH с помощью команды `ssh` . Замените `sshuser` именем пользователя SSH для кластера HDInsight, а `clustername` с именем кластера HDInsight:

```cmd
ssh -C2qTnNf -D 9876 sshuser@clustername-ssh.azurehdinsight.net
```

Эта команда создает подключение, через которое направляется трафик, поступающий на локальный порт 9876, в кластер по протоколу SSH. Доступны следующие параметры.

* **D 9876** — локальный порт, используемый для направления трафика через туннель;
* **C** — сжатие всех данных, так как веб-трафик преимущественно состоит из текста;
* **2** — принудительная попытка использовать только протокол SSH версии 2;
* **q** — тихий режим;
* **T** — отключение распределения псевдотелетайпа, так как выполняется только перенаправление порта;
* **n** — запрет считывания с STDIN, так как выполняется только перенаправление порта;
* **N** — запрет на выполнение удаленной команды, так как выполняется только перенаправление порта;
* **f** — выполнение в фоновом режиме.

После завершения команды трафик, отправленный на порт 9876 локального компьютера, будет направляться на головной узел кластера.

## <a name="useputty"></a>Создание туннеля с помощью PuTTY

[PuTTY](https://www.chiark.greenend.org.uk/~sgtatham/putty) — это графический клиент SSH для Windows. Если вы не работали с PuTTY, ознакомьтесь с [документацией по PuTTY](https://www.chiark.greenend.org.uk/~sgtatham/putty/docs.html). Для создания туннеля SSH с помощью PuTTY выполните следующие действия.

### <a name="create-or-load-a-session"></a>Создание или загрузка сеанса

1. Откройте PuTTY и выберите **Session** (Сеанс) в меню слева. Если сеанс уже сохранен, выберите имя сеанса из **сохраненные сеансы** перечисления и выбора **нагрузки**.

1. Если же у вас еще нет сохраненного сеанса, введите информацию о подключении.
    * **Host Name (or IP address)** (Имя узла (или IP-адрес)) — SSH-адрес для кластера HDInsight. Например, **mycluster-ssh.azurehdinsight.net**
    * **Port** (Порт) — 22.
    * **Connection Type** (Тип подключения) — SSH.

1. Нажмите кнопку **Сохранить**.

    ![Создание сеанса SSH.](./media/hdinsight-linux-ambari-ssh-tunnel/hdinsight-create-putty-session.png)

1. В разделе **Категории** в левой части диалогового окна последовательно разверните **Подключение**, **SSH** и выберите **Туннели**.

1. Введите следующую информацию в форме **Параметры, управляющие перенаправлением портов SSH** :
   
   * **Порт источника** — порт на стороне клиента, трафик которого нужно перенаправлять. Например, **9876**.

   * **Destination** (Назначение) — SSH-адрес для кластера HDInsight. Например, **mycluster-ssh.azurehdinsight.net**.

   * **Динамическая** — включает динамическую маршрутизацию прокси-сервера SOCKS.
     
     ![изображение параметров туннелирования](./media/hdinsight-linux-ambari-ssh-tunnel/puttytunnel.png)

1. Выберите **добавить** добавьте параметры, а затем нажмите кнопку **откройте** открыть SSH-подключение.

1. Когда появится запрос, войдите на сервер.

## <a name="use-the-tunnel-from-your-browser"></a>Использование туннеля из браузера

> [!IMPORTANT]  
> Для действий, описанных в этом разделе, используется браузер FireFox, так как предоставляет те же параметры прокси-сервера на всех платформах. Для других современных браузеров, например Google Chrome, может потребоваться расширение, например FoxyProxy, для работы с туннелем.

1. Настроить браузер для использования **localhost** и порта, использованного при создании туннеля, в качестве прокси-сервера **SOCKS 5**. Вот как выглядят параметры Firefox. Если используется порт, отличный от 9876, измените номер порта соответствующим образом.
   
    ![изображение параметров Firefox](./media/hdinsight-linux-ambari-ssh-tunnel/firefoxproxy.png)
   
   > [!NOTE]  
   > Если выбрать параметр **Remote DNS** (Удаленная служба DNS), то запросы службы доменных имен (DNS) будут разрешаться с помощью кластера HDInsight. Этот параметр разрешает запросы DNS с помощью головного узла кластера.

2. Чтобы проверить, работает ли туннель, зайдите на сайт [https://www.whatismyip.com/](https://www.whatismyip.com/). Возвращаемый IP-адрес должен быть адресом, который используется центром обработки данных Microsoft Azure.

## <a name="verify-with-ambari-web-ui"></a>Проверка для веб-интерфейса Ambari

После настройки кластера выполните следующие действия, чтобы удостовериться, что веб-интерфейсы служб доступны из веб-интерфейса Ambari.

1. В браузере перейдите по адресу `http://headnodehost:8080`. Адрес `headnodehost` отправляется через туннель в кластер и разрешается в головном узле, где выполняется Ambari. При появлении запроса введите имя пользователя (admin) и пароль учетной записи администратора кластера. Веб-интерфейс Ambari может потребовать повторного ввода имени пользователя и пароля. В этом случае повторно введите имя пользователя и пароль.

   > [!NOTE]  
   > При использовании адреса `http://headnodehost:8080` для подключения к кластеру вы подключаетесь через туннель. Безопасность обмена данными обеспечивает туннель SSH, а не протокол HTTPS. Для подключения через Интернет по протоколу HTTPS, используйте `https://clustername.azurehdinsight.net`, где `clustername` — это имя кластера.

2. В веб-интерфейсе Ambari выберите HDFS в списке в левой части страницы.

    ![Изображение с выбранным пунктом HDFS](./media/hdinsight-linux-ambari-ssh-tunnel/hdfsservice.png)

3. После появления информации о службе HDFS выберите **Быстрые ссылки**. Появится список головных узлов кластера. Выберите один из головных узлов, а затем выберите **NameNode UI**(Пользовательский интерфейс NameNode).

    ![Изображение с развернутым меню "Быстрые ссылки"](./media/hdinsight-linux-ambari-ssh-tunnel/namenodedropdown.png)

    > [!NOTE]  
    > При выборе меню __Быстрые ссылки__ может появиться индикатор ожидания. Это может произойти, если подключение к Интернету медленное. Подождите одну-две минуты для получения данных с сервера, а затем повторите попытку.
    >
    > Некоторые записи в меню **Быстрые ссылки** могут быть обрезаны правым краем экрана. В этом случае разверните меню с помощью мыши и используйте клавишу со стрелкой вправо, чтобы прокрутить экран вправо и увидеть остальную часть меню.

4. Откроется страница, аналогичная следующей:

    ![Изображение пользовательского интерфейса NameNode](./media/hdinsight-linux-ambari-ssh-tunnel/namenode.png)

    > [!NOTE]  
    > Обратите внимание, что URL-адрес для этой страницы; он должен быть аналогичен `http://hn1-CLUSTERNAME.randomcharacters.cx.internal.cloudapp.net:8088/cluster`. Этот URI использует полное внутреннее доменное имя узла (FQDN), и он доступен только при использовании туннеля SSH.

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы узнали, как создать и использовать туннель SSH, просмотрите другие способы использования Ambari в следующем документе:

* [Управление кластерами HDInsight с помощью веб-интерфейса Apache Ambari](hdinsight-hadoop-manage-ambari.md)