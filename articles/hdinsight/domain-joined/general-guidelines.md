---
title: Общие рекомендации по корпоративной безопасности в Azure HDInsight
description: Некоторые рекомендации, которые должны облегчить развертывание и управление пакетом корпоративной безопасности.
author: hrasheed-msft
ms.author: hrasheed
ms.reviewer: jasonh
ms.service: hdinsight
ms.topic: conceptual
ms.date: 02/13/2020
ms.openlocfilehash: be6c1fdc5deb6d541656c198469822dae0a5f7c5
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "77463210"
---
# <a name="enterprise-security-general-information-and-guidelines-in-azure-hdinsight"></a>Общая информация и рекомендации по корпоративной безопасности в Azure HDInsight

При развертывании безопасного кластера HDInsight существует несколько рекомендаций, которые должны упростить управление развертыванием и кластером. Некоторые общие сведения и руководящие принципы обсуждаются здесь.

## <a name="use-of-secure-cluster"></a>Использование безопасного кластера

### <a name="recommended"></a>Рекомендуемая

* Кластер будет использоваться несколькими пользователями одновременно.
* Пользователи имеют разные уровни доступа к тем же данным.

### <a name="not-necessary"></a>Не обязательно

* Вы собираетесь запускать только автоматизированные задания (например, один пользовательский аккаунт), стандартный кластер достаточно хорош.
* Вы можете выполнять импорт данных с помощью стандартного кластера и использовать одну и ту же учетную запись хранилища в другом безопасном кластере, где пользователи могут выполнять задания аналитики.

## <a name="use-of-local-account"></a>Использование локальной учетной записи

* Если вы используете общую учетную запись пользователя или локальную учетную запись, то будет трудно определить, кто использовал учетную запись для изменения конфигурации или службы.
* Использование локальных учетных записей является проблематичным, когда пользователи больше не являются частью организации.

## <a name="ranger"></a>Ranger

### <a name="policies"></a>Политики

* По умолчанию Ranger использует **Deny** в качестве политики.

* Когда доступ к данным осуществляется через службу, где авторизация включена:
  * Плагин авторизации Ranger вызывается и учитывая контекст запроса.
  * Ranger применяет политики, настроенные для службы. В случае сбоя политики Ranger проверка доступа откладывается в файловую систему. Некоторые службы, такие как MapReduce, проверяют только то, принадлежит ли файл/папка тому же пользователю, который отправляет запрос. Службы, такие как Hive, проверить либо собственности совпадают или соответствующие разрешения файловой системы (`rwx`).

* Для Hive, в дополнение к разрешению делать Создать / Обновление / `rwx`Удалить разрешения, пользователь должен иметь разрешения на каталог на хранение и все суб-каталоги.

* Политики могут применяться к группам (предпочтительным) вместо отдельных лиц.

* Авторизатор Ranger оценит все политики Ranger для этой службы для каждого запроса. Эта оценка может повлиять на время, задействоваве на принятие задания или запроса.

### <a name="storage-access"></a>Доступ к хранению

* Если тип хранилища ЯВЛЯЕТСЯ WASB, то не участвует токен OAuth.
* Если Ranger выполнил авторизацию, то доступ к хранению происходит с помощью Управляемой идентификации.
* Если Ranger не выполнил авторизацию, то доступ к хранению происходит с помощью токена OAuth пользователя.

### <a name="hierarchical-name-space"></a>Пространство иерархических имен

Когда иерархическое пространство имени в невключенном:

* Разрешения на наследство не имеются.
* Только разрешение файловой системы, которое работает, это роль **хранения данных XXXX** RBAC, которая будет назначена пользователю непосредственно на портале Azure.

### <a name="default-hdfs-permissions"></a>Разрешения HDFS по умолчанию

* По умолчанию пользователи не имеют **/** доступа к папке на HDFS (они должны быть в роли владельца капли хранилища для получения доступа к успеху).
* Для постановки каталога для mapreduce и других, пользовательский `sticky _wx` каталог создается и предоставляется разрешения. Пользователи могут создавать файлы и папки внизу, но не могут смотреть на другие элементы.

### <a name="url-auth"></a>URL auth

Если URL auth включен:

* Конфигурация будет содержать то, что префиксы покрыты `adl://`в URL auth (например).
* Если доступ для этого URL, то Ranger будет проверять, если пользователь находится в списке разрешений.
* Рейнджер не будет проверять ни один из тонкозернистых политик.

## <a name="resource-groups"></a>Группы ресурсов

Используйте новую группу ресурсов для каждого кластера, чтобы можно было различать ресурсы кластера.

## <a name="nsgs-firewalls-and-internal-gateway"></a>НС, брандмауэры и внутренний шлюз

* Используйте группы сетевой безопасности (NSGs) для блокировки виртуальных сетей.
* Используйте брандмауэр для обработки политик исходящего доступа.
* Используйте внутренний шлюз, который не открыт для общедоступного интернета.

## <a name="azure-active-directory"></a>Azure Active Directory

[Активный каталог Azure](../../active-directory/fundamentals/active-directory-whatis.md) (Azure AD) — служба управления идентификаторами и доступом корпорации Майкрософт.

### <a name="policies"></a>Политики

* Отстранить от политики условного доступа с помощью политики на основе IP-адресов. Для этого необходимо, чтобы конечные точки обслуживания были включены на VNETs, где развернуты кластеры. Если вы используете внешний сервис для МИД (что-то другое, чем AAD), политика на основе IP-адреса не будет работать

* `AllowCloudPasswordValidation`политика необходима для федеративных пользователей. Поскольку HDInsight использует имя пользователя / пароль непосредственно для получения токенов из Azure AD, эта политика должна быть включена для всех пользователей с федеративными устройствами.

* Включить конечные точки службы, если требуется условное обход доступа с использованием надежных I-пор.

### <a name="groups"></a>Группы

* Всегда развертывайте кластеры с группой.
* Используйте Azure AD для управления членством в группах (проще, чем пытаться управлять отдельными службами в кластере).

### <a name="user-accounts"></a>Учетные записи пользователей

* Используйте уникальную учетную запись пользователя для каждого сценария. Например, используйте учетную запись для импорта, используйте другую для запроса или другие задания обработки.
* Используйте групповые политики Ranger вместо отдельных политик.
* Есть план, как управлять пользователями, которые не должны иметь доступ к кластерам больше.

## <a name="azure-active-directory-domain-services"></a>Доменные службы Azure Active Directory

[Службы домена Active Directory Domain Services](../../active-directory-domain-services/overview.md) (Azure AD DS) предоставляют управляемые доменные службы, такие как соединение доменов, групповая политика, легкий протокол доступа к каталогам (LDAP) и аутентификация Kerberos / NTLM, которая полностью совместима с Active Directory Windows Server.

Для присоединения к домену для присоединения безопасных кластеров требуется AD Azure DS.
HDInsight не может зависеть от контроллеров доменов или пользовательских контроллеров доменов, так как он вводит слишком много точек сбоев, обмена учетными данными, разрешений DNS и так далее. Для получения дополнительной информации смотрите [часто задаваемые вопросы Azure AD DS](../../active-directory-domain-services/faqs.md).

### <a name="azure-ad-ds-instance"></a>Экземпляр Azure AD DS

* Создайте экземпляр `.onmicrosoft.com domain`с помощью . Таким образом, не будет несколько DNS-серверов, обслуживающих домен.
* Создайте сертификат с самостоятельной подписью для LDAPS и загрузите его в Azure AD DS.
* Используйте запутанную виртуальную сеть для развертывания кластеров (когда у вас есть несколько групп, развертывающих кластеры HDInsight ESP, это будет полезно). Это гарантирует, что вам не нужно открывать порты (NSG) в виртуальной сети с контроллером домена.
* Направляйте DNS для виртуальной сети правильно (доменное имя Azure AD DS должно быть решено без каких-либо записей файлов хоста).
* Если вы ограничиваете исходящий трафик, убедитесь, что вы прочитали [поддержку брандмауэра в HDInsight](../hdinsight-restrict-outbound-traffic.md)

### <a name="properties-synced-from-azure-ad-to-azure-ad-ds"></a>Свойства синхронизированы с Azure AD с Azure AD DS

* Azure AD соединяет синхронизацию от локальных до Azure AD.
* Azure AD DS синхронизируется с Azure AD.

Azure AD DS периодически синхронизирует объекты из Azure AD. Лезвие Azure AD DS на портале Azure отображает состояние синхронизации. На каждом этапе синхронизации уникальные свойства могут попасть в конфликт и переименоваться. Обратите внимание на отображение свойств от Azure AD до Azure AD DS.

Для получения дополнительной информации смотрите [в группе Azure AD UserPrincipalName](../../active-directory/hybrid/plan-connect-userprincipalname.md)и [как работает синхронизация Azure AD DS.](../../active-directory-domain-services/synchronization.md)

### <a name="password-hash-sync"></a>Синхронизация хэша паролей

* Пароли синхронизируются иначе, чем другие типы объектов. Только необратимые хэши паролей синхронизируются в Azure AD и Azure AD DS
* В помещение Azure AD должно быть включено через AD Connect
* Синхронизация Azure AD к Azure AD DS происходит автоматически (поздние ожидания составляют менее 20 минут).
* Хэши паролей синхронизируются только при наличии измененного пароля. При включении синхронизации хэша паролей все существующие пароли не синхронизируются автоматически, поскольку они хранятся необратимо. При изменении пароля синхронизируются хэши паролей.

### <a name="computer-objects-location"></a>Расположение компьютерных объектов

Каждый кластер связан с одним OU. Внутренний пользователь подготовлен в OU. Все узлы являются доменом, объединенными в один и тот же OU.

### <a name="active-directory-administrative-tools"></a>Активные административные инструменты каталога

Ознакомиться с тем, как установить административные инструменты Active Directory на VM с Windows Server VM, можно ознакомиться с [инструментами управления Install.](../../active-directory-domain-services/tutorial-create-management-vm.md)

## <a name="troubleshooting"></a>Устранение неполадок

### <a name="cluster-creation-fails-repeatedly"></a>Создание кластера не удается повторно

Наиболее распространенные причины:

* Конфигурация DNS неверна, соединение домена кластерных узлов сбой.
* НСГ слишком ограничительны, предотвращая соединение доменов.
* Управляемая идентификация не имеет достаточных разрешений.
* Название кластера не является уникальным на первых шести символах (либо с другим живым кластером, либо с удаленным кластером).

## <a name="next-steps"></a>Дальнейшие действия

* [Конфигурации пакета корпоративной безопасности с помощью служб домена Active Directory в HDInsight](./apache-domain-joined-configure-using-azure-adds.md)

* [Синхронизируйте пользователей Active Directory Azure с кластером HDInsight.](../hdinsight-sync-aad-users-to-cluster.md)
