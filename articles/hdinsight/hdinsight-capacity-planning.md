---
title: Планирование загрузки кластера в Azure HDInsight
description: Определите ключевые вопросы для планирования емкости и производительности кластера Azure HDInsight.
author: hrasheed-msft
ms.author: hrasheed
ms.reviewer: jasonh
ms.service: hdinsight
ms.topic: conceptual
ms.custom: hdinsightactive
ms.date: 04/07/2020
ms.openlocfilehash: 4ede8833fdbdbd57654e6c02147f53e58a17b1de
ms.sourcegitcommit: d187fe0143d7dbaf8d775150453bd3c188087411
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80886999"
---
# <a name="capacity-planning-for-hdinsight-clusters"></a>Планирование загрузки кластеров HDInsight

Перед развертыванием кластера HDInsight спланируйте предполагаемую емкость кластера, определив необходимую производительность и масштаб. Это помогает оптимизировать удобство использования и затраты. Некоторые решения кластерной емкости не могут быть изменены после развертывания. В случае изменения параметров производительности кластер можно отключить, а затем повторно создать без потери хранимых в нем данных.

Ниже приведены основные вопросы о планировании загрузки.

* В географическом регионе следует развернуть кластер?
* Какой объем хранилища требуется?
* Какой тип кластера следует выбрать для развертывания?
* Какие размер и тип виртуальной машины следует использовать на узлах кластера?
* Сколько рабочих узлов должен включать в себя кластер?

## <a name="choose-an-azure-region"></a>Выбор региона Azure

Регион Azure определяет место физической подготовки кластера. Чтобы свести к минимуму задержки при чтении и записи, кластер должен быть расположен близко к вашим данным.

Служба HDInsight доступна во многих регионах Azure. Чтобы найти ближайший регион, [см.](https://azure.microsoft.com/global-infrastructure/services/?products=hdinsight)

## <a name="choose-storage-location-and-size"></a>Выбор расположения и размера хранилища

### <a name="location-of-default-storage"></a>Расположение хранилища по умолчанию

Хранилище по умолчанию (учетная запись хранения Azure или Azure Data Lake Storage) должно находиться том же расположении, что и кластер. Служба хранилища Azure доступна во всех расположениях. Данные Lake Storage Gen1 доступны в некоторых регионах - см. текущую [доступность хранилища data Lake.](https://azure.microsoft.com/global-infrastructure/services/?products=storage)

### <a name="location-of-existing-data"></a>Расположение существующих данных

Если в качестве хранилища по умолчанию необходимо использовать существующую учетную запись хранения или хранилище Data Lake Storage, затем необходимо развернуть кластер в том же месте.

### <a name="storage-size"></a>Объем памяти

В развернутом кластере можно прикрепить дополнительные учетные записи хранилища Azure или получить доступ к другим хранилищам озера данных. Все учетные записи хранилища должны жить в том же месте, что и кластер. Хранение озера данных может находиться в другом месте, хотя большие расстояния могут привести к некоторой задержке.

Azure Storage имеет некоторые [ограничения емкости,](../azure-resource-manager/management/azure-subscription-service-limits.md#storage-limits)в то время как Data Lake Storage Gen1 практически не ограничен.

Кластер может обращаться к разным учетным записям хранения. Некоторые распространенные примеры:

* когда объем данных, вероятнее всего, превышает емкость одного контейнера больших двоичных объектов;
* когда скорость доступа к контейнеру больших двоичных объектов может превышать пороговое значение, что активирует регулирование;
* Если вы хотите сделать данные, вы уже загружены в контейнер капли доступны для кластера.
* когда требуется изолировать различные части хранилища из соображений безопасности или для упрощения администрирования.

Для повышения производительности используйте только один контейнер на учетную запись хранения.

## <a name="choose-a-cluster-type"></a>Выбор типа кластера

Тип кластера определяет рабочую нагрузку, настроенную для запуска кластера HDInsight. Типы включают [Apache Hadoop](./hadoop/apache-hadoop-introduction.md), [Apache Storm](./storm/apache-storm-overview.md), [Apache Кафка](./kafka/apache-kafka-introduction.md), или [Apache Spark](./spark/apache-spark-overview.md). Подробное описание доступных типов кластеров см. в статье [Общие сведения об Azure HDInsight и стеке технологий Hadoop и Spark](hdinsight-overview.md#cluster-types-in-hdinsight). Каждый тип кластера имеет определенную топологию развертывания, которая включает в себя требования к размеру и количеству узлов.

## <a name="choose-the-vm-size-and-type"></a>Выбор типа и размера виртуальной машины

У каждого типа кластера имеется набор типов узлов, и у каждого типа узла имеются определенные параметры, определяющие размер и тип виртуальной машины.

Чтобы определить оптимальный размер кластера для приложения, можно измерить производительность кластера и увеличить его размер в соответствии с полученными рекомендациями. Например, можно использовать имитацию рабочей нагрузки или *запрос предохранителя*. Выполнить смоделированные рабочие нагрузки на кластерах разного размера. Постепенно увеличивай размер до достижения предполагаемой производительности. Канарский запрос может периодически вставляться среди других производственных запросов, чтобы показать, достаточно ли ресурсов у кластера.

Для получения дополнительной информации о том, как выбрать правильное семейство VM для рабочей нагрузки, [см.](hdinsight-selecting-vm-size.md)

## <a name="choose-the-cluster-scale"></a>Выбор масштаба кластера

Масштаб кластера определяется количеством его узлов виртуальных машин. Для всех типов кластеров существуют типы узлов, которые имеют определенную шкалу, и типы узлов, поддерживающие масштаб. Например, кластеру может потребоваться ровно три узла [Apache zooKeeper](https://zookeeper.apache.org/) или два узла Головы. Рабочие узлы, обрабатывающие данные распределенным способом, получают выгоду от дополнительных узлов.

В зависимости от типа кластера увеличение числа узлов рабочего значения добавляет дополнительные вычислительные мощности (например, больше ядер). Дополнительные узлы увеличат общую память, необходимую для всего кластера для поддержки хранения обрабатываемых данных в памяти. Как и в случае выбора размера и типа VM, выбор правильной кластерной шкалы обычно достигается эмпирически. Используйте смоделированные рабочие нагрузки или канарейки запросов.

Можно масштабировать кластер для удовлетворения пиковых потребностей в нагрузках. Затем масштабируйте его обратно вниз, когда эти дополнительные узлы больше не нужны. [Функция Autoscale](hdinsight-autoscale-clusters.md) позволяет автоматически масштабировать кластер на основе заранее определенных метрик и таймингов. Для получения дополнительной информации о масштабировании кластеров вручную, [см.](hdinsight-scaling-best-practices.md)

### <a name="cluster-lifecycle"></a>Жизненный цикл кластера

С вас взимается плата за жизнь кластера. Если требуется только определенное время кластера, [создайте кластеры по запросу с помощью Azure Data Factory.](hdinsight-hadoop-create-linux-clusters-adf.md) Можно также создать сценарии PowerShell, которые подготавливают и удаляют кластер, и запланировать выполнение этих сценариев с помощью [службы автоматизации Azure](https://azure.microsoft.com/services/automation/).

> [!NOTE]  
> При удалении кластера также удаляется его метахранилище Hive по умолчанию. Чтобы сохранить метахранилище для следующего повторного создания кластера, используйте внешнее хранилище метаданных, такое как база данных Azure или [Apache Oozie](https://oozie.apache.org/).
<!-- see [Using external metadata stores](hdinsight-using-external-metadata-stores.md). -->

### <a name="isolate-cluster-job-errors"></a>Изоляция ошибок заданий кластера

Иногда ошибки могут возникать из-за параллельного выполнения нескольких карт и уменьшения компонентов в многоузловом кластере. Чтобы помочь изолировать проблему, попробуйте распределенное тестирование. Выполнить одновременное несколько заданий в одном кластере узлов рабочего. Затем расширьте этот подход, чтобы одновременно запускать несколько заданий на кластерах, содержащих более одного узла. Для создания кластера HDInsight с одним узлом воспользуйтесь *`Custom(size, settings, apps)`* опцией и используйте значение 1 для числа рабочих *узлов* в разделе размер **кластера** при подготовке нового кластера на портале.

## <a name="quotas"></a>Квоты

После определения размера виртуальных машин, масштаба и типа целевого кластера проверьте текущие квоты емкости своей подписки. При достижении ограничения квоты нельзя развертывать новые кластеры. Или масштабируйте существующие кластеры, добавляя больше узлов работы. Единственное ограничение квоты является квотой на число ядер ЦП, которая существует на уровне региона для каждой подписки. Например, ваша подписка может иметь 30 основных ограничений в восточной части США.

Чтобы проверить доступные ядра, сделайте следующие шаги:

1. Войдите на [портал Azure](https://portal.azure.com/).
2. Перейдите на страницу **Обзор** для кластера HDInsight.
3. В левом меню выберите **лимиты квоты.**

   Страница отображает количество использоваемых ядер, количество доступных ядер и общее количество ядер.

При необходимости подайте запрос на увеличение квоты, сделав следующее.

1. Войдите на [портал Azure](https://portal.azure.com/).
1. Выберите **справку и поддержку** в нижней левой части страницы.
1. Выберите **новый запрос на поддержку**.
1. В разделе **Новый запрос на поддержку** во вкладке **Основы** выберите следующие параметры:

   - **Тип выпуска**: **Ограничения обслуживания и подписки (квоты)**
   - **Подписка**: подписка, которая вы хотите изменить
   - **Тип квоты**: **HDInsight**

     ![Создание запроса в службу поддержки для увеличения квоты на ядра HDInsight](./media/hdinsight-capacity-planning/hdinsight-quota-support-request.png)

1. Выберите **далее: Решения >>**.
1. На странице Подробности введите описание проблемы, выберите серьезность **проблемы,** предпочтительный метод контакта и другие необходимые поля.
1. Выберите **далее: Обзор и создайте >>**.
1. На вкладке **Проверить и создать** выберите **Создать**.

> [!NOTE]  
> Если нужно увеличить квоту на ядра HDInsight в частную область, [отправьте запрос на список разрешений](https://aka.ms/canaryintwhitelist).

Вы можете [обратиться в службу поддержки, чтобы запросить увеличение квоты](https://docs.microsoft.com/azure/azure-portal/supportability/resource-manager-core-quotas-request).

Существуют некоторые фиксированные ограничения квот. Например, одна подписка Azure может иметь не более 10 000 ядер. Сведения об этих ограничениях см. в статье [Подписка Azure, границы, квоты и ограничения службы](https://docs.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits).

## <a name="next-steps"></a>Дальнейшие действия

* [Настройка кластеров в HDInsight с Apache Hadoop, Spark, Kafka и многое другое:](hdinsight-hadoop-provision-linux-clusters.md)Узнайте, как настроить и настроить кластеры в HDInsight.
* [Мониторинг производительности кластера](hdinsight-key-scenarios-to-monitor.md): изучите основные сценарии, которые могут влиять на емкость кластера HDInsight и требуют его мониторинга.
