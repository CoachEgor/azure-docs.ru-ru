---
title: Планирование загрузки кластера в Azure HDInsight
description: Выявление ключевых вопросов для планирования емкости и производительности кластера Azure HDInsight.
author: hrasheed-msft
ms.author: hrasheed
ms.reviewer: jasonh
ms.service: hdinsight
ms.topic: conceptual
ms.custom: hdinsightactive
ms.date: 04/07/2020
ms.openlocfilehash: 4ede8833fdbdbd57654e6c02147f53e58a17b1de
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "80886999"
---
# <a name="capacity-planning-for-hdinsight-clusters"></a>Планирование загрузки кластеров HDInsight

Перед развертыванием кластера HDInsight спланируйте предполагаемую емкость кластера, определив необходимую производительность и масштаб. Это помогает оптимизировать удобство использования и затраты. Некоторые решения по емкости кластера нельзя изменить после развертывания. В случае изменения параметров производительности кластер можно отключить, а затем повторно создать без потери хранимых в нем данных.

Ниже приведены основные вопросы о планировании загрузки.

* В географическом регионе следует развернуть кластер?
* Какой объем хранилища требуется?
* Какой тип кластера следует выбрать для развертывания?
* Какие размер и тип виртуальной машины следует использовать на узлах кластера?
* Сколько рабочих узлов должен включать в себя кластер?

## <a name="choose-an-azure-region"></a>Выбор региона Azure

Регион Azure определяет место физической подготовки кластера. Чтобы свести к минимуму задержки при чтении и записи, кластер должен быть расположен близко к вашим данным.

Служба HDInsight доступна во многих регионах Azure. Чтобы найти ближайший регион, см. раздел [доступность продуктов по регионам](https://azure.microsoft.com/global-infrastructure/services/?products=hdinsight).

## <a name="choose-storage-location-and-size"></a>Выбор расположения и размера хранилища

### <a name="location-of-default-storage"></a>Расположение хранилища по умолчанию

Хранилище по умолчанию (учетная запись хранения Azure или Azure Data Lake Storage) должно находиться том же расположении, что и кластер. Служба хранилища Azure доступна во всех расположениях. Data Lake Storage 1-го поколения доступен в некоторых регионах — см. сведения о текущей [доступности Data Lake Storage](https://azure.microsoft.com/global-infrastructure/services/?products=storage).

### <a name="location-of-existing-data"></a>Расположение существующих данных

Если вы хотите использовать существующую учетную запись хранения или Data Lake Storage в качестве хранилища по умолчанию для кластера, необходимо развернуть кластер в том же расположении.

### <a name="storage-size"></a>Объем памяти

В развернутом кластере можно присоединить дополнительные учетные записи хранения Azure или получить доступ к другим Data Lake Storage. Все учетные записи хранения должны находиться в том же расположении, что и кластер. Data Lake Storage может находиться в другом расположении, хотя большие расстояния могут привести к задержке.

[Емкость](../azure-resource-manager/management/azure-subscription-service-limits.md#storage-limits)хранилища Azure ограничена, а Data Lake Storage 1-го поколения почти неограниченна.

Кластер может обращаться к разным учетным записям хранения. Некоторые распространенные примеры:

* когда объем данных, вероятнее всего, превышает емкость одного контейнера больших двоичных объектов;
* когда скорость доступа к контейнеру больших двоичных объектов может превышать пороговое значение, что активирует регулирование;
* Если вы хотите сделать данные, вы уже передавали в контейнер больших двоичных объектов, доступный для кластера.
* когда требуется изолировать различные части хранилища из соображений безопасности или для упрощения администрирования.

Для повышения производительности используйте только один контейнер на учетную запись хранения.

## <a name="choose-a-cluster-type"></a>Выбор типа кластера

Тип кластера определяет рабочую нагрузку, для которой настроен кластер HDInsight. К типам относятся [Apache Hadoop](./hadoop/apache-hadoop-introduction.md), [Apache Storm](./storm/apache-storm-overview.md), [Apache Kafka](./kafka/apache-kafka-introduction.md)или [Apache Spark](./spark/apache-spark-overview.md). Подробное описание доступных типов кластеров см. в статье [Общие сведения об Azure HDInsight и стеке технологий Hadoop и Spark](hdinsight-overview.md#cluster-types-in-hdinsight). Каждый тип кластера имеет определенную топологию развертывания, которая включает в себя требования к размеру и количеству узлов.

## <a name="choose-the-vm-size-and-type"></a>Выбор типа и размера виртуальной машины

У каждого типа кластера имеется набор типов узлов, и у каждого типа узла имеются определенные параметры, определяющие размер и тип виртуальной машины.

Чтобы определить оптимальный размер кластера для приложения, можно измерить производительность кластера и увеличить его размер в соответствии с полученными рекомендациями. Например, можно использовать имитацию рабочей нагрузки или *запрос предохранителя*. Запустите смоделированные рабочие нагрузки в разных кластерах размеров. Постепенно увеличивайте размер до достижения предполагаемой производительности. Запрос ранний можно периодически вставлять в другие рабочие запросы, чтобы узнать, достаточно ли ресурсов в кластере.

Дополнительные сведения о выборе подходящего семейства виртуальных машин для рабочей нагрузки см. в статье [Выбор правильного размера виртуальной машины для кластера](hdinsight-selecting-vm-size.md).

## <a name="choose-the-cluster-scale"></a>Выбор масштаба кластера

Масштаб кластера определяется количеством его узлов виртуальных машин. Для всех типов кластеров существуют типы узлов с конкретным масштабом и типы узлов, поддерживающие горизонтальное масштабирование. Например, для кластера может потребоваться ровно три [Apache ZooKeeper](https://zookeeper.apache.org/) узлов или два головных узла. Рабочие узлы, которые выполняют обработку данных в распределенном преимуществах от дополнительных рабочих узлов.

В зависимости от типа кластера, увеличение числа рабочих узлов увеличивает дополнительную вычислительную мощность (например, дополнительные ядра). Дополнительные узлы увеличивают общий объем памяти, необходимый для поддержки хранения обрабатываемых данных в кластере в памяти. Как и при выборе размера и типа виртуальной машины, выбор правильного масштаба кластера обычно достигается. Используйте смоделированные рабочие нагрузки или запросы ранний.

Вы можете масштабировать кластер в соответствии с пиковыми требованиями к нагрузке. Затем следует масштабировать его, если эти дополнительные узлы больше не нужны. [Функция автомасштабирования](hdinsight-autoscale-clusters.md) позволяет автоматически масштабировать кластер на основе предварительно заданных метрик и времени. Дополнительные сведения о масштабировании кластеров вручную см. в статье [масштабирование кластеров HDInsight](hdinsight-scaling-best-practices.md).

### <a name="cluster-lifecycle"></a>Жизненный цикл кластера

Плата наследуется за время существования кластера. Если требуется только определенное время для кластера, [Создайте кластеры по запросу с помощью фабрики данных Azure](hdinsight-hadoop-create-linux-clusters-adf.md). Можно также создать сценарии PowerShell, которые подготавливают и удаляют кластер, и запланировать выполнение этих сценариев с помощью [службы автоматизации Azure](https://azure.microsoft.com/services/automation/).

> [!NOTE]  
> При удалении кластера также удаляется его метахранилище Hive по умолчанию. Чтобы сохранить метахранилище для следующего повторного создания кластера, используйте внешнее хранилище метаданных, такое как база данных Azure или [Apache Oozie](https://oozie.apache.org/).
<!-- see [Using external metadata stores](hdinsight-using-external-metadata-stores.md). -->

### <a name="isolate-cluster-job-errors"></a>Изоляция ошибок заданий кластера

Иногда ошибки могут возникать из-за параллельного выполнения нескольких карт и уменьшения компонентов в кластере с несколькими узлами. Чтобы изолировать эту неполадку, попробуйте выполнить распределенное тестирование. Выполнение нескольких параллельных заданий в одном кластере рабочих узлов. Затем разверните этот подход, чтобы одновременно запустить несколько заданий в кластерах, содержащих несколько узлов. Чтобы создать кластер HDInsight с одним узлом в Azure, используйте *`Custom(size, settings, apps)`* параметр и используйте значение 1 для *количества рабочих узлов* в разделе **Размер кластера** при подготовке нового кластера на портале.

## <a name="quotas"></a>Квоты

После определения размера виртуальных машин, масштаба и типа целевого кластера проверьте текущие квоты емкости своей подписки. При достижении предельной квоты развертывать новые кластеры нельзя. Или масштабировать существующие кластеры, добавляя дополнительные рабочие узлы. Единственное ограничение квоты является квотой на число ядер ЦП, которая существует на уровне региона для каждой подписки. Например, ваша подписка может иметь 30 основных ограничений в восточной части США.

Чтобы проверить доступные ядра, выполните следующие действия.

1. Войдите на [портал Azure](https://portal.azure.com/).
2. Перейдите на страницу **обзора** кластера HDInsight.
3. В меню слева выберите **предел квоты**.

   На странице отображается количество используемых ядер, количество доступных ядер и общее число ядер.

При необходимости подайте запрос на увеличение квоты, сделав следующее.

1. Войдите на [портал Azure](https://portal.azure.com/).
1. Выберите **Справка и поддержка** в нижней левой части страницы.
1. Выберите **новый запрос в службу поддержки**.
1. В разделе **Новый запрос на поддержку** во вкладке **Основы** выберите следующие параметры:

   - **Тип проблемы**: **пределы службы и подписки (квоты)**
   - **Подписка**. Подписка, которую требуется изменить.
   - **Тип квоты**: **HDInsight**

     ![Создание запроса в службу поддержки для увеличения квоты на ядра HDInsight](./media/hdinsight-capacity-planning/hdinsight-quota-support-request.png)

1. Нажмите кнопку **Далее: solutions >>**.
1. На странице **сведения** введите описание проблемы, выберите серьезность проблемы, предпочтительный способ связи и другие обязательные поля.
1. Выберите **Далее: Проверка + создать >>**.
1. На вкладке **Проверить и создать** выберите **Создать**.

> [!NOTE]  
> Если нужно увеличить квоту на ядра HDInsight в частную область, [отправьте запрос на список разрешений](https://aka.ms/canaryintwhitelist).

Вы можете [обратиться в службу поддержки, чтобы запросить увеличение квоты](https://docs.microsoft.com/azure/azure-portal/supportability/resource-manager-core-quotas-request).

Существуют некоторые фиксированные ограничения квоты. Например, одна подписка Azure может иметь не более 10 000 ядер. Сведения об этих ограничениях см. в статье [Подписка Azure, границы, квоты и ограничения службы](https://docs.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits).

## <a name="next-steps"></a>Дальнейшие шаги

* [Настройка кластеров в hdinsight с помощью Apache Hadoop, Spark, Kafka и др](hdinsight-hadoop-provision-linux-clusters.md). Узнайте, как настроить и настроить кластеры в hdinsight.
* [Мониторинг производительности кластера](hdinsight-key-scenarios-to-monitor.md): изучите основные сценарии, которые могут влиять на емкость кластера HDInsight и требуют его мониторинга.
