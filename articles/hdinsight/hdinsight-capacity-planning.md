---
title: Планирование загрузки кластера в Azure HDInsight
description: Определите ключевые вопросы для планирования емкости и производительности кластера Azure HDInsight.
author: hrasheed-msft
ms.author: hrasheed
ms.reviewer: jasonh
ms.service: hdinsight
ms.custom: hdinsightactive
ms.topic: conceptual
ms.date: 10/15/2019
ms.openlocfilehash: 69627c961d9224a124fda09f40901f837d627281
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79272647"
---
# <a name="capacity-planning-for-hdinsight-clusters"></a>Планирование загрузки кластеров HDInsight

Перед развертыванием кластера HDInsight следует спланировать его предполагаемую загрузку, определив необходимые производительность и масштаб. Это помогает оптимизировать удобство использования и затраты. Некоторые решения кластерной емкости не могут быть изменены после развертывания. В случае изменения параметров производительности кластер можно отключить, а затем повторно создать без потери хранимых в нем данных.

Ниже приведены основные вопросы о планировании загрузки.

* В географическом регионе следует развернуть кластер?
* Какой объем хранилища требуется?
* Какой тип кластера следует выбрать для развертывания?
* Какие размер и тип виртуальной машины следует использовать на узлах кластера?
* Сколько рабочих узлов должен включать в себя кластер?

## <a name="choose-an-azure-region"></a>Выбор региона Azure

Регион Azure определяет место физической подготовки кластера. Чтобы свести к минимуму задержки при чтении и записи, кластер должен быть расположен близко к вашим данным.

Служба HDInsight доступна во многих регионах Azure. Чтобы найти ближайший регион, [см.](https://azure.microsoft.com/global-infrastructure/services/?products=hdinsight)

## <a name="choose-storage-location-and-size"></a>Выбор расположения и размера хранилища

### <a name="location-of-default-storage"></a>Расположение хранилища по умолчанию

Хранилище по умолчанию (учетная запись хранения Azure или Azure Data Lake Storage) должно находиться том же расположении, что и кластер. Служба хранилища Azure доступна во всех расположениях. Данные Lake Storage Gen1 доступны в некоторых регионах - см. текущую [доступность хранилища data Lake.](https://azure.microsoft.com/global-infrastructure/services/?products=storage)

### <a name="location-of-existing-data"></a>Расположение существующих данных

Если у вас уже есть учетная запись хранения или хранилище Data Lake Storage с вашими данными и вы хотите использовать это хранилище в качестве хранилища по умолчанию для кластера, то кластер необходимо развернуть в том же расположении.

### <a name="storage-size"></a>Объем памяти

После развертывания кластера HDInsight можно подключить дополнительные учетные записи хранения Azure или обращаться к другим хранилищам Data Lake Storage. Все учетные записи хранения должны находиться в том же расположении, что и кластер. Data Lake Storage может находиться в другом расположении, хотя это может привести к задержке при чтении и записи некоторых данных.

Служба хранилища Azure накладывает некоторые [ограничения емкости](../azure-resource-manager/management/azure-subscription-service-limits.md#storage-limits), тогда как емкость Data Lake Storage 1-го поколения практически не ограничена.

Кластер может обращаться к разным учетным записям хранения. Некоторые распространенные примеры:

* когда объем данных, вероятнее всего, превышает емкость одного контейнера больших двоичных объектов;
* когда скорость доступа к контейнеру больших двоичных объектов может превышать пороговое значение, что активирует регулирование;
* Если вы хотите сделать данные, вы уже загружены в контейнер капли доступны для кластера.
* когда требуется изолировать различные части хранилища из соображений безопасности или для упрощения администрирования.

Для повышения производительности используйте только один контейнер на учетную запись хранения.

## <a name="choose-a-cluster-type"></a>Выбор типа кластера

Тип кластера определяет рабочую нагрузку, для выполнения которой настроен кластер HDInsight. Примеры: [Apache Hadoop](https://hadoop.apache.org/), [Apache Storm](https://storm.apache.org/), [Apache Kafka](https://kafka.apache.org/) или [Apache Spark](https://spark.apache.org/). Подробное описание доступных типов кластеров см. в статье [Общие сведения об Azure HDInsight и стеке технологий Hadoop и Spark](hdinsight-overview.md#cluster-types-in-hdinsight). Каждый тип кластера имеет определенную топологию развертывания, которая включает в себя требования к размеру и количеству узлов.

## <a name="choose-the-vm-size-and-type"></a>Выбор типа и размера виртуальной машины

У каждого типа кластера имеется набор типов узлов, и у каждого типа узла имеются определенные параметры, определяющие размер и тип виртуальной машины.

Чтобы определить оптимальный размер кластера для приложения, можно измерить производительность кластера и увеличить его размер в соответствии с полученными рекомендациями. Например, можно использовать имитацию рабочей нагрузки или *запрос предохранителя*. Имитация рабочей нагрузки позволяет выполнять ожидаемую рабочую нагрузки на кластерах разного размера, постепенного увеличивая их размер, пока не будет достигнута требуемая производительность. Канарский запрос может периодически вставляться среди других производственных запросов, чтобы показать, достаточно ли ресурсов у кластера.

Для получения дополнительной информации о том, как выбрать правильное семейство VM для рабочей нагрузки, [см.](hdinsight-selecting-vm-size.md)

## <a name="choose-the-cluster-scale"></a>Выбор масштаба кластера

Масштаб кластера определяется количеством его узлов виртуальных машин. Для всех типов кластеров существуют типы узлов, которые имеют определенную шкалу, и типы узлов, поддерживающие масштаб. Например, кластеру может потребоваться ровно три узла [Apache zooKeeper](https://zookeeper.apache.org/) или два узла Головы. Развертывание рабочих узлов, которые выполняют распределенную обработку данных, может повысить производительность благодаря добавлению дополнительных рабочих узлов.

В зависимости от того, какой тип кластера используется, при увеличении числа рабочих узлов добавляются дополнительные вычислительные ресурсы (например, дополнительные ядра), но также может увеличиваться общий объем памяти, необходимой всему кластеру для поддержки хранения обрабатываемых данных в памяти. Как и в случае выбора размера и типа виртуальной машины, выбор правильного масштаба кластера обычно осуществляется эмпирически, с помощью имитации рабочей нагрузки или запросов предохранителя.

Можно развернуть кластер, чтобы справиться с пиковыми нагрузками, а затем уменьшить его масштаб, когда эти дополнительные узлы уже будут не нужны. [Функция Autoscale](hdinsight-autoscale-clusters.md) позволяет автоматически масштабировать кластер на основе заранее определенных метрик и таймингов. Для получения дополнительной информации о масштабировании кластеров вручную, [см.](hdinsight-scaling-best-practices.md)

### <a name="cluster-lifecycle"></a>Жизненный цикл кластера

Плата взимается на протяжении времени существования кластера. Если работающий кластер требуется вам только в определенные моменты времени, можно [создавать кластеры по требованию с помощью фабрики данных Azure](hdinsight-hadoop-create-linux-clusters-adf.md). Можно также создать сценарии PowerShell, которые подготавливают и удаляют кластер, и запланировать выполнение этих сценариев с помощью [службы автоматизации Azure](https://azure.microsoft.com/services/automation/).

> [!NOTE]  
> При удалении кластера также удаляется его метахранилище Hive по умолчанию. Чтобы сохранить метахранилище для следующего повторного создания кластера, используйте внешнее хранилище метаданных, такое как база данных Azure или [Apache Oozie](https://oozie.apache.org/).
<!-- see [Using external metadata stores](hdinsight-using-external-metadata-stores.md). -->

### <a name="isolate-cluster-job-errors"></a>Изоляция ошибок заданий кластера

Иногда ошибки могут происходить из-за параллельного выполнения нескольких компонентов maps и reduce в кластере с несколькими узлами. Чтобы помочь изолировать проблему, попробуйте распределенное тестирование, запустив одновременное несколько заданий в одном кластере узлов рабочего места, а затем расширьте этот подход для одновременного выполнения нескольких заданий на кластерах, содержащих более одного узла. Для создания кластера HDInsight с одним узлом воспользуйтесь опцией *Custom (размер, настройки, приложения)* и спользуйте значение 1 для *числа рабочих узлов* в разделе размер **кластера** при создании нового кластера на портале.

## <a name="quotas"></a>Квоты

После определения размера виртуальных машин, масштаба и типа целевого кластера проверьте текущие квоты емкости своей подписки. После достижения квоты вы не сможете развертывать новые кластеры или масштабировать существующие кластеры, добавляя дополнительные рабочие узлы. Единственное ограничение квоты является квотой на число ядер ЦП, которая существует на уровне региона для каждой подписки. Например, ваша подписка может иметь 30 основных ограничений в восточной части США. 

Чтобы проверить доступные ядра, сделайте следующие шаги:

1. Войдите на [портал Azure](https://portal.azure.com/).
2. Перейдите на страницу **Обзор** для кластера HDInsight. 
3. В левом меню нажмите **лимит квоты.**

   Страница отображает количество использоваемых ядер, количество доступных ядер и общее количество ядер.

При необходимости подайте запрос на увеличение квоты, сделав следующее.

1. Войдите на [портал Azure](https://portal.azure.com/).
1. Выберите **справку и поддержку** в нижней левой части страницы.
1. Выберите **новый запрос на поддержку**.
1. В разделе **Новый запрос на поддержку** во вкладке **Основы** выберите следующие параметры:

   - **Тип выпуска**: **Ограничения обслуживания и подписки (квоты)**
   - **Подписка**: подписка, которая вы хотите изменить
   - **Тип квоты**: **HDInsight**

     ![Создание запроса в службу поддержки для увеличения квоты на ядра HDInsight](./media/hdinsight-capacity-planning/hdinsight-quota-support-request.png)

1. Выберите **далее: Решения >>**.
1. На странице Подробности введите описание проблемы, выберите серьезность **проблемы,** предпочтительный метод контакта и другие необходимые поля.
1. Выберите **далее: Обзор и создайте >>**.
1. На вкладке **Проверить и создать** выберите **Создать**.

> [!NOTE]  
> Если нужно увеличить квоту на ядра HDInsight в частную область, [отправьте запрос на список разрешений](https://aka.ms/canaryintwhitelist).

Вы можете [обратиться в службу поддержки, чтобы запросить увеличение квоты](https://docs.microsoft.com/azure/azure-portal/supportability/resource-manager-core-quotas-request).

Однако существуют некоторые фиксированные квоты, например, одна подписка Azure может содержать не более 10 000 ядер. Сведения об этих ограничениях см. в статье [Подписка Azure, границы, квоты и ограничения службы](https://docs.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits).

## <a name="next-steps"></a>Дальнейшие действия

* [Установка кластеров в HDInsight с использованием Apache Hadoop, Spark, Kafka и других технологий](hdinsight-hadoop-provision-linux-clusters.md): узнайте, как установить и настроить кластеры в HDInsight с использованием Apache Hadoop, Spark, Kafka, Interactive Hive, HBase, Служб машинного обучения или Storm.
* [Мониторинг производительности кластера](hdinsight-key-scenarios-to-monitor.md): изучите основные сценарии, которые могут влиять на емкость кластера HDInsight и требуют его мониторинга.
