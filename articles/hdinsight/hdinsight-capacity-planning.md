---
title: Планирование загрузки кластера в Azure HDInsight
description: Выявление ключевых вопросов для планирования емкости и производительности кластера Azure HDInsight.
author: hrasheed-msft
ms.author: hrasheed
ms.reviewer: jasonh
ms.service: hdinsight
ms.custom: hdinsightactive
ms.topic: conceptual
ms.date: 10/15/2019
ms.openlocfilehash: 9080a0f327aae50a87b5e69ec157a46181a38a65
ms.sourcegitcommit: f788bc6bc524516f186386376ca6651ce80f334d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/03/2020
ms.locfileid: "75640947"
---
# <a name="capacity-planning-for-hdinsight-clusters"></a>Планирование загрузки кластеров HDInsight

Перед развертыванием кластера HDInsight следует спланировать его предполагаемую загрузку, определив необходимые производительность и масштаб. Это помогает оптимизировать удобство использования и затраты. Некоторые решения по емкости кластера нельзя изменить после развертывания. В случае изменения параметров производительности кластер можно отключить, а затем повторно создать без потери хранимых в нем данных.

Ниже приведены основные вопросы о планировании загрузки.

* В географическом регионе следует развернуть кластер?
* Какой объем хранилища требуется?
* Какой тип кластера следует выбрать для развертывания?
* Какие размер и тип виртуальной машины следует использовать на узлах кластера?
* Сколько рабочих узлов должен включать в себя кластер?

## <a name="choose-an-azure-region"></a>Выбор региона Azure

Регион Azure определяет место физической подготовки кластера. Чтобы свести к минимуму задержки при чтении и записи, кластер должен быть расположен близко к вашим данным.

Служба HDInsight доступна во многих регионах Azure. Чтобы найти ближайший регион, см. раздел [доступность продуктов по регионам](https://azure.microsoft.com/global-infrastructure/services/?products=hdinsight).

## <a name="choose-storage-location-and-size"></a>Выбор расположения и размера хранилища

### <a name="location-of-default-storage"></a>Расположение хранилища по умолчанию

Хранилище по умолчанию (учетная запись хранения Azure или Azure Data Lake Storage) должно находиться том же расположении, что и кластер. Служба хранилища Azure доступна во всех расположениях. Data Lake Storage 1-го поколения доступен в некоторых регионах — см. сведения о текущей [доступности Data Lake Storage](https://azure.microsoft.com/global-infrastructure/services/?products=storage).

### <a name="location-of-existing-data"></a>Расположение существующих данных

Если у вас уже есть учетная запись хранения или хранилище Data Lake Storage с вашими данными и вы хотите использовать это хранилище в качестве хранилища по умолчанию для кластера, то кластер необходимо развернуть в том же расположении.

### <a name="storage-size"></a>Объем памяти

После развертывания кластера HDInsight можно подключить дополнительные учетные записи хранения Azure или обращаться к другим хранилищам Data Lake Storage. Все учетные записи хранения должны находиться в том же расположении, что и кластер. Data Lake Storage может находиться в другом расположении, хотя это может привести к задержке при чтении и записи некоторых данных.

Служба хранилища Azure накладывает некоторые [ограничения емкости](../azure-resource-manager/management/azure-subscription-service-limits.md#storage-limits), тогда как емкость Data Lake Storage 1-го поколения практически не ограничена.

Кластер может обращаться к разным учетным записям хранения. Некоторые распространенные примеры:

* когда объем данных, вероятнее всего, превышает емкость одного контейнера больших двоичных объектов;
* когда скорость доступа к контейнеру больших двоичных объектов может превышать пороговое значение, что активирует регулирование;
* Если вы хотите сделать данные, вы уже передавали в контейнер больших двоичных объектов, доступный для кластера.
* когда требуется изолировать различные части хранилища из соображений безопасности или для упрощения администрирования.

Для кластера с 48 узлами рекомендуется использовать 4–8 учетных записей хранения. Хотя общий объем хранилища уже может быть вполне достаточным, каждая учетная запись хранения обеспечивает дополнительную пропускную способность сети для вычислительных узлов. При наличии нескольких учетных записей хранения используйте случайное имя без префикса для каждой из них. Назначение случайного именования — уменьшить вероятность возникновения узких мест в хранилище (и регулирования) и типичных сбоев во всех учетных записях. Для повышения производительности используйте только один контейнер на учетную запись хранения.

## <a name="choose-a-cluster-type"></a>Выбор типа кластера

Тип кластера определяет рабочую нагрузку, для выполнения которой настроен кластер HDInsight. Примеры: [Apache Hadoop](https://hadoop.apache.org/), [Apache Storm](https://storm.apache.org/), [Apache Kafka](https://kafka.apache.org/) или [Apache Spark](https://spark.apache.org/). Подробное описание доступных типов кластеров см. в статье [Общие сведения об Azure HDInsight и стеке технологий Hadoop и Spark](hdinsight-overview.md#cluster-types-in-hdinsight). Каждый тип кластера имеет определенную топологию развертывания, которая включает в себя требования к размеру и количеству узлов.

## <a name="choose-the-vm-size-and-type"></a>Выбор типа и размера виртуальной машины

У каждого типа кластера имеется набор типов узлов, и у каждого типа узла имеются определенные параметры, определяющие размер и тип виртуальной машины.

Чтобы определить оптимальный размер кластера для приложения, можно измерить производительность кластера и увеличить его размер в соответствии с полученными рекомендациями. Например, можно использовать имитацию рабочей нагрузки или *запрос предохранителя*. Имитация рабочей нагрузки позволяет выполнять ожидаемую рабочую нагрузки на кластерах разного размера, постепенного увеличивая их размер, пока не будет достигнута требуемая производительность. Запрос ранний можно периодически вставлять в другие рабочие запросы, чтобы узнать, достаточно ли ресурсов в кластере.

Дополнительные сведения о выборе подходящего семейства виртуальных машин для рабочей нагрузки см. в статье [Выбор правильного размера виртуальной машины для кластера](hdinsight-selecting-vm-size.md).

## <a name="choose-the-cluster-scale"></a>Выбор масштаба кластера

Масштаб кластера определяется количеством его узлов виртуальных машин. Для всех типов кластеров существуют типы узлов с конкретным масштабом и типы узлов, поддерживающие горизонтальное масштабирование. Например, для кластера может потребоваться ровно три [Apache ZooKeeper](https://zookeeper.apache.org/) узлов или два головных узла. Развертывание рабочих узлов, которые выполняют распределенную обработку данных, может повысить производительность благодаря добавлению дополнительных рабочих узлов.

В зависимости от того, какой тип кластера используется, при увеличении числа рабочих узлов добавляются дополнительные вычислительные ресурсы (например, дополнительные ядра), но также может увеличиваться общий объем памяти, необходимой всему кластеру для поддержки хранения обрабатываемых данных в памяти. Как и в случае выбора размера и типа виртуальной машины, выбор правильного масштаба кластера обычно осуществляется эмпирически, с помощью имитации рабочей нагрузки или запросов предохранителя.

Можно развернуть кластер, чтобы справиться с пиковыми нагрузками, а затем уменьшить его масштаб, когда эти дополнительные узлы уже будут не нужны. [Функция автомасштабирования](hdinsight-autoscale-clusters.md) позволяет автоматически масштабировать кластер на основе предварительно заданных метрик и времени. Дополнительные сведения о масштабировании кластеров вручную см. в статье [масштабирование кластеров HDInsight](hdinsight-scaling-best-practices.md).

### <a name="cluster-lifecycle"></a>Жизненный цикл кластера

Плата взимается на протяжении времени существования кластера. Если работающий кластер требуется вам только в определенные моменты времени, можно [создавать кластеры по требованию с помощью фабрики данных Azure](hdinsight-hadoop-create-linux-clusters-adf.md). Можно также создать сценарии PowerShell, которые подготавливают и удаляют кластер, и запланировать выполнение этих сценариев с помощью [службы автоматизации Azure](https://azure.microsoft.com/services/automation/).

> [!NOTE]  
> При удалении кластера также удаляется его метахранилище Hive по умолчанию. Чтобы сохранить метахранилище для следующего повторного создания кластера, используйте внешнее хранилище метаданных, такое как база данных Azure или [Apache Oozie](https://oozie.apache.org/).
<!-- see [Using external metadata stores](hdinsight-using-external-metadata-stores.md). -->

### <a name="isolate-cluster-job-errors"></a>Изоляция ошибок заданий кластера

Иногда ошибки могут происходить из-за параллельного выполнения нескольких компонентов maps и reduce в кластере с несколькими узлами. Чтобы изолировать эту неполадку, попробуйте выполнить распределенное тестирование, запустив параллельно несколько заданий в одном кластере рабочих узлов, а затем раскройте этот подход, чтобы одновременно запустить несколько заданий в кластерах, содержащих несколько узлов. Чтобы создать кластер HDInsight с одним узлом в Azure, используйте параметр *Настраиваемый (размер, параметры, приложения)* и используйте значение 1 для *числа рабочих узлов* в разделе **Размер кластера** при подготовке нового кластера на портале.

## <a name="quotas"></a>Квоты

После определения размера виртуальных машин, масштаба и типа целевого кластера проверьте текущие квоты емкости своей подписки. После достижения квоты вы не сможете развертывать новые кластеры или масштабировать существующие кластеры, добавляя дополнительные рабочие узлы. Единственное ограничение квоты является квотой на число ядер ЦП, которая существует на уровне региона для каждой подписки. Например, ваша подписка может иметь 30 основных ограничений в восточной части США. 

Чтобы проверить доступные ядра, выполните следующие действия.

1. Войдите на [портал Azure](https://portal.azure.com/).
2. Перейдите на страницу **обзора** кластера HDInsight. 
3. В меню слева щелкните **пределы квоты**.

   На странице отображается количество используемых ядер, количество доступных ядер и общее число ядер.

При необходимости подайте запрос на увеличение квоты, сделав следующее.

1. Войдите на [портал Azure](https://portal.azure.com/).
1. Выберите **Справка и поддержка** в нижней левой части страницы.
1. Выберите **Новый запрос в службу поддержки**.
1. В разделе **Новый запрос на поддержку** во вкладке **Основы** выберите следующие параметры:

   - **Тип проблемы**: **пределы службы и подписки (квоты)**
   - **Подписка**. Подписка, которую необходимо изменить.
   - **Тип квоты**: **HDInsight**

     ![Создание запроса в службу поддержки для увеличения квоты на ядра HDInsight](./media/hdinsight-capacity-planning/hdinsight-quota-support-request.png)

1. Выберите **Далее: solutions > >** .
1. На странице **сведения** введите описание проблемы, выберите серьезность проблемы, предпочтительный способ связи и другие обязательные поля.
1. Нажмите кнопку **Далее: Проверка и создание > >** .
1. На вкладке " **Проверка и создание** " выберите **создать**.

> [!NOTE]  
> Если нужно увеличить квоту на ядра HDInsight в частную область, [отправьте запрос на список разрешений](https://aka.ms/canaryintwhitelist).

Вы можете [обратиться в службу поддержки, чтобы запросить увеличение квоты](https://docs.microsoft.com/azure/azure-supportability/resource-manager-core-quotas-request).

Однако существуют некоторые фиксированные квоты, например, одна подписка Azure может содержать не более 10 000 ядер. Сведения об этих ограничениях см. в статье [Подписка Azure, границы, квоты и ограничения службы](https://docs.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits).

## <a name="next-steps"></a>Дальнейшие действия

* [Установка кластеров в HDInsight с использованием Apache Hadoop, Spark, Kafka и других технологий](hdinsight-hadoop-provision-linux-clusters.md): узнайте, как установить и настроить кластеры в HDInsight с использованием Apache Hadoop, Spark, Kafka, Interactive Hive, HBase, Служб машинного обучения или Storm.
* [Мониторинг производительности кластера](hdinsight-key-scenarios-to-monitor.md): изучите основные сценарии, которые могут влиять на емкость кластера HDInsight и требуют его мониторинга.
