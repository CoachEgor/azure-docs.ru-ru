---
title: Обработка Apache Spark потоковых заданий в Azure HDInsight занимает больше времени, чем обычно.
description: Обработка Apache Spark потоковых заданий в Azure HDInsight занимает больше времени, чем обычно.
ms.service: hdinsight
ms.topic: troubleshooting
author: hrasheed-msft
ms.author: hrasheed
ms.date: 07/29/2019
ms.openlocfilehash: 7c7baaaa5fd08a102b3b55c38fb2c4bf892480c5
ms.sourcegitcommit: 13d5eb9657adf1c69cc8df12486470e66361224e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/31/2019
ms.locfileid: "68679436"
---
# <a name="scenario-apache-spark-streaming-jobs-take-longer-than-usual-to-process-in-azure-hdinsight"></a>Сценарий: Обработка Apache Spark потоковых заданий в Azure HDInsight занимает больше времени, чем обычно.

В этой статье описываются действия по устранению неполадок и возможные способы решения проблем при использовании Apache Spark компонентов в кластерах Azure HDInsight.

## <a name="issue"></a>Проблемы

Обратите внимание, что некоторые Apache Spark задания потоковой передачи работают медленнее или занимают больше времени, чем обычно для обработки. Для приложений потоковой передачи Spark каждый пакет сообщений соответствует одному заданию, отправленному в Spark. Если для обработки задания обычно требуется X секунд, это может занять от 2-3 минут больше, чем обычно.

## <a name="cause"></a>Причина:

Одна из возможных причин заключается в том, что для завершения записи в кластер Kafka производитель Apache Kafka занимает более 2 минут. Для дальнейшей отладки проблемы с Kafka можно добавить ведение журнала в код, использующий производитель Kafka для отправки сообщений, и сопоставить его с журналами из кластера Kafka.

Другая возможная причина заключается в том, что частые операции чтения и записи в WASB могут привести к задержке в последующих микропакетах. Реализация `Filesystem.listStatus` WASB очень мала из-за `O(n!)` алгоритма удаления дубликатов. Он использует слишком много памяти из-за дополнительного преобразования `BlobListItem` `FileMetadata` `FileStatus`в в. Например, для вывода списка файлов 700 000 алгоритм занимает более 30 минут. Поэтому, `ListBlobs` если вызывается агрессивно с SparkSQL каждого микропакетного пакета, то последующие микропакеты будут задерживаться, в результате чего вы будете испытывать проблемы с высокой задержкой при планировании. [Это исправление](https://issues.apache.org/jira/browse/HADOOP-15547) устраняет проблему, но если она отсутствует в вашей среде, `ListBlobs` будет работать высокая задержка. Кроме того, даже если файлы удаляются каждый час, список в серверной части должен пройти по всем строкам (включая удаленные), так как процесс сбора мусора еще не завершен. Хотя это исправление может решить проблему, проблема сборки мусора может вызвать задержку при потоковой обработке пакетов.

## <a name="resolution"></a>Разрешение

Примените исправление [Hadoop-15547](https://issues.apache.org/jira/browse/HADOOP-15547) . Если это невозможно, можно использовать HDFS в качестве расположения для проверки. Задайте `checkpointDirectory` значение примерно следующего вида `hdfs://mycluster/checkpoint`:.

## <a name="next-steps"></a>Следующие шаги

Если вы не видите своего варианта проблемы или вам не удается ее устранить, дополнительные сведения можно получить, посетив один из следующих каналов.

* Получите ответы от экспертов Azure через [службу поддержки сообщества Azure](https://azure.microsoft.com/support/community/).

* Подключайтесь с помощью [@AzureSupport](https://twitter.com/azuresupport) официальной учетной записи Microsoft Azure для улучшения качества работы клиентов, подключив сообщество Azure к нужным ресурсам: ответы, поддержка и эксперты.

* Если вам нужна дополнительная помощь, можно отправить запрос в службу поддержки из [портал Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade/). Выберите пункт **Поддержка** в строке меню или откройте центр **справки и поддержки** . Дополнительные сведения см. [в](https://docs.microsoft.com/azure/azure-supportability/how-to-create-azure-support-request)этой службе. Доступ к управлению подписками и поддержкой выставления счетов включен в вашу подписку Microsoft Azure, а техническая поддержка предоставляется через один из [планов поддержки Azure](https://azure.microsoft.com/support/plans/).
