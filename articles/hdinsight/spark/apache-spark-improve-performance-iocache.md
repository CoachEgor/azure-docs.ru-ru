---
title: Производительность Apache Spark рабочих нагрузок с помощью кэша операций ввода-вывода Azure HDInsight (Предварительная версия)
description: Узнайте о службе IO Cache для Azure HDInsight и ее использовании для повышения производительности Apache Spark.
ms.service: hdinsight
author: hrasheed-msft
ms.author: hrasheed
ms.topic: conceptual
ms.date: 10/15/2018
ms.openlocfilehash: a078fc205403983f4f6484f6a7ccde7f99c4dd58
ms.sourcegitcommit: 97605f3e7ff9b6f74e81f327edd19aefe79135d2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/06/2019
ms.locfileid: "70734547"
---
# <a name="improve-performance-of-apache-spark-workloads-using-azure-hdinsight-io-cache-preview"></a>Повышение производительности рабочих нагрузок Apache Spark с помощью службы IO Cache для Azure HDInsight (предварительная версия)

IO Cache — это служба кэширования данных для Azure HDInsight, который повышает производительность заданий Apache Spark. IO Cache также поддерживает рабочие нагрузки [Apache Tez](https://tez.apache.org/) и [Apache Hive](https://hive.apache.org/), которые могут выполняться в кластерах [Apache Spark](https://spark.apache.org/). IO Cache использует компонент кэширования с открытым исходным кодом RubiX. Локальный дисковый кэш RubiX предназначен для использования с модулями аналитики больших данных, которые получают данные из систем облачного хранения. RubiX выделяется в ряду систем кэширования, поскольку использует для хранения данных не оперативную память, а твердотельные накопители (SSD). Служба IO Cache запускает серверы метаданных RubiX на каждом рабочем узле кластера и управляет ими. Она также настраивает прозрачное использование кэша RubiX для всех служб кластера.

Большинство твердотельных накопителей обеспечивают пропускную способность более 1 ГБ в секунду. Такая пропускная способность в сочетании с файловым кэшем в памяти, который поддерживает операционная система, обеспечивает возможность загружать модули обработки для вычисления больших данных, например Apache Spark. Оперативная память остается доступной Apache Spark для обработки задач с высокой нагрузкой на память, например процессов изменения порядка элементов. Эксклюзивное использование оперативной памяти позволяет Apache Spark добиться оптимального использования ресурсов.  

>[!Note]  
>В настоящее время IO Cache использует RubiX в качестве компонента кэширования, но в будущих версиях службы это может измениться. Используйте интерфейсы IO Cache, не создавая никаких прямых зависимостей от реализации RubiX.

## <a name="benefits-of-azure-hdinsight-io-cache"></a>Преимущества IO Cache для Azure HDInsight

Использование IO Cache повышает производительность заданий, которые считывают данные из хранилища BLOB-объектов Azure.

Вам не придется вносить никаких изменений в задания Spark, чтобы заметить повышение производительности от использования IO Cache. При отключенной службе IO Cache этот код Spark считывает данные напрямую из удаленного хранилища BLOB-объектов Azure: `spark.read.load('wasbs:///myfolder/data.parquet').count()`. При включенной службе IO Cache эта же строка кода считывает данные через IO Cache. В дальнейшем данные уже считываются локально с твердотельного накопителя. Рабочие узлы в кластере HDInsight оснащаются локально подключенными выделенными твердотельными накопителями. IO Cache для HDInsight использует эти локальные твердотельные накопители для кэширования, обеспечивая минимально возможный уровень задержки и повышая пропускную способность.

## <a name="getting-started"></a>Приступая к работе

IO Cache для Azure HDInsight по умолчанию отключен в предварительной версии. Служба IO Cache доступна в кластерах Azure HDInsight 3.6 и более поздних версий с Apache Spark 2.3.  Чтобы включить IO Cache, сделайте следующее:

1. Выберите кластер HDInsight на [портале Azure](https://portal.azure.com).

1. На странице **Обзор** (которая открывается по умолчанию при выборе кластера) выберите **Домашняя страница Ambari** в разделе **Панели мониторинга кластера**.

1. Выберите службу **IO Cache** в левой части страницы.

1. Выберите **Действия**, а затем **Активировать**.

    ![Включение службы IO Cache в Ambari](./media/apache-spark-improve-performance-iocache/ambariui-enable-iocache.png "Включение службы IO Cache в Ambari")

1. Подтвердите перезапуск всех затрагиваемых служб в кластере.

>[!NOTE]  
> Несмотря на значение индикатора выполнения, фактически IO Cache активируется только после перезапуска всех затрагиваемых служб.

## <a name="troubleshooting"></a>Устранение неполадок
  
После включения IO Cache при выполнении заданий Spark могут возникать ошибки отсутствия места на диске. Эти ошибки связаны с тем, что Spark также использует место на локальном диске для хранения данных во время операций перетасовки. Может случиться так, что после включения IO Cache на твердотельном накопителе закончится свободное место для Spark. По умолчанию IO Cache использует половину от общего объема твердотельного накопителя. В Ambari можно настроить параметры использования места на диске для IO Cache. Если вы столкнетесь с ошибками отсутствия места на диске, сократите объем памяти на твердотельном накопителе, используемый для IO Cache, и перезапустите службу. Чтобы изменить настройки пространства для IO Cache, выполните следующие действия:

1. В Apache Ambari выберите службу **HDFS** слева.

1. Выберите вкладки **Configs** (Конфигурации) и **Advanced** (Дополнительно).

    ![Редактирование расширенной конфигурации HDFS](./media/apache-spark-improve-performance-iocache/ambariui-hdfs-service-configs-advanced.png "Редактирование расширенной конфигурации HDFS")

1. Прокрутите вниз и разверните область **Custom core-site** (Пользовательский основной сайт).

1. Найдите свойство **hadoop.cache.data.fullness.percentage**.

1. Измените значение в этом поле.

    ![Изменение процента заполненности IO Cache](./media/apache-spark-improve-performance-iocache/ambariui-cache-data-fullness-percentage-property.png "Изменение процента заполненности IO Cache")

1. Выберите **Сохранить** в правом верхнем углу.

1. Выберите **Restart** (Перезапустить)  > **Restart All Affected** (Перезапустить все затрагиваемые).

    ![Перезапустить все затрагиваемые](./media/apache-spark-improve-performance-iocache/ambariui-restart-all-affected.png "Перезапустить все затрагиваемые")

1. Щелкните **Confirm Restart All** (Подтвердить перезапуск всех).

Если это не поможет, отключите IO Cache.

## <a name="next-steps"></a>Следующие шаги

- Дополнительные сведения о кэше ввода-вывода, включая показатели производительности, см. в следующей записи блога: [Девятикратное ускорение заданий Apache Spark с кэшем ввода-вывода HDInsight (Apache Spark jobs gain up to 9x speed up with HDInsight IO Cache)](https://azure.microsoft.com/blog/apache-spark-speedup-with-hdinsight-io-cache/).
