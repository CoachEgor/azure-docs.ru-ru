---
title: Производительность Apache Spark - Azure HDInsight IO Cache (Предварительный просмотр)
description: Узнайте о службе IO Cache для Azure HDInsight и ее использовании для повышения производительности Apache Spark.
author: hrasheed-msft
ms.author: hrasheed
ms.reviewer: jasonh
ms.service: hdinsight
ms.topic: conceptual
ms.date: 12/23/2019
ms.openlocfilehash: 43875b87d26f144b85454077fd3c044c820132bf
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75494989"
---
# <a name="improve-performance-of-apache-spark-workloads-using-azure-hdinsight-io-cache"></a>Улучшение производительности рабочих нагрузок Apache Spark с помощью кэша Azure HDInsight IO

IO Cache — это служба кэширования данных для Azure HDInsight, который повышает производительность заданий Apache Spark. IO Cache также поддерживает рабочие нагрузки [Apache Tez](https://tez.apache.org/) и [Apache Hive](https://hive.apache.org/), которые могут выполняться в кластерах [Apache Spark](https://spark.apache.org/). IO Cache использует компонент кэширования с открытым исходным кодом RubiX. Локальный дисковый кэш RubiX предназначен для использования с модулями аналитики больших данных, которые получают данные из систем облачного хранения. RubiX выделяется в ряду систем кэширования, поскольку использует для хранения данных не оперативную память, а твердотельные накопители (SSD). Служба IO Cache запускает серверы метаданных RubiX на каждом рабочем узле кластера и управляет ими. Она также настраивает прозрачное использование кэша RubiX для всех служб кластера.

Большинство твердотельных накопителей обеспечивают пропускную способность более 1 ГБ в секунду. Такая пропускная способность в сочетании с файловым кэшем в памяти, который поддерживает операционная система, обеспечивает возможность загружать модули обработки для вычисления больших данных, например Apache Spark. Оперативная память остается доступной Apache Spark для обработки задач с высокой нагрузкой на память, например процессов изменения порядка элементов. Эксклюзивное использование оперативной памяти позволяет Apache Spark добиться оптимального использования ресурсов.  

> [!Note]  
> В настоящее время IO Cache использует RubiX в качестве компонента кэширования, но в будущих версиях службы это может измениться. Используйте интерфейсы IO Cache, не создавая никаких прямых зависимостей от реализации RubiX.
>В настоящее время IO Cache поддерживается только при хранении Azure BLOB.

## <a name="benefits-of-azure-hdinsight-io-cache"></a>Преимущества IO Cache для Azure HDInsight

Использование IO Cache повышает производительность заданий, которые считывают данные из хранилища BLOB-объектов Azure.

Вам не придется вносить никаких изменений в задания Spark, чтобы заметить повышение производительности от использования IO Cache. При отключенной службе IO Cache этот код Spark считывает данные напрямую из удаленного хранилища BLOB-объектов Azure: `spark.read.load('wasbs:///myfolder/data.parquet').count()`. При включенной службе IO Cache эта же строка кода считывает данные через IO Cache. В дальнейшем данные уже считываются локально с твердотельного накопителя. Рабочие узлы в кластере HDInsight оснащаются локально подключенными выделенными твердотельными накопителями. IO Cache для HDInsight использует эти локальные твердотельные накопители для кэширования, обеспечивая минимально возможный уровень задержки и повышая пропускную способность.

## <a name="getting-started"></a>Начало работы

IO Cache для Azure HDInsight по умолчанию отключен в предварительной версии. Служба IO Cache доступна в кластерах Azure HDInsight 3.6 и более поздних версий с Apache Spark 2.3.  Чтобы активировать кэш IO на HDInsight 4.0, сделайте следующие шаги:

1. Из веб-браузера, `https://CLUSTERNAME.azurehdinsight.net`перейдите к , где `CLUSTERNAME` имя вашего кластера.

1. Выберите службу **IO Cache** в левой части страницы.

1. Выберите **действия** **(Действия службы** в ИРЧП 3.6) и **активируйте.**

    ![Включение службы IO Cache в Амбари](./media/apache-spark-improve-performance-iocache/ambariui-enable-iocache.png "Включение службы IO Cache в Амбари")

1. Подтвердите перезапуск всех затрагиваемых служб в кластере.

> [!NOTE]  
> Несмотря на значение индикатора выполнения, фактически IO Cache активируется только после перезапуска всех затрагиваемых служб.

## <a name="troubleshooting"></a>Устранение неполадок
  
После включения IO Cache при выполнении заданий Spark могут возникать ошибки отсутствия места на диске. Эти ошибки связаны с тем, что Spark также использует место на локальном диске для хранения данных во время операций перетасовки. Может случиться так, что после включения IO Cache на твердотельном накопителе закончится свободное место для Spark. По умолчанию IO Cache использует половину от общего объема твердотельного накопителя. В Ambari можно настроить параметры использования места на диске для IO Cache. Если вы столкнетесь с ошибками отсутствия места на диске, сократите объем памяти на твердотельном накопителе, используемый для IO Cache, и перезапустите службу. Чтобы изменить настройки пространства для IO Cache, выполните следующие действия:

1. В Apache Ambari выберите службу **HDFS** слева.

1. Выберите вкладки **Configs** (Конфигурации) и **Advanced** (Дополнительно).

    ![Оторитите расширенную конфигурацию HDFS](./media/apache-spark-improve-performance-iocache/ambariui-hdfs-service-configs-advanced.png "Оторитите расширенную конфигурацию HDFS")

1. Прокрутите вниз и разверните область **Custom core-site** (Пользовательский основной сайт).

1. Найдите свойство **hadoop.cache.data.fullness.percentage**.

1. Измените значение в этом поле.

    ![Изменение IO кэш апотой полноты Процент](./media/apache-spark-improve-performance-iocache/ambariui-cache-data-fullness-percentage-property.png "Изменение IO кэш апотой полноты Процент")

1. Выберите **Сохранить** в правом верхнем углу.

1. Выберите **перезагрузку** > **перезагрузки всех пострадавших.**

    ![Apache Ambari перезапускает все пострадавших](./media/apache-spark-improve-performance-iocache/ambariui-restart-all-affected.png "Перезагрузить все затронутые")

1. Выберите **Подтвердить Перезагрузить все**.

Если это не работает, отогнайте IO Cache.

## <a name="next-steps"></a>Next Steps

Дополнительная информация об IO Cache, в том числе о сравнительных тестах производительности, приведена в [этой записи блога](https://azure.microsoft.com/blog/apache-spark-speedup-with-hdinsight-io-cache/)
