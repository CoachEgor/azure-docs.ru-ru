---
title: Архитектура виртуальной сети Azure HDInsight
description: Сведения о ресурсах, доступных при создании кластера HDInsight в виртуальной сети Azure.
author: hrasheed-msft
ms.author: hrasheed
ms.reviewer: jasonh
ms.service: hdinsight
ms.topic: conceptual
ms.date: 10/31/2019
ms.openlocfilehash: b3f622b360f565ef5b16d5376cb1aa2498655017
ms.sourcegitcommit: 509b39e73b5cbf670c8d231b4af1e6cfafa82e5a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2020
ms.locfileid: "78389824"
---
# <a name="azure-hdinsight-virtual-network-architecture"></a>Архитектура виртуальной сети Azure HDInsight

В этой статье объясняются ресурсы, которые имеются при развертывании кластера HDInsight в настраиваемой виртуальной сети Azure. Эта информация поможет вам подключить локальные ресурсы к кластеру HDInsight в Azure. Дополнительные сведения о виртуальных сетях Azure см. в статье [что такое виртуальная сеть Azure?](../virtual-network/virtual-networks-overview.md).

## <a name="resource-types-in-azure-hdinsight-clusters"></a>Типы ресурсов в кластерах Azure HDInsight

Кластеры Azure HDInsight имеют различные типы виртуальных машин или узлов. Каждый тип узла играет роль в работе системы. В следующей таблице перечислены типы узлов и их роли в кластере.

| Тип | Описание |
| --- | --- |
| Головной узел |  Для всех типов кластеров, кроме Apache Storm, головные узлы размещают процессы, управляющие выполнением распределенного приложения. Головной узел — это также узел, который можно использовать для подключения по протоколу SSH и выполнения приложений, которые затем согласовываются в ресурсах кластера. Количество головных узлов фиксировано по два для всех типов кластера. |
| Узел ZooKeeper | Zookeeper координирует задачи между узлами, выполняющими обработку данных. Он также выдает ведущие выборы головного узла и отслеживает, какой головной узел выполняет определенную главную службу. Число узлов ZooKeeper фиксировано 3. |
| Рабочий узел | Представляет узлы, поддерживающие функции обработки данных. Рабочие узлы можно добавлять в кластер или удалять из кластера, чтобы масштабировать вычислительные возможности и управлять затратами. |
| Граничные узлы R Server | Пограничным узлом R Server является узел, который можно использовать для подключения по протоколу SSH и выполнения приложений, которые затем согласовываются для выполнения в ресурсах кластера. Граничные узлы не участвуют в анализе данных в кластере. Этот узел также содержит R Studio Server, что позволяет запускать приложение R с помощью браузера. |
| Узел региона | Для типа кластера HBase узел региона (также называемый узлом данных) запускает сервер регионов. Региональные серверы обслуживают и управляют частью данных, управляемых HBase. Узлы регионов можно добавлять в кластер или удалять из него, чтобы масштабировать вычислительные возможности и управлять затратами.|
| Узел Nimbus | Для типа кластера Nimbus узел предоставляет функциональные возможности, аналогичные головному узлу. Узел Nimbus назначает задачи другим узлам в кластере через Zookeeper, который координирует выполнение топологий. |
| Узел супервизора | Для типа кластера с различными типами узел супервизора выполняет инструкции, предоставленные узлом Nimbus для выполнения требуемой обработки. |

## <a name="resource-naming-conventions"></a>Соглашения об именовании ресурсов

При адресации узлов в кластере следует использовать полные доменные имена (FQDN). Полные доменные имена для различных типов узлов в кластере можно получить с помощью [API Ambari](hdinsight-hadoop-manage-ambari-rest-api.md). 

Эти полные доменные имена будут иметь форму `<node-type-prefix><instance-number>-<abbreviated-clustername>.<unique-identifier>.cx.internal.cloudapp.net`.

`<node-type-prefix>` будет *HN* для головных узлах, *WN* для рабочих узлов и *ЗН* для Zookeeper узлов.

Если требуется только имя узла, используйте только первую часть полного доменного имени: `<node-type-prefix><instance-number>-<abbreviated-clustername>`

## <a name="basic-virtual-network-resources"></a>Основные ресурсы виртуальной сети

На следующей схеме показано размещение узлов HDInsight и сетевых ресурсов в Azure.

![Схема сущностей HDInsight, созданных в настраиваемой виртуальной сети Azure](./media/hdinsight-virtual-network-architecture/hdinsight-vnet-diagram.png)

Ресурсы по умолчанию, используемые при развертывании HDInsight в виртуальной сети Azure, включают в себя типы узлов кластера, упомянутые в предыдущей таблице, а также сетевые устройства, поддерживающие взаимодействие между виртуальной сетью и внешними сетями.

В следующей таблице перечислены девять узлов кластера, которые создаются при развертывании HDInsight в настраиваемой виртуальной сети Azure.

| Тип ресурса | Номер представлен | Подробности |
| --- | --- | --- |
|Головной узел | two |    |
|Узел ZooKeeper | three | |
|Рабочий узел | two | Это число может изменяться в зависимости от конфигурации кластера и масштабирования. Для Apache Kafka требуется не менее трех рабочих узлов.  |
|Узел шлюза | two | Узлы шлюза — это виртуальные машины Azure, созданные в Azure, но не отображаемые в вашей подписке. Если необходимо перезагрузить эти узлы, обратитесь в службу поддержки. |

В виртуальной сети, используемой в HDInsight, автоматически создаются следующие сетевые ресурсы:

| Сетевой ресурс | Номер представлен | Подробности |
| --- | --- | --- |
|Подсистема балансировки нагрузки | three | |
|Интерфейсы сети | девять | Это значение основано на стандартном кластере, где каждый узел имеет собственный сетевой интерфейс. Девять интерфейсов предназначены для двух головных узлов, трех узлов Zookeeper, двух рабочих узлов и двух узлов шлюза, упомянутых в предыдущей таблице. |
|Общедоступные IP-адреса | two |    |

## <a name="endpoints-for-connecting-to-hdinsight"></a>Конечные точки для подключения к HDInsight

Доступ к кластеру HDInsight можно получить тремя способами:

- Конечная точка HTTPS за пределами виртуальной сети в `CLUSTERNAME.azurehdinsight.net`.
- Конечная точка SSH для прямого подключения к головного узла на `CLUSTERNAME-ssh.azurehdinsight.net`.
- Конечная точка HTTPS в виртуальной сети `CLUSTERNAME-int.azurehdinsight.net`. Обратите внимание на "-int" в этом URL-адресе. Эта конечная точка будет разрешаться в частный IP-адрес в этой виртуальной сети и недоступна из общедоступного Интернета.

Каждому из этих трех конечных точек назначается балансировщик нагрузки.

Общедоступные IP-адреса также предоставляются для двух конечных точек, которые разрешают подключение извне виртуальной сети.

1. Один общедоступный IP-адрес назначается подсистеме балансировки нагрузки для полного доменного имени (FQDN), используемого при подключении к кластеру из `CLUSTERNAME.azurehdinsight.net`Интернета.
1. Второй общедоступный IP-адрес используется только для имени домена, используемого только SSH `CLUSTERNAME-ssh.azurehdinsight.net`.

## <a name="next-steps"></a>Следующие шаги

- [Защита входящего трафика в кластерах HDInsight в виртуальной сети с помощью частной конечной точки](https://azure.microsoft.com/blog/secure-incoming-traffic-to-hdinsight-clusters-in-a-vnet-with-private-endpoint/)
