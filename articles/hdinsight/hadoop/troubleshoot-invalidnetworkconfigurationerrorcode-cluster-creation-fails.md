---
title: Ошибка InvalidNetworkConfigurationErrorCode — Azure HDInsight
description: Различные причины неудачного создания кластера с помощью InvalidNetworkConfigurationErrorCode в Azure HDInsight
ms.service: hdinsight
ms.topic: troubleshooting
author: hrasheed-msft
ms.author: hrasheed
ms.reviewer: jasonh
ms.date: 08/05/2019
ms.openlocfilehash: f857ee47f5dd8018d2e26aab47252533b0b17617
ms.sourcegitcommit: 8e9a6972196c5a752e9a0d021b715ca3b20a928f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/11/2020
ms.locfileid: "75887110"
---
# <a name="cluster-creation-fails-with-invalidnetworkconfigurationerrorcode-in-azure-hdinsight"></a>Сбой создания кластера с InvalidNetworkConfigurationErrorCode в Azure HDInsight

В этой статье описываются действия по устранению неполадок и возможные способы решения проблем при взаимодействии с кластерами Azure HDInsight.

Если отображается код ошибки `InvalidNetworkConfigurationErrorCode` с описанием "Конфигурация виртуальной сети несовместима с требованиями к HDInsight", обычно это указывает на проблему с [конфигурацией виртуальной сети](../hdinsight-plan-virtual-network-deployment.md) для кластера. В зависимости от оставшейся части описания ошибки следуйте приведенным ниже разделам, чтобы устранить проблему.

## <a name="hostname-resolution-failed"></a>"Сбой разрешения имени узла"

### <a name="issue"></a>Проблема

Описание ошибки содержит "сбой разрешения имени узла".

### <a name="cause"></a>Причина

Эта ошибка указывает на проблему с пользовательской конфигурацией DNS. DNS-серверы в виртуальной сети могут пересылать запросы DNS в рекурсивные арбитры конфликтов Azure для разрешения имен узлов в этой виртуальной сети (Дополнительные сведения см. [в разделе разрешение имен в виртуальных сетях](../../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md) ). Доступ к рекурсивным разрешителям Azure предоставляется через виртуальный IP-адрес 168.63.129.16. Этот IP-адрес доступен только на виртуальных машинах Azure. Поэтому он не будет работать при использовании локального DNS-сервера или если DNS-сервер является виртуальной машиной Azure, которая не является частью виртуальной сети кластера.

### <a name="resolution"></a>Разрешение

1. Подключитесь по протоколу SSH к виртуальной машине, входящей в состав кластера, и выполните команду `hostname -f`. Это приведет к возврату полного доменного имени узла (в приведенных ниже инструкциях это называется `<host_fqdn>`).

1. Затем выполните команду `nslookup <host_fqdn>` (например, `nslookup hn1-hditest.5h6lujo4xvoe1kprq3azvzmwsd.hx.internal.cloudapp.net`). Если эта команда разрешает имя в IP-адрес, это означает, что DNS-сервер работает правильно. В этом случае создайте обращение в службу поддержки HDInsight, и мы оббудем исследование проблемы. В ваш вариант поддержки включите действия по устранению неполадок, которые вы выполнили. Это поможет нам быстрее устранить проблему.

1. Если приведенная выше команда не возвращает IP-адрес, запустите `nslookup <host_fqdn> 168.63.129.16` (например, `nslookup hn1-hditest.5h6lujo4xvoe1kprq3azvzmwsd.hx.internal.cloudapp.net 168.63.129.16`). Если эта команда может разрешить IP-адрес, это означает, что DNS-сервер не перенаправляет запрос в DNS Azure или не является виртуальной машиной, входящей в ту же виртуальную сеть, что и кластер.

1. Если у вас нет виртуальной машины Azure, которая может использоваться в качестве пользовательского DNS-сервера в виртуальной сети кластера, необходимо сначала добавить это. Создайте виртуальную машину в виртуальной сети, которая будет настроена в качестве DNS-сервера пересылки.

1. После развертывания виртуальной машины в виртуальной сети настройте правила пересылки DNS на этой виртуальной машине. Перешлите все запросы на разрешение имени iDNS в 168.63.129.16, а остальные — на ваш DNS-сервер. [Ниже](../hdinsight-plan-virtual-network-deployment.md) приведен пример такой настройки для пользовательского DNS-сервера.

1. Добавьте IP-адрес этой виртуальной машины в качестве первой записи DNS для конфигурации DNS виртуальной сети.

---

## <a name="failed-to-connect-to-azure-storage-account"></a>"Не удалось подключиться к учетной записи хранения Azure"

### <a name="issue"></a>Проблема

Описание ошибки содержит сообщение "не удалось подключиться к учетной записи хранения Azure" или "не удалось подключиться к Azure SQL".

### <a name="cause"></a>Причина

Служба хранилища Azure и SQL не имеют фиксированных IP-адресов, поэтому для доступа к этим службам необходимо разрешить исходящие подключения ко всем IP-адресам. Точные действия по устранению зависят от того, настроена ли группа безопасности сети (NSG) или определяемые пользователем правила (UDR). Дополнительные сведения об этих конфигурациях см. в разделе [Управление сетевым трафиком с помощью HDInsight с группами безопасности сети и определяемыми пользователем маршрутами](../hdinsight-plan-virtual-network-deployment.md#hdinsight-ip) .

### <a name="resolution"></a>Разрешение

* Если кластер использует [группу безопасности сети (NSG)](../../virtual-network/virtual-network-vnet-plan-design-arm.md).

    Перейдите в портал Azure и найдите NSG, связанный с подсетью, в которой развертывается кластер. В разделе **правила безопасности для исходящего трафика** разрешите исходящий доступ к Интернету без ограничений (Обратите внимание, что номер меньшего **приоритета** здесь означает более высокий приоритет). Кроме того, в разделе **подсети** подтвердите, применен ли этот NSG к подсети кластера.

* Если кластер использует [определяемые пользователем маршруты (UDR)](../../virtual-network/virtual-networks-udr-overview.md).

    Перейдите к портал Azure и найдите таблицу маршрутов, связанную с подсетью, в которой развертывается кластер. Найдя таблицу маршрутов для подсети, просмотрите раздел **Routes (маршруты** ).

    Если определены маршруты, убедитесь, что существуют маршруты для IP-адресов для региона, в котором развернут кластер, а **NextHopType** для каждого маршрута — в **Интернете**. Для каждого обязательного IP-адреса, описанного в упомянутой выше статье, должен быть определен маршрут.

---

### <a name="next-steps"></a>Дальнейшие действия

Если вы не видите своего варианта проблемы или вам не удается ее устранить, дополнительные сведения можно получить, посетив один из следующих каналов.

* Получите ответы от экспертов Azure через [службу поддержки сообщества Azure](https://azure.microsoft.com/support/community/).

* Подключайтесь с [@AzureSupport](https://twitter.com/azuresupport) — официальная учетная запись Microsoft Azure для улучшения качества обслуживания клиентов путем подключения сообщества Azure к нужным ресурсам: ответы, поддержка и эксперты.

* Если вам нужна дополнительная помощь, можно отправить запрос в службу поддержки из [портал Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade/). Выберите пункт **Поддержка** в строке меню или откройте центр **справки и поддержки** . Дополнительные сведения см. [в](https://docs.microsoft.com/azure/azure-portal/supportability/how-to-create-azure-support-request)этой службе. Доступ к управлению подписками и поддержкой выставления счетов включен в вашу подписку Microsoft Azure, а техническая поддержка предоставляется через один из [планов поддержки Azure](https://azure.microsoft.com/support/plans/).
