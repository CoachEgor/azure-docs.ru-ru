---
title: Использование внешних хранилищ метаданных в Azure HDInsight
description: Используйте внешние хранилища метаданных с кластерами Azure HDInsight.
author: hrasheed-msft
ms.author: hrasheed
ms.reviewer: jasonh
ms.service: hdinsight
ms.topic: conceptual
ms.custom: hdinsightactive
ms.date: 04/03/2020
ms.openlocfilehash: e53164d1e25f8a8d0a14d21c0544d95cf912fe9f
ms.sourcegitcommit: 7e04a51363de29322de08d2c5024d97506937a60
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81313971"
---
# <a name="use-external-metadata-stores-in-azure-hdinsight"></a>Использование внешних хранилищ метаданных в Azure HDInsight

HDInsight позволяет управлять своими данными и метаданными с помощью внешних хранилив данных. Эта функция доступна для [МетамаркетА Apache Hive,](#custom-metastore) [метамагазина Apache Oozie](#apache-oozie-metastore)и [базы данных Apache Ambari.](#custom-ambari-db)

Хранилище метаданных Apache Hive в HDInsight является важной частью архитектуры Apache Hadoop. Метамагазин является центральным хранилищем схем. Метамагазин используется другими инструментами доступа к большим данным, такими как Apache Spark, Интерактивный запрос (LLAP), Presto или Apache Pig. HDInsight использует базу данных SQL Azure в качестве хранилища метаданных Hive.

![Архитектура хранилища метаданных Hive HDInsight](./media/hdinsight-use-external-metadata-stores/metadata-store-architecture.png)

Есть два способа настроить хранилище метаданных для кластеров HDInsight:

* [Хранилище метаданных по умолчанию](#default-metastore).
* [Пользовательское хранилище метаданных](#custom-metastore)

## <a name="default-metastore"></a>Хранилище метаданных по умолчанию

По умолчанию HDInsight создает хранилище метаданных с каждым типом кластера. Вместо этого можно указать пользовательское хранилище метаданных. При использовании хранилища метаданных по умолчанию учитывайте следующее:

* Дополнительные затраты не требуются. HDInsight создает хранилище метаданных с каждым типом кластера без дополнительных затрат с вашей стороны.

* Каждое хранилище метаданных по умолчанию является частью жизненного цикла кластера. При удалении кластера соответствующее хранилище метаданных и метаданные также удаляются.

* Нельзя делиться метамагазином по умолчанию с другими кластерами.

* Хранилище метаданных по умолчанию использует стандартную базу данных SQL Azure с ограничением в пять DTU (единица транзакций базы данных).
Этот метамагазин по умолчанию обычно используется для относительно простых рабочих нагрузок. Рабочие нагрузки, не требующие нескольких кластеров и не требующие сохранения метаданных за пределами жизненного цикла кластера.

## <a name="custom-metastore"></a>Пользовательское хранилище метаданных

HDInsight также поддерживает пользовательские хранилища метаданных, которые рекомендуется использовать для кластеров в рабочей среде:

* В качестве хранилища метаданных указывается собственная база данных SQL Azure.

* Жизненный цикл метамагазина не привязан к жизненному циклу кластеров, поэтому можно создавать и удалять кластеры без потери метаданных. Метаданные, такие как схемы Hive, сохраняются даже после удаления и повторного создания кластера HDInsight.

* Пользовательское хранилище метаданных позволяет присоединять к этому хранилищу метаданных кластеры различных типов. Например, одно хранилище метаданных может совместно использоваться в кластерах Interactive Query, Hive и Hive в HDInsight.

* Вы оплачиваете стоимость хранилища метаданных (База данных SQL Azure) в соответствии с выбранным уровнем производительности.

* При необходимости хранилище метаданных можно масштабировать.

* Кластер и внешний метамагазин должны размещаться в одном регионе.

![Вариант использования хранилища метаданных Hive HDInsight](./media/hdinsight-use-external-metadata-stores/metadata-store-use-case.png)

### <a name="create-and-config-azure-sql-database-for-the-custom-metastore"></a>Создание и конфигурация базы данных Azure S'L для пользовательского метамагазина

Создайте или увасите существующую базу данных Azure S'L, прежде чем создавать пользовательский метамагазин Hive для кластера HDInsight.  Для получения дополнительной информации [см.](https://docs.microsoft.com/azure/sql-database/sql-database-single-database-get-started?tabs=azure-portal)

При создании кластера служба HDInsight должна подключаться к внешнему метамагазину и проверять учетные данные. Навлажь правила брандмауэра базы данных Azure S'L Database, чтобы позволить службам и ресурсам Azure получить доступ к серверу. Включите эту опцию на портале Azure, выбрав **брандмауэр Set server.** Затем выберите **No** Underneath **Deny общедоступный доступ к сети,** а **«Да»** под **allow Azure службы и ресурсы для доступа к этому серверу** для сервера или базы данных базы данных Azure S'L. Для получения дополнительной информации [см.](https://docs.microsoft.com/azure/sql-database/sql-database-firewall-configure#use-the-azure-portal-to-manage-server-level-ip-firewall-rules)

![установить кнопку брандмауэра сервера](./media/hdinsight-use-external-metadata-stores/configure-azure-sql-database-firewall1.png)

![предоставить доступ к лазурным службам](./media/hdinsight-use-external-metadata-stores/configure-azure-sql-database-firewall2.png)

### <a name="select-a-custom-metastore-during-cluster-creation"></a>Выбор пользовательского хранилища метаданных во время создания кластера

Вы можете в любое время указать кластер на ранее созданную базу данных Azure S'L. Для создания кластера через портал, опция указана из **настройки хранения > Metastore.**

![Хранилище метаданных Hive HDInsight на портале Azure](./media/hdinsight-use-external-metadata-stores/azure-portal-cluster-storage-metastore.png)

## <a name="hive-metastore-guidelines"></a>Инструкции по метамагазину Hive

* По возможности используйте пользовательское хранилище метаданных, так как это поможет разделить вычислительные ресурсы в выполняемом кластере и метаданные из хранилища метаданных.

* Начните с уровня S2, предоставляющего 50 DTU и хранилище размером 250 ГБ. Если вы видите узкое место, можно увеличить масштаб базы данных.

* Если требуется несколько кластеров HDInsight для доступа к отдельным данным, используйте отдельную базу данных для хранилища метаданных для каждого кластера. Если хранилище метаданных используется совместно в нескольких кластерах HDInsight, это означает, что кластеры используют одинаковые метаданные и базовые файлы данных пользователей.

* Периодически архивируйте пользовательское хранилище метаданных. База данных SQL Azure автоматически создает резервные копии, но период их хранения различается. Дополнительные сведения см. в статье [Подробнее об автоматическом резервном копировании базы данных SQL](../sql-database/sql-database-automated-backups.md).

* Найдите свой кластер metastore и HDInsight в одном регионе. Эта конфигурация обеспечит самую высокую производительность и самые низкие сборы за выход из сети.

* Мониторинг метамагазина для повышения производительности и доступности с помощью инструментов мониторинга баз данных Azure S'L или журналов Azure Monitor.

* Когда новая, более высокая версия Azure HDInsight создается на базе данных пользовательского метамагазина, система обновляет схему метамагазина. Обновление необратимо без восстановления базы данных из резервного копирования.

* Если вы совместно используете хранилище метаданных в нескольких кластерах, убедитесь, что все кластеры имеют одну и ту же версию HDInsight. Различные версии Hive используют разные версии базы данных хранилища метаданных. Например, нельзя делиться метамагазином в кластерах версий Hive 2.1 и Hive 3.1.

* В HDInsight 4.0 Spark и Hive используют независимые каталоги для доступа к таблицам SparkS'L или Hive. Таблица, созданная Spark, обитает в каталоге Spark. Таблица, созданная Hive, обитает в каталоге Hive. Такое поведение отличается от HDInsight 3.6, где Hive и Spark имеют общий каталог. Интеграция Hive и Spark в HDInsight 4.0 опирается на хиу-складский разъем (HWC). HWC работает как мост между Spark и Hive. [Узнайте больше о хиле Склад разъем](../hdinsight/interactive-query/apache-hive-warehouse-connector.md).

## <a name="apache-oozie-metastore"></a>Метамагазин Apache Oozie

Apache Oozie — это система координации рабочих процессов, которая управляет заданиями Hadoop. Эта система поддерживает задания Hadoop для Apache MapReduce, Pig, Hive и т. д.  Oozie использует метамагазин для хранения сведений о рабочих процессах. Для повышения производительности Oozie можно использовать Базу данных SQL Azure в качестве хранилища метаданных. Метамагазин предоставляет доступ к данным о работе Oozie после удаления кластера.

Дополнительные инструкции по созданию хранилища метаданных Oozie с базой данных SQL Azure см. в статье [Использование Oozie с Hadoop для определения и запуска рабочих процессов в Azure HDInsight под управлением Linux](hdinsight-use-oozie-linux-mac.md).

## <a name="custom-ambari-db"></a>Пользовательская база данных Ambari DB

Чтобы использовать свою собственную внешнюю базу данных с Apache Ambari на HDInsight, [см.](hdinsight-custom-ambari-db.md)

## <a name="next-steps"></a>Следующие шаги

* [Установка кластеров в HDInsight с использованием Apache Hadoop, Apache Spark, Apache Kafka и других технологий](./hdinsight-hadoop-provision-linux-clusters.md)
