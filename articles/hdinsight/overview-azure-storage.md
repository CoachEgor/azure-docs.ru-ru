---
title: Обзор хранения azure в HDInsight
description: Обзор хранилища Azure в HDInsight.
author: hrasheed-msft
ms.author: hrasheed
ms.reviewer: jasonh
ms.service: hdinsight
ms.topic: conceptual
ms.date: 04/21/2020
ms.openlocfilehash: 43d948a2a98407bacc212ddc6e065c67a105f332
ms.sourcegitcommit: af1cbaaa4f0faa53f91fbde4d6009ffb7662f7eb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/22/2020
ms.locfileid: "81873385"
---
# <a name="azure-storage-overview-in-hdinsight"></a>Обзор хранения azure в HDInsight

Служба хранилища Azure — это надежное, универсальное решение, которое полностью интегрируется с HDInsight. HDInsight может использовать контейнер больших двоичных объектов в службе хранилища Azure в качестве файловой системы по умолчанию для кластера. С помощью интерфейса HDFS все компоненты HDInsight могут напрямую взаимодействовать со структурированными или неструктурированными данными, хранящимися как большие двоичные объекты.

Мы рекомендуем использовать отдельные контейнеры для хранения кластеров по умолчанию и бизнес-данных. Разделение заключается в изоляции журналов HDInsight и временных файлов от ваших собственных бизнес-данных. Мы также рекомендуем удалять контейнер blob по умолчанию, который содержит журналы приложений и системы, после каждого использования для снижения затрат на хранение. Обязательно извлеките эти журналы перед удалением контейнера.

Если вы решите обезопасить свою учетную запись хранения с помощью **брандмауэров и** ограничений виртуальных сетей в **выбранных сетях,** не забудьте включить исключение **Разрешить доверенные службы Microsoft ...**. Исключением является то, что HDInsight может получить доступ к вашей учетной записи хранения.

## <a name="hdinsight-storage-architecture"></a>Архитектура хранилища HDInsight

Следующая схема является абстрактным представлением архитектуры HDInsight службы хранилища Azure:

!['HDInsight Хранения Архитектура'](./media/overview-azure-storage/storage-architecture.png "Архитектура хранения данных HDInsight")

HDInsight предоставляет доступ к распределенной файловой системе, которая локально присоединена к вычислительным узлам. Доступ к этой файловой системе может осуществляться с использованием полного универсального кода ресурса (URI), например:

    hdfs://<namenodehost>/<path>

С помощью HDInsight вы также можете получить доступ к данным в Хранилище Azure. Синтаксис:

    wasb://<containername>@<accountname>.blob.core.windows.net/<path>

Рассмотрите некоторые рекомендации для использования учетной записи хранения Azure с кластерами HDInsight.

* **Контейнеры в учетных записях хранения, подключенные к кластеру.** Поскольку имя учетной записи и ключ связываются с кластером во время создания, вы получаете полный доступ к BLOB-объектам в этих контейнерах.

* **Общедоступные контейнеры или общедоступные капли в учетных записях хранения, не подключенные к кластеру:** Вы только читать разрешение на капли в контейнерах.
  
  > [!NOTE]  
  > Общедоступные контейнеры позволяют получить список всех доступных в этом контейнере больших двоичных объектов, а также метаданные контейнера. Общедоступные BLOB-объекты позволяют получить доступ к BLOB-объектам только при условии, что вам известен точный URL-адрес. Дополнительные сведения см. в статье [Управление анонимным доступом на чтение к контейнерам и большим двоичным объектам](../storage/blobs/storage-manage-access-to-resources.md).

* **Частные контейнеры в учетных записях хранения, не подключенные к кластеру:** Вы не можете получить доступ к каплям в контейнерах, если вы не определите учетную запись хранения при отправке заданий WebHCat.

Определенные на этапе создания учетные записи хранения и их ключи хранятся в файле %HADOOP_HOME%/conf/core-site.xml на узлах кластера. По умолчанию HDInsight будет использовать учетные записи хранения, определенные в файле core-site.xml. Этот параметр можно изменить с помощью [Apache Ambari](./hdinsight-hadoop-manage-ambari.md).

Несколько заданий WebHCat, включая Apache Hive. И MapReduce, Apache Hadoop потокового, и Apache Свинья, нести описание хранения счетов и метаданных. (Этот аспект в настоящее время верно для Свиньи с учетными записями хранения, но не для метаданных.) Для получения дополнительной информации [см.](https://social.technet.microsoft.com/wiki/contents/articles/23256.using-an-hdinsight-cluster-with-alternate-storage-accounts-and-metastores.aspx)

Большие двоичные объекты могут использоваться для хранения как структурированных, так и неструктурированных данных. В контейнерах больших двоичных объектов данные хранятся в виде пар "ключ — значение" и отсутствует иерархия каталогов. Тем не менее, в имени ключа может использоваться знак косой черты "/", чтобы оно выглядело так, будто файл хранится в структуре каталогов. Например, ключ большого двоичного объекта может выглядеть следующим образом: `input/log1.txt`. Фактического каталога `input` не существует, но из-за косой черты в имени ключа, ключ выглядит как путь к файлу.

## <a name="benefits-of-azure-storage"></a>Преимущества службы хранилища Azure

Вычислительные кластеры и ресурсы хранилища, которые не являются совместно размещенными, подразумевают затраты производительности. Эти затраты компенсируются благодаря созданию вычислительных кластеров близко к ресурсам учетной записи хранения в регионе Azure. В этом регионе эти вычислительные узлы могут получать эффективный доступ к данным по высокоскоростной сети в службе хранилища Azure.

При хранении данных в службе хранилища Azure вместо HDFS вы получаете ряд преимуществ:

* **Повторное использование данных и общий доступ к данным.** Данные в файловой системе HDFS расположены внутри вычислительного кластера. Только приложения, имеющие доступ к вычислительному кластеру, могут использовать данные через API HDFS. Доступ к данным в службе хранилища Azure, напротив, может осуществляться через API HDFS или через REST API хранилища BLOB-объектов. Из за этого для создания и использования данных можно применять больший набор приложений (включая другие кластеры HDInsight) и средств.

* **Архивирование данных:** При хранении данных в Хранилище Azure кластеры HDInsight, используемые для вычислений, можно безопасно удалять без потери пользовательских данных.

* **Стоимость хранения данных:** Хранение данных в DFS в долгосрочной перспективе обходится дороже, чем хранение данных в Azure Storage. Поскольку стоимость вычислительного кластера выше, чем стоимость хранилища Azure. Кроме того, так как данные не требуется повторно загружать при создании каждого вычислительного кластера, вы экономите также на загрузке данных.

* **Гибкое масштабирование.** Хотя HDFS и представляет собой масштабируемую файловую систему, масштаб определяется количеством узлов, создаваемых для кластера. Изменение шкалы может быть более сложным, чем возможности эластичного масштабирования, которые вы получаете автоматически в Хранилище Azure.

* **Георепликация:** Хранилище Azure можно гео-реплицировать. Хотя это обеспечивает возможность географического восстановления и избыточность данных, переход в расположение геореплицированных данных при отработке отказа заметно влияет на производительность, что может привести к дополнительным затратам. Поэтому мы рекомендуем взвешенно подходить к использованию георепликации, применяя ее, только когда стоимость данных окупает дополнительные затраты.

Определенные задания и пакеты MapReduce могут создавать промежуточные результаты, которые нет нужды хранить в службе хранилища Azure. В таком случае можно выбрать хранение данных в локальной системе HDFS. HDInsight использует DFS для некоторых таких промежуточных результатов в заданиях Hive и других процессах.

> [!NOTE]  
> Большинство команд HDFS (например, `ls`, `copyFromLocal` и `mkdir`) работают правильно в службе хранилища Azure. В службе хранилища Azure будет отличаться поведение только тех команд, которые относятся к стандартной реализации HDFS (под названием DFS), например `fschk` и `dfsadmin`.

## <a name="next-steps"></a>Дальнейшие действия

* [Общие сведения о хранилище Azure Data Lake Storage Gen2 (предварительная версия)](../storage/blobs/data-lake-storage-introduction.md)
* [Введение в хранилище Azure](../storage/common/storage-introduction.md)
* [Обзор данных Azure Data Lake Data Gen1](./overview-data-lake-storage-gen1.md)