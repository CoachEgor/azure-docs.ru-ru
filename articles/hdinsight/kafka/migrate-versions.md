---
title: Перенос рабочих нагрузок Apache Kafka в Azure HDInsight 4.0
description: Узнайте, как перенести рабочие нагрузки Apache Kafka на HDInsight 3.6 в HDInsight 4.0.
author: hrasheed-msft
ms.author: hrasheed
ms.reviewer: jasonh
ms.service: hdinsight
ms.topic: conceptual
ms.date: 12/18/2019
ms.openlocfilehash: 0a31c6cf32222277e033aacf7d04622c54aef9ea
ms.sourcegitcommit: ced98c83ed25ad2062cc95bab3a666b99b92db58
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/31/2020
ms.locfileid: "80437015"
---
# <a name="migrate-apache-kafka-workloads-to-azure-hdinsight-40"></a>Перенос рабочих нагрузок Apache Kafka в Azure HDInsight 4.0

Azure HDInsight 4.0 предлагает новейшие компоненты с открытым исходным кодом со значительными улучшениями в производительности, подключении и безопасности. В этом документе объясняется, как мигрировать рабочие нагрузки Apache Kafka на HDInsight 3.6 в HDInsight 4.0. После переноса рабочих нагрузок в HDInsight 4.0 вы можете использовать многие новые функции, которые недоступны на HDInsight 3.6.

## <a name="hdinsight-36-kafka-migration-paths"></a>HDInsight 3.6 Пути миграции Кафки

HDInsight 3.6 поддерживает две версии Kafka: 1.0.0 и 1.1.0. HDInsight 4.0 поддерживает версии 1.1.0 и 2.1.0. В зависимости от того, какую версию Kafka и какую версию HDInsight вы хотели бы запустить, существует несколько поддерживаемых путей миграции. Эти пути объясняются ниже и проиллюстрированы на следующей диаграмме.

* **Запуск как Kafka и HDInsight на последних версиях (рекомендуется)**: Мигрировать HDInsight 3.6 и Кафка 1.0.0 или 1.1.0 приложение hdInsight 4.0 с Kafka 2.1.0 (пути D и E ниже).
* **Выполнить HDInsight на последней версии, но Кафка только на более поздней версии**: Мигрировать HDInsight 3.6 и Кафка 1.0.0 приложение для HDInsight 4.0 с Kafka 1.1.0 (путь B ниже).
* **Выполнить HDInsight на последней версии, сохранить версию Kafka**: Мигрировать HDInsight 3.6 и Кафка 1.1.0 приложение hdInsight 4.0 с Kafka 1.1.0 (путь C ниже).
* **Выполнить Kafka на более позднюю версию, сохранить версию HDInsight:** Мигрируйте приложение Kafka 1.0.0 до 1.1.0 и оставайтесь на HDInsight 3.6 (путь А ниже). Обратите внимание, что этот вариант по-прежнему потребует развертывания нового кластера. Обновление версии Kafka на существующем кластере не поддерживается. После создания кластера с нужной версией переносите клиентов Kafka для использования нового кластера.

![Маршруты обновления для Apache Kafka на 3.6](./media/upgrade-threesix-to-four/apache-kafka-upgrade-path.png)

## <a name="apache-kafka-versions"></a>Версии Apache Kafka

### <a name="kafka-110"></a>Кафка 1.1.0
  
Если вы мигрируете из Kafka 1.0.0 к 1.1.0, вы можете воспользоваться следующими новыми функциями:

* Улучшения контроллера Kafka ускоряют контролируемое отключение, так что вы можете перезапустить брокеров и быстрее восстановить сяочие. 
* Улучшения в [логике FetchRequests,](https://issues.apache.org/jira/browse/KAFKA-6254) которые позволяют иметь больше разделов (и, следовательно, больше тем) на кластере. 
* Kafka Connect поддерживает [заголовки регулировок](https://issues.apache.org/jira/browse/KAFKA-5142) и [регулярные выражения](https://issues.apache.org/jira/browse/KAFKA-3073) для тем. 

Полный список обновлений можно узнать в [примечаниях к выпуску Apache Kafka 1.1.](https://archive.apache.org/dist/kafka/1.1.0/RELEASE_NOTES.html)

### <a name="apache-kafka-210"></a>Апач Кафка 2.1.0

Если вы переноситесь на Kafka 2.1, вы можете воспользоваться следующими функциями:

* Улучшение устойчивости брокера благодаря улучшенному протоколу репликации.
* Новый функционал в API KafkaAdminClient.
* Настраиваемое управление квотами.
* Поддержка сжатия стандарта.

Для получения полного списка обновлений [см.](https://archive.apache.org/dist/kafka/2.0.0/RELEASE_NOTES.html) [Apache Kafka 2.1 release notes](https://archive.apache.org/dist/kafka/2.1.0/RELEASE_NOTES.html)

## <a name="kafka-client-compatibility"></a>Совместимость клиента Kafka

Новые брокеры Kafka поддерживают пожилых клиентов. [KIP-35 - Получение протокольной версии](https://cwiki.apache.org/confluence/display/KAFKA/KIP-35+-+Retrieving+protocol+version) ввело механизм динамического определения функциональности брокера Kafka и [KIP-97: Улучшенная политика совместимости клиентов Kafka Client RPC](https://cwiki.apache.org/confluence/display/KAFKA/KIP-97%3A+Improved+Kafka+Client+RPC+Compatibility+Policy) представила новую политику совместимости и гарантии для клиента Java. Ранее клиенту Kafka приходилось взаимодействовать с брокером той же версии или более новой версии. Теперь новые версии клиентов Java и других клиентов, `librdkafka` поддерживающих KIP-35, например, могут вернуться к старым типам запросов или выбросить соответствующие ошибки, если функциональность недоступна.

![Обновление совместимости клиентов Kafka](./media/upgrade-threesix-to-four/apache-kafka-client-compatibility.png)

Обратите внимание, что это не означает, что клиент поддерживает старых брокеров.  Для получения дополнительной информации [см.](https://cwiki.apache.org/confluence/display/KAFKA/Compatibility+Matrix)

## <a name="general-migration-process"></a>Общий миграционный процесс

Следующее руководство по миграции предполагает кластер Apache Kafka 1.0.0 или 1.1.0, развернутый на HDInsight 3.6 в одной виртуальной сети. Существующий брокер имеет некоторые темы и активно используется производителями и потребителями.

![Текущая среда Кафки предполагаемой](./media/upgrade-threesix-to-four/apache-kafka-presumed-environment.png)

Для завершения миграции сделайте следующие шаги:

1. **Развертывание нового кластера HDInsight 4.0 и клиентов для тестирования.** Развертывание нового кластера HDInsight 4.0 Kafka. Если можно выбрать несколько кластерных версий Kafka, рекомендуется выбрать последнюю версию. После развертывания установите некоторые параметры по мере необходимости и создайте тему с тем же именем, что и существующая среда. Кроме того, установите TLS и принесите шифрование собственного ключа (BYOK) по мере необходимости. Затем проверьте, правильно ли он работает с новым кластером.

    ![Развертывание новых кластеров HDInsight 4.0](./media/upgrade-threesix-to-four/deploy-new-hdinsight-clusters.png)

1. **Переключите кластер для приложения производителя и подождите, пока все данные очереди будут использованы текущими потребителями.** Когда новый кластер HDInsight 4.0 Kafka будет готов, переключите существующий пункт назначения производителя в новый кластер. Оставьте все как есть до тех пор, пока существующее приложение Consumer не поглотит все данные из существующего кластера.

    ![Кластер коммутатора для приложения производителя](./media/upgrade-threesix-to-four/switch-cluster-producer-app.png)

1. **Переключите кластер в потребительском приложении.** Подтвердив, что существующее приложение потребителя закончило расходовать все данные из существующего кластера, переключите соединение на новый кластер.

    ![Переключение кластера на потребительском приложении](./media/upgrade-threesix-to-four/switch-cluster-consumer-app.png)

1. **Удалите старый кластер и тестировать приложения по мере необходимости.** После того, как коммутатор будет завершен и работает должным образом, удалите старый кластер HDInsight 3.6 Kafka и производителей и потребителей, используемых в тесте по мере необходимости.

## <a name="next-steps"></a>Следующие шаги

* [Оптимизация производительности для кластеров Apache Kafka HDInsight](apache-kafka-performance-tuning.md)
* [Быстрый запуск: Создайте кластер Apache Kafka в Azure HDInsight с помощью портала Azure](apache-kafka-get-started.md)
