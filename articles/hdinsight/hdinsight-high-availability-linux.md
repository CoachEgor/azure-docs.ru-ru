---
title: Высокий уровень доступности для Hadoop в Azure HDInsight
description: Узнайте, как использование дополнительного головного узла позволяет повысить надежность и доступность кластеров HDInsight. Узнайте, как это влияет на службы Hadoop, такие как Ambari и Hive, и научитесь подключаться к каждому отдельному головному узлу с помощью SSH.
author: hrasheed-msft
ms.author: hrasheed
ms.reviewer: jasonh
keywords: Высокая доступность Hadoop
ms.service: hdinsight
ms.custom: hdinsightactive,hdiseo17may2017
ms.topic: conceptual
ms.date: 10/28/2019
ms.openlocfilehash: 8b914b8ffe995cf31f8a22b6f80250431facc770
ms.sourcegitcommit: 609d4bdb0467fd0af40e14a86eb40b9d03669ea1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/06/2019
ms.locfileid: "73682232"
---
# <a name="availability-and-reliability-of-apache-hadoop-clusters-in-hdinsight"></a>Доступность и надежность кластеров Apache Hadoop в HDInsight

В кластерах HDInsight предусмотрены два головных узла, повышающие доступность и надежность выполняемых служб и заданий Apache Hadoop.

Платформа Hadoop обеспечивает высокий уровень доступности и надежности, реплицируя службы и данные на нескольких узлах в кластере. Однако стандартные дистрибутивы Hadoop обычно имеют один головной узел. Любой сбой такого узла может вызвать прекращение работы кластера. HDInsight предоставляет два головных узла для повышения доступности и надежности Hadoop.

## <a name="availability-and-reliability-of-nodes"></a>Доступность и надежность узлов

Узлы в кластере HDInsight реализуются с помощью виртуальных машин Azure. В следующих разделах рассматриваются отдельные типы узлов, которые используются с HDInsight.

> [!NOTE]  
> Не все типы узлов используются для определенного типа кластера. Например, тип кластера Hadoop не содержит узлы Nimbus. Дополнительные сведения об узлах, используемых типами кластеров HDInsight, см. в разделе "Типы кластеров" статьи [Создание кластеров Hadoop в HDInsight](hdinsight-hadoop-provision-linux-clusters.md#cluster-types).

### <a name="head-nodes"></a>Головные узлы

Для обеспечения высокого уровня доступности службы Hadoop HDInsight предоставляет два головных узла. Оба головных узла активны и работают в кластере HDInsight одновременно. Некоторые службы, например Apache HDFS или Apache Hadoop YARN, в любой момент времени активны только на одном головном узле. Другие службы, например HiveServer2 или Hive MetaStore, активны одновременно на обоих головных узлах.

Головные узлы (и другие узлы в HDInsight) содержат в своем имени числовое значение. Например, `hn0-CLUSTERNAME` или `hn4-CLUSTERNAME`.

> [!IMPORTANT]  
> Не воспринимайте это числовое значение как обозначение приоритета узла (первичный или вторичный). Единственная функция этого значения — обеспечение уникальности имен для каждого узла.

### <a name="nimbus-nodes"></a>Узлы Nimbus

Узлы Nimbus доступны с кластерами Apache Storm. Узлы Nimbus предоставляют Hadoop JobTracker похожие функциональные возможности путем распределения и мониторинга обработки на рабочих узлах. HDInsight предоставляет два узла Nimbus для кластеров Storm.

### <a name="apache-zookeeper-nodes"></a>Узлы Apache Zookeeper

Узлы [ZooKeeper](https://zookeeper.apache.org/) используются для выбора лидера главных служб на головных узлах, Они также используются, чтобы убедиться, что службы, узлы данных (рабочие роли) и шлюзы узнают, на каком головном узле активна Главная служба. По умолчанию в кластере HDInsight предусмотрено три узла ZooKeeper.

### <a name="worker-nodes"></a>Рабочие узлы

Рабочие узлы выполняют анализ данных при отправке задания в кластер. Если происходит сбой рабочего узла, выполняемая задача отправляется на другой рабочий узел. По умолчанию HDInsight создает четыре рабочих узла. Вы можете изменить это количество по своему усмотрению как во время создания кластера, так и позднее.

### <a name="edge-node"></a>краевой узел

Граничные узлы не участвуют в анализе данных в кластере. Он используется разработчиками или специалистами по обработке и анализу данных при работе с Hadoop. Граничный узел находится в той же виртуальной сети Azure, что и другие узлы в кластере, и может получать непосредственный доступ ко всем остальным узлам. Его можно использовать без опасения отнять ресурсы у критически важных служб или заданий анализа Hadoop.

Сейчас службы машинного обучения в HDInsight являются единственным типом кластера, который по умолчанию предоставляет граничный узел. В службах машинного обучения в HDInsight граничный узел используется для локального тестирования кода R на узле перед его отправкой в кластер для распределенной обработки.

Сведения об использовании граничного узла с другими типами кластеров, см. в статье [Использование пустых граничных узлов в HDInsight](hdinsight-apps-use-edge-node.md).

## <a name="accessing-the-nodes"></a>Доступ к узлам

Доступ к кластеру из Интернета предоставляется через общедоступный шлюз. Доступ ограничен подключением к головным узлам и, если таковой существует, граничным узлом. Доступ к службам, работающим на головных узлах, не влияет на наличие нескольких головных узлов. Общедоступный шлюз просто направляет запросы к тому головному узлу, на котором размещается запрашиваемая служба. Например, если служба Apache Ambari размещена на вторичном головном узле, шлюз будет направлять на этот узел все входящие запросы к службе Ambari.

Доступ через общедоступный шлюз ограничен портами 443 (HTTPS), 22 и 23.

|Порт |Description (Описание) |
|---|---|
|443|Используется для доступа к Ambari и другим веб-ИНТЕРФЕЙСам или интерфейсам API RESTFUL, размещенным на головных узлах.|
|22|Используется для доступа к основному головному узлу или пограничному узлу с помощью SSH.|
|23|Используется для доступа к вторичному головному узлу с помощью SSH. Например, `ssh username@mycluster-ssh.azurehdinsight.net` подключается к основному головному узлу кластера с именем **mycluster**.|

Дополнительные сведения об использовании SSH см. в статье [Подключение к HDInsight (Hadoop) с помощью SSH](hdinsight-hadoop-linux-use-ssh-unix.md).

### <a name="internal-fully-qualified-domain-names-fqdn"></a>Внутренние полные доменные имена (FQDN)

Каждый узел в кластере HDInsight имеет внутренний IP-адрес и полное доменное имя, доступ к которым возможен только из этого кластера. При доступе к службам в кластере с помощью внутреннего FQDN или IP-адреса следует использовать Ambari для проверки IP-адреса или FQDN, которые будут использоваться для доступа к службе.

Например, служба Apache Oozie может выполняться только на одном головном узле, и при использовании команды `oozie` в сеансе SSH требуется URL-адрес службы. Этот адрес можно получить из Ambari с помощью следующей команды:

```bash
export password='PASSWORD'
export clusterName="CLUSTERNAME"

curl -u admin:$password "https://$clusterName.azurehdinsight.net/api/v1/clusters/$clusterName/configurations?type=oozie-site&tag=TOPOLOGY_RESOLVED" | grep oozie.base.url
```

Эта команда возвращает значение, аналогичное приведенному ниже, которое содержит внутренний URL-адрес для использования с командой `oozie`:

```output
"oozie.base.url": "http://hn0-CLUSTERNAME-randomcharacters.cx.internal.cloudapp.net:11000/oozie"
```

Дополнительные сведения о работе с REST API службы Ambari см. в статье [Управление кластерами HDInsight с помощью REST API Ambari](hdinsight-hadoop-manage-ambari-rest-api.md).

### <a name="accessing-other-node-types"></a>Доступ к узлам других типов

Подключиться к узлам, которые недоступны напрямую через Интернет, можно с помощью следующих методов.

|Метод |Description (Описание) |
|---|---|
|SSH|после подключения к головному узлу с помощью SSH можно затем использовать SSH с головного узла для подключения к другим узлам в кластере. Дополнительные сведения см. в статье [Подключение к HDInsight (Hadoop) с помощью SSH](hdinsight-hadoop-linux-use-ssh-unix.md).|
|Туннель SSH|Если необходимо получить доступ к веб-службе, размещенной на одном из узлов, которые не доступны в Интернете, необходимо использовать туннель SSH. Дополнительные сведения см. в статье [Использование туннелирования SSH для доступа к веб-интерфейсу Ambari, JobHistory, NameNode, Oozie и другим веб-интерфейсам](hdinsight-linux-ambari-ssh-tunnel.md).|
|Виртуальная сеть Azure|Если кластер HDInsight входит в состав виртуальной сети Azure, любой ресурс в той же виртуальной сети может напрямую получать доступ ко всем узлам в кластере. Дополнительные сведения см. в документе [планирование виртуальной сети для HDInsight](hdinsight-plan-virtual-network-deployment.md) .|

## <a name="how-to-check-on-a-service-status"></a>Проверка состояния службы

Состояние служб, работающих на головных узлах, можно проверить с помощью веб-интерфейса Ambari или REST API Ambari.

### <a name="ambari-web-ui"></a>Веб-интерфейс Ambari

Веб-интерфейс Ambari можно просмотреть по ссылке `https://CLUSTERNAME.azurehdinsight.net`. Замените **CLUSTERNAME** именем кластера. При появлении запроса введите учетные данные пользователя HTTP для кластера. По умолчанию используются имя пользователя HTTP **admin** и пароль, который вы ввели при создании кластера.

Открыв страницу Ambari, слева вы увидите список установленных служб.

![Установленные службы Apache Ambari](./media/hdinsight-high-availability-linux/hdinsight-installed-services.png)

Существует ряд значков, которые могут отображаться рядом со службой и указывать ее состояние. Все оповещения, связанные с той или иной службой, можно просмотреть, щелкнув ссылку **Оповещения** в верхней части страницы.  Ambari предлагает несколько предопределенных предупреждений.

Следующие оповещения помогают отслеживать доступность кластера.

| Имя оповещения                               | Description (Описание)                                                                                                                                                                                  |
|------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Состояние мониторинга метрики                    | Это предупреждение указывает состояние процесса монитора метрик, определяемое сценарием состояния монитора.                                                                                   |
| Пульс агента Ambari                   | Это оповещение активируется, если сервер потерял связь с агентом.                                                                                                                        |
| Серверный процесс ZooKeeper                 | Это оповещение на уровне узла активируется, если не удается определить серверный процесс ZooKeeper и прослушивать сеть.                                                               |
| Состояние сервера метаданных Иокаче           | Это оповещение на уровне узла активируется, если не удается определить сервер метаданных Иокаче и отреагировать на запросы клиентов.                                                            |
| Веб-интерфейс Жаурналноде                       | Это оповещение уровня узла активируется, если веб-интерфейс Жаурналноде недоступен.                                                                                                                 |
| Spark2 Thrift Server                     | Это оповещение уровня узла активируется, если не удается определить сервер Spark2 Thrift.                                                                                                |
| Процесс сервера журнала                   | Это оповещение на уровне узла активируется, если не удается установить процесс сервера журнала, чтобы он был запущен и прослушивается в сети.                                                                |
| Веб-интерфейс сервера журналов                    | Это оповещение уровня узла активируется, если веб-интерфейс сервера журнала недоступен.                                                                                                              |
| Веб-интерфейс `ResourceManager`                   | Это оповещение уровня узла активируется, если веб-интерфейс `ResourceManager` недоступен.                                                                                                             |
| Сводка по работоспособности NodeManager               | Это предупреждение уровня обслуживания активируется при наличии неработоспособных NodeManagers                                                                                                                    |
| Веб-интерфейс временной шкалы приложения                      | Это оповещение уровня узла активируется, если веб-интерфейс сервера временной шкалы приложения недоступен.                                                                                                         |
| Сводка по работоспособности узла                  | Это предупреждение уровня обслуживания активируется при наличии неработоспособных узлов с данным                                                                                                                       |
| Веб-интерфейс NameNode                          | Это оповещение уровня узла активируется, если веб-интерфейс NameNode недоступен.                                                                                                                    |
| Процесс отказоустойчивого контроллера ZooKeeper    | Это оповещение на уровне узла активируется, если невозможно подтвердить, что процесс контроллера отработки отказа ZooKeeper не может быть включен и прослушивать сеть.                                                   |
| Веб-интерфейс сервера Oozie                      | Это оповещение уровня узла активируется, если веб-интерфейс сервера Oozie недоступен.                                                                                                                |
| Состояние сервера Oozie                      | Это оповещение уровня узла активируется, если не удается определить сервер Oozie и отреагировать на запросы клиентов.                                                                      |
| Процесс хранилище метаданных Hive                   | Это оповещение на уровне узла активируется, если не удается определить процесс хранилище метаданных Hive и прослушивать сеть.                                                                 |
| Процесс HiveServer2                      | Это оповещение уровня узла активируется, если не удается определить HiveServer и отреагировать на запросы клиентов.                                                                        |
| Состояние сервера WebHCat                    | Это оповещение на уровне узла активируется, если `templeton` состояние сервера находится в неработоспособном состоянии.                                                                                                            |
| Процент доступных серверов ZooKeeper      | Это оповещение активируется, если число ZooKeeper серверов в кластере превышает заданное критическое пороговое значение. Он объединяет результаты проверок процесса ZooKeeper.     |
| Spark2 Livy Server                       | Это оповещение уровня узла активируется, если не удается определить сервер Livy2.                                                                                                        |
| Сервер журнала Spark2                    | Это оповещение уровня узла активируется, если не удается определить сервер журнала Spark2.                                                                                               |
| Процесс сборщика метрик                | Это оповещение активируется, если невозможно подтвердить, что сборщик метрик не может быть подтвержден и прослушивает настроенный порт в течение времени в секундах, равного порогу.                                 |
| Сборщик метрик — процесс HBase Master | Это оповещение активируется, если не удается подтвердить, что процессы хозяина метрик сборщика данных HBase не могут быть настроены и прослушиваться в сети для заданного критического порогового значения в секундах. |
| Доступные мониторы метрик процента       | Это оповещение активируется, если в процентах мониторов, которые отслеживают процессы, не прослушивают сеть для настроенных предупреждений и критических порогов.                             |
| Процент доступных NodeManagers           | Это оповещение активируется, если количество NodeManagers вниз в кластере превышает заданное критическое пороговое значение. Он объединяет результаты проверок процесса NodeManager.        |
| Работоспособность NodeManager                       | Это оповещение на уровне узла проверяет свойство работоспособности узла, доступное в компоненте NodeManager.                                                                                              |
| Веб-интерфейс NodeManager                       | Это оповещение уровня узла активируется, если веб-интерфейс NodeManager недоступен.                                                                                                                 |
| Работоспособность высокой доступности NameNode        | Это предупреждение уровня обслуживания активируется, если не запущены активные NameNode или резервные NameNode.                                                                                     |
| Процесс node                         | Это оповещение на уровне узла активируется, если не удается установить отдельные процессы узла данных, чтобы они были запущены и прослушиваться в сети.                                                         |
| Пользовательский веб-интерфейс узла                          | Это оповещение уровня узла активируется, если веб-интерфейс узла обработки недоступен.                                                                                                                    |
| Процент доступных Жаурналнодес           | Это оповещение активируется, если количество Жаурналнодес вниз в кластере превышает заданное критическое пороговое значение. Он объединяет результаты проверок процесса Жаурналноде.        |
| Доступно узлов в процентах              | Это оповещение активируется, если число отключенных узлов данных в кластере превышает заданное критическое пороговое значение. В нем суммируются результаты проверок в процессе обработки узлов данных.              |
| Состояние сервера Zeppelin                   | Это оповещение уровня узла активируется, если не удается определить сервер Zeppelin и отреагировать на запросы клиентов.                                                                   |
| Интерактивный процесс HiveServer2          | Это оповещение уровня узла активируется, если не удается определить Хивесерверинтерактиве и отреагировать на запросы клиентов.                                                             |
| Приложение LLAP                         | Это предупреждение активируется, если не удается определить приложение LLAP и отреагировать на запросы.                                                                                    |

Чтобы просмотреть дополнительные сведения о службе, выберите ее.

Хотя страница службы предоставляет сведения о состоянии и конфигурации каждой службы, она не предоставляет сведения о том, на каком головном узле запущена служба. Чтобы просмотреть эти сведения, щелкните ссылку **Узлы** в верхней части страницы. На странице отобразятся все узлы кластера, включая головные узлы.

![Список узлов Apache Ambari головного узла](./media/hdinsight-high-availability-linux/hdinsight-hosts-list.png)

Выберите ссылку на один из головных узлов, чтобы отобразить работающие на нем службы и компоненты.

![Состояние компонента Apache Ambari](./media/hdinsight-high-availability-linux/hdinsight-node-services.png)

Подробные сведения об использовании Ambari см. в статье [Управление кластерами HDInsight с помощью веб-интерфейса Ambari](hdinsight-hadoop-manage-ambari.md).

### <a name="ambari-rest-api"></a>Ambari REST API

Ambari REST API доступен в Интернете. Открытый шлюз HDInsight обрабатывает запросы маршрутизации к головному узлу, на котором в настоящее время размещается REST API.

Чтобы проверить состояние службы с помощью интерфейса Ambari REST API, можно воспользоваться следующей командой:

```bash
curl -u admin:PASSWORD https://CLUSTERNAME.azurehdinsight.net/api/v1/clusters/CLUSTERNAME/services/SERVICENAME?fields=ServiceInfo/state
```

* Замените **PASSWORD** паролем учетной записи пользователя (администратора) HTTP.
* Замените **CLUSTERNAME** именем кластера.
* Замените **SERVICENAME** именем службы, состояние которой вы хотите проверить.

Например, чтобы проверить состояние службы **HDFS** в кластере с именем **mycluster** и паролем **password**, нужно выполнить следующую команду.

```bash
curl -u admin:password https://mycluster.azurehdinsight.net/api/v1/clusters/mycluster/services/HDFS?fields=ServiceInfo/state
```

В ответ вы получите примерно такой код JSON:

```json
{
    "href" : "http://hn0-CLUSTERNAME.randomcharacters.cx.internal.cloudapp.net:8080/api/v1/clusters/mycluster/services/HDFS?fields=ServiceInfo/state",
    "ServiceInfo" : {
    "cluster_name" : "mycluster",
    "service_name" : "HDFS",
    "state" : "STARTED"
    }
}
```

URL-адрес указывает, что сейчас служба работает на узле с именем **hn0-CLUSTERNAME**.

Состояние указывает, что служба в настоящий момент запущена ( **STARTED**).

Если вы не уверены, какие службы установлены в кластере, для получения списка можно использовать следующую команду:

```bash
curl -u admin:PASSWORD https://CLUSTERNAME.azurehdinsight.net/api/v1/clusters/CLUSTERNAME/services
```

Дополнительные сведения о работе с REST API службы Ambari см. в статье [Управление кластерами HDInsight с помощью REST API Ambari](hdinsight-hadoop-manage-ambari-rest-api.md).

#### <a name="service-components"></a>Компоненты служб

Иногда службы содержат компоненты, состояние которых может потребоваться проверить по отдельности. Например, служба HDFS содержит компонент NameNode. Чтобы просмотреть сведения о компоненте, используйте следующую команду:

```bash
curl -u admin:PASSWORD https://CLUSTERNAME.azurehdinsight.net/api/v1/clusters/CLUSTERNAME/services/SERVICE/components/component
```

Если вы не уверены, какие компоненты предоставляются службой, для получения списка можно использовать следующую команду:

```bash
curl -u admin:PASSWORD https://CLUSTERNAME.azurehdinsight.net/api/v1/clusters/CLUSTERNAME/services/SERVICE/components/component
```

## <a name="how-to-access-log-files-on-the-head-nodes"></a>Доступ к файлам журнала на головных узлах

### <a name="ssh"></a>SSH

Если подключение к головному узлу установлено через SSH, файлы журнала можно найти в папке **/var/log**. Например, в папке **/var/log/hadoop-yarn/yarn** содержатся журналы для YARN.

Каждый головной узел может иметь уникальные записи журнала, поэтому следует проверить журналы на обоих узлах.

### <a name="sftp"></a>SFTP

Кроме того, к головному узлу можно подключаться с помощью протокола передачи файлов SSH или безопасного протокола передачи файлов (SFTP) и напрямую загружать файлы журналов.

Как и при использовании клиента SSH, при подключении к кластеру необходимо указать имя учетной записи пользователя SSH и адрес SSH кластера. Пример: `sftp username@mycluster-ssh.azurehdinsight.net`. Предоставьте пароль для учетной записи, когда отобразится соответствующий запрос, или передайте открытый ключ через параметр `-i`.

После подключения появится запрос `sftp>`. С помощью этой строки можно переходить в другие каталоги, отправлять и скачивать файлы. Например, следующие команды изменяют каталоги на каталог **/var/log/hadoop/hdfs** , а затем загружают все файлы в каталоге.

    cd /var/log/hadoop/hdfs
    get *

Для просмотра списка доступных команд введите `help` в строке `sftp>`.

> [!NOTE]  
> Некоторые графические интерфейсы позволяют визуализировать файловую систему при подключении по протоколу SFTP. Например, [MobaXTerm](https://mobaxterm.mobatek.net/) позволяет просматривать файловую систему с помощью интерфейса, похожего на проводник Windows.

### <a name="ambari"></a>Ambari

> [!NOTE]  
> Чтобы получить доступ к файлам журнала с помощью Ambari, используйте туннель SSH. К веб-интерфейсам для отдельных служб не предоставляется открытый доступ через Интернет. Дополнительные сведения об использовании туннеля SSH см. в документе [Использование туннелирования SSH для доступа к веб-интерфейсу Ambari, JobHistory, NameNode, Oozie и другим веб-интерфейсам](hdinsight-linux-ambari-ssh-tunnel.md).

Через веб-Интерфейс Ambari выберите службу, для которой вы хотите просмотреть журналы (например, YARN). Затем в разделе **Быстрые ссылки** выберите головной узел, для которого нужно просмотреть журналы.

![Использование быстрых ссылок для просмотра журналов](./media/hdinsight-high-availability-linux/quick-links-view-logs.png)

## <a name="how-to-configure-the-node-size"></a>Настройка размера узла

Размер узла можно выбрать только во время создания кластера. Список различных размеров виртуальных машин, доступных для HDInsight, можно найти на [странице цен на HDInsight](https://azure.microsoft.com/pricing/details/hdinsight/).

При создании кластера можно указать размер узлов. Следующая информация содержит рекомендации по заданию размера с помощью [портал Azure](https://portal.azure.com/), [Azure PowerShellого модуля AZ](/powershell/azureps-cmdlets-docs)и [Azure CLI](https://docs.microsoft.com/cli/azure/?view=azure-cli-latest):

* **Портал Azure.** При создании кластера можно задать размер для узлов этого кластера:

    ![Изображение мастера создания кластера с выбором размера узла](./media/hdinsight-high-availability-linux/hdinsight-headnodesize.png)

* **Azure CLI**. при использовании команды [`az hdinsight create`](https://docs.microsoft.com/cli/azure/hdinsight?view=azure-cli-latest#az-hdinsight-create) можно задать размер головного, рабочего и ZooKeeper узлов, используя параметры `--headnode-size`, `--workernode-size`и `--zookeepernode-size`.

* **Azure PowerShell**. при использовании командлета [New-аздинсигхтклустер](https://docs.microsoft.com/powershell/module/az.hdinsight/new-azhdinsightcluster) можно задать размер головного, рабочего и ZooKeeper узлов с помощью параметров `-HeadNodeSize`, `-WorkerNodeSize`и `-ZookeeperNodeSize`.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об элементах, обсуждаемых в этой статье, см. в следующих статьях:

* [Справочник по REST Apache Ambari](https://github.com/apache/ambari/blob/trunk/ambari-server/docs/api/v1/index.md)
* [Установка и настройка CLI Azure](https://docs.microsoft.com//cli/azure/install-azure-cli?view=azure-cli-latest)
* [Установка и Настройка модуля Azure PowerShell AZ](/powershell/azure/overview)
* [Управление кластерами HDInsight с помощью веб-интерфейса Ambari](hdinsight-hadoop-manage-ambari.md)
* [«Подготовка кластеров HDInsight на основе Linux»](hdinsight-hadoop-provision-linux-clusters.md)
