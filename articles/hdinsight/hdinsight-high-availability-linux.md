---
title: Высокий уровень доступности для Hadoop в Azure HDInsight
description: Узнайте, как использование дополнительного головного узла позволяет повысить надежность и доступность кластеров HDInsight. Узнайте, как это влияет на службы Hadoop, такие как Ambari и Hive, и научитесь подключаться к каждому отдельному головному узлу с помощью SSH.
author: hrasheed-msft
ms.author: hrasheed
ms.reviewer: jasonh
keywords: Высокая доступность Hadoop
ms.service: hdinsight
ms.custom: hdinsightactive,hdiseo17may2017
ms.topic: conceptual
ms.date: 10/28/2019
ms.openlocfilehash: 085933f9a74ee37779ce63ce499d89ea53a9f7d6
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "77198945"
---
# <a name="availability-and-reliability-of-apache-hadoop-clusters-in-hdinsight"></a>Доступность и надежность кластеров Apache Hadoop в HDInsight

В кластерах HDInsight предусмотрены два головных узла, повышающие доступность и надежность выполняемых служб и заданий Apache Hadoop.

Платформа Hadoop обеспечивает высокий уровень доступности и надежности, реплицируя службы и данные на нескольких узлах в кластере. Однако стандартные дистрибутивы Hadoop обычно имеют один головной узел. Любой сбой такого узла может вызвать прекращение работы кластера. HDInsight предоставляет два головных узла для повышения доступности и надежности Hadoop.

## <a name="availability-and-reliability-of-nodes"></a>Доступность и надежность узлов

Узлы в кластере HDInsight реализуются с помощью виртуальных машин Azure. В следующих разделах рассматриваются отдельные типы узлов, которые используются с HDInsight.

> [!NOTE]  
> Не все типы узлов используются для определенного типа кластера. Например, тип кластера Hadoop не содержит узлы Nimbus. Дополнительные сведения об узлах, используемых типами кластеров HDInsight, см. в разделе "Типы кластеров" статьи [Создание кластеров Hadoop в HDInsight](hdinsight-hadoop-provision-linux-clusters.md#cluster-type).

### <a name="head-nodes"></a>Головные узлы

Для обеспечения высокого уровня доступности службы Hadoop HDInsight предоставляет два головных узла. Оба головных узла активны и работают в кластере HDInsight одновременно. Некоторые службы, например Apache HDFS или Apache Hadoop YARN, в любой момент времени активны только на одном головном узле. Другие службы, например HiveServer2 или Hive MetaStore, активны одновременно на обоих головных узлах.

Для получения имен узлов для различных типов узлов в кластере, пожалуйста, используйте [API Ambari REST.](hdinsight-hadoop-manage-ambari-rest-api.md#example-get-the-fqdn-of-cluster-nodes)

> [!IMPORTANT]  
> Не воспринимайте это числовое значение как обозначение приоритета узла (первичный или вторичный). Единственная функция этого значения — обеспечение уникальности имен для каждого узла.

### <a name="nimbus-nodes"></a>Узлы Nimbus

Узлы Nimbus доступны с кластерами Apache Storm. Узлы Nimbus предоставляют Hadoop JobTracker похожие функциональные возможности путем распределения и мониторинга обработки на рабочих узлах. HDInsight предоставляет два узла Nimbus для кластеров Storm.

### <a name="apache-zookeeper-nodes"></a>Узлы Apache Zookeeper

Узлы [ZooKeeper](https://zookeeper.apache.org/) используются для выбора лидера главных служб на головных узлах, Они также используются для обеспечения того, чтобы службы, узлы данных (рабочих) и шлюзы знали, на каком головном узло работает мастер-сервис. По умолчанию в кластере HDInsight предусмотрено три узла ZooKeeper.

### <a name="worker-nodes"></a>Рабочие узлы

Рабочие узлы выполняют анализ данных при отправке задания в кластер. Если происходит сбой рабочего узла, выполняемая задача отправляется на другой рабочий узел. По умолчанию HDInsight создает четыре рабочих узла. Вы можете изменить это количество по своему усмотрению как во время создания кластера, так и позднее.

### <a name="edge-node"></a>краевой узла

Крайуг узла не участвует в анализе данных в кластере. Он используется разработчиками или учеными данных при работе с Hadoop. Граничный узел находится в той же виртуальной сети Azure, что и другие узлы в кластере, и может получать непосредственный доступ ко всем остальным узлам. Его можно использовать без опасения отнять ресурсы у критически важных служб или заданий анализа Hadoop.

Сейчас службы машинного обучения в HDInsight являются единственным типом кластера, который по умолчанию предоставляет граничный узел. В службах машинного обучения в HDInsight граничный узел используется для локального тестирования кода R на узле перед его отправкой в кластер для распределенной обработки.

Сведения об использовании граничного узла с другими типами кластеров, см. в статье [Использование пустых граничных узлов в HDInsight](hdinsight-apps-use-edge-node.md).

## <a name="accessing-the-nodes"></a>Доступ к узлам

Доступ к кластеру из Интернета предоставляется через общедоступный шлюз. Доступ ограничен подключением к головным узлам и, если он существует, узла края. Доступ к службам, работающим на головных узлах, не зависит от наличия нескольких узлов головы. Общедоступный шлюз просто направляет запросы к тому головному узлу, на котором размещается запрашиваемая служба. Например, если служба Apache Ambari размещена на вторичном головном узле, шлюз будет направлять на этот узел все входящие запросы к службе Ambari.

Доступ через общедоступный шлюз ограничен портами 443 (HTTPS), 22 и 23.

|Порт |Описание |
|---|---|
|443|Используется для доступа к Ambari и другим веб-uI или REST AIS, размещенным на головных узлах.|
|22|Используется для доступа к основному головному узлаили или краю узла с SSH.|
|23|Используется для доступа к вторичному головному узлам с SSH. Например, `ssh username@mycluster-ssh.azurehdinsight.net` подключается к основному головному узлу кластера с именем **mycluster**.|

Дополнительные сведения об использовании SSH см. в статье [Подключение к HDInsight (Hadoop) с помощью SSH](hdinsight-hadoop-linux-use-ssh-unix.md).

### <a name="internal-fully-qualified-domain-names-fqdn"></a>Внутренние полные доменные имена (FQDN)

Каждый узел в кластере HDInsight имеет внутренний IP-адрес и полное доменное имя, доступ к которым возможен только из этого кластера. При доступе к службам в кластере с помощью внутреннего FQDN или IP-адреса следует использовать Ambari для проверки IP-адреса или FQDN, которые будут использоваться для доступа к службе.

Например, служба Apache Oozie может выполняться только на одном головном узле, и при использовании команды `oozie` в сеансе SSH требуется URL-адрес службы. Этот адрес можно получить из Ambari с помощью следующей команды:

```bash
export password='PASSWORD'
export clusterName="CLUSTERNAME"

curl -u admin:$password "https://$clusterName.azurehdinsight.net/api/v1/clusters/$clusterName/configurations?type=oozie-site&tag=TOPOLOGY_RESOLVED" | grep oozie.base.url
```

Эта команда возвращает значение, аналогичное следующему, которое `oozie` содержит внутренний URL для использования с командой:

```output
"oozie.base.url": "http://<ACTIVE-HEADNODE-NAME>cx.internal.cloudapp.net:11000/oozie"
```

Дополнительные сведения о работе с REST API службы Ambari см. в статье [Управление кластерами HDInsight с помощью REST API Ambari](hdinsight-hadoop-manage-ambari-rest-api.md).

### <a name="accessing-other-node-types"></a>Доступ к узлам других типов

Вы можете подключиться к узлам, которые не доступны напрямую через Интернет, используя следующие методы:

|Метод |Описание |
|---|---|
|SSH|после подключения к головному узлу с помощью SSH можно затем использовать SSH с головного узла для подключения к другим узлам в кластере. Дополнительные сведения см. в статье [Подключение к HDInsight (Hadoop) с помощью SSH](hdinsight-hadoop-linux-use-ssh-unix.md).|
|Туннель SSH|Если вам необходимо получить доступ к веб-службе, размещенной на одном из узлов, которые не подвергаются воздействию Интернета, вы должны использовать туннель SSH. Дополнительные сведения см. в статье [Использование туннелирования SSH для доступа к веб-интерфейсу Ambari, JobHistory, NameNode, Oozie и другим веб-интерфейсам](hdinsight-linux-ambari-ssh-tunnel.md).|
|Виртуальная сеть Azure|Если кластер HDInsight входит в состав виртуальной сети Azure, любой ресурс в той же виртуальной сети может напрямую получать доступ ко всем узлам в кластере. Для получения дополнительной информации смотрите в плане виртуальную сеть для документа [HDInsight.](hdinsight-plan-virtual-network-deployment.md)|

## <a name="how-to-check-on-a-service-status"></a>Проверка состояния службы

Состояние служб, работающих на головных узлах, можно проверить с помощью веб-интерфейса Ambari или REST API Ambari.

### <a name="ambari-web-ui"></a>Веб-интерфейс Ambari

Веб-интерфейс Ambari можно просмотреть по ссылке `https://CLUSTERNAME.azurehdinsight.net`. Замените **CLUSTERNAME** с именем кластера. При появлении запроса введите учетные данные пользователя HTTP для кластера. По умолчанию используются имя пользователя HTTP **admin** и пароль, который вы ввели при создании кластера.

Открыв страницу Ambari, слева вы увидите список установленных служб.

![Apache Ambari установил услуги](./media/hdinsight-high-availability-linux/hdinsight-installed-services.png)

Существует ряд значков, которые могут отображаться рядом со службой и указывать ее состояние. Все оповещения, связанные с той или иной службой, можно просмотреть, щелкнув ссылку **Оповещения** в верхней части страницы.  Ambari предлагает несколько предопределенных предупреждений.

Следующие оповещения помогают контролировать наличие кластера:

| Имя предупреждения                               | Описание                                                                                                                                                                                  |
|------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Статус метеомонитора                    | Это предупреждение указывает на состояние процесса монитора метрик, определяемого сценарием состояния монитора.                                                                                   |
| Амбариа Агент Сердцебиение                   | Это оповещение срабатывает, если сервер потерял контакт с агентом.                                                                                                                        |
| Процесс сервера Зоохранителя                 | Это оповещение на уровне хоста срабатывает, если невозможно определить, что процесс сервера зооkeeper будет запущен и прослушан в сети.                                                               |
| Статус сервера МЕТАданных IOCache           | Это оповещение на уровне хоста срабатывает, если не уровень метаданных IOCache может быть определен как запрос ы и ответ на запросы клиентов                                                            |
| Веб-uI JournalNode                       | Это предупреждение на уровне хоста срабатывает, если веб-миноносец JournalNode недосягаем.                                                                                                                 |
| Spark2 Бережли в сервере                     | Это оповещение на уровне хоста срабатывает, если сервер Spark2 Thrift Server не может быть определен как подъем.                                                                                                |
| Процесс сервера истории                   | Это оповещение на уровне хоста срабатывает, если процесс History Server не может быть установлен для запуска и прослушивания в сети.                                                                |
| История Сервер веб-uI                    | Это оповещение на уровне хоста срабатывает, если веб-иноматематизм History Server недосягаем.                                                                                                              |
| `ResourceManager`Веб-uI                   | Это предупреждение уровня хоста срабатывает, если `ResourceManager` веб-миноносец недосягаем.                                                                                                             |
| NodeManager Здравоохранение Резюме               | Это оповещение на уровне службы срабатывает при наличии неработоспособных узлов                                                                                                                    |
| Веб-uI App Timeline                      | Это оповещение на уровне хоста срабатывает, если веб-узел App Timeline Server недосягаем.                                                                                                         |
| Резюме состояния DataNode                  | Это оповещение на уровне службы срабатывает при наличии неработоспособных DataNodes                                                                                                                       |
| Веб-uI NameNode                          | Это предупреждение на уровне хоста срабатывает, если веб-миноносец NameNode недосягаем.                                                                                                                    |
| Зоохранител Failover Процесс контроллера    | Это оповещение на уровне хоста срабатывает, если процесс контроллера «ЗооKeeper Failover» не может быть подтвержден как запущенный и прослушиваемый в сети.                                                   |
| Веб-интерфейс Oozie Server                      | Это оповещение на уровне хоста срабатывает, если веб-интерфейс сервера Oozie недосягаем.                                                                                                                |
| Статус сервера Oozie                      | Это оповещение на уровне хоста срабатывает, если сервер Oozie не может быть определен как запущенный и отвечая на запросы клиентов.                                                                      |
| Процесс Hive Metastore                   | Это предупреждение на уровне хоста срабатывает, если невозможно определить, что процесс Hive Metastore будет запущен в сеть.                                                                 |
| Процесс HiveServer2                      | Это оповещение на уровне хоста срабатывает, если HiveServer не может быть определен как запущенный и отвечая на запросы клиентов.                                                                        |
| Статус сервера WebHCat                    | Это оповещение на `templeton` уровне хоста срабатывает, если состояние сервера не является здоровым.                                                                                                            |
| Процент серверов зоохранителей доступны      | Это оповещение срабатывает, если число несудающихся серверов в кластере превышает настроенный критический порог. Он агрегирует результаты проверки процесса зоохранителя.     |
| Spark2 Livy Server                       | Это оповещение уровня хоста срабатывает, если невозможно определить, что сервер Livy2 не может быть определен как подъем.                                                                                                        |
| Сервер истории Spark2                    | Это оповещение на уровне хоста срабатывает, если невозможно определить, что сервер истории Spark2 не может быть определен как подъем.                                                                                               |
| Процесс сбора метрик                | Это оповещение срабатывает, если коллектор метрик не может быть подтвержден как наданный и прослушиваемый в настроенном порту в течение нескольких секунд, равных порогу.                                 |
| Сборщик метрик - Мастер-процесс HBase | Это оповещение срабатывает, если мастер-процессы HBase коллектора метрики не могут быть подтверждены как поднятые и прослушиваемые в сети для настроенного критического порога, заданного в считанные секунды. |
| Процент метеоков Мониторы доступны       | Это оповещение срабатывает, если процент процессов Metrics Monitor не работает и не слушается в сети для настроенных предупреждений и критических порогов.                             |
| Процент узлов Доступные           | Это предупреждение срабатывает, если число внизовых узлов в кластере превышает настроенный критический порог. Он агрегирует результаты проверки процесса NodeManager.        |
| Здоровье NodeManager                       | Это предупреждение на уровне хоста проверяет свойство работоспособности узла, доступное из компонента NodeManager.                                                                                              |
| Веб-uI NodeManager                       | Это оповещение на уровне хоста срабатывает, если веб-миноносец NodeManager недосягаем.                                                                                                                 |
| Здоровье высокой доступности NameNode        | Это оповещение на уровне службы срабатывает, если нет ни Active NameNode, ни Standby NameNode.                                                                                     |
| Процесс DataNode                         | Это оповещение на уровне хоста срабатывает, если отдельные процессы DataNode не могут быть созданы для того, чтобы быть запущенными и прослушиваемыми в сети.                                                         |
| Веб-uI DataNode                          | Это предупреждение на уровне хоста срабатывает, если доступ к веб-убору DataNode недосягаем.                                                                                                                    |
| Процент доступных удосов журнала           | Это предупреждение срабатывает, если число внизжурналов в кластере превышает настроенный критический порог. Он агрегирует результаты проверки процесса JournalNode.        |
| Процент доступных dataNoд              | Это предупреждение срабатывает, если число снижаемых dataNodes в кластере превышает настроенный критический порог. Он агрегирует результаты проверки процесса DataNode.              |
| Статус сервера Цеппелин                   | Это оповещение на уровне хоста срабатывает, если сервер zeppelin не может быть определен как наданный и отвечая на запросы клиентов.                                                                   |
| Интерактивный процесс HiveServer2          | Это оповещение на уровне хоста срабатывает, если HiveServerInteractive не может быть определено, чтобы быть и отвечать на запросы клиентов.                                                             |
| Приложение LLAP                         | Это оповещение срабатывает, если приложение LLAP не может быть определено как запущенное и отвечая на запросы.                                                                                    |

Чтобы просмотреть дополнительные сведения о службе, выберите ее.

Хотя страница службы предоставляет информацию о состоянии и конфигурации каждой службы, она не предоставляет информацию о том, на каком головном узлах работает служба. Чтобы просмотреть эти сведения, щелкните ссылку **Узлы** в верхней части страницы. На странице отобразятся все узлы кластера, включая головные узлы.

![Apache Ambari Headnode хостов список](./media/hdinsight-high-availability-linux/hdinsight-hosts-list.png)

Выберите ссылку на один из головных узлов, чтобы отобразить работающие на нем службы и компоненты.

![Статус компонента Apache Ambari](./media/hdinsight-high-availability-linux/hdinsight-node-services.png)

Подробные сведения об использовании Ambari см. в статье [Управление кластерами HDInsight с помощью веб-интерфейса Ambari](hdinsight-hadoop-manage-ambari.md).

### <a name="ambari-rest-api"></a>Ambari REST API

Ambari REST API доступен в Интернете. Открытый шлюз HDInsight обрабатывает запросы маршрутизации к головному узлу, на котором в настоящее время размещается REST API.

Чтобы проверить состояние службы с помощью интерфейса Ambari REST API, можно воспользоваться следующей командой:

```bash
curl -u admin:PASSWORD https://CLUSTERNAME.azurehdinsight.net/api/v1/clusters/CLUSTERNAME/services/SERVICENAME?fields=ServiceInfo/state
```

* Замените **PASSWORD** паролем учетной записи пользователя HTTP (admin).
* Замените **CLUSTERNAME** названием кластера.
* Замените **SERVICENAME** именем службы, состояние которой вы хотите проверить.

Например, чтобы проверить состояние службы **HDFS** в кластере с именем **mycluster** и паролем **password**, нужно выполнить следующую команду.

```bash
curl -u admin:password https://mycluster.azurehdinsight.net/api/v1/clusters/mycluster/services/HDFS?fields=ServiceInfo/state
```

В ответ вы получите примерно такой код JSON:

```json
{
    "href" : "http://mycluster.wutj3h4ic1zejluqhxzvckxq0g.cx.internal.cloudapp.net:8080/api/v1/clusters/mycluster/services/HDFS?fields=ServiceInfo/state",
    "ServiceInfo" : {
    "cluster_name" : "mycluster",
    "service_name" : "HDFS",
    "state" : "STARTED"
    }
}
```

URL говорит нам, что служба в настоящее время работает на головном узле под названием **mycluster.wutj3h4ic1zejluqhxvvckxqq0g**.

Состояние указывает, что служба в настоящий момент запущена ( **STARTED**).

Если вы не знаете, какие службы установлены в кластере, можно использовать следующую команду для получения списка:

```bash
curl -u admin:PASSWORD https://CLUSTERNAME.azurehdinsight.net/api/v1/clusters/CLUSTERNAME/services
```

Дополнительные сведения о работе с REST API службы Ambari см. в статье [Управление кластерами HDInsight с помощью REST API Ambari](hdinsight-hadoop-manage-ambari-rest-api.md).

#### <a name="service-components"></a>Компоненты служб

Иногда службы содержат компоненты, состояние которых может потребоваться проверить по отдельности. Например, служба HDFS содержит компонент NameNode. Чтобы просмотреть сведения о компоненте, используйте следующую команду:

```bash
curl -u admin:PASSWORD https://CLUSTERNAME.azurehdinsight.net/api/v1/clusters/CLUSTERNAME/services/SERVICE/components/component
```

Если вы не знаете, какие компоненты предоставляются службой, вы можете использовать следующую команду для получения списка:

```bash
curl -u admin:PASSWORD https://CLUSTERNAME.azurehdinsight.net/api/v1/clusters/CLUSTERNAME/services/SERVICE/components/component
```

## <a name="how-to-access-log-files-on-the-head-nodes"></a>Доступ к файлам журнала на головных узлах

### <a name="ssh"></a>SSH

Если подключение к головному узлу установлено через SSH, файлы журнала можно найти в папке **/var/log**. Например, в папке **/var/log/hadoop-yarn/yarn** содержатся журналы для YARN.

Каждый головной узел может иметь уникальные записи журнала, поэтому следует проверить журналы на обоих узлах.

### <a name="sftp"></a>SFTP

Кроме того, к головному узлу можно подключаться с помощью протокола передачи файлов SSH или безопасного протокола передачи файлов (SFTP) и напрямую загружать файлы журналов.

Как и при использовании клиента SSH, при подключении к кластеру необходимо указать имя учетной записи пользователя SSH и адрес SSH кластера. Например, `sftp username@mycluster-ssh.azurehdinsight.net`. Предоставьте пароль для учетной записи, когда отобразится соответствующий запрос, или передайте открытый ключ через параметр `-i`.

После подключения вам предоставляется `sftp>` подсказка. С помощью этой строки можно переходить в другие каталоги, отправлять и скачивать файлы. Например, следующие команды изменяют каталоги на каталог **/var/log/hadoop/hdfs** , а затем загружают все файлы в каталоге.

    cd /var/log/hadoop/hdfs
    get *

Для просмотра списка доступных команд введите `help` в строке `sftp>`.

> [!NOTE]  
> Некоторые графические интерфейсы позволяют визуализировать файловую систему при подключении по протоколу SFTP. Например, [MobaXTerm](https://mobaxterm.mobatek.net/) позволяет просматривать файловую систему с помощью интерфейса, похожего на проводник Windows.

### <a name="ambari"></a>Ambari

> [!NOTE]  
> Чтобы получить доступ к файлам журнала с помощью Ambari, используйте туннель SSH. К веб-интерфейсам для отдельных служб не предоставляется открытый доступ через Интернет. Дополнительные сведения об использовании туннеля SSH см. в документе [Использование туннелирования SSH для доступа к веб-интерфейсу Ambari, JobHistory, NameNode, Oozie и другим веб-интерфейсам](hdinsight-linux-ambari-ssh-tunnel.md).

Через веб-Интерфейс Ambari выберите службу, для которой вы хотите просмотреть журналы (например, YARN). Затем в разделе **Быстрые ссылки** выберите головной узел, для которого нужно просмотреть журналы.

![Использование быстрых ссылок для просмотра журналов](./media/hdinsight-high-availability-linux/quick-links-view-logs.png)

## <a name="how-to-configure-the-node-size"></a>Настройка размера узла

Размер узла можно выбрать только во время создания кластера. Список различных размеров виртуальных машин, доступных для HDInsight, можно найти на [странице цен на HDInsight](https://azure.microsoft.com/pricing/details/hdinsight/).

При создании кластера можно указать размер узлов. Ниже приводится руководство о том, как указать размер с помощью [портала Azure](https://portal.azure.com/), [модуль Azure PowerShell Az](/powershell/azureps-cmdlets-docs)и [Azure CLI:](https://docs.microsoft.com/cli/azure/?view=azure-cli-latest)

* **Портал Azure.** При создании кластера можно задать размер для узлов этого кластера:

    ![Изображение мастера создания кластера с выбором размера узла](./media/hdinsight-high-availability-linux/azure-portal-cluster-configuration-pricing-hadoop.png)

* **Azure CLI:** При [`az hdinsight create`](https://docs.microsoft.com/cli/azure/hdinsight?view=azure-cli-latest#az-hdinsight-create) использовании команды можно установить размер узлов головы, рабочего `--headnode-size`и `--workernode-size`зоозащитника, используя , и `--zookeepernode-size` параметры.

* **Azure PowerShell:** При использовании cmdlet [New-AzHDInsightCluster](https://docs.microsoft.com/powershell/module/az.hdinsight/new-azhdinsightcluster) можно установить размер узла головы, рабочего `-WorkerNodeSize`и `-ZookeeperNodeSize` зоозащитника с помощью `-HeadNodeSize`узлов и параметров.

## <a name="next-steps"></a>Дальнейшие действия

Чтобы узнать больше о пунктах, обсуждаемых в этой статье, см.:

* [Справочник по REST Apache Ambari](https://github.com/apache/ambari/blob/trunk/ambari-server/docs/api/v1/index.md)
* [Установка и настройка CLI Azure](https://docs.microsoft.com//cli/azure/install-azure-cli?view=azure-cli-latest)
* [Установка и настройка модуля Azure PowerShell Az](/powershell/azure/overview)
* [Управление кластерами HDInsight с помощью веб-интерфейса Ambari](hdinsight-hadoop-manage-ambari.md)
* [«Подготовка кластеров HDInsight на основе Linux»](hdinsight-hadoop-provision-linux-clusters.md)
