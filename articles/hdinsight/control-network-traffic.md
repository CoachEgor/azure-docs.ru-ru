---
title: Управление сетевым трафиком в Azure HDInsight
description: Узнайте о методах управления входящим и исходящим трафиком в кластерах Azure HDInsight.
author: hrasheed-msft
ms.author: hrasheed
ms.reviewer: jasonh
ms.service: hdinsight
ms.topic: conceptual
ms.date: 05/04/2020
ms.openlocfilehash: 031dbb0e8c9b9fb8dc37b264f9ba8e1186efc832
ms.sourcegitcommit: 31236e3de7f1933be246d1bfeb9a517644eacd61
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2020
ms.locfileid: "82783595"
---
# <a name="control-network-traffic-in-azure-hdinsight"></a>Управление сетевым трафиком в Azure HDInsight

Для управления сетевым трафиком в виртуальных сетях Azure можно использовать следующие методы:

* **Группы безопасности сети** (NSG) позволяют фильтровать входящий и исходящий трафик в сети. Дополнительные сведения см. в документе [Фильтрация сетевого трафика с помощью групп безопасности сети](../virtual-network/security-overview.md).

* **Сетевые виртуальные устройства** (NVA) можно использовать только с исходящим трафиком. NVA реплицирует функциональность таких устройств, как брандмауэры и маршрутизаторы. Дополнительные сведения см. в документе [Сетевые устройства](https://azure.microsoft.com/solutions/network-appliances).

В качестве управляемой службы HDInsight требует неограниченного доступа к службе работоспособности и управления службой хранилища HDInsight как для входящего, так и для исходящего трафика из виртуальной сети. При использовании группы безопасности сети необходимо убедиться, что эти службы по-прежнему могут взаимодействовать с кластером HDInsight.

![Схема сущностей HDInsight, созданных в настраиваемой виртуальной сети Azure](./media/control-network-traffic/hdinsight-vnet-diagram.png)

## <a name="hdinsight-with-network-security-groups"></a>HDInsight с группами безопасности сети

Если вы планируете использовать **группы безопасности сети** для управления сетевым трафиком, перед установкой HDInsight выполните следующие действия.

1. Определите регион Azure, который планируется использовать для HDInsight.

2. Найдите теги службы, необходимые HDInsight для вашего региона. Дополнительные сведения см. в статье [теги службы группы безопасности сети (NSG) для Azure HDInsight](hdinsight-service-tags.md).

3. Создайте или измените группы безопасности сети для подсети, в которую планируется установить HDInsight.

    * __Группы безопасности сети__: разрешите __входящий__ трафик через порт __443__ с диапазона IP-адресов. Это обеспечит, чтобы службы управления HDInsight могли получить доступ к кластеру извне виртуальной сети.

Дополнительные сведения о группах безопасности сети см. в разделе [Общие сведения о группах безопасности сети](../virtual-network/security-overview.md).

## <a name="controlling-outbound-traffic-from-hdinsight-clusters"></a>Управление исходящим трафиком из кластеров HDInsight

Дополнительные сведения об управлении исходящим трафиком из кластеров HDInsight см. в статье [Настройка ограничения исходящего сетевого трафика для кластеров Azure hdinsight](hdinsight-restrict-outbound-traffic.md).

### <a name="forced-tunneling-to-on-premises"></a>Принудительное туннелирование в локальной среде

Принудительное туннелирование — это определяемая пользователем конфигурация маршрутизации, в которой весь трафик из подсети принудительно применяется к определенной сети или расположению, например к локальной сети или брандмауэру. Принудительное туннелирование всех данных, передаваемых обратно в локальную среду, _не_ рекомендуется из-за больших объемов передачи данных и потенциального влияния на производительность.

Клиентам, желающим настроить принудительное туннелирование, следует использовать [Пользовательский метахранилища](./hdinsight-use-external-metadata-stores.md) и настроить подходящее подключение из подсети кластера или локальной сети к этим пользовательским метахранилища.

Пример установки UDR с помощью брандмауэра Azure см. в статье [Настройка ограничения исходящего сетевого трафика для кластеров Azure HDInsight](hdinsight-restrict-outbound-traffic.md).

## <a name="required-ip-addresses"></a> Требуемые IP-адреса

Если для управления трафиком используются группы безопасности сети или определяемые пользователем маршруты, см. раздел [IP-адреса управления HDInsight](hdinsight-management-ip-addresses.md).

## <a name="required-ports"></a>Требуемые порты

Если вы планируете использовать **брандмауэр** и получить доступ к кластеру за пределами определенных портов, вам следует разрешить трафик на этих портах, необходимых для вашего сценария. По умолчанию специальные список разрешений портов не требуются, пока трафик управления Azure, описанный в предыдущем разделе, может получить доступ к кластеру через порт 443.

См. [список портов, используемых службами Hadoop в HDInsight](hdinsight-hadoop-port-settings-for-services.md).

Дополнительные сведения о правилах межсетевого экрана для виртуальных модулей см. в документе [Сценарий использования виртуальных устройств](../virtual-network/virtual-network-scenario-udr-gw-nva.md).

## <a name="next-steps"></a>Дальнейшие действия

* Примеры кода и примеры создания виртуальных сетей Azure см. в статье [Создание виртуальных сетей для кластеров Azure HDInsight](hdinsight-create-virtual-network.md).
* Полный пример настройки HDInsight для подключения к локальной сети см. в статье [Подключение HDInsight к локальной сети](./connect-on-premises-network.md).
* Дополнительные сведения о виртуальных сетях Azure см. в статье [Виртуальная сеть Azure](../virtual-network/virtual-networks-overview.md).
* Дополнительные сведения о группах безопасности сети см. в статье [Фильтрация сетевого трафика с помощью групп безопасности сети](../virtual-network/security-overview.md).
* Дополнительные сведения об определяемых пользователем маршрутах см. в разделе [определяемые пользователем маршруты и IP-пересылка](../virtual-network/virtual-networks-udr-overview.md).
* Дополнительные сведения о виртуальных сетях см. в статье [Планирование виртуальных сетей для HDInsight](./hdinsight-plan-virtual-network-deployment.md).
