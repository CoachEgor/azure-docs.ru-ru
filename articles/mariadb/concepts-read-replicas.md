---
title: Чтение реплик в базе данных Azure для MariaDB
description: В этой статье описываются реплики чтения для базы данных Azure для MariaDB.
author: ajlam
ms.author: andrela
ms.service: mariadb
ms.topic: conceptual
ms.date: 07/12/2019
ms.openlocfilehash: e6bbe15727a6f989d8c16c67591d39d7870d5708
ms.sourcegitcommit: de47a27defce58b10ef998e8991a2294175d2098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/15/2019
ms.locfileid: "67874900"
---
# <a name="read-replicas-in-azure-database-for-mariadb"></a>Чтение реплик в базе данных Azure для MariaDB

Функция чтения реплики позволяет реплицировать данные с сервера базы данных Azure для MariaDB на сервер, предназначенный только для чтения. Можно выполнить репликацию с главного сервера до пяти реплик. Реплики обновляются асинхронно с помощью технологии репликации на основе расположения файлов двоичного журнала MariaDB Engine (бинлог) с глобальным ИДЕНТИФИКАТОРом транзакции (ГТИД). Дополнительные сведения о репликации binlog см. в [этой статье](https://mariadb.com/kb/en/library/replication-overview/).

> [!IMPORTANT]
> Реплику чтения можно создать в том же регионе, что и главный сервер, или в любом другом регионе Azure по своему усмотрению. Реплики чтения (в одном регионе и в разных регионах) сейчас доступны в общедоступной предварительной версии.

Реплики — это новые серверы, управление которыми осуществляется аналогично обычным серверам базы данных Azure для MariaDB. За каждую реплику чтения выставляется счет с учетом подготовленных вычислительных ресурсов (количество виртуальных ядер) и хранилища (ГБ/месяц).

Дополнительные сведения о репликации ГТИД см. в документации по [репликации MariaDB](https://mariadb.com/kb/en/library/gtid/).

## <a name="when-to-use-a-read-replica"></a>Использование реплик чтения

Компонент "Реплика чтения" помогает повысить производительность и масштабируемость рабочих нагрузок с высокой интенсивностью чтения. Рабочие нагрузки чтения можно изолировать в реплики, направив рабочие нагрузки записи на главный сервер.

К типичным сценариям относится ситуация, когда рабочие нагрузки бизнес-аналитики и анализа используют реплику чтения в качестве источника данных для отчетов.

Так как реплики доступны только для чтения, они не снимают с главного сервера нагрузку, связанную с записью. Этот компонент не предназначен для рабочих нагрузок с интенсивной записью.

Функция чтения реплики использует асинхронную репликацию. Этот компонент также не предназначен для сценариев синхронной репликации. Между поступлением данных на главный сервер и на реплики будет существенная задержка. Данные на реплике и на главном узле согласованы в конечном счете. Используйте этот компонент только для таких рабочих нагрузок, которым не страшна такая задержка.

Реплики чтения могут улучшить план аварийного восстановления. При наличии региональной аварии и недоступности главного сервера можно направить рабочую нагрузку в реплику в другом регионе. Для этого сначала позвольте реплике принимать записи, используя функцию «останавливает репликацию». Затем можно перенаправить приложение, обновив строку подключения. Дополнительные сведения см. в разделе " [Завершение репликации](#stop-replication) ".

## <a name="create-a-replica"></a>Создание реплики

Если у главного сервера нет серверов реплики, главный сервер сначала перезапустится, чтобы подготовиться к репликации.

При запуске рабочего процесса создания реплики будет создан пустой сервер базы данных Azure для MariaDB. Этот сервер заполняется данными, которые были на главном сервере. Время создания зависит от объема данных на главном сервере и времени, прошедшего с момента последнего еженедельного полного резервного копирования. Время может варьироваться от нескольких минут до нескольких часов.

> [!NOTE]
> Если вы еще не настроили оповещения хранилища на серверах, рекомендуем сделать это сейчас. Это позволит получать сведения о приближении к заполнению хранилища на сервере, которое влияет на эффективность репликации.

Дополнительные сведения о создании реплики чтения на портале Azure см. [здесь](howto-read-replicas-portal.md).

## <a name="connect-to-a-replica"></a>Подключение к реплике

Создаваемая реплика не наследует от главного сервера правила брандмауэра или конечную точку службы виртуальной сети. Эти правила следует настроить для каждой реплики отдельно.

Реплика наследует от главного сервера учетную запись администратора. Также на реплики чтения копируются все учетные записи пользователей с главного сервера. К реплике чтения можно подключиться только с помощью учетных записей пользователей, доступных на главном сервере.

Вы можете подключиться к реплике, используя ее имя узла и допустимую учетную запись пользователя, как и на обычной базе данных Azure для сервера MariaDB. Для сервера с именем **MyReplica»** и именем администратора **MyAdmin**можно подключиться к реплике с помощью MySQL CLI:

```bash
mysql -h myreplica.mariadb.database.azure.com -u myadmin@myreplica -p
```

При появлении запроса введите пароль для учетной записи пользователя.

## <a name="monitor-replication"></a>Мониторинг репликации

База данных Azure для MariaDB обеспечивает **задержку репликации в секундах** в Azure Monitor. Эта метрика доступна только для реплик.

Эта метрика вычисляется с `seconds_behind_master` помощью метрики, доступной `SHOW SLAVE STATUS` в команде MariaDB.

Настройте оповещение, чтобы сообщить вам, когда задержка репликации достигнет значения, неприемлемого для вашей рабочей нагрузки.

## <a name="stop-replication"></a>Остановка репликации

Вы можете остановить репликацию между главным сервером и репликой. После остановки репликации между главным сервером и репликой чтения реплика становится отдельным сервером. На отдельном сервере сохраняются все данные, которые существовали на нем на момент запуска команды "Остановить репликацию". Данные на изолированном сервере не синхронизируются с главным сервером.

Если вы решили отключить репликацию в реплике, она теряет все ссылки на предыдущие главные и другие реплики. Автоматическая отработка отказа между главным и ее репликами отсутствует.

> [!IMPORTANT]
> Это сервер нельзя снова преобразовать в реплику.
> Прежде, чем останавливать репликацию в реплике чтения убедитесь, что реплика содержит все необходимые данные.

Процесс остановки репликации описан в [этой статье](howto-read-replicas-portal.md).

## <a name="considerations-and-limitations"></a>Ограничения и рекомендации

### <a name="pricing-tiers"></a>Ценовые категории

Реплики чтения сейчас доступны только в ценовых категориях "Общее назначение" и "Оптимизировано для памяти".

### <a name="master-server-restart"></a>Перезапуск главного сервера

При создании реплики для главного сервера, не имеющего существующих реплик, сначала выполняется перезапуск, чтобы подготовиться к репликации. Следует это учитывать и выполнять такие операции в период низкой нагрузки.

### <a name="new-replicas"></a>Новые реплики

Реплика чтения создается как новый сервер базы данных Azure для MariaDB. Существующий сервер нельзя снова преобразовать в реплику. Невозможно создать реплику другой реплики чтения.

### <a name="replica-configuration"></a>Конфигурация реплики

Реплика создается с той же конфигурацией сервера, что и у главного сервера. После создания реплики некоторые параметры могут быть изменены независимо от главного сервера: поколение вычислений, виртуальных ядер, хранилище, срок хранения резервных копий и версия подсистемы MariaDB. Изменить также можно ценовую категорию (за исключением уровня "Базовый").

> [!IMPORTANT]
> Прежде чем изменить параметры конфигурации на главном сервере, установите на каждой реплике такие же или более высокие значения. Это позволит реплике справляться с нагрузкой, соответствующей новым параметрам главного сервера.

### <a name="stopped-replicas"></a>Остановленные реплики

Если остановить репликацию между главным сервером и репликой чтения, то остановленная реплика станет автономным сервером, принимающим операции чтения и записи. Это сервер нельзя снова преобразовать в реплику.

### <a name="deleted-master-and-standalone-servers"></a>Удаленные главного и отдельного серверов

При удалении главного сервера репликация останавливается для всех реплик чтения. Эти реплики становятся изолированными серверами. Удаляется сам главный сервер.

### <a name="user-accounts"></a>Учетные записи пользователей

Пользователи на главном сервере реплицируются в реплики чтения. К реплике чтения можно подключиться только с помощью учетных записей пользователей, доступных на главном сервере.

### <a name="server-parameters"></a>Параметры сервера

Чтобы предотвратить синхронизацию данных и избежать возможной потери или повреждения данных, некоторые параметры сервера не обновляются при использовании реплик чтения.

На серверах главной и реплики заблокированы следующие параметры сервера:
- [`innodb_file_per_table`](https://mariadb.com/kb/en/library/innodb-system-variables/#innodb_file_per_table) 
- [`log_bin_trust_function_creators`](https://mariadb.com/kb/en/library/replication-and-binary-log-system-variables/#log_bin_trust_function_creators)

[`event_scheduler`](https://mariadb.com/kb/en/library/server-system-variables/#event_scheduler) Параметр заблокирован на серверах реплик.

### <a name="other"></a>Другие

- Создание реплики реплики не поддерживается.
- Таблицы в памяти могут вызывать рассинхронизацию реплик. Это ограничение технологии репликации MariaDB.
- Убедитесь, что у таблиц главного сервера есть первичные ключи. Отсутствие первичных ключей может привести к задержке репликации между главным сервером и репликами.

## <a name="next-steps"></a>Следующие шаги

- Узнайте, как [создавать реплики чтения и управлять ими с помощью портала Azure](howto-read-replicas-portal.md).
