---
title: Смена сертификатов для базы данных Azure для MariaDB
description: Узнайте о предстоящих изменениях изменений корневого сертификата, которые повлияют на базу данных Azure для MariaDB
author: kummanish
ms.author: manishku
ms.service: mariadb
ms.topic: conceptual
ms.date: 09/02/2020
ms.openlocfilehash: ba5a1a0eb61ca086c3cd1ea66acddc18e950871d
ms.sourcegitcommit: 814778c54b59169c5899199aeaa59158ab67cf44
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2020
ms.locfileid: "90057246"
---
# <a name="understanding-the-changes-in-the-root-ca-change-for-azure-database-for-mariadb"></a>Основные сведения об изменениях в корневом центре сертификации для базы данных Azure для MariaDB

База данных Azure для MariaDB будет изменять корневой сертификат для клиентского приложения или драйвера, включенного с помощью SSL. Используйте для [подключения к серверу базы данных](concepts-connectivity-architecture.md). Срок действия корневого сертификата в настоящее время истекает 26 октября 2020 (10/26/2020) в рамках стандартных рекомендаций по обслуживанию и обеспечению безопасности. В этой статье приводятся дополнительные сведения о предстоящих изменениях, ресурсах, которые будут затронуты, и действиях, которые необходимо выполнить, чтобы обеспечить поддержку подключения приложения к серверу базы данных.

## <a name="what-update-is-going-to-happen"></a>Какое обновление будет выполнено?

В некоторых случаях приложения используют локальный файл сертификата, созданный из файла сертификата доверенного центра сертификации (ЦС) для безопасного подключения. Сейчас клиенты могут использовать только предопределенный сертификат для подключения к серверу базы данных Azure для MariaDB, расположенному [здесь](https://www.digicert.com/CACerts/BaltimoreCyberTrustRoot.crt.pem). Однако в [браузере центра сертификации (ЦС) на форуме](https://cabforum.org/)   Недавно опубликованные отчеты о нескольких сертификатах, выданных поставщиками ЦС, не соответствуют требованиям.

Согласно требованиям отрасли поставщики ЦС начали отменять сертификаты ЦС для несоответствующих центров сертификации, требовать, чтобы серверы использовали сертификаты, выпущенные соответствующими центрами сертификации, и подписали сертификаты ЦС из соответствующих центров сертификации. Так как база данных Azure для MariaDB в настоящее время использует один из этих несоответствующих сертификатов, которые клиентские приложения используют для проверки своих SSL-подключений, необходимо убедиться, что выполнены соответствующие действия (описанные ниже), чтобы максимально уменьшить потенциальное воздействие на серверы MariaDB.


Новый сертификат будет использоваться начиная с 26 октября 2020 г. (10/26/2020). При использовании проверки ЦС или полной проверки сертификата сервера при подключении из клиента MySQL (sslmode = Verify-CA или sslmode = Verify-Full) необходимо обновить конфигурацию приложения до 26 октября 2020 г. (10/26/2020).

## <a name="how-do-i-know-if-my-database-is-going-to-be-affected"></a>Разделы справки понять, будет ли затронута моя база данных?

Все приложения, использующие SSL/TLS и проверяющие корневой сертификат, должны обновить корневой сертификат для подключения к базе данных Azure для MariaDB. Если вы сейчас не используете SSL/TLS, это не повлияет на доступность вашего приложения. Вы можете проверить, пытается ли клиентское приложение использовать режим SSL с предопределенным доверенным центром сертификации (CA) [здесь](concepts-ssl-connection-security.md#default-settings).

Чтобы предотвратить прерывание доступности приложения из-за неожиданного отзыва сертификатов или обновления сертификата, который был отозван, см. раздел [**"что нужно сделать для поддержания подключения"**](concepts-certificate-rotation.md#what-do-i-need-to-do-to-maintain-connectivity) .

## <a name="what-do-i-need-to-do-to-maintain-connectivity"></a>Что нужно сделать для поддержания подключения

Чтобы избежать прерывания доступности приложения из-за неожиданного отзыва сертификатов или обновления сертификата, который был отозван, выполните следующие действия:

*   Скачайте **BaltimoreCyberTrustRoot**  &  **DigiCertGlobalRootG2** CA по ссылкам ниже:
    *   https://www.digicert.com/CACerts/BaltimoreCyberTrustRoot.crt.pem
    *   https://cacerts.digicert.com/DigiCertGlobalRootG2.crt.pem

*   Создайте объединенное хранилище сертификатов ЦС с сертификатами **BaltimoreCyberTrustRoot** и **DigiCertGlobalRootG2** .
    *   Для пользователей Java (MariaDB Connector/J) выполните:

          ```azurecli-interactive
          keytool -importcert -alias MariaDBServerCACert  -file D:\BaltimoreCyberTrustRoot.crt.pem  -keystore truststore -storepass password -noprompt
          ```

          ```azurecli-interactive
          keytool -importcert -alias MariaDBServerCACert2  -file D:\DigiCertGlobalRootG2.crt.pem -keystore truststore -storepass password  -noprompt
          ```

          Затем замените исходный файл хранилища ключей новым созданным файлом.
        *   System. setProperty ("жавакс. NET. SSL. trustStore", "path_to_truststore_file"); 
        *   System. setProperty ("жавакс. NET. SSL. trustStorePassword", "пароль");
    *   Для пользователей .NET (MariaDB Connector/NET, Мариадбконнектор) убедитесь, что в хранилище сертификатов Windows существуют и другие доверенные корневые центры сертификации ( **BaltimoreCyberTrustRoot** и **DigiCertGlobalRootG2** ). Если какие либо сертификаты не существуют, импортируйте недостающий сертификат.

        ![Сертификат .NET для базы данных Azure для MariaDB](media/overview/netconnecter-cert.png)

    *   Для пользователей .NET в Linux, использующих SSL_CERT_DIR, убедитесь, что **BaltimoreCyberTrustRoot** и **DigiCertGlobalRootG2** существуют в каталоге, указанном SSL_CERT_DIR. Если какие либо сертификаты не существуют, создайте недостающий файл сертификата.

    *   Для других пользователей (MariaDB Client/MariaDB Workbench/C/C++/го/Писон/Руби/ФП/нодежс/Перл/Свифт) можно выполнить слияние двух файлов сертификатов ЦС, таких как приведенный ниже формат.</b>

        </br>-----НАЧАТЬ-----СЕРТИФИКАТА
 </br>(Корневой CA1: BaltimoreCyberTrustRoot. CRT. PEM)
 </br>----------КОНЕЧНОГО СЕРТИФИКАТА
 </br>-----НАЧАТЬ-----СЕРТИФИКАТА
 </br>(Корневой CA2: DigiCertGlobalRootG2. CRT. PEM)
 </br>----------КОНЕЧНОГО СЕРТИФИКАТА

*   Замените исходный файл PEM корневого центра сертификации на объединенный файл корневого ЦС и перезапустите приложение или клиент.
*   В будущем после развертывания нового сертификата на стороне сервера можно изменить PEM-файл CA на DigiCertGlobalRootG2. CRT. PEM.

## <a name="what-can-be-the-impact"></a>Что может быть повлияло?
Если вы используете сертификат, выданный в базе данных Azure для MariaDB, как описано здесь, доступность приложения может быть прервана, так как база данных не будет доступна. В зависимости от приложения могут быть получены различные сообщения об ошибках, включая, но не ограниченные:
*   Недопустимый сертификат или отозванный сертификат
*   Время ожидания подключения истекло
*   Ошибка, если применимо

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

### <a name="1-if-i-am-not-using-ssltls-do-i-still-need-to-update-the-root-ca"></a>1. Если я не использую SSL/TLS, мне все равно нужно обновить корневой ЦС?
Если вы не используете SSL/TLS, никаких действий не требуется. 

### <a name="2-if-i-am-using-ssltls-do-i-need-to-restart-my-database-server-to-update-the-root-ca"></a>2. Если я использую SSL/TLS, нужно ли перезапустить сервер базы данных, чтобы обновить корневой ЦС?
Нет, не нужно перезагружать сервер базы данных, чтобы приступить к использованию нового сертификата. Это изменение на стороне клиента, и для входящих клиентских подключений необходимо использовать новый сертификат, чтобы обеспечить возможность подключения к серверу базы данных.

### <a name="3-what-will-happen-if-i-do-not-update-the-root-certificate-before-october-26-2020-10262020"></a>3. что произойдет, если не обновить корневой сертификат до 26 октября 2020 (10/26/2020)?
Если вы не обновите корневой сертификат до 30 ноября 2020, то приложения, подключающиеся по протоколу SSL/TLS и выполняющие проверку корневого сертификата, не смогут взаимодействовать с сервером базы данных MariaDB, и приложение будет испытывать проблемы с подключением к серверу базы данных MariaDB.

### <a name="4-do-i-need-to-plan-a-maintenance-downtime-for-this-changebr"></a>4. нужно ли мне запланировать время простоя обслуживания для этого изменения?<BR>
Нет. Так как изменение здесь происходит только на стороне клиента для подключения к серверу базы данных, для этого изменения не требуется простоя обслуживания.

### <a name="5--what-if-i-cannot-get-a-scheduled-downtime-for-this-change-before-october-26-2020-10262020"></a>5. что делать, если не удается получить запланированное время простоя для этого изменения до 26 октября 2020 (10/26/2020)?
Так как клиенты, используемые для подключения к серверу, должны обновить сведения о сертификате, как описано в разделе Исправление [здесь](./concepts-certificate-rotation.md#what-do-i-need-to-do-to-maintain-connectivity), в этом случае не требуется простоя сервера.

###  <a name="6-if-i-create-a-new-server-after-nov-30th-will-i-be-impacted"></a>6. Если я создам новый сервер после 30 ноября, будет ли это повлиять?
Для серверов, созданных после 26 октября 2020 (10/26/2020), можно использовать только что выпущенный сертификат для подключения приложений по протоколу SSL.

### <a name="7-how-often-does-microsoft-update-their-certificates-or-what-is-the-expiry-policy"></a>7. как часто Корпорация Майкрософт обновляет свои сертификаты или какова политика срока действия?
Эти сертификаты, используемые базой данных Azure для MariaDB, предоставляются доверенными центрами сертификации (CA). Поэтому поддержка этих сертификатов в базе данных Azure для MariaDB связана с поддержкой этих сертификатов центром сертификации. Однако, как и в этом случае, в этих стандартных сертификатах могут воздержаться непредвиденные ошибки, которые должны быть исправлены самым ранним образом.

### <a name="8-if-i-am-using-read-replicas-do-i-need-to-perform-this-update-only-on-master-server-or-all-the-read-replicas"></a>8. Если я использую для чтения реплики, нужно ли выполнять это обновление только на главном сервере или во всех репликах чтения?
Так как это обновление является изменением на стороне клиента, если клиент использовался для считывания данных с сервера реплики, необходимо также применить изменения для этих клиентов. 

### <a name="9-do-we-have-server-side-query-to-verify-if-ssl-is-being-used"></a>9. у нас есть запрос на стороне сервера, чтобы проверить, используется ли протокол SSL?
Чтобы проверить, используется ли SSL-соединение для подключения к серверу, обратитесь к [проверке SSL](howto-configure-ssl.md#verify-the-ssl-connection).

### <a name="10-what-if-i-have-further-questions"></a>10. что делать, если у меня возникнут дополнительные вопросы?
Если у вас есть вопросы, получите ответы от экспертов сообщества в [Microsoft Q&а](mailto:AzureDatabaseformariadb@service.microsoft.com). Если у вас есть план поддержки и вам нужна техническая помощь, [свяжитесь с нами](mailto:AzureDatabaseformariadb@service.microsoft.com)
