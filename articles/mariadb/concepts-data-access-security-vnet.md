---
title: Конечные точки службы виртуальной сети — база данных Azure для MariaDB
description: Описание работы конечных точек служб виртуальной сети Базы данных Azure для сервера MariaDB.
author: ajlam
ms.author: andrela
ms.service: mariadb
ms.topic: conceptual
ms.date: 12/02/2019
ms.openlocfilehash: 17c957dbd9c43b3cc66af39195a73bad8e006814
ms.sourcegitcommit: 3dc1a23a7570552f0d1cc2ffdfb915ea871e257c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/15/2020
ms.locfileid: "75982348"
---
# <a name="use-virtual-network-service-endpoints-and-rules-for-azure-database-for-mariadb"></a>Сведения об использовании конечных точек служб и правил виртуальной сети с Базой данных Azure для MariaDB

*Правила виртуальной сети* — это одна из функций безопасности брандмауэра, обеспечивающая управление приемом сервером базы данных Azure для MariaDB подключений из определенных подсетей в виртуальных сетях. В этой статье объясняется, почему правила виртуальной сети иногда являются лучшим вариантом для защиты подключений к серверу базы данных Azure для MariaDB.

Чтобы создать правило виртуальной сети, необходимо сначала указать [виртуальную сеть][vm-virtual-network-overview] (VNet) и [конечную точку службы виртуальной сети][vm-virtual-network-service-endpoints-overview-649d] , на которую будет ссылаться правило. На следующем рисунке показано, как конечная точка службы для виртуальной сети работает с базой данных Azure для MariaDB.

![Пример того, как работает конечная точка службы виртуальной сети](media/concepts-data-access-security-vnet/vnet-concept.png)

> [!NOTE]
> Эта функция доступна во всех областях Azure, где База данных Azure для MariaDB развернута для серверов общего назначения и оптимизированных для операций в памяти.

<a name="anch-terminology-and-description-82f" />

## <a name="terminology-and-description"></a>Терминология и описание

**Виртуальная сеть**. С подпиской Azure могут быть связаны виртуальные сети.

**Подсеть**. Виртуальная сеть содержит **подсети**. Все ваши виртуальные машины Azure назначены в подсети. Одна подсеть может содержать несколько виртуальных машин или других вычислительных узлов. Вычислительные узлы, которые находятся вне вашей виртуальной сети, не имеют доступа к ней, если только не настроить систему безопасности таким образом, чтобы предоставить им доступ.

[Конечные точки служб для виртуальной сети][vm-virtual-network-service-endpoints-overview-649d]. **Конечная точка службы для виртуальной сети** — это подсеть, значения свойств которой включают в себя одно или несколько формальных имен типов службы Azure. В этой статье мы рассмотрим тип **Microsoft.Sql**, который относится к службе Azure, которая называется Базой данных SQL. Этот тег службы также применяется к службам Базы данных Azure для MariaDB, MySQL и PostgreSQL. Важно отметить, что при применении тега службы **Microsoft.Sql** к конечной точке службы виртуальной сети она настроит трафик конечной точки службы для всех присутствующих в подсети серверов Базы данных SQL Azure, Базы данных Azure для MySQL, Базы данных Azure для MariaDB и Базы данных Azure для PostgreSQL.

**Правило виртуальной сети**. Правило виртуальной сети для сервера базы данных Azure для MariaDB — это подсеть, которая указана в списке управления доступом (ACL) сервера базы данных Azure для MariaDB. Для включения в ACL для сервера базы данных Azure для MariaDB подсеть должна содержать имя типа **Microsoft.Sql**.

Правило виртуальной сети предписывает серверу базы данных Azure для MariaDB принимать подключения от всех узлов, находящихся в подсети.







<a name="anch-benefits-of-a-vnet-rule-68b" />

## <a name="benefits-of-a-virtual-network-rule"></a>Преимущества правила виртуальной сети

Пока вы не выполните соответствующие действия, виртуальные машины в подсети не могут взаимодействовать с сервером базы данных Azure для MariaDB. Создание правила виртуальной сети — это единственное действие, которое устанавливает подключение. Чтобы обосновать выбор подхода на основе правил виртуальной сети, требуется сравнить преимущества и недостатки этого подхода с конкурирующими функциями безопасности, предоставляемыми брандмауэром.

### <a name="a-allow-access-to-azure-services"></a>A. Разрешение доступа к службам Azure

На панели безопасности подключения есть кнопка **Вкл./Выкл.** с надписью **Разрешить доступ к службам Azure**. Значение **ON** (Вкл.) разрешает подключение со всех IP-адресов Azure и из всех подсетей Azure. Эти Azure IP-адреса и подсети могут принадлежать не вам. Возможно, значение **Вкл.** делает вашу систему более открытой, чем требуется для базы данных Azure для MariaDB. Правила виртуальной сети обеспечивают более детализированный контроль.

### <a name="b-ip-rules"></a>Б. Правила фильтрации IP-адресов

Брандмауэр базы данных Azure для MariaDB позволяет указать диапазоны IP-адресов, подключения с которых принимаются базой данных Azure для MariaDB. Эта методика хорошо подходит для постоянных IP-адресов, которые находятся за пределами частной сети Azure. Однако за пределами частной сети Azure используется множество *динамических* IP-адресов. Динамические IP-адреса могут изменяться, например при перезапуске виртуальной машины. Было бы неразумно указывать динамический IP-адрес в правиле брандмауэра в рабочей среде.

Можно сохранить выбранный IP-адрес, присвоив виртуальной машине *статический* IP-адрес. Дополнительные сведения см. [в статье Настройка частных IP-адресов для виртуальной машины с помощью портал Azure][vm-configure-private-ip-addresses-for-a-virtual-machine-using-the-azure-portal-321w].

Однако применение статических IP-адресов может усложнить управление и создать дополнительные расходы при увеличении масштаба среды. Правила виртуальной сети проще устанавливать и контролировать.

### <a name="c-cannot-yet-have-azure-database-for-mariadb-on-a-subnet-without-defining-a-service-endpoint"></a>В. Базу данных Azure для MariaDB невозможно создать в подсети без определения конечной точки службы

Если сервер **Microsoft.Sql** будет узлом в подсети виртуальной сети, то все узлы в этой виртуальной сети смогут взаимодействовать с сервером базы данных Azure для MariaDB. В этом случае виртуальные машины могут взаимодействовать с базой данных Azure для MariaDB без дополнительных правил виртуальной сети или фильтрации IP-адресов.

Однако, по состоянию на август 2018 года служба Базы данных Azure для MariaDB еще не вошла в список служб, которые можно напрямую назначить в подсеть.

<a name="anch-details-about-vnet-rules-38q" />

## <a name="details-about-virtual-network-rules"></a>Сведения о правилах виртуальной сети

В этом разделе приводятся некоторые сведения о правилах виртуальной сети.

### <a name="only-one-geographic-region"></a>Только один географический регион

Каждая конечная точка службы для виртуальной сети может использоваться только в одном регионе Azure. Конечная точка не поддерживает прием подключений из подсети в других регионах.

Любое правило виртуальной сети ограничена регионом, в котором используется базовая конечная точка.

### <a name="server-level-not-database-level"></a>На уровне сервера, а не базы данных

Каждое правило виртуальной сети применяется ко всему серверу базы данных Azure для MariaDB, а не только к одной конкретной базе данных на сервере. Другими словами, правило виртуальной сети применяется на уровне сервера,а не на уровне базы данных.

### <a name="security-administration-roles"></a>Роли администратора безопасности

Роли безопасности для администрирования конечных точек служб для виртуальной сети разделены. Требуется действие каждой из следующих ролей:

- **Администратор сети:** &nbsp; включить конечную точку.
- **Администратор базы данных:** &nbsp; обновить список управления доступом (ACL), чтобы добавить данную подсеть к серверу базы данных Azure для MariaDB.

*Альтернатива RBAC*

Роли администратора сети и администратора базы данных имеют больше возможностей, чем требуется для управления правилами виртуальной сети. На самом деле для этого требуется только часть их возможностей.

Вы можете использовать [Управление доступом на основе ролей (RBAC)][rbac-what-is-813s] в Azure, чтобы создать одну настраиваемую роль, имеющую только необходимое подмножество возможностей. Вместо администратора сети или администратора базы данных можно использовать пользовательскую роль. При добавлении пользователя в пользовательскую роль контактная зона снижает уровень безопасности, а не добавляет пользователя к двум другим основным ролям администратора.

> [!NOTE]
> Иногда база данных Azure для MariaDB и подсеть виртуальной сети относятся к разным подпискам. В этих случаях необходимо обеспечить следующую конфигурацию:
> - Обе подписки должны быть в одном клиенте Azure Active Directory.
> - Пользователь должен иметь необходимые разрешения для запуска операций, например для включения конечных точек службы или добавления подсети виртуальной сети к заданному серверу.
> - Убедитесь, что у обеих подписок есть зарегистрированный поставщик ресурсов **Microsoft. SQL** . Дополнительные сведения см. в статье [Регистрация в диспетчере ресурсов][resource-manager-portal] .

## <a name="limitations"></a>Ограничения

Для базы данных Azure для MariaDB правила виртуальной сети имеют следующие ограничения.

- Веб-приложения можно сопоставить с частным IP-адресом в виртуальной сети или подсети. Даже если конечные точки службы включены в определенной виртуальной сети или подсети, при подключении из веб-приложения к серверу в качестве источника будет использоваться открытый IP-адрес Azure, виртуальная сеть или подсеть. Чтобы обеспечить подключение веб-приложения к серверу, который имеет правила брандмауэра виртуальной сети, необходимо разрешить службам Azure доступ к серверу на сервере.

- В брандмауэре для базы данных Azure для MariaDB каждое правило виртуальной сети ссылается на подсеть. Все подсети, на которые есть ссылки, должны размещаться в том же географическом регионе, где размещена база данных Azure для MariaDB.

- Каждый сервер базы данных Azure для MariaDB может использовать до 128 записей ACL для любой виртуальной сети.

- Правила виртуальной сети применяются только к виртуальным сетям Azure Resource Manager. а не в [классические сети модели развертывания][resource-manager-deployment-model-568f] .

- Включение конечных точек службы виртуальной сети для Базы данных Azure для MariaDB с помощью тега службы **Microsoft.Sql** также включает конечные точки для всех служб базы данных Azure: Базы данных Azure для MySQL, Базы данных Azure для MariaDB, Базы данных Azure для PostgreSQL, Базы данных SQL Azure и хранилища данных SQL Azure.

- Поддержка конечных точек службы виртуальной сети предназначена только для серверов общего назначения и серверов, оптимизированных для операций в памяти.

- К приведенным ниже элементам сети применяются диапазоны IP-адресов в брандмауэре, а правила виртуальной сети — нет:
    - [Виртуальная частная сеть (VPN) типа "сеть — сеть" (S2S)][vpn-gateway-indexmd-608y]
    - Локальная среда с помощью [ExpressRoute][expressroute-indexmd-744v]

## <a name="expressroute"></a>ExpressRoute

Если сеть подключена к сети Azure с помощью [ExpressRoute][expressroute-indexmd-744v], для каждого канала настраивается два общедоступных IP-адреса в Microsoft погранично. Эти два IP-адреса используются для подключения к службам Майкрософт, таким как служба хранилища Azure, с помощью общедоступного пиринга Azure.

Чтобы разрешить взаимодействие канала с базой данных Azure для MariaDB, создайте сетевые правила для общедоступных IP-адресов этого канала. Чтобы найти общедоступные IP-адреса канала ExpressRoute, отправьте запрос по ExpressRoute в службу поддержки через портал Azure.

## <a name="adding-a-vnet-firewall-rule-to-your-server-without-turning-on-vnet-service-endpoints"></a>Добавление правила брандмауэра виртуальной сети к серверу без включения конечных точек службы виртуальной сети

Если задано лишь правило брандмауэра, обеспечить безопасность сервера в виртуальной сети невозможно. Для безопасности нужно **включить** конечные точки службы виртуальной сети. При **включении** конечных точек службы подсеть виртуальной сети будет простаивать, пока не будет выполнен переход из состояния **Выкл.** в состояние **Вкл.** Это особенно верно в случае с большими виртуальными сетями. С помощью параметра **IgnoreMissingServiceEndpoint** можно уменьшить или исключить время простоя во время перехода.

Задать параметр **IgnoreMissingServiceEndpoint** можно с помощью Azure CLI или портала.

## <a name="related-articles"></a>Связанные статьи
- [Виртуальные сети Azure][vm-virtual-network-overview]
- [Конечные точки службы виртуальной сети Azure][vm-virtual-network-service-endpoints-overview-649d]

## <a name="next-steps"></a>Дальнейшие действия
Статьи о создании правил виртуальной сети см. по следующим ссылкам:
- [Создание правил виртуальной сети базы данных Azure для MariaDB и управление ими на портале Azure](howto-manage-vnet-portal.md)
 
<!--
- [Create and manage Azure Database for MariaDB VNet rules using Azure CLI](howto-manage-vnet-using-cli.md)
-->

<!-- Link references, to text, Within this same GitHub repo. -->
[resource-manager-deployment-model-568f]: ../azure-resource-manager/management/deployment-models.md

[vm-virtual-network-overview]: ../virtual-network/virtual-networks-overview.md

[vm-virtual-network-service-endpoints-overview-649d]: ../virtual-network/virtual-network-service-endpoints-overview.md

[vm-configure-private-ip-addresses-for-a-virtual-machine-using-the-azure-portal-321w]: ../virtual-network/virtual-networks-static-private-ip-arm-pportal.md

[rbac-what-is-813s]: ../active-directory/role-based-access-control-what-is.md

[vpn-gateway-indexmd-608y]: ../vpn-gateway/index.yml

[expressroute-indexmd-744v]: ../expressroute/index.yml

[resource-manager-portal]: ../azure-resource-manager/management/resource-providers-and-types.md
