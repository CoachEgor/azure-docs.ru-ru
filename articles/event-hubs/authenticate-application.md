---
title: Проверка подлинности приложения для доступа к ресурсам концентраторов событий Azure
description: В этой статье содержатся сведения о проверке подлинности приложения с помощью Azure Active Directory для доступа к ресурсам концентраторов событий Azure.
ms.topic: conceptual
ms.date: 06/23/2020
ms.openlocfilehash: 56c9033d5b44fde50ebac25bf194cbea486ad387
ms.sourcegitcommit: 0e8a4671aa3f5a9a54231fea48bcfb432a1e528c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/24/2020
ms.locfileid: "87131945"
---
# <a name="authenticate-an-application-with-azure-active-directory-to-access-event-hubs-resources"></a>Проверка подлинности приложения с Azure Active Directory для доступа к ресурсам концентраторов событий
Microsoft Azure предоставляет интегрированную систему управления доступом к ресурсам и приложениям на основе Azure Active Directory (Azure AD). Ключевым преимуществом использования Azure AD с концентраторами событий Azure является то, что вам больше не нужно хранить учетные данные в коде. Вместо этого можно запросить маркер доступа OAuth 2,0 на платформе Microsoft Identity. Имя ресурса для запроса маркера — `https://eventhubs.azure.net/` (для клиентов Kafka ресурс, запрашивающий маркер, — `https://<namespace>.servicebus.windows.net` ). Azure AD выполняет проверку подлинности субъекта безопасности (пользователя, группы или субъекта-службы), на котором выполняется приложение. Если проверка подлинности прошла, Azure AD возвращает маркер доступа к приложению, а приложение может использовать маркер доступа для авторизации запросов к ресурсам концентраторов событий Azure.

Когда роль назначается субъекту безопасности Azure AD, Azure предоставляет доступ к этим ресурсам для этого субъекта безопасности. Доступ может быть ограничен уровнем подписки, группой ресурсов, пространством имен концентраторов событий или любым ресурсом. Безопасность Azure AD может назначать роли пользователю, группе, субъекту-службе приложения или [управляемому удостоверению для ресурсов Azure](../active-directory/managed-identities-azure-resources/overview.md). 

> [!NOTE]
> Определение роли представляет собой коллекцию разрешений. Управление доступом на основе ролей (RBAC) управляет применением этих разрешений с помощью назначения ролей. Назначение ролей состоит из трех элементов: субъект безопасности, определение роли и область действия. Дополнительные сведения см. [в разделе понимание различных ролей](../role-based-access-control/overview.md).

## <a name="built-in-roles-for-azure-event-hubs"></a>Встроенные роли для концентраторов событий Azure
Azure предоставляет следующие встроенные роли RBAC для авторизации доступа к данным концентраторов событий с помощью Azure AD и OAuth:

- [Владелец данных концентраторов событий Azure](../role-based-access-control/built-in-roles.md#azure-event-hubs-data-owner). Используйте эту роль, чтобы предоставить полный доступ к ресурсам концентраторов событий.
- [Отправитель данных концентраторов событий Azure](../role-based-access-control/built-in-roles.md#azure-event-hubs-data-sender). Используйте эту роль, чтобы предоставить доступ на отправку ресурсам концентраторов событий.
- [Приемник данных концентраторов событий Azure](../role-based-access-control/built-in-roles.md#azure-event-hubs-data-receiver). Используйте эту роль, чтобы предоставить доступ к ресурсам концентраторов событий.   

> [!IMPORTANT]
> Наш предварительный выпуск поддерживал добавление привилегий доступа к данным концентраторов событий к роли владельца или участника. Однако права доступа к данным для роли владельца и участника больше не учитываются. Если вы используете роль владельца или участника, переключитесь на использование роли владельца данных концентраторов событий Azure.

## <a name="assign-rbac-roles-using-the-azure-portal"></a>Назначение ролей RBAC с помощью портал Azure  
Дополнительные сведения об управлении доступом к ресурсам Azure с помощью RBAC и портал Azure см. в [этой статье](..//role-based-access-control/role-assignments-portal.md). 

Определив соответствующую область для назначения ролей, перейдите к этому ресурсу в портал Azure. Отобразить параметры управления доступом (IAM) для ресурса и выполнить следующие инструкции для управления назначениями ролей:

> [!NOTE]
> Описанные ниже действия назначают роль концентратора событий в пространствах имен концентраторов событий, но вы можете выполнить те же действия, чтобы назначить роль, ограниченную любым ресурсом концентраторов событий.

1. На [портале Azure](https://portal.azure.com/) перейдите к пространству имен Центров событий.
2. На странице **Обзор** выберите концентратор событий, для которого требуется назначить роль.

    ![Выберите концентратор событий](./media/authenticate-application/select-event-hub.png)
1. Выберите **Управление доступом (IAM)** , чтобы отобразить параметры управления доступом для концентратора событий. 
1. Выберите вкладку **Назначения ролей**, чтобы просмотреть список назначений ролей. Нажмите кнопку **Добавить** на панели инструментов, а затем выберите **добавить назначение ролей**. 

    ![Кнопка "Добавить" на панели инструментов](./media/authenticate-application/role-assignments-add-button.png)
1. На странице **Добавление назначения ролей** выполните следующие действия.
    1. Выберите **роль концентраторов событий** , которую требуется назначить. 
    1. Найдите **участника безопасности** (пользователя, группы, субъекта-службы), которому нужно назначить роль.
    1. Нажмите кнопку **сохранить** , чтобы сохранить назначение ролей. 

        ![Назначение роли пользователю](./media/authenticate-application/assign-role-to-user.png)
    4. Удостоверение, которому назначена роль RBAC, будет отображаться в списке под этой ролью. Например, на следующем рисунке показано, что Azure-Users находится в роли владельца данных концентратора событий Azure. 
        
        ![Пользователь в списке](./media/authenticate-application/user-in-list.png)

Вы можете выполнить аналогичные действия, чтобы назначить роль для пространства имен концентраторов событий, группы ресурсов или подписки. Определив роль и ее область, вы можете проверить это поведение с помощью примеров [в этом расположении GitHub](https://github.com/Azure/azure-event-hubs/tree/master/samples/DotNet/Microsoft.Azure.EventHubs/Rbac).


## <a name="authenticate-from-an-application"></a>Аутентификация из приложения
Ключевым преимуществом использования Azure AD с концентраторами событий является то, что ваши учетные данные больше не нужно хранить в коде. Вместо этого можно запросить маркер доступа OAuth 2,0 на платформе Microsoft Identity. Azure AD выполняет проверку подлинности субъекта безопасности (пользователя, группы или субъекта-службы), на котором выполняется приложение. Если проверка подлинности прошла удачно, Azure AD возвращает маркер доступа приложению, а приложение может использовать маркер доступа для авторизации запросов к концентраторам событий Azure.

В следующих разделах показано, как настроить собственное приложение или веб-приложение для проверки подлинности с помощью Microsoft Identity Platform 2,0. Дополнительные сведения о платформе Microsoft Identity Platform 2,0 см. в статье [Обзор платформы Microsoft Identity Platform (v 2.0)](../active-directory/develop/v2-overview.md).

Общие сведения о процессе предоставления кода OAuth 2.0 представлены в разделе [Авторизация доступа к веб-приложениям Azure Active Directory с помощью потока предоставления кода OAuth 2.0](../active-directory/develop/v2-oauth2-auth-code-flow.md).

### <a name="register-your-application-with-an-azure-ad-tenant"></a>Регистрация приложения в клиенте Azure AD
Первым шагом в использовании Azure AD для авторизации ресурсов концентраторов событий является регистрация клиентского приложения в клиенте Azure AD из [портал Azure](https://portal.azure.com/). При регистрации клиентского приложения вы предоставляете сведения о приложении в AD. Затем Azure AD предоставляет идентификатор клиента (также называемый ИДЕНТИФИКАТОРом приложения), с помощью которого можно связать приложение со средой выполнения Azure AD. Дополнительные сведения об идентификаторе клиента см. в статье [Объекты приложения и субъекта-службы в Azure Active Directory](../active-directory/develop/app-objects-and-service-principals.md). 

На следующих изображениях показаны шаги для регистрации веб-приложения.

![Регистрация приложения](./media/authenticate-application/app-registrations-register.png)

> [!Note]
> При регистрации приложения в качестве собственного приложения можно указать любой допустимый универсальный код ресурса (URI) для URI перенаправления. Для собственных приложений это значение не обязательно должно быть действительным URL-адресом. Для веб-приложений URI перенаправления должен быть допустимым URI, так как он указывает URL-адрес, на который предоставляются токены.

После регистрации приложения в разделе **Параметры**отобразится **идентификатор приложения (клиента)** .

![Идентификатор приложения зарегистрированного приложения](./media/authenticate-application/application-id.png)

Дополнительные сведения о регистрации приложения в Azure AD см. в разделе [Интеграция приложений с Azure Active Directory](../active-directory/develop/quickstart-register-app.md).


### <a name="create-a-client-secret"></a>Создание секрета клиента   
Приложению требуется секрет клиента для подтверждения его личности при запросе маркера. Чтобы добавить секрет клиента, выполните следующие действия.

1. Перейдите к регистрации приложения в портал Azure.
1. Выберите параметр **сертификаты & секреты** .
1. В разделе **секреты клиента**выберите **новый секрет клиента** , чтобы создать новый секрет.
1. Введите описание секрета и выберите желаемый интервал срока действия.
1. Немедленно скопируйте значение нового секрета в безопасное расположение. Значение заполнения отображается только один раз.

    ![Секрет клиента](./media/authenticate-application/client-secret.png)


### <a name="client-libraries-for-token-acquisition"></a>Клиентские библиотеки для получения маркера  
После регистрации приложения и предоставления ему разрешений на отправку и получение данных в концентраторах событий Azure можно добавить код в приложение для проверки подлинности субъекта безопасности и получения маркера OAuth 2,0. Для проверки подлинности и получения маркера можно использовать одну из [библиотек проверки подлинности платформы идентификации Microsoft Identity](../active-directory/develop/reference-v2-libraries.md) или другую библиотеку с открытым исходным кодом, которая поддерживает OpenID Connect или Connect 1,0. Приложение может использовать маркер доступа для авторизации запросов к концентраторам событий Azure.

Список сценариев, для которых поддерживается получение маркеров, см. в разделе [сценарии](https://aka.ms/msal-net-scenarios) [библиотеки проверки подлинности Майкрософт (MSAL) для](https://github.com/AzureAD/microsoft-authentication-library-for-dotnet) репозитория GitHub .NET.

## <a name="samples"></a>Примеры
- [Примеры Microsoft. Azure. EventHubs](https://github.com/Azure/azure-event-hubs/tree/master/samples/DotNet/Microsoft.Azure.EventHubs/Rbac). 
    
    В этих примерах используется старая библиотека **Microsoft. Azure. EventHubs** , но вы можете легко обновить ее, используя последнюю библиотеку **Azure. Messaging. EventHubs** . Чтобы переместить пример из старой библиотеки в новую, ознакомьтесь с [руководством по миграции из Microsoft. Azure. EventHubs в Azure. Messaging. EventHubs](https://github.com/Azure/azure-sdk-for-net/blob/master/sdk/eventhub/Azure.Messaging.EventHubs/MigrationGuide.md).
- [Примеры Azure. Messaging. EventHubs](https://github.com/Azure/azure-event-hubs/tree/master/samples/DotNet/Azure.Messaging.EventHubs/ManagedIdentityWebApp)

    Этот пример обновлен для использования последней библиотеки **Azure. Messaging. EventHubs** .

## <a name="next-steps"></a>Дальнейшие действия
- Дополнительные сведения о RBAC см. в статье [что такое управление доступом на основе ролей в Azure (Azure RBAC)](../role-based-access-control/overview.md)?
- Чтобы узнать, как назначать роли RBAC и управлять назначениями ролей с помощью Azure PowerShell, Azure CLI или REST API, см. сведения в статьях ниже:
    - [Управление доступом на основе ролей с помощью Azure PowerShell](../role-based-access-control/role-assignments-powershell.md)  
    - [Управление доступом на основе ролей с помощью интерфейса командной строки Azure](../role-based-access-control/role-assignments-cli.md)
    - [Управление доступом на основе ролей с помощью REST API](../role-based-access-control/role-assignments-rest.md)
    - [Управление доступом на основе ролей (RBAC) с помощью шаблонов Azure Resource Manager](../role-based-access-control/role-assignments-template.md)

См. следующие статьи:
- [Проверка подлинности управляемого удостоверения с Azure Active Directory для доступа к ресурсам концентраторов событий](authenticate-managed-identity.md)
- [Проверка подлинности запросов к концентраторам событий Azure с помощью подписанных URL](authenticate-shared-access-signature.md)
- [Авторизация доступа к ресурсам концентраторов событий с помощью Azure Active Directory](authorize-access-azure-active-directory.md)
- [Авторизация доступа к ресурсам концентраторов событий с помощью подписанных URL](authorize-access-shared-access-signature.md)
