---
title: Authenticate приложение для доступа к ресурсам Azure Event Hubs
description: В этой статье содержится информация о проверке подлинности приложения с помощью active Directory Azure для доступа к ресурсам Azure Event Hubs
services: event-hubs
ms.service: event-hubs
documentationcenter: ''
author: spelluru
ms.topic: conceptual
ms.date: 02/12/2020
ms.author: spelluru
ms.openlocfilehash: 4cef49f138b96848b8e59cb5b2d0b185d4568aa9
ms.sourcegitcommit: b0ff9c9d760a0426fd1226b909ab943e13ade330
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/01/2020
ms.locfileid: "80520995"
---
# <a name="authenticate-an-application-with-azure-active-directory-to-access-event-hubs-resources"></a>Authenticate приложение с помощью Active Directory Azure для доступа к ресурсам концентраторов событий
Microsoft Azure предоставляет интегрированную систему управления доступом к ресурсам и приложениям на основе Azure Active Directory (Azure AD). Ключевым преимуществом использования Azure AD с концентраторами azure Event является то, что вам больше не нужно хранить учетные данные в коде. Вместо этого вы можете запросить токен доступа OAuth 2.0 от платформы Microsoft Identity. Имя ресурса для запроса `https://eventhubs.azure.net/` токена (Для клиентов Kafka `https://<namespace>.servicebus.windows.net`ресурс для запроса токена). Azure AD проверяет подлинность принципаслужбы безопасности (пользователя, группы или основного обслуживания), работая с приложением. Если проверка подлинности удалась, Azure AD возвращает в приложение маркер доступа, и приложение может использовать контокен доступа для авторизации запроса на ресурсы Azure Event Hubs.

Когда роль назначается директору безопасности Azure AD, Azure предоставляет доступ к этим ресурсам для этого принципа безопасности. Доступ может быть доступен на уровне подписки, группы ресурсов, пространства имен событий концентраторов или любого ресурса под ним. Служба aD Azure может присвоить роли пользователю, группе, директору службы приложений или [управляемому иidentityусу для ресурсов Azure.](../active-directory/managed-identities-azure-resources/overview.md) 

> [!NOTE]
> Определение роли представляет собой коллекцию разрешений. Контроль доступа на основе ролей (RBAC) контролирует, как эти разрешения выполняются через назначение ролей. Назначение ролей состоит из трех элементов: субъект безопасности, определение роли и область действия. Для получения дополнительной [информации см.](../role-based-access-control/overview.md)

## <a name="built-in-roles-for-azure-event-hubs"></a>Встроенные роли для концентраторов событий Azure
Azure предоставляет следующие встроенные роли RBAC для авторизации доступа к данным событийных концентраторов с помощью Azure AD и OAuth:

- [Владелец данных Azure Event Hubs:](../role-based-access-control/built-in-roles.md#azure-event-hubs-data-owner)Используйте эту роль, чтобы предоставить полный доступ к ресурсам концентраторов событий.
- [Отправитель данных Azure Event Hubs](../role-based-access-control/built-in-roles.md#azure-event-hubs-data-sender): Используйте эту роль, чтобы предоставить доступ к ресурсам концентраторов событий.
- [Получатель данных Azure Event Hubs:](../role-based-access-control/built-in-roles.md#azure-event-hubs-data-receiver)Используйте эту роль, чтобы предоставить доступ к ресурсам концентраторов событий.   

> [!IMPORTANT]
> Наш предварительный выпуск поддерживал добавление привилегий доступа к данным Event Hubs к роли владельца или автора. Однако привилегии доступа к данным для роли владельца и вкладчика больше не соблюдаться. Если вы используете роль Владельца или Автора, переключитесь на использование роли владельца данных Концентраторов событий Azure.

## <a name="assign-rbac-roles-using-the-azure-portal"></a>Назначить роли RBAC с помощью портала Azure  
Подробнее об управлении ресурсами Azure с помощью RBAC и портала Azure можно узнать в [этой статье.](..//role-based-access-control/role-assignments-portal.md) 

После определения подходящей области для назначения ролей перейдите на этот ресурс на портале Azure. Отобразите настройки управления доступом (IAM) для ресурса и следуйте этим инструкциям для управления назначениями ролей:

> [!NOTE]
> Описанные ниже шаги присваивают роль концентратору событий под пространствами имен Событий концентратору, но вы можете следовать тем же шагам, чтобы назначить роль, присваиваемую любому ресурсу концентраторов событий.

1. На [портале Azure](https://portal.azure.com/)перейдите в пространство имен событий Hubs.
2. На странице **«Обзор»** выберите концентратор событий, для которого необходимо назначить роль.

    ![Выберите концентратор событий](./media/authenticate-application/select-event-hub.png)
1. Выберите **элемент управления доступом (IAM)** для отображения параметров управления доступом для концентратора событий. 
1. Выберите вкладку **Назначения ролей**, чтобы просмотреть список назначений ролей. Выберите кнопку **Добавить** на панели инструментов, а затем выберите **Добавить назначение ролей.** 

    ![Добавить кнопку на панели инструментов](./media/authenticate-application/role-assignments-add-button.png)
1. На странице **назначения ролей Добавить** сделайте следующие шаги:
    1. Выберите **роль концентраторов событий, которую** вы хотите назначить. 
    1. Поиск, чтобы найти **основную безопасность** (пользователь, группа, директор службы), которому вы хотите назначить роль.
    1. Выберите **Сохранить,** чтобы сохранить назначение ролей. 

        ![Назначить роль пользователю](./media/authenticate-application/assign-role-to-user.png)
    4. Удостоверение, которому назначена роль RBAC, будет отображаться в списке под этой ролью. Например, следующее изображение показывает, что пользователи Azure в роли владельца данных концентраторов Azure Event. 
        
        ![Пользователь в списке](./media/authenticate-application/user-in-list.png)

Можно выполнить аналогичные действия, чтобы назначить область действия в пространстве имен событий концентраторов, группе ресурсов или подписке. После определения роли и сферы действия можно проверить это поведение с помощью образцов [в этом месте GitHub.](https://github.com/Azure/azure-event-hubs/tree/master/samples/DotNet/Microsoft.Azure.EventHubs/Rbac)


## <a name="authenticate-from-an-application"></a>Аутентификация из приложения
Ключевым преимуществом использования Azure AD с концентраторами событий является то, что учетные данные больше не должны храниться в коде. Вместо этого вы можете запросить токен доступа OAuth 2.0 от платформы идентификации Майкрософт. Azure AD проверяет подлинность принципаслужбы безопасности (пользователя, группы или директора службы), работая с приложением. Если аутентификация удается, Azure AD возвращает маркер доступа в приложение, и приложение может использовать маркер доступа для авторизации запросов в концентраторы событий Azure.

Ниже приведены разделы, как настроить нативное приложение или веб-приложение для проверки подлинности с помощью платформы идентификации Microsoft 2.0. Для получения дополнительной информации о платформе [Microsoft identity platform (v2.0) overview](../active-directory/develop/v2-overview.md)идентификации Microsoft 2.0 см.

Общие сведения о процессе предоставления кода OAuth 2.0 представлены в разделе [Авторизация доступа к веб-приложениям Azure Active Directory с помощью потока предоставления кода OAuth 2.0](../active-directory/develop/v2-oauth2-auth-code-flow.md).

### <a name="register-your-application-with-an-azure-ad-tenant"></a>Регистрация приложения в клиенте Azure AD
Первым шагом в использовании Azure AD для авторизации ресурсов Event Hubs является регистрация клиентского приложения с помощью клиента Azure AD с [портала Azure.](https://portal.azure.com/) При регистрации клиентского приложения вы предоставляете информацию о приложении aD. Затем Azure AD предоставляет идентификатор клиента (также называемый идентификатор приложения), который можно использовать для ассоциировать приложение с временем выполнения Azure AD. Дополнительные сведения об идентификаторе клиента см. в статье [Объекты приложения и субъекта-службы в Azure Active Directory](../active-directory/develop/app-objects-and-service-principals.md). 

Следующие изображения показывают шаги для регистрации веб-приложения:

![Регистрация приложения](./media/authenticate-application/app-registrations-register.png)

> [!Note]
> Если вы регистрируете свое заявление в качестве нативного приложения, вы можете указать любой действительный URI для Redirect URI. Для натимного приложения это значение не должно быть реальным URL- Для веб-приложений перенаправление URI должно быть действительным URI, поскольку он определяет URL,к которому предоставляются токены.

После регистрации приложения вы увидите **идентификатор приложения (клиента)** в **настройках:**

![Идентификатор приложения зарегистрированного приложения](./media/authenticate-application/application-id.png)

Дополнительные сведения о регистрации приложения в Azure AD см. в разделе [Интеграция приложений с Azure Active Directory](../active-directory/develop/quickstart-v2-register-an-app.md).


### <a name="create-a-client-secret"></a>Создание секрета клиента   
Приложению нужна секрет клиента, чтобы доказать свою личность при запросе токена. Чтобы добавить секрет клиента, выполните следующие шаги.

1. Перейдите к регистрации приложения на портале Azure.
1. Выберите настройку **сертификатов & секретов.**
1. Под **секретами клиента,** выберите **новый секрет клиента,** чтобы создать новую тайну.
1. Предоставьте описание секрета и выберите требуемый интервал истечения срока действия.
1. Немедленно скопируйте значение нового секрета в безопасное место. Значение заполнения отображается вам только один раз.

    ![Секрет клиента](./media/authenticate-application/client-secret.png)


### <a name="client-libraries-for-token-acquisition"></a>Библиотеки клиентов для приобретения токенов  
После регистрации приложения и предоставления ему разрешений на отправку/получение данных в azure Event Hubs можно добавить код в приложение для проверки подлинности принципаслужбы безопасности и приобретения токена OAuth 2.0. Для проверки подлинности и приобретения токена можно использовать одну из [библиотек аутентификации платформы майкрософт](../active-directory/develop/reference-v2-libraries.md) или другую библиотеку с открытым исходным кодом, поддерживающую OpenID или Connect 1.0. Затем приложение может использовать маркер доступа для авторизации запроса в отношении концентраторов событий Azure.

Список сценариев, для которых поддерживается приобретение токенов, смотрите раздел [Сценарии](https://aka.ms/msal-net-scenarios) [Библиотеки подлинности Майкрософт (MSAL) для](https://github.com/AzureAD/microsoft-authentication-library-for-dotnet) репозитория .NET GitHub.

## <a name="samples"></a>Примеры
- [Образцы microsoft.Azure.EventHubs](https://github.com/Azure/azure-event-hubs/tree/master/samples/DotNet/Microsoft.Azure.EventHubs/Rbac). 
    
    В этих образцах используется старая библиотека **Microsoft.Azure.EventHubs,** но вы можете легко обновить ее до самой последней библиотеки **Azure.Messaging.EventHubs.** Для перемещения образца из старой библиотеки в новую можно [см.](https://github.com/Azure/azure-sdk-for-net/blob/master/sdk/eventhub/Azure.Messaging.EventHubs/MigrationGuide.md)
- [Образцы образцов Azure.Messaging.EventHubs](https://github.com/Azure/azure-event-hubs/tree/master/samples/DotNet/Azure.Messaging.EventHubs/ManagedIdentityWebApp)

    Этот пример был обновлен для использования последней библиотеки **Azure.Messaging.EventHubs.**

## <a name="next-steps"></a>Дальнейшие действия
- Чтобы узнать больше о RBAC, [см.](../role-based-access-control/overview.md)
- Чтобы узнать, как назначать роли RBAC и управлять назначениями ролей с помощью Azure PowerShell, Azure CLI или REST API, см. сведения в статьях ниже:
    - [Управление доступом на основе ролей с помощью Azure PowerShell](../role-based-access-control/role-assignments-powershell.md)  
    - [Управление доступом на основе ролей с помощью интерфейса командной строки Azure](../role-based-access-control/role-assignments-cli.md)
    - [Управление доступом на основе ролей с помощью REST API](../role-based-access-control/role-assignments-rest.md)
    - [Управление управлением элементом управления доступом на основе ролей (RBAC) с помощью шаблонов менеджера ресурсов Azure](../role-based-access-control/role-assignments-template.md)

Смотрите следующие статьи:
- [Проверка управляемого итогового данных с помощью Active Directory Azure для доступа к ресурсам концентратов событий](authenticate-managed-identity.md)
- [Проверка подлинности концентрах событий Azure с использованием общих подписей доступа](authenticate-shared-access-signature.md)
- [Разрешить доступ к ресурсам концентраторов событий с помощью активного каталога Azure](authorize-access-azure-active-directory.md)
- [Разрешить доступ к ресурсам концентраторов событий с помощью общих подписей доступа](authorize-access-shared-access-signature.md)

