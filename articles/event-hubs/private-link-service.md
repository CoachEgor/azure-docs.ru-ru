---
title: Интеграция концентраторов событий Azure с сервисом частных ссылок Azure
description: Узнайте, как интегрировать концентраторы событий Azure с службой частных ссылок Azure
services: event-hubs
author: spelluru
ms.author: spelluru
ms.date: 03/12/2020
ms.service: event-hubs
ms.topic: article
ms.openlocfilehash: cff1b3b79b34d3f0bed27a2ea50799185958a8ba
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79477854"
---
# <a name="integrate-azure-event-hubs-with-azure-private-link-preview"></a>Интеграция концентраторов Azure event с помощью частной ссылки Azure (Предварительный просмотр)
Служба частных ссылок Azure позволяет получить доступ к службам Azure (например, концентраторы событий Azure, Azure Storage и DB Azure Cosmos) и Azure размещает услуги клиентов/партнеров через **частную конечную точку** в виртуальной сети.

Частная конечная точка — это сетевой интерфейс, который соединяет вас в частном порядке и надежно к службе, работающей на Azure Private Link. Частная конечная точка использует частный IP-адрес из виртуальной сети, по сути перемещая службу в виртуальную сеть. Весь трафик к службе может маршрутизироваться через частную конечную точку, поэтому шлюзы, устройства преобразования сетевых адресов (NAT), подключения ExpressRoute и VPN, а также общедоступные IP-адреса не требуются. Трафик между виртуальной сетью и службой проходит через магистральную сеть Майкрософт, что позволяет избежать рисков общедоступного Интернета. Вы можете подключиться к экземпляру ресурса Azure, обеспечивая наивысшую степень детализации в управлении доступом.

Для получения дополнительной [What is Azure Private Link?](../private-link/private-link-overview.md) информации см.

> [!NOTE]
> Эта функция поддерживается только **с выделенным** уровнем. Для получения дополнительной информации [Overview of Event Hubs Dedicated](event-hubs-dedicated-overview.md)об выделенном уровне см. 
>
> Эта функция в настоящее время в **предварительном просмотре**. 


## <a name="add-a-private-endpoint-using-azure-portal"></a>Добавление частной конечных точек с помощью портала Azure

### <a name="prerequisites"></a>Предварительные требования

Для интеграции пространства имен событий с Azure Private Link вам потребуются следующие сущности или разрешения:

- Пространство имен Центров событий.
- Виртуальная сеть Azure.
- Подсеть в виртуальной сети.
- Разрешения владельца или участника как для пространства имен, так и для виртуальной сети.

Частная конечная точка и виртуальная сеть должны находиться в одном регионе. При выборе региона для частной конечной точки с помощью портала будут автоматически фильтроваться только виртуальные сети в этом регионе. Ваше пространство имен может находиться в другом регионе.

Частная конечная точка использует частный IP-адрес в виртуальной сети.

### <a name="steps"></a>Шаги
Если у вас уже есть пространство имен Event Hubs, можно создать частное соединение ссылки, выдвив на следующий этап:

1. Войдите на [портал Azure](https://portal.azure.com). 
2. В панели поиска введите **концентраторы событий.**
3. Выберите **пространство имен** из списка, к которому вы хотите добавить частную конечную точку.
4. Выберите вкладку **Сети** в **настройках.**
5. Выберите вкладку **Приватные конечные точки (предварительный просмотр)** в верхней части страницы. Если вы не используете выделенный уровень концентраторов событий, вы увидите сообщение: **Приватные соединения конечных точек в концентрах событий поддерживаются только пространствами имен, созданными в специальном кластере.**
6. Выберите кнопку **«Частная конечная точка»** в верхней части страницы.

    ![Изображение](./media/private-link-service/private-link-service-3.png)
7. На странице **Основы** выполните следующие действия: 
    1. Выберите **подписку Azure,** в которой требуется создать частную конечную точку. 
    2. Выберите **группу ресурсов** для частного ресурса конечных точек.
    3. Введите **имя** для частной конечной точки. 
    5. Выберите **регион** для частной конечных точек. Ваша частная конечная точка должна находиться в том же регионе, что и виртуальная сеть, но может находиться в другом регионе сюда с частным ресурсом связи, к которым вы подключаетесь. 
    6. Выберите **далее: кнопка >ресурсов** в нижней части страницы.

        ![Создание частной конечный точки - Страница Основы](./media/private-link-service/create-private-endpoint-basics-page.png)
8. На странице **Ресурса** выполните следующие действия:
    1. Для метода подключения при выборе **ресурса «Подключение к ресурсу Azure» в моем каталоге**выполните следующие действия: 
        1. Выберите **подписку Azure,** в которой существует **пространство имен событий.** 
        2. Для **типа ресурсов**выберите **Microsoft.EventHub/именные пространства** для типа **ресурса.**
        3. Для **ресурса**выберите пространство имен концентров событий из списка выпадающих. 
        4. Подтвердите, что **целевой подресурс** настроен на **пространство имен.**
        5. Выберите **следующую: Конфигурация >** кнопку в нижней части страницы. 
        
            ![Создание частной конечный точки - Страница ресурсов](./media/private-link-service/create-private-endpoint-resource-page.png)    
    2. При выборе **подключения к ресурсу Azure по идентификатору ресурсов или псевдониму**выполните следующие действия:
        1. Введите **идентификатор ресурса** или **псевдоним**. Это может быть идентификатор ресурсов или псевдоним, которым некоторые из них поделились с вами.
        2. Для **субресурса Target**введите **пространство имен.** Это тип суб-ресурса, к который может получить доступ к вашей частной конечной точке.
        3. (необязательно) Введите **сообщение запроса**. Владелец ресурса видит это сообщение при управлении частным конечным соединением.
        4. Затем выберите **кнопку «Следующая: Конфигурация >** в нижней части страницы.

            ![Создание частной конечный точки - Подключение с помощью идентификатора ресурса](./media/private-link-service/connect-resource-id.png)
9. На странице **Configuration** вы выбираете подсеть в виртуальной сети, где требуется развернуть частную конечную точку. 
    1. Выберите **виртуальную сеть.** В списке выпадающих списков перечислены только виртуальные сети в выбранной в настоящее время подписке и местоположении. 
    2. Выберите **подсеть** в выбранной вами виртуальной сети. 
    3. Выберите **далее: Теги >кнопку** в нижней части страницы. 

        ![Создание частной конечный точки - Страница конфигурации](./media/private-link-service/create-private-endpoint-configuration-page.png)
10. На странице **теги** создайте любые теги (имена и значения), которые необходимо связать с частным ресурсом конечных точек. Затем выберите **Кнопку «Обзор» и создайте** кнопку в нижней части страницы. 
11. В **обзоре создайте,** просмотрите все настройки и выберите **Создать** для создания частной конечной точки.
    
    ![Создание частной точки предварительного просмотра - Обзор и создание страницы](./media/private-link-service/create-private-endpoint-review-create-page.png)
12. Подтвердите, что в списке конечных точек отображается созданное соединение с конечной точкой. В этом примере частная конечная точка автоматически одобрена, поскольку вы подключены к ресурсу Azure в каталоге и у вас достаточно разрешений. 

    ![Создана частная конечная точка](./media/private-link-service/private-endpoint-created.png)

## <a name="add-a-private-endpoint-using-powershell"></a>Добавить частную конечную точку с помощью PowerShell
В следующем примере показано, как использовать Azure PowerShell для создания частного соединения конечных точек. Это не создает для вас выделенного кластера. Выполните последующие шаги в [этой статье,](event-hubs-dedicated-cluster-create-portal.md) чтобы создать выделенный кластер концентраторов событий. 

```azurepowershell-interactive
# create resource group

$rgName = "<RESOURCE GROUP NAME>"
$vnetlocation = "<VIRTUAL NETWORK LOCATION>"
$vnetName = "<VIRTUAL NETWORK NAME>"
$subnetName = "<SUBNET NAME>"
$namespaceLocation = "<NAMESPACE LOCATION>"
$namespaceName = "<NAMESPACE NAME>"
$peConnectionName = "<PRIVATE ENDPOINT CONNECTION NAME>"

# create virtual network
$virtualNetwork = New-AzVirtualNetwork `
                    -ResourceGroupName $rgName `
                    -Location $vnetlocation `
                    -Name $vnetName `
                    -AddressPrefix 10.0.0.0/16

# create subnet with endpoint network policy disabled
$subnetConfig = Add-AzVirtualNetworkSubnetConfig `
                    -Name $subnetName `
                    -AddressPrefix 10.0.0.0/24 `
                    -PrivateEndpointNetworkPoliciesFlag "Disabled" `
                    -VirtualNetwork $virtualNetwork

# update virtual network
$virtualNetwork | Set-AzVirtualNetwork

# create an event hubs namespace in a dedicated cluster
$namespaceResource = New-AzResource -Location $namespaceLocation `
                                    -ResourceName $namespaceName `
                                    -ResourceGroupName $rgName `
                                    -Sku @{name = "Standard"; capacity = 1} `
                                    -Properties @{clusterArmId = "/subscriptions/<SUBSCRIPTION ID>/resourceGroups/<RESOURCE GROUP NAME>/providers/Microsoft.EventHub/clusters/<EVENT HUBS CLUSTER NAME>"} `
                                    -ResourceType "Microsoft.EventHub/namespaces" -ApiVersion "2018-01-01-preview"

# create private endpoint connection
$privateEndpointConnection = New-AzPrivateLinkServiceConnection `
                                -Name $peConnectionName `
                                -PrivateLinkServiceId $namespaceResource.ResourceId `
                                -GroupId "namespace"

# get subnet object that you will use later
$virtualNetwork = Get-AzVirtualNetwork -ResourceGroupName  $rgName -Name $vnetName
$subnet = $virtualNetwork | Select -ExpandProperty subnets `
                                | Where-Object  {$_.Name -eq $subnetName}  
   
# create a private endpoint   
$privateEndpoint = New-AzPrivateEndpoint -ResourceGroupName $rgName  `
                                -Name $vnetName   `
                                -Location $vnetlocation `
                                -Subnet  $subnet   `
                                -PrivateLinkServiceConnection $privateEndpointConnection

(Get-AzResource -ResourceId $namespaceResource.ResourceId -ExpandProperties).Properties


```

## <a name="manage-private-endpoints-using-azure-portal"></a>Управление частными конечными точками с помощью портала Azure

При создании частной конечной точки подключение должно быть утверждено. Если ресурс, для которого вы создаете частную конечную точку, находится в каталоге, вы можете утвердить запрос на подключение при условии наличия достаточных разрешений. Если вы подключаетесь к ресурсу Azure в другом каталоге, необходимо дождаться, когда владелец этого ресурса утвердит запрос на подключение.

Существует четыре состояния подготовки:

| Действия по обслуживанию | Состояние частной конечной точки объекта-получателя службы | Описание |
|--|--|--|
| None | Ожидает | Подключение создается вручную и ожидает утверждения от владельца ресурса Приватного канала. |
| Утверждение | Approved | Подключение утверждено автоматически или вручную и готово к использованию. |
| Reject | Отклонено | Подключение отклонил владелец ресурса Приватного канала. |
| Удалить | Отключено | Подключение удалил владелец ресурса Приватного канала. Частная конечная точка станет информативной и подлежит удалению для очистки. |
 
###  <a name="approve-reject-or-remove-a-private-endpoint-connection"></a>Утверждение, отклонение или удаление приватного соединения конечных точек

1. Войдите на портал Azure.
2. В панели поиска введите **концентраторы событий.**
3. Выберите **пространство имен,** которым вы хотите управлять.
4. Выберите вкладку **Сеть.**
5. Перейдите в соответствующий раздел ниже на основе операции, которая вы хотите: утвердить, отклонить или удалить.

### <a name="approve-a-private-endpoint-connection"></a>Утвердить приватное соединение конечных точек
1. Если есть какие-либо соединения, которые находятся на рассмотрении, вы увидите соединение, указанное в **положении ожидания** в состоянии подготовки. 
2. Выберите **частную конечную точку,** которая вы хотите утвердить
3. Выберите кнопку **«Утвердить».**

    ![Изображение](./media/private-link-service/approve-private-endpoint.png)
4. На странице **подключения Утверждение** добавьте комментарий (необязательно) и выберите **«Да».** Если вы выберете **Нет,** ничего не происходит. 
5. Следует увидеть, что статус закрытого соединения конечной точки в списке изменен на **Утвержденный**. 

### <a name="reject-a-private-endpoint-connection"></a>Отклонить частное соединение конечных точек

1. Если есть какие-либо частные соединения конечных точек, которые вы хотите отклонить, будь то ожидающий запрос или существующее соединение, выберите соединение и нажмите кнопку **Отклонить.**

    ![Изображение](./media/private-link-service/private-endpoint-reject-button.png)
2. На странице **соединения Reject** введите комментарий (необязательно) и выберите **«Да».** Если вы выберете **Нет,** ничего не происходит. 
3. Следует увидеть, что статус закрытого соединения конечной точки в списке изменен на **Отклоненный**. 

### <a name="remove-a-private-endpoint-connection"></a>Удалить приватное соединение конечных точек

1. Чтобы удалить приватное соединение конечных точек, выберите его в списке и **выберите Удалить** на панели инструментов.
2. На странице **подключения Delete** выберите **«Да»,** чтобы подтвердить удаление частной конечной точки. Если вы выберете **Нет,** ничего не происходит.
3. Вы должны увидеть, что статус изменен на **Отключенный.** Затем вы увидите, что конечная точка исчезнет из списка.

## <a name="validate-that-the-private-link-connection-works"></a>Проверка работоспособности подключения Приватного канала

Следует проверить, что ресурсы в одной подсети частного ресурса конечных точек подключаются к вашему пространству имен Event Hubs через частный IP-адрес, и что они имеют правильную частную интеграцию зоны DNS.

Сначала создайте виртуальную машину, выполнив действия, описанные в статье [Краткое руководство. Создание виртуальной машины Windows на портале Azure](../virtual-machines/windows/quick-create-portal.md).

Во вкладке **Сеть:**

1. Укажите **виртуальную сеть** и **подсеть**. Можно создать виртуальную сеть или выбрать существующую. При выборе существующей сети убедитесь, что регион соответствует.
1. Укажите **общедоступный ресурс ИС.**
1. В **группе безопасности сети NIC**выберите **Нет**.
1. В **балансировке нагрузки**выберите **Нет**.

Откройте командную строку и выполните следующую команду:

```console
nslookup <your-event-hubs-namespace-name>.servicebus.windows.net
```

Если вы запустите команду поиска ns для разрешения IP-адреса пространства имен Event Hubs через общедоступную точку, вы увидите результат, который выглядит следующим образом:

```console
c:\ >nslookup <your-event-hubs-namespae-name>.servicebus.windows.net

Non-authoritative answer:
Name:    
Address:  (public IP address)
Aliases:  <your-event-hubs-namespace-name>.servicebus.windows.net
```

Если вы запустите команду поиска ns для разрешения IP-адреса пространства имен Event Hubs через частную конечную точку, вы увидите результат, который выглядит следующим образом:

```console
c:\ >nslookup your_event-hubs-namespace-name.servicebus.windows.net

Non-authoritative answer:
Name:    
Address:  10.1.0.5 (private IP address)
Aliases:  <your-event-hub-name>.servicebus.windows.net
```

## <a name="limitations-and-design-considerations"></a>Ограничения и соображения дизайна

**Ценообразование**: Для получения информации о ценах [на](https://azure.microsoft.com/pricing/details/private-link/)цены см.

**Ограничения**: Частная конечная точка для концентраторов Azure находится в открытом доступе. Эта возможность есть во всех общедоступных регионах Azure.

**Максимальное количество частных конечных точек в пространстве имен Event Hubs**: 120.

Для получения [Azure Private Link service: Limitations](../private-link/private-link-service-overview.md#limitations) дополнительной информации см.

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о службе [Приватный канал Azure](../private-link/private-link-service-overview.md)
- Узнайте больше о [концентрах событий Azure](event-hubs-about.md)
