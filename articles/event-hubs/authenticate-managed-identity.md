---
title: Проверка подлинности управляемого удостоверения с помощью Azure Active Directory
description: В этой статье содержатся сведения о проверке подлинности управляемого удостоверения с Azure Active Directory для доступа к ресурсам концентраторов событий Azure.
services: event-hubs
ms.service: event-hubs
documentationcenter: ''
author: spelluru
manager: ''
ms.topic: conceptual
ms.date: 08/22/2019
ms.author: spelluru
ms.openlocfilehash: cbd7de7d526e1954aaad60f7d71e5cdf202f6a29
ms.sourcegitcommit: 007ee4ac1c64810632754d9db2277663a138f9c4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/23/2019
ms.locfileid: "69992839"
---
# <a name="authenticate-a-managed-identity-with-azure-active-directory-to-access-event-hubs-resources"></a>Проверка подлинности управляемого удостоверения с Azure Active Directory для доступа к ресурсам концентраторов событий
Концентраторы событий Azure поддерживают проверку подлинности Azure Active Directory (Azure AD) с помощью [управляемых удостоверений для ресурсов Azure](../active-directory/managed-identities-azure-resources/overview.md). Управляемые удостоверения для ресурсов Azure могут авторизовать доступ к ресурсам концентраторов событий с помощью учетных данных Azure AD из приложений, работающих на виртуальных машинах Azure, приложений-функций, масштабируемых наборов виртуальных машин и других служб. Используя управляемые удостоверения для ресурсов Azure вместе с проверкой подлинности Azure AD, можно избежать хранения учетных данных в приложениях, выполняемых в облаке.

В этой статье показано, как авторизовать доступ к концентратору событий с помощью управляемого удостоверения на виртуальной машине Azure.

## <a name="enable-managed-identities-on-a-vm"></a>Включение управляемых удостоверений на виртуальной машине
Прежде чем вы сможете использовать управляемые удостоверения для ресурсов Azure для авторизации ресурсов концентраторов событий из виртуальной машины, сначала необходимо включить управляемые удостоверения для ресурсов Azure на виртуальной машине. Сведения о включении управляемых удостоверений для ресурсов Azure см. в одной из следующих статей.

- [портал Azure](../active-directory/managed-service-identity/qs-configure-portal-windows-vm.md)
- [Azure PowerShell](../active-directory/managed-identities-azure-resources/qs-configure-powershell-windows-vm.md)
- [Интерфейс командной строки Azure](../active-directory/managed-identities-azure-resources/qs-configure-cli-windows-vm.md)
- [Шаблон Azure Resource Manager](../active-directory/managed-identities-azure-resources/qs-configure-template-windows-vm.md)
- [Клиентские библиотеки Azure Resource Manager](../active-directory/managed-identities-azure-resources/qs-configure-sdk-windows-vm.md)

## <a name="grant-permissions-to-a-managed-identity-in-azure-ad"></a>Предоставление разрешений управляемому удостоверению в Azure AD
Чтобы авторизовать запрос к службе концентраторов событий из управляемого удостоверения в приложении, сначала настройте параметры управления доступом на основе ролей (RBAC) для этого управляемого удостоверения. Концентраторы событий Azure определяют роли RBAC, которые охватывают разрешения для отправки и чтения из концентраторов событий. Когда роль RBAC назначается управляемому удостоверению, управляемому удостоверению предоставляется доступ к данным концентраторов событий в соответствующей области.

Дополнительные сведения о назначении ролей RBAC см. [в статье Проверка подлинности с помощью Azure Active Directory для доступа к ресурсам концентраторов событий](authorize-access-azure-active-directory.md).

## <a name="use-event-hubs-with-managed-identities"></a>Использование концентраторов событий с управляемыми удостоверениями
Чтобы использовать концентраторы событий с управляемыми удостоверениями, необходимо назначить удостоверение роли и соответствующую область. Процедура в этом разделе использует простое приложение, которое выполняется под управляемым удостоверением и обращается к ресурсам концентраторов событий.

Здесь мы используем пример веб-приложения, размещенного в [службе приложений Azure](https://azure.microsoft.com/services/app-service/). Пошаговые инструкции по созданию веб-приложения см. [в статье создание ASP.NET Core веб-приложения в Azure](../app-service/app-service-web-get-started-dotnet.md) .

После создания приложения выполните следующие действия. 

1. Перейдите в раздел **Параметры** и выберите **удостоверение**. 
1. Выберите **состояние** **включено**. 
1. Нажмите кнопку **Сохранить**, чтобы сохранить параметры. 

    ![Управляемое удостоверение для веб-приложения](./media/authenticate-managed-identity/identity-web-app.png)

После включения этого параметра в Azure Active Directory (Azure AD) создается новое удостоверение службы, которое настраивается в узле службы приложений.

Теперь назначьте это удостоверение службы роли в требуемой области в ресурсах концентраторов событий.

### <a name="to-assign-rbac-roles-using-the-azure-portal"></a>Назначение ролей RBAC с помощью портал Azure
Чтобы назначить роль ресурсам концентраторов событий, перейдите к этому ресурсу в портал Azure. Отобразить параметры управления доступом (IAM) для ресурса и выполнить следующие инструкции для управления назначениями ролей:

> [!NOTE]
> Следующие шаги назначают роль удостоверения службы для пространств имен концентраторов событий. Вы можете выполнить те же действия, чтобы назначить роль для любого ресурса концентраторов событий. 

1. В портал Azure перейдите к пространству имен концентраторов событий и просмотрите **Общие сведения** о пространстве имен. 
1. Выберите **Управление доступом (IAM)** в меню слева, чтобы отобразить параметры управления доступом для концентратора событий.
1.  Выберите вкладку **Назначения ролей**, чтобы просмотреть список назначений ролей.
3.  Нажмите кнопку **Добавить** , чтобы добавить новую роль.
4.  На странице **Добавление назначения ролей** выберите роли концентраторов событий, которые требуется назначить. Затем найдите удостоверение службы, зарегистрированное для назначения роли.
    
    ![Страница добавления назначения ролей](./media/authenticate-managed-identity/add-role-assignment-page.png)
5.  Щелкните **Сохранить**. Удостоверение, которому назначена роль RBAC, будет отображаться в списке под этой ролью. Например, на следующем рисунке показано, что удостоверение службы имеет владельца данных концентраторов событий.
    
    ![Удостоверение, назначенное роли](./media/authenticate-managed-identity/role-assigned.png)

После назначения роли веб-приложение будет иметь доступ к ресурсам концентраторов событий в определенной области. 

### <a name="test-the-web-application"></a>Тестирование веб-приложения
Теперь вы можете запустить веб-приложение и указать в браузере страницу с примером страницы ASPX. Вы можете найти пример веб-приложения, которое отправляет и получает данные из ресурсов концентраторов событий в [репозитории GitHub](https://github.com/Azure/azure-event-hubs/tree/master/samples/DotNet/Microsoft.Azure.EventHubs/Rbac/ManagedIdentityWebApp).

Установите последний пакет из [NuGet](https://www.nuget.org/packages/Microsoft.Azure.EventHubs/)и начните отправлять и получать данные из концентраторов событий с помощью EventHubClient, как показано в следующем коде: 

```csharp
var ehClient = EventHubClient.CreateWithManagedIdentity(new Uri($"sb://{EventHubNamespace}/"), EventHubName);
```

## <a name="next-steps"></a>Следующие шаги
- Скачайте [Пример](https://github.com/Azure/azure-event-hubs/tree/master/samples/DotNet/Microsoft.Azure.EventHubs/Rbac/ManagedIdentityWebApp) с сайта GitHub.
- Сведения об управляемых удостоверениях для ресурсов Azure см. в следующей статье: [Что такое управляемые удостоверения для ресурсов Azure?](../active-directory/managed-identities-azure-resources/overview.md)
- См. следующие статьи:
    - [Проверка подлинности запросов к концентраторам событий Azure из приложения с помощью Azure Active Directory](authenticate-application.md)
    - [Проверка подлинности запросов к концентраторам событий Azure с помощью подписанных URL](authenticate-shared-access-signature.md)
    - [Авторизация доступа к ресурсам концентраторов событий с помощью Azure Active Directory](authorize-access-azure-active-directory.md)
    - [Авторизация доступа к ресурсам концентраторов событий с помощью подписанных URL](authorize-access-shared-access-signature.md)