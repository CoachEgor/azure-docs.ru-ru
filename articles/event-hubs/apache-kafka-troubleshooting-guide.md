---
title: Проблемы устранения проблем с концентраторами событий Azure для Apache Kafka
description: В этой статье показано, как устранить проблемы с azure Event Hubs для Apache Kafka
services: event-hubs
documentationcenter: ''
author: ShubhaVijayasarathy
manager: ''
ms.service: event-hubs
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/01/2020
ms.author: shvija
ms.openlocfilehash: 12ddc5fa74b7a1b42bbd64fde9ec3410b1c1e425
ms.sourcegitcommit: 5e49f45571aeb1232a3e0bd44725cc17c06d1452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2020
ms.locfileid: "81606734"
---
# <a name="apache-kafka-troubleshooting-guide-for-event-hubs"></a>Apache Кафка руководство по устранению неполадок для событий концентраторов
В этой статье приведены советы по устранению неполадок для проблем, с которыми вы можете столкнуться при использовании концентраторов событий для Apache Kafka. 

## <a name="server-busy-exception"></a>Исключение сервера Занято
Вы можете получить исключение Server Busy из-за регулирования Kafka. С клиентами АМЗП, Event Hubs немедленно возвращает исключение **Server Busy** при задушить службу. Это эквивалентно сообщению "попробуй еще раз позже". В Кафке сообщения задерживаются до завершения. Длина задержки возвращается `throttle_time_ms` в миллисекундах, как в ответе на производство/извлечение. В большинстве случаев эти отложенные запросы не регистрируются как исключения ServerBusy на панелях мониторинга событийных центров. Вместо этого `throttle_time_ms` значение ответа должно использоваться в качестве индикатора того, что пропускная стоимость превысила предусмотренную квоту.

Если трафик является чрезмерным, служба имеет следующее поведение:

- Если задержка запроса на производство превышает тайм-аут запроса, центры событий возвращают код **ошибки нарушения политики.**
- Если задержка запроса на получение превышает тайм-аут запроса, Event Hubs регистрирует запрос как задушил и отвечает пустым набором записей и кодом ошибки.

[Выделенные кластеры](event-hubs-dedicated-overview.md) не имеют механизмов регулирования. Вы можете свободно потреблять все ресурсы кластера.

## <a name="no-records-received"></a>Записи не получены
Вы можете увидеть, что едоки не получают никакие показатели и постоянн rebalancing. В этом случае потребители не получают никаких записей и постоянно перебалансируются. Там нет исключения или ошибки, когда это произойдет, но журналы Kafka покажет, что потребители застряли, пытаясь вернуться в группу и назначить разделы. Есть несколько возможных причин:

- Убедитесь, `request.timeout.ms` что ваш, по крайней мере рекомендуемое `session.timeout.ms` значение 60000 и ваш, по крайней мере рекомендуемое значение 30000. Наличие этих параметров слишком низким может привести к потребителю тайм-аутов, которые затем вызывают ребалансировки (которые затем вызывают больше тайм-аутов, которые вызывают больше ребалансировки, и так далее) 
- Если ваша конфигурация соответствует рекомендуемым значениям, и вы все еще видите постоянную перебалансировку, не стесняйтесь открыть проблему (не забудьте включить всю конфигурацию в проблему, чтобы мы могли помочь отладить)!

## <a name="compressionmessage-format-version-issue"></a>Проблема формата сжатия/сообщения
Kafka поддерживает сжатие, а event Hubs для Kafka в настоящее время нет. Ошибки, в которых упоминается версия `The message format version on the broker does not support the request.`формата сообщений (например, ) возникают, когда клиент пытается отправить сжатые сообщения Kafka нашим брокерам.

Если сжатые данные необходимы, сжатие данных перед отправкой брокеров и декомпрессии после получения является действительным обходным решением. Тело сообщения является просто байт массив ажиотаж к службе, так что клиент стороне сжатия / декомпрессии не вызовет каких-либо проблем.

## <a name="unknownserverexception"></a>НеизвестныйСерверИсключение
Вы можете получить UnknownServerException из клиентских библиотек Kafka, аналогичный следующему примеру: 

```
org.apache.kafka.common.errors.UnknownServerException: The server experienced an unexpected error when processing the request
```

Откройте билет при поддержке Майкрософт.  При отладке проблемы полезны данные о регистрации уровне отошибок и временных меток исключений в UTC. 

## <a name="other-issues"></a>Другие проблемы
Проверьте следующие элементы, если вы видите проблемы при использовании Kafka на концентрах событий.

- **Брандмауэр блокирует трафик** - Убедитесь, что порт **9093** не заблокирован брандмауэром.
- **ТемаАвторизацияИсключение** - Наиболее распространенными причинами этого исключения являются:
    - Опечатка в строке соединения в файле конфигурации, или
    - Попытка использовать концентраторы событий для Kafka в пространстве имен базового уровня. Концентраторы событий для Kafka [поддерживаются только для стандартных и выделенных областей имен.](https://azure.microsoft.com/pricing/details/event-hubs/)
- **Несоответствие версии Kafka** - Event Hubs для Kafka Ecosystems поддерживает версии Kafka 1.0 и позже. Некоторые приложения, использующие версию Kafka 0.10 и позже, могут иногда работать из-за обратной совместимости протокола Kafka, но мы настоятельно рекомендуем не использовать старые версии API. Версии Kafka 0.9 и ранее не поддерживают требуемые протоколы SASL и не могут подключиться к концентрам событий.
- **Странные кодировки на заголовках АМЗП при потреблении с Kafka** - при отправке событий в концентратор событий над АМЗП, любые заголовки полезной нагрузки АМЗП сериализируются в кодировании Am-P. Потребители Кафки не десериализируют заголовки из АМЗП. Чтобы прочитать значения заголовка, вручную расшифровать заголовки AM-P. Кроме того, вы можете избежать использования заголовков AM-P, если вы знаете, что вы будете потреблять через протокол Kafka. Для получения дополнительной информации смотрите [этот выпуск GitHub](https://github.com/Azure/azure-event-hubs-for-kafka/issues/56).
- **Проверка подлинности SASL** - Получение инфраструктуры для сотрудничества с протоколом проверки подлинности SASL, требуемым Event Hubs, может быть сложнее, чем кажется на первый взгляд. Узнайте, можно ли устранить неполадки, используя ресурсы платформы при проверке подлинности SASL. 

## <a name="limits"></a>Ограничения
Апач Кафка vs. Событие Хабс Кафка. По большей части концентраторы событий для экосистем Kafka имеет те же значения по умолчанию, свойства, коды ошибок и общее поведение, что и Apache Kafka. Случаи, когда эти два явно отличаются (или где концентраторы событий накладывает ограничение, которое Не имеет Kafka) перечислены ниже:

- Максимальная длина `group.id` свойства составляет 256 символов
- Максимальный `offset.metadata.max.bytes` размер 1024 байтов
- Смещение коммитов задушены на 4 вызова / секунда на раздел с максимальным внутренним размером журнала 1 МБ


## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о Центрах событий и Центрах событий для Kafka см. в следующих статьях:  

- [Руководство разработчика Apache Kafka для концентраторов событий](apache-kafka-developer-guide.md)
- [Руководство по миграции Apache Kafka для центров событий](apache-kafka-migration-guide.md)
- [Часто задаваемые вопросы - Концентраторы событий для Apache Kafka](apache-kafka-frequently-asked-questions.md)
- [Рекомендуемые конфигурации](https://github.com/Azure/azure-event-hubs-for-kafka/blob/master/CONFIGURATION.md)
