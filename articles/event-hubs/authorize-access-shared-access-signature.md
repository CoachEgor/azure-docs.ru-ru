---
title: Разрешить доступ с общей подписью доступа в концентрах событий Azure
description: В этой статье содержится информация об авторизации доступа к ресурсам Azure Event Hubs с помощью общих подписей доступа (SAS).
services: event-hubs
ms.service: event-hubs
documentationcenter: ''
author: spelluru
ms.topic: conceptual
ms.date: 08/22/2019
ms.author: spelluru
ms.openlocfilehash: bdb1896f8a40c6de21ae76b536bfccec316341cd
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "69992800"
---
# <a name="authorizing-access-to-event-hubs-resources-using-shared-access-signatures"></a>Разрешение доступа к ресурсам концентров событий с использованием общих подписей доступа
Общая подпись доступа (SAS) предоставляет вам возможность предоставить ограниченный доступ к ресурсам в пространстве имен Event Hubs. SAS охраняет доступ к ресурсам Event Hubs на основе правил авторизации. Эти правила настроены либо на пространстве имен, либо на объекте (концентратор событий или тема). В этой статье содержится обзор модели SAS и обзоры рекомендаций SAS.

## <a name="what-are-shared-access-signatures"></a>Что такое общие подписи доступа?
Общая подпись доступа (SAS) обеспечивает делегированный доступ к ресурсам Event Hubs на основе правил авторизации. Право авторизации имеет имя, связано с определенными правами и содержит пару криптографических ключей. Для создания токенов SAS вы используете имя и ключ правила через клиентов Event Hubs или в собственном коде. Затем клиент может передать токен концентрам событий, чтобы доказать авторизацию запрашиваемых операций.

SAS — это механизм авторизации на основе претензий с использованием простых токенов. При использовании SAS ключи никогда не передаются по сети. Ключи криптографически подписывают сведения, которые впоследствии будут проверены службой. SAS можно использовать так же, как и имя пользователя и пароль, где клиент немедленно получает имя и соответствующий ключ правила авторизации. SAS может быть использован по аналогии с федеративной моделью безопасности, где клиент получает ограниченный по времени и подписанный токен доступа от службы маркеров безопасности, даже не вступая во владение ключом подписи.

> [!NOTE]
> Концентраторы событий Azure поддерживают авторизацию ресурсов концентров событий с помощью active Directory Azure (Azure AD). Разрешение пользователей или приложений с помощью токена OAuth 2.0, возвращенного Azure AD, обеспечивает превосходную безопасность и простоту использования над общими подписями доступа (SAS). С Azure AD нет необходимости хранить маркеры в коде и рисковать потенциальными уязвимостями безопасности.
>
> Корпорация Майкрософт рекомендует использовать Azure AD с приложениями Azure Event Hubs, когда это возможно. Для получения дополнительной информации см. [Авторизовать доступ к ресурсу Azure Event Hubs с помощью Active Directory Azure.](authorize-access-azure-active-directory.md)

> [!IMPORTANT]
> Токены SAS (Общие подписи доступа) имеют решающее значение для защиты ваших ресурсов. Обеспечивая детализацию, SAS предоставляет клиентам доступ к ресурсам Event Hubs. Они не должны быть опубликованы публично. При совместном использовании, если это необходимо для устранения неполадок, рассмотрите возможность использования уменьшенной версии любых файлов журнала или удалите маркеры SAS (если они присутствуют) из файлов журнала, и убедитесь, что скриншоты также не содержат информацию SAS.

## <a name="shared-access-authorization-policies"></a>Политики авторизации общего доступа
Каждое пространство имен концентров событий и каждая сущность концентраторов событий (экземпляр концентратора событий или тема Kafka) имеют общую политику авторизации доступа, состоящую из правил. Политика на уровне пространства имен применяется ко всем сущностям в пространстве имен независимо от настройки их политики.
Для каждого правила политики авторизации необходимо выбрать три элемента информации: имя, область и права. Название является уникальным именем в этой области. Сфера применения является URI рассматриваемого ресурса. Для пространства имен Event Hubs область югги является полностью квалифицированным `https://<yournamespace>.servicebus.windows.net/`доменным именем (ФЗДН), например.

Права, предусмотренные правилом политики, могут быть комбинацией:
- **Отправка** - Дает право отправлять сообщения сущности
- **Слушайте** - Дает право слушать или получать к сущности
- **Управление** - Дает право управлять топологией пространства имен, включая создание и удаление сущностей

> [!NOTE]
> Право **управления** включает права **отправлять** и **слушать.**

Политика пространства имен или сущности может содержать до 12 правил авторизации общего доступа, предоставляя место для трех наборов правил, каждый из которых охватывает основные права, и сочетание отправки и прослушивания. Этот лимит подчеркивает, что магазин политики SAS не предназначен для того, чтобы быть магазином учетных записей пользователя или службы. Если приложению необходимо предоставить доступ к ресурсам Event Hubs на основе идентификаторов пользователей или служб, он должен реализовать службу маркеров безопасности, которая выдает токены SAS после проверки подлинности и проверки доступа.

Правило авторизации присваивается **основной ключ** и **вторичный ключ.** Эти ключи являются криптографически сильными ключами. Не теряйте их и не сливайте их. Они всегда будут доступны на портале Azure. Вы можете использовать любой из созданных ключей и создавать их повторно в любое время. Если вы повторно создадите или измените ключ в политике, все ранее выданные маркеры на его основе моментально станут недействительными. Тем не менее текущие подключения, созданные на основе этих маркеров, продолжат работать до истечения срока их действия.

При создании пространства имен Event Hubs автоматически создается правило политики под названием **RootManageSharedAccessKey** для пространства имен. В этом политике **есть** разрешение на все пространство имен. Рекомендуется рассматривать это правило как административную корневую учетную запись и не использовать его в приложении. Вы можете создать дополнительные правила политики во вкладке **Настройка** для пространства имен на портале, через PowerShell или Azure CLI.

## <a name="best-practices-when-using-sas"></a>Рекомендации по использованию SAS
При использовании подписей общего доступа в приложениях необходимо иметь в виду две потенциальные проблемы:

- Если SAS просочилась, она может быть использована любым, кто его получит, что потенциально может поставить под угрозу ваши ресурсы концентраторов событий.
- Если срок действия SAS, предоставленного клиенту, истекает и приложение не может получить новый SAS из вашей службы, то функциональность приложения может быть затруднена.

Следующие рекомендации по использованию подписанных URL-адресов помогут нейтрализовать эти риски:

- **Попросите клиентов автоматически возобновить SAS, если это необходимо:** Клиенты должны продлить SAS задолго до истечения срока действия, чтобы дать время для повторов, если услуга, предоставляющая SAS, недоступна. Если ваш SAS предназначен для использования небольшого числа немедленных, недолговечных операций, которые, как ожидается, будут завершены в течение срока действия, то это может быть ненужным, поскольку SAS не будет возобновлен. Однако если имеется клиент, регулярно выполняющий запросы через подпись, то возможность истечения срока действия следует принять во внимание. Ключевым соображением является уравновешивание необходимости того, чтобы SAS был недолгим (как указывалось ранее) с необходимостью обеспечить, чтобы клиент запрашивал продление достаточно рано (чтобы избежать сбоев из-за истечения срока действия SAS до успешного продления).
- **Будьте осторожны с sAS время начала**: Если вы установите время начала для SAS **сейчас,** то из-за перекоса часов (различия в текущем времени в зависимости от различных машин), сбои могут наблюдаться с перерывами в течение первых нескольких минут. В общем, устанавливайте время начала действия на 15 минут или более в прошлом времени. Или, не устанавливайте его на всех, которые сделают его действительным немедленно в всех случаях. То же самое обычно относится и к сроку годности, а также. Помните, что вы можете наблюдателя до 15 минут часы перекос в любом направлении по любому запросу. 
- **Будьте конкретны с ресурсом, к**который будет доступна: наилучшей практикой безопасности является предоставление пользователю минимальных требуемых привилегий. Если пользователю требуется только доступ для чтения к отдельной сущности, предоставьте доступ на чтение к этой сущности, а не доступ на чтение, запись и удаление для всех сущностей. Это также помогает уменьшить ущерб, если SAS скомпрометирован, потому что SAS имеет меньше энергии в руках злоумышленника.
- **Не всегда используйте SAS:** Иногда риски, связанные с конкретной операцией против концентраторов событий, перевешивают преимущества SAS. Для таких операций создайте службу среднего уровня, которая записывает в концентраторы событий после проверки бизнес-правил, аутентификации и аудита.
- **Всегда используйте HTTPs**: Всегда используйте Https для создания или распространения SAS. Если SAS передается через HTTP и перехвачен, злоумышленник, выполняющий атташе «человек в середине», может прочитать SAS, а затем использовать его так же, как мог иметь предполагаемый пользователь, потенциально компрометируя конфиденциальные данные или допуская порчу данных злоумышленником.

## <a name="conclusion"></a>Заключение
Подписи доступа для обмена подписями полезны для предоставления клиентам ограниченных разрешений ресурсам Event Hubs. Они являются жизненно важной частью модели безопасности для любого приложения, использующего концентраторы Azure Event. Если вы будете следовать рекомендациям, перечисленным в этой статье, вы можете использовать SAS, чтобы обеспечить большую гибкость доступа к вашим ресурсам, не ставя под угрозу безопасность вашего приложения.

## <a name="next-steps"></a>Дальнейшие действия
Смотрите следующие статьи: 

- [Authenticate requests to Azure Event Hubs из приложения с использованием active-каталога Azure](authenticate-application.md)
- [Проверка управляемого итогового данных с помощью Active Directory Azure для доступа к ресурсам концентратов событий](authenticate-managed-identity.md)
- [Проверка подлинности концентрах событий Azure с использованием общих подписей доступа](authenticate-shared-access-signature.md)
- [Разрешить доступ к ресурсам концентраторов событий с помощью активного каталога Azure](authorize-access-azure-active-directory.md)


