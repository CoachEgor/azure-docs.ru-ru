---
title: Управление доступом на основе ролей (предварительная версия) — Центры событий Azure | Документация Майкрософт
description: В этой статье приводятся сведения об управлении доступом на основе ролей для Центров событий Azure.
services: event-hubs
documentationcenter: na
author: ShubhaVijayasarathy
manager: timlt
ms.service: event-hubs
ms.devlang: na
ms.topic: article
ms.custom: seodec18
ms.date: 12/06/2018
ms.author: shvija
ms.openlocfilehash: 549cfb84ff247295e01c800aa41ba265bb8921c7
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60343466"
---
# <a name="active-directory-role-based-access-control-preview"></a>Управление доступом к Active Directory на основе ролей (предварительная версия)

Microsoft Azure предоставляет интегрированную систему управления доступом к ресурсам и приложениям на основе Azure Active Directory (Azure AD). С помощью Azure AD вы можете управлять учетными записями пользователей и приложениями специально для приложений на основе Azure или же объединить имеющуюся инфраструктуру Active Directory и Azure AD в федерацию, чтобы обеспечить единый вход на всех компьютерах компании, а также для ресурсов и приложений, размещенных в Azure. Затем можно назначить эти удостоверения пользователя и приложения Azure AD для глобальных ролей и ролей определенных служб, чтобы предоставить доступ к ресурсам Azure.

Для Центров событий Azure управление пространствами имен и всеми связанными ресурсами через портал Azure и API управления ресурсами Azure уже защищено с помощью модели *управления доступом на основе ролей* (RBAC). Сейчас компонент RBAC для операций среды выполнения доступен в общедоступной предварительной версии. 

В приложении, использующем RBAC Azure AD, не нужно обрабатывать правила и ключи SAS, а также любые другие маркеры доступа, относящиеся к Центрам событий. Клиентское приложение взаимодействует с Azure AD, чтобы установить контекст аутентификации, и получает маркер доступа для Центров событий. Благодаря учетным записям пользователей домена, требующих интерактивного входа в систему, приложение не обрабатывает учетные данные напрямую.

## <a name="event-hubs-roles-and-permissions"></a>Роли и разрешения Центров событий

В исходной общедоступной предварительной версии можно только добавлять учетные записи Azure AD и субъекты-службы для ролей "Владелец" или "Участник" пространства имен Центров событий. Эта операция предоставляет удостоверению полный доступ ко всем сущностям в пространстве имен. Операции управления, изменяющие топологию пространства имен, изначально поддерживаются только через управление ресурсами Azure, а не через интерфейс управления REST Центров событий. Это также означает, что объект клиента .NET Framework [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) нельзя использовать с учетной записью Azure AD.  

## <a name="use-event-hubs-with-an-azure-ad-domain-user-account"></a>Использование Центров событий с помощью учетной записи пользователя домена в Azure AD

В следующем разделе описано, как создать и запустить пример приложения, которое запрашивает вход в систему интерактивного пользователя Azure AD, как предоставить учетной записи пользователя доступ к Центрам событий и как использовать удостоверение для доступа к Центрам событий. 

В этом введении описывается простое консольное приложение, [код для которого находится на сайте GitHub](https://github.com/Azure/azure-event-hubs/tree/master/samples/DotNet/Rbac/EventHubsSenderReceiverRbac/).

### <a name="create-an-active-directory-user-account"></a>Создание учетной записи пользователя Active Directory

Первый шаг не является обязательным. Каждая подписка Azure автоматически связана с клиентом Azure Active Directory. Если у вас есть к ней доступ, то она уже зарегистрирована. Это означает, что вы можете использовать имеющуюся учетную запись. 

Если вам все же нужно создать учетную запись для этого сценария, [выполните следующие действия](../automation/automation-create-aduser-account.md). Необходимо наличие разрешения на создание учетных записей в клиенте Azure Active Directory. Этот вариант не подходит для крупных корпоративных сценариев.

### <a name="create-an-event-hubs-namespace"></a>Создание пространства имен в Центрах событий

Далее [создайте пространство имен Центров событий](event-hubs-create.md) в одном из регионов Azure с поддержкой предварительной версии Центров событий для RBAC: **восточная часть США**, **восточная часть США 2** или **Западная Европа**. 

После создания пространства имен перейдите на страницу **Управление доступом (IAM)** на портале и щелкните **Добавить назначение ролей**, чтобы добавить учетную запись пользователя Azure AD к роли владельца. Если вы используете собственную учетную запись пользователя и создали пространство имен, вам уже назначена роль владельца. Чтобы добавить другую учетную запись в роль, найдите имя веб-приложения в области **Добавление разрешений** в поле **Select** (Выбор), а затем щелкните запись. Нажмите кнопку **Сохранить**. Теперь учетная запись имеет доступ к пространству имен Центров событий и к ранее созданному концентратору событий.
 
### <a name="register-the-application"></a>Регистрация приложения

Перед запуском примера приложения зарегистрируйте его в Azure AD и утвердите запрос на продолжение, позволяющий приложению получить доступ к Центрам событий от его имени. 

Так как пример приложения — консольное приложение, необходимо зарегистрировать собственное приложение и добавить разрешения API для **Microsoft.EventHub** в набор необходимых разрешений. Собственным приложениям также необходим **URI перенаправления** в Azure AD, выступающий в качестве идентификатора. URI не должен быть сетевым адресом. В этом примере используйте `https://eventhubs.microsoft.com`, так как в образце кода уже используется этот URI.

Подробные шаги по регистрации описаны в [этом руководстве](../active-directory/develop/quickstart-v1-integrate-apps-with-azure-ad.md). Выполните следующие действия, чтобы зарегистрировать **собственное** приложение, а затем следуйте инструкциям по обновлению, чтобы добавить API **Microsoft.EventHub** к необходимым разрешениям. Выполняя эти действия, запишите значения **TenantId** и **ApplicationId**, так как они необходимы для запуска приложения.

### <a name="run-the-app"></a>Запуск приложения

Перед запуском примера измените файл App.config и в зависимости от вашего сценария установите следующие значения:

- `tenantId`: задайте значение **TenantId**.
- `clientId`: задайте значение **ApplicationId**. 
- `clientSecret`: если необходимо войти в систему с помощью секрета клиента, создайте его в Azure AD. Кроме того, используйте веб-приложение или API вместо собственного приложения. Добавьте приложение на страницу **Управление доступом (IAM)** в созданном ранее пространстве имен.
- `eventHubNamespaceFQDN`: укажите полное DNS-имя только что созданного пространства имен Центров событий (например, `example.servicebus.windows.net`).
- `eventHubName`: укажите имя созданного концентратора событий.
- URI перенаправления, указанный в приложении на предыдущих шагах.
 
При запуске консольного приложения вам будет предложено выбрать сценарий. Щелкните **Interactive User Login** (Вход в систему с учетными данными текущего пользователя), указав его номер и нажав клавишу ВВОД. В приложении отобразится окно входа в систему, появится запрос на доступ к Центрам событий, а затем с помощью службы будет запущен сценарий отправки и получения, в котором используется удостоверение для входа.

Приложение использует значение `ServiceAudience.EventHubsAudience` как аудиторию токена. При использовании других языков или пакетов SDK, где аудитория недоступна как константа, правильное значение — `https://eventhubs.azure.net/`.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о Центрах событий см. по следующим ссылкам:

* Начало работы с помощью [учебника по Центрам событий](event-hubs-dotnet-standard-getstarted-send.md)
* [Часто задаваемые вопросы о Центрах событий](event-hubs-faq.md)
* [Сведения о ценах на Центры событий](https://azure.microsoft.com/pricing/details/event-hubs/)
* [Примеры приложений, использующих Центры событий](https://github.com/Azure/azure-event-hubs/tree/master/samples)
