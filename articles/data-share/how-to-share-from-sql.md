---
title: Совместное использование и получение данных из базы данных SQL Azure и Azure синапсе Analytics
description: Сведения о совместном использовании и получении данных из базы данных SQL Azure и Azure синапсе Analytics
author: jifems
ms.author: jife
ms.service: data-share
ms.topic: how-to
ms.date: 08/28/2020
ms.openlocfilehash: 2cb06b6802fdc4cebd04f687266f5ac08dde82c0
ms.sourcegitcommit: bcda98171d6e81795e723e525f81e6235f044e52
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/01/2020
ms.locfileid: "89270264"
---
# <a name="share-and-receive-data-from-azure-sql-database-and-azure-synapse-analytics"></a>Совместное использование и получение данных из базы данных SQL Azure и Azure синапсе Analytics

[!INCLUDE[appliesto-sql](includes/appliesto-sql.md)]

Общий ресурс данных Azure поддерживает общий доступ к базе данных SQL Azure на основе моментального снимка и Azure синапсе Analytics (ранее — хранилище Azure SQL). В этой статье объясняется, как совместно использовать и принимать данные из этих источников.

Общий ресурс данных Azure поддерживает общий доступ к таблицам и представлениям из базы данных SQL Azure и Azure синапсе Analytics (ранее — хранилище Azure SQL). Потребители данных могут принять данные в Azure Data Lake Storage 2-го поколения или хранилище BLOB-объектов Azure в виде CSV-или Parquet-файла, а также в базу данных SQL Azure и Azure синапсе Analytics в качестве таблиц.

При принятии данных в Azure Data Lake Store Gen2 или хранилище BLOB-объектов Azure полные моментальные снимки перезаписывают содержимое целевого файла, если он уже существует.
При получении данных в таблицу и если Целевая таблица еще не существует, Общая папка данных Azure создает таблицу SQL с исходной схемой. Если целевая таблица с таким именем уже существует, она будет удалена и переписана с использованием последнего полного моментального снимка. Добавочные моментальные снимки в настоящее время не поддерживаются.

## <a name="share-data"></a>Совместное использование данных

### <a name="prerequisites-to-share-data"></a>Необходимые условия для совместного использования данных

* Подписка Azure. Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/), прежде чем начинать работу.
* Адрес электронной почты для входа получателей в Azure (псевдонимы электронной почты не поддерживаются).
* Если исходное хранилище данных Azure находится в подписке Azure, отличной от той, которая будет использоваться для создания ресурса Data Share, зарегистрируйте [поставщик ресурсов Microsoft.DataShare](concepts-roles-permissions.md#resource-provider-registration) в подписке, в которой находится хранилище данных Azure. 

### <a name="prerequisites-for-sql-source"></a>Необходимые условия для источника SQL

* База данных SQL Azure или Azure Synapse Analytics (ранее хранилище данных SQL Azure) с таблицами и представлениями, к которым вы хотите предоставить общий доступ.
* Разрешение на запись в базы данных на сервере SQL, которое присутствует в *Microsoft.Sql/servers/databases/write*. Это разрешение назначено роли участника.
* Разрешение на доступ к хранилищу данных для общего ресурса данных. Это можно обеспечить следующим образом. 
    1. Укажите себя в качестве администратора Azure Active Directory для сервера SQL.
    1. Подключитесь к хранилищу данных SQL Azure или базе данных SQL Azure с использованием Azure Active Directory.
    1. Используйте редактор запросов (предварительная версия) для выполнения следующего сценария, чтобы добавить управляемое удостоверение для ресурса Data Share в качестве db_datareader. Необходимо подключиться с помощью Active Directory, а не аутентификации SQL Server. 
    
        ```sql
        create user "<share_acct_name>" from external provider;     
        exec sp_addrolemember db_datareader, "<share_acct_name>"; 
        ```                   
       Обратите внимание на то, что *<share_acc_name>* — это имя вашего ресурса Data Share. Если вы еще не создали ресурс Data Share, вы можете вернуться к этому требованию позже.  

* Пользователь Базы данных SQL Azure с доступом "db_datareader" для навигации и выбора таблиц и представлений, к которым необходимо предоставить общий доступ. 

* Доступ к брандмауэру для IP-адреса клиента SQL Server. Это можно обеспечить следующим образом. 
    1. В SQL Server на портале Azure перейдите к разделу *Брандмауэры и виртуальные сети*
    1. Чтобы разрешить доступ к службам Azure, щелкните переключатель **Вкл.**
    1. Щелкните **+Добавить IP-адрес клиента**, а затем **Сохранить**. IP-адрес клиента можно изменить. При следующем совместном использовании данных SQL из портала Azure может потребоваться повторение этого процесса. Вы можете также добавить диапазон IP-адресов. 

### <a name="sign-in-to-the-azure-portal"></a>Вход на портал Azure

Войдите на [портал Azure](https://portal.azure.com/).

### <a name="create-a-data-share-account"></a>Создание учетной записи для общего доступа к данным

Создайте ресурс Azure Data Share в группе ресурсов Azure.

1. Нажмите кнопку меню в левом верхнем углу портала, а затем выберите **создать ресурс** (+).

1. Найдите *Data Share*.

1. Выберите Общий ресурс данных и нажмите **Создать**.

1. Укажите основные сведения о ресурсе Azure Data Share, указав следующую информацию. 

     **Параметр** | **Рекомендуемое значение** | **Описание поля**
    |---|---|---|
    | Подписка | Ваша подписка | Выберите подписку Azure, которую нужно использовать для своей учетной записи Data Share.|
    | Группа ресурсов | *test-resource-group* | Воспользуйтесь существующей группой ресурсов или создайте новую. |
    | Расположение | *Восточная часть США 2* | Выберите регион для учетной записи Data Share.
    | Имя | *datashareaccount* | Укажите имя вашей учетной записи Data Share. |
    | | |

1. Выберите **Проверить и создать**, а затем **Создать**, чтобы подготовить учетную запись для общего ресурса данных. Подготовка новой учетной записи для общего доступа к данным обычно занимает около 2 минут или меньше. 

1. Когда развертывание будет завершено, выберите **Перейти ресурсу**.

### <a name="create-a-share"></a>Создание общей папки

1. Перейдите на страницу "Обзор Data Share".

    ![Общий доступ к данным](./media/share-receive-data.png "Общий доступ к данным") 

1. Выберите команду **Начать совместное использование данных**.

1. Нажмите кнопку **Создать**.   

1. Заполните сведения о вашей общей папке. Укажите имя, тип совместного использования, описание содержимого и условия использования (необязательно). 

    ![EnterShareDetails](./media/enter-share-details.png "Введите сведения об общем ресурсе") 

1. Выберите **Continue** (Продолжить).

1. Чтобы добавить наборы данных в общую папку, выберите **добавить наборы данных**. 

    ![Добавление наборов данных в общую папку](./media/datasets.png "Наборы данных")

1. Выберите тип набора данных, который хотите добавить. Вы увидите другой список типов наборов данных в зависимости от типа ресурса (моментальный снимок или на странице), который вы выбрали на предыдущем этапе. 

    ![AddDatasets](./media/add-datasets.png "Добавление наборов данных")    

1. Выберите свой SQL Server, укажите учетные данные и нажмите кнопку **Далее** для перехода к объекту, к которому вы хотите предоставить общий доступ, и выберите команду "добавить наборы данных". 

    ![SelectDatasets](./media/select-datasets-sql.png "Выбор наборов данных")    

1. На вкладке "Получатели" введите адреса электронной почты получателей данных, выбрав команду "+Добавить получателя". 

    ![AddRecipients](./media/add-recipient.png "Добавление получателей") 

1. Выберите **Continue** (Продолжить).

1. Если выбран тип общего доступа к моментальным снимкам, вы можете настроить расписание моментальных снимков для предоставления обновлений данных потребителям. 

    ![EnableSnapshots](./media/enable-snapshots.png "Включение моментальных снимков") 

1. Выберите время начала и интервал повторения. 

1. Выберите **Continue** (Продолжить).

1. На вкладке "Просмотр и создание" просмотрите содержимое пакета, параметры, получателей и параметры синхронизации. Нажмите кнопку **Создать**.

Azure Data Share создан, и получатель Data Share готов принять ваше приглашение. 

## <a name="receive-data"></a>Получение данных

### <a name="prerequisites-to-receive-data"></a>Необходимые условия для получения данных
Чтобы принять приглашение в общий ресурс данных, вам необходимо подготовить к работе ряд ресурсов Azure, которые перечислены ниже. 

Прежде чем принять приглашение в общий ресурс данных, выполните все предварительные требования. 

* Подписка Azure. Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/), прежде чем начинать работу.
* Приглашение Data Share. Приглашение от Microsoft Azure с темой "Приглашение Azure Data Share от **<yourdataprovider@domain.com>** ".
* Зарегистрируйте [поставщик ресурсов Microsoft.DataShare](concepts-roles-permissions.md#resource-provider-registration) в подписке Azure, где вы создадите ресурс Data Share и подписку Azure, в которой находятся целевые хранилища данных Azure.

### <a name="prerequisites-for-target-storage-account"></a>Необходимые условия для целевой учетной записи хранения
Если вы решили получить данные в службе хранилища Azure, ниже приведен список предварительных требований.

* Учетная запись хранения Azure. Если у вас еще нет учетной записи хранения Azure, вы можете [создать ее](https://docs.microsoft.com/azure/storage/common/storage-quickstart-create-account). 
* Разрешение на запись в учетную запись хранения, которая имеется в *Microsoft.Storage/storageAccounts/write*. Это разрешение назначено роли участника. 
* Разрешение на добавление назначения ролей в учетную запись хранения, имеющуюся в *Microsoft.Authorization/role assignments/write*. Это разрешение назначено роли владельца.  

### <a name="prerequisites-for-sql-target"></a>Необходимые условия для целевого объекта SQL
Если вы решили получить данные в базе данных SQL Azure, ниже приведен список предварительных требований для Azure синапсе Analytics.

* Разрешение на запись в базы данных на сервере SQL, которое присутствует в *Microsoft.Sql/servers/databases/write*. Это разрешение назначено роли участника. 
* Разрешение на доступ управляемого удостоверения общего ресурса данных к Базе данных SQL Azure или Хранилищу данных SQL Azure. Это можно обеспечить следующим образом. 
    1. Укажите себя в качестве администратора Azure Active Directory для сервера SQL.
    1. Подключитесь к хранилищу данных SQL Azure или базе данных SQL Azure с использованием Azure Active Directory.
    1. Используйте редактор запросов (предварительная версия) для выполнения следующего сценария, чтобы добавить управляемое удостоверение Data Share в качестве роли "db_datareader, db_datawriter, db_ddladmin" Необходимо подключиться с помощью Active Directory, а не аутентификации SQL Server. 

        ```sql
        create user "<share_acc_name>" from external provider; 
        exec sp_addrolemember db_datareader, "<share_acc_name>"; 
        exec sp_addrolemember db_datawriter, "<share_acc_name>"; 
        exec sp_addrolemember db_ddladmin, "<share_acc_name>";
        ```      
        Обратите внимание на то, что *<share_acc_name>* — это имя вашего ресурса Data Share. Если вы еще не создали ресурс Data Share, вы можете вернуться к этому требованию позже.         

* Доступ к брандмауэру для IP-адреса клиента SQL Server. Это можно обеспечить следующим образом. 
    1. В SQL Server на портале Azure перейдите к разделу *Брандмауэры и виртуальные сети*
    1. Чтобы разрешить доступ к службам Azure, щелкните переключатель **Вкл.**
    1. Щелкните **+Добавить IP-адрес клиента**, а затем **Сохранить**. IP-адрес клиента можно изменить. При следующем поступлении данных в целевое расположение SQL с портала Azure может потребоваться повторение этого процесса. Вы можете также добавить диапазон IP-адресов. 

### <a name="sign-in-to-the-azure-portal"></a>Вход на портал Azure

Войдите на [портал Azure](https://portal.azure.com/).

### <a name="open-invitation"></a>Открытие приглашения

1. Вы можете открыть приглашение из электронной почты или непосредственно из портала Azure. 

   Чтобы открыть приглашение из электронной почты, проверьте папку "Входящие" на наличие приглашения от поставщика данных. Это должно быть приглашение от Microsoft Azure с названием **Приглашение Azure Data Share от <yourdataprovider@domain.com>** . Выберите **Просмотреть приглашение**, чтобы увидеть ваше приглашение в Azure. 

   Чтобы открыть приглашение непосредственно из портала Azure, найдите на портале параметр **Приглашения Data Share**. Вы перейдете к списку приглашений Data Share.

   ![Список приглашений](./media/invitations.png "Список приглашений") 

1. Выберите общий ресурс для просмотра. 

### <a name="accept-invitation"></a>Принятие приглашения
1. Просмотрите все поля, в том числе **Условия использования**. Если вы согласны с условиями использования, установите флажок для подтверждения своего согласия. 

   ![Условия использования](./media/terms-of-use.png "Условия использования") 

1. В разделе *Target Data Share Account* (Целевая учетная запись Data Share) выберите подписку и группу ресурсов, куда будете развертывать общий ресурс данных. 

   В поле **учетной записи Data Share** выберите **Создать**, если у вас нет существующей учетной записи Data Share. В противном случае выберите учетную запись Data Share, где бы вы хотели принимать данные. 

   В поле **Received Share Name** (Имя полученного общего ресурса) можно оставить значение по умолчанию, заданное поставщиком данных, или указать для полученного общего ресурса новое имя. 

   Согласившись с условиями использования и указав учетную запись Data Share для управления полученным общим ресурсом, выберите **Accept and Configure** (Принять и настроить). Будет создана подписка на общий ресурс. 

   ![Принятие параметров](./media/accept-options.png "Принятие параметров") 

   В результате вы перейдете к полученному общему ресурсу в учетной записи Data Share. 

   Если вы не хотите принимать приглашение, выберите *Отклонить*. 

### <a name="configure-received-share"></a>Настройка полученного общего ресурса
Выполните следующие действия, чтобы настроить место для получения данных.

1. Перейдите на вкладку **Наборы данных**. Установите флажок рядом с набором данных, которому следует назначить место назначение. Нажмите **+ Сопоставить с целевым объектом**, чтобы выбрать целевое хранилище данных. 

   ![Кнопка "Сопоставить с целевым объектом"](./media/dataset-map-target.png "Сопоставление с целевым объектом") 

1. Выберите целевое хранилище данных, в котором должны находиться данные. Все файлы и таблицы данных в целевом хранилище данных с тем же путем и именем будут перезаписаны. 

   ![Целевая учетная запись хранения](./media/dataset-map-target-sql.png "Целевое хранилище данных") 

1. Для совместного использования на основе моментальных снимков можно также включить на вкладе **Расписание моментальных снимков** функцию расписания моментальных снимков при условии, что поставщик данных создал такое расписание для регулярного обновления данных. Установите флажок рядом с расписанием моментальных снимков и выберите **+ Включить**.

   ![Включение расписания моментальных снимков](./media/enable-snapshot-schedule.png "Включение расписания моментальных снимков")

### <a name="trigger-a-snapshot"></a>Активация создания моментальных снимков
Эти действия применимы только к общему доступу на основе моментальных снимков.

1. Вы можете активировать создание моментальных снимков, нажав на вкладке **Подробности** кнопку **Активировать моментальный снимок**. Здесь вы сможете активировать полные или добавочные моментальные снимки ваших данных. Если вы осуществляете прием данных от поставщика в первый раз, выберите полное копирование. Для источников SQL поддерживается только полный моментальный снимок.

   ![Активация создания моментального снимка](./media/trigger-snapshot.png "Активация создания моментального снимка") 

1. Если состояние последнего запуска является *успешным*, перейдите к целевому хранилищу данных для просмотра полученных данных. Выберите **Наборы данных**и щелкните ссылку в целевом пути. 

   ![Наборы данных объекта-получателя](./media/consumer-datasets.png "Сопоставление набора данных объекта-получателя") 

### <a name="view-history"></a>Просмотр истории
Этот шаг применим только для общего доступа на основе моментальных снимков. Чтобы просмотреть журнал моментальных снимков, выберите вкладку **Журнал**. Здесь вы найдете журнал всех моментальных снимков за последние 30 дней. 

## <a name="next-steps"></a>Дальнейшие действия
Вы узнали, как предоставлять общий доступ и принимать данные из учетной записи хранения с помощью службы общего доступа к данным Azure. Чтобы получить дополнительные сведения о совместном использовании из других источников данных, перейдите к [поддерживаемым хранилищам данных](supported-data-stores.md).

