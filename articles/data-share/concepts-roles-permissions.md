---
title: Роли и требования для Azure Data Share
description: Сведения о разрешениях, необходимых для обмена данными и их получения с помощью общего ресурса данных Azure.
author: joannapea
ms.author: joanpo
ms.service: data-share
ms.topic: conceptual
ms.date: 07/10/2019
ms.openlocfilehash: 0f836553c3c3bb324d76d022af189f154b5b1972
ms.sourcegitcommit: 42517355cc32890b1686de996c7913c98634e348
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/02/2020
ms.locfileid: "76964470"
---
# <a name="roles-and-requirements-for-azure-data-share"></a>Роли и требования для Azure Data Share 

В этой статье описываются роли и разрешения, необходимые для совместного использования и получения данных с помощью службы общего доступа к данным Azure. 

## <a name="roles-and-requirements"></a>Роли и требования

С помощью службы совместного использования данных Azure можно обмениваться данными без обмена учетными данными между поставщиком данных и потребителем. Служба общего доступа к данным Azure использует управляемые удостоверения (ранее известные как MSI) для проверки подлинности в хранилище данных Azure. 

Управляемому удостоверению общего ресурса Azure Data Share необходимо предоставить доступ к хранилищу данных Azure. Затем служба общего ресурса данных Azure использует это управляемое удостоверение для чтения и записи данных для совместного использования с помощью моментальных снимков, а затем устанавливает символическую ссылку для совместного использования на месте. 

Для предоставления общего доступа или получения данных из хранилища данных Azure пользователь должен иметь по крайней мере следующие разрешения. Для совместного использования на основе SQL требуются дополнительные разрешения.
* Разрешение на запись в хранилище данных Azure. Как правило, это разрешение существует в роли **участника** .
* Разрешение на создание назначения ролей в хранилище данных Azure. Как правило, разрешение на создание назначений ролей существует в роли **владельца** , в роли администратора доступа пользователей или в пользовательской роли с помощью Microsoft. Authorization, назначение ролей или разрешение на запись. Это разрешение не требуется, если управляемому удостоверению ресурса общего доступа к данным уже предоставлен доступ к хранилищу данных Azure. Необходимые роли см. в таблице ниже.

Ниже приведена сводка ролей, назначенных управляемому удостоверению ресурса общего доступа к данным:

| |  |  |
|---|---|---|
|**Тип хранилища данных**|**Хранилище данных источника поставщика данных**|**Целевое хранилище данных потребителя данных**|
|Хранилище BLOB-объектов Azure| Модуль чтения данных BLOB-объекта хранилища | Участник данных BLOB-объекта хранилища
|Azure Data Lake Gen1 | Владелец | Не поддерживается
|Azure Data Lake Gen2 | Модуль чтения данных BLOB-объекта хранилища | Участник данных BLOB-объекта хранилища
|Azure SQL Server | Участник БД SQL | Участник БД SQL
|Кластер Azure обозреватель данных | Участник | Участник
|

Для совместного использования на основе SQL пользователь SQL должен быть создан из внешнего поставщика в базе данных SQL с тем же именем, что и ресурс общего ресурса данных Azure. Ниже приведена сводка разрешений, необходимых пользователю SQL.

| |  |  |
|---|---|---|
|**Тип базы данных SQL**|**Разрешение пользователя SQL для поставщика данных**|**Разрешение пользователя SQL для потребителя данных**|
|База данных SQL Azure | db_datareader; | db_datareader, db_datawriter db_ddladmin
|Azure Synapse Analytics (ранее — Хранилище данных SQL) | db_datareader; | db_datareader, db_datawriter db_ddladmin
|


### <a name="data-provider"></a>Поставщик данных 
Чтобы добавить набор данных в общую папку данных Azure, управляемому удостоверению общего ресурса данных поставщика необходимо предоставить доступ к исходному хранилищу данных Azure. Например, в случае учетной записи хранения управляемое удостоверение ресурса общей папки предоставляет роль читателя данных BLOB-объекта хранилища. 

Это выполняется автоматически службой общих ресурсов данных Azure, когда пользователь добавляет набор данных через портал Azure и пользователь имеет соответствующее разрешение. Например, пользователь является владельцем хранилища данных Azure или членом пользовательской роли, которой назначено разрешение Microsoft. Authorization, роли/запись. 

Кроме того, пользователь может быть владельцем хранилища данных Azure, добавляя управляемое удостоверение ресурса общих ресурсов в хранилище данных Azure вручную. Это действие необходимо выполнить только один раз для каждого ресурса в общем ресурсе.

Чтобы создать назначение роли для управляемого удостоверения общего ресурса данных, выполните следующие действия.

1. Перейдите к хранилищу данных Azure.
1. Выберите **Управление доступом (IAM)** .
1. Выберите **Добавление назначения роли**.
1. В разделе *роль*выберите роль в таблице назначение ролей (например, для учетной записи хранения выберите *модуль чтения данных BLOB-объекта хранилища*).
1. В поле *выбрать*введите имя общего ресурса данных Azure.
1. Выберите команду *Сохранить*.

Для источников на основе SQL, помимо описанных выше шагов, пользователь SQL должен быть создан из внешнего поставщика в базе данных SQL с тем же именем, что и ресурс общего ресурса данных Azure. Этому пользователю необходимо предоставить разрешение *db_datareader* . Пример скрипта, а также другие необходимые компоненты для совместного использования на основе SQL можно найти в руководстве по [совместному использованию данных](share-your-data.md) . 

### <a name="data-consumer"></a>Потребитель данных
Для получения данных управляемому удостоверению общего ресурса потребителя данных необходимо предоставить доступ к целевому хранилищу данных Azure. Например, в случае учетной записи хранения управляемое удостоверение ресурса общей папки предоставляет роль участника данных BLOB-объекта хранилища. 

Это выполняется автоматически службой общего ресурса данных Azure, если пользователь указывает целевое хранилище данных через портал Azure и пользователь имеет соответствующее разрешение. Например, пользователь является владельцем хранилища данных Azure или членом пользовательской роли, для которой назначено разрешение Microsoft. Authorization, роли/запись. 

Кроме того, пользователь может быть владельцем хранилища данных Azure, добавляя управляемое удостоверение ресурса общих ресурсов в хранилище данных Azure вручную. Это действие необходимо выполнить только один раз для каждого ресурса в общем ресурсе.

Чтобы создать назначение роли для управляемого удостоверения ресурса ресурса данных вручную, выполните следующие действия.

1. Перейдите к хранилищу данных Azure.
1. Выберите **Управление доступом (IAM)** .
1. Выберите **Добавление назначения роли**.
1. В разделе *роль*выберите роль в таблице назначение ролей (например, для учетной записи хранения выберите *модуль чтения данных BLOB-объекта хранилища*).
1. В поле *выбрать*введите имя общего ресурса данных Azure.
1. Выберите команду *Сохранить*.

Для целевого объекта на основе SQL в дополнение к описанным выше шагам необходимо создать пользователя SQL из внешнего поставщика в базе данных SQL с тем же именем, что и ресурс общего ресурса данных Azure. Этому пользователю необходимо предоставить разрешения *db_datareader, db_datawriter, db_ddladmin* . Пример скрипта, а также другие необходимые компоненты для совместного использования на основе SQL можно найти в руководстве по [принятию и получению данных](subscribe-to-data-share.md) . 

Если вы предоставляете общий доступ к данным с помощью API-интерфейсов, эти назначения ролей необходимо создать вручную. 

Дополнительные сведения о добавлении назначения ролей см. в [этой документации](https://docs.microsoft.com/azure/role-based-access-control/role-assignments-portal#add-a-role-assignment). 

## <a name="resource-provider-registration"></a>Регистрация поставщика ресурсов 

Чтобы просмотреть приглашение к общему ресурсу данных Azure в клиенте Azure впервые, может потребоваться вручную зарегистрировать поставщик ресурсов Microsoft. Data Share в подписке Azure. Выполните следующие действия, чтобы зарегистрировать поставщик ресурсов Microsoft. данных в подписке Azure. 

1. В портал Azure перейдите к разделу **подписки**.
1. Выберите подписку, которую вы используете для общего ресурса данных Azure.
1. Щелкните **поставщики ресурсов**.
1. Найдите файл Microsoft.
1. Щелкните **Зарегистрировать**.

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о ролях в Azure см. в статье [Определения ролей](../role-based-access-control/role-definitions.md).

