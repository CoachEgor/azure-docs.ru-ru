---
title: Роли и требования для Azure Data Share
description: Сведения о разрешениях, необходимых для обмена данными и их получения с помощью общего ресурса данных Azure.
author: jifems
ms.author: jife
ms.service: data-share
ms.topic: conceptual
ms.date: 10/15/2020
ms.openlocfilehash: ac528d1cfb74221a7398e390cedda08df4ea4508
ms.sourcegitcommit: dbe434f45f9d0f9d298076bf8c08672ceca416c6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/17/2020
ms.locfileid: "92151399"
---
# <a name="roles-and-requirements-for-azure-data-share"></a>Роли и требования для Azure Data Share 

В этой статье описываются роли и разрешения, необходимые для совместного использования и получения данных с помощью службы общего доступа к данным Azure. 

## <a name="roles-and-requirements"></a>Роли и требования

С помощью службы совместного использования данных Azure можно обмениваться данными без обмена учетными данными между поставщиком данных и потребителем. Служба общего доступа к данным Azure использует управляемые удостоверения (ранее известные как MSI) для проверки подлинности в хранилище данных Azure. 

Управляемому удостоверению общего ресурса Azure Data Share необходимо предоставить доступ к хранилищу данных Azure. Затем служба общего ресурса данных Azure использует это управляемое удостоверение для чтения и записи данных для совместного использования с помощью моментальных снимков, а затем устанавливает символическую ссылку для совместного использования на месте. 

Для предоставления общего доступа или получения данных из хранилища данных Azure пользователь должен иметь по крайней мере следующие разрешения. Для совместного использования на основе SQL требуются дополнительные разрешения.

* Разрешение на запись в хранилище данных Azure. Как правило, это разрешение существует в роли **участника** .
* Разрешение на создание назначения ролей в хранилище данных Azure. Как правило, разрешение на создание назначений ролей существует в роли **владельца** , в роли администратора доступа пользователей или в пользовательской роли с помощью Microsoft. Authorization, назначение ролей или разрешение на запись. Это разрешение не требуется, если управляемому удостоверению ресурса общего доступа к данным уже предоставлен доступ к хранилищу данных Azure. Необходимые роли см. в таблице ниже.

Ниже приведена сводка ролей, назначенных управляемому удостоверению ресурса общего доступа к данным:

|**Тип хранилища данных**|**Хранилище данных источника поставщика данных**|**Целевое хранилище данных потребителя данных**|
|---|---|---|
|хранилище BLOB-объектов Azure| Читатель данных больших двоичных объектов хранилища | Участник данных BLOB-объектов хранилища
|Azure Data Lake 1-го поколения | Владелец | Не поддерживается
|Azure Data Lake 2-го поколения | Читатель данных больших двоичных объектов хранилища | Участник данных BLOB-объектов хранилища
|Кластер Azure Data Explorer | Участник | Участник
|

Для совместного использования на основе SQL пользователь SQL должен быть создан из внешнего поставщика в базе данных SQL Azure с тем же именем, что и ресурс общего ресурса данных Azure. Для создания этого пользователя требуется разрешение администратора Azure Active Directory. Ниже приведена сводка разрешений, необходимых пользователю SQL.

|**Тип базы данных SQL**|**Разрешение пользователя SQL для поставщика данных**|**Разрешение пользователя SQL для потребителя данных**|
|---|---|---|
|База данных SQL Azure | db_datareader, | db_datareader, db_datawriter db_ddladmin
|Azure Synapse Analytics (ранее — Хранилище данных SQL) | db_datareader, | db_datareader, db_datawriter db_ddladmin
|

### <a name="data-provider"></a>Поставщик данных

Чтобы добавить набор данных в общую папку данных Azure, управляемому удостоверению общего ресурса данных поставщика необходимо предоставить доступ к исходному хранилищу данных Azure. Например, в случае учетной записи хранения управляемое удостоверение ресурса общей папки предоставляет роль читателя данных BLOB-объекта хранилища. 

Это выполняется автоматически службой общих ресурсов данных Azure, когда пользователь добавляет набор данных через портал Azure и пользователь имеет соответствующее разрешение. Например, пользователь является владельцем хранилища данных Azure или членом пользовательской роли, которой назначено разрешение Microsoft. Authorization, роли/запись. 

Кроме того, пользователь может быть владельцем хранилища данных Azure, добавляя управляемое удостоверение ресурса общих ресурсов в хранилище данных Azure вручную. Это действие необходимо выполнить только один раз для каждого ресурса в общем ресурсе.

Чтобы создать назначение роли для управляемого удостоверения ресурса ресурса данных вручную, выполните следующие действия.  

1. Перейдите к хранилищу данных Azure.
1. Выберите **Управление доступом (IAM)** .
1. Выберите **добавить назначение ролей**.
1. В разделе *роль*выберите роль в таблице назначение ролей (например, для учетной записи хранения выберите *модуль чтения данных BLOB-объекта хранилища*).
1. В поле *выбрать*введите имя общего ресурса данных Azure.
1. Нажмите кнопку *Сохранить*.

Дополнительные сведения о назначении ролей см. в разделе [Добавление или удаление назначений ролей Azure с помощью портал Azure](https://docs.microsoft.com/azure/role-based-access-control/role-assignments-portal#add-a-role-assignment). При совместном использовании данных с помощью API-интерфейсов RESTFUL можно создать назначение ролей с помощью API-интерфейса, обратившись [к элементу Добавление или удаление назначений ролей Azure с помощью REST API](https://docs.microsoft.com/azure/role-based-access-control/role-assignments-rest). 

Для источников на основе SQL пользователь SQL должен быть создан из внешнего поставщика в базе данных SQL с тем же именем, что и ресурс общего ресурса данных Azure при подключении к базе данных SQL с использованием Azure Active Directory проверки подлинности. Этому пользователю необходимо предоставить разрешение *db_datareader* . Пример скрипта, а также другие необходимые компоненты для общего доступа на основе SQL можно найти в статье Общие сведения о [базе данных SQL Azure или синапсе Analytics](how-to-share-from-sql.md) . 

### <a name="data-consumer"></a>Потребитель данных
Для получения данных управляемому удостоверению общего ресурса потребителя данных необходимо предоставить доступ к целевому хранилищу данных Azure. Например, в случае учетной записи хранения управляемое удостоверение ресурса общей папки предоставляет роль участника данных BLOB-объекта хранилища. 

Это выполняется автоматически службой общего ресурса данных Azure, если пользователь указывает целевое хранилище данных через портал Azure и пользователь имеет соответствующее разрешение. Например, пользователь является владельцем хранилища данных Azure или членом пользовательской роли, для которой назначено разрешение Microsoft. Authorization, роли/запись. 

Кроме того, пользователь может быть владельцем хранилища данных Azure, добавляя управляемое удостоверение ресурса общих ресурсов в хранилище данных Azure вручную. Это действие необходимо выполнить только один раз для каждого ресурса в общем ресурсе.

Чтобы создать назначение роли для управляемого удостоверения ресурса ресурса данных вручную, выполните следующие действия. 

1. Перейдите к хранилищу данных Azure.
1. Выберите **Управление доступом (IAM)** .
1. Выберите **добавить назначение ролей**.
1. В разделе *роль*выберите роль в таблице назначение ролей (например, для учетной записи хранения выберите *модуль чтения данных BLOB-объекта хранилища*).
1. В поле *выбрать*введите имя общего ресурса данных Azure.
1. Нажмите кнопку *Сохранить*.

Дополнительные сведения о назначении ролей см. в разделе [Добавление или удаление назначений ролей Azure с помощью портал Azure](https://docs.microsoft.com/azure/role-based-access-control/role-assignments-portal#add-a-role-assignment). Если вы получаете данные с помощью API-интерфейсов RESTFUL, можно создать назначение ролей с помощью API, обратившись [к элементу Добавление или удаление назначений ролей Azure с помощью REST API](https://docs.microsoft.com/azure/role-based-access-control/role-assignments-rest). 

Для целевого объекта на основе SQL пользователь SQL должен быть создан из внешнего поставщика в базе данных SQL с тем же именем, что и ресурс общего ресурса данных Azure, при подключении к базе данных SQL с использованием Azure Active Directory проверки подлинности. Этому пользователю необходимо предоставить разрешения *db_datareader, db_datawriter, db_ddladmin* . Пример скрипта, а также другие необходимые компоненты для общего доступа на основе SQL можно найти в статье Общие сведения о [базе данных SQL Azure или синапсе Analytics](how-to-share-from-sql.md) . 

## <a name="resource-provider-registration"></a>Регистрация поставщика ресурсов 

Возможно, потребуется вручную зарегистрировать поставщик ресурсов Microsoft. на ресурсе в подписке Azure в следующих сценариях: 

* Просмотр приглашения на общий ресурс Azure в первый раз в клиенте Azure
* Совместное использование данных из хранилища данных Azure в другой подписке Azure из общего ресурса данных Azure
* Получение данных в хранилище данных Azure в другой подписке Azure из общего ресурса данных Azure

Выполните следующие действия, чтобы зарегистрировать поставщик ресурсов Microsoft. данных в подписке Azure. Для регистрации поставщика ресурсов необходимо иметь доступ *участника* к подписке Azure.

1. В портал Azure перейдите к разделу **подписки**.
1. Выберите подписку, которую вы используете для общего ресурса данных Azure.
1. Щелкните **поставщики ресурсов**.
1. Найдите файл Microsoft.
1. Щелкните **Зарегистрировать**.
 
Дополнительные сведения о поставщике ресурсов см. в статье [поставщики и типы ресурсов Azure](https://docs.microsoft.com/azure/azure-resource-manager/management/resource-providers-and-types).

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о ролях в Azure см. в статье [Определения ролей](../role-based-access-control/role-definitions.md).
