---
title: Руководство по принятию и получению данных в Azure Data Share
description: Руководство по принятию и получению данных с помощью службы Azure Data Share.
author: joannapea
ms.author: joanpo
ms.service: data-share
ms.topic: tutorial
ms.date: 07/10/2019
ms.openlocfilehash: 4dff48f909cd3febbbb7e92dcf96070020b8f57c
ms.sourcegitcommit: 58faa9fcbd62f3ac37ff0a65ab9357a01051a64f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/29/2020
ms.locfileid: "82145135"
---
# <a name="tutorial-accept-and-receive-data-using-azure-data-share"></a>Руководство по Прием и получение данных с помощью Azure Data Share  

В этом руководстве вы узнаете, как принять приглашение в общий ресурс данных с помощью службы Azure Data Share, а также как получить данные, к которым вам предоставили доступ и включить интервал регулярного обновления, чтобы всегда иметь последний моментальный снимок этих данных. 

> [!div class="checklist"]
> * Как принять приглашение Azure Data Share
> * Создание учетной записи Azure Data Share
> * Указание места назначения данных.
> * Создание подписки на общий ресурс с данными для получения запланированного обновления.

## <a name="prerequisites"></a>Предварительные требования
Чтобы принять приглашение в общий ресурс данных, вам необходимо подготовить к работе ряд ресурсов Azure, которые перечислены ниже. 

Прежде чем принять приглашение в общий ресурс данных, выполните все предварительные требования. 

* Подписка Azure. Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/), прежде чем начинать работу.
* Приглашение Data Share. Приглашение от Microsoft Azure с темой "Приглашение Azure Data Share от **<yourdataprovider@domain.com>** ".
* Зарегистрируйте [поставщик ресурсов Microsoft.DataShare](concepts-roles-permissions.md#resource-provider-registration) в подписке Azure, где вы создадите ресурс Data Share и подписку Azure, в которой находятся целевые хранилища данных Azure.

### <a name="receive-data-into-a-storage-account"></a>Получение данных в учетную запись хранения 

* Учетная запись хранения Azure. Если у вас еще нет учетной записи хранения Azure, вы можете [создать ее](https://docs.microsoft.com/azure/storage/common/storage-quickstart-create-account). 
* Разрешение на запись в учетную запись хранения, которая имеется в *Microsoft.Storage/storageAccounts/write*. Это разрешение назначено роли участника. 
* Разрешение на добавление назначения ролей в учетную запись хранения, имеющуюся в *Microsoft.Authorization/role assignments/write*. Это разрешение назначено роли владельца.  

### <a name="receive-data-into-a-sql-based-source"></a>Получение данных в источник на основе SQL

* Разрешение на запись в базы данных на сервере SQL, которое присутствует в *Microsoft.Sql/servers/databases/write*. Это разрешение назначено роли участника. 
* Разрешение на доступ управляемого удостоверения общего ресурса данных к Базе данных SQL Azure или Хранилищу данных SQL Azure. Это можно обеспечить следующим образом. 
    1. Укажите себя в качестве администратора Azure Active Directory для сервера SQL.
    1. Подключитесь к хранилищу данных SQL Azure или базе данных SQL Azure с использованием Azure Active Directory.
    1. Используйте редактор запросов (предварительная версия) для выполнения следующего сценария, чтобы добавить управляемое удостоверение Data Share в качестве роли "db_datareader, db_datawriter, db_ddladmin" Необходимо подключиться с помощью Active Directory, а не аутентификации SQL Server. 

        ```sql
        create user "<share_acc_name>" from external provider; 
        exec sp_addrolemember db_datareader, "<share_acc_name>"; 
        exec sp_addrolemember db_datawriter, "<share_acc_name>"; 
        exec sp_addrolemember db_ddladmin, "<share_acc_name>";
        ```      
        Обратите внимание на то, что *<share_acc_name>* — это имя вашего ресурса Data Share. Если вы еще не создали ресурс Data Share, вы можете вернуться к этому требованию позже.         

* Доступ к брандмауэру для IP-адреса клиента SQL Server. Это можно обеспечить следующим образом. 
    1. В SQL Server на портале Azure перейдите к разделу *Брандмауэры и виртуальные сети*
    1. Чтобы разрешить доступ к службам Azure, щелкните переключатель **Вкл.**
    1. Щелкните **+Добавить IP-адрес клиента**, а затем **Сохранить**. IP-адрес клиента можно изменить. При следующем поступлении данных в целевое расположение SQL с портала Azure может потребоваться повторение этого процесса. Вы можете также добавить диапазон IP-адресов. 


### <a name="receive-data-into-an-azure-data-explorer-cluster"></a>Получение данных в кластере Azure Data Explorer: 

* Кластер Azure Data Explorer в том же центре обработки данных Azure, что и кластер Azure Data Explorer поставщика данных: Если у вас еще нет кластера, вы можете создать [кластер Azure Data Explorer](https://docs.microsoft.com/azure/data-explorer/create-cluster-database-portal). Если вы не знакомы с центром обработки данных Azure в кластере поставщика данных, вы можете создать кластер позже.
* Разрешение на запись в кластер Azure Data Explorer, имеющийся в *Microsoft.Kusto/clusters/write*. Это разрешение назначено роли участника. 
* Разрешение на добавление назначения ролей в кластер Azure Data Explorer *Microsoft.Authorization/role assignments/write*. Это разрешение назначено роли владельца. 

## <a name="sign-in-to-the-azure-portal"></a>Вход на портал Azure

Войдите на [портал Azure](https://portal.azure.com/).

## <a name="open-invitation"></a>Открытие приглашения

1. Вы можете открыть приглашение из электронной почты или непосредственно из портала Azure. 

   Чтобы открыть приглашение из электронной почты, проверьте папку "Входящие" на наличие приглашения от поставщика данных. Это должно быть приглашение от Microsoft Azure с названием **Приглашение Azure Data Share от <yourdataprovider@domain.com>** . Выберите **Просмотреть приглашение**, чтобы увидеть ваше приглашение в Azure. 

   Чтобы открыть приглашение непосредственно из портала Azure, найдите на портале параметр **Приглашения Data Share**. Вы перейдете к списку приглашений Data Share.

   ![Приглашения](./media/invitations.png "Список приглашений") 

1. Выберите общий ресурс для просмотра. 

## <a name="accept-invitation"></a>Принятие приглашения
1. Просмотрите все поля, в том числе **Условия использования**. Если вы согласны с условиями использования, установите флажок для подтверждения своего согласия. 

   ![Условия использования](./media/terms-of-use.png "Условия использования") 

1. В разделе *Target Data Share Account* (Целевая учетная запись Data Share) выберите подписку и группу ресурсов, куда будете развертывать общий ресурс данных. 

   В поле **учетной записи Data Share** выберите **Создать**, если у вас нет существующей учетной записи Data Share. В противном случае выберите учетную запись Data Share, где бы вы хотели принимать данные. 

   В поле **Received Share Name** (Имя полученного общего ресурса) можно оставить значение по умолчанию, заданное поставщиком данных, или указать для полученного общего ресурса новое имя. 

   ![Целевая учетная запись Data Share](./media/target-data-share.png "Целевая учетная запись Data Share") 

1. Согласившись с условиями использования и указав расположение для общего ресурса, выберите *Accept and Configure* (Принять и настроить). Будет создана подписка на общий ресурс.

   Для общего доступа на основе моментальных снимков на следующем экране будет предложено выбрать целевую учетную запись хранения для копирования данных. 

   ![Принятие параметров](./media/accept-options.png "Принятие параметров") 

   Если вы хотите принять приглашение сейчас, но настроить целевое хранилище данных позднее, выберите *Accept and Configure later* (Принять и настроить позже). Сведения о возобновлении конфигурации общего ресурса данных, см. на странице [How to configure a dataset mapping for a received share in Azure Data Share](how-to-configure-mapping.md) (Настройка сопоставлений наборов данных для полученного общего ресурса в Azure Data Share). 

   Сведения о возобновлении конфигурации общего ресурса данных на месте, см. на странице [How to configure a dataset mapping for a received share in Azure Data Share](how-to-configure-mapping.md) (Настройка сопоставлений наборов данных для полученного общего ресурса в Azure Data Share). 

   Если вы не хотите принимать приглашение, выберите *Отклонить*. 

## <a name="configure-storage"></a>Настройка хранилища
1. В разделе *Target Storage Settings* (Параметры целевого хранилища) выберите подписку, группу ресурсов и учетную запись хранения, где вы хотите получать свои данные. 

   ![Параметры целевого хранилища](./media/target-storage-settings.png "Целевое хранилище") 

1. Чтобы получать регулярные обновления данных, включите настройки создания моментальных снимков. Обратите внимание, что вы сможете увидеть параметры расписания создания моментальных снимком только в том случае, если ваш поставщик данных включил расписание в общий ресурс. 

   ![Параметры моментального снимка](./media/snapshot-settings.png "Параметры моментального снимка") 

1. Щелкните *Сохранить*. 

> [!IMPORTANT]
> Если вы получаете данные SQL и хотите передавать их в источник на основе SQL, ознакомьтесь с нашим практическим руководством [How to configure a dataset mapping for a received share in Azure Data Share](how-to-configure-mapping.md) (Настройка сопоставлений наборов данных для полученного общего ресурса в Azure Data Share), чтобы узнать, как настроить SQL Server в качестве назначения для набора данных. 

## <a name="trigger-a-snapshot"></a>Активация создания моментальных снимков
Эти действия применимы только к общему доступу на основе моментальных снимков.

1. Вы можете активировать создание моментальных снимков, выбрав в разделе Received Shares (Полученные общие ресурсы) вкладку "Подробности", а затем — **Trigger snapshot** (Активировать создание моментальных снимков). Здесь вы сможете активировать полные или добавочные моментальные снимки ваших данных. Если вы осуществляете прием данных от поставщика в первый раз, выберите полное копирование. 

   ![Активация создания моментального снимка](./media/trigger-snapshot.png "Активация создания моментального снимка") 

1. Если состояние последнего запуска является *успешным*, перейдите к целевому хранилищу данных для просмотра полученных данных. Выберите **Наборы данных**и щелкните ссылку в целевом пути. 

   ![Наборы данных объекта-получателя](./media/consumer-datasets.png "Сопоставление набора данных объекта-получателя") 

## <a name="view-history"></a>Просмотр истории
Чтобы просмотреть журнал моментальных снимков, перейдите в раздел Received Shares (Полученные общие ресурсы) -> "Журнал". Здесь вы найдете журнал всех моментальных снимков за последние 60 дней. 

## <a name="next-steps"></a>Дальнейшие действия
В этом учебнике вы узнали, как принять приглашение и получить данные Azure Data Share. Дополнительные сведения о понятиях Azure Data Share см. в[ этой статье](terminology.md).