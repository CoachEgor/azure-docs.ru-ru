---
title: Обновление реестра контейнеров Azure уровня "Классический"
description: Воспользуйтесь преимуществами управляемых реестров контейнеров с расширенным набором функций ценовой категории "Базовый", "Стандартный" или "Премиум", обновив неуправляемый реестр контейнеров уровня "Классический".
services: container-registry
author: dlepow
manager: gwallace
ms.service: container-registry
ms.topic: article
ms.date: 03/26/2019
ms.author: danlep
ms.openlocfilehash: 05c227e7de078c6bb371049f16e191598b9ca4e5
ms.sourcegitcommit: f5075cffb60128360a9e2e0a538a29652b409af9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/18/2019
ms.locfileid: "68310377"
---
# <a name="upgrade-a-classic-container-registry"></a>Обновление реестра контейнеров уровня "Классический"

Реестр контейнеров Azure (ACR) доступен на нескольких уровнях служб, [известных как номера SKU](container-registry-skus.md). В первоначальном выпуске ACR предлагался один номер SKU уровня "Классический", в котором не предоставляются несколько возможностей, имеющиеся в номерах SKU уровня "Базовый", "Стандартный" и "Премиум" (известные как *управляемые* реестры).

Классическое значение SKU является устаревшим и будет недоступно после апреля 2019. В этой статье подробно описывается переход с неуправляемого реестра уровня "Классический" на один из управляемых номеров SKU, чтобы воспользоваться преимуществами их улучшенных функций.

## <a name="why-upgrade"></a>Причины, по которым стоит установить обновление

Классический номер SKU реестра является **устаревшим**и будет недоступен после **апреля 2019**. Все существующие классические реестры должны быть обновлены до апреля 2019. Будут выдаваться функции управления на портале классических реестров. Создание новых классических реестров будет отключено после апреля 2019.

Из-за запланированных устаревших и ограниченных возможностей классических неуправляемых реестров все классические реестры должны быть обновлены до управляемых реестров (Basic, Standard или Premium). Эти номера SKU более высокого уровня более тесно интегрируют реестр с возможностями Azure. Дополнительные сведения о ценах и возможностях различных уровней служб см. в разделе [номера SKU реестра контейнеров](container-registry-skus.md).

Реестр уровня "Классический" зависит от учетной записи хранения, которую Azure автоматически подготавливает в вашей подписке Azure при создании реестра. Номера SKU "Базовый", "Стандартный" и "Премиум" используют преимущества [дополнительных функций хранения Azure](container-registry-storage.md), прозрачно обрабатывая хранилище образов для вас. Отдельная учетная запись хранения не создается в подписке.

Управляемое хранилище реестров предоставляет следующие преимущества.

* Образы контейнеров [зашифрованы при хранении](container-registry-storage.md#encryption-at-rest).
* Образы хранятся с помощью [геоизбыточного хранилища](container-registry-storage.md#geo-redundant-storage)и подтверждают резервное копирование образов с использованием репликации в нескольких регионах (только SKU Premium).
* Возможность без ограничений [перемещаться между номерами SKU](container-registry-skus.md#changing-skus), что обеспечивает высокую пропускную способность при выборе номера SKU более высокого уровня. С каждым номером SKU ACR может удовлетворить ваши требования к пропускной способности по мере роста ваших потребностей.
* Единая модель безопасности для реестра и его хранилища предоставляет возможность упрощенного управления правами. Вы можете управлять разрешениями только для реестра контейнеров без необходимости управлять разрешениями для отдельной учетной записи хранения.

Дополнительные сведения о хранилище образов в записи контроля доступа см. в статье о [хранилище образов контейнеров в Реестре контейнеров Azure](container-registry-storage.md).

## <a name="migration-considerations"></a>Рекомендации по переносу

При обновлении классического реестра до управляемого реестра Azure должен скопировать все существующие образы контейнеров из учетной записи хранения, созданной службой контроля доступа в подписке, в учетную запись хранения, управляемую Azure. В зависимости от размера реестра этот процесс может занять от нескольких минут до нескольких часов. Для целей оценки необходимо время миграции приблизительно 0,5 гиб в минуту.

Во время процесса `docker push` преобразования операции отключаются в течение последних 10% миграции. `docker pull`функция продолжит работать в обычном режиме.

Во время преобразования не удаляйте и не изменяйте содержимое учетной записи хранения, в которую копируется реестр уровня "Классический". Это может привести к повреждению или потере образов контейнера.

После завершения миграции учетная запись хранения в подписке, которая изначально была создана в классическом реестре, больше не используется реестром контейнеров Azure. После проверки успешности миграции рассмотрите возможность удаления учетной записи хранения, чтобы свести затраты к минимуму.

>[!IMPORTANT]
> Обновление реестра от уровня "Классический" до одного из управляемых номеров SKU является **односторонним процессом**. После обновления реестра до уровня "Базовый", "Стандартный" или "Премиум" вы не сможете вернуться к использованию уровня "Классический". Однако вы можете без ограничений перемещаться между управляемыми номерами SKU с емкостью, достаточной для реестра.

## <a name="how-to-upgrade"></a>Обновление

Неуправляемый реестр уровня "Классический" можно обновить до одного из управляемых SKU несколькими способами. В следующих разделах описывается процесс использования [Azure CLI][azure-cli] and the [Azure portal][azure-portal].

## <a name="upgrade-in-azure-cli"></a>Обновление с помощью интерфейса командной строки Azure

Чтобы обновить классический реестр в Azure CLI, выполните команду [AZ контроля доступа Update][az-acr-update] и укажите новый номер SKU для реестра. В следующем примере реестр уровня "Классический" с именем *myclassicregistry* обновляется до SKU уровня "Премиум".

```azurecli-interactive
az acr update --name myclassicregistry --sku Premium
```

После миграции вы увидите выходные данные, аналогичные следующим. Обратите внимание `sku` , что параметр имеет значение " `storageAccount` премиум `null`" и указывает, что теперь Azure управляет хранилищем образов для этого реестра.

```JSON
{
  "adminUserEnabled": false,
  "creationDate": "2017-12-12T21:23:29.300547+00:00",
  "id": "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/myresourcegroup/providers/Microsoft.ContainerRegistry/registries/myregistry",
  "location": "eastus",
  "loginServer": "myregistry.azurecr.io",
  "name": "myregistry",
  "provisioningState": "Succeeded",
  "resourceGroup": "myresourcegroup",
  "sku": {
    "name": "Premium",
    "tier": "Premium"
  },
  "status": null,
  "storageAccount": null,
  "tags": {},
  "type": "Microsoft.ContainerRegistry/registries"
}
```

Если указать управляемый номер SKU реестра, максимальная емкость которого меньше, чем размер реестра уровня "Классический", отобразится следующее сообщение об ошибке.

`Cannot update the registry SKU due to reason: Registry size 12936251113 bytes exceeds the quota value 10737418240 bytes for SKU Basic. The suggested SKU is Standard.`

При возникновении подобной ошибки снова выполните команду [AZ запись контроля][az-acr-update] доступа и укажите предлагаемый SKU, который является номером SKU следующего верхнего уровня, который может разместить ваши образы.

## <a name="upgrade-in-azure-portal"></a>Обновление на портале Azure

При обновлении классического реестра с помощью портал Azure Azure автоматически выбирает SKU "Стандартный" или "Премиум" в зависимости от того, какой SKU может разместить ваши образы. Например, если в реестре содержится менее 100 гиб в изображениях, Azure автоматически выберет и преобразует классический реестр в стандартный (максимум 100 гиб).

Чтобы обновить реестр уровня "Классический" с помощью портала Azure, перейдите в раздел реестра контейнеров **Overview** (Обзор) и выберите **Обновление до управляемого реестра**.

![Кнопка обновления реестра уровня "Классический" в пользовательском интерфейсе портала Azure][update-classic-01-upgrade]

Щелкните **ОК**, чтобы подтвердить обновление управляемого реестра.

Во время миграции на портале **состояние подготовки** реестра — *Updating* (Обновляется). Как упоминалось ранее `docker push` , операции отключаются в течение последних 10% миграции. Не удаляйте и не обновляйте учетную запись хранения, используемую классическим реестром во время миграции. это может привести к повреждению образа.

![Процесс обновления реестра уровня "Классический" в пользовательском интерфейсе портала Azure][update-classic-03-updating]

После завершения миграции **состояние подготовки** указывает на *успех*, и вы можете возобновить нормальную работу с реестром.

![Завершение обновления реестра уровня "Классический" в пользовательском интерфейсе портала Azure][update-classic-04-updated]

## <a name="next-steps"></a>Следующие шаги

После обновления классического реестра до управляемого реестра Azure больше не использует учетную запись хранения, которая изначально была создана в классическом реестре. Чтобы сократить затраты, рассмотрите возможность удаления учетной записи хранения или контейнера больших двоичных объектов в учетной записи, содержащей старые образы контейнера.

<!-- IMAGES -->
[update-classic-01-upgrade]: ./media/container-registry-upgrade/update-classic-01-upgrade.png
[update-classic-02-confirm]: ./media/container-registry-upgrade/update-classic-02-confirm.png
[update-classic-03-updating]: ./media/container-registry-upgrade/update-classic-03-updating.png
[update-classic-04-updated]: ./media/container-registry-upgrade/update-classic-04-updated.png

<!-- LINKS - internal -->
[az-acr-update]: /cli/azure/acr#az-acr-update
[azure-cli]: /cli/azure/install-azure-cli
[azure-portal]: https://portal.azure.com