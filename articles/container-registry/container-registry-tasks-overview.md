---
title: Обзор Задач ACR
description: Введение в ACR Tasks— набор функций в реестре контейнеров Azure, обеспечивающий безопасное автоматическое построение изображения контейнеров, управление и исправление в облаке.
ms.topic: article
ms.date: 01/22/2020
ms.openlocfilehash: 4fda57c1d7c866f2e6f72b04d75e53f91e995baf
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79087289"
---
# <a name="automate-container-image-builds-and-maintenance-with-acr-tasks"></a>Автоматизация сборки изображений контейнера и техническое обслуживание с помощью задач ACR

Контейнеры предоставляют новые уровни виртуализации, изолируя зависимости приложения и разработчиков от требований в отношении инфраструктуры и эксплуатации. Однако остается необходимость решения вопроса о том, как управлять виртуализацией этого приложения и исправлять жизненный цикл контейнера.

## <a name="what-is-acr-tasks"></a>Что такое "Задачи ACR"?

**Задачи ACR** — это набор компонентов в Реестре контейнеров Azure. Он обеспечивает создание облачных контейнерных изображений для [платформ,](#image-platforms) включая Linux, Windows и ARM, а также позволяет автоматизировать [исправление ОС и фреймворков](#automate-os-and-framework-patching) для контейнеров Docker. ACR Tasks не только расширяет ваш цикл разработки «внутреннего цикла» до облака с помощью сборок изображений контейнеров по требованию, но и позволяет автоматические сборки, вызванные обновлениями исходного кода, обновлениями базового изображения контейнера или таймерами. Например, с помощью триггеров базового обновления изображений можно автоматизировать работу над платформой ОС и платформой приложений, сохраняя безопасные среды при соблюдении принципов непреложных контейнеров.

## <a name="task-scenarios"></a>Сценарии задач

ACR Tasks поддерживает несколько сценариев для создания и обслуживания изображений контейнеров и других артефактов. Подробности в этой статье смотрите следующие разделы.

* **[Быстрая задача](#quick-task)** - Сборка и нажатие изображения одного контейнера в реестр контейнеров по требованию, в Azure, без локальной установки Docker Engine. Выполняйте `docker build` и `docker push` в облаке.
* **Автоматически срабатывает задачи** - Включить один или несколько *триггеров* для создания изображения:
  * **[Триггер на обновление исходного кода](#trigger-task-on-source-code-update)** 
  * **[Триггер на базовом обновлении изображения](#automate-os-and-framework-patching)** 
  * **[Триггер по расписанию](#schedule-a-task)** 
* **[Многоступенчатая задача](#multi-step-tasks)** - Расширить возможность создания и нажатия одного изображения задач ACR с помощью многоступенчатых многоконтейнерных рабочих процессов. 

Каждая задача ACR имеет связанный [контекст исходного кода](#context-locations) - расположение набора исходных файлов, используемых для создания изображения контейнера или другого артефакта. Пример ы входят репозиторий Git или локальная файловая система.

Задачи также могут использовать [преимущества переменных выполнения,](container-registry-tasks-reference-yaml.md#run-variables)так что вы можете повторно использовать определения задач и стандартизировать теги для изображений и артефактов.

## <a name="quick-task"></a>Быстрая задача

Цикл разработки "внутреннего цикла" — это итеративный процесс написания кода, сборки и тестирования приложения перед фиксацией в системе управления версиями. Это лишь начало управления жизненным циклом контейнера.

Прежде чем зафиксировать первую строку кода, функция [Быстрая задача](container-registry-tutorial-quick-task.md) службы "Задачи ACR" может обеспечить интегрированный опыт разработки, разгружая сборки образов контейнера в Azure. С помощью быстрых задач можно проверить автоматические определения сборки и перехватывать потенциальные проблемы перед фиксацией кода.

Используя знакомый формат `docker build`, команда [az acr build][az-acr-build] в Azure CLI извлекает [контекст](#context-locations) (набор файлов для сборки), отправляет его в службу "Задачи ACR" и по умолчанию отправляет встроенный образ в его реестр после завершения.

Для введения см. quickstart для [создания и запуска изображения контейнера](container-registry-quickstart-task-cli.md) в реестре контейнеров Azure.  

Служба "Задачи ACR" разработана как примитив жизненного цикла контейнеров. К примеру, интегрируйте службу "Задачи ACR" в решение CI/CD. Выполнив команды [az login][az-login] с [субъектом-службой][az-login-service-principal], решение CI/CD может выдавать команды [az acr build][az-acr-build] для запуска сборок образов.

Узнайте, как использовать быстрые задачи из первого руководства по Задачам ACR: [Руководство. Создание образов контейнера в облаке с помощью службы "Задачи Реестра контейнеров Azure"](container-registry-tutorial-quick-task.md).

> [!TIP]
> Если вы хотите создать и нажать изображение непосредственно из исходного кода, без Dockerfile, Azure Container Registry предоставляет команду [сборки пакета az acr][az-acr-pack-build] (предварительный просмотр). Этот инструмент создает и выталкивает изображение из исходного кода приложения с помощью [Cloud Native Buildpacks.](https://buildpacks.io/)

## <a name="trigger-task-on-source-code-update"></a>Задача триггера по обновлению исходного кода

Запустите создание изображения контейнера или многоступенчатую задачу, когда код заявится или запрос на вытягивание сделан или обновлен, в общедоступный или частный репозиторий Git в GitHub или Azure DevOps. Например, настроить задачу сборки с задачей команды Azure CLI [az acr,][az-acr-task-create] удевив рекогностую часть Git и опционально ветку и Dockerfile. Когда команда обновляет код в репозитории, созданный ACR Tasks запускает сборку изображения контейнера, определенного в репо. 

Задачи ACR поддерживают следующие триггеры при установке репо Git в качестве контекста задачи:

| Триггер | По умолчанию включено |
| ------- | ------------------ |
| Commit | Да |
| Запрос на вытягивание | нет |

Чтобы настроить триггер обновления исходного кода, необходимо предоставить задаче токен личного доступа (PAT) для настройки веб-крючка в публичном или частном репо GitHub или Azure DevOps.

> [!NOTE]
> Сейчас Задачи ACR не поддерживают триггеры фиксации или запроса на вытягивание в репозиториях GitHub Enterprise.

Узнайте, как активировать сборку при фиксации исходного кода из второго руководства по службе "Задачи ACR": [Руководство. Автоматизация сборок образов контейнера с помощью службы "Задачи Реестра контейнеров Azure"](container-registry-tutorial-build-task.md).

## <a name="automate-os-and-framework-patching"></a>Автоматизация установки исправлений ОС и платформы

Мощность ACR Tasks для действительного повышения рабочего процесса сборки контейнеров обусловлена его способностью обнаруживать обновление *базового изображения.* Особенностью большинства контейнерных изображений, базовое изображение родительского изображения, на котором основано одно или несколько изображений приложения. Базовые изображения обычно содержат операционную систему, а иногда и платформы приложений. 

Можно настроить задачу ACR для отслеживания зависимости от базового изображения при построении изображения приложения. Когда обновленное базовое изображение перемещается в ваш реестр или базовое изображение обновляется в общедоступном репо, например в Docker Hub, ACR Tasks могут автоматически создавать любые изображения приложений на его основе.
Благодаря такому автоматическому обнаружению и повторному выполнению сборок служба "Задачи ACR" экономит время и усилия, необходимые для того, чтобы вручную отслеживать и обновлять каждый образ приложения, ссылающийся на обновленный базовый образ.

Подробнее об [спусковых крючках базового изображения](container-registry-tasks-base-images.md) для задач ACR. И узнать, как вызвать сборку изображений, когда базовое изображение перенадвигается в реестр контейнеров в учебном центре [Automate, когда базовое изображение обновляется в реестре контейнеров Azure](container-registry-tutorial-base-image-update.md)

## <a name="schedule-a-task"></a>Планирование задачи

По желанию запланируйте задачу, настроив один или несколько *триггеров таймера* при создании или обновлении задачи. Планирование задачи полезно для выполнения рабочих нагрузок контейнера по определенному графику, или выполнения операций по техническому обслуживанию или тестов на изображениях, регулярно перемещаемых в ваш реестр. Для получения [подробной](container-registry-tasks-scheduled.md)информации см.

## <a name="multi-step-tasks"></a>Многошаговые задачи

Функция Многошаговые задачи обеспечивает определение и выполнение задач на основе шага для создания, тестирования и исправления изображений контейнера в облаке. Шаги задач, определенные в [файле YAML,](container-registry-tasks-reference-yaml.md) определяют отдельные операции сборки и нажатия для изображений контейнеров или других артефактов. Они также могут определять выполнение одного или нескольких контейнеров, причем каждый шаг использует контейнер в качестве среды выполнения.

Например, можно создать многошаговую задачу, которая автоматизирует следующие операции:

1. Сборка образа веб-приложения.
1. Выполнение контейнера веб-приложения.
1. Сборка тестового образа веб-приложения.
1. Запустите тестовый контейнер веб-приложения, который выполняет тесты против запущенного контейнера приложений
1. Если тесты проходят успешно, создайте пакет архива диаграмм Helm.
1. Выполнение команды `helm upgrade` с использованием нового пакета архива диаграмм Helm.

Многошаговые задачи позволяют разделить создание, выполнение и тестирование образов на большее количество составных шагов с поддержкой зависимостей между шагами. Благодаря многошаговым задачам в службе "Задачи ACR" у вас есть более детальный контроль над рабочими процессами создания и тестирования образа, а также исправления платформы и ОС.

Дополнительные сведения о многошаговых задачах см. в статье [Выполнение многошаговых задач сборки, тестирования и исправления в службе "Задачи ACR"](container-registry-tasks-multi-step.md).

## <a name="context-locations"></a>Расположение контекста

В следующей таблице приведено несколько примеров поддерживаемых расположений контекста для Задач ACR:

| Расположение контекста | Описание | Пример |
| ---------------- | ----------- | ------- |
| Локальная файловая система | Файлы в каталоге в локальной файловой системе. | `/home/user/projects/myapp` |
| Главная ветвь GitHub | Файлы в основной (или другой ветви по умолчанию) публичного или частного репозитория GitHub.  | `https://github.com/gituser/myapp-repo.git` |
| Ветвь GitHub | Специфическая ветвь государственного или частного репо GitHub.| `https://github.com/gituser/myapp-repo.git#mybranch` |
| Вложенная папка GitHub | Файлы в рамках субфолдера в публичном или частном репо GitHub. Пример показывает сочетание спецификации ветви и субфолдера. | `https://github.com/gituser/myapp-repo.git#mybranch:myfolder` |
| GitHub коммит | Конкретный коммит в публичном или частном репо GitHub. Пример показывает комбинацию хэш-хэша коммитов (SHA) и спецификации subfolder. | `https://github.com/gituser/myapp-repo.git#git-commit-hash:myfolder` |
| Подфолдер Azure DevOps | Файлы в рамках субфолдера в публичном или частном репо Azure. Пример показывает сочетание спецификации ветви и субфолдера. | `https://dev.azure.com/user/myproject/_git/myapp-repo#mybranch:myfolder` |
| Удаленный архив Tarball | Файлы в сжатом архиве на удаленном веб-сервере. | `http://remoteserver/myapp.tar.gz` |

> [!NOTE]
> При использовании частного репо Git в качестве контекста для задачи необходимо предоставить токен для личного доступа (PAT).

## <a name="image-platforms"></a>Платформы изображений

По умолчанию ACR Tasks создает изображения для Linux OS и архитектуры amd64. Укажите `--platform` тег для создания изображений Windows или Linux для других архитектур. Укажите ОС и опционально поддерживаемую архитектуру `--platform Linux/arm`в формате OS/architecture (например, ). Для архитектуры ARM дополнительно укажите вариант в формате OS/architecture/variant (например, `--platform Linux/arm64/v8`):

| OS | Architecture|
| --- | ------- | 
| Linux | amd64<br/>arm<br/>arm64<br/>386 |
| Windows | amd64 |

## <a name="view-task-output"></a>Просмотр выходных данных задачи

Каждый запуск задачи генерирует вывод журнала, который можно проверить, чтобы определить, успешно ли выполнены шаги задачи. При запуске задачи вручную выход журнала для выполнения задачи передается на консоль, а также сохраняется для последующего поиска. При автоматическом срабатывании задачи, например, с помощью коммита исходного кода или обновления базового изображения, журналы задач сохраняются только в.. Просмотр журналов выполнения на портале Azure или используйте команду [задач az acr.](/cli/azure/acr/task#az-acr-task-logs)

Подробнее о [просмотре и управлении журналами задач.](container-registry-tasks-logs.md)

## <a name="next-steps"></a>Дальнейшие действия

Когда вы будете готовы автоматизировать сборку изображений контейнеров и техническое обслуживание в облаке, ознакомьтесь с [серией учебников ACR Tasks.](container-registry-tutorial-quick-task.md)

При необходимости установите [расширение Docker для Visual Studio Code](https://code.visualstudio.com/docs/azure/docker) и расширение [учетной записи Azure](https://marketplace.visualstudio.com/items?itemName=ms-vscode.azure-account) для работы со своими реестрами контейнеров Azure. Извлекайте и отправляйте образы в реестр контейнеров Azure или запускайте Задачи ACR в Visual Studio Code.

<!-- LINKS - External -->
[base-alpine]: https://hub.docker.com/_/alpine/
[base-dotnet]: https://hub.docker.com/r/microsoft/dotnet/
[base-node]: https://hub.docker.com/_/node/
[base-windows]: https://hub.docker.com/r/microsoft/nanoserver/
[sample-archive]: https://github.com/Azure-Samples/acr-build-helloworld-node/archive/master.zip
[terms-of-use]: https://azure.microsoft.com/support/legal/preview-supplemental-terms/

<!-- LINKS - Internal -->
[azure-cli]: /cli/azure/install-azure-cli
[az-acr-build]: /cli/azure/acr#az-acr-build
[az-acr-pack-build]: /cli/azure/acr/pack#az-acr-pack-build
[az-acr-task]: /cli/azure/acr/task
[az-acr-task-create]: /cli/azure/acr/task#az-acr-task-create
[az-login]: /cli/azure/reference-index#az-login
[az-login-service-principal]: /cli/azure/authenticate-azure-cli

<!-- IMAGES -->
[quick-build-01-fork]: ./media/container-registry-tutorial-quick-build/quick-build-01-fork.png
[quick-build-02-browser]: ./media/container-registry-tutorial-quick-build/quick-build-02-browser.png
