---
title: Автоматизация установки исправлений ОС и платформы с помощью службы "Задачи Реестра контейнеров Azure" ("Задачи ACR")
description: Общие сведения о службе "Задачи ACR" — наборе компонентов в Реестре контейнеров Azure, предоставляющем безопасную, автоматическую сборку образов контейнеров и применение исправлений в облаке.
services: container-registry
author: dlepow
ms.service: container-registry
ms.topic: article
ms.date: 03/28/2019
ms.author: danlep
ms.openlocfilehash: b97db09c477a940ca36129316613f5ceb4eb13b1
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60582420"
---
# <a name="automate-os-and-framework-patching-with-acr-tasks"></a>Автоматизация установки исправлений ОС и платформы с помощью службы "Задачи ACR"

Контейнеры предоставляют новые уровни виртуализации, изолируя зависимости приложения и разработчиков от требований в отношении инфраструктуры и эксплуатации. Но остается необходимым найти способ применения исправлений виртуализации этого приложения.

## <a name="what-is-acr-tasks"></a>Что такое "Задачи ACR"?

**Задачи ACR** — это набор компонентов в Реестре контейнеров Azure. Она позволяет создавать образы облачных контейнеров для Linux, Windows и ARM, а также автоматизировать применение [исправлений платформы и ОС](#automate-os-and-framework-patching) для ваших контейнеров Docker. Служба "Задачи ACR" не только расширяет "внутренний цикл" разработки до облака за счет сборки образов контейнера по требованию, но и обеспечивает автоматические сборки при фиксации исходного кода или при обновлении базового образа контейнера. С помощью триггеров, которые срабатывают при обновлении базового образа, можно автоматизировать рабочий процесс внесения исправлений ОС и платформы приложения, поддерживая безопасность в средах в соответствии с правилами неизменяемых контейнеров.

Создавайте и тестируйте образы контейнера с помощью службы "Задачи ACR" четырьмя способами:

* [Быстрая задача](#quick-task). Создавайте и отправляйте образы контейнера по требованию в Azure без необходимости в установке локального модуля Docker. Выполняйте `docker build` и `docker push` в облаке. Выполняйте сборку на основе локального исходного кода или репозитория Git.
* [Сборка при фиксации исходного кода](#automatic-build-on-source-code-commit). Автоматически активируйте сборку образов контейнеров при фиксации кода в репозиторий Git.
* [Сборка на основе обновления образа](#automate-os-and-framework-patching). Автоматически активируйте сборку образа контейнера при обновлении базового образа.
* [Многошаговых задач](#multi-step-tasks): Определяйте многошаговые задачи, которые создают образы, выполняют контейнеры в качестве команд и отправляют образы в реестр. Эта функция задач ACR поддерживает выполнение задач по запросу и изображение для параллельной сборки, тестирования и Push-операций.

## <a name="quick-task"></a>Быстрая задача

Цикл разработки "внутреннего цикла" — это итеративный процесс написания кода, сборки и тестирования приложения перед фиксацией в системе управления версиями. Это лишь начало управления жизненным циклом контейнера.

Прежде чем зафиксировать первую строку кода, функция [Быстрая задача](container-registry-tutorial-quick-task.md) службы "Задачи ACR" может обеспечить интегрированный опыт разработки, разгружая сборки образов контейнера в Azure. С помощью быстрых задач можно проверить автоматические определения сборки и перехватывать потенциальные проблемы перед фиксацией кода.

Используя знакомый формат `docker build`, команда [az acr build][az-acr-build] в Azure CLI извлекает *контекст* (набор файлов для сборки), отправляет его в службу "Задачи ACR" и по умолчанию отправляет встроенный образ в его реестр после завершения.

Общие сведения см. в разделе Краткое руководство по [собрать и запустить образ контейнера](container-registry-quickstart-task-cli.md) в реестре контейнеров Azure.  

В следующей таблице приведено несколько примеров поддерживаемых расположений контекста для Задач ACR:

| Расположение контекста | ОПИСАНИЕ | Пример |
| ---------------- | ----------- | ------- |
| Локальная файловая система | Файлы в каталоге в локальной файловой системе. | `/home/user/projects/myapp` |
| Главная ветвь GitHub | Файлы в главной ветви (или другой ветви по умолчанию) репозитория GitHub.  | `https://github.com/gituser/myapp-repo.git` |
| Ветвь GitHub | Определенная ветвь репозитория GitHub.| `https://github.com/gituser/myapp-repo.git#mybranch` |
| Запрос на вытягивание GitHub | Запрос на вытягивание в репозитории GitHub. | `https://github.com/gituser/myapp-repo.git#pull/23/head` |
| Вложенная папка GitHub | Файлы во вложенной папке в репозитории GitHub. В примере показано сочетание спецификации запроса на вытягивание и вложенной папки. | `https://github.com/gituser/myapp-repo.git#pull/24/head:myfolder` |
| Удаленный архив Tarball | Файлы в сжатом архиве на удаленном веб-сервере. | `http://remoteserver/myapp.tar.gz` |

Служба "Задачи ACR" разработана как примитив жизненного цикла контейнеров. К примеру, интегрируйте службу "Задачи ACR" в решение CI/CD. Выполнив команды [az login][az-login] с [субъектом-службой][az-login-service-principal], решение CI/CD может выдавать команды [az acr build][az-acr-build] для запуска сборок образов.

Узнайте, как использовать быстрые задачи из первого руководства по Задачам ACR: [Руководство. Создание образов контейнера в облаке с помощью службы "Задачи Реестра контейнеров Azure"](container-registry-tutorial-quick-task.md).

## <a name="automatic-build-on-source-code-commit"></a>Автоматическая сборка при фиксации исходного кода

Используйте службу "Задачи ACR", чтобы автоматически активировать сборку образов контейнеров при фиксации кода в репозиторий Git. Задачи сборки, настраиваемые с помощью команды Azure CLI [az acr task][az-acr-task], позволяют задавать репозиторий Git и при необходимости ветвь и файл Docker. Когда ваша команда фиксирует код в репозиторий, веб-перехватчик, созданный службой "Задачи ACR", активирует сборку образов контейнеров, определенную в репозитории.

> [!IMPORTANT]
> Если вы ранее создавали задачи в предварительной версии, используя команду `az acr build-task`, эти задачи необходимо повторно создать, используя команду [az acr task][az-acr-task].

Узнайте, как активировать сборку при фиксации исходного кода из второго руководства по службе "Задачи ACR": [Руководство. Автоматизация сборок образов контейнера с помощью службы "Задачи Реестра контейнеров Azure"](container-registry-tutorial-build-task.md).

## <a name="automate-os-and-framework-patching"></a>Автоматизация установки исправлений ОС и платформы

Возможность службы "Задачи ACR" значительно улучшать рабочий процесс сборки контейнера обуславливается ее способностью обнаруживать обновление базового образа. Когда обновленный базовый образ помещается в ваш реестр, служба "Задачи ACR" может автоматически выполнять сборку всех образов приложения на его основе.

Образы контейнеров можно классифицировать на *базовые* образы и образы *приложения*. К базовым образам, как правило, относятся операционная система и платформы приложений, на основе которых создано приложение, а также другие настройки. Эти базовые образы обычно создаются на основе открытых вышестоящих образов, например: [Alpine Linux][base-alpine], [Windows][base-windows], [.NET][base-dotnet] или [Node.js][base-node]. Несколько образов вашего приложения могут совместно использовать общий базовый образ.

Когда вышестоящая программа обслуживания обновляет образ ОС или платформу приложения, к примеру, путем внесения критического исправления системы безопасности ОС, необходимо также внести его и в базовые образы. Затем необходимо повторно выполнить сборку каждого образа приложения, чтобы внести эти вышестоящие исправления, внесенные в базовый образ.

Так как при создании образа контейнера служба "Задачи ACR" динамически находит зависимости базовых образов, она может определить время обновления базового образа приложения. С помощью одной предварительно настроенной [задачи сборки](container-registry-tutorial-base-image-update.md#create-a-task) служба "Задачи ACR" **автоматически повторно выполняет сборку каждого образа приложения**. Благодаря такому автоматическому обнаружению и повторному выполнению сборок служба "Задачи ACR" экономит время и усилия, необходимые для того, чтобы вручную отслеживать и обновлять каждый образ приложения, ссылающийся на обновленный базовый образ.

Дополнительные сведения об исправлениях ОС и платформы см. в третьем руководстве по Задачам ACR [Руководство. Автоматизация сборок образа при обновлении базового образа с помощью службы "Задачи Реестра контейнеров Azure"](container-registry-tutorial-base-image-update.md).

> [!NOTE]
> Обновление базовых образов активирует сборки, если базовые образы и образы приложения находятся в одном и том же реестре контейнеров Azure или базовые образы расположены в общедоступном репозитории Центра Docker.

## <a name="multi-step-tasks"></a>Многошаговые задачи

Многошаговых задач обеспечивают задач на основе шаг определения и выполнения для создания, тестирования и исправления образы контейнеров в облаке. Шаги задач определяют отдельный образ контейнера сборки и перемещения контейнеров. Они также могут определять выполнение одного или нескольких контейнеров, причем каждый шаг использует контейнер в качестве среды выполнения.

Например, можно создать многошаговую задачу, которая автоматизирует следующие операции:

1. Сборка образа веб-приложения.
1. Выполнение контейнера веб-приложения.
1. Сборка тестового образа веб-приложения.
1. Выполнение контейнера для тестирования веб-приложения, который выполняет тестирование работающего контейнера приложения.
1. Если тесты проходят успешно, создайте пакет архива диаграмм Helm.
1. Выполнение команды `helm upgrade` с использованием нового пакета архива диаграмм Helm.

Многошаговые задачи позволяют разделить создание, выполнение и тестирование образов на большее количество составных шагов с поддержкой зависимостей между шагами. Благодаря многошаговым задачам в службе "Задачи ACR" у вас есть более детальный контроль над рабочими процессами создания и тестирования образа, а также исправления платформы и ОС.

Дополнительные сведения о многошаговых задачах см. в статье [Выполнение многошаговых задач сборки, тестирования и исправления в службе "Задачи ACR"](container-registry-tasks-multi-step.md).

## <a name="next-steps"></a>Дальнейшие действия

Когда вы будете готовы для автоматизации операционной системы и установки исправлений framework путем создания образов контейнеров в облаке, ознакомьтесь с трех частей [серии руководств задачи ACR](container-registry-tutorial-quick-task.md).

При необходимости установите [расширение Docker для Visual Studio Code](https://code.visualstudio.com/docs/azure/docker) и расширение [учетной записи Azure](https://marketplace.visualstudio.com/items?itemName=ms-vscode.azure-account) для работы со своими реестрами контейнеров Azure. Извлекайте и отправляйте образы в реестр контейнеров Azure или запускайте Задачи ACR в Visual Studio Code.

<!-- LINKS - External -->
[base-alpine]: https://hub.docker.com/_/alpine/
[base-dotnet]: https://hub.docker.com/r/microsoft/dotnet/
[base-node]: https://hub.docker.com/_/node/
[base-windows]: https://hub.docker.com/r/microsoft/nanoserver/
[sample-archive]: https://github.com/Azure-Samples/acr-build-helloworld-node/archive/master.zip
[terms-of-use]: https://azure.microsoft.com/support/legal/preview-supplemental-terms/

<!-- LINKS - Internal -->
[azure-cli]: /cli/azure/install-azure-cli
[az-acr-build]: /cli/azure/acr#az-acr-build
[az-acr-task]: /cli/azure/acr
[az-login]: /cli/azure/reference-index#az-login
[az-login-service-principal]: /cli/azure/authenticate-azure-cli

<!-- IMAGES -->
[quick-build-01-fork]: ./media/container-registry-tutorial-quick-build/quick-build-01-fork.png
[quick-build-02-browser]: ./media/container-registry-tutorial-quick-build/quick-build-02-browser.png
