---
title: Параметры проверки подлинности реестра
description: Варианты аутентификации для частного реестра контейнеров Azure, включая вхинг с идентификатором Active Directory Azure, использование основ службы и использование дополнительных учетных данных админ.
ms.topic: article
ms.date: 01/30/2020
ms.openlocfilehash: 5459ac29c1264b18404cb2863b9d4209907ac029
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79247050"
---
# <a name="authenticate-with-an-azure-container-registry"></a>Аутентификация в реестре контейнеров Azure

Существует несколько способов аутентификации в реестре контейнеров Azure, каждый из которых подходит для одного или нескольких сценариев использования реестра.

Рекомендуемые способы включают аутентификацию в реестре непосредственно через [индивидуальный логин,](#individual-login-with-azure-ad)или ваши приложения и контейнерные оркестранты могут выполнять функции без присмотра или «безголовые» аутентификации с помощью [принципа службы](#service-principal)Azure Active Directory (Azure AD).

## <a name="authentication-options"></a>Параметры проверки подлинности

В следующей таблице перечислены доступные методы проверки подлинности и рекомендуемые сценарии. Подробнее о содержимом.

| Метод                               | Как проверить подлинность                                           | Сценарии                                                            | RBAC                             | Ограничения                                |
|---------------------------------------|-------------------------------------------------------|---------------------------------------------------------------------|----------------------------------|--------------------------------------------|
| [Индивидуальная идентификация AD](#individual-login-with-azure-ad)                | `az acr login` в Azure CLI                             | Интерактивный толчок/тянуть разработчиками, тестерами                                    | Да                              | Токен AD должен обновляться каждые 3 часа     |
| [Директор службы AD](#service-principal)                  | `docker login`<br/><br/>`az acr login`в Azure CLI<br/><br/> Настройки входа в реестр в AIS или инструментарии<br/><br/> [Kubernetes тянуть секрет](container-registry-auth-kubernetes.md)                                           | Без присмотра толчок от конвейера CI/CD<br/><br/> Притяжение без присмотра к Azure или внешним службам  | Да                              | SP пароль по умолчанию срок годности составляет 1 год       |                                                           
| [Интеграция с AKS](../aks/cluster-container-registry-integration.md?toc=/azure/container-registry/toc.json&bc=/azure/container-registry/breadcrumb/toc.json)                    | Прикрепите реестр при создании или обновлении кластера AKS  | Без присмотра тянуть к кластеру AKS                                                  | Нет, потяните доступ только             | Доступно только с кластером AKS            |
| [Управляемая идентификация для ресурсов Azure](container-registry-authentication-managed-identity.md)  | `docker login`<br/><br/> `az acr login` в Azure CLI                                       | Без присмотра от конвейера Azure CI/CD<br/><br/> Притяжение без присмотра к службам Azure<br/><br/>   | Да                              | Используйте только из служб Azure, которые [поддерживают управляемые идентификаторы для ресурсов Azure](../active-directory/managed-identities-azure-resources/services-support-managed-identities.md#azure-services-that-support-managed-identities-for-azure-resources)              |
| [Пользователь Admin](#admin-account)                            | `docker login`                                          | Интерактивный толчок/тянуть отдельным разработчиком или тестером                           | Нет, всегда тянуть и толкать доступ  | Единая учетная запись в реестре, не рекомендуется для нескольких пользователей         |
| [Токен доступа с областью репозитория](container-registry-repository-scoped-permissions.md)               | `docker login`<br/><br/>`az acr login`в Azure CLI   | Интерактивный толчок/тянуть к репозиторию отдельным разработчиком или тестером<br/><br/> Без присмотра push/pull в репозиторий по отдельной системе или внешнему устройству                  | Да                              | В настоящее время не интегрирована с идентификацией AD  |

## <a name="individual-login-with-azure-ad"></a>Отдельный вход с помощью Azure AD

При работе с реестром напрямую, например при извлечении образов на рабочую станцию разработки и отправке образов с нее, выполняйте аутентификацию с помощью команды [az acr login](/cli/azure/acr?view=azure-cli-latest#az-acr-login) в [Azure CLI](/cli/azure/install-azure-cli).

```azurecli
az acr login --name <acrName>
```

При входе с помощью команды `az acr login` интерфейс командной строки использует маркер, созданный при выполнении команды [az login](/cli/azure/reference-index#az-login), чтобы прозрачно выполнить аутентификацию вашего сеанса в реестре. Для завершения потока проверки подлинности Docker должен быть установлен и запущен в вашей среде. `az acr login`использует клиент Docker для установки маркера Active `docker.config` Directory Azure в файле. После входа таким образом ваши учетные данные сохраняются в кэше, и при последующем выполнении команд `docker` в вашем сеансе не потребуется вводить имя пользователя или пароль.

> [!TIP]
> Также `az acr login` используйте для проверки подлинности индивидуальной идентификации, если вы хотите нажать или вытащить артефакты, кроме изображений Docker, в свой реестр, такие как [артефакты OCI.](container-registry-oci-artifacts.md)  


Для доступа к реестру `az acr login` токен, используемый в течение 3 часов, действителен в `docker` течение **3 часов,** поэтому мы рекомендуем вам всегда войти в реестр перед запуском команды. Если срок действия маркера истекает, его можно обновить его с помощью команды `az acr login`, чтобы повторно пройти аутентификацию. 

Использование `az acr login` с удостоверениями Azure обеспечивает [доступ на основе ролей](../role-based-access-control/role-assignments-portal.md). В некоторых сценариях может потребоваться войти в реестр с вашей индивидуальной идентификацией в Azure AD. Для сценариев кросс-сервисов или для обработки потребностей рабочей группы или рабочего процесса разработки, в котором вы не хотите управлять индивидуальным доступом, можно также войти в систему с [управляемым интилитатом для ресурсов Azure.](container-registry-authentication-managed-identity.md)

## <a name="service-principal"></a>Субъект-служба

Если назначить [субъект-службу](../active-directory/develop/app-objects-and-service-principals.md) для реестра, приложение или служба сможет использовать его для автоматической аутентификации. Использование субъектов-служб обеспечивает [доступ к реестру на основе ролей](../role-based-access-control/role-assignments-portal.md), и одному реестру можно назначить несколько субъектов-служб. Применение нескольких субъектов-служб позволяет определить разные права доступа для приложений.

Доступные роли для реестра контейнеров включают:

* **AcrPull**: извлечение

* **AcrPush**: извлечение и отправка

* **Владелец**: извлечение, отправка и назначение ролей другим пользователям.

Полный список ролей см. в статье, посвященной [ролям и разрешениям реестра контейнеров Azure](container-registry-roles.md).

Для того, чтобы скрипты CLI создали принцип службы для проверки подлинности с помощью реестра контейнеров Azure и дополнительные рекомендации [см.](container-registry-auth-service-principal.md)

## <a name="admin-account"></a>Учетная запись администратора

Каждый реестр контейнеров содержит учетную запись администратора, которая отключена по умолчанию. Вы можете включить учетную запись администратора и управлять ее учетными данными на портале Azure или с помощью Azure CLI либо других средств Azure.

> [!IMPORTANT]
> Учетная запись администратора предоставляет доступ к реестру одному пользователю. Она предназначена, главным образом, для тестирования. Мы не рекомендуем делиться учетными данными учетной записи админ среди нескольких пользователей. Все пользователи, выполняющие аутентификацию с учетной записью администратора, отображаются как один пользователь с возможностью извлечения данных из реестра и отправки данных в него. Изменив или отключив эту учетную запись, вы ограничите доступ к реестру для пользователей, использующих эти учетные данные. Для пользователей и субъектов-служб в сценариях автоматического входа рекомендуется использовать отдельные удостоверения.
>

Учетной записи администратора предоставляются два пароля, каждый из которых можно создать повторно. Благодаря этому вы можете подключаться к реестру, используя один пароль, пока второй создается повторно. Если учетная запись администратора включена, вы можете указать в команде `docker login` имя пользователя и пароль, когда будет предложено выполнить базовую аутентификацию в реестре. Пример:

```
docker login myregistry.azurecr.io 
```

Для наилучшей практики управления учетным [docker login](https://docs.docker.com/engine/reference/commandline/login/) данными входа см.

Чтобы включить учетную запись администратора для существующего реестра, можно использовать параметр `--admin-enabled` в команде [az acr update](/cli/azure/acr?view=azure-cli-latest#az-acr-update) в Azure CLI.

```azurecli
az acr update -n <acrName> --admin-enabled true
```

Чтобы включить учетную запись администратора на портале Azure, перейдите к реестру, выберите **Ключи доступа** в разделе **Параметры**, затем щелкните **Включить** в разделе **Пользователь-администратор**.

![Включение учетной записи администратора на портале Azure][auth-portal-01]

## <a name="next-steps"></a>Дальнейшие действия

* [Отправка первого образа с помощью Azure CLI](container-registry-get-started-azure-cli.md)

<!-- IMAGES -->
[auth-portal-01]: ./media/container-registry-authentication/auth-portal-01.png
