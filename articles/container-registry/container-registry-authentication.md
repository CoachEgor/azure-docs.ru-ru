---
title: Параметры проверки подлинности в реестре
description: Варианты проверки подлинности для реестра контейнеров Azure, включая вход с помощью удостоверения Azure Active Directory, с помощью субъектов-служб и с помощью необязательных учетных данных администратора.
ms.topic: article
ms.date: 12/21/2018
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 29e23f6a983ccc2197e609511aee2ce13726ed0f
ms.sourcegitcommit: 12d902e78d6617f7e78c062bd9d47564b5ff2208
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/24/2019
ms.locfileid: "74455389"
---
# <a name="authenticate-with-a-private-docker-container-registry"></a>Аутентификация с помощью частного реестра контейнеров Docker

Существует несколько способов аутентификации в реестре контейнеров Azure, каждый из которых подходит для одного или нескольких сценариев использования реестра.

Рекомендуется включить проверку подлинности в реестре напрямую через [отдельное имя входа](#individual-login-with-azure-ad), а приложения и управляющие контейнеры могут выполнять автоматическую или бездисплейную проверку подлинности с помощью [субъекта-службы](#service-principal)Azure Active Directory (Azure AD).

## <a name="individual-login-with-azure-ad"></a>Отдельный вход с помощью Azure AD

При работе с реестром напрямую, например при извлечении образов на рабочую станцию разработки и отправке образов с нее, выполняйте аутентификацию с помощью команды [az acr login](/cli/azure/acr?view=azure-cli-latest#az-acr-login) в [Azure CLI](/cli/azure/install-azure-cli).

```azurecli
az acr login --name <acrName>
```

При входе с помощью команды `az acr login` интерфейс командной строки использует маркер, созданный при выполнении команды [az login](/cli/azure/reference-index#az-login), чтобы прозрачно выполнить аутентификацию вашего сеанса в реестре. После входа таким образом ваши учетные данные сохраняются в кэше, и при последующем выполнении команд `docker` в вашем сеансе не потребуется вводить имя пользователя или пароль. 

`az acr login` может использовать маркер в течение 1 часа, поэтому мы рекомендуем всегда входить в реестр перед выполнением команды `docker`. Если срок действия маркера истекает, его можно обновить его с помощью команды `az acr login`, чтобы повторно пройти аутентификацию. 

Использование `az acr login` с удостоверениями Azure обеспечивает [доступ на основе ролей](../role-based-access-control/role-assignments-portal.md). В некоторых сценариях может потребоваться вход в реестр с помощью собственных отдельных идентификаторов в Azure AD. Для сценариев между службами или для удовлетворения потребностей рабочей группы, в которой не требуется управлять отдельным доступом, вы можете войти в систему с помощью [управляемого удостоверения для ресурсов Azure](container-registry-authentication-managed-identity.md).

## <a name="service-principal"></a>Субъект-служба

Если назначить [субъект-службу](../active-directory/develop/app-objects-and-service-principals.md) для реестра, приложение или служба сможет использовать его для автоматической аутентификации. Использование субъектов-служб обеспечивает [доступ к реестру на основе ролей](../role-based-access-control/role-assignments-portal.md), и одному реестру можно назначить несколько субъектов-служб. Применение нескольких субъектов-служб позволяет определить разные права доступа для приложений.

Доступные роли для реестра контейнеров включают:

* **AcrPull**: извлечение

* **AcrPush**: извлечение и отправка

* **Владелец**: извлечение, отправка и назначение ролей другим пользователям.

Полный список ролей см. в статье, посвященной [ролям и разрешениям реестра контейнеров Azure](container-registry-roles.md).

Сведения о создании субъекта-службы для проверки подлинности в реестре контейнеров Azure с помощью скриптов CLI и рекомендации по использованию субъекта-службы см. в статье [Проверка подлинности реестра контейнеров Azure с субъектами-службами](container-registry-auth-service-principal.md).

## <a name="admin-account"></a>Учетная запись администратора

Каждый реестр контейнеров содержит учетную запись администратора, которая отключена по умолчанию. Вы можете включить учетную запись администратора и управлять ее учетными данными на портале Azure или с помощью Azure CLI либо других средств Azure.

> [!IMPORTANT]
> Учетная запись администратора предоставляет доступ к реестру одному пользователю. Она предназначена, главным образом, для тестирования. Не рекомендуется совместно использовать учетные данные учетной записи администратора между несколькими пользователями. Все пользователи, выполняющие аутентификацию с учетной записью администратора, отображаются как один пользователь с возможностью извлечения данных из реестра и отправки данных в него. Изменив или отключив эту учетную запись, вы ограничите доступ к реестру для пользователей, использующих эти учетные данные. Для пользователей и субъектов-служб в сценариях автоматического входа рекомендуется использовать отдельные удостоверения.
>

Учетной записи администратора предоставляются два пароля, каждый из которых можно создать повторно. Благодаря этому вы можете подключаться к реестру, используя один пароль, пока второй создается повторно. Если учетная запись администратора включена, вы можете указать в команде `docker login` имя пользователя и пароль, когда будет предложено выполнить базовую аутентификацию в реестре. Например,

```
docker login myregistry.azurecr.io 
```

Рекомендации по управлению учетными данными для входа см. в справочнике по командам [DOCKER login](https://docs.docker.com/engine/reference/commandline/login/) .

Чтобы включить учетную запись администратора для существующего реестра, можно использовать параметр `--admin-enabled` в команде [az acr update](/cli/azure/acr?view=azure-cli-latest#az-acr-update) в Azure CLI.

```azurecli
az acr update -n <acrName> --admin-enabled true
```

Чтобы включить учетную запись администратора на портале Azure, перейдите к реестру, выберите **Ключи доступа** в разделе **Параметры**, затем щелкните **Включить** в разделе **Пользователь-администратор**.

![Включение учетной записи администратора на портале Azure][auth-portal-01]

## <a name="next-steps"></a>Дополнительная информация

* [Отправка первого образа с помощью Azure CLI](container-registry-get-started-azure-cli.md)

<!-- IMAGES -->
[auth-portal-01]: ./media/container-registry-authentication/auth-portal-01.png
