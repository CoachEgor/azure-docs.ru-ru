---
title: Журналы ресурсов для реестра контейнеров Azure | Документация Майкрософт
description: Записывайте и анализируйте события журнала ресурсов для реестра контейнеров Azure, такие как проверка подлинности, отправка образа и извлечение образа.
services: container-registry
documentationcenter: ''
author: dlepow
manager: gwallace
editor: ''
ms.assetid: ''
ms.service: container-registry
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: multiple
ms.workload: ''
ms.date: 10/30/2019
ms.author: danlep
ms.openlocfilehash: e419f8c5cf06efc93294f9c428e9102c1f81b36a
ms.sourcegitcommit: 98ce5583e376943aaa9773bf8efe0b324a55e58c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2019
ms.locfileid: "73180820"
---
# <a name="azure-container-registry-logs-for-diagnostic-evaluation-and-auditing"></a>Журналы реестра контейнеров Azure для диагностической оценки и аудита

В этой статье объясняется, как получить данные журнала для реестра контейнеров Azure с помощью функций [Azure Monitor](../azure-monitor/overview.md). Azure Monitor собирает [журналы ресурсов](../azure-monitor/platform/resource-logs-overview.md) (ранее называемые *журналами диагностики*) для событий, управляемых пользователем, в реестре. Собирайте и потребляют эти данные в соответствии с потребностями:

* Аудит событий проверки подлинности в реестре для обеспечения безопасности и соответствия требованиям 

* Предоставьте полный журнал действий для артефактов реестра, таких как события извлечения и извлечения, чтобы диагностировать проблемы с реестром. 

Сбор данных журнала ресурсов с помощью Azure Monitor может повлечь дополнительные затраты. См. [Azure Monitor цены](https://azure.microsoft.com/pricing/details/monitor/). 


> [!IMPORTANT]
> Эта функция сейчас доступна в предварительной версии, и некоторые [ограничения](#preview-limitations) применяются. Предварительные версии предоставляются при условии, что вы принимаете [дополнительные условия использования][terms-of-use]. Некоторые аспекты этой функции могут быть изменены до выхода общедоступной версии.

## <a name="preview-limitations"></a>Ограничения предварительной версии

Ведение журнала событий уровня репозитория в настоящее время не включает события удаления или удалить тег. Регистрируются только следующие события репозитория:
* **События push-уведомлений** для изображений и других артефактов
* **События извлечения** для изображений и других артефактов

## <a name="registry-resource-logs"></a>Журналы ресурсов реестра

Журналы ресурсов содержат сведения, созданные ресурсами Azure, которые описывают их внутреннюю работу. Для реестра контейнеров Azure журналы содержат события проверки подлинности и уровня репозитория, хранящиеся в следующих таблицах. 

* **Контаинеррегистрилогиневентс** — события и состояние проверки подлинности реестра, включая входящий идентификатор и IP-адрес.
* **Контаинеррегистрирепоситоревентс** — такие операции, как отправка и Извлечение изображений и других артефактов в репозиториях реестра.
* **Азуреметрикс** - [метрики реестра контейнеров](../azure-monitor/platform/metrics-supported.md#microsoftcontainerregistryregistries) , такие как агрегированные push-уведомления и счетчики Pull.

Для операций данные журнала включают:
  * Состояние успеха или сбоя
  * Метки времени начала и окончания

Помимо журналов ресурсов, Azure предоставляет [Журнал действий](../azure-monitor/platform/activity-logs-overview.md), отдельную запись на уровне подписки на события управления Azure, например создание или удаление реестра контейнеров.

## <a name="enable-collection-of-resource-logs"></a>Включение сбора журналов ресурсов

Сбор журналов ресурсов для реестра контейнеров по умолчанию отключен. Явно включите параметры диагностики для каждого реестра, который требуется отслеживать. Сведения о параметрах включения диагностики см. в статье [Создание параметров диагностики для сбора журналов и метрик платформы в Azure](../azure-monitor/platform/diagnostic-settings.md).

Например, чтобы просмотреть журналы и метрики для реестра контейнеров практически в реальном времени в Azure Monitor, собирайте журналы ресурсов в рабочей области Log Analytics. Чтобы включить этот параметр диагностики с помощью портал Azure, выполните следующие действия.

1. Если у вас еще нет рабочей области, создайте ее с помощью [портал Azure](../azure-monitor/learn/quick-create-workspace.md). Чтобы максимально сокращать задержку в сборе данных, убедитесь, что Рабочая область находится в том **же регионе** , что и реестр контейнеров.
1. На портале выберите реестр и выберите **мониторинг > параметры диагностики > добавить параметр диагностики**.
1. Введите имя параметра и выберите **отправить в log Analytics**.
1. Выберите рабочую область для журналов диагностики реестра.
1. Выберите данные журнала, которые требуется отслеживать, и нажмите кнопку **сохранить**.

На следующем рисунке показано создание параметра диагностики для реестра с помощью портала.

![Включение параметров диагностики](media/container-registry-diagnostics-audit-logs/diagnostic-settings.png)

> [!TIP]
> Собирайте только необходимые данные, стоимость балансировки и потребности мониторинга. Например, если требуется только аудит событий проверки подлинности, выберите только журнал **контаинеррегистрилогиневентс** . 

## <a name="view-data-in-azure-monitor"></a>Просмотр данных в Azure Monitor

После включения сбора журналов диагностики в Log Analytics для отображения данных в Azure Monitor может потребоваться несколько минут. Чтобы просмотреть данные на портале, выберите реестр и выберите **мониторинг > журналы**. Выберите одну из таблиц, содержащих данные для реестра. 

Выполнение запросов для просмотра данных. Предоставляется несколько примеров запросов или выполняется собственное. Например, следующий запрос получает последние 24 часа данных из таблицы **контаинеррегистрирепоситоревентс** :

```Kusto
ContainerRegistryRepositoryEvents
| where TimeGenerated > ago(1d) 
```

На следующем рисунке показан пример выходных данных:

![Запрашивание данных журнала](media/container-registry-diagnostics-audit-logs/azure-monitor-query.png)

Руководство по использованию Log Analytics в портал Azure см. в статье Начало [работы с Azure Monitor log Analytics](../azure-monitor/log-query/get-started-portal.md)или использование [демонстрационной среды](https://portal.loganalytics.io/demo)log Analytics. 

Дополнительные сведения о запросах журналов см. [в разделе Общие сведения о запросах журналов в Azure Monitor](../azure-monitor/log-query/log-query-overview.md).

### <a name="additional-query-examples"></a>Дополнительные примеры запросов

#### <a name="100-most-recent-registry-events"></a>100. Последние события реестра

```Kusto
ContainerRegistryRepositoryEvents
| union ContainerRegistryLoginEvents
| top 100 by TimeGenerated
| project TimeGenerated, LoginServer , OperationName , Identity , Repository , DurationMs , Region , ResultType
```

## <a name="additional-log-destinations"></a>Дополнительные назначения журналов

Помимо отправки журналов в Log Analytics или в качестве альтернативы распространенным сценарием является выбор учетной записи хранения Azure в качестве назначения журнала. Чтобы архивировать журналы в службе хранилища Azure, создайте учетную запись хранения, прежде чем включать архивацию с помощью параметров диагностики.

Вы также можете выполнять потоковую передачу событий журнала диагностики в [концентратор событий Azure](../event-hubs/event-hubs-what-is-event-hubs.md). Центры событий способны принимать миллионы событий в секунду, позволяя преобразовать и сохранять их с помощью любого поставщика аналитики в реальном времени. 

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения об использовании [log Analytics](../azure-monitor/log-query/get-started-portal.md) и создании [запросов журналов](../azure-monitor/log-query/get-started-queries.md).
* Сведения о журналах платформы, доступных на разных уровнях Azure, см. в статье [Обзор журналов платформы Azure](../azure-monitor/platform/platform-logs-overview.md) .

<!-- LINKS - External -->
[terms-of-use]: https://azure.microsoft.com/support/legal/preview-supplemental-terms/
