---
title: Сбор & анализу журналов ресурсов
description: Запись и анализ событий журнала ресурсов для реестра контейнеров Azure, таких как аутентификация, нажатие изображения и притяжение изображений.
ms.topic: article
ms.date: 01/03/2020
ms.openlocfilehash: 00f9468721126bd166051df47cec1596356e9b54
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79409649"
---
# <a name="azure-container-registry-logs-for-diagnostic-evaluation-and-auditing"></a>Журналы реестра контейнеров Azure для диагностической оценки и аудита

В этой статье объясняется, как собирать данные журнала для реестра контейнеров Azure с помощью функций [Azure Monitor.](../azure-monitor/overview.md) Azure Monitor собирает [журналы ресурсов](../azure-monitor/platform/platform-logs-overview.md) (ранее называемые *диагностическими журналами)* для событий, управляемых пользователем, в вашем реестре. Сбор и использование этих данных для удовлетворения таких потребностей, как:

* Аудит событий проверки подлинности реестра для обеспечения безопасности и соответствия требованиям 

* Обеспечить полный след активности на артефакты реестра, такие как тянуть и тянуть события, так что вы можете диагностировать операционные проблемы с вашим реестром 

Сбор данных журнала ресурсов с помощью Azure Monitor может повлечь за себя дополнительные расходы. Смотрите [цены На Azure Monitor](https://azure.microsoft.com/pricing/details/monitor/). 

## <a name="repository-events"></a>События репозитория

Следующие события уровня репозитория для изображений и других артефактов в настоящее время регистрируются:

* **Нажмите события**
* **Вытягивать события**
* **События Untag**
* **Удаление событий** (включая события удаления репозитория)

События уровня репозитория, которые в настоящее время не зарегистрированы: События очистки.

## <a name="registry-resource-logs"></a>Журналы ресурсов реестра

В журналах ресурсов содержится информация, излучаемые ресурсами Azure, описывающими их внутреннюю работу. Для реестра контейнеров Azure журналы содержат события аутентификации и уровня репозитория, хранящиеся в следующих таблицах. 

* **ContainerRegistryLoginEvents** - События проверки подлинности реестра и статус, включая входящие удостоверения личности и IP-адрес
* **ContainerRegistryRepositoryEvents** - Операции, такие как нажатие и вытягивание для изображений и других артефактов в хранилищах реестра
* **Показатели реестра контейнеров AzureMetrics,** - такие как агрегированные[подсчеты](../azure-monitor/platform/metrics-supported.md#microsoftcontainerregistryregistries) толчков и вытягивания.

Для операций данные журнала включают:
  * Статус успеха или неудачи
  * Штампы времени начала и окончания

Помимо журналов ресурсов, Azure предоставляет [журнал активности,](../azure-monitor/platform/platform-logs-overview.md)единую запись на уровне подписки событий управления Azure, такие как создание или удаление реестра контейнеров.

## <a name="enable-collection-of-resource-logs"></a>Включить сбор журналов ресурсов

Сбор журналов ресурсов для реестра контейнеров не включен по умолчанию. Явно включите диагностические настройки для каждого реестра, который вы хотите контролировать. Для опций, позволяющих включить диагностические настройки, [см. Создать диагностическую настройку для сбора журналов платформ и метрик в Azure.](../azure-monitor/platform/diagnostic-settings.md)

Например, для просмотра журналов и метрик для реестра контейнеров в Azure Monitor соберите журналы ресурсов в рабочей области analytics log. Для включения этой диагностической настройки с помощью портала Azure:

1. Если у вас еще нет рабочего пространства, создайте рабочее пространство с помощью [портала Azure.](../azure-monitor/learn/quick-create-workspace.md) Чтобы свести к минимуму задержку в сборе данных, убедитесь, что рабочее пространство находится в том **же регионе,** что и реестр контейнеров.
1. На портале выберите реестр и выберите **настройки мониторинга > диагностики > добавить диагностическую настройку.**
1. Введите имя для настройки и выберите **Send to Log Analytics.**
1. Выберите рабочее место для журналов диагностики реестра.
1. Выберите данные журнала, которые вы хотите собрать, и нажмите **Сохранить**.

На следующем изображении показано создание диагностической настройки для реестра с помощью портала.

![Включение параметров диагностики](media/container-registry-diagnostics-audit-logs/diagnostic-settings.png)

> [!TIP]
> Собирайте только необходимые данные, балансируя стоимость и потребности в мониторинге. Например, если вам нужно только проверить события проверки подлинности, выберите только журнал **ContainerRegistryLoginEvents.** 

## <a name="view-data-in-azure-monitor"></a>Просмотр данных в Azure Monitor

После включения в систему сбора диагностических журналов в журнале Analytics может быть несколько минут, чтобы данные появились в Azure Monitor. Для просмотра данных на портале выберите реестр и выберите **журналы мониторинга >.** Выберите одну из таблиц, содержащую данные для реестра. 

Запуск запросов для просмотра данных. Предоставляется несколько выборочных запросов или выполнить свой собственный. Например, в следующем запросе извлекается последние данные за 24 часа из таблицы **ContainerRegistryRepositoryEvents:**

```Kusto
ContainerRegistryRepositoryEvents
| where TimeGenerated > ago(1d) 
```

Следующее изображение показывает выход образца:

![Запрашивание данных журнала](media/container-registry-diagnostics-audit-logs/azure-monitor-query.png)

В учебнике по использованию аналитики журналов на портале Azure [см.](../azure-monitor/log-query/get-started-portal.md) [Demo environment](https://portal.loganalytics.io/demo) 

Для получения дополнительной информации о запросах журналов смотрите [Обзор запросов журналов в Azure Monitor](../azure-monitor/log-query/log-query-overview.md).

### <a name="additional-query-examples"></a>Дополнительные примеры запросов

#### <a name="100-most-recent-registry-events"></a>100 последних событий реестра

```Kusto
ContainerRegistryRepositoryEvents
| union ContainerRegistryLoginEvents
| top 100 by TimeGenerated
| project TimeGenerated, LoginServer , OperationName , Identity , Repository , DurationMs , Region , ResultType
```

## <a name="additional-log-destinations"></a>Дополнительные назначения журналов

Помимо отправки журналов в журнал «Аналитика журнала» или в качестве альтернативы, общим сценарием является выбор учетной записи хранилища Azure в качестве пункта назначения журнала. Чтобы архивировать журналы в Хранилище Azure, создайте учетную запись хранения, прежде чем включить архивирование через диагностические настройки.

Вы также можете передавать события диагностического журнала в [концентратор событий Azure.](../event-hubs/event-hubs-what-is-event-hubs.md) Центры событий способны принимать миллионы событий в секунду, позволяя преобразовать и сохранять их с помощью любого поставщика аналитики в реальном времени. 

## <a name="next-steps"></a>Дальнейшие действия

* Подробнее об использовании [журналов](../azure-monitor/log-query/get-started-portal.md) analytics и создании [журналов запросов.](../azure-monitor/log-query/get-started-queries.md)
* Просмотрите [обзор журналов платформы Azure,](../azure-monitor/platform/platform-logs-overview.md) чтобы узнать о платформах, доступных на разных уровнях Azure.

