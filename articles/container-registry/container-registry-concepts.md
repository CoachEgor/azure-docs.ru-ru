---
title: О репозиториях & изображений
description: Введение в ключевые концепции реестров контейнеров Azure, репозиторий и изображений контейнеров.
ms.topic: article
ms.date: 09/10/2019
ms.openlocfilehash: ea6e2577d3eee91626dd613617a0b79e4ff3d6a1
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79247063"
---
# <a name="about-registries-repositories-and-images"></a>О реестрах, репозиториях и изображениях

В этой статье представлены ключевые понятия реестров контейнеров, репозиторий, изображений контейнеров и связанных с ними артефактов. 

## <a name="registry"></a>Реестр

*Реестр* контейнера — служба, которая хранит и распределяет образы контейнеров. Docker Hub — это публичный реестр контейнеров, который поддерживает сообщество с открытым исходным кодом и служит общим каталогом изображений. Реестр контейнеров Azure предоставляет пользователям прямой контроль над своими изображениями, с интегрированной аутентификацией, [георепликацией,](container-registry-geo-replication.md) поддерживающей глобальное распределение и надежность для развертывания сети, [виртуальной сети и конфигурации брандмауэра,](container-registry-vnet.md) [блокировки тегов](container-registry-image-lock.md)и многих других расширенных функций. 

Помимо изображений контейнеров Docker, реестр контейнеров Azure поддерживает [соответствующие артефакты содержимого,](container-registry-image-formats.md) включая форматы изображений Open Container Initiative (OCI).

## <a name="content-addressable-elements-of-an-artifact"></a>Содержимое адресных элементов артефакта

Адрес артефакта в реестре контейнеров Azure включает в себя следующие элементы. 

`[loginUrl]/[namespace]/[artifact:][tag]`

* **loginUrl** - Полностью квалифицированное название регистратора хоста. Хозяин реестра в контейнерном реестре Azure находится в формате *myregistry*.azurecr.io (все нижние регистры). Необходимо указать loginUrl при использовании Docker или других клиентских инструментов для вытягивания или нажатия артефактов в реестр контейнеров Azure. 
* **namespace** - Слэш-разграниченная логическая группировка связанных изображений или артефактов - например, для рабочей группы или приложения
* **артефакт** - название репозитория для конкретного изображения или артефакта
* **тег** - конкретная версия изображения или артефакта, хранящихся в репозитории


Например, полное имя изображения в реестре контейнеров Azure может выглядеть следующим образом:

*myregistry.azurecr.io/marketing/campaign10-18/email-sender:v2*

Подробности об этих элементах приведены ниже.

## <a name="repository-name"></a>Имя репозитория

Контейнерные реестры управляют *репозиториями,* коллекциями изображений контейнеров или других артефактов с тем же именем, но разными тегами. Например, следующие три образа находятся в репозитории acr-helloworld.


- *acr-helloworld:последний*
- *acr-helloworld:v1*
- *acr-helloworld:v2*

Имена репозиториев также могут включать [пространство имен](container-registry-best-practices.md#repository-namespaces). Namespaces позволяет группировать изображения, используя имена передних слэш-разграничения репозиторий, например:

- *маркетинг/кампания10-18/web:v2*
- *маркетинг/кампания10-18/api:v3*
- *маркетинг/кампания10-18/email-отправитель:v2*
- *возврат ы на продукт/веб-представление:20180604*
- *возврат продукции/наследие-интегратор:20180715*

## <a name="image"></a>Изображение

Изображение контейнера или другой артефакт в реестре связано с одним или несколько тегами, имеет один или несколько слоев и идентифицируется манифестом. Понимание того, как эти компоненты связаны друг с другом, может помочь вам эффективно управлять реестром.

### <a name="tag"></a>Тег

*Тег* для изображения или другого артефакта определяет свою версию. Один артефакт в репозитории может быть назначен один или несколько тегов, а также может быть "непомеченным". То есть можно удалить все теги из изображения, в то время как данные изображения (его слои) остаются в реестре.

Репозиторий (или репозиторий и пространство имен) вместе с тегом определяют имя образа. Образ можно отправлять и получать. Для этого в операции передачи или получения необходимо указать его имя.

То, как вы помечаете изображения контейнеров, руководствуется сценариями их разработки или развертывания. Например, для поддержания базовых изображений рекомендуются стабильные теги, а также уникальные теги для развертывания изображений. Для получения дополнительной информации смотрите [Рекомендации для пометки и версии изображений контейнеров.](container-registry-image-tag-version.md)

### <a name="layer"></a>Уровень

Изображения контейнеров состоят из одного или нескольких *слоев,* каждый из которых соответствует строке в Dockerfile, которая определяет изображение. Образы в реестре используют слои совместно, что позволяет увеличить эффективность хранилища. Например, несколько образов, которые находятся в разных репозиториях, могут совместно использовать базовый слой Alpine Linux, но только одна копия из этого слоя может хранится в реестре.

Совместное использование слоя также оптимизирует распределение слоев для узлов с несколькими образами, совместно использующих общие слои. Например, если образ уже находится в узле, который включает в себя уровень Alpine Linux в качестве основы, последующее притяжение другого образа, ссылающегося на один и тот же слой, не переносит его слой на узел. Вместо этого он ссылается на слой, который уже существует на узле.

Для обеспечения безопасной изоляции и защиты от потенциальных манипуляций с слоем слои не распределяются по всем реестрам.

### <a name="manifest"></a>манифеста

Каждое изображение контейнера или артефакт, отодвинутый в реестр контейнеров, связано с *манифестом.* Манифест создается реестром во время отправки образа, уникально идентифицирует образ и указывает его слой. С помощью команды Azure CLI [az acr repository show-manifests][az-acr-repository-show-manifests] можно получить список манифестов репозитория.

```azurecli
az acr repository show-manifests --name <acrName> --repository <repositoryName>
```

Например, перечислите манифесты для репозитория "acr-helloworld":

```azurecli
az acr repository show-manifests --name myregistry --repository acr-helloworld
```

```output
[
  {
    "digest": "sha256:0a2e01852872580b2c2fea9380ff8d7b637d3928783c55beb3f21a6e58d5d108",
    "tags": [
      "latest",
      "v3"
    ],
    "timestamp": "2018-07-12T15:52:00.2075864Z"
  },
  {
    "digest": "sha256:3168a21b98836dda7eb7a846b3d735286e09a32b0aa2401773da518e7eba3b57",
    "tags": [
      "v2"
    ],
    "timestamp": "2018-07-12T15:50:53.5372468Z"
  },
  {
    "digest": "sha256:7ca0e0ae50c95155dbb0e380f37d7471e98d2232ed9e31eece9f9fb9078f2728",
    "tags": [
      "v1"
    ],
    "timestamp": "2018-07-11T21:38:35.9170967Z"
  }
]
```

### <a name="manifest-digest"></a>Дайджест манифеста

Манифесты идентифицируются с помощью уникального хэша SHA-256 или *дайджеста манифеста*. Каждое изображение или артефакт - будь то помечены или нет - определяется его дайджест. Значение дайджеста уникально, даже если данные слоя образа идентичны данным другого образа. Данный механизм позволяет многократно отправлять образы с идентичными тегами в реестр. Например, можно многократно отправлять `myimage:latest` в реестр, при этом не получая сообщений об ошибке. Это происходит из за того, что каждый образ идентифицируется по уникальному дайджесту.

Чтобы извлечь образ из реестра, необходимо указать его дайджест в операции передачи. Некоторые системы можно настроить на извлечения с помощью дайджеста, так как он гарантирует, что будет извлечена запрашиваемая версия образа. Операция будет выполнена, даже если образы, которые были идентично помечены, впоследствии будут перенесены в реестр.

Например, вытяните изображение из репозитория "acr-helloworld" с помощью явного дайджеста:

`docker pull myregistry.azurecr.io/acr-helloworld@sha256:0a2e01852872580b2c2fea9380ff8d7b637d3928783c55beb3f21a6e58d5d108`

> [!IMPORTANT]
> Если многократно отправлять измененные образы с идентичными тегами, можно создать потерянные образы, которые остались без тегов, но все еще потребляют пространство реестра. Образы без тегов не отображаются в Azure CLI или на портале Azure при просмотре списка или образов по тегу. Тем не менее их слои по-прежнему существуют и занимают место в реестре. Исключение немаркированного изображения освобождает пространство реестра, когда манифест является единственным или последним, указывая на определенный слой. Для получения информации об освобождении пространства, используемого немаркированными изображениями, [см.](container-registry-delete.md)

## <a name="next-steps"></a>Дальнейшие действия

Узнайте больше о [хранении изображений](container-registry-storage.md) и [поддерживаемых форматах содержимого](container-registry-image-formats.md) в реестре контейнеров Azure.

<!-- LINKS - Internal -->
[az-acr-repository-show-manifests]: /cli/azure/acr/repository#az-acr-repository-show-manifests


