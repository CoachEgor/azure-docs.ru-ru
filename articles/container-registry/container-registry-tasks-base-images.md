---
title: Обновления базового изображения - Задачи
description: Узнайте о базовых изображениях для изображений контейнеров приложений и о том, как базовое обновление изображения может вызвать задачу реестра контейнеров Azure.
ms.topic: article
ms.date: 01/22/2019
ms.openlocfilehash: 017c8f8a3a15896bd6e14a54136ba713e9f9c499
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "77617935"
---
# <a name="about-base-image-updates-for-acr-tasks"></a>Об обновлениях базового изображения для задач ACR

В этой статье содержится справочная информация об обновлениях базового изображения приложения и о том, как эти обновления могут вызвать задачу реестра контейнеров Azure.

## <a name="what-are-base-images"></a>Что такое базовые изображения?

Dockerfiles, определяющий большинство изображений контейнеров, указывают родительское изображение, на котором основано изображение, часто называемое его *базовым.* Базовые образы обычно содержат операционную систему, например [Alpine Linux][base-alpine] или [Windows Nano Server][base-windows], к которой применяются остальные слои контейнера. Они также могут включать в себя платформы приложений, например [Node.js][base-node] или [.NET Core][base-dotnet]. Эти базовые изображения сами по себе, как правило, основаны на общедоступных изображений вверх по течению. Несколько образов вашего приложения могут совместно использовать общий базовый образ.

Разработчик образов часто обновляет базовый образ, чтобы включить новые функции или улучшения в ОС или платформу в образе. Исправления безопасности — еще одна распространенная причина обновления базового образа. При возникновении этих обновлений вверх по течению необходимо также обновить базовые изображения, чтобы включить критическое исправление. Затем необходимо повторно выполнить сборку каждого образа приложения, чтобы внести эти вышестоящие исправления, внесенные в базовый образ.

В некоторых случаях, например, в частной группе разработчиков, базовое изображение может указывать не что иное, как ОС или фреймворк. Например, базовое изображение может быть общим изображением компонента службы, которое необходимо отслеживать. Членам группы может потребоваться отслеживать это базовое изображение для тестирования или регулярно обновлять изображение при разработке изображений приложения.

## <a name="track-base-image-updates"></a>Отслеживайте обновления базового изображения

Решение "Задачи ACR" включают в себя возможность автоматически создавать образы при обновлении базового образа контейнера.

ACR Tasks динамически обнаруживает базовые зависимости изображений при построении изображения контейнера. В результате он может обнаружить, когда базовое изображение изображения приложения обновляется. С помощью одной задачи предварительно настроенной сборки задачи ACR Tasks могут автоматически перестраивать каждое изображение приложения, которое ссылается на базовое изображение. Благодаря такому автоматическому обнаружению и повторному выполнению сборок служба "Задачи ACR" экономит время и усилия, необходимые для того, чтобы вручную отслеживать и обновлять каждый образ приложения, ссылающийся на обновленный базовый образ.

## <a name="base-image-locations"></a>Расположение базовых изображений

При использовании сборок образов из Dockerfile задача ACR обнаружит зависимости базовых образов в следующих расположениях:

* реестр контейнеров Azure, в котором выполняется задача;
* Другой частный реестр контейнеров Azure в том же или другом регионе 
* общедоступный репозиторий в Docker Hub; 
* общедоступный репозиторий в Реестре контейнеров Azure.

Если базовое изображение, `FROM` указанное в заявлении, находится в одном из этих мест, задача ACR добавляет крючок, чтобы убедиться, что изображение будет восстановлено в любое время его база обновляется.

## <a name="additional-considerations"></a>Дополнительные сведения

* **Базовые изображения для изображений приложений** - В настоящее время задача ACR отслеживает только базовые обновления изображений для изображений приложения *(время выполнения).* Они не отслеживают обновления базового образа для промежуточных образов (*время сборки*), которые используются в многоэтапных файлах Dockerfile.  

* **Включено по умолчанию** - При создании задачи ACR с [задачей az acr создать команду,][az-acr-task-create] по умолчанию задача *включена* для триггера обновлением базового изображения. То есть свойству `base-image-trigger-enabled` присвоено значение "True". Если нужно отключить это поведение в задаче, измените свойство на "False". Например, выполните следующую команду [az acr task update][az-acr-task-update]:

  ```azurecli
  az acr task update --myregistry --name mytask --base-image-trigger-enabled False
  ```

* **Триггер для отслеживания зависимостей** - Для того, чтобы задача ACR могла определить и отследить зависимости изображения контейнера, которые включают его базовое изображение, необходимо сначала запустить задачу по созданию изображения **по крайней мере один раз.** Например, запустите задачу вручную с помощью команды [az acr task run][az-acr-task-run].

* **Стабильный тег для базового изображения** - Чтобы вызвать задачу при обновлении базового изображения, базовое изображение должно иметь *стабильный* тег, `node:9-alpine`например. Эта расстановка тегов типична для базового образа, который обновляется с помощью исправлений платформы и ОС до последней стабильной версии. Если базовый образ обновляется с помощью нового тега версии, он не запускает задачу. Подробнее о добавлении тегов к образам см. [Расстановка тегов в Docker: рекомендации для расстановки тегов и управления версиями образов Docker](container-registry-image-tag-version.md). 

* **Другие триггеры задач** - В задаче, вызванной обновлениями базового изображения, вы также можете включить триггеры на основе [коммита исходного кода](container-registry-tutorial-build-task.md) или [расписания.](container-registry-tasks-scheduled.md) Базовое обновление изображения также может вызвать [многоступенчатую задачу.](container-registry-tasks-multi-step.md)

## <a name="next-steps"></a>Дальнейшие действия

Ознакомьтесь со следующими учебниками по сценариям автоматизации сборки изображений приложений после обновления базового изображения:

* [Автоматизировать сборку изображения контейнера при обновлении базового изображения в том же реестре](container-registry-tutorial-base-image-update.md)

* [Автоматизировать сборку изображения контейнера при обновлении базового изображения в другом реестре](container-registry-tutorial-base-image-update.md)


<!-- LINKS - External -->
[base-alpine]: https://hub.docker.com/_/alpine/
[base-dotnet]: https://hub.docker.com/r/microsoft/dotnet/
[base-node]: https://hub.docker.com/_/node/
[base-windows]: https://hub.docker.com/r/microsoft/nanoserver/
[sample-archive]: https://github.com/Azure-Samples/acr-build-helloworld-node/archive/master.zip
[terms-of-use]: https://azure.microsoft.com/support/legal/preview-supplemental-terms/

<!-- LINKS - Internal -->
[azure-cli]: /cli/azure/install-azure-cli
[az-acr-build]: /cli/azure/acr#az-acr-build
[az-acr-pack-build]: /cli/azure/acr/pack#az-acr-pack-build
[az-acr-task]: /cli/azure/acr/task
[az-acr-task-create]: /cli/azure/acr/task#az-acr-task-create
[az-acr-task-run]: /cli/azure/acr/task#az-acr-task-run
[az-acr-task-update]: /cli/azure/acr/task#az-acr-task-update
[az-login]: /cli/azure/reference-index#az-login
[az-login-service-principal]: /cli/azure/authenticate-azure-cli

<!-- IMAGES -->
[quick-build-01-fork]: ./media/container-registry-tutorial-quick-build/quick-build-01-fork.png
[quick-build-02-browser]: ./media/container-registry-tutorial-quick-build/quick-build-02-browser.png
