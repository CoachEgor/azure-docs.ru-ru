---
title: Индексирование больших наборов данных с помощью встроенных индексаторов в службе "Поиск Azure"
description: Ознакомьтесь со стратегиями для индексирования больших объемов данных или индексирования с использованием значительных вычислительных мощностей с помощью пакетного режима, а также с методами выполнения запланированного, параллельного и распределенного индексирования.
services: search
author: HeidiSteen
manager: nitinme
ms.service: search
ms.topic: conceptual
ms.date: 09/19/2019
ms.author: heidist
ms.openlocfilehash: e3240ca40b9dcf866c5e4a5cf570b5575b7586d8
ms.sourcegitcommit: 992e070a9f10bf43333c66a608428fcf9bddc130
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2019
ms.locfileid: "71240356"
---
# <a name="how-to-index-large-data-sets-in-azure-search"></a>Индексирование больших наборов данных в службе "Поиск Azure"

По мере изменения объема данных или обработки потребности в них может оказаться, что простые и используемые по умолчанию стратегии индексирования более непрактичны. В службе "Поиск Azure" существует несколько подходов для работы с крупными наборами данных, которые предназначены как для структурирования запросов на передачу данных, так и для использования зависящего от источника индексатора для запланированных и распределенных рабочих нагрузок.

Те же методы применяются и к долго выполняющимся процессам. В частности, действия, описанные в разделе о [параллельном индексировании](#parallel-indexing), пригодны и для индексирования с большим объемом вычислений, например анализа изображений или обработки естественного языка в [конвейерах когнитивного поиска](cognitive-search-concept-intro.md).

В следующих разделах рассматриваются три метода индексирования больших объемов данных.

## <a name="option-1-pass-multiple-documents"></a>Вариант 1. Передача нескольких документов

Простейшим механизмом индексирования большего набора данных является отправка нескольких документов или записей в одном запросе. Если размер всех полезных данных не превышает 16 МБ, запрос может обрабатывать до 1000 документов в рамках одной операции массовой отправки. Эти ограничения применяются независимо от того, используете ли вы класс " [добавить документы (остальные)](https://docs.microsoft.com/rest/api/searchservice/addupdate-or-delete-documents) " или " [индекс](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.models.index?view=azure-dotnet) " в пакете SDK для .NET. Для любого из этих API необходимо упаковать 1000 документов в тексте каждого запроса.

Пакетное индексирование реализуется для отдельных запросов с помощью REST, .NET или индексаторов. Для некоторых индексаторов действуют разные ограничения. В частности, при индексировании BLOB-объектов Azure размер пакета задается равным 10 документам с учетом того, что размер документа больше среднего. Для индексаторов, основанных на [CREATE индексатора (остальное)](https://docs.microsoft.com/rest/api/searchservice/Create-Indexer ), можно задать `BatchSize` аргумент для настройки этого параметра, чтобы лучше соответствовать характеристикам данных. 

> [!NOTE]
> Чтобы сократить размер документа, старайтесь не добавлять незапрашиваемые данные в индекс. Изображения и другие двоичные данные не поддерживают прямой поиск и не должны храниться в индексе. Чтобы добавить в результаты поиска недоступные для запроса данные, следует определить поле, недоступное для поиска, в котором хранится ссылка на URL-адрес ресурса.

## <a name="option-2-add-resources"></a>Вариант 2. Добавление ресурсов

Службы, подготовленные в одной из [ценовых категорий "Стандартный"](search-sku-tier.md), часто имеют недостаточно используемую емкость для хранения и рабочих нагрузок (запросов или индексирования), поэтому [увеличение количества секций и реплик](search-capacity-planning.md) становится очевидным решением для размещения крупных наборов данных. Для достижения наилучших результатов необходимы оба ресурса: секции для хранения данных и реплики для приема данных.

Увеличение количества реплик и секций — это оплачиваемые события, которые увеличивают затраты, но если не выполняется непрерывная индексация при максимальной нагрузке, можно добавить масштаб в течение процесса индексирования, а затем изменить уровни ресурсов в обратном направлении после индексирования. готовы.

## <a name="option-3-use-indexers"></a>Вариант 3. Использование индексаторов

[Индексаторы](search-indexer-overview.md) используются для обхода поддерживаемых источников данных Azure для поиска содержимого. Несмотря на то что некоторые возможности индексаторов не предназначены специально для крупномасштабного индексирования, они особенно полезны для обработки крупных наборов данных.

+ Планировщики позволяют запускать индексирование через регулярные интервалы.
+ Запланированное индексирование можно возобновлять с последнего известного момента остановки. Если в течение 24 часов был выполнен лишь частичный обход источника данных, индексатор возобновит действие на второй день с места остановки.
+ При секционировании данных на небольшие отдельные источники данных можно применять параллельную обработку. Вы можете разбить большой набор данных на небольшие наборы данных на платформе исходных данных (например, хранилище BLOB-объектов Azure или базу данных SQL Azure), а затем создать несколько [объектов источника данных](https://docs.microsoft.com/rest/api/searchservice/create-data-source) в поиске Azure, которые можно индексировать параллельно.

> [!NOTE]
> Индексаторы зависят от типов источников данных, поэтому индексирование применяется только к отдельным источникам данных в Azure: [база данных SQL](search-howto-connecting-azure-sql-database-to-azure-search-using-indexers.md), [хранилище BLOB-объектов](search-howto-indexing-azure-blob-storage.md), [хранилище таблиц](search-howto-indexing-azure-tables.md), [Cosmos DB](search-howto-index-cosmosdb.md).

### <a name="scheduled-indexing"></a>Запланированное индексирование

Планирование индексатора служит важным механизмом в обработке больших наборов данных и длительных процессов, таких как анализ изображений в конвейере когнитивного поиска. Индексатор выполняет обработку в пределах 24-часового периода. Если за это время ее завершить не удается, вы можете исправить ситуацию с помощью планирования индексаторов. 

Запланированные операции индексирования запускаются через определенные интервалы времени, и обычно работа очередного задания индексатора завершается до того, как наступит время запускать следующее. Но если обработка к этому моменту еще не завершена, индексатор останавливается (завершается отведенное ему время). При запуске следующего задания обработка начнется с места остановки, так как система отслеживает текущее состояние операций. 

На практике это означает, что для многодневных задач индексирования вам следует настроить для индексатора запуск через каждые 24 часа. Каждое следующее задание индексирования в начале 24-часового цикла начнет работу с последнего документа, который считается надежным. Такая схема работы позволяет индексатору перебирать очередь документа в течение нескольких дней, пока все они не будут обработаны. Дополнительные сведения об этом подходе см. в разделе об [индексировании больших наборов данных](search-howto-indexing-azure-blob-storage.md#indexing-large-datasets). Дополнительные сведения о настройке расписания в целом см. в разделе [CREATE индексатор REST API](https://docs.microsoft.com/rest/api/searchservice/Create-Indexer#request-syntax) или [в разделе Планирование индексаторов для поиска Azure](search-howto-schedule-indexers.md).

<a name="parallel-indexing"></a>

### <a name="parallel-indexing"></a>Параллельное индексирование

Стратегия параллельного индексирования основана на одновременном индексировании нескольких источников данных, где каждое определение источника данных задает подмножество данных. 

Для нетипичных заданий индексирования, требующих высокой вычислительной мощности, например для распознавания текста в отсканированных документах в конвейере когнитивного поиска, при анализе изображений или обработке естественного языка, правильным решением может оказаться стратегия параллельного индексирования. Если вы можете отказаться от запросов или сократить их количество, параллельное индексирование данных службы, которая не обрабатывает запросы одновременно, является оптимальным вариантом для быстрой переработки значительного объема содержимого, требующего длительной обработки. 

Параллельная обработка состоит из следующих этапов.

+ Разделите исходные данные на несколько контейнеров или несколько виртуальных папок в одном контейнере. 
+ Сопоставьте каждый мини-набор данных с собственным [источником данных](https://docs.microsoft.com/rest/api/searchservice/create-data-source), связанным с собственным [индексатором](https://docs.microsoft.com/rest/api/searchservice/create-indexer).
+ В службе когнитивного поиска настройте один и тот же [набор навыков](https://docs.microsoft.com/rest/api/searchservice/create-skillset) для каждого из определений индексаторов.
+ В качестве целевого объекта записи назначьте им один и тот же индекс. 
+ Настройте для всех индексаторов запуск в одно и то же время.

> [!NOTE]
> Служба "Поиск Azure" не поддерживает выделенные реплики или разделы для конкретных рабочих нагрузок. Большой объем одновременных заданий индексирования может привести к перегрузке системы, что ухудшит производительность обработки запросов. Если у вас есть тестовая среда, попробуйте запустить в ней параллельное индексирование, чтобы оценить потенциальные проблемы.

### <a name="how-to-configure-parallel-indexing"></a>Настройка параллельного индексирования

Вычислительная мощность индексаторов слабо связана с одной подсистемой индексаторов, которую служба поиска использует для каждой единицы службы (SU). Несколько одновременных индексаторов можно выполнять в службах "Поиск Azure", которые предоставляются на уровне "Базовый" или "Стандартный" и имеют по меньше мере две реплики. 

1. На [портале Azure](https://portal.azure.com) откройте панель мониторинга для службы поиска, затем страницу **Обзор** и проверьте значение параметра **Ценовая категория**, чтобы убедиться в доступности параллельного индексирования. На уровнях "Базовый" и "Стандартный" поддерживается использование нескольких реплик.

2. В разделе **Параметры** > **Масштабирование** [увеличьте количество реплик](search-capacity-planning.md) для параллельной обработки, создав одну дополнительную реплику для каждой рабочей нагрузки индексатора. Оставьте достаточное количество реплик для обработки фактического объема запросов. Не следует жертвовать рабочими нагрузками обработки запросов в пользу индексирования.

3. Распределите данные на несколько контейнеров на таком уровне, который доступен для индексаторов службы "Поиск Azure". Например, создайте несколько таблиц в базе данных SQL Azure, несколько контейнеров в хранилище BLOB-объектов Azure или несколько коллекций. Определите отдельный объект источника данных для каждой таблицы или контейнера.

4. Создайте несколько индексаторов и расписания для их параллельного выполнения.

   + В качестве примера давайте рассмотрим службу с шестью репликами. Настройте для нее шесть индексаторов, каждый из которых сопоставлен с источником данных, содержащим примерно шестую часть от общего объема набора данных. 

   + Настройте для каждого индексатора один и тот же индекс. Укажите один и тот же набор навыков для рабочих нагрузок когнитивного поиска.

   + В определении каждого индексатора запланируйте одинаковые графики выполнения. Например, `"schedule" : { "interval" : "PT8H", "startTime" : "2018-05-15T00:00:00Z" }` создает для всех индексаторов расписание, по которому они запускаются каждые 8 часов 15 мая 2018 г.

В запланированное время все индексаторы одновременно начнут загружать данные, применять к ним правила обогащения (если вы настроили для них конвейер когнитивного поиска) и сохранять результаты в индекс. Служба "Поиск Azure" не применяет блокировку индекса для обновлений. Параллельные операции записи обрабатываются логикой повторных попыток, если при первой попытке не удалось записать данные.

> [!Note]
> Увеличивая количество реплик, попробуйте увеличить и количество разделы, если прогнозируется значительное увеличение размера индекса. Разделы хранят фрагменты индексированного содержимого. Чем больше разделов, тем меньше объем сохраненной в каждом из них информации.

## <a name="see-also"></a>См. также

+ [Обзор индексатора](search-indexer-overview.md)
+ [Импорт данных в службу поиска Azure с помощью портала](search-import-data-portal.md)
+ [Индексатор Базы данных SQL Azure](search-howto-connecting-azure-sql-database-to-azure-search-using-indexers.md)
+ [Индексатор Azure Cosmos DB](search-howto-index-cosmosdb.md)
+ [Индексатор хранилища BLOB-объектов Azure](search-howto-indexing-azure-blob-storage.md)
+ [Индексатор хранилища таблиц Azure](search-howto-indexing-azure-tables.md)
+ [Безопасность и управляемый доступ в службе поиска Azure](search-security-overview.md)
