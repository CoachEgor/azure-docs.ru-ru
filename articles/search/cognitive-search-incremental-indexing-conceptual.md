---
title: Введение в добавочное индексирование (Предварительная версия)
titleSuffix: Azure Cognitive Search
description: Настройте конвейер обогащения искусственного интеллекта для обеспечения согласованности данных для обработки любых обновлений в навыках, навыков, индексаторах или источниках данных.
manager: nitinme
author: Vkurpad
ms.author: vikurpad
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 11/04/2019
ms.openlocfilehash: ea3bcfc25040f09b6871d85412ac64061ec2f9e8
ms.sourcegitcommit: 3f8017692169bd75483eefa96c225d45cd497f06
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2019
ms.locfileid: "73549113"
---
# <a name="what-is-incremental-indexing-in-azure-cognitive-search"></a>Что такое добавочное индексирование в Azure Когнитивный поиск?

> [!Note]
> Добавочное индексирование находится на этапе предварительной версии и не предназначено для использования в рабочей среде. Эта функция предоставляется в [версии REST API 2019-05-06-Preview](search-api-preview.md). В настоящее время отсутствует поддержка портала или пакета SDK для .NET.
>

Добавочное индексирование — это новая функция Когнитивный поиск Azure, которая добавляет кэширование и состояние в обогащенный набор квалификационных навыков, позволяя управлять обработкой и повторной обработкой отдельных шагов в конвейере обогащения. Это позволяет не только сохранить денежные инвестиции в обработку, но и повысить эффективность работы системы. При кэшировании структур и содержимого индексатор может определить, какие навыки были изменены, и выполнить только те из них, которые были изменены, а также все нисходящие зависимые навыки. 

При добавочном индексировании Текущая версия конвейера обогащения выполняет минимальный объем работы для обеспечения согласованности всех документов в индексе. Для сценариев, в которых требуется полный доступ, можно использовать детализированные элементы управления для переопределения ожидаемого поведения. Дополнительные сведения о конфигурации см. в разделе [Настройка добавочного индексирования](search-howto-incremental-index.md).

## <a name="indexer-cache"></a>Кэш индексатора

Добавочное индексирование добавляет кэш индексатора в конвейер обогащения. Индексатор кэширует результаты взлома документа и выходные данные каждого навыка для каждого документа. При обновлении набора знаний перезапускаются только измененные или нисходящие навыки. Обновленные результаты записываются в кэш, а документ обновляется в индексе и в хранилище знаний.

Физически кэш является учетной записью хранения. Все индексы в службе поиска могут использовать одну и ту же учетную запись хранения для кэша индексатора. Каждому индексатору назначается уникальный и неизменяемый идентификатор кэша.

### <a name="cache-configuration"></a>Конфигурация кэша

Для запуска выигрыша из инкрементного индексирования необходимо задать свойство `cache` в индексаторе. В следующем примере показан индексатор с включенным кэшированием. Конкретные части этой конфигурации описаны в следующих разделах.

```json
{
    "name": "myIndexerName",
    "targetIndexName": "myIndex",
    "dataSourceName": "myDatasource",
    "skillsetName": "mySkillset",
    "cache" : {
        "storageConnectionString" : "Your storage account connection string",
        "enableReprocessing": true,
        "id" : "Auto generated Id you do not need to set"
    },
    "fieldMappings" : [],
    "outputFieldMappings": [],
    "parameters":{}
}
```

Если установить это свойство в первый раз для существующего индексатора, потребуется также сбросить его, что приведет к повторной обработке всех документов в источнике данных. Целью добавочного индексирования является обеспечение соответствия документов в индексе с источником данных и текущей версией набора навыков. Сброс индекса является первым шагом к этой согласованности, так как устраняет все документы, дополненные предыдущими версиями набора навыков. Необходимо сбросить индексатор, чтобы начать с единообразного базового плана.

### <a name="cache-lifecycle"></a>Жизненный цикл кэша

Жизненный цикл кэша управляется индексатором. Если свойству `cache` в индексаторе присвоено значение null или изменена строка соединения, существующий кэш будет удален. Жизненный цикл кэша также привязан к жизненному циклу индексатора. При удалении индексатора также удаляется связанный с ним кэш.

### <a name="indexer-cache-mode"></a>Режим кэша индексатора

Кэш индексатора может действовать в режимах, где данные записываются только в кэш, а данные записываются в кэш и используются для повторного расширения документов.  Можно временно приостановить добавочное обогащение, задав для свойства `enableReprocessing` в кэше значение `false`, а позднее возобновить добавочное уточнение и накопительное согласование, задав для него значение `true`. Этот элемент управления особенно удобен в том случае, если необходимо задать приоритеты для индексирования новых документов, чтобы обеспечить согласованность в совокупности документов.

## <a name="change-detection-override"></a>Переопределение обнаружения изменений

Добавочное индексирование обеспечивает детальный контроль над всеми аспектами конвейера обогащения. Этот элемент управления позволяет работать с ситуациями, когда изменение может привести к непредвиденным последствиям. Например, изменение набора навыков и изменение URL-адреса для пользовательского навыка приведет к недействительности в индексаторе кэшированных результатов для этого навыка. Если вы перемещаете конечную точку только на другую виртуальную машину или повторно развертываете свой навык с помощью нового ключа доступа, вы действительно не хотите повторно обрабатывать какие-либо существующие документы.

Чтобы в индексаторе были только явно нужные дополнения, обновления в наборе навыков могут при необходимости задать для параметра `disableCacheReprocessingChangeDetection` QueryString значение `true`. Если этот параметр задан, он гарантирует, что будут зафиксированы только обновления набора навыков, а изменение не будет оцениваться на наличие изменений в существующем совокупности.

В следующем примере демонстрируется использование строки запроса. Это часть запроса, в которой есть пары "ключ-значение", разделенные &. 

```http
PUT https://customerdemos.search.windows.net/skillsets/callcenter-text-skillset?api-version=2019-05-06-Preview&disableCacheReprocessingChangeDetection=true
```

## <a name="cache-invalidation"></a>Недействительность кэша

Этот сценарий является одним из случаев, когда вы можете развернуть новую версию пользовательского навыка, ничего не меняется в конвейере обогащения, но при этом требуется, чтобы определенные навыки стали недействительными, а все затронутые документы перерабатывались в соответствии с преимуществами обновленной модели. В таких случаях можно вызвать операцию сделать недействительные навыки для набора навыков. API сброса навыков принимает запрос POST со списком выходных данных навыков в кэше, которые должны быть аннулированы. Дополнительные сведения об API сброса навыков см. в разделе [Сброс индексатора (поиск REST API)](https://docs.microsoft.com/rest/api/searchservice/reset-indexer).

## <a name="bi-directional-change-detection"></a>Двунаправленное обнаружение изменений

Индексаторы не только перемещаются вперед и обрабатывают новые документы, но теперь могут перемещаться назад и обрабатывать ранее обработанные документы до согласованности. Благодаря этой новой возможности важно понимать, как изменения в компонентах конвейера обогащения приводят к работе индексатора. Индексатор будет ставить в очередь работу, которая будет выполняться при обнаружении изменений, которые либо недействительны, либо не согласуются с кэшированным содержимым.

### <a name="invalidating-changes"></a>Непроверяемые изменения

Непроверяемые изменения являются редкими, но оказывают значительное воздействие на состояние конвейера обогащения. Недействительное изменение — это одно из тех, в котором весь кэш больше не является допустимым. Примером недействительного изменения является то, где обновляется источник данных. Для сценариев, когда известно, что изменение не должно сделать кэш недействительным, например, при смене ключа в учетной записи хранения, параметру `ignoreResetRequirement` QueryString должно быть присвоено значение `true` операции обновления конкретного ресурса, чтобы гарантировать, что операция не отклонено.

Ниже приведен полный список изменений, которые сделают кэш недействительным.

* Изменение типа источника данных
* Переход к контейнеру источника данных
* Учетные данные источника данных
* Политика обнаружения изменений источника данных
* Политика обнаружения удаления источников данных
* Сопоставления полей индексатора
* Параметры индексатора
    * Режим синтаксического анализа
    * Исключенные расширения имен файлов
    * Индексированные расширения имен файлов
    * Индексировать метаданные хранилища только для документов с слишком размером
    * Текстовые заголовки с разделителями
    * Разделитель текста с разделителями
    * Корень документа
    * Действие с изображением (изменения в способе извлечения изображений)

### <a name="inconsistent-changes"></a>Непоследовательные изменения

Примером непротиворечивого изменения является обновление набора навыков, изменяющего навык. Изменение может привести к непротиворечивости части кэша. Индексатор определит работу для обеспечения их единообразия.  

Полный список изменений, приводящих к несогласованности кэша:

* Навык в наборе навыков имеет другой тип. Тип OData для навыка обновлен
* Параметры, относящиеся к навыкам, обновлены, например URL-адрес, значения по умолчанию или другие параметры
* Результаты навыков изменяются, навык Возвращает дополнительные или различные выходные данные.
* Изменения в навыках отличаются от происхождение, изменились цепочки навыков, т. е. входные данные навыка
* Любой вышестоящий уровень недействительности, если навык, предоставляющий входные данные для этого навыка, обновлен
* Обновления расположения проекции хранилища знаний, что приводит к перепроецированию документов
* Изменения в проекциях хранилища знаний, что приводит к перепроецированию документов
* Изменение сопоставления полей вывода в индексаторе приводит к перепроецированию документов в индекс

## <a name="rest-api-reference-for-incremental-indexing"></a>REST API ссылка для добавочного индексирования

Функции RESTFUL `api-version=2019-05-06-Preview` предоставляют API для добавочного индексирования с дополнениями к индексаторам, навыков и источникам данных. Справочная документация в настоящее время не включает эти дополнения. В следующем разделе описываются изменения API.

### <a name="indexers"></a>Индексаторы

[Создание индексатора](https://docs.microsoft.com/rest/api/searchservice/create-indexer) и [индексатора обновления](https://docs.microsoft.com/rest/api/searchservice/update-indexer) теперь будет предоставлять новые свойства, связанные с кэшем:

* `StorageAccountConnectionString`: строка подключения к учетной записи хранения, которая будет использоваться для кэширования промежуточных результатов.

* `CacheId`. `cacheId` — это идентификатор контейнера в учетной записи хранения `annotationCache`, который будет использоваться в качестве кэша для этого индексатора. Этот кэш будет уникальным для этого индексатора, и если индексатор будет удален и создан повторно с тем же именем, `cacheId` будет создан повторно. Невозможно задать `cacheId`, он всегда создается службой.

* `EnableReprocessing`: по умолчанию задано значение `true`. Если задано значение `false`, документы будут по прежнему записываться в кэш, но существующие документы не будут повторно обрабатываться на основе данных кэша.

Некоторые индексаторы (через [Источники данных](https://docs.microsoft.com/rest/api/searchservice/create-data-source)) получают данные через запросы. Для запросов, извлекающих данные, индексаторы также поддерживают новый параметр строки запроса: `ignoreResetRequirement` должны иметь значение `true` если действие обновления не должно сделать кэш недействительным.

### <a name="skillsets"></a>Наборы навыков

Навыков не будет поддерживать новые операции, но будет поддерживать новый параметр QueryString: `disableCacheReprocessingChangeDetection` должен иметь значение `true`, если обновление существующих документов на основе текущего действия не требуется.

### <a name="datasources"></a>Источников данных

Источники данных не будут поддерживать новые операции, но будут поддерживать новый параметр QueryString: `ignoreResetRequirement` должны иметь значение `true` если действие обновления не должно сделать кэш недействительным.

## <a name="best-practices"></a>Рекомендации

Рекомендуемым подходом к использованию добавочного индексирования является настройка свойства Cache в новом индексаторе или Сброс существующего индексатора и задание свойства Cache.

Используйте `ignoreResetRequirement` экономно, так как это может привести к непредвиденному несогласованности данных, которые не будут обнаружены легко.

## <a name="takeaways"></a>Общие выводы

Добавочное индексирование — это мощная функция, которая расширяет отслеживание изменений от источника данных до всех аспектов конвейера обогащения, включая источник данных, текущую версию набора навыков и индексатор. По мере развития навыков, навыковов и дополнений, конвейер обогащения обеспечивает минимальную возможную работу, сохраняя при этом документы в конечном итоге.

## <a name="next-steps"></a>Дальнейшие действия

Начало работы с добавочным индексированием путем добавления кэша к существующему индексатору или добавления кэша при определении нового индексатора.

> [!div class="nextstepaction"]
> [Настройка добавочного индексирования](search-howto-incremental-index.md)
