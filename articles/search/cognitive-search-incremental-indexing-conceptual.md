---
title: Добавочное обогащение (Предварительная версия)
titleSuffix: Azure Cognitive Search
description: Кэшировать промежуточное содержимое и добавочные изменения из конвейера обогащения искусственного интеллекта в службе хранилища Azure для сохранения инвестиций в существующие обработанные документы. Эта функция сейчас доступна в виде общедоступной предварительной версии.
manager: nitinme
author: Vkurpad
ms.author: vikurpad
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 01/09/2020
ms.openlocfilehash: a5b12a426e52c3b80c58a30b320b2f746bbe990d
ms.sourcegitcommit: f53cd24ca41e878b411d7787bd8aa911da4bc4ec
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/10/2020
ms.locfileid: "75832196"
---
# <a name="introduction-to-incremental-enrichment-and-caching-in-azure-cognitive-search"></a>Общие сведения о добавочном обогащении и кэшировании в Azure Когнитивный поиск

> [!IMPORTANT] 
> Добавочное углубление в настоящее время находится в общедоступной предварительной версии. Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/). Эта функция предоставляется в [версии REST API 2019-05-06-Preview](search-api-preview.md). В настоящее время отсутствует поддержка портала или пакета SDK для .NET.

Добавочное дополнение добавляет кэширование и пользуясь в конвейер обогащения, сохраняя инвестиции в существующие выходные данные, изменяя только те документы, на которые влияет определенное изменение. Это не только позволяет сохранить денежные инвестиции в обработку (в частности, распознавание текста и обработки изображений), но также делает систему более эффективной. При кэшировании структур и содержимого индексатор может определить, какие навыки были изменены, и выполнить только те из них, которые были изменены, а также все нисходящие зависимые навыки. 

## <a name="indexer-cache"></a>Кэш индексатора

При добавочном обогащении добавляется кэш в конвейер обогащения. Индексатор кэширует результаты взлома документа, а также выходные данные каждого навыка для каждого документа. При обновлении набора знаний повторно запускаются только измененные навыки и те, которые выполняются после них. Обновленные результаты записываются в кэш, а документ обновляется в индексе поиска или в хранилище знаний.

Физически кэш хранится в контейнере больших двоичных объектов в вашей учетной записи хранения Azure. Все индексы в службе поиска могут использовать для кэша индексатора одну учетную запись хранения. Каждому индексатору назначается уникальный и неизменяемый идентификатор кэша для контейнера, который он использует.

## <a name="cache-configuration"></a>Конфигурация кэша

Необходимо задать свойство `cache` в индексаторе, чтобы запустить выигрыша из добавочного уточнения. В следующем примере показан индексатор с включенным кэшированием. Конкретные части этой конфигурации описаны в следующих разделах. Дополнительные сведения см. в разделе [Настройка добавочного обогащения](search-howto-incremental-index.md).

```json
{
    "name": "myIndexerName",
    "targetIndexName": "myIndex",
    "dataSourceName": "myDatasource",
    "skillsetName": "mySkillset",
    "cache" : {
        "storageConnectionString" : "Your storage account connection string",
        "enableReprocessing": true
    },
    "fieldMappings" : [],
    "outputFieldMappings": [],
    "parameters": []
}
```

Если установить это свойство для существующего индексатора, потребуется сбросить и повторно запустить индексатор, что приведет к повторной обработке всех документов в источнике данных. Этот шаг необходим для удаления документов, дополненных предыдущими версиями набора навыков. 

## <a name="cache-management"></a>Управление кэшем

Жизненным циклом кэша управляет индексатор. Если для свойства `cache` индексатора задано значение null или строка подключения изменена, существующий кэш удаляется при следующем запуске индексатора. Кроме того, жизненный цикл кэша привязан к жизненному циклу индексатора. При удалении индексатора удаляется и связанный с ним кэш.

Хотя поэтапное углубление предназначено для обнаружения изменений и реагирования на них без вмешательства пользователя, существуют параметры, которые можно использовать для переопределения поведения по умолчанию.

+ Приостановить кэширование
+ Обход проверок набора навыков
+ Обход проверок источников данных
+ Принудительная Оценка набора навыков

### <a name="suspend-caching"></a>Приостановить кэширование

Вы можете временно приостановить добавочное обогащение, задав для свойства `enableReprocessing` в кэше значение `false`, а позднее возобновить добавочное обогащение и потребовать итоговую согласованность, задав значение `true`. Этот элемент управления особенно удобно использовать, если индексирование новых документов должно иметь более высокий приоритет, чем согласованность всей совокупности документов.

### <a name="bypass-skillset-evaluation"></a>Обход оценки набора навыков

Изменение набора навыков и повторная обработка этого набора навыков обычно направляются вручную. Однако некоторые изменения в наборе навыков не должны приводить к повторной обработке (например, развертыванию пользовательского навыка в новом месте или с помощью нового ключа доступа). Скорее всего, это периферийные изменения, не подлинность которых повлияла на вещество самого набора навыков. 

Если известно, что изменение набора навыков действительно является ненужным, следует переопределить оценку набора навыков, задав для параметра `disableCacheReprocessingChangeDetection` значение `true`.

1. Вызовите Update квалификационный набор и измените определение набора навыков.
1. Добавьте в запрос параметр `disableCacheReprocessingChangeDetection=true`.
1. Отправьте изменение.

Установка этого параметра гарантирует, что зафиксированы только обновления определения набора навыков, и изменение не будет оцениваться на наличие изменений в существующем совокупности.

В следующем примере показан запрос на обновление набора квалификационных навыков с помощью параметра:

```http
PUT https://customerdemos.search.windows.net/skillsets/callcenter-text-skillset?api-version=2019-05-06-Preview&disableCacheReprocessingChangeDetection=true
```

### <a name="bypass-data-source-validation-checks"></a>Обход проверки источника данных

Большинство изменений в определении источника данных сделает кэш недействительным. Однако в случаях, когда известно, что изменение не должно сделать кэш недействительным, например изменение строки подключения или вращение ключа в учетной записи хранения, добавьте параметр`ignoreResetRequirement` в обновление источника данных. Присвоение этому параметру значения `true` позволяет выполнить фиксацию, не запуская условие сброса, которое приведет к перестроению всех объектов и заполнению с нуля.

```http
PUT https://customerdemos.search.windows.net/datasources/callcenter-ds?api-version=2019-05-06-Preview&ignoreResetRequirement=true
```

### <a name="force-skillset-evaluation"></a>Принудительная Оценка набора навыков

Целью кэша является избежание ненужной обработки, но предположим, что вы внесли изменения в навык или набор навыков, который не обнаруживается индексатором (например, изменения внешних компонентов, таких как пользовательский набор навыков). 

В этом случае можно использовать API [сброса навыков](preview-api-resetskills.md) для принудительной повторной обработки определенного навыка, включая все нисходящие навыки, зависящие от выходных данных этого навыка. Этот API принимает запрос POST со списком навыков, которые необходимо сделать недействительными, и повторно запустите. После сброса навыков запустите индексатор, чтобы выполнить операцию.

## <a name="change-detection"></a>Обнаружение изменений

После включения кэша индексатор оценивает изменения в компоновке конвейера, чтобы определить, какое содержимое можно повторно использовать и что требуется выполнить повторную обработку. В этом разделе перечисляются изменения, которые делают кэш недействительным, за которыми следуют изменения, которые инициируют добавочную обработку. 

### <a name="changes-that-invalidate-the-cache"></a>Изменения, которые делают кэш недействительным

К таким изменениям относятся такие действия, после которых весь кэш становится недействительным. Например, приводящим к недействительности изменением является обновление источника данных. Вот полный список изменений, которые делают кэш недействительным:

* изменение типа внешнего источника данных;
* изменение контейнера источника данных;
* учетные данные источника данных;
* политика обнаружения изменений в источнике данных;
* политика обнаружения удалений в источнике данных;
* сопоставления полей индексатора;
* Параметры индексатора
    * режим анализа;
    * исключаемые расширения имен файлов;
    * индексируемые расширения имен файлов;
    * индексация метаданных хранилища только для очень больших документов;
    * заголовки текста с разделителями;
    * разделители текста с разделителями;
    * корневой каталог документов;
    * действие с изображением (изменения в способе извлечения изображений).

### <a name="changes-that-trigger-incremental-processing"></a>Изменения, вызывающие добавочную обработку

Добавочная обработка оценивает определение набора навыков и определяет, какие навыки следует повторно запустить, выборочно обновив затронутые части дерева документов. Ниже приведен полный список изменений, которые в результате добавочного уточнения:

* другой тип навыка в наборе навыков; изменение типа OData для навыка;
* обновление параметров конкретного навыка, например его URL-адреса, значений по умолчанию или других параметров;
* изменение выходных данных навыков, в том числе их наличие дополнительных или других выходных данных;
* изменения в навыках, изменяющие их родственные отношения и цепочки зависимостей, например: входные данные навыков
* недействительность любого навыка на уровне выше, если он предоставляет входные данные для этого навыка;
* изменение расположения для проекции хранилища знаний, которое приводит к повторному проецированию документов;
* изменение проекций хранилища знаний, которое приводит к повторному проецированию документов;
* изменение сопоставления выходных полей в индексаторе, которое приводит к повторному проецированию документов в индекс.

## <a name="api-reference-content-for-incremental-enrichment"></a>Справочное содержимое API для добавочного дополнения

Функции RESTFUL `api-version=2019-05-06-Preview` предоставляют API для добавочного уточнения с добавлением к индексаторам, навыков и источникам данных. [Официальная справочная документация](https://docs.microsoft.com/rest/api/searchservice/) предназначена для общедоступных интерфейсов API и не охватывает предварительные версии функций. В следующем разделе содержится справочное содержимое для затронутых API.

Сведения об использовании и примеры см. в подокне [Настройка кэширования для добавочного дополнения](search-howto-incremental-index.md).

### <a name="indexers"></a>Индексаторы

[Создание индексатора](https://docs.microsoft.com/rest/api/searchservice/create-indexer) и [индексатора обновления](https://docs.microsoft.com/rest/api/searchservice/update-indexer) теперь будет предоставлять новые свойства, связанные с кэшем:

+ `StorageAccountConnectionString`: строка подключения к учетной записи хранения, которая будет использоваться для кэширования промежуточных результатов.

+ `EnableReprocessing`: по умолчанию задано значение `true`. Если задано значение `false`, документы будут по прежнему записываться в кэш, но существующие документы не будут повторно обрабатываться на основе данных кэша.

+ `ID` (только для чтения). `ID` является идентификатором контейнера в `annotationCache` учетной записи хранения, который будет использоваться в качестве кэша для этого индексатора. Этот кэш будет уникальным для этого индексатора. Значение `ID` восстанавливается, если вы удалите индексатор и повторно создадите с тем же именем. Вы не можете задать значение для `ID` — оно всегда определяется службой.

### <a name="skillsets"></a>Наборы навыков

+ Набор [навыков обновления](https://docs.microsoft.com/rest/api/searchservice/update-skillset) поддерживает новый параметр запроса: `disableCacheReprocessingChangeDetection`, для которого необходимо задать значение `true`, если не требуется обновлять существующие документы на основе текущего действия.

+ [Сброс навыков](preview-api-resetskills.md) — это новая операция, используемая для аннулирования набора навыков.

### <a name="datasources"></a>Источники данных

+ Некоторые Индексаторы получают данные через запросы. Для запросов, извлекающих данные, [Обновление источника данных](https://docs.microsoft.com/rest/api/searchservice/update-datasource) поддерживает новый параметр `ignoreResetRequirement`запроса, который должен быть установлен в `true` если действие обновления не должно сделать кэш недействительным.

Используйте `ignoreResetRequirement` экономно, так как это может привести к непредвиденному несогласованности данных, которые не будут обнаружены легко.

## <a name="next-steps"></a>Дальнейшие действия

Добавочное дополнение — это мощная функция, которая расширяет отслеживание изменений до навыков и искусственного интеллекта. По мере развития навыков, добавочное дополнение обеспечивает минимальную возможную работу, сохраняя при этом документы для согласованности в конечном итоге.

Начните с добавления кэша к существующему индексатору или добавьте кэш при определении нового индексатора.

> [!div class="nextstepaction"]
> [Настройка кэширования для добавочного дополнения](search-howto-incremental-index.md)
