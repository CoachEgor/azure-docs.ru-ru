---
title: Инкрементное обогащение (предварительный просмотр)
titleSuffix: Azure Cognitive Search
description: Промежуточное содержимое кэша и постепенные изменения от конвейера обогащения ИИ в Azure Storage для сохранения инвестиций в существующие обработанные документы. Эта функция сейчас доступна в виде общедоступной предварительной версии.
manager: nitinme
author: Vkurpad
ms.author: vikurpad
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 01/09/2020
ms.openlocfilehash: 09003c26ead9108d07ae339fcf64235c246474a4
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "77024149"
---
# <a name="introduction-to-incremental-enrichment-and-caching-in-azure-cognitive-search"></a>Введение в инкрементное обогащение и кэширование в Azure Cognitive Search

> [!IMPORTANT] 
> Инкрементное обогащение в настоящее время находится в публичном предварительном просмотре. Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/). Эта функция предоставляется в [версии REST API 2019-05-06-Preview](search-api-preview.md). В настоящее время нет портала или поддержки .NET SDK.

Инкрементное обогащение добавляет кэширование и состояние конвейера обогащения, сохраняя ваши инвестиции в существующий объем производства, изменяя при этом только те документы, на которые влияет конкретная модификация. Это не только сохраняет ваши денежные инвестиции в обработку (в частности, OCR и обработки изображений), но это также делает для более эффективной системы. При кэшировании структур и содержимого индексер может определить, какие навыки изменились, и запустить только те, которые были изменены, а также любые навыки зависимых ниже по течению. 

## <a name="indexer-cache"></a>Кэш индексатора

Инкрементное обогащение добавляет кэш в конвейер обогащения. Индексер кэширует результаты взлома документов плюс выходы каждого навыка для каждого документа. При обновлении набора знаний повторно запускаются только измененные навыки и те, которые выполняются после них. Обновленные результаты записываются в кэш, и документ обновляется в индексе поиска или хранилище знаний.

Физически кэш хранится в контейнере с каплями в учетной записи хранения Azure. Кэш также использует хранилище таблиц для внутренней записи обновлений обработки. Все индексы в службе поиска могут использовать для кэша индексатора одну учетную запись хранения. Каждому индексатору присваивается уникальный и неизменяемый идентификатор кэша в используемом контейнере.

## <a name="cache-configuration"></a>Конфигурация кэша

Вам нужно будет установить `cache` свойство на индексаторе, чтобы начать получать выгоду от постепенного обогащения. Следующий пример иллюстрирует индексер с включенным кэшированием. Конкретные части этой конфигурации описаны в следующих разделах. Для получения дополнительной информации [см.](search-howto-incremental-index.md)

```json
{
    "name": "myIndexerName",
    "targetIndexName": "myIndex",
    "dataSourceName": "myDatasource",
    "skillsetName": "mySkillset",
    "cache" : {
        "storageConnectionString" : "Your storage account connection string",
        "enableReprocessing": true
    },
    "fieldMappings" : [],
    "outputFieldMappings": [],
    "parameters": []
}
```

Установка этого свойства на существующем индексаторе потребует сброса и повторного запуска индекса, что приведет к повторной обработке всех документов в исходном доме данных. Этот шаг необходим для устранения любых документов, обогащенных предыдущими версиями набора навыков. 

## <a name="cache-management"></a>Управление кэшем

Жизненным циклом кэша управляет индексатор. Если `cache` свойство индексатера сведено на нет или строка соединения изменена, существующий кэш удаляется при следующем запуске индекса. Кроме того, жизненный цикл кэша привязан к жизненному циклу индексатора. При удалении индексатора удаляется и связанный с ним кэш.

В то время как инкрементное обогащение предназначено для обнаружения и реагирования на изменения без вмешательства с вашей стороны, есть параметры, которые можно использовать для переопределения поведения по умолчанию:

+ Приоритетность новых документов
+ Проверка навыков обхода
+ Проверка источника данных обхода
+ Оценка силовых навыков

### <a name="prioritize-new-documents"></a>Приоритетность новых документов

Установите `enableReprocessing` свойство для контроля за обработкой входящих документов, уже представленных в кэше. При `true` (по умолчанию) документы, уже наемные в кэше, перерабатываются при повторном запуске индекса, предполагая, что обновление навыков влияет на этот документ. 

Когда `false`существующие документы не перерабатываются, эффективно отоделяя приоритеты нового входящего содержимого по сравнению с существующим контентом. Вы должны `enableReprocessing` установить только `false` на временной основе. Для обеспечения согласованности по `enableReprocessing` всему `true` корпусу, должно быть большую часть времени, гарантируя, что все документы, как новые, так и существующие, действительны в соответствии с текущим определением набора навыков.

### <a name="bypass-skillset-evaluation"></a>Объездная оценка навыков

Изменение набора навыков и переработка этого набора навыков обычно идут рука об руку. Однако некоторые изменения в наборе навыков не должны приводить к переработке (например, развертывание пользовательского навыка в новом месте или с новым ключом доступа). Скорее всего, это периферийные модификации, которые не оказывают подлинного влияния на содержание самого навыка. 

Если вы знаете, что изменение набора навыков действительно поверхностно, следует `disableCacheReprocessingChangeDetection` переопределить `true`оценку набора навыков, установив параметр для:

1. Позвоните в обновление Skillset и измените определение набора навыков.
1. Придатите `disableCacheReprocessingChangeDetection=true` параметр к запросу.
1. Отправить изменение.

Установка этого параметра гарантирует, что будут зафиксированы только обновления определения набора навыков и изменение не оценивается для воздействия на существующий корпус.

В следующем примере показан запрос Обновления Skillset с параметром:

```http
PUT https://customerdemos.search.windows.net/skillsets/callcenter-text-skillset?api-version=2019-05-06-Preview&disableCacheReprocessingChangeDetection=true
```

### <a name="bypass-data-source-validation-checks"></a>Проверка источника проверки источников данных обхода

Большинство изменений в определении источника данных аннулируют кэш. Однако в случаях, когда вы знаете, что изменение не должно аннулировать кэш, например изменение строки`ignoreResetRequirement` соединения или вращение ключа в учетной записи хранилища, придатите параметр к обновлению источника данных. Установка этого `true` параметра позволяет коммитюлю пройти, не запуская условие сброса, что приведет к восстановлению и заселению всех объектов с нуля.

```http
PUT https://customerdemos.search.windows.net/datasources/callcenter-ds?api-version=2019-05-06-Preview&ignoreResetRequirement=true
```

### <a name="force-skillset-evaluation"></a>Оценка силовых навыков

Цель кэша состоит в том, чтобы избежать ненужной обработки, но предположим, что вы внесете изменения в навык, который не обнаруживает индексатор (например, что-то меняется во внешнем коде, например, пользовательский навык).

В этом случае можно использовать [навыки смазания,](https://docs.microsoft.com/rest/api/searchservice/2019-05-06-preview/reset-skills) чтобы заставить перерабатывать определенный навык, включая любые навыки вниз по течению, которые зависят от вывода этого навыка. Этот API принимает запрос POST со списком навыков, которые должны быть признаны недействительными и помечены для переработки. После сбросить навыки запустите индексер для ввода конвейера.

## <a name="change-detection"></a>Обнаружение изменений

После включения кэша индексер оценивает изменения в составе конвейера, чтобы определить, какое содержимое можно использовать повторно, а какое - переработку. В этом разделе перечислены изменения, которые аннулируют кэш сразу, а затем изменения, которые вызывают постепенную обработку. 

### <a name="changes-that-invalidate-the-cache"></a>Изменения, которые аннулируют кэш

К таким изменениям относятся такие действия, после которых весь кэш становится недействительным. Например, приводящим к недействительности изменением является обновление источника данных. Вот полный список изменений, которые делают кэш недействительным:

* изменение типа внешнего источника данных;
* изменение контейнера источника данных;
* учетные данные источника данных;
* политика обнаружения изменений в источнике данных;
* политика обнаружения удалений в источнике данных;
* сопоставления полей индексатора;
* Параметры индексатора
    * режим анализа;
    * исключаемые расширения имен файлов;
    * индексируемые расширения имен файлов;
    * индексация метаданных хранилища только для очень больших документов;
    * заголовки текста с разделителями;
    * разделители текста с разделителями;
    * корневой каталог документов;
    * действие с изображением (изменения в способе извлечения изображений).

### <a name="changes-that-trigger-incremental-processing"></a>Изменения, вызывающие постепенную обработку

Инкрементная обработка оценивает определение набора навыков и определяет, какие навыки следует перезапустить, выборочно обновляя затронутые части дерева документа. Вот полный список изменений, приводящих к постепенному обогащению:

* другой тип навыка в наборе навыков; изменение типа OData для навыка;
* обновление параметров конкретного навыка, например его URL-адреса, значений по умолчанию или других параметров;
* изменение выходных данных навыков, в том числе их наличие дополнительных или других выходных данных;
* изменения в навыках, изменяющие их родственные отношения и цепочки зависимостей, например: входные данные навыков
* недействительность любого навыка на уровне выше, если он предоставляет входные данные для этого навыка;
* изменение расположения для проекции хранилища знаний, которое приводит к повторному проецированию документов;
* изменение проекций хранилища знаний, которое приводит к повторному проецированию документов;
* изменение сопоставления выходных полей в индексаторе, которое приводит к повторному проецированию документов в индекс.

## <a name="api-reference"></a>Справочник по интерфейсам API

Версия `2019-05-06-Preview` REST API обеспечивает дополнительное обогащение за счет дополнительных свойств индексов, навыков и источников данных. В дополнение к справочной документации см. [Кэширование настройки для дополнительного обогащения](search-howto-incremental-index.md) для получения подробной информации о том, как позвонить в AA.

+ [Создать индексер (api-версия-2019-05-06-Preview)](https://docs.microsoft.com/rest/api/searchservice/2019-05-06-preview/create-indexer) 

+ [Индексный индекс обновления (апи-версия-2019-05-06-Preview)](https://docs.microsoft.com/rest/api/searchservice/2019-05-06-preview/update-indexer) 

+ [Обновление Skillset (api-версия-2019-05-06-Preview)](https://docs.microsoft.com/rest/api/searchservice/2019-05-06-preview/update-skillset) (Новый параметр URI по запросу)

+ [Reset Skills (api-version=2019-05-06-Preview)](https://docs.microsoft.com/rest/api/searchservice/2019-05-06-preview/reset-skills)

+ Индексы баз данных (Azure S'L, Космос DB). Некоторые индексы извлекают данные с помощью запросов. Для запросов, которые извлекают данные, [Источник данных обновления](https://docs.microsoft.com/rest/api/searchservice/update-data-source) поддерживает новый параметр на **запросе ignoreResetRequirement,** который должен быть установлен, `true` когда действие обновления не должно аннулировать кэш. 

  Используйте **ignoreResetRequirement** экономно, так как это может привести к непреднамеренной несогласованности в данных, которые не будут легко обнаружены.

## <a name="next-steps"></a>Дальнейшие действия

Инкрементное обогащение является мощной особенностью, которая расширяет отслеживание изменений на skillsets и обогащение ИИ. AIncremental обогащение позволяет повторно использовать существующий обработанный контент, как вы итерации над skillset дизайн.

В качестве следующего шага включите кэширование на существующем индексаторе или добавьте кэш при определении нового индекса.

> [!div class="nextstepaction"]
> [Настройка кэширования для инкрементного обогащения](search-howto-incremental-index.md)
