---
title: Добавочное обогащение (Предварительная версия)
titleSuffix: Azure Cognitive Search
description: Кэшировать промежуточное содержимое и добавочные изменения из конвейера обогащения искусственного интеллекта в службе хранилища Azure для сохранения инвестиций в существующие обработанные документы. Эта функция сейчас доступна в виде общедоступной предварительной версии.
manager: nitinme
author: Vkurpad
ms.author: vikurpad
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 01/09/2020
ms.openlocfilehash: f0e7c3bbbdcd1edad24422163fde38e3fdce7e27
ms.sourcegitcommit: 4f6a7a2572723b0405a21fea0894d34f9d5b8e12
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/04/2020
ms.locfileid: "76988657"
---
# <a name="introduction-to-incremental-enrichment-and-caching-in-azure-cognitive-search"></a>Общие сведения о добавочном обогащении и кэшировании в Azure Когнитивный поиск

> [!IMPORTANT] 
> Добавочное углубление в настоящее время находится в общедоступной предварительной версии. Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/). Эта функция предоставляется в [версии REST API 2019-05-06-Preview](search-api-preview.md). В настоящее время отсутствует поддержка портала или пакета SDK для .NET.

Добавочное дополнение добавляет кэширование и пользуясь в конвейер обогащения, сохраняя инвестиции в существующие выходные данные, изменяя только те документы, на которые влияет определенное изменение. Это не только позволяет сохранить денежные инвестиции в обработку (в частности, распознавание текста и обработки изображений), но также делает систему более эффективной. При кэшировании структур и содержимого индексатор может определить, какие навыки были изменены, и выполнить только те из них, которые были изменены, а также все нисходящие зависимые навыки. 

## <a name="indexer-cache"></a>Кэш индексатора

При добавочном обогащении добавляется кэш в конвейер обогащения. Индексатор кэширует результаты взлома документа, а также выходные данные каждого навыка для каждого документа. При обновлении набора знаний повторно запускаются только измененные навыки и те, которые выполняются после них. Обновленные результаты записываются в кэш, а документ обновляется в индексе поиска или в хранилище знаний.

Физически кэш хранится в контейнере больших двоичных объектов в вашей учетной записи хранения Azure. Все индексы в службе поиска могут использовать для кэша индексатора одну учетную запись хранения. Каждому индексатору назначается уникальный и неизменяемый идентификатор кэша для контейнера, который он использует.

## <a name="cache-configuration"></a>Конфигурация кэша

Необходимо задать свойство `cache` в индексаторе, чтобы запустить выигрыша из добавочного уточнения. В следующем примере показан индексатор с включенным кэшированием. Конкретные части этой конфигурации описаны в следующих разделах. Дополнительные сведения см. в разделе [Настройка добавочного обогащения](search-howto-incremental-index.md).

```json
{
    "name": "myIndexerName",
    "targetIndexName": "myIndex",
    "dataSourceName": "myDatasource",
    "skillsetName": "mySkillset",
    "cache" : {
        "storageConnectionString" : "Your storage account connection string",
        "enableReprocessing": true
    },
    "fieldMappings" : [],
    "outputFieldMappings": [],
    "parameters": []
}
```

Если установить это свойство для существующего индексатора, потребуется сбросить и повторно запустить индексатор, что приведет к повторной обработке всех документов в источнике данных. Этот шаг необходим для удаления документов, дополненных предыдущими версиями набора навыков. 

## <a name="cache-management"></a>Управление кэшем

Жизненным циклом кэша управляет индексатор. Если для свойства `cache` индексатора задано значение null или строка подключения изменена, существующий кэш удаляется при следующем запуске индексатора. Кроме того, жизненный цикл кэша привязан к жизненному циклу индексатора. При удалении индексатора удаляется и связанный с ним кэш.

Хотя поэтапное углубление предназначено для обнаружения изменений и реагирования на них без вмешательства пользователя, существуют параметры, которые можно использовать для переопределения поведения по умолчанию.

+ Определение приоритетов для новых документов
+ Обход проверок набора навыков
+ Обход проверок источников данных
+ Принудительная Оценка набора навыков

### <a name="prioritize-new-documents"></a>Определение приоритетов для новых документов

Задайте свойство `enableReprocessing`, чтобы управлять обработкой входящих документов, уже представленных в кэше. При `true` (по умолчанию) документы, которые уже находятся в кэше, повторно обрабатываются при перезапуске индексатора при условии, что обновление навыка влияет на этот документ. 

При `false`существующие документы не обрабатываются повторно, что позволяет эффективно определять приоритет нового входящего содержимого поверх существующего содержимого. `enableReprocessing` следует устанавливать на временной основе только для `false`. Чтобы обеспечить согласованность в совокупности, `enableReprocessing` следует `true` большую часть времени, гарантируя, что все документы, как новые, так и существующие, действительны в соответствии с текущим определением набора навыков.

### <a name="bypass-skillset-evaluation"></a>Обход оценки набора навыков

Изменение набора навыков и повторная обработка этого набора навыков обычно направляются вручную. Однако некоторые изменения в наборе навыков не должны приводить к повторной обработке (например, развертыванию пользовательского навыка в новом месте или с помощью нового ключа доступа). Скорее всего, это периферийные изменения, не подлинность которых повлияла на вещество самого набора навыков. 

Если известно, что изменение набора навыков действительно является ненужным, следует переопределить оценку набора навыков, задав для параметра `disableCacheReprocessingChangeDetection` значение `true`.

1. Вызовите Update квалификационный набор и измените определение набора навыков.
1. Добавьте в запрос параметр `disableCacheReprocessingChangeDetection=true`.
1. Отправьте изменение.

Установка этого параметра гарантирует, что зафиксированы только обновления определения набора навыков, и изменение не будет оцениваться на наличие изменений в существующем совокупности.

В следующем примере показан запрос на обновление набора квалификационных навыков с помощью параметра:

```http
PUT https://customerdemos.search.windows.net/skillsets/callcenter-text-skillset?api-version=2019-05-06-Preview&disableCacheReprocessingChangeDetection=true
```

### <a name="bypass-data-source-validation-checks"></a>Обход проверки источника данных

Большинство изменений в определении источника данных сделает кэш недействительным. Однако в случаях, когда известно, что изменение не должно сделать кэш недействительным, например изменение строки подключения или вращение ключа в учетной записи хранения, добавьте параметр`ignoreResetRequirement` в обновление источника данных. Присвоение этому параметру значения `true` позволяет выполнить фиксацию, не запуская условие сброса, которое приведет к перестроению всех объектов и заполнению с нуля.

```http
PUT https://customerdemos.search.windows.net/datasources/callcenter-ds?api-version=2019-05-06-Preview&ignoreResetRequirement=true
```

### <a name="force-skillset-evaluation"></a>Принудительная Оценка набора навыков

Целью кэша является избежание ненужной обработки, но предположим, что вы вносите изменения в навык, который не обнаруживает индексатор (например, изменение какого-либо внешнего кода, например пользовательского навыка).

В этом случае можно использовать [Сброс навыков](https://docs.microsoft.com/rest/api/searchservice/2019-05-06-preview/reset-skills) для принудительной повторной обработки определенного навыка, включая все нисходящие навыки, зависящие от выходных данных этого навыка. Этот API принимает запрос POST со списком навыков, которые должны быть аннулированы и помечены для повторной обработки. После сброса навыков запустите индексатор, чтобы вызвать конвейер.

## <a name="change-detection"></a>Обнаружение изменений

После включения кэша индексатор оценивает изменения в компоновке конвейера, чтобы определить, какое содержимое можно повторно использовать и что требуется выполнить повторную обработку. В этом разделе перечисляются изменения, которые делают кэш недействительным, за которыми следуют изменения, которые инициируют добавочную обработку. 

### <a name="changes-that-invalidate-the-cache"></a>Изменения, которые делают кэш недействительным

К таким изменениям относятся такие действия, после которых весь кэш становится недействительным. Например, приводящим к недействительности изменением является обновление источника данных. Вот полный список изменений, которые делают кэш недействительным:

* изменение типа внешнего источника данных;
* изменение контейнера источника данных;
* учетные данные источника данных;
* политика обнаружения изменений в источнике данных;
* политика обнаружения удалений в источнике данных;
* сопоставления полей индексатора;
* Параметры индексатора
    * режим анализа;
    * исключаемые расширения имен файлов;
    * индексируемые расширения имен файлов;
    * индексация метаданных хранилища только для очень больших документов;
    * заголовки текста с разделителями;
    * разделители текста с разделителями;
    * корневой каталог документов;
    * действие с изображением (изменения в способе извлечения изображений).

### <a name="changes-that-trigger-incremental-processing"></a>Изменения, вызывающие добавочную обработку

Добавочная обработка оценивает определение набора навыков и определяет, какие навыки следует повторно запустить, выборочно обновив затронутые части дерева документов. Ниже приведен полный список изменений, которые в результате добавочного уточнения:

* другой тип навыка в наборе навыков; изменение типа OData для навыка;
* обновление параметров конкретного навыка, например его URL-адреса, значений по умолчанию или других параметров;
* изменение выходных данных навыков, в том числе их наличие дополнительных или других выходных данных;
* изменения в навыках, изменяющие их родственные отношения и цепочки зависимостей, например: входные данные навыков
* недействительность любого навыка на уровне выше, если он предоставляет входные данные для этого навыка;
* изменение расположения для проекции хранилища знаний, которое приводит к повторному проецированию документов;
* изменение проекций хранилища знаний, которое приводит к повторному проецированию документов;
* изменение сопоставления выходных полей в индексаторе, которое приводит к повторному проецированию документов в индекс.

## <a name="api-reference"></a>Справочные материалы по API

REST API версии `2019-05-06-Preview` обеспечивает добавочное дополнение посредством дополнительных свойств индексаторов, навыков и источников данных. В дополнение к справочной документации см. раздел [Настройка кэширования для добавочного уточнения](search-howto-incremental-index.md) для получения дополнительных сведений о вызове API.

+ [Создание индексатора (API-Version = 2019 – 05 -06-Preview)](https://docs.microsoft.com/rest/api/searchservice/2019-05-06-preview/create-indexer) 

+ [Индексатор обновления (API-Version = 2019 – 05 -06-Preview)](https://docs.microsoft.com/rest/api/searchservice/2019-05-06-preview/update-indexer) 

+ [Обновление набора навыков (API-Version = 2019-05 -06-Preview)](https://docs.microsoft.com/rest/api/searchservice/2019-05-06-preview/update-skillset) (новый параметр URI в запросе)

+ [Сброс навыков (API-Version = 2019 – 05 -06-Preview)](https://docs.microsoft.com/rest/api/searchservice/2019-05-06-preview/reset-skills)

+ Индексаторы базы данных (SQL Azure, Cosmos DB). Некоторые Индексаторы получают данные через запросы. Для запросов, извлекающих данные, [Обновление источника данных](https://docs.microsoft.com/rest/api/searchservice/update-data-source) поддерживает новый параметр в запросе **игнорересетрекуиремент**, который должен быть установлен в `true`, если действие обновления не должно сделать кэш недействительным. 

  Используйте **игнорересетрекуиремент** экономно, так как это может привести к непредвиденному несогласованности данных, которые не будут обнаружены легко.

## <a name="next-steps"></a>Дальнейшие действия

Добавочное дополнение — это мощная функция, которая расширяет отслеживание изменений до навыков и искусственного интеллекта. Аинкрементал обогащение позволяет повторно использовать существующее обработанное содержимое при переборе проекта набора навыков.

В качестве следующего шага включите кэширование для существующего индексатора или добавьте кэш при определении нового индексатора.

> [!div class="nextstepaction"]
> [Настройка кэширования для добавочного дополнения](search-howto-incremental-index.md)
