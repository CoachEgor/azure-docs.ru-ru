---
title: Обновление до пакета SDK .NET для поиска Azure версии 10
titleSuffix: Azure Cognitive Search
description: Перенесите код в пакет SDK .NET для службы поиска Azure версии 10 из старых версий. Сведения о новых возможностях и необходимых изменениях кода.
manager: nitinme
author: arv100kri
ms.author: arjagann
ms.service: cognitive-search
ms.devlang: dotnet
ms.topic: conceptual
ms.date: 11/04/2019
ms.openlocfilehash: 4a8550a7f9c6a684a172da6f384039c6050797f6
ms.sourcegitcommit: b050c7e5133badd131e46cab144dd5860ae8a98e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/23/2019
ms.locfileid: "72793051"
---
# <a name="upgrade-to-azure-search-net-sdk-version-10"></a>Обновление до пакета SDK .NET для поиска Azure версии 10

Если вы используете [пакет SDK для .NET для службы поиска Azure](https://aka.ms/search-sdk)версии 9,0 или более поздней, эта статья поможет вам обновить приложение для использования версии 10.

Более общее пошаговое руководство по пакету SDK, включая примеры, см. в разделе [Использование службы поиска Azure в приложении .NET](search-howto-dotnet-sdk.md).

Версия 10 добавляет несколько функций и исправления ошибок, применяя их к тому же функциональному уровню, что и самый последний выпуск REST API версии `2019-05-06`. В случаях, когда изменение нарушает существующий код, мы рассмотрим [шаги, необходимые для решения проблемы](#UpgradeSteps).

> [!NOTE]
> Если вы используете версию 8,0-Preview или более раннюю версию, сначала необходимо выполнить обновление до версии 9, а затем выполнить обновление до версии 10. Инструкции см. в разделе [обновление до пакета SDK .NET для службы поиска Azure версии 9](search-dotnet-sdk-migration-version-9.md) .
>
> Экземпляр службы поиска Azure поддерживает несколько версий REST API, включая последнюю. Можно продолжать использовать версию, которая больше не является последней, но рекомендуется выполнить перенос кода, чтобы использовать последнюю версию. При использовании REST API необходимо указывать версию API в каждом запросе с помощью параметра api-version. При использовании пакета SDK для .NET версия пакета SDK, которую вы используете, определяет соответствующую версию REST API. Если вы используете устаревшую версию пакета SDK, можно продолжать выполнять этот код без изменений, даже если служба обновлена для поддержки более новой версии API.

<a name="WhatsNew"></a>

## <a name="whats-new-in-version-10"></a>Новые возможности версии 10
Версия 10 пакета SDK .NET для поиска Azure предназначена для последней общедоступной версии REST API поиска Azure (`2019-05-06`) с этими обновлениями:

* Появление двух новых навыков — [условного](cognitive-search-skill-conditional.md) навыка и [навыков перевода текста](cognitive-search-skill-text-translation.md).
* Для обеспечения консолидации из вложенных контекстов в качестве входных данных по [навыкам фигуры](cognitive-search-skill-shaper.md) были внесены реструктуризации. Дополнительные сведения см. в этом [примере определения JSON](https://docs.microsoft.com/azure/search/cognitive-search-skill-shaper#scenario-3-input-consolidation-from-nested-contexts).
* Добавление двух новых [функций сопоставления полей](search-indexer-field-mappings.md):
    - [urlEncode](https://docs.microsoft.com/azure/search/search-indexer-field-mappings#urlencode-function)
    - [урлдекоде](https://docs.microsoft.com/azure/search/search-indexer-field-mappings#urldecode-function)
* В некоторых случаях ошибки и предупреждения, отображаемые в [состоянии выполнения индексатора](https://docs.microsoft.com/rest/api/searchservice/get-indexer-status) , могут содержать дополнительные сведения, помогающие при отладке. `IndexerExecutionResult` был обновлен для отражения этого поведения.
* Отдельные уровни опыта, определенные в наборе [навыков](cognitive-search-defining-skillset.md) , при необходимости можно определить, указав свойство `name`.
* `ServiceLimits` показывает ограничения для [сложных типов](https://docs.microsoft.com/azure/search/search-howto-complex-data-types) и `IndexerExecutionInfo` показывает соответствующие ограничения и квоты индексатора.

<a name="UpgradeSteps"></a>

## <a name="steps-to-upgrade"></a>Действия по обновлению

1. Обновите ссылку NuGet для `Microsoft.Azure.Search` с помощью консоли диспетчера пакетов NuGet или щелкните правой кнопкой мыши ссылки на проект и выберите "Управление пакетами NuGet...". в Visual Studio.

2. После того как NuGet загрузит новые пакеты и их зависимости, перестройте проект. 

3. В случае сбоя сборки необходимо исправить все ошибки сборки. Дополнительные сведения о том, как устранить каждую возможную ошибку сборки, см. в разделе [критические изменения в версии 10](#ListOfChanges) .

4. После устранения предупреждений и ошибок сборки при необходимости можно внести изменения в приложение, чтобы воспользоваться преимуществами новых функциональных возможностей. Новые возможности в пакете SDK подробно описаны в новых возможностях [версии 10](#WhatsNew).

<a name="ListOfChanges"></a>

## <a name="breaking-changes-in-version-10"></a>Критические изменения в версии 10

В версии 10 имеется несколько критических изменений, которые могут потребовать изменения кода в дополнение к перестроению приложения.

> [!NOTE]
> Список изменений ниже не является исчерпывающим. Некоторые изменения, скорее всего, не приведут к ошибкам сборки, но технически нарушаются, так как они нарушают двоичную совместимость со сборками, зависящими от предыдущих версий сборок пакета SDK .NET для службы поиска Azure. Важные изменения, которые попадают в эту категорию, также перечислены вместе с рекомендациями. Перестройте приложение при обновлении до версии 10, чтобы избежать проблем с совместимостью двоичных файлов.

### <a name="custom-web-api-skill-definition"></a>Определение навыка настраиваемого веб-API

Определение [настраиваемого навыка веб-API](cognitive-search-custom-skill-web-api.md) было неправильно указано в версии 9 и более старых. 

Модель для `WebApiSkill` задается `HttpHeaders` как свойство объекта, _содержащее_ словарь. Создание набора навыков с `WebApiSkill`, созданным таким образом, приведет к возникновению исключения, поскольку REST API считать, что запрос неверно сформирован. Эта проблема исправлена, так как `HttpHeaders` **свойство словаря верхнего уровня** в самой модели `WebApiSkill`, которое считается допустимым запросом из REST API.

Например, если ранее была предпринята попытка создания экземпляра `WebApiSkill` следующим образом:

```csharp

var webApiSkill = new WebApiSkill(
            inputs, 
            outputs,
            uri: "https://contoso.example.org")
{
    HttpHeaders = new WebApiHttpHeaders()
    {
        Headers = new Dictionary<string, string>()
        {
            ["header"] = "value"
        }
    }
};

```

Измените его следующим образом, чтобы избежать ошибки проверки REST API:

```csharp

var webApiSkill = new WebApiSkill(
            inputs, 
            outputs,
            uri: "https://contoso.example.org")
{
    HttpHeaders = new Dictionary<string, string>()
    {
        ["header"] = "value"
    }
};

```

## <a name="shaper-skill-allows-nested-context-consolidation"></a>Уровень навыка "Фигура" допускает консолидацию вложенного контекста

Теперь у формы "навык" можно разрешить консолидацию входных данных из вложенных контекстов. Чтобы включить это изменение, мы изменили `InputFieldMappingEntry`, чтобы можно было создать экземпляр, указав только свойство `Source` или свойства `SourceContext` и `Inputs`.

Вам, скорее всего, не потребуется вносить изменения в код. Однако обратите внимание, что допускается только одно из этих двух сочетаний. Это означает следующее:

- Создание `InputFieldMappingEntry`, где инициализировано только `Source`, является допустимым.
- Создание `InputFieldMappingEntry`, где инициализированы только `SourceContext` и `Inputs`, являются допустимыми.
- Все остальные сочетания, включающие эти три свойства, недопустимы.

Если вы решили приступить к использованию этой новой возможности, перед развертыванием этого изменения убедитесь, что все клиенты обновлены для использования версии 10. В противном случае существует вероятность того, что обновление клиента (с использованием более старой версии пакета SDK) на уровень навыка может привести к ошибкам проверки.

> [!NOTE]
> Несмотря на то, что базовая модель `InputFieldMappingEntry` была изменена, чтобы обеспечить консолидацию из вложенных контекстов, она используется только в пределах определения навыка для фигуры. Использование этой возможности в других навыках во время компиляции приводит к ошибке проверки в среде выполнения.

## <a name="skills-can-be-identified-by-a-name"></a>Навыки можно идентифицировать по имени

Каждый навык в наборе навыков теперь имеет новое свойство `Name`, которое можно инициализировать в коде, чтобы помочь определить навык. Это необязательный параметр — если не задано (по умолчанию, если не было сделано явного изменения кода), ему присваивается имя по умолчанию с использованием индекса уровня опыта в наборе, который начинается с символа "#". Например, в следующем определении набора навыков (большинство инициализаций пропускаются для краткости):

```csharp
var skillset = new Skillset()
{
    Skills = new List<Skill>()
    {
        new SentimentSkill(),
        new WebApiSkill(),
        new ShaperSkill(),
        ...
    }
}
```

`SentimentSkill` присваивается имя `#1`, `WebApiSkill` назначается `#2`, `ShaperSkill` назначается `#3` и т. д.

Если вы решили определить навыки по пользовательскому имени, сначала обновите все экземпляры клиентов до версии 10 пакета SDK. В противном случае существует вероятность того, что клиент, использующий более старую версию пакета SDK, может `null` свойство `Name` навыка, что приведет к тому, что клиент вернется к схеме именования по умолчанию.

## <a name="details-about-errors-and-warnings"></a>Сведения об ошибках и предупреждениях

модели `ItemError` и `ItemWarning`, инкапсулирующие подробные сведения об ошибках и предупреждениях (соответственно), возникающие при выполнении индексатора, были изменены с целью включения в процесс отладки индексатора три новых свойства. Эти свойства:

- `Name`: имя источника, в котором возникла ошибка. Например, он может ссылаться на определенный навык в присоединенном наборе навыков.
- `Details`: дополнительные подробные сведения об ошибке или предупреждении.
- `DocumentationLink`: ссылка на руководство по устранению неполадок для конкретной ошибки или предупреждения.

> [!NOTE]
> Мы начали структурировать наши ошибки и предупреждения, чтобы включить эти полезные сведения, когда это возможно. Мы работаем над тем, чтобы для всех ошибок и предупреждений эти сведения присутствовали, но это выполняемая работа, и эти дополнительные сведения не всегда могут быть заполнены.

## <a name="next-steps"></a>Дальнейшие действия

- Изменения, внесенные в навык создания фигуры, имеют наибольшее влияние на новый или существующий код. Чтобы перейти к следующему шагу, перейдите к этому примеру, проиллюстрированной структурой входных данных: [Пример определения формата JSON для подготовки к отметке](cognitive-search-skill-shaper.md)
- Просмотрите [Обзор обогащения искусственного интеллекта](cognitive-search-concept-intro.md).
- Будем рады вашим отзывам о пакете SDK. При возникновении проблем вы можете попросить нас получить помощь по [Stack overflow](https://stackoverflow.com/questions/tagged/azure-search). При обнаружении ошибки можно зарегистрировать проблему в [репозитории GitHub пакета SDK .NET для Azure](https://github.com/Azure/azure-sdk-for-net/issues). Обязательно добавьте в заголовок проблемы префикс "[Azure Когнитивный поиск]".

