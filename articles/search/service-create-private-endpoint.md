---
title: Создание частной конечной точки для безопасного соединения
titleSuffix: Azure Cognitive Search
description: Настройка частной конечной точки в виртуальной сети для безопасного подключения к службе когнитивного поиска Azure
manager: nitinme
author: mrcarter8
ms.author: mcarter
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 01/13/2020
ms.openlocfilehash: 2664b1abd4131cf1dca186c7b044e338bf1efa84
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75945823"
---
# <a name="create-a-private-endpoint-for-a-secure-connection-to-azure-cognitive-search-preview"></a>Создание частной точки предварительного подключения к когнитивному поиску Azure (Предварительный просмотр)

В этой статье используйте портал для создания нового экземпляра службы когнитивного поиска Azure, к которым нельзя получить доступ через общедоступный IP-адрес. Затем настройте виртуальную машину Azure в той же виртуальной сети и используйте ее для доступа к службе поиска через частную конечную точку.

> [!Important]
> Частная конечная точка поддержки Azure Cognitive Search доступна [по запросу](https://aka.ms/SearchPrivateLinkRequestAccess) в качестве предварительного просмотра с ограниченным доступом. Функции предварительного просмотра предоставляются без соглашения об уровне обслуживания и не рекомендуются для производственных нагрузок. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/). 
>
> После того, как вам будет предоставлен доступ к предварительному просмотру, вы сможете настроить частные конечные точки для службы с помощью портала Azure или [версии Management REST API 2019-10-06-Preview.](https://docs.microsoft.com/rest/api/searchmanagement/)
>   

## <a name="why-use-private-endpoint-for-secure-access"></a>Зачем использовать Private Endpoint для безопасного доступа?

[Частные конечные точки](../private-link/private-endpoint-overview.md) для Azure Cognitive Search позволяют клиенту виртуальной сети безопасно получать доступ к данным в поисковом индексе по [частной ссылке.](../private-link/private-link-overview.md) Частная конечная точка использует IP-адрес из [виртуального сетевого адреса для](../virtual-network/virtual-network-ip-addresses-overview-arm.md#private-ip-addresses) службы поиска. Сетевой трафик между клиентом и поисковым сервисом пересекает виртуальную сеть и частную ссылку на магистральной сети Microsoft, исключая воздействие из общедоступного интернета. Для списка других служб PaaS, поддерживающих Частную ссылку, проверьте [раздел доступности](../private-link/private-link-overview.md#availability) в документации продукта.

Частные конечные точки для поисковой службы позволяют:

- Заблокируйте все соединения в общедоступной точке поиска.
- Увеличьте безопасность виртуальной сети, позволяя блокировать эксфильтрацию данных из виртуальной сети.
- Безопасно подключайтесь к поисковой службе из закрытых сетей, которые подключаются к виртуальной сети с помощью [VPN](../vpn-gateway/vpn-gateway-about-vpngateways.md) или [ExpressRoutes](../expressroute/expressroute-locations.md) с помощью частного пиринга.

> [!NOTE]
> В настоящее время в предварительном просмотре есть некоторые ограничения, о которых следует знать:
> * Доступно только для поисковых услуг на **базовом** уровне. 
> * Доступно в Западной части США 2, Западно-Центральном США, Восточной части США, южной части Центральной части США, Австралии Восточной и Австралии юго-восточных регионах.
> * Когда конечная точка службы является частной, некоторые функции портала отключены. Вы сможете просматривать и управлять информацией об уровне обслуживания, но доступ к индексным данным и различным компонентам службы, таким как определения индекса, индекса и наборов навыков, ограничен по соображениям безопасности.
> * Когда конечная точка службы является частной, необходимо использовать [API Поиска REST](https://docs.microsoft.com/rest/api/searchservice/) для загрузки документов в индекс.
> * Необходимо использовать следующую ссылку, чтобы просмотреть частную опцию поддержки конечных точек на портале Azure:https://portal.azure.com/?feature.enablePrivateEndpoints=true



## <a name="request-access"></a>Запрос доступа 

Нажмите [на доступ к запросу,](https://aka.ms/SearchPrivateLinkRequestAccess) чтобы подписаться на эту функцию предварительного просмотра. Форма запрашивает информацию о вас, вашей компании и общей топологии сети. Как только мы просмотрим ваш запрос, вы получите подтверждение электронной почты с дополнительными инструкциями.

## <a name="create-the-virtual-network"></a>Создание виртуальной сети

В этом разделе вы создадите виртуальную сеть и подсеть для размещения VM, которые будут использоваться для доступа к частной конечной точке поисковой службы.

1. Из домашней вкладки портала Azure выберите Создать > **виртуальную сеть** **сетей.** > **Networking**

1. В подменю **Создать виртуальную сеть** введите или выберите следующую информацию:

    | Параметр | Значение |
    | ------- | ----- |
    | name | Введите *MyVirtualNetwork* |
    | Пространство адресов | Введите *10.1.0.0.0/16* |
    | Подписка | Выберите свою подписку.|
    | Группа ресурсов | Выберите **Создать новый,** введите *myResourceGroup*, затем выберите **OK** |
    | Расположение | Выберите **Запад США** или любой регион, который вы используете|
    | Имя подсети | Введите *mySubnet* |
    | Диапазон адреса подсети | Введите *10.1.0.0.0/24* |
    |||

1. Оставьте без изменений значения остальных параметров и выберите **Создать**.


## <a name="create-a-search-service-with-a-private-endpoint"></a>Создание поисковой службы с частной конечной точкой

В этом разделе будет создан новый сервис когнитивного поиска Azure с частной конечной точкой. 

1. На верхней левой стороне экрана на портале Azure выберите **Создать ресурс** > **Web** > **Azure Cognitive Search.**

1. В **новой поисковой службе - Основы**введите или выберите эту информацию:

    | Параметр | Значение |
    | ------- | ----- |
    | **ПРОЕКТ ЛЕТЛЕТ** | |
    | Подписка | Выберите свою подписку. |
    | Группа ресурсов | Выберите **myResourceGroup**. Вы создали ее в предыдущем разделе.|
    | **INSTANCE DETAILS** |  |
    | URL-адрес | Укажите уникальное имя. |
    | Расположение | Выберите область, указанную при запросе доступа к этой функции предварительного просмотра. |
    | Ценовая категория | Выберите **уровень цен изменения** и выберите **Basic**. Этот уровень необходим для предварительного просмотра. |
    |||
  
1. Выберите **далее: Масштаб.**

1. Оставьте значения по умолчанию и выберите **Далее: Сеть**.

1. В **новой поисковой службе - Networking**, выберите **Private** для **подключения конечных точек (данные).**

1. В **новой поисковой службе - Сеть**, выберите и **добавить** под **private конечную точку**. 

1. В **создайте частную конечную точку,** введите или выберите эту информацию:

    | Параметр | Значение |
    | ------- | ----- |
    | Подписка | Выберите свою подписку. |
    | Группа ресурсов | Выберите **myResourceGroup**. Вы создали ее в предыдущем разделе.|
    | Расположение | Выберите **Западная часть США**.|
    | name | Введите *myPrivateEndpoint*.  |
    | Целевой подресурс | Оставьте поиск по **умолчаниюServiceа.** |
    | **Сети** |  |
    | Виртуальная сеть  | Выберите *MyVirtualNetwork* из ресурсной группы *myResourceGroup*. |
    | Подсеть | Выберите *mySubnet*. |
    | **ЧАСТНАЯ ИНТЕГРАЦИЯ DNS** |  |
    | Интеграция с частной зоной DNS  | Оставьте значение **Yes**по умолчанию . |
    | Частная зона DNS  | Оставьте по умолчанию (новый) privatelink.search.windows.net. |
    |||

1. Нажмите кнопку **ОК**. 

1. Выберите **Review + create** (Просмотреть и создать). Вы будете перенаправлены на страницу **Просмотр и создание**, где Azure проверит вашу конфигурацию. 

1. При походе пройденое сообщение **«Проверка»** выберите **«Создать».** 

1. После завершения подготовки новой службы просмотрите только что созданный ресурс.

1. Выберите **ключи** из меню левого содержимого.

1. Копируйте **ключ от основного админирования** на более поздний срок при подключении к службе.

## <a name="create-a-virtual-machine"></a>Создание виртуальной машины

1. На верхней левой стороне экрана на портале Azure выберите **Создать ресурс** > **Compute** > **Virtual machine.**

1. В окне **Создание виртуальной машины — Основы** введите или выберите следующую информацию:

    | Параметр | Значение |
    | ------- | ----- |
    | **ПРОЕКТ ЛЕТЛЕТ** | |
    | Подписка | Выберите свою подписку. |
    | Группа ресурсов | Выберите **myResourceGroup**. Вы создали ее в предыдущем разделе.  |
    | **INSTANCE DETAILS** |  |
    | Имя виртуальной машины | Введите *myVm*. |
    | Регион | Выберите **Запад США** или любой регион, который вы используете. |
    | Параметры доступности | Оставьте значение по умолчанию **No infrastructure redundancy required** (Избыточность инфраструктуры не требуется). |
    | Изображение | Выберите **Центр обработки данных Windows Server 2019**. |
    | Размер | Оставьте значение по умолчанию **Standard DS1 v2**. |
    | **Учетная запись АДМИНИСТРАТОРА** |  |
    | Имя пользователя | Введите выбранное имя пользователя. |
    | Пароль | Введите выбранный пароль. Пароль должен включать минимум 12 символов и соответствовать [определенным требованиям к сложности](../virtual-machines/windows/faq.md?toc=%2fazure%2fvirtual-network%2ftoc.json#what-are-the-password-requirements-when-creating-a-vm).|
    | Подтверждение пароля | Введите пароль еще раз. |
    | **ПРАВИЛА ВХОДЯЩИХ ПОРТОВ** |  |
    | Общедоступные входящие порты | Оставьте по умолчанию **Разрешить выбранные порты.** |
    | Выбрать входящие порты | Оставьте RDP по умолчанию **(3389)**. |
    | **Экономия** |  |
    | Already have a Windows license? (У вас уже есть лицензия Windows?) | Оставьте значение по умолчанию **Нет**. |
    |||

1. Выберите **далее: Диски**.

1. В **Создать виртуальную машину - Диски**, оставить по умолчанию и выбрать **Далее: Сеть**.

1. В окне **Создание виртуальной машины — Сети** выберите такую информацию:

    | Параметр | Значение |
    | ------- | ----- |
    | Виртуальная сеть | Оставьте по умолчанию **MyVirtualNetwork**.  |
    | Пространство адресов | Оставьте значение по умолчанию **10.1.0.0/24**.|
    | Подсеть | Оставьте значение по умолчанию **mySubnet (10.1.0.0/24)**.|
    | Общедоступный IP-адрес | Оставьте значение по умолчанию **(new) myVm-ip**. |
    | Общедоступные входящие порты | Выберите **Разрешить выбранные порты**. |
    | Выбрать входящие порты | Выберите **HTTP** и **RDP**.|
    ||

1. Выберите **Review + create** (Просмотреть и создать). Вы будете перенаправлены на страницу **Просмотр и создание**, где Azure проверит вашу конфигурацию.

1. При походе пройденое сообщение **«Проверка»** выберите **«Создать».** 


## <a name="connect-to-the-vm"></a>Подключение к виртуальной машине

Скачать, а затем подключиться к VM *myVm* следующим образом:

1. На портале в строке поиска введите *myVm*.

1. Нажмите кнопку **Подключиться**. После нажатия кнопки **Подключиться** откроется окно **Connect to virtual machine** (Подключение к виртуальной машине).

1. Выберите **Скачать RDP файл**. Azure создаст и скачает на ваш компьютер файл протокола удаленного рабочего стола (*RDP*).

1. Откройте скачанный RDP-файл*.

    1. При появлении запроса выберите **Подключиться**.

    1. Введите имя пользователя и пароль, указанные при создании виртуальной машины.

        > [!NOTE]
        > Возможно, вам придется выбрать **Дополнительные варианты** > **Используйте другую учетную запись,** чтобы указать учетные данные, которые вы ввели при создании VM.

1. Нажмите кнопку **ОК**.

1. При входе в систему может появиться предупреждение о сертификате. В таком случае выберите **Да** или **Продолжить**.

1. Когда появится рабочий стол виртуальной машины, сверните его, чтобы вернуться на локальный рабочий стол.  


## <a name="test-connections"></a>Проверка подключения

В этом разделе вы проверите доступ частной сети к поисковой службе и подключитесь к частной точке спомощьей Private Endpoint.

Напомним из введения, что все взаимодействия с поисковой службой требуют [поиска REST API.](https://docs.microsoft.com/rest/api/searchservice/) Портал и .NET SDK не поддерживаются в этом предварительном просмотре.

1. На удаленном рабочем столе  *myVm* откройте PowerShell.

1. Введите 'nslookup (имя службы поиска).search.windows.net'

    Должно появиться сообщение следующего вида:
    ```azurepowershell
    Server:  UnKnown
    Address:  168.63.129.16
    Non-authoritative answer:
    Name:    [search service name].privatelink.search.windows.net
    Address:  10.0.0.5
    Aliases:  [search service name].search.windows.net
    ```

1. С VM подключитесь к поисковой службе и создайте индекс. Вы можете следить за этим [быстрым запуском,](search-get-started-postman.md) чтобы создать новый индекс поиска в вашем сервисе в Postman с помощью REST API. Настройка запросов от Postman требует конечных точек поисковой службы (https://'поисковое имя службы.search.windows.net) и admin api-key, который вы скопировали на предыдущем этапе.

1. Завершение запуска с VM является вашим подтверждением того, что услуга полностью работает.

1. Закройте удаленное подключение к рабочему столу *на myVM.* 

1. Чтобы убедиться, что ваша служба недоступна в общедоступной точке, откройте Postman на локальной рабочей станции и попытайтесь сделать первые несколько задач в quickstart. Если вы получили ошибку, что удаленный сервер не существует, вы успешно настроили частную конечную точку для службы поиска.

## <a name="clean-up-resources"></a>Очистка ресурсов 
Когда вы закончите использовать Частную конечную точку, службу поиска и VM, удалите группу ресурсов и все ресурсы, которые она содержит:
1. Введите *myResourceGroup* в поле **поиска** в верхней части портала и выберите *myResourceGroup* из результатов поиска. 
1. Выберите **Удалить группу ресурсов**. 
1. Введите *myResourceGroup* для **TYPE RESOURCE GROUP NAME** и выберите **Удалить**.

## <a name="next-steps"></a>Дальнейшие действия
В этой статье вы создали VM в виртуальной сети и поисковый сервис с частной конечной точкой. Вы подключились к VM из интернета и надежно общались в поисковую службу с помощью Private Link. Чтобы узнать больше о частной конечной точке, [см.](../private-link/private-endpoint-overview.md)
