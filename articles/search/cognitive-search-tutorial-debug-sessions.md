---
title: Руководство по использованию сеансов отладки для диагностики, исправления ошибок и фиксации изменений в наборе навыков
titleSuffix: Azure Cognitive Search
description: Сеансы отладки (предварительная версия) предоставляют интерфейс на основе портала для оценки и исправления проблем и ошибок в наборе навыков
author: HeidiSteen
ms.author: heidist
manager: nitinme
ms.service: cognitive-search
ms.topic: tutorial
ms.date: 09/25/2020
ms.openlocfilehash: 8ec39c4616f5a34f8326b56d4f0ba6e15cdad91c
ms.sourcegitcommit: e2dc549424fb2c10fcbb92b499b960677d67a8dd
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/17/2020
ms.locfileid: "94699123"
---
# <a name="tutorial-diagnose-repair-and-commit-changes-to-your-skillset"></a>Руководство по диагностике, исправлению ошибок и фиксации изменений в наборе навыков

В этой статье рассказано как устранить проблемы с предоставленным набором навыков, используя портал Azure для доступа к сеансам отладки. Набор навыков содержит ряд ошибок, которые необходимо устранить. В этом руководстве мы расскажем о том, как выявить и устранить проблемы с входными и выходными значениями навыков с помощью сеанса отладки.

> [!Important]
> Сеансы отладки — это функция в предварительной версии, которая предоставляется без соглашения об уровне обслуживания, поэтому использовать ее в рабочей среде не рекомендуется. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).
>

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="prerequisites"></a>Предварительные требования

> [!div class="checklist"]
> * Подписка Azure. Создайте [бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F) или используйте текущую подписку.
> * Экземпляр службы "Когнитивный поиск Azure"
> * Учетная запись хранения Azure
> * [Классическое приложение Postman](https://www.getpostman.com/)

## <a name="create-services-and-load-data"></a>Создание служб и загрузка данных

Это руководство предполагает использование Когнитивного поиска Azure и службы хранилища Azure.

* [Загрузите пример данных](https://github.com/Azure-Samples/azure-search-sample-data/tree/master/clinical-trials-pdf-19) состоящий из 19 файлов.

* [Создайте учетную запись хранения Azure](../storage/common/storage-account-create.md?tabs=azure-portal) или [найдите имеющуюся учетную запись](https://ms.portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Storage%2storageAccounts/). 

   Выберите регион, в котором размещается Когнитивный поиск Azure, чтобы не оплачивать трафик.
   
   Выберите тип учетной записи StorageV2 (общего назначения версии 2).

* Откройте страницы служб хранилища и создайте контейнер. Рекомендуется указать уровень доступа "частный". Присвойте контейнеру имя `clinicaltrialdataset`.

* В контейнере щелкните **Отправить**, чтобы отправить примеры файлов, скачанных и распакованных на первом шаге.

* [Создайте службу "Когнитивный поиск Azure"](search-create-service-portal.md) или [найдите имеющуюся службу](https://ms.portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Search%2FsearchServices). Вы можете использовать бесплатную службу для выполнения инструкций, описанных в этом кратком руководстве.

## <a name="get-a-key-and-url"></a>Получение ключа и URL-адреса

Вызовам REST требуется URL-адрес службы и ключ доступа при каждом запросе. Служба поиска создана с обоими элементами, поэтому если вы добавили службу "Когнитивный поиск Azure" в подписку, выполните следующие действия для получения необходимых сведений:

1. [Войдите на портал Azure](https://portal.azure.com/) и на странице **обзора** службы поиска получите URL-адрес. Пример конечной точки может выглядеть так: `https://mydemo.search.windows.net`.

1. В разделе **Параметры** > **Ключи** получите ключ администратора, чтобы обрести полные права на службу. Существуют два взаимозаменяемых ключа администратора, предназначенных для обеспечения непрерывности бизнес-процессов на случай, если вам потребуется сменить один из них. Вы можете использовать первичный или вторичный ключ для выполнения запросов на добавление, изменение и удаление объектов.

:::image type="content" source="media/search-get-started-rest/get-url-key.png" alt-text="Получение конечной точки HTTP и ключа доступа" border="false":::

Для выполнения любого запроса к службе требуется использование ключа API. Если есть действительный ключ, для каждого запроса устанавливаются отношения доверия между приложением, которое отправляет запрос, и службой, которая его обрабатывает.

## <a name="create-data-source-skillset-index-and-indexer"></a>Создание источника данных, набора навыков, индекса и индексатора

В этом разделе для создания источника данных, набора навыков, индекса и индексатора службы "Поиск" используются Postman и предоставленная коллекция.

1. Если у вас нет Postman, можно [скачать здесь классическую версию этого приложения](https://www.getpostman.com/).
1. [Скачайте коллекцию Postman для сеансов отладки](https://github.com/Azure-Samples/azure-search-postman-samples/tree/master/Debug-sessions).
1. Запустите Postman.
1. Последовательно выберите **Files** > **New** (Файлы > Создать) и выберите коллекцию для импорта.
1. После импорта коллекции разверните список действий (...).
1. Нажмите кнопку **Изменить**.
1. Введите имя службы поиска searchService (например, если конечная точка — `https://mydemo.search.windows.net`, то именем службы будет `mydemo`).
1. В качестве apiKey укажите первичный или вторичный ключ службы "Поиск".
1. Введите строку подключения к хранилищу storageConnectionString со страницы ключа учетной записи хранения Azure.
1. Введите имя containerName для контейнера, созданного в учетной записи хранения.

> :::image type="content" source="media/cognitive-search-debug/postman-enter-variables.png" alt-text="Изменение переменных в Postman":::

Коллекция содержит четыре разных вызова RESTFUL, которые используются для выполнения инструкций этого раздела.

Первый вызов создает источник данных `clinical-trials-ds`. Второй — набор навыков `clinical-trials-ss`. Третий — индекс `clinical-trials`. Четвертый и последний — индексатор `clinical-trials-idxr`. После выполнения всех вызовов в коллекции закройте Postman и вернитесь на портал Azure.

> :::image type="content" source="media/cognitive-search-debug/postman-create-data-source.png" alt-text="Использование Postman для создания источника данных":::

## <a name="check-the-results"></a>Проверка результатов

Набор навыков содержит несколько распространенных ошибок. На этапе, описанном в этом разделе, выполнение пустого запроса для возврата всех документов приведет к отображению нескольких ошибок. На последующих этапах эти проблемы будут устранены с помощью сеанса отладки.

1. Перейдите к своей службе "Поиск" на портале Azure. 
1. Выберите вкладку **Индексы**. 
1. Выберите индекс `clinical-trials`.
1. Щелкните **Поиск**, чтобы выполнить пустой запрос. 

По завершении поиска в окне будут указаны два поля, не содержащие данных: organizations и locations. Выполните эти действия, чтобы найти все проблемы, вызванные набором навыков.

1. Вернитесь на страницу "Обзор" для службы "Поиск".
1. Выберите вкладку **Индексаторы**. 
1. Щелкните `clinical-trials-idxr` и выберите предупреждения. 

Возникло множество проблем с сопоставлениями полей выходных данных проекции, а на третьей странице есть предупреждения о недопустимости одного или нескольких входных значений навыков.

Вернитесь на экран обзора службы "Поиск".

## <a name="start-your-debug-session"></a>Запуск сеанса отладки

> :::image type="content" source="media/cognitive-search-debug/new-debug-session-screen-required.png" alt-text="Запуск нового сеанса отладки":::

1. Перейдите на вкладку Debug sessions (preview) (Сеансы отладки (предварительная версия)).
1. Выберите +NewDebugSession.
1. Присвойте сеансу имя. 
1. Подключите сеанс к учетной записи хранения. 
1. Укажите имя индексатора. Индексатор содержит ссылки на источник данных, набор навыков и индекс.
1. Примите выбор документа по умолчанию для первого документа в коллекции. 
1. **Сохраните** сеанс. Сохранение сеанса инициирует конвейер обогащения с помощью ИИ, как определено в наборе навыков.

> [!Important]
> Сеанс отладки работает только с одним документом. Если не выбрать конкретный документ в наборе данных, сеанс будет использовать по умолчанию первый документ.

> :::image type="content" source="media/cognitive-search-debug/debug-execution-complete1.png" alt-text="Запущен новый сеанс отладки":::

Когда сеанс отладки завершится, по умолчанию откроется вкладка AI Enrichments (Обогащение ИИ), на которой будет выделен граф навыков.

+ На графе навыков визуально представлена иерархия набора навыков и порядок выполнения сверху вниз. Навыки, расположенные на графе рядом, выполняются параллельно. Цветовая кодировка навыков на графе указывает на типы навыков, выполняемых в наборе навыков. В этом примере обозначенные зеленым цветом навыки — это текст, а обозначенные красным — это концепция. Если щелкнуть отдельный навык на графе, в окне сеанса в области справа отобразятся сведения об этом экземпляре навыка. Параметры навыка, редактор JSON, сведения о выполнении, а также ошибки и предупреждения доступны как для просмотра, так и для редактирования.
+ Расширенная структура данных содержит сведения об узлах дерева обогащения, созданных навыками из содержимого исходного документа.

Список на вкладке "Ошибки и предупреждения" будет значительно короче того, который был показан ранее, так как в нем содержатся только сведения об ошибках для одного документа. Как и в списке, отображаемом индексатором, здесь можно щелкнуть сообщение с предупреждением и просмотреть для него подробные сведения.

## <a name="fix-missing-skill-input-value"></a>Исправление ошибок из-за отсутствия входного значения навыка

На вкладке "Ошибки и предупреждения" указана ошибка для операции, помеченной как `Enrichment.NerSkillV2.#1`. В сведениях об этой ошибке объясняется, что возникла проблема со входным значением навыка "/document/languageCode". 

1. Вернитесь на вкладку AI Enrichments (Обогащение ИИ).
1. Щелкните **Граф навыков**.
1. Щелкните навык, помеченный как № 1, чтобы в области справа для него отобразились подробные сведения.
1. Найдите входное значение для "languageCode".
1. Выберите символ в начале строки **</>** и откройте вычислитель выражений.
1. Нажмите кнопку **Вычислить** и убедитесь, что это выражение приводит к ошибке. Это подтвердит, что свойство "languageCode" не является допустимым входным значением.

> :::image type="content" source="media/cognitive-search-debug/expression-evaluator-language.png" alt-text="Вычислитель выражений":::

Эту ошибку в сеансе можно изучить двумя способами. Первый — посмотреть, откуда поступают входные данные. Какой навык в иерархии предположительно выдает такой результат? На вкладке "Число выполнений" в области сведений о навыках должен отображаться источник входных данных. Если источник отсутствует, это указывает на ошибку сопоставления полей.

1. Перейдите на вкладку **Число выполнений**.
1. Найдите свойство "ВХОДНЫЕ ДАННЫЕ" и "languageCode". Источник для этого входного значения не указан. 
1. В области слева перейдите на вкладку "Обогащенная структура данных". Сопоставленный путь, соответствующий "languageCode", отсутствует.

> :::image type="content" source="media/cognitive-search-debug/enriched-data-structure-language.png" alt-text="Вкладка &quot;Обогащенная структура данных&quot;":::

При этом существует сопоставленный путь для "language". Таким образом, в параметрах навыка допущена опечатка. Чтобы исправить это выражение в навыке № 1, необходимо обновить "/document/language".

1. Откройте вычислитель выражений **</>** для пути "language".
1. Скопируйте выражение. Закройте окно.
1. Перейдите к параметрам навыка № 1 и откройте вычислитель выражений **</>** для входного значения "languageCode".
1. Вставьте новое значение "/document/language" в поле выражение и нажмите кнопку **Вычислить**.
1. Должно отобразиться правильное входное значение "en". Чтобы обновить выражение, нажмите кнопку "Применить".
1. Щелкните **Сохранить** справа. Откроется область сведений о навыках.
1. Щелкните **Выполнить** в меню окна сеанса. Это приведет к другому запуску набора навыков с использованием документа. 

После завершения сеанса отладки перейдите на вкладку "Ошибки и предупреждения" и убедитесь, что ошибка, помеченная как "Enrichment.NerSkillV2.#1", исчезла. Однако остались два предупреждения о том, что служба не может сопоставлять выходные поля для организаций и расположений с индексом поиска. Отсутствуют значения: "/document/merged_content/organizations" и "/document/merged_content/locations".

## <a name="fix-missing-skill-output-values"></a>Исправление ошибок из-за отсутствия выходного значения навыка

> :::image type="content" source="media/cognitive-search-debug/warnings-missing-value-locations-organizations.png" alt-text="Ошибки и предупреждения":::

Для навыка отсутствуют выходные значения. Чтобы определить навык с ошибкой, перейдите на вкладку "Обогащенная структура данных", найдите имя значения и посмотрите на источник его происхождения. При отсутствии значений organizations и locations, данные об организациях и расположениях выводятся из навыка № 1. При открытии вычислителя выражений </> для каждого пути будут, соответственно, отображены выражения указанные в виде "/document/content/organizations" и "/document/content/locations".

> :::image type="content" source="media/cognitive-search-debug/expression-eval-missing-value-locations-organizations.png" alt-text="Сущность organizations в вычислителе выражений":::

Выходные данные для этих сущностей пусты, а так быть не должно. Какие входные данные приводят к такому результату?

1. Перейдите на вкладку **Граф навыков** и выберите навык № 1.
1. Перейдите на вкладку **Число выполнений** в области сведений о навыках справа.
1. Откройте вычислитель выражений **</>** для входного значения "text".

> :::image type="content" source="media/cognitive-search-debug/input-skill-missing-value-locations-organizations.png" alt-text="Входные данные для навыка &quot;текст&quot;":::

Отображаемый результат для этих входных данных не похож на текстовое входное значение. Похоже, что это изображение, окруженное новыми строками. Из-за отсутствия текста сущность идентифицировать невозможно. Если посмотреть на иерархию набора навыков, можно заметить, что содержимое сначала обрабатывается навыком № 6 (OCR), а затем передается в навык № 5 (слияние). 

1. Выберите навык № 5 (слияние) на **графе навыков**.
1. Перейдите на вкладку **Число выполнений** в области сведений о навыках справа и откройте вычислитель выражений **</>** для свойства "ВЫХОДНЫЕ ДАННЫЕ" mergedText.

> :::image type="content" source="media/cognitive-search-debug/merge-output-detail-missing-value-locations-organizations.png" alt-text="Выходные данные для навыка слияния":::

Здесь текст связан с изображением. Если взглянуть на выражение "/document/merged_content", можно заметить ошибку в путях "organizations" и "locations" для навыка № 1. Вместо выражения "/document/content" для входных данных "text" следует использовать "/document/merged_content".

1. Скопируйте выражение для выходных данных "mergedText" и закройте окно вычислителя выражений.
1. Выберите навык № 1 на **графе навыков**.
1. Перейдите на вкладку **Параметры навыков** в области сведений о навыках справа.
1. Откройте вычислитель выражений **</>** для входного значения "text".
1. Вставьте новое выражение в поле. Нажмите кнопку **Вычислить**.
1. Должны отобразиться правильные входные данные с добавленным текстом. Чтобы обновить параметры навыков, нажмите кнопку **Применить**.
1. Щелкните **Сохранить** справа. Откроется область сведений о навыках.
1. Щелкните **Выполнить** в меню окна сеанса. Это приведет к другому запуску набора навыков с использованием документа.

После завершения выполнения индексатора ошибки все еще остались. Вернитесь к навыку № 1 и изучите проблему. Входные данные для навыка были исправлены с "content" на "merged_content". Каковы выходные данные для этих сущностей в навыке?

1. Перейдите на вкладку **AI Enrichments** (Обогащение ИИ).
1. Выберите **Граф навыков** и щелкните навык № 1.
1. Перейдите на вкладку **Параметры навыков**, чтобы найти выходные данные.
1. Откройте вычислитель выражений **</>** для сущности "organizations".

> :::image type="content" source="media/cognitive-search-debug/skill-output-detail-missing-value-locations-organizations.png" alt-text="Выходные данные для сущности &quot;organizations&quot;":::

Вычисление результата выражения даст правильный результат. Навык работает, определяя правильное значение для сущности "organizations". Однако сопоставление выходных данных в пути сущности по-прежнему приводит к ошибке. При сравнении пути к выходным данным в навыке с путем к выходным данным в сообщении об ошибке можно увидеть, что навык устанавливает родительские связи с выходными данными (organizations и locations) в узле /document/content. Однако сопоставление выходных полей предполагает, что результаты должны быть связаны родительской связью в узле /document/merged_content. На предыдущем шаге входные данные изменились с "/document/content" на "/document/merged_content". Чтобы обеспечить создание выходных данных с правильным контекстом, необходимо изменить контекст в параметрах навыка.

1. Перейдите на вкладку **AI Enrichments** (Обогащение ИИ).
1. Выберите **Граф навыков** и щелкните навык № 1.
1. Перейдите на вкладку **Параметры навыков**, чтобы найти контекст.
1. Дважды щелкните параметр "context" и измените его на "/document/merged_content".
1. Щелкните **Сохранить** справа. Откроется область сведений о навыках.
1. Щелкните **Выполнить** в меню окна сеанса. Это приведет к другому запуску набора навыков с использованием документа.

> :::image type="content" source="media/cognitive-search-debug/skill-setting-context-correction-missing-value-locations-organizations.png" alt-text="Исправление контекста в параметрах навыка":::

Все ошибки устранены.

## <a name="commit-changes-to-the-skillset"></a>Фиксация изменений в наборе навыков

При запуске сеанса отладки служба "Поиск" создала копию набора навыков. Это было сделано для того, чтобы внесенные изменения не повлияли на рабочую систему. После завершения отладки набора навыков исправления можно зафиксировать (перезаписав ими исходный набор навыков) в рабочей системе. Если вы хотите продолжить вносить изменения в набор навыков без последствий для рабочей системы, можно сохранить сеанс отладки и открыть его позже.

1. Щелкните **Зафиксировать изменения** в главном меню сеансов отладки.
1. Нажмите кнопку **ОК**, чтобы подтвердить обновление набора навыков.
1. Закройте сеанс отладки и перейдите на вкладку **Индексаторы**.
1. Откройте "clinical-trials-idxr".
1. Выберите **Сбросить**.
1. Нажмите кнопку **Запустить**. Нажмите кнопку **ОК** для подтверждения.

После завершения работы индексатора на вкладке "История выполнений" должна появиться зеленая галочка и слово "Успешно" рядом с меткой времени последнего запуска. Убедитесь, что изменения применены, выполнив следующие действия.

1. Закройте **индексатор** и выберите вкладку **Индекс**.
1. Откройте индекс "clinical-trials" и на вкладке "Проводник поиска" нажмите кнопку **Поиск**.
1. В окне результатов должно быть указано, что сущности organizations и locations теперь заполнены ожидаемыми значениями.

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы работаете в своей подписке, по окончании проекта рекомендуем решить, нужны ли вам созданные ресурсы. Работающие ресурсы могут означать лишние затраты. Можно удалить отдельные ресурсы или удалить группу ресурсов, что позволит удалить весь набор ресурсов.

Просматривать ресурсы и управлять ими можно на портале с помощью ссылок **Все ресурсы** или **Группы ресурсов** на панели навигации слева.

При работе с бесплатной версией службы помните о том, что вам доступно максимум три индекса, индексатора и источника данных. Вы можете удалить отдельные элементы на портале, чтобы не превысить лимит. 

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Узнайте больше о наборах навыков](./cognitive-search-working-with-skillsets.md)
> [Узнайте больше о добавочном обогащении и кэшировании](./cognitive-search-incremental-indexing-conceptual.md)