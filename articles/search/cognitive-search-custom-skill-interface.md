---
title: Определение интерфейса для пользовательских навыков в когнитивном поиске. Поиск Azure
description: Настраиваемый интерфейс извлечения данных для пользовательского навыка веб-API в конвейере когнитивного поиска в службе "Поиск Azure".
manager: pablocas
author: luiscabrer
services: search
ms.service: search
ms.devlang: NA
ms.topic: conceptual
ms.date: 05/02/2019
ms.author: luisca
ms.custom: seodec2018
ms.openlocfilehash: e181aab3d92d8111a0a7d1d41bbddac20687a547
ms.sourcegitcommit: 2e4b99023ecaf2ea3d6d3604da068d04682a8c2d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/09/2019
ms.locfileid: "67668863"
---
# <a name="how-to-add-a-custom-skill-to-a-cognitive-search-pipeline"></a>Добавление пользовательского навыка в конвейер когнитивного поиска

[Конвейер индексирования когнитивного поиска](cognitive-search-concept-intro.md) в службе "Поиск Azure" можно составить из [предопределенных навыков](cognitive-search-predefined-skills.md) и [пользовательских навыков](cognitive-search-custom-skill-web-api.md), самостоятельно создаваемых и добавляемых в конвейер. В этой статье вы научитесь создавать пользовательские навыки, которые предоставляют интерфейс, позволяя ему возможность включения в конвейер когнитивного поиска. 

Создание пользовательского навыка позволяет вставлять преобразования, уникальные для содержимого. Пользовательский навык выполняется независимо, применяя любой нужный вам шаг обогащения. Например, вы можете определить пользовательские сущности конкретных полей, создать настраиваемые модели классификации для разделения деловых и финансовых контрактов и документов, а также добавить навык распознавания речи, чтобы углубиться в содержимое звуковых файлов. Примеры с пошаговыми инструкциями см. в разделе [пример: Создание пользовательских опыт для когнитивного поиска](cognitive-search-create-custom-skill-example.md).

 Какая бы настраиваемая возможность вам ни требовалась, доступен простой и понятный интерфейс для подключения пользовательского навыка к остальной части конвейера обогащения. Единственным требованием для включения в [набор навыков](cognitive-search-defining-skillset.md) является возможность принимать входные данные и выводить выходные данные способами, поддерживаемыми всем набором навыков. В этой статье основное внимание уделено форматам входных и выходных данных для конвейера обогащения.

## <a name="web-api-custom-skill-interface"></a>Интерфейс пользовательских навыков веб-API

Если ответ от настраиваемых конечных точек навыка API Поиска в Интернете не будет получен в течение 30-секундного окна, то по умолчанию они истекают. Конвейер индексирования является синхронным и индексация будет вызывать ошибку времени ожидания, если ответ не будет получен в этом окне времени.  Установив параметр времени ожидания, его можно настроить до 90 секунд.

```json
        "@odata.type": "#Microsoft.Skills.Custom.WebApiSkill",
        "description": "This skill has a 90 second timeout",
        "uri": "https://[your custom skill uri goes here]",
        "timeout": "PT90S",
```

Сейчас единственный механизм взаимодействия с пользовательским навыком основан на интерфейсе веб-API. Этот веб-API должен удовлетворять требованиям, описанным в данном разделе.

### <a name="1--web-api-input-format"></a>1.  Входной формат веб-API

Веб-API должен принимать массив записей для обработки. Каждая запись должна содержать "контейнер свойств", то есть входные данные для веб-API. 

Предположим, что нужно создать простой обогатитель, который определяет первую дату, упомянутую в тексте контракта. В этом примере навык принимает один входной элемент *contractText* в качестве текста контракта. Кроме того, навык имеет один выходной элемент — дату контракта. Чтобы улучшить обогатитель, можно возвратить этот элемент *contractDate* в форме составного сложного типа.

Веб-API должен быть готов к приему пакета входящих записей. Каждый член массива *values* представляет входные данные для конкретной записи. Каждая запись должна иметь следующие элементы:

+ Член *recordId*, являющийся уникальным идентификатором для конкретной записи. Если ваш обогатитель возвращает результаты, он должен предоставлять этот *recordId*, чтобы позволить вызывающему объекту сопоставить результаты записи с их входными данными.

+ Член *данные*, являющийся контейнером полей входных данных для каждой записи.

Если выражаться конкретнее, то в соответствии с приведенным выше примером веб-API следует ожидать запросы следующего вида:

```json
{
    "values": [
      {
        "recordId": "a1",
        "data":
           {
             "contractText": 
                "This is a contract that was issues on November 3, 2017 and that involves... "
           }
      },
      {
        "recordId": "b5",
        "data":
           {
             "contractText": 
                "In the City of Seattle, WA on February 5, 2018 there was a decision made..."
           }
      },
      {
        "recordId": "c3",
        "data":
           {
             "contractText": null
           }
      }
    ]
}
```
На самом деле служба может вызываться с сотнями или тысячами записей, а не только тремя, показанными здесь.

### <a name="2-web-api-output-format"></a>2. Формат выходных данных веб-API

Формат выходных данных — это набор записей, содержащих *recordId* и контейнер свойств 

```json
{
  "values": 
  [
      {
        "recordId": "b5",
        "data" : 
        {
            "contractDate":  { "day" : 5, "month": 2, "year" : 2018 }
        }
      },
      {
        "recordId": "a1",
        "data" : {
            "contractDate": { "day" : 3, "month": 11, "year" : 2017 }                    
        }
      },
      {
        "recordId": "c3",
        "data" : 
        {
        },
        "errors": [ { "message": "contractText field required "}   ],  
        "warnings": [ {"message": "Date not found" }  ]
      }
    ]
}
```

Этот конкретный пример имеет всего один выходной элемент, но вывести можно более одного свойства. 

### <a name="errors-and-warning"></a>Ошибки и предупреждения

Как показано в предыдущем примере, для каждой записи можно возвращать сообщения об ошибках и предупреждения.

## <a name="consuming-custom-skills-from-skillset"></a>Использование пользовательских навыков из набора навыков

При создании обогатителя веб-API можно в составе запроса описать HTTP-заголовки и параметры. Приведенный ниже фрагмент кода показывает, как параметры и НТТР-заголовки запроса можно описать внутри определения набора навыков.

```json
{
    "skills": [
      {
        "@odata.type": "#Microsoft.Skills.Custom.WebApiSkill",
        "description": "This skill calls an Azure function, which in turn calls TA sentiment",
        "uri": "https://indexer-e2e-webskill.azurewebsites.net/api/DateExtractor?language=en",
        "context": "/document",
        "httpHeaders": {
            "DateExtractor-Api-Key": "foo"
        },
        "inputs": [
          {
            "name": "contractText",
            "source": "/document/content"
          }
        ],
        "outputs": [
          {
            "name": "contractDate",
            "targetName": "date"
          }
        ]
      }
  ]
}
```

## <a name="next-steps"></a>Следующие шаги

+ [Пример. Создание пользовательских опыт для когнитивный поиск](cognitive-search-create-custom-skill-example.md)
+ [Определение набора навыков](cognitive-search-defining-skillset.md)
+ [Создание набора навыков (REST)](https://docs.microsoft.com/rest/api/searchservice/create-skillset)
+ [Сопоставление обогащенных полей](cognitive-search-output-field-mapping.md)
