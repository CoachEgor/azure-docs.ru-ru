---
title: Расписание выполнения индексатора
titleSuffix: Azure Cognitive Search
description: Запланируйте Azure Когнитивный поиск индексировать содержимое периодически или в определенное время.
author: HeidiSteen
manager: nitinme
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 11/04/2019
ms.openlocfilehash: 72326413d463d449d339b1f3fd241ba2c27b4b6b
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "74112946"
---
# <a name="how-to-schedule-indexers-in-azure-cognitive-search"></a>Как планировать индексаторы в Azure Когнитивный поиск

Индексатор обычно выполняется один раз сразу после создания. Его можно запустить повторно по запросу с помощью портала, REST API или пакета SDK для .NET. Можно также настроить периодический запуск индексатора по расписанию.

В некоторых ситуациях полезно планирование индексаторов:

* С течением времени исходные данные будут меняться, и вам нужно, чтобы индексаторы Когнитивный поиск Azure автоматически обрабатывали измененные данные.
* Индекс будет заполнен из нескольких источников данных и необходимо убедиться, что индексаторы выполняются в разное время, чтобы уменьшить число конфликтов.
* Исходные данные очень велики, и вы хотите распределить обработку индексатора с течением времени. Дополнительные сведения об индексировании больших объемов данных см. [в статье индексирование больших наборов данных в Azure когнитивный Поиск](search-howto-large-index.md).

Планировщик — это встроенная функция Когнитивный поиск Azure. Для управления индексаторами поиска нельзя использовать внешний планировщик.

## <a name="define-schedule-properties"></a>Определение свойств расписания

Расписание индексатора имеет два свойства:
* **Интервал**, который определяет промежуток времени между запланированными выполнениями индексатора. Наименьший допустимый интервал составляет 5 минут, а максимальный — 24 часа.
* **Время начала (UTC)**, которое указывает на первый момент выполнения индексатора.

Вы можете указать расписание при первом создании индексатора или позже, обновив свойства индексатора. Расписания индексатора можно задать с помощью [портала](#portal), [REST API](#restApi)или [пакета SDK для .NET](#dotNetSdk).

Одновременно можно выполнить только один запуск выбранного индексатора. Если индексатор уже выполняется при запланированном следующем выполнении, это выполнение откладывается до следующего запланированного времени.

Для большей ясности рассмотрим пример. Предположим, что расписание индексатора настроено с **интервалом** в час и **временем начала** 1 июня 2019 8:00:00 по Гринвичу. Вот что может произойти, если выполнение индексатора длится дольше часа:

* Первое выполнение индексатора начинается с 1 июня 2019 в 8:00 по ГРИНВИЧу. Предположим, выполнение займет 20 минут (или иное количество времени в пределах часа).
* Второе выполнение начинается с 1 июня 2019 9:00 по ГРИНВИЧу или около него. Предположим, что выполнение занимает 70 минут — больше часа, и оно не будет выполнено до 10:10 по ГРИНВИЧу.
* Третье выполнение по расписанию начинается с 10:00 по Гринвичу (UTC), но в то время как предыдущее выполнение все еще выполняется. Это запланированное выполнение затем пропускается. Следующее выполнение индексатора не будет начато до 11:00 времени в формате UTC.

> [!NOTE]
> Если для индексатора задано определенное расписание, но повторная Ошибка одного и того же документа повторяется при каждом запуске, то работа индексатора начнется через менее частый интервал (до максимума не менее одного раза в 24 часа), пока не будет успешно выполнен прогресс.  Если вы считаете, что какая-либо проблема привела к зависанию индексатора в определенной точке, можно выполнить запрос по требованию индексатора и, если процесс выполнен успешно, индексатор снова вернется к его интервалу Set Schedule.

<a name="portal"></a>

## <a name="schedule-in-the-portal"></a>Расписание на портале

Мастер импорта данных на портале позволяет определить расписание для индексатора во время создания. По умолчанию параметр расписания имеет значение **ежечасно**, а это означает, что индексатор выполняется один раз после его создания и снова запускается каждый час.

Можно изменить параметр расписания на **один раз** , если вы не хотите, чтобы индексатор автоматически выполнялся или **ежедневно** запускался раз в день. Задайте значение **Custom** , если хотите указать другой интервал или определенное время начала.

Если задать для расписания значение **Custom**, то отображаются поля, позволяющие указать **интервал** и **время начала (UTC)**. Минимально допустимый интервал времени составляет 5 минут, а наибольшее — 1440 минут (24 часа).

   ![Настройка расписания индексатора в мастере импорта данных](media/search-howto-schedule-indexers/schedule-import-data.png "Настройка расписания индексатора в мастере импорта данных")

После создания индексатора можно изменить параметры расписания с помощью панели редактирования индексатора. Поля расписания те же, что и в мастере импорта данных.

   ![Задание расписания на панели редактирования индексатора](media/search-howto-schedule-indexers/schedule-edit.png "Задание расписания на панели редактирования индексатора")

<a name="restApi"></a>

## <a name="schedule-using-rest-apis"></a>Расписание с использованием API-интерфейсов RESTFUL

Расписание для индексатора можно определить с помощью REST API. Для этого включите свойство **Schedule** при создании или обновлении индексатора. В приведенном ниже примере показан запрос на размещение для обновления существующего индексатора.

    PUT https://myservice.search.windows.net/indexers/myindexer?api-version=2019-05-06
    Content-Type: application/json
    api-key: admin-key

    {
        "dataSourceName" : "myazuresqldatasource",
        "targetIndexName" : "target index name",
        "schedule" : { "interval" : "PT10M", "startTime" : "2015-01-01T00:00:00Z" }
    }

Параметр **interval** обязателен. Он указывает время между двумя последовательными запусками индексатора. Наименьшее допустимое значение — 5 минут, наибольшее — один день. Значение должно быть отформатировано как значение dayTimeDuration XSD (ограниченное подмножество значения [продолжительности ISO 8601](https://www.w3.org/TR/xmlschema11-2/#dayTimeDuration) ). Используется следующий шаблон: `P(nD)(T(nH)(nM))`. Примеры: `PT15M` для каждых 15 минут, `PT2H` для каждых 2 часов.

Необязательный параметр **StartTime** указывает, когда должно начаться выполнение по расписанию. Если опустить этот параметр, используется текущее время в формате UTC. Это время может быть раньше, в этом случае первое выполнение планируется так, как если бы индексатор выполнялся непрерывно с момента исходного времени **начала**.

Вы также можете запустить индексатор по запросу в любое время, используя вызов индексатора. Дополнительные сведения о запуске индексаторов и задании расписаний индексатора см. в разделе [Запуск индексатора](https://docs.microsoft.com/rest/api/searchservice/run-indexer), [Получение индексатора](https://docs.microsoft.com/rest/api/searchservice/get-indexer)и [Обновление индексатора](https://docs.microsoft.com/rest/api/searchservice/update-indexer) в справочнике по REST API.

<a name="dotNetSdk"></a>

## <a name="schedule-using-the-net-sdk"></a>Расписание с помощью пакета SDK для .NET

Расписание для индексатора можно определить с помощью пакета SDK Azure Когнитивный поиск .NET. Для этого включите свойство **Schedule** при создании или обновлении индексатора.

В следующем примере кода C# создается индексатор, использующий предопределенный источник данных и индекс, и задается расписание, которое будет выполняться один раз в день через 30 минут с этого момента:

```
    Indexer indexer = new Indexer(
        name: "azure-sql-indexer",
        dataSourceName: dataSource.Name,
        targetIndexName: index.Name,
        schedule: new IndexingSchedule(
                        TimeSpan.FromDays(1), 
                        new DateTimeOffset(DateTime.UtcNow.AddMinutes(30))
                    )
        );
    await searchService.Indexers.CreateOrUpdateAsync(indexer);
```
Если параметр **расписания** пропущен, индексатор будет выполняться только один раз сразу после его создания.

Для параметра **StartTime** можно задать время в прошлом. В этом случае первое выполнение планируется так, как если бы индексатор выполнялся непрерывно с момента заданной **StartTime**.

Расписание определяется с помощью класса [индексингсчедуле](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.models.indexingschedule?view=azure-dotnet) . Для конструктора **индексингсчедуле** требуется параметр **Interval** , заданный с помощью объекта **TimeSpan** . Наименьшее допустимое значение интервала — 5 минут, а максимальное — 24 часа. Второй параметр **StartTime** , указанный в качестве объекта **DateTimeOffset** , является необязательным.

Пакет SDK для .NET позволяет управлять операциями индексатора с помощью класса [SearchServiceClient](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.searchserviceclient) и его свойства [индексаторов](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.searchserviceclient.indexers) , которые реализуют методы из интерфейса **ииндексерсоператионс** . 

Индексатор можно запустить по запросу в любое время с помощью одного из методов [Run](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.indexersoperationsextensions.run), [RunAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.indexersoperationsextensions.runasync)или [рунвисхттпмессажесасинк](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.iindexersoperations.runwithhttpmessagesasync) .

Дополнительные сведения о создании, обновлении и выполнении индексаторов см. в разделе [иииндексерсоператионс](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.iindexersoperations?view=azure-dotnet).
