---
title: Выполнение индекса расписания
titleSuffix: Azure Cognitive Search
description: Запланируйте индексы Azure Cognitive Search для периодии индексации содержимого периодически или в определенное время.
author: HeidiSteen
manager: nitinme
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 11/04/2019
ms.openlocfilehash: 72326413d463d449d339b1f3fd241ba2c27b4b6b
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "74112946"
---
# <a name="how-to-schedule-indexers-in-azure-cognitive-search"></a>Как запланировать индексы в Azure Cognitive Search

Индексер обычно работает один раз, сразу после его создания. Вы можете запустить его снова по требованию с помощью портала, REST API или .NET SDK. Можно также настроить индексатор для периодическиго выполнения по расписанию.

Некоторые ситуации, когда планирование индекса полезно:

* Исходные данные будут меняться с течением времени, и вы хотите, чтобы индексы когнитивного поиска Azure автоматически обрабатывали измененные данные.
* Индекс будет заселен из нескольких источников данных, и вы хотите убедиться, что индексы работают в разное время для уменьшения конфликтов.
* Исходные данные очень велики, и вы хотите распределить обработку индекса с течением времени. Более подробную информацию об индексации больших объемов данных можно [найти в Azure Cognitive Search.](search-howto-large-index.md)

Планировщик является встроенной функцией Azure Cognitive Search. Вы не можете использовать внешний планировщик для управления поисковыми индексами.

## <a name="define-schedule-properties"></a>Определение свойств расписания

Расписание индекса имеет два свойства:
* **Интервал**, который определяет количество времени между запланированными выполнением индекса. Самый маленький интервал составляет 5 минут, а самый большой - 24 часа.
* **Время начала (UTC),** в котором указывается первый раз, когда индексатор должен быть запущен.

Можно указать расписание при первом создании индекса или позже обновить свойства индекса. Расписание индексамогут быть установлены с помощью [портала,](#portal) [REST API](#restApi)или [.NET SDK](#dotNetSdk).

Одновременно можно выполнить только один запуск выбранного индексатора. Если индексер уже работает при запланировании следующего выполнения, выполнение откладывается до следующего запланированного времени.

Для большей ясности рассмотрим пример. Предположим, мы настраиваем расписание индекса с **интервалом** в час и **время начала** 1 июня 2019 года в 8:00 утра UTC. Вот что может произойти, когда запуск индекса занимает больше часа:

* Первое исполнение индекса начинается 1 июня 2019 года в 8:00 utC. Предположим, выполнение займет 20 минут (или иное количество времени в пределах часа).
* Второе исполнение начинается 1 июня 2019 г. в 9:00 ПО UTC. Предположим, что это выполнение занимает 70 минут - более часа - и оно не завершится до 10:10 утра UTC.
* Третье исполнение планируется начать в 10:00 utC, но в это время предыдущее исполнение все еще работает. Это запланированное выполнение затем пропущено. Следующее выполнение индекса не начнется до 11:00 UTC.

> [!NOTE]
> Если индексатор настроен на определенное расписание, но неоднократно выходит из одного и того же документа снова и снова каждый раз, индексер начнет работать с меньшим частым интервалом (максимум один раз в 24 часа), пока он успешно не достигнет прогресса Снова.  Если вы считаете, что исправили все проблемы, которые привели к тому, что индексер застрял в определенной точке, вы можете выполнить по требованию запуск индекса, и если это успешно прогрессирует, индексер вернется к установленной интервалграфика снова.

<a name="portal"></a>

## <a name="schedule-in-the-portal"></a>Расписание на портале

Мастер данных импорта на портале позволяет определить расписание для индексатора во время создания. Настройка расписания по умолчанию **является Hourly,** что означает, что индексатор работает один раз после его создания, и снова работает каждый час после этого.

Вы можете изменить настройки Расписание на **Один раз,** если вы не хотите, чтобы индексер запускать снова автоматически, или **ежедневно** работать один раз в день. Установите его в **Custom,** если вы хотите указать другой интервал или определенное будущее время начала.

При настройке расписания в **Custom,** поля, как представляется, позволяют указать **Интервал** и **время начала (UTC)**. Самый короткий промежуток времени составляет 5 минут, а самый длинный - 1440 минут (24 часа).

   ![Настройка расписания индекса в мастере данных импорта](media/search-howto-schedule-indexers/schedule-import-data.png "Настройка расписания индекса в мастере данных импорта")

После создания индекса можно изменить настройки расписания с помощью панели edit индекса. Поля Расписание такие же, как и в мастере данных импорта.

   ![Настройка расписания в панели индекса Edit](media/search-howto-schedule-indexers/schedule-edit.png "Настройка расписания в панели индекса Edit")

<a name="restApi"></a>

## <a name="schedule-using-rest-apis"></a>Расписание с использованием REST AIS

Расписание индексастом можно определить с помощью REST API. Для этого включите свойство **расписания** при создании или обновлении индекса. В приведенном ниже примере показан запрос PUT на обновление существующего индекса:

    PUT https://myservice.search.windows.net/indexers/myindexer?api-version=2019-05-06
    Content-Type: application/json
    api-key: admin-key

    {
        "dataSourceName" : "myazuresqldatasource",
        "targetIndexName" : "target index name",
        "schedule" : { "interval" : "PT10M", "startTime" : "2015-01-01T00:00:00Z" }
    }

Параметр **interval** обязателен. Он указывает время между двумя последовательными запусками индексатора. Наименьшее допустимое значение — 5 минут, наибольшее — один день. Значение должно быть отформатировано как значение dayTimeDuration XSD (ограниченное подмножество значения [продолжительности ISO 8601](https://www.w3.org/TR/xmlschema11-2/#dayTimeDuration) ). Используется следующий шаблон: `P(nD)(T(nH)(nM))`. Примеры: `PT15M` для каждых 15 минут, `PT2H` для каждых 2 часов.

В дополнительном **времени запуска** указывается, когда должны начаться запланированные выполнения. Если опустить этот параметр, используется текущее время в формате UTC. Это время может быть в прошлом, и в этом случае первое выполнение запланировано, как если бы индексатор работает непрерывно с момента первоначального **startTime**.

Вы также можете запустить индексер по требованию в любое время с помощью вызова Run Indexer. Для получения дополнительной информации о запуске индексеров и [Get Indexer](https://docs.microsoft.com/rest/api/searchservice/get-indexer)настройке расписания [Update Indexer](https://docs.microsoft.com/rest/api/searchservice/update-indexer) индекса [см.](https://docs.microsoft.com/rest/api/searchservice/run-indexer)

<a name="dotNetSdk"></a>

## <a name="schedule-using-the-net-sdk"></a>Расписание с помощью .NET SDK

Расписание для индекса можно определить с помощью Azure Cognitive Search .NET SDK. Для этого включите свойство **расписания** при создании или обновлении Indexer.

Следующий пример СЗ создает индексатор, используя заранее определенный источник данных и индекс, и устанавливает его график для запуска один раз в день, начиная с 30 минут:

```
    Indexer indexer = new Indexer(
        name: "azure-sql-indexer",
        dataSourceName: dataSource.Name,
        targetIndexName: index.Name,
        schedule: new IndexingSchedule(
                        TimeSpan.FromDays(1), 
                        new DateTimeOffset(DateTime.UtcNow.AddMinutes(30))
                    )
        );
    await searchService.Indexers.CreateOrUpdateAsync(indexer);
```
Если параметр **расписания** опущен, индексер будет работать только один раз сразу после его создания.

Параметр **StartTime** может быть установлен на время в прошлом. В этом случае первое выполнение запланировано так, как если бы индексатор работал непрерывно с момента данного **startTime.**

Расписание определяется с помощью класса [IndexingSchedule.](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.models.indexingschedule?view=azure-dotnet) Конструктору **IndexingSchedule** требуется **параметр интервала,** указанный с помощью объекта **TimeSpan.** Наименьшее допустимое интервалное значение составляет 5 минут, а самое большое - 24 часа. Второй параметр **StartTime,** указанный как объект **DateTimeOffset,** является необязательным.

SDK .NET позволяет управлять операциями индекса с использованием класса [SearchServiceClient](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.searchserviceclient) и его свойства [индексеров,](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.searchserviceclient.indexers) который реализует методы из интерфейса **IIndexersOperations.** 

Вы можете запустить индексер по требованию в любое время с помощью одного из методов [Run,](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.indexersoperationsextensions.run) [RunAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.indexersoperationsextensions.runasync)или [RunWithMessagesAsync.](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.iindexersoperations.runwithhttpmessagesasync)

Для получения дополнительной информации о создании, обновлении и запуске индексеров [см.](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.iindexersoperations?view=azure-dotnet)
