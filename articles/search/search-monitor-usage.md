---
title: Мониторинг операций и деятельности
titleSuffix: Azure Cognitive Search
description: Позволяете регистрать, получать метрики активности запроса, использование ресурсов и другие системные данные из службы когнитивного поиска Azure.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 02/15/2020
ms.openlocfilehash: 353e00f902a7314e5e5b7c8ee03e8b925a510b26
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "77462332"
---
# <a name="monitor-operations-and-activity-of-azure-cognitive-search"></a>Мониторинг операций и деятельности Azure Cognitive Search

В этой статье вводится мониторинг на уровне службы (ресурса), на уровне рабочей нагрузки (запросы и индексация), и предлагается основа для мониторинга пользовательского доступа.

По всему спектру вы будете использовать сочетание встроенной инфраструктуры и базовых служб, таких как Azure Monitor, а также AI-аПО обслуживания, которые возвращают статистику, подсчеты и статус. Понимание диапазона возможностей может помочь вам построить цикл обратной связи, так что вы можете решать проблемы по мере их возникновения.

## <a name="use-azure-monitor"></a>Использование Azure Monitor

Многие службы, включая Azure Cognitive Search, используют [Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/) для оповещения, метрик и диагностических данных о регистрации. Для Azure Cognitive Search встроенная инфраструктура мониторинга используется в основном для мониторинга на уровне ресурсов (работоспособности службы) и [мониторинга запросов.](search-monitor-queries.md)

Следующий скриншот поможет найти функции Azure Monitor на портале.

+ **Вкладка мониторинга,** расположенная на главной странице обзора, отображает ключевые метрики с первого взгляда.
+ **В журнале действий**, чуть ниже Обзор, отчеты о действиях на уровне ресурсов: работоспособность службы и уведомления о запросе клавиш API.
+ **Мониторинг**, далее вниз по списку, обеспечивает настраиваемые оповещения, метрики и диагностические журналы. Создавайте их, когда они вам нужны. После сбора и хранения данных можно запросить или визуализировать информацию для получения информации.

![Интеграция Azure Monitor в поисковой службе](./media/search-monitor-usage/azure-monitor-search.png
 "Интеграция Azure Monitor в поисковой службе")

### <a name="precision-of-reported-numbers"></a>Точность заявленных чисел

Страницы портала обновляются каждые несколько минут. Таким образом, цифры, представленные на портале, являются приблизительными, чтобы дать вам общее представление о том, насколько хорошо ваша система обслуживает запросы. Фактические метрики, такие как запросы в секунду (КПС), могут быть выше или ниже, чем число, указанное на странице.

## <a name="activity-logs-and-service-health"></a>Журналы активности и работоспособность службы

[**В журнале Activity**](https://docs.microsoft.com/azure/azure-monitor/platform/activity-log-view) собирается информация от менеджера ресурсов Azure и отчеты об изменениях в работоспособности службы. Вы можете отслеживать журнал активности на критических, ошибок и предупреждений, связанных со работоспособностью службы.

Для задач в обслуживании, таких как запросы, индексация или создание объектов, вы увидите общие информационные уведомления, такие как *Get Admin Key* и *Get Query keys* для каждого запроса, но не само конкретное действие. Для получения информации об этом зерне необходимо настроить диагностическую лесозаготовку.

Вы можете получить доступ к **журналу действий** из области навигации слева, с помощью уведомления на панели команд в верхнем окне или на странице **Диагностика и решение проблем**.

## <a name="monitor-storage"></a>Хранение монитора

Страницы с вкладками, встроенные в страницу «Обзор», сообщают об использовании ресурсов. Эта информация становится доступной, как только вы начинаете использовать службу, без необходимости конфигурации, и страница обновляется каждые несколько минут. 

Если вы принимаете решения о том, [какой уровень выбрать для производственных рабочих нагрузок](search-sku-tier.md), или о том, следует ли [изменить число активных реплик и секций](search-capacity-planning.md), эти метрики помогут вам, так как они показывают, насколько быстро используются ресурсы и насколько хорошо текущая конфигурация справляется с текущей нагрузкой.

Оповещения, связанные с хранением, в настоящее время отсутствуют; Потребление хранилища не агрегируется и не входит в таблицу **AzureMetrics** в Azure Monitor. Необходимо создать [специальное решение,](https://docs.microsoft.com/azure/azure-monitor/insights/solutions-creating) которое испускает уведомления, связанные с ресурсами, где код проверяет размер хранилища и обрабатывает ответ. Для получения дополнительной информации о метриках хранения, [см.](https://docs.microsoft.com/rest/api/searchservice/get-service-statistics#response)

Для визуального мониторинга на портале вкладка **«Использование»** показывает доступность ресурсов относительно [текущих ограничений,](search-limits-quotas-capacity.md) налагаемых уровнем обслуживания. 

На следующем рисунке показана служба ценовой категории "Бесплатный", которая ограничена 3 объектами каждого типа и 50 МБ памяти. Службы ценовых категории "Базовый" и "Стандартный" обеспечивают больше ресурсов, а при увеличении числа секций максимальный размер хранилища пропорционально возрастает.

![Состояние использования по отношению к ограничениям уровня](./media/search-monitor-usage/usage-tab.png
 "Состояние использования по отношению к ограничениям уровня")

## <a name="monitor-workloads"></a>Мониторинг рабочих нагрузок

Зарегистрированные события включают события, связанные с индексацией и запросами. Таблица **AzureDiagnostics** в журнале Log Analytics собирает оперативные данные, связанные с запросами и индексированием.

Большая часть зарегистрированных данных предназначена для операций только для чтения. Для других операций создания обновления-удаления, не захваченных в журнале, можно запросить службу поиска для системной информации.

| OperationName | Описание |
|---------------|-------------|
| СервисСтатистика | Эта операция является обычным вызовом [для получения статистики обслуживания,](https://docs.microsoft.com/rest/api/searchservice/get-service-statistics)либо вызова непосредственно или косвенно, чтобы заполнить страницу обзора портала, когда он загружается или обновляется. |
| Запрос.Поиск |  Запросы запросов в отношении [запросов](search-monitor-queries.md) индекса See Monitor для получения информации о зарегистрированных запросах.|
| Индексирование.Индекс  | Эта операция представляет собой призыв [добавить, обновить или удалить документы](https://docs.microsoft.com/rest/api/searchservice/addupdate-or-delete-documents). |
| Индексы. Прототип | Это индекс, созданный мастером данных импорта. |
| Индексы.Создание | Создайте индексатор явно или косвенно через мастера данных импорта. |
| Индексы.Get | Возвращает имя индексара всякий раз, когда индексатор запущен. |
| Индексы.Статус | Возвращает статус индекса при запуске индекса. |
| DataSources.Get | Возвращает имя источника данных при запуске индекса.|
| Индексы.Get | Возвращает имя индекса всякий раз, когда индексатор запущен. |

### <a name="kusto-queries-about-workloads"></a>Кусто запросы о рабочих нагрузках

Если вы включили журнал, можно запросить **AzureDiagnostics** для списка операций, которые были включены в службу и когда. Можно также соотнести действия для исследования изменений в производительности.

#### <a name="example-list-operations"></a>Пример: Операции списка 

Верните список операций и количество каждой из них.

```
AzureDiagnostics
| summarize count() by OperationName
```

#### <a name="example-correlate-operations"></a>Пример: Операции коррелятов

Соотведать запрос запроса с операциями индексирования и сделать точки данных на временной диаграмме, чтобы операции совпадали.

```
AzureDiagnostics
| summarize OperationName, Count=count()
| where OperationName in ('Query.Search', 'Indexing.Index')
| summarize Count=count(), AvgLatency=avg(DurationMs) by bin(TimeGenerated, 1h), OperationName
| render timechart
```

### <a name="use-search-apis"></a>Используйте поисковые aIS

Как Azure Cognitive Search REST API, так и .NET SDK обеспечивают программный доступ к показателям обслуживания, информации об индексах и индексере, а также подсчету документов.

+ [Статистика обслуживания GET](/rest/api/searchservice/get-service-statistics)
+ [Статистика индексов GET](/rest/api/searchservice/get-index-statistics)
+ [ПОДсчитывает документы GET](/rest/api/searchservice/count-documents)
+ [Статус индекса GET](/rest/api/searchservice/get-indexer-status)

## <a name="monitor-user-access"></a>Мониторинг пользовательского доступа

Поскольку индексы поиска являются компонентом более крупного клиентского приложения, нет встроенной методологии для контроля или мониторинга доступа к индексу для одного пользователя. Предполагается, что запросы поступают от клиентского приложения, для запросов на запросы от админа или запроса. Операции админовирования записи включают создание, обновление, удаляние объектов по всей службе. Операции только для чтения — это запросы в отношении сбора документов, прим. 

Таким образом, в журналах активности вы увидите ссылки на вызовы с помощью ключей админ или ключей запроса. Соответствующий ключ включен в запросы, исходящие из кода клиента. Служба не оборудована для обработки токенов идентификационных данных или олицетворения.

Когда бизнес-требования существуют для авторизации для пользователей, рекомендация заключается в интеграции с Active Directory Azure. Можно использовать $filter и идентификаторы пользователей для [обрезки результатов поиска](search-security-trimming-for-azure-search-with-aad.md) документов, которые пользователь не должен видеть. 

Нет никакого способа войти в эту информацию отдельно от строки запроса, которая включает $filter параметр. См [запросы Monitor](search-monitor-queries.md) для получения подробной информации о строках запросов отчетности.

## <a name="next-steps"></a>Дальнейшие действия

Свободное владение Azure Monitor имеет важное значение для надзора за любой службой Azure, включая такие ресурсы, как Azure Cognitive Search. Если вы не знакомы с Azure Monitor, позаботьтесь о просмотре статей, связанных с ресурсами. В дополнение к учебникам, следующая статья является хорошим местом для начала.

> [!div class="nextstepaction"]
> [Мониторинг ресурсов Azure с помощью Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/insights/monitor-azure-resource)
