---
title: Настройка емкости для рабочих нагрузок запроса и индекса
titleSuffix: Azure Cognitive Search
description: Отрегулируйте разделительные и реплики компьютерных ресурсов в Azure Cognitive Search, где каждый ресурс оценивается в единицах поиска.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 02/14/2020
ms.openlocfilehash: e2ba5301b81b1a6f5de696ab4587cd8ff43e3c68
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "77462570"
---
# <a name="adjust-capacity-in-azure-cognitive-search"></a>Настройка емкости в когнитивном поиске Azure

Прежде чем [предоставить службу поиска](search-create-service-portal.md) и зафиксировать определенный уровень ценообразования, потребуется несколько минут, чтобы понять роль реплик и разделов в службе и как можно настроить службу для размещения пиков и падений спроса на ресурсы.

Емкость — это функция [выбираемого уровня](search-sku-tier.md) (уровни определяют аппаратные характеристики), а также комбинации реплики и перегородки, необходимые для прогнозируемых рабочих нагрузок. В зависимости от уровня и размера регулировки добавление или уменьшение емкости может занять от 15 минут до нескольких часов. 

При изменении распределения реплик и разделов рекомендуется использовать портал Azure. Портал применяет ограничения на допустимые комбинации, которые остаются ниже максимальных пределов уровня. Однако, если требуется подход к подготовке на основе сценариев или кодирования, [Azure PowerShell](search-manage-powershell.md) или [API Management REST](https://docs.microsoft.com/rest/api/searchmanagement/services) являются альтернативными решениями.

## <a name="terminology-replicas-and-partitions"></a>Терминология: реплики и перегородки

|||
|-|-|
|*Секции* | Служат для хранения индексов и ввода-вывода данных для операций чтения и записи (например, при повторном создании или обновлении индексов). Каждая часть имеет долю от общего индекса. Если вы выделяете три раздела, индекс делится на треть. |
|*Реплики* | Экземпляры службы поиска, используемые главным образом для распределения операций запросов. Каждая реплика представляет собой одну копию индекса. Если вы выделите три реплики, у вас будет три копии индекса, доступных для обслуживания запросов запросов запросов.|

## <a name="when-to-add-nodes"></a>Когда добавлять узлы

Первоначально службе выделяется минимальный уровень ресурсов, состоящий из одной раздела и одной реплики. 

Одна служба должна иметь достаточно ресурсов для обработки всех рабочих нагрузок (индексирования и запросов). Ни одна рабочая нагрузка не выполняется в фоновом режиме. Можно запланировать индексацию на время, когда запросы запросов, естественно, менее часты, но в противном случае служба не будет приоритизировать одну задачу над другой. Кроме того, определенное количество избыточности сглаживает производительность запроса при обновлении служб или узлов внутри компании.

Как правило, приложения поиска, как правило, нуждаются в большем количестве реплик, чем разделов, особенно когда операции службы смещены по отношению к рабочим нагрузкам запросов. В разделе, посвященном [высокой доступности](#HA) , объясняется, почему так происходит.

Добавление дополнительных реплик или разделов увеличивает стоимость запуска службы. Обязательно проверьте [калькулятор ценообразования,](https://azure.microsoft.com/pricing/calculator/) чтобы понять последствия выставления счетов добавления дополнительных узлов. Приведенная [ниже диаграмма](#chart) поможет вам перекрестно сопомнение количества единиц поиска, необходимых для определенной конфигурации.

## <a name="how-to-allocate-replicas-and-partitions"></a>Как распределить реплики и разделы

1. Войдите на [портал Azure](https://portal.azure.com/) и выберите службу поиска.

1. В **настройках**откройте страницу **шкалы** для изменения реплик и разделов. 

   На следующем скриншоте показана стандартная услуга, подготовленная с одной репликой и разделом. Формула внизу указывает, сколько поисковых единиц используется (1). Если цена единицы составила $ 100 (не реальная цена), ежемесячная стоимость запуска этой услуги будет $ 100 в среднем.

   ![Масштабирование страницы, отображающее текущие значения](media/search-capacity-planning/1-initial-values.png "Масштабирование страницы, отображающее текущие значения")

1. Используйте ползунок для увеличения или уменьшения количества перегородок. Формула внизу указывает, сколько поисковых единиц используется.

   Этот пример удваивает емкость, с двумя репликами и разделами каждый. Обратите внимание на количество единиц поиска; в настоящее время четыре, потому что формула выставления счетов реплики умножается на разделы (2 х 2). Удвоение емкости более чем удваивает стоимость выполнения службы. Если поиск единицы стоимость составила $ 100, новый ежемесячный счет теперь будет $ 400.

   Для текущих затрат на единицу каждого уровня, посетите [страницу ценообразования](https://azure.microsoft.com/pricing/details/search/).

   ![Добавление реплик и перегородок](media/search-capacity-planning/2-add-2-each.png "Добавление реплик и перегородок")

1. Нажмите **Сохранить,** чтобы подтвердить изменения.

   ![Подтверждение изменений в масштабе и выставлении счетов](media/search-capacity-planning/3-save-confirm.png "Подтверждение изменений в масштабе и выставлении счетов")

   Изменение емкости занимает несколько часов. Вы не можете отменить после начала процесса и нет мониторинга в режиме реального времени для регулировок реплики и раздела. Тем не менее, следующее сообщение остается видимым, пока происходят изменения.

   ![Сообщение о статусе на портале](media/search-capacity-planning/4-updating.png "Сообщение о статусе на портале")

> [!NOTE]
> После того, как услуга предоставляется, она не может быть повышена до более высокого уровня. Вам нужно будет создать службу поиска на новом уровне и перезагрузить индексы. [См. Создать сервис когнитивного поиска Azure](search-create-service-portal.md) на портале для получения помощи в предоставлении услуг.
>
> Кроме того, разделы и реплики управляются исключительно и внутренне службой. Отсутствует концепция сродства процессора или назначения рабочей нагрузки конкретному узлам.
>

<a id="chart"></a>

## <a name="partition-and-replica-combinations"></a>сочетания разделов и реплик

На уровне "Базовый" служба может иметь только одну секцию и до трех реплик. Таким образом, максимальное количество единиц поиска составляет три. Единственным ресурсом, который можно изменять, являются реплики. Требуется не менее двух реплик, чтобы обеспечить высокий уровень доступности при обработке запросов.

Все службы поиска Standard and Storage Optimized могут предполагать следующие комбинации реплик и разделов, при условии ограничения 36-SU. 

|   | **1 перегородка** | **2 перегородки** | **3 секции** | **4 секции** | **6 перегородок** | **12 секций** |
| --- | --- | --- | --- | --- | --- | --- |
| **1 реплика** |1 ЕП |2 ЕП |3 ЕП |4 ЕП |6 ЕП |12 ЕП |
| **2 реплики** |2 ЕП |4 ЕП |6 ЕП |8 ЕП |12 ЕП |24 ЕП |
| **3 реплики** |3 ЕП |6 ЕП |9 ЕП |12 ЕП |18 ЕП |36 ЕП |
| **4 реплики** |4 ЕП |8 ЕП |12 ЕП |16 ЕП |24 ЕП |Недоступно |
| **5 реплик** |5 ЕП |10 ЕП |15 ЕП |20 ЕП |30 ЕП |Недоступно |
| **6 реплик** |6 ЕП |12 ЕП |18 ЕП |24 ЕП |36 ЕП |Недоступно |
| **12 реплик** |12 ЕП |24 ЕП |36 ЕП |Недоступно |Недоступно |Недоступно |

Подробные сведения о единицах поиска, ценах и объемах приведены на веб-сайте Azure. Дополнительные сведения см. на [странице с ценами](https://azure.microsoft.com/pricing/details/search/).

> [!NOTE]
> Количество реплик и секций должно быть делителем 12 (а именно 1, 2, 3, 4, 6, 12). Это связано с тем, что Azure Cognitive Search предварительно делит каждый индекс на 12 осколков, чтобы его можно было распределить равными частями по всем разделам. Например, если в вашей службе есть три секции и вы создаете индекс, то каждая секция будет содержать по четыре сегмента индекса. То, как Azure Cognitive Search осколки индекса является деталью реализации, может быть изменена в будущих выпусках. Несмотря на то, что сегодня это число 12, вам не следует полагаться на то, что в будущем оно не изменится.
>

<a id="HA"></a>

## <a name="high-availability"></a>Высокий уровень доступности

Поскольку задача масштабирования решается достаточно легко и быстро, на начальном этапе обычно рекомендуется использовать один раздел и одну или две реплики, увеличивая их количество по мере роста запросов. Рабочие нагрузки запросов в основном выполняются с репликами. Для повышения пропускной способности или обеспечения высокого уровня доступности вам, скорее всего, потребуется больше реплик.

Ниже приведены общие рекомендации для обеспечения высокой доступности.

* Две реплики для обеспечения высокой доступности рабочих нагрузок для чтения (запросов).

* Три или более реплик для обеспечения высокого уровня доступности рабочих нагрузок чтения и записи (запросов и индексирования по мере добавления, обновления или удаления отдельных документов).

Соглашения об уровне обслуживания (SLA) для Azure Cognitive Search ориентированы на операции запросов и обновления индексов, которые включают добавление, обновление или удаливание документов.

Категория "Базовый" ограничена одной секцией и тремя репликами. Если нужно оперативно реагировать на колебания требований к индексированию и пропускной способности запросов, рекомендуем использовать одну из категорий "Стандартный".  Если вы обнаружите, что ваши требования к хранению растут гораздо быстрее, чем пропускная память, рассмотрим один из уровней оптимизации хранилища.

## <a name="disaster-recovery"></a>Аварийное восстановление

В настоящее время встроенного механизма для аварийного восстановления не предусмотрено. Увеличение разделов или реплик для решения задач аварийного восстановления является ошибочной стратегией. Наиболее распространенным подходом является добавление избыточности на уровне службы за счет настройки второй службы поиска в другом регионе. Как и в случае с доступностью при повторном создании индекса, перенаправление и логику отработки отказа должен обеспечивать ваш код.

## <a name="estimate-replicas"></a>Оценка реплик

На производственной службе следует выделить три реплики для целей SLA. Если вы испытываете медленную производительность запроса, можно добавить реплики, чтобы дополнительные копии индекса были введены в режим еде для поддержки больших рабочих нагрузок запроса и для загрузки баланса запросов по нескольким репликам.

Мы не предоставляем рекомендации о том, сколько реплик необходимо для размещения нагрузок запросов. Производительность запроса зависит от сложности запроса и конкурирующих рабочих нагрузок. Добавляя реплики, можно повысить производительность, но результат не обязательно будет линейным. Например, добавление трех реплик не гарантирует трехкратный рост пропускной способности.

Для получения рекомендаций по оценке кондиционирования решения можно просмотреть [шкалу производительности](search-performance-optimization.md)и [мониторинг запросов](search-monitor-queries.md)

## <a name="estimate-partitions"></a>Оценка разделов

Выбираемый [уровень](search-sku-tier.md) определяет размер и скорость раздела, и каждый уровень оптимизирован вокруг набора характеристик, которые соответствуют различным сценариям. Если вы выберете более высокий уровень, вам может понадобиться меньше разделов, чем если вы идете с S1. Один из вопросов, на который вам нужно будет ответить с помощью самостоятельного тестирования, заключается в том, дает ли более крупный и более дорогостоящий раздел более высокую производительность, чем два более дешевых раздела на услугу, обслуживаемую на более низком уровне.

Приложениям поиска, которым требуется обновления данных в режиме, близком к реальному времени, понадобится пропорционально больше секций, чем реплик. При добавлении секций операции чтения-записи распределяются среди большего количества вычислительных ресурсов. Оно также обеспечивает больше дискового пространства для хранения дополнительных индексов и документов.

Запрос больших индексов выполняется дольше. Поэтому может оказаться, что каждое добавочное увеличение числа секций потребует меньшего, но пропорционального увеличения числа реплик. Сложность запросов и их объем обусловливают скорость выполнения запросов.

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Выберите ценовой уровень для когнитивного поиска Azure](search-sku-tier.md)