---
title: Масштабирование секций и реплик для запросов и индексирования — поиска Azure
description: Настройка вычислительных ресурсов секций и реплик в Поиске Azure, в которых каждый ресурс оценивается в оплачиваемых единицах поиска.
author: HeidiSteen
manager: cgronlun
services: search
ms.service: search
ms.topic: conceptual
ms.date: 03/22/2019
ms.author: heidist
ms.custom: seodec2018
ms.openlocfilehash: 6879dd975f97ba2746165e87a135e5d90e8b229f
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60308762"
---
# <a name="scale-partitions-and-replicas-for-query-and-indexing-workloads-in-azure-search"></a>Масштабирование секций и реплик для запросов и индексирования рабочих нагрузок в службе поиска Azure
После [выбора ценовой категории](search-sku-tier.md) и [подготовки службы поиска](search-create-service-portal.md) следующим шагом является необязательное увеличение количества реплик или секций, используемых службой. Каждый уровень предоставляет фиксированное число единиц выставления счетов. В этой статье объясняется, как выделять эти единицы для достижения оптимальной конфигурации, позволяющей сбалансировать ваши требования к для выполнению запросов, индексированию и хранению данных.

Конфигурация ресурсов доступна при настройке службы на [уровня "базовый"](https://aka.ms/azuresearchbasic) или один из [уровней "стандартный" или, оптимизированные для хранилища](search-limits-quotas-capacity.md). Для всех служб на этих уровнях емкость приобретается в *единицах поиска*, где каждая секция и реплика принимается за одну единицу поиска. 

Чем меньше используется единиц поиска, тем меньше выставляется счет. Оплата осуществляется на протяжении всего периода настройки службы. Чтобы не платить за службу, которую вы временно не используете, вам нужно удалить ее, а затем при необходимости создать снова.

> [!Note]
> Удаление службы приводит к удалению всех связанных с ней компонентов. В службе поиска Azure отсутствуют возможности резервного копирования и восстановления сохраненных данных для поиска. Чтобы повторно развернуть существующий индекс в новой службе, необходимо запустить программу, которая изначально использовалась для его создания и загрузки. 

## <a name="terminology-replicas-and-partitions"></a>Терминология: реплик и секций
Реплик и секций являются основными ресурсами, которые поддерживают службу поиска.

| Ресурс | Определение |
|----------|------------|
|*Секции* | Служат для хранения индексов и ввода-вывода данных для операций чтения и записи (например, при повторном создании или обновлении индексов).|
|*Реплики* | Экземпляры службы поиска, используемые главным образом для распределения операций запросов. На каждой реплике всегда размещается одна копия индекса. Если у вас есть 12 реплик, в службу будет загружено 12 копий каждого индекса.|

> [!NOTE]
> Невозможно напрямую выбрать или определить, какие индексы будут запущены в реплике. Одна копия каждого индекса в каждой реплике является частью архитектуры службы.
>


## <a name="how-to-allocate-replicas-and-partitions"></a>Выделение реплик и секций
В Поиске Azure для службы поиска изначально выделяется минимальный уровень ресурсов, состоящий из одного раздела и одной реплики. Для уровней, которые поддерживают службу, вы можете постепенно корректировать вычислительные ресурсы, увеличивая количество секций, если вам нужно больше места для хранения и операций ввода-вывода, или добавляя реплики, чтобы увеличить объем запросов или повысить производительность. Одна служба должна иметь достаточно ресурсов для обработки всех рабочих нагрузок (индексирования и запросов). Нельзя разделить рабочие нагрузки между несколькими службами.

Для увеличения или изменения количества выделенных реплик или секций мы рекомендуем использовать портал Azure. Принудительно применяет ограничения для допустимых сочетаний, которые не превышают верхний предел. Если требуется, чтобы на основе сценария или на основе кода подготовки подход, [Azure PowerShell](search-manage-powershell.md) или [API REST управления](https://docs.microsoft.com/rest/api/searchmanagement/services) являются альтернативные решения.

Как правило, приложениям поиска требуется больше реплик, чем секций, особенно если операции службы смещаются в сторону рабочей нагрузки запросов. В разделе, посвященном [высокой доступности](#HA) , объясняется, почему так происходит.

1. Войдите на [портал Azure](https://portal.azure.com/) и выберите службу поиска.
2. В **параметры**откройте **масштабирования** страницу, чтобы изменить реплик и секций. 

   На следующем рисунке показан стандартной службы подготовки с одной реплики и раздела. Формула в нижней указывает, сколько единиц поиска используемые (1). Если цена за единицу 100 долл. США (а не реальных цена), Ежемесячная стоимость работы этой службы будет 100 долл. США в среднем.

   ![Странице "масштаб" отображаются текущие значения](media/search-capacity-planning/1-initial-values.png "странице \"масштаб\" отображаются текущие значения")

3. Используйте ползунок, чтобы увеличить или уменьшить количество секций. Формула в нижней указывает, сколько единиц поиска, используются.

   В этом примере удваивается емкости с двумя репликами и каждой секции. Обратите внимание, что количество единиц поиска; Теперь стало четыре так, как формула выставления счетов — реплики, умноженные partitions (2 x 2). Более чем вдвое емкость удваивается в стоимость использования службы. Если стоимость единицы поиска был 100 долл. США, новый ежемесячный счет будет 400 долларов США.

   Текущий на затраты на единицы использования каждого уровня, см. в статье [странице цен](https://azure.microsoft.com/pricing/details/search/).

   ![Добавление реплик и секций](media/search-capacity-planning/2-add-2-each.png "Добавление реплик и секций")

3. Нажмите кнопку **Сохранить** для подтверждения изменения.

   ![Подтверждение изменений для масштабирования и выставление счетов](media/search-capacity-planning/3-save-confirm.png "Подтверждение изменений для масштабирования и выставление счетов")

   Изменения в емкости занять несколько часов. Не удается отменить после начала процесса и есть не мониторинг в реальном времени для корректировки реплик и секций. Тем не менее сообщение остается видимым во время изменения находятся в процессе реализации.

   ![Сообщение о состоянии на портале](media/search-capacity-planning/4-updating.png "сообщение о состоянии на портале")


> [!NOTE]
> После подготовки службы ее невозможно обновить до более высокого SKU. Вам нужно будет создать службу поиска на новом уровне и перезагрузить индексы. Инструкции по подготовке службы см. в статье [Создание службы Поиска Azure с помощью портала Azure](search-create-service-portal.md).
>
>

<a id="chart"></a>

## <a name="partition-and-replica-combinations"></a>сочетания разделов и реплик

На уровне "Базовый" служба может иметь только одну секцию и до трех реплик. Таким образом, максимальное количество единиц поиска составляет три. Единственным ресурсом, который можно изменять, являются реплики. Требуется не менее двух реплик, чтобы обеспечить высокий уровень доступности при обработке запросов.

Все "стандартный" и оптимизированные для хранилища службы поиска можно предположить, перечисленных ниже комбинациями реплик и секций, ограничение 36 единиц поиска. 

|   | **1 секция** | **2 секции** | **3 секции** | **4 секции** | **6 секций** | **12 секций** |
| --- | --- | --- | --- | --- | --- | --- |
| **1 реплика** |1 ЕП |2 ЕП |3 ЕП |4 ЕП |6 ЕП |12 ЕП |
| **2 реплики** |2 ЕП |4 ЕП |6 ЕП |8 ЕП |12 ЕП |24 ЕП |
| **3 реплики** |3 ЕП |6 ЕП |9 ЕП |12 ЕП |18 ЕП |36 ЕП |
| **4 реплики** |4 ЕП |8 ЕП |12 ЕП |16 ЕП |24 ЕП |Н/Д |
| **5 реплик** |5 ЕП |10 ЕП |15 ЕП |20 ЕП |30 ЕП |Н/Д |
| **6 реплик** |6 ЕП |12 ЕП |18 ЕП |24 ЕП |36 ЕП |Н/Д |
| **12 реплик** |12 ЕП |24 ЕП |36 ЕП |Н/Д |Н/Д |Н/Д |

Подробные сведения о единицах поиска, ценах и объемах приведены на веб-сайте Azure. Дополнительные сведения см. на [странице с ценами](https://azure.microsoft.com/pricing/details/search/).

> [!NOTE]
> Количество реплик и секций должно быть делителем 12 (а именно 1, 2, 3, 4, 6, 12). Это связано с тем, что Поиск Azure предварительно делит каждый индекс на 12 сегментов, которые можно распределить равными частями по разделам. Например, если в вашей службе есть три секции и вы создаете индекс, то каждая секция будет содержать по четыре сегмента индекса. Способ, используемый службой поиска Azure для сегментации индекса, является задачей оптимизации и может быть изменен в будущих выпусках. Несмотря на то, что сегодня это число 12, вам не следует полагаться на то, что в будущем оно не изменится.
>


<a id="HA"></a>

## <a name="high-availability"></a>высокую доступность;
Поскольку задача масштабирования решается достаточно легко и быстро, на начальном этапе обычно рекомендуется использовать один раздел и одну или две реплики, увеличивая их количество по мере роста запросов. Рабочие нагрузки запросов в основном выполняются с репликами. Для повышения пропускной способности или обеспечения высокого уровня доступности вам, скорее всего, потребуется больше реплик.

Ниже приведены общие рекомендации для обеспечения высокой доступности.

* Две реплики для обеспечения высокой доступности рабочих нагрузок для чтения (запросов).
* Три или более реплик для обеспечения высокого уровня доступности рабочих нагрузок чтения и записи (запросов и индексирования по мере добавления, обновления или удаления отдельных документов).

Соглашения об уровне обслуживания для Поиска Azure используются для операций запросов и обновления индекса, которые состоят из добавления, обновления или удаления документов.

Категория "Базовый" ограничена одной секцией и тремя репликами. Если нужно оперативно реагировать на колебания требований к индексированию и пропускной способности запросов, рекомендуем использовать одну из категорий "Стандартный".  Если вы обнаружите, что значительно быстрее, чем пропускная способность запросов растут требования к хранилищу, рассмотрите один из уровней, оптимизированные для хранилища.

### <a name="index-availability-during-a-rebuild"></a>Доступность индексов во время повторного создания

Высокий уровень доступности для Поиска Azure относится к запросам и обновлению индексов, не требующих повторного создания индексов. Если вы удалите, переименуете поле или измените тип данных, индекс потребуется перестроить. Для этого его необходимо удалить, затем создать заново и повторно загрузить данные.

> [!NOTE]
> Можно добавить новые поля в индекс Поиска Azure, не перестраивая его. Значение нового поля будет равно NULL для всех документов, уже добавленных в индекс.

Чтобы обеспечить доступность индекса во время повторного создания, необходимо иметь копию индекса с другим именем в той же службе или копию индекса с таким же именем в другой службе, а затем обеспечить перенаправление или логику отработки отказа в коде.

## <a name="disaster-recovery"></a>Аварийное восстановление
В настоящее время встроенного механизма для аварийного восстановления не предусмотрено. Увеличение разделов или реплик для решения задач аварийного восстановления является ошибочной стратегией. Наиболее распространенным подходом является добавление избыточности на уровне службы за счет настройки второй службы поиска в другом регионе. Как и в случае с доступностью при повторном создании индекса, перенаправление и логику отработки отказа должен обеспечивать ваш код.

## <a name="increase-query-performance-with-replicas"></a>Увеличение производительности запросов с помощью реплик
Признаком необходимости добавления дополнительных реплик является задержка обработки запросов. Как правило, первым шагом к повышению производительности запросов является добавление этого ресурса. При добавлении новых реплик вы подключаете дополнительные копии индексов. В результате увеличивается допустимая рабочая нагрузка и обеспечивается распределение запросов между большим количеством реплик.

Мы не можем указать точное количество запросов в секунду (QPS), так как выполнение запроса во многом зависит от его сложности и конкурирующих рабочих нагрузок. Добавляя реплики, можно повысить производительность, но результат не обязательно будет линейным. Например, добавление трех реплик не гарантирует трехкратный рост пропускной способности.

Сведения об оценке QPS для рабочих нагрузок см. в статье [Рекомендации по производительности и оптимизации Поиска Azure](search-performance-optimization.md).

## <a name="increase-indexing-performance-with-partitions"></a>Увеличение производительности индексирования с помощью секций
Приложениям поиска, которым требуется обновления данных в режиме, близком к реальному времени, понадобится пропорционально больше секций, чем реплик. При добавлении секций операции чтения-записи распределяются среди большего количества вычислительных ресурсов. Оно также обеспечивает больше дискового пространства для хранения дополнительных индексов и документов.

Запрос больших индексов выполняется дольше. Поэтому может оказаться, что каждое добавочное увеличение числа секций потребует меньшего, но пропорционального увеличения числа реплик. Сложность запросов и их объем обусловливают скорость выполнения запросов.


## <a name="next-steps"></a>Дальнейшие действия

[Выберите ценовую категорию для службы поиска Azure](search-sku-tier.md)
