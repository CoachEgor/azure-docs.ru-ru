---
title: Настройка емкости для рабочих нагрузок запросов и индексов
titleSuffix: Azure Cognitive Search
description: Настройте ресурсы компьютера секционирования и реплики в Когнитивный поиск Azure, где цена за каждый ресурс оплачивается в оплачиваемых единицах поиска.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 02/14/2020
ms.openlocfilehash: e2ba5301b81b1a6f5de696ab4587cd8ff43e3c68
ms.sourcegitcommit: 6ee876c800da7a14464d276cd726a49b504c45c5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2020
ms.locfileid: "77462570"
---
# <a name="adjust-capacity-in-azure-cognitive-search"></a>Настройка емкости в Azure Когнитивный поиск

Перед [подготовкой службы поиска](search-create-service-portal.md) и блокировки в определенной ценовой категории Потратьте несколько минут, чтобы понять роль реплик и секций в службе, а также настроить службу для обеспечения пиковых нагрузок и распределения ресурсов по требованию.

Емкость — это функция [выбранного уровня](search-sku-tier.md) (уровни определяют характеристики оборудования), а также сочетание реплик и разделов, необходимых для проектируемой рабочей нагрузки. В зависимости от уровня и размера корректировки, добавление или уменьшение емкости может занять от 15 минут до нескольких часов. 

При изменении распределения реплик и секций рекомендуется использовать портал Azure. Портал применяет ограничения для допустимых сочетаний, которые остаются ниже максимальных пределов уровня. Однако если требуется подход к подготовке на основе сценариев или кода, [Azure PowerShell](search-manage-powershell.md) или [REST API управления](https://docs.microsoft.com/rest/api/searchmanagement/services) являются альтернативными решениями.

## <a name="terminology-replicas-and-partitions"></a>Терминология: реплики и секции

|||
|-|-|
|*Секции* | Служат для хранения индексов и ввода-вывода данных для операций чтения и записи (например, при повторном создании или обновлении индексов). Каждая секция имеет общую папку с индексом Total. При выделении трех секций индекс делится на сторонние. |
|*Реплики* | Экземпляры службы поиска, используемые главным образом для распределения операций запросов. Каждая реплика является одной копией индекса. При выделении трех реплик вы получите три копии индекса, доступные для обслуживания запросов запросов.|

## <a name="when-to-add-nodes"></a>Когда следует добавлять узлы

Изначально служба выделяет минимальный уровень ресурсов, состоящий из одной секции и одной реплики. 

Одна служба должна иметь достаточно ресурсов для обработки всех рабочих нагрузок (индексирования и запросов). Ни одна рабочая нагрузка не выполняется в фоновом режиме. Можно запланировать индексирование на время, когда запросы запросов естественным образом происходят реже, но служба не будет расставлять приоритеты для одной задачи поверх другой. Кроме того, определенный объем избыточности повышает производительность запросов при внутреннем обновлении служб или узлов.

Как правило, в приложениях поиска обычно требуется больше реплик, чем для секций, особенно когда операции службы перемещаются в рабочие нагрузки запросов. В разделе, посвященном [высокой доступности](#HA) , объясняется, почему так происходит.

Добавление дополнительных реплик или секций увеличивает затраты на запуск службы. Не забудьте проверить [Расчет цен](https://azure.microsoft.com/pricing/calculator/) , чтобы понять влияние добавления дополнительных узлов на выставление счетов. Приведенная [ниже диаграмма](#chart) поможет вам перекрестно ссылаться на количество единиц поиска, необходимых для конкретной конфигурации.

## <a name="how-to-allocate-replicas-and-partitions"></a>Как выделить реплики и секции

1. Войдите на [портал Azure](https://portal.azure.com/) и выберите службу поиска.

1. В разделе **Параметры**откройте страницу **масштаб** , чтобы изменить реплики и секции. 

   На следующем снимке экрана показана стандартная служба, подготовленная с одной репликой и секцией. В формуле внизу показано, сколько единиц поиска используется (1). Если цена за единицу была $100 (не реальная цена), ежемесячная стоимость запуска этой службы будет $100 в среднем.

   ![Страница "Масштаб" с текущими значениями](media/search-capacity-planning/1-initial-values.png "Страница "Масштаб" с текущими значениями")

1. Используйте ползунок, чтобы увеличить или уменьшить количество секций. В формуле внизу показано, сколько единиц поиска используется.

   В этом примере удваивается емкость с двумя репликами и секциями. Обратите внимание на число единиц поиска. Теперь это четыре, так как формула выставления счетов — это реплики, умноженные на секции (2 x 2). Удвоение емкости больше, чем удвоение стоимости запуска службы. Если цена за единицу поиска была $100, новый ежемесячный счет теперь будет $400.

   Текущие затраты на единицу каждого уровня см. на [странице цен](https://azure.microsoft.com/pricing/details/search/).

   ![Добавление реплик и секций](media/search-capacity-planning/2-add-2-each.png "Добавление реплик и секций")

1. Нажмите кнопку **сохранить** , чтобы подтвердить изменения.

   ![Подтверждение изменений для масштабирования и выставления счетов](media/search-capacity-planning/3-save-confirm.png "Подтверждение изменений для масштабирования и выставления счетов")

   Для выполнения изменений в емкости требуется несколько часов. Нельзя отменить после запуска процесса, и в режиме реального времени не будет выполняться мониторинг реплик и секций. Однако следующее сообщение остается видимым во время внесения изменений.

   ![Сообщение о состоянии на портале](media/search-capacity-planning/4-updating.png "Сообщение о состоянии на портале")

> [!NOTE]
> После подготовки службы ее нельзя обновить до более высокого уровня. Вам нужно будет создать службу поиска на новом уровне и перезагрузить индексы. Дополнительные сведения о подготовке службы см. [в статье Создание службы когнитивный Поиск Azure на портале](search-create-service-portal.md) .
>
> Кроме того, разделы и реплики управляются исключительно и внутренне службой. Нет концепции сходства процессоров или назначения рабочей нагрузки конкретному узлу.
>

<a id="chart"></a>

## <a name="partition-and-replica-combinations"></a>сочетания разделов и реплик

На уровне "Базовый" служба может иметь только одну секцию и до трех реплик. Таким образом, максимальное количество единиц поиска составляет три. Единственным ресурсом, который можно изменять, являются реплики. Требуется не менее двух реплик, чтобы обеспечить высокий уровень доступности при обработке запросов.

Все стандартные и оптимизированные для хранилища службы поиска могут принимать следующие сочетания реплик и секций с ограничением в 36-SU. 

|   | **1 секция** | **2 секции** | **3 секции** | **4 секции** | **6 секций** | **12 секций** |
| --- | --- | --- | --- | --- | --- | --- |
| **1 реплика** |1 ЕП |2 ЕП |3 ЕП |4 ЕП |6 ЕП |12 ЕП |
| **2 реплики** |2 ЕП |4 ЕП |6 ЕП |8 ЕП |12 ЕП |24 ЕП |
| **3 реплики** |3 ЕП |6 ЕП |9 ЕП |12 ЕП |18 ЕП |36 ЕП |
| **4 реплики** |4 ЕП |8 ЕП |12 ЕП |16 ЕП |24 ЕП |Н/Д |
| **5 реплик** |5 ЕП |10 ЕП |15 ЕП |20 ЕП |30 ЕП |Н/Д |
| **6 реплик** |6 ЕП |12 ЕП |18 ЕП |24 ЕП |36 ЕП |Н/Д |
| **12 реплик** |12 ЕП |24 ЕП |36 ЕП |Н/Д |Н/Д |Н/Д |

Подробные сведения о единицах поиска, ценах и объемах приведены на веб-сайте Azure. Дополнительные сведения см. на [странице с ценами](https://azure.microsoft.com/pricing/details/search/).

> [!NOTE]
> Количество реплик и секций должно быть делителем 12 (а именно 1, 2, 3, 4, 6, 12). Это связано с тем, что Azure Когнитивный поиск предварительно делит каждый индекс на 12 сегментов, чтобы его можно было распределять по всем секциям в равных частях. Например, если в вашей службе есть три секции и вы создаете индекс, то каждая секция будет содержать по четыре сегмента индекса. Как Azure Когнитивный поиск сегментирование индекса — это сведения о реализации, которые могут быть изменены в будущих выпусках. Несмотря на то, что сегодня это число 12, вам не следует полагаться на то, что в будущем оно не изменится.
>

<a id="HA"></a>

## <a name="high-availability"></a>Высокий уровень доступности

Поскольку задача масштабирования решается достаточно легко и быстро, на начальном этапе обычно рекомендуется использовать один раздел и одну или две реплики, увеличивая их количество по мере роста запросов. Рабочие нагрузки запросов в основном выполняются с репликами. Для повышения пропускной способности или обеспечения высокого уровня доступности вам, скорее всего, потребуется больше реплик.

Ниже приведены общие рекомендации для обеспечения высокой доступности.

* Две реплики для обеспечения высокой доступности рабочих нагрузок для чтения (запросов).

* Три или более реплик для обеспечения высокого уровня доступности рабочих нагрузок чтения и записи (запросов и индексирования по мере добавления, обновления или удаления отдельных документов).

Соглашения об уровне обслуживания (SLA) для Azure Когнитивный поиск предназначены для операций запросов и обновлений индекса, состоящих из добавления, обновления или удаления документов.

Категория "Базовый" ограничена одной секцией и тремя репликами. Если нужно оперативно реагировать на колебания требований к индексированию и пропускной способности запросов, рекомендуем использовать одну из категорий "Стандартный".  Если вы обнаружите, что требования к хранилищу увеличиваются гораздо быстрее, чем пропускная способность запроса, рассмотрите один из уровней, оптимизированных для хранилища.

## <a name="disaster-recovery"></a>Аварийное восстановление

В настоящее время встроенного механизма для аварийного восстановления не предусмотрено. Увеличение разделов или реплик для решения задач аварийного восстановления является ошибочной стратегией. Наиболее распространенным подходом является добавление избыточности на уровне службы за счет настройки второй службы поиска в другом регионе. Как и в случае с доступностью при повторном создании индекса, перенаправление и логику отработки отказа должен обеспечивать ваш код.

## <a name="estimate-replicas"></a>Оценка реплик

В рабочей службе необходимо выделить три реплики для целей соглашения об уровне обслуживания. При низкой производительности запросов можно добавить реплики, чтобы дополнительные копии индекса перевелися в оперативный режим для поддержки большего количества рабочих нагрузок запросов и балансировки нагрузки запросов по нескольким репликам.

Мы не предоставляем рекомендации по количеству реплик, необходимых для загрузки запросов. Производительность запросов зависит от сложности запроса и конкурирующих рабочих нагрузок. Добавляя реплики, можно повысить производительность, но результат не обязательно будет линейным. Например, добавление трех реплик не гарантирует трехкратный рост пропускной способности.

Рекомендации по оценке QPS для вашего решения см. в статье [масштабирование для производительности](search-performance-optimization.md)и [мониторинга запросов](search-monitor-queries.md) .

## <a name="estimate-partitions"></a>Оценка секций

Выбранный [уровень](search-sku-tier.md) определяет размер и скорость секции, и каждый уровень оптимизирован по набору характеристик, соответствующих различным сценариям. При выборе более высокого уровня может потребоваться меньше секций, чем при переходе на S1. Один из вопросов, на которые нужно ответить при самостоятельном тестировании, — это увеличение и повышение производительности секции, что повышает производительность, чем две более дешевые секции в службе, подготовленные на более низком уровне.

Приложениям поиска, которым требуется обновления данных в режиме, близком к реальному времени, понадобится пропорционально больше секций, чем реплик. При добавлении секций операции чтения-записи распределяются среди большего количества вычислительных ресурсов. Оно также обеспечивает больше дискового пространства для хранения дополнительных индексов и документов.

Запрос больших индексов выполняется дольше. Поэтому может оказаться, что каждое добавочное увеличение числа секций потребует меньшего, но пропорционального увеличения числа реплик. Сложность запросов и их объем обусловливают скорость выполнения запросов.

## <a name="next-steps"></a>Следующие шаги

> [!div class="nextstepaction"]
> [Выберите ценовую категорию для Azure Когнитивный поиск](search-sku-tier.md)