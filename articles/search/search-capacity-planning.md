---
title: Масштабирование рабочих нагрузок запросов и индексов
titleSuffix: Azure Cognitive Search
description: Настройте ресурсы компьютера секционирования и реплики в Когнитивный поиск Azure, где цена за каждый ресурс оплачивается в оплачиваемых единицах поиска.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 11/04/2019
ms.openlocfilehash: 4020a40b87c32bdbd07e390a0d04769cb3d47f7d
ms.sourcegitcommit: 598c5a280a002036b1a76aa6712f79d30110b98d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/15/2019
ms.locfileid: "74112124"
---
# <a name="scale-up-partitions-and-replicas-to-add-capacity-for-query-and-index-workloads-in-azure-cognitive-search"></a>Масштабирование разделов и реплик для увеличения емкости рабочих нагрузок запросов и индексов в Azure Когнитивный поиск

После [выбора ценовой категории](search-sku-tier.md) и [подготовки службы поиска](search-create-service-portal.md) следующим шагом является необязательное увеличение количества реплик или секций, используемых службой. Каждый уровень предоставляет фиксированное число единиц выставления счетов. В этой статье объясняется, как выделять эти единицы для достижения оптимальной конфигурации, позволяющей сбалансировать ваши требования к для выполнению запросов, индексированию и хранению данных.

Конфигурация ресурсов доступна при настройке службы на уровне " [базовый](https://aka.ms/azuresearchbasic) " или на одном из [уровней "Стандартный" или "оптимизировано для хранилища](search-limits-quotas-capacity.md)". Для всех служб на этих уровнях емкость приобретается в *единицах поиска*, где каждая секция и реплика принимается за одну единицу поиска. 

Чем меньше используется единиц поиска, тем меньше выставляется счет. Оплата осуществляется на протяжении всего периода настройки службы. Чтобы не платить за службу, которую вы временно не используете, вам нужно удалить ее, а затем при необходимости создать снова.

> [!Note]
> Удаление службы приводит к удалению всех связанных с ней компонентов. В Azure Когнитивный поиск нет средств для резервного копирования и восстановления сохраненных данных поиска. Чтобы повторно развернуть существующий индекс в новой службе, необходимо запустить программу, которая изначально использовалась для его создания и загрузки. 

## <a name="terminology-replicas-and-partitions"></a>Терминология: реплики и секции
Реплики и секции — это основные ресурсы, которые поддерживают службу поиска.

| Resource (Ресурс) | Определение |
|----------|------------|
|*Секции* | Служат для хранения индексов и ввода-вывода данных для операций чтения и записи (например, при повторном создании или обновлении индексов).|
|*Реплики* | Экземпляры службы поиска, используемые главным образом для распределения операций запросов. На каждой реплике всегда размещается одна копия индекса. Если у вас есть 12 реплик, в службу будет загружено 12 копий каждого индекса.|

> [!NOTE]
> Невозможно напрямую выбрать или определить, какие индексы будут запущены в реплике. Одна копия каждого индекса в каждой реплике является частью архитектуры службы.
>


## <a name="how-to-allocate-replicas-and-partitions"></a>Как выделить реплики и секции
В Azure Когнитивный поиск Служба изначально выделяет минимальный уровень ресурсов, состоящий из одной секции и одной реплики. Для уровней, которые поддерживают службу, вы можете постепенно корректировать вычислительные ресурсы, увеличивая количество секций, если вам нужно больше места для хранения и операций ввода-вывода, или добавляя реплики, чтобы увеличить объем запросов или повысить производительность. Одна служба должна иметь достаточно ресурсов для обработки всех рабочих нагрузок (индексирования и запросов). Нельзя разделить рабочие нагрузки между несколькими службами.

Для увеличения или изменения количества выделенных реплик или секций мы рекомендуем использовать портал Azure. Портал применяет ограничения для допустимых сочетаний, которые остаются ниже максимальных ограничений. Если требуется подход к подготовке на основе сценария или кода, [Azure PowerShell](search-manage-powershell.md) или [REST API управления](https://docs.microsoft.com/rest/api/searchmanagement/services) являются альтернативными решениями.

Как правило, приложениям поиска требуется больше реплик, чем секций, особенно если операции службы смещаются в сторону рабочей нагрузки запросов. В разделе, посвященном [высокой доступности](#HA) , объясняется, почему так происходит.

1. Войдите на [портал Azure](https://portal.azure.com/) и выберите службу поиска.

2. В разделе **Параметры**откройте страницу **масштаб** , чтобы изменить реплики и секции. 

   На следующем снимке экрана показана стандартная служба, подготовленная с одной репликой и секцией. В формуле внизу показано, сколько единиц поиска используется (1). Если цена за единицу была $100 (не реальная цена), ежемесячная стоимость запуска этой службы будет $100 в среднем.

   ![Страница "Масштаб" с текущими значениями](media/search-capacity-planning/1-initial-values.png "Страница "Масштаб" с текущими значениями")

3. Используйте ползунок, чтобы увеличить или уменьшить количество секций. В формуле внизу показано, сколько единиц поиска используется.

   В этом примере удваивается емкость с двумя репликами и секциями. Обратите внимание на число единиц поиска. Теперь это четыре, так как формула выставления счетов — это реплики, умноженные на секции (2 x 2). Удвоение емкости больше, чем удвоение стоимости запуска службы. Если цена за единицу поиска была $100, новый ежемесячный счет теперь будет $400.

   Текущие затраты на единицу каждого уровня см. на [странице цен](https://azure.microsoft.com/pricing/details/search/).

   ![Добавление реплик и секций](media/search-capacity-planning/2-add-2-each.png "Добавление реплик и секций")

3. Нажмите кнопку **сохранить** , чтобы подтвердить изменения.

   ![Подтверждение изменений для масштабирования и выставления счетов](media/search-capacity-planning/3-save-confirm.png "Подтверждение изменений для масштабирования и выставления счетов")

   Для выполнения изменений в емкости требуется несколько часов. Нельзя отменить после запуска процесса, и в режиме реального времени не будет выполняться мониторинг реплик и секций. Однако следующее сообщение остается видимым во время внесения изменений.

   ![Сообщение о состоянии на портале](media/search-capacity-planning/4-updating.png "Сообщение о состоянии на портале")


> [!NOTE]
> После подготовки службы ее невозможно обновить до более высокого SKU. Вам нужно будет создать службу поиска на новом уровне и перезагрузить индексы. Дополнительные сведения о подготовке службы см. [в статье Создание службы когнитивный Поиск Azure на портале](search-create-service-portal.md) .
>
>

<a id="chart"></a>

## <a name="partition-and-replica-combinations"></a>сочетания разделов и реплик

На уровне "Базовый" служба может иметь только одну секцию и до трех реплик. Таким образом, максимальное количество единиц поиска составляет три. Единственным ресурсом, который можно изменять, являются реплики. Требуется не менее двух реплик, чтобы обеспечить высокий уровень доступности при обработке запросов.

Все стандартные и оптимизированные для хранилища службы поиска могут принимать следующие сочетания реплик и секций с ограничением в 36-SU. 

|   | **1 секция** | **2 секции** | **3 секции** | **4 секции** | **6 секций** | **12 секций** |
| --- | --- | --- | --- | --- | --- | --- |
| **1 реплика** |1 ЕП |2 ЕП |3 ЕП |4 ЕП |6 ЕП |12 ЕП |
| **2 реплики** |2 ЕП |4 ЕП |6 ЕП |8 ЕП |12 ЕП |24 ЕП |
| **3 реплики** |3 ЕП |6 ЕП |9 ЕП |12 ЕП |18 ЕП |36 ЕП |
| **4 реплики** |4 ЕП |8 ЕП |12 ЕП |16 ЕП |24 ЕП |Недоступно |
| **5 реплик** |5 ЕП |10 ЕП |15 ЕП |20 ЕП |30 ЕП |Недоступно |
| **6 реплик** |6 ЕП |12 ЕП |18 ЕП |24 ЕП |36 ЕП |Недоступно |
| **12 реплик** |12 ЕП |24 ЕП |36 ЕП |Недоступно |Недоступно |Недоступно |

Подробные сведения о единицах поиска, ценах и объемах приведены на веб-сайте Azure. Дополнительные сведения см. на [странице с ценами](https://azure.microsoft.com/pricing/details/search/).

> [!NOTE]
> Количество реплик и секций должно быть делителем 12 (а именно 1, 2, 3, 4, 6, 12). Это связано с тем, что Azure Когнитивный поиск предварительно делит каждый индекс на 12 сегментов, чтобы его можно было распределять по всем секциям в равных частях. Например, если в вашей службе есть три секции и вы создаете индекс, то каждая секция будет содержать по четыре сегмента индекса. Как Azure Когнитивный поиск сегментирование индекса — это сведения о реализации, которые могут быть изменены в будущих выпусках. Несмотря на то, что сегодня это число 12, вам не следует полагаться на то, что в будущем оно не изменится.
>


<a id="HA"></a>

## <a name="high-availability"></a>высокой доступности
Поскольку задача масштабирования решается достаточно легко и быстро, на начальном этапе обычно рекомендуется использовать один раздел и одну или две реплики, увеличивая их количество по мере роста запросов. Рабочие нагрузки запросов в основном выполняются с репликами. Для повышения пропускной способности или обеспечения высокого уровня доступности вам, скорее всего, потребуется больше реплик.

Ниже приведены общие рекомендации для обеспечения высокой доступности.

* Две реплики для обеспечения высокой доступности рабочих нагрузок для чтения (запросов).

* Три или более реплик для обеспечения высокого уровня доступности рабочих нагрузок чтения и записи (запросов и индексирования по мере добавления, обновления или удаления отдельных документов).

Соглашения об уровне обслуживания (SLA) для Azure Когнитивный поиск предназначены для операций запросов и обновлений индекса, состоящих из добавления, обновления или удаления документов.

Категория "Базовый" ограничена одной секцией и тремя репликами. Если нужно оперативно реагировать на колебания требований к индексированию и пропускной способности запросов, рекомендуем использовать одну из категорий "Стандартный".  Если вы обнаружите, что требования к хранилищу увеличиваются гораздо быстрее, чем пропускная способность запроса, рассмотрите один из уровней, оптимизированных для хранилища.

### <a name="index-availability-during-a-rebuild"></a>Доступность индексов во время повторного создания

Высокий уровень доступности Когнитивный поиск Azure относится к запросам и обновлениям индексов, которые не требуют перестроения индекса. Если вы удалите, переименуете поле или измените тип данных, индекс потребуется перестроить. Для этого его необходимо удалить, затем создать заново и повторно загрузить данные.

> [!NOTE]
> Вы можете добавлять новые поля в индекс Когнитивный поиск Azure без перестроения индекса. Значение нового поля будет равно NULL для всех документов, уже добавленных в индекс.

Чтобы обеспечить доступность индекса во время повторного создания, необходимо иметь копию индекса с другим именем в той же службе или копию индекса с таким же именем в другой службе, а затем обеспечить перенаправление или логику отработки отказа в коде.

## <a name="disaster-recovery"></a>Аварийное восстановление
В настоящее время встроенного механизма для аварийного восстановления не предусмотрено. Увеличение разделов или реплик для решения задач аварийного восстановления является ошибочной стратегией. Наиболее распространенным подходом является добавление избыточности на уровне службы за счет настройки второй службы поиска в другом регионе. Как и в случае с доступностью при повторном создании индекса, перенаправление и логику отработки отказа должен обеспечивать ваш код.

## <a name="increase-query-performance-with-replicas"></a>Увеличение производительности запросов с помощью реплик
Признаком необходимости добавления дополнительных реплик является задержка обработки запросов. Как правило, первым шагом к повышению производительности запросов является добавление этого ресурса. При добавлении новых реплик вы подключаете дополнительные копии индексов. В результате увеличивается допустимая рабочая нагрузка и обеспечивается распределение запросов между большим количеством реплик.

Мы не можем указать точное количество запросов в секунду (QPS), так как выполнение запроса во многом зависит от его сложности и конкурирующих рабочих нагрузок. Добавляя реплики, можно повысить производительность, но результат не обязательно будет линейным. Например, добавление трех реплик не гарантирует трехкратный рост пропускной способности.

Рекомендации по оценке QPS для рабочих нагрузок см. в статье [вопросы производительности и оптимизации в Azure когнитивный Поиск](search-performance-optimization.md).

## <a name="increase-indexing-performance-with-partitions"></a>Увеличение производительности индексирования с помощью секций
Приложениям поиска, которым требуется обновления данных в режиме, близком к реальному времени, понадобится пропорционально больше секций, чем реплик. При добавлении секций операции чтения-записи распределяются среди большего количества вычислительных ресурсов. Оно также обеспечивает больше дискового пространства для хранения дополнительных индексов и документов.

Запрос больших индексов выполняется дольше. Поэтому может оказаться, что каждое добавочное увеличение числа секций потребует меньшего, но пропорционального увеличения числа реплик. Сложность запросов и их объем обусловливают скорость выполнения запросов.


## <a name="next-steps"></a>Дополнительная информация

[Выберите ценовую категорию для Azure Когнитивный поиск](search-sku-tier.md)
