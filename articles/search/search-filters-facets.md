---
title: Фильтры Facet для поиска навигации в приложениях
titleSuffix: Azure Cognitive Search
description: Критерии фильтрации по ипотированности пользователя, геолокации или численным значениям для снижения результатов поиска по запросам в Azure Cognitive Search, сервисе поиска облаков в Microsoft Azure.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 11/04/2019
ms.openlocfilehash: 082575a67ea43d62f322e177cff087e5bd572c27
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "72792894"
---
# <a name="how-to-build-a-facet-filter-in-azure-cognitive-search"></a>Как создать фильтр граней в Azure Cognitive Search 

Faceted навигация используется для самостоятельной фильтрации результатов запроса в поисковом приложении, где приложение предлагает элементы управления доступом для поиска групп документов (например, категорий или брендов), а Azure Cognitive Search предоставляет структуру данных поддержать опыт. В этой статье кратко рассматриваются основные шаги для создания структуры фасетной навигации с возможностями поиска, которые вы хотите предоставить. 

> [!div class="checklist"]
> * Выбор полей для фильтрации и фасетизации
> * Указание атрибутов поля
> * Построение индекса и загрузка данных
> * Добавление фильтров аспектов в запрос
> * Обработка результатов

Аспекты являются динамическими и возвращаются в запросе. В ответах поиска приводятся фасетные категории, используемые для навигации по результатам. Если вы не знакомы с аспектами, ниже приведен пример структуры фасетной навигации.

  ![](./media/search-filters-facets/facet-nav.png)

Хотите подробнее узнать о фасетной навигации? [Узнайте, как реализовать граненые навигации в Azure Cognitive Search](search-faceted-navigation.md).

## <a name="choose-fields"></a>Выбор полей

Аспекты могут быть вычислены для отдельных полей значений, а также для коллекций. Поля, которые лучше всего работают в граненой навигации, имеют низкую кардинальность: небольшое количество различных значений, которые повторяются в документах в корпусе поиска (например, список цветов, стран/регионов или фирменных наименований). 

Лицом конвключилка включена на поле за полевым `facetable` уровнем `true`при создании индекса, установив атрибут. Как правило, необходимо `filterable` также `true` настроить атрибут для таких полей, чтобы поисковое приложение могли фильтровать на этих полях на основе граней, которые выбирает конечный пользователь. 

При создании индекса с использованием REST API любой [тип поля,](https://docs.microsoft.com/rest/api/searchservice/supported-data-types) который `facetable` может быть использован в граненых навигациях, по умолчанию по умолчанию обозначен:

+ `Edm.String`
+ `Edm.DateTimeOffset`
+ `Edm.Boolean`
+ Типы численных `Edm.Int32` `Edm.Int64`полей: ,`Edm.Double`
+ Коллекции вышеуказанных типов `Collection(Edm.String)` (например, или `Collection(Edm.Double)`)

Вы не `Edm.GeographyPoint` `Collection(Edm.GeographyPoint)` можете использовать или поля в граненой навигации. Facets лучше всего работать на полях с низкой кардинальности. Из-за разрешения геокоординатов, редко, что любые два набора координат будет равен в данном наборе данных. Таким образом аспекты не поддерживаются для географических координат. Вам понадобится поле города или региона для поиска по местоположению с использованием фасетизации.

## <a name="set-attributes"></a>Определение атрибутов

Атрибуты индекса, которые управляют использованием поля, добавляются к отдельным определениям полей в индексе. В следующем примере поля с низкой кардинальностью, полезные для гране, состоят из: `category` (отель, мотель, хостел), `tags`и `rating`. Эти поля `filterable` имеют `facetable` четко ею и атрибуты, четко установленные в следующем примере для иллюстративных целей. 

> [!Tip]
> Для оптимизации производительности и хранения отключите фасетизацию для полей, которые никогда не должны использоваться в качестве аспектов. В частности, следует установить полей строки для уникальных `"facetable": false` значений, таких как идентификатор или название продукта, чтобы предотвратить их случайное (и неэффективное) использование в граненой навигации.


```json
{
  "name": "hotels",  
  "fields": [
    { "name": "hotelId", "type": "Edm.String", "key": true, "searchable": false, "sortable": false, "facetable": false },
    { "name": "baseRate", "type": "Edm.Double" },
    { "name": "description", "type": "Edm.String", "filterable": false, "sortable": false, "facetable": false },
    { "name": "description_fr", "type": "Edm.String", "filterable": false, "sortable": false, "facetable": false, "analyzer": "fr.lucene" },
    { "name": "hotelName", "type": "Edm.String", "facetable": false },
    { "name": "category", "type": "Edm.String", "filterable": true, "facetable": true },
    { "name": "tags", "type": "Collection(Edm.String)", "filterable": true, "facetable": true },
    { "name": "parkingIncluded", "type": "Edm.Boolean",  "filterable": true, "facetable": true, "sortable": false },
    { "name": "smokingAllowed", "type": "Edm.Boolean", "filterable": true, "facetable": true, "sortable": false },
    { "name": "lastRenovationDate", "type": "Edm.DateTimeOffset" },
    { "name": "rating", "type": "Edm.Int32", "filterable": true, "facetable": true },
    { "name": "location", "type": "Edm.GeographyPoint" }
  ]
}
```

> [!Note]
> Это определение индекса скопировано из [создания индекса когнитивного поиска Azure с помощью REST API.](https://docs.microsoft.com/azure/search/search-create-index-rest-api) Оно идентично, за исключением поверхностных различий в определениях полей. `filterable` Атрибуты `facetable` и атрибуты явно `category` `tags`добавляются `smokingAllowed`на `rating` , , `parkingIncluded`, и и поля. На практике `filterable` `facetable` и будет включен по умолчанию на этих полях при использовании REST API. При использовании .NET SDK эти атрибуты должны быть включены явно.

## <a name="build-and-load-an-index"></a>Построение и загрузка индекса

Промежуточным (и, возможно, очевидным) шагом является [сборка и заполнение индекса](https://docs.microsoft.com/azure/search/search-get-started-dotnet#1---create-index) перед формулировкой запроса. Здесь мы упомянем этот шаг для полноты картины. Один из способов определить доступность индекса — это проверить список индексов на [портале](https://portal.azure.com).

## <a name="add-facet-filters-to-a-query"></a>Добавление фильтров аспектов в запрос

В коде приложения создайте запрос, который определяет все части допустимого запроса, включая выражения поиска, фасеты, фильтры, профили оценки — все, что используется для формулировки запроса. В следующем примере создается запрос, применяемый для фасетной навигации с использованием фасетов размещения, рейтинга и других удобств.

```csharp
var sp = new SearchParameters()
{
    ...
    // Add facets
    Facets = new[] { "category", "rating", "parkingIncluded", "smokingAllowed" }.ToList()
};
```

### <a name="return-filtered-results-on-click-events"></a>Возврат отфильтрованных результатов при событии щелчка

Когда конечный пользователь нажимает на значение граней, обработчик для события щелчка должен использовать выражение фильтра для реализации намерения пользователя. Учитывая `category` грань, нажав категории "мотель" реализуется с выражением, `$filter` которое выбирает жилье этого типа. Когда пользователь нажимает кнопку "мотель", чтобы указать, что должны `$filter=category eq 'motel'`быть показаны только мотели, следующий запрос, который отправляет приложение, включает в себя.

Следующий фрагмент кода добавляет категорию в фильтр, если пользователь выбирает значение из фасета категории.

```csharp
if (!String.IsNullOrEmpty(categoryFacet))
    filter = $"category eq '{categoryFacet}'";
```

Если пользователь нажимает на значение граней `tags`для поля сбора, например значение "бассейн", приложение должно использовать следующий синтаксис фильтра:`$filter=tags/any(t: t eq 'pool')`

## <a name="tips-and-workarounds"></a>Советы и обходные решения

### <a name="initialize-a-page-with-facets-in-place"></a>Инициализация страницы с помощью фасетов

Если требуется инициализировать страницу с помощью фасетов, вы можете отправить запрос как часть инициализации страницы, чтобы заполнить страницу исходной структурой фасета.

### <a name="preserve-a-facet-navigation-structure-asynchronously-of-filtered-results"></a>Асинхронное сохранение структуры фасетной навигации отфильтрованных результатов

Одна из проблем, связанных с фазой навигации в Azure Cognitive Search, заключается в том, что аспекты существуют только для текущих результатов. На практике обычно сохраняется статический набор фасетов, чтобы пользователь мог перемещаться в обратном направлении, проходя по поисковому содержимому для поиска альтернативных путей. 

Хотя это распространенный вариант использования, структура фасетной навигации в настоящее время не предоставляет этого изначально. Разработчики, которым требуются статические аспекты, обычно обходят ограничение, выполняя два отфильтрованных запроса: один в пределах результатов, а другой для создания статического списка аспектов для навигации.

## <a name="see-also"></a>См. также

+ [Фильтры в когнитивном поиске Azure](search-filters.md)
+ [Create Index (Azure Search Service REST API)](https://docs.microsoft.com/rest/api/searchservice/create-index) (Создание индексов (REST API службы "Поиск Azure")).
+ [Поиск документов REST API](https://docs.microsoft.com/rest/api/searchservice/search-documents)
