---
title: Общие сведения о сходстве и оценке
titleSuffix: Azure Cognitive Search
description: Описываются основные понятия сходства и оценки, а также действия, которые разработчик может выполнить для настройки результатов оценки.
manager: nitinme
author: luiscabrer
ms.author: luisca
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 04/27/2020
ms.openlocfilehash: 00cf806bf6575fd96af435abf8d0b3dd8734338a
ms.sourcegitcommit: 50673ecc5bf8b443491b763b5f287dde046fdd31
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/20/2020
ms.locfileid: "83679659"
---
# <a name="similarity-and-scoring-in-azure-cognitive-search"></a>Сходство и оценка в Когнитивном поиске Azure

Оценка — это вычисление оценки поиска для всех элементов, возвращенных в результатах поиска, для запросов полнотекстового поиска. Это показатель релевантности элемента в контексте текущей операции поиска. Чем выше оценка, тем более релевантен элемент. Элементы в результатах поиска упорядочиваются по рангу (от наивысшего до наинизшего) на основе оценок поиска, вычисленных для каждого элемента. 

По умолчанию в ответе возвращаются первые 50 элементов, но можно использовать параметр **$top**, чтобы вернуть меньше или больше элементов (до 1000 в одном ответе) и параметр **$skip**, чтобы получить следующий набор результатов.

Оценка поиска вычисляется на основе статистических свойств данных и запроса. Когнитивный поиск Azure находит документы, соответствующие условиям поиска (некоторые или все в зависимости от [searchMode](https://docs.microsoft.com/rest/api/searchservice/search-documents#searchmodeany--all-optional)), отдавая предпочтение документам, которые содержат несколько экземпляров условия поиска. Оценка поиска возрастает, если условие поиска редко встречается в индексе данных, но часто — внутри документа. Основу для такого подхода к вычислению релевантности называют *TF-IDF* или частотой условия — инверсная частота в документе.

Значения оценки поиска в результирующем наборе могут повторяться. Если у нескольких совпадений одинаковая оценка поиска, порядок сортировки элементов не определен и не является стабильным. Выполните запрос еще раз, и, возможно, позиции элементов изменятся, особенно если вы используете бесплатную службу или оплачиваемую службу с несколькими репликами. Если есть два элемента с одинаковой оценкой, невозможно определить, какой из них отобразится первым.

Если вы хотите разорвать связь между повторяющимися оценками, вы можете добавить предложение **$orderby**, чтобы упорядочить элементы по оценке, а затем упорядочить по другому сортируемому полю (например, `$orderby=search.score() desc,Rating desc`). Дополнительные сведения см. в статье [Синтаксис $orderby OData в Когнитивном поиске Azure](https://docs.microsoft.com/azure/search/search-query-odata-orderby).

> [!NOTE]
> `@search.score = 1.00` указывает на результирующий набор без оценивания или без ранжирования. Оценка одинакова для всех результатов. Не оцениваемые результаты появляются, когда в форме запроса используется поиск нечетких соответствий, запросы с подстановочными знаками или регулярными выражениями либо выражение **$filter**. 

## <a name="scoring-profiles"></a>Профили оценки

Вы можете настроить способ ранжирования различных полей, определив пользовательский *профиль повышения*. Профили оценки позволяют управлять приоритетом элементов в результатах поиска. Например, может потребоваться повысить приоритет элементов на основе потенциального дохода, повысить уровень более новых элементов или, возможно, элементов, которые слишком долго находились на складе. 

Профиль повышения — часть определения индекса, состоящая из взвешенных полей, функций и параметров. Дополнительные сведения о таком определении см. в статье [Добавление профилей повышения в индекс службы Когнитивного поиска Azure](index-add-scoring-profiles.md).

<a name="scoring-statistics"></a>

## <a name="scoring-statistics-and-sticky-sessions-preview"></a>Статистика оценки и прикрепленные сеансы (предварительная версия)

Для обеспечения масштабируемости Когнитивный поиск Azure распределяет каждый индекс горизонтально через процесс сегментирования. Это означает, что части индекса физически разделены.

По умолчанию оценка документа вычисляется на основе статистических свойств данных *в сегменте*. Этот подход, как правило, не является проблемой для большого объема данных. Он обеспечивает лучшую производительность, чем вычисление оценки на основе информации по всем сегментам. Тем не менее, использование этой оптимизации производительности может привести к тому, что два очень похожих (или даже идентичных) документа будут иметь разные оценки релевантности, если они окажутся в разных сегментах.

Если вы предпочитаете вычислять оценку на основе статистических свойств всех сегментов, вы можете сделать это, добавив *scoringStatistics=global* в качестве [параметра запроса](https://docs.microsoft.com/rest/api/searchservice/search-documents) (или добавив *"scoringStatistics": "global"* в качестве параметра текста [запроса](https://docs.microsoft.com/rest/api/searchservice/search-documents)).

```http
GET https://[service name].search.windows.net/indexes/[index name]/docs?scoringStatistics=global&api-version=2019-05-06-Preview&search=[search term]
  Content-Type: application/json
  api-key: [admin or query key]  
```
Использование scoringStatistics гарантирует, что все сегменты в одной реплике обеспечивают одинаковые результаты. Тем не менее, разные реплики могут немного отличаться друг от друга, так как они всегда обновляются с последними изменениями в индексе. В некоторых случаях вам может потребоваться, чтобы пользователи во время "сеанса запроса" получали более согласованные результаты. В таких случаях вы можете предоставить `sessionId` как часть запросов. `sessionId` является уникальной строкой, которую вы создаете для ссылки на уникальный сеанс пользователя.

```http
GET https://[service name].search.windows.net/indexes/[index name]/docs?sessionId=[string]&api-version=2019-05-06-Preview&search=[search term]
  Content-Type: application/json
  api-key: [admin or query key]  
```
Пока используется та же самая строка `sessionId`, будет предпринята максимальная попытка нацеливания на одну и ту же реплику, что повысит согласованность результатов, которые увидят пользователи. 

> [!NOTE]
> Повторное использование одних и тех же значений `sessionId` может повлиять на балансировку нагрузки запросов по репликам, а также негативно повлиять на производительность службы поиска. Значение, используемое в качестве sessionId, не может начинаться с символа "_".

## <a name="similarity-ranking-algorithms"></a>Алгоритмы ранжирования сходства

Когнитивный поиск Azure поддерживает два различных алгоритма ранжирования сходства: *классический алгоритм сходства* и официальную реализацию алгоритма *Okapi BM25* (в настоящее время доступного в предварительной версии). Классический алгоритм сходства является алгоритмом по умолчанию. Однако начиная с 15 июля, все новые службы, созданные после этой даты, используют новый алгоритм BM25. Это единственный алгоритм, который доступен для новых служб.

Сейчас вы можете указать, какой алгоритм ранжирования сходства вы хотели бы использовать. Дополнительные сведения см. в статье [Алгоритм ранжирования в Когнитивном поиске Azure](index-ranking-similarity.md).

В следующем фрагменте видео приведено краткое описание алгоритмов ранжирования, которые используются в Когнитивном поиске Azure. Дополнительные сведения можно получить, просмотрев полное видео.

> [!VIDEO https://www.youtube.com/embed/Y_X6USgvB1g?version=3&start=322&end=643]

## <a name="see-also"></a>См. также раздел

 [Добавление профилей повышения в индекс службы Когнитивного поиска Azure](index-add-scoring-profiles.md) [Служба "Когнитивный поиск Azure REST"](https://docs.microsoft.com/rest/api/searchservice/)   
 [Поиск документов (REST API Когнитивного поиска Azure)](https://docs.microsoft.com/rest/api/searchservice/search-documents)   
 [Библиотеки службы "Поиск Azure" для .NET](https://docs.microsoft.com/dotnet/api/overview/azure/search?view=azure-dotnet)  
