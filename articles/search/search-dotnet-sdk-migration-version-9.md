---
title: Обновление до Azure Search .NET SDK версия 9
titleSuffix: Azure Cognitive Search
description: Переносите код в версию Azure Search .NET SDK 9 из старых версий. Сведения о новых возможностях и необходимых изменениях кода.
manager: nitinme
author: brjohnstmsft
ms.author: brjohnst
ms.service: cognitive-search
ms.devlang: dotnet
ms.topic: conceptual
ms.date: 11/04/2019
ms.openlocfilehash: fcc70267754f7e66f29dd1b855d3efb8b814e78b
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "72793016"
---
# <a name="upgrade-to-azure-search-net-sdk-version-9"></a>Обновление до Azure Search .NET SDK версия 9

Если вы используете версию 7.0-preview или старше [Azure Search .NET SDK,](https://aka.ms/search-sdk)эта статья поможет вам обновить приложение для использования версии 9.

> [!NOTE]
> Если вы хотите использовать версию 8.0-preview для оценки функций, которые, как правило, еще не доступны, вы также можете следовать инструкциям в этой статье, чтобы обновить до 8.0-предварительного просмотра из предыдущих версий.

Более общее пошаговое руководство по пакету SDK, включая примеры, см. в разделе [Использование службы поиска Azure в приложении .NET](search-howto-dotnet-sdk.md).

Версия 9 Azure Search .NET SDK содержит много изменений из предыдущих версий. Некоторые из них нарушают изменения, но они должны требовать лишь относительно незначительных изменений в коде. В разделе [Действия по обновлению](#UpgradeSteps) вы найдете инструкции о том, как изменить код для использования новой версии пакета SDK.

> [!NOTE]
> Если вы используете версию 4.0-предварительный просмотр или старше, вы должны обновить до версии 5, а затем обновить до версии 9. Для получения инструкций смотрите [обновление до версии Azure Search .NET SDK 5.](search-dotnet-sdk-migration-version-5.md)
>
> Экземпляр службы поиска Azure поддерживает несколько версий REST API, включая последнюю. Можно продолжать использовать версию, которая больше не является последней, но рекомендуется выполнить перенос кода, чтобы использовать последнюю версию. При использовании REST API необходимо указывать версию API в каждом запросе с помощью параметра api-version. При использовании пакета SDK для .NET версия пакета SDK, которую вы используете, определяет соответствующую версию REST API. Если вы используете устаревшую версию пакета SDK, можно продолжать выполнять этот код без изменений, даже если служба обновлена для поддержки более новой версии API.

<a name="WhatsNew"></a>

## <a name="whats-new-in-version-9"></a>Что нового в версии 9
Версия 9 поиска Azure .NET SDK нацелена на последнюю общедоступную версию API Azure Search REST, в частности 2019-05-06. Это дает возможность использовать новые функции службы поиска Azure из приложений для .NET, включая следующие:

* [Обогащение ИИ](cognitive-search-concept-intro.md) — это возможность извлекать текст из изображений, капли и других неструктурированных источников данных, обогащая содержимое, чтобы сделать его более пригодным для поиска в индексе поиска Azure.
* Поддержка [сложных типов](search-howto-complex-data-types.md) позволяет моделировать практически любую вложенную структуру JSON в индексе поиска Azure.
* [Autocomplete](search-autocomplete-tutorial.md) предоставляет альтернативу API **Suggest** для реализации поведения типа поиска по мере вас. Автозаполнение "завершает" набираемое пользователем слово или фразу.
* [Режим разбора JsonLines,](search-howto-index-json-blobs.md)часть индексирования Azure Blob, создает один поисковый документ на объект JSON, который разделен новой строкой.

### <a name="new-preview-features-in-version-80-preview"></a>Новые функции предварительного просмотра в версии 8.0-предварительный просмотр
Версия 8.0-предварительный просмотр Azure Search .NET SDK нацелена на версию API 2017-11-11-Preview. Эта версия включает в себя все те же функции версии 9, а также:

* [Управляемые клиентом ключи шифрования](search-security-manage-encryption-keys.md) для шифрования на стороне службы на отдыхе — это новая функция предварительного просмотра. В дополнение к встроенному шифрованию на отдыхе, управляемому корпорацией Майкрософт, вы можете применить дополнительный уровень шифрования, где вы являетесь единственным владельцем ключей.

<a name="UpgradeSteps"></a>

## <a name="steps-to-upgrade"></a>Действия по обновлению
Прежде всего обновите справочник NuGet для `Microsoft.Azure.Search` , воспользовавшись консолью диспетчера пакетов NuGet или щелкнув правой кнопкой мыши ссылки проекта и выбрав "Управление пакетами NuGet" в Visual Studio.

После того как NuGet загрузит новые пакеты и их зависимости, перестройте проект. Сборка может быть выполнена успешно — в зависимости от того, как структурирован ваш код. Если она выполнена, то теперь все готово.

Если сборка завершается неудачей, необходимо исправить каждую ошибку сборки. Подробную информацию о том, как устранить каждую потенциальную ошибку сборки, читайте в материале [«Нарушение изменений» в версии 9.](#ListOfChanges)

Могут появиться дополнительные предупреждения о сборке, связанные с устаревшими методами или свойствами. В предупреждениях будет указано, что следует использовать вместо устаревшей функции. Например, если приложение `DataSourceType.DocumentDb` использует свойство, вы должны получить предупреждение, в которое говорится: "Этот участник устранен. Вместо этого используйте CosmosDb».

После устранения предупреждений и ошибок сборки при необходимости можно внести изменения в приложение, чтобы воспользоваться преимуществами новых функциональных возможностей. Новые функции в SDK подробно описаны в [What's new в версии 9](#WhatsNew).

<a name="ListOfChanges"></a>

## <a name="breaking-changes-in-version-9"></a>Нарушение изменений в версии 9

В версии 9 есть несколько изменений, которые могут потребовать изменения кода в дополнение к восстановлению приложения.

> [!NOTE]
> Приведенный ниже список изменений не является исчерпывающим. Некоторые изменения, скорее всего, не приведут к ошибкам сборки, но технически нарушаются, поскольку они нарушают двоичную совместимость с сборками, которые зависят от более ранних версий сборок Azure Search .NET SDK. Такие изменения не перечислены ниже. Пожалуйста, перестроить приложение при обновлении до версии 9, чтобы избежать любых проблем с двоичной совместимости.

### <a name="immutable-properties"></a>Неизменяемые свойства

Публичные свойства нескольких типовых классов теперь неизменяемы. Если вам нужно создать пользовательские экземпляры этих классов для тестирования, можно использовать новые параметризированные конструкторы:

  - `AutocompleteItem`
  - `DocumentSearchResult`
  - `DocumentSuggestResult`
  - `FacetResult`
  - `SearchResult`
  - `SuggestResult`

### <a name="changes-to-field"></a>Изменения в поле

Класс `Field` изменился теперь, когда он также может представлять сложные поля.

Следующие `bool` свойства теперь недействительны:

  - `IsFilterable`
  - `IsFacetable`
  - `IsSearchable`
  - `IsSortable`
  - `IsRetrievable`
  - `IsKey`

Это объясняется тем, `null` что эти свойства теперь должны быть в случае сложных полей. Если у вас есть код, который считывает `null`эти свойства, он должен быть готов к обработке. Обратите внимание, что `Field` все другие свойства всегда были и остаются `null` недействительными, и некоторые из них также будут в случае сложных полей - в частности, следующие:

  - `Analyzer`
  - `SearchAnalyzer`
  - `IndexAnalyzer`
  - `SynonymMaps`

Изготовлен безпаралистный `Field` `internal`конструктор. Отныне каждый `Field` требует явного имени и типа данных во время строительства.

### <a name="simplified-batch-and-results-types"></a>Упрощенные типы пакетов и результатов

В версии 7.0-preview и ранее различные классы, инкапсуляющие группы документов, были структурированы в параллельные иерархии классов:

  -  `DocumentSearchResult`и `DocumentSearchResult<T>` унаследовал от`DocumentSearchResultBase`
  -  `DocumentSuggestResult`и `DocumentSuggestResult<T>` унаследовал от`DocumentSuggestResultBase`
  -  `IndexAction`и `IndexAction<T>` унаследовал от`IndexActionBase`
  -  `IndexBatch`и `IndexBatch<T>` унаследовал от`IndexBatchBase`
  -  `SearchResult`и `SearchResult<T>` унаследовал от`SearchResultBase`
  -  `SuggestResult`и `SuggestResult<T>` унаследовал от`SuggestResultBase`

Полученные типы без общего параметра типа должны были использоваться в сценариях "динамически набранных" и предполагаемом использовании `Document` типа.

Начиная с версии 8.0-preview, базовые классы и необщие производные классы были удалены. Для динамически набранных сценариев можно использовать `IndexBatch<Document>` `DocumentSearchResult<Document>`и так далее.
 
### <a name="removed-extensibleenum"></a>Удален освящаетсяEnum

Базовый класс `ExtensibleEnum` был удален. Все классы, которые вытекают из него `AnalyzerName`в `DataType`настоящее время структурирует, такие как , и, `DataSourceType` например. Их `Create` методы также были удалены. Вы можете просто `Create` удалить вызовы, так как эти типы неявно кабриолет из строк. Если это приводит к ошибкам компилятора, вы можете явно вызвать оператора преобразования через литье для disambiguate типов. Например, можно изменить код следующим образом:

```csharp
var index = new Index()
{
    Fields = new[]
    {
        new Field("id", DataType.String) { IsKey = true },
        new Field("message", AnalyzerName.Create("my_email_analyzer")) { IsSearchable = true }
    },
    ...
}
```

на такой:

```csharp
var index = new Index()
{
    Fields = new[]
    {
        new Field("id", DataType.String) { IsKey = true },
        new Field("message", (AnalyzerName)"my_email_analyzer") { IsSearchable = true }
    },
    ...
}
```

Свойства, в которые содержались дополнительные значения этих типов, теперь явно набраны как недействительные, поэтому они по-прежнему являются необязательными.

### <a name="removed-facetresults-and-hithighlights"></a>Удалены FacetРезультаты и HitHighlights

`FacetResults` Классы `HitHighlights` и классы были удалены. Facet результаты в `IDictionary<string, IList<FacetResult>>` настоящее время `IDictionary<string, IList<string>>`набрали, как и хит подчеркивается как . Быстрый способ устранения ошибок сборки, `using` введенных этим изменением, заключается в добавлении псевдонимов в верхней части каждого файла, используюго удаленные типы. Пример:

```csharp
using FacetResults = System.Collections.Generic.IDictionary<string, System.Collections.Generic.IList<Models.FacetResult>>;
using HitHighlights = System.Collections.Generic.IDictionary<string, System.Collections.Generic.IList<string>>;
```

### <a name="change-to-synonymmap"></a>Изменение в SynonymMap 

Конструктор `SynonymMap` больше не использует параметр `enum` для `SynonymMapFormat`. Это перечисление имело только одно значение, следовательно, оно было избыточным. Если вы видите ошибки сборки в результате этого, просто удалите ссылки на параметр `SynonymMapFormat`.

### <a name="miscellaneous-model-class-changes"></a>Различные изменения класса модели

Имущество `AutocompleteMode` `AutocompleteParameters` больше не является недействительным. Если у вас есть код, `null`который присваивает это свойство, вы можете просто удалить его, и свойство будет автоматически инициализировано к значению по умолчанию.

Порядок параметров конструктора `IndexAction` изменился теперь, когда этот конструктор автоматически генерируется. Вместо использования конструктора, мы рекомендуем использовать `IndexAction.Upload`заводские методы `IndexAction.Merge`и так далее.

### <a name="removed-preview-features"></a>Удалены функции предварительной версии

Если вы переключитесь с версии 8.0-preview на версию 9, имейте в виду, что шифрование с ключами, управляемыми клиентом, было удалено, так как эта функция все еще находится в предварительном просмотре. В `EncryptionKey` частности, `Index` `SynonymMap` свойства и были удалены.

Если ваше приложение сильно зависит от этой функции, вы не сможете перейти в версию 9 Azure Search .NET SDK. Вы можете продолжать использовать версию 8.0-preview. Однако необходимо учитывать, что **использовать предварительные версии пакетов SDK в рабочих приложениях не рекомендуется**. Предварительные версии функций предназначены исключительно для оценки и могут изменяться.

> [!NOTE]
> Если вы создали зашифрованные индексы или синонимы карт с помощью версии 8.0-предварительного просмотра SDK, вы все равно сможете использовать их и изменять их определения с помощью версии 9 SDK без негативного влияния на их статус шифрования. Версия 9 SDK не будет `encryptionKey` отправлять свойство на REST API, и в результате REST API не изменит статус шифрования ресурса. 

### <a name="behavioral-change-in-data-retrieval"></a>Поведенческие изменения в поиске данных

Если вы используете "динамически набранные" `Search`, `Suggest`или `Get` AI, `Document`которые возвращают экземпляры типа, имейте в `object[]` виду, что они теперь десериализировать пустые массивы JSON вместо `string[]`.

## <a name="conclusion"></a>Заключение
Если вам нужны дополнительные сведения об использовании пакета SDK .NET для службы поиска Azure, то ознакомьтесь с [практическим руководством по .NET](search-howto-dotnet-sdk.md).

Будем рады вашим отзывам о пакете SDK. Если вы столкнулись с проблемами, не стесняйтесь обратиться к нам за помощью на [стек переполнения](https://stackoverflow.com/questions/tagged/azure-search). При обнаружении ошибки можно зарегистрировать проблему в [репозитории GitHub пакета SDK .NET для Azure](https://github.com/Azure/azure-sdk-for-net/issues). Добавьте в заголовок вашей проблемы префикс "[Azure Search]".

Благодарим вас за использование поиска Azure!
