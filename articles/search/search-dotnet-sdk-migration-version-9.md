---
title: Обновление до SDK .NET для поиска Azure версии 9 — поиска Azure
description: Перенос кода в SDK .NET для поиска Azure версии 9 из прежних версий. Сведения о новых возможностях и необходимых изменениях кода.
author: brjohnstmsft
manager: jlembicz
services: search
ms.service: search
ms.devlang: dotnet
ms.topic: conceptual
ms.date: 05/06/2019
ms.author: brjohnst
ms.custom: seodec2018
ms.openlocfilehash: f540bc304920073bcd823adcf6c9dd47cb2cf93b
ms.sourcegitcommit: f6ba5c5a4b1ec4e35c41a4e799fb669ad5099522
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65159755"
---
# <a name="upgrading-to-the-azure-search-net-sdk-version-9"></a>Обновление до SDK .NET для поиска Azure версии 9

Если вы используете версию предварительной версии 7.0 или более раннюю [пакет SDK Azure Search .NET](https://aka.ms/search-sdk), эта статья поможет вам обновить приложение для использования версии 9.

> [!NOTE]
> Если вы хотите использовать для ознакомления с функциями, которые еще не общедоступной версии 8.0-preview, можно также следуйте инструкциям в этой статье для обновления до предварительной версии 8.0 с предыдущими версиями.

Более общее пошаговое руководство по пакету SDK, включая примеры, см. в разделе [Использование службы поиска Azure в приложении .NET](search-howto-dotnet-sdk.md).

Версия 9 пакета SDK для .NET для поиска Azure содержит множество изменений из более ранних версий. Некоторые из них являются критическими, но они необходима только незначительные изменения в код. В разделе [Действия по обновлению](#UpgradeSteps) вы найдете инструкции о том, как изменить код для использования новой версии пакета SDK.

> [!NOTE]
> Если вы используете версию Предварительная версия 4.0 или более ранней версии, следует сначала выполнить обновление до версии 5 и затем обновите до версии 9. См. в разделе [обновление до SDK .NET для поиска Azure версии 5](search-dotnet-sdk-migration-version-5.md) инструкции.
>
> Экземпляр службы поиска Azure поддерживает несколько версий REST API, включая последнюю. Можно продолжать использовать версию, которая больше не является последней, но рекомендуется выполнить перенос кода, чтобы использовать последнюю версию. При использовании REST API необходимо указывать версию API в каждом запросе с помощью параметра api-version. При использовании пакета SDK для .NET версия пакета SDK, которую вы используете, определяет соответствующую версию REST API. Если вы используете устаревшую версию пакета SDK, можно продолжать выполнять этот код без изменений, даже если служба обновлена для поддержки более новой версии API.

<a name="WhatsNew"></a>

## <a name="whats-new-in-version-9"></a>Новые возможности в версии 9
9 версию пакета SDK для .NET для поиска Azure предназначена для последней общедоступной версии REST API службы поиска Azure, в частности 2019-05-06. Это дает возможность использовать новые функции службы поиска Azure из приложений для .NET, включая следующие:

* [Когнитивный поиск](cognitive-search-concept-intro.md) — это функция искусственного Интеллекта в службе поиска Azure, используемое для извлечения текста из образов, больших двоичных объектов и других источников неструктурированных данных — привлечению новых специалистов содержимое, чтобы сделать ее более доступным для поиска в индексе поиска Azure.
* Поддержка [сложные типы](search-howto-complex-data-types.md) позволяет моделировать практически любой вложенной структуры JSON в индекс службы поиска Azure.
* [Автозаполнение](search-autocomplete-tutorial.md) представляет собой альтернативу **предложить** API для реализации поведения поиска как то type. Автозаполнение «завершения» слово или фразу, пользователь вводит текст в настоящее время.
* [Режим анализа JsonLines](search-howto-index-json-blobs.md), которое входит BLOB-объектов Azure индексирования, создает один документ поиска по сущности JSON, который отделяется символом новой строки.

### <a name="new-preview-features-in-version-80-preview"></a>Новые функции предварительной версии в версии 8.0-preview
Версия 8.0-preview пакета SDK для .NET для поиска Azure предназначен для API версии 2017-11-11-предварительной версии. Эта версия включает те же функции версии 9, а также:

* [Ключи шифрования, управляемых пользователем](search-security-manage-encryption-keys.md) для со стороны службы шифрования при хранении — это новая функция предварительной версии. Помимо встроенных шифрования при хранении управляет Корпорация Майкрософт вы можете применить дополнительный уровень шифрования, где вы являетесь единственным владельцем ключи.

<a name="UpgradeSteps"></a>

## <a name="steps-to-upgrade"></a>Действия по обновлению
Прежде всего обновите справочник NuGet для `Microsoft.Azure.Search` , воспользовавшись консолью диспетчера пакетов NuGet или щелкнув правой кнопкой мыши ссылки проекта и выбрав "Управление пакетами NuGet" в Visual Studio.

После того как NuGet загрузит новые пакеты и их зависимости, перестройте проект. Сборка может быть выполнена успешно — в зависимости от того, как структурирован ваш код. Если она выполнена, то теперь все готово.

Если в противном случае необходимо будет исправления каждой ошибки сборки. См. в разделе [критические изменения в версии 9](#ListOfChanges) для сведения по устранению каждой потенциал ошибку сборки.

Могут появиться дополнительные предупреждения о сборке, связанные с устаревшими методами или свойствами. В предупреждениях будет указано, что следует использовать вместо устаревшей функции. Например, если приложение использует `DataSourceType.DocumentDb` свойство, вы должны получить предупреждение об ошибке «этот элемент устарел. Используйте CosmosDb».

После устранения предупреждений и ошибок сборки при необходимости можно внести изменения в приложение, чтобы воспользоваться преимуществами новых функциональных возможностей. Новые возможности в пакете SDK описаны в [новые возможности в версии 9](#WhatsNew).

<a name="ListOfChanges"></a>

## <a name="breaking-changes-in-version-9"></a>Критические изменения в версии 9

Существует несколько критических изменений в версии 9, которые могут потребовать изменений в код повторной сборки приложения.

> [!NOTE]
> Список изменений ниже не является исчерпывающим. Некоторые изменения, скорее всего не приведет к ошибкам построения, но технически являются критическими, так как они нарушают совместимость двоичных данных с использованием сборок, которые зависят от более ранних версий сборок пакета SDK для .NET для поиска Azure. Такие изменения не перечислены ниже. Повторите сборку приложения, при обновлении до версии 9, чтобы избежать проблем совместимости.

### <a name="making-properties-immutable"></a>Что делает Неизменяемые свойства

Открытые свойства из нескольких классов модели теперь являются неизменяемыми. Если необходимо создать пользовательские экземпляры этих классов для тестирования, можно использовать новый параметризованные конструкторы:

  - `AutocompleteItem`
  - `DocumentSearchResult`
  - `DocumentSuggestResult`
  - `FacetResult`
  - `SearchResult`
  - `SuggestResult`

### <a name="changes-to-field"></a>Изменения в поле

`Field` Класс был изменен, теперь, когда он может также представлять сложных полей.

Следующие `bool` свойства теперь допускают значение NULL:

  - `IsFilterable`
  - `IsFacetable`
  - `IsSearchable`
  - `IsSortable`
  - `IsRetrievable`
  - `IsKey`

Это обусловлено тем, эти свойства теперь должны быть `null` в случае сложных полей. Если у вас есть код, который считывает эти свойства, он должен уметь обрабатывать `null`. Обратите внимание, что все остальные свойства `Field` всегда были и по-прежнему значение NULL, а некоторые из них будет также `null` в случае сложных полей — в частности следующие:

  - `Analyzer`
  - `SearchAnalyzer`
  - `IndexAnalyzer`
  - `SynonymMaps`

Конструктор без параметров `Field` стала `internal`. Теперь каждый `Field` требуется явный тип имени и данных во время конструирования.

### <a name="simplification-of-batch-and-results-types"></a>Упрощение типов пакетной службы и результаты

В версии предварительной версии 7.0 и более ранних версий различные классы, которые инкапсулируют групп документов были структурированные в иерархии классов параллельных:

  -  `DocumentSearchResult` и `DocumentSearchResult<T>` унаследовано от `DocumentSearchResultBase`
  -  `DocumentSuggestResult` и `DocumentSuggestResult<T>` унаследовано от `DocumentSuggestResultBase`
  -  `IndexAction` и `IndexAction<T>` унаследовано от `IndexActionBase`
  -  `IndexBatch` и `IndexBatch<T>` унаследовано от `IndexBatchBase`
  -  `SearchResult` и `SearchResult<T>` унаследовано от `SearchResultBase`
  -  `SuggestResult` и `SuggestResult<T>` унаследовано от `SuggestResultBase`

Производные типы без параметра универсального типа были предназначены для использования в сценариях «динамических типов» и предполагается, что использование `Document` типа.

Начиная с версии 8.0-preview, базовых классов и производных классах неуниверсальных удалены. Для динамических типов сценариев, можно использовать `IndexBatch<Document>`, `DocumentSearchResult<Document>`, и т. д.
 
### <a name="removal-of-extensibleenum"></a>Удаление ExtensibleEnum

`ExtensibleEnum` Базовый класс был удален. Все классы, производные от него теперь являются структурами, такие как `AnalyzerName`, `DataType`, и `DataSourceType` для примера. Их `Create` методы также будут удалены. Можно просто удалить вызовы `Create` так, как эти типы неявно преобразуются из строк. Если, приводит к ошибкам компилятора, можно явным образом вызвать оператор преобразования с помощью приведения для однозначного определения типов. Например можно изменить код следующим образом:

```csharp
var index = new Index()
{
    Fields = new[]
    {
        new Field("id", DataType.String) { IsKey = true },
        new Field("message", AnalyzerName.Create("my_email_analyzer")) { IsSearchable = true }
    },
    ...
}
```

на такой:

```csharp
var index = new Index()
{
    Fields = new[]
    {
        new Field("id", DataType.String) { IsKey = true },
        new Field("message", (AnalyzerName)"my_email_analyzer") { IsSearchable = true }
    },
    ...
}
```

Свойства, которые удерживаются необязательных значений из этих типов теперь явно типизированы как допускающие значение NULL, они продолжают быть необязательным.

### <a name="removal-of-facetresults-and-hithighlights"></a>Удаление FacetResults и HitHighlights

`FacetResults` И `HitHighlights` классы были удалены. Теперь имеют тип аспекта результаты `IDictionary<string, IList<FacetResult>>` и выделяет попадание в качестве `IDictionary<string, IList<string>>`. Быстро для устранения ошибок сборки, представленное в это изменение, чтобы добавить `using` псевдонимы в верхней части каждого файла, который использует эти типы. Например: 

```csharp
using FacetResults = System.Collections.Generic.IDictionary<string, System.Collections.Generic.IList<Models.FacetResult>>;
using HitHighlights = System.Collections.Generic.IDictionary<string, System.Collections.Generic.IList<string>>;
```

### <a name="change-to-synonymmap"></a>Изменить на SynonymMap 

Конструктор `SynonymMap` больше не использует параметр `enum` для `SynonymMapFormat`. Это перечисление имело только одно значение, следовательно, оно было избыточным. Если вы видите ошибки сборки в результате этого, просто удалите ссылки на параметр `SynonymMapFormat`.

### <a name="miscellaneous-model-class-changes"></a>Изменение классов различные модели

`AutocompleteMode` Свойство `AutocompleteParameters` больше не допускает значения NULL. Если у вас есть код, который присваивает этому свойству, чтобы `null`, вы можете просто удалить его, и свойство автоматически инициализируются значением по умолчанию.

Порядок параметров для `IndexAction` конструктор был изменен после того, как этот конструктор автоматически созданный. Вместо использования конструктора, мы рекомендуем использовать фабричных методов `IndexAction.Upload`, `IndexAction.Merge`, и т. д.

### <a name="removed-preview-features"></a>Удалены функции предварительной версии

Если при обновлении с версии 8.0-preview до версии 9, помните, что шифрование с помощью управляемых пользователем ключей был удален, так как эта функция находится на стадии предварительной версии. В частности `EncryptionKey` свойства `Index` и `SynonymMap` будут удалены.

Если приложение имеет жесткую зависимость от этой функции, вы не сможете обновить до версии 9, пакета SDK для .NET для поиска Azure. Можно продолжать использовать версию 8.0-preview. Однако необходимо учитывать, что **использовать предварительные версии пакетов SDK в рабочих приложениях не рекомендуется**. Предварительные версии функций предназначены исключительно для оценки и могут изменяться.

> [!NOTE]
> При создании зашифрованных индексы или синоним, карт, с помощью версии 8.0-preview пакета SDK, вы по-прежнему сможете использовать их и изменить их определения, с помощью пакета SDK версии 9 без негативного воздействия на их состояние шифрования. Версия пакета SDK 9 не будет отправлять `encryptionKey` свойство к REST API, в результате чего REST API не изменится состояние шифрования ресурса. 

### <a name="behavioral-change-in-data-retrieval"></a>Изменение поведения в получении данных

Если вы используете «динамически типизированные» `Search`, `Suggest`, или `Get` API, которые возвращают экземпляры типа `Document`, имейте в виду, теперь десериализации пустые массивы JSON для `object[]` вместо `string[]`.

## <a name="conclusion"></a>Заключение
Если вам нужны дополнительные сведения об использовании пакета SDK .NET для службы поиска Azure, то ознакомьтесь с [практическим руководством по .NET](search-howto-dotnet-sdk.md).

Будем рады вашим отзывам о пакете SDK. Если возникли проблемы, вы можете обратиться за помощью на [Stack Overflow](https://stackoverflow.com/questions/tagged/azure-search). При обнаружении ошибки можно зарегистрировать проблему в [репозитории GitHub пакета SDK .NET для Azure](https://github.com/Azure/azure-sdk-for-net/issues). Добавьте в заголовок вашей проблемы префикс "[Azure Search]".

Благодарим вас за использование поиска Azure!
