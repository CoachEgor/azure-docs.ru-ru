---
title: Простой синтаксис запросов
titleSuffix: Azure Cognitive Search
description: Справочник по синтаксису простого запроса, который используется для запросов полнотекстового поиска в Когнитивный поиск Azure.
manager: nitinme
author: brjohnstmsft
ms.author: brjohnst
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 04/24/2020
ms.openlocfilehash: dfd75ad2c6ae246bfe6ee8b983744b3db07a841f
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "82194947"
---
# <a name="simple-query-syntax-in-azure-cognitive-search"></a>Простой синтаксис запросов в Azure Когнитивный поиск

Когнитивный поиск Azure реализует два языка запросов на основе Lucene: [простое средство синтаксического анализа запросов](https://lucene.apache.org/core/6_6_1/queryparser/org/apache/lucene/queryparser/simple/SimpleQueryParser.html) и [средство синтаксического анализа запросов Lucene](https://lucene.apache.org/core/6_6_1/queryparser/org/apache/lucene/queryparser/classic/package-summary.html).

Простой синтаксический анализатор является более гибким и попытается интерпретировать запрос, даже если он не был полностью составлен. Из-за этой гибкости это значение по умолчанию для запросов в Azure Когнитивный поиск. 

Простой синтаксис используется для выражений запроса, передаваемых `search` в параметре [запроса поиска документов](https://docs.microsoft.com/rest/api/searchservice/search-documents), и не следует путать с [синтаксисом OData](query-odata-filter-orderby-syntax.md) , используемым для параметра [$Filter Expressions](search-filters.md) одного и того же API поисковых документов. Параметры `search` и `$filter` имеют разный синтаксис, а также собственные правила для построения запросов, экранирования строк и т. д.

Хотя простое средство синтаксического анализа основано на классе [простого анализатора запросов Apache Lucene](https://lucene.apache.org/core/6_6_1/queryparser/org/apache/lucene/queryparser/simple/SimpleQueryParser.html) , реализация в Azure когнитивный Поиск исключает нечеткий поиск. Если вам требуется [нечеткий поиск](search-query-fuzzy.md) или другие расширенные формы запросов, вместо этого следует рассмотреть альтернативный [синтаксис полного запроса Lucene](query-lucene-syntax.md) .

## <a name="invoke-simple-parsing"></a>Вызов простого анализа

Простой синтаксис включен по умолчанию. Вызов необходим только в том случае, если вы сбрасываете синтаксис с полного на простой. Чтобы явно установить синтаксис, используйте параметр поиска `queryType`. Допустимые значения `queryType=simple` : `queryType=full`или, `simple` где является значением по умолчанию, и `full` вызывает [полное средство синтаксического анализа запросов Lucene](query-lucene-syntax.md) для более сложных запросов. 

## <a name="syntax-fundamentals"></a> Основные сведения о синтаксисе

Любой текст с одним или несколькими терминами считается допустимой отправной точкой для выполнения запроса. Когнитивный поиск Azure будет сопоставлять документы, содержащие любые или все условия, включая любые варианты, найденные во время анализа текста.

Так же, как это звучит, существует один аспект выполнения запросов в Azure Когнитивный поиск, который *может* привести к непредвиденным результатам, увеличивая, а не уменьшая результаты поиска по мере добавления в входную строку большего числа условий и операторов. Фактическое наличие этого расширения зависит от включения оператора NOT в сочетании с параметром **searchMode** , который определяет, как не интерпретируется в терминах поведения и или. Дополнительные сведения см. в разделе [Оператор NOT](#not-operator).

### <a name="precedence-operators-grouping"></a>Операторы приоритета (группирование)

Вы можете использовать круглые скобки, чтобы создать вложенные запросы, включая операторы в заключенной в скобки инструкции. Например, `motel+(wifi|luxury)` будет выполнять поиск документов, содержащих термин "motel" и "wifi" или "luxury" (или оба).

Группирование полей аналогично, но группирование ограничивается одним полем. Например, `hotelAmenities:(gym+(wifi|pool))` ищет в поле "hotelAmenities" термины "gym" и "wifi" или "gym" и "pool".  

### <a name="escaping-search-operators"></a>Поисковые операторы экранирования  

В простом синтаксисе операторы поиска включают следующие символы:`+ | " ( ) ' \`  

Если какой-либо из этих символов является частью токена в индексе, необходимо построчно исправить его, добавив в`\`запрос одну обратную косую черту (). Например, предположим, что вы использовали пользовательский анализатор для разметки всего термина, а индекс содержит строку "люкс + гостиницы". Чтобы получить точное соответствие для этого маркера, вставьте escape-символ: `search=luxury\+hotel`. 

Для упрощения более типичных случаев существует два исключения из этого правила, в которых не требуется экранирование.  

+ Оператор `-` not должен быть экранированным только в том случае, если он является первым символом после пробела. Если `-` отображается в середине (например, в `3352CDD0-EF30-4A2E-A512-3B30AF40F3FD`), можно пропустить экранирование.

+ Оператор `*` суффикса должен быть экранированным только в том случае, если он является последним символом перед пробелом. Если `*` отображается в середине (например, в `4*4=16`), экранирование не требуется.

> [!NOTE]  
> По умолчанию стандартный анализатор удалит и разбивает слова на дефисы, пробелы, амперсанды и другие символы во время [лексического анализа](search-lucene-query-architecture.md#stage-2-lexical-analysis). Если требуется, чтобы в строке запроса оставались специальные символы, может потребоваться анализатор, сохраняющий их в индексе. К некоторым вариантам относятся [анализаторы](index-add-language-analyzers.md)естественного языка (Майкрософт), которые сохраняют перенос слов или пользовательский анализатор для более сложных шаблонов. Дополнительные сведения см. в разделе [частичные термины, шаблоны и специальные символы](search-query-partial-matching.md).

### <a name="encoding-unsafe-and-reserved-characters-in-urls"></a>Кодирование небезопасных и зарезервированных знаков в URL-адресах

Убедитесь, что в URL-адресе закодированы все небезопасные и зарезервированные знаки. Например, "#" является ненадежным символом, так как он является идентификатором фрагмента или привязки в URL-адресе. Знак должен быть закодирован как `%23`, если он используется в URL-адресе. "&" и "=" являются примерами зарезервированных символов, так как они разделяют параметры и указывают значения в Когнитивный поиск Azure. Дополнительные сведения см. в разделе [RFC1738: универсальные указатели ресурсов (URL-адрес)](https://www.ietf.org/rfc/rfc1738.txt) .

Небезопасными знаками являются: ``" ` < > # % { } | \ ^ ~ [ ]``. Зарезервированными знаками являются: `; / ? : @ = + &`.

###  <a name="query-size-limits"></a><a name="bkmk_querysizelimits"></a>Ограничения размера запроса

 Существует ограничение на размер запросов, которые можно отправить в Azure Когнитивный поиск. В частности, вы можете иметь не более 1024 предложений (выражения, разделенные AND, OR и т. д.). Кроме того, размер любого отдельного термина в запросе не может превышать 32 КБ. Если приложение создает поисковые запросы программным способом, рекомендуется разрабатывать его таким образом, чтобы оно не создавало запросы неограниченного размера.  

## <a name="boolean-search"></a>Логический поиск

Логические операторы (и, или, NOT) можно внедрять в строку запроса для создания обширного набора критериев для поиска соответствующих документов. 

### <a name="and-operator-"></a>Оператор AND `+`

Оператор AND представляет собой знак плюс. Например, условие `wifi + luxury` будет искать документы, содержащие и `wifi`, и `luxury`.

### <a name="or-operator-"></a>Оператор OR `|`

Оператор OR представляет собой вертикальную черту. Например, условие `wifi | luxury` будет искать документы, содержащие `wifi` или `luxury`, или и то и другое.

<a name="not-operator"></a>

### <a name="not-operator--"></a>Оператор NOT `-`

Оператор NOT представляет собой знак минус. Например, будет `wifi –luxury` искать документы, у которых нет `wifi` термина и (или) нет `luxury`.

Параметр **searchMode** запроса определяет, является ли термин с оператором NOT and или ORed с другими условиями в запросе (при условии, что оператор `+` or `|` отсутствует в других терминах). Допустимые значения: `any` и `all`.

`searchMode=any`повышает отзыв запросов, включая дополнительные результаты, и по умолчанию `-` интерпретируется как «или not». Например, `wifi -luxury` соответствует документам, которые содержат термин `wifi`, или документам, которые не содержат термин `luxury`.

`searchMode=all`увеличивает точность запросов, включая меньше результатов, и по умолчанию интерпретируется как «AND NOT». Например, `wifi -luxury` соответствует документам, которые содержат термин `wifi` и не содержат термин "luxury". Вероятно, это более интуитивное поведение оператора `-`. Поэтому `searchMode=all` рекомендуется использовать вместо `searchMode=any` , если требуется оптимизировать поиск точности вместо отзыва, *а* пользователи часто используют `-` оператор в поиске.

При принятии решения о параметре **searchMode** следует учитывать закономерности взаимодействия с пользователем для запросов в различных приложениях. Пользователи, которые ищут информацию, скорее всего, включают оператор в запрос, а не сайты электронной коммерции с более встроенными структурами навигации.

<a name="prefix-search"></a>

## <a name="prefix-search"></a>Поиск префикса

Суффиксом оператора является звездочка `*`. Например, `lingui*` найдет «лингвистические» или «лингуини» без учета регистра. 

Как и в случае с фильтрами, запрос префикса выполняет поиск точного совпадения. Таким образом, не существует оценки релевантности (все результаты получают оценку 1,0). Запросы с префиксом могут выполняться очень часто, особенно если индекс большой, а префикс состоит из небольшого числа символов. 

Если вы хотите выполнить запрос суффикса, совпадающий с последней частью строки, используйте [Поиск по шаблону](query-lucene-syntax.md#bkmk_wildcard) и полный синтаксис Lucene.

## <a name="phrase-search-"></a>Поиск фраз`"`

Поиск термина — это запрос для одного или нескольких терминов, где любое из условий считается совпадением. Поиск фраз — это точная фраза, заключенная в `" "`кавычки. Например, при `Roach Motel` (без кавычек) будут найдены документы, содержащие `Roach` и/или `Motel` (в любом порядке), а при `"Roach Motel"` (с кавычками) будут найдены только те документы, в которых есть эта фраза целиком и с таким же порядком слов (анализ текста по-прежнему применяется).

## <a name="see-also"></a>См. также  

+ [How full text search works in Azure Cognitive Search](search-lucene-query-architecture.md) (Как выполняется полнотекстовый поиск в Когнитивном поиске Azure)
+ [Примеры запросов для простого поиска](search-query-simple-examples.md)
+ [Примеры запросов для полного поиска в Lucene](search-query-lucene-examples.md)
+ [Поиск документов REST API](https://docs.microsoft.com/rest/api/searchservice/Search-Documents)
+ [Синтаксис запросов Lucene](query-lucene-syntax.md)
+ [Синтаксис выражений OData](query-odata-filter-orderby-syntax.md) 
