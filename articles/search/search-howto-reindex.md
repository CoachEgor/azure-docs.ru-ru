---
title: Перестроить индекс поиска
titleSuffix: Azure Cognitive Search
description: Добавляйте новые элементы, обновляйте существующие элементы или документы или удаляйте устаревшие документы при полной перестроении или частичной индексации для обновления индекса когнитивного поиска Azure.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 02/14/2020
ms.openlocfilehash: 58b60a0eee8ab407709f33911d3c6b13ffbf301a
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "77498376"
---
# <a name="how-to-rebuild-an-index-in-azure-cognitive-search"></a>Как восстановить индекс в Azure Cognitive Search

В этой статье объясняется, как восстановить индекс когнитивного поиска Azure, обстоятельства, при которых требуется восстановление, и рекомендации по смягчению влияния перестроений на текущие запросы запросов.

*Перестроение* — это удаление и повторное создание структур физических данных, связанных с индексом, включая все индексы, инвертированные на основе поля. В Azure Cognitive Search нельзя отбросить и воссоздать отдельные поля. Для перестроения индекса все хранилище полей необходимо удалить, создать заново на основе существующей или измененной схемы индексов, а затем повторно заполнить их данными, отправленными в индекс или полученными из внешних источников. 

Обычно индексы перестраиваются во время разработки, но иногда требуется перестроить индекс рабочего уровня в соответствии со структурными изменениями, например при добавлении сложных типов или полей в средства подбора.

## <a name="rebuild-conditions"></a>Условия перестроения

Падение и воссоздание индекса, если какое-либо из следующих условий верно. 

| Условие | Описание |
|-----------|-------------|
| Изменение определения поля | Если вы меняете имя поля, тип данных или определенные [атрибуты индекса](https://docs.microsoft.com/rest/api/searchservice/create-index) (с возможностью поиска, фильтрации, сортировки или поддержкой аспектов), требуется полная перестройка. |
| Присвоение полю анализатора | [Анализаторы](search-analyzers.md) определяются в индексе, а затем присваиваются полям. Вы можете добавить новое определение анализатора в индекс в любое время, но *присвоить* анализатор можно только при создании поля. Это касается обоих свойств: **analyzer** и **indexAnalyzer**. Свойство **searchAnalyzer** является исключением (его можно присвоить уже существующему полю). |
| Обновление или удаление определения анализатора в индексе | Удалить или изменить существующую конфигурацию анализатора (анализатор, создатель маркеров, фильтр маркеров или фильтр символов) можно, только перестроив весь индекс. |
| Добавление поля в средство подбора | Чтобы добавить уже существующее поле в конструкцию [средств подбора](index-add-suggesters.md), необходимо перестроить индекс. |
| Удаление поля | Чтобы физически удалить все следы поля, необходимо перестроить индекс. Если немедленная перестройка непрактична, можно изменить код приложения, чтобы отключить доступ к "удаленному" полю или использовать [параметр $select запроса,](search-query-odata-select.md) чтобы выбрать, какие поля представлены в наборе результатов. Физически определение и содержимое поля сохраняются в индексе до следующей перестройки с использованием схемы, в которой это поле отсутствует. |
| Смена уровня | Если требуется больше емкости, на портале Azure нет обновления. Необходимо создать новую службу, а индексы должны быть построены с нуля на новой службе. Чтобы помочь автоматизировать этот процесс, можно использовать пример **кода-излгин-восстановления индекса** в этом [примере Azure Cognitive Search .NET.](https://github.com/Azure-Samples/azure-search-dotnet-samples) Это приложение будет резервное копирование вашего индекса в серии файлов JSON, а затем воссоздать индекс в поисковой службе вы указываете.|

## <a name="update-conditions"></a>Условия обновления

Многие другие изменения могут быть сделаны без воздействия существующих физических структур. В частности, следующие изменения *не* требуют перестроения индекса. Для этих изменений можно [обновить определение индекса](https://docs.microsoft.com/rest/api/searchservice/update-index) с вашими изменениями.

+ Добавление нового поля
+ Задание атрибута **Доступный для получения** для существующего поля
+ Задание свойства **searchAnalyzer** для существующего поля
+ Добавление нового определения анализатора в индекс
+ Добавление, обновление или удаление профилей повышения
+ Добавление, обновление или удаление параметров CORS
+ Добавление, обновление или удаление synonymMaps

Когда вы добавляете новое поле, во всех существующих в индексе документах новому полю присваивается значение null. При обновлении данных в будущем значения из данных внешнего источника заменяют нулевые, добавленные Azure Cognitive Search. Дополнительные сведения об обновлении содержимого индекса см. в статье [Добавление, обновление и удаление документов](https://docs.microsoft.com/rest/api/searchservice/addupdate-or-delete-documents).

## <a name="how-to-rebuild-an-index"></a>Как перестроить индекс

Во время разработки схема индекса часто меняется. Вы можете спланировать его, создав индексы, которые могут быть удалены, воссозданы и быстро загружены с небольшим набором репрезентативных данных.

Для приложений, которые уже находятся в рабочей среде, рекомендуется создать новый индекс, который выполняется параллельно существующему, чтобы избежать простоя запроса. Код приложения обеспечивает перенаправление на новый индекс.

Индексирование не выполняется в фоновом режиме, и служба сбалансирует дополнительную индексацию с текущими запросами. Во время индексации можно [отслеживать запросы запросов](search-monitor-queries.md) на портале, чтобы обеспечить своевременное завершение запросов.

1. Определите, требуется ли восстановление. Если вы просто добавляете поля или меняете часть индекса, не связанную с полями, можно просто [обновить определение](https://docs.microsoft.com/rest/api/searchservice/update-index) без его удаление, воссоздание и полная перезагрузка.

1. [Получите определение индекса](https://docs.microsoft.com/rest/api/searchservice/get-index) в случае, если оно необходимо для будущей ссылки.

1. [Отбросьте существующий индекс,](https://docs.microsoft.com/rest/api/searchservice/delete-index)предполагая, что вы не работаете новые и старые индексы бок о бок. 

   Все запросы, предназначенные для этого индекса, немедленно удаляются. Помните, что исключение индекса необратимо, уничтожая физическое хранилище для сбора полей и других конструкций. Пауза, чтобы подумать о последствиях, прежде чем бросить его. 

1. [Создайте пересмотренный индекс,](https://docs.microsoft.com/rest/api/searchservice/create-index)где тело запроса включает измененные или измененные определения поля.

1. [Загрузите индекс с документами](https://docs.microsoft.com/rest/api/searchservice/addupdate-or-delete-documents) из внешнего источника.

При создании индекса физическое хранилище выделяется для каждого поля в схеме индекса, и для каждого поля с поддержкой поиска создается инвертированный индекс. Поля, не поддерживающие поиск, можно использовать в фильтрах или выражениях, но у них нет инвертированных индексов и они недоступны для поиска по полному тексту или нечеткому соответствию. При перестроении индекса эти инвертированные индексы удаляются и создаются снова на основе предоставленной схемы индекса.

Когда вы загружаете индекс, инвертированный индекс каждого поля заполняется всеми уникальными маркированными словами из каждого документа с сопоставлением по идентификаторам соответствующих документов. Например, при индексировании набора данных гостиницы инвертированный индекс для поля "Город" может содержать условия для значений "Сиэтл", "Портленд" и т. д. Для документов, содержащих "Сиэтл" или "Портленд" в поле "Город", будет указан идентификатор рядом с условием поиска. При любой операции [добавления, обновления или удаления](https://docs.microsoft.com/rest/api/searchservice/addupdate-or-delete-documents) условия поиска и список идентификаторов документов обновляются соответствующим образом.

> [!NOTE]
> Если у вас строгие требования к уровню обслуживания, подготовьте новую службу специально для этой работы, чтобы разработка и индексирование выполнялись в полной изоляции от индекса в рабочей среде. Это отдельная служба выполняется на своем оборудовании, устраняя возможное состязание ресурсов. Когда разработка будет завершена, необходимо либо оставить новый индекс на месте, перенаправив запросы в новую конечную точку и индекс, либо запустите готовый код для публикации пересмотренного индекса в исходной службе Azure Cognitive Search. В настоящее время отсутствует механизм для перемещения готового индекса в другую службу.

## <a name="check-for-updates"></a>Проверка обновлений

Вы можете отправлять запросы к индексу сразу после загрузки первого документа. Если вы знаете идентификатор документа, [API REST поиска по документу](https://docs.microsoft.com/rest/api/searchservice/lookup-document) возвращает определенный документ. Для более подробного тестирования подождите полной загрузки индекса, а затем используйте запросы, чтобы проверить контекст, который вы ожидаете увидеть.

Вы можете использовать [Search Explorer](search-explorer.md) или веб-инструмент тестирования, как [Почтальон,](search-get-started-postman.md) чтобы проверить на наличие обновленного контента.

Если вы добавили или переименовали поле, используйте [$select,](search-query-odata-select.md) чтобы вернуть это поле:`search=*&$select=document-id,my-new-field,some-old-field&$count=true`

## <a name="see-also"></a>См. также

+ [Обзор индексатора](search-indexer-overview.md)
+ [Индексирование с поддержкой горизонтального масштабирования в службе "Поиск Azure"](search-howto-large-index.md)
+ [Импорт данных в службу поиска Azure с помощью портала](search-import-data-portal.md)
+ [Индексатор Базы данных SQL Azure](search-howto-connecting-azure-sql-database-to-azure-search-using-indexers.md)
+ [Индексатор Azure Cosmos DB](search-howto-index-cosmosdb.md)
+ [Индексатор хранения azure Blob](search-howto-indexing-azure-blob-storage.md)
+ [Индексатор таблицхранения таблиц Azure](search-howto-indexing-azure-tables.md)
+ [Безопасность в когнитивном поиске Azure](search-security-overview.md)