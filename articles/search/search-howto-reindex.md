---
title: Перестроение индекса поиска
titleSuffix: Azure Cognitive Search
description: Добавьте новые элементы, обновите существующие элементы или документы или удалите устаревшие документы при полной пересборке или частичной индексации, чтобы обновить индекс Когнитивный поиск Azure.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 02/14/2020
ms.openlocfilehash: 8cebe02ebc638ba62fceec80dff2c6724ccf92c8
ms.sourcegitcommit: 0eb0673e7dd9ca21525001a1cab6ad1c54f2e929
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2020
ms.locfileid: "77212301"
---
# <a name="how-to-rebuild-an-index-in-azure-cognitive-search"></a>Как перестроить индекс в Azure Когнитивный поиск

В этой статье объясняется, как перестроить индекс Azure Когнитивный поиск, обстоятельства, при которых требуется перестроение, и рекомендации по устранению последствий перестроения текущих запросов.

*Перестроение* — это удаление и повторное создание структур физических данных, связанных с индексом, включая все индексы, инвертированные на основе поля. В Когнитивный поиск Azure нельзя удалять и повторно создавать отдельные поля. Для перестроения индекса все хранилище полей необходимо удалить, создать заново на основе существующей или измененной схемы индексов, а затем повторно заполнить их данными, отправленными в индекс или полученными из внешних источников. 

Обычно индексы перестраиваются во время разработки, но иногда требуется перестроить индекс рабочего уровня в соответствии со структурными изменениями, например при добавлении сложных типов или полей в средства подбора.

## <a name="rebuild-conditions"></a>Условия перестроения

Удалите и повторно создайте индекс, если выполняется любое из следующих условий. 

| Условие | Описание |
|-----------|-------------|
| Изменение определения поля | Если вы меняете имя поля, тип данных или определенные [атрибуты индекса](https://docs.microsoft.com/rest/api/searchservice/create-index) (с возможностью поиска, фильтрации, сортировки или поддержкой аспектов), требуется полная перестройка. |
| Присвоение полю анализатора | [Анализаторы](search-analyzers.md) определяются в индексе, а затем присваиваются полям. Вы можете добавить новое определение анализатора в индекс в любое время, но *присвоить* анализатор можно только при создании поля. Это касается обоих свойств: **analyzer** и **indexAnalyzer**. Свойство **searchAnalyzer** является исключением (его можно присвоить уже существующему полю). |
| Обновление или удаление определения анализатора в индексе | Удалить или изменить существующую конфигурацию анализатора (анализатор, создатель маркеров, фильтр маркеров или фильтр символов) можно, только перестроив весь индекс. |
| Добавление поля в средство подбора | Чтобы добавить уже существующее поле в конструкцию [средств подбора](index-add-suggesters.md), необходимо перестроить индекс. |
| Удаление поля | Чтобы физически удалить все следы поля, необходимо перестроить индекс. Если перестроить индекс сейчас неудобно, можно изменить код приложения, чтобы отключить доступ к удаленному полю. Физически определение и содержимое поля сохраняются в индексе до следующей перестройки с использованием схемы, в которой это поле отсутствует. |
| Смена уровня | Если требуется дополнительная емкость, обновление на месте в портал Azure отсутствует. Должна быть создана новая служба, и индексы должны быть построены с нуля на новой службе. Чтобы автоматизировать этот процесс, вы можете использовать пример кода с **индексом резервного копирования и восстановления** в этом [репозитории примера Azure когнитивный Поиск .NET](https://github.com/Azure-Samples/azure-search-dotnet-samples). Это приложение будет выполнять резервное копирование индекса в ряд JSON-файлов, а затем повторно создать индекс в указанной службе поиска.|

## <a name="update-conditions"></a>Условия обновления

Многие другие изменения могут быть сделаны без влияния на существующие физические структуры. В частности, для следующих изменений *не* требуется перестроение индекса. Для этих изменений можно [Обновить определение индекса](https://docs.microsoft.com/rest/api/searchservice/update-index) с учетом внесенных изменений.

+ Добавление нового поля
+ Задание атрибута **Доступный для получения** для существующего поля
+ Задание свойства **searchAnalyzer** для существующего поля
+ Добавление нового определения анализатора в индекс
+ Добавление, обновление или удаление профилей повышения
+ Добавление, обновление или удаление параметров CORS
+ Добавление, обновление или удаление synonymMaps

Когда вы добавляете новое поле, во всех существующих в индексе документах новому полю присваивается значение null. При обновлении данных в будущем значения из внешних исходных данных заменяются значениями NULL, добавленными Когнитивный поиск Azure. Дополнительные сведения об обновлении содержимого индекса см. в статье [Добавление, обновление и удаление документов](https://docs.microsoft.com/rest/api/searchservice/addupdate-or-delete-documents).

## <a name="how-to-rebuild-an-index"></a>Как перестроить индекс

Во время разработки схема индекса часто изменяется. Его можно запланировать, создав индексы, которые можно быстро удалить, повторно создать и загрузить с помощью небольшого репрезентативного набора данных. 

Для приложений, которые уже находятся в рабочей среде, рекомендуется создать новый индекс, который выполняется параллельно существующему, чтобы избежать простоя запроса. Код приложения обеспечивает перенаправление на новый индекс.

1. Определите, требуется ли перестроение. Если вы просто добавляете поля или изменяете часть индекса, которая не связана с полями, вы можете просто [Обновить определение](https://docs.microsoft.com/rest/api/searchservice/update-index) без удаления, повторного создания и полной перезагрузки.

1. [Получите определение индекса](https://docs.microsoft.com/rest/api/searchservice/get-index) в том случае, если оно понадобится для дальнейшего использования.

1. [Удалите существующий индекс](https://docs.microsoft.com/rest/api/searchservice/delete-index), если вы не используете новые и старые индексы параллельно. 

   Все запросы, предназначенные для этого индекса, немедленно удаляются. Помните, что удаление индекса необратимо, уничтожение физического хранилища для коллекции Fields и других конструкций. Приостановите, чтобы подумать о последствиях перед их удалением. 

1. [Создание измененного индекса](https://docs.microsoft.com/rest/api/searchservice/create-index), в котором текст запроса включает измененные или измененные определения полей.

1. [Загрузите индекс с документами](https://docs.microsoft.com/rest/api/searchservice/addupdate-or-delete-documents) из внешнего источника.

При создании индекса физическое хранилище выделяется для каждого поля в схеме индекса, и для каждого поля с поддержкой поиска создается инвертированный индекс. Поля, не поддерживающие поиск, можно использовать в фильтрах или выражениях, но у них нет инвертированных индексов и они недоступны для поиска по полному тексту или нечеткому соответствию. При перестроении индекса эти инвертированные индексы удаляются и создаются снова на основе предоставленной схемы индекса.

Когда вы загружаете индекс, инвертированный индекс каждого поля заполняется всеми уникальными маркированными словами из каждого документа с сопоставлением по идентификаторам соответствующих документов. Например, при индексировании набора данных гостиницы инвертированный индекс для поля "Город" может содержать условия для значений "Сиэтл", "Портленд" и т. д. Для документов, содержащих "Сиэтл" или "Портленд" в поле "Город", будет указан идентификатор рядом с условием поиска. При любой операции [добавления, обновления или удаления](https://docs.microsoft.com/rest/api/searchservice/addupdate-or-delete-documents) условия поиска и список идентификаторов документов обновляются соответствующим образом.

> [!NOTE]
> Если у вас строгие требования к уровню обслуживания, подготовьте новую службу специально для этой работы, чтобы разработка и индексирование выполнялись в полной изоляции от индекса в рабочей среде. Это отдельная служба выполняется на своем оборудовании, устраняя возможное состязание ресурсов. По завершении разработки можно либо оставить новый индекс на месте, перенаправлять запросы в новую конечную точку и индекс, либо запустить готовый код для публикации измененного индекса в исходной службе Azure Когнитивный поиск. В настоящее время отсутствует механизм для перемещения готового индекса в другую службу.

## <a name="check-for-updates"></a>Проверка наличия обновлений

Вы можете отправлять запросы к индексу сразу после загрузки первого документа. Если вы знаете идентификатор документа, [API REST поиска по документу](https://docs.microsoft.com/rest/api/searchservice/lookup-document) возвращает определенный документ. Для более подробного тестирования подождите полной загрузки индекса, а затем используйте запросы, чтобы проверить контекст, который вы ожидаете увидеть.

## <a name="see-also"></a>См. также:

+ [Обзор индексатора](search-indexer-overview.md)
+ [Индексирование с поддержкой горизонтального масштабирования в службе "Поиск Azure"](search-howto-large-index.md)
+ [Импорт данных в службу поиска Azure с помощью портала](search-import-data-portal.md)
+ [Индексатор Базы данных SQL Azure](search-howto-connecting-azure-sql-database-to-azure-search-using-indexers.md)
+ [Индексатор Azure Cosmos DB](search-howto-index-cosmosdb.md)
+ [Индексатор хранилища BLOB-объектов Azure](search-howto-indexing-azure-blob-storage.md)
+ [Индексатор хранилища таблиц Azure](search-howto-indexing-azure-tables.md)
+ [Безопасность в Azure Когнитивный поиск](search-security-overview.md)