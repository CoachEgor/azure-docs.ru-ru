---
title: Создание и защита ключей API администратора и запроса, а также управление ими в службе "Поиск Azure"
description: Управление доступом к конечной точке службы с помощью ключей API. Ключи администратора предоставляют доступ на запись. Ключи запроса создаются для доступа только для чтения.
author: HeidiSteen
manager: cgronlun
tags: azure-portal
services: search
ms.service: search
ms.devlang: rest-api
ms.topic: conceptual
ms.date: 05/02/2019
ms.author: heidist
ms.openlocfilehash: f12d7f1a7dfcaf80df9a71a0bfc598d72db63a2e
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "65024413"
---
# <a name="create-and-manage-api-keys-for-an-azure-search-service"></a>Создание ключей API и управление ими для службы "Поиск Azure"

Для всех запросов к службе поиска требуется ключ API, доступный только для чтения, который был создан специально для службы. Этот ключ API является единственным механизмом аутентификации доступа к конечной точке службы поиска. Ключ нужно включить в каждый запрос. В [решениях REST](search-get-started-nodejs.md#update-the-configjs-with-your-search-service-url-and-api-key) ключ API обычно указывается в заголовке запроса. В [решениях .NET](search-howto-dotnet-sdk.md#core-scenarios)ключ часто указывается как параметр конфигурации и затем передается в [SearchServiceClient](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.searchserviceclient) в качестве [Credentials](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.searchserviceclient.credentials) (ключ администратора) или [SearchCredentials](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.searchserviceclient.searchcredentials) (ключа запроса).

Ключи создаются вместе со службой поиска во время подготовки службы. Просмотреть и получить значение ключа можно на [портале Azure](https://portal.azure.com).

![Страница портала, раздел "Параметры", пункт "Ключи"](media/search-manage/azure-search-view-keys.png)

## <a name="what-is-an-api-key"></a>Что собой представляет ключ API

Ключ API является строкой, состоящей из случайно сгенерированных букв и цифр. Используя [разрешения на основе ролей](search-security-rbac.md), вы можете удалять или считывать ключи, но не можете заменить ключ пользовательским паролем или использовать Active Directory в качестве основного метода проверки подлинности для доступа к операциям поиска. 

Для доступа к службе поиска используются два типа ключей: ключи администратора (для чтения и записи) и ключи запроса (только для чтения).

|Ключ|Описание|Ограничения|  
|---------|-----------------|------------|  
|Администратор|Предоставляет полный доступ ко всем операциям, включая возможность управлять службой, создавать и удалять индексы, индексаторы и источники данных.<br /><br /> При создании службы генерируются два ключа администратора, которые на портале называются *первичным* и *вторичным*. При необходимости их можно создать заново независимо друг от друга. При наличии двух ключей один ключ можно сменить, а второй использовать для непрерывного доступа к службе.<br /><br /> Ключи администратора указываются только в заголовках HTTP-запросов. Ключ API администратора нельзя разместить в URL-адресе.|Не более 2 на службу|  
|Запрос|Предоставляет только разрешение на чтение индексов и документов; обычно они добавляются в клиентские приложения, которые создают запросы на поиск.<br /><br /> Ключи запроса создаются по запросу. Их можно создать вручную на портале или программным путем с помощью [REST API управления](https://docs.microsoft.com/rest/api/searchmanagement/).<br /><br /> Ключи запроса можно указать в заголовке HTTP-запроса для операции поиска, предложения или уточняющего запроса. Кроме того, ключ запроса можно передать как параметр в URL-адресе. В зависимости от того, как клиентское приложение формирует запрос, возможно, проще передать ключ в качестве параметра запроса:<br /><br /> `GET /indexes/hotels/docs?search=*&$orderby=lastRenovationDate desc&api-version=2019-05-06&api-key=[query key]`|50 на службу|  

 Визуально нет никакой разницы между ключом администратора и ключом запроса. Оба ключа представляют собой строки из 32 случайно сгенерированных буквенно-цифровых символов. Если вы не знаете, какой тип ключа указан в приложении, вы можете [проверить значения ключа на портале](https://portal.azure.com) или использовать [REST API](https://docs.microsoft.com/rest/api/searchmanagement/), чтобы возвратить значение и тип ключа.  

> [!NOTE]  
>  В целях безопасности в URI запроса не рекомендуется передавать конфиденциальные данные, например `api-key`. В связи с этим Поиск Azure принимает ключи запросов только в виде параметров `api-key` в строках запросов, и использовать такую схему рекомендуется только в том случае, если содержимое индекса должно быть общедоступным. Как правило, мы рекомендуем передавать `api-key` в заголовке запроса.  

## <a name="find-existing-keys"></a>Поиск существующих ключей

Получить ключи доступа можно на портале или с помощью [REST API управления](https://docs.microsoft.com/rest/api/searchmanagement/). Дополнительные сведения см. в статье [об управлении ключами API для администратора и запроса](search-security-api-keys.md).

1. Войдите на [портале Azure](https://portal.azure.com).
2. Выведите список [служб поиска](https://portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Search%2FsearchServices) для вашей подписки.
3. Выберите службу, а на странице "Обзор" щелкните **параметры** >**ключи** для просмотра ключей администратора и запроса.

   ![Страница портала, раздел "Параметры", пункт "Ключи"](media/search-security-overview/settings-keys.png)

## <a name="create-query-keys"></a>Создание ключей запросов

Ключи запросов используются для доступа только для чтения к документов в индексе для операций, предназначенные для коллекции документов. Запросы поиска, фильтрации и предложения, все операции, которые принимают ключ запроса. Любая операция только для чтения, которая возвращает системы определения данных или объекта, такие как состояние определения или индексатор для индекса, требуется ключ администратора.

Ограничение доступа к и операций в клиентских приложениях очень важно для защиты поиск ресурсов в службе. Всегда используете ключ запроса вместо ключа администратора для любого запроса из клиентского приложения.

1. Войдите на [портале Azure](https://portal.azure.com).
2. Выведите список [служб поиска](https://portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Search%2FsearchServices) для вашей подписки.
3. Выберите службу, а на странице "Обзор" щелкните **параметры** >**ключи**.
4. Нажмите кнопку **управление ключами запросов**.
5. Использовать ключ запроса, который уже создан для вашей службы, или создать до 50 ключей запроса. Ключ запроса по умолчанию не имеет имени, но ключи дополнительных запросов могут называться управляемость.

   ![Создать или использовать ключ запроса](media/search-security-overview/create-query-key.png) 

> [!Note]
> Пример кода, демонстрирующий использование ключа запроса можно найти в [Отправка запросов в индекс поиска Azure в C# ](search-query-dotnet.md).

<a name="regenerate-admin-keys"></a>

## <a name="regenerate-admin-keys"></a>Повторное создание ключей администратора

Два ключа администратора создаются для каждой службы, таким образом, можно поворачивать первичного ключа, используя вторичный ключ для обеспечения непрерывности бизнеса.

1. На странице **Параметры** >**Ключи** скопируйте вторичный ключ.
2. Во всех приложениях обновите параметры, добавив вторичный ключ в качестве ключа API.
3. Заново создайте первичный ключ.
4. Обновите все приложения, указав новый первичный ключ.

Если вы случайно восстановить оба ключа одновременно, все клиентские запросы, с помощью этих ключей будут завершаться HTTP 403-запрещено. Однако содержимое не удаляется, и вам не заблокирован без возможности восстановления. 

По-прежнему могут обращаться к ней через портал или уровень управления ([REST API](https://docs.microsoft.com/rest/api/searchmanagement/), [PowerShell](https://docs.microsoft.com/azure/search/search-manage-powershell), или Azure Resource Manager). Функции управления являются рабочем состоянии, через идентификатор подписки не api ключ службы и таким образом, по-прежнему доступно, даже если ключи api не. 

Создав новые ключи с помощью портала или управления слоя, восстановлении доступа к содержимому (индексы, индексаторы, источники данных, карты синонимов) после новые ключи и предоставлять эти ключи в запросах.

## <a name="secure-api-keys"></a>Обеспечение безопасности ключей API
Безопасность ключей API обеспечивается за счет ограничения доступа на портале или в интерфейсах Resource Manager (PowerShell или интерфейс командной строки). Как уже упоминалось, администраторы подписки могут просматривать и повторно создавать все ключи API. В качестве меры предосторожности проверьте назначения ролей, чтобы понять, кто имеет доступ к ключам администратора.

+ На панели мониторинга службы щелкните **Управление доступом (IAM)** , а затем — вкладку **Назначения ролей**, чтобы просмотреть назначенные роли для службы.

Просматривать и повторно создавать ключи могут участники следующих ролей: владелец, участник, [участник службы поиска](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#search-service-contributor).

> [!Note]
> Чтобы применить доступ к результатам поиска на основе удостоверений, вы можете создать фильтры безопасности по идентификаторам, удаляя из результатов те документы, к которым запрашивающая сторона не должна иметь доступ. Дополнительные сведения см. в статьях о [фильтрах безопасности](search-security-trimming-for-azure-search.md) и [безопасности в Active Directory](search-security-trimming-for-azure-search-with-aad.md).

## <a name="see-also"></a>См. также

+ [Управление доступом на основе ролей на портале Azure](search-security-rbac.md)
+ [Управление с помощью PowerShell](search-manage-powershell.md) 
+ [Статья о производительности и оптимизации](search-performance-optimization.md)