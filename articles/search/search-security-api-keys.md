---
title: Создание, управление и безопасность admin и api-ключей запроса
titleSuffix: Azure Cognitive Search
description: Api-ключ контролирует доступ к конечной точке службы. Ключи администратора предоставляют доступ на запись. Ключи запроса создаются для доступа только для чтения.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 11/04/2019
ms.openlocfilehash: 68a17b8b3587077222a9ed2057927c8f16253c1e
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "72794372"
---
# <a name="create-and-manage-api-keys-for-an-azure-cognitive-search-service"></a>Создание и управление api-ключами для службы когнитивного поиска Azure

Для всех запросов к службе поиска требуется ключ API, доступный только для чтения, который был создан специально для службы. Этот ключ API является единственным механизмом аутентификации доступа к конечной точке службы поиска. Ключ нужно включить в каждый запрос. В [решениях REST](search-get-started-postman.md) ключ API обычно указывается в заголовке запроса. В [решениях .NET](search-howto-dotnet-sdk.md#core-scenarios)ключ часто указывается как параметр конфигурации и затем передается в [SearchServiceClient](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.searchserviceclient) в качестве [Credentials](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.searchserviceclient.credentials) (ключ администратора) или [SearchCredentials](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.searchserviceclient.searchcredentials) (ключа запроса).

Ключи создаются вместе со службой поиска во время подготовки службы. Просмотреть и получить значение ключа можно на [портале Azure](https://portal.azure.com).

![Страница портала, раздел "Параметры", пункт "Ключи"](media/search-manage/azure-search-view-keys.png)

## <a name="what-is-an-api-key"></a>Что собой представляет ключ API

Ключ API является строкой, состоящей из случайно сгенерированных букв и цифр. Используя [разрешения на основе ролей](search-security-rbac.md), вы можете удалять или считывать ключи, но не можете заменить ключ пользовательским паролем или использовать Active Directory в качестве основного метода проверки подлинности для доступа к операциям поиска. 

Для доступа к службе поиска используются два типа ключей: ключи администратора (для чтения и записи) и ключи запроса (только для чтения).

|Ключ|Описание|Ограничения|  
|---------|-----------------|------------|  
|Административный|Предоставляет полный доступ ко всем операциям, включая возможность управлять службой, создавать и удалять индексы, индексаторы и источники данных.<br /><br /> При создании службы генерируются два ключа администратора, которые на портале называются *первичным* и *вторичным*. При необходимости их можно создать заново независимо друг от друга. При наличии двух ключей один ключ можно сменить, а второй использовать для непрерывного доступа к службе.<br /><br /> Ключи администратора указываются только в заголовках HTTP-запросов. Ключ API администратора нельзя разместить в URL-адресе.|Не более 2 на службу|  
|Запрос|Предоставляет только разрешение на чтение индексов и документов; обычно они добавляются в клиентские приложения, которые создают запросы на поиск.<br /><br /> Ключи запроса создаются по запросу. Их можно создать вручную на портале или программным путем с помощью [REST API управления](https://docs.microsoft.com/rest/api/searchmanagement/).<br /><br /> Ключи запроса можно указать в заголовке HTTP-запроса для операции поиска, предложения или уточняющего запроса. Кроме того, ключ запроса можно передать как параметр в URL-адресе. В зависимости от того, как клиентское приложение формирует запрос, возможно, проще передать ключ в качестве параметра запроса:<br /><br /> `GET /indexes/hotels/docs?search=*&$orderby=lastRenovationDate desc&api-version=2019-05-06&api-key=[query key]`|50 на службу|  

 Визуально нет никакой разницы между ключом администратора и ключом запроса. Оба ключа представляют собой строки из 32 случайно сгенерированных буквенно-цифровых символов. Если вы не знаете, какой тип ключа указан в приложении, вы можете [проверить значения ключа на портале](https://portal.azure.com) или использовать [REST API](https://docs.microsoft.com/rest/api/searchmanagement/), чтобы возвратить значение и тип ключа.  

> [!NOTE]  
>  В целях безопасности в URI запроса не рекомендуется передавать конфиденциальные данные, например `api-key`. По этой причине Azure Cognitive Search принимает ключ `api-key` запроса только в строке запроса, и следует избегать этого, если содержимое индекса не будет общедоступным. Как правило, мы рекомендуем передавать `api-key` в заголовке запроса.  

## <a name="find-existing-keys"></a>Поиск существующих ключей

Получить ключи доступа можно на портале или с помощью [REST API управления](https://docs.microsoft.com/rest/api/searchmanagement/). Дополнительные сведения см. в статье [об управлении ключами API для администратора и запроса](search-security-api-keys.md).

1. Войдите на [портал Azure](https://portal.azure.com).
2. Выведите список [служб поиска](https://portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Search%2FsearchServices) для вашей подписки.
3. Выберите службу и на странице «Обзор», нажмите **«Параметры** **настроек»,** >чтобы просмотреть ключи от админа и запроса.

   ![Страница портала, раздел "Параметры", пункт "Ключи"](media/search-security-overview/settings-keys.png)

## <a name="create-query-keys"></a>Создание ключей запроса

Ключи запроса используются для доступа только для чтения к документам в индексе для операций, ориентированных на сбор документов. Запросы поиска, фильтрации и предложения — это все операции, которые используют ключ запроса. Любая операция только для чтения, которая возвращает системные данные или определения объектов, такие как определение индекса или статус индекса, требует ключа админ.

Ограничение доступа и операций в клиентских приложениях имеет важное значение для защиты поисковых активов в вашем сервисе. Всегда используйте ключ запроса, а не ключ админ для любого запроса, исходящего из клиентского приложения.

1. Войдите на [портал Azure](https://portal.azure.com).
2. Выведите список [служб поиска](https://portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Search%2FsearchServices) для вашей подписки.
3. Выберите службу и на странице Обзор, нажмите **Кнопка** >**Параметры**.
4. Нажмите **Кнопка Управление клавишами запроса**.
5. Используйте уже сгенерированный для службы ключ запроса или создайте до 50 новых ключей запроса. Ключ запроса по умолчанию не называется, но дополнительные ключи запроса могут быть названы для управляемости.

   ![Создание или использование ключа запроса](media/search-security-overview/create-query-key.png) 

> [!Note]
> Пример кода, показывающий использование ключа запроса, можно найти в [индексе когнитивного поиска Azure в C .](search-query-dotnet.md)

<a name="regenerate-admin-keys"></a>

## <a name="regenerate-admin-keys"></a>Повторное создание ключей администратора

Для каждой службы создаются два клавиши администрирования, чтобы можно было повернуть основной ключ, используя вторичный ключ для непрерывности бизнеса.

1. На странице >**«Параметры»** скопируйте вторичный ключ. **Settings**
2. Во всех приложениях обновите параметры, добавив вторичный ключ в качестве ключа API.
3. Заново создайте первичный ключ.
4. Обновите все приложения, указав новый первичный ключ.

Если вы непреднамеренно регенерируете оба ключа одновременно, все запросы клиентов, использующие эти ключи, не сдадутся с помощью HTTP 403 Запрещено. Тем не менее, содержимое не удаляется, и вы не заблокированы навсегда. 

Вы все еще можете получить доступ к сервису через портал или уровень управления[(REST API,](https://docs.microsoft.com/rest/api/searchmanagement/) [PowerShell](https://docs.microsoft.com/azure/search/search-manage-powershell)или менеджер ресурсов Azure). Функции управления функционируют через идентификатор подписки, а не сервис api-key, и, таким образом, по-прежнему доступны, даже если ваши api-ключи не являются. 

После создания новых ключей через портал или уровень управления доступ к содержимому (индексы, индексы, источники данных, синонимы карты) после того, как у вас есть новые ключи и предоставить эти ключи в запросах.

## <a name="secure-api-keys"></a>Обеспечение безопасности ключей API
Безопасность ключей API обеспечивается за счет ограничения доступа на портале или в интерфейсах Resource Manager (PowerShell или интерфейс командной строки). Как уже упоминалось, администраторы подписки могут просматривать и повторно создавать все ключи API. В качестве меры предосторожности проверьте назначения ролей, чтобы понять, кто имеет доступ к ключам администратора.

+ На панели мониторинга службы щелкните **Управление доступом (IAM)**, а затем — вкладку **Назначения ролей**, чтобы просмотреть назначенные роли для службы.

Просмотр и повторное создание ключей доступны для следующих ролей: владелец, участник, [участник службы поиска](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#search-service-contributor).

> [!Note]
> Чтобы применить доступ к результатам поиска на основе удостоверений, вы можете создать фильтры безопасности по идентификаторам, удаляя из результатов те документы, к которым запрашивающая сторона не должна иметь доступ. Дополнительные сведения см. в статьях о [фильтрах безопасности](search-security-trimming-for-azure-search.md) и [безопасности в Active Directory](search-security-trimming-for-azure-search-with-aad.md).

## <a name="see-also"></a>См. также

+ [Управление доступом на основе ролей в Azure Cognitive Search](search-security-rbac.md)
+ [Управление с помощью PowerShell](search-manage-powershell.md) 
+ [Статья о производительности и оптимизации](search-performance-optimization.md)