---
title: Создание и защита ключей API администратора и запроса, а также управление ими в службе "Поиск Azure"
description: Управление доступом к конечной точке службы с помощью ключей API. Ключи администратора предоставляют доступ на запись. Ключи запроса создаются для доступа только для чтения.
author: HeidiSteen
manager: cgronlun
tags: azure-portal
services: search
ms.service: search
ms.devlang: rest-api
ms.topic: conceptual
ms.date: 05/02/2019
ms.author: heidist
ms.openlocfilehash: d3880ed367ebe33e04f37b139927b75e3d01b178
ms.sourcegitcommit: 670c38d85ef97bf236b45850fd4750e3b98c8899
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/08/2019
ms.locfileid: "68855781"
---
# <a name="create-and-manage-api-keys-for-an-azure-search-service"></a>Создание ключей API и управление ими для службы "Поиск Azure"

Для всех запросов к службе поиска требуется ключ API, доступный только для чтения, который был создан специально для службы. Этот ключ API является единственным механизмом аутентификации доступа к конечной точке службы поиска. Ключ нужно включить в каждый запрос. В [решениях REST](search-get-started-postman.md) ключ API обычно указывается в заголовке запроса. В [решениях .NET](search-howto-dotnet-sdk.md#core-scenarios)ключ часто указывается как параметр конфигурации и затем передается в [SearchServiceClient](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.searchserviceclient) в качестве [Credentials](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.searchserviceclient.credentials) (ключ администратора) или [SearchCredentials](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.searchserviceclient.searchcredentials) (ключа запроса).

Ключи создаются вместе со службой поиска во время подготовки службы. Просмотреть и получить значение ключа можно на [портале Azure](https://portal.azure.com).

![Страница портала, раздел "Параметры", пункт "Ключи"](media/search-manage/azure-search-view-keys.png)

## <a name="what-is-an-api-key"></a>Что собой представляет ключ API

Ключ API является строкой, состоящей из случайно сгенерированных букв и цифр. Используя [разрешения на основе ролей](search-security-rbac.md), вы можете удалять или считывать ключи, но не можете заменить ключ пользовательским паролем или использовать Active Directory в качестве основного метода проверки подлинности для доступа к операциям поиска. 

Для доступа к службе поиска используются два типа ключей: ключи администратора (для чтения и записи) и ключи запроса (только для чтения).

|Ключ|Описание|Ограничения|  
|---------|-----------------|------------|  
|Административная единица|Предоставляет полный доступ ко всем операциям, включая возможность управлять службой, создавать и удалять индексы, индексаторы и источники данных.<br /><br /> При создании службы генерируются два ключа администратора, которые на портале называются *первичным* и *вторичным*. При необходимости их можно создать заново независимо друг от друга. При наличии двух ключей один ключ можно сменить, а второй использовать для непрерывного доступа к службе.<br /><br /> Ключи администратора указываются только в заголовках HTTP-запросов. Ключ API администратора нельзя разместить в URL-адресе.|Не более 2 на службу|  
|Запрос|Предоставляет только разрешение на чтение индексов и документов; обычно они добавляются в клиентские приложения, которые создают запросы на поиск.<br /><br /> Ключи запроса создаются по запросу. Их можно создать вручную на портале или программным путем с помощью [REST API управления](https://docs.microsoft.com/rest/api/searchmanagement/).<br /><br /> Ключи запроса можно указать в заголовке HTTP-запроса для операции поиска, предложения или уточняющего запроса. Кроме того, ключ запроса можно передать как параметр в URL-адресе. В зависимости от того, как клиентское приложение формирует запрос, возможно, проще передать ключ в качестве параметра запроса:<br /><br /> `GET /indexes/hotels/docs?search=*&$orderby=lastRenovationDate desc&api-version=2019-05-06&api-key=[query key]`|50 на службу|  

 Визуально нет никакой разницы между ключом администратора и ключом запроса. Оба ключа представляют собой строки из 32 случайно сгенерированных буквенно-цифровых символов. Если вы не знаете, какой тип ключа указан в приложении, вы можете [проверить значения ключа на портале](https://portal.azure.com) или использовать [REST API](https://docs.microsoft.com/rest/api/searchmanagement/), чтобы возвратить значение и тип ключа.  

> [!NOTE]  
>  В целях безопасности в URI запроса не рекомендуется передавать конфиденциальные данные, например `api-key`. В связи с этим Поиск Azure принимает ключи запросов только в виде параметров `api-key` в строках запросов, и использовать такую схему рекомендуется только в том случае, если содержимое индекса должно быть общедоступным. Как правило, мы рекомендуем передавать `api-key` в заголовке запроса.  

## <a name="find-existing-keys"></a>Найти существующие ключи

Получить ключи доступа можно на портале или с помощью [REST API управления](https://docs.microsoft.com/rest/api/searchmanagement/). Дополнительные сведения см. в статье [об управлении ключами API для администратора и запроса](search-security-api-keys.md).

1. Войдите на [портале Azure](https://portal.azure.com).
2. Выведите список [служб поиска](https://portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Search%2FsearchServices) для вашей подписки.
3. Выберите службу и на странице Обзор щелкните **Параметры** >**ключи** , чтобы просмотреть ключи администратора и запроса.

   ![Страница портала, раздел "Параметры", пункт "Ключи"](media/search-security-overview/settings-keys.png)

## <a name="create-query-keys"></a>Создание ключей запроса

Ключи запроса используются для доступа только для чтения к документам в индексе для операций, предназначенных для коллекции документов. Запросы поиска, фильтрации и предложений — это все операции, которые принимают ключ запроса. Любая операция только чтения, возвращающая системные данные или определения объектов, например определение индекса или состояние индексатора, требует наличия ключа администратора.

Ограничения доступа и операций в клиентских приложениях необходимы для защиты ресурсов поиска в службе. Всегда используйте ключ запроса, а не ключ администратора для любого запроса, исходящего из клиентского приложения.

1. Войдите на [портале Azure](https://portal.azure.com).
2. Выведите список [служб поиска](https://portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Search%2FsearchServices) для вашей подписки.
3. Выберите службу и на странице Обзор щелкните **Параметры** >**ключи**.
4. Щелкните **Управление ключами запроса**.
5. Используйте ключ запроса, уже созданный для вашей службы, или создайте до 50 новых ключей запроса. Ключ запроса по умолчанию не именован, но для управляемости можно назвать дополнительные ключи запроса.

   ![Создание или использование ключа запроса](media/search-security-overview/create-query-key.png) 

> [!Note]
> Пример кода, в котором показано использование ключа запроса, можно найти в разделе [запрос индекса службы C#поиска Azure в ](search-query-dotnet.md).

<a name="regenerate-admin-keys"></a>

## <a name="regenerate-admin-keys"></a>Повторное создание ключей администратора

Для каждой службы создаются два ключа администратора, чтобы можно было поворачивать первичный ключ, используя вторичный ключ для обеспечения непрерывности бизнес-процессов.

1. На странице **Параметры** >**Ключи** скопируйте вторичный ключ.
2. Во всех приложениях обновите параметры, добавив вторичный ключ в качестве ключа API.
3. Заново создайте первичный ключ.
4. Обновите все приложения, указав новый первичный ключ.

Если случайно создать оба ключа одновременно, все клиентские запросы, использующие эти ключи, завершатся ошибкой HTTP 403 запрещено. Однако содержимое не удаляется, и вы не блокируете его без возможности восстановления. 

Вы по-прежнему можете получить доступ к службе на портале или на уровне управления ([REST API](https://docs.microsoft.com/rest/api/searchmanagement/), [PowerShell](https://docs.microsoft.com/azure/search/search-manage-powershell)или Azure Resource Manager). Функции управления работают с ИДЕНТИФИКАТОРом подписки, а не ключом API службы и, таким же, доступны даже в том случае, если ключи API не используются. 

После создания новых ключей с помощью портала или слоя управления доступ восстанавливается в содержимое (индексы, индексаторы, источники данных, карты синонимов), когда у вас есть новые ключи и эти ключи задаются в запросах.

## <a name="secure-api-keys"></a>Обеспечение безопасности ключей API
Безопасность ключей API обеспечивается за счет ограничения доступа на портале или в интерфейсах Resource Manager (PowerShell или интерфейс командной строки). Как уже упоминалось, администраторы подписки могут просматривать и повторно создавать все ключи API. В качестве меры предосторожности проверьте назначения ролей, чтобы понять, кто имеет доступ к ключам администратора.

+ На панели мониторинга службы щелкните **Управление доступом (IAM)** , а затем — вкладку **Назначения ролей**, чтобы просмотреть назначенные роли для службы.

Просматривать и повторно создавать ключи могут участники следующих ролей: владелец, участник, [участник службы поиска](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#search-service-contributor).

> [!Note]
> Чтобы применить доступ к результатам поиска на основе удостоверений, вы можете создать фильтры безопасности по идентификаторам, удаляя из результатов те документы, к которым запрашивающая сторона не должна иметь доступ. Дополнительные сведения см. в статьях о [фильтрах безопасности](search-security-trimming-for-azure-search.md) и [безопасности в Active Directory](search-security-trimming-for-azure-search-with-aad.md).

## <a name="see-also"></a>См. также

+ [Управление доступом на основе ролей на портале Azure](search-security-rbac.md)
+ [Управление с помощью PowerShell](search-manage-powershell.md) 
+ [Статья о производительности и оптимизации](search-performance-optimization.md)