---
title: Как задать запрос Azure Cognitive Search из power Apps
titleSuffix: Azure Cognitive Search
description: Пошагзае руководство о том, как создать пользовательский разъем для когнитивного поиска и как визуализировать его из приложения Power App
author: luiscabrer
manager: eladz
ms.author: luisca
ms.service: cognitive-search
ms.devlang: rest-api
ms.topic: conceptual
ms.date: 03/25/2020
ms.openlocfilehash: c246f8652227a5ad2c0798880e530d6039cdeea8
ms.sourcegitcommit: e040ab443f10e975954d41def759b1e9d96cdade
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/29/2020
ms.locfileid: "80385118"
---
# <a name="how-to-query-a-cognitive-search-index-from-power-apps"></a>Как задать запрос на индекс когнитивного поиска из Power Apps

В этом документе показано, как создать пользовательский разъем Power Apps, чтобы можно было получить результаты поиска из поискового индекса. Он также показывает, как выдать поисковый запрос и визуализировать результаты с Power App. 

## <a name="prerequisites"></a>Предварительные требования
*    Доступ к учетной записи Power Apps с возможностью создания пользовательских разъемов.
*    Мы предполагаем, что вы уже создали индекс поиска Azure.

## <a name="create-a-custom-connector-to-query-azure-search"></a>Создание пользовательского разъема для поиска запроса Azure

Есть два основных шага к тому, чтобы иметь PowerApp, который показывает результаты когнитивного поиска Azure. Во-первых, давайте создадим разъем, который может задать запрос индексу поиска. В [следующем разделе](#visualize-results-from-the-custom-connector) мы обновим ваше приложение Power Apps, чтобы визуализировать результаты, возвращенные разъемом.

1. Перейти к [make.powerapps.com](http://make.powerapps.com) и **войти в**.

1. Поиск**пользовательских соединителей** **данных** > 
 
    :::image type="content" source="./media/search-howto-powerapps/1-2-custom-connector.png" alt-text="Пользовательское меню разъема" border="true":::

1. Нажмите **на новый пользовательский разъем,** а затем выберите **Создать из пустой**.

    :::image type="content" source="./media/search-howto-powerapps/1-3-create-blank.png" alt-text="Создание из пустого меню" border="true":::

1. Дайте вашему пользовательскому разъему имя. (то есть, *AzureSearch's),* а затем нажмите **Продолжить**. Это позволит воспитать мастера, чтобы создать новый разъем.

1. Введите информацию на Общую Страницу.

    - Цвет фона значка (например, #007ee5)
    - Описание (например, «Разъем для когнитивного поиска Azure»)
    - В Host необходимо ввести URL-адрес поисковой службы (например, `<yourservicename>.search.windows.net`)
    - Для базового URL просто введите "/"
    
    :::image type="content" source="./media/search-howto-powerapps/1-5-general-info.png" alt-text="Общий информационный диалог" border="true":::

1. На странице безопасности установите *aPI-ключ* в качестве **типа аутентификации,** установите параметрную метку и поля имени параметра в качестве *api-key.* Для **расположения параметра**выберите *заголовок,* как показано ниже.
 
    :::image type="content" source="./media/search-howto-powerapps/1-6-authentication-type.png" alt-text="Опция типа аутентификации" border="true":::

1. На странице «Определения» выберите **новое действие** для создания действия, которое будет заготавлив индекс. Введите значение "Запрос" для резюме и имя идентификатора операции. Введите описание типа *"Запросы индекса поиска"*.
 
    :::image type="content" source="./media/search-howto-powerapps/1-7-new-action.png" alt-text="Новые варианты действий" border="true":::


1. Нажмите кнопку **«Импорт» с точки влитого** влобов, чтобы определить параметры и заголовки. Далее вы определите запрос запроса.  

    * Выберите глагол`GET`
    * Для URL-адреса введите пример запроса для вашего поискового индекса, например:
       
    >https://yoursearchservicename.search.windows.net/indexes/yourindexname/docs?search=«&api-версия»2019-05-06-Preview
    

    **Power Apps** будет использовать синтаксис для извлечения параметров из запроса. Обратите внимание, что мы четко определили поле поиска. 

    :::image type="content" source="./media/search-howto-powerapps/1-8-1-import-from-sample.png" alt-text="Импорт из примера" border="false":::

1.  Нажмите **«Импорт»,** чтобы автоматически заполнить диалог запроса.

    :::image type="content" source="./media/search-howto-powerapps/1-8-2-import-from-sample.png" alt-text="Импорт из образца диалога" border="false":::


1. Полная настройка метаданных параметра, нажав **на ...** символ рядом с каждым из параметров.

    - Для *поиска* `*` : Установите в качестве **значения по умолчанию,** установить **требуется** как *ложные* и установить **видимость** *нет.* 

    :::image type="content" source="./media/search-howto-powerapps/1-10-1-parameter-metadata-search.png" alt-text="Метаданные параметров поиска" border="true":::

    - Для *api-версии*: Установите `2019-05-06-Preview` в качестве **значения по умолчанию,** установите **видимость** как внутреннюю и установите, **необходимые** *true.*  

    :::image type="content" source="./media/search-howto-powerapps/1-10-2-parameter-metadata-version.png" alt-text="Метаданные параметра версии" border="true":::

    - Аналогичным образом, для *api-ключ*, установить его **по мере необходимости,** с *внутренней* **видимости.** Введите aPI-ключ службы поиска в качестве **значения по умолчанию.**
    
    После внесения этих изменений переключитесь на представление **редактора Swagger.** В разделе параметров следует увидеть следующую конфигурацию:    

    ```
          parameters:
          - {name: search, in: query, required: false, type: string, default: '*'}
          - {name: api-version, in: query, required: true, type: string, default: 2019-05-06-Preview,
            x-ms-visibility: internal}
          - {name: api-key, in: header, required: true, type: string, default: YOURKEYGOESHERE,
            x-ms-visibility: internal}
    ```

1. В разделе Ответ нажмите **кнопку "Добавить ответ по умолчанию".** Это очень важно, поскольку это поможет **Power Apps** понять схему ответа. Вставьте образец ответа.

    > [!TIP] 
    > Существует ограничение символов для ответа JSON, в который вы можете ввести, так что вы можете упростить JSON так, чтобы он перед его вставкой. Схема важного аспекта/формат ответа. Фактические значения в ответе выборки менее важны и могут быть упрощены для уменьшения количества символов.
    

1.    Нажмите кнопку **Create разъема** в правом верхнем правом верхнем экране, прежде чем вы сможете протестировать его.

1.  На странице тестирования щелкните **новое соединение**и введите клавишу поиска службы поиска в качестве значения для *api-key.*

    Этот шаг может привести вас к выходу из мастера и на страницу Соединения. Вы можете вернуться к редактору пользовательских подключений, чтобы проверить соединение. Перейти к **пользовательским соединитель** > Выберите вновь созданный соединитель > *...* > **Просмотр свойств** > **Отсечения** > **4. Тест,** чтобы вернуться на тестовую страницу.

1.    Теперь нажмите **тестовую операцию,** чтобы убедиться, что вы получаете результаты от вашего индекса. Если вы были успешными, вы должны увидеть 200 статус, и в теле ответа вы должны увидеть JSON, который описывает результаты поиска.




## <a name="visualize-results-from-the-custom-connector"></a>Визуализация результатов пользовательского разъема
Цель этого учебника не показать вам, как создать причудливый пользовательский опыт с приложениями питания, так что макет пользовательского интерфейса будет минималистичным. Давайте создадим PowerApp с полем поиска, кнопкой поиска и отобразим результаты в управлении галереей.  PowerApp подключится к нашему недавно созданному пользовательскому разъему для получения данных из Azure Search.

1. Создайте новое приложение Power App. Перейдите в раздел **Приложения,** нажмите на **новое приложение**и выберите **Canvas**.

    :::image type="content" source="./media/search-howto-powerapps/2-1-create-canvas.png" alt-text="Создание приложения canvas" border="true":::

1. Выберите тип приложения, которое вы хотели бы. Для этого учебника создать **пустое приложение** с **телефоном Layout**. Появится **студия Power Apps.**

1. Оказавшись в студии, выберите вкладку **«Источники данных»** и нажмите на новый разъем, который вы только что создали. В нашем случае он называется *AzureSearch's*. Нажмите **Добавить соединение**.

    :::image type="content" source="./media/search-howto-powerapps/2-3-connect-connector.png" alt-text="соединить разъем" border="true":::

    Теперь *AzureSearch'ry* — это источник данных, который можно использовать в приложении.
    
1. Перейдите на **вкладку Insert,** чтобы мы могли добавить несколько элементов управления в нашу форму.

    :::image type="content" source="./media/search-howto-powerapps/2-4-add-controls.png" alt-text="Вставить элементы управления" border="true":::

1.  Вставьте следующие элементы:
    -   Текстовая этикетка со значением "Запрос:"
    -   Элемент ввода текста (назовем его *txt'ery,* значение по умолчанию: «Я»)
    -   Кнопка с текстом "Поиск" 
    -   Вертикальная галерея называется (назовите его *galleryResults*)
    
    Ваша форма должна выглядеть примерно так:

    :::image type="content" source="./media/search-howto-powerapps/2-5-controls-layout.png" alt-text="Макет элементов управления" border="true":::

1. Чтобы **сделать кнопку поиска** запрос, выберите кнопку и вставьте следующее действие, чтобы взять на **OnSelect:**

    ```
    If(!IsBlank(txtQuery.Text),
        ClearCollect(azResult, AzureSearchQuery.Get({search: txtQuery.Text}).value))
    ```

    :::image type="content" source="./media/search-howto-powerapps/2-6-search-button-event.png" alt-text="Кнопка OnSelect" border="true":::
 
    Это действие приведет к тому, что кнопка обновит новую коллекцию под названием *azResult* с результатом поискового запроса, используя текст в текстовом поле *txt'query* в качестве термина запроса.
    
1.  В качестве следующего шага мы свяжем вертикальную галерею, созданную ими, с коллекцией *azResult.* Выберите элемент управления галереи и выполните следующие действия в панели свойств.

    -  Установите **DataSource** на *azResult*.
    
    -  Выберите **layout,** который работает для вас на основе типа данных в индексе. В этом случае мы использовали *название, субтитры и макет кузова.*
    
    -  **Отспособите поля**и выберите поля, которые вы хотели бы визуализировать.

    Так как мы предоставили результат выборки, когда мы определили разъем, приложение знает о полях, доступных в вашем индексе.
    
    :::image type="content" source="./media/search-howto-powerapps/2-7-gallery-select-fields.png" alt-text="Поля коллекции" border="true":::   
 
1.  Нажмите **F5,** чтобы просмотреть приложение.  

    Помните, что поля могут быть настроены на расчетные значения.      
    Например, установка с использованием макета *"Изображение, название и подзаголовок"* и указание функции *изображения* как конкатации `"https://mystore.blob.core.windows.net/multilang/" & ThisItem.metadata_storage_name`корневого контура для данных и имени файла (например, ) приведут к результату ниже.

    :::image type="content" source="./media/search-howto-powerapps/2-8-2-final.png" alt-text="Окончательный вид приложения" border="true":::        

## <a name="next-steps"></a>Дальнейшие действия

Для получения дополнительной информации и онлайн-обучения, [см.](https://docs.microsoft.com/powerapps/learning-catalog/get-started)

