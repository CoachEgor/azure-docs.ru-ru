---
title: Как работать с результатами поиска
titleSuffix: Azure Cognitive Search
description: Структурируйте и сортируйте результаты поиска, получайте количество документов и добавляйте навигацию содержимого в результаты поиска в Azure Cognitive Search.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 04/01/2020
ms.openlocfilehash: df80668f5e4a31d6247e9e9806e3de0667fd9036
ms.sourcegitcommit: 62c5557ff3b2247dafc8bb482256fef58ab41c17
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/03/2020
ms.locfileid: "80656009"
---
# <a name="how-to-work-with-search-results-in-azure-cognitive-search"></a>Как работать с результатами поиска в Azure Cognitive Search

В этой статье объясняется, как получить ответ на запрос, который возвращается с полным подсчетом соответствующих документов, результатов, отсортированных результатов и терминов, выделенных на хит.

Структура ответа определяется параметрами в запросе: [Поисковый документ](https://docs.microsoft.com/rest/api/searchservice/Search-Documents) в REST API или [DocumentSearchResult Class](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.models.documentsearchresult-1) в .NET SDK.

## <a name="result-composition"></a>Результатная композиция

Хотя документ поиска может состоять из большого количества полей, обычно для представления каждого документа в наборе результатов требуется лишь несколько. В запросе запроса `$select=<field list>` приложение укажите, какие поля отображаются в ответе. Поле должно быть отнесено как **извлекаемое** в индекс, чтобы быть включенным в результат. 

Поля, которые работают лучше всего, включают те, которые контрастируют и различают сятворность между документами, предоставляя достаточную информацию, чтобы предложить клик-через ответ со стороны пользователя. На сайте электронной коммерции, это может быть название продукта, описание, бренд, цвет, размер, цена и рейтинг. Для встроенных образцов отелей-образецов могут быть поля в следующем примере:

```http
POST /indexes/hotels-sample-index/docs/search?api-version=2019-05-06 
    {  
      "search": "sandy beaches",
      "select": "HotelId, HotelName, Description, Rating, Address/City"
      "count": true
    }
```

> [!NOTE]
> Если в результате необходимо включить файлы изображений, такие как фотография продукта или логотип, храните их за пределами Azure Cognitive Search, но включите поле в индекс для ссылки на URL-адрес изображения в документе поиска. Пример индексов, которые поддерживают изображения в результатах включают **в себя realestate-образец нас** демо, Лучшее в этом [quickstart](search-create-app-portal.md), и [Нью-йорк Джобс демо-приложение](https://aka.ms/azjobsdemo).

## <a name="paging-results"></a>Разбиение результатов по страницам

По умолчанию поисковая система возвращается до первых 50 совпадений, определяемых счетом поиска, если запрос выполнен полный текстовый поиск, или в произвольном порядке для точных запросов соответствия.

Чтобы вернуть другое количество соответствующих документов, добавьте `$top` и `$skip` параметры в запрос запроса. Следующий список объясняет логику.

+ Добавьте, `$count=true` чтобы получить подсчет общего числа соответствующих документов в индексе.

+ Верните первый набор из 15 соответствующих документов плюс подсчет общего количества матчей:`GET /indexes/<INDEX-NAME>/docs?search=<QUERY STRING>&$top=15&$skip=0&$count=true`

+ Вернуть второй сет, пропустив первые 15, `$top=15&$skip=15`чтобы получить следующие 15: . Сделайте то же самое для третьего набора из 15:`$top=15&$skip=30`

Результаты paginated запросов не гарантированно будут стабильными, если базовый индекс меняется. Paging изменяет `$skip` значение для каждой страницы, но каждый запрос независим и работает на текущем представлении данных, как это существует в индексе во время запроса (другими словами, нет кэширования или моментального снимка результатов, таких как те, которые содержатся в базе данных общего назначения).
 
Ниже приводится пример того, как вы можете получить дубликаты. Предположим, индекс с четырьмя документами:

    { "id": "1", "rating": 5 }
    { "id": "2", "rating": 3 }
    { "id": "3", "rating": 2 }
    { "id": "4", "rating": 1 }
 
Теперь предположим, что вы хотите, чтобы результаты вернулись два за один раз, заказывающий по рейтингу. Выполнить этот запрос, чтобы получить первую `$top=2&$skip=0&$orderby=rating desc`страницу результатов: , приподготовке следующих результатов:

    { "id": "1", "rating": 5 }
    { "id": "2", "rating": 3 }
 
На службе предположим, что пятый документ добавляется `{ "id": "5", "rating": 4 }`к индексу между вызовами запросов: .  Вскоре после этого вы выполняете запрос, чтобы `$top=2&$skip=2&$orderby=rating desc`получить вторую страницу: и получите следующие результаты:

    { "id": "2", "rating": 3 }
    { "id": "3", "rating": 2 }
 
Обратите внимание, что документ 2 извлекается дважды. Это потому, что новый документ 5 имеет большее значение для рейтинга, поэтому он сортирует до документа 2 и приземляется на первой странице. Хотя такое поведение может быть неожиданным, это типично для того, как ведет себя поисковая система.

## <a name="ordering-results"></a>Упорядочение результатов

Для запросов полного поиска текста результаты автоматически ранжируются по счету поиска, рассчитанному на основе частоты терминов и близости в документе, при этом более высокие баллы будут высливать документы, имеющие более или более сильные совпадения на поисковом термине. 

Результаты поиска передают общее чувство актуальности, отражая силу матча по сравнению с другими документами в том же наборе результатов. Оценки не всегда совпадают от одного запроса к другому, поэтому при работе с запросами можно заметить небольшие расхождения в порядке заказа документов поиска. Есть несколько объяснений того, почему это может произойти.

| Причина | Описание |
|-----------|-------------|
| Волатильность данных | Содержание индекса меняется при добавлении, изменении или удалении документов. Срокчастоты будут меняться по мере обработки обновлений индекса с течением времени, что влияет на оценки поиска соответствующих документов. |
| Несколько реплик | Для служб, использующих несколько реплик, параллельно выдаются запросы против каждой реплики. Статистика индекса, используемая для расчета оценки поиска, рассчитывается на основе реплики, при этом результаты сливаются и упорядочены в ответе запроса. Реплики в основном зеркала друг от друга, но статистика может отличаться из-за небольших различий в состоянии. Например, одна реплика могла удалить документы, вносящие вклад в их статистику, которые были объединены из других реплик. Как правило, различия в статистике на реплику более заметны в меньших индексах. |
| Идентичные оценки | Если несколько документов имеют один и тот же балл, любой из них может появиться первым.  |

### <a name="consistent-ordering"></a>Последовательный заказ

Учитывая гибкость в заказе результатов, можно изучить другие варианты, если согласованность является требованием приложения. Самый простой подход — сортировка по местом поля, например рейтингу или дате. Для сценариев, где вы хотите сортировать по определенному полю, например рейтинг или дату, можно четко определить [ `$orderby` выражение,](query-odata-filter-orderby-syntax.md)которое может быть применено к любому поле, которое проиндексировано как **Sortable.**

Другим вариантом является использование [пользовательского профиля скоринга.](index-add-scoring-profiles.md) Профили оценки дают вам больше контроля над рейтингом элементов в результатах поиска, с возможностью увеличения совпадений, найденных в определенных областях. Дополнительная логика скоринга может помочь переопределить незначительные различия между репликами, поскольку оценки поиска для каждого документа находятся дальше друг от друга. Мы рекомендуем [алгоритм ранжирования](index-ranking-similarity.md) для такого подхода.

## <a name="hit-highlighting"></a>Выделение совпадений

Хит-подчеркнув относится к форматированию текста (например, смелые или желтые освещаются) применяется к сопоставлению термина в результате, что делает его легко обнаружить матч. Инструкции по подсветке хита предоставляются в [запросе запроса.](https://docs.microsoft.com/rest/api/searchservice/search-documents) Поисковая система прикрепивает соответствующий `highlightPreTag` термин `highlightPostTag`в теги, и ваш код обрабатывает ответ (например, применяя жирный шрифт).

Форматирование применяется к запросам всего срока. В следующем примере термины "песчаный", "песок", "пляж", "пляж", найденные в поле описания, помечены для выделения. Запросы на частичных терминах, таких как нечеткий поиск или поиск подстановочных знаков, которые приводят к расширению запроса в движке, не могут использовать выделение хита.

```http
POST /indexes/hotels-sample-index/docs/search?api-version=2019-05-06 
    {  
      "search": "sandy beaches",  
      "highlight": "Description"
    }
```

> [!IMPORTANT]
> Услуги, созданные после 15 июля 2020 года, предоставят другой опыт выделения. Службы, созданные до этой даты, не изменятся в поведении выделений. С этим изменением будут возвращены только фразы, которые соответствуют полному запросу фразы. Также можно будет указать размер фрагмента, возвращенный для изюминки.
>
> Когда вы пишете клиентский код, который реализует выделение хита, будьте в курсе этого изменения. Обратите внимание, что это не повлияет на вас, если вы не создадите совершенно новый поисковый сервис.

## <a name="next-steps"></a>Дальнейшие действия

Чтобы быстро создать страницу поиска для клиента, рассмотрим следующие варианты:

+ [Генератор приложений](search-create-app-portal.md)на портале создает HTML-страницу с панелью поиска, граненой навигацией и областью результатов, которая включает изображения.
+ [Создать свое первое приложение в СК](tutorial-csharp-create-first-app.md) является учебник, который строит функционального клиента. Пример кода демонстрирует paginated запросы, подсветку хитов и сортировку.

Несколько образцов кода включают веб-интерфейс интерфейса, который вы можете найти здесь: [New York City Jobs демо-приложение,](https://aka.ms/azjobsdemo) [JavaScript образец кода с живой демо-сайт](https://github.com/liamca/azure-search-javascript-samples), и [CognitiveSearchFrontEnd](https://github.com/LuisCabrer/CognitiveSearchFrontEnd).