---
title: Оценка емкости и затрат
titleSuffix: Azure Cognitive Search
description: Ознакомьтесь с руководством по оценке емкости и управлению затратами на службу поиска, включая инфраструктуру и средства в Azure, а также рекомендации по более эффективному использованию ресурсов.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 12/15/2020
ms.openlocfilehash: d48ae71a979a2d0f1457b0cefa8a98a02710dd96
ms.sourcegitcommit: 77ab078e255034bd1a8db499eec6fe9b093a8e4f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/16/2020
ms.locfileid: "97577749"
---
# <a name="how-to-estimate-capacity-and-costs-of-an-azure-cognitive-search-service"></a>Оценка емкости и затрат на службу Когнитивный поиск Azure

В рамках планирования ресурсов для Когнитивный поиск Azure следующие рекомендации помогут снизить затраты или более эффективно управлять затратами.

+ Создайте все ресурсы в одном и том же регионе или как можно меньшее количество регионов, чтобы свести к сведению или исключить плату за пропускную способность.

+ Объедините все службы в одну группу ресурсов, например Azure Когнитивный поиск, Cognitive Services и другие службы Azure, используемые в решении. В портал Azure найдите группу ресурсов и используйте команды **управления затратами** для анализа фактических и прогнозируемых расходов.

+ Рассмотрим веб-приложение Azure для внешнего приложения, чтобы запросы и ответы оставались в пределах границ центра обработки данных.

+ Увеличение масштаба для ресурсоемких операций, таких как индексирование, а затем изменение их вниз для обычных рабочих нагрузок запросов. Начните с минимальной конфигурации Когнитивный поиск Azure (одной SU, состоящей из одной секции и одной реплики), а затем Отслеживайте действия пользователей, чтобы определить закономерности использования, которые свидетельствуют о необходимости увеличения емкости. Если имеется прогнозируемый шаблон, вы можете синхронизировать масштабирование с действием (для автоматизации этого потребуется написать код).

В [выборе ценовой категории](search-sku-tier.md)объясняются оплачиваемые события, формула оплаты и коэффициент оплаты. Кроме того, вы можете посетить [Управление выставлением счетов и затратами](../cost-management-billing/cost-management-billing-overview.md) для встроенных средств и функций, относящихся к расходам.

Не удается завершить работу службы поиска на временной основе. Выделенные ресурсы всегда работают, выделяются для монопольного использования в течение срока службы. Удаление службы является постоянной, а также удаляет связанные с ней данные.

В терминах самой службы единственным способом снижения счета является сокращение количества реплик и секций до уровня, который по-прежнему обеспечивает приемлемое соответствие производительности и [соглашений об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/search/v1_0/), или создание службы на более низком уровне (часовые тарифы S1 ниже S2 или S3). Предполагая, что вы подготавливаете службу в нижней части проекций нагрузки, если вы масштабируемостьи службу, вы можете создать вторую более крупную службу, перестроить индексы во второй службе, а затем удалить первую из них.

## <a name="how-to-evaluate-capacity-requirements"></a>Оценка требований к емкости

В Когнитивный поиск Azure емкость структурирована как *реплики* и *Секции*.

+ Реплики — это экземпляры службы поиска. Каждая реплика содержит одну копию индекса с балансировкой нагрузки. Например, служба с шестью репликами имеет шесть копий каждого индекса, загруженного в службу.

+ Секции хранят индексы и автоматически разбивают данные, поддерживающие поиск. Два раздела делят индекс на две части, три секции разбивают их на третьи и т. д. С точки зрения емкости *размер секции* является основной отличительной особенностью уровней.

> [!NOTE]
> Все уровни Standard и оптимизированные для хранилища поддерживают [гибкие сочетания реплик и секций](search-capacity-planning.md#chart) , что позволяет [оптимизировать систему для ускорения или хранения](search-performance-optimization.md) , изменяя баланс. Уровень "базовый" предлагает до трех реплик для обеспечения высокой доступности, но имеет только один раздел. Бесплатные уровни не предоставляют выделенные ресурсы: вычислительные ресурсы совместно используются несколькими подписчиками.

### <a name="evaluating-capacity"></a>Оценка емкости

Емкость и стоимость работы службы. Уровни накладывают ограничения на два уровня: Хранение и содержимое (например, количество индексов). Следует подумать о обоих случаях, так как достигнуто максимально допустимое ограничение.

Бизнес-требования обычно определяют необходимое количество индексов. Например, может потребоваться глобальный индекс для большого репозитория документов. Или может потребоваться несколько индексов на основе региона, приложения или бизнес-нишу.

Чтобы определить размер индекса, необходимо [создать его](search-what-is-an-index.md). Его размер будет основан на импортированных данных и конфигурации индекса, например о включении предложений, фильтрации и сортировки.

Для полнотекстового поиска Первичная структура данных является [инвертированной](https://en.wikipedia.org/wiki/Inverted_index) структурой индекса, которая имеет различные характеристики, чем исходные данные. Для инвертированного индекса размер и сложность определяются по содержимому, а не к объему данных, которые вы передаете в него. Большой источник данных с высокой избыточностью может привести к тому, что индекс будет меньше, чем меньший набор данных, содержащий сильно изменяемое содержимое. Поэтому редко бывает возможно определить размер индекса на основе размера исходного набора данных.

> [!NOTE] 
> Несмотря на то, что оценка будущих потребностей для индексов и хранилища может показаться предоставляяй, она стоит делать. Если емкость уровня оказывается слишком низкой, необходимо создать новую службу на более высоком уровне, а затем [перезагрузить индексы](search-howto-reindex.md). Обновление службы на месте с одного уровня на другой не выполняется.
>

## <a name="estimate-with-the-free-tier"></a>Оценка на уровне Free

Один из способов оценки емкости — начать с бесплатного уровня. Помните, что бесплатная служба предлагает до трех индексов, 50 МБ хранилища и 2 минуты времени индексирования. Оценка предполагаемого размера индекса с этими ограничениями может быть непростой, но это шаги:

+ [Создайте бесплатную службу](search-create-service-portal.md).
+ Подготовьте небольшой репрезентативный набор данных.
+ [Создайте исходный индекс на портале](search-get-started-portal.md) и запишите его размер. Функции и атрибуты оказывают влияние на хранилище. Например, добавление предложений (Поиск по мере ввода) приведет к увеличению требований к хранилищу. Используя тот же набор данных, вы можете попытаться создать несколько версий индекса с различными атрибутами для каждого поля, чтобы увидеть, как требования к хранилищу различны. Дополнительные сведения см. [в разделе "влияние на хранилище" раздела Создание базового индекса](search-what-is-an-index.md#index-size).

Выполнив приблизительную оценку, вы можете вдвое воздействовать на бюджет для двух индексов (разработки и рабочей среды), а затем выбрать свой уровень соответствующим образом.

## <a name="estimate-with-a-billable-tier"></a>Оценка с помощью оплачиваемого уровня

Выделенные ресурсы могут поддерживать большую выборку и время обработки для более реалистичных оценок объема индексов, размера и запросов во время разработки. Некоторые клиенты переходят вправо с помощью оплачиваемого уровня, а затем повторно вычисляют проект разработки.

1. [Просмотрите ограничения службы на каждом уровне](./search-limits-quotas-capacity.md#index-limits) , чтобы определить, могут ли более низкие уровни поддерживать необходимое количество индексов. Для уровней Basic, S1 и S2 ограничения индекса равны 15, 50 и 200 соответственно. Уровень, оптимизированный для хранилища, имеет ограничение в 10 индексов, поскольку оно предназначено для поддержки небольшого количества очень больших индексов.

1. [Создайте службу на платном уровне](search-create-service-portal.md):

    + Если вы не уверены в прогнозируемой нагрузке, начните с Low, Basic или S1.
    + Если вы знаете, что планируется крупномасштабное индексирование и загрузка запросов, начните с уровня S2 или даже S3.
    + Начните с оптимизированного хранилища на уровне L1 или L2, если вы индексируете большой объем данных, а загрузка запросов относительно низкая, как в случае внутреннего бизнес-приложения.

1. [Создайте начальный индекс](search-what-is-an-index.md), чтобы определить, как исходные данные преобразуются в индекс. Это единственный способ оценки размера индекса.

1. [Отслеживайте хранилище, ограничения служб, объем запросов и задержку](search-monitor-usage.md) в портале. На портале отображаются запросы в секунду, регулируемые запросы и задержки поиска. Все эти значения помогут решить, выбран ли подходящий уровень. 

Порядковый номер и размер индекса не менее важны для вашего анализа. Это связано с тем, что максимальное количество ограничений достигается за счет полного использования хранилища (секций) или максимальных ограничений на ресурсы (индексы, индексаторы и т. д.), в зависимости от того, что происходит первым. Портал помогает отслеживать и то, и другое, показывая текущее использование и максимальные ограничения на странице "Обзор".

> [!NOTE]
> Требования к хранилищу могут быть сведены, если документы содержат лишние данные. В идеале документы содержат только те данные, которые необходимы для поиска. Двоичные данные недоступны для поиска и должны храниться отдельно (возможно, в таблице Azure или хранилище BLOB-объектов). Поле должно быть добавлено в индекс для хранения URL-ссылки на внешние данные. Максимальный размер отдельного документа составляет 16 МБ (или меньше, если вы выполняете небольшую загрузку нескольких документов в одном запросе). Дополнительные сведения см. [в статье ограничения службы в когнитивный Поиск Azure](search-limits-quotas-capacity.md).
>

**Рекомендации по объему запросов**

Количество запросов в секунду (QPS) является важной метрикой во время настройки производительности, но обычно это относится только к уровню, если предполагается, что вы планируете высокий объем запросов.

Уровни Standard могут обеспечивать баланс между репликами и секциями. Вы можете увеличить количество запросов, добавив реплики для балансировки нагрузки или добавив секции для параллельной обработки. Затем можно настроить производительность после подготовки службы.

Если вы предполагали, что самые высокие объемы запросов будут задерживаться с самого начала, следует рассмотреть более высокие уровни уровня Standard, которые поддерживаются более мощным оборудованием. После этого можно перевести секции и реплики в автономный режим или даже переключиться на службу более низкого уровня, если эти тома запросов не выполняются. Дополнительные сведения о том, как вычислить пропускную способность запросов, см. в статье [производительность и оптимизация когнитивный Поиск Azure](search-performance-optimization.md).

Уровни, оптимизированные для хранилища, полезны для рабочих нагрузок с большими данными и поддерживают более общее Доступное хранилище индексов, когда требования к задержке запросов менее важны. Вы по-прежнему должны использовать дополнительные реплики для балансировки нагрузки и дополнительные секции для параллельной обработки. Затем можно настроить производительность после подготовки службы.

**Соглашения об уровне обслуживания**

Бесплатные функции уровня и предварительной версии не обеспечивают [соглашения об уровне обслуживания (SLA)](https://azure.microsoft.com/support/legal/sla/search/v1_0/). Для всех оплачиваемых уровней соглашения об уровне обслуживания вступают в силу, если для службы обеспечена достаточная избыточность. Для запроса соглашения об уровне обслуживания (Read) необходимо иметь две или более реплики. Необходимо иметь три или более реплики для запросов SLA и индексирования (для чтения и записи). Количество секций не влияет на соглашения об уровне обслуживания.

## <a name="tips-for-tier-evaluation"></a>Советы по оценке уровня

+ Разрешить метрикам создавать запросы и собирать данные по шаблонам использования (запросы в рабочее время, индексирование в часы наименьшей нагрузки). Используйте эти данные для информирования решений о подготовке службы. Хотя это непрактично для почасовой или ежедневной ритмичности, можно динамически корректировать секции и ресурсы, чтобы учесть запланированные изменения в томах запросов. Вы также можете обеспечить незапланированные, но устойчивые изменения, если уровни достаточно долго, чтобы гарантировать выполнение действий.

+ Помните, что единственным недостатком при подготовке является то, что вам может потребоваться разорвать службу, если фактические требования больше ваших прогнозов. Чтобы избежать прерывания работы служб, создайте новую службу на более высоком уровне и запустите ее параллельно, пока все приложения и запросы не будут нацелены на новую конечную точку.

## <a name="next-steps"></a>Дальнейшие шаги

Начните с уровня Free и создайте начальный индекс с помощью подмножества данных, чтобы понять его характеристики. Структура данных в Когнитивный поиск Azure — это обратная структура индекса. Размер и сложность инвертированного индекса определяются содержимым. Помните, что высокоизбыточное содержимое имеет тенденцию приводить к созданию индекса меньшего объема, чем более неоднородное содержимое. Поэтому характеристики содержимого, а не размер набора данных, определяют требования к хранению индекса.

После первоначальной оценки размера индекса [подготавливается к оплате](search-create-service-portal.md) на одном из уровней, описанных в этой статье: базовый, стандартный или оптимизированный для хранилища. Ослабляете любые искусственные ограничения на размер данных и [перестройте индекс](search-howto-reindex.md) , чтобы включить в него все данные, которые необходимо найти.

[Выделите секции и реплики](search-capacity-planning.md) по мере необходимости, чтобы получить требуемую производительность и масштабирование.

Если производительность и емкость являются достаточными, то все готово. В противном случае повторно создайте службу поиска на другом уровне, более точно соответствующем вашим потребностям.

> [!NOTE]
> Если у вас есть вопросы, опубликуйте [](https://stackoverflow.com/questions/tagged/azure-search) их по [адресу StackOverflow или обратитесь в службу поддержки Azure](https://azure.microsoft.com/support/options/).