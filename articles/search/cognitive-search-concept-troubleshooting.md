---
title: Советы по дизайну обогащения ИИ
titleSuffix: Azure Cognitive Search
description: Советы и устранение неполадок для настройки конвейеров обогащения ИИ в Azure Cognitive Search.
manager: nitinme
author: luiscabrer
ms.author: luisca
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 11/04/2019
ms.openlocfilehash: 3fef5db90c3ae63a8fa48835646e09f9dfe6f023
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79245490"
---
# <a name="tips-for-ai-enrichment-in-azure-cognitive-search"></a>Советы по обогащению ИИ в Azure Cognitive Search

Эта статья содержит список советов и приемов, чтобы держать вас двигаться, как вы начинаете с возможностями обогащения ИИ в Azure когнитивного поиска. 

Если вы еще не сделали этого, шаг через [учебник: Узнайте, как назвать AI обогащения ИИ](cognitive-search-quickstart-blob.md) для практики при применении обогащения ИИ к источнику данных blob.

## <a name="tip-1-start-with-a-small-dataset"></a>Совет 1. Начните с небольшого набора данных
Лучший способ быстро определять проблемы — ускорить процесс их исправления. Лучший способ ускорить индексирование — уменьшить число индексируемых документов. 

Начните с создания источника данных с небольшим числом документов или записей. Пример документа должен отображать особенности разных документов, которые будут индексироваться. 

Выполните для примера документа полный цикл операций и проверьте, соответствуют ли результаты вашим потребностям. Как только будут достигнуты нужные результаты, можно добавить в источник данных дополнительные файлы.

## <a name="tip-2-make-sure-your-data-source-credentials-are-correct"></a>Совет 2. Убедитесь в правильности учетных данных источника данных
Подключение к источнику данных не проверяется до определения индексатора, который его использует. При обнаружении ошибок, сообщающих о том, что индексатору не удается получить доступ к данным, убедитесь в следующем:
- Строка подключения должна быть указана правильно. Специально при создании токенов SAS убедитесь в том, что вы используете формат, ожидаемый Azure Cognitive Search. Сведения о разных поддерживаемых форматах см. в руководстве по [определению учетных данных](
https://docs.microsoft.com/azure/search/search-howto-indexing-azure-blob-storage#how-to-specify-credentials).
- Имя контейнера в индексаторе указано правильно.

## <a name="tip-3-see-what-works-even-if-there-are-some-failures"></a>Совет 3. Проверьте, какие компоненты работают даже при сбоях
Иногда небольшой сбоя препятствует работе индексатора. Это допустимо, если вы планируете устранять проблемы по очереди. Тем не менее определенные типы ошибок можно пропускать, чтобы индексатор продолжал работу, а вы могли увидеть, какие потоки выполняются.

В этом случае можно указать индексатору игнорировать ошибки. Для этого параметрам *maxFailedItems* и *maxFailedItemsPerBatch* задается значение -1 в определении индексатора.

```
{
  "// rest of your indexer definition
   "parameters":
   {
      "maxFailedItems":-1,
      "maxFailedItemsPerBatch":-1
   }
}
```
## <a name="tip-4-looking-at-enriched-documents-under-the-hood"></a>Совет 4. Что такое обогащенные документы 
Обогащенные документы — это временные структуры, которые создаются во время обогащения и удаляются после завершения обработки.

Чтобы сделать снимок обогащенного документа, созданного во время индексирования, добавьте в индекс поле ```enriched```. Индексатор автоматически помещает в поле строковое представление всех экземпляров обогащения этого документа.

Поле ```enriched``` будет содержать строку, которая является логическим представлением обогащенного документа в JSON, находящегося в памяти.  Значение поля является допустимым документом JSON. Кавычки экранируются, поэтому вам нужно изменить `\"` на `"`, чтобы просмотреть документ в формате JSON. 

Обогащенное поле используется для отладки, чтобы вы могли проанализировать логическую форму содержимого, используемого для обработки выражений. Не следует использовать это поле для индексирования.

Добавьте поле ```enriched``` в определение индекса для отладки:

#### <a name="request-body-syntax"></a>Синтаксис текста запроса
```json
{
  "fields": [
    // other fields go here.
    {
      "name": "enriched",
      "type": "Edm.String",
      "searchable": false,
      "sortable": false,
      "filterable": false,
      "facetable": false
    }
  ]
}
```

## <a name="tip-5-expected-content-fails-to-appear"></a>Совет 5. Проблемы с отображением ожидаемого содержимого

После удаления документов при индексировании содержимое будет отсутствовать. Для уровней "Бесплатный" и "Базовый" предусмотрены небольшие ограничения на размер документов. Любой файл, который превышает ограничение, удаляется при индексировании. Наличие удаленных документов можно проверить на портале Azure. На панели мониторинга службы поиска дважды щелкните плитку "Индексаторы". Просмотрите долю успешно проиндексированных документов. Если она не равна 100 %, можно щелкнуть отображаемое значение для получения дополнительных сведений. 

Если проблема связана с размером файла, вы можете увидеть \<ошибку, как это: \<"Капля файл-имя>" имеет размер файла размера> байтами, который превышает максимальный размер для извлечения документов для текущего уровня службы". Дополнительные сведения об ограничениях индексатора см. в разделе [Ограничения служб](search-limits-quotas-capacity.md).

Еще одна причина отказа при отображении содержимого может быть связана с ошибками сопоставления операций ввода-вывода. Например, целевое имя выходного параметра — "People", но имя поля индекса указано со строчной буквы: "people". Система может возвращать сообщения 201, указывающие на успешное выполнение всего конвейера, в результате чего вы решите, что индексирование прошло успешно. А на самом деле поле будет пустым. 

## <a name="tip-6-extend-processing-beyond-maximum-run-time-24-hour-window"></a>Совет 6. Выполнение обработки в течение времени, превышающего максимальное допустимое (24-часового окна)

Анализ изображений — это ресурсоемкая задача даже в простых сценариях. Поэтому время обработки очень больших или сложных изображений может превышать максимально допустимое. 

Максимальное время выполнения зависит от уровня: от нескольких минут на уровне "Бесплатный" до 24 часов индексирования на платных уровнях. Если процесс не удается завершить в течение 24 часов в случае обработки по требованию, придерживайтесь расписания, в рамках которого индексатор будет возобновлять обработку с того места, где она была остановлена. 

В таком случае индексатор будет по расписанию возобновлять обработку последнего известного приемлемого документа. При использовании повторяющегося расписания индексатор может выполнять работу над необработанными изображением в течение нескольких часов или дней, пока все они не будут обработаны. Для получения дополнительной информации о синтаксисе расписания см. [Шаг 3: Создайте-индексатор](search-howto-indexing-azure-blob-storage.md#step-3-create-an-indexer) или см. [Как запланировать индексы для Azure Cognitive Search.](search-howto-schedule-indexers.md)

> [!NOTE]
> Если индексатор настроен на определенное расписание, но неоднократно выходит из одного и того же документа снова и снова каждый раз, индексер начнет работать с меньшим частым интервалом (максимум один раз в 24 часа), пока он успешно не достигнет прогресса Снова.  Если вы считаете, что исправили все проблемы, которые привели к тому, что индексер застрял в определенной точке, вы можете выполнить по требованию запуск индекса, и если это успешно прогрессирует, индексер вернется к установленной интервалграфика снова.

При индексировании на основе портала (описанного в кратком руководстве) выбор режима однократного выполнения индексатора ограничивает обработку 1 часом (`"maxRunTime": "PT1H"`). Вам может потребоваться продлить обработку.

## <a name="tip-7-increase-indexing-throughput"></a>Совет 7. Увеличение пропускной способности индексирования

При [параллельном индексировании](search-howto-large-index.md) можно разместить данные в нескольких контейнерах или виртуальных папках в одном и том же контейнере. Затем можно создать несколько пар источника данных и индексатора. Все индексаторы могут использовать один и тот же набор навыков и выполнять запись в один и тот же целевой индекс поиска. Поэтому приложению поиска не нужно знать об этом секционировании.
Дополнительные сведения см. в руководстве по [индексированию больших наборов данных](search-howto-indexing-azure-blob-storage.md#indexing-large-datasets).

## <a name="see-also"></a>См. также
+ [Быстрый запуск: Создание конвейера по обогащению ИИ на портале](cognitive-search-quickstart-blob.md)
+ [Учебник: Узнайте обогащение AI REST APIs](cognitive-search-tutorial-blob.md)
+ [Specifying data source credentials](search-howto-indexing-azure-blob-storage.md#how-to-specify-credentials) (Указание учетных данных источника данных)
+ [Indexing Large Datasets](search-howto-indexing-azure-blob-storage.md#indexing-large-datasets) (Индексирование больших наборов данных)
+ [Определение набора навыков](cognitive-search-defining-skillset.md)
+ [How to map enriched fields to an index](cognitive-search-output-field-mapping.md) (Как сопоставить обогащенные поля с индексом)
