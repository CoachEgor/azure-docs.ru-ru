---
title: Алгоритм сходства рейтинга
titleSuffix: Azure Cognitive Search
description: Как установить алгоритм сходства, чтобы попробовать новый алгоритм сходства для ранжирования
manager: nitinme
author: luiscabrer
ms.author: luisca
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 03/13/2020
ms.openlocfilehash: c327440649300533c94c2a1956e3c45f433c9780
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79409977"
---
# <a name="ranking-algorithm-in-azure-cognitive-search"></a>Алгоритм ранжирования в когнитивном поиске Azure

> [!IMPORTANT]
> Начиная с 15 июля 2020 года, недавно созданные поисковые службы будут использовать функцию рейтинга BM25, которая в большинстве случаев доказала, что они лучше соответствуют ожиданиям пользователей, чем текущий рейтинг по умолчанию.  Помимо превосходного рейтинга, BM25 также позволяет параметры конфигурации для настройки результатов на основе таких факторов, как размер документа.  
>
> С этим изменением вы, скорее всего, увидите небольшие изменения в упорядочении результатов поиска.   Для тех, кто хочет проверить влияние этого изменения, мы сделали доступными в 2019-05-06-Preview API возможность включить BM25 забил на новые индексы.  

В этой статье описывается, как можно обновить сервис, созданный до 15 июля 2020 года, чтобы использовать новый алгоритм ранжирования BM25.

Azure Cognitive Search будет использовать официальную реализацию Lucene алгоритма Okapi BM25, *BM25Similarity*, который заменит ранее использовавшейся реализации *ClassicSimilarity.* Как и старый алгоритм ClassicSimilarity, BM25Similarity — это функция поиска, похожая на TF-IDF, которая использует частоту термина (TF) и обратную частоту документов (IDF) в качестве переменных для расчета оценок релевантности для каждой пары запросов документов, которая затем используется для ранжирования. Хотя концептуально похож на старый алгоритм классического сходства, BM25 берет свое корневой в вероятностной поиска информации, чтобы улучшить его. BM25 также предлагает расширенные варианты настройки, такие как позволяет пользователю решать, как весы оценки релевантности с термином частота соответствующих терминов.

## <a name="how-to-test-bm25-today"></a>Как протестировать BM25 сегодня

При создании нового индекса можно установить свойство "подобность". Вам нужно будет использовать *версию 2019-05-06-Preview,* как показано ниже.

```
PUT https://[search service name].search.windows.net/indexes/[index name]?api-version=2019-05-06-Preview
```

```json  
{
    "name": "indexName",
    "fields": [
        {
            "name": "id",
            "type": "Edm.String",
            "key": true
        },
        {
            "name": "name",
            "type": "Edm.String",
            "searchable": true,
            "analyzer": "en.lucene"
        },
        ...
    ],
    "similarity": {
        "@odata.type": "#Microsoft.Azure.Search.BM25Similarity"
    }
}
```

Для сервисов, созданных до 15 июля 2020 года: Если сходство опущено или сведено к нулю, индекс будет использовать старый классический алгоритм сходства.

Для сервисов, созданных после 15 июля 2020 года: Если сходство опущено или сведено к нулю, индекс будет использовать новый алгоритм сходства BM25.

Вы также можете четко установить значение сходства, чтобы быть одним из следующих двух значений: *"#Microsoft.Azure.Search.ClassicSimilarity"* или *"#Microsoft.Azure.Search.BM25Similarity".*


## <a name="bm25-similarity-parameters"></a>Параметры сходства BM25

Сходство BM25 добавляет два настраиваемых параметра пользователя для управления рассчитанной оценкой релевантности:

### <a name="k1"></a>k1

Параметр *k1* контролирует функцию масштабирования между частотой термина каждого сопоставления терминов к окончательному счету релевантности пары запросов документа.

Значение нуля представляет собой "двоичную модель", где вклад одного соответствующего термина одинаков для всех соответствующих документов, независимо от того, сколько раз этот термин появляется в тексте, в то время как большее значение k1 позволяет баллу продолжать увеличиваться по мере увеличения экземпляры того же термина содержатся в документе. По умолчанию Azure Cognitive Search использует значение 1,2 для параметра k1. Использование более высокого значения k1 может быть важным в тех случаях, когда мы ожидаем, что несколько терминов будут частью поискового запроса. В этих случаях мы можем отдавать предпочтение документам, которые соответствуют многим различным терминам запроса, которые ищутся по документам, которые совпадают только с одним, несколько раз. Например, при запросе индекса для документов, содержащих термины "Apollo Spaceflight", мы могли бы снизить оценку статьи о греческой мифологии, которая содержит термин "Аполлон" несколько десятков раз, без упоминания "Космический полет", по сравнению с другая статья, в которой прямо упоминается как "Аполлон" и "Космический полет" несколько раз только. 
 
### <a name="b"></a>b

Параметр *b* контролирует, как длина документа влияет на балл релевантности.

Значение 0,0 означает, что длина документа не повлияет на балл, в то время как значение 1.0 означает, что влияние частоты термина на оценку релевантности будет нормализовано по длине документа. Значение по умолчанию, используемое в Azure Cognitive Search для параметра b, составляет 0,75. Нормализация частоты термина по длине документа полезна в тех случаях, когда мы хотим наказывать более длинные документы. В некоторых случаях более длинные документы (например, полный роман) с большей вероятностью содержат много неактуальных терминов по сравнению с гораздо более короткими документами.

### <a name="setting-k1-and-b-parameters"></a>Установка параметров k1 и b

Чтобы настроить значения b или k1, просто добавьте их в качестве свойств к объекту сходства при использовании BM25:

```json
    "similarity": {
        "@odata.type": "#Microsoft.Azure.Search.BM25Similarity",
        "b" : 0.5,
        "k1" : 1.3
    }
```

Алгоритм сходства может быть установлен только во время создания индекса. Это означает, что используемый алгоритм сходства не может быть изменен для существующих индексов. Параметры *"b"* и *"k1"* могут быть изменены при обновлении существующего определения индекса, использующее BM25. Изменение этих значений на существующем индексе приведет к отключению индекса по крайней мере на несколько секунд, в результате чего запросы на индексацию и запросы запросов сбудутся. Из-за этого необходимо установить параметр "allowIndexDowntime-true" в строке запроса запроса на обновление:

```http
PUT https://[search service name].search.windows.net/indexes/[index name]?api-version=[api-version]&allowIndexDowntime=true
```


## <a name="see-also"></a>См. также  

 [Azure Когнитивный поиск REST](https://docs.microsoft.com/rest/api/searchservice/)   
 [Добавление профилей скоринга в свой индекс](index-add-scoring-profiles.md)    
 [Создание индекса &#40;Azure Cognitive Search REST API&#41;](https://docs.microsoft.com/rest/api/searchservice/create-index)   
  [Azure Когнитивный поиск .NET SDK](https://docs.microsoft.com/dotnet/api/overview/azure/search?view=azure-dotnet)  
