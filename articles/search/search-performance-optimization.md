---
title: Оптимизация развертывания и производительности
titleSuffix: Azure Cognitive Search
description: Узнайте о методах и рекомендациях по настройке производительности Azure Когнитивный поиск и настройке оптимального масштаба.
manager: nitinme
author: LiamCavanagh
ms.author: liamca
ms.devlang: rest-api
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 11/04/2019
ms.openlocfilehash: 4ff6779843546bd41423c140ef40de6a7e24b026
ms.sourcegitcommit: 598c5a280a002036b1a76aa6712f79d30110b98d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/15/2019
ms.locfileid: "74113247"
---
# <a name="deployment-strategies-and-best-practices-for-optimizing-performance-on-azure-cognitive-search"></a>Стратегии развертывания и рекомендации по оптимизации производительности Когнитивный поиск Azure

В этой статье описываются рекомендации по расширенным сценариям с помощью сложных требований к масштабируемости и доступности. 

## <a name="develop-baseline-numbers"></a>Разработка базовых номеров
При оптимизации производительности поиска следует сосредоточиться на сокращении времени выполнения запроса. Для этого необходимо знать, как выглядит Обычная нагрузка запроса. Приведенные ниже рекомендации могут помочь при получении номеров базовых запросов.

1. Выберите целевую задержку (или максимальное количество времени), которая типична для выполнения запроса на поиск.
2. Создайте и протестируйте реальную рабочую нагрузку на своей службе поиска, используя правдоподобный набор данных, чтобы измерить эти показатели задержки.
3. Начните с небольшого количества запросов в секунду (QPS) и постепенно увеличивайте число, выполняемое в тесте, пока задержка запроса не станет меньше заданной целевой задержки. Это важный тест производительности, который поможет спланировать масштабирование приложения по мере того, как оно будет охватывать все больше пользователей.
4. По возможности повторно используйте подключения HTTP. При использовании пакета SDK Azure Когнитивный поиск .NET это означает, что следует повторно использовать экземпляр или экземпляр [SearchIndexClient](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.searchindexclient) , а если используется REST API, следует повторно использовать один HttpClient.
5. Изменяйте вещество запросов запросов, чтобы поиск произносится по разным частям индекса. Вариант важен, поскольку если вы постоянно выполняете те же поисковые запросы, кэширование данных начнет повысить производительность, чем может быть более разнородным набором запросов.
6. Изменяйте структуру запросов запросов, чтобы получать различные типы запросов. Не все поисковые запросы выполняются на одном уровне. Например, Поиск документа или предложение поиска обычно выполняется быстрее, чем запрос с большим количеством аспектов и фильтров. Тестовая композиция должна включать различные запросы в примерно те же соотношения, что и в рабочей среде.  

При создании этих тестовых рабочих нагрузок необходимо помнить о некоторых характеристиках Когнитивный поиск Azure:

+ Вы можете перегрузить службу, помещая слишком много поисковых запросов за один раз. В этом случае вы увидите коды ответов HTTP 503. Чтобы избежать 503 во время тестирования, начните с различных диапазонов запросов поиска, чтобы увидеть разницу в скорости задержки по мере добавления дополнительных запросов поиска.

+ Azure Когнитивный поиск не выполняет задачи индексирования в фоновом режиме. Если служба обрабатывает рабочие нагрузки запросов и индексирования параллельно, примите это во внимание, поставляя задания индексирования в тесты запросов, или изучите варианты выполнения заданий индексации в часы пиковой нагрузки.

> [!NOTE]
> [Нагрузочное тестирование Visual Studio](https://www.visualstudio.com/docs/test/performance-testing/run-performance-tests-app-before-release) — это действительно хороший способ выполнения тестов производительности, так как он позволяет выполнять HTTP-запросы так, как это необходимо для выполнения запросов к когнитивный Поиск Azure и обеспечивает параллелизации запросов.
> 
> 

## <a name="scaling-for-high-query-volume-and-throttled-requests"></a>Масштабирование для большого объема запросов и регулируемых запросов
При получении слишком большого количества регулируемых запросов или превышении целевой частоты задержки при повышенной нагрузке запроса можно уменьшить частоту задержки одним из двух способов:

1. **Увеличение реплик:**  Реплика похожа на копию данных, позволяя Azure Когнитивный поиск балансировки нагрузки запросов к нескольким копиям.  Все балансировка нагрузки и репликация данных между репликами управляются с помощью Azure Когнитивный поиск и вы можете изменить количество реплик, выделенных для службы, в любое время.  Можно выделить до 12 реплик для службы поиска уровня "Стандартный" и до 3 реплик для службы поиска уровня "Базовый". Реплики можно изменить на [портале Azure](search-create-service-portal.md) или в [PowerShell](search-manage-powershell.md).
2. **Повышение уровня поиска:**  Когнитивный поиск Azure поставляется на [нескольких](https://azure.microsoft.com/pricing/details/search/) уровнях, и каждый из этих уровней обеспечивает различные уровни производительности.  В некоторых случаях у вас может быть столько запросов, что уровень, на котором вы настроили, не может обеспечить достаточно низкой частоты задержки, даже если реплики израсходован. В этом случае вам может потребоваться использовать один из более высоких уровней поиска, например Azure Когнитивный поиск S3, который хорошо подходит для сценариев с большим количеством документов и чрезвычайно высокой рабочей нагрузкой запросов.

## <a name="scaling-for-slow-individual-queries"></a>Масштабирование для отдельных запросов
Другая причина для высокой скорости задержки — выполнение одного запроса занимает слишком много времени. В этом случае добавление реплик не поможет. Ниже приведены два возможных параметра, которые могут оказаться полезными.

1. **Увеличьте число секций**. Секция представляет собой механизм разделения данных между дополнительными ресурсами. При добавлении второй секции данные разбиваются на две, третья секция разбивается на три и т. д. Один из положительных побочных эффектов заключается в том, что медленные запросы иногда выполняются быстрее из-за параллельных вычислений. Мы отметили параллелизм по запросам с низким уровнем избирательности, например запросам, которые соответствуют многим документам, или аспектам, предоставляющим подсчеты в большом количестве документов. Поскольку значительные вычисления необходимы для оценки релевантности документов или для подсчета количества документов, добавление дополнительных секций позволяет ускорить выполнение запросов.  
   
   Для службы поиска уровня "Стандартный" можно использовать до 12 секций, а для службы поиска уровня "Базовый" — только 1 секцию.  Секции можно изменить на [портале Azure](search-create-service-portal.md) или в [PowerShell](search-manage-powershell.md).

2. **Ограничить большие поля кратности:** Большое поле кратности состоит из поля с аспектом или фильтруемым полем, которое имеет значительное количество уникальных значений, и в результате потребляет значительные ресурсы при вычислении результатов. Например, задание идентификатора продукта или поля описания в качестве аспекта или фильтрации будет считаться большим количеством элементов, так как большинство значений из документа в документ являются уникальными. По возможности ограничивайте число полей с высокой кратностью.

3. **Повышение уровня поиска:**  Переход на более высокий уровень Когнитивный поиск Azure может быть другим способом повышения производительности медленных запросов. Каждый более высокий уровень обеспечивает более быстрые процессоры и больше памяти, что оказывает положительное воздействие на производительность запросов.

## <a name="scaling-for-availability"></a>Масштабирование для обеспечения доступности
Реплики не только уменьшают задержки при обработке запросов, но и могут обеспечить высокий уровень доступности. При использовании одной реплики следует ожидать периодических простоев из-за перезагрузки сервера после обновления программного обеспечения или других операций технического обслуживания.  Поэтому важно определить, требуется ли приложению высокий уровень доступности операций поиска (запросов) и записи (событий индексирования). Azure Когнитивный поиск предлагает варианты соглашения об уровне обслуживания для всех платных предложений поиска со следующими атрибутами:

* 2 реплики для обеспечения высокой доступности рабочих нагрузок для чтения (запросов).
* 3 или более реплики для обеспечения высокой доступности рабочих нагрузок чтения и записи (запросов и индексирования).

Дополнительные сведения см. в [Соглашение об уровне обслуживания когнитивный Поиск Azure](https://azure.microsoft.com/support/legal/sla/search/v1_0/).

Так как реплики являются копиями данных, наличие нескольких реплик позволяет Когнитивный поиск Azure выполнять перезагрузку и обслуживание компьютеров в одной реплике, одновременно позволяя продолжать выполнение запросов на других репликах. И наоборот, если вы принимаете реплики, вы получаете снижение производительности запросов, предполагая, что эти реплики были недостаточно загружены.

## <a name="scaling-for-geo-distributed-workloads-and-geo-redundancy"></a>Масштабирование для геораспределенных рабочих нагрузок и геоизбыточности
Для геораспределенных рабочих нагрузок пользователи, расположенные далеко от центра обработки данных, на котором размещается Когнитивный поиск Azure, будут иметь более высокую задержку. Одним из способов устранения этой проблемы является предоставление нескольких служб поиска в регионах с более близкой стороной к этим пользователям. Azure Когнитивный поиск в настоящее время не предоставляет автоматизированный способ георепликации индексов Azure Когнитивный поиск в регионах, но существуют некоторые методы, которые могут упростить процесс реализации этого процесса и управления им. Они описаны в нескольких следующих разделах.

Целью геораспределенного набора служб поиска является наличие двух или более индексов, доступных в двух или более регионах, где пользователь направляется в службу Когнитивный поиск Azure, которая обеспечивает наименьшую задержку, как показано в этом примере:

   ![Перекрестные запросы к службам по региону][1]

### <a name="keeping-data-in-sync-across-multiple-azure-cognitive-search-services"></a>Поддержание синхронизации данных в нескольких службах Когнитивный поиск Azure
Существует два варианта синхронизации распределенных служб поиска, которые состоят из использования [индексатора когнитивный Поиск Azure](search-indexer-overview.md) или API push-уведомлений (также называемого [когнитивный Поиск Azure REST API](https://docs.microsoft.com/rest/api/searchservice/)).  

### <a name="use-indexers-for-updating-content-on-multiple-services"></a>Использование индексаторов для обновления содержимого в нескольких службах

Если вы уже используете индексатор в одной службе, можно настроить второй индексатор во второй службе для использования одного и того же объекта источника данных, получая данные из одного и того же расположения. Каждая служба в каждом регионе имеет собственный индексатор и целевой индекс (индекс поиска не является общим, а это означает, что данные дублируются), но каждый индексатор ссылается на один и тот же источник данных.

Ниже приведен высокоуровневый визуальный элемент того, как будет выглядеть архитектура.

   ![Один источник данных с сочетаниями распределенного индексатора и службы][2]

### <a name="use-rest-apis-for-pushing-content-updates-on-multiple-services"></a>Использование интерфейсов API RESTFUL для отправки обновлений содержимого в несколько служб
Если вы используете REST API Когнитивный поиск Azure для [отправки содержимого в индекс когнитивный Поиск Azure](https://docs.microsoft.com/rest/api/searchservice/update-index), вы можете синхронизировать различные службы поиска, отправляя изменения во все службы поиска каждый раз, когда потребуется обновление. Убедитесь, что в коде выполняются ситуации, когда обновление одной службы поиска завершается сбоем, но для других служб поиска выполняется успешно.

## <a name="leverage-azure-traffic-manager"></a>Использование диспетчера трафика Azure
[Диспетчер трафика Azure](../traffic-manager/traffic-manager-overview.md) позволяет маршрутизировать запросы к нескольким географически размещенным веб-сайтам, которые затем поддерживаются несколькими службами поиска. Одно из преимуществ диспетчера трафика заключается в том, что он может проверить Когнитивный поиск Azure, чтобы убедиться, что он доступен, и направить пользователей в другие службы поиска в случае простоя. Кроме того, при маршрутизации запросов поиска через веб-сайты Azure диспетчер трафика Azure позволяет выполнять балансировку нагрузки, когда веб-сайт работает, но не Когнитивный поиск Azure. Ниже приведен пример архитектуры, использующей диспетчер трафика.

   ![Перекрестные запросы к службам по региону с использованием диспетчера трафика][3]

## <a name="next-steps"></a>Дополнительная информация
Дополнительные сведения о ценовых категориях и службах для каждого из них см. [в статье ограничения служб в Azure когнитивный Поиск](search-limits-quotas-capacity.md).

Статья [Планирование ресурсов](search-capacity-planning.md) поможет больше узнать о различных сочетаниях секций и реплик.

Чтобы более детально ознакомиться с производительностью и увидеть, как можно реализовать оптимизации, описанные в этой статье, посмотрите следующее видео.

> [!VIDEO https://channel9.msdn.com/Events/Microsoft-Azure/AzureCon-2015/ACON319/player]
> 
> 

<!--Image references-->
[1]: ./media/search-performance-optimization/geo-redundancy.png
[2]: ./media/search-performance-optimization/scale-indexers.png
[3]: ./media/search-performance-optimization/geo-search-traffic-mgr.png
