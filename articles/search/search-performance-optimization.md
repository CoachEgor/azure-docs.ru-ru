---
title: Рекомендации по развертыванию и рекомендации по оптимизации производительности — поиска Azure
description: Методики и рекомендации по настройке производительности Поиска Azure и выбору оптимального масштаба.
author: LiamCavanagh
manager: jlembicz
services: search
ms.service: search
ms.devlang: rest-api
ms.topic: conceptual
ms.date: 03/02/2019
ms.author: liamca
ms.custom: seodec2018
ms.openlocfilehash: 8a07657d04cee57cb69c9f5f7862fed3e7965716
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61283599"
---
# <a name="deployment-strategies-and-best-practices-for-optimizing-performance-on-azure-search"></a>Рекомендации по развертыванию и рекомендации по оптимизации производительности поиска Azure

В этой статье описываются рекомендации для более сложных сценариев с расширенными требованиями к масштабируемости и доступности. 

## <a name="develop-baseline-numbers"></a>Разработка исходных значений
При оптимизации производительности поиска, следует сосредоточиться на сокращение времени выполнения запроса. Чтобы сделать это, необходимо знать, как выглядит нагрузки типичный запрос. Следующие рекомендации помогут вам определиться с запрос исходных значений.

1. Выберите целевую задержку (или максимальное количество времени), которая типична для выполнения запроса на поиск.
2. Создайте и протестируйте реальную рабочую нагрузку на своей службе поиска, используя правдоподобный набор данных, чтобы измерить эти показатели задержки.
3. Начните с небольшое количество запросов в секунду (QPS) и постепенно увеличивать номер выполнения теста, пока задержка при обработке запросов не станет меньше определенное целевое. Это важный тест производительности, который поможет спланировать масштабирование приложения по мере того, как оно будет охватывать все больше пользователей.
4. По возможности повторно используйте подключения HTTP. Если используется пакет SDK для Поиска Azure для .NET, то это означает, что следует повторно использовать экземпляр или экземпляр [SearchIndexClient](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.searchindexclient) , а если используется REST API, то следует использовать один HttpClient.
5. Требовать вещества запросов, поэтому поиск осуществляется через различные части индекса. Вариант важно в тех случаях, так как если постоянно выполнять одинаковые запросы на поиск, кэширование данных начнет производительности, лучше, чем они могут с помощью более разрозненных запроса заданы.
6. Различаются структуры запросов, что позволяет получить различные типы запросов. Не все поисковые запросы выполняет на одном уровне. К примеру предложение поиска или поиска документа обычно выполняется быстрее, чем запрос со значительное количество аспектов и фильтров. Композиции тестирования должен включать различных запросов, в примерно же пропорции, как и следовало ожидать в рабочей среде.  

При создании этих тестовых рабочих нагрузок следует помнить о некоторых характеристиках Поиска Azure.

+ Можно перегрузить службу с помощью принудительной отправки слишком много запросов поиска за один раз. В этом случае вы увидите коды ответов HTTP 503. Чтобы избежать 503 во время тестирования, начните с разных диапазонов запросов поиска, чтобы увидеть разницей в задержке по мере добавления запросов на поиск.

+ Поиск Azure не выполняется в фоновом режиме задачи индексирования. Если служба обрабатывает запросов и индексирования рабочих нагрузок одновременно, это учитывайте путем задания индексирования в тесты запроса либо введения или открыв Параметры запуска задания индексирования во время пониженной нагрузки.

> [!NOTE]
> [Нагрузочное тестирование Visual Studio](https://www.visualstudio.com/docs/test/performance-testing/run-performance-tests-app-before-release) — очень удобный способ измерять производительность, так как оно позволяет выполнять HTTP-запросы точно так же, как выполняются запросы к Поиску Azure, и обеспечивает их параллельную обработку.
> 
> 

## <a name="scaling-for-high-query-volume-and-throttled-requests"></a>Масштабирование для большое число запросов и регулируемых запросов
Когда вы получили слишком много отрегулированных запросов или превышать задержек вашей целевой с за повышенной нагрузки запросов, может выглядеть уменьшить задержки одним из двух способов:

1. **Увеличьте число реплик**.  Реплика — это как копия ваших данных, позволяющая Поиску Azure балансировать нагрузку запросов, распределяя их между несколькими копиями.  Всеми операциями балансировки нагрузки и репликации данных между репликами управляет Поиск Azure, и в любое время можно изменить число реплик, выделенных для вашей службы.  Можно выделить до 12 реплик для службы поиска уровня "Стандартный" и до 3 реплик для службы поиска уровня "Базовый". Реплики можно изменить на [портале Azure](search-create-service-portal.md) или в [PowerShell](search-manage-powershell.md).
2. **Повысьте уровень поиска**.  Поиск Azure предоставляется на [нескольких уровнях](https://azure.microsoft.com/pricing/details/search/), и каждый из них предлагает разные уровни производительности.  В некоторых случаях число запросов может превысить возможности текущего уровня, приводя к недопустимо высоким задержкам даже при максимальном числе реплик. В этом случае можно воспользоваться одним из более высоких уровней поиска, например уровнем Azure S3, который хорошо подходит для сценариев с большим количеством документов и чрезвычайно высокими рабочими нагрузками запросов.

## <a name="scaling-for-slow-individual-queries"></a>Масштабирование для медленных отдельных запросов
Другая причина возникновения высокой задержки является слишком долгое выполнение одного запроса. В этом случае добавление реплик не поможет. Два параметры возможные параметры, которые могут помочь следующие:

1. **Увеличьте число секций**. Секция представляет собой механизм разделения данных между дополнительными ресурсами. Добавление второго раздела разбивает данные на две части, третья секция разделяет их на три и т. д. Один положительный побочный эффект — что медленнее запросов иногда выполняются быстрее из-за параллельных вычислений. Мы отметили параллелизации на запросы с низкой избирательностью, например запросы, которые соответствуют много документов или аспекты предоставления счетчиков в большое количество документов. Так как требуется значительное вычисления для оценки релевантности документов или для подсчета количества документов, добавление секций позволяет ускорить выполнение запросов.  
   
   Для службы поиска уровня "Стандартный" можно использовать до 12 секций, а для службы поиска уровня "Базовый" — только 1 секцию.  Секции можно изменить на [портале Azure](search-create-service-portal.md) или в [PowerShell](search-manage-powershell.md).

2. **Ограничьте число полей с высокой кратностью**. Поле большого количества элементов состоит из аспектируемый или фильтруемые поля, которое имеет значительное количество уникальных значений и таким образом, требуются значительные ресурсы, при вычислении результатов. Например установку идентификатор продукта или описание поля в качестве фильтруемое и аспектируемое будет считаться за большим количеством элементов так как большая часть значений из документа для документа являются уникальными. По возможности ограничивайте число полей с высокой кратностью.

3. **Повысьте уровень поиска**.  Переход на более высокий уровень Поиска Azure также может ускорить обработку медленно выполняемых запросов. Более высокий уровень обеспечивает более высокую ЦП и больший объем памяти, для которых оказать положительное влияние на производительность запросов.

## <a name="scaling-for-availability"></a>Масштабирование для обеспечения доступности
Реплики не только уменьшают задержки при обработке запросов, но и могут обеспечить высокий уровень доступности. При использовании одной реплики следует ожидать периодических простоев из-за перезагрузки сервера после обновления программного обеспечения или других операций технического обслуживания.  Поэтому важно определить, требуется ли приложению высокий уровень доступности операций поиска (запросов) и записи (событий индексирования). Поиск Azure предлагает различные варианты соглашения об уровне обслуживания для всех платных предложений поиска со следующими атрибутами:

* 2 реплики для обеспечения высокой доступности рабочих нагрузок для чтения (запросов).
* 3 или более реплики для обеспечения высокой доступности рабочих нагрузок чтения и записи (запросов и индексирования).

Дополнительные сведения об этом см. в [соглашении об уровне обслуживания для Поиска Azure](https://azure.microsoft.com/support/legal/sla/search/v1_0/).

Так как реплики копий данных, наличие нескольких реплик позволяет поиску Azure виртуальные машины или перезагрузки и обслуживание для одной реплики, обеспечивая выполнение запроса продолжить с другими репликами. И наоборот Если сейчас реплик, будет плата за снижения производительности обработки запросов, при условии, что эти реплики были мало ресурсов.

## <a name="scaling-for-geo-distributed-workloads-and-geo-redundancy"></a>Масштабирование геораспределенных рабочих нагрузок и геоизбыточности
Для рабочих нагрузок на географически распределенных пользователей, которые расположены далеко от центра обработки данных, размещение службы поиска Azure будет иметь более высокие скорости задержки. Один является подготовка несколько служб поиска в регионах с близких к этим пользователям. В настоящее время Поиск Azure не предоставляет автоматический метод георепликации индексов Поиска Azure между регионами, но доступны некоторые методы, с помощью которых легко реализовать этот процесс и управлять им. Они описаны в нескольких следующих разделах.

Цель геораспределенного набора служб поиска — иметь два или более индексов, доступных в двух или нескольких регионах, где пользователь направляется в службу поиска Azure, которая обеспечивает наименьшую задержку, как показано в этом примере:

   ![Перекрестные запросы к службам по региону][1]

### <a name="keeping-data-in-sync-across-multiple-azure-search-services"></a>Синхронизация данных между несколькими службами Поиска Azure
Существует два варианта обеспечить синхронизацию распределенных служб поиска: использовать [индексатор Поиска Azure](search-indexer-overview.md) или API Push (также называемый [REST API Поиска Azure](https://docs.microsoft.com/rest/api/searchservice/)).  

### <a name="use-indexers-for-updating-content-on-multiple-services"></a>Использовать индексаторы для обновления содержимого в нескольких службах

Если вы уже используете индексатора для одной службы, можно настроить второй индексатора на второй службе использовать тот же объект источника данных, извлечение данных из одного расположения. Каждая служба в каждом из них имеет свой собственный индексатора и целевым индексом (данных поиска не используется совместно, что означает, что данные дублируются), но каждый индексатор ссылается на тот же источник данных.

Ниже приведен общий визуальное изображение объекта как будет выглядеть этой архитектуры.

   ![Один источник данных с сочетаниями распределенного индексатора и службы][2]

### <a name="use-rest-apis-for-pushing-content-updates-on-multiple-services"></a>Использование интерфейсов REST API для отправки содержимого обновлений на нескольких служб
Если вы используете API REST службы поиска Azure для [Push-содержимое в индекс службы поиска Azure](https://docs.microsoft.com/rest/api/searchservice/update-index), вы можете синхронизировать различных служб поиска, отправляя изменения во все службы поиска всякий раз, когда обновление является обязательным. В коде убедитесь, что для обработки случаев, когда происходит сбой обновления одной службы поиска, но завершается сбоем для других служб поиска.

## <a name="leverage-azure-traffic-manager"></a>Использовать диспетчер трафика Azure
[Диспетчер трафика Azure](../traffic-manager/traffic-manager-overview.md) позволяет перенаправлять запросы на несколько расположенных в разных географических регионах веб-сайтов, которые поддерживаются несколькими службами Поиска Azure. Одним из преимуществ диспетчера трафика является то, что он может проверять доступность Поиска Azure и направлять пользователей к альтернативным службам поиска в случае сбоя. Кроме того, если маршрутизация запросов на поиск осуществляется через веб-сайты Azure, то диспетчер трафика Azure позволяет балансировать нагрузку в случаях, когда веб-сайт работает, а Поиск Azure — нет. Ниже приведен пример архитектуры, использующей диспетчер трафика.

   ![Перекрестные запросы к службам по региону с использованием диспетчера трафика][3]

## <a name="monitor-performance"></a>Мониторинг производительности
Поиск Azure предлагает возможность анализировать и отслеживать производительность службы с помощью [аналитика поискового трафика](search-traffic-analytics.md). Если включить эту функцию и добавить инструментирование в свое клиентское приложение, вы можно дополнительно вести журнал отдельных операций поиска, а также агрегированные метрики в учетную запись хранилища Azure, который затем можно обработать для анализа или визуализации в Power BI. Захват метрик таким образом предоставляют статистику производительности, например среднее количество запросов или время ответа на запрос. Кроме того, ведение журнала операций позволяет детализировать сведения об операциях поиска.

Аналитика трафика полезно для понимания задержек с этой точки зрения поиска Azure. Так как метрики производительности запросов, регистрируемые в журнале, основаны на времени полного выполнения запроса в Поиске Azure (с момента поступления запроса до его отправки обратно), вы можете использовать их, чтобы определить источник проблем, порождающих задержки. Это могут быть задержки из-за службы Поиска Azure или, например, задержки сети.  

## <a name="next-steps"></a>Дальнейшие действия
Чтобы больше узнать о ценовых категориях и лимитах служб, ознакомьтесь с разделом [Ограничения поиска Azure](search-limits-quotas-capacity.md).

Статья [Планирование ресурсов](search-capacity-planning.md) поможет больше узнать о различных сочетаниях секций и реплик.

Чтобы более детально ознакомиться с производительностью и увидеть, как можно реализовать оптимизации, описанные в этой статье, посмотрите следующее видео.

> [!VIDEO https://channel9.msdn.com/Events/Microsoft-Azure/AzureCon-2015/ACON319/player]
> 
> 

<!--Image references-->
[1]: ./media/search-performance-optimization/geo-redundancy.png
[2]: ./media/search-performance-optimization/scale-indexers.png
[3]: ./media/search-performance-optimization/geo-search-traffic-mgr.png
