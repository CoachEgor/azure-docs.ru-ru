---
title: Добавление запросов typeahead в индекс — Поиск Azure
description: Активируйте действия запроса опережающего типа в поиске Azure, создав средства подбора и составления запросы, которые вызывают Автозаполнение или автопредложенные термины запроса.
ms.date: 09/30/2019
services: search
ms.service: search
ms.topic: conceptual
author: Brjohnstmsft
ms.author: brjohnst
manager: nitinme
translation.priority.mt:
- de-de
- es-es
- fr-fr
- it-it
- ja-jp
- ko-kr
- pt-br
- ru-ru
- zh-cn
- zh-tw
ms.openlocfilehash: d3f934bea5df821e51a4747170af4f7efd1eaacc
ms.sourcegitcommit: 7c2dba9bd9ef700b1ea4799260f0ad7ee919ff3b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/02/2019
ms.locfileid: "71828300"
---
# <a name="add-suggesters-to-an-index-for-typeahead-in-azure-search"></a>Добавление предложений в индекс для typeahead в службе поиска Azure

В службе "Поиск Azure" функции "Поиск по мере использования" или typeahead основаны на конструкции **предложения** , добавляемой в [индекс поиска](search-what-is-an-index.md). Это список из одного или нескольких полей, для которых необходимо включить typeahead.

Предложение поддерживает два варианта typeahead: *Автозаполнение*, которое завершает вводимый термин или фразу, и *предложения* , которые возвращают краткий список соответствующих документов.  

На следующем снимке экрана из примера [создания первого приложения в C# ](tutorial-csharp-type-ahead-and-suggestions.md) примере демонстрируется typeahead. Автозаполнение предполагает, что пользователь может ввести в поле поиска. Фактические входные данные — "TW", которое завершается автозаполнением "in", в качестве условия для условия поиска добавляется "двойника". В раскрывающемся списке отображаются варианты визуализации. Для предложений можно использовать любую часть документа, которая лучше описывает результат. В этом примере предложения являются названиями гостиницы. 

![Визуальное сравнение автозаполнения и предлагаемых запросов](./media/index-add-suggesters/hotel-app-suggestions-autocomplete.png "Визуальное сравнение автозаполнения и предлагаемых запросов")

Чтобы реализовать эти поведения в службе поиска Azure, существует компонент индекса и запроса. 

+ В индексе добавьте предложение в индекс. Можно использовать портал, [REST API](https://docs.microsoft.com/rest/api/searchservice/create-index)или [пакет SDK для .NET](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.models.suggester?view=azure-dotnet). Оставшаяся часть этой статьи посвящена созданию средства подбора. 

+ В запросе запроса вызовите один из [интерфейсов API, перечисленных ниже](#how-to-use-a-suggester).

Поддержка поиска по мере ввода включена для каждого поля. Вы можете реализовать оба поведения typeahead в одном и том же решении поиска, если вы хотите использовать тот же интерфейс, что и на снимке экрана. Оба запроса нацелены на коллекцию *документов* определенного индекса, и ответы возвращаются после того, как пользователь предоставил по крайней мере три символьные входные строки.

## <a name="create-a-suggester"></a>Создание средства подбора

Хотя средство подбора имеет несколько свойств, оно, в первую очередь, представляет собой набор полей, для которых вы включаете typeahead интерфейс. Например, для приложения для путешествий необходимо включить упреждающий поиск по пунктам назначения, городам и достопримечательностям. Таким образом, все три поля будут находиться в коллекции Fields.

Чтобы создать предложение, добавьте его в схему индекса. В индексе можно использовать одно средство подбора (в частности, одно предложение в коллекции предложений). 

### <a name="when-to-create-a-suggester"></a>Когда следует создавать предложение

Лучшим моментом для создания средства подбора является то, что вы также создаете само определение поля.

Если вы попытаетесь создать средство подбора с помощью уже существующих полей, этот API будет запрещен. Текст Typeahead создается во время индексирования, когда частичные термины в двух или более комбинациях символов размечены вместе с целыми терминами. Учитывая, что существующие поля уже были размечены, потребуется перестроить индекс, чтобы добавить их в средство подбора. Дополнительные сведения о повторном индексировании см. [в разделе перестроение индекса службы поиска Azure](search-howto-reindex.md).

### <a name="create-using-the-rest-api"></a>Создание с помощью REST API

В REST API добавьте средства подбора путем [создания индекса](https://docs.microsoft.com/rest/api/searchservice/create-index) или [обновления индекса](https://docs.microsoft.com/rest/api/searchservice/update-index). 

  ```json
  {
    "name": "hotels",
    "fields": [
      . . .
    ],
    "suggesters": [
      {
        "name": "sg",
        "searchMode": "analyzingInfixMatching",
        "sourceFields": ["hotelName", "category"]
      }
    ],
    "scoringProfiles": [
      . . .
    ]
  }
  ```


### <a name="create-using-the-net-sdk"></a>Создание с помощью пакета SDK для .NET

В C#Определите [объект](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.models.suggester?view=azure-dotnet)средства подбора. `Suggesters` является коллекцией, но может принимать только один элемент. 

```csharp
private static void CreateHotelsIndex(SearchServiceClient serviceClient)
{
    var definition = new Index()
    {
        Name = "hotels",
        Fields = FieldBuilder.BuildForType<Hotel>(),
        Suggesters = new List<Suggester>() {new Suggester()
            {
                Name = "sg",
                SourceFields = new string[] { "HotelId", "Category" }
            }}
    };

    serviceClient.Indexes.Create(definition);

}
```

### <a name="property-reference"></a>Справочник по свойствам

|Свойство      |Описание      |
|--------------|-----------------|
|`name`        |Имя средства подбора.|
|`searchMode`  |Стратегия, используемая для поиска фраз кандидата. В настоящее время поддерживается только режим `analyzingInfixMatching`, в рамках которого выполняется гибкий поиск совпадений в начале и середине фраз.|
|`sourceFields`|Список из одного или нескольких полей, которые служат источником содержимого для предложений. Поля должны иметь тип `Edm.String` и `Collection(Edm.String)`. Если в поле указан анализатор, он должен быть именованным анализатором из [этого списка](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.models.analyzername?view=azure-dotnet) (а не настраиваемого анализатора).<p/>Рекомендуется указывать только те поля, которые приведут себя к ожидаемому и соответствующему ответу, будь то заполненная строка в строке поиска или раскрывающемся списке.<p/>Имя отеля является хорошим кандидатом, поскольку имеет точность. Поля с подробными сведениями, такие как описания и комментарии, слишком сжимаются. Аналогичным образом, повторяющиеся поля, такие как категории и теги, менее эффективны. В примерах мы все равно включаем «Category», чтобы показать, что можно включить несколько полей. |

### <a name="analyzer-restrictions-for-sourcefields-in-a-suggester"></a>Ограничения анализатора для Саурцефиелдс в предложении

Служба поиска Azure анализирует содержимое поля, чтобы обеспечить выполнение запросов по отдельным терминам. Средствам подбора требуются префиксы для индексирования в дополнение к полным условиям, что требует дополнительного анализа исходных полей. Пользовательские конфигурации анализатора могут сочетать любой из различных маркеров и фильтров, часто в случаях, когда создание префиксов, необходимых для предложений, будет невозможным. По этой причине Поиск Azure предотвращает включение полей с пользовательскими анализаторами в средство подбора.

> [!NOTE] 
>  Если необходимо обойти указанное выше ограничение, используйте два отдельных поля для одного и того же содержимого. Это позволит одному из полей иметь средство подбора, а другое можно настроить с помощью настраиваемой конфигурации анализатора.

<a name="how-to-use-a-suggester"></a>

## <a name="use-a-suggester-in-a-query"></a>Использование предложения в запросе

После создания предложения вызовите соответствующий API в логике запроса, чтобы вызвать эту функцию. 

+ [Предложения REST API](https://docs.microsoft.com/rest/api/searchservice/suggestions) 
+ [Автозаполнение REST API](https://docs.microsoft.com/rest/api/searchservice/autocomplete) 
+ [Метод Сугжествисхттпмессажесасинк](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.idocumentsoperations.suggestwithhttpmessagesasync?view=azure-dotnet)
+ [Метод Аутокомплетевисхттпмессажесасинк](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.idocumentsoperations.autocompletewithhttpmessagesasync?view=azure-dotnet&viewFallbackFrom=azure-dotnet)

Использование API показано в следующем вызове функции автозаполнения REST API. В этом примере есть две выводы. Во-первых, как и во всех запросах, операция выполняется для коллекции Documents индекса. Во вторых, можно добавить параметры запроса. Хотя многие параметры запроса являются общими для обоих интерфейсов API, список для каждого из них отличается.

```http
GET https://[service name].search.windows.net/indexes/[index name]/docs/autocomplete?[query parameters]  
api-key: [admin or query key]
```

Если в индексе не определен метод подбора, вызов функции автозаполнения или предложений завершится ошибкой.

## <a name="sample-code"></a>Пример кода

+ [Создание первого приложения в C# ](tutorial-csharp-type-ahead-and-suggestions.md) примере демонстрирует конструкцию средства подбора, предлагаемые запросы, автозаполнение и навигацию с аспектами. Этот пример кода выполняется в песочнице службы поиска Azure и использует предварительно загруженный индекс гостиниц, поэтому достаточно нажать клавишу F5, чтобы запустить приложение. Подписка или вход не требуется.

+ [Дотнесовтоаутокомплете](https://github.com/Azure-Samples/search-dotnet-getting-started/tree/master/DotNetHowToAutocomplete) — это более старый пример, C# содержащий код и Java. Здесь также демонстрируется конструкция средства подбора, предлагаемые запросы, автозаполнение и навигация с помощью аспектов. В этом примере кода используется размещенный образец данных [NYCJobs](https://github.com/Azure-Samples/search-dotnet-asp-net-mvc-jobs) . 


## <a name="next-steps"></a>Следующие шаги

Мы рекомендуем использовать следующий пример, чтобы увидеть, как формируются запросы.

> [!div class="nextstepaction"]
> [Примеры предложений и автозаполнения](search-autocomplete-tutorial.md) 
