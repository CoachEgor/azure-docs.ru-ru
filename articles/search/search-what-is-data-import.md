---
title: Импорт данных для их приема в индексе поиска — Поиск Azure
description: Заполнение и передача данных в индекс службы "Поиск Azure" с внешних источников данных.
author: HeidiSteen
manager: cgronlun
services: search
ms.service: search
ms.topic: conceptual
ms.date: 05/02/2019
ms.author: heidist
ms.custom: seodec2018
ms.openlocfilehash: 83ca0c11ab0065929d939b7345cbd15869740bb3
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "65024343"
---
# <a name="data-import-overview---azure-search"></a>Импорт данных, Обзор — службы поиска Azure

В службе "Поиск Azure" запросы выполняются и сохраняются на основе содержимого, загруженного в [индекс поиска](search-what-is-an-index.md). В этой статье рассматриваются два основных подхода к заполнению содержимого индекса: *отправка* данных в индекс программными средствами и указание в [индексаторе службы "Поиск Azure"](search-indexer-overview.md) поддерживаемого источника данных для *извлечения* данных.

В обоих подходах целью является *загрузки данных* из внешнего источника данных в индекс службы поиска Azure. Поиск Azure позволяет создать пустой индекс, но пока вы отправлять и извлекать данные в него, он не поддерживает запросы.

## <a name="pushing-data-to-an-index"></a>Отправка данных в индекс
Применение модели передачи данных, которая используется для отправки данных в службу "Поиск Azure" программными средствами, — это самый гибкий подход. Во-первых, в этой модели нет ограничений на тип источника данных. В индекс службы "Поиск Azure" можно отправить любой набор данных, состоящий из документов JSON, при условии, что каждый документ в наборе данных содержит поля, которые сопоставляются с полями, определенными в схеме индекса. Во-вторых, в этой модели нет ограничений на частоту выполнения. Вы можете отправлять изменения в индекс с любой частотой. Для приложений с очень высокими требованиями к задержке (например, если операции поиска должны синхронизироваться с динамической учетной базой данных) можно использовать только модель передачи.

Передача является более гибким подходом, чем извлечение, поскольку документы можно передавать по одному или пакетами (не более 1000 документов и не более 16 МБ в каждом пакете). Модель передачи позволяет отправлять документы в службу поиска Azure независимо от расположения данных.

### <a name="how-to-push-data-to-an-azure-search-index"></a>Как отправлять данные в индекс службы "Поиск Azure"

Для загрузки одного или нескольких документов в индекс можно использовать следующие API-интерфейсы:

+ [добавление, обновление и удаление документов (REST API)](https://docs.microsoft.com/rest/api/searchservice/AddUpdate-or-Delete-Documents);
+ [класс indexAction](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.models.indexaction?view=azure-dotnet) или [клаcс indexBatch](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.models.indexbatch?view=azure-dotnet). 

Инструментов для передачи данных через портал пока не существует.

Общие сведения о каждом методологии, см. в разделе [краткое руководство: Создание индекса службы поиска Azure с помощью PowerShell и REST API](search-create-index-rest-api.md) или [краткое руководство: Создание индекса службы поиска Azure в C# ](search-import-data-dotnet.md).

<a name="indexing-actions"></a>

### <a name="indexing-actions-upload-merge-mergeorupload-delete"></a>Индексирование действий: отправка, merge, mergeOrUpload, удаление

Можно управлять тип индексирования действия на основе каждого документа, указав, передаются ли документ в полную, объединенные с существующим содержимым документа или удаленные.

В REST API выдавать запросы HTTP POST с телами запрос JSON URL-адрес конечной точки индекса службы поиска Azure. Каждый объект JSON в массиве «value» содержит ключ документа и задает действие индексирования, добавление, обновление и, или удаляет содержимое документа. Пример кода см. в разделе [загрузки документов](search-create-index-rest-api.md#load-documents).

В пакете SDK .NET упаковать данные в `IndexBatch` объекта. `IndexBatch` Инкапсулирует коллекцию `IndexAction` объектов, каждый из которых содержит документ и свойство, определяющее, какое действие необходимо выполнить с этим документом службы поиска Azure. Пример кода см. в разделе [создания IndexBatch](search-import-data-dotnet.md#construct-indexbatch).


| @search.action | Описание | Необходимые поля для каждого документа | Примечания |
| -------------- | ----------- | ---------------------------------- | ----- |
| `upload` |Операция `upload` аналогична операции upsert, которая добавляет документ, если он новый, и обновляет либо заменяет его, если он уже существует. |Поле key, а также другие поля, которые вы хотите определить. |При обновлении или замене существующего документа все поля, не указанные в запросе, получат значение `null`. Это происходит, даже если для поля указано непустое значение. |
| `merge` |Обновляет существующий документ с использованием указанных полей. Если документ не существует в индексе, объединение завершится ошибкой. |Поле key, а также другие поля, которые вы хотите определить. |Поля, указанные в запросе на объединение, заменяют собой существующие поля документа. В пакет SDK для .NET, это включает в себя поля типа `DataType.Collection(DataType.String)`. В REST API, это включает в себя поля типа `Collection(Edm.String)`. Например, если документ содержит поле `tags` со значением `["budget"]` и вы выполняете операцию объединения со значением `["economy", "pool"]` для поля `tags`, в итоге поле `tags` примет значение `["economy", "pool"]`, а не `["budget", "economy", "pool"]`. |
| `mergeOrUpload` |Эта операция аналогична операции `merge`, если документ с указанным значением ключа уже существует в индексе. Если документа нет, эта операция выполняется так же, как и операция `upload` с новым документом. |Поле key, а также другие поля, которые вы хотите определить. |- |
| `delete` |Удаление указанного документа из индекса. |Только ключ |Все указанные поля, которые отличаются от ключевого поля, будут игнорироваться. Чтобы удалить из документа определенное поле, лучше воспользуйтесь операцией `merge`, явным образом задав для требуемого поля значение NULL. |

## <a name="decide-which-indexing-action-to-use"></a>Выбор операций индексирования
Импорт данных с помощью пакета SDK для .NET, (отправка, merge, delete и mergeOrUpload). В зависимости от выбранной операции для каждого документа будут включены только определенные поля.


### <a name="formulate-your-query"></a>Формулировка запроса
Существует два способа [поиска в индексе с помощью REST API](https://docs.microsoft.com/rest/api/searchservice/Search-Documents). Один из них — отправка HTTP-запроса POST с текстом, содержащим объект JSON, в котором определены параметры запроса. Другой способ — отправка HTTP-запроса GET, содержащего URL-адрес, в котором определены параметры запроса. Обратите внимание, что в запросе POST предусмотрены [менее жесткие ограничения](https://docs.microsoft.com/rest/api/searchservice/Search-Documents) на размер параметров запроса, чем в запросе GET. Поэтому мы рекомендуем использовать запрос POST, за исключением особых случаев, когда удобнее использовать запрос GET.

Как для POST, так и для GET в URL-адресе запроса необходимо указать *имя службы*, *имя индекса*, а также правильную *версию API* (текущая версия API на момент публикации этого документа — `2019-05-06`). Если вы используете запрос GET, его параметры указываются в *строке запроса* в конце URL-адреса. Ниже приведен формат URL-адреса.

    https://[service name].search.windows.net/indexes/[index name]/docs?[query string]&api-version=2019-05-06

Формат для POST такой же, но в параметрах в строке запроса указывается только версия API.


## <a name="pulling-data-into-an-index"></a>Извлечение данных в индекс
Модель извлечения выполняет поиск в поддерживаемом источнике данных, автоматически загружая данные в индекс. В службе "Поиск Azure" эта возможность реализуется с помощью *индексаторов*, которые сейчас доступны для следующих платформ:

+ [Хранилище BLOB-объектов](search-howto-indexing-azure-blob-storage.md)
+ [Хранилище таблиц](search-howto-indexing-azure-tables.md)
+ [Azure Cosmos DB](https://aka.ms/documentdb-search-indexer)
+ [База данных SQL Azure и SQL Server на виртуальных машинах Azure](search-howto-connecting-azure-sql-database-to-azure-search-using-indexers.md).

Индексаторы подключают индекс к источнику данных (как правило, это таблица, представление или эквивалентная структура) и сопоставляют поля источника с эквивалентными полями в индексе. Во время выполнения набор строк автоматически преобразуется в формат JSON и загружается в указанный индекс. Все индексаторы поддерживают планирование, так что вы можете указать частоту обновления данных. Большинство индексаторов позволяют отслеживать изменения, если источник данных поддерживает такую возможность. Отслеживая процессы изменения и удаления существующих документов, помимо распознания новых документов, индексаторы исключают необходимость в активном управлении данными в индексе. 


### <a name="how-to-pull-data-into-an-azure-search-index"></a>Как извлечь данные в индекс службы "Поиск Azure"

Индексатор доступен на [портале Azure](search-import-data-portal.md), в интерфейсе [REST API](/rest/api/searchservice/Indexer-operations) и в [пакете SDK для .NET](/dotnet/api/microsoft.azure.search.indexersoperationsextensions). 

Преимуществом использования портала является то, что служба поиска Azure, как правило, способна автоматически создавать стандартную схему индекса при чтении метаданных из исходного набора данных. Можно изменить создаваемый индекс до его обработки, после чего будут разрешены только те изменения схемы, которые не требуют повторного индексирования. Если вносимые изменения непосредственно влияют на схему, вам потребуется повторно создать индекс. 

## <a name="verify-data-import-with-search-explorer"></a>Проверка импорта данных с помощью проводника поиска

Чтобы быстро выполнить предварительную проверку загрузки документа, можно воспользоваться **проводником поиска** на портале. Проводник позволяет создавать запросы к индексу без необходимости писать код. Возможности поиска используют стандартные параметры, включая [простой синтаксис](/rest/api/searchservice/simple-query-syntax-in-azure-search) и стандартный [параметр запроса searchMode](/rest/api/searchservice/search-documents). Результаты возвращаются в формате JSON, позволяя проверить весь документ.

> [!TIP]
> Доступно множество [примеров кода для службы поиска Azure](https://github.com/Azure-Samples/?utf8=%E2%9C%93&query=search), которые включают внедренные или готовые наборы данных, позволяющие быстро начать работу. На портале также доступен пример индексатора и источника данных, представленного небольшим набором данных, связанных с недвижимостью (realestate-us-sample). При запуске предварительно настроенного индексатора с примером источника данных создается и загружается индекс с документами. Затем вы можете создать запрос к этому индексу, используя проводник поиска или программные средства.

## <a name="see-also"></a>См. также

+ [Обзор индексатора](search-indexer-overview.md)
+ [Руководство по созданию первого индекса службы поиска Azure на портале](search-get-started-portal.md)
