---
title: Импорт и использование данных в поисковых индексах
titleSuffix: Azure Cognitive Search
description: Заполнить и загрузить данные в индекс в Azure Cognitive Search из внешних источников данных.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 11/04/2019
ms.openlocfilehash: cc3f38e9bb96ce76263a3124f8bfdc49dc638bfd
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79282761"
---
# <a name="data-import-overview---azure-cognitive-search"></a>Обзор импорта данных - Azure Cognitive Search

В Azure Cognitive Search запросы выполняются по содержимому, загруженному и сохраненным в [поисковом индексе.](search-what-is-an-index.md) В этой статье рассматриваются два основных подхода к заполнению индекса: *затолкать* данные в индекс программно или указать [индексатору когнитивного поиска Azure](search-indexer-overview.md) на поддерживаемый источник данных, чтобы *вытянуть* данные.

При любом подходе цель состоит в том, чтобы *загрузить данные* из внешнего источника данных в индекс когнитивного поиска Azure. Azure Cognitive Search позволит создать пустой индекс, но пока вы не нажимаете или не втягиваете данные в него, это не задав.

## <a name="pushing-data-to-an-index"></a>Отправка данных в индекс
Наиболее гибким подходом является модель push, используемая для программного отсылки данных в Azure Cognitive Search. Во-первых, в этой модели нет ограничений на тип источника данных. Любой набор данных, состоящий из документов JSON, может быть перемещен в индекс когнитивного поиска Azure, если предположить, что каждый документ в наборе данных имеет отображение полей на поля, определенные в схеме индекса. Во-вторых, в этой модели нет ограничений на частоту выполнения. Вы можете отправлять изменения в индекс с любой частотой. Для приложений с очень высокими требованиями к задержке (например, если операции поиска должны синхронизироваться с динамической учетной базой данных) можно использовать только модель передачи.

Передача является более гибким подходом, чем извлечение, поскольку документы можно передавать по одному или пакетами (не более 1000 документов и не более 16 МБ в каждом пакете). Модель push также позволяет загружать документы в Azure Cognitive Search независимо от того, где находятся ваши данные.

### <a name="how-to-push-data-to-an-azure-cognitive-search-index"></a>Как перейти к индексу когнитивного поиска Azure

Для загрузки одного или нескольких документов в индекс можно использовать следующие API-интерфейсы:

+ [Добавление, обновление или удаление документов (REST API)](https://docs.microsoft.com/rest/api/searchservice/AddUpdate-or-Delete-Documents)
+ [класс indexAction](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.models.indexaction?view=azure-dotnet) или [клаcс indexBatch](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.models.indexbatch?view=azure-dotnet). 

Инструментов для передачи данных через портал пока не существует.

Для введения каждой методологии [см.](search-create-index-rest-api.md) [C# Quickstart: Create an Azure Cognitive Search index using .NET SDK](search-get-started-dotnet.md)

<a name="indexing-actions"></a>

### <a name="indexing-actions-upload-merge-mergeorupload-delete"></a>Действия индексирования: загрузить, слить, слитьOrUpload, удалить

Вы можете контролировать тип действия индексирования на основе в основе в основе в основе, указывая, следует ли загружать документ в полном объеме, объединены с существующим содержанием документа или удалены.

В REST API выдавайте запросы HTTP POST с помощью органов запросов JSON на URL-адрес вашего индекса когнитивного поиска. Каждый объект JSON в массиве "значение" содержит ключ документа и определяет, добавляет ли действие индексирования, обновляет или удаляет содержимое документа. Для примера кода [см.](search-get-started-dotnet.md#load-documents)

В .NET SDK упакуйте `IndexBatch` данные в объект. В `IndexBatch` ней содержится коллекция `IndexAction` объектов, каждая из которых содержит документ и свойство, которое сообщает Azure Cognitive Search, какие действия следует выполнять в этом документе. Для примера кода [C# Quickstart](search-get-started-dotnet.md)см.


| @search.action | Описание | Необходимые поля для каждого документа | Примечания |
| -------------- | ----------- | ---------------------------------- | ----- |
| `upload` |Операция `upload` аналогична операции upsert, которая добавляет документ, если он новый, и обновляет либо заменяет его, если он уже существует. |Поле key, а также другие поля, которые вы хотите определить. |При обновлении или замене существующего документа все поля, не указанные в запросе, получат значение `null`. Это происходит, даже если для поля указано непустое значение. |
| `merge` |Обновляет существующий документ с использованием указанных полей. Если документ не существует в индексе, объединение завершится ошибкой. |Поле key, а также другие поля, которые вы хотите определить. |Поля, указанные в запросе на объединение, заменяют собой существующие поля документа. В .NET SDK это включает `DataType.Collection(DataType.String)`поля типа. В REST API это включает `Collection(Edm.String)`поля типа. Например, если документ содержит поле `tags` со значением `["budget"]` и вы выполняете операцию объединения со значением `["economy", "pool"]` для поля `tags`, в итоге поле `tags` примет значение `["economy", "pool"]`, а не `["budget", "economy", "pool"]`. |
| `mergeOrUpload` |Эта операция аналогична операции `merge`, если документ с указанным значением ключа уже существует в индексе. Если документа нет, эта операция выполняется так же, как и операция `upload` с новым документом. |Поле key, а также другие поля, которые вы хотите определить. |- |
| `delete` |Удаление указанного документа из индекса. |Только ключ |Все указанные поля, которые отличаются от ключевого поля, будут игнорироваться. Чтобы удалить из документа определенное поле, лучше воспользуйтесь операцией `merge`, явным образом задав для требуемого поля значение NULL. |

## <a name="decide-which-indexing-action-to-use"></a>Выбор операций индексирования
Импортировать данные с помощью .NET SDK (загрузка, слияние, удаление и слияниеOrUpload). В зависимости от выбранной операции для каждого документа будут включены только определенные поля.


### <a name="formulate-your-query"></a>Формулировка запроса
Существует два способа [поиска в индексе с помощью REST API](https://docs.microsoft.com/rest/api/searchservice/Search-Documents). Один из них — отправка HTTP-запроса POST с текстом, содержащим объект JSON, в котором определены параметры запроса. Другой способ — отправка HTTP-запроса GET, содержащего URL-адрес, в котором определены параметры запроса. Обратите внимание, что в запросе POST предусмотрены [менее жесткие ограничения](https://docs.microsoft.com/rest/api/searchservice/Search-Documents) на размер параметров запроса, чем в запросе GET. Поэтому мы рекомендуем использовать запрос POST, за исключением особых случаев, когда удобнее использовать запрос GET.

Как для POST, так и для GET в URL-адресе запроса необходимо указать *имя службы*, *имя индекса*, а также правильную *версию API* (текущая версия API на момент публикации этого документа — `2019-05-06`). Если вы используете запрос GET, его параметры указываются в *строке запроса* в конце URL-адреса. Ниже приведен формат URL-адреса.

    https://[service name].search.windows.net/indexes/[index name]/docs?[query string]&api-version=2019-05-06

Формат для POST такой же, но в параметрах в строке запроса указывается только версия API.


## <a name="pulling-data-into-an-index"></a>Извлечение данных в индекс
Модель извлечения выполняет поиск в поддерживаемом источнике данных, автоматически загружая данные в индекс. В Azure Cognitive Search эта возможность реализуется через *индексы,* которые в настоящее время доступны для этих платформ:

+ [Хранилище BLOB-объектов](search-howto-indexing-azure-blob-storage.md)
+ [Хранение таблицы](search-howto-indexing-azure-tables.md)
+ [Azure Космос DB](https://aka.ms/documentdb-search-indexer)
+ [База данных Azure S'L и сервер S'L на VMs Azure](search-howto-connecting-azure-sql-database-to-azure-search-using-indexers.md)

Индексаторы подключают индекс к источнику данных (как правило, это таблица, представление или эквивалентная структура) и сопоставляют поля источника с эквивалентными полями в индексе. Во время выполнения набор строк автоматически преобразуется в формат JSON и загружается в указанный индекс. Все индексаторы поддерживают планирование, так что вы можете указать частоту обновления данных. Большинство индексаторов позволяют отслеживать изменения, если источник данных поддерживает такую возможность. Отслеживая процессы изменения и удаления существующих документов, помимо распознания новых документов, индексаторы исключают необходимость в активном управлении данными в индексе. 


### <a name="how-to-pull-data-into-an-azure-cognitive-search-index"></a>Как вытащить данные в индекс когнитивного поиска Azure

Индексатор доступен на [портале Azure](search-import-data-portal.md), в интерфейсе [REST API](/rest/api/searchservice/Indexer-operations) и в [пакете SDK для .NET](/dotnet/api/microsoft.azure.search.indexersoperationsextensions). 

Преимуществом использования портала является то, что Azure Cognitive Search обычно может генерировать для вас схему индекса по умолчанию, читая метаданные исходного набора данных. Можно изменить создаваемый индекс до его обработки, после чего будут разрешены только те изменения схемы, которые не требуют повторного индексирования. Если вносимые изменения непосредственно влияют на схему, вам потребуется повторно создать индекс. 

## <a name="verify-data-import-with-search-explorer"></a>Проверка импорта данных с помощью проводника поиска

Быстрый способ выполнить предварительную проверку загрузки документа — использовать **search Explorer** на портале. Проводник позволяет создавать запросы к индексу без необходимости писать код. Опыт поиска основан на настройках по умолчанию, таких как [простой параметр синтаксиса](/rest/api/searchservice/simple-query-syntax-in-azure-search) и [параметр поиска searchMode](/rest/api/searchservice/search-documents)по умолчанию. Результаты возвращаются в формате JSON, позволяя проверить весь документ.

> [!TIP]
> Многочисленные [образцы кода Azure Cognitive Search](https://github.com/Azure-Samples/?utf8=%E2%9C%93&query=search) включают встроенные или легкодоступные наборы данных, предлагая простой способ начать работу. На портале также доступен пример индексатора и источника данных, представленного небольшим набором данных, связанных с недвижимостью (realestate-us-sample). При запуске предварительно настроенного индексатора с примером источника данных создается и загружается индекс с документами. Затем вы можете создать запрос к этому индексу, используя проводник поиска или программные средства.

## <a name="see-also"></a>См. также

+ [Обзор индексатора](search-indexer-overview.md)
+ [Руководство по созданию первого индекса службы поиска Azure на портале](search-get-started-portal.md)
