---
title: Поиск нечетких соответствий
titleSuffix: Azure Cognitive Search
description: Реализация "вы имеете в виду" опыт поиска для автоматической коррекции неправильного термина или опечатки.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 04/08/2020
ms.openlocfilehash: 95f6befa7e97984ad64a3ffb2a9b91d343945cbb
ms.sourcegitcommit: 25490467e43cbc3139a0df60125687e2b1c73c09
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2020
ms.locfileid: "81000665"
---
# <a name="fuzzy-search-to-correct-misspellings-and-typos"></a>Нечеткий поиск для исправления опечаток и опечаток

Azure Cognitive Search поддерживает нечеткий поиск, тип запроса, который компенсирует опечатки и неправильно написанные термины в строке ввода. Он делает это путем сканирования терминов, имеющих аналогичную композицию. Расширение поиска для покрытия ближайших матчей имеет эффект автоматической коррекции опечатки, когда расхождение составляет всего несколько неуместных символов. 

## <a name="what-is-fuzzy-search"></a>Что такое нечеткий поиск?

Это расширение упражнения, которое производит матч на условиях, имеющих аналогичную композицию. При указании нечеткого поиска движок создает график (на основе [детерминированной теории конечного автомата)](https://en.wikipedia.org/wiki/Deterministic_finite_automaton)аналогично составленных терминов, для всех терминов в запросе. Например, если ваш запрос включает три термина "университет Вашингтона", для `search=university~ of~ washington~` каждого термина в запросе создается график (в нечетком поиске нет удаления стоп-слова, так что "из" получает график).

График состоит из до 50 расширений, или перестановок, каждого термина, захватывая как правильные, так и неправильные варианты в процессе. Затем двигатель возвращает наиболее актуальные матчи в ответе. 

Для термина как «университет», диаграмма могла иметь «unversty, universty, университет, вселенный, обратный». Любые документы, совпадающие с документами, сошедших на графике, включены в результаты. В отличие от других запросов, которые анализируют текст для обработки различных форм одного и того же слова ("мыши" и "мышь"), сравнения в нечетком запросе принимаются за чистую монету без какого-либо лингвистического анализа текста. "Вселенная" и "обратная", которые семантически отличаются, будут совпадать, потому что синтаксические расхождения малы.

Матч удается, если расхождения ограничены двумя или менее редактирования, где редактирование вставить, удалены, заменены или перенесены характер. Алгоритм коррекции строки, который определяет дифференциал, является метрикой [расстояния Damerau-Levenshtein,](https://en.wikipedia.org/wiki/Damerau%E2%80%93Levenshtein_distance) описанной как "минимальное количество операций (вставки, удаления, замены или транспозиции двух смежных символов), необходимых для изменения одного слова в другое". 

В Azure Когнитивный поиск:

+ Нечеткий запрос относится ко всем терминам, но вы можете поддерживать фразы через и конструкции. Например, "Unviersty" из "Wshington" будет соответствовать "Университет Вашингтона".

+ Расстояние досажа по умолчанию составляет 2. Значение не `~0` означает никакого расширения (только точный термин считается совпадением), но вы можете указать `~1` для одной степени разницы, или одно изменить. 

+ Нечеткий запрос может расширить срок до 50 дополнительных перестановок. Этот предел не настраивается, но вы можете эффективно уменьшить количество расширений, уменьшая расстояние от снасти до 1.

+ Ответы состоят из документов, содержащих соответствующий совпадение (до 50).

В совокупности графики представляются в качестве критериев соответствия токенам в индексе. Как вы можете себе представить, нечеткий поиск по своей сути медленнее, чем другие формы запроса. Размер и сложность индекса могут определить, достаточны ли преимущества для компенсации задержки ответа.

> [!NOTE]
> Поскольку нечеткий поиск, как правило, медленный, может быть целесообразным исследовать альтернативы, такие как n-грамм индексации, с его прогрессирование коротких последовательностей символов (два и три последовательности символов для биграм и триграмма токенов). В зависимости от вашего языка и поверхности запроса, n-gram может дать вам лучшую производительность. Компромисс заключается в том, что n-грамм индексации очень хранения интенсивным и генерирует гораздо больше индексов.
>
> Другой альтернативой, которую вы могли бы рассмотреть, если вы хотите обрабатывать только самые вопиющие случаи, будет [синонимом карты](search-synonyms.md). Например, отображение "поиск" на "серах, серк, сарч" или "извлечение" на "retreive".

## <a name="indexing-for-fuzzy-search"></a>Индексирование для нечеткого поиска

Анализаторы не используются при обработке запросов для создания графика расширения, но это не означает, что анализаторы должны быть проигнорированы в нечетких сценариях поиска. В конце концов, анализаторы используются во время индексации для создания токенов, против которых выполняется сопоставление, является ли запрос свободной формой, отфильтрованным поиском или нечетким поиском с графиком в качестве ввода. 

Как правило, при назначении анализаторов на основе поля решение о настройке цепочки анализа основывается на первичном случае использования (фильтр или полный поиск текста), а не на специализированных формах запроса, таких как нечеткий поиск. По этой причине не существует конкретной рекомендации анализатора для нечеткого поиска. 

Однако, если тестовые запросы не производят соответствия, которые вы ожидаете, вы можете попробовать изменять анализатор индексирования, установив его на [анализатор языка,](index-add-language-analyzers.md)чтобы увидеть, если вы получите лучшие результаты. Некоторые языки, особенно с гласными мутациями, могут извлечь выгоду из перегиба и нерегулярных форм слов, генерируемых процессорами естественного языка Майкрософт. В некоторых случаях использование правильного анализатора языка может изменить ситуацию к тому, является ли термин токенизирован таким образом, чтобы он был совместим со значением, предоставляемым пользователем.

## <a name="how-to-use-fuzzy-search"></a>Как использовать нечеткий поиск

Нечеткие запросы строятся с использованием полного синтаксиса запроса Lucene, ссылаясь на [парсер запроса Lucene.](https://lucene.apache.org/core/6_6_1/queryparser/org/apache/lucene/queryparser/classic/package-summary.html)

1. Установите полный parser Lucene`queryType=full`на запросе ().

1. Дополнительно, область запроса на конкретные поля, используя этот параметр (`searchFields=<field1,field2>`). 

1. Приложить tilde`~`() оператор в конце всего`search=<string>~`срока ().

   Включите дополнительный параметр, число между 0 и 2 (по`~1`умолчанию), если вы хотите указать расстояние отсвасывания (). Например, "blue~" или "blue~1" вернет результаты с "blue", "blues" и "glue".

В Azure Cognitive Search, помимо срока и расстояния (максимум 2), нет дополнительных параметров, установленных на запросе.

> [!NOTE]
> При обработке запросов нечеткие запросы не проходят [лексического анализа.](search-lucene-query-architecture.md#stage-2-lexical-analysis) Ввод запроса добавляется непосредственно к дереву запроса и расширяется для создания графика терминов. Единственное преобразование выполняется нижняя оболочка.

## <a name="how-to-test-fuzzy-search"></a>Как проверить нечеткий поиск

Для простого тестирования мы рекомендуем [search explorer](search-explorer.md) или [Postman](search-get-started-postman.md) для итерации выражения запроса. Оба инструмента являются интерактивными, что означает, что вы можете быстро пройти через несколько вариантов термина и оценить ответы, которые возвращаются.

Когда результаты неоднозначны, [подсветка удара](search-pagination-page-layout.md#hit-highlighting) может помочь вам определить совпадение в ответе. 

> [!Note]
> Использование хит-выделяя для идентификации нечетких совпадений имеет ограничения и работает только для базового нечеткого поиска. Если в индексе есть профили скоринга, или если вы наслоение запроса с дополнительным синтаксисом, выделение хита может не идентифицировать совпадение. 

### <a name="example-1-fuzzy-search-with-the-exact-term"></a>Пример 1: нечеткий поиск с точным термином

Предположим, что следующая `"Description"` строка существует в поле в поисковом документе:`"Test queries with special characters, plus strings for MSFT, SQL and Java."`

Начните с нечеткого поиска на "специальном" и добавьте выделение хита в поле описания:

    search=special~&highlight=Description

В ответе, поскольку вы добавили выделение хита, форматирование применяется к "специальному" в качестве соответствующего термина.

    "@search.highlights": {
        "Description": [
            "Test queries with <em>special</em> characters, plus strings for MSFT, SQL and Java."
        ]

Попробуйте еще раз запрос, опечатка "специальные", вынимая несколько букв ("pe"):

    search=scial~&highlight=Description

Пока никаких изменений в ответе. Использование по умолчанию 2 градусов расстояние, удаление двух символов "pe" от "специальных" по-прежнему позволяет для успешного матча на этот термин.

    "@search.highlights": {
        "Description": [
            "Test queries with <em>special</em> characters, plus strings for MSFT, SQL and Java."
        ]

Попытка еще один запрос, дальнейшее изменение поискового термина, вынимая один последний символ в общей сложности три удаления (от "специальных" до "масштабировать"):

    search=scal~&highlight=Description

Обратите внимание, что тот же ответ возвращается, но теперь вместо соответствия на "специальный", нечеткий матч находится на "S'L".

            "@search.score": 0.4232868,
            "@search.highlights": {
                "Description": [
                    "Mix of special characters, plus strings for MSFT, <em>SQL</em>, 2019, Linux, Java."
                ]

Смысл этого расширенного примера заключается в том, чтобы проиллюстрировать ясность, которую хит выделения может привести к неоднозначным результатам. Во всех случаях один и тот же документ возвращается. Если бы вы полагались на идол документов для проверки соответствия, вы могли бы пропустить переход от "специального" к "S'L".

## <a name="see-also"></a>См. также

+ [Как работает полный поиск текста в Azure Cognitive Search (архитектура разбора запросов)](search-lucene-query-architecture.md)
+ [Исследователь поиска](search-explorer.md)
+ [Выполнение запроса в .NET](search-query-dotnet.md)
+ [Выполнение запроса в REST](search-create-index-rest-api.md)
