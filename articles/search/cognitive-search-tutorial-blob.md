---
title: Руководство по использованию REST. Вызов Cognitive Services в конвейере обогащения ИИ в Поиске Azure
description: Ознакомьтесь с примером извлечения данных, обработки естественного языка и изображений с применением искусственного интеллекта в индексировании службы "Поиск Azure" для извлечения и преобразования данных больших двоичных объектов JSON с применением Postman и REST API.
manager: pablocas
author: luiscabrer
services: search
ms.service: search
ms.devlang: NA
ms.topic: tutorial
ms.date: 05/28/2019
ms.author: luisca
ms.subservice: cognitive-search
ms.openlocfilehash: d431f0ced5b417e178e064dca347ae8d78f14e5d
ms.sourcegitcommit: bc3a153d79b7e398581d3bcfadbb7403551aa536
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/06/2019
ms.locfileid: "68840874"
---
# <a name="rest-tutorial-call-cognitive-services-apis-in-an-azure-search-indexing-pipeline"></a>Руководство по использованию REST. Вызов API-интерфейсов Cognitive Services в конвейере индексирования службы "Поиск Azure"

В этом руководстве вы узнаете о механизме программирования обогащения данных в службе "Поиск Azure" с использованием *когнитивных методик*. Навыки подкрепляются возможностями обработки естественного языка (NLP) и анализа изображений в Cognitive Services. Настроив сочетание и конфигурацию набора навыков, можно извлечь текст и текстовые представления изображения или файл отсканированного документа. Кроме того, вы можете определить язык, сущности, ключевые фразы и многое другое. Конечным результатом является расширенное содержимое в индексе Поиска Azure, созданное конвейером индексирования с возможностями ИИ. 

В этом руководстве вы сделаете вызовы REST API, чтобы выполнить следующие задачи:

> [!div class="checklist"]
> * Создадите конвейер индексирования, который дополняет пример данных в маршруте к индексу.
> * Примените встроенные функции: распознавание объектов, распознавание языка, обработка текста и извлечение ключевых слов.
> * Объединять методики, сопоставляя входные данные с результатами в наборе навыков.
> * Выполнить запросы и просмотреть результаты.
> * Сбросить индекс и индексаторы для дальнейшей разработки.

Выходные данные — это полнотекстовый индекс с поддержкой поиска в службе "Поиск Azure". Вы можете улучшить индекс с помощью других стандартных возможностей, таких как [синонимы](search-synonyms.md), [профили оценки](https://docs.microsoft.com/rest/api/searchservice/add-scoring-profiles-to-a-search-index), [анализаторы](search-analyzers.md) и [фильтры](search-filters.md).

В рамках этого учебника используется бесплатная служба, но количество бесплатных транзакций ограничено 20 документами в день. Если вы хотите выполнять описанные здесь операции несколько раз в день, используйте меньший набор файлов.

> [!NOTE]
> По мере расширения области путем увеличения частоты обработки и добавления большего количества документов или дополнительных алгоритмов ИИ, вам нужно будет [присоединить оплачиваемый ресурс Cognitive Services](cognitive-search-attach-cognitive-services.md). Плата взимается при вызове API в Cognitive Services и извлечении изображений при открытии документов в службе "Поиск Azure". За извлечение текста из документов плата не взимается.
>
> Плата за выполнение встроенных навыков взимается в рамках существующей [модели оплаты Cognitive Services по мере использования](https://azure.microsoft.com/pricing/details/cognitive-services/). Плата за извлечение изображений указана на [странице с ценами на Поиск Azure](https://go.microsoft.com/fwlink/?linkid=2042400).

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="prerequisites"></a>Предварительные требования

В этом руководстве используются приведенные ниже службы, инструменты и данные. 

+ [Создайте учетную запись хранения Azure](https://docs.microsoft.com/azure/storage/common/storage-quickstart-create-account) для хранения примера данных. Создайте учетную запись хранения в том регионе, где находится служба "Поиск Azure".

+ [Классическое приложение Postman](https://www.getpostman.com/) используется для выполнения вызовов REST в службу "Поиск Azure".

+ [Пример данных](https://1drv.ms/f/s!As7Oy81M_gVPa-LCb5lC_3hbS-4), который состоит из небольшого набора файлов различных типов. 

+ [Создайте службу "Поиск Azure"](search-create-service-portal.md) или [найдите имеющуюся службу](https://ms.portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Search%2FsearchServices) в рамках текущей подписки. Вы можете использовать бесплатную службу для выполнения инструкций, описанных в этом учебнике.

## <a name="get-a-key-and-url"></a>Получение ключа и URL-адреса

Вызовам REST требуется URL-адрес службы и ключ доступа при каждом запросе. Служба поиска создана с обоими элементами, поэтому если вы добавили службу "Поиск Azure" в подписку, выполните следующие действия для получения необходимых сведений:

1. [Войдите на портал Azure](https://portal.azure.com/) и на странице **обзора** службы поиска получите URL-адрес. Пример конечной точки может выглядеть так: `https://mydemo.search.windows.net`.

1. В разделе **Параметры** > **Ключи** получите ключ администратора, чтобы обрести полные права на службу. Существуют два взаимозаменяемых ключа администратора, предназначенных для обеспечения непрерывности бизнес-процессов на случай, если вам потребуется сменить один из них. Вы можете использовать первичный или вторичный ключ для выполнения запросов на добавление, изменение и удаление объектов.

![Получение конечной точки HTTP и ключа доступа](media/search-get-started-postman/get-url-key.png "Получение конечной точки HTTP и ключа доступа")

Для выполнения любого запроса к службе требуется использование ключа API. Если есть действительный ключ, для каждого запроса устанавливаются отношения доверия между приложением, которое отправляет запрос, и службой, которая его обрабатывает.

## <a name="prepare-sample-data"></a>Подготовка примера данных

Конвейер обогащения извлекает данные из источников данных Azure. Исходные данные должны поступать из поддерживаемого типа источника данных [индексатора службы "Поиск Azure"](search-indexer-overview.md). Хранилище таблиц Azure не поддерживается для когнитивного поиска. В этом упражнении используется хранилище BLOB-объектов, чтобы продемонстрировать несколько типов содержимого.

1. [Войдите на портал Azure](https://portal.azure.com), перейдите к учетной записи хранения Azure, выберите **Большие двоичные объекты**, а затем щелкните **Контейнер**.

1. [Создайте контейнер больших двоичных объектов](https://docs.microsoft.com/azure/storage/blobs/storage-quickstart-blobs-portal) для хранения примера данных. Можно задать любое из допустимых значений уровня общего доступа.

1. После создания контейнера откройте его и выберите **Передать** на панели команд, чтобы передать примеры файлов, которые вы скачали на предыдущем шаге.

   ![Исходные файлы в хранилище BLOB-объектов Azure](./media/cognitive-search-quickstart-blob/sample-data.png)

1. После загрузки примеров файлов введите имя контейнера и строку подключения для хранилища BLOB-объектов. Это можно сделать, перейдя в учетную запись хранения на портале Azure. На вкладке **Ключи доступа** скопируйте поле **Строка подключения**.

   Строка подключения должна быть URL-адресом, аналогичным следующему примеру:

      ```http
      DefaultEndpointsProtocol=https;AccountName=cogsrchdemostorage;AccountKey=<your account key>;EndpointSuffix=core.windows.net
      ```

Существуют и другие способы указать строку подключения, например предоставить подписанный URL-адрес. Дополнительные сведения об учетных данных источника данных см. в статье [Индексирование документов в хранилище BLOB-объектов Azure с помощью службы поиска Azure](search-howto-indexing-azure-blob-storage.md#Credentials).

## <a name="set-up-postman"></a>Настройка Postman

Запустите Postman и настройте HTTP-запрос. Если вы не работали с этим инструментом, изучите статью [Работа с REST API службы "Поиск Azure" с помощью Postman или Fiddler](search-get-started-postman.md).

Методы запроса, используемые в этом руководстве: **POST**, **PUT** и **GET**. Заголовки ключей: для Content-type задано значение application/json, а для api-key задано значение ключа администратора службы "Поиск Azure". Тело — это расположение фактического содержимого вызова. 

  ![Частично структурированный поиск](media/search-semi-structured-data/postmanoverview.png)

Мы используем Postman для вызовов API к службе поиска для создания источника данных, набора навыков, индекса и индексатора. Источник данных содержит указатель к вашей учетной записи хранения и данным JSON. Служба поиска создает подключение при отправке данных.


## <a name="create-a-data-source"></a>Создание источника данных

Теперь, когда службы и исходные файлы подготовлены, начните сборку компонентов конвейера индексирования. Начните с [объекта источника данных](https://docs.microsoft.com/rest/api/searchservice/create-data-source), который указывает службе "Поиск Azure", как извлекать данные из внешнего источника.

В заголовке запроса укажите имя службы, которое вы использовали при создании службы "Поиск Azure", и ключ API, созданный для службы поиска. В тексте запроса укажите имя контейнера BLOB-объектов и строку подключения.

### <a name="sample-request"></a>Пример запроса
```http
POST https://[service name].search.windows.net/datasources?api-version=2019-05-06
Content-Type: application/json
api-key: [admin key]
```
#### <a name="request-body-syntax"></a>Синтаксис текста запроса
```json
{
  "name" : "demodata",
  "description" : "Demo files to demonstrate cognitive search capabilities.",
  "type" : "azureblob",
  "credentials" :
  { "connectionString" :
    "DefaultEndpointsProtocol=https;AccountName=<your account name>;AccountKey=<your account key>;"
  },
  "container" : { "name" : "<your blob container name>" }
}
```
Отправьте запрос. Средство веб-тестирования должно вернуть код состояния 201, подтверждающий успешное выполнение. 

Так как это ваш первый запрос, на портале Azure убедитесь, что источник данных был создан в службе "Поиск Azure". На странице панели мониторинга службы поиска проверьте наличие нового элемента в списке "Источники данных". Возможно, вам придется подождать несколько минут, пока обновится страница портала. 

  ![Плитка источников данных на портале](./media/cognitive-search-tutorial-blob/data-source-tile.png "Плитка источников данных на портале")

Если вы получили ошибку 403 или 404, проверьте структуру запроса: `api-version=2019-05-06` должен находиться в конечной точке, `api-key` должен находиться в заголовке после `Content-Type`, и его значение должно быть действительным для службы поиска. Вы можете повторно использовать заголовок для остальных шагов этого руководства.

## <a name="create-a-skillset"></a>Создание набора навыков

На этом этапе вы определяете набор шагов обогащения, которые хотите применить к данным. Каждый шаг обогащения называется *навыком*, а набор шагов обогащения — *набором навыков*. В этом руководстве для набора навыков используются [встроенные когнитивные навыки](cognitive-search-predefined-skills.md):

+ [Распознавание языка](cognitive-search-skill-language-detection.md) для определения языка содержимого.

+ [Разделение текста](cognitive-search-skill-textsplit.md) для разбиения большого объема содержимого на более мелкие фрагменты данных перед вызовом метода извлечения ключевой фразы. Этот метод принимает входные данные объемом 50 000 символов или меньше. Некоторые примеры файлов следует разделить, чтобы удовлетворить это ограничение.

+ [Распознавание сущностей](cognitive-search-skill-entity-recognition.md) для извлечения названий организаций из содержимого в контейнере больших двоичных объектов.

+ [Извлечение ключевых фраз](cognitive-search-skill-keyphrases.md) для получения основных ключевых фраз. 

### <a name="sample-request"></a>Пример запроса
Прежде чем выполнить этот вызов REST, не забудьте заменить имя службы и ключ администратора в запросе ниже, если ваше средство не сохраняет заголовок запроса между вызовами. 

Этот запрос создает набор навыков. Укажите имя набора навыков ```demoskillset```, который будет использоваться до конца этого руководства.

```http
PUT https://[servicename].search.windows.net/skillsets/demoskillset?api-version=2019-05-06
api-key: [admin key]
Content-Type: application/json
```
#### <a name="request-body-syntax"></a>Синтаксис текста запроса
```json
{
  "description":
  "Extract entities, detect language and extract key-phrases",
  "skills":
  [
    {
      "@odata.type": "#Microsoft.Skills.Text.EntityRecognitionSkill",
      "categories": [ "Organization" ],
      "defaultLanguageCode": "en",
      "inputs": [
        {
          "name": "text", "source": "/document/content"
        }
      ],
      "outputs": [
        {
          "name": "organizations", "targetName": "organizations"
        }
      ]
    },
    {
      "@odata.type": "#Microsoft.Skills.Text.LanguageDetectionSkill",
      "inputs": [
        {
          "name": "text", "source": "/document/content"
        }
      ],
      "outputs": [
        {
          "name": "languageCode",
          "targetName": "languageCode"
        }
      ]
    },
    {
      "@odata.type": "#Microsoft.Skills.Text.SplitSkill",
      "textSplitMode" : "pages",
      "maximumPageLength": 4000,
      "inputs": [
        {
          "name": "text",
          "source": "/document/content"
        },
        {
          "name": "languageCode",
          "source": "/document/languageCode"
        }
      ],
      "outputs": [
        {
          "name": "textItems",
          "targetName": "pages"
        }
      ]
    },
    {
      "@odata.type": "#Microsoft.Skills.Text.KeyPhraseExtractionSkill",
      "context": "/document/pages/*",
      "inputs": [
        {
          "name": "text", "source": "/document/pages/*"
        },
        {
          "name":"languageCode", "source": "/document/languageCode"
        }
      ],
      "outputs": [
        {
          "name": "keyPhrases",
          "targetName": "keyPhrases"
        }
      ]
    }
  ]
}
```

Отправьте запрос. Средство веб-тестирования должно вернуть код состояния 201, подтверждающий успешное выполнение. 

#### <a name="explore-the-request-body"></a>Просмотр текста запроса

Обратите внимание, что для каждой страницы применяется навык извлечения ключевых фраз. Если установить контекст ```"document/pages/*"```, средство обогащения будет выполнено для каждого элемента массива документов или страниц (для каждой страницы в документе).

Каждый навык выполняется в содержимом документа. Во время обработки служба "Поиск Azure" разбивает каждый документ для чтения содержимого из разных форматов файлов. Найденный текст в исходном файле помещается в созданное поле ```content```, по одному для каждого документа. Таким образом, установите входные данные как ```"/document/content"```.

Графическое представление набора навыков показано ниже. 

![Общие сведения о наборе навыков](media/cognitive-search-tutorial-blob/skillset.png "Общие сведения о наборе навыков")

Выходные данные могут быть сопоставлены с индексом, используемым в качестве входных данных для нисходящего навыка, или к обоим, как в случае с кодом языка. В индексе код языка полезен для фильтрации. В качестве входных данных код языка используется навыками анализа текста, чтобы указать лингвистические правила для разбивки слов.

Общие сведения о наборах навыков см. в статье [How to create a skillset in an enrichment pipeline](cognitive-search-defining-skillset.md) (Способ создания набора навыков в конвейере обогащения).

## <a name="create-an-index"></a>Создание индекса

В этом разделе вы определите схему индекса, указав поля для включения в индекс поиска, а также атрибуты поиска для каждого поля. Поля имеют тип и могут принимать атрибуты, определяющие их использование (поиск, сортировка и т. д.). Имена полей в индексе не обязательно должны точно соответствовать именам полей в источнике. На более позднем этапе вы добавите сопоставления полей в индексаторе для подключения полей "источник — назначение". Для этого шага определите индекс, используя соглашения об именовании полей, относящиеся к вашему поисковому приложению.

В этом упражнении используются следующие поля и типы полей:

| имена полей: | `id`       | Содержимое   | languageCode | keyPhrases         | organizations     |
|--------------|----------|-------|----------|--------------------|-------------------|
| типы полей: | Edm.String|Edm.String| Edm.String| List<Edm.String>  | List<Edm.String>  |


### <a name="sample-request"></a>Пример запроса
Прежде чем выполнить этот вызов REST, не забудьте заменить имя службы и ключ администратора в запросе ниже, если ваше средство не сохраняет заголовок запроса между вызовами. 

Этот запрос создает индекс. Используйте имя индекса ```demoindex```, которое будет использоваться до конца этого руководства.

```http
PUT https://[servicename].search.windows.net/indexes/demoindex?api-version=2019-05-06
api-key: [api-key]
Content-Type: application/json
```
#### <a name="request-body-syntax"></a>Синтаксис текста запроса

```json
{
  "fields": [
    {
      "name": "id",
      "type": "Edm.String",
      "key": true,
      "searchable": true,
      "filterable": false,
      "facetable": false,
      "sortable": true
    },
    {
      "name": "content",
      "type": "Edm.String",
      "sortable": false,
      "searchable": true,
      "filterable": false,
      "facetable": false
    },
    {
      "name": "languageCode",
      "type": "Edm.String",
      "searchable": true,
      "filterable": false,
      "facetable": false
    },
    {
      "name": "keyPhrases",
      "type": "Collection(Edm.String)",
      "searchable": true,
      "filterable": false,
      "facetable": false
    },
    {
      "name": "organizations",
      "type": "Collection(Edm.String)",
      "searchable": true,
      "sortable": false,
      "filterable": false,
      "facetable": false
    }
  ]
}
```
Отправьте запрос. Средство веб-тестирования должно вернуть код состояния 201, подтверждающий успешное выполнение. 

Дополнительные сведения об определении индекса см. в статье [Create Index (Azure Search Service REST API)](https://docs.microsoft.com/rest/api/searchservice/create-index) (Создание индексов (REST API службы поиска Azure)).


## <a name="create-an-indexer-map-fields-and-execute-transformations"></a>Создание индексатора, сопоставление полей и выполнение преобразования

Пока вы создали источник данных, набор навыков и индекс. Эти три компонента становятся частью [индексатора](search-indexer-overview.md), который объединяет каждую часть в единую многофазную операцию. Чтобы связать их вместе в индексаторе, необходимо определить сопоставления полей. 

+ Обработка FieldMappings выполняется перед набором навыков. Исходные поля из источника данных сопоставляются с целевыми полями в индексе. Если имена и типы полей одинаковы в исходном и целевом расположениях, сопоставление не требуется.

+ Обработка OutputFieldMappings выполняется после набора навыков. Добавляются ссылки на элементы sourceFieldNames, которые не существуют, пока они не будут созданы при анализе или обогащении документов. TargetFieldName — это поле в индексе.

Помимо привязки входных данных к выходным данным, можно также использовать сопоставления полей для преобразования структур данных в плоские структуры. Для получения дополнительных сведений см. раздел [Сопоставление обогащенных полей с индексом, поддерживающим поиск](cognitive-search-output-field-mapping.md).

### <a name="sample-request"></a>Пример запроса

Прежде чем выполнить этот вызов REST, не забудьте заменить имя службы и ключ администратора в запросе ниже, если ваше средство не сохраняет заголовок запроса между вызовами. 

Также укажите имя вашего индексатора. Укажите имя ```demoindexer```, которое будет использоваться до конца этого руководства.

```http
PUT https://[servicename].search.windows.net/indexers/demoindexer?api-version=2019-05-06
api-key: [api-key]
Content-Type: application/json
```
#### <a name="request-body-syntax"></a>Синтаксис текста запроса

```json
{
  "name":"demoindexer", 
  "dataSourceName" : "demodata",
  "targetIndexName" : "demoindex",
  "skillsetName" : "demoskillset",
  "fieldMappings" : [
    {
      "sourceFieldName" : "metadata_storage_path",
      "targetFieldName" : "id",
      "mappingFunction" :
        { "name" : "base64Encode" }
    },
    {
      "sourceFieldName" : "content",
      "targetFieldName" : "content"
    }
  ],
  "outputFieldMappings" :
  [
    {
      "sourceFieldName" : "/document/organizations",
      "targetFieldName" : "organizations"
    },
    {
      "sourceFieldName" : "/document/pages/*/keyPhrases/*",
      "targetFieldName" : "keyPhrases"
    },
    {
      "sourceFieldName": "/document/languageCode",
      "targetFieldName": "languageCode"
    }
  ],
  "parameters":
  {
    "maxFailedItems":-1,
    "maxFailedItemsPerBatch":-1,
    "configuration":
    {
      "dataToExtract": "contentAndMetadata",
      "imageAction": "generateNormalizedImages"
    }
  }
}
```

Отправьте запрос. Средство веб-тестирования должно вернуть код состояния 201, подтверждающий успешную обработку. 

Выполнение этого действия может занять несколько минут. Несмотря на то что набор данных невелик, аналитические навыки выполняют интенсивные вычисления. Некоторые навыки, такие как анализ изображений, долго выполняются.

> [!TIP]
> Создание индексатора вызывает конвейер. Если есть проблемы с получением данных, сопоставлением входных и выходных данных или порядком операций, они появятся на этом этапе. Чтобы повторно запустить конвейер с изменениями кода или скрипта, вам может потребоваться сначала удалить объекты. Дополнительные сведения см. в статье [Руководство по вызову API-интерфейсов когнитивного поиска (предварительная версия)](#reset).

#### <a name="explore-the-request-body"></a>Просмотр текста запроса

Скрипт устанавливает значение -1 для ```"maxFailedItems"```, которое инструктирует механизм индексирования игнорировать ошибки во время импорта данных. Это полезно, потому что в демонстрационном источнике данных мало документов. Для большего источника данных необходимо установить значение больше 0.

Также обратите внимание на оператор ```"dataToExtract":"contentAndMetadata"``` в параметрах конфигурации. Этот оператор указывает индексатору автоматически извлекать содержимое из разных форматов файлов, а также метаданные, относящиеся к каждому файлу. 

Когда содержимое будет извлечено, вы можете установить ```imageAction``` для извлечения текста из изображений, найденных в источнике данных. Конфигурация ```"imageAction":"generateNormalizedImages"``` вместе с навыком распознавания текста и навыком объединения текста инструктирует индексатор извлекать текст из изображений (например слово "стоп" из знака остановки движения) и вставлять его как часть поля содержимого. Это относится как к изображениям, встроенным в документы (например, изображение внутри PDF-файлов), так и к изображениям, найденным в источнике данных, например к файлу JPG.

## <a name="check-indexer-status"></a>Проверка состояния индексатора

После того как индексатор будет определен, он будет выполняться автоматически при отправке запроса. В зависимости от того, какие когнитивные навыки вы определили, индексирование может занять больше времени, чем вы ожидаете. Чтобы узнать, работает ли индексатор, отправьте следующий запрос для получения сведений о состоянии.

```http
GET https://[servicename].search.windows.net/indexers/demoindexer/status?api-version=2019-05-06
api-key: [api-key]
Content-Type: application/json
```

В ответе вернутся сведения о том, что индексатор работает. После завершения индексирования используйте другой HTTP-метод GET для конечной точки STATUS (как указано выше), чтобы просмотреть отчеты об ошибках и предупреждениях, которые произошли во время обогащения.  

Предупреждения часто возникают с некоторыми исходными файлами и комбинациями навыков и не всегда указывают на проблему. В этом руководстве предупреждения являются неопасными (например, нет текстовых входных данных из файлов JPEG). Вы можете просмотреть ответ о состоянии, чтобы получить подробную информацию о предупреждениях, выдаваемых при индексировании.
 
## <a name="query-your-index"></a>Отправка запроса в индекс

После завершения индексации выполните запросы, возвращающие содержимое отдельных полей. По умолчанию служба "Поиск Azure" возвращает 50 лучших результатов. Примеры данных малы, поэтому параметр по умолчанию работает нормально. Однако при работе с большими наборами данных вам может потребоваться включить параметры в строку запроса, чтобы вернуть больше результатов. Инструкции см. в статье [Разбивка результатов поиска на страницы в службе поиска Azure](search-pagination-page-layout.md).

Для проверки запросите индекс для всех полей.

```http
GET https://[servicename].search.windows.net/indexes/demoindex?api-version=2019-05-06
api-key: [api-key]
Content-Type: application/json
```

В результате будет возвращена схема индекса с именем и типом, а также атрибуты каждого поля.

Отправьте второй запрос с `"*"`, чтобы вернуть все содержимое одного поля, например `organizations`.

```http
GET https://[servicename].search.windows.net/indexes/demoindex/docs?search=*&$select=organizations&api-version=2019-05-06
api-key: [api-key]
Content-Type: application/json
```

Повторите запрос для дополнительных полей: content, languageCode, keyPhrases и organizations в этом упражнении. Вы можете возвратить несколько полей с помощью `$select`, используя разделенный запятыми список.

Можно использовать методы GET или POST, в зависимости от сложности и длины строки запроса. Дополнительные сведения см. в статье [Отправка запросов в индекс службы поиска Azure с помощью REST API](https://docs.microsoft.com/rest/api/searchservice/search-documents).



<a name="reset"></a>

## <a name="reset-and-rerun"></a>Сброс и повторный запуск

На ранних экспериментальных этапах разработки конвейера наиболее практичным подходом к итерации проектирования является удаление объектов из службы "Поиск Azure" и их восстановление. Имена ресурсов являются уникальными. Удаление объекта позволяет воссоздать его с использованием того же имени.

Чтобы повторно проиндексировать документы с использованием новых определений:

1. Удалите индекс, чтобы удалить сохраненные данные. Удалите индексатор для его восстановления в службе.
2. Измените определение набора навыков и индекса.
3. Заново создайте индекс и индексатор в службе для запуска конвейера. 

Для удаления индексов, индексаторов и наборов навыков можно использовать портал.

```http
DELETE https://[servicename].search.windows.net/skillsets/demoskillset?api-version=2019-05-06
api-key: [api-key]
Content-Type: application/json
```

При успешном удалении возвращается код состояния 204.

По мере оптимизации кода вам может потребоваться уточнить стратегию восстановления. Дополнительные сведения см. в статье [How to rebuild an Azure Search index](search-howto-reindex.md) (Как восстановить индекс для службы "Поиск Azure").

## <a name="takeaways"></a>Общие выводы

В этом руководстве показаны основные шаги для построения обогащенного конвейера индексирования посредством создания компонентов: источника данных, набора навыков, индекса и индексатора.

Вы получили сведения о [предопределенных навыках](cognitive-search-predefined-skills.md), а также определении набора навыков и механизме построения цепочек навыков путем сопоставления входных и выходных данных. Вы также узнали, что `outputFieldMappings` в определении индексатора требуется для маршрутизации обогащенных значений из конвейера в индекс для поиска в службе "Поиск Azure".

Наконец, вы узнали, как тестировать результаты и выполнять сброс системы для дальнейших итераций. Вы узнали, что отправка запросов к индексу возвращает результат, созданный обогащенным конвейером индексирования. В этом выпуске существует механизм просмотра внутренних конструкций (обогащенные документы, созданные системой). Вы также узнали, как проверить состояние индексатора, и какие объекты нужно удалить перед повторным запуском конвейера.

## <a name="clean-up-resources"></a>Очистка ресурсов

Самый быстрый способ очистки после завершения работы с руководством — удалить группу ресурсов, содержащую службу "Поиск Azure" и службу BLOB-объектов Azure. Предположим, обе службы находятся в одной группе, в этом случае удалите группу ресурсов, чтобы окончательно удалить все ее содержимое, включая службы и любое хранимое содержимое, созданное для этого руководства. На портале имя группы ресурсов находится на странице "Обзор" каждой службы.

## <a name="next-steps"></a>Дополнительная информация

Настройте или расширьте конвейер, добавив пользовательские навыки. Создание пользовательского навыка и добавление его в набор навыков позволяет вам внедрять анализ текста или изображения, который вы пишете сами. 

> [!div class="nextstepaction"]
> [Пример. Создание пользовательского навыка для Когнитивного поиска](cognitive-search-create-custom-skill-example.md)
