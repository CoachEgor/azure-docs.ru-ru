---
title: Концепции навыков и рабочий процесс
titleSuffix: Azure Cognitive Search
description: Skillsets — это место, где вы авторите конвейер обогащения ИИ в Azure Cognitive Search. Узнайте важные концепции и детали о композиции skillset.
manager: nitinme
author: vkurpad
ms.author: vikurpad
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 11/04/2019
ms.openlocfilehash: 8b45840215092281c7fbc8d499e26b095b374dd6
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "77191023"
---
# <a name="skillset-concepts-and-composition-in-azure-cognitive-search"></a>Концепции и композиции Skillset в Azure Cognitive Search

Эта статья предназначена для разработчиков, которым необходимо более глубокое понимание того, как работает конвейер обогащения, и предполагает, что у вас есть концептуальное понимание процесса обогащения ИИ. Если вы новичок в этой концепции, начните с:
+ [Обогащение ИИ в когнитивном поиске Azure](cognitive-search-concept-intro.md)
+ [Что собой представляет хранилище знаний в службе "Поиск Azure"](knowledge-store-concept-intro.md)

## <a name="specify-the-skillset"></a>Указать Skillset
Набор навыков — это многоразовый ресурс в Azure Cognitive Search, который определяет набор когнитивных навыков, используемых для анализа, преобразования и обогащения содержимого текста или изображения во время индексации. Создание набора навыков позволяет прикреплять обогащение текста и изображений на этапе приема данных, извлекая и создавая новую информацию и структуры из сырья.

Набор навыков имеет три свойства:

+   ```skills```, неупорядоченная коллекция навыков, для которых платформа определяет последовательность выполнения на основе входных данных, необходимых для каждого навыка
+   ```cognitiveServices```, когнитивные услуги ключ, необходимый для выставления счетов когнитивных навыков, вызванных
+   ```knowledgeStore```, учетная запись хранения, где будут проецироваться ваши обогащенные документы



Skillsets автор в JSON. Вы можете создавать сложные навыки с циклированием и [ветвлением](https://docs.microsoft.com/azure/search/cognitive-search-skill-conditional) с помощью [языка выражения.](https://docs.microsoft.com/azure/search/cognitive-search-skill-conditional) Язык выражения использует нотацию пути [JSON Pointer](https://tools.ietf.org/html/rfc6901) с несколькими изменениями для определения узлов в дереве обогащения. Прохождение ```"/"``` уровня ниже в дереве и ```"*"``` выступает в качестве для каждого оператора в контексте. Эти понятия лучше всего описывать на примере. Чтобы проиллюстрировать некоторые концепции и возможности, мы пройдемся по [набору навыков, которые](knowledge-store-connect-powerbi.md) можно провести обзоры отелей. Для просмотра набора навыков после того, как вы следили за рабочим процессом импорта, необходимо использовать клиент REST API для [получения набора навыков.](https://docs.microsoft.com/rest/api/searchservice/get-skillset)

### <a name="enrichment-tree"></a>Дерево обогащения

Чтобы представить себе, как набор навыков постепенно обогащает ваш документ, давайте начнем с того, как документ выглядит до любого обогащения. Выход взлома документа зависит от источника данных и выбранного конкретного способа разбора. Это также состояние документа, из которого [картографы поля](search-indexer-field-mappings.md) могут исходить содержимое при добавлении данных в индекс поиска.
![Хранилище знаний на схеме конвейера](./media/knowledge-store-concept-intro/annotationstore_sans_internalcache.png "Хранилище знаний на схеме конвейера")

После того, как документ находится в конвейере обогащения, он представлен как дерево содержания и связанных с ним обогащений. Это дерево мгновенно, как выход взлома документа. Формат дерева обогащения позволяет конвейеру обогащения прикреплять метаданные даже к примитивным типам данных, он не является действительным объектом JSON, но может быть проецирован в действительный формат JSON. В следующей таблице показано состояние документа, входящего в конвейер обогащения:

|Режим «Источник и разбор данных»|Значение по умолчанию|JSON, JSON Линии & CSV|
|---|---|---|
|Хранилище BLOB-объектов|/документ/содержание<br>/документ/normalized_images/з.<br>…|(документ/ключ1)<br>/документ/ключ2)<br>…|
|SQL|(документ/<br>(документ/<br>…|Недоступно |
|Cosmos DB|(документ/ключ1)<br>/документ/ключ2)<br>…|Недоступно|

 По мере того как искусства выполняют, они добавляют новые узлы к дереву обогащения. Эти новые узлы могут затем использоваться в качестве входных данных для навыков вниз по течению, проектирования в хранилище знаний или отображения для индексирования полей. Обогащение не изменяется: после создания узлы не могут быть отредактированы. По мере того как ваши skillsets получают более сложными, поэтому будет ваше дерево обогащения, но не все узлы в дереве обогащения нужно сделать его к индексу или магазину знаний. 

Можно выборочно сохранять только подмножество обогащений в индекс или хранилище знаний.
Для остальной части этого документа, мы будем считать, что мы работаем с [примером отзывов отелей,](https://docs.microsoft.com/azure/search/knowledge-store-connect-powerbi)но те же концепции применяются к обогащению документов из всех других источников данных.

### <a name="context"></a>Контекст
Каждый навык требует контекста. Контекст определяет:
+   Количество раз, когда выполняется навык, на основе выбранных узлов. Для значений контекста в ```/*``` коллекции типов добавление в конце приведет к тому, что навык будет вызываться один раз для каждого экземпляра в коллекции. 
+   Где в дереве обогащения добавляются навыки выходов. Выходы всегда добавляются в дерево в качестве дна контекстного узла. 
+   Форма входов. Для многоуровневых коллекций настройка контекста родительской коллекции повлияет на форму ввода для навыка. Например, если у вас есть дерево обогащения со списком стран, каждая из которых обогащена списком состояний, содержащих список почтовых индексов.

|Контекст|Входные данные|Форма ввода|Вызов навыков|
|---|---|---|---|
|```/document/countries/*``` |```/document/countries/*/states/*/zipcodes/*``` |Список всех почтовых индексов в стране |Один раз в одну страну |
|```/document/countries/*/states/*``` |```/document/countries/*/states/*/zipcodes/*``` |Список почтовых индексов в штате | Один раз в комбинации страны и государства|

### <a name="sourcecontext"></a>ИсточникКонтекст

Используется `sourceContext` только в навыках [входов и проекций.](knowledge-store-projection-overview.md) Он используется для построения многоуровневых, вложенных объектов. Возможно, вам придется создать новый объект, чтобы либо передать его в качестве вклада в навык или проект в хранилище знаний. Поскольку узлы обогащения не могут быть действительным объектом JSON в дереве обогащения и ссылки на узел в дереве только возвращает это состояние узла, когда он был создан, используя обогащения в качестве навыков входов или проекций требует от вас для создания хорошо сформированного объекта JSON. Позволяет `sourceContext` построить иерархический, анонимный объект типа, который потребует нескольких навыков, если вы используете только контекст. Использование `sourceContext` отображается в следующем разделе. Посмотрите на вывод навыков, который генерировал обогащение, чтобы определить, является ли он допустимым объектом JSON, а не примитивным типом.

### <a name="projections"></a>Проекции

Проекция — это процесс выбора узлов из дерева обогащения, которые будут сохранены в хранилище знаний. Проекции представляют сяртами формы документа (содержание и обогащение), которые могут быть выходными как таблица или объектные проекции. Чтобы узнать больше о работе с прогнозами, смотрите [работу с прогнозами](knowledge-store-projection-overview.md).

![Варианты картирования полей](./media/cognitive-search-working-with-skillsets/field-mapping-options.png "Варианты картирования поля для конвейера по обогащению")

На приведенной выше диаграмме описывается селектор, с помощью котором вы работаете, в зависимости от того, где вы находитесь в конвейере обогащения.

## <a name="generate-enriched-data"></a>Создание обогащенных данных 

Давайте теперь шаг через отель обзоры skillset, вы можете следить за [учебником](knowledge-store-connect-powerbi.md) для создания skillset или [просматривать](https://github.com/Azure-Samples/azure-search-postman-samples/blob/master/samples/skillset.json) skillset. Мы будем смотреть на:

* как дерево обогащения развивается с исполнением каждого навыка 
* как работают контекст и входные данные для определения того, сколько раз выполняется навык 
* что форма ввода основана на контексте. 

Поскольку мы используем режим разграничения текста для индекса, документ в процессе обогащения представляет собой одну строку в файле CSV.

### <a name="skill-1-split-skill"></a>Навыки #1: Сплит мастерство 

![обогащение дерева после документа растрескивания](media/cognitive-search-working-with-skillsets/enrichment-tree-doc-cracking.png "Дерево обогащения после растрескивания документов и перед выполнением навыков")

С мастерством ```"/document/reviews_text"```контексте , этот навык `reviews_text`будет выполнять один раз для . Выход навыка — это `reviews_text` список, в котором сегменты 5000 символов разделены на 5000 символов. Выход из навыка разделения `pages` назван и добавлен к дереву обогащения. Функция `targetName` позволяет переименовать выход навыка перед добавлением в дерево обогащения.

Дерево обогащения теперь имеет новый узла, помещенного в контексте навыка. Этот узла доступен для любого отображения навыков, проекции или выходных полей.


Корневой узла для всех `"/document"`обогащений . При работе с каплей-индексаторами `"/document"` узла будут `"/document/content"` `"/document/normalized_images"`иметься детские узлы и . При работе с данными CSV, как мы в этом примере, имена столбцов будут отображаться на узлах под `"/document"`. Чтобы получить доступ к любому из обогащений, добавленным к уему навыком, необходим полный путь для обогащения. Например, если вы хотите использовать ```pages``` текст из узла в качестве ввода в другой ```"/document/reviews_text/pages/*"```навык, вам нужно будет указать его как.
 
 ![обогащение дерево после мастерства #1](media/cognitive-search-working-with-skillsets/enrichment-tree-skill1.png "Дерево обогащения после #1 выполнено")

### <a name="skill-2-language-detection"></a>Навыки #2 обнаружения языка
 В то время как навык обнаружения языка является третьим (навыком #3) навыком, определенным в наборе навыков, это следующий навык для выполнения. Поскольку он не блокируется, требуя каких-либо входных данных, он будет выполняться параллельно с предыдущим навыком. Как и навык разделения, который предшествовал ему, навык обнаружения языка также вызывается один раз для каждого документа. Дерево обогащения теперь имеет новый узла для языка.
 ![обогащение дерево после #2 мастерства](media/cognitive-search-working-with-skillsets/enrichment-tree-skill2.png "Дерево обогащения после #2 выполнено")
 
 ### <a name="skill-3-key-phrases-skill"></a>Навыки #3: Ключевые фразы мастерство 

С учетом ```/document/reviews_text/pages/*``` контекста ключевых фраз навык будет ссылаться один `pages` раз для каждого из элементов в коллекции. Выход из навыка будет узловым под соответствующим элементом страницы. 

 Теперь вы должны быть в состоянии смотреть на остальные навыки в skillset и визуализировать, как дерево обогащения будет продолжать расти с выполнением каждого навыка. Некоторые навыки, такие как навыкслияния и навыки формовщика, также создают новые узлы, но используют только данные из существующих узлов и не создают новых чистых обогащений.

![обогащение дерева после всех навыков](media/cognitive-search-working-with-skillsets/enrichment-tree-final.png "Дерево обогащения после всех навыков")

Цвета разъемов в дереве выше указывают на то, что обогащение было создано различными навыками и узлы должны быть рассмотрены индивидуально и не будет частью объекта, возвращенного при выборе родительского узла.

## <a name="save-enrichments-in-a-knowledge-store"></a>Сохранить обогащения в хранилище знаний 

Skillsets также определяют хранилище знаний, где ваши обогащенные документы могут быть проецированы как таблицы или объекты. Чтобы сохранить обогащенные данные в хранилище знаний, вы определяете набор проекций для обогащенного документа. Чтобы узнать больше о магазине знаний, смотрите [обзор магазина знаний](knowledge-store-concept-intro.md)

### <a name="slicing-projections"></a>Проекции нарезки

При определении группы проекции таблицы один узло в дереве обогащения может быть разрезан на несколько связанных таблиц. Если добавить таблицу с исходным путем, который является ребенком существующей проекции таблицы, полученный узел ребенка не будет ребенком существующей проекции таблицы, а будет проецироваться в новую, связанную таблицу. Этот метод нарезки позволяет определить один узлы в навыке формовщика, который может быть источником для всех ваших проекций таблицы. 

### <a name="shaping-projections"></a>Формирование прогнозов

Существует два способа определения проекции. Вы можете использовать навык и формовщика для создания нового узла, который является корневым узлам для всех проектов обогащений. Затем, в ваших проекциях, вы будете ссылаться только на выход навыка формовщика. Можно также встроить проекцию в самом определении проекции.

Подход к формовщику более многословен, чем вставка, но гарантирует, что все мутации дерева обогащения содержатся в пределах навыков и что выход является объектом, который может быть использован повторно. Внестройное формирование позволяет создавать нудную форму, но является анонимным объектом и доступна только для проекции, для которой она определена. Подходы можно использовать совместно или отдельно. Набор навыков, созданный для вас в рабочем процессе портала, содержит и то, и другое. Он использует навык формовщика для проекций таблицы, но также использует внее формирование для проецирования таблицы ключевых фраз.

Чтобы расширить пример, можно удалить внее формирование и использовать навык формовщика для создания нового узла для ключевых фраз. Для создания формы, проецируемой на `hotelReviewsDocument` `hotelReviewsPages`три `hotelReviewsKeyPhrases`таблицы, а именно, , и , два варианта описаны в следующих разделах.


#### <a name="shaper-skill-and-projection"></a>Навыки и проекция Shaper 

> [!Note]
> Некоторые столбцы из таблицы документов были удалены из этого примера для краткости.
>
```json
{
    "@odata.type": "#Microsoft.Skills.Util.ShaperSkill",
    "name": "#5",
    "description": null,
    "context": "/document",
    "inputs": [        
        {
            "name": "reviews_text",
            "source": "/document/reviews_text",
            "sourceContext": null,
            "inputs": []
        },
        {
            "name": "reviews_title",
            "source": "/document/reviews_title",
            "sourceContext": null,
            "inputs": []
        },
        {
            "name": "AzureSearch_DocumentKey",
            "source": "/document/AzureSearch_DocumentKey",
            "sourceContext": null,
            "inputs": []
        },  
        {
            "name": "pages",
            "source": null,
            "sourceContext": "/document/reviews_text/pages/*",
            "inputs": [
                {
                    "name": "SentimentScore",
                    "source": "/document/reviews_text/pages/*/Sentiment",
                    "sourceContext": null,
                    "inputs": []
                },
                {
                    "name": "LanguageCode",
                    "source": "/document/Language",
                    "sourceContext": null,
                    "inputs": []
                },
                {
                    "name": "Page",
                    "source": "/document/reviews_text/pages/*",
                    "sourceContext": null,
                    "inputs": []
                },
                {
                    "name": "keyphrase",
                    "sourceContext": "/document/reviews_text/pages/*/Keyphrases/*",
                    "inputs": [
                        {
                            "source": "/document/reviews_text/pages/*/Keyphrases/*",
                            "name": "Keyphrases"
                        }
                    ]
                }
            ]
        }
    ],
    "outputs": [
        {
            "name": "output",
            "targetName": "tableprojection"
        }
    ]
}
```

С `tableprojection` узлом, `outputs` определенным в разделе выше, теперь мы можем использовать `tableprojection` функцию нарезки для проецирования частей узла в различные таблицы:

> [!Note]
> Это только фрагмент проекции в конфигурации хранилища знаний.
>
```json
"projections": [
    {
        "tables": [
            {
                "tableName": "hotelReviewsDocument",
                "generatedKeyName": "Documentid",
                "source": "/document/tableprojection"
            },
            {
                "tableName": "hotelReviewsPages",
                "generatedKeyName": "Pagesid",
                "source": "/document/tableprojection/pages/*"
            },
            {
                "tableName": "hotelReviewsKeyPhrases",
                "generatedKeyName": "KeyPhrasesid",
                "source": "/document/tableprojection/pages/*/keyphrase/*"
            }
        ]
    }
]
```

#### <a name="inline-shaping-projections"></a>Проекции внелинейного формирования

Подход к формированию внеочередных форм не требует навыков формовщика, так как все формы, необходимые для проекций, создаются в то время, когда они необходимы. Для проецирования тех же данных, что и в предыдущем примере, вариант водной проекции будет выглядеть следующим образом:

```json
"projections": [
    {
        "tables": [
            {
                "tableName": "hotelReviewsInlineDocument",
                "generatedKeyName": "Documentid",
                "sourceContext": "/document",     
                "inputs": [
                    {
                        "name": "reviews_text",
                        "source": "/document/reviews_text"
                    },
                    {
                        "name": "reviews_title",
                        "source": "/document/reviews_title"
                    },
                    {
                        "name": "AzureSearch_DocumentKey",
                        "source": "/document/AzureSearch_DocumentKey"
                    }                             
                ]
            },
            {
                "tableName": "hotelReviewsInlinePages",
                "generatedKeyName": "Pagesid",
                "sourceContext": "/document/reviews_text/pages/*",
                "inputs": [
                        {
                    "name": "SentimentScore",
                    "source": "/document/reviews_text/pages/*/Sentiment"
                    },
                    {
                        "name": "LanguageCode",
                        "source": "/document/Language"
                    },
                    {
                        "name": "Page",
                        "source": "/document/reviews_text/pages/*"
                    }
                ]
            },
            {
                "tableName": "hotelReviewsInlineKeyPhrases",
                "generatedKeyName": "KeyPhraseId",
                "sourceContext": "/document/reviews_text/pages/*/Keyphrases/*",
                "inputs": [
                    {
                        "name": "Keyphrases",
                        "source": "/document/reviews_text/pages/*/Keyphrases/*"
                    }
                ]
            }
        ]
    }
]
```
  
Одно замечание от обоих подходов, как значения `"Keyphrases"` проецируются с помощью `"sourceContext"`. Узла, `"Keyphrases"` содержащего набор строк, само по себе является ребенком текста страницы. Однако, поскольку проекции требуют объекта JSON и страница `"sourceContext"` является примитивной (строка), используется для обернуть ключевую фразу в объект с названным свойством. Этот метод позволяет даже примитивам проецироваться независимо.

## <a name="next-steps"></a>Дальнейшие действия

В качестве следующего шага, создать свой первый набор навыков с когнитивными навыками.

> [!div class="nextstepaction"]
> [Создайте свой первый набор навыков.](cognitive-search-defining-skillset.md)
