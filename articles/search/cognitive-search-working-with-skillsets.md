---
title: Основные понятия и рабочий процесс для набора навыков
titleSuffix: Azure Cognitive Search
description: Наборы навыков используются для создания конвейера обогащения с помощью искусственного интеллекта в Когнитивном поиске Azure. Изучите важные понятия и сведения о составлении набора навыков.
manager: nitinme
author: vkurpad
ms.author: vikurpad
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 11/04/2019
ms.openlocfilehash: e8e263d29bc71ac76c374eeda78e5250a0af2095
ms.sourcegitcommit: 493b27fbfd7917c3823a1e4c313d07331d1b732f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/21/2020
ms.locfileid: "83744791"
---
# <a name="skillset-concepts-and-composition-in-azure-cognitive-search"></a>Основные понятия и процесс составления набора навыков в Когнитивном поиске Azure

Эта статья предназначена для разработчиков, которым необходимо более глубокое понимание того, как работает конвейер обогащения. При этом предполагается, что вы понимаете смысл основных понятий процесса обогащения с помощью ИИ. Если вам они незнакомы, для начала ознакомьтесь со статьей
+ [Обогащение с помощью ИИ в службе "Когнитивный поиск Azure"](cognitive-search-concept-intro.md)
+ [Что собой представляет хранилище знаний в службе "Поиск Azure"](knowledge-store-concept-intro.md)

## <a name="specify-the-skillset"></a>Определение набора навыков
Набор навыков — это многократно используемый ресурс в службе "Когнитивный поиск Azure", который определяет коллекцию когнитивных навыков, используемых для анализа, преобразования и обогащения текстового или графического содержимого во время индексирования. Создание набора навыков позволяет прикреплять текст и изображения на этапе приема данных, извлекая и создавая новые сведения и структуры из необработанного содержимого.

Набор навыков имеет три свойства.

+    ```skills``` — неупорядоченная коллекция навыков, последовательность выполнения которой платформа определяет на основе входных данных, необходимых для каждого навыка.
+    ```cognitiveServices``` — ключ когнитивной службы, необходимый для выставления счетов за вызываемые профессиональные навыки.
+    ```knowledgeStore``` — учетная запись хранения, в которой будут проецироваться обогащенные документы.



Наборы навыков создаются в формате JSON. С помощью [языка выражений](https://docs.microsoft.com/azure/search/cognitive-search-skill-conditional) можно создавать сложные навыки с циклами и [ветвлениями](https://docs.microsoft.com/azure/search/cognitive-search-skill-conditional). В языке выражений для обозначения узлов в дереве обогащения используется нотация пути [указателя JSON](https://tools.ietf.org/html/rfc6901) с небольшими изменениями. Оператор ```"/"``` позволяет опуститься в дереве на уровень ниже, а ```"*"``` выступает в качестве оператора for-each в контексте. Чтобы объяснить эти понятия, лучше продемонстрировать их использование на примере. Чтобы продемонстрировать некоторые основные понятия и возможности, мы рассмотрим пример набора навыков [Отзывы о гостинице](knowledge-store-connect-powerbi.md). Чтобы просмотреть набор навыков после выполнения рабочего процесса импорта данных, необходимо [его получить](https://docs.microsoft.com/rest/api/searchservice/get-skillset) с помощью клиента REST API.

### <a name="enrichment-tree"></a>Дерево обогащения

Чтобы представить, как набор навыков постепенно обогащает ваш документ, давайте для начала посмотрим на документ до всякого обогащения. Результат распознавания документов зависит от источника данных и конкретного режима, выбранного для анализа. На него также влияет состояние документа, который служит источником содержимого для [сопоставления полей](search-indexer-field-mappings.md) при добавлении данных в индекс поиска.
![Хранилище знаний на схеме конвейера](./media/knowledge-store-concept-intro/annotationstore_sans_internalcache.png "Хранилище знаний на схеме конвейера")

После прохождения конвейера обогащения документ представляется в виде дерева содержимого и связанных результатов обогащения. Экземпляр этого дерева создается в результате распознавания документа. Формат дерева обогащения позволяет конвейеру обогащения прикреплять метаданные к одинаковым примитивным типам данных. Хотя такое дерево и не является допустимым объектом JSON, его можно спроецировать в допустимый формат JSON. В следующей таблице показано состояние документа, поступающего в конвейер обогащения.

|Источник данных и режим анализа|По умолчанию|JSON, строки JSON и CSV|
|---|---|---|
|Хранилище BLOB-объектов|/document/content<br>/document/normalized_images/*<br>…|/document/{key1}<br>/document/{key2}<br>…|
|SQL|/document/{column1}<br>/document/{column2}<br>…|Недоступно |
|Cosmos DB|/document/{key1}<br>/document/{key2}<br>…|Недоступно|

 По мере выполнения навыков они добавляют новые узлы в дерево обогащения. Эти новые узлы затем можно использовать в качестве входных данных для подчиненных навыков, проецирования в хранилище знаний или сопоставления с полями индекса. Результаты обогащения остаются неизменными: узлы нельзя изменять после создания. По мере усложнения набора навыков усложняется и дерево обогащения, но помещать все его узлы в индекс или хранилище знаний не обязательно. 

В них можно выборочно сохранить только подмножество результатов обогащения.
В оставшейся части этого документа предполагается, что мы работаем с [примером отзывов о гостинице](https://docs.microsoft.com/azure/search/knowledge-store-connect-powerbi), но те же принципы применяются и при обогащении документов изо всех остальных источников данных.

### <a name="context"></a>Контекст
Для каждого навыка требуется контекст. Контекст определяет следующие характеристики.
+    Количество выполнений навыка на основе выбранных узлов. Для значений контекста типа "Коллекция" добавление ```/*``` в конце приведет к тому, что навык будет вызываться один раз для каждого экземпляра в коллекции. 
+    Место добавления выходных данных навыков в дерево обогащения. Выходные данные всегда добавляются в дерево как дочерние узлы для узла контекста. 
+    Форма входных данных. В случае коллекций с несколькими уровнями установка контекста для родительской коллекции влияет на форму входных данных для навыка. Например, если имеется дерево обогащения со списком стран или регионов, каждый его элемент обогащается списком штатов, областей или краев, содержащим список почтовых индексов.

|Контекст|Входные данные|Форма входных данных|Вызов навыка|
|---|---|---|---|
|```/document/countries/*``` |```/document/countries/*/states/*/zipcodes/*``` |Список всех почтовых индексов в стране или регионе |По одному разу для страны или региона |
|```/document/countries/*/states/*``` |```/document/countries/*/states/*/zipcodes/*``` |Список почтовых индексов в штате, области или крае | Один раз для каждого сочетания страны или региона и штата, области или края|

### <a name="sourcecontext"></a>SourceContext

`sourceContext` используется только во входных данных навыков и [проекциях](knowledge-store-projection-overview.md). Применяется для создания многоуровневых вложенных объектов. Возможно, вам потребуется создать новый объект, чтобы передать его в хранилище знаний в качестве входных данных для навыка или проекта. Так как узлы обогащения в дереве обогащения не обязательно являются допустимыми объектами JSON и при ссылке на узел в дереве возвращается только состояние этого узла на момент его создания, при использовании результатов обогащения в качестве входных данных или проекций навыков требуется создать объект JSON с правильным форматом. `sourceContext` позволяет создать иерархический объект анонимного типа. Если использовался только контекст, для этого потребуется несколько навыков. Использование `sourceContext` показано в следующем разделе. Проанализируйте выходные данные навыка, которые создали обогащение, чтобы определить, являются ли они допустимым объектом JSON, а не примитивным типом.

### <a name="projections"></a>Проекции

Проекция — это процесс выбора узлов из дерева обогащения для сохранения в хранилище знаний. Проекции представляют собой настраиваемые формы документа (содержимое и результаты обогащения), которые могут выводиться как табличные или объектные проекции. Дополнительные сведения о работе с проекциями см. в статье о [работе с проекциями](knowledge-store-projection-overview.md).

![Параметры сопоставления полей](./media/cognitive-search-working-with-skillsets/field-mapping-options.png "Параметры сопоставления полей для конвейера обогащения")

На приведенной выше схеме демонстрируется механизм выбора, применяемый на различных участках конвейера обогащения.

## <a name="generate-enriched-data"></a>Создание обогащенных данных 

Теперь давайте приступим к работе с набором навыков "Отзывы о гостинице". Вы можете выполнить инструкции в [учебнике](knowledge-store-connect-powerbi.md) и создать набор навыков самостоятельно или [просмотреть](https://github.com/Azure-Samples/azure-search-postman-samples/) готовый набор навыков. Нас будут интересовать следующие вопросы:

* Как развивается дерево обогащения при выполнении каждого навыка? 
* Как контекст и входные данные влияют на количество выполнений навыка? 
* Какой будет форма входных данных, исходя из контекста? 

Поскольку для индексатора используется режим синтаксического анализа текста с разделителями, документ в процессе обогащения представляет одну строку в CSV-файле.

### <a name="skill-1-split-skill"></a>Навык № 1. Навык разделения 

![Дерево обогащения после распознавания документа](media/cognitive-search-working-with-skillsets/enrichment-tree-doc-cracking.png "Дерево обогащения после распознавания документа перед выполнением навыков")

Для контекста навыка ```"/document/reviews_text"``` этот навык будет выполняться для `reviews_text` один раз. Выводимый навык — это список, в котором `reviews_text` разбивается на сегменты размером 5000 символов. Выходные данные из навыка разделения именуются `pages` и добавляются в дерево обогащения. Признак `targetName` позволяет переименовать выходные данные навыка перед их добавлением в дерево обогащения.

Дерево обогащения теперь содержит новый узел, находящийся в контексте навыка. Этот узел доступен любому сопоставлению навыков, проекций или выходных полей.


Корневой узел для всех результатов обогащения — `"/document"`. При работе с индексаторами больших двоичных объектов узел `"/document"` будет иметь дочерние узлы `"/document/content"` и `"/document/normalized_images"`. При работе с данными в формате CSV (как в этом примере) имена столбцов будут сопоставляться с узлами, расположенными под `"/document"`. Чтобы получить доступ к любому из результатов обогащения, добавленных в узел навыком, требуется полный путь для обогащения. Например, если вы хотите использовать текст из узла ```pages``` в качестве входных данных для другого навыка, необходимо указать его как ```"/document/reviews_text/pages/*"```.
 
 ![Дерево обогащения после применения навыка № 1](media/cognitive-search-working-with-skillsets/enrichment-tree-skill1.png "Дерево обогащения после выполнения навыка № 1")

### <a name="skill-2-language-detection"></a>Навык № 2. Определение языка
 Хотя навык определения языка задан в наборе навыков третьим (навык № 3), он выполняется следующим. Так как он не блокируется, поскольку не требует наличия входных данных, он будет выполняться параллельно с предыдущим навыком. Как и в случае с предыдущим навыком разделения, навык определения языка также вызывается один раз для каждого документа. Дерево обогащения теперь содержит новый узел для языка.
 ![Дерево обогащения после применения навыка № 2](media/cognitive-search-working-with-skillsets/enrichment-tree-skill2.png "Дерево обогащения после выполнения навыка № 2")
 
 ### <a name="skill-3-key-phrases-skill"></a>Навык № 3. Навык ключевых фраз 

При наличии контекста ```/document/reviews_text/pages/*``` навык ключевых фраз будет вызываться один раз для каждого элемента в коллекции `pages`. Результатом выполнения навыка будет узел под соответствующим элементом page. 

 Теперь вы можете изучить остальные навыки в наборе навыков и представить, как будет расти дерево обогащения с учетом выполнения каждого навыка. Некоторые навыки, например навык слияния и навык определения формы, также создают новые узлы, но используют данные только из имеющихся узлов и не создают абсолютно новые результаты обогащения.

![Дерево обогащения после применения всех навыков](media/cognitive-search-working-with-skillsets/enrichment-tree-final.png "Дерево обогащения после применения всех навыков")

Различные цвета соединителей в показанном выше дереве указывают на то, что результаты обогащения созданы различными навыками, поэтому узлы должны обрабатываться по отдельности. Они не будут входить в состав объекта, возвращаемого при выборе родительского узла.

## <a name="save-enrichments-in-a-knowledge-store"></a>Сохранение результатов обогащения в хранилище знаний 

Набор навыков также определяет хранилище знаний, в котором обогащенные документы можно проектировать в виде таблиц или объектов. Чтобы сохранить обогащенные данные в хранилище знаний, необходимо определить набор проекций для обогащенного документа. Дополнительные сведения о хранилище знаний см. в [обзоре хранилища знаний](knowledge-store-concept-intro.md).

### <a name="slicing-projections"></a>Создание срезов проекций

При определении группы табличных проекций один узел в дереве обогащения может быть разделен на срезы в виде нескольких связанных таблиц. При добавлении таблицы с исходным путем, дочерним по отношению к имеющейся проекции таблицы, полученный дочерний узел не будет дочерним элементом имеющейся проекции таблицы, а будет спроектирован в новую связанную таблицу. Этот метод создания срезов позволяет определить один узел в навыке определения формы, который может служить источником для всех табличных проекций. 

### <a name="shaping-projections"></a>Формирование проекций

Проекцию можно определить двумя способами. Для создания нового узла, который является корневым для всех проецируемых результатов обогащения, можно использовать навык определения формы. Затем в проекциях нужно будет просто сослаться на выходные данные навыка определения формы. Формы проекции можно также встроить в определение самой проекции.

Определение формы требует большей детализации по сравнению со встраиванием, однако такой подход гарантирует, что все изменения дерева обогащения остаются в пределах навыков, а выходные данные представляют собой объект, пригодный для повторного использования. Встраивание позволяет создать необходимую форму, но она будет анонимным объектом, доступным только проекции, для которой она определена. Эти подходы можно использовать вместе или отдельно. В наборе навыков, созданном для вас в рабочем процессе портала, используются оба варианта. Навык определения формы используется в нем для табличных проекций, а встроенная форма применяется для проецирования таблицы ключевых фраз.

Чтобы расширить этот пример, можно удалить встроенную форму и использовать навык определения формы для создания нового узла для ключевых фраз. Форму, проецируемую в три таблицы, а именно `hotelReviewsDocument`, `hotelReviewsPages` и `hotelReviewsKeyPhrases`, можно создать двумя способами, описанными в следующих разделах.


#### <a name="shaper-skill-and-projection"></a>Навык определения формы и проекция 

> [!Note]
> Некоторые из столбцов таблицы документа были удалены из этого примера для краткости.
>
```json
{
    "@odata.type": "#Microsoft.Skills.Util.ShaperSkill",
    "name": "#5",
    "description": null,
    "context": "/document",
    "inputs": [        
        {
            "name": "reviews_text",
            "source": "/document/reviews_text",
            "sourceContext": null,
            "inputs": []
        },
        {
            "name": "reviews_title",
            "source": "/document/reviews_title",
            "sourceContext": null,
            "inputs": []
        },
        {
            "name": "AzureSearch_DocumentKey",
            "source": "/document/AzureSearch_DocumentKey",
            "sourceContext": null,
            "inputs": []
        },  
        {
            "name": "pages",
            "source": null,
            "sourceContext": "/document/reviews_text/pages/*",
            "inputs": [
                {
                    "name": "SentimentScore",
                    "source": "/document/reviews_text/pages/*/Sentiment",
                    "sourceContext": null,
                    "inputs": []
                },
                {
                    "name": "LanguageCode",
                    "source": "/document/Language",
                    "sourceContext": null,
                    "inputs": []
                },
                {
                    "name": "Page",
                    "source": "/document/reviews_text/pages/*",
                    "sourceContext": null,
                    "inputs": []
                },
                {
                    "name": "keyphrase",
                    "sourceContext": "/document/reviews_text/pages/*/Keyphrases/*",
                    "inputs": [
                        {
                            "source": "/document/reviews_text/pages/*/Keyphrases/*",
                            "name": "Keyphrases"
                        }
                    ]
                }
            ]
        }
    ],
    "outputs": [
        {
            "name": "output",
            "targetName": "tableprojection"
        }
    ]
}
```

Благодаря узлу `tableprojection`, определенному выше в разделе `outputs`, теперь для проецирования частей узла `tableprojection` в различные таблицы можно воспользоваться функцией среза.

> [!Note]
> Это только фрагмент проекции в конфигурации хранилища знаний.
>
```json
"projections": [
    {
        "tables": [
            {
                "tableName": "hotelReviewsDocument",
                "generatedKeyName": "Documentid",
                "source": "/document/tableprojection"
            },
            {
                "tableName": "hotelReviewsPages",
                "generatedKeyName": "Pagesid",
                "source": "/document/tableprojection/pages/*"
            },
            {
                "tableName": "hotelReviewsKeyPhrases",
                "generatedKeyName": "KeyPhrasesid",
                "source": "/document/tableprojection/pages/*/keyphrase/*"
            }
        ]
    }
]
```

#### <a name="inline-shaping-projections"></a>Проекции со встроенной формой

Подход встраивания формы не требует использования навыка определения формы, так как все формы, необходимые для проекций, создаются в тот момент, когда они требуются. При проецировании тех же данных, что и в предыдущем примере, с использованием встраивания в проекцию результат будет выглядеть следующим образом:

```json
"projections": [
    {
        "tables": [
            {
                "tableName": "hotelReviewsInlineDocument",
                "generatedKeyName": "Documentid",
                "sourceContext": "/document",     
                "inputs": [
                    {
                        "name": "reviews_text",
                        "source": "/document/reviews_text"
                    },
                    {
                        "name": "reviews_title",
                        "source": "/document/reviews_title"
                    },
                    {
                        "name": "AzureSearch_DocumentKey",
                        "source": "/document/AzureSearch_DocumentKey"
                    }                             
                ]
            },
            {
                "tableName": "hotelReviewsInlinePages",
                "generatedKeyName": "Pagesid",
                "sourceContext": "/document/reviews_text/pages/*",
                "inputs": [
                        {
                    "name": "SentimentScore",
                    "source": "/document/reviews_text/pages/*/Sentiment"
                    },
                    {
                        "name": "LanguageCode",
                        "source": "/document/Language"
                    },
                    {
                        "name": "Page",
                        "source": "/document/reviews_text/pages/*"
                    }
                ]
            },
            {
                "tableName": "hotelReviewsInlineKeyPhrases",
                "generatedKeyName": "KeyPhraseId",
                "sourceContext": "/document/reviews_text/pages/*/Keyphrases/*",
                "inputs": [
                    {
                        "name": "Keyphrases",
                        "source": "/document/reviews_text/pages/*/Keyphrases/*"
                    }
                ]
            }
        ]
    }
]
```
  
Отличительной особенностью обоих этих подходов является то, как значения `"Keyphrases"` проецируются с использованием `"sourceContext"`. Узел `"Keyphrases"`, содержащий коллекцию строк, сам по себе является дочерним по отношению к тексту в объекте page. Однако, поскольку для проекций требуется объект JSON, а page является примитивом (строкой), для заключения ключевой фразы в объект с именованным свойством используется `"sourceContext"`. Этот метод позволяет независимо проектировать даже примитивы.

## <a name="next-steps"></a>Дальнейшие действия

Следующий шаг — создание своего первого набора навыков с помощью когнитивных навыков.

> [!div class="nextstepaction"]
> [Создайте свой первый набор навыков](cognitive-search-defining-skillset.md).
