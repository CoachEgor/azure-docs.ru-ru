---
title: Добавление добавочного индексирования (Предварительная версия)
titleSuffix: Azure Cognitive Search
description: Включение отслеживания изменений и сохранение состояния расширенного содержимого для контролируемой обработки в наборе автонавыков. Эта функция сейчас доступна в виде общедоступной предварительной версии.
author: vkurpad
manager: eladz
ms.author: vikurpad
ms.service: cognitive-search
ms.devlang: rest-api
ms.topic: conceptual
ms.date: 11/04/2019
ms.openlocfilehash: 09defe9648208e2300594169add990d4bcbd7a39
ms.sourcegitcommit: 598c5a280a002036b1a76aa6712f79d30110b98d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/15/2019
ms.locfileid: "74112569"
---
# <a name="how-to-set-up-incremental-indexing-of-enriched-documents-in-azure-cognitive-search"></a>Как настроить добавочное индексирование обогащенных документов в Azure Когнитивный поиск

> [!IMPORTANT] 
> Добавочное индексирование в настоящее время находится в общедоступной предварительной версии. Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/). Эта функция предоставляется в [версии REST API 2019-05-06-Preview](search-api-preview.md). В настоящее время отсутствует поддержка портала или пакета SDK для .NET.

В этой статье показано, как добавить состояние и кэширование в обогащенные документы, перемещаясь через конвейер Когнитивный поиск обогащения Azure, чтобы можно было постепенно индексировать документы из любого из поддерживаемых источников данных. По умолчанию набор умений не имеет состояния, а изменение любой части его композиции требует полного повторного запуска индексатора. При добавочном индексировании индексатор может определить, какие части конвейера были изменены, повторно использовать существующие дополнения для неизмененных частей и изменяя уточнения для шагов, которые изменяются. Кэшированное содержимое помещается в службу хранилища Azure.

Если вы не знакомы с настройкой индексаторов, начните с [обзора индексатора](search-indexer-overview.md) , а затем перейдите к [навыков](cognitive-search-working-with-skillsets.md) , чтобы узнать о конвейерах обогащения. Дополнительные сведения о ключевых понятиях см. в разделе [добавочное индексирование](cognitive-search-incremental-indexing-conceptual.md).

## <a name="modify-an-existing-indexer"></a>Изменение существующего индексатора

При наличии существующего индексатора выполните следующие действия, чтобы включить добавочное индексирование.

### <a name="step-1-get-the-indexer"></a>Шаг 1. получение индексатора

Начните с допустимого существующего индексатора, который уже определил требуемый источник данных и индекс. Ваш индексатор должен быть готов к запуску. С помощью клиента API создайте [запрос Get](https://docs.microsoft.com/rest/api/searchservice/get-indexer) для получения текущей конфигурации индексатора, к которому необходимо добавить добавочное индексирование.

```http
GET https://[service name].search.windows.net/indexers/[your indexer name]?api-version=2019-05-06-Preview
Content-Type: application/json
api-key: [admin key]
```

### <a name="step-2-add-the-cache-property"></a>Шаг 2. Добавление свойства Cache

Измените ответ запроса GET, чтобы добавить свойство `cache` в индексатор. Для объекта кэша требуется только одно свойство, а это строка подключения к учетной записи хранения Azure.

```json
    "cache": {
        "storageConnectionString": "[your storage connection string]"
    }
```

### <a name="step-3-reset-the-indexer"></a>Шаг 3. Сброс индексатора

> [!NOTE]
> Сброс индексатора приведет к тому, что все документы в источнике данных будут обрабатываться повторно, чтобы содержимое можно было кэшировать. Все неработающие обогащения будут перезапущены во всех документах.
>

Сброс индексатора требуется при настройке добавочного индексирования для существующих индексаторов, чтобы гарантировать, что все документы находятся в стабильном состоянии. Сбросьте индексатор с помощью [REST API](https://docs.microsoft.com/rest/api/searchservice/reset-indexer).

```http
POST https://[service name].search.windows.net/indexers/[your indexer name]/reset?api-version=2019-05-06-Preview
Content-Type: application/json
api-key: [admin key]
```

### <a name="step-4-save-the-updated-definition"></a>Шаг 4. Сохранение обновленного определения

Обновление определения индексатора с помощью запроса на размещение. тело запроса должно содержать обновленное определение индексатора.

```http
PUT https://[service name].search.windows.net/indexers/[your indexer name]/reset?api-version=2019-05-06-Preview
Content-Type: application/json
api-key: [admin key]
{
    "name" : "your indexer name",
    ...
    "cache": {
        "storageConnectionString": "[your storage connection string]",
        "enableReprocessing": true
    }
}
```

Если теперь вы выдаете другой запрос GET для индексатора, ответ службы будет включать свойство `cacheId` в объект Cache. `cacheId` — это имя контейнера, который будет содержать все кэшированные результаты и промежуточное состояние каждого документа, обрабатываемого этим индексатором.

## <a name="enable-incremental-indexing-on-new-indexers"></a>Включить добавочное индексирование для новых индексаторов

Чтобы настроить добавочное индексирование для нового индексатора, включите свойство `cache` в полезные данные определения индексатора. Убедитесь, что вы используете `2019-05-06-Preview` версию API.

## <a name="overriding-incremental-indexing"></a>Переопределение добавочного индексирования

При настройке добавочное индексирование отслеживает изменения в конвейере индексирования и на дисках, чтобы обеспечить согласованность в индексе и проекциях. В некоторых случаях необходимо переопределить это поведение, чтобы индексатор не выполнит дополнительную работу в результате обновления конвейера индексирования. Например, для обновления строки подключения к источнику данных потребуется сброс индексатора и повторное индексирование всех документов по мере изменения DataSource. Но если бы вы обновляли строку подключения только с помощью нового ключа, изменение не приведет к изменению существующих документов. И наоборот, может потребоваться, чтобы индексатор сделает кэш недействительным и обогащенным документом, даже если изменения в конвейере индексирования не производятся. Например, можно сделать недействительным индексатор, если необходимо повторно развернуть пользовательский навык с помощью новой модели, и вы хотели, чтобы навык перезапускались для всех документов.

### <a name="override-reset-requirement"></a>Переопределение требования сброса

При внесении изменений в конвейер индексации любые изменения, приводящие к недействительности кэша, требуют сброса индексатора. Если вы вносите изменения в конвейер индексатора и не хотите, чтобы отслеживание изменений сделает кэш недействительным, необходимо присвоить параметру `ignoreResetRequirement` QueryString значение `true` для операций в индексаторе или источнике данных.

### <a name="override-change-detection"></a>Переопределение обнаружения изменений

При внесении обновлений в набор навыков, в результате которого документы помечаются как несоответствующие, например, при повторном развертывании навыка обновляется URL-адрес пользовательского навыка, установите для параметра `disableCacheReprocessingChangeDetection` строки запроса значение `true` при обновлении набора навыков.

### <a name="force-change-detection"></a>Принудительное обнаружение изменений

В экземпляре, когда необходимо, чтобы конвейер индексирования распознал изменение во внешней сущности, например развертывание новой версии пользовательского навыка, необходимо обновить набор навыков и "коснуться" конкретного навыка, изменив определение навыка, а именно URL-адрес для принудительного выполнения. Обнаружение изменений и недействительность кэша для этого навыка.

## <a name="next-steps"></a>Дополнительная информация

В этой статье описывается добавочное индексирование для индексаторов, включающих навыков. Для дальнейшего округления знаний ознакомьтесь со статьями о повторной индексации в целом, применимых ко всем сценариям индексирования в Azure Когнитивный поиск.

+ [Как перестроить индекс Azure когнитивный Поиск](search-howto-reindex.md). 
+ [Как индексировать большие наборы данных в Azure когнитивный Поиск](search-howto-large-index.md). 
