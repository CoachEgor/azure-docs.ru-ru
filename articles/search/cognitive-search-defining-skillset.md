---
title: Создание набора навыков
titleSuffix: Azure Cognitive Search
description: Определите шаги по извлечению данных, обработке естественного языка или анализу изображений для обогащения и извлечения структурированной информации из ваших данных для использования в Azure Cognitive Search.
manager: nitinme
author: luiscabrer
ms.author: luisca
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 11/04/2019
ms.openlocfilehash: 43251783cbcd6501562913b7b9cafb4f9f7cb3f1
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75754567"
---
# <a name="how-to-create-a-skillset-in-an-ai-enrichment-pipeline-in-azure-cognitive-search"></a>Как создать набор навыков в конвейере обогащения ИИ в Azure Cognitive Search 

Обогащение ИИ извлекает и обогащает данные, чтобы сделать их пригодными для поиска в Azure Cognitive Search. Шаги извлечения и обогащения называются *когнитивными навыками*. Они объединяются в *наборы навыков*, указываемые при индексировании. Набор навыков может использовать [встроенные навыки](cognitive-search-predefined-skills.md) или пользовательские навыки (см. [Пример: Создание пользовательского навыка в конвейере обогащения ИИ](cognitive-search-create-custom-skill-example.md) для получения дополнительной информации).

В этой статье описано, как создать конвейер обогащения для используемых навыков. Набор навыков прилагается к [индексатору](search-indexer-overview.md)когнитивного поиска Azure. Процесс проектирования конвейера, который описывается в этой статье, включает создание самого набора навыков, 

> [!NOTE]
> а также определение индексатора (см. [следующий шаг](#next-step)). Определение индексатора предполагает создание ссылки на набор навыков, а также наличие сопоставлений полей, используемых для связывания входных и выходных данных в целевом индексе.

Важно помнить следующее:

+ С каждым индексатором может использоваться только один набор навыков.
+ В наборе навыков должен быть хотя бы один навык.
+ Вы можете создать несколько навыков одного типа (например, варианты навыка анализа изображений).

## <a name="begin-with-the-end-in-mind"></a>Начиная процесс, помните о его завершении

Вначале рекомендуется определить, какие данные необходимо извлечь из необработанных данных и как они будут использоваться в решении поиска. Созданная схема всего конвейера обогащения поможет определить необходимые действия.

Предположим, вы хотите обработать определенное число комментариев финансовых аналитиков. Для каждого файла требуется извлечь названия компаний и общую тональность комментариев. Также вам может понадобиться написать специальное средство обогащения, которое использует службу поиска сущностей Bing для определения дополнительных сведений о компании, например, чем именно она занимается. По сути вам нужно извлечь следующую информацию, проиндексированную для каждого документа:

| Текст записи | Компании | Тональность | Описания компаний |
|--------|-----|-----|-----|
|Пример записи| ["Майкрософт", "LinkedIn"] | 0.99 | ["Корпорация Майкрософт — американская мультинациональная технологическая компания..." , "LinkedIn — социальная сеть для поиска и установления деловых контактов..."]

На следующей схеме показан возможный конвейер обогащения:

![Гипотетический конвейер обогащения](media/cognitive-search-defining-skillset/sample-skillset.png "Гипотетический конвейер обогащения")


Получив четкое представление о том, что должен включать конвейер, вы можете определить набор навыков для выполнения всех действий. Функционально набор навыков выражается при загрузке определения индекса в Azure Cognitive Search. См. дополнительные сведения об [отправке индексатора](https://docs.microsoft.com/rest/api/searchservice/create-indexer).


На схеме этап *открытия документа* происходит автоматически. По сути, Azure Cognitive Search знает, как открывать известные файлы и создает поле *содержимого,* содержащее текст, извлеченный из каждого документа. Белые прямоугольники соответствуют встроенным средствам обогащения, а заполненный точками прямоугольник "Поиск сущностей Bing" — настраиваемому средству обогащения, которое вы создаете. Как показано на схеме, набор навыков содержит три навыка.

## <a name="skillset-definition-in-rest"></a>Определение набора навыков в REST

Набор навыков определяется в виде массива навыков. Каждый навык определяет источник его входных данных и имя выдаваемых выходных данных. Используя [REST API для создания набора навыков](https://docs.microsoft.com/rest/api/searchservice/create-skillset), можно определить набор навыков, соответствующий предыдущей схеме: 

```http
PUT https://[servicename].search.windows.net/skillsets/[skillset name]?api-version=2019-05-06
api-key: [admin key]
Content-Type: application/json
```

```json
{
  "description": 
  "Extract sentiment from financial records, extract company names, and then find additional information about each company mentioned.",
  "skills":
  [
    {
      "@odata.type": "#Microsoft.Skills.Text.EntityRecognitionSkill",
      "context": "/document",
      "categories": [ "Organization" ],
      "defaultLanguageCode": "en",
      "inputs": [
        {
          "name": "text",
          "source": "/document/content"
        }
      ],
      "outputs": [
        {
          "name": "organizations",
          "targetName": "organizations"
        }
      ]
    },
    {
      "@odata.type": "#Microsoft.Skills.Text.SentimentSkill",
      "inputs": [
        {
          "name": "text",
          "source": "/document/content"
        }
      ],
      "outputs": [
        {
          "name": "score",
          "targetName": "mySentiment"
        }
      ]
    },
    {
      "@odata.type": "#Microsoft.Skills.Custom.WebApiSkill",
     "description": "Calls an Azure function, which in turn calls Bing Entity Search",
      "uri": "https://indexer-e2e-webskill.azurewebsites.net/api/InvokeTextAnalyticsV3?code=foo",
      "httpHeaders": {
          "Ocp-Apim-Subscription-Key": "foobar"
      },
      "context": "/document/organizations/*",
      "inputs": [
        {
          "name": "query",
          "source": "/document/organizations/*"
        }
      ],
      "outputs": [
        {
          "name": "description",
          "targetName": "companyDescription"
        }
      ]
    }
  ]
}
```

## <a name="create-a-skillset"></a>Создание набора навыков

Создавая набор навыков, можно предоставить описание, чтобы сделать такой набор самодокументируемым. Описание является необязательным, но с его помощью удобно отслеживать действия, которые выполняет набор навыков. Так как набор навыков — это документ JSON, который не допускает комментарии, необходимо использовать элемент `description`.

```json
{
  "description": 
  "This is our first skill set, it extracts sentiment from financial records, extract company names, and then finds additional information about each company mentioned.",
  ...
}
```

Следующий элемент в наборе навыков — массив навыков. Каждый навык можно представить в виде примитива обогащения. Каждый навык выполняет небольшую задачу в конвейере обогащения. Каждый из них принимает один или несколько элементов входных данных и возвращает выходные данные. Следующие несколько разделов посвящены тому, как указать встроенные и пользовательские навыки, навыки цепочки вместе через входные и выходные ссылки. Входные данные могут поступать из исходных данных или из другого навыка. Выходные данные можно сопоставить с полем в индексе поиска или использовать в качестве входных для нижестоящего навыка.

## <a name="add-built-in-skills"></a>Добавление встроенных навыков

Давайте посмотрим на первый навык, который является встроенным [навыком распознавания сущности:](cognitive-search-skill-entity-recognition.md)

```json
    {
      "@odata.type": "#Microsoft.Skills.Text.EntityRecognitionSkill",
      "context": "/document",
      "categories": [ "Organization" ],
      "defaultLanguageCode": "en",
      "inputs": [
        {
          "name": "text",
          "source": "/document/content"
        }
      ],
      "outputs": [
        {
          "name": "organizations",
          "targetName": "organizations"
        }
      ]
    }
```

* Каждый встроенный `odata.type`навык `input`имеет, и `output` свойства. Свойства, связанные с определенным навыком, предоставляют дополнительные сведения, применимые к этому навыку. При распознавании сущностей предварительно обученной моделью `categories` представляет одну из сущностей фиксированного набора типов сущностей.

* Каждый навык должен иметь ```"context"```. Контекст представляет уровень, на котором выполняются операции. В приведенном выше навыке контекст представляет собой весь документ, что означает, что навык распознавания сущности вызывается один раз в документ. Также на этом уровне создаются выходные данные. В частности, создаются ```"organizations"``` в качестве элемента ```"/document"```. В нижестоящих навыках можно ссылаться на только что созданную информацию как на ```"/document/organizations"```.  Если поле ```"context"``` явно не задано, контекстом по умолчанию является документ.

* Навык имеет один входной параметр text, исходный входной параметр для которого задан как ```"/document/content"```. Навык (распознавание сущности) работает на поле *содержимого* каждого документа, которое является стандартным полем, созданным индексатором azure blob. 

* Навык имеет один выходной параметр с именем ```"organizations"```. Выходные данные существуют только во время обработки. Для связывания этого выходного параметра со входным параметром нижестоящего навыка можно ссылаться на выходной параметр как на ```"/document/organizations"```.

* Для определенного документа значение ```"/document/organizations"``` представляет массив организаций, извлеченный из текста. Пример:

  ```json
  ["Microsoft", "LinkedIn"]
  ```

В некоторых ситуациях требуется ссылаться на каждый элемент массива отдельно. Например, предположим, что нужно передать каждый элемент ```"/document/organizations"``` отдельно в другой навык (например, в настраиваемое средство обогащения поиска сущностей Bing). Можно создать ссылку на каждый элемент массива, добавив звездочку в путь: ```"/document/organizations/*"``` 

Второй навык для извлечения тональности используется так же, как и первое средство обогащения. Он принимает ```"/document/content"``` в качестве входных данных и возвращает оценку тональности для каждого экземпляра содержимого. Так как поле ```"context"``` не задано явным образом, выходные данные (mySentiment) теперь являются дочерним элементом ```"/document"```.

```json
    {
      "@odata.type": "#Microsoft.Skills.Text.SentimentSkill",
      "inputs": [
        {
          "name": "text",
          "source": "/document/content"
        }
      ],
      "outputs": [
        {
          "name": "score",
          "targetName": "mySentiment"
        }
      ]
    },
```

## <a name="add-a-custom-skill"></a>Добавление настраиваемого навыка

Напомним структуру настраиваемого средства обогащения для поиска сущностей Bing:

```json
    {
      "@odata.type": "#Microsoft.Skills.Custom.WebApiSkill",
     "description": "This skill calls an Azure function, which in turn calls Bing Entity Search",
      "uri": "https://indexer-e2e-webskill.azurewebsites.net/api/InvokeTextAnalyticsV3?code=foo",
      "httpHeaders": {
          "Ocp-Apim-Subscription-Key": "foobar"
      },
      "context": "/document/organizations/*",
      "inputs": [
        {
          "name": "query",
          "source": "/document/organizations/*"
        }
      ],
      "outputs": [
        {
          "name": "description",
          "targetName": "companyDescription"
        }
      ]
    }
```

Это определение является [пользовательским навыком,](cognitive-search-custom-skill-web-api.md) который вызывает веб-API как часть процесса обогащения. Для каждой организации, идентифицированной по распознаванию сущности, этот навык вызывает web API, чтобы найти описание этой организации. Оркестрация времени вызова веб-API и включения в поток полученной информации обрабатывается внутренним модулем обогащения. При этом инициализация, необходимая для вызова этого настраиваемого API, должна быть задана в JSON (например, uri, httpHeaders и ожидаемые входные данные). Инструкции по созданию настраиваемого веб-API для конвейера обогащения см. в руководстве по [определению настраиваемого интерфейса](cognitive-search-custom-skill-interface.md).

Обратите внимание, что в поле context задается значение ```"/document/organizations/*"``` со звездочкой. Это означает, что этап обогащения вызывается *для каждой* организации из ```"/document/organizations"```. 

Выходные данные (в этом случае описание компании) создаются для каждой идентифицированной организации. При создании ссылки на описание в нижестоящем шаге (например, при извлечении ключевых фраз) следует использовать путь ```"/document/organizations/*/description"```. 

## <a name="add-structure"></a>Добавить структуру

Набор навыков создает структурированную информацию из неструктурированных данных. Рассмотрим следующий пример:

*"В четвертом квартале Microsoft получила $1,1 млрд выручки от LinkedIn, социальной сети, которая она купила в прошлом году. Приобретение позволяет корпорации Майкрософт сочетать возможности LinkedIn с возможностями CRM и Office. Акционеры рады прогрессу до сих пор ".*

Вероятным результатом будет приблизительно такая созданная структура:

![Структура вывода образцов](media/cognitive-search-defining-skillset/enriched-doc.png "Структура вывода образцов")

До сих пор эта структура была только внутренней, только для памяти и использовалась только в индексах когнитивного поиска Azure. Добавление магазина знаний дает вам способ сохранить формы обогащения для использования за пределами поиска.

## <a name="add-a-knowledge-store"></a>Добавление хранилища знаний

[Хранилище знаний](knowledge-store-concept-intro.md) — это функция предварительного просмотра в Azure Cognitive Search для сохранения обогащенного документа. Созданный магазин знаний, поддерживаемый учетной записью хранения Azure, — это хранилище, в котором приземляются ваши обогащенные данные. 

Определение хранилища знаний добавляется к набору навыков. Для пошагового просмотра всего процесса [см.](knowledge-store-create-rest.md)

```json
"knowledgeStore": {
  "storageConnectionString": "<an Azure storage connection string>",
  "projections" : [
    {
      "tables": [ ]
    },
    {
      "objects": [
        {
          "storageContainer": "containername",
          "source": "/document/EnrichedShape/",
          "key": "/document/Id"
        }
      ]
    }
  ]
}
```

Вы можете сохранить обогащенные документы в виде таблиц с сохраненными иерархическими отношениями или в документах JSON в хранилище каблов. Выход из любого из навыков в наборе навыков может быть получен в качестве вклада для проекции. Если вы хотите проецировать данные в определенную форму, обновленный [навык формовщика](cognitive-search-skill-shaper.md) теперь может моделировать сложные типы для использования. 

<a name="next-step"></a>

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы узнали о конвейере обогащения и наборах навыков, переходите к руководствам по [созданию ссылок на аннотации в наборе навыков](cognitive-search-concept-annotations-syntax.md) и [сопоставлению выходных данных с полями в индексе](cognitive-search-output-field-mapping.md). 
