---
title: Подключение к хранилищу знаний с помощью Power BI — Поиск Azure
description: Узнайте, как создать хранилище знаний с помощью мастера импорта данных на портале Azure и подключиться к нему с помощью Power BI для анализа и исследования.
author: heidisteen
services: search
ms.service: search
ms.subservice: cognitive-search
ms.devlang: NA
ms.topic: tutorial
ms.date: 07/30/2019
ms.author: heidist
ms.openlocfilehash: 518a96ae8ace5c9630d594fe70487635b6ec1d2c
ms.sourcegitcommit: bc3a153d79b7e398581d3bcfadbb7403551aa536
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/06/2019
ms.locfileid: "68840841"
---
# <a name="create-an-azure-search-knowledge-store-and-connect-using-power-bi"></a>Создание хранилища знаний Поиска Azure и подключение к нему с помощью Power BI

> [!Note]
> Хранилище знаний предоставляется в предварительной версии и не предназначено для использования в рабочей среде. Этот компонент предоставляется в [REST API версии 2019-05-06-Preview](search-api-preview.md). Поддержка пакета SDK для .NET пока не реализована.
>

Хранилище знаний — это компонент Поиска Azure, который сохраняет выходные данные конвейера обогащения, выполняемого с помощью ИИ, для последующего анализа или обработки. Конвейер обогащения с помощью ИИ способен получать файлы изображений или неструктурированные текстовые файлы из поддерживаемого источника данных, отправлять их для индексирования в Поиск Azure, применять результаты обогащения ИИ, выполняемого службами Cognitive Services (например, анализ изображений и обработку естественного языка), а затем сохранять результаты в хранилище знаний в службе хранилища Azure. К хранилищу знаний можно подключить такие средства, как Power BI или Обозреватель службы хранилища, для изучения результатов.

В этой статье объясняется, как создать хранилище знаний на портале и подключиться к нему для изучения содержимого хранилища с помощью Power Query в Power BI Desktop. 

В этом пошаговом руководстве описано, как использовать набор данных, состоящий из отзывов и оценок клиентов, данные об оценках тональности из Cognitive Services и надстройку Power Query для получения документов. Данные подготовлены на основе отзывов о гостиницах, оставленных на сайте Kaggle.com. 

## <a name="prerequisites"></a>Предварительные требования

+ [Скачайте CSV-файл отзывов о гостиницах (HotelReviews_Free.csv)](https://knowledgestoredemo.blob.core.windows.net/hotel-reviews/HotelReviews_Free.csv?st=2019-07-29T17%3A51%3A30Z&se=2021-07-30T17%3A51%3A00Z&sp=rl&sv=2018-03-28&sr=c&sig=LnWLXqFkPNeuuMgnohiz3jfW4ijePeT5m2SiQDdwDaQ%3D). Этот набор данных содержит отзывы клиентов о гостиницах.

+ [Power BI Desktop](https://powerbi.microsoft.com/downloads/)

+ [Поиск Azure.](search-create-service-portal.md) Вы можете использовать бесплатную службу для выполнения инструкций из этого руководства. 

+ [Хранилище Azure.](https://docs.microsoft.com/azure/storage/blobs/storage-quickstart-blobs-portal) Убедитесь, что используется учетная запись общего назначения. Это может быть *StorageV2 (учетная запись общего назначения версии 2 по умолчанию)* или *Storage (учетная запись общего назначения версии 1)* . Выберите регион, в котором размещается Поиск Azure.
 
## <a name="prepare-data"></a>Подготовка данных 

Загрузите CSV-файл в хранилище BLOB-объектов Azure, чтобы он был доступен для индексатора службы "Поиск Azure".

1. [Войдите на портал Azure](https://portal.azure.com), перейдите к учетной записи хранения Azure, выберите **Большие двоичные объекты**, а затем щелкните **Контейнер**.

1. [Создайте контейнер больших двоичных объектов](https://docs.microsoft.com/azure/storage/blobs/storage-quickstart-blobs-portal) для хранения примера данных. 

   1. Присвойте контейнеру имя `hotel-reviews`. 
   
   1. Задайте любое из допустимых значений уровня общего доступа. В нашем примере используется значение по умолчанию.

1. Откройте контейнер после создания и на панели команд выберите **Загрузить**.

1. Перейдите в папку с файлом **HotelReviews-Free.csv**, выберите его и нажмите кнопку **Отправить**.

   ![Отправка CSV-файла](media/knowledge-store-howto-powerbi/hotel-reviews-blob-container.png "Отправка CSV-файла")

1. Находясь в хранилище Azure, получите строку подключения и имя контейнера.  Они понадобятся вам при создании объекта источника данных.

   1. На странице обзора щелкните **Ключи доступа** и скопируйте *строку подключения*. Она начинается с `DefaultEndpointsProtocol=https;` и заканчивается `EndpointSuffix=core.windows.net`. Посередине указано имя и ключ вашей учетной записи. 

   1. В качестве имени контейнера должно быть указано `hotel-reviews` или любое другое назначенное имя. 

## <a name="create-and-run-ai-enrichments"></a>Создание и запуск обогащений, выполняемых с помощью ИИ

Используйте мастер импорта данных для создания хранилища знаний. Нужно импортировать набор данных, выбрать обогащения, настроить хранилище знаний и индекс, после чего выполнить индексирование.

1. [Найдите службу поиска](https://ms.portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Search%2FsearchServices) на портале Azure.

1. Нажмите кнопку **импорта данных** на панели команд.

1. Создайте объект источника данных на первой странице мастера.

   - Выберите **хранилище BLOB-объектов Azure**.

   - Присвойте источнику данных имя, например *hotel-reviews-ds*.

   - Так как данные имеют формат CSV, выберите **Текстовый файл с разделителями** для режима анализа, щелкните **Первая строка содержит заголовок** и убедитесь, что в качестве символа разделителя задана запятая.

   - Строку подключения к учетной записи хранения Azure можно получить на портале в разделе **Ключи доступа**.

   - Имя контейнера можно также получить на портале, просмотрев список больших двоичных объектов службы хранилища Azure.

      ![Создание объекта источника данных](media/knowledge-store-howto-powerbi/hotel-reviews-ds.png "Создание объекта источника данных")

1. Добавьте обогащения и настройте хранилище знаний на второй странице мастера.

   - В разделе **Подключение Cognitive Services** можно использовать бесплатный ресурс, который позволяет выполнять до 20 транзакций в день. Число записей в файле HotelReviews-Free.csv не превышает 20.

   - В разделе **Добавление обогащений** присвойте набору навыков имя *hotel-reviews-ss*, в поле исходных данных выберите *reviews_text*, для уровня детализации обогащения выберите *Страницы (фрагменты из 5000 симв.)* , после чего выберите три навыка: *Извлечь ключевые фразы*, *Определить язык*, *Определить тональность*.

      ![Создание набора навыков](media/knowledge-store-howto-powerbi/hotel-reviews-ss.png "Создание набора навыков")

   - В разделе **Сохранение обогащений в хранилище знаний** укажите строку подключения к учетной записи хранения Azure общего назначения. Хранилище знаний создается в Хранилище таблиц Azure, когда вы выбираете в этом разделе параметр *Проекты таблицы Azure*.

      ![Настройка хранилища знаний](media/knowledge-store-howto-powerbi/hotel-reviews-ks.png "Настройка хранилища знаний")
   
   Щелкните **Далее: Настроить целевой индекс**, чтобы перейти к следующему шагу.

1. Настройте индекс для полнотекстовых поисковых запросов, выполняемых в Поиске Azure. Хотя основное внимание в этом руководстве уделяется подключению Power BI к Хранилищу таблиц Azure, **мастер импорта данных** может также создать индекс для полнотекстового поиска в Поиске Azure. 

   Мастер сортирует данные из источника по отдельным полям и типам данных, поэтому вам остается только выбрать необходимые атрибуты для достижения желаемого поведения. Так, *Доступный для получения* означает, что содержимое поля может быть получено из службы, тогда как *Доступный для поиска* позволяет выполнять полнотекстовый поиск по выбранным полям.

   - Присвойте индексу имя, например *hotel-reviews-idx*.
   - Задайте для всех полей параметр **Доступный для получения**.
   - Для полей *city*, *name*, *reviews_text*, *language*, *keyphrases* задайте параметр **Доступный для поиска**.
   - Для полей *sentiment*, *language* и *keyphrases* задайте параметры **Фильтруемый** и **Аспектируемый**. 
   
    Индекс должен выглядеть примерно так, как показано на следующем рисунке.

     ![Настройка индекса](media/knowledge-store-howto-powerbi/hotel-reviews-idx.png "Настройка индекса")

   Щелкните **Далее: Создать индексатор**, чтобы перейти к следующему шагу.

1. Настройте индексатор, указав его имя и задав ему расписание. В нашем примере в качестве имени индексатора используйте *hotel-reviews-idxr* и заданный по умолчанию параметр **Один раз** для расписания, чтобы немедленно запустить индексатор.

   При создании индексатора применяются все заданные ранее настройки. На этом этапе выполняется извлечение, обработка и прием данных.

1. Отслеживать ход индексирования можно в очереди уведомлений на портале. Индексирование занимает несколько минут.

## <a name="connect-with-power-bi"></a>Подключение с помощью Power BI

1. Запустите Power BI Desktop и выберите **Получение данных**.

1. В этом разделе выберите **Azure** и **Хранилище таблиц Azure**. Щелкните **Подключить**.

1. В поле "Имя и URL-адрес учетной записи " вставьте имя учетной записи службы хранилища Azure (полный URL-адрес будет разрешен автоматически).

1. Введите ключ учетной записи.

1. Выберите Document, KeyPhrases и Pages. Это таблицы, созданные мастером импорта данных после выбора одноименных элементов при настройке хранилища знаний. Нажмите кнопку **Загрузить**.

1. Откройте Power Query, щелкнув значок **Изменить запросы**.

   ![Запуск Power Query](media/knowledge-store-howto-powerbi/powerbi-edit-queries.png "Запуск Power Query")

1. В таблице Document сделайте следующее:

   - Удалите столбцы PartitionKey, RowKey и Timestamp, созданные Хранилищем таблиц Azure. Хранилище знаний обеспечивает связи, используемые в этом анализе.

   - Разверните столбец содержимого.

     ![Правка таблиц](media/knowledge-store-howto-powerbi/powerbi-edit-table.png "Правка таблиц")

1. Выберите все поля, а затем отмените выбор, начиная с поля metadata.

1. Щелкая значок ABC-123 в каждом столбце, исправьте тип данных в следующих столбцах:

   - В столбцах Date тип данных нужно задать как **Дата и время**.
   - В столбце *Latitude* — **Десятичное число**.
   - В столбце *Longitude* — **Десятичное число**.

1. Повторите эти шаги в таблице KeyPhrases, удалив PartitionKey и другие столбцы, развернув столбцы содержимого и задав для столбца *SentimentScore* тип данных **Десятичное число**.

1. Повторите действия в таблице Pages, удалив PartitionKey и другие столбцы и расширив столбцы содержимого. В этой таблице не нужно изменять тип данных.

1. Щелкните **Закрыть и применить** в левом углу на панели команд Power Query.

1. Убедитесь, что Power BI распознает связи, созданные в данных хранилищем знаний. Щелкните плитку связей на панели навигации слева. Все три таблицы должны быть связаны. Измените связи и убедитесь, что настроена двухсторонняя перекрестная фильтрация. Это обеспечит обновление всех визуальных элементов при применении фильтра.

   ![Проверка связей](media/knowledge-store-howto-powerbi/powerbi-relationships.png "Проверка связей")

## <a name="try-with-larger-data-sets"></a>Работа с большими наборами данных

Мы намеренно использовали небольшой набор данных, чтобы избежать расходов при выполнении инструкций из руководства. Для большей реалистичности вы можете создать и присоединить платный ресурс Cognitive Services, что позволит выполнить больше транзакций для получения навыков анализа тональности, извлечения ключевых фраз и определения языка.

Создайте отдельные контейнеры в хранилище BLOB-объектов Azure для каждого CSV-файла. Используйте один из этих контейнеров на шаге создания источника данных в мастере импорта данных.

| ОПИСАНИЕ | Ссылка |
|-------------|------|
| Уровень "Бесплатный"   | [HotelReviews_Free.csv](https://knowledgestoredemo.blob.core.windows.net/hotel-reviews/HotelReviews_Free.csv?st=2019-07-29T17%3A51%3A30Z&se=2021-07-30T17%3A51%3A00Z&sp=rl&sv=2018-03-28&sr=c&sig=LnWLXqFkPNeuuMgnohiz3jfW4ijePeT5m2SiQDdwDaQ%3D) |
| Небольшой (500 записей) | [HotelReviews_Small.csv](https://knowledgestoredemo.blob.core.windows.net/hotel-reviews/HotelReviews_Small.csv?st=2019-07-29T17%3A51%3A30Z&se=2021-07-30T17%3A51%3A00Z&sp=rl&sv=2018-03-28&sr=c&sig=LnWLXqFkPNeuuMgnohiz3jfW4ijePeT5m2SiQDdwDaQ%3D) |
| Средний (6000 записей)| [HotelReviews_Medium.csv](https://knowledgestoredemo.blob.core.windows.net/hotel-reviews/HotelReviews_Medium.csv?st=2019-07-29T17%3A51%3A30Z&se=2021-07-30T17%3A51%3A00Z&sp=rl&sv=2018-03-28&sr=c&sig=LnWLXqFkPNeuuMgnohiz3jfW4ijePeT5m2SiQDdwDaQ%3D)
| Большой (полный набор данных с 35 000 записей) | [HotelReviews_Large.csv](https://knowledgestoredemo.blob.core.windows.net/hotel-reviews/HotelReviews_Large.csv?st=2019-07-29T17%3A51%3A30Z&se=2021-07-30T17%3A51%3A00Z&sp=rl&sv=2018-03-28&sr=c&sig=LnWLXqFkPNeuuMgnohiz3jfW4ijePeT5m2SiQDdwDaQ%3D). Имейте в виду, что обработка очень больших наборов данных требует больших затрат. Плата за обработку этого контейнера составит приблизительно 1000 долл. США.|

Чтобы использовать большие наборы данных, на шаге добавления обогащений в мастере подключите платный ресурс [Cognitive Services](https://docs.microsoft.com/azure/cognitive-services/cognitive-services-apis-create-account), созданный на уровне *S0* в одном регионе с Поиском Azure. 

  ![Создание ресурса Cognitive Services](media/knowledge-store-howto-powerbi/create-cognitive-service.png "Создание ресурса Cognitive Services")

## <a name="next-steps"></a>Дополнительная информация

Если вы хотите повторить это упражнение или выполнить инструкции из другого пошагового руководства по обогащению с помощью ИИ, удалите только что созданный индексатор *hotel-reviews-idx*. При удалении индексатора счетчик бесплатных ежедневных транзакций будет обнулен. 

Дополнительные пошаговые инструкции по работе с хранилищем знаний см. в следующей статье, в которой показано, как создать хранилище знаний с помощью REST API и Postman.

> [!div class="nextstepaction"]
> [Начало работы с хранилищем знаний](knowledge-store-howto.md)
