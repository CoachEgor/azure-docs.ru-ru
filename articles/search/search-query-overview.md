---
title: Типы запросов
titleSuffix: Azure Cognitive Search
description: Сведения о типах запросов, поддерживаемых в Когнитивный поиск, включая произвольный текст, фильтр, автозаполнение и предложения, географический поиск, системные запросы и поиск документов.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 12/09/2020
ms.openlocfilehash: d1ea2d0ba8ed5850e5d4cd9c06a0b016c4059ca7
ms.sourcegitcommit: 273c04022b0145aeab68eb6695b99944ac923465
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/10/2020
ms.locfileid: "97007863"
---
# <a name="query-types-in-azure-cognitive-search"></a>Типы запросов в Когнитивный поиск Azure

В Azure Когнитивный поиск запрос представляет собой полную спецификацию операции приема-передачи с параметрами, которые управляют выполнением запросов, а также параметрами, которые формируют ответ, поступающий обратно.

## <a name="elements-of-a-request"></a>Элементы запроса

Следующий пример представляет собой репрезентативный запрос, созданный с помощью [поисковых документов REST API](/rest/api/searchservice/search-documents). Этот пример предназначен для [демонстрационного индекса гостиниц](search-get-started-portal.md) и включает общие параметры, чтобы вы могли получить представление о том, как выглядит запрос.

```http
POST https://[service name].search.windows.net/indexes/[index name]/docs/search?api-version=[api-version]
{
    "queryType": "simple" 
    "search": "`New York` +restaurant",
    "searchFields": "Description, Address/City, Tags",
    "select": "HotelId, HotelName, Description, Rating, Address/City, Tags",
    "top": "10",
    "count": "true",
    "orderby": "Rating desc"
}
```

Запросы всегда направляются в коллекцию Documents одного индекса. Невозможно объединить индексы или создать пользовательские или временные структуры данных и указать их в качестве цели запроса.

+ **`queryType`** Задает средство синтаксического анализа, которое является либо [анализатором простого запроса по умолчанию](search-query-simple-examples.md) (оптимальным для полнотекстового поиска), либо [полным средством синтаксического анализа запросов Lucene](search-query-lucene-examples.md) , используемым для расширенных конструкций запросов, таких как регулярные выражения, поиск по сходству, нечеткий и поиск с подстановочными знаками.

+ **`search`** предоставляет критерии соответствия (обычно целые термины или фразы), но часто сопровождается логическими операторами. Запрос с одним самостоятельным термином называется запросом *термина*. Многокомпонентные запросы, заключенные в кавычки, — это запросы *фраз* . Поиск может быть неопределенным, как в **`search=*`** , но без критериев для сопоставления, результирующий набор состоит из произвольно выбранных документов.

+ **`searchFields`** ограничивает выполнение запросов конкретными полями. Для этого параметра доступно любое поле, которое является атрибутом, поддерживающим *Поиск* в схеме индекса.

Ответы также обрабатываются параметрами, включенными в запрос:

+ **`select`** Указывает, какие поля должны возвращаться в ответе. В инструкции SELECT можно использовать только те поля, которые помечены как доступные для *получения* индекса.

+ **`top`** Возвращает указанное число наиболее подходящих документов. В этом примере возвращаются только 10 обращений. Для страницы результатов можно использовать предложения TOP и Skip (не показано).

+ **`count`** Указывает, сколько документов во всем индексе соответствует общему числу, что может быть больше, чем возвращено. 

+ **`orderby`** используется, если требуется сортировать результаты по значению, например по рейтингу или расположению. В противном случае по умолчанию используется показатель релевантности для ранжирования результатов.

> [!Tip]
> Перед написанием кода можно использовать средства запросов для изучения синтаксиса и экспериментов с различными параметрами. Самый быстрый подход — встроенное средство портала, [Обозреватель поиска](search-explorer.md).
>
> Если вы припустили это [Краткое руководство, чтобы создать демонстрационный индекс гостиниц](search-get-started-portal.md), можно вставить эту строку запроса в панель поиска обозревателя, чтобы выполнить первый запрос: `search=+"New York" +restaurant&searchFields=Description, Address/City, Tags&$select=HotelId, HotelName, Description, Rating, Address/City, Tags&$top=10&$orderby=Rating desc&$count=true`

### <a name="how-field-attributes-in-an-index-determine-query-behaviors"></a>Определение поведения запросов в атрибутах полей в индексе

Проектирование индексов и проектирование запросов тесно связаны в Azure Когнитивный поиск. Здесь важно сразу понять, что именно *схема индекса* с атрибутами для каждого поля определяет, какие типы запросов вы сможете создавать. 

Атрибуты индекса задают допустимые операции для набора полей в индексе, например возможность поиска (*searchable*), извлечения (*retrievable*), сортировки (*sortable*) и фильтрации (*filterable*). В примере строки запроса `"$orderby": "Rating"` работает только потому, что поле Рейтинг помечено как *сортируемый* в схеме индекса. 

![Определение индекса для примера отеля](./media/search-query-overview/hotel-sample-index-definition.png "Определение индекса для примера отеля")

Приведенный выше снимок экрана представляет собой частичный список атрибутов индекса для примера гостиниц. Полную схему индекса вы можете изучить на портале. Дополнительные сведения об атрибутах индекса см. в статье [Create Index (Azure Search Service REST API)](/rest/api/searchservice/create-index) (Создание индекса (REST API службы "Поиск Azure")).

> [!Note]
> Некоторые функции обработки запросов включаются на уровне всего индекса, а не для отдельных полей. К таким возможностям относятся: [карты синонимов](search-synonyms.md), [пользовательские анализаторы](index-add-custom-analyzers.md), конструкции средств подбора [(для автозаполнения и предлагаемых запросов)](index-add-suggesters.md), [логика оценки для ранжирования результатов](index-add-scoring-profiles.md).

## <a name="choose-a-parser-simple--full"></a>Выберите средство синтаксического анализа: simple (простое) или full (полное)

Когнитивный поиск Azure предоставляет возможность выбора между двумя синтаксическими анализаторами запросов для обработки типичных и специализированных запросов. Запросы для простого средства синтаксического анализа должны использовать [простой синтаксис запросов](query-simple-syntax.md). Этот вариант используется по умолчанию, так как обеспечивает высокую скорость и эффективность для запросов в свободной текстовой форме. Этот синтаксис поддерживает ряд общих операторов поиска, включая AND, OR, NOT, а также фразы, суффиксы и операторы приоритета.

[Полный синтаксис запросов Lucene](query-Lucene-syntax.md#bkmk_syntax), который включается при добавлении параметра `queryType=full` в запрос, позволяет применить широко распространенный и выразительный язык запросов, разработанный в составе библиотеки [Apache Lucene](https://lucene.apache.org/core/6_6_1/queryparser/org/apache/lucene/queryparser/classic/package-summary.html). Полный синтаксис расширяет простой синтаксис. Средство полного синтаксического анализа Lucene поймет любой запрос, созданный для простого средства синтаксического анализа. 

Этот аспект демонстрируется в следующих примерах: один и тот же запрос с разными значениями параметра queryType возвращает разные результаты. В первом запросе параметр `^3` After `historic` рассматривается как часть условия поиска. Итоговый результат для этого запроса — "Маркуис за & Suite", в его описание которого есть *океанские* части.

```http
queryType=simple&search=ocean historic^3&searchFields=Description, Tags&$select=HotelId, HotelName, Tags, Description&$count=true
```

Тот же запрос, использующий полное средство синтаксического анализа Lucene, интерпретируется `^3` как повышение в поле. При переключении синтаксических анализаторов изменяется ранг, а результаты, содержащие термин с *предысторией* , перемещаются в начало.

```http
queryType=full&search=ocean historic^3&searchFields=Description, Tags&$select=HotelId, HotelName, Tags, Description&$count=true
```

<a name="types-of-queries"></a>

## <a name="types-of-queries"></a>Типы запросов

Azure Когнитивный поиск поддерживает широкий спектр типов запросов. 

| Тип запроса | Использование | Дополнительные сведения и примеры |
|------------|--------|-------------------------------|
| Текстовый поиск со свободной формой записи | Параметр поиска и любое средство синтаксического анализа| Полнотекстовый поиск позволяет найти один или несколько терминов во всех полях индекса с меткой *searchable*, примерно так же, как поисковая система Google или Bing. В примере во введении представлен именно полнотекстовый поиск.<br/><br/>Полнотекстовый поиск проходит лексическую анализ с помощью стандартного анализатора Lucene (по умолчанию). чтобы опустить все термины, удалите такие слова, как «The». По умолчанию можно переопределить [анализаторы, отличные от английской](index-add-language-analyzers.md#language-analyzer-list) , или [специализированные анализаторы, не зависящие от языка](index-add-custom-analyzers.md#AnalyzerTable) , которые изменяют лексический анализ. Например, [keyword](https://lucene.apache.org/core/6_6_1/analyzers-common/org/apache/lucene/analysis/core/KeywordAnalyzer.html) позволяет использовать все содержимое поля как один токен. Это полезно для данных некоторых типов, таких как почтовые индексы, идентификаторы и названия продуктов. | 
| Поиск с фильтрацией | [Выражение фильтра OData](query-odata-filter-orderby-syntax.md) и любое средство синтаксического анализа | Запросы фильтрации оценивают логическое выражение по всем полям индекса с меткой *filterable*. В отличие от поиска, запрос фильтрации проверяет точное содержимое поля, в том числе учитывает регистр для строковых полей. Еще одно важное различие — запросы фильтрации выражаются в синтаксисе OData. <br/>[Пример поиска с фильтрацией](search-query-simple-examples.md#example-3-filter-queries) |
| Геопространственный поиск | [Тип Edm.GeographyPoint](/rest/api/searchservice/supported-data-types) для поля, выражение фильтра и любое средство синтаксического анализа | Координаты, хранящиеся в поле с типом Edm.GeographyPoint, используются для "поиска соседних объектов" и для элементов управления со встроенными картами. <br/>[Пример поиска геообъектов](search-query-simple-examples.md#example-5-geo-search)|
| Поиск по диапазону | Выражение фильтра и средство простого синтаксического анализа | В Когнитивный поиск Azure запросы к диапазону создаются с помощью параметра Filter. <br/>[Пример фильтра по диапазону](search-query-simple-examples.md#example-4-range-filters) | 
| [Поиск по полям](query-lucene-syntax.md#bkmk_fields) | Параметр поиска и средство полного синтаксического анализа | Создайте сложное выражение запроса, предназначенное для одного поля. <br/>[Пример поиска по полям](search-query-lucene-examples.md#example-2-fielded-search) |
| [Автозаполнение или предлагаемые результаты](search-autocomplete-tutorial.md) | Параметр автозаполнения или предложения | Альтернативная форма запроса, которая выполняется на основе частичных строк в интерфейсе поиска по мере использования. Можно использовать автозаполнение и предложения вместе или отдельно. |
| [нечеткий поиск](query-lucene-syntax.md#bkmk_fuzzy) | Параметр поиска и средство полного синтаксического анализа | Находит совпадения с терминами, которые имеют сходную конструкцию или орфографию. <br/>[Пример поиска нечетких соответствий](search-query-lucene-examples.md#example-3-fuzzy-search) |
| [поиск по сходству](query-lucene-syntax.md#bkmk_proximity) | Параметр поиска и средство полного синтаксического анализа | Находит термины, которые расположены в документе рядом друг с другом. <br/>[Пример поиска с учетом расположения](search-query-lucene-examples.md#example-4-proximity-search) |
| [повышение термина](query-lucene-syntax.md#bkmk_termboost) | Параметр поиска и средство полного синтаксического анализа | Присваивает более высокий приоритет документам, которые содержат определенный термин. <br/>[Пример повышения приоритета термина](search-query-lucene-examples.md#example-5-term-boosting) |
| [Поиск регулярных выражений](query-lucene-syntax.md#bkmk_regex) | Параметр поиска и средство полного синтаксического анализа | Находит совпадения на основе содержимого регулярного выражения. <br/>[Пример поиска с использованием регулярного выражения](search-query-lucene-examples.md#example-6-regex) |
|  [Поиск с подстановочным знаком или префиксом](query-lucene-syntax.md#bkmk_wildcard) | Параметр поиска и средство полного синтаксического анализа | Находит совпадения с учетом префикса и символа тильды (`~`) или одного символа (`?`). <br/>[Пример поиска с использованием подстановочных знаков](search-query-lucene-examples.md#example-7-wildcard-search) |

## <a name="next-steps"></a>Следующие шаги

Используйте портал или другое средство, например POST или Visual Studio Code, или один из пакетов SDK для более подробного изучения запросов. Чтобы приступить к работе, необходимо ознакомиться со следующими ссылками.

+ [Обозреватель поиска](search-explorer.md)
+ [Выполнение запроса в .NET](./search-get-started-dotnet.md)
+ [Выполнение запроса в REST](./search-get-started-powershell.md)