---
title: Концепции ресурсных лесов для служб доменов Azure AD Domain (ru) Документы Майкрософт
description: Узнайте, что такое лес ресурсов в службах домена Azure Active Directory Domain Services и как они приносят пользу вашей организации в гибридной среде с ограниченными возможностями проверки подлинности пользователей или проблемами безопасности.
services: active-directory-ds
author: iainfoulds
manager: daveba
ms.service: active-directory
ms.subservice: domain-services
ms.workload: identity
ms.topic: conceptual
ms.date: 03/30/2020
ms.author: iainfou
ms.openlocfilehash: e0e5dde246dbcd5e5cb2e4ae923872a59a539d87
ms.sourcegitcommit: efefce53f1b75e5d90e27d3fd3719e146983a780
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/01/2020
ms.locfileid: "80476398"
---
# <a name="resource-forest-concepts-and-features-for-azure-active-directory-domain-services"></a>Концепции и функции ресурсов для служб доменов Active Directory

Службы домена Active Directory Domain Services (AD DS) предоставляют опыт вхождения для устаревших, корпоративных приложений. Пользователи, группы и хэши паролей пользователей-предприимчезных и облачных пользователей синхронизируются с доменом Azure AD DS. Эти синхронизированные хэши паролей дают пользователям единый набор учетных данных, которые они могут использовать для предприимчивых AD DS, Office 365 и Azure Active Directory.

Несмотря на безопасность и дополнительные преимущества в области безопасности, некоторые организации не могут синхронизировать эти хэши паролей пользователей с Azure AD или Azure AD DS. Пользователи в организации могут не знать свой пароль, потому что они используют только проверку подлинности смарт-карты. Эти ограничения не позволяют некоторым организациям использовать DS Azure AD для снятия и переноса классических приложений на помещения в Azure.

Для удовлетворения этих потребностей и ограничений можно создать управляемый dS Azure AD, в котором используется лес ресурсов. В этой концептуальной статье объясняется, что такое леса и как они доверяют другим ресурсам для обеспечения безопасного метода аутентификации. Ресурсные леса Azure AD DS в настоящее время находятся в предварительном просмотре.

> [!IMPORTANT]
> Ресурсные леса Azure AD DS в настоящее время не поддерживают файлы Azure HDInsight или Azure. Леса пользователя Azure AD DS по умолчанию поддерживают обе эти дополнительные службы.

## <a name="what-are-forests"></a>Что такое леса?

*Лес* — это логическая конструкция, используемая службами доменов Active Directory Domain Services (AD DS) для группы одного или нескольких *доменов.* Затем домены хранят объекты для пользователей или групп и предоставляют услуги аутентификации.

В Azure AD DS лес содержит только один домен. В помещениях AD DS леса часто содержат много доменов. В крупных организациях, особенно после слияний и поглощений, вы можете в конечном итоге с несколькими на территории леса, которые каждый затем содержат несколько доменов.

По умолчанию управляемый dS-домен Azure AD создается как лес *пользователя.* Лес этого типа синхронизирует все объекты из Azure AD, включая учетные записи пользователей, созданные в локальной среде AD DS. Учетные записи пользователей могут напрямую аутентифицироваться на домене Azure AD DS, например, для вступления в vM, объединенный доменом. Лес пользователя работает, когда хэши паролей могут быть синхронизированы и пользователи не используют эксклюзивные методы регистрации, такие как проверка подлинности смарт-карт.

В *лесном* массиве ресурсов Azure AD DS пользователи удостоверяют подлинность в отношении одностороннего лесного *траста* из своего собственного AD DS. При таком подходе объекты пользователя и хэши паролей не синхронизируются с Azure AD DS. Объекты пользователя и учетные данные существуют только в предварительном AD DS. Такой подход позволяет предприятиям размещать ресурсы и прикладные платформы в Azure, которые зависят от классической аутентификации, таких как LDAPS, Kerberos или NTLM, но любые проблемы проверки подлинности или проблемы удаляются. Ресурсные леса Azure AD DS в настоящее время находятся в предварительном просмотре.

Ресурсные леса также предоставляют возможность поднимать и сдвигать приложения по одному компоненту за раз. Многие устаревшие приложения являются многоуровневыми, часто используя веб-сервер или переднюю часть и многие компоненты, связанные с базами данных. Эти уровни затруднив подъем и перенос всего приложения в облако за один шаг. С помощью ресурсов можно переставить приложение в облако поэтапно, что упрощает перемещение приложения в Azure.

## <a name="what-are-trusts"></a>Что такое трасты?

Организациям, которые имеют более одного домена, часто требуются пользователи для доступа к общим ресурсам в другом домене. Доступ к этим общим ресурсам требует, чтобы пользователи в одном домене были проверены на другой домен. Чтобы обеспечить эти возможности аутентификации и авторизации между клиентами и серверами в разных доменах, между двумя доменами должно быть *доверие.*

С доверием доменов механизмы аутентификации для каждого домена доверяют аутентификациям, поступающим из другого домена. Трасты помогают обеспечить контролируемый доступ к общим ресурсам в домене ресурсов *(доверительном* домене), проверяя, что входящие запросы на проверку подлинности поступают от доверенного органа *(доверенного* домена). Трасты выступают в качестве мостов, позволяющих только проверить запросы на проверку подлинности для перемещения между доменами.

Способ обработки запросов на аутентификацию траста зависит от того, как он настроен. Трасты могут быть настроены одним из следующих способов:

* **One-way** - обеспечивает доступ от доверенного домена к ресурсам в доверительном домене.
* **Двусторонний** - обеспечивает доступ от каждого домена к ресурсам в другом домене.

Трасты также настроены для обработки дополнительных доверительных отношений одним из следующих способов:

* **Нетранзитный** - Доверие существует только между двумя доменами траст-партнера.
* **Transitive** - Trust автоматически распространяется на любые другие домены, которым доверяет любой из партнеров.

В некоторых случаях доверительные отношения автоматически устанавливаются при создании доменов. В других случаях необходимо выбрать тип доверия и четко установить соответствующие отношения. Конкретные типы используемых трастов и структура этих доверительных отношений зависят от того, как организована служба каталога Active Directory и сосуществуют ли в сети различные версии Windows.

## <a name="trusts-between-two-forests"></a>Доверия между двумя лесами

Вы можете расширить доменные трасты в пределах одного леса в другой лес, вручную создав одностороннее или двустороннее лесное доверие. Лесной траст — это транзитивное доверие, которое существует только между корневым доменом леса и вторым доменом корня лесов.

* Доверие к лесам с односторонним односторонним способом позволяет всем пользователям в одном лесу доверять всем областям в другом лесу.
* Двустороннее доверие к лесам формирует переходную доверительную связь между всеми областными областями в обоих лесах.

Транзитистость лесных трастов ограничивается двумя лесными партнерами. Лесной траст не распространяется на дополнительные леса, которым доверяет ни один из партнеров.

![Диаграмма лесного траста от Azure AD DS до находинного AD DS](./media/concepts-resource-forest/resource-forest-trust-relationship.png)

Можно создавать различные конфигурации доверительного управления доменов и лесов в зависимости от структуры Active Directory организации. Azure AD DS поддерживает только одностороннее доверие к лесам. В этой конфигурации ресурсы Azure AD DS могут доверять всем доменам в припредре.

## <a name="supporting-technology-for-trusts"></a>Поддержка технологии для трастов

Трасты используют различные службы и функции, такие как DNS, чтобы найти контроллеры доменов в партнерских лесах. Трасты также зависят от протоколов проверки подлинности NTLM и Kerberos, а также от механизмов авторизации и контроля доступа на базе Windows, которые помогут обеспечить защищенную инфраструктуру связи в областях Active Directory и лесах. Следующие службы и функции помогают поддерживать успешные доверительные отношения.

### <a name="dns"></a>DNS

AD DS нуждается в DNS для расположения и именования контроллера домена (DC). Следующая поддержка от DNS предоставляется для AD DS для успешной работы:

* Служба разрешения имен, которая позволяет сети хостов и служб для поиска DC.
* Структура именования, позволяющая предприятию отражать свою организационную структуру в названиях доменов служб каталогов.

Обычно развертывается пространство доменных имен DNS, которое отражает пространство доменных имен AD DS. Если перед развертыванием AD DS имеется существующее пространство имен DNS, то пространство имен DNS обычно разделено для Active Directory, и создается поддомен DNS и делегирование для корневой тропины. Дополнительные доменные имена DNS добавляются для каждого детского домена Active Directory.

DNS также используется для поддержки расположения CS Active Directory. Зоны DNS заполнены записями ресурсов DNS, которые позволяют узлам сети и службам находить dCs Active Directory.

### <a name="applications-and-net-logon"></a>Приложения и Чистый Логон

Оба приложения и служба Net Logon являются компонентами модели каналов распределенного канала безопасности Windows. Приложения, интегрированные с Windows Server и Active Directory, используют протоколы аутентификации для связи с службой Net Logon, чтобы можно было установить защищенный путь, по которому может произойти аутентификация.

### <a name="authentication-protocols"></a>Протоколы проверки подлинности

С Помощью одного из следующих протоколов, использующих DCs Active Directory, проверяетподлинность пользователей и приложений:

* **Протокол аутентификации версии 5 Kerberos**
    * Протокол Kerberos version 5 — это протокол проверки подлинности по умолчанию, используемый на работе компьютеров с Windows и поддерживающими сторонние операционные системы. Этот протокол указан в RFC 1510 и полностью интегрирован с Active Directory, блоком сообщений серверов (SMB), HTTP и удаленным вызовом процедуры (RPC), а также клиентскими и серверными приложениями, которые используют эти протоколы.
    * При использовании протокола Kerberos серверу не нужно связываться с dc. Вместо этого клиент получает билет на сервер, запрашивая его у постоянного тока в домене серверного счета. Затем сервер проверяет билет, не посоветовавшись с каким-либо другим органом.
    * Если какой-либо компьютер, участвующий в транзакции, не поддерживает протокол версии 5 Kerberos, используется протокол NTLM.

* **Протокол проверки подлинности NTLM**
    * Протокол NTLM является классическим протоколом проверки подлинности сети, используемым старыми операционными системами. По причинам совместимости он используется доменами Active Directory для обработки запросов на аутентификацию сетей, которые поступают из приложений, предназначенных для более ранних клиентов и серверов Windows, а также сторонних операционных систем.
    * Когда протокол NTLM используется между клиентом и сервером, сервер должен связаться со службой аутентификации домена в dc для проверки учетных данных клиента. Сервер проверяет подлинность клиента, перенаправив учетные данные клиента в dc в домене счета клиента.
    * Когда два домена Active Directory или леса соединены трастом, запросы на проверку подлинности, сделанные с помощью этих протоколов, могут быть направлены для обеспечения доступа к ресурсам в обоих лесах.

## <a name="authorization-and-access-control"></a>Проверка подлинности и управление доступом

Технологии авторизации и доверия работают вместе, чтобы обеспечить защищенную инфраструктуру связи в различных областях Active Directory или лесах. Авторизация определяет, какой уровень доступа пользователя к ресурсам в домене. Доверия облегчают авторизацию пользователей по перекрестному домену, предоставляя путь для проверки подлинности пользователей в других областях, чтобы их запросы на общие ресурсы в этих доменах могли быть авторизованы.

Когда запрос на проверку подлинности, сделанный в доверительном домене, проверяется доверенным доменом, он передается целевому ресурсу. Затем целевой ресурс определяет, следует ли авторизовать конкретный запрос, сделанный пользователем, службой или компьютером в надежном домене на основе конфигурации управления доступом.

Трасты предоставляют этот механизм для проверки запросов на аутентификацию, которые передаются в доверительный домен. Механизмы управления доступом на ресурсном компьютере определяют окончательный уровень доступа, предоставленного запрашиванию в надежном домене.

## <a name="next-steps"></a>Следующие шаги

Подробнее о трастах читайте в рекламе [AD DS Azure AD?][concepts-trust]

Чтобы начать работу с созданием домена Azure AD DS, управляемого ресурсами, [см. Создать и настроить домена Azure AD DS, управляемый DS.][tutorial-create-advanced] Затем можно [создать исходящий лесной траст в домене (предварительный просмотр).][create-forest-trust]

<!-- LINKS - INTERNAL -->
[concepts-trust]: concepts-forest-trust.md
[tutorial-create-advanced]: tutorial-create-instance-advanced.md
[create-forest-trust]: tutorial-create-forest-trust.md
