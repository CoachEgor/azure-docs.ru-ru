---
title: Основные понятия леса ресурсов для доменных служб Azure AD | Документация Майкрософт
description: Узнайте, что такое лес ресурсов в Azure Active Directory доменных служб, и как они используют вашу организацию в гибридной среде с ограниченными параметрами проверки подлинности пользователей или вопросами безопасности.
services: active-directory-ds
author: iainfoulds
manager: daveba
ms.service: active-directory
ms.subservice: domain-services
ms.workload: identity
ms.topic: conceptual
ms.date: 11/19/2019
ms.author: iainfou
ms.openlocfilehash: a583e32cbc3d58d5dfc5616335b2f38ad20fac14
ms.sourcegitcommit: d6b68b907e5158b451239e4c09bb55eccb5fef89
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/20/2019
ms.locfileid: "74233614"
---
# <a name="resource-forest-concepts-and-features-for-azure-active-directory-domain-services"></a>Основные понятия и функции леса ресурсов для Azure Active Directory доменных служб

Azure Active Directory доменных служб (AD DS) предоставляет возможность входа для устаревших локальных бизнес-приложений. Пользователи, группы и хэши паролей локальных и облачных пользователей синхронизируются с управляемым доменом AD DS Azure. Эти синхронизированные хэши паролей дают пользователям единый набор учетных данных, которые они могут использовать для локальных AD DS, Office 365 и Azure Active Directory.

Хотя безопасность и предоставляет дополнительные преимущества безопасности, некоторые организации не могут синхронизировать эти хэши паролей пользователей с Azure AD или Azure AD DS. Пользователи в организации могут не иметь сведений о пароле, так как они используют только проверку подлинности с помощью смарт-карты. Эти ограничения не позволяют некоторым организациям использовать AD DS Azure для переноса и смены локальных классических приложений в Azure.

Для решения этих задач и ограничений можно создать управляемый домен Azure AD DS, использующий лес ресурсов. В этой концептуальной статье объясняется, что представляют собой леса и как они доверяют другим ресурсам, чтобы обеспечить безопасный метод проверки подлинности. В настоящее время доступны предварительные версии лесов ресурсов Azure AD DS.

> [!IMPORTANT]
> В настоящее время лес ресурсов Azure AD DS не поддерживает Azure HDInsight или службы файлов Azure. По умолчанию пользовательские леса AD DS Azure поддерживают обе эти дополнительные службы.

## <a name="what-are-forests"></a>Что такое леса?

*Лес* — это логическая конструкция, используемая службами домен Active Directory Services (AD DS) для группирования одного или нескольких *доменов*. Затем домены сохраняют объекты для пользователей или групп и предоставляют службы проверки подлинности.

В AD DS Azure лес содержит только один домен. Локальные AD DSные леса часто содержат много доменов. В больших организациях, особенно после слияния и приобретения, вы можете получить несколько локальных лесов, каждый из которых будет содержать несколько доменов.

По умолчанию управляемый домен Azure AD DS создается в качестве леса *пользователя* . Лес этого типа синхронизирует все объекты из Azure AD, включая учетные записи пользователей, созданные в локальной среде AD DS. Учетные записи пользователей могут напрямую проходить проверку подлинности в управляемом домене Azure AD DS, например для входа в виртуальную машину, присоединенную к домену. Пользовательский лес работает, когда хэши паролей могут быть синхронизированы, и пользователи не используют эксклюзивные методы входа, такие как проверка подлинности с помощью смарт-карты.

В лесу *ресурсов* Azure AD DS пользователи проходят проверку подлинности одностороннего *доверия* между лесами из локальной AD DS. При таком подходе пользовательские объекты и хэши паролей не синхронизируются с Azure AD DS. Пользовательские объекты и учетные данные существуют только в локальной AD DS. Такой подход позволяет предприятиям размещать ресурсы и платформы приложений в Azure, которые зависят от классической проверки подлинности, таких как LDAPs, Kerberos или NTLM, но все проблемы проверки подлинности или неполадки удаляются. В настоящее время доступны предварительные версии лесов ресурсов Azure AD DS.

Леса ресурсов также предоставляют возможность переноса и сдвига приложений по одному компоненту за раз. Многие устаревшие локальные приложения являются многоуровневые, часто используют веб-сервер или внешний интерфейс и многие компоненты, связанные с базами данных. Эти уровни затруднить перемещение всего приложения в облако за один шаг. С помощью лесов ресурсов вы можете переносить приложение в облако в поэтапном подходе, что упрощает перенос приложения в Azure.

## <a name="what-are-trusts"></a>Что такое отношения доверия?

Организациям, имеющим более одного домена, часто требуется доступ пользователей к общим ресурсам в другом домене. Для доступа к этим общим ресурсам пользователи в одном домене должны пройти проверку подлинности в другом домене. Чтобы обеспечить эти возможности проверки подлинности и авторизации между клиентами и серверами в разных доменах, необходимо *отношение доверия* между двумя доменами.

При использовании доверительных отношений между доменами механизмы проверки подлинности для каждого домена доверяют проверки подлинности, поступающие из другого домена. Отношения доверия обеспечивают управляемый доступ к общим ресурсам в домене ресурсов ( *доверяющем* домене), проверяя, что входящие запросы на аутентификацию поступают из доверенного центра ( *доверенного* домена). Отношения доверия действуют как мосты, которые позволяют пропускать проверенные запросы проверки подлинности между доменами.

Способ, которым доверие передает запросы на проверку подлинности, зависит от того, как он настроен. Отношения доверия можно настроить одним из следующих способов:

* **Односторонний** — обеспечивает доступ из доверенного домена к ресурсам в доверяющем домене.
* **Двусторонний** — обеспечивает доступ из каждого домена к ресурсам в другом домене.

Отношения доверия также настроены на обработку дополнительных отношений доверия одним из следующих способов:

* **Нетранзитивное** — доверие существует только между двумя доверенными доменами партнеров.
* **Транзитивное** доверие автоматически распространяется на любые другие домены, которым доверяет любой из партнеров.

В некоторых случаях отношения доверия автоматически устанавливаются при создании доменов. В других случаях необходимо выбрать тип доверия и явно установить соответствующие связи. Конкретные типы отношений доверия и структура этих отношений доверия зависят от того, как организована служба Active Directory Directory и различаются ли разные версии Windows в сети.

## <a name="trusts-between-two-forests"></a>Отношения доверия между двумя лесами

Вы можете расширить доверительные отношения доменов в пределах одного леса на другой лес, вручную создав одностороннее или двустороннее доверие лесов. Доверие лесов — это транзитивное отношение доверия, которое существует только между корневым доменом леса и вторым корневым доменом леса.

* Одностороннее доверие лесов позволяет всем пользователям в одном лесу доверять всем доменам в другом лесу.
* Двустороннее доверие лесов образует транзитивное отношение доверия между всеми доменами в обоих лесах.

Транзитивность доверия лесов ограничено двумя партнерами леса. Доверие лесов не распространяется на дополнительные леса, которые являются доверенными для одного из участников.

![Схема доверия лесов из AD DS Azure к локальной AD DS](./media/concepts-resource-forest/resource-forest-trust-relationship.png)

Можно создать различные конфигурации доверия домена и леса в зависимости от структуры Active Directory организации. AD DS Azure поддерживает только односторонние отношения доверия лесов. В этой конфигурации ресурсы в AD DS Azure могут доверять всем доменам в локальном лесу.

## <a name="supporting-technology-for-trusts"></a>Поддержка технологии для отношений доверия

Отношения доверия используют различные службы и функции, такие как DNS, для размещения контроллеров домена в партнерских лесах. Отношения доверия также зависят от протоколов проверки подлинности NTLM и Kerberos и механизмов управления доступом и авторизации на основе Windows, чтобы обеспечить безопасную инфраструктуру связи в Active Directory доменах и лесах. Следующие службы и компоненты помогают поддерживать успешные доверительные отношения.

### <a name="dns"></a>DNS

AD DS требуется DNS для расположения и именования контроллера домена. Для успешной работы AD DS предоставлена следующая поддержка DNS:

* Служба разрешения имен, которая позволяет сетевым узлам и службам размещать контроллеры домена.
* Структура именования, которая позволяет Организации отражать организационную структуру в именах доменов службы каталогов.

Обычно развертывается пространство имен домена DNS, отражающее AD DS пространство имен домена. Если перед развертыванием AD DS существует существующее пространство имен DNS, пространство имен DNS обычно секционируется для Active Directory, а также создается поддомен DNS и делегирование для корня леса Active Directory. Затем добавляются дополнительные доменные имена DNS для каждого Active Directory дочернего домена.

DNS также используется для поддержки расположения Active Directory контроллеров домена. Зоны DNS заполняются записями ресурсов DNS, которые позволяют узлам и службам сети разрешать обнаружение Active Directory контроллеров домена.

### <a name="applications-and-net-logon"></a>Приложения и Net Logon

Оба приложения и служба сетевого входа в систему являются компонентами модели распределенного канала безопасности Windows. Приложения, интегрированные с Windows Server и Active Directory используют протоколы проверки подлинности для взаимодействия со службой сетевого входа в систему, чтобы можно было установить защищенный путь, который может быть установлен для проверки подлинности.

### <a name="authentication-protocols"></a>Протоколы проверки подлинности

Active Directory DCs проверяет подлинность пользователей и приложений с помощью одного из следующих протоколов:

* **Протокол проверки подлинности Kerberos версии 5**
    * Протокол Kerberos версии 5 является протоколом проверки подлинности по умолчанию, используемым локальными компьютерами под управлением Windows и поддерживающими операционные системы сторонних производителей. Этот протокол указан в RFC 1510 и полностью интегрирован с Active Directory, SMB, HTTP и удаленным вызовом процедур (RPC), а также клиентскими и серверными приложениями, использующими эти протоколы.
    * Если используется протокол Kerberos, серверу не нужно обращаться к контроллеру домена. Вместо этого клиент получает билет для сервера, запрашивая его у контроллера домена в домене учетной записи сервера. Затем сервер проверяет билет без консультации с другими центрами.
    * Если любой компьютер, вовлеченный в транзакцию, не поддерживает протокол Kerberos версии 5, используется протокол NTLM.

* **Протокол проверки подлинности NTLM**
    * Протокол NTLM — это классический сетевой протокол проверки подлинности, используемый в старых операционных системах. В целях совместимости он используется Active Directory доменами для обработки запросов проверки подлинности сети, поступающих из приложений, предназначенных для более ранних клиентов и серверов под управлением Windows, и операционных систем сторонних производителей.
    * Если между клиентом и сервером используется протокол NTLM, сервер должен обратиться к службе проверки подлинности домена на КОНТРОЛЛЕРе домена, чтобы проверить учетные данные клиента. Сервер выполняет проверку подлинности клиента, пересылая учетные данные клиента КОНТРОЛЛЕРу домена в домене учетной записи клиента.
    * При соединении доверия между двумя Active Directory доменами или лесами запросы на проверку подлинности, созданные с помощью этих протоколов, можно маршрутизировать для предоставления доступа к ресурсам в обоих лесах.

## <a name="authorization-and-access-control"></a>Проверка подлинности и управление доступом

Технологии авторизации и доверия работают совместно, чтобы обеспечить безопасную инфраструктуру связи в Active Directory доменах или лесах. Авторизация определяет уровень доступа пользователя к ресурсам в домене. Отношения доверия упрощают междоменную авторизацию пользователей, предоставляя путь для проверки подлинности пользователей в других доменах, чтобы их запросы к общим ресурсам в этих доменах могли быть авторизованы.

Когда запрос на проверку подлинности, сделанный в доверяющем домене, проверяется доверенным доменом, он передается целевому ресурсу. Затем целевой ресурс определяет, следует ли авторизовать конкретный запрос, сделанный пользователем, службой или компьютером в доверенном домене, на основе его конфигурации контроля доступа.

Отношения доверия обеспечивают этот механизм для проверки запросов проверки подлинности, передаваемых в доверяющий домен. Механизмы управления доступом на компьютере ресурса определяют окончательный уровень доступа, предоставленный запрашивающему пользователю в доверенном домене.

## <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения о доверии см [. в разделе как работают отношения доверия лесов в Azure AD DS?][concepts-trust]

Чтобы приступить к созданию управляемого домена Azure AD DS с помощью леса ресурсов, см. статью [Создание и Настройка управляемого домена AD DS Azure][tutorial-create-advanced]. Затем можно [создать исходящее доверие лесов для локального домена (Предварительная версия)][create-forest-trust].

<!-- LINKS - INTERNAL -->
[concepts-trust]: concepts-forest-trust.md
[tutorial-create-advanced]: tutorial-create-instance-advanced.md
[create-forest-trust]: tutorial-create-forest-trust.md
