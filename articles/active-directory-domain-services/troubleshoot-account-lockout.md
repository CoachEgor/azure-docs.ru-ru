---
title: Блокировка учетной записи по устранению неполадок в службах домена Azure AD (ru) Документы Майкрософт
description: Узнайте, как устранить распространенные проблемы, из-за которых учетные записи пользователей будут заблокированы в службах домена Active Directory.
services: active-directory-ds
author: iainfoulds
manager: daveba
ms.service: active-directory
ms.subservice: domain-services
ms.workload: identity
ms.topic: troubleshooting
ms.date: 10/02/2019
ms.author: iainfou
ms.openlocfilehash: 2e274aa353f6c3e485ae10a6a67ee2940eb88b08
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80246326"
---
# <a name="troubleshoot-account-lockout-problems-with-an-azure-ad-domain-services-managed-domain"></a>Проблемы блокировки учетной записи с доменом Azure AD Domain

Чтобы предотвратить неоднократные попытки вредоносного вступления в систему, Azure AD DS блокирует учетные записи после определенного порога. Блокировка учетной записи также может произойти случайно без инцидента с атакой. Например, если пользователь неоднократно вводит неправильный пароль или служба пытается использовать старый пароль, учетная запись заблокирована.

В этой статье, связанной с устранением неполадок, описывается, почему происходят блокировки учетных записей и как можно настроить поведение, и как просмотреть аудит безопасности для устранения неполадок.

## <a name="what-is-an-account-lockout"></a>Что такое блокировка учетной записи?

Учетная запись пользователя в Azure AD DS заблокирована при соблюдении определенного порога для неудачных попыток входной связи. Такое поведение блокировки учетной записи предназначено для защиты от неоднократных попыток входной системы грубой силы, которые могут указывать на автоматизированную цифровую атаку.

**По умолчанию, если есть 5 неудачных попыток пароля в течение 2 минут, учетная запись заблокирована в течение 30 минут.**

Пороги блокировки учетной записи по умолчанию настраиваются с использованием мелкозернистой политики паролей. Если у вас есть определенный набор требований, можно переопределить эти пороги блокировки учетной записи по умолчанию. Тем не менее, не рекомендуется увеличивать пороговые пределы, чтобы попытаться уменьшить блокировку учетных записей. Сначала устранение проблем с источником поведения блокировки учетной записи.

### <a name="fine-grained-password-policy"></a>Политика тонкозернистого пароля

Политики в отношении готовых паролей (FGPP) позволяют применять определенные ограничения для политики блокировки паролей и учетных записей для разных пользователей в домене. FGPP влияет только на пользователей, созданных в Azure AD DS. Облачные пользователи и пользователи доменов, синхронизированные с управляемым доменом Azure AD DS из Azure AD, не подвержены влиянию политик и средств паролей.

Политики распределяются через групповую ассоциацию в домене Azure AD DS, и любые внесенные изменения применяются при следующем входе пользователя. Изменение политики не открывает учетную запись пользователя, которая уже заблокирована.

Для получения дополнительной информации о мелкозернистых политиках паролей [см.][configure-fgpp]

## <a name="common-account-lockout-reasons"></a>Общие причины блокировки учетной записи

Наиболее распространенные причины блокировки учетной записи без каких-либо злонамеренных намерений или факторов включают следующие сценарии:

* **Пользователь заперся.**
    * После недавнего изменения пароля, продолжает ли пользователь использовать предыдущий пароль? Политика блокировки учетной записи по умолчанию, в течение 5 неудачных попыток за 2 минуты, может быть вызвана непреднамеренной попыткой пользователя старого пароля.
* **Есть приложение или служба со старым паролем.**
    * Если учетная запись используется приложениями или службами, эти ресурсы могут неоднократно пытаться войти в систему с помощью старого пароля. Такое поведение приводит к блокировке учетной записи.
    * Постарайтесь свести к минимуму использование учетной записи в нескольких различных приложениях или службах и записать, где используются учетные данные. Если пароль учетной записи изменен, обновите связанные приложения или службы соответствующим образом.
* **Пароль был изменен в другой среде, и новый пароль еще не синхронизирован.**
    * Если пароль учетной записи изменен за пределами Azure AD DS, например, в среде on-prem AD DS, синхронизация изменения пароля через Azure AD и в Azure AD DS может занять несколько минут.
    * Пользователь, который пытается войти в ресурс через Azure AD DS до завершения процесса синхронизации паролей, приводит к блокировке учетной записи.

## <a name="troubleshoot-account-lockouts-with-security-audits"></a>Блокировка учетных записей с аудитом безопасности

Чтобы устранить неполадки при возникновении событий блокировки учетных записей и откуда они берутся, [включите аудит безопасности для Azure AD DS.][security-audit-events] События аудита фиксируются только с момента включения функции. В идеале следует включить аудит безопасности *до возникновения* проблемы блокировки учетной записи для устранения неполадок. Если в учетной записи пользователя неоднократно возникают проблемы с блокировкой, можно включить аудит безопасности, готовый к следующему моменту возникновения ситуации.

После того как вы включили аудит безопасности, следующие примеры запросов показывают вам, как просмотреть *события блокировки учетной записи,* код *4740*.

Просмотр всех событий блокировки учетной записи за последние семь дней:

```Kusto
AADDomainServicesAccountManagement
| where TimeGenerated >= ago(7d)
| where OperationName has "4740"
```

Просмотр всех событий блокировки учетной записи за последние семь дней для учетной записи под названием *driley*.

```Kusto
AADDomainServicesAccountLogon
| where TimeGenerated >= ago(7d)
| where OperationName has "4740"
| where "driley" == tolower(extract("Logon Account:\t(.+[0-9A-Za-z])",1,tostring(ResultDescription)))
```

Посмотреть все события блокировки учетной записи между 26 июня 2019 в 9 утра. и 1 июля 2019 полночь, отсортированная восходящая по дате и времени:

```Kusto
AADDomainServicesAccountManagement
| where TimeGenerated >= datetime(2019-06-26 09:00) and TimeGenerated <= datetime(2019-07-01)
| where OperationName has "4740"
| sort by TimeGenerated asc
```

## <a name="next-steps"></a>Дальнейшие действия

Для получения дополнительной информации о мелкозернистых политиках [Configure password and account lockout policies][configure-fgpp]паролей для корректировки пороговых значений блокировки учетных записей см.

Если у вас по-прежнему возникли проблемы с присоединением ВМ к домену Azure AD DS, [найдите справку и откройте билет поддержки для Active Directory Azure.][azure-ad-support]

<!-- INTERNAL LINKS -->
[configure-fgpp]: password-policy.md
[security-audit-events]: security-audit-events.md
[azure-ad-support]: ../active-directory/fundamentals/active-directory-troubleshooting-support-howto.md
