---
title: Устранение неполадок блокировки учетных записей в доменных службах Azure AD | Документация Майкрософт
description: Узнайте, как устранять распространенные проблемы, приводящие к блокировке учетных записей пользователей в доменных службах Azure Active Directory.
services: active-directory-ds
author: iainfoulds
manager: daveba
ms.service: active-directory
ms.subservice: domain-services
ms.workload: identity
ms.topic: troubleshooting
ms.date: 04/06/2020
ms.author: iainfou
ms.openlocfilehash: 7d2e22804c06f589c7990bf8f19319b897363a93
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "80743454"
---
# <a name="troubleshoot-account-lockout-problems-with-an-azure-ad-domain-services-managed-domain"></a>Устранение неполадок с блокировкой учетной записи в управляемом домене доменных служб Azure AD

Чтобы предотвратить повторные попытки вредоносного входа, Azure AD DS блокирует учетные записи после определенного порогового значения. Блокировка учетной записи также может произойти случайным образом без атаки на систему. Например, если пользователь многократно вводит неправильный пароль или служба пытается использовать старый пароль, учетная запись блокируется.

В этой статье приведены сведения об устранении блокировки учетной записи и способах настройки поведения, а также о том, как просматривать Аудиты безопасности для устранения неполадок в событиях блокировки.

## <a name="what-is-an-account-lockout"></a>Что такое блокировка учетной записи?

Учетная запись пользователя в Azure AD DS заблокирована, если достигнуто заданное пороговое значение неудачных попыток входа. Это поведение блокировки учетной записи предназначено для защиты от повторных попыток входа методом подбора, которые могут указывать на автоматическую цифровую атаку.

**По умолчанию при наличии 5 попыток ввода пароля в течение 2 минут учетная запись блокируется в течение 30 минут.**

Пороговые значения блокировки учетной записи по умолчанию настраиваются с использованием детальной политики паролей. При наличии определенного набора требований можно переопределить эти пороговые значения блокировки по умолчанию. Однако не рекомендуется увеличивать пределы пороговых значений, чтобы сократить число блокировок учетной записи. Сначала устраните неполадки с источником блокировки учетной записи.

### <a name="fine-grained-password-policy"></a>Детализированная политика паролей

Детализированные политики паролей (Фгппс) позволяют применять определенные ограничения для политик блокировки паролей и учетных записей для разных пользователей в домене. ФГПП влияет только на пользователей в управляемом домене Azure AD DS. Пользователи облака и пользователи домена, синхронизированные в управляемый домен AD DS Azure из Azure AD, затрагиваются только политиками паролей в Azure AD DS. Их учетные записи в Azure AD или в локальном каталоге не затрагиваются.

Политики распространяются с помощью сопоставления групп в управляемом домене Azure AD DS, а все вносимые изменения применяются при следующем входе пользователя в систему. Изменение политики не разблокирует уже заблокированную учетную запись пользователя.

Дополнительные сведения о детализированных политиках паролей и различиях между пользователями, созданными непосредственно в Azure AD DS а также с помощью синхронизации в Azure AD, см. в статье [Настройка политик блокировки паролей и учетных записей][configure-fgpp].

## <a name="common-account-lockout-reasons"></a>Общие причины блокировки учетной записи

Наиболее распространенные причины блокировки учетной записи без вредоносных целей или факторов включают в себя следующие сценарии.

* **Пользователь заблокировался.**
    * После последнего изменения пароля пользователь продолжает использовать предыдущий пароль? Политика блокировки учетных записей по умолчанию, 5 неудачных попыток в течение 2 минут, может быть вызвана непреднамеренной попыткой пользователя повторить старый пароль.
* **Существует приложение или служба со старым паролем.**
    * Если учетная запись используется приложениями или службами, эти ресурсы могут многократно пытаться войти, используя старый пароль. Такое поведение приводит к блокировке учетной записи.
    * Старайтесь не использовать учетную запись в нескольких разных приложениях или службах и записываете, где используются учетные данные. Если пароль учетной записи изменен, соответствующим образом обновите соответствующие приложения или службы.
* **Пароль был изменен в другой среде, а новый пароль еще не синхронизирован.**
    * Если пароль учетной записи изменяется за пределами Azure AD DS, например в локальной среде AD DS, для синхронизации паролей через Azure AD и Azure AD DS может потребоваться несколько минут.
    * Пользователь, который пытается войти в ресурс с помощью AD DS Azure до завершения процесса синхронизации паролей, приводит к блокировке учетной записи.

## <a name="troubleshoot-account-lockouts-with-security-audits"></a>Устранение неполадок с блокировкой учетных записей с аудитом безопасности

Чтобы устранить неполадки при возникновении событий блокировки учетной записи и о том, откуда они поступают, [включите аудит безопасности для Azure AD DS][security-audit-events]. События аудита фиксируются только с момента включения функции. В идеале следует включить аудит безопасности, *чтобы устранить* неполадки с блокировкой учетной записи. Если у учетной записи пользователя возникают проблемы с блокировкой, можно включить аудит безопасности в следующий раз, когда произойдет такая ситуация.

После включения аудита безопасности в следующих примерах запросов показано, как просмотреть *события блокировки учетной записи*, код *4740*.

Просмотреть все события блокировки учетной записи за последние семь дней:

```Kusto
AADDomainServicesAccountManagement
| where TimeGenerated >= ago(7d)
| where OperationName has "4740"
```

Просмотрите все события блокировки учетной записи за последние семь дней для учетной записи с именем *дрилэй*.

```Kusto
AADDomainServicesAccountLogon
| where TimeGenerated >= ago(7d)
| where OperationName has "4740"
| where "driley" == tolower(extract("Logon Account:\t(.+[0-9A-Za-z])",1,tostring(ResultDescription)))
```

Просмотр всех событий блокировки учетной записи между 26 июня, 2019 в 9:00 и 1 июля 2019 полночь, отсортировано по возрастанию на дату и время:

```Kusto
AADDomainServicesAccountManagement
| where TimeGenerated >= datetime(2019-06-26 09:00) and TimeGenerated <= datetime(2019-07-01)
| where OperationName has "4740"
| sort by TimeGenerated asc
```

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о детализированных политиках паролей для настройки порогов блокировки учетной записи см. в разделе [Настройка политик блокировки паролей и учетных записей][configure-fgpp].

Если у вас по-прежнему возникли проблемы при присоединении виртуальной машины к управляемому домену Azure AD DS, [найдите справку и откройте запрос в службу поддержки для Azure Active Directory][azure-ad-support].

<!-- INTERNAL LINKS -->
[configure-fgpp]: password-policy.md
[security-audit-events]: security-audit-events.md
[azure-ad-support]: ../active-directory/fundamentals/active-directory-troubleshooting-support-howto.md
