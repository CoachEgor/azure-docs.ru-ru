---
title: Доменные службы Azure Active Directory. Включение ограниченного делегирования Kerberos | Документация Майкрософт
description: Включение ограниченного делегирования Kerberos в управляемых доменах доменных служб Azure Active Directory
services: active-directory-ds
documentationcenter: ''
author: MikeStephens-MS
manager: daveba
editor: curtand
ms.assetid: 938a5fbc-2dd1-4759-bcce-628a6e19ab9d
ms.service: active-directory
ms.subservice: domain-services
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 05/13/2019
ms.author: mstephen
ms.openlocfilehash: 287aea990664cf01caf83e1871acf69e48210226
ms.sourcegitcommit: 509e1583c3a3dde34c8090d2149d255cb92fe991
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/27/2019
ms.locfileid: "66246169"
---
# <a name="configure-kerberos-constrained-delegation-kcd-on-a-managed-domain"></a>Настройка ограниченного делегирования Kerberos в управляемом домене
Многим приложениям требуется доступ к ресурсам в контексте пользователя. Active Directory поддерживает делегирование Kerberos — механизм, который позволяет использовать эту возможность. Кроме того, делегирование можно ограничить, чтобы разрешить доступ в контексте пользователя только к определенным ресурсам. Управляемые домены доменных служб Azure AD отличаются от традиционных доменов Active Directory, поскольку они безопаснее заблокированы.

В этой статье показано, как настроить ограниченное делегирование Kerberos в управляемом домене доменных служб Azure AD.

[!INCLUDE [active-directory-ds-prerequisites.md](../../includes/active-directory-ds-prerequisites.md)]

## <a name="kerberos-constrained-delegation-kcd"></a>Ограниченное делегирование Kerberos
Делегирование Kerberos позволяет учетной записи олицетворять другой субъект безопасности (например, пользователя) для доступа к ресурсам. Рассмотрим веб-приложение, которое обращается к серверному API веб-приложения в контексте пользователя. В этом примере веб-приложение (запущенное в контексте учетной записи службы или учетной записи компьютера или виртуальной машины) олицетворяет пользователя при доступе к ресурсу (серверному API веб-приложения). Делегирование Kerberos не защищено, поскольку в нем не ограничивается доступ к ресурсам, к которым может получить доступ олицетворяемая учетная запись в контексте пользователя.

Ограниченное делегирование Kerberos ограничивает службы и ресурсы, к которым указанный сервер может обращаться от имени пользователя. Для настройки учетной записи домена для службы и ограничения учетной записи одним доменом в традиционном ограниченном делегировании Kerberos требуются привилегии администратора домена.

Традиционное ограниченное делегирование Kerberos связано с несколькими трудностями. В ранних версиях операционных систем, если администратор домена настроил учетную запись с ограниченным делегированием Kerberos, у администратора службы не было возможности узнать, какие интерфейсные службы делегируются службам ресурсов, владельцем которых он является. При этом все интерфейсные службы, которые можно делегировать службе ресурса, являлись потенциальной точкой атаки. Если сервер, на котором размещена интерфейсная служба, скомпрометирован и при этом он настроен для делегирования службам ресурсов, службы ресурсов также могут быть скомпрометированы.

> [!NOTE]
> В управляемом домене доменных служб Azure AD у вас нет привилегий администратора домена. Таким образом **традиционное ограниченное делегирование Kerberos на основе учетной записи нельзя настроить в управляемом домене**. Используйте основанное на ресурсах ограниченное делегирование Kerberos, как описано в этой статье. Этот механизм также более безопасен.
>
>

## <a name="resource-based-kcd"></a>Ограниченное делегирование Kerberos на основе ресурсов
После выпуска Windows Server 2012 администраторы службы могут настраивать ограниченное делегирование для своей службы. В этой модели администратор служб сервера может разрешить или запретить конкретным интерфейсным службам использовать ограниченное делегирование Kerberos. Такая модель называется **ограниченным делегированием Kerberos на основе ресурсов**.

Ограниченное делегирование Kerberos на основе ресурсов настраивается с помощью PowerShell. Используйте командлет `Set-ADComputer` или `Set-ADUser` в зависимости от того, является ли учетная запись олицетворением учетной записи компьютера, службы или пользователя.

### <a name="configure-resource-based-kcd-for-a-computer-account-on-a-managed-domain"></a>Настройка ограниченного делегирования Kerberos на основе ресурсов для учетной записи компьютера в управляемом домене
Допустим, что веб-приложение запущено на компьютере "contoso100-webapp.contoso100.com". Ему требуется доступ к ресурсу (API веб-приложения, запущенного на компьютере "contoso100-api.contoso100.com") в контексте пользователей домена. Вот как можно настроить ограниченное делегирование Kerberos на основе ресурсов для этого сценария.

1. [Создайте настраиваемое подразделение](create-ou.md). Вы можете делегировать разрешения, чтобы управлять настраиваемым подразделением пользователей в управляемом домене.
2. Присоедините обе виртуальные машины (одну с веб-приложением и вторую с веб-API) к управляемому домену. Создайте учетные записи компьютеров в настраиваемом подразделении.
3. Теперь настройте ограниченное делегирование Kerberos на основе ресурсов с помощью следующей команды PowerShell:

```powershell
$ImpersonatingAccount = Get-ADComputer -Identity contoso100-webapp.contoso100.com
Set-ADComputer contoso100-api.contoso100.com -PrincipalsAllowedToDelegateToAccount $ImpersonatingAccount
```

> [!NOTE]
> Учетные записи компьютеров с веб-приложением и веб-API должны находиться в настраиваемом подразделении, где вы имеете разрешения на настройку ограниченного делегирования Kerberos на основе ресурсов. Вы не можете настроить ограниченное делегирование Kerberos на основе ресурсов в учетной записи компьютера во встроенном контейнере AAD DC Computers.
>

### <a name="configure-resource-based-kcd-for-a-user-account-on-a-managed-domain"></a>Настройка ограниченного делегирования Kerberos на основе ресурсов для учетной записи пользователя в управляемом домене
Предположим, что веб-приложение запущено как от имени учетной записи службы appsvc и ему требуется доступ к ресурсу (API веб-приложения, запущенного от имени учетной записи службы backendsvc) в контексте пользователей домена. Вот как можно настроить ограниченное делегирование Kerberos на основе ресурсов для этого сценария.

1. [Создайте настраиваемое подразделение](create-ou.md). Вы можете делегировать разрешения, чтобы управлять настраиваемым подразделением пользователей в управляемом домене.
2. Присоедините виртуальную машину, на которой выполняется серверный веб-API или ресурс, к управляемому домену. Создайте учетную запись компьютера в настраиваемом подразделении.
3. Создайте учетную запись службы (например, appsvc), используемую при запуске веб-приложения в настраиваемом подразделении.
4. Теперь настройте ограниченное делегирование Kerberos на основе ресурсов с помощью следующей команды PowerShell:

```powershell
$ImpersonatingAccount = Get-ADUser -Identity appsvc
Set-ADUser backendsvc -PrincipalsAllowedToDelegateToAccount $ImpersonatingAccount
```

> [!NOTE]
> Учетная запись компьютера с серверным веб-API и учетная запись службы должны находиться в настраиваемом подразделении, где вы имеете разрешения на настройку ограниченного делегирования Kerberos на основе ресурсов. Настроить ограниченное делегирование Kerberos на основе ресурсов в учетной записи компьютера во встроенном контейнере AAD DC Computers или в учетных записях пользователей во встроенном контейнере AAD DC Users нельзя. Поэтому вы не сможете настроить ограниченное делегирование Kerberos на основе ресурсов с помощью учетных записей пользователей, синхронизированных с Azure AD.
>

## <a name="related-content"></a>См. также
* [Приступая к работе с доменными службами Azure AD](create-instance.md)
* [(Обзор ограниченного делегирования Kerberos)](https://technet.microsoft.com/library/jj553400.aspx)
