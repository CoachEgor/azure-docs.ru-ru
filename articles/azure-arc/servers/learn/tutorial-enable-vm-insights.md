---
title: Учебник. Мониторинг гибридной виртуальной машины с помощью Azure Monitor для виртуальных машин
description: Сведения о сборе и анализе данных с гибридной виртуальной машины в Azure Monitor.
ms.topic: tutorial
ms.date: 08/12/2020
ms.openlocfilehash: 76df7d403fdce6fc3ac77c0b24849aedffb57ce0
ms.sourcegitcommit: 4913da04fd0f3cf7710ec08d0c1867b62c2effe7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/14/2020
ms.locfileid: "88213160"
---
# <a name="tutorial-monitor-a-hybrid-machine-with-azure-monitor-for-vms"></a>Руководство по мониторингу виртуальной гибридной машины с помощью Azure Monitor для виртуальных машин

[Azure Monitor](../overview.md) может собирать данные напрямую из гибридных виртуальных машин в рабочую область Log Analytics для подробного анализа данных и корреляции. Обычно это влечет за собой установку [агента Log Analytics](../../../azure-monitor/platform/agents-overview.md#log-analytics-agent) на машине с помощью сценария, вручную или автоматически в соответствии со стандартами управления конфигурацией. Серверы с поддержкой Arc (предварительная версия) недавно представили поддержку для установки [расширений виртуальных машин](../manage-vm-extensions.md) Log Analytics и Dependency Agent для Windows и Linux, что позволяет Azure Monitor собирать данные с виртуальных машин, не относящихся к Azure.

В этом руководстве показано, как настроить и собрать данные с виртуальных машин Linux или Windows, включив Azure Monitor для виртуальных машин, выполнив набор шагов, которые упрощают работу и занимают меньше времени.  

## <a name="prerequisites"></a>Предварительные требования

* Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

* Функциональность расширения виртуальной машины доступна только в списке [поддерживаемых регионов](../overview.md#supported-regions).

* См. раздел о [поддерживаемых операционных системах](../../../azure-monitor/insights/vminsights-enable-overview.md#supported-operating-systems), чтобы убедиться, что включаемая операционная система виртуальных машин поддерживается в Azure Monitor для виртуальных машин.

* Ознакомьтесь с требованиями к брандмауэру для агента Log Analytics, приведенными в [обзоре агента Log Analytics](../../../azure-monitor/platform/log-analytics-agent.md#network-requirements). Dependency Agent в Azure Monitor для виртуальных машин не передает данные и не требует изменений в настройках брандмауэра или портов.

## <a name="sign-in-to-azure-portal"></a>Вход на портал Azure

Войдите на [портал Azure](https://portal.azure.com).

## <a name="enable-azure-monitor-for-vms"></a>Включение Azure Monitor для виртуальных машин

1. Запустите службу Azure Arc на портале Azure, щелкнув **Все службы**, а затем выполнив поиск и выбрав **Компьютеры — Azure Arc**.

    :::image type="content" source="./media/quick-enable-hybrid-vm/search-machines.png" alt-text="Поиск серверов с поддержкой Arc в разделе "Все службы"" border="false":::

1. На странице **Компьютеры — Azure Arc** выберите подключенный компьютер, созданный при изучении [краткого руководства](quick-enable-hybrid-vm.md).

1. На левой панели в разделе **Мониторинг** выберите **Аналитические сведения**, а затем **Включить**.

    :::image type="content" source="./media/tutorial-enable-vm-insights/insights-option.png" alt-text="Выбор параметра "Аналитические сведения" в меню слева" border="false":::

1. На странице **Переход на Insights** в Azure Monitor вам будет предложено создать рабочую область. Для работы с этим учебником мы не рекомендуем выбирать имеющуюся рабочую область Log Analytics. Подтвердите вариант по умолчанию — рабочую область с уникальным именем в том же регионе, где расположен зарегистрированный подключенный компьютер. Это рабочая область создана и настроена для вас.

    :::image type="content" source="./media/tutorial-enable-vm-insights/enable-vm-insights.png" alt-text="Страница включения Azure Monitor для виртуальных машин" border="false":::

1. При выполнении настройки вы будете получать сообщения о состоянии. Этот процесс занимает несколько минут, так как на подключенном компьютере установлены расширения.

    :::image type="content" source="./media/tutorial-enable-vm-insights/onboard-vminsights-vm-portal-status.png" alt-text="Сообщение о состоянии включения Azure Monitor для виртуальных машин" border="false":::

    После завершения вы получите сообщение об успешном подключении компьютера и развертывании аналитических сведений.

## <a name="view-data-collected"></a>Просмотр собранных данных

После завершения развертывания и настройки выберите **Аналитические сведения**, а затем перейдите на вкладку **Производительность**. На вкладке "Производительность" отобразится группа счетчиков производительности, собираемых из операционной системы виртуальной машины. Прокрутите вниз, чтобы просмотреть дополнительные счетчики, и наведите указатель мыши на график, чтобы просмотреть среднее значение и процентили, полученные с момента установки расширения виртуальной машины Log Analytics на компьютер.

:::image type="content" source="./media/tutorial-enable-vm-insights/insights-performance-charts.png" alt-text="Диаграммы производительности Azure Monitor для виртуальных машин для выбранного компьютера" border="false":::

Щелкните **Карта**, чтобы открыть функцию отображения процессов, запущенных на виртуальной машине, и их зависимостей в формате карты. Щелкните **Свойства**, чтобы открыть панель свойств, если она еще не открыта.

:::image type="content" source="./media/tutorial-enable-vm-insights/insights-map.png" alt-text="Карта Azure Monitor для виртуальных машин для выбранного компьютера" border="false":::

Разверните процессы, выполняемые на виртуальной машине. Выберите любой из процессов, чтобы просмотреть сведения о нем и выделить его зависимости.

Снова выберите виртуальную машину и щелкните **События журнала**. Отобразится список таблиц, которые хранятся в рабочей области Log Analytics для этой виртуальной машины. Этот список будет разным в зависимости от того, используете ли вы виртуальную машину Windows или Linux. Выберите таблицу **События**. В таблице **События** перечислены все события из журнала событий Windows. Откроется Log Analytics с простым запросом для получения собранных записей журнала событий.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о Azure Monitor см. в следующей статье:

> [!div class="nextstepaction"]
> [Общие сведения о службе Azure Monitor](../../../azure-monitor/overview.md)