---
title: Управление Azure Arc для агентов серверов (предварительный просмотр)
description: В этой статье описаны различные задачи управления, которые обычно выполняются в течение жизненного цикла azure Arc для серверов агента Connected Machine.
services: azure-arc
ms.service: azure-arc
ms.subservice: azure-arc-servers
author: mgoedtel
ms.author: magoedte
ms.date: 04/01/2020
ms.topic: conceptual
ms.openlocfilehash: 8bcf59ee863bb2fd2a3213480372ad215c2fc00d
ms.sourcegitcommit: c5661c5cab5f6f13b19ce5203ac2159883b30c0e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/01/2020
ms.locfileid: "80528587"
---
# <a name="managing-and-maintaining-the-connected-machine-agent"></a>Управление и обслуживание агента подключенной машины

После первоначального развертывания Azure Arc для серверов (предварительный просмотр) агента Connected Machine для Windows или Linux может потребоваться перенастроить агента, обновить его или удалить с компьютера, если он достиг стадии выхода на пенсию в своем жизненном цикле. Вы можете легко управлять этими задачами обслуживания вручную или автоматизировать этот процесс, сократив при этом эксплуатационные расходы и количество ошибок.

## <a name="upgrading-agent"></a>Обновление агента

Агент Azure Connected Machine для Windows и Linux может быть обновлен до последнего выпуска вручную или автоматически в зависимости от ваших требований. В следующей таблице описаны методы, поддерживаемые для выполнения обновления агента.

| Операционная система | Метод перехода |
|------------------|----------------|
| Windows | Вручную<br> Центр обновления Windows |
| Ubuntu | [Apt](https://help.ubuntu.com/lts/serverguide/apt.html) |
| SUSE Linux Enterprise Server | [zypper](https://en.opensuse.org/SDB:Zypper_usage_11.3) |
| RedHat Enterprise, Amazon, CentOS Linux | [Ням](https://wiki.centos.org/PackageManagement/Yum) | 

### <a name="windows-agent"></a>Агент Windows

Для обновления агента на машине Windows до последней версии агент доступен из Microsoft Update и может быть развернут с помощью существующего процесса управления обновлением программного обеспечения. Он также может быть запущен вручную от командного запроса, `AzureConnectedMachine.msi`из сценария или другого решения автоматизации, или от мастера uI путем выполнения. 

> [!NOTE]
> * Чтобы обновить агента, необходимо иметь разрешения *администратора.*
> * Для обновления вручную необходимо сначала загрузить и скопировать пакет Installer в папку на целевом сервере или из общей сетевой папки. 

Если вы не знакомы с вариантами командной строки для пакетов Windows Installer, просмотрите [стандартные параметры командной строки Msiexec](https://docs.microsoft.com/windows/win32/msi/standard-installer-command-line-options) и [параметры командной строки Msiexec.](https://docs.microsoft.com/windows/win32/msi/command-line-options)

#### <a name="to-upgrade-using-the-setup-wizard"></a>Обновление с помощью мастера настройки

1. Войдите в систему компьютера, используя учетную запись с правами администратора.

2. Выполните **AzureConnectedMachineAgent.msi,** чтобы запустить мастер setup.

Мастер настройки обнаруживает, существует ли предыдущая версия, а затем автоматически выполняет обновление агента. Когда обновление завершается, мастер настройки автоматически закрывается.

#### <a name="to-upgrade-from-the-command-line"></a>Обновление от командной строки

1. Войдите в систему компьютера, используя учетную запись с правами администратора.

2. Чтобы обновить агента без звучания и создать `C:\Support\Logs` файл журнала настройки в папке, запустите следующую команду.

    ```dos
    msiexec.exe /i AzureConnectedMachineAgent.msi /qn /l*v "C:\Support\Logs\Azcmagentupgradesetup.log"
    ```

### <a name="linux-agent"></a>Агент Linux

Чтобы обновить агента на машине Linux до последней версии, он включает в себя две команды. Одна команда обновляет локальный индекс пакетов со списком последних доступных пакетов из репозиториев, а одна — обновление локального пакета. 

> [!NOTE]
> Чтобы обновить агент, необходимо иметь разрешения *на доступ корневого* доступа или с учетной записью, которая имеет повышенные права с помощью Sudo.

#### <a name="upgrade-ubuntu"></a>Обновление Ubuntu

1. Чтобы обновить локальный индекс пакетов с последними изменениями, внесенными в репозитории, запустите следующую команду:

    ```bash
    apt update
    ```

2. Чтобы обновить систему, запустите следующую команду:

    ```bash
    apt upgrade
    ```

Действия [меткой](https://help.ubuntu.com/lts/serverguide/apt.html) команды, такие как установка и удаление пакетов, `/var/log/dpkg.log` регистрируются в файле журнала.

#### <a name="upgrade-red-hatcentosamazon-linux"></a>Обновление Red Hat/CentOS/Amazon Linux

1. Чтобы обновить локальный индекс пакетов с последними изменениями, внесенными в репозитории, запустите следующую команду:

    ```bash
    yum check-update
    ```

2. Чтобы обновить систему, запустите следующую команду:

    ```bash
    yum update
    ```

Действия команды [yum,](https://access.redhat.com/articles/yum-cheat-sheet) такие как установка и удаление пакетов, `/var/log/yum.log` регистрируются в файле журнала. 

#### <a name="upgrade-suse-linux-enterprise"></a>Обновление SUSE Linux Предприятия

1. Чтобы обновить локальный индекс пакетов с последними изменениями, внесенными в репозитории, запустите следующую команду:

    ```bash
    zypper refresh
    ```

2. Чтобы обновить систему, запустите следующую команду:

    ```bash
    zypper update
    ```

Действия команды [zypper,](https://en.opensuse.org/Portal:Zypper) такие как установка и удаление пакетов, `/var/log/zypper.log` регистрируются в файле журнала. 

## <a name="remove-the-agent"></a>Удаление агента

Выполните один из следующих методов для удаления агента Windows или Linux Connected Machine из машины. Удаление агента не отменяет регистрацию машины с Arc для серверов (предварительный просмотр), это отдельный процесс, который вы выполняете, когда вам больше не нужно управлять машиной в Azure.

### <a name="windows-agent"></a>Агент Windows

Оба следующих метода удаляют агента, но они не удаляют папку *C:'Program Files-AzureConnectedMachineMachineAgent* на машине.

#### <a name="uninstall-from-control-panel"></a>Удаление из панели управления

1. Чтобы удалить агент Windows с компьютера, выполните следующие действия:

    а. Войдите в систему компьютера, используя учетную запись с правами администратора.  
    b. Откройте **Панель управления**, выберите раздел **Программы и компоненты**.  
    c. В разделе **Программы и компоненты** выберите **Azure Connected Machine Agent** (Агент подключенного компьютера Azure), затем **Удалить**, а затем **Да**.  

    >[!NOTE]
    > Можно также запустить мастер установки агента, дважды щелкнув пакет установщика **AzureConnectedMachineAgent.msi**.

#### <a name="uninstall-from-the-command-line"></a>Удаление из командной строки

Чтобы удалить агента вручную из команды Prompt или использовать автоматизированный метод, например скрипт, можно использовать следующий пример. Сначала необходимо получить код продукта, который является GUID, который является основным идентификатором пакета приложений, из операционной системы. Удаление выполняется с помощью командной строки Msiexec.exe - `msiexec /x {Product Code}`.
    
1. откройте редактор реестра;

2. в разделе реестра `HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Uninstall` найдите и скопируйте код GUID продукта;

3. Затем можно удалить агент, используя Msiexec, используя следующие примеры:

   * Из типа командной строки:

       ```dos
       msiexec.exe /x {product code GUID} /qn
       ```

   * Вы можете выполнить те же шаги с помощью PowerShell:

       ```powershell
       Get-ChildItem -Path HKLM:\Software\Microsoft\Windows\CurrentVersion\Uninstall | `
       Get-ItemProperty | `
       Where-Object {$_.DisplayName -eq "Azure Connected Machine Agent"} | `
       ForEach-Object {MsiExec.exe /x "$($_.PsChildName)" /qn}
       ```

### <a name="linux-agent"></a>Агент Linux

> [!NOTE]
> Чтобы удалить агента, необходимо иметь разрешения на *доступ корней* или с учетной записью, которая имеет повышенные права с помощью Sudo.

Чтобы удалить агента Linux, команда для использования зависит от операционной системы Linux.

- Для Ubuntu запустите следующую команду:

    ```bash
    sudo apt purge azcmagent
    ```

- Для RHEL, CentOS и Amazon Linux запустите следующую команду:

    ```bash
    sudo yum remove azcmagent
    ```

- Для SLES запустите следующую команду:

    ```bash
    sudo zypper remove azcmagent
    ```

## <a name="unregister-machine"></a>Нерегистрируемая машина

Если вы планируете прекратить управление машиной с помощью служб поддержки в Azure, выполните следующие действия по отрегистрификации машины с помощью Arc для серверов (предварительный просмотр). Вы можете выполнить этот шаг либо до, либо после удаления агента Connected Machine из машины.

1. Перейдите на [портал Azure](https://aka.ms/hybridmachineportal) и откройте Azure Arc для серверов (предварительная версия).

2. Выберите компьютер в списке, щелкните значок с многоточием (**...**), а затем выберите пункт **Удалить**.
