---
title: Создание или обновление пользовательских ролей Azure с помощью портала Azure (Preview) - Azure RBAC
description: Узнайте, как создать пользовательские роли Azure для управления доступом на основе ролей Azure (Azure RBAC) с помощью портала Azure. Здесь приводится описание процедур получения списка, создания, обновления и удаления пользовательских ролей.
services: active-directory
documentationcenter: ''
author: rolyon
manager: mtillman
ms.service: role-based-access-control
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 02/26/2020
ms.author: rolyon
ms.openlocfilehash: 3204cdf51f3f37588f684f801a811f569b337d13
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "77674874"
---
# <a name="create-or-update-azure-custom-roles-using-the-azure-portal-preview"></a>Создание или обновление пользовательских ролей Azure с помощью портала Azure (Предварительный просмотр)

> [!IMPORTANT]
> Пользовательские роли Azure с помощью портала Azure в настоящее время находятся в общедоступном предварительном просмотре.
> Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены.
> Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

Если [встроенные роли Azure](built-in-roles.md) не отвечают конкретным потребностям организации, можно создать собственные пользовательские роли Azure. Точно так же, как встроенные роли, можно назначить пользовательские роли пользователям, группам и руководителям служб в областях подписки и группы ресурсов. Настраиваемые роли хранятся в каталоге Azure Active Directory (Azure AD) и могут использоваться несколькими подписками. Каждый каталог может иметь до 5000 пользовательских ролей. Пользовательские роли можно создавать с помощью портала Azure, Azure PowerShell, Azure CLI или АPI REST. В этой статье описывается, как создавать пользовательские роли с помощью портала Azure (в настоящее время в предварительном просмотре).

## <a name="prerequisites"></a>Предварительные требования

Для создания пользовательских ролей в Azure требуются:

- разрешения на создание пользовательских ролей, такие как [Владелец](built-in-roles.md#owner) или [Администратор доступа пользователя](built-in-roles.md#user-access-administrator);

## <a name="step-1-determine-the-permissions-you-need"></a>Шаг 1: Определите необходимые разрешения

Azure имеет тысячи разрешений, которые потенциально можно включить в пользовательскую роль. Вот четыре способа определения разрешений, которые вы хотите добавить в пользовательскую роль:

| Метод | Описание |
| --- | --- |
| Посмотреть на существующие роли | Можно посмотреть существующие роли, чтобы увидеть, какие разрешения используются. Для получения дополнительной информации смотрите [встроенные роли Azure.](built-in-roles.md) |
| Поиск разрешений по ключевому слову | При создании пользовательской роли с помощью портала Azure можно искать разрешения по ключевому слову. Например, можно найти разрешения на *виртуальную машину* или *выставление счетов.* Эта функция поиска описана позже в [шаге 4: Разрешения](#step-4-permissions). |
| Загрузить все разрешения | При создании пользовательской роли с помощью портала Azure можно загрузить все разрешения в виде файла CSV, а затем выполнить поиск этого файла. На панели **разрешений Добавить** щель щелкните кнопку **Загрузить все разрешения,** чтобы загрузить все разрешения. Для получения дополнительной информации о панели разрешений Добавить см. [Шаг 4: Разрешения](#step-4-permissions). |
| Просмотр разрешений в документах | Доступные разрешения можно просмотреть в [операциях поставщика ресурсов Ресурсов Ресурсного отдела Azure Manager.](resource-provider-operations.md) |

## <a name="step-2-choose-how-to-start"></a>Шаг 2: Выберите, как начать

Есть три способа, которые вы можете начать создавать пользовательские роли. Вы можете клонировать существующую роль, начать с нуля или начать с файла JSON. Самый простой способ — найти существующую роль, которая имеет большинство необходимых разрешений, а затем клонировать и изменять ее для вашего сценария. 

### <a name="clone-a-role"></a>Клон роль

Если существующая роль не имеет необходимых разрешений, ее можно клонировать, а затем изменить. Выполните следующие шаги, чтобы начать клонирование роли.

1. На портале Azure откройте группу подписки или ресурсов, где требуется, чтобы пользовательская роль была назначена, а затем откройте **элемент управления доступом (IAM).**

    На следующем скриншоте показана страница управления доступом (IAM), открытая для подписки.

    ![Страница управления доступом (IAM) для подписки](./media/custom-roles-portal/access-control-subscription.png)

1. Чтобы просмотреть список всех встроенных и пользовательских ролей, щелкните вкладку **Роли**.

1. Поиск роли, которую вы хотите клонировать, такие как роль Биллинг Читателя.

1. В конце строки, нажмите эллипсис **(...**) и нажмите **Клон**.

    ![Меню контекста клона](./media/custom-roles-portal/clone-menu.png)

    Это открывает пользовательский редактор ролей с **выбранным клоном вариантом роли.**

1. Приступить к [шагу 3: Основы](#step-3-basics).

### <a name="start-from-scratch"></a>Создание клиента с нуля

Если вы предпочитаете, вы можете выполнить эти шаги, чтобы начать пользовательские роли с нуля.

1. На портале Azure откройте группу подписки или ресурсов, где требуется, чтобы пользовательская роль была назначена, а затем откройте **элемент управления доступом (IAM).**

1. Нажмите **Добавить,** а затем нажмите **Добавить пользовательскую роль (предварительный просмотр)**.

    ![Добавление пользовательского ролевой меню](./media/custom-roles-portal/add-custom-role-menu.png)

    Это открывает пользовательский редактор ролей с выбранным вариантом **Start from scratch.**

1. Приступить к [шагу 3: Основы](#step-3-basics).

### <a name="start-from-json"></a>Начните с JSON

Если вы предпочитаете, вы можете указать большинство пользовательских значений ролей в файле JSON. Вы можете открыть файл в пользовательском редакторе ролей, внести дополнительные изменения, а затем создать пользовательскую роль. Выполните следующие действия, чтобы начать с файла JSON.

1. Создайте файл JSON со следующим форматом:

    ```json
    {
        "properties": {
            "roleName": "",
            "description": "",
            "assignableScopes": [],
            "permissions": [
                {
                    "actions": [],
                    "notActions": [],
                    "dataActions": [],
                    "notDataActions": []
                }
            ]
        }
    }
    ```

1. В файле JSON укажите значения для различных свойств. Вот пример с некоторыми добавленными значениями. Для получения информации о различных свойствах [см.](role-definitions.md)

    ```json
    {
        "properties": {
            "roleName": "Billing Reader Plus",
            "description": "Read billing data and download invoices",
            "assignableScopes": [
                "/subscriptions/11111111-1111-1111-1111-111111111111"
            ],
            "permissions": [
                {
                    "actions": [
                        "Microsoft.Authorization/*/read",
                        "Microsoft.Billing/*/read",
                        "Microsoft.Commerce/*/read",
                        "Microsoft.Consumption/*/read",
                        "Microsoft.Management/managementGroups/read",
                        "Microsoft.CostManagement/*/read",
                        "Microsoft.Support/*"
                    ],
                    "notActions": [],
                    "dataActions": [],
                    "notDataActions": []
                }
            ]
        }
    }
    ```
    
1. На портале Azure откройте страницу **управления доступом (IAM).**

1. Нажмите **Добавить,** а затем нажмите **Добавить пользовательскую роль (предварительный просмотр)**.

    ![Добавление пользовательского ролевой меню](./media/custom-roles-portal/add-custom-role-menu.png)

    Это открывает пользовательский редактор ролей.

1. На вкладке «Основы» в **базовых разрешениях**выберите **«Старт» от JSON.**

1. Рядом с файловым полем Выберите кнопку папки, чтобы открыть поле «Открытый диалог».

1. Выберите файл JSON, а затем нажмите **Open.**

1. Приступить к [шагу 3: Основы](#step-3-basics).

## <a name="step-3-basics"></a>Шаг 3: Основы

На вкладке **«Основы» указаны** имя, описание и базовые разрешения для пользовательской роли.

1. В специальном поле **для ролевых имен** укажите имя для пользовательской роли. Название должно быть уникальным для каталога Azure AD. Название может включать буквы, цифры, пробелы и специальные символы.

1. В поле **Описания** укажите дополнительное описание для пользовательской роли. Это станет инструментом для пользовательской роли.

    Параметр **базовых разрешений** уже должен быть установлен на основе предыдущего шага, но вы можете изменить.

    ![Вкладка Основы с указанными значениями](./media/custom-roles-portal/basics-values.png)

## <a name="step-4-permissions"></a>Шаг 4: Разрешения

На вкладке **«Разрешения»** указаны разрешения на пользовательскую роль. В зависимости от того, клонировали ли вы роль или начали с JSON, вкладка «Разрешения» может уже перечислить некоторые разрешения.

![Вкладка разрешений создания пользовательской роли](./media/custom-roles-portal/permissions.png)

### <a name="add-or-remove-permissions"></a>Добавление или удаление разрешений

Выполните следующие действия, чтобы добавить или удалить разрешения для вашей пользовательской роли.

1. Чтобы добавить разрешения, нажмите **«Добавить разрешения»,** чтобы открыть панель разрешений Добавления.

    В этом панели перечислены все доступные разрешения, сгруппированные в различные категории в формате карты. Каждая категория представляет *поставщика ресурсов,* который является службой, которая предоставляет ресурсы Azure.

1. В поле **поиска разрешений** введите строку для поиска разрешений. Например, поиск *счета-фактуры* для поиска разрешений, связанных с счетом-фактурой.

    Список карт поставщика ресурсов будет отображаться на основе строки поиска. Список того, как поставщики ресурсов отображают карту служб Azure, можно узнать о [поставщиках ресурсов для служб Azure.](../azure-resource-manager/management/azure-services-resource-providers.md)

    ![Добавление панели разрешений с поставщиком ресурсов](./media/custom-roles-portal/add-permissions-provider.png)

1. Нажмите на карту поставщика ресурсов, которая может иметь разрешения, которые вы хотите добавить к вашей пользовательской роли, такие как **Биллинг Майкрософт.**

    Список разрешений управления для этого поставщика ресурсов отображается на основе строки поиска.

    ![Добавление списка разрешений](./media/custom-roles-portal/add-permissions-list.png)

1. Если вы ищете разрешения, применимые к плоскости данных, нажмите **«Действия данных».** В противном случае оставьте действия переключения, установленные на **действиях,** чтобы перечислить разрешения, применимые к плоскости управления. Для получения дополнительной информации о различиях между плоскости управления и плоскости данных [см.](role-definitions.md#management-and-data-operations)

1. При необходимости обновите строку поиска для дальнейшего уточнения поиска.

1. Как только вы найдете одно или несколько разрешений, которые вы хотите добавить в пользовательскую роль, добавьте галочку рядом с разрешениями. Например, добавьте контрольный знак рядом с **Другим: Скачать счет-фактуру,** чтобы добавить разрешение на загрузку счетов-фактур.

1. Нажмите **Добавить,** чтобы добавить разрешение в список разрешений.

    Разрешение добавляется как `Actions` `DataActions`или .

    ![Добавлено разрешение](./media/custom-roles-portal/permissions-list-add.png)

1. Чтобы удалить разрешения, нажмите значок удаления в конце строки. В этом примере, поскольку пользователю не потребуется `Microsoft.Support/*` возможность создавать билеты поддержки, разрешение может быть удалено.

### <a name="add-wildcard-permissions"></a>Добавление разрешений подстановочных знаков

В зависимости от того, как вы решили начать,\*вы можете иметь разрешения с подстановочными знаками () в списке разрешений. Подстановочный знак ()\*расширяет разрешение на все, что соответствует строке вы предоставляете. Например, предположим, что вы хотели добавить все разрешения, связанные с управлением затратами Azure и экспортом. Можно добавить все эти разрешения:

```
Microsoft.CostManagement/exports/action
Microsoft.CostManagement/exports/read
Microsoft.CostManagement/exports/write
Microsoft.CostManagement/exports/delete
Microsoft.CostManagement/exports/run/action
```

Вместо добавления всех этих разрешений можно просто добавить разрешение подстановочного знака. Например, следующее разрешение подстановочного знака эквивалентно предыдущим пяти разрешениям. Это также будет включать в себя любые будущие разрешения на экспорт, которые могут быть добавлены.

```
Microsoft.CostManagement/exports/*
```

Если вы хотите добавить новое разрешение подстановочного знака, вы не можете добавить его с помощью панели **разрешений Добавления.** Чтобы добавить разрешение подстановочного знака, необходимо добавить его вручную с помощью вкладки **JSON.** Для получения дополнительной информации [см.](#step-6-json)

### <a name="exclude-permissions"></a>Исключить разрешения

Если ваша роль имеет\*подстановочный знак () разрешение, и вы хотите исключить или вычесть конкретные разрешения из этого разрешения подстановочного знака, вы можете исключить их. Например, предположим, что у вас есть следующее разрешение на подстановочный знак:

```
Microsoft.CostManagement/exports/*
```

Если вы не хотите, чтобы экспорт был удален, можно исключить следующее разрешение на удаление:

```
Microsoft.CostManagement/exports/delete
```

При исключении разрешения оно добавляется как `NotActions` или `NotDataActions`. Эффективные разрешения управления вычисляются путем добавления `Actions` всех, `NotActions`а затем вычитания всех . Эффективные разрешения данных вычисляются `DataActions` путем добавления всех, а затем вычитания всех `NotDataActions`.

> [!NOTE]
> Исключение разрешения не то же самое, что отрицание. Исключение разрешений — это просто удобный способ вычесть разрешения из разрешения подстановочного знака.

1. Чтобы исключить или вычесть разрешение из разрешенного разрешения подстановочного знака, нажмите **Разрешение На** открытие панели разрешений «Исключить».

    На этом панели указаны разрешения управления или данные, которые исключены или вычтены.

1. Как только вы найдете одно или несколько разрешений, которые вы хотите исключить, добавьте галочку рядом с разрешениями, а затем нажмите кнопку **Добавить.**

    ![Исключить разрешение панели - разрешение выбрано](./media/custom-roles-portal/exclude-permissions-select.png)

    Разрешение добавляется как `NotActions` `NotDataActions`или .

    ![Разрешение исключено](./media/custom-roles-portal/exclude-permissions-list-add.png)

## <a name="step-5-assignable-scopes"></a>Шаг 5: Присвоенные области

На **вкладке Присваиваемые области** вы указываете, где доступна пользовательская роль для назначения, например, подписка или группа ресурсов. В зависимости от того, как вы решили начать, эта вкладка может перечислить область, в которой вы открыли страницу управления доступом (IAM). Настройка присвоенной области для корневой области ("/) не поддерживается. Для этого предварительного просмотра нельзя добавлять группу управления в качестве присваиваемой области.

1. Нажмите **Добавить присучиваемые области,** чтобы открыть панель присваиваемых прицелов Add.

    ![Вкладка присваиваемых областей](./media/custom-roles-portal/assignable-scopes.png)

1. Нажмите на одну или несколько областей, которые вы хотите использовать, как правило, подписку.

    ![Добавление присвоенных областей](./media/custom-roles-portal/add-assignable-scopes.png)

1. Нажмите кнопку **Добавить,** чтобы добавить присвоенную область.

## <a name="step-6-json"></a>Шаг 6: JSON

На вкладке **JSON** вы видите вашу пользовательскую роль, отформатированную в JSON. Если вы хотите, вы можете непосредственно отодвить JSON. Если вы хотите добавить\*подстановочный знак () разрешение, вы должны использовать эту вкладку.

1. Чтобы отсеять JSON, нажмите **Edit**.

    ![Вкладка JSON, показывающая пользовательскую роль](./media/custom-roles-portal/json.png)

1. Внести изменения в JSON.

    Если JSON не отформатирован правильно, вы увидите красную неровную линию и индикатор в вертикальной канаве.

1. При завершении редактирования нажмите **Сохранить**.

## <a name="step-7-review--create"></a>Шаг 7: Обзор и создание

На вкладке **«Обзор» и «Создайте»** пользовательские настройки ролей.

1. Просмотрите настройки пользовательских ролей.

    ![Вкладка "Просмотр и создание"](./media/custom-roles-portal/review-create.png)

1. Нажмите **Создать** для создания пользовательской роли.

    Через несколько мгновений появляется окно сообщений, указывающее на успешное создание пользовательской роли.

    ![Создание пользовательского ролевой сообщения](./media/custom-roles-portal/custom-role-success.png)

    При обнаружении каких-либо ошибок будет отображаться сообщение.

    ![Просмотрение и создание ошибки](./media/custom-roles-portal/review-create-error.png)

1. Просмотр новой пользовательской роли в списке **ролей.** Если вы не видите свою пользовательскую роль, нажмите **Refresh.**

     Это может занять несколько минут для вашей пользовательской роли, чтобы появиться везде.

## <a name="list-custom-roles"></a>Вывод списка настраиваемых ролей

Выполните следующие действия, чтобы просмотреть пользовательские роли.

1. Откройте группу подписки или ресурсов, а затем откройте **контроль доступа (IAM).**

1. Чтобы просмотреть список всех встроенных и пользовательских ролей, щелкните вкладку **Роли**.

1. В списке **Типов** выберите **CustomRole,** чтобы просто увидеть пользовательские роли.

    Если вы только что создали свою пользовательскую роль и не увидите ее в списке, нажмите **Refresh.**

    ![Пользовательский список ролей](./media/custom-roles-portal/custom-role-list.png)

## <a name="update-a-custom-role"></a>Обновление пользовательской роли

1. Как описано ранее в этой статье, откройте список пользовательских ролей.

1. Нажмите на эллипсис **(...**) для пользовательской роли вы хотите обновить, а затем нажмите **Edit**. Обратите внимание, что вы не можете обновить встроенные роли.

    Пользовательская роль открывается в редакторе.

    ![Пользовательское ролевой меню](./media/custom-roles-portal/edit-menu.png)

1. Используйте различные вкладки для обновления пользовательской роли.

1. После того, как вы закончите с изменениями, нажмите **на вкладку «Обзор» и создайте** для просмотра изменений.

1. Нажмите кнопку **«Обновление»,** чтобы обновить пользовательскую роль.

## <a name="delete-a-custom-role"></a>Удаление настраиваемой роли

1. Как описано ранее в этой статье, откройте список пользовательских ролей.

1. Удалите любые назначения ролей, использующие пользовательскую роль.

1. Нажмите на эллипсис **(...**) для пользовательской роли вы хотите удалить, а затем нажмите **Удалить**.

    ![Пользовательское ролевой меню](./media/custom-roles-portal/delete-menu.png)

    Это может занять несколько минут для вашей пользовательской роли, чтобы быть полностью удалены.

## <a name="next-steps"></a>Дальнейшие действия

- [Руководство. Создание пользовательских ролей с помощью Azure PowerShell](tutorial-custom-role-powershell.md)
- [Пользовательские роли в Azure](custom-roles.md)
- [Операции поставщика ресурсов ресурсов менеджера ресурсов Azure](resource-provider-operations.md)
