---
title: Настройка единого входа в Azure Active Directory | Документация Майкрософт
description: В этом руководстве показано, как с помощью портала Azure настроить единый вход на основе SAML для приложения в Azure Active Directory (Azure AD).
services: active-directory
author: msmimart
manager: CelesteDG
ms.service: active-directory
ms.subservice: app-mgmt
ms.topic: tutorial
ms.workload: identity
ms.date: 04/08/2019
ms.author: mimart
ms.reviewer: arvinh,luleon
ms.collection: M365-identity-device-management
ROBOTS: NOINDEX
ms.openlocfilehash: a415ac749d0d322bc2f71f64d4bec6e32ad1f12e
ms.sourcegitcommit: db2d402883035150f4f89d94ef79219b1604c5ba
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/07/2020
ms.locfileid: "77063498"
---
# <a name="how-to-configure-saml-based-single-sign-on"></a>Настройка единого входа на основе SAML

После добавления приложения к корпоративным приложениям Azure AD настройте параметры единого входа. В этой статье описывается настройка единого входа на основе SAML для приложения не из коллекции. 

> [!NOTE]
> Добавляете приложение из коллекции? Пошаговые инструкции по установке см. в [списке руководств по приложениям SaaS](../saas-apps/tutorial-list.md).

Чтобы настроить единый вход для приложения не из коллекции *без написания кода*, необходима подписка или Azure AD Premium. Кроме того, приложение должно поддерживать SAML 2.0. Дополнительные сведения о версиях Azure AD см. в разделе [Цены на Azure AD](https://azure.microsoft.com/pricing/details/active-directory/).

## <a name="before-you-begin"></a>Перед началом

- Если приложение еще не добавлено в клиент Azure AD, ознакомьтесь со статьей о [добавлении приложения из коллекции](add-gallery-app.md) или [добавлении приложения не из коллекции](add-non-gallery-app.md).
- Обратитесь к поставщику приложения, чтобы получить правильные данные для следующих параметров:

    | Параметр "Базовая конфигурация SAML" | Инициированный поставщиком услуг | Инициированный поставщиком удостоверений | Описание |
    |:--|:--|:--|:--|
    | Идентификатор (идентификатор сущности) | Требуется для некоторых приложений | Требуется для некоторых приложений | Однозначно определяет приложение, для которого выполняется настройка единого входа. Azure AD отправляет идентификатор в приложение в качестве параметра "Аудитория" токена SAML. Приложение должно проверить его. Это значение также отображается как идентификатор сущности во всех метаданных SAML, предоставленных приложением. *Это значение можно найти в элементе **Издатель** в запросе **AuthnRequest** (запросе SAML), отправленном приложением.* |
    | URL-адрес ответа | Необязательно | Обязательно | Этот параметр указывает место, где приложение ожидает токен SAML. URL-адрес ответа также называется URL-адресом службы обработчика утверждений (ACS). |
    | URL-адрес входа | Обязательно | Не указывайте | Когда пользователь открывает этот URL-адрес, поставщик услуг выполняет перенаправление в Azure AD для аутентификации и входа пользователя в систему. Azure AD использует URL-адрес, чтобы запустить приложение из Office 365 или на панели доступа Azure AD. Если это поле пустое, Azure AD полагается на поставщика удостоверений, который инициирует единый вход, когда пользователь запускает приложение.|
    | Состояние ретранслятора | Необязательно | Необязательно | Указывает приложению, куда перенаправить пользователя после аутентификации. Обычно здесь указывается допустимый URL-адрес приложения. Но некоторые приложения используют это поле по-другому. Чтобы получить дополнительные сведения, обратитесь к поставщику приложения.
    | URL-адрес выхода. | Необязательно | Необязательно | Используется для отправки приложению ответов при завершении сеанса SAML.

## <a name="step-1-edit-the-basic-saml-configuration"></a>Шаг 1. Правка базовой конфигурации SAML

1. Войдите на [портал Azure](https://portal.azure.com) в качестве администратора облачных приложений или администратора приложения для клиента Azure AD.

1. Перейдите в **Azure Active Directory** > **Корпоративные приложения** и выберите приложение из списка. 
   
   - Чтобы выполнить поиск приложения, в меню **Тип приложения** выберите **Все приложения** и щелкните **Применить**. В поле поиска введите имя приложения, а затем выберите нужное приложение на панели результатов.

1. В разделе **Управление** щелкните **Единый вход**. 

1. Выберите **SAML**. Откроется страница **Настройка единого входа с помощью SAML**.

1. Чтобы изменить основные параметры конфигурации SAML, выберите значок **Изменить** (карандаш) в правом верхнем углу раздела **Базовая конфигурация SAML**.

     ![Настройка сертификатов](media/configure-single-sign-on-portal/basic-saml-configuration-edit-icon.png)

1. В соответствующих полях введите сведения, описанные в разделе [Перед началом работы](#before-you-begin).

1. В верхней части страницы щелкните **Сохранить**.

## <a name="step-2-configure-user-attributes-and-claims"></a>Шаг 2. Настройка атрибутов пользователя и утверждений 

Приложению могут потребоваться определенные атрибуты пользователя или утверждения в токене SAML, который оно получает из Azure AD при входе пользователя в систему. Например, могут потребоваться конкретные URI утверждений или значения утверждений, а **имя** должно быть отличным от имени пользователя, хранящегося на платформе удостоверений Майкрософт. Требования к приложениям из коллекции описаны в [руководствах для конкретных приложений](../saas-apps/tutorial-list.md), либо можно обратиться к поставщику приложения. Ниже приведены общие действия по настройке атрибутов пользователей и утверждений.

1. В разделе **Атрибуты пользователя и утверждения** выберите значок **Изменить** (карандаш) в правом верхнем углу.

1. Проверьте **значение идентификатора имени**. Значение по умолчанию — *user.principalname*. Идентификатор пользователя является уникальным идентификатором для каждого пользователя в приложении. Например, если адрес электронной почты является и именем пользователя, и уникальным идентификатором, задайте значение *user.mail*.

1. Чтобы изменить **значение идентификатора имени**, щелкните значок **Изменить** (карандаш) рядом с полем **Значение идентификатора имени**. Если потребуется, внесите соответствующие изменения в формат идентификатора и источник. Дополнительные сведения см. в разделе [Изменение NameID](https://docs.microsoft.com/azure/active-directory//develop/active-directory-saml-claims-customization#editing-nameid). Сохраните изменения, когда все будет готово. 
 
1. Чтобы настроить утверждения группы, выберите значок **Изменить** для поля **Groups returned in claim** (Группы, возвращенные в утверждении). Дополнительные сведения см. в статье о [настройке утверждений групп](../hybrid/how-to-connect-fed-group-claims.md).

3. Чтобы добавить утверждение, щелкните **Добавить новое утверждение** в верхней части страницы. Введите **Имя** и выберите соответствующий источник. Если вы выберете источник **Атрибут**, следует выбрать требуемый **Атрибут источника**. Если вы выберете источник **Перевод**, следует выбрать требуемые значения параметров **Преобразование** и **Параметр 1**. Дополнительные сведения см. в разделе [Добавление утверждений для конкретного приложения](https://docs.microsoft.com/azure/active-directory//develop/active-directory-saml-claims-customization#adding-application-specific-claims). Сохраните изменения, когда все будет готово. 

4. Щелкните **Сохранить**. В таблице появится новое утверждение.

   > [!NOTE]
   > Дополнительные способы настройки токена SAML из Azure AD в приложение см. в следующих ресурсах.
   >- Сведения о создании пользовательских ролей с помощью портала Azure см. в статье о [настройке утверждений роли](../develop/active-directory-enterprise-app-role-management.md).
   >- Сведения о настройке утверждений с помощью PowerShell см. в статье о [настройке утверждений в PowerShell](../develop/active-directory-claims-mapping.md).
   >- Сведения об изменении манифеста приложения для настройки необязательных утверждений для вашего приложения см. в [этой статье](../develop/active-directory-optional-claims.md).
   >- Сведения о настройке политик времени жизни маркера для маркеров обновления, доступа, сеансов и идентификатора см. в статье [Configurable token lifetimes in Azure Active Directory (Preview)](../develop/active-directory-configurable-token-lifetimes.md) (Время существования маркеров с возможностью настройки в Azure Active Directory (предварительная версия)). Сведения об ограничении сеансов проверки подлинности с помощью условного доступа Azure AD см. в [этой статье](https://go.microsoft.com/fwlink/?linkid=2083106).

## <a name="step-3-manage-the-saml-signing-certificate"></a>Шаг 3. Управление сертификатом для подписи SAML

Azure AD использует сертификат для подписи токенов SAML, отправляемых в приложение. На странице **Настройка единого входа с помощью SAML** можно просмотреть или скачать активный сертификат. Вы также можете обновить, создать или импортировать сертификат. Сведения о формате сертификата для приложений из коллекции доступны в документации по SAML приложения (ознакомьтесь с [руководствами для конкретных приложений](../saas-apps/tutorial-list.md)). 

1. Перейдите в раздел **Сертификат подписи SAML**. В зависимости от типа приложения вы увидите параметры для скачивания сертификата в формате Base64, формате RAW или XML-файла метаданных федерации. Azure AD также предоставляет **URL-адрес метаданных федерации приложений**, в котором можно получить доступ к метаданным, уникальным для приложения, в формате `https://login.microsoftonline.com/<Directory ID>/federationmetadata/2007-06/federationmetadata.xml?appid=<Application ID>`.

1. Чтобы создать, импортировать сертификат или управлять им, щелкните значок **Изменить** (карандаш) в правом верхнем углу раздела **Сертификат подписи SAML**, а затем выполните одно из следующих действий.

   - Чтобы создать сертификат, выберите **Новый сертификат**, **Дата окончания срока действия**, а затем нажмите кнопку **Сохранить**. Чтобы активировать сертификат, выберите контекстное меню ( **...** ) и пункт **Активировать сертификат**.
   - Чтобы отправить сертификат с закрытым ключом и учетными данными PFX, выберите **Импорт сертификата** и перейдите к сертификату. Введите **пароль PFX**, а затем щелкните **Добавить**.  
   - Чтобы настроить дополнительные параметры подписи сертификатов, используйте следующие параметры. Описание этих параметров см. в статье [Advanced certificate signing options in the SAML token for gallery apps in Azure Active Directory](certificate-signing-options.md) (Расширенные параметры подписи сертификата в маркере SAML для приложений коллекции в Azure Active Directory).
      - В раскрывающемся списке **Вариант подписывания** выберите **Ответ знака SAML**, **Утверждение знака SAML** или **Ответ знака SAML и утверждение**.
      - В раскрывающемся списке **Алгоритм подписывания** выберите **SHA-1** или **SHA-256**.
   - Чтобы уведомить дополнительных пользователей о том, что срок действия активного сертификата скоро истечет, введите адреса электронной почты в полях **Адреса электронной почты для уведомлений**.

1. Щелкните **Сохранить** в верхней части раздела **Сертификат подписи SAML**. 

## <a name="step-4-set-up-the-application-to-use-azure-ad"></a>Шаг 4. Настройка использования Azure AD в приложении

В разделе **Настройка \<applicationName>** приведены значения, которые необходимо настроить в приложении, чтобы Azure AD использовался в качестве поставщика удостоверений SAML. Необходимые значения зависят от приложения. Дополнительные сведения см. в документации к SAML приложения.

1. Прокрутите вниз до раздела **Настройка \<applicationName>** . 
2. При необходимости скопируйте значение из каждой строки в этом разделе и следуйте инструкциям конкретного приложения по добавлению значения в приложение. Для приложений из коллекции можно просмотреть документацию, выбрав **Просмотреть пошаговые инструкции**. 
   - Значения **URL-адрес входа** и **URL-адрес выхода** указывают на одну конечную точку, то есть на конечную точку обработки запроса SAML для вашего экземпляра Azure AD. 
   - **Идентификатор Azure AD** — это значение **издателя** в токене SAML, выданном приложению.
1. Завершив перенос значений в нужные поля, щелкните **Сохранить**.

## <a name="step-5-validate-single-sign-on"></a>Шаг 5. Проверка единого входа

Теперь все готово к тестированию параметров, чтобы узнать, работает ли единый вход для администратора.  

1. Откройте параметры единого входа для приложения. 
2. Прокрутите страницу до раздела **Validate single sign-on with <applicationName>** (Проверка единого входа с помощью). В этом руководстве этот раздел называется **Настройка GitHub-test**.
3. Выберите **Тест**. Отобразятся параметры тестирования.
4. Выберите **Войдите от имени текущего пользователя**. 

Если вход выполнен успешно, можно приступить к назначению пользователей и групп для приложения SAML.
Если появится сообщение об ошибке, сделайте следующее:

1. Скопируйте и вставьте сведения об ошибке в поле **Как выглядит ошибка**.

    ![С помощью окна What does the error look like (Описание ошибки) можно получить инструкции по устранению проблемы.](media/configure-single-sign-on-portal/error-guidance.png)

1. Щелкните **Получить рекомендации по устранению**. Отобразятся сведения о причине ошибки и рекомендации по ее устранению.  В этом примере пользователь не был назначен приложению.
1. Прочтите рекомендации по разрешению и устраните проблему, если возможно.
1. Выполните проверку еще раз, чтобы она завершилась успешно.

## <a name="next-steps"></a>Дальнейшие действия

- [Assign users and groups to an application in Azure Active Directory](methods-for-assigning-users-and-groups.md) (Назначение пользователей и групп для приложения в Azure Active Directory)
- [Managing user account provisioning for enterprise apps in the Azure portal](../app-provisioning/configure-automatic-user-provisioning-portal.md) (Управление подготовкой учетных записей пользователей для корпоративных приложений на портале Azure)
