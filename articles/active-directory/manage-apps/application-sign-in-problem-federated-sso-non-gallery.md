---
title: Проблемы при входе в приложение федеративного единого входа не из коллекции
description: Рекомендации по конкретным проблемам при входе в приложение, для которого настроен федеративный единый вход на базе SAML с помощью Azure AD
services: active-directory
documentationcenter: ''
author: kenwith
manager: celestedg
ms.assetid: ''
ms.service: active-directory
ms.subservice: app-mgmt
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: troubleshooting
ms.date: 07/11/2017
ms.author: kenwith
ms.reviewer: asteen
ms.collection: M365-identity-device-management
ms.openlocfilehash: e72ed9ef43fd1222592e7f88d4e3a6e998c59d2d
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "84759085"
---
# <a name="problems-signing-in-to-a-non-gallery-application-configured-for-federated-single-sign-on"></a>Проблемы с входом в приложение не из коллекции, для которого настроен федеративный единый вход

Чтобы устранить проблемы при входе ниже, мы рекомендуем использовать эти предложения, чтобы получить лучшую диагностику и автоматизировать действия по устранению:

- Установите [расширение "Мои приложения" для безопасного браузера](access-panel-extension-problem-installing.md) , чтобы помочь Azure Active Directory (Azure AD), чтобы обеспечить лучшую диагностику и разрешения при использовании тестирования в портал Azure.
- Воспроизведите ошибку с помощью интерфейса тестирования на странице настройки приложения в портал Azure. Дополнительные сведения об [отладке приложений единого входа на основе SAML](../azuread-dev/howto-v1-debug-saml-sso-issues.md)

## <a name="application-not-found-in-directory"></a>Приложение не найдено в каталоге

*Ошибка AADSTS70001: приложение с идентификатором `https://contoso.com` не найдено в каталоге*.

**Возможные причины**

Атрибут Issuer, отправляемый из приложения в Azure AD в запросе SAML, не соответствует значению идентификатора, настроенному в приложении Azure AD.

**Решение**

Убедитесь, что `Issuer` атрибут в запросе SAML соответствует значению идентификатора, настроенному в Azure AD. Если вы используете [опыт тестирования](../azuread-dev/howto-v1-debug-saml-sso-issues.md) в портал Azure с расширением "Защищенный браузер" Мои приложения ", вам не нужно вручную выполнять эти действия.

1. Откройте [**портал Azure**](https://portal.azure.com/) и войдите в систему как **глобальный администратор** или **Соадминистратор.**

2. Откройте **расширение Azure Active Directory**, щелкнув **Все службы** в верхней части главного меню навигации слева.

3. В поле фильтра поиска введите **Azure Active Directory** и выберите элемент **Azure Active Directory**.

4. В меню навигации Azure Active Directory слева выберите **Корпоративные приложения**.

5. Щелкните **Все приложения**, чтобы открыть полный список приложений.

   * Если нужное приложение отсутствует в списке, в верхней части списка **Все приложения** воспользуйтесь элементом управления **Фильтр**, указав в нем для параметра **Показать** значение **Все приложения**.

6. Выберите приложение, для которого нужно настроить единый вход.

7. После загрузки приложения выберите пункт **Единый вход** в меню навигации этого приложения слева.

8. После загрузки приложения щелкните **Базовая конфигурация SAML**. Убедитесь, что значение в текстовом поле идентификатор совпадает со значением идентификатора, отображаемого в ошибке.

## <a name="the-reply-address-does-not-match-the-reply-addresses-configured-for-the-application"></a>Адрес ответа не соответствует адресам ответа, настроенным для приложения. 

*Ошибка AADSTS50011: адрес ответа `https://contoso.com` не совпадает с адреса ответа, настроенного для приложения* 

**Возможные причины** 

Значение AssertionConsumerServiceURL в запросе SAML не соответствует значению URL-адреса ответа или шаблону, настроенному в Azure AD. Значение AssertionConsumerServiceURL в запросе SAML является URL-адресом, отображаемым в сообщении об ошибке. 

**Решение** 

Убедитесь, что `Issuer` атрибут в запросе SAML соответствует значению идентификатора, настроенному в Azure AD. Если вы используете [опыт тестирования](../azuread-dev/howto-v1-debug-saml-sso-issues.md) в портал Azure с расширением "Защищенный браузер" Мои приложения ", вам не нужно вручную выполнять эти действия.
 
1. Откройте [**портал Azure**](https://portal.azure.com/) и войдите в систему как **глобальный администратор** или **Соадминистратор.** 

2. Откройте **расширение Azure Active Directory**, щелкнув **Все службы** в верхней части главного меню навигации слева. 

3. В поле фильтра поиска введите **Azure Active Directory** и выберите элемент **Azure Active Directory**. 

4. В меню навигации Azure Active Directory слева выберите **Корпоративные приложения**. 

5. Щелкните **Все приложения**, чтобы открыть полный список приложений. 

   * Если нужное приложение не отображается здесь, используйте элемент управления **Фильтр** в верхней части **списка все приложения** и задайте для параметра **Показать** значение **все приложения.**
  
6. Выберите приложение, для которого нужно настроить единый вход.

7. После загрузки приложения выберите пункт **Единый вход** в меню навигации этого приложения слева.

8. После загрузки приложения щелкните **Базовая конфигурация SAML**. Проверьте или обновите значение в текстовом поле URL-адрес ответа, чтобы оно совпадало со `AssertionConsumerServiceURL` значением в запросе SAML.    
    
После обновления значения URL-адреса ответа в Azure AD, которое соответствует значению, отправленному приложением в запросе SAML, вы сможете войти в приложение.

## <a name="user-not-assigned-a-role"></a>Не назначена роль пользователя

*Ошибка AADSTS50105: пользователь, выполнивший вход, `brian\@contoso.com` не назначен роли для приложения*

**Возможные причины**

Пользователю не предоставлен доступ к приложению в Azure AD.

**Решение**

Чтобы напрямую назначить одного или нескольких пользователей приложению, выполните следующие действия. Если вы используете [опыт тестирования](../azuread-dev/howto-v1-debug-saml-sso-issues.md) в портал Azure с расширением "Защищенный браузер" Мои приложения ", вам не нужно вручную выполнять эти действия.

1. Откройте [**портал Azure**](https://portal.azure.com/) и войдите в систему как **глобальный администратор**.

2. Откройте **расширение Azure Active Directory**, щелкнув **Все службы** в верхней части главного меню навигации слева.

3. В поле фильтра поиска введите **Azure Active Directory** и выберите элемент **Azure Active Directory**.

4. В меню навигации Azure Active Directory слева выберите **Корпоративные приложения**.

5. Щелкните **Все приложения**, чтобы открыть полный список приложений.

   * Если нужное приложение отсутствует в списке, в верхней части списка **Все приложения** воспользуйтесь элементом управления **Фильтр**, указав в нем для параметра **Показать** значение **Все приложения**.

6. Выберите из списка приложение, которое необходимо назначить пользователю.

7. После загрузки приложения в меню навигации слева щелкните **Пользователи и группы**.

8. В верхней части списка **Пользователи и группы** нажмите кнопку **Добавить**, чтобы открыть область **Добавление назначения**.

9. В области **Добавление назначения** щелкните **Пользователи и группы**.

10. В поле поиска **Поиск по имени или адресу электронной почты** введите **полное имя** или **адрес электронной почты** пользователя, которого требуется назначить.

11. Наведите указатель мыши на **пользователя** в списке, чтобы отобразить **флажок**. Чтобы добавить пользователя в список **Выбрано**, установите флажок рядом с фотографией или логотипом профиля этого пользователя.

12. **Необязательно**. Если вы хотите **добавить более одного пользователя**, в поле **Поиск по имени или адресу электронной почты** введите **полное имя** или **адрес электронной почты** другого пользователя и установите флажок, чтобы добавить этого пользователя в список **Выбрано**.

13. Выбрав всех пользователей, щелкните **Выбрать**, чтобы добавить их в список пользователей и групп, которые будут назначены для приложения.

14. **Необязательно.** В области **Добавление назначения** щелкните **Выбор ролей**, чтобы выбрать роль, которая будет назначена указанным пользователям.

15. Нажмите кнопку **Назначить**, чтобы назначить приложение выбранным пользователям.

Через некоторое время выбранные пользователи смогут запускать эти приложения с помощью методов, приведенных в описании решения.

## <a name="not-a-valid-saml-request"></a>Недопустимый запрос SAML

*Ошибка AADSTS75005: запрос не является допустимым сообщением протокола Saml2*.

**Возможные причины**

Azure AD не поддерживает запрос SAML, отправленный приложением для единого входа. К наиболее распространенным проблемам относятся:

-   Отсутствие обязательных полей в запросе SAML

-   Метод кодировки запроса SAML

**Решение**

1.  Захватите запрос SAML. Сведения о захвате запроса SAML см. в учебнике [Отладка единого входа на основе SAML в приложения в Azure Active Directory](https://docs.microsoft.com/azure/active-directory/develop/active-directory-saml-debugging).

2.  Свяжитесь с разработчиком приложения и передайте ему следующее:

    -   Запрос SAML

    -   [Требования к протоколу SAML единого входа в Azure](https://docs.microsoft.com/azure/active-directory/develop/active-directory-single-sign-on-protocol-reference)

Поставщик приложения должен проверить, что он поддерживает реализацию SAML в Azure AD для единого входа.

## <a name="misconfigured-application"></a>Неправильно настроенное приложение

*Ошибка AADSTS650056: неправильно настроенное приложение. Это может быть вызвано одной из следующих проблем: клиент не перечисляет разрешения в запрошенных разрешениях в регистрации приложения клиента. Или администратор не предслал в клиенте. Или проверьте идентификатор приложения в запросе, чтобы убедиться, что он соответствует настроенному идентификатору клиентского приложения. Обратитесь к администратору, чтобы исправить конфигурацию или согласие от имени клиента.*

**Возможные причины**

`Issuer`Атрибут, отправленный из приложения в Azure AD в запросе SAML, не соответствует значению идентификатора, настроенному для приложения в Azure AD.

**Решение**

Убедитесь, что `Issuer` атрибут в запросе SAML соответствует значению идентификатора, настроенному в Azure AD. Если вы используете [опыт тестирования](../azuread-dev/howto-v1-debug-saml-sso-issues.md) в портал Azure с расширением "Защищенный браузер" Мои приложения ", вам не нужно вручную выполнять следующие действия:

1.  Откройте [**портал Azure**](https://portal.azure.com/) и войдите в систему как **глобальный администратор** или **Соадминистратор**.

1.  Откройте **расширение Azure Active Directory** , выбрав **все службы** в верхней части главного меню навигации слева.

1.  В поле фильтра поиска введите **"Azure Active Directory"** и выберите элемент **Azure Active Directory** .

1.  В меню навигации Azure Active Directory слева выберите **корпоративные приложения** .

1.  Выберите **все приложения** , чтобы просмотреть список всех приложений.

    Если нужное приложение не отображается здесь, используйте элемент управления **Фильтр** в верхней части **списка все приложения** и задайте для параметра **Показать** значение **все приложения**.

1.  Выберите приложение, для которого нужно настроить единый вход.

1.  После загрузки приложения щелкните **Базовая конфигурация SAML**. Убедитесь, что значение в текстовом поле идентификатор совпадает со значением идентификатора, отображаемого в ошибке.

## <a name="certificate-or-key-not-configured"></a>Не настроен сертификат или ключ

Ошибка AADSTS50003: не настроен ключ подписывания.

**Возможные причины**

Поврежден объект приложения, и Azure AD не распознает сертификат, настроенный для приложения.

**Решение**

Чтобы удалить и создать сертификат, выполните следующие действия:

1. Откройте [**портал Azure**](https://portal.azure.com/) и войдите в систему как **глобальный администратор** или **Соадминистратор.**

2. Откройте **расширение Azure Active Directory**, щелкнув **Все службы** в верхней части главного меню навигации слева.

3. В поле фильтра поиска введите **Azure Active Directory** и выберите элемент **Azure Active Directory**.

4. В меню навигации Azure Active Directory слева выберите **Корпоративные приложения**.

5. Щелкните **Все приложения**, чтобы открыть полный список приложений.

   * Если нужное приложение отсутствует в списке, в верхней части списка **Все приложения** воспользуйтесь элементом управления **Фильтр**, указав в нем для параметра **Показать** значение **Все приложения**.

6. Выберите приложение, для которого нужно настроить единый вход.

7. После загрузки приложения выберите пункт **Единый вход** в меню навигации этого приложения слева.

8. В разделе **Сертификат подписи SAML** щелкните **Создать сертификат**.

9. Выберите срок действия. Затем нажмите кнопку **Сохранить.**

10. Установите флажок **сделать новый сертификат активным** , чтобы переопределить активный сертификат. Нажмите кнопку **Сохранить** в верхней части области и активируйте сертификат возобновления.

11. В разделе **сертификат подписи SAML** нажмите кнопку **Удалить** , чтобы удалить **неиспользуемый** сертификат.

## <a name="saml-request-not-present-in-the-request"></a>Отсутствие запроса SAML в запросе

*Ошибка AADSTS750054: запроса SAML или SAMLResponse должны присутствовать в качестве параметров строки запроса в HTTP-запросе для привязки перенаправления SAML.*

**Возможные причины**

Azure AD не удалось определить запрос SAML в параметрах URL-адреса в HTTP-запросе. Это может произойти, если приложение не использует привязку перенаправления HTTP при отправке запроса SAML в Azure AD.

**Решение**

Приложению необходимо отправить запрос SAML, закодированный в заголовке Location, с помощью привязки перенаправления HTTP. Дополнительные сведения о реализации см. в разделе о HTTP перенаправлении привязки в документе спецификации протокола SAML [здесь](https://docs.oasis-open.org/security/saml/v2.0/saml-bindings-2.0-os.pdf).

## <a name="azure-ad-is-sending-the-token-to-an-incorrect-endpoint"></a>Azure AD отправляет маркер в неправильную конечную точку

**Возможные причины**

Во время единого входа, если запрос на вход не содержит явно заданного URL-адреса ответа (URL-адрес службы утверждения), Azure AD выберет любой из настроенных URL-адресов для этого приложения. Даже если для приложения настроен явный URL-адрес ответа, пользователь может перенаправить его https://127.0.0.1:444 . 

Когда приложение добавлялось как не входящее в коллекцию, служба Azure Active Directory создавала этот URL-адрес ответа как значение по умолчанию. Эта схема изменена, и теперь Azure Active Directory больше не добавляет по умолчанию этот URL-адрес. 

**Решение**

Удалите неиспользуемые URL-адреса ответа, настроенные для приложения.

1.  Откройте [**портал Azure**](https://portal.azure.com/) и войдите в систему как **глобальный администратор** или **Соадминистратор**.

2.  Откройте **расширение Azure Active Directory** , выбрав **все службы** в верхней части главного меню навигации слева.

3.  В поле фильтра поиска введите **"Azure Active Directory"** и выберите элемент **Azure Active Directory** .

4.  В меню навигации Azure Active Directory слева выберите **корпоративные приложения** .

5.  Выберите **все приложения** , чтобы просмотреть список всех приложений.

    Если нужное приложение не отображается здесь, используйте элемент управления **Фильтр** в верхней части **списка все приложения** и задайте для параметра **Показать** значение **все приложения**.

6.  Выберите приложение, для которого нужно настроить единый вход.

7.  После загрузки приложения щелкните **Базовая конфигурация SAML**. В **URL-адресе ответа (URL-адрес службы утверждения)** удалите неиспользуемые или URL-адреса ответа по умолчанию, созданные системой. Например, `https://127.0.0.1:444/applications/default.aspx`.



## <a name="problem-when-customizing-the-saml-claims-sent-to-an-application"></a>Проблема при настройке утверждений SAML, отправляемых в приложение

Чтобы узнать, как настроить утверждения атрибута SAML, отправляемые в приложение, ознакомьтесь с разделом [Сопоставление утверждений в Azure Active Directory](https://docs.microsoft.com/azure/active-directory/active-directory-claims-mapping).

## <a name="next-steps"></a>Дальнейшие действия
[Требования к протоколу SAML единого входа в Azure](https://docs.microsoft.com/azure/active-directory/develop/active-directory-single-sign-on-protocol-reference)
