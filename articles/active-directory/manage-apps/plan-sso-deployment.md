---
title: Планирование единого развертывания указателей Azure Active
description: Руководство по планированию, развертыванию и управлению SSO в вашей организации.
services: active-directory
author: jeevansd
manager: CelesteDG
ms.service: active-directory
ms.subservice: app-mgmt
ms.topic: conceptual
ms.workload: identity
ms.date: 05/22/2019
ms.author: baselden
ms.reviewer: jeedes
ms.collection: M365-identity-device-management
ms.openlocfilehash: 92496fa572c5c1cae4588f82ac61c18de3024045
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "76512833"
---
# <a name="plan-a-single-sign-on-deployment"></a>Планирование развертывания единого входа

Единый вход (SSO) означает доступ ко всем приложениям и ресурсам, которые необходимы пользователю, восвайв всего один раз с помощью одной учетной записи пользователя. С помощью SSO пользователи могут получить доступ ко всем необходимым приложениям без необходимости проверки подлинности во второй раз.

## <a name="benefits-of-sso"></a>Преимущества SSO

Единый всхот (SSO) добавляет безопасность и удобство при вшивке пользователей в приложения в Active Directory Azure (Azure AD). 

Многие организации полагаются на программное обеспечение в качестве сервисных приложений (SaaS), таких как Office 365, Box и Salesforce, для повышения производительности конечных пользователей. Исторически сложилось так, что ИТ-персоналу требовалось индивидуально создавать и обновлять учетные записи пользователей в каждом приложении SaaS, а пользователям требовалось запоминать пароль для каждого из них.

Azure Marketplace имеет более 3000 приложений с предварительно интегрированными S-интегрированными SSO-соединениями, что позволяет легко интегрировать их в арендатора.

## <a name="licensing"></a>Лицензирование

- **Лицензирование Azure AD** - SSO для предварительно интегрированных приложений SaaS является бесплатным. Однако количество объектов в каталоге и функции, которые вы хотите развернуть, могут потребовать дополнительных лицензий. Полный список лицензионных требований можно узнать в формате [Azure Active Directory Pricing.](https://azure.microsoft.com/pricing/details/active-directory/)
- **Лицензирование приложений** - Для удовлетворения потребностей компании вам потребуются соответствующие лицензии для приложений SaaS. Работайте с владельцем приложения, чтобы определить, имеют ли пользователи, назначенные в приложение, соответствующие лицензии на их роли в приложении. Если Azure AD управляет автоматической подготовкой на основе ролей, роли, назначенные в Azure AD, должны соответствовать количеству лицензий, принадлежащих в приложении. Неправильное количество лицензий, принадлежащих в приложении, может привести к ошибкам при подготовке/обновлении пользователя.

## <a name="plan-your-sso-team"></a>Планируйте свою команду SSO

- **Привлечение нужных заинтересованных сторон** - Когда технологические проекты терпят неудачу, это, как правило, из-за несовпадающих ожиданий в отношении воздействия, результатов и обязанностей. Чтобы избежать этих ловушек, [убедитесь, что вы привлекаете нужных заинтересованных сторон](https://aka.ms/deploymentplans) и чтобы заинтересованные стороны понимали их роль.
- **План связи** - Коммуникация имеет решающее значение для успеха любой новой службы. Проактивно сообщайте пользователям о том, как изменится их опыт, когда он изменится и как получить поддержку, если они испытывают проблемы. Просмотрите параметры доступа [конечных пользователей к приложениям с поддержкой SSO](end-user-experiences.md)и создайте ваши сообщения в соответствии с вашим выбором. 

## <a name="plan-your-sso-protocol"></a>Планирование протокола SSO

Реализация SSO, основанная на протоколах федерации, повышает безопасность, надежность и взаимодействие с конечными пользователями и упрощается в реализации. Многие приложения предварительно интегрированы в Azure AD с [пошаговыми руководствами.](../saas-apps/tutorial-list.md) Вы можете найти их на нашем [рынке Azure.](https://azuremarketplace.microsoft.com/marketplace/) Подробную информацию о каждом методе SSO можно найти в статье [«Единый знак на приложениях» в каталоге Azure Active.](what-is-single-sign-on.md)

Существует два основных способа, с которыми пользователи могут разнорегистрировать свои приложения:

- **С федеративной одной регистрации** Azure AD проверяет подлинность пользователя в приложении, используя свою учетную запись Azure AD. Этот метод поддерживается для приложений, поддерживающих протоколы, такие как SAML 2.0, WS-Federation или OpenID Connect, и является самым богатым способом единого вхождения. Мы рекомендуем использовать Federated SSO с Azure AD, когда приложение поддерживает его, а не на основе паролей SSO и ADFS.

- **С паролем на основе одного знака на** пользователя войти в приложение с именем пользователя и паролем в первый раз, они получают доступ к нему. После первого входа Azure AD предоставляет приложению имя пользователя и пароль. Единый вход на основе пароля позволяет безопасно хранить пароли приложений и воспроизводить его с помощью расширения веб-браузера или мобильного приложения. Эта опция использует существующий процесс вхинга, предоставляемый приложением, позволяет администратору управлять паролями и не требует, чтобы пользователь знал пароль.

### <a name="considerations-for-federation-based-sso"></a>Рассмотрение вопросов для базирующейся в федерации SSO

- **Использование OpenID Connect и OAuth** - Если приложение, к которое вы подключаетесь, поддерживает его, используйте метод OIDC/OAuth 2.0, чтобы включить SSO в это приложение. Этот метод требует меньше конфигурации и позволяет более богатым пользовательским опытом. Для получения дополнительной информации см. [OAuth 2.0,](../develop/v2-oauth2-auth-code-flow.md) [OpenID Connect 1.0](../develop/v2-protocols-oidc.md)и [руководство разработчика Active Directory Azure.](https://docs.microsoft.com/azure/active-directory/develop/active-directory-developers-guide)
- **Конфигурации конечных точек для SSO на основе SAML** - Если вы используете SAML, вашим разработчикам потребуется конкретная информация до настройки приложения. Для получения дополнительной [Edit the Basic SAML Configuration](configure-single-sign-on-non-gallery-applications.md)информации см.
- **Управление сертификатами для SSO на основе SAML** - При включании Federated SSO для вашего приложения Azure AD создает сертификат, который по умолчанию действителен в течение трех лет. При необходимости можно настроить срок действия этого сертификата. Убедитесь, что у вас есть процессы для продления сертификатов до истечения срока их действия. Чтобы узнать больше, смотрите [сертификаты управления Azure AD.](https://docs.microsoft.com/azure/active-directory/active-directory-sso-certs)

### <a name="considerations-for-password-based-sso"></a>Рассмотрение sSO на основе паролей

Использование Azure AD для SSO на основе паролей требует развертывания расширения браузера, которое позволит безопасно получить учетные данные и заполнить формы входа. Определите механизм развертывания расширения в масштабе с [помощью поддерживаемых браузеров.](https://docs.microsoft.com/azure/active-directory/active-directory-saas-access-panel-introduction) Доступные параметры: 

- [Групповая политика для Internet Explorer](https://azure.microsoft.com/documentation/articles/active-directory-saas-ie-group-policy/)
- [Менеджер конфигурации для Internet Explorer](https://docs.microsoft.com/configmgr/core/clients/deploy/deploy-clients-to-windows-computers)
- [Загрузка и конфигурация пользователя для Chrome, Firefox, Microsoft Edge или IE](https://docs.microsoft.com/azure/active-directory/active-directory-saas-access-panel-introduction)

Чтобы узнать больше, [см. Как настроить пароль одного знака на](https://docs.microsoft.com/azure/active-directory/application-config-sso-how-to-configure-password-sso-non-gallery).

#### <a name="capturing-login-forms-metadata-for-applications-that-arent-in-the-gallery"></a>Захват регистрационных форм метаданных для приложений, которые не входят в галерею

Корпорация Майкрософт поддерживает захват метаданных в веб-приложении для свода паролей (захват имен пользователя и полей паролей). Перейдите к URL-адресу входа в систему в процессе настройки приложения для захвата метаданных форм. Запросите у владельца приложения точный URL-адрес входа. Эта информация используется в процессе входиного, отображая учетные данные Azure AD в приложении во время входиний.

Чтобы узнать больше, смотрите [Что такое доступ к приложениям и SSO с Azure AD? - SSO на основе паролей](https://azure.microsoft.com/documentation/articles/active-directory-appssoaccess-whatis/).

#### <a name="indications-that-metadata-in-forms-needs-to-be-recaptured"></a>Показания, которые метаданные в формах должны быть повторно

При изменении html-макета приложениям может потребоваться повторное воспроизведение метаданных для настройки изменений. Общие симптомы, указывающие на изменение формата HTML:

- Пользователи сообщают, что нажатие на приложение "застряло" на странице входа
- Пользователи сообщают, что имя пользователя или пароль не заселены

#### <a name="shared-accounts"></a>Общие учетные записи

С точки зрения входе приложения с общими учетными записями не отличаются от приложения галереи, использующее пароль SSO для отдельных пользователей. Однако при планировании и настройке приложения, предназначенного для использования общих учетных записей, требуется ряд дополнительных шагов:

1. Работайте с бизнес-пользователями приложений, чтобы задокументировать следующее:
   1. Набор пользователей в организации, которые будут использовать приложение
   1. Существующий набор учетных данных в приложении, связанный с набором пользователей 
1. Для каждой комбинации наборов пользователей и учетных данных создайте группу безопасности в облаке или на предпосылке в соответствии с вашими требованиями.
1. Сбросить общие учетные данные. После развертывания приложения в Azure AD пользователям не нужен пароль общей учетной записи. Поскольку Azure AD будет хранить пароль, подумайте о том, чтобы установить его очень длинным и сложным. 
1. Назначайте автоматическое опрокидывание пароля, если приложение поддерживает его. Таким образом, даже администратор, который сделал первоначальную настройку, не будет знать пароль общей учетной записи. 

## <a name="plan-your-authentication-method"></a>Планирование метода проверки подлинности

Выбор правильного метода аутентификации является основным первым решением при настройке решения для гибридной идентификации Azure AD. Реализация метода аутентификации настраивается с помощью Azure AD Connect, что также дает возможность подготовить пользователей в облаке.

Чтобы выбрать метод аутентификации, необходимо учитывать время, имеющуюся инфраструктуру, сложность и стоимость реализации решения. Эти факторы отличаются для каждой организации и могут изменяться с течением времени. Вы должны выбрать тот, который наиболее точно соответствует вашему конкретному сценарию. Для получения дополнительной информации ознакомьтесь с тем, что [выберите правильный метод проверки подлинности для решения гибридной идентификации Azure Active Directory.](https://docs.microsoft.com/azure/security/fundamentals/choose-ad-authn)

## <a name="plan-your-security-and-governance"></a>Планируйте свою безопасность и управление 

Идентичность является новым основным стержнем для внимания безопасности и инвестиций, поскольку периметры сети становятся все более пористой и менее эффективной с взрывом устройств BYOD и облачных приложений. 

### <a name="plan-access-reviews"></a>Планирование обзоров доступа

[Обзоры доступа](https://docs.microsoft.com/azure/active-directory/governance/create-access-review) позволяют организациям эффективно управлять членством в группах, доступом к корпоративным приложениям и назначениям ролей. Вы должны планировать регулярное просмотр доступа пользователей, чтобы убедиться, что только нужные люди имеют постоянный доступ.

Некоторые из ключевых тем, которые необходимо планировать при настройке обзоров доступа, включают:

1. Определение каденции для проверки доступа, которая соответствует вашим потребностям бизнеса. Это может быть так часто, как один раз в неделю, ежемесячно, ежегодно, или как по требованию упражнения.

1. Создавайте группы, представляющие рецензентов отчетов о доступе к приложениям. Необходимо убедиться, что заинтересованные стороны, наиболее знакомые с приложением и его целевыми пользователями, являются участниками ваших обзоров доступа

1. Завершение проверки доступа включает в себя отобрать разрешения на доступ к приложениям пользователям, которые больше не нуждаются в доступе. План ируйтесь обработки потенциальных запросов на поддержку от отклонимых пользователей. Удаленный пользователь будет оставаться удаленным в Azure AD в течение 30 дней, в течение которых он может быть восстановлен администратором в случае необходимости. По истечении 30 дней пользователь будет окончательно удален. Используя портал Active Directory Azure, Глобальный администратор может явно навсегда удалить недавно удаленного пользователя до достижения этого периода времени.

### <a name="plan-auditing"></a>План аудита

Azure AD предоставляет [отчеты, содержащие технические и бизнес-идеи.](https://azure.microsoft.com/documentation/articles/active-directory-view-access-usage-reports/) 

Доступны отчеты о безопасности и действиях. Отчеты о безопасности показывают, что пользователи помечены как подверженные риску, и рискованные входы. Отчеты о действиях помогают вам понять поведение пользователей в вашей организации, подробно описывая активность входа и предоставляя аудиторские следы всех логинов. Отчеты можно использовать для управления рисками, повышения производительности и мониторинга соответствия требованиям.

| Тип отчета | Обзор доступа | Отчеты о безопасности | Отчет о входном весенем восподписании |
|-------------|---------------|------------------|----------------|
| Использование для просмотра | Разрешения и использование приложений. | Потенциально скомпрометированные учетные записи | Кто получает доступ к приложениям |
| Потенциальные действия | Доступ к аудиту; аннулировать разрешения | Отмена доступа; силы безопасности сбросить | «Отозвать доступ» |

Azure AD сохраняет большинство аудиторских данных в течение 30 дней и делает данные доступными через портал admin Azure или через API для загрузки в системы анализа.

### <a name="consider-using-microsoft-cloud-application-security"></a>Рассмотрите возможность использования службы облачных приложений Майкрософт

Microsoft Cloud App Security (MCAS) — решение для обеспечения безопасности доступа в облачный доступ (CASB). Он обеспечивает видимость ваших облачных приложений и служб, предоставляет сложную аналитику для выявления и борьбы с киберугрозами, а также позволяет контролировать, как ваши данные перемещается.

Развертывание MCAS позволяет:

- Используйте Cloud Discovery для картирования и идентификации облачной среды и облачных приложений, используемых организацией.
- Санкционные и несанкционные приложения в вашем облаке
- Используйте простые для развертывания разъемы приложений, которые используют преимущества aI-класса поставщика, для видимости и управления приложениями, к которым вы подключаетесь
- Используйте защиту условного доступа App Control, чтобы получить видимость в режиме реального времени и контроль над доступом и действиями в облачных приложениях
- Помогает вам иметь непрерывный контроль, устанавливая, а затем постоянно тонкой настройки, политики.

Управление сеансом Microsoft Cloud Application Security (MCAS) доступно для любого браузера на любой крупной платформе любой операционной системы. Мобильные и классические приложения также можно добавлять в список заблокированных или разрешенных. При интеграции с Azure AD можно поддерживать любые приложения, настроенные с SAML, или open ID Connect с одним включением в Azure AD, включая [несколько приложений.](https://docs.microsoft.com/cloud-app-security/proxy-intro-aad)

Для получения информации о [Microsoft Cloud App Security overview](https://docs.microsoft.com/cloud-app-security/what-is-cloud-app-security)MCAS, см. MCAS — это служба подписки на пользователей. Вы можете просмотреть сведения о лицензировании в [листе данных лицензирования MCAS.](https://query.prod.cms.rt.microsoft.com/cms/api/am/binary/RE2NXYO)

### <a name="use-conditional-access"></a>Использование условного доступа

С помощью Условия доступа можно автоматизировать решения по управлению доступом на основе критериев для облачных приложений.

Политики условного доступа применяются после того, как пользователь прошел однофакторную аутентификацию. Таким образом, Условный доступ не предназначен в качестве защиты первой линии для таких сценариев, как атаки типа "отказ в обслуживании" (DoS), но может использовать сигналы этих событий для определения доступа. Например, можно использовать уровень риска ввне, расположение запроса и так далее. Для получения дополнительной информации об условном доступе смотрите [обзор](https://docs.microsoft.com/azure/active-directory/conditional-access/plan-conditional-access) и [план развертывания.](https://docs.microsoft.com/azure/active-directory/conditional-access/plan-conditional-access)

## <a name="azure-sso-technical-requirements"></a>Технические требования Azure SSO

В следующем разделе подробно описаны требования к настройке конкретного приложения, включая необходимую среду (ы), конечные точки, картографирование претензий, требуемые атрибуты, сертификаты и используемые протоколы. Эта информация необходима для настройки SSO на [портале Azure AD.](https://portal.azure.com/)

### <a name="authentication-mechanism-details"></a>Детали механизма аутентификации

Для всех предварительно интегрированных приложений SaaS корпорация Майкрософт предоставляет учебник, и вам не понадобится эта информация. Если приложение не на нашем рынке приложений / галерея, возможно, потребуется собрать следующие части данных:

- **Текущий поставщик идентификационных данных приложение использует для SSO, если это применимо** - Например: AD FS, PingFederate, Okta
- **Протоколы, поддерживаемые целевой заявкой** - Например, SAML 2.0, OpenID Connect, OAuth, Forms-based Auth, WS-Fed, WS-Trust
- **Протокол настраивается с Azure AD** - Например, SAML 2.0 или 1.1, OpenID Connect, OAuth, Forms-based, WS-Fed

### <a name="attribute-requirements"></a>Требования к атрибутам

Между объектами пользователя Azure AD и каждым пользовательским объектом приложения SaaS имеется предварительно настроенный набор атрибутов и отображений атрибутов. Некоторые приложения управляют другими типами объектов, таких как группы. Запланируйте отображение атрибутов пользователя из Azure AD в приложении и [настройте отображение атрибутов по умолчанию](https://docs.microsoft.com/azure/active-directory/manage-apps/customize-application-attributes) в соответствии с потребностями компании.

### <a name="certificate-requirements"></a>Требования к сертификатам

Сертификат приложения должен быть актуальным, иначе есть риск того, что пользователи не смогут получить доступ к приложению. Большинство сертификатов приложений SaaS хороши в течение 36 месяцев. Вы изменяете продолжительность сертификата в лезвии приложения. Убедитесь в том, чтобы документировать срок действия и знать, как вы будете управлять обновлением сертификата. 

Существует два способа управления сертификатами. 

- **Автоматическое опрокидывание сертификатов** - Корпорация Майкрософт поддерживает [опрокидывание ключей в Azure AD.](https://docs.microsoft.com/azure/active-directory/develop/active-directory-signing-key-rollover) Хотя это наш предпочтительный метод управления сертификатами, не все ISV поддерживает этот сценарий.

- **Ручное обновление** - Каждое приложение имеет свой собственный сертификат, срок действия которого истекает в зависимости от того, как он определен. До истечения срока действия сертификата у приложения создайте новый сертификат и отправьте его в ISV. Эта информация может быть извлечена из метаданных федерации. [Подробнее о метаданных Федерации читайте здесь.](https://docs.microsoft.com/azure/active-directory/develop/active-directory-federation-metadata)

## <a name="implement-sso"></a>Реализация SSO

Используйте следующие этапы для планирования и развертывания решения в организации:

### <a name="user-configuration-for-sso"></a>Конфигурация пользователя для SSO

- **Определите пользователей тестов**

   Свяжитесь с владельцем приложения и попросите их создать в приложении как минимум трех тестовых пользователей. Обеспечьте правильное заполнение информации, которую вы будете использовать в качестве основного идентификатора, и сопосмотреть атрибут, доступный в Azure AD. В большинстве случаев это будет карта "NameID" для SAML-приложений. Для токенов JWT это "preferred_username".
   
   Создавайте пользователя в Azure AD вручную в качестве облачного пользователя или синхронизируйте пользователя с предварительной с помощью движка синхронизации Azure AD Connect. Убедитесь, что информация соответствует претензиям, направляемым в приложение.

- **Настройка единого входа**

   Из [списка приложений,](https://docs.microsoft.com/azure/active-directory/active-directory-saas-tutorial-list)найти и открыть sSO учебник для вашего приложения, а затем следовать шагам учебника, чтобы успешно настроить приложение SaaS.

   Если вы не можете найти свое приложение, смотрите [документацию пользовательского приложения](https://docs.microsoft.com/azure/active-directory/application-config-sso-how-to-configure-federated-sso-non-gallery). Это поможет вам о том, как добавить приложение, которое не находится в галерее Azure AD.

   В качестве опционов можно использовать требования, выданные в токене SAML для корпоративного приложения, используя [документацию руководства корпорации Майкрософт.](https://docs.microsoft.com/azure/active-directory/active-directory-claims-mapping) Убедитесь, что это карты к тому, что вы ожидаете получить в samL ответ для вашего приложения. Если вы столкнулись с проблемами во время конфигурации, воспользуйтесь нашим руководством о [том, как отладить интеграцию SSO.](https://docs.microsoft.com/azure/active-directory/develop/active-directory-saml-debugging)

Пользовательское приложение на борту является функция Azure AD Premium P1 или P2 лицензий.

### <a name="provide-sso-change-communications-to-end-users"></a>Предоставление SSO изменения связи для конечных пользователей

Реализуйте свой план общения. Убедитесь, что вы даете вашим конечным пользователям знать, что изменения идут, когда он прибыл, что делать сейчас, и как обратиться за помощью.

### <a name="verify-end-user-scenarios-for-sso"></a>Проверка сценариев конечных пользователей для SSO

Вы можете использовать следующие тестовые случаи для проведения тестов на корпоративных и личных устройствах, чтобы убедиться, что конфигурации SSO работают в соответствии с ожиданиями. Сценарии ниже предполагают, что пользователь перемещается по URL-адресу приложения и проходит через поток аутентификации, инициированный поставщиком услуг (SP-инициированный auth flow).

| Сценарий | Ожидаемый результат по потоку SP-инициированных auth пользователем |
|----------|---------------------------------------------------|
| Войти в приложение с IE в то время как на corpnet. | Интегрированная аутентификация Windows (IWA) происходит без каких-либо дополнительных запросов. |
| Войти в приложение с IE в то время как от corpnet с новой попыткой входа. | Подсказка на основе форм на AD FS Server. Пользователь успешно входит в систему и браузер подсказок для МИД. |
| Войти в приложение с IE в то время как вне corpnet с текущей сессии и никогда не выполняется МИД. | Пользователь не получает запрос для первого фактора. Пользователь получает запрос для МИД. |
| Войти в приложение с IE в то время как вне corpnet с текущей сессии и уже выполняется МИД в этой сессии. | Пользователь не получает запрос для первого фактора. Пользователь не получает МИД. Пользователь SSOs в приложение. |
| Войти в приложение с Chrome /Firefox/Safari в то время как от corpnet с текущей сессии и уже выполняется МИД в этой сессии. | Пользователь не получает запрос для первого фактора. Пользователь не получает МИД. Пользователь SSO в приложение. |
| Войти в приложение с Chrome /Firefox/Safari в то время как от corpnet с новой попыткой входа. | Подсказка на основе форм на AD FS Server. Пользователь успешно входит в систему и браузер подсказок для МИД. |
| Войти в приложение с Chrome / Firefox в то время как на корпоративной сети с текущей сессии. | Пользователь не получает запрос для первого фактора. Пользователь не получает МИД. Пользователь SSO в приложение. |
| Войти в приложение с приложением мобильное приложение с новой попыткой входа. | Подсказка на основе форм на AD FS Server. Пользователь успешно входит в систему и ADAL клиент подсказывает для МИД. |
| Несанкционированный пользователь пытается войти в приложение с URL-адресом входа. | Подсказка на основе форм на AD FS Server. Пользователь не может войти с первым фактором. |
| Авторизованный пользователь пытается войти в систему, но вводит неправильный пароль. | Пользователь переходит на URL-адрес приложения и получает плохую ошибку имени пользователя/паролей. |
| Авторизованный пользователь нажимает на ссылку в электронном письме и уже проверяется. | Пользователь нажимает на URL и подписывается в приложение без каких-либо дополнительных запросов. |
| Авторизованный пользователь нажимает на ссылку в электронном письме и еще не проверен. | Пользователь нажимает на URL и вызывает возможность проверки подлинности с помощью первого фактора. |
| Авторизованный пользователь входит в приложение с приложением мобильного приложения (SP-по инициативе) с новой попыткой входа. | Подсказка на основе форм на AD FS Server. Пользователь успешно входит в систему и ADAL клиент подсказывает для МИД. |
| Несанкционированный пользователь пытается войти в приложение с URL-адресом входа (SP-инициированный). | Подсказка на основе форм на AD FS Server. Пользователь не может войти с первым фактором. |
| Авторизованный пользователь пытается войти в систему, но вводит неправильный пароль.| Пользователь переходит на URL-адрес приложения и получает плохую ошибку имени пользователя/паролей. |
| Авторизованный пользователь вырегистрируется, а затем снова входит в систему. | Если URL-адрес регистрации настроен, пользователь вырегистрируется из всех служб и подскажет аутентификации. |
| Авторизованный пользователь вырегистрируется, а затем снова входит в систему. | Если URL-адрес Регистрации не настроен, пользователь будет автоматически зарегистрирован обратно в использовании существующего маркера из существующей сессии браузера Azure AD. |
| Авторизованный пользователь нажимает на ссылку в электронном письме и уже проверяется. | Пользователь нажимает на URL и подписывается в приложение без каких-либо дополнительных запросов. |
| Авторизованный пользователь нажимает на ссылку в электронном письме и еще не проверен. | Пользователь нажимает на URL и вызывает возможность проверки подлинности с помощью первого фактора. |

## <a name="manage-sso"></a>Управление SSO

В этом разделе излагаются требования и рекомендации по успешному управлению SSO.

### <a name="required-administrative-roles"></a>Обязательные административные функции

Всегда используйте роль с наименьшим количеством разрешений, доступных для выполнения требуемой задачи в каталоге Azure Active. Корпорация Майкрософт рекомендует [просмотреть различные доступные роли](https://docs.microsoft.com/azure/active-directory/active-directory-assign-admin-roles-azure-portal) и выбрать правильный, чтобы решить ваши потребности для каждого персоны для этого приложения. Некоторые роли могут быть применены временно и удалены после завершения развертывания.

| Персоной| Роли | Роль Azure AD (при необходимости) |
|--------|-------|-----------------------------|
| Администратор справочной службы | Поддержка уровня 1 | None |
| Админ идентификации | Настройка и отладка при воздействии проблем на Azure AD | глобальный администратор; |
| Админ приложения | Подтверждение пользователя в приложении, конфигурация на пользователях с разрешениями | None |
| Админы инфраструктуры | Владелец опрокидывания cert | глобальный администратор; |
| Владелец бизнеса/акционер | Подтверждение пользователя в приложении, конфигурация на пользователях с разрешениями | None |

Мы рекомендуем использовать [Privileged Identity Management](https://docs.microsoft.com/azure/active-directory/active-directory-privileged-identity-management-configure) (PIM) для управления ролями для проведения дополнительного аудита, контроля и проверки доступа для пользователей с разрешениями каталогов.

### <a name="sso-certificate-lifecycle-management"></a>Управление жизненным циклом сертификата SSO

Важно определить правильные роли и списки рассылки электронной почты, которым поручено управлять жизненным циклом сертификата подписи между Azure AD и приложением, настроенным с одним вданным. Вот некоторые из ключевых ролей, которые мы рекомендуем иметь на месте:

- Владелец для обновления свойств пользователей в приложении
- Владелец On-Call для поддержки разрыва приложения/исправления
- Тщательно отслеживаемый список рассылки электронной почты для уведомлений об изменениях, связанных с сертификатом

Максимальный срок действия сертификата составляет три года. Рекомендуем создать процесс, как вы будете обрабатывать изменения сертификата между Azure AD и вашим приложением. Это может помочь предотвратить или свести к минимуму сбой из-за истечения срока действия сертификата или опрокидывания сертификата.

### <a name="rollback-process"></a>Процесс отката

После завершения тестирования на основе тестовых случаев пришло время перейти в производство с вашим приложением. Переход к производству означает, что вы будете реализовывать запланированные и проверенные конфигурации в производственном арендаторе и раскатывать их для пользователей. Однако важно планировать, что делать в случае, если развертывание не идет по плану. Если конфигурация SSO выходит из строя во время развертывания, необходимо понять, как уменьшить любое отключение и уменьшить воздействие на пользователей.

Наличие методов аутентификации в приложении будет определять вашу лучшую стратегию. Всегда убедитесь, что у вас есть подробная документация для владельцев приложений о том, как именно вернуться к исходной конфигурации входа в случае, если развертывание сталкивается с проблемами.

- **Если приложение поддерживает несколько поставщиков идентификационных данных,** например LDAP и AD FS и Ping, не удаляйте существующую конфигурацию SSO во время развертывания. Вместо этого, отключить его во время миграции в случае, если вам нужно переключить его обратно позже. 

- **Если приложение не поддерживает несколько высокопоставленных лиц,** но позволяет пользователям войти в систему с помощью проверки подлинности на основе форм (имя пользователя/пароль), убедитесь, что пользователи могут вернуться к этому подходу в случае сбоя новой конфигурации SSO.

### <a name="access-management"></a>Управление доступом

Мы рекомендуем выбирать масштабированный подход при управлении доступом к ресурсам. Общие подходы включают использование групп на территории, синхронизируя через Azure AD Connect, [создание динамических групп в Azure AD на основе атрибутов пользователя](https://docs.microsoft.com/azure/active-directory/active-directory-groups-dynamic-membership-azure-portal)или создание [групп самообслуживания](https://docs.microsoft.com/azure/active-directory/active-directory-accessmanagement-self-service-group-management) в Azure AD, управляемых владельцем ресурса.

### <a name="monitor-security"></a>Мониторинг безопасности

Мы рекомендуем настроить регулярную каденцию, в которой вы просматриваете различные аспекты безопасности приложения SaaS и выполняете любые необходимые действия по исправлению положения.

### <a name="troubleshooting"></a>Устранение неполадок

Следующие ссылки представляют сценарии устранения неполадок. Возможно, вы захотите создать специальное руководство для персонала службы поддержки, которое включает в себя эти сценарии и шаги по их исправлению.

#### <a name="consent-issues"></a>Вопросы согласия

- [Неожиданная ошибка согласия](https://docs.microsoft.com/azure/active-directory/manage-apps/application-sign-in-unexpected-user-consent-prompt)

- [Ошибка при предоставлении согласия пользователем](https://docs.microsoft.com/azure/active-directory/manage-apps/application-sign-in-unexpected-user-consent-error)

#### <a name="sign-in-issues"></a>Проблемы при входе

- [Проблемы, связанные с ввозами с пользовательского портала](https://docs.microsoft.com/azure/active-directory/manage-apps/application-sign-in-other-problem-deeplink)

- [Проблемы при входе с панели доступа](https://docs.microsoft.com/azure/active-directory/manage-apps/application-sign-in-other-problem-access-panel)

- [Ошибка на странице входа в приложение](https://docs.microsoft.com/azure/active-directory/manage-apps/application-sign-in-problem-application-error)

- [Непоперейливая регистрация в приложении Майкрософт](https://docs.microsoft.com/azure/active-directory/manage-apps/application-sign-in-problem-first-party-microsoft)

#### <a name="sso-issues-for-applications-listed-in-the-azure-application-gallery"></a>Проблемы SSO для приложений, перечисленных в галерее приложений Azure

- [Проблема с sSO паролей для приложений, перечисленных в галерее приложений Azure](https://docs.microsoft.com/azure/active-directory/manage-apps/application-sign-in-problem-password-sso-gallery) 

- [Проблема с федеративной SSO для приложений, перечисленных в галерее приложений Azure](https://docs.microsoft.com/azure/active-directory/manage-apps/application-sign-in-problem-federated-sso-gallery)   

#### <a name="sso-issues-for-applications-not-listed-in-the-azure-application-gallery"></a>Проблемы SSO для приложений, не перечисленных в галерее приложений Azure

- [Проблема с паролем SSO для приложений, не перечисленных в галерее приложений Azure](https://docs.microsoft.com/azure/active-directory/manage-apps/application-sign-in-problem-password-sso-non-gallery) 

- [Проблема с федеративной SSO для приложений, не перечисленных в галерее приложений Azure](https://docs.microsoft.com/azure/active-directory/manage-apps/application-sign-in-problem-federated-sso-non-gallery)

## <a name="next-steps"></a>Дальнейшие действия

[Отладка единого входа на основе SAML](https://docs.microsoft.com/azure/active-directory/develop/active-directory-saml-debugging)

[Отображение претензий для приложений через PowerShell](https://docs.microsoft.com/azure/active-directory/active-directory-claims-mapping)

[Настройка претензий, выданных в токене SAML](https://docs.microsoft.com/azure/active-directory/develop/active-directory-saml-claims-customization)

[Протокол единого знака САМЛ](https://docs.microsoft.com/azure/active-directory/develop/active-directory-single-sign-on-protocol-reference)

[Протокол единого выхода SAML](https://docs.microsoft.com/azure/active-directory/develop/active-directory-single-sign-out-protocol-reference)

[Azure AD B2B](https://docs.microsoft.com/azure/active-directory/active-directory-b2b-what-is-azure-ad-b2b) (для внешних пользователей, таких как партнеры и поставщики)

[Условный доступ AD Azure](https://docs.microsoft.com/azure/active-directory/active-directory-conditional-access-azure-portal)

[Защита идентификационных данных Azure](https://docs.microsoft.com/azure/active-directory/active-directory-identityprotection)

[Доступ с единым входом](https://docs.microsoft.com/azure/active-directory/active-directory-appssoaccess-whatis)

[Приложение SSO Учебник](https://docs.microsoft.com/azure/active-directory/saas-apps/tutorial-list)
