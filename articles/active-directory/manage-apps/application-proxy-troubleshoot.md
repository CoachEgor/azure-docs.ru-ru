---
title: Устранение неполадок прокси-сервера приложений | Документация Майкрософт
description: Способы устранения ошибок в прокси-сервере приложений Azure AD.
services: active-directory
documentationcenter: ''
author: msmimart
manager: CelesteDG
ms.service: active-directory
ms.subservice: app-mgmt
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 06/24/2019
ms.author: mimart
ms.reviewer: japere
ms.custom: H1Hack27Feb2017; it-pro
ms.collection: M365-identity-device-management
ms.openlocfilehash: 6cf5b6d4cadf4592fbaa19c89a969b20e9eb69b6
ms.sourcegitcommit: 198c3a585dd2d6f6809a1a25b9a732c0ad4a704f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/23/2019
ms.locfileid: "68424264"
---
# <a name="troubleshoot-application-proxy-problems-and-error-messages"></a>Устранение неполадок и сообщения об ошибках прокси приложения

При устранении неполадок прокси-сервера приложений рекомендуется начать с просмотра последовательности устранения неполадок, [отладки ошибок соединителя прокси приложения](application-proxy-debug-connectors.md), чтобы определить, правильно ли настроены соединители прокси приложения. Если у вас по-прежнему возникают проблемы с подключением к приложению, выполните процедуру устранения неполадок в статье [Отладка приложений прокси приложения](application-proxy-debug-apps.md).

Если во время доступа к опубликованному приложению или публикации приложений возникают ошибки, проверьте следующие параметры, чтобы выяснить, правильно ли работает прокси-сервер приложений Microsoft Azure AD.

* Откройте консоль служб Windows. Убедитесь, что служба **соединителя прокси приложения Microsoft AAD** включена и работает. Вы также можете проверить страницу свойств службы прокси-сервера приложения, как показано на следующем рисунке:  
  ![Снимок экрана свойств соединителя прокси-сервера приложений Microsoft AAD](./media/application-proxy-troubleshoot/connectorproperties.png)
* Откройте средство просмотра событий и найдите события для соединителя прокси приложения в узле **Журналы приложений и служб** > **Microsoft** > **AadApplicationProxy** > **Соединитель** > **Администратор**.
* При необходимости доступны более подробные журналы, если [включить журналы сеансов соединителя прокси-сервера приложения](application-proxy-connectors.md#under-the-hood).

## <a name="the-page-is-not-rendered-correctly"></a>Страница не отображается правильно
Даже если вы не получаете сообщения о конкретных ошибках, все равно возможны проблемы с отображением или работой приложения. Это может произойти если вы опубликовали путь к статье, но приложение требует содержимое, которое находится за пределами этого пути.

Например, если вы публикуете путь `https://yourapp/app`, но приложение запрашивает изображения в `https://yourapp/media`, они не будут отображаться. Чтобы включить все соответствующее содержимое, обязательно публикуйте приложение, используя путь самого высокого уровня. Для этого примера это `http://yourapp/`.

Если вы изменили путь, чтобы включить содержимое, на которое указывает ссылка, но при этом хотите перенаправлять пользователей по внутренней ссылке пути, см. инструкции в записи блога [Setting the right link for Application Proxy applications in the Azure AD access panel and Office 365 app launcher](https://blogs.technet.microsoft.com/applicationproxyblog/2016/04/06/setting-the-right-link-for-application-proxy-applications-in-the-azure-ad-access-panel-and-office-365-app-launcher/) (Настройка правильной ссылки на приложения прокси приложений на панели доступа Azure AD и в средстве запуска приложений Office 365).

## <a name="connector-errors"></a>Ошибки соединителя

Если при установке мастера создания соединителя произойдет сбой регистрации, его причину можно проверить двумя способами. Вы можете просмотреть записи в журнале событий в разделе **Applications and Services Logs\Microsoft\AadApplicationProxy\Connector\Admin** или выполнить следующую команду Windows PowerShell:

    Get-EventLog application –source "Microsoft AAD Application Proxy Connector" –EntryType "Error" –Newest 1

При обнаружении ошибки соединителя в журнале событий воспользуйтесь приведенной таблицей распространенных ошибок, чтобы устранить проблему.

| Error | Рекомендуемые действия |
| ----- | ----------------- |
| Не удалось зарегистрировать соединитель: убедитесь, что включен прокси-сервер приложений на портале управления Azure и что имя пользователя и пароль Active Directory введены правильно. Ошибка: "Произошла одна или несколько ошибок". | Если вы закрыли окно регистрации, не войдя в Azure AD, еще раз запустите мастер настройки соединителя и зарегистрируйте соединитель. <br><br> Если окно регистрации открывается, а затем немедленно закрывается без возможности входа в систему, вероятно, возникает эта ошибка. Эта ошибка возникает при ошибках сетевого подключения в системе. Убедитесь, что вы можете подключиться из браузера к общедоступному веб-сайту и что порты открыты в соответствии с [требованиями прокси приложения](application-proxy-add-on-premises-application.md#prepare-your-on-premises-environment). |
| В окне регистрации отображается чистая ошибка. Продолжение невозможно. | Если вы видите эту ошибку, после чего окно закрывается, это означает, что вы неправильно ввели имя пользователя или пароль. Повторите попытку. |
| Не удалось зарегистрировать соединитель: убедитесь, что включен прокси-сервер приложений на портале управления Azure и что имя пользователя и пароль Active Directory введены правильно. Ошибка: "AADSTS50059: не найдены идентификационные сведения о клиенте в запросе или в предоставленных учетных данных, а поиск URI субъекта-службы завершился ошибкой. | Вы пытаетесь войти с помощью учетной записи Майкрософт, а не домена, который является частью идентификатора организации каталога, к которому вы пытаетесь получить доступ. Убедитесь, что администратор является частью того же имени домена, что и домен клиента, например, если домен Azure AD — contoso.com, администратором должен быть admin@contoso.com. |
| Не удалось получить текущую политику выполнения для запуска сценариев PowerShell | Если установка соединителя завершается сбоем, убедитесь, что политика выполнения PowerShell не отключена. <br><br>1. Откройте редактор групповой политики.<br>2. Выберите **Конфигурация компьютера** > **Административные шаблоны** > **Компоненты Windows** > **Windows PowerShell** и дважды щелкните пункт **Включить выполнение сценариев**.<br>3. Возможные значения политики выполнения: **Не настроено** и **Включено**. Если установлено значение **Включено**, убедитесь, что в разделе "Параметры" для параметра "Политика выполнения" установлено значение **Разрешать локальные сценарии и удаленные подписанные сценарии** или **Разрешать все сценарии**. |
| Соединителю не удалось загрузить конфигурацию. | Истек срок действия сертификата клиента соединителя, который используется для проверки подлинности. Это также может произойти, если соединитель установлен за прокси-сервером. В этом случае у соединителя нет доступа к Интернету и он не может предоставлять приложения удаленным пользователям. Обновите отношение доверия вручную с помощью командлета `Register-AppProxyConnector` в Windows PowerShell. Если соединитель находится за прокси-сервером, необходимо предоставить доступ к Интернету учетным записям соединителя (сетевые службы и локальная система). Для этого предоставьте им доступ к прокси-серверу или настройте их на обход прокси-сервера. |
| Не удалось зарегистрировать соединитель: Чтобы зарегистрировать соединитель, вы должны быть администратором приложения своей службы Active Directory. Ошибка: "Запрос на регистрацию отклонен". | Псевдоним, с помощью которого вы пытаетесь войти в систему, не является администратором в этом домене. Соединитель всегда устанавливается для каталога, которому принадлежит домен пользователя. Убедитесь, что учетная запись администратора, с которой вы пытаетесь войти, имеет по крайней мере права администратора приложений для клиента Azure AD. |
| Соединителю не удалось подключиться к службе из-за проблем с сетью. Соединитель попытался получить доступ к следующему URL-адресу. | Соединителю не удалось подключиться к облачной службе прокси приложения. Это может произойти, если подключение блокируется правилом брандмауэра. Убедитесь, что вы разрешили доступ к правильным портам и URL-АДРЕСам, перечисленным в [предварительных требованиях прокси приложения](application-proxy-add-on-premises-application.md#prepare-your-on-premises-environment). |

## <a name="kerberos-errors"></a>Ошибки Kerberos

Эта таблица охватывает более распространенные ошибки, происходящие при установке и настройке Kerberos, и содержит рекомендации по устранению.

| Error | Рекомендуемые действия |
| ----- | ----------------- |
| Не удалось получить текущую политику выполнения для запуска сценариев PowerShell | В случае сбоя установки соединителя проверьте, не отключена ли политика выполнения PowerShell.<br><br>1. Откройте редактор групповой политики.<br>2. Выберите **Конфигурация компьютера** > **Административные шаблоны** > **Компоненты Windows** > **Windows PowerShell** и дважды щелкните пункт **Включить выполнение сценариев**.<br>3. Возможные значения политики выполнения: **Не настроено** и **Включено**. Если установлено значение **Включено**, убедитесь, что в разделе "Параметры" для параметра "Политика выполнения" установлено значение **Разрешать локальные сценарии и удаленные подписанные сценарии** или **Разрешать все сценарии**. |
| 12008 — для Azure AD превышено максимальное количество попыток проверки подлинности Kerberos на внутреннем сервере. | Эта ошибка может означать неправильную конфигурацию между Azure AD и внутренним сервером приложений или проблему в настройках даты и времени на обоих компьютерах. Внутренний сервер отклонил билет Kerberos, созданный службой Azure AD. Проверьте правильность конфигурации Azure AD и сервера внутренних приложений. Убедитесь, что конфигурация даты и времени в Azure AD и на внутреннем сервере приложений синхронизирована. |
| 13016 — службе Azure AD не удается получить билет Kerberos от имени пользователя из-за отсутствия UPN в граничном маркере или файле cookie доступа. | Существует проблема с конфигурацией службы маркеров безопасности. Исправьте конфигурацию утверждения UPN в службе маркеров безопасности. |
| 13019 — службе Azure AD не удается получить билет Kerberos от имени пользователя из-за следующей общей ошибки API. | Это событие может означать неправильную конфигурацию между Azure AD и сервером контроллера домена или проблему в конфигурации даты и времени на обоих компьютерах. Контроллер домена отклонил билет Kerberos, созданный службой Azure AD. Проверьте правильность конфигурации Azure AD и сервера внутренних приложений, особенно конфигурацию имени субъекта-службы. Убедитесь, что служба Azure AD присоединена к тому же домену, что и контроллер домена, чтобы контроллер домена мог установить отношения доверия с Azure AD. Убедитесь, что конфигурация даты и времени в Azure AD и на контроллере домена синхронизирована. |
| 13020 — службе Azure AD не удается получить билет Kerberos от имени пользователя, так как имя субъекта-службы для внутреннего сервера не определено. | Это событие может означать неправильную конфигурацию между Azure AD и сервером контроллера домена или проблему в конфигурации даты и времени на обоих компьютерах. Контроллер домена отклонил билет Kerberos, созданный службой Azure AD. Проверьте правильность конфигурации Azure AD и сервера внутренних приложений, особенно конфигурацию имени субъекта-службы. Убедитесь, что служба Azure AD присоединена к тому же домену, что и контроллер домена, чтобы контроллер домена мог установить отношения доверия с Azure AD. Убедитесь, что конфигурация даты и времени в Azure AD и на контроллере домена синхронизирована. |
| 13022 — службе Azure AD не удается проверить подлинность пользователя, так как внутренний сервер отвечает на попытки проверки подлинности Kerberos ошибкой HTTP 401. | Это событие может означать неправильную конфигурацию между Azure AD и внутренним сервером приложений или проблему в конфигурации даты и времени на обоих компьютерах. Внутренний сервер отклонил билет Kerberos, созданный службой Azure AD. Проверьте правильность конфигурации Azure AD и сервера внутренних приложений. Убедитесь, что конфигурация даты и времени в Azure AD и на внутреннем сервере приложений синхронизирована. Дополнительные сведения см. в статье [Устранение неполадок конфигураций ограниченного делегирования Kerberos для прокси приложения](application-proxy-back-end-kerberos-constrained-delegation-how-to.md).  |

## <a name="end-user-errors"></a>Ошибки пользователей

Этот список содержит ошибки, с которыми могут столкнуться пользователи при неудачной попытке доступа к приложению. 

| Error | Рекомендуемые действия |
| ----- | ----------------- |
| Веб-сайт не может отобразить страницу. | Пользователь может увидеть эту ошибку при попытке доступа к опубликованному вами приложению, если оно является приложением IWA. Возможно, для этого приложения определено неправильное имя субъекта-службы. Для приложений IWA: убедитесь, что для приложения настроено правильное имя субъекта-службы. |
| Веб-сайт не может отобразить страницу. | Пользователь может получить эту ошибку при попытке доступа к опубликованному вами приложению, если оно является приложением OWA. Это может быть вызвано одной из следующих причин:<br><li>Для этого приложения определено неверное имя субъекта-службы. Убедитесь в правильности имени субъекта-службы (SPN), настроенного для этого приложения.</li><li>Пользователь, который попытался получить доступ к приложению, использует для входа учетную запись Майкрософт, а не надлежащую корпоративную учетную запись, или является гостевым пользователем. Убедитесь, что пользователь выполняет вход с помощью корпоративной учетной записи, которая соответствует имени домена опубликованного приложения. Пользователи учетных записей Майкрософт и гости не могут получить доступ к приложениям IWA.</li><li>Пользователь, который пытался получить доступ к приложению, не определен надлежащим образом для этого приложения на локальной стороне. Убедитесь, что этот пользователь имеет соответствующие разрешения, определенные для этого серверного приложения на локальном компьютере. |
| К этому корпоративному приложению нет доступа. Вы не авторизованы для доступа к этому приложению. Сбой авторизации. Не забудьте назначить пользователю доступ к этому приложению. | Пользователь может получить эту ошибку при попытке доступа к опубликованному приложению, если для входа в систему использовались учетные записи Майкрософт вместо корпоративной учетной записи. Также эта ошибка возникает при входе с помощью гостевой учетной записи. Пользователи учетных записей Майкрософт и гости не могут получить доступ к приложениям IWA. Убедитесь, что пользователь выполняет вход с помощью корпоративной учетной записи, которая соответствует имени домена опубликованного приложения.<br><br>Возможно, вы не назначили пользователя для этого приложения. Перейдите на вкладку **Приложение** и в разделе **Пользователи и группы** назначьте этого пользователя или группу пользователей для этого приложения. |
| Доступ к этому корпоративному приложению невозможно получить прямо сейчас. Повторите попытку позже. Истекло время ожидания для соединителя. | Пользователь может получить эту ошибку при попытке доступа к опубликованному приложению, если оно неправильно определено для этого приложения на локальной стороне. Убедитесь, что у пользователей есть соответствующие разрешения, определенные для этого серверного приложения на локальном компьютере. |
| К этому корпоративному приложению нет доступа. Вы не авторизованы для доступа к этому приложению. Сбой авторизации. Убедитесь, что у пользователя есть лицензия на Azure Active Directory Premium или Basic. | Пользователь может получить эту ошибку при попытке доступа к опубликованному приложению, если оно не было явно назначено администратором подписчика с лицензией Premium или Basic. Откройте вкладку **Лицензии** службы Active Directory подписчика и убедитесь, что этому пользователю или группе пользователей назначена лицензия Премиум или Базовая. |
| Не удалось найти сервер с указанным именем узла. | Пользователь может получить эту ошибку при попытке доступа к опубликованному приложению, если личный домен приложения настроен неправильно. Убедитесь, что вы загрузили сертификат для домена и правильно настроили запись DNS, выполнив действия, описанные в разделе [Работа с пользовательскими доменами в Azure AD application proxy](application-proxy-configure-custom-domain.md) |

## <a name="my-error-wasnt-listed-here"></a>Моей ошибки здесь нет

Если вы столкнулись с ошибкой и проблемой в работе прокси приложения Azure AD, не указанной в этом руководстве по устранению неполадок, нам бы хотелось услышать об этом. Отправьте нашей [команде по отзывам и предложениям](mailto:aadapfeedback@microsoft.com) электронное сообщение с описанием обнаруженной ошибки.

## <a name="see-also"></a>См. также
* [Включение прокси приложения Azure AD](application-proxy-add-on-premises-application.md)
* [Опубликуйте приложения с помощью прокси-сервера приложений.](application-proxy-add-on-premises-application.md)
* [Доступ с единым входом](application-proxy-configure-single-sign-on-with-kcd.md)
* [Включить условный доступ](application-proxy-integrate-with-sharepoint-server.md)


<!--Image references-->
[1]: ./media/application-proxy-troubleshoot/connectorproperties.png
[2]: ./media/active-directory-application-proxy-troubleshoot/sessionlog.png
