---
title: Планирование облачного приложения отдела кадров для Azure Active Directory подготовки пользователей
description: В этой статье описывается процесс развертывания облачных систем отдела кадров, таких как Workday и Суцессфакторс с Azure Active Directory. Интеграция Azure AD с облачной системой управления персоналом приводит к полному управлению жизненным циклом удостоверений.
services: active-directory
author: martincoetzer
manager: CelesteDG
tags: azuread
ms.service: active-directory
ms.subservice: app-mgmt
ms.topic: conceptual
ms.workload: identity
ms.date: 11/22/2019
ms.author: martinco
ms.reviewer: arvindha
ms.openlocfilehash: 5d55aafc29b3b022d1023077d2d8f459b0608ae7
ms.sourcegitcommit: 428fded8754fa58f20908487a81e2f278f75b5d0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/27/2019
ms.locfileid: "74555656"
---
# <a name="plan-cloud-hr-application-to-azure-active-directory-user-provisioning"></a>Планирование облачного приложения отдела кадров для Azure Active Directory подготовки пользователей

Исторический ИТ-персонал полагается на ручные методы создания, обновления и удаления сотрудников, таких как отправка CSV-файлов или пользовательские сценарии для синхронизации данных сотрудников. Эти процессы подготовки могут быть подвержены ошибкам, ненадежны и трудно управлять ими.

Для беспроблемного управления комплексными жизненным циклом удостоверений сотрудников, поставщиков или работников, использующих зависимости, [Azure Active Directory (Azure AD) служба подготовки пользователей](https://docs.microsoft.com/azure/active-directory/manage-apps/user-provisioning) обеспечивает интеграцию с облачными приложениями (HR), такими как Workday или SuccessFactors.

Azure AD использует эту интеграцию для реализации следующих рабочих процессов облачных приложений (приложений).

- **Подготовка пользователей к выделенным в AD** наборам пользователей из облачного приложения отдела кадров в один или несколько доменов Active Directory (AD).
- **Подготовка облачных пользователей к Azure AD** — в сценариях, где AD не используется, подготавливайте пользователей непосредственно из облачного приложения отдела кадров Azure AD.
- **Обратная запись в облачное приложение отдела кадров.** — Запишите адреса электронной почты и атрибуты имени пользователя из Azure AD обратно в облачное приложение отдела кадров.

> [!NOTE]
> Этот план развертывания описывает, как развернуть рабочие процессы облачного приложения HR с помощью подготовки пользователей Azure AD. Сведения о развертывании автоматической подготовки пользователей в приложениях SaaS см. в статье [Планирование развертывания автоматической подготовки пользователей](https://aka.ms/deploymentplans/provisioning).

## <a name="enabled-hr-scenarios"></a>Включенные сценарии HR

Служба подготовки пользователей Azure AD позволяет автоматизировать следующие сценарии управления жизненным циклом удостоверений на основе кадров:

- **Наем новых сотрудников** . при добавлении нового сотрудника в облачное приложение отдела кадров учетная запись пользователя автоматически создается в AD и Azure AD с возможностью записи адресов электронной почты и атрибутов имени пользователя в облачное приложение отдела кадров.
- **Обновление атрибутов и профилей сотрудников** . при обновлении записи сотрудника в облачном приложении отдела кадров (например, его имени, должности или руководителя) учетная запись пользователя будет автоматически обновлена в AD и Azure AD.
- **Прекращение сотрудников** . когда сотрудник завершает работу в облачном приложении отдела кадров, его учетная запись пользователя автоматически отключается в AD и Azure AD.
- Повторный **прием сотрудников** . когда сотрудник переключается из облачного приложения отдела кадров, его старая учетная запись может быть автоматически активирована или повторно подготавливаться к AD и Azure AD.

## <a name="who-is-this-integration-best-suited-for"></a>Для чего лучше всего подходит эта интеграция?

Интеграция облачных приложений отдела кадров с подготовкой пользователей Azure AD идеально подходит для организаций, которые:

- предприятие предварительно созданного облачного решения для подготовки пользователей в Cloud HR
- требовать прямую подготовку пользователей из облачного приложения отдела кадров в AD или Azure AD
- требовать подготовку пользователей с помощью данных, полученных из облачного приложения отдела кадров
- требовать синхронизацию, перемещение и покинуть пользователей для синхронизации с одним или несколькими лесами AD, доменами и подразделениями на основе сведений об изменениях, обнаруженных в облачном приложении отдела кадров
- Использование Office 365 для электронной почты

## <a name="learn"></a>Обучение

Подготовка пользователей создает основу для постоянного управления удостоверениями и повышает качество бизнес-процессов, зависящих от достоверных данных удостоверений.

### <a name="terms"></a>Термины

В этой статье используются следующие термины:

- **Исходная система** — репозиторий пользователей, от которых заготавливается Azure AD (например, облачное приложение для работы с персоналом, например Workday и SuccessFactors).
- **Целевая система** — репозиторий пользователей, на которые подготавливается Azure AD (например, AD, Azure AD, Office 365 или другие приложения SaaS).
- **Присоединение-перевозчики — леаверс процесс** — термин, используемый для новых сотрудников, переносов и прекращений с помощью облачного приложения отдела кадров в качестве системы записей. Процесс завершается, когда служба успешно подготавливает необходимые атрибуты к целевой системе.

### <a name="key-benefits"></a>Основные преимущества

Эта возможность подготовки ИТ-ОТДЕЛов обеспечивает значительные преимущества для бизнеса, как показано ниже:

- **Повышение производительности** . Теперь можно автоматизировать назначение учетных записей пользователей, лицензий Office 365 и предоставить доступ к ключевым группам. Автоматизация назначений дает новым наймам немедленный доступ к своим средствам работы и повышает производительность.
- **Управление рисками** . Вы можете повысить уровень безопасности, автоматизируя изменения на основе состояния сотрудников или членства в группах с данными, передаваемыми из облачного приложения отдела кадров. Автоматизация изменений гарантирует, что удостоверения пользователей и доступ к основным приложениям обновляются автоматически при переходе или выходе пользователей из Организации.
- **Соответствие и управление** : Azure AD поддерживает собственные журналы аудита для запросов подготовки пользователей, выполняемых приложениями как исходной, так и целевой системы. Аудит позволяет отслеживать, кто имеет доступ к приложениям с одного экрана.
- **Управление затратами** . Автоматическая подготовка сокращает затраты за счет предотвращения неэффективного использования и ошибок, связанных с подготовкой вручную. Это снижает потребность в настраиваемых решениях подготовки пользователей, созданных с течением времени, используя устаревшие и устаревшие платформы.

### <a name="licensing"></a>Лицензирование

Чтобы настроить облачное приложение HR для интеграции подготовки пользователей Azure AD, требуется действительная [лицензия Azure AD Premium](https://azure.microsoft.com/pricing/details/active-directory/) и лицензия для облачного приложения отдела кадров, например Workday или SuccessFactors.

Кроме того, вам потребуется действительная лицензия на подписку Azure AD Premium P1 или более поздней версии для каждого пользователя, который будет источником из облачного приложения отдела кадров и подготовленных для AD или Azure AD. Любое неправильное количество лицензий, принадлежащих облачному приложению отдела кадров, может привести к ошибкам во время подготовки пользователей.

### <a name="prerequisites"></a>Технические условия

- Глобальный администратор Azure Active Directory — доступ для настройки агента подготовки Azure AD Connect.
- Тестовый и рабочий экземпляр облачного приложения отдела кадров.
- Разрешения администратора в облачном приложении отдела кадров для создания пользователя системной интеграции и внесения изменений в тестовые данные о сотрудниках в целях тестирования.
- Для подготовки пользователей в AD требуется сервер под Windows Server 2012 или более поздней версии с .NET 4.7.1 + Runtime для размещения [агента подготовки Azure AD Connect](https://go.microsoft.com/fwlink/?linkid=847801).
- [Azure AD Connect](https://docs.microsoft.com/azure/active-directory/hybrid/whatis-azure-ad-connect) для синхронизации пользователей между AD и Azure AD.

### <a name="training-resources"></a>Учебные материалы

| **ресурсы** | **Ссылка и описание** |
|:-|:-|
| Видео | [Что такое подготовка пользователей в активном каталоге Azure?](https://youtu.be/_ZjARPpI6NI) |
| | [Как развернуть подготовку пользователей в активном каталоге Azure?](https://youtu.be/pKzyts6kfrw) |
| Учебники | См. [список руководств по интеграции приложений SaaS с Azure AD](https://docs.microsoft.com/azure/active-directory/active-directory-saas-tutorial-list) . |
| | [Учебник. Настройка Workday для автоматической подготовки пользователей](https://docs.microsoft.com/azure/active-directory/saas-apps/workday-inbound-tutorial#frequently-asked-questions-faq) |
| Вопросы и ответы | [Автоматическая подготовка пользователей](https://docs.microsoft.com/azure/active-directory/manage-apps/user-provisioning#frequently-asked-questions) |
| | [Подготовка из Workday в Azure AD](https://docs.microsoft.com/azure/active-directory/saas-apps/workday-inbound-tutorial#frequently-asked-questions-faq) |

### <a name="solution-architecture"></a>Архитектура решения

В следующем примере описывается комплексная архитектура решения подготовки пользователей для распространенных гибридных сред и включает в себя:

- **Достоверный поток данных отдела кадров — от облачного приложения отдела кадров к AD** — в этом потоке событие HR ("взаимосвязь-перевозчики-леаверс процесс") инициируется в облачном клиенте приложения для отдела кадров. Служба подготовки Azure AD и Azure AD Connect агент подготовки подготавливает данные пользователя из облачного приложения отдела кадров в AD. В зависимости от события, это может приводить к операциям создания, обновления, включения или отключения в AD.
- **Синхронизация с Azure AD и электронной почтой обратной записи и именем пользователя из локальной службы AD в облачное приложение отдела кадров** . После обновления учетных записей в AD они синхронизируются с Azure AD через Azure AD Connect, а адреса электронной почты и атрибуты имени пользователя можно записать обратно в облачный клиент Cloud App.

![Схема рабочих процессов](./media/plan-cloudhr-provisioning/plan-cloudhr-provisioning-img1.png)

#### <a name="description-of-workflow"></a>Описание рабочего процесса

Основные шаги, указанные на схеме:  

1. Отдел **кадров** выполняет транзакции в облачном клиенте приложения для отдела кадров.
2. **Служба подготовки Azure AD** запускает запланированные циклы от клиента облачного приложения отдела кадров и определяет изменения, которые необходимо обработать для синхронизации с AD.
3. **Служба подготовки Azure AD** вызывает агент подготовки Azure AD Connect с использованием полезных данных запроса, содержащих операции создания, обновления, включения и отключения учетной записи AD.
4. **Azure AD Connect агент подготовки** использует учетную запись службы для управления данными учетной записи AD.
5. **Azure AD Connect** выполняет разностную [синхронизацию](https://docs.microsoft.com/azure/active-directory/hybrid/how-to-connect-sync-whatis) для извлечения обновлений в AD.
6. Обновления **Active Directory** синхронизируются с Azure AD.
7. **Служба подготовки Azure AD** обратная запись атрибута электронной почты и имени пользователя из Azure AD в клиент облачного приложения отдела кадров.

## <a name="plan-the-deployment-project"></a>Планирование проекта развертывания

Учитывайте потребности Организации во время определения стратегии развертывания в вашей среде.

### <a name="engage-the-right-stakeholders"></a>Привлечение нужных заинтересованных лиц

При сбое технологических проектов они обычно делают это из-за несовпадения ожидания, результатов и обязанностей. Чтобы избежать этих трудностей, [Убедитесь, что вы вовлечены в нужные заинтересованные лица](https://aka.ms/deploymentplans) и что роли заинтересованных лиц в проекте хорошо понятны, задокументирование заинтересованных лиц, а также их ввод и подотчетности.

Необходимо включить представителя из организации отдела кадров, который может предоставлять входные данные для существующих бизнес-процессов и требований к обработке данных о рабочем процессе и заданиях.

### <a name="plan-communications"></a>Планирование информирования

Связь важна для успеха любой новой службы. Вы должны заранее общаться с пользователями, как они изменяются, когда они изменятся, а также как получить поддержку в случае возникновения проблем.

### <a name="plan-a-pilot"></a>Планирование пилотного развертывания

Интеграция бизнес-процессов и рабочих процессов по управлению персоналом с облачным приложением отдела кадров к целевым системам требует значительного объема проверки данных, преобразования данных, очистки данных и сквозного тестирования перед развертыванием решения в рабочей среде.

Рекомендуется использовать начальную конфигурацию в [пилотной среде](https://docs.microsoft.com/azure/active-directory/fundamentals/active-directory-deployment-plans#best-practices-for-a-pilot) , прежде чем масштабировать ее для всех пользователей в рабочей области.

## <a name="select-cloud-hr-provisioning-connector-apps"></a>Выбор облачных приложений соединителя для подготовки кадров

Для упрощения рабочих процессов подготовки Azure AD между облачным приложением отдела кадров и AD существует несколько приложений соединителя подготовки, которые можно добавить из коллекции приложений Azure AD:

- **Облачное приложение отдела кадров для подготовки пользователей AD** — это приложение соединителя подготовки упрощает подготовку учетных записей пользователей из облачного приложения HR в один домен AD. При наличии нескольких доменов можно добавить один экземпляр этого приложения из коллекции приложений Azure AD для каждого домена AD, который необходимо подготавливать.
- **Облачное приложение отдела кадров для подготовки пользователей Azure AD** . Хотя Azure AD Connect — это средство, которое следует использовать для синхронизации пользователей AD с Azure AD, это приложение соединителя подготовки можно использовать для упрощения подготовки облачных пользователей из облачного приложения отдела кадров к одному клиенту Azure AD.
- **Обратная запись облачного приложения для отдела кадров** . это приложение соединителя подготовки упрощает обратную передачу адресов электронной почты пользователей из Azure AD в облачное приложение отдела кадров.

Например, на рисунке ниже перечислены приложения соединителя Workday, доступные в коллекции приложений Azure AD.

![Коллекция приложений портала Azure Active Directory](./media/plan-cloudhr-provisioning/plan-cloudhr-provisioning-img2.png)

### <a name="decision-flowchart"></a>Блок-схема принятия решений

Используйте приведенную ниже диаграмму для принятия решений, чтобы определить, какие облачные приложения для подготовки персонала относятся к вашему сценарию.

![Блок-схема принятия решений](./media/plan-cloudhr-provisioning/plan-cloudhr-provisioning-img3.png)

## <a name="design-azure-ad-connect-provisioning-agent-deployment-topology"></a>Разработка топологии развертывания агента Azure AD Connect подготовки

Интеграция подготовки между облачным приложением для отдела кадров и AD требует следующих четырех компонентов:

- Клиент облачного приложения для отдела кадров
- Приложение соединителя подготовки
- Агент подготовки Azure AD Connect
- Домен AD

Топология развертывания Azure AD Connect подготовки агента зависит от количества клиентов облачных приложений отдела кадров и дочерних доменов AD, которые планируется интегрировать. Если у вас несколько доменов AD, это зависит от того, являются ли домены AD [смежными или](https://docs.microsoft.com/windows-server/identity/ad-ds/plan/disjoint-namespace)несвязанными.

В зависимости от вашего решения выберите один из сценариев развертывания:

- Клиент облачного приложения для одного облака — > целевое одно или несколько дочерних доменов AD в доверенном лесу
- Клиент облачного приложения отдела кадров с одним облаком — > нацеливание нескольких дочерних доменов в несвязанном лесу AD

### <a name="single-cloud-hr-app-tenant---single-or-multiple-target-ad-child-domains-in-a-trusted-forest"></a>Клиент приложения для одного облака отдел кадров — > один или несколько дочерних доменов AD в доверенном лесу

Мы рекомендуем использовать следующую рабочую конфигурацию:

|Требование|Рекомендации|
|:-|:-|
|Число Azure AD Connect агентов подготовки к развертыванию|2 (для обеспечения высокой доступности и отработки отказа)
|Число настраиваемых приложений соединителя подготовки|Одно приложение на дочерний домен|
|Узел сервера для агента подготовки Azure AD Connect|Windows 2012 R2 + со сведениями об географически расположенных контроллерах домена AD</br>Может сосуществовать со службой Azure AD Connect|

![Потоковая передача в локальные агенты](./media/plan-cloudhr-provisioning/plan-cloudhr-provisioning-img4.png)

### <a name="single-cloud-hr-app-tenant---target-multiple-child-domains-in-a-disjoint-ad-forest"></a>Клиент облачного приложения отдела кадров с одним облаком — > нацеливание нескольких дочерних доменов в несвязанном лесу AD

В этом сценарии предполагается подготовка пользователей из облачного приложения отдела кадров к доменам в неприсоединенных лесах AD.

Мы рекомендуем использовать следующую рабочую конфигурацию:

|Требование|Рекомендации|
|:-|:-|
|Число агентов подготовки Azure AD Connect для развертывания в локальной среде|2 для неприсоединенного леса AD|
|Число настраиваемых приложений соединителя подготовки|Одно приложение на дочерний домен|
|Узел сервера для агента подготовки Azure AD Connect|Windows 2012 R2 + со сведениями об географически расположенных контроллерах домена AD</br>Может сосуществовать со службой Azure AD Connect|

![Неприсоединенный лес AD для одного облака по управлению персоналом](./media/plan-cloudhr-provisioning/plan-cloudhr-provisioning-img5.png)

### <a name="azure-ad-connect-provisioning-agent-requirements"></a>Требования к агенту подготовки Azure AD Connect

Решение подготовки пользователей Cloud HR to AD требует развертывания одного или нескольких Azure AD Connect агентов подготовки на серверах под управлением Windows 2012 R2 или более поздней версии с 4 ГБ ОЗУ и .NET 4.7.1 + Runtime. Убедитесь, что сервер узла имеет сетевой доступ к целевому домену AD.

Чтобы подготовить локальную среду, мастер настройки агента Azure AD Connect подготовки регистрирует агент в клиенте Azure AD, [открывает порты](https://docs.microsoft.com/azure/active-directory/manage-apps/application-proxy-add-on-premises-application#open-ports), [разрешает доступ к URL-адресам](https://docs.microsoft.com/azure/active-directory/manage-apps/application-proxy-add-on-premises-application#allow-access-to-urls)и поддерживает [исходящую конфигурацию прокси-сервера HTTPS](https://docs.microsoft.com/azure/active-directory/saas-apps/workday-inbound-tutorial#how-do-i-configure-the-provisioning-agent-to-use-a-proxy-server-for-outbound-http-communication).

Агент подготовки использует учетную запись службы для взаимодействия с доменами AD. Перед установкой агента рекомендуется создать учетную запись службы для пользователей и компьютеров AD, которые отвечают следующим требованиям.

- Пароль без истечения срока действия
- Делегированные разрешения CONTROL на чтение, создание, удаление учетных записей пользователей и управление ими

Вы можете выбрать контроллеры домена, которые должны выполнять запросы на подготовку. Если у вас есть несколько географически распределенных контроллеров домена, установите агент подготовки на том же сайте, что и предпочитаемый контроллер домена, чтобы повысить надежность и производительность комплексного решения.

Для обеспечения высокой доступности можно развернуть более одного агента подготовки Azure AD Connect и зарегистрировать его для работы с одним и тем же набором локальных доменов AD.

## <a name="plan-scoping-filters-and-attribute-mapping"></a>Планирование фильтров области и сопоставления атрибутов

При включении подготовки из облачного приложения отдела кадров к AD или Azure AD портал Azure определяет значения атрибутов с помощью сопоставления атрибутов.

### <a name="define-scoping-filters"></a>Определение фильтров области

Используйте [фильтры области](https://docs.microsoft.com/azure/active-directory/active-directory-saas-scoping-filters) , чтобы определить правила на основе атрибутов, определяющие, какие пользователи должны быть подготовлены из облачного приложения HR в AD или Azure AD.

При запуске процесса соединений необходимо выполнить следующие требования.

- Используется ли облачное приложение для отдела кадров, которое будет использоваться как сотрудниками, так и рабочими работниками?
- Планируете ли вы использовать облачное приложение HR для подготовки пользователей в Azure AD для управления сотрудниками и рабочими работниками?
- Планируется ли развертывание облачного приложения отдела кадров Azure AD только для подмножества пользователей облачных приложений отдела кадров (например, только для сотрудников)?

В зависимости от требований при настройке сопоставлений атрибутов можно задать поле **область исходного объекта** , чтобы выбрать, какие наборы пользователей в облачном приложении HR должны находиться в области для подготовки в AD. Часто используемые фильтры области см. в руководстве по облачному приложению для работы с персоналом.

### <a name="determine-matching-attributes"></a>Определение совпадающих атрибутов

С помощью подготовки вы получаете возможность сопоставлять существующие учетные записи между исходной и целевой системами. При интеграции облачного приложения отдела кадров с помощью службы подготовки Azure AD можно [настроить сопоставление атрибутов](https://docs.microsoft.com/azure/active-directory/manage-apps/configure-automatic-user-provisioning-portal#mappings) , чтобы определить, какие данные пользователя должны передаваться из облачного приложения отдела кадров в AD или Azure AD.

При запуске процесса соединений необходимо выполнить следующие требования.

- Какой уникальный идентификатор в этом облачном приложении отдела кадров используется для идентификации каждого пользователя?
- С точки зрения жизненного цикла идентификации, как вы обрабатываете перенять? Сохраняют ли при перенайме старый идентификатор сотрудника?
- Вы заранее обрабатываете свои сотрудники, датированные будущими правами, и создали учетные записи AD?
- С точки зрения жизненного цикла идентификации, как вы обрабатываете преобразование сотрудника в зависимости от работника или иным образом?
- Будут ли преобразованные пользователи хранить старую учетную запись AD или они получат новые?

В зависимости от вашего требования Azure AD поддерживает прямое сопоставление атрибутов с атрибутами, предоставляя постоянные значения или [создавая выражения для сопоставлений атрибутов](https://docs.microsoft.com/azure/active-directory/active-directory-saas-writing-expressions-for-attribute-mappings). Такая гибкость позволяет получить максимальный контроль над тем, что будет заполняться в атрибуте целевого приложения. Вы можете использовать [Microsoft Graph API](https://docs.microsoft.com/azure/active-directory/manage-apps/export-import-provisioning-configuration) и обозреватель графа для экспорта сопоставлений атрибутов подготовки пользователей и схемы в JSON-файл и импортировать их обратно в Azure AD.

По **умолчанию**атрибут в облачном приложении HR, представляющий уникальный идентификатор сотрудника, используется в качестве совпадающего атрибута, *сопоставленного с уникальным АТРИБУТОМ в Active Directory.* Например, в сценарии с приложением Workday атрибут *workday* *воркерид* сопоставляется с атрибутом AD *EmployeeID* .

Можно задать несколько совпадающих атрибутов и назначить приоритет сопоставления. Они оцениваются по приоритету сопоставления. Как только соответствие найдено, дальнейшие атрибуты сопоставления не вычисляются.

Можно также [настроить сопоставления атрибутов по умолчанию](https://docs.microsoft.com/azure/active-directory/manage-apps/customize-application-attributes#understanding-attribute-mapping-types) , такие как изменение или удаление существующих сопоставлений атрибутов, или создать новые сопоставления атрибутов в соответствии с потребностями бизнеса. Список настраиваемых атрибутов для сопоставлений см. в руководстве по облачному приложению для работы с персоналом (например, [Workday](https://docs.microsoft.com/azure/active-directory/saas-apps/workday-inbound-tutorial#planning-workday-to-active-directory-user-attribute-mapping-and-transformations)).

### <a name="determine-user-account-status"></a>Определение состояния учетной записи пользователя

По умолчанию приложение соединителя подготовки сопоставляет **состояние профиля пользователя HR** с **состоянием учетной записи пользователя** в AD или Azure AD, чтобы определить, следует ли включить или отключить учетную запись пользователя.

При запуске процесса объединения или Леаверс соберите следующие требования.

| Процесс | Требования |
| - | - |
| **Отсоединение** | С точки зрения жизненного цикла идентификации, как вы обрабатываете перенять? Сохраняют ли при перенайме старый идентификатор сотрудника? |
| | Вы заранее обрабатываете свои сотрудники в будущем и создаете учетные записи AD? Создаются ли эти учетные записи в состоянии "включено" или "отключено"? |
| | С точки зрения жизненного цикла идентификации, как вы обрабатываете преобразование сотрудника в зависимости от работника или иным образом? |
| | Будут ли преобразованные пользователи хранить старую учетную запись AD или они получат новые? |
| **леаверс** | Обрабатываются ли прерывания по-разному для сотрудников и рабочих процессов в AD? |
| | Какие эффективные даты учитываются при обработке завершения работы пользователя? |
| | Как преобразовываются сотрудники и взаимозависимости работников на существующие учетные записи AD? |
| | Как обрабатываются операции «отменить» в AD? Операции «отменить» должны быть обработаны, если в рамках процесса объединения в AD создаются будущие сотрудники. |

В зависимости от требований вы можете настроить логику сопоставления с помощью [выражений Azure AD](https://docs.microsoft.com/azure/active-directory/manage-apps/functions-for-customizing-application-data) , чтобы учетная запись AD была включена или отключена на основе сочетания точек данных.

### <a name="map-cloud-hr-app-to-ad-user-attributes"></a>Сопоставьте облачное приложение HR с атрибутами пользователя AD

Каждое облачное приложение отдела кадров поставляется с сопоставлением AD по умолчанию с облачным приложением отдела кадров.

При запуске процесса присоединение/перевозчиков/Леаверс необходимо выполнить следующие требования.

| Процесс | Требования |
| - | - |
| **Отсоединение** | Является ли процесс создания учетной записи AD ручным, автоматизированным или частичным автоматизированным? |
| | Планируется ли распространение настраиваемых атрибутов из облачного приложения отдела кадров в AD? |
| **Перевозчик** | Какие атрибуты вы хотите обработать при каждом выполнении операции "перевозчики" в облачном приложении отдела кадров? |
| | Выполняются ли во время обновлений пользователей конкретные проверки атрибутов? Если да, укажите сведения. |
| **леаверс** | Обрабатываются ли прерывания по-разному для сотрудников и рабочих процессов в AD? |
| | Какие эффективные даты учитываются при обработке завершения работы пользователя? |
| | Как преобразовываются сотрудники и взаимозависимости работников на существующие учетные записи AD? |

В зависимости от требований вы можете изменить сопоставления в соответствии с целями интеграции. Список настраиваемых атрибутов для сопоставлений см. в руководстве по облачному приложению отдела кадров (например, [Workday](https://docs.microsoft.com/azure/active-directory/saas-apps/workday-inbound-tutorial#planning-workday-to-active-directory-user-attribute-mapping-and-transformations)).

### <a name="generate-unique-attribute-value"></a>Создать уникальное значение атрибута

При запуске процесса объединения может потребоваться создать уникальные значения атрибутов при задании таких атрибутов, как CN, samAccountName и UPN с ограничениями UNIQUE.

Функция Azure AD [селектуникуевалуес](https://docs.microsoft.com/azure/active-directory/manage-apps/functions-for-customizing-application-data#selectuniquevalue) оценивает каждое правило, а затем проверяет значение, созданное для уникальности в целевой системе. См. пример [Создание уникального значения для атрибута userPrincipalName (UPN)](https://docs.microsoft.com/azure/active-directory/manage-apps/functions-for-customizing-application-data#generate-unique-value-for-userprincipalname-upn-attribute).

> [!NOTE]
> Эта функция в настоящее время поддерживается только для "Workday для Active Directory подготовки пользователей". Его нельзя использовать с другими приложениями подготовки.

### <a name="configure-ad-ou-container-assignment"></a>Настройка назначения контейнера "AD OU"

Распространенным требованием является размещение учетных записей пользователей AD в контейнерах на основе бизнес-подразделений, расположений и отделов. При инициации процесса перевозчика и изменении организационной Организации может потребоваться переместить пользователя из одного подразделения в другое в AD.

Используйте функцию [switch ()](https://docs.microsoft.com/azure/active-directory/manage-apps/functions-for-customizing-application-data#switch) , чтобы настроить бизнес-логику для назначения подразделения и соотнести ее с атрибутом AD *парентдистингуишеднаме*.

Например, если вы хотите создать пользователей в подразделении на основе атрибута HR "орган", можно использовать следующее выражение.

`
Switch([Municipality], "OU=Default,OU=Users,DC=contoso,DC=com", "Dallas", "OU=Dallas,OU=Users,DC=contoso,DC=com", "Austin", "OU=Austin,OU=Users,DC=contoso,DC=com", "Seattle", "OU=Seattle,OU=Users,DC=contoso,DC=com", "London", "OU=London,OU=Users,DC=contoso,DC=com")
`

В этом выражении, если значение органа государственной власти — Dallas, Остин, Сиэтл или Лондон, то учетная запись пользователя будет создана в соответствующем подразделении. Если совпадений нет, учетная запись будет создана в подразделении по умолчанию.

## <a name="plan-for-password-delivery-of-new-user-accounts"></a>Планирование доставки паролей для новых учетных записей пользователей

При запуске процесса объединения необходимо задать и доставить временный пароль для новых учетных записей пользователей. С облачным персоналом для подготовки пользователей в Azure AD вы можете выполнить развертывание функции [самостоятельного сброса пароля](https://docs.microsoft.com/azure/active-directory/authentication/quickstart-sspr) Azure AD (SSPR) для пользователя в день 1.

SSPR — это простое средство для ИТ-администраторов, позволяющих пользователям сбрасывать пароли или разблокирование их учетных записей. Вы можете подготавливать атрибут **номеров мобильных устройств** из облачного приложения HR к AD и синхронизировать его с Azure AD. Когда атрибут **номера мобильного устройства** находится в Azure AD, можно включить SSPR для учетной записи пользователя, чтобы в день 1 новые пользователи могли использовать зарегистрированный и проверенный номер мобильного устройства для проверки подлинности.

## <a name="plan-for-initial-cycle"></a>Планирование начального цикла

Когда служба подготовки Azure AD запускается впервые, она выполняет [первоначальный цикл](https://docs.microsoft.com/azure/active-directory/manage-apps/user-provisioning#what-happens-during-provisioning) работы с облачным приложением отдела кадров для создания моментального снимка всех объектов-пользователей в облачном приложении отдела кадров. Время, затрачиваемое на начальные циклы, непосредственно зависит от количества пользователей, имеющихся в исходной системе. Начальный цикл для некоторых клиентов облачных приложений отдела кадров с более чем 100 000 пользователями может занять много времени.

**Для больших клиентов облачных приложений отдела кадров (> 30 000) рекомендуется** запускать начальный цикл в прогрессивных стадиях и запускать добавочные обновления только после проверки того, что в AD заданы правильные атрибуты для различных сценариев подготовки пользователей. Используйте следующий порядок:

1. Запустите начальный цикл только для ограниченного набора пользователей, задав [Фильтр области](#plan-scoping-filters-and-attribute-mapping).
2. Проверьте подготовку учетных записей AD и значения атрибутов, заданные для пользователей, выбранных для первого запуска. Если результат соответствует ожиданиям, разверните фильтр области, чтобы добавить больше пользователей и проверить результаты второго запуска.

Когда вы удовлетворены результатами начального цикла для тестовых пользователей, можно запустить [добавочные обновления](https://docs.microsoft.com/azure/active-directory/manage-apps/user-provisioning#incremental-cycles).

## <a name="plan-testing-and-security"></a>Планирование тестирования и безопасности

На каждом этапе развертывания из начального пилотного проекта путем включения подготовки пользователей убедитесь, что результаты проверки ожидаемы, и выполните аудит циклов подготовки.

### <a name="plan-testing"></a>Планирование тестирования

После настройки облачного приложения HR для подготовки пользователей в Azure AD необходимо будет выполнить тестовые случаи, чтобы проверить, соответствует ли это решение требованиям вашей организации.

|Сценарии|Ожидаемые результаты|
|:-|:-|
|Новый прием сотрудников в облачном приложении отдела кадров| — Учетная запись пользователя подготовлена в AD.</br>Пользователи могут входить в приложения AD-Domain и выполнять необходимые действия.</br>— Если настроена синхронизация AAD Connect, то учетная запись пользователя также будет создана в Azure AD.
|Пользователь завершает работу в облачном приложении отдела кадров|— Учетная запись пользователя отключена в AD.</br>— Пользователь не может войти в корпоративные приложения, защищенные AD.
|Пользовательская организация обновлена в облачном приложении отдела кадров|На основе сопоставления атрибутов учетная запись пользователя перемещается из одного подразделения в другое в AD.|
|Менеджер пользователя по обновлениям отдела кадров в облачном приложении отдела кадров|Поле руководителя в AD обновляется в соответствии с именем нового руководителя.|
|HR перенимает сотрудника на новую роль.|Поведение зависит от того, как облачное приложение отдела кадров настроено для создания идентификаторов сотрудников:</br>— Если старый идентификатор сотрудника повторно используется для перенайма, соединитель включит существующую учетную запись AD для пользователя.</br>Если при перенайме получить новый идентификатор сотрудника, соединитель создаст для пользователя новую учетную запись AD.|
|HR преобразует сотрудника в контрактный работник или наоборот|Для нового персонажа создается новая учетная запись AD, а старая учетная запись отключается на дату вступления в силу.|

Используйте приведенные выше результаты, чтобы определить, как перенести автоматическую реализацию подготовки пользователей в рабочую среду на основе установленных временных шкал.

> [!TIP]
> Мы рекомендуем использовать такие методы, как сокращение данных и очистка данных, при обновлении тестовой среды с рабочими данными, чтобы удалить или маскировать конфиденциальные данные (личные сведения) в соответствии со стандартами конфиденциальности и безопасности.

### <a name="plan-security"></a>Планирование безопасности

Как правило, проверка безопасности должна быть необходима в рамках развертывания новой службы. Если проверка безопасности обязательна или еще не проведена, ознакомьтесь со многими техническими сведениями [об Azure AD,](https://www.microsoft.com/download/details.aspx?id=36391) которые предоставляют обзор идентификации как услуги.

### <a name="plan-rollback"></a>Откат плана

Если реализация подготовки пользователей в Cloud HR не работает, как требуется в рабочей среде, приведенные ниже шаги отката помогут вам вернуться к предыдущему известному работоспособному состоянию.

1. Просмотрите [сводный отчет о подготовке](https://docs.microsoft.com/azure/active-directory/active-directory-saas-provisioning-reporting#getting-provisioning-reports-from-the-azure-management-portal) и [журналы подготовки](https://docs.microsoft.com/azure/active-directory/active-directory-saas-provisioning-reporting#provisioning-audit-logs) (см. раздел [управление облачными пользователями Cloud App](#manage-your-configuration)), чтобы определить, какие неправильные операции были выполнены с затронутыми пользователями или группами.
2. Последнее известное работоспособное состояние пользователей и/или групп можно определить с помощью журналов аудита подготовки или путем просмотра целевых систем (Azure AD или AD).
3. Обратитесь к владельцу приложения, чтобы обновить пользователей и/или группы, затронутые непосредственно в приложении, используя последние известные значения хорошего состояния.

## <a name="deploy-the-cloud-hr-app"></a>Развертывание облачного приложения отдела кадров

Выберите облачное приложение отдела кадров, которое соответствует требованиям вашего решения.

**Workday** — см. [руководство по настройке workday для автоматической подготовки пользователей](https://docs.microsoft.com/azure/active-directory/saas-apps/workday-inbound-tutorial#planning-your-deployment) для выполнения действий, которые необходимо выполнить для импорта профилей рабочих ролей из Workday в Active Directory и Azure AD с дополнительной обратной записью адреса электронной почты и имени пользователя в Workday.

## <a name="manage-your-configuration"></a>Управление конфигурацией

Azure AD может предоставить дополнительные сведения об использовании и работоспособности подготовки пользователей в Организации с помощью журналов аудита и отчетов.

### <a name="gain-insights-from-reports-and-logs"></a>Получение ценных сведений из отчетов и журналов

После успешного выполнения [начального цикла](https://docs.microsoft.com/azure/active-directory/manage-apps/user-provisioning#what-happens-during-provisioning)служба подготовки Azure AD продолжит выполнять добавочные обновления в течение неограниченного времени с интервалами, определенными в руководствах для каждого приложения, до тех пор, пока не произойдет одно из следующих событий:

- Служба останавливается вручную и новый начальный цикл запускается с помощью [портал Azure](https://portal.azure.com/) или с помощью соответствующей команды [API Microsoft Graph](https://developer.microsoft.com/graph/docs/api-reference/beta/resources/synchronization-overview) .
- Новый начальный цикл активируется из-за изменения сопоставлений атрибутов или фильтров области.
- Процесс подготовки переходит в карантин из-за высокой частоты ошибок и остается в карантине в течение более чем четырех недель, когда она будет автоматически отключена.

Чтобы просмотреть эти события и все остальные действия, выполняемые службой подготовки, [Узнайте, как просматривать журналы и получать отчеты о действиях по подготовке](https://docs.microsoft.com/azure/active-directory/manage-apps/check-status-user-account-provisioning).

#### <a name="azure-monitor-logs"></a>Журналы Azure Monitor

Все действия, выполняемые службой подготовки, записываются в **журналы аудита Azure AD**. Вы можете направить журналы аудита Azure AD в журналы Azure Monitor для дальнейшего анализа. **Журналы Azure Monitor (также называемые log Analytics рабочей областью)** позволяют запрашивать данные для поиска событий, анализа тенденций и выполнения корреляции между различными источниками данных. Просмотрите это [видео](https://youtu.be/MP5IaCTwkQg) , чтобы узнать о преимуществах использования журналов Azure Monitor для журналов Azure AD в практических сценариях пользователя.

Вы можете установить [представления log Analytics для журналов действий Azure AD](https://docs.microsoft.com/azure/active-directory/reports-monitoring/howto-install-use-log-analytics-views) , чтобы получить доступ к [предварительно созданным отчетам](https://github.com/AzureAD/Deployment-Plans/tree/master/Log%20Analytics%20Views) по подготовке событий в вашей среде.

Дополнительные сведения см. в статье [Анализ журналов действий Azure AD с помощью журналов Azure Monitor](https://docs.microsoft.com/azure/active-directory/reports-monitoring/howto-analyze-activity-logs-log-analytics) .

### <a name="manage-personal-data"></a>Управление персональными данными

Azure AD Connect агент подготовки, установленный на сервере Windows Server, создает журналы в журнале событий Windows, которые могут содержать персональные данные, в зависимости от сопоставления атрибутов облачного приложения HR с атрибутами AD. Для соблюдения требований к конфиденциальности пользователей можно настроить запланированную задачу Windows для очистки журнала событий и гарантировать, что данные не будут храниться свыше 48 часов.

Служба подготовки Azure AD не создает отчеты, не выполняет аналитику и не предоставляет ценные сведения за 30 дней. Таким образом, в службе подготовки Azure AD не хранятся и не обрабатываются данные за период более 30 дней. 

### <a name="troubleshoot"></a>Устранение неполадок

Сведения об устранении неполадок, которые могут возникать во время подготовки, см. по следующим ссылкам:

- [Проблема при настройке подготовки пользователей в приложении из коллекции Azure AD](https://docs.microsoft.com/azure/active-directory/manage-apps/application-provisioning-config-problem)
- [Синхронизация атрибута из локального Active Directory с Azure AD для подготовки приложения](https://docs.microsoft.com/azure/active-directory/manage-apps/user-provisioning-sync-attributes-for-mapping)
- [Подготовка пользователей к приложению из коллекции Azure AD занимает несколько часов или больше](https://docs.microsoft.com/azure/active-directory/manage-apps/application-provisioning-when-will-provisioning-finish)
- [Проблема сохранения учетных данных администратора при настройке подготовки пользователей для приложения из коллекции Azure Active Directory](https://docs.microsoft.com/azure/active-directory/manage-apps/application-provisioning-config-problem-storage-limit)
- [Не выполняется подготовка пользователей к работе с приложением из коллекции Azure AD](https://docs.microsoft.com/azure/active-directory/manage-apps/application-provisioning-config-problem-no-users-provisioned)
- [В приложении из коллекции Azure AD выполняется подготовка неправильного набора пользователей](https://docs.microsoft.com/azure/active-directory/manage-apps/application-provisioning-config-problem-wrong-users-provisioned)
- [Настройка средства просмотра событий Windows для устранения неполадок агента](https://docs.microsoft.com/azure/active-directory/saas-apps/workday-inbound-tutorial#setting-up-windows-event-viewer-for-agent-troubleshooting)
- [Настройка журналов аудита на портале Azure для устранения неполадок службы](https://docs.microsoft.com/azure/active-directory/saas-apps/workday-inbound-tutorial#setting-up-azure-portal-audit-logs-for-service-troubleshooting)
- [Общие сведения о журналах операций создания учетных записей пользователей AD](https://docs.microsoft.com/azure/active-directory/saas-apps/workday-inbound-tutorial#understanding-logs-for-ad-user-account-create-operations)
- [Общие сведения о журналах операций обновления руководителя](https://docs.microsoft.com/azure/active-directory/saas-apps/workday-inbound-tutorial#understanding-logs-for-manager-update-operations)
- [Устранение распространенных ошибок](https://docs.microsoft.com/azure/active-directory/saas-apps/workday-inbound-tutorial#resolving-commonly-encountered-errors)

### <a name="next-steps"></a>Дальнейшие действия

- [Написание выражений для сопоставлений атрибутов](https://docs.microsoft.com/azure/active-directory/manage-apps/functions-for-customizing-application-data)
- [Общие сведения об API синхронизации Azure AD](https://developer.microsoft.com/graph/docs/api-reference/beta/resources/synchronization-overview)
- [Пропуск удаления учетных записей пользователей, которые выходят за пределы области](https://docs.microsoft.com/azure/active-directory/manage-apps/skip-out-of-scope-deletions)
- [Агент подготовки Azure AD Connect: журнал выпусков версий](https://docs.microsoft.com/azure/active-directory/manage-apps/provisioning-agent-release-version-history)
