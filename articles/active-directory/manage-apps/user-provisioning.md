---
title: Автоматическая подготовка пользователей для приложения SaaS в Azure AD | Документы Майкрософт
description: Общие сведения об использовании Azure AD для автоматической подготовки, отзыва и постоянного обновления учетных записей пользователей в нескольких приложениях SaaS сторонних разработчиков.
services: active-directory
documentationcenter: ''
author: msmimart
manager: CelesteDG
ms.service: active-directory
ms.subservice: app-mgmt
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 11/15/2019
ms.author: mimart
ms.reviewer: arvinh
ms.collection: M365-identity-device-management
ms.openlocfilehash: 1f661aa67f04de23c7b4871e78d3628c639e7567
ms.sourcegitcommit: 5cfe977783f02cd045023a1645ac42b8d82223bd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/17/2019
ms.locfileid: "74144534"
---
# <a name="automate-user-provisioning-and-deprovisioning-to-applications-with-azure-active-directory"></a>Автоматизируйте подготовку пользователей и отменяйте подготовку приложений с помощью Azure Active Directory

В Azure Active Directory (Azure AD) термин " **Подготовка приложения** " означает автоматическое создание удостоверений пользователей и ролей в облачных приложениях ([SaaS](https://azure.microsoft.com/overview/what-is-saas/)), к которым пользователям требуется доступ. Кроме создания удостоверений пользователей, автоматическая подготовка включает в себя обслуживание и удаление удостоверений пользователей по мере изменения состояния или ролей. Типичные сценарии включают подготовку пользователя Azure AD в таких приложениях, как [Dropbox](https://docs.microsoft.com/azure/active-directory/saas-apps/dropboxforbusiness-provisioning-tutorial), [Salesforce](https://docs.microsoft.com/azure/active-directory/saas-apps/salesforce-provisioning-tutorial), [ServiceNow](https://docs.microsoft.com/azure/active-directory/saas-apps/servicenow-provisioning-tutorial)и другие.

![Обзорная схема подготовки](media/user-provisioning/provisioning-overview.png)

Эта функция позволяет:

- **Автоматизация подготовки**: автоматическое создание новых учетных записей в правильных системах для новых людей, присоединяемых к вашей команде или организации.
- **Автоматизация отмены инициализации:** Автоматически деактивировать учетные записи в правильных системах, когда люди оставляют команду или организацию.
- **Синхронизация данных между системами:** Убедитесь, что удостоверения в приложениях и системах актуальны в соответствии с изменениями в каталоге или системе отдела кадров.
- **Группы инициализации:** Подготавливайте группы для приложений, которые их поддерживают.
- **Управление доступом:** Мониторинг и аудит, подготовленные для приложений.
- **Простое развертывание в условиях использования поля Браун:** Сопоставление существующих удостоверений между системами и предоставление простой интеграции, даже если пользователи уже существуют в целевой системе.
- **Используйте широкие возможности настройки:** Воспользуйтесь преимуществами настраиваемых сопоставлений атрибутов, определяющих, какие данные пользователя должны передаваться из исходной системы в целевую систему.
- **Получение оповещений о критических событиях:** Служба подготовки предоставляет оповещения для критически важных событий и позволяет интегрировать Log Analytics, где можно определить пользовательские оповещения для удовлетворения бизнес-потребностей.

## <a name="benefits-of-automatic-provisioning"></a>Преимущества автоматической подготовки

По мере роста количества приложений, используемых в современных организациях, ИТ – администраторы получают управление доступом в масштабе. Такие стандарты, как SAML или Open ID Connect (OIDC), позволяют администраторам быстро настроить единый вход (SSO), но для доступа также требуется, чтобы пользователи были подготовлены в приложении. Для многих администраторов подготовка означает ручное создание каждой учетной записи пользователя или отправку CSV-файлов каждую неделю, но эти процессы требуют длительных, дорогостоящих и подверженных ошибкам. Такие решения, как SAML JIT (JIT), были реализованы для автоматизации подготовки, но компаниям также требуется решение для отмены подготовки пользователей, когда они оставляют организацию или больше не требуют доступа к определенным приложениям в зависимости от изменения роли.

Ниже перечислены некоторые распространенные причины использования автоматической подготовки.

- Максимально эффективное быстродействие и точность процессов подготовки.
- Экономия ресурсов, связанных с размещением и обслуживанием пользовательских решений и сценариев подготовки.
- Защита Организации путем мгновенного удаления удостоверений пользователей из ключевых приложений SaaS при выходе из Организации.
- Простое импортирование большого числа пользователей в определенное приложение SaaS или систему.
- Наличие одного набора политик для определения пользователей, которые подготавливается, и пользователей, которые могут входить в приложение.

Подготовка пользователей Azure AD поможет решить эти проблемы. Чтобы узнать больше о том, как клиенты используют подготовку пользователей Azure AD, можно ознакомиться с примером [использования ASOS](https://aka.ms/asoscasestudy). В видео ниже приведены общие сведения о подготовке пользователей в Azure AD.

> [!VIDEO https://www.youtube.com/embed/_ZjARPpI6NI]

## <a name="what-applications-and-systems-can-i-use-with-azure-ad-automatic-user-provisioning"></a>Какие приложения и системы можно использовать с автоматической подготовкой пользователей Azure AD

В Azure AD реализована предварительно интегрированная поддержка многих популярных приложений SaaS и систем отдела кадров, а также общая поддержка приложений, которые реализуют определенные части [стандарта SCIM 2,0](https://techcommunity.microsoft.com/t5/Identity-Standards-Blog/Provisioning-with-SCIM-getting-started/ba-p/880010).

* **Предварительно интегрированные приложения (приложения SaaS в коллекции)** . Все приложения, для которых Azure AD поддерживает предварительно интегрированный соединитель подготовки, можно найти в [списке руководств по приложениям для подготовки пользователей](../saas-apps/tutorial-list.md). Предварительно интегрированные приложения, перечисленные в галерее, обычно используют API-интерфейсы управления пользователями на основе SCIM 2,0 для подготовки. 

   ![Логотип Salesforce](media/user-provisioning/gallery-app-logos.png)

   Если вы хотите запросить новое приложение для подготовки, вы можете [запросить интеграцию приложения с нашей коллекцией приложений](https://docs.microsoft.com/azure/active-directory/develop/howto-app-gallery-listing). Для запроса на подготовку пользователя требуется, чтобы приложение имело конечную точку, совместимую с SCIM. Запросите поставщика приложения следовать стандарту SCIM, чтобы мы могли быстро подключить приложение к нашей платформе.

* **Приложения, поддерживающие SCIM 2,0**. Сведения о универсальных способах подключения приложений, реализующих API-интерфейсы управления пользователями на основе SCIM 2,0, см. в разделе [Использование scim для автоматической настройки пользователей и групп из Azure Active Directory в приложения](use-scim-to-provision-users-and-groups.md).

## <a name="what-is-scim"></a>Что такое SCIM?

Чтобы помочь автоматизировать подготовку и отмену подготовки, приложения предоставляют собственные интерфейсы API пользователей и групп. Однако все, кто пытается управлять пользователями в нескольких приложениях, покажет, что каждое приложение пытается выполнить одни и те же простые действия, такие как создание или обновление пользователей, Добавление пользователей в группы или отменяется предоставление пользователям. Но все эти простые действия реализуются немного по-разному, используя разные пути к конечным точкам, различные методы для указания сведений о пользователе и другая схема для представления каждого элемента информации.

Для решения этих проблем спецификация SCIM предоставляет общую схему пользователя, помогающую пользователям переходить к приложениям, выходить из них и вокруг них. SCIM становится стандартом де-факто для подготовки и, при использовании в сочетании с стандартами Федерации, такими как SAML или OpenID Connect Connect, предоставляет администраторам комплексное решение для управления доступом на основе стандартов.

Подробное руководство по использованию SCIM для автоматизации подготовки и деподготовки пользователей и групп для приложения см. в статье [подготовка пользователей scim с помощью Azure Active Directory](use-scim-to-provision-users-and-groups.md).

## <a name="how-does-automatic-provisioning-work"></a>Как работает автоматическая подготовка

**Служба подготовки Azure AD** подготавливает пользователей к приложениям SaaS и другим системам, подключаясь к конечным точкам API управления пользователями, предоставляемым каждым поставщиком приложения. Эти конечные точки API управления пользователями позволяют Azure AD создавать, обновлять и удалять пользователей путем программирования. Для выбранных приложений Служба подготовки может также создавать, обновлять и удалять дополнительные объекты, связанные с удостоверениями, такие как группы и роли.

![службы подготовки Azure AD](./media/user-provisioning/provisioning0.PNG)
*рис. 1. Служба подготовки Azure AD*

Рабочий процесс подготовки исходящего пользователя ![](./media/user-provisioning/provisioning1.PNG)
*рис. 2. "исходящий" Рабочий процесс подготовки пользователей из Azure AD в популярные приложения SaaS*

Рабочий процесс подготовки входящих пользователей ![](./media/user-provisioning/provisioning2.PNG)
*рис. 3. "входящий" Рабочий процесс подготовки пользователей из популярных приложений управления человеческим капиталом (HCM) на Azure Active Directory и Windows Server Active Directory*

## <a name="how-do-i-set-up-automatic-provisioning-to-an-application"></a>Как настроить автоматический вход в приложение

Для предварительно интегрированных приложений, перечисленных в коллекции, доступны пошаговые инструкции по настройке автоматической подготовки. См. [список учебников по интегрированным приложениям галереи](https://docs.microsoft.com/azure/active-directory/saas-apps/). В следующем видео показано, как настроить автоматическую подготовку пользователей для SalesForce.

> [!VIDEO https://www.youtube.com/embed/pKzyts6kfrw]

Для других приложений, поддерживающих SCIM 2,0, выполните действия, описанные в статье [scim подготовка пользователей с помощью Azure Active Directory](use-scim-to-provision-users-and-groups.md).

## <a name="what-happens-during-provisioning"></a>Что происходит при подготовке

Когда исходной системой является Azure AD, служба подготовки использует [функцию разностных запросов API Graph Azure AD](https://msdn.microsoft.com/Library/Azure/Ad/Graph/howto/azure-ad-graph-api-differential-query) для отслеживания пользователей и групп. Служба подготовки выполняет начальный цикл по отношению к исходной системе и целевой системе, за которыми следуют периодические инкрементные циклы.

### <a name="initial-cycle"></a>Начальный цикл

При запуске службы подготовки первая синхронизация всегда выполняется:

1. Запрашивает всех пользователей и все группы из исходной системы, получая все атрибуты, определенные в [сопоставлениях атрибутов](customize-application-attributes.md).
1. Фильтрует полученных пользователей и группы с помощью настроенных [назначений](assign-user-or-group-access-portal.md) или [фильтров области на основе атрибутов](define-conditional-rules-for-provisioning-user-accounts.md).
1. При назначении пользователя или в области для подготовки служба запрашивает у целевой системы соответствующего пользователя, используя указанные [атрибуты сопоставления](customize-application-attributes.md#understanding-attribute-mapping-properties). Пример. Если имя userPrincipal в исходной системе является совпадающим атрибутом и соответствует атрибуту userName в целевой системе, то служба подготовки запрашивает у целевой системы атрибуты userName, которые соответствуют значениям имени userPrincipal в исходной системе.
1. Если соответствующий пользователь не найден в целевой системе, он создается с использованием атрибутов, возвращенных исходной системой. После создания учетной записи пользователя Служба подготовки обнаруживает и кэширует идентификатор целевой системы для нового пользователя, который используется для выполнения всех последующих операций с этим пользователем.
1. Если найден соответствующий пользователь, он обновляется с использованием атрибутов, предоставляемых исходной системой. После сопоставления учетной записи пользователя Служба подготовки обнаруживает и кэширует идентификатор целевой системы для нового пользователя, который используется для выполнения всех последующих операций с этим пользователем.
1. Если сопоставления атрибутов содержат атрибуты "Reference", служба выполняет дополнительные обновления в целевой системе для создания и связывания объектов, на которые имеются ссылки. Например, пользователь может использовать атрибут Manager в целевой системе, который связан с другим пользователем, созданным в целевой системе.
1. Сохранить водяной знак в конце начального цикла, который предоставляет отправную точку для последующих инкрементных циклов.

Некоторые приложения, такие как ServiceNow, G Suite и Box, поддерживают не только пользователей, но и группы, а также их членов. В таких случаях, если в [сопоставлениях](customize-application-attributes.md)включена подготовка групп, служба подготовки синхронизирует пользователей и группы, а затем синхронизирует членство в группах.

### <a name="incremental-cycles"></a>Добавочные циклы

После начального цикла все остальные циклы будут:

1. Запрашивает у исходной системы всех пользователей и все группы, которые были обновлены с момента сохранения последнего водяного знака.
1. Фильтрует полученных пользователей и группы с помощью настроенных [назначений](assign-user-or-group-access-portal.md) или [фильтров области на основе атрибутов](define-conditional-rules-for-provisioning-user-accounts.md).
1. При назначении пользователя или в области для подготовки служба запрашивает у целевой системы соответствующего пользователя, используя указанные [атрибуты сопоставления](customize-application-attributes.md#understanding-attribute-mapping-properties).
1. Если соответствующий пользователь не найден в целевой системе, он создается с использованием атрибутов, возвращенных исходной системой. После создания учетной записи пользователя Служба подготовки обнаруживает и кэширует идентификатор целевой системы для нового пользователя, который используется для выполнения всех последующих операций с этим пользователем.
1. Если найден соответствующий пользователь, он обновляется с использованием атрибутов, предоставляемых исходной системой. Если это новая назначенная учетная запись, служба подготовки обнаруживает и кэширует идентификатор целевой системы для нового пользователя, который используется для выполнения всех последующих операций с этим пользователем.
1. Если сопоставления атрибутов содержат атрибуты "Reference", служба выполняет дополнительные обновления в целевой системе для создания и связывания объектов, на которые имеются ссылки. Например, пользователь может использовать атрибут Manager в целевой системе, который связан с другим пользователем, созданным в целевой системе.
1. Если пользователь, который ранее был в области для подготовки, удаляется из нее (включая отмену назначения), то служба отключает этого пользователя в целевой системе при обновлении.
1. Если пользователь, который ранее был в области для подготовки, отключается или обратимо удаляется в исходной системе, то служба отключает этого пользователя в целевой системе при обновлении.
1. Если пользователь, который ранее был в области для подготовки, необратимо удаляется в исходной системе, то служба удаляет этого пользователя в целевой системе. В Azure AD пользователи жестко удаляются через 30 дней после обратимого удаления.
1. Сохранить новый водяной знак в конце инкрементного цикла, который предоставляет начальную точку для последующих инкрементных циклов.

> [!NOTE]
> При необходимости можно отключить операции **создания**, **обновления**или **удаления** с помощью флажков " **действия целевого объекта** " в разделе " [сопоставления](customize-application-attributes.md) ". Логикой отключения пользователей во время обновления также управляет сопоставление атрибутов из поля, например accountEnabled.

Служба подготовки продолжит выполнение добавочных циклов в течение неограниченного времени с интервалами, определенными в [руководстве по каждому приложению](../saas-apps/tutorial-list.md), до тех пор, пока не произойдет одно из следующих событий:

- Служба останавливается вручную с помощью портала Azure или соответствующей команды API Graph. 
- Новый начальный цикл активируется с помощью параметра **очистить состояние и перезапустить** в портал Azure или с помощью соответствующей команды API Graph. Это действие очищает любой сохраненный водяной знак и вызывает повторную оценку всех исходных объектов.
- Новый начальный цикл запускается из-за изменения сопоставлений атрибутов или фильтров области. Это действие также очищает любой сохраненный водяной знак и вызывает повторную оценку всех исходных объектов.
- Процесс подготовки переходит в карантин (см. ниже) из-за высокой частоты ошибок и остается в карантине более четырех недель. В этом случае служба будет автоматически отключена.

### <a name="errors-and-retries"></a>Ошибки и повторные попытки

Если отдельный пользователь не может быть добавлен, обновлен или удален в целевой системе из-за ошибки в целевой системе, операция выполняется повторно в следующем цикле синхронизации. Если операция с пользователем продолжает завершаться сбоем, то повторные попытки будут выполняться с меньшей частотой вплоть до одной попытки в день. Чтобы устранить ошибку, администраторы должны проверить [журналы подготовки](../reports-monitoring/concept-provisioning-logs.md?context=azure/active-directory/manage-apps/context/manage-apps-context) , чтобы определить основную причину и предпринять соответствующие действия. Ниже перечислены распространенные ошибки.

- Не заполнен атрибут пользователей в исходной системе, требуемый в целевой системе.
- Пользователи, имеющие значение атрибута в исходной системе, для которого существует ограничение уникальности в целевой системе, и одно и то же значение присутствует в другой записи пользователя.

Эти ошибки можно устранить, настроив значения атрибутов для затронутого пользователя в исходной системе или настроив сопоставления атрибутов таким образом, чтобы не возникали конфликты.

### <a name="quarantine"></a>Карантин

Если большинство или все вызовы, выполненные для целевой системы, постоянно завершаются сбоем из-за ошибки (например, для недопустимых учетных данных администратора), задание подготовки переходит в состояние "карантина". Это состояние указывается в [сводном отчете по подготовке](check-status-user-account-provisioning.md) и по электронной почте, если уведомления по электронной почте были настроены в портал Azure.

В карантине частота добавочных циклов постепенно сокращается до одного раза в день.

Задание подготовки будет удалено из карантина после устранения всех ошибочных ошибок и начала следующего цикла синхронизации. Если задания подготовки остается в карантине более четырех недель, оно отключается. Дополнительные сведения о состоянии карантина см. [здесь](https://docs.microsoft.com/azure/active-directory/manage-apps/application-provisioning-quarantine-status).

## <a name="how-long-will-it-take-to-provision-users"></a>Сколько времени занимает подготовка пользователей?

Производительность зависит от того, выполняет ли задание подготовки первоначальный цикл подготовки или добавочный цикл. Дополнительные сведения о том, как долго выполняется подготовка и как отслеживать состояние службы подготовки, см. [в разделе Проверка состояния подготовки пользователей](application-provisioning-when-will-provisioning-finish-specific-user.md).

## <a name="how-can-i-tell-if-users-are-being-provisioned-properly"></a>Как узнать, правильно ли подготовлены пользователи?

Все операции, выполняемые службой подготовки пользователей, записываются в [журналы подготовки Azure AD (Предварительная версия)](../reports-monitoring/concept-provisioning-logs.md?context=azure/active-directory/manage-apps/context/manage-apps-context). Сюда входят все операции чтения и записи, выполненные в исходной и целевой системах, а также данные пользователя, которые были считаны или записаны во время каждой операции.

Дополнительные сведения о том, как читать журналы подготовки в портал Azure, см. в разделе [руководство по подготовке отчетов](check-status-user-account-provisioning.md).

## <a name="how-do-i-troubleshoot-issues-with-user-provisioning"></a>Как устранить неполадки, связанные с подготовкой пользователей?

Руководство по устранению неполадок при автоматической подготовке пользователей со сценариями доступно в разделе [Проблемы при настройке и подготовке пользователей для приложения](application-provisioning-config-problem.md).

## <a name="what-are-the-best-practices-for-rolling-out-automatic-user-provisioning"></a>Каковы рекомендации по развертыванию автоматической подготовки пользователей?

> [!VIDEO https://www.youtube.com/embed/MAy8s5WSe3A]

Пример поэтапного плана развертывания "исходящей" подготовки пользователей в приложении см. в документе [Outbound User Provisioning Deployment Plan](https://aka.ms/deploymentplans/userprovisioning) (План развертывания "исходящей" подготовки пользователей).

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

### <a name="does-automatic-user-provisioning-to-saas-apps-work-with-b2b-users-in-azure-ad"></a>Поддерживается ли автоматическая подготовка пользователей для приложений SaaS для пользователей B2B в Azure AD?

Да, можно использовать службу подготовки пользователей Azure AD для подготовки пользователей B2B (или гостей) в Azure AD к приложениям SaaS.

Тем не менее, чтобы пользователи B2B могли входить в приложение SaaS с помощью Azure AD, в приложении SaaS должна быть настроена возможность единого входа на основе SAML. Дополнительные сведения о настройке приложений SaaS для поддержки входа пользователей B2B см. в разделе [Настройка приложений SaaS для службы совместной работы B2B]( https://docs.microsoft.com/azure/active-directory/b2b/configure-saas-apps).

### <a name="does-automatic-user-provisioning-to-saas-apps-work-with-dynamic-groups-in-azure-ad"></a>Поддерживается ли автоматическая подготовка пользователей для приложений SaaS для динамических групп в Azure AD?

Да. При настройке параметра "синхронизировать только назначенные пользователи и группы" Служба подготовки пользователей Azure AD может подготовить или отменить подготовку пользователей в приложении SaaS в зависимости от того, являются ли они членами [динамической группы](../users-groups-roles/groups-create-rule.md). Динамические группы также работают с параметром "Синхронизация всех пользователей и групп".

Тем не менее использование динамических групп может повлиять на общую производительность комплексной подготовки пользователей из Azure AD для приложений SaaS. При использовании динамических групп учитывайте следующие предостережения и рекомендации.

- Скорость подготовки и отзыва пользователя из динамической группы в приложении SaaS зависит от того, как быстро динамическая группа может оценить изменения членства. Сведения о том, как проверить состояние обработки динамической группы, см. в разделе [Проверка состояния обработки правила членства](https://docs.microsoft.com/azure/active-directory/users-groups-roles/groups-create-rule).

- При использовании динамических групп правила должны быть тщательно обработаны при подготовке и отзыве пользователей, так как утрата членства приводит к отсчету события отзыва.

### <a name="does-automatic-user-provisioning-to-saas-apps-work-with-nested-groups-in-azure-ad"></a>Поддерживается ли автоматическая подготовка пользователей для приложений SaaS для вложенных групп в Azure AD?

Нет При настройке "синхронизировать только назначенные пользователи и группы" Служба подготовки пользователей Azure AD не может считывать или подготавливать пользователей, которые находятся во вложенных группах. Он может только считывать и подготавливать пользователей, которые являются непосредственными членами явно назначенной группы.

Это ограничение назначений на основе группы для приложений, которое также влияет на единый вход. Оно описано в разделе [Использование группы для управления доступом к приложениям SaaS](https://docs.microsoft.com/azure/active-directory/users-groups-roles/groups-saasapps ).

В качестве обходного решения следует явно назначить (или иным образом [областью действия](https://docs.microsoft.com/azure/active-directory/manage-apps/define-conditional-rules-for-provisioning-user-accounts)) группы, содержащие пользователей, которые должны быть подготовлены.

### <a name="is-provisioning-between-azure-ad-and-a-target-application-using-an-encrypted-channel"></a>Является ли подготовка между Azure AD и целевым приложением с помощью зашифрованного канала?

Да. Мы используем HTTPS-шифрование SSL для целевого сервера.

## <a name="related-articles"></a>Связанные статьи

- [Список руководств по интеграции приложений SaaS с Azure Active Directory](../saas-apps/tutorial-list.md)
- [Настройка сопоставлений атрибутов для подготовки пользователей](customize-application-attributes.md)
- [Написание выражений для сопоставлений атрибутов](functions-for-customizing-application-data.md)
- [Фильтры области для подготовки пользователей](define-conditional-rules-for-provisioning-user-accounts.md)
- [Использование SCIM для включения автоматической подготовки пользователей и групп из Azure AD в приложения](use-scim-to-provision-users-and-groups.md)
- [Общие сведения об API синхронизации Azure AD](https://developer.microsoft.com/graph/docs/api-reference/beta/resources/synchronization-overview)
