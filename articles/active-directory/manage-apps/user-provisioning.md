---
title: Автоматическая подготовка пользователей для приложения SaaS в Azure AD | Документы Майкрософт
description: Общие сведения об использовании Azure AD для автоматической подготовки, отзыва и постоянного обновления учетных записей пользователей в нескольких приложениях SaaS сторонних разработчиков.
services: active-directory
documentationcenter: ''
author: msmimart
manager: CelesteDG
ms.service: active-directory
ms.subservice: app-mgmt
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 06/12/2019
ms.author: mimart
ms.reviewer: arvinh
ms.collection: M365-identity-device-management
ms.openlocfilehash: 3ef652b05f62218ee1d0e72543bfa546f0c14abe
ms.sourcegitcommit: be344deef6b37661e2c496f75a6cf14f805d7381
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/07/2019
ms.locfileid: "72001708"
---
# <a name="automate-user-provisioning-and-deprovisioning-to-saas-applications-with-azure-active-directory"></a>Автоматическая подготовка пользователей и ее отзыв для приложений SaaS в Azure Active Directory

Azure Active Directory (Azure AD) позволяет автоматизировать создание, Обслуживание и удаление удостоверений пользователей в облачных приложениях ([SaaS](https://azure.microsoft.com/overview/what-is-saas/)), таких как Dropbox, Salesforce, ServiceNow и т. д. Это называется автоматической подготовкой пользователей для приложений SaaS.

> [!VIDEO https://www.youtube.com/embed/_ZjARPpI6NI]

Эта функция позволяет:

- Автоматическое создание новых учетных записей в соответствующих системах для новых членов вашей команды или организации.
- Автоматическая деактивация учетных записей в соответствующих системах, когда люди покидают команду или организацию.
- Постоянное обновление удостоверений в ваших приложениях и системах при внесении изменений в каталог или в систему управления персоналом.
- Подготовка не созданных пользователями объектов, таких как группы, в приложениях, которые их поддерживают.

Автоматическая подготовка пользователей также включает в себя следующие функции:

- Возможность сопоставления существующих удостоверений между исходной и целевой системами.
- Настраиваемые сопоставления атрибутов, которые определяют, какие данные пользователя должны поступать из исходной системы в целевую систему.
- Необязательная отправка сообщения с оповещением об ошибке при подготовке.
- Составление отчетов и журналов действий для упрощения отслеживания и устранения неполадок.

## <a name="why-use-automated-provisioning"></a>Для чего нужна автоматическая подготовка

Вот несколько основных причин, по которым стоит использовать эту функцию:

- Исключение затрат, неэффективности и ошибок, связанных с человеческим фактором, которые могут возникать в ходе выполнения подготовки вручную.
- Отсутствие затрат, связанных с размещением и поддержкой специально разработанных решений и скриптов для подготовки.
- Защита Организации путем мгновенного удаления удостоверений пользователей из ключевых приложений SaaS при выходе из Организации.
- Простое импортирование большого числа пользователей в определенное приложение SaaS или систему.
- Наличие одного набора политик для определения пользователей, которые подготавливается, и пользователей, которые могут входить в приложение.

## <a name="how-does-automatic-provisioning-work"></a>Как работает автоматическая подготовка

**Служба подготовки Azure AD** подготавливает пользователей к приложениям SaaS и другим системам, подключаясь к конечным точкам API управления пользователями, предоставляемым каждым поставщиком приложения. Эти конечные точки API управления пользователями позволяют Azure AD создавать, обновлять и удалять пользователей путем программирования. Для выбранных приложений Служба подготовки может также создавать, обновлять и удалять дополнительные объекты, связанные с удостоверениями, такие как группы и роли.

Служба подготовки AD @no__t 0Azure @ no__t-1 @ no__t-2Figure 1: Служба подготовки Azure AD*

Рабочий процесс подготовки пользователей @no__t 0Outbound @ no__t-1 @ no__t-2Figure 2: "Исходящий" рабочий процесс подготовки пользователей из Azure AD в популярные приложения SaaS*

Рабочий процесс подготовки пользователей @no__t 0Inbound @ no__t-1 @ no__t-2Figure 3: "Входящий" рабочий процесс подготовки пользователей из популярных приложений управления кадрами (HCM) в Azure Active Directory и Windows Server Active Directory*

## <a name="what-applications-and-systems-can-i-use-with-azure-ad-automatic-user-provisioning"></a>Какие приложения и системы можно использовать с автоматической подготовкой пользователей Azure AD

В Azure AD реализована предварительно интегрированная поддержка многих популярных приложений SaaS и систем отдела кадров, а также общая поддержка приложений, которые реализуют определенные части [стандарта SCIM 2,0](https://techcommunity.microsoft.com/t5/Identity-Standards-Blog/Provisioning-with-SCIM-getting-started/ba-p/880010).

### <a name="pre-integrated-applications"></a>Предварительно интегрированные приложения

Перечень всех приложений, для которых Azure AD поддерживает предварительно интегрированный соединитель подготовки, приведен в [списке руководств по приложениям для подготовки пользователей](../saas-apps/tutorial-list.md).

Для того чтобы связаться с командой инженеров Azure AD для обеспечения подготовки в других приложениях, отправьте сообщение через [форум отзывов Azure Active Directory](https://feedback.azure.com/forums/374982-azure-active-directory-application-requests/filters/new?category_id=172035).

> [!NOTE]
> Чтобы приложение поддерживало автоматическую подготовку пользователей, сначала оно должно предоставить необходимые API управления пользователями, которые позволят внешним программам автоматизировать создание, обслуживание и удаление пользователей. Таким образом не все приложения SaaS совместимы с этой функцией. Для приложений, поддерживающих интерфейсы API управления пользователями, группа инженеров Azure AD может создать соединитель подготовки для этих приложений, и эта работа будет определяться приоритетом текущих и потенциальных клиентов.

### <a name="connecting-applications-that-support-scim-20"></a>Подключение приложений с поддержкой SCIM 2.0

Общие инструкции по подключению приложений, которые реализуют API управления пользователями на основе SCIM 2.0, см. в статье [Использование SCIM для автоматической подготовки пользователей и групп Azure Active Directory для приложений](use-scim-to-provision-users-and-groups.md).

## <a name="how-do-i-set-up-automatic-provisioning-to-an-application"></a>Как настроить автоматический вход в приложение

> [!VIDEO https://www.youtube.com/embed/pKzyts6kfrw]

Используйте портал Azure Active Directory, чтобы настроить службу подготовки Azure AD для выбранного приложения.

1. Откройте **[портал Azure Active Directory](https://aad.portal.azure.com)** .
1. В области слева выберите **корпоративные приложения** . Отобразится список всех настроенных приложений.
1. Выберите **+ создать приложение** , чтобы добавить приложение. В зависимости от сценария добавьте один из следующих параметров.

   - Параметр **Добавить собственное приложение** поддерживает пользовательские интеграции scim.
   - Все приложения в разделе **Добавление из галереи** > **популярных приложений** поддерживают автоматическую подготовку. Дополнительные приложения см. в [списке руководств по приложениям для подготовки пользователей](../saas-apps/tutorial-list.md).

1. Укажите подробные сведения и нажмите кнопку **Добавить**. Новое приложение будет добавлено в список корпоративных приложений и откроется на экране управления приложениями.
1. Выберите **Подготовка** для управления параметрами подготовки учетных записей пользователей для приложения.

   ![Отображение экрана параметров подготовки](./media/user-provisioning/provisioning_settings0.PNG)

1. Установите флажок автоматически для **режима подготовки** , чтобы указать параметры учетных данных администратора, сопоставления, запуска и остановки и синхронизации.

   - Разверните узел **учетные данные администратора** , чтобы ввести учетные данные, необходимые для подключения Azure AD к API управления пользователями приложения. Этот раздел также позволяет включить уведомления по электронной почте в случае сбоя учетных данных или задания подготовки в [карантине](#quarantine).
   - Разверните узел **сопоставления** , чтобы просмотреть и изменить атрибуты пользователей, переходящих между Azure AD и целевым приложением при подготовке или обновлении учетных записей пользователей. Если целевое приложение поддерживает его, в этом разделе можно дополнительно настроить подготовку групп и учетных записей пользователей. Выберите сопоставление в таблице, чтобы открыть редактор сопоставления справа, где можно просмотреть и настроить атрибуты пользователя.

     **Фильтры области** указывают службе подготовки, какие пользователи и группы в исходной системе должны быть подготовлены к работе или отменены для целевой системы. На панели **сопоставление атрибутов** выберите **область исходного объекта** для фильтрации по указанным значениям атрибутов. Например, вы можете указать, что в области подготовки должны быть только пользователи с атрибутом отдела "Продажи". Дополнительные сведения см. в разделе [Подготовка приложений на основе атрибутов с использованием фильтров области](define-conditional-rules-for-provisioning-user-accounts.md).

     Дополнительные сведения см. в статье [Настройка сопоставлений атрибутов для подготовки пользователей для приложений SaaS в Azure Active Directory](customize-application-attributes.md).

   - **Параметры** управляют работой службы подготовки для приложения, включая, выполняется ли оно в данный момент. В меню **область** можно указать, должны ли быть в области подготовки только назначенные пользователи и группы, или если все пользователи в каталоге Azure AD должны быть подготовлены. Дополнительные сведения см. в статье [Назначение пользователя или группы корпоративному приложению в Azure Active Directory](assign-user-or-group-access-portal.md).

На экране Управление приложениями выберите **журналы подготовки (Предварительная версия)** , чтобы просмотреть записи каждой операции, выполняемой службой подготовки Azure AD. Дополнительные сведения см. в статье [Руководство по отчетам об автоматической подготовке учетных записей пользователей](check-status-user-account-provisioning.md).

![Пример. экран "журналы подготовки" для приложения](./media/user-provisioning/audit_logs.PNG)

> [!NOTE]
> Для настройки службы подготовки пользователей Azure AD и управления ею можно также использовать [API Microsoft Graph](https://developer.microsoft.com/graph/docs/api-reference/beta/resources/synchronization-overview).

## <a name="what-happens-during-provisioning"></a>Что происходит при подготовке

Когда исходной системой является Azure AD, служба подготовки использует [функцию разностных запросов API Graph Azure AD](https://msdn.microsoft.com/Library/Azure/Ad/Graph/howto/azure-ad-graph-api-differential-query) для отслеживания пользователей и групп. Служба подготовки выполняет начальный цикл по отношению к исходной системе и целевой системе, за которыми следуют периодические инкрементные циклы.

### <a name="initial-cycle"></a>Начальный цикл

При запуске службы подготовки первая синхронизация всегда выполняется:

1. Запрашивает всех пользователей и все группы из исходной системы, получая все атрибуты, определенные в [сопоставлениях атрибутов](customize-application-attributes.md).
1. Фильтрует полученных пользователей и группы с помощью настроенных [назначений](assign-user-or-group-access-portal.md) или [фильтров области на основе атрибутов](define-conditional-rules-for-provisioning-user-accounts.md).
1. При назначении пользователя или в области для подготовки служба запрашивает у целевой системы соответствующего пользователя, используя указанные [атрибуты сопоставления](customize-application-attributes.md#understanding-attribute-mapping-properties). Пример: Если имя userPrincipal в исходной системе является совпадающим атрибутом и соответствует атрибуту userName в целевой системе, то служба подготовки запрашивает у целевой системы атрибуты userName, которые соответствуют значениям имени userPrincipal в исходной системе.
1. Если соответствующий пользователь не найден в целевой системе, он создается с использованием атрибутов, возвращенных исходной системой. После создания учетной записи пользователя Служба подготовки обнаруживает и кэширует идентификатор целевой системы для нового пользователя, который используется для выполнения всех последующих операций с этим пользователем.
1. Если найден соответствующий пользователь, он обновляется с использованием атрибутов, предоставляемых исходной системой. После сопоставления учетной записи пользователя Служба подготовки обнаруживает и кэширует идентификатор целевой системы для нового пользователя, который используется для выполнения всех последующих операций с этим пользователем.
1. Если сопоставления атрибутов содержат атрибуты "Reference", служба выполняет дополнительные обновления в целевой системе для создания и связывания объектов, на которые имеются ссылки. Например, пользователь может использовать атрибут Manager в целевой системе, который связан с другим пользователем, созданным в целевой системе.
1. Сохранить водяной знак в конце начального цикла, который предоставляет отправную точку для последующих инкрементных циклов.

Некоторые приложения, такие как ServiceNow, G Suite и Box, поддерживают не только пользователей, но и группы, а также их членов. В таких случаях, если в [сопоставлениях](customize-application-attributes.md)включена подготовка групп, служба подготовки синхронизирует пользователей и группы, а затем синхронизирует членство в группах.

### <a name="incremental-cycles"></a>Добавочные циклы

После начального цикла все остальные циклы будут:

1. Запрашивает у исходной системы всех пользователей и все группы, которые были обновлены с момента сохранения последнего водяного знака.
1. Фильтрует полученных пользователей и группы с помощью настроенных [назначений](assign-user-or-group-access-portal.md) или [фильтров области на основе атрибутов](define-conditional-rules-for-provisioning-user-accounts.md).
1. При назначении пользователя или в области для подготовки служба запрашивает у целевой системы соответствующего пользователя, используя указанные [атрибуты сопоставления](customize-application-attributes.md#understanding-attribute-mapping-properties).
1. Если соответствующий пользователь не найден в целевой системе, он создается с использованием атрибутов, возвращенных исходной системой. После создания учетной записи пользователя Служба подготовки обнаруживает и кэширует идентификатор целевой системы для нового пользователя, который используется для выполнения всех последующих операций с этим пользователем.
1. Если найден соответствующий пользователь, он обновляется с использованием атрибутов, предоставляемых исходной системой. Если это новая назначенная учетная запись, служба подготовки обнаруживает и кэширует идентификатор целевой системы для нового пользователя, который используется для выполнения всех последующих операций с этим пользователем.
1. Если сопоставления атрибутов содержат атрибуты "Reference", служба выполняет дополнительные обновления в целевой системе для создания и связывания объектов, на которые имеются ссылки. Например, пользователь может использовать атрибут Manager в целевой системе, который связан с другим пользователем, созданным в целевой системе.
1. Если пользователь, который ранее был в области для подготовки, удаляется из нее (включая отмену назначения), то служба отключает этого пользователя в целевой системе при обновлении.
1. Если пользователь, который ранее был в области для подготовки, отключается или обратимо удаляется в исходной системе, то служба отключает этого пользователя в целевой системе при обновлении.
1. Если пользователь, который ранее был в области для подготовки, необратимо удаляется в исходной системе, то служба удаляет этого пользователя в целевой системе. В Azure AD пользователи жестко удаляются через 30 дней после обратимого удаления.
1. Сохранить новый водяной знак в конце инкрементного цикла, который предоставляет начальную точку для последующих инкрементных циклов.

> [!NOTE]
> При необходимости можно отключить операции **создания**, **обновления**или **удаления** с помощью флажков " **действия целевого объекта** " в разделе " [сопоставления](customize-application-attributes.md) ". Логикой отключения пользователей во время обновления также управляет сопоставление атрибутов из поля, например accountEnabled.

Служба подготовки продолжит выполнение добавочных циклов в течение неограниченного времени с интервалами, определенными в [руководстве по каждому приложению](../saas-apps/tutorial-list.md), до тех пор, пока не произойдет одно из следующих событий:

- Служба останавливается вручную с помощью портала Azure или соответствующей команды API Graph. 
- Новый начальный цикл активируется с помощью параметра **очистить состояние и перезапустить** в портал Azure или с помощью соответствующей команды API Graph. Это действие очищает любой сохраненный водяной знак и вызывает повторную оценку всех исходных объектов.
- Новый начальный цикл запускается из-за изменения сопоставлений атрибутов или фильтров области. Это действие также очищает любой сохраненный водяной знак и вызывает повторную оценку всех исходных объектов.
- Процесс подготовки переходит в карантин (см. ниже) из-за высокой частоты ошибок и остается в карантине более четырех недель. В этом случае служба будет автоматически отключена.

### <a name="errors-and-retries"></a>Ошибки и повторные попытки

Если отдельный пользователь не может быть добавлен, обновлен или удален в целевой системе из-за ошибки в целевой системе, операция выполняется повторно в следующем цикле синхронизации. Если операция с пользователем продолжает завершаться сбоем, то повторные попытки будут выполняться с меньшей частотой вплоть до одной попытки в день. Чтобы устранить ошибку, администраторы должны проверить [журналы подготовки](../reports-monitoring/concept-provisioning-logs.md?context=azure/active-directory/manage-apps/context/manage-apps-context) , чтобы определить основную причину и предпринять соответствующие действия. Ниже перечислены распространенные ошибки.

- Не заполнен атрибут пользователей в исходной системе, требуемый в целевой системе.
- Пользователи, имеющие значение атрибута в исходной системе, для которого существует ограничение уникальности в целевой системе, и одно и то же значение присутствует в другой записи пользователя.

Эти ошибки можно устранить, настроив значения атрибутов для затронутого пользователя в исходной системе или настроив сопоставления атрибутов таким образом, чтобы не возникали конфликты.

### <a name="quarantine"></a>Карантин

Если большинство или все вызовы, выполненные для целевой системы, постоянно завершаются сбоем из-за ошибки (например, для недопустимых учетных данных администратора), задание подготовки переходит в состояние "карантина". Это состояние указывается в [сводном отчете по подготовке](check-status-user-account-provisioning.md) и по электронной почте, если уведомления по электронной почте были настроены в портал Azure.

В карантине частота добавочных циклов постепенно сокращается до одного раза в день.

Задание подготовки будет удалено из карантина после устранения всех ошибочных ошибок и начала следующего цикла синхронизации. Если задания подготовки остается в карантине более четырех недель, оно отключается.

## <a name="how-long-will-it-take-to-provision-users"></a>Сколько времени занимает подготовка пользователей?

Производительность зависит от того, выполняет ли задание подготовки первоначальный цикл подготовки или добавочный цикл. Дополнительные сведения о том, как долго выполняется подготовка и как отслеживать состояние службы подготовки, см. [в разделе Проверка состояния подготовки пользователей](application-provisioning-when-will-provisioning-finish-specific-user.md).

## <a name="how-can-i-tell-if-users-are-being-provisioned-properly"></a>Как узнать, правильно ли подготовлены пользователи?

Все операции, выполняемые службой подготовки пользователей, записываются в [журналы подготовки Azure AD (Предварительная версия)](../reports-monitoring/concept-provisioning-logs.md?context=azure/active-directory/manage-apps/context/manage-apps-context). Сюда входят все операции чтения и записи, выполненные в исходной и целевой системах, а также данные пользователя, которые были считаны или записаны во время каждой операции.

Дополнительные сведения о том, как читать журналы подготовки в портал Azure, см. в разделе [руководство по подготовке отчетов](check-status-user-account-provisioning.md).

## <a name="how-do-i-troubleshoot-issues-with-user-provisioning"></a>Как устранить неполадки, связанные с подготовкой пользователей?

Руководство по устранению неполадок при автоматической подготовке пользователей со сценариями доступно в разделе [Проблемы при настройке и подготовке пользователей для приложения](application-provisioning-config-problem.md).

## <a name="what-are-the-best-practices-for-rolling-out-automatic-user-provisioning"></a>Каковы рекомендации по развертыванию автоматической подготовки пользователей?

> [!VIDEO https://www.youtube.com/embed/MAy8s5WSe3A]

Пример поэтапного плана развертывания "исходящей" подготовки пользователей в приложении см. в документе [Outbound User Provisioning Deployment Plan](https://aka.ms/userprovisioningdeploymentplan) (План развертывания "исходящей" подготовки пользователей).

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

### <a name="does-automatic-user-provisioning-to-saas-apps-work-with-b2b-users-in-azure-ad"></a>Поддерживается ли автоматическая подготовка пользователей для приложений SaaS для пользователей B2B в Azure AD?

Да, можно использовать службу подготовки пользователей Azure AD для подготовки пользователей B2B (или гостей) в Azure AD к приложениям SaaS.

Тем не менее, чтобы пользователи B2B могли входить в приложение SaaS с помощью Azure AD, в приложении SaaS должна быть настроена возможность единого входа на основе SAML. Дополнительные сведения о настройке приложений SaaS для поддержки входа пользователей B2B см. в разделе [Настройка приложений SaaS для службы совместной работы B2B]( https://docs.microsoft.com/azure/active-directory/b2b/configure-saas-apps).

### <a name="does-automatic-user-provisioning-to-saas-apps-work-with-dynamic-groups-in-azure-ad"></a>Поддерживается ли автоматическая подготовка пользователей для приложений SaaS для динамических групп в Azure AD?

Да. При настройке параметра "синхронизировать только назначенные пользователи и группы" Служба подготовки пользователей Azure AD может подготовить или отменить подготовку пользователей в приложении SaaS в зависимости от того, являются ли они членами [динамической группы](../users-groups-roles/groups-create-rule.md). Динамические группы также работают с параметром "Синхронизация всех пользователей и групп".

Тем не менее использование динамических групп может повлиять на общую производительность комплексной подготовки пользователей из Azure AD для приложений SaaS. При использовании динамических групп учитывайте следующие предостережения и рекомендации.

- Скорость подготовки и отзыва пользователя из динамической группы в приложении SaaS зависит от того, как быстро динамическая группа может оценить изменения членства. Сведения о том, как проверить состояние обработки динамической группы, см. в разделе [Проверка состояния обработки правила членства](https://docs.microsoft.com/azure/active-directory/users-groups-roles/groups-create-rule).

- При использовании динамических групп правила должны быть тщательно обработаны при подготовке и отзыве пользователей, так как утрата членства приводит к отсчету события отзыва.

### <a name="does-automatic-user-provisioning-to-saas-apps-work-with-nested-groups-in-azure-ad"></a>Поддерживается ли автоматическая подготовка пользователей для приложений SaaS для вложенных групп в Azure AD?

Нет. При настройке "синхронизировать только назначенные пользователи и группы" Служба подготовки пользователей Azure AD не может считывать или подготавливать пользователей, которые находятся во вложенных группах. Он может только считывать и подготавливать пользователей, которые являются непосредственными членами явно назначенной группы.

Это ограничение назначений на основе группы для приложений, которое также влияет на единый вход. Оно описано в разделе [Использование группы для управления доступом к приложениям SaaS](https://docs.microsoft.com/azure/active-directory/users-groups-roles/groups-saasapps ).

В качестве обходного решения следует явно назначить (или иным образом [областью действия](https://docs.microsoft.com/azure/active-directory/manage-apps/define-conditional-rules-for-provisioning-user-accounts)) группы, содержащие пользователей, которые должны быть подготовлены.

### <a name="is-provisioning-between-azure-ad-and-a-target-application-using-an-encrypted-channel"></a>Является ли подготовка между Azure AD и целевым приложением с помощью зашифрованного канала?

Да. Мы используем HTTPS-шифрование SSL для целевого сервера.

## <a name="related-articles"></a>Связанные статьи

- [Список руководств по интеграции приложений SaaS с Azure Active Directory](../saas-apps/tutorial-list.md)
- [Настройка сопоставлений атрибутов для подготовки пользователей](customize-application-attributes.md)
- [Написание выражений для сопоставлений атрибутов](functions-for-customizing-application-data.md)
- [Фильтры области для подготовки пользователей](define-conditional-rules-for-provisioning-user-accounts.md)
- [Использование SCIM для включения автоматической подготовки пользователей и групп из Azure AD в приложения](use-scim-to-provision-users-and-groups.md)
- [Общие сведения об API синхронизации Azure AD](https://developer.microsoft.com/graph/docs/api-reference/beta/resources/synchronization-overview)
