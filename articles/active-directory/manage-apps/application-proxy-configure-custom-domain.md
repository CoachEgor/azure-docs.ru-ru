---
title: Личные домены в прокси приложения Azure AD | Документация Майкрософт
description: Настройка пользовательских доменов и управление ими в AD Application Proxy Azure.
services: active-directory
documentationcenter: ''
author: msmimart
manager: CelesteDG
ms.service: active-directory
ms.subservice: app-mgmt
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 10/24/2019
ms.author: mimart
ms.reviewer: harshja
ms.custom: it-pro
ms.collection: M365-identity-device-management
ms.openlocfilehash: 3f35658a75adb4d4c6c279e45087e741b8117e65
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "79481387"
---
# <a name="configure-custom-domains-with-azure-ad-application-proxy"></a>Настройка пользовательских доменов с помощью Azure AD Application Proxy

При публикации приложения с помощью Azure Active Directory Application Proxy создается внешний URL-адрес для пользователей. Имя этого URL-адреса содержит домен по умолчанию *ваш_клиент-msappproxy.net*. Например, если вы публикуете приложение с именем " *расходы* " в клиенте с именем *contoso*, внешний URL-адрес будет иметь значение *HTTPS\/:/Expenses-contoso.msappproxy.NET*. Если вы хотите использовать собственное доменное имя вместо *msappproxy.NET*, можно настроить личный домен для своего приложения. 

## <a name="benefits-of-custom-domains"></a>Преимущества пользовательских доменов

Рекомендуется настроить личные домены для приложений, когда это возможно. Ниже приведены некоторые причины использования пользовательских доменов.

- Связи между приложениями работают даже за пределами корпоративной сети. Без личного домена, если приложение имеет жестко запрограммированные внутренние ссылки на целевые объекты, находящиеся за пределами прокси приложения, а ссылки не разрешимы извне, они будут нарушены. Если внутренние и внешние URL-адреса одинаковы, эту проблему можно избежать. Если вы не можете использовать личные домены, см. статью [о перенаправлении жестко закодированных ссылок для приложений, опубликованных с помощью AD application proxy Azure](../application-proxy-link-translation.md) , и другие способы решения этой проблемы. 
  
- Пользователям будет проще работать, так как они могут получить доступ к приложению с тем же URL-адресом из сети или за ее пределами. Им не нужно изучать разные внутренние и внешние URL-адреса или отслеживанию их текущего расположения. 

- Вы можете управлять фирменной символикой и создавать нужные URL-адреса. Личный домен может помочь в создании уверенности пользователей, так как пользователи видят и используют привычное имя вместо *msappproxy.NET*.

- Некоторые конфигурации будут работать только с пользовательскими доменами. Например, для приложений, использующих язык разметки зявлений системы безопасности (SAML) (SAML), требуются пользовательские домены, например, если вы используете службы федерации Active Directory (AD FS) (AD FS), но не можете использовать WS-Federation. Дополнительные сведения см. [в разделе Работа с приложениями, поддерживающими утверждения, в прокси приложения](application-proxy-configure-for-claims-aware-applications.md). 

Если вы не можете делать внутренние и внешние URL-адреса, не так важно использовать личные домены, но можно воспользоваться другими преимуществами. 

## <a name="dns-configuration-options"></a>Параметры конфигурации DNS

Существует несколько вариантов настройки конфигурации DNS в зависимости от требований.

### <a name="same-internal-and-external-url-different-internal-and-external-behavior"></a>Одинаковый внутренний и внешний URL-адрес, другое поведение во внутреннем и внешнем 

Если вы не хотите, чтобы внутренние пользователи направляться через прокси приложения, можно настроить *DNS с разделением*. Разделенная инфраструктура DNS направляет внутренние узлы на внутренний сервер доменных имен и внешние узлы на внешний сервер доменных имен для разрешения имен. 

![Разделенная система DNS](./media/application-proxy-configure-custom-domain/split-brain-dns.png)

### <a name="different-internal-and-external-urls"></a>Разные внутренние и внешние URL-адреса 

Если внутренние и внешние URL-адреса различаются, не нужно настраивать поведение раздельного мозгового поведения, так как маршрутизация пользователей определяется по URL-адресу. В этом случае вы изменяете только внешний DNS и направите внешний URL-адрес конечной точке прокси приложения. 

При выборе пользовательского домена для внешнего URL-адреса на панели информации отображается запись CNAME, которую необходимо добавить к внешнему поставщику DNS. Эти сведения всегда можно просмотреть, перейдя на страницу **прокси приложения** .

## <a name="set-up-and-use-custom-domains"></a>Настройка и использование пользовательских доменов

Чтобы настроить локальное приложение для использования личного домена, необходимо проверить Azure Active Directory пользовательский домен, PFX-сертификат для личного домена и настроить локальное приложение. 

### <a name="create-and-verify-a-custom-domain"></a>Создание и проверка пользовательского домена

Чтобы создать и проверить личный домен, выполните следующие действия.

1. В Azure Active Directory выберите **пользовательские доменные имена** в левой области навигации, а затем выберите **Добавить личный домен**. 
1. Введите имя личного домена и нажмите кнопку **Добавить домен**. 
1. На странице домен скопируйте сведения о записи TXT для своего домена. 
1. Перейдите к регистратору домена и создайте новую запись типа TXT для своего домена на основе скопированных данных DNS.
1. После регистрации домена на странице домена в Azure Active Directory выберите **проверить**. После **проверки**состояния домена можно использовать домен во всех конфигурациях Azure AD, включая прокси приложения. 

Более подробные инструкции см. [в статье Добавление имени личного домена с помощью портала Azure Active Directory](../fundamentals/add-custom-domain.md).

### <a name="configure-an-app-to-use-a-custom-domain"></a>Настройка приложения для использования пользовательского домена

Чтобы опубликовать приложение через прокси приложения с пользовательским доменом, выполните следующие действия.

1. Для нового приложения в Azure Active Directory выберите **корпоративные приложения** в левой области навигации. Выберите **Новое приложение**. В разделе **Локальные приложения** выберите **Добавление локального приложения**. 
   
   Для приложения, которое уже находится в **корпоративном приложении**, выберите его из списка, а затем выберите **прокси приложения** в левой области навигации. 

2. На странице Параметры прокси приложения введите **имя** , если вы добавляете собственное локальное приложение.

3.  В поле **внутренний URL-адрес** введите внутренний URL-адрес приложения.
   
4. В поле **внешний URL-адрес** раскрывающийся список и выберите личный домен, который вы хотите использовать.
   
5. Выберите **Добавить**.
   
   ![Выбрать личный домен](./media/application-proxy-configure-custom-domain/application-proxy.png)
   
6. Если у домена уже есть сертификат, в поле **сертификат** отображаются сведения о сертификате. В противном случае выберите поле **сертификат** . 
   
   ![Щелкните, чтобы передать сертификат.](./media/application-proxy-configure-custom-domain/certificate.png)
   
7. На странице **SSL-сертификат** найдите и выберите файл сертификата pfx. Введите пароль для сертификата и выберите **отправить сертификат**. Дополнительные сведения о сертификатах см. в разделе [сертификаты для пользовательских доменов](#certificates-for-custom-domains) .
   
   ![Загрузка сертификата](./media/application-proxy-configure-custom-domain/ssl-certificate.png)
   
   > [!TIP] 
   > Пользовательскому домену требуется только отправка сертификата. После этого переданный сертификат применяется автоматически при использовании пользовательского домена для других приложений.
   
8. Если вы добавили сертификат, на странице **прокси приложения** выберите **сохранить**. 
   
9. На панели информации на странице **прокси приложения** Обратите внимание на запись CNAME, которую необходимо добавить в зону DNS. 
   
   ![Добавление записи CNAME DNS](./media/application-proxy-configure-custom-domain/dns-info.png)
   
10. Следуйте инструкциям в статье [Управление записями и наборами записей DNS с помощью портал Azure](../../dns/dns-operations-recordsets-portal.md) , чтобы добавить запись DNS, которая перенаправляет новый внешний URL-адрес в домен *msappproxy.NET* .
   
11. Чтобы проверить правильность настройки записи DNS, используйте команду [nslookup](https://social.technet.microsoft.com/wiki/contents/articles/29184.nslookup-for-beginners.aspx) , чтобы убедиться, что внешний URL-адрес доступен, а домен *msapproxy.NET* отображается как псевдоним.

Теперь приложение настроено для использования пользовательского домена. Не забудьте назначить пользователей приложению перед его тестированием или освобождением. 

Чтобы изменить домен для приложения, выберите другой домен из раскрывающегося списка во **внешнем URL-адресе** на странице **прокси приложения приложений** . При необходимости отправьте сертификат для обновленного домена и обновите запись DNS. Если вы не видите личный домен в раскрывающемся списке во **внешнем URL-адресе**, он может быть не проверен.

Более подробные инструкции по использованию прокси приложения см. [в разделе Учебник. Добавление локального приложения для удаленного доступа через прокси приложения в Azure Active Directory](application-proxy-add-on-premises-application.md).

## <a name="certificates-for-custom-domains"></a>Сертификаты для пользовательских доменов

Сертификат создает безопасное TLS-подключение для личного домена. 

### <a name="certificate-formats"></a>Форматы сертификатов

Необходимо использовать PFX-сертификат, чтобы обеспечить включение всех необходимых промежуточных сертификатов. Сертификат должен содержать закрытый ключ.

На методы подписи сертификата нет ограничений. Поддерживаются алгоритмы шифрования на основе эллиптических кривых (ECC), альтернативное имя субъекта (SAN) и другие общие типы сертификатов. 

Можно использовать подстановочные сертификаты, если подстановочный знак соответствует внешнему URL-адресу. Для [приложений с подстановочными знаками](application-proxy-wildcard.md)необходимо использовать подстановочные сертификаты. Если вы хотите использовать сертификат для доступа к поддоменам, необходимо добавить подстановочные знаки поддоменов в качестве альтернативных имен субъектов в том же сертификате. Например, сертификат для * \*. Adventure-Works.com* не будет работать для * \*. Apps.Adventure-Works.com* , если вы не добавите * \*. Apps.Adventure-Works.com* в качестве альтернативного имени субъекта. 

Вы можете использовать сертификаты, выданные собственной инфраструктурой открытых ключей (PKI), если цепочка сертификатов установлена на клиентских устройствах. Intune может развертывать эти сертификаты на управляемых устройствах. Для неуправляемых устройств необходимо вручную установить эти сертификаты. 

Не рекомендуется использовать частный корневой ЦС, так как закрытый корневой ЦС также потребуется отправить на клиентские компьютеры, что может привести к многочисленным проблемам.

### <a name="certificate-management"></a>Управление сертификатами

Все управление сертификатами осуществляется через страницы отдельных приложений. Перейдите на страницу **прокси приложения** приложения, чтобы получить доступ к полю **сертификата** .

Один и тот же сертификат можно использовать для нескольких приложений. Если отправленный сертификат работает с другим приложением, он будет применен автоматически. При добавлении или настройке приложения вам не будет предложено передать его снова. 

По истечении срока действия сертификата вы получите предупреждение о том, что вы загрузили другой сертификат. Если сертификат отозван, пользователи могут столкнуться с предупреждением безопасности при доступе к приложению. Чтобы обновить сертификат для приложения, перейдите на страницу **прокси приложения** для приложения, выберите **сертификат**и отправьте новый сертификат. Если старый сертификат не используется другими приложениями, он удаляется автоматически. 

## <a name="next-steps"></a>Дальнейшие действия
* [Включите единый вход](application-proxy-configure-single-sign-on-with-kcd.md) в опубликованные приложения с помощью аутентификации Azure AD.
* [Включите условный доступ](../conditional-access/overview.md) к опубликованным приложениям.

