---
title: Личные домены в прокси приложения Azure AD | Документация Майкрософт
description: Нанастройка и управление пользовательскими доменами в прокси-приложении Azure AD.
services: active-directory
documentationcenter: ''
author: msmimart
manager: CelesteDG
ms.service: active-directory
ms.subservice: app-mgmt
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 10/24/2019
ms.author: mimart
ms.reviewer: harshja
ms.custom: it-pro
ms.collection: M365-identity-device-management
ms.openlocfilehash: 3f35658a75adb4d4c6c279e45087e741b8117e65
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79481387"
---
# <a name="configure-custom-domains-with-azure-ad-application-proxy"></a>Настройка пользовательских доменов с помощью прокси-приложения Azure AD

При публикации приложения через Azure Active Directory Application Proxy создается внешний URL-адрес для пользователей. Имя этого URL-адреса содержит домен по умолчанию *ваш_клиент-msappproxy.net*. Например, если вы публикуете приложение под названием *Расходы* в вашем арендатора имени *Contoso*, внешний URL *https:\// expenses-contoso.msappproxy.net*. Если вы хотите использовать собственное доменное имя вместо *msappproxy.net,* вы можете настроить пользовательский домен для вашего приложения. 

## <a name="benefits-of-custom-domains"></a>Преимущества пользовательских доменов

Это хорошая идея, чтобы настроить пользовательские домены для ваших приложений, когда это возможно. Некоторые причины для использования пользовательских доменов включают в себя:

- Связи между приложениями работают даже за пределами корпоративной сети. Без пользовательского домена, если ваше приложение имеет жестко закодированные внутренние ссылки на цели за пределами прокси-сервера приложения, и ссылки не являются внешне разрешимыми, они будут ломаться. Когда ваши внутренние и внешние URL-адреса одинаковы, вы избегаете этой проблемы. Если вы не можете использовать пользовательские домены, см. [Перенаправить жесткие ссылки для приложений, опубликованных с Azure AD Application Proxy,](../application-proxy-link-translation.md) для других способов решения этой проблемы. 
  
- Ваши пользователи будут иметь более легкий опыт, потому что они могут добраться до приложения с тем же URL внутри или за пределами вашей сети. Им не нужно изучать различные внутренние и внешние URL-адреса или отслеживать их текущее местоположение. 

- Вы можете контролировать свой брендинг и создавать нужные URL-адреса. Пользовательский домен может помочь повысить доверие пользователей, потому что пользователи видят и используют знакомое имя вместо *msappproxy.net.*

- Некоторые конфигурации будут работать только с пользовательскими доменами. Например, нужны пользовательские домены для приложений, использующих язык цензуры безопасности (SAML), например, при использовании служб Ытвения Active Directory Federation (AD FS), но не способных использовать WS-Federation. Для получения дополнительной информации смотрите [в приложении «Работа с приложениями, осведомленными о требованиях» в приложении Proxy](application-proxy-configure-for-claims-aware-applications.md). 

Если вы не в состоянии сделать внутренние и внешние URL-адреса совпадают, это не так важно использовать пользовательские домены, но вы все еще можете воспользоваться другими преимуществами. 

## <a name="dns-configuration-options"></a>Параметры конфигурации DNS

Существует несколько вариантов настройки конфигурации DNS в зависимости от ваших требований:

### <a name="same-internal-and-external-url-different-internal-and-external-behavior"></a>Один и тот же внутренний и внешний URL, различное внутреннее и внешнее поведение 

Если вы не хотите, чтобы ваши внутренние пользователи направлялись через приложение Proxy, вы можете настроить *DNS с разделенным мозгом.* Разделенная инфраструктура DNS направляет внутренние хосты на внутренний сервер доменных имен, а внешние хосты — на внешний сервер доменных имен для разрешения имен. 

![Разделенная система DNS](./media/application-proxy-configure-custom-domain/split-brain-dns.png)

### <a name="different-internal-and-external-urls"></a>Различные внутренние и внешние URL-адреса 

Если внутренние и внешние URL-адреса отличаются друг от друга, вам не нужно настраивать поведение сплит-мозга, потому что пользовательская реуктора определяется URL. В этом случае вы измените только внешние DNS и направите внешний URL в конечную точку приложения Proxy. 

При выборе пользовательского домена для внешнего URL-адреса информационная панель показывает запись CNAME, необходимую для добавления к внешнему поставщику DNS. Вы всегда можете увидеть эту информацию, перейдя на страницу **прокси-сервера приложения.**

## <a name="set-up-and-use-custom-domains"></a>Настройка и использование пользовательских доменов

Для настройки находного приложения для использования пользовательского домена необходимо проверить пользовательский домен Azure Active Directory, сертификат PFX для пользовательского домена и приложение для настройки. 

### <a name="create-and-verify-a-custom-domain"></a>Создание и проверка пользовательского домена

Для создания и проверки пользовательского домена:

1. В Active Directory Azure выберите **пользовательские доменные имена** в левой навигации, а затем выберите **Пользовательский домен.** 
1. Введите пользовательское доменное имя и выберите **Добавить домен.** 
1. На странице домена скопируйте информацию о записи TXT для вашего домена. 
1. Перейдите к регистратору домена и создайте новую запись TXT для вашего домена, основанную на скопированных DNS информации.
1. После регистрации домена на странице домена в Active Directory Azure выберите **Verify.** После **проверки**статуса домена можно использовать домен во всех конфигурациях Azure AD, включая прокси-сервер приложения. 

Для получения более подробных инструкций [см.](../fundamentals/add-custom-domain.md)

### <a name="configure-an-app-to-use-a-custom-domain"></a>Настройка приложения для использования пользовательского домена

Чтобы опубликовать приложение через приложение Proxy с пользовательским доменом:

1. Для нового приложения в Active Directory Azure выберите **приложения Enterprise** в левой навигации. Выберите **Новое приложение**. В разделе **Локальные приложения** выберите **Добавление локального приложения**. 
   
   Для приложения, уже наделено **приложениями Enterprise,** выберите его из списка, а затем выберите **прокси-сервер приложения** в левой навигации. 

2. На странице настроек приложения Proxy введите **имя,** если вы добавляете собственное приложение.

3.  Во внутреннем поле **Url** введите внутренний URL-адрес приложения.
   
4. В поле **Внешнего Url** отбросьте список и выберите пользовательский домен, который вы хотите использовать.
   
5. Нажмите кнопку **Добавить**.
   
   ![Выберите пользовательский домен](./media/application-proxy-configure-custom-domain/application-proxy.png)
   
6. Если в домене уже есть сертификат, поле **Сертификата** отображает информацию о сертификате. В противном случае выберите поле **сертификата.** 
   
   ![Щелкните, чтобы передать сертификат.](./media/application-proxy-configure-custom-domain/certificate.png)
   
7. На странице **сертификата SSL** просмотрите и выберите файл сертификата PFX. Введите пароль для сертификата и выберите **Сертификат загрузки.** Для получения дополнительной информации о сертификатах смотрите раздел [Сертификаты для пользовательских доменов.](#certificates-for-custom-domains)
   
   ![Загрузка сертификата](./media/application-proxy-configure-custom-domain/ssl-certificate.png)
   
   > [!TIP] 
   > Пользовательский домен нуждается только в том, что его сертификат загружен один раз. После этого загруженный сертификат применяется автоматически при использовании пользовательского домена для других приложений.
   
8. Если вы добавили сертификат на странице **прокси приложения,** выберите **Сохранить**. 
   
9. В информационной панели на странице **прокси приложения** обратите внимание на запись CNAME, которая необходимо добавить в зону DNS. 
   
   ![Добавление ввода CNAME DNS](./media/application-proxy-configure-custom-domain/dns-info.png)
   
10. Следуйте инструкциям в [записях и записях Управления DNS, используя портал Azure](../../dns/dns-operations-recordsets-portal.md) для добавления записи DNS, которая перенаправляет новый внешний URL на *msappproxy.net* домена.
   
11. Чтобы проверить, правильно ли настроена запись DNS, используйте команду [nslookup,](https://social.technet.microsoft.com/wiki/contents/articles/29184.nslookup-for-beginners.aspx) чтобы подтвердить, что ваш внешний URL довествуется, а *домен msapproxy.net* отображается в качестве псевдонима.

Теперь приложение настроено на использование пользовательского домена. Не забудьте назначить пользователей в приложение, прежде чем тестировать или отпустить его. 

Чтобы изменить домен для приложения, выберите другой домен из списка выпадающих данных во **внешнем** URL-адресе на странице **прокси-сервера приложения.** Загрузите сертификат для обновленного домена, если это необходимо, и обновите запись DNS. Если вы не видите пользовательский домен, который вы хотите, в списке выпадающих данных во **внешнем URL,** он может не быть проверен.

Для получения более подробных инструкций для приложения Proxy [см.](application-proxy-add-on-premises-application.md)

## <a name="certificates-for-custom-domains"></a>Сертификаты для пользовательских доменов

Сертификат создает безопасное соединение TLS для пользовательского домена. 

### <a name="certificate-formats"></a>Форматы сертификатов

Вы должны использовать сертификат PFX, чтобы убедиться, что все необходимые промежуточные сертификаты включены. Сертификат должен содержать закрытый ключ.

Нет никаких ограничений на методы подписи сертификата. Поддерживается эллиптическая кривая криптография (ECC), Тема альтернативное название (SAN) и другие распространенные типы сертификатов. 

Сертификаты подстановочных знаков можно использовать до тех пор, пока подстановочный знак соответствует внешнему URL. Вы должны использовать сертификаты подстановочных знаков для [приложений подстановочных знаков.](application-proxy-wildcard.md) Если вы хотите использовать сертификат для доступа к поддоменам, необходимо добавить поддомены поддомены в качестве альтернативных имен в том же сертификате. Например, сертификат * \*для .adventure-works.com* не будет работать для * \*.apps.adventure-works.com* если вы не добавите * \*.apps.adventure-works.com* в качестве альтернативного имени субъекта. 

Вы можете использовать сертификаты, выданные собственной инфраструктурой ключей общего пользования (PKI), если цепочка сертификатов установлена на устройствах ваших клиентов. Intune может развернуть эти сертификаты на управляемые устройства. Для неуправляемых устройств необходимо вручную установить эти сертификаты. 

Мы не рекомендуем использовать частный root CA, так как частный root CA также необходимо будет подтолкнуть к клиентским машинам, что может привести к многочисленным проблемам.

### <a name="certificate-management"></a>Управление сертификатами

Все управление сертификатом происходит через отдельные страницы приложения. Перейдите на **прокси-страницу приложения** для доступа к полю **Сертификата.**

Вы можете использовать один и тот же сертификат для нескольких приложений. Если загруженный сертификат работает с другим приложением, он будет применяться автоматически. Вам не будет предложено загрузить его снова, когда вы добавляете или настроить приложение. 

По истечении срока действия сертификата вы получаете предупреждение о загрузке другого сертификата. Если сертификат отозван, пользователи могут увидеть предупреждение о безопасности при доступе к приложению. Чтобы обновить сертификат для приложения, перейдите на страницу **прокси приложения** для приложения, выберите **Сертификат**и загрузите новый сертификат. Если старый сертификат не используется другими приложениями, он удаляется автоматически. 

## <a name="next-steps"></a>Дальнейшие действия
* [Включите единый вход](application-proxy-configure-single-sign-on-with-kcd.md) в опубликованные приложения с помощью аутентификации Azure AD.
* [Включить условный доступ](../conditional-access/overview.md) к опубликованным приложениям.

