---
title: Написание выражений для сопоставления атрибутов в Azure AD
description: Узнайте, как использовать сопоставление выражений для преобразования значений атрибутов в допустимый формат при автоматической подготовке объектов приложения SaaS в Azure Active Directory.
services: active-directory
documentationcenter: ''
author: msmimart
manager: CelesteDG
ms.service: active-directory
ms.subservice: app-mgmt
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 07/31/2019
ms.author: mimart
ms.collection: M365-identity-device-management
ms.openlocfilehash: 4a346b264afc23e21ccf3e6d5dbf7a8f5d96518d
ms.sourcegitcommit: c38a1f55bed721aea4355a6d9289897a4ac769d2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/05/2019
ms.locfileid: "74842260"
---
# <a name="writing-expressions-for-attribute-mappings-in-azure-active-directory"></a>Запись выражений для сопоставления атрибутов в Azure Active Directory
При настройке подготовки для приложения SaaS одним из типов сопоставления атрибутов, которые можно указать, является сопоставление выражений. Для этого необходимо написать выражение, похожее на скрипт. Оно позволит вам преобразовать данные пользователей в форматы, более подходящие для приложений SaaS.

## <a name="syntax-overview"></a>Общие сведения о синтаксисе
Синтаксис выражений для сопоставления атрибутов напоминает функции Visual Basic для приложений (VBA).

* Все выражение должно определяться функциями, состоящими из имени и следующих за ним в скобках аргументов: <br>
  *FunctionName(`<<argument 1>>`,`<<argument N>>`)*
* Функции можно вкладывать одну в другую. Пример. <br> *FunctionOne(FunctionTwo(`<<argument1>>`))*
* В функцию можно передавать следующие три типа аргументов.
  
  1. Атрибуты, которые должны быть заключены в квадратные скобки. Например: [имя_атрибута].
  2. Строковые константы, которые должны быть заключены в двойные кавычки. Например: "США".
  3. Другие функции. Например: Функтиононе (`<<argument1>>`, Функтионтво (`<<argument2>>`))
* Если в строковых константах необходимо использовать обратную косую черту (\) или кавычки (""), такие символы следует экранировать обратной косой чертой (\). Например: "название компании: \\" Contoso\\""

## <a name="list-of-functions"></a>Список функций
[Добавление](#append) &nbsp;&nbsp;&nbsp;&nbsp; [FormatDateTime](#formatdatetime) &nbsp;&nbsp;&nbsp;&nbsp; [Join](#join) &nbsp;&nbsp;&nbsp;&nbsp; [Mid](#mid) &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; [нормализедиакритикс](#normalizediacritics) [не](#not) &nbsp;&nbsp;&nbsp;&nbsp; [заменить](#replace) &nbsp;&nbsp;&nbsp;&nbsp; [селектуникуевалуе](#selectuniquevalue)&nbsp;&nbsp;&nbsp;&nbsp; [синглеаппролеассигнмент](#singleapproleassignment)&nbsp;&nbsp;&nbsp;&nbsp; [Split](#split)&nbsp;&nbsp;&nbsp;&nbsp;[Стрипспацес](#stripspaces) &nbsp;&nbsp;&nbsp;&nbsp; [коммутатор](#switch)&nbsp;&nbsp;&nbsp;&nbsp; [ToLower](#tolower)&nbsp;&nbsp;&nbsp;&nbsp; [ToUpper](#toupper)

---
### <a name="append"></a>Добавить
**Функция:**<br> Append(source, suffix)

**Описание.**<br> Получает исходное строковое значение и присоединяет к его концу суффикс.

**Параметры:**<br> 

| Name | Обязательно/повторяется | Тип | Заметки |
| --- | --- | --- | --- |
| **источник** |Обязательно для заполнения |Строка |Как правило, имя атрибута из исходного объекта. |
| **суффикс** |Обязательно для заполнения |Строка |Строка, которую необходимо присоединить к концу исходного значения. |

---
### <a name="formatdatetime"></a>FormatDateTime
**Функция:**<br> FormatDateTime(source, inputFormat, outputFormat)

**Описание.**<br> Преобразовывает строку даты из одного формата в другой.

**Параметры:**<br> 

| Name | Обязательно/повторяется | Тип | Заметки |
| --- | --- | --- | --- |
| **источник** |Обязательно для заполнения |Строка |Как правило, имя атрибута из исходного объекта. |
| **входной_формат** |Обязательно для заполнения |Строка |Предполагаемый формат исходного значения. Поддерживаемые форматы см. по адресу [https://msdn.microsoft.com/library/8kb3ddd4%28v=vs.110%29.aspx](https://msdn.microsoft.com/library/8kb3ddd4%28v=vs.110%29.aspx). |
| **выходной_формат** |Обязательно для заполнения |Строка |Формат вывода даты. |

---
### <a name="join"></a>Объединение
**Функция:**<br> Join(separator, source1, source2, …)

**Описание.**<br> Функция Join() схожа с функцией Append() за исключением того, что она может объединять несколько строковых значений **source** в одну строку. При этом каждое значение разделяется строкой **separator**.

Если одно из исходных значений является атрибутом с несколькими значениями, все значения в этом атрибуте будут объединены, а между ними будет значение разделителя.

**Параметры:**<br> 

| Name | Обязательно/повторяется | Тип | Заметки |
| --- | --- | --- | --- |
| **разделитель** |Обязательно для заполнения |Строка |Строка, используемая для разделения исходных значений, когда они объединяются в одну строку. Если разделитель не требуется, может не иметь значения (""). |
| **источник1… источникN** |Обязательно, количество повторов может меняться |Строка |Строковые значения для объединения. |

---
### <a name="mid"></a>Mid
**Функция:**<br> Mid(source, start, length)

**Описание.**<br> Возвращает подстроку исходного значения. Подстрокой является строка, содержащая только некоторые символы из исходной строки.

**Параметры:**<br> 

| Name | Обязательно/повторяется | Тип | Заметки |
| --- | --- | --- | --- |
| **источник** |Обязательно для заполнения |Строка |Как правило, имя атрибута. |
| **start** |Обязательно для заполнения |целое число |Индекс положения в строке **source**, откуда должна начинаться подстрока. Первый символ в строке будет иметь индекс 1, второй символ — индекс 2 и т. д. |
| **длина** |Обязательно для заполнения |целое число |Длина подстроки. Если длина превышает размер **исходной** строки, функция возвращает подстроку из **начала** индекса и до конца **исходной** строки. |

---
### <a name="normalizediacritics"></a>NormalizeDiacritics
**Функция:**<br> NormalizeDiacritics(source)

**Описание.**<br> Требуется один строковый аргумент. Возвращает строку, в которой все символы с диакритическими знаками заменены эквивалентами без диакритических знаков. Обычно используется для преобразования имен и фамилий с диакритическими знаками в допустимые значения, которые могут использоваться в различных идентификаторах пользователя, таких как имена участников-пользователей, имена учетных записей SAM и адреса электронной почты.

**Параметры:**<br> 

| Name | Обязательно/повторяется | Тип | Заметки |
| --- | --- | --- | --- |
| **источник** |Обязательно для заполнения |Строка | Обычно атрибут имени или фамилии. |

---
### <a name="not"></a>not
**Функция:**<br> Not(источник)

**Описание.**<br> Обращает логическое значение **source**. Если значение **source** равно *True*, возвращается значение *False*. В противном случае возвращает значение*True*.

**Параметры:**<br> 

| Name | Обязательно/повторяется | Тип | Заметки |
| --- | --- | --- | --- |
| **источник** |Обязательно для заполнения |Логическая строка |Предполагаемые значения **source**: True или False. |

---
### <a name="replace"></a>Замените
**Функция:**<br> Replace(source, oldValue, regexPattern, regexGroupName, replacementValue, replacementAttributeName, template)

**Описание.**<br>
Заменяет значения в пределах строки. Ее работа зависит от указанных параметров.

* Если указаны параметры **oldValue** и **replacementValue**:
  
  * Заменяет все вхождения **OldValue** в **источнике** на **replacementValue**
* Если указаны параметры **oldValue** и **template**:
  
  * заменяет все экземпляры **oldValue** в **template** значением **source**.
* При указании **regexPattern** и **replacementValue** :

  * Функция применяет **regexPattern** к **исходной** строке и позволяет использовать имена групп регулярных выражений для создания строки для **replacementValue**
* Если указаны параметры **regexPattern**, **regexGroupName**, **replacementValue**:
  
  * Функция применяет **regexPattern** к **исходной** строке и заменяет все значения, соответствующие **regexGroupName** , на **replacementValue**
* Если указаны **regexPattern**, **regexGroupName**, **реплацементаттрибутенаме** :
  
  * Если для **source** не указано значение, возвращается **source**.
  * Если **источник** имеет значение, функция применяет **regexPattern** к **исходной** строке и заменяет все значения, соответствующие **RegexGroupName** , значением, связанным с **реплацементаттрибутенаме**

**Параметры:**<br> 

| Name | Обязательно/повторяется | Тип | Заметки |
| --- | --- | --- | --- |
| **источник** |Обязательно для заполнения |Строка |Обычно это имя атрибута из **исходного** объекта. |
| **старое_значение** |Необязательно |Строка |Значение для замены в **source** или **template**. |
| **шаблон_регулярного_выражения** |Необязательно |Строка |Шаблон регулярного выражения для значения, заменяемого в **source**. Или, если используется **replacementPropertyName** , шаблон для извлечения значения из **replacementPropertyName**. |
| **имя_группы_регулярного_выражения** |Необязательно |Строка |Имя группы в **regexPattern**. Если используется **replacementPropertyName** , то значение этой группы будет извлечено как **replacementValue** из **replacementPropertyName**. |
| **значение_замены** |Необязательно |Строка |Новое значение для замены старого. |
| **имя_атрибута_замены** |Необязательно |Строка |Имя атрибута, используемого для заменяющего значения |
| **шаблон** |Необязательно |Строка |Если указано значение **шаблона** , мы будем искать в шаблоне значение **OldValue** и заменять его **исходным** значением. |

---
### <a name="selectuniquevalue"></a>SelectUniqueValue
**Функция:**<br> SelectUniqueValue(uniqueValueRule1, uniqueValueRule2, uniqueValueRule3, …)

**Описание.**<br> Требуется как минимум два аргумента, которые являются правилами формирования уникальных значений, определенными с помощью выражений. Функция вычисляет каждое правило, а затем проверяет сформированное значение на уникальность в целевом приложении/каталоге. Будет возвращено первое найденное уникальное значение. Если все значения уже существуют в целевом объекте, запись будет дополнительно обработана, а причина записана в журналы аудита. Предельной границы числа аргументов, которые можно указать, не существует.

> [!NOTE]
> - Это функция верхнего уровня, которую нельзя вложить.
> - Эта функция не может применяться к атрибутам с соответствующим приоритетом.  
> - Эта функция предназначена только для создания записей. При использовании ее с атрибутом задайте для свойства **Apply Mapping** (Применить сопоставление) значение **Только в ходе создания объектов**.
> - Эта функция в настоящее время поддерживается только для "Workday для Active Directory подготовки пользователей". Его нельзя использовать с другими приложениями подготовки. 


**Параметры:**<br> 

| Name | Обязательно/повторяется | Тип | Заметки |
| --- | --- | --- | --- |
| **uniqueValueRule1... uniqueValueRuleN** |Требуется не менее 2, нет верхней границы |Строка | Список правил формирования уникальных значений для оценки. |


---
### <a name="singleapproleassignment"></a>SingleAppRoleAssignment
**Функция:**<br> SingleAppRoleAssignment([appRoleAssignments])

**Описание.**<br> Возвращает один объект appRoleAssignment из списка всех объектов appRoleAssignment, назначенных пользователю для заданного приложения. Эта функция необходима для преобразования объекта appRoleAssignment в отдельную строку имени роли. Обратите внимание на то, что рекомендуется назначать только один объект appRoleAssignment одному пользователю одновременно. При назначении нескольких ролей невозможно предсказать возвращаемую строку роли. 

**Параметры:**<br> 

| Name | Обязательно/повторяется | Тип | Заметки |
| --- | --- | --- | --- |
| **[appRoleAssignments]** |Обязательно для заполнения |Строка |Объект **[appRoleAssignments]** . |

---
### <a name="split"></a>разделение;
**Функция:**<br> Split(source, delimiter)

**Описание.**<br> Разделяет строку на многозначный массив, используя указанный символ-разделитель.

**Параметры:**<br> 

| Name | Обязательно/повторяется | Тип | Заметки |
| --- | --- | --- | --- |
| **источник** |Обязательно для заполнения |Строка |**источник** , которое необходимо обновить. |
| **разделитель** |Обязательно для заполнения |Строка |Задает символ, который будет использоваться для разделения строки (к примеру, ",") |

---
### <a name="stripspaces"></a>StripSpaces
**Функция:**<br> StripSpaces(source)

**Описание.**<br> Удаляет все пробелы (« ») из исходной строки.

**Параметры:**<br> 

| Name | Обязательно/повторяется | Тип | Заметки |
| --- | --- | --- | --- |
| **источник** |Обязательно для заполнения |Строка |**источник** , которое необходимо обновить. |

---
### <a name="switch"></a>Switch
**Функция:**<br> Switch(source, defaultValue, key1, value1, key2, value2, …)

**Описание.**<br> Если значение **source** соответствует **key**, возвращается **value** для этого параметра **key**. Если значение **source** не соответствует ни одному параметру, то возвращается **defaultValue**.  Параметры **key** и **value** должны всегда быть парными. Для функции необходимо всегда использовать четное количество параметров. Функция не должна использоваться для ссылочных атрибутов, таких как диспетчер. 

**Параметры:**<br> 

| Name | Обязательно/повторяется | Тип | Заметки |
| --- | --- | --- | --- |
| **источник** |Обязательно для заполнения |Строка |**Source** , которое необходимо обновить. |
| **defaultValue** |Необязательно |Строка |Значение по умолчанию, которое необходимо использовать, если источник не соответствует ни одному ключу. Может быть пустой строкой (""). |
| **key** |Обязательно для заполнения |Строка |Параметр **key**, с которым сравнивается значение **source**. |
| **значение** |Обязательно для заполнения |Строка |Значение, которым заменяется значение **source** , соответствующее ключу. |

---
### <a name="tolower"></a>ToLower
**Функция:**<br> ToLower(источник, язык и региональные параметры)

**Описание.**<br> Принимает строковое значение *источника* и преобразует его в нижний регистр, используя указанные правила языка и региональных параметров. Если не указаны сведения о *языке и региональных параметрах*, будут использоваться инвариантные язык и региональные параметры.

**Параметры:**<br> 

| Name | Обязательно/повторяется | Тип | Заметки |
| --- | --- | --- | --- |
| **источник** |Обязательно для заполнения |Строка |Как правило, имя атрибута из исходного объекта. |
| **Язык и региональные параметры** |Необязательно |Строка |Форматом названия языка и региональных параметров в соответствии с RFC 4646 является *languagecode2-country/regioncode2*, где *languagecode2* — это двухбуквенный код языка, а *country/regioncode2* — двухбуквенный код субкультуры. Примеры включают в себя ja-JP для японского языка (Япония) и en-US для английского (США). В случаях, когда двухбуквенный код языка недоступен, используется трехбуквенный код на основе ISO 639-2.|

---
### <a name="toupper"></a>ToUpper
**Функция:**<br> ToUpper(источник, язык и региональные параметры)

**Описание.**<br> Принимает строковое значение *источника* и преобразует его в верхний регистр, используя указанные правила языка и региональных параметров. Если не указаны сведения о *языке и региональных параметрах*, будут использоваться инвариантные язык и региональные параметры.

**Параметры:**<br> 

| Name | Обязательно/повторяется | Тип | Заметки |
| --- | --- | --- | --- |
| **источник** |Обязательно для заполнения |Строка |Как правило, имя атрибута из исходного объекта. |
| **Язык и региональные параметры** |Необязательно |Строка |Форматом названия языка и региональных параметров в соответствии с RFC 4646 является *languagecode2-country/regioncode2*, где *languagecode2* — это двухбуквенный код языка, а *country/regioncode2* — двухбуквенный код субкультуры. Примеры включают в себя ja-JP для японского языка (Япония) и en-US для английского (США). В случаях, когда двухбуквенный код языка недоступен, используется трехбуквенный код на основе ISO 639-2.|

## <a name="examples"></a>Примеры
### <a name="strip-known-domain-name"></a>Извлечение известного доменного имени
Необходимо извлечь известное доменное имя из адреса электронной почты пользователя, чтобы получить имя пользователя. <br>
Например, если домен — contoso.com, можно использовать следующее выражение:

**Выражение:** <br>
`Replace([mail], "@contoso.com", , ,"", ,)`

**Пример ввода и вывода:** <br>

* **Входные данные** (mail): "john.doe@contoso.com"
* **Выходные данные**: john.doe

### <a name="append-constant-suffix-to-user-name"></a>Добавление суффикса константы к имени пользователя
При использовании Salesforce Sandbox может потребоваться добавить дополнительный суффикс ко всем именам пользователей перед их синхронизацией.

**Выражение:** <br>
`Append([userPrincipalName], ".test")`

**Пример ввода и вывода:** <br>

* **Входные данные**: (userPrincipalName): "John.Doe@contoso.com"
* **Выходные данные**: "John.Doe@contoso.com.test"

### <a name="generate-user-alias-by-concatenating-parts-of-first-and-last-name"></a>Создание псевдонима пользователя путем сцепления частей имени и фамилии
Необходимо создать псевдоним пользователя, используя первые три буквы имени и первые пять букв фамилии пользователя.

**Выражение:** <br>
`Append(Mid([givenName], 1, 3), Mid([surname], 1, 5))`

**Пример ввода и вывода:** <br>

* **ВВОД** : (givenName): "John"
* **ВВОД** : (surname): "Doe"
* **Выходные данные**: "JohDoe"

### <a name="remove-diacritics-from-a-string"></a>Удаление диакритических знаков из строки
Вам нужно заменить символы с диакритическими знаками эквивалентами без диакритических знаков.

**Выражение:** <br>
NormalizeDiacritics([givenName])

**Пример ввода и вывода:** <br>

* **ВВОД** (givenName): "Zoë"
* **Выходные данные**: "Zoe".

### <a name="split-a-string-into-a-multi-valued-array"></a>Разделение строки на многозначный массив
Выберите список строк с разделителями-запятыми и разделите их на массив, который можно подключить к такому многозначному атрибуту, как, например, атрибут PermissionSets компании Salesforce. В этом примере список наборов разрешений заполнен в extensionAttribute5 в Azure AD.

**Выражение:** <br>
Split([extensionAttribute5], ",")

**Пример ввода и вывода:** <br>

* **Входные данные** (extensionAttribute5): "Пермиссионсетоне, пермисионсеттво"
* **Выходные данные**:  ["PermissionSetOne", "PermissionSetTwo"]

### <a name="output-date-as-a-string-in-a-certain-format"></a>Вывод даты в виде строки в определенном формате
Необходимо отправить в приложение SaaS даты в определенном формате. <br>
Например, требуется отформатировать даты для ServiceNow.

**Выражение:** <br>

`FormatDateTime([extensionAttribute1], "yyyyMMddHHmmss.fZ", "yyyy-MM-dd")`

**Пример ввода и вывода:**

* **ВВОД** : (extensionAttribute1): "20150123105347.1Z"
* **Выходные данные**: "2015-01-23"

### <a name="replace-a-value-based-on-predefined-set-of-options"></a>Замена значения на основе предопределенного набора параметров

Необходимо определить часовой пояс пользователя на основе кода государства, сохраненного в Azure AD. <br>
Если код государства не совпадает с предопределенными параметрами, используйте значение по умолчанию «Australia/Sydney».

**Выражение:** <br>
`Switch([state], "Australia/Sydney", "NSW", "Australia/Sydney","QLD", "Australia/Brisbane", "SA", "Australia/Adelaide")`

**Пример ввода и вывода:**

* **ВВОД** : (state): "QLD"
* **ВЫВОД**: "Australia/Brisbane"

### <a name="replace-characters-using-a-regular-expression"></a>Замените символы с помощью регулярного выражения
Необходимо определить символы, соответствующие значению регулярного выражения, и удалить их.

**Выражение:** <br>

Replace([mailNickname], , "[a-zA-Z_]*", , "", , )

**Пример ввода и вывода:**

* **Входные данные** (mailNickname: "john_doe72"
* **Выходные данные**: "72"

### <a name="convert-generated-userprincipalname-upn-value-to-lower-case"></a>Преобразование созданного значения userPrincipalName (UPN) в нижний регистр
В приведенном ниже примере значение UPN создается путем объединения полей источника данных PreferredFirstName и PreferredLastName, а функция ToLower использует строку для преобразования всех знаков в нижний регистр. 

`ToLower(Join("@", NormalizeDiacritics(StripSpaces(Join(".",  [PreferredFirstName], [PreferredLastName]))), "contoso.com"))`

**Пример ввода и вывода:**

* **Входные данные** (предпочитаемое имя): "John".
* **Входные данные** (предпочитаемая фамилия): "Smith".
* **Выходные данные**: "john.smith@contoso.com"

### <a name="generate-unique-value-for-userprincipalname-upn-attribute"></a>Создание уникального значения для атрибута userPrincipalName (имя участника-пользователя)
На основе имени, отчества и фамилии пользователя необходимо создать значение для атрибута имени участника-пользователя и проверить его на уникальность в целевом каталоге AD перед присвоением этого значения атрибуту имени участника-пользователя.

**Выражение:** <br>

    SelectUniqueValue( 
        Join("@", NormalizeDiacritics(StripSpaces(Join(".",  [PreferredFirstName], [PreferredLastName]))), "contoso.com"), 
        Join("@", NormalizeDiacritics(StripSpaces(Join(".",  Mid([PreferredFirstName], 1, 1), [PreferredLastName]))), "contoso.com"),
        Join("@", NormalizeDiacritics(StripSpaces(Join(".",  Mid([PreferredFirstName], 1, 2), [PreferredLastName]))), "contoso.com")
    )

**Пример ввода и вывода:**

* **Входные данные** (предпочитаемое имя): "John".
* **Входные данные** (предпочитаемая фамилия): "Smith".
* **Выходные данные**: "John.Smith@contoso.com", если значение имени участника-пользователя John.Smith@contoso.com еще не существует в каталоге.
* **Выходные данные**: "J.Smith@contoso.com", если значение John.Smith@contoso.com уже существует в каталоге.
* **Выходные данные**: "Jo.Smith@contoso.com", если два указанные выше значения имени участника-пользователя уже существуют в каталоге.

## <a name="related-articles"></a>Связанные статьи
* [Автоматическая подготовка пользователей и ее отзыв для приложений SaaS](user-provisioning.md)
* [Настройка сопоставления атрибутов для подготовки пользователей](customize-application-attributes.md)
* [Фильтры области для подготовки пользователей](define-conditional-rules-for-provisioning-user-accounts.md)
* [Автоматическая подготовка пользователей и групп из Azure Active Directory в приложениях с использованием SCIM](use-scim-to-provision-users-and-groups.md)
* [Уведомления о подготовке учетных записей](user-provisioning.md)
* [Список учебников по интеграции приложений SaaS](../saas-apps/tutorial-list.md)
