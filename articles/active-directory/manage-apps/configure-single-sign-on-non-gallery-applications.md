---
title: Единый вход SAML — приложения не из коллекции — платформа Microsoft Identity | Документация Майкрософт
description: Настройка единого входа (SSO) для приложений не из коллекции на платформе Microsoft Identity Platform (Azure AD)
services: active-directory
author: msmimart
manager: CelesteDG
ms.service: active-directory
ms.subservice: app-mgmt
ms.topic: article
ms.workload: identity
ms.date: 07/19/2019
ms.author: celested
ms.reviewer: arvinh,luleon
ms.collection: M365-identity-device-management
ms.openlocfilehash: cf6c89e5f891c5f16551885fb40e8d5082fd6ba5
ms.sourcegitcommit: db2d402883035150f4f89d94ef79219b1604c5ba
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/07/2020
ms.locfileid: "77063515"
---
# <a name="configure-saml-based-single-sign-on-to-non-gallery-applications"></a>Настройка единого входа на основе SAML для приложений не из коллекции

При [добавлении приложения из коллекции](add-gallery-app.md) или веб- [приложения не из коллекции](add-non-gallery-app.md) в корпоративные приложения Azure AD одним из доступных вариантов единого входа является [единый вход на основе SAML](what-is-single-sign-on.md#saml-sso). Выберите SAML, если это возможно для приложений, которые проходят проверку подлинности с помощью одного из протоколов SAML. При использовании единого входа на основе SAML служба Azure AD выполняет аутентификацию в приложении, используя учетную запись Azure AD пользователя. Azure AD передает приложению данные для входа через протокол соединения. Вы можете сопоставлять пользователей с определенными ролями приложений на основе правил, определенных в заявках SAML. В этой статье описывается настройка единого входа на основе SAML для приложения не из коллекции. 

> [!NOTE]
> Добавляете приложение из коллекции? Пошаговые инструкции по установке см. в [списке руководств по приложениям SaaS](../saas-apps/tutorial-list.md).

Чтобы настроить единый вход SAML для приложения не из коллекции без написания кода, необходимо иметь подписку с Azure AD Premium лицензией, и приложение должно поддерживать SAML 2,0. Дополнительные сведения о версиях Azure AD см. в разделе [Цены на Azure AD](https://azure.microsoft.com/pricing/details/active-directory/).

## <a name="before-you-begin"></a>Перед началом

Если приложение не было добавлено в клиент Azure AD, см. статью [Добавление приложения, не](add-non-gallery-app.md)относящегося к коллекции.

## <a name="step-1-edit-the-basic-saml-configuration"></a>Шаг 1. Правка базовой конфигурации SAML

1. Войдите на [портал Azure](https://portal.azure.com) в качестве администратора облачных приложений или администратора приложения для клиента Azure AD.

2. Перейдите в **Azure Active Directory** > **Корпоративные приложения** и выберите приложение из списка. 
   
   - Чтобы выполнить поиск приложения, в меню **Тип приложения** выберите **Все приложения** и щелкните **Применить**. В поле поиска введите имя приложения, а затем выберите нужное приложение на панели результатов.

3. В разделе **Управление** щелкните **Единый вход**. 

4. Выберите **SAML**. Откроется страница **Настройка единого входа с помощью SAML**.

   ![Шаг 1. изменение базовой конфигурации SAML](media/configure-single-sign-on-non-gallery-applications/step-one-basic-saml-config.png)

5. Чтобы изменить основные параметры конфигурации SAML, выберите значок **Изменить** (карандаш) в правом верхнем углу раздела **Базовая конфигурация SAML**.

1. Введите следующие параметры. Вы должны получить значения от поставщика приложения. Вы можете вручную ввести значения или отправить файл метаданных, чтобы извлечь значения полей.

    | Параметр "Базовая конфигурация SAML" | Инициированный поставщиком услуг | Инициированный поставщиком удостоверений | Description |
    |:--|:--|:--|:--|
    | **Идентификатор (идентификатор сущности)** | Требуется для некоторых приложений | Требуется для некоторых приложений | Уникально идентифицирует приложение. Azure AD отправляет идентификатор в приложение в качестве параметра "Аудитория" токена SAML. Приложение должно проверить его. Это значение также отображается как идентификатор сущности во всех метаданных SAML, предоставленных приложением. Введите URL-адрес, который использует следующий шаблон: "https://<subdomain>. contoso.com". *это значение можно найти в качестве элемента **Issuer** в **AuthnRequest** (запрос SAML), отправляемого приложением.* |
    | **URL-адрес ответа** | Обязательно | Обязательно | Этот параметр указывает место, где приложение ожидает токен SAML. URL-адрес ответа также называется URL-адресом службы обработчика утверждений (ACS). Для указания нескольких URL-адресов ответа можно использовать дополнительные поля URL-адреса ответа. Например, для нескольких поддоменов могут потребоваться дополнительные URL-адреса ответа. Или в целях тестирования можно одновременно указать несколько URL-адресов ответа (локальный узел и общедоступные URL-адреса). |
    | **URL-адрес входа** | Обязательно | Не указывайте | Когда пользователь открывает этот URL-адрес, поставщик услуг выполняет перенаправление в Azure AD для аутентификации и входа пользователя в систему. Azure AD использует URL-адрес, чтобы запустить приложение из Office 365 или на панели доступа Azure AD. Если это поле не указано, Azure AD выполняет IdP-инициированный вход, когда пользователь запускает приложение из Office 365, панели доступа Azure AD или URL-адреса единого входа Azure AD.|
    | **Состояние ретрансляции** | Необязательно | Необязательно | Указывает приложению, куда перенаправить пользователя после аутентификации. Обычно здесь указывается допустимый URL-адрес приложения. Но некоторые приложения используют это поле по-другому. Чтобы получить дополнительные сведения, обратитесь к поставщику приложения.
    | **URL-адрес выхода**. | Необязательно | Необязательно | Используется для отправки приложению ответов при завершении сеанса SAML.

Дополнительные сведения см. [в разделе протокол SAML единого входа](../develop/single-sign-on-saml-protocol.md).

## <a name="step-2-configure-user-attributes-and-claims"></a>Шаг 2. Настройка атрибутов пользователя и утверждений 

Когда пользователь проходит проверку подлинности в приложении, Azure AD выдает приложению маркер SAML с информацией (или утверждениями) о пользователе, который однозначно идентифицирует их. По умолчанию эти сведения включают имя пользователя, адрес электронной почты, имя и фамилию. Если, например, приложению требуются конкретные значения утверждения или формат **имени** , отличный от username, может потребоваться настроить эти утверждения. Требования к приложениям из коллекции описаны в [руководствах для конкретных приложений](../saas-apps/tutorial-list.md), либо можно обратиться к поставщику приложения. Ниже приведены общие действия по настройке атрибутов пользователей и утверждений.

1. В разделе **Атрибуты пользователя и утверждения** выберите значок **Изменить** (карандаш) в правом верхнем углу.

   ![Шаг 2. Настройка атрибутов и утверждений пользователей](media/configure-single-sign-on-non-gallery-applications/step-two-user-attributes-claims.png)

2. Проверьте **значение идентификатора имени**. Значение по умолчанию — *user.principalname*. Идентификатор пользователя является уникальным идентификатором для каждого пользователя в приложении. Например, если адрес электронной почты является и именем пользователя, и уникальным идентификатором, задайте значение *user.mail*.

3. Чтобы изменить **значение идентификатора имени**, щелкните значок **Изменить** (карандаш) рядом с полем **Значение идентификатора имени**. Если потребуется, внесите соответствующие изменения в формат идентификатора и источник. Дополнительные сведения см. в разделе [Изменение NameID](../develop/active-directory-saml-claims-customization.md#editing-nameid). Сохраните изменения, когда все будет готово. 
 
4. Чтобы настроить утверждения группы, выберите значок **Изменить** для поля **Groups returned in claim** (Группы, возвращенные в утверждении). Дополнительные сведения см. в статье о [настройке утверждений групп](../hybrid/how-to-connect-fed-group-claims.md).

5. Чтобы добавить утверждение, щелкните **Добавить новое утверждение** в верхней части страницы. Введите **Имя** и выберите соответствующий источник. Если вы выберете источник **Атрибут**, следует выбрать требуемый **Атрибут источника**. Если вы выберете источник **Перевод**, следует выбрать требуемые значения параметров **Преобразование** и **Параметр 1**. Дополнительные сведения см. в разделе [Добавление утверждений для конкретного приложения](../develop/active-directory-saml-claims-customization.md#adding-application-specific-claims). Сохраните изменения, когда все будет готово. 

6. Щелкните **Сохранить**. В таблице появится новое утверждение.

   > [!NOTE]
   > Дополнительные способы настройки токена SAML из Azure AD в приложение см. в следующих ресурсах.
   >- Сведения о создании пользовательских ролей с помощью портала Azure см. в статье о [настройке утверждений роли](../develop/active-directory-enterprise-app-role-management.md).
   >- Сведения о настройке утверждений с помощью PowerShell см. в статье о [настройке утверждений в PowerShell](../develop/active-directory-claims-mapping.md).
   >- Сведения об изменении манифеста приложения для настройки необязательных утверждений для вашего приложения см. в [этой статье](../develop/active-directory-optional-claims.md).
   >- Сведения о настройке политик времени жизни маркера для маркеров обновления, доступа, сеансов и идентификатора см. в статье [Configurable token lifetimes in Azure Active Directory (Preview)](../develop/active-directory-configurable-token-lifetimes.md) (Время существования маркеров с возможностью настройки в Azure Active Directory (предварительная версия)). Сведения об ограничении сеансов проверки подлинности с помощью условного доступа Azure AD см. в [этой статье](https://go.microsoft.com/fwlink/?linkid=2083106).

## <a name="step-3-manage-the-saml-signing-certificate"></a>Шаг 3. Управление сертификатом для подписи SAML

Azure AD использует сертификат для подписи токенов SAML, отправляемых в приложение. Этот сертификат понадобится вам, чтобы настроить доверие между Azure AD и приложением. Дополнительные сведения о формате сертификата см. в документации по SAML приложения. Дополнительные сведения см. в разделе [Управление сертификатами для федеративного единого входа](manage-certificates-for-federated-single-sign-on.md) и [Дополнительные параметры подписи сертификата в токене SAML](certificate-signing-options.md).

Из Azure AD вы можете скачать активный сертификат в формате Base64 или RAW непосредственно из главной страницы **Настройка единого входа с помощью SAML** . Кроме того, активный сертификат можно получить, загрузив XML-файл метаданных приложения или указав URL-адрес метаданных федерации приложения. Чтобы просмотреть, создать или скачать сертификаты (активные или неактивные), выполните следующие действия.

1. Перейдите в раздел **Сертификат подписи SAML**. 

   ![Шаг 3. Управление сертификатом подписи SAML](./media/configure-single-sign-on-non-gallery-applications/step-three-certificate.png)

2. Убедитесь, что у сертификата есть указанные ниже элементы.

   - *Требуемая Дата окончания срока действия.* Вы можете настроить срок действия до трех лет в будущем.
   - *Состояние активности для требуемого сертификата.* Если состояние **неактивно**, измените состояние на **активно**. Чтобы изменить состояние, щелкните правой кнопкой мыши строку нужного сертификата и выберите **сделать сертификат активным**.
   - *Правильный параметр подписывания и алгоритм.*
   - *Правильные адреса электронной почты для уведомлений.* Когда активный сертификат приближается к дате окончания срока действия, Azure AD отправляет уведомление на адрес электронной почты, настроенный в этом поле.

2. Чтобы скачать сертификат, выберите один из параметров в формате Base64, Необработанный формат или XML-файл метаданных федерации. Azure AD также предоставляет **URL-адрес метаданных федерации приложений**, в котором можно получить доступ к метаданным, уникальным для приложения, в формате `https://login.microsoftonline.com/<Directory ID>/federationmetadata/2007-06/federationmetadata.xml?appid=<Application ID>`.

3. Для управления, создания или импорта сертификата щелкните значок **редактирования** (карандаш) в правом верхнем углу раздела **сертификат подписи SAML** .

   ![Сертификат подписи SAML](./media/configure-single-sign-on-non-gallery-applications/saml-signing-certificate.png)


   Выполните любое из следующих действий.

   - Чтобы создать сертификат, выберите **Новый сертификат**, **Дата окончания срока действия**, а затем нажмите кнопку **Сохранить**. Чтобы активировать сертификат, выберите контекстное меню ( **...** ) и пункт **Активировать сертификат**.
   - Чтобы отправить сертификат с закрытым ключом и учетными данными PFX, выберите **Импорт сертификата** и перейдите к сертификату. Введите **пароль PFX**, а затем щелкните **Добавить**.  
   - Чтобы настроить дополнительные параметры подписи сертификатов, используйте следующие параметры. Описание этих параметров см. в статье [Advanced certificate signing options in the SAML token for gallery apps in Azure Active Directory](certificate-signing-options.md) (Расширенные параметры подписи сертификата в маркере SAML для приложений коллекции в Azure Active Directory).
      - В раскрывающемся списке **Вариант подписывания** выберите **Ответ знака SAML**, **Утверждение знака SAML** или **Ответ знака SAML и утверждение**.
      - В раскрывающемся списке **Алгоритм подписывания** выберите **SHA-1** или **SHA-256**.
   - Чтобы уведомить дополнительных пользователей о том, что срок действия активного сертификата скоро истечет, введите адреса электронной почты в полях **Адреса электронной почты для уведомлений**.

4. Если вы внесли изменения, выберите **сохранить** в верхней части раздела **сертификат подписи SAML** . 

## <a name="step-4-set-up-the-application-to-use-azure-ad"></a>Шаг 4. Настройка использования Azure AD в приложении

В разделе **Настройка \<applicationName>** приведены значения, которые необходимо настроить в приложении, чтобы Azure AD использовался в качестве поставщика удостоверений SAML. Необходимые значения зависят от приложения. Дополнительные сведения см. в документации к SAML приложения. Чтобы найти документацию, перейдите к заголовку **настройка \<имя приложения >** и выберите **Просмотреть**пошаговые инструкции. Документация отображается на странице **Настройка единого входа** . На этой странице вы заполните **URL-адрес входа**, **идентификатор Azure AD**и значения **URL-адреса выхода** в разделе **Настройка \<имя приложения >** .

1. Прокрутите вниз до раздела **Настройка \<applicationName>** . 
   
   ![Шаг 4. Настройка приложения](media/configure-single-sign-on-non-gallery-applications/step-four-app-config.png)

1. При необходимости скопируйте значение из каждой строки в этом разделе и следуйте инструкциям конкретного приложения по добавлению значения в приложение. Для приложений из коллекции можно просмотреть документацию, выбрав **Просмотреть пошаговые инструкции**. 
   - Значения **URL-адрес входа** и **URL-адрес выхода** указывают на одну конечную точку, то есть на конечную точку обработки запроса SAML для вашего экземпляра Azure AD. 
   - **Идентификатор Azure AD** — это значение **издателя** в токене SAML, выданном приложению.
2. Завершив перенос значений в нужные поля, щелкните **Сохранить**.

## <a name="step-5-validate-single-sign-on"></a>Шаг 5. Проверка единого входа

После настройки приложения для использования Azure AD в качестве поставщика удостоверений на основе SAML можно проверить параметры, чтобы узнать, работает ли единый вход для вашей учетной записи. 

2. Прокрутите страницу до раздела **Validate single sign-on with <applicationName>** (Проверка единого входа с помощью).

   ![Шаг 5. Проверка единого входа](media/configure-single-sign-on-non-gallery-applications/step-five-validate.png)

3. Выберите **Проверить**. Отобразятся параметры тестирования.

4. Выберите **Войдите от имени текущего пользователя**. 

Если вход выполнен успешно, можно приступить к назначению пользователей и групп для приложения SAML.
Если появится сообщение об ошибке, сделайте следующее:

1. Скопируйте и вставьте сведения об ошибке в поле **Как выглядит ошибка**.

    ![Получение рекомендаций по устранению](media/configure-single-sign-on-non-gallery-applications/error-guidance.png)

2. Щелкните **Получить рекомендации по устранению**. Отобразятся сведения о причине ошибки и рекомендации по ее устранению.  В этом примере пользователь не был назначен приложению.

3. Прочтите рекомендации по разрешению и устраните проблему, если возможно.

4. Выполните проверку еще раз, чтобы она завершилась успешно.

Дополнительные сведения см. в разделе [Отладка единого входа на основе SAML в приложения в Azure Active Directory](../develop/howto-v1-debug-saml-sso-issues.md).

## <a name="next-steps"></a>Дальнейшие действия

- [Assign users and groups to an application in Azure Active Directory](methods-for-assigning-users-and-groups.md) (Назначение пользователей и групп для приложения в Azure Active Directory)
- [Managing user account provisioning for enterprise apps in the Azure portal](../app-provisioning/configure-automatic-user-provisioning-portal.md) (Управление подготовкой учетных записей пользователей для корпоративных приложений на портале Azure)
