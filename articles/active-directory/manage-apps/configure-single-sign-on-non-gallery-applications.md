---
title: SAML одиночный вписать - не галерейные приложения - платформа идентификации Microsoft Документы Майкрософт
description: Настройка одного ввоза (SSO) в негалерейные приложения в платформе идентификации Майкрософт (Azure AD)
services: active-directory
author: msmimart
manager: CelesteDG
ms.service: active-directory
ms.subservice: app-mgmt
ms.topic: article
ms.workload: identity
ms.date: 07/19/2019
ms.author: celested
ms.reviewer: arvinh,luleon
ms.collection: M365-identity-device-management
ms.openlocfilehash: ad27ad5e34d9f44fe7d7be80e05e33dd6fb5e7b1
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79244216"
---
# <a name="configure-saml-based-single-sign-on-to-non-gallery-applications"></a>Налажить SAML одиночный знак на негалерей приложений

При [добавлении приложения галереи](add-gallery-app.md) или [веб-приложения, не являющегося галереей,](add-non-gallery-app.md) в приложения Azure AD Enterprise Applications, одним из доступных для вас вариантов регистрации является [SAML-одиночный знак.](what-is-single-sign-on.md#saml-sso) Выберите SAML, когда это возможно, для приложений, которые удостоверяют подлинность с помощью одного из протоколов SAML. При использовании единого входа на основе SAML служба Azure AD выполняет аутентификацию в приложении, используя учетную запись Azure AD пользователя. Azure AD передает приложению данные для входа через протокол соединения. Можно сопоставить пользователей с определенными ролями приложений на основе правил, которые вы определяете в своих претензиях SAML. В этой статье описывается настройка единого входа на основе SAML для приложения не из коллекции. 

> [!NOTE]
> Добавляете приложение из коллекции? Пошаговые инструкции по установке см. в [списке руководств по приложениям SaaS](../saas-apps/tutorial-list.md).

Чтобы настроить одиночный вставку SAML для негалерейного приложения без написания кода, необходимо иметь подписку вместе с лицензией Azure AD Premium, а приложение должно поддерживать SAML 2.0. Дополнительные сведения о версиях Azure AD см. в разделе [Цены на Azure AD](https://azure.microsoft.com/pricing/details/active-directory/).

## <a name="before-you-begin"></a>Перед началом

Если приложение не было добавлено в ваш aure AD-назойло, [см.](add-non-gallery-app.md)

## <a name="step-1-edit-the-basic-saml-configuration"></a>Шаг 1. Правка базовой конфигурации SAML

1. Войдите на [портал Azure](https://portal.azure.com) в качестве администратора облачных приложений или администратора приложения для клиента Azure AD.

2. Перейдите к**приложениям** **Azure Active Directory** > Enterprise и выберите приложение из списка. 
   
   - Чтобы выполнить поиск приложения, в меню **Тип приложения** выберите **Все приложения** и щелкните **Применить**. В поле поиска введите имя приложения, а затем выберите нужное приложение на панели результатов.

3. В разделе **Управление** щелкните **Единый вход**. 

4. Выберите **SAML**. Откроется страница **Настройка единого входа с помощью SAML**.

   ![Шаг 1 Отслажывай основную конфигурацию SAML](media/configure-single-sign-on-non-gallery-applications/step-one-basic-saml-config.png)

5. Чтобы изменить основные параметры конфигурации SAML, выберите значок **Изменить** (карандаш) в правом верхнем углу раздела **Базовая конфигурация SAML**.

1. Введите следующие параметры. Вы должны получить значения от поставщика приложений. Вы можете вручную ввести значения или отправить файл метаданных, чтобы извлечь значения полей.

    | Параметр "Базовая конфигурация SAML" | Инициированный поставщиком услуг | Инициированный поставщиком удостоверений | Описание |
    |:--|:--|:--|:--|
    | **Идентификатор (идентификатор сущности)** | Требуется для некоторых приложений | Требуется для некоторых приложений | Уникально идентифицирует приложение. Azure AD отправляет идентификатор в приложение в качестве параметра "Аудитория" токена SAML. Приложение должно проверить его. Это значение также отображается как идентификатор сущности во всех метаданных SAML, предоставленных приложением. Введите URL-адрес, который<subdomain>использует следующий шаблон: "https:// .contoso.com' *Вы можете найти это значение в качестве элемента **эмитента** в **запросе AuthnRequest** (SAML-запрос), отправленном приложением.* |
    | **URL-адрес ответа** | Обязательно | Обязательно | Этот параметр указывает место, где приложение ожидает токен SAML. URL-адрес ответа также называется URL-адресом службы обработчика утверждений (ACS). Дополнительные поля URL-адреса ответов можно использовать для указания нескольких URL-адресов ответа. Например, может потребоваться дополнительный ответ URL-адресов для нескольких поддоменов. Или для целей тестирования можно указать несколько URL-адресов ответов (местные URL-адреса и общедоступные URL-адреса) одновременно. |
    | **Восподписанный URL-адрес** | Обязательно | Не указывайте | Когда пользователь открывает этот URL-адрес, поставщик услуг выполняет перенаправление в Azure AD для аутентификации и входа пользователя в систему. Azure AD использует URL-адрес, чтобы запустить приложение из Office 365 или на панели доступа Azure AD. При пустом месте Azure AD выполняет инициированную IdP регистрацию, когда пользователь запускает приложение из Office 365, панели доступа Azure AD или URL-адреса Azure AD SSO.|
    | **Состояние ретранслятора** | Необязательный | Необязательный | Указывает приложению, куда перенаправить пользователя после аутентификации. Обычно здесь указывается допустимый URL-адрес приложения. Но некоторые приложения используют это поле по-другому. Чтобы получить дополнительные сведения, обратитесь к поставщику приложения.
    | **URL-адрес выхода.** | Необязательный | Необязательный | Используется для отправки приложению ответов при завершении сеанса SAML.

Для получения дополнительной информации [см.](../develop/single-sign-on-saml-protocol.md)

## <a name="step-2-configure-user-attributes-and-claims"></a>Шаг 2. Настройка атрибутов пользователя и утверждений 

Когда пользователь проверяет подлинность приложения, Azure AD выдает приложению токен SAML с информацией (или претензиями) о пользователе, который однозначно идентифицирует его. По умолчанию эта информация включает имя пользователя, адрес электронной почты, имя и фамилию. Возможно, потребуется настроить эти утверждения, если, например, приложению требуются определенные значения претензий или формат **имени,** кроме имени пользователя. Требования к приложениям из коллекции описаны в [руководствах для конкретных приложений](../saas-apps/tutorial-list.md), либо можно обратиться к поставщику приложения. Ниже приведены общие действия по настройке атрибутов пользователей и утверждений.

1. В разделе **Атрибуты пользователя и утверждения** выберите значок **Изменить** (карандаш) в правом верхнем углу.

   ![Шаг 2 Настройка атрибутов и требований пользователя](media/configure-single-sign-on-non-gallery-applications/step-two-user-attributes-claims.png)

2. Проверьте **значение идентификатора имени**. Значение по умолчанию — *user.principalname*. Идентификатор пользователя является уникальным идентификатором для каждого пользователя в приложении. Например, если адрес электронной почты является и именем пользователя, и уникальным идентификатором, задайте значение *user.mail*.

3. Чтобы изменить **значение идентификатора имени**, щелкните значок **Изменить** (карандаш) рядом с полем **Значение идентификатора имени**. Если потребуется, внесите соответствующие изменения в формат идентификатора и источник. Дополнительные сведения см. в разделе [Изменение NameID](../develop/active-directory-saml-claims-customization.md#editing-nameid). Сохраните изменения, когда все будет готово. 
 
4. Чтобы настроить утверждения группы, выберите значок **Изменить** для поля **Groups returned in claim** (Группы, возвращенные в утверждении). Дополнительные сведения см. в статье о [настройке утверждений групп](../hybrid/how-to-connect-fed-group-claims.md).

5. Чтобы добавить утверждение, щелкните **Добавить новое утверждение** в верхней части страницы. Введите **Имя** и выберите соответствующий источник. Если вы выберете источник **Атрибут**, следует выбрать требуемый **Атрибут источника**. Если вы выберете источник **Перевод**, следует выбрать требуемые значения параметров **Преобразование** и **Параметр 1**. Дополнительные сведения см. в разделе [Добавление утверждений для конкретного приложения](../develop/active-directory-saml-claims-customization.md#adding-application-specific-claims). Сохраните изменения, когда все будет готово. 

6. Нажмите кнопку **Сохранить**. В таблице появится новое утверждение.

   > [!NOTE]
   > Дополнительные способы настройки токена SAML из Azure AD в приложение см. в следующих ресурсах.
   >- Сведения о создании пользовательских ролей с помощью портала Azure см. в статье о [настройке утверждений роли](../develop/active-directory-enterprise-app-role-management.md).
   >- Сведения о настройке утверждений с помощью PowerShell см. в статье о [настройке утверждений в PowerShell](../develop/active-directory-claims-mapping.md).
   >- Сведения об изменении манифеста приложения для настройки необязательных утверждений для вашего приложения см. в [этой статье](../develop/active-directory-optional-claims.md).
   >- Сведения о настройке политик времени жизни маркера для маркеров обновления, доступа, сеансов и идентификатора см. в статье [Configurable token lifetimes in Azure Active Directory (Preview)](../develop/active-directory-configurable-token-lifetimes.md) (Время существования маркеров с возможностью настройки в Azure Active Directory (предварительная версия)). Сведения об ограничении сеансов проверки подлинности с помощью условного доступа Azure AD см. в [этой статье](https://go.microsoft.com/fwlink/?linkid=2083106).

## <a name="step-3-manage-the-saml-signing-certificate"></a>Шаг 3. Управление сертификатом для подписи SAML

Azure AD использует сертификат для подписи токенов SAML, отправляемых в приложение. Этот сертификат понадобится вам, чтобы настроить доверие между Azure AD и приложением. Дополнительные сведения о формате сертификата см. в документации по SAML приложения. Для получения дополнительной информации [в](manage-certificates-for-federated-single-sign-on.md) [токене SAML](certificate-signing-options.md)см.

С Azure AD вы можете скачать активный сертификат в формате Base64 или Raw непосредственно с основной страницы **Set up Single Sign-On с SAML.** Кроме того, вы можете получить активный сертификат, загрузив файл метаданных XML приложения или используя URL-адрес метаданных Федерации приложений. Чтобы просмотреть, создать или загрузить сертификаты (активные или неактивные), выполните следующие действия.

1. Перейдите в раздел **Сертификат подписи SAML**. 

   ![Шаг 3 Управление сертификатом подписи SAML](./media/configure-single-sign-on-non-gallery-applications/step-three-certificate.png)

2. Убедитесь, что у сертификата есть указанные ниже элементы.

   - *Нужный срок действия.* Вы можете настроить срок годности на срок до трех лет в будущем.
   - *Статус активен для желаемого сертификата.* Если статус **неактивен,** измените статус на **Active.** Чтобы изменить статус, нажмите правой кнопкой строки желаемого сертификата и выберите **Сделать сертификат активным.**
   - *Правильный вариант подписания и алгоритм.*
   - *Правильный адрес электронной почты уведомления (es).* Когда активный сертификат приближается к дате истечения срока действия, Azure AD отправляет уведомление на адрес электронной почты, настроенный в этой области.

2. Чтобы загрузить сертификат, выберите один из вариантов формата Base64, формата Raw или Federation Metadata XML. Azure AD также предоставляет **URL-адрес метаданных федерации приложений**, в котором можно получить доступ к метаданным, уникальным для приложения, в формате `https://login.microsoftonline.com/<Directory ID>/federationmetadata/2007-06/federationmetadata.xml?appid=<Application ID>`.

3. Чтобы управлять, создавать или импортировать сертификат, выберите значок **«Edit»** (карандаш) в правом верхнем углу раздела **сертификата подписи SAML.**

   ![Свидетельство о подписании SAML](./media/configure-single-sign-on-non-gallery-applications/saml-signing-certificate.png)


   Примите любое из следующих действий:

   - Чтобы создать сертификат, выберите **Новый сертификат**, **Дата окончания срока действия**, а затем нажмите кнопку **Сохранить**. Чтобы активировать сертификат, выберите контекстное меню (**...**) и пункт **Активировать сертификат**.
   - Чтобы отправить сертификат с закрытым ключом и учетными данными PFX, выберите **Импорт сертификата** и перейдите к сертификату. Введите **пароль PFX**, а затем щелкните **Добавить**.  
   - Чтобы настроить дополнительные параметры подписи сертификатов, используйте следующие параметры. Описание этих параметров см. в статье [Advanced certificate signing options in the SAML token for gallery apps in Azure Active Directory](certificate-signing-options.md) (Расширенные параметры подписи сертификата в маркере SAML для приложений коллекции в Azure Active Directory).
      - В раскрывающемся списке **Вариант подписывания** выберите **Ответ знака SAML**, **Утверждение знака SAML** или **Ответ знака SAML и утверждение**.
      - В раскрывающемся списке **Алгоритм подписывания** выберите **SHA-1** или **SHA-256**.
   - Чтобы уведомить дополнительных пользователей о том, что срок действия активного сертификата скоро истечет, введите адреса электронной почты в полях **Адреса электронной почты для уведомлений**.

4. Если вы внесли изменения, выберите **Сохранить** в верхней части раздела **сертификата подписи SAML.** 

## <a name="step-4-set-up-the-application-to-use-azure-ad"></a>Шаг 4. Настройка использования Azure AD в приложении

В разделе **Настройка \<applicationName>** приведены значения, которые необходимо настроить в приложении, чтобы Azure AD использовался в качестве поставщика удостоверений SAML. Необходимые значения зависят от приложения. Дополнительные сведения см. в документации к SAML приложения. Чтобы найти документацию, перейдите к **названию приложения Set up \<>** заголовка и выберите **пошаговые инструкции View.** Документация отображается на странице **настройки.** Эта страница поможет вам заполнить **URL-адрес входа,** **идентификатор AD Azure aD**и **URL-адреса Logout** в **названии приложения Set up \<>** заголовка.

1. Прокрутите вниз до раздела **Настройка \<applicationName>**. 
   
   ![Шаг 4 Настройка приложения](media/configure-single-sign-on-non-gallery-applications/step-four-app-config.png)

1. При необходимости скопируйте значение из каждой строки в этом разделе и следуйте инструкциям конкретного приложения по добавлению значения в приложение. Для приложений из коллекции можно просмотреть документацию, выбрав **Просмотреть пошаговые инструкции**. 
   - Значения **URL-адрес входа** и **URL-адрес выхода** указывают на одну конечную точку, то есть на конечную точку обработки запроса SAML для вашего экземпляра Azure AD. 
   - **Идентификатор Azure AD** — это значение **издателя** в токене SAML, выданном приложению.
2. Завершив перенос значений в нужные поля, щелкните **Сохранить**.

## <a name="step-5-validate-single-sign-on"></a>Шаг 5. Проверка единого входа

После настройки приложения для использования Azure AD в качестве поставщика идентификационных данных на основе SAML можно протестировать настройки, чтобы узнать, работает ли для вашей учетной записи один заход. 

2. Прокрутите страницу до раздела **Validate single sign-on with <applicationName>** (Проверка единого входа с помощью).

   ![Шаг 5 Проверка одного знака](media/configure-single-sign-on-non-gallery-applications/step-five-validate.png)

3. Выберите **Проверить**. Отобразятся параметры тестирования.

4. Выберите **Войдите от имени текущего пользователя**. 

Если вход выполнен успешно, можно приступить к назначению пользователей и групп для приложения SAML.
Если появится сообщение об ошибке, сделайте следующее:

1. Скопируйте и вставьте сведения об ошибке в поле **Как выглядит ошибка**.

    ![Получение рекомендаций по устранению](media/configure-single-sign-on-non-gallery-applications/error-guidance.png)

2. Щелкните **Получить рекомендации по устранению**. Отобразятся сведения о причине ошибки и рекомендации по ее устранению.  В этом примере пользователь не был назначен приложению.

3. Прочтите рекомендации по разрешению и устраните проблему, если возможно.

4. Выполните проверку еще раз, чтобы она завершилась успешно.

Для получения дополнительной информации смотрите [в каталоге Azure Active Directory](../azuread-dev/howto-v1-debug-saml-sso-issues.md)см.

## <a name="next-steps"></a>Дальнейшие действия

- [Assign users and groups to an application in Azure Active Directory](methods-for-assigning-users-and-groups.md) (Назначение пользователей и групп для приложения в Azure Active Directory)
- [Managing user account provisioning for enterprise apps in the Azure portal](../app-provisioning/configure-automatic-user-provisioning-portal.md) (Управление подготовкой учетных записей пользователей для корпоративных приложений на портале Azure)
