---
title: SAML одиночный входной для местных приложений с Azure AD App Proxy
description: Узнайте, как предоставить единый вданный для местных приложений, которые защищены с помощью проверки подлинности SAML. Обеспечить удаленный доступ к приложениям с помощью приложения Proxy.
services: active-directory
documentationcenter: ''
author: msmimart
manager: CelesteDG
ms.service: active-directory
ms.subservice: app-mgmt
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 10/24/2019
ms.author: mimart
ms.reviewer: japere
ms.custom: it-pro
ms.collection: M365-identity-device-management
ms.openlocfilehash: ccf34b52e06e369fe4dd459ff9dfa2880596fb35
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79481353"
---
# <a name="saml-single-sign-on-for-on-premises-applications-with-application-proxy"></a>SAML одиночный вданный для местных приложений с прокси-сервером приложения

Вы можете предоставить единый вход (SSO) в местные приложения, которые защищены проверкой подлинности SAML и обеспечить удаленный доступ к этим приложениям через Application Proxy. С помощью одного входного ввоза SAML Активный каталог Azure (Azure AD) проверяет подлинность приложения с помощью учетной записи Azure AD пользователя. Azure AD передает приложению данные для входа через протокол соединения. Вы также можете сопоставить пользователей с определенными ролями приложений на основе правил, которые вы определяете в своих претензиях SAML. Включив приложение Proxy в дополнение к SAML SSO, ваши пользователи будут иметь внешний доступ к приложению и бесшовный опыт SSO.

Приложения должны быть в состоянии потреблять токены SAML, выпущенные **Active Directory Azure.** Эта конфигурация не применяется к приложениям, использующим поставщика идентификационных данных. В этих сценариях мы рекомендуем просмотреть [Ресурсы для переноса приложений в Azure AD.](migration-resources.md)

SAML SSO с Application Proxy также работает с функцией шифрования токенов SAML. Для получения дополнительной информации [см.](howto-saml-token-encryption.md)

Диаграммы протокола ниже описывают единую последовательность подписей как для потока, инициированного поставщиком услуг (SP-инициированный), так и для потока, инициированного поставщиком идентификации (инициированным ИДП). Приложение Прокси работает с SAML SSO путем кэширования запроса SAML и ответа на и из предварительного приложения.

  ![SAML SP Поток](./media/application-proxy-configure-single-sign-on-on-premises-apps/saml-sp-initiated-flow.png)

  ![SAML SP Поток](./media/application-proxy-configure-single-sign-on-on-premises-apps/saml-idp-initiated-flow.png)

## <a name="create-an-application-and-set-up-saml-sso"></a>Создать приложение и настроить SAML SSO

1. На портале Azure выберите **Azure Active Directory > приложениями Enterprise** и выберите **новое приложение.**

2. Введите имя дисплея для нового приложения, выберите **Интегрируйте любое другое приложение,** которое вы не найдете в галерее, а затем выберите **Создать.**

3. На странице **обзора** приложения выберите **Единый подсобный знак**.

4. Выберите **SAML** в качестве единого метода регистрации.

5. Сначала настроил SAML SSO для работы в корпоративной сети. На **странице Set up Single Sign-On со** страницей SAML перейдите на заголовок **Basic SAML Configuration** и выберите значок **edit** (карандаш). Выполните шаги в [базовой конфигурации SAML Enter,](configure-single-sign-on-non-gallery-applications.md#step-1-edit-the-basic-saml-configuration) чтобы настроить проверку подлинности на основе SAML для приложения.

6. Добавьте в приложение хотя бы одного пользователя и убедитесь, что тестовая учетная запись имеет доступ к приложению. При подключении к корпоративной сети используйте тестовую учетную запись, чтобы узнать, есть ли у вас один подписи в приложении. 

   > [!NOTE]
   > После настройки приложения Proxy вы вернетесь и обновите **URL-адрес**SAML Reply.

## <a name="publish-the-on-premises-application-with-application-proxy"></a>Публикация приложения с помощью приложения Proxy

Прежде чем предоставить SSO для корпоративных приложений, необходимо включить прокси-сервер приложения и установить разъем. Ознакомьтесь с [учебником Добавить приложение для удаленного доступа через Приложение Прокси в Azure AD,](application-proxy-add-on-premises-application.md) чтобы узнать, как подготовить вашу среду, установить и зарегистрировать разъем, и протестировать разъем. Затем выполните следующие действия, чтобы опубликовать новое приложение с помощью приложения Proxy. Для других параметров, не упомянутых ниже, обратитесь к [приложению «Добавить в разделе Azure AD» в разделе Azure AD](application-proxy-add-on-premises-application.md#add-an-on-premises-app-to-azure-ad) в учебнике.

1. Поскольку приложение по-прежнему открыто на портале Azure, выберите **прокси-сервер приложения.** Предоставьте **внутренний URL-адрес** приложения. Если вы используете пользовательский домен, вам также необходимо загрузить сертификат TLS/SSL для вашего приложения. 
   > [!NOTE]
   > В качестве наилучшей практики, используйте пользовательские домены, когда это возможно для оптимизированного пользовательского опыта. Подробнее о [работе с пользовательскими доменами в прокси-сервере Azure AD Application.](application-proxy-configure-custom-domain.md)

2. Выберите **Active Directory Azure** в качестве **метода предварительной аутентификации** для приложения.

3. Копирование **внешнего URL-адреса** для приложения. Этот URL-адрес для завершения конфигурации SAML понадобится вам.

4. Используя тестовую учетную запись, попробуйте открыть приложение с **внешним URL,** чтобы проверить, что прокси-сервер приложения настроен правильно. При наличии проблем ссм. [Проблемы приложения Proxy и сообщения об ошибках.](application-proxy-troubleshoot.md)

## <a name="update-the-saml-configuration"></a>Обновление конфигурации SAML

1. Поскольку приложение по-прежнему открыто на портале Azure, выберите **Единый подчет**. 

2. На **странице Set up Single Sign-On со** страницей SAML перейдите на заголовок **Basic SAML Configuration** и выберите значок **edit** (карандаш). Убедитесь, что **внешний URL,** настроенный в прокси-сервере приложения, заполняется в полях **идентификации,** **url-адреса ответов**и **URL-адресов logout.** Эти URL-адреса необходимы для правильной работы прокси-сервера приложения. 

3. Отспособьте **URL-адрес ответа,** настроенный ранее, чтобы его домен был догнан прокси-сервером приложения. Например, если ваш `https://contosotravel-f128.msappproxy.net` **внешний URL** и `https://contosotravel.com/acs`исходный **URL-адрес ответа** был, `https://contosotravel-f128.msappproxy.net/acs`вам нужно обновить исходный **URL-адрес ответа.** 

    ![Введите базовые данные конфигурации SAML](./media/application-proxy-configure-single-sign-on-on-premises-apps/basic-saml-configuration.png)


4. Выберите флажок рядом с обновленным **URL-адресом ответа,** чтобы отметить его по умолчанию.

   * Если необходимый **URL-адрес ответа** уже указан, отметьте этот **URL-адрес ответа** по умолчанию и удалите ранее настроенный **URL-адрес ответа.**

   * Для потока, инициированного SP, убедитесь, что приложение бэк-энда определяет правильный **URL-адрес ответа** или URL-адрес Службы защиты прав потребителей для получения токена проверки подлинности.

    > [!NOTE]
    > Если приложение бэк-энда ожидает, что **URL-адрес ответа** будет внутренним URL, вам нужно либо использовать [пользовательские домены,](application-proxy-configure-custom-domain.md) чтобы иметь соответствующие внутренние и внешние URLS, либо установить безопасное расширение для входного доступа My Apps на устройства пользователей. Это расширение автоматически перенаправит на соответствующую службу прокси-приложений. Чтобы установить расширение, смотрите [My Apps безопасное расширение ввески.](../user-help/my-apps-portal-end-user-access.md#download-and-install-the-my-apps-secure-sign-in-extension)
    
## <a name="test-your-app"></a>Тестирование приложения

Когда вы завершите выполнение этих шагов, ваше приложение будет настроено и запущено. Чтобы протестировать приложение:

1. Откройте браузер и перейдите на **созданный внешний URL** при публикации приложения. 
1. Войдите с помощью тестовой учетной записи, назначенной приложению. Вы должны быть в состоянии загрузить приложение и SSO в приложение.

## <a name="next-steps"></a>Дальнейшие действия

- [Как прокси приложения Azure AD предоставляет единый вход?](application-proxy-single-sign-on.md)
- [Устранение неполадок прокси-сервера приложений](application-proxy-troubleshoot.md)
