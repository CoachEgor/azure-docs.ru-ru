---
title: Планирование развертывания прокси-приложений azure Active Directory
description: Сквозное руководство по планированию развертывания прокси-сервера приложения в вашей организации
services: active-directory
documentationcenter: azure
author: barbaraselden
manager: CelesteDG
ms.assetid: ''
ms.service: active-directory
ms.subservice: app-mgmt
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 04/04/2019
ms.author: baselden
ms.reviewer: ''
ms.openlocfilehash: edd607c4d708df9fcfd3cbd5fdb71f0a7652d6c0
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80330914"
---
# <a name="plan-an-azure-ad-application-proxy-deployment"></a>Планирование развертывания прокси-приложений Azure AD

Azure Active Directory (Azure AD) Application Proxy — это безопасное и экономное решение для удаленного доступа для корпоративных приложений. Он обеспечивает немедленный переход для организаций "Облако первых" для управления доступом к устаревшим корпоративным приложениям, которые еще не способны использовать современные протоколы. Для получения дополнительной вводной информации, [см.](https://docs.microsoft.com/azure/active-directory/manage-apps/application-proxy)

Приложение Прокси рекомендуется для предоставления удаленным пользователям доступа к внутренним ресурсам. Прокси-сервер приложения заменяет потребность в VPN или обратном прокси для этих случаев удаленного использования доступа. Он не предназначен для пользователей, которые находятся в корпоративной сети. Эти пользователи, которые используют Application Proxy для доступа к интрасети, могут столкнуться с нежелательными проблемами с производительностью.

Эта статья включает ресурсы, необходимые для планирования, эксплуатации и управления прокси-сервером Azure AD. 

## <a name="plan-your-implementation"></a>Планирование реализации

В следующем разделе представлено широкое представление о ключевых элементах планирования, которые подготовят вас к эффективному опыту развертывания. 

### <a name="prerequisites"></a>Предварительные требования

Перед началом реализации необходимо выполнить следующие предпосылки. Вы можете увидеть более подробную информацию о настройке среды, в ключая эти предпосылки, в этом [учебнике.](application-proxy-add-on-premises-application.md)

* **Соединитель:** Соединительы являются легкими агентами, которые можно развернуть на:
   * Физическое оборудование на месте
   * VM, размещенный в любом гипервизорном решении
   * VM, размещенный в Azure для включения исходящего подключения к службе прокси приложений.

* Для более подробного обзора смотрите более подробные [обзоры](application-proxy-connectors.md) для получения более подробного обзора.

     * Перед установкой разъемов необходимо подключить разъемные машины [для TLS 1.2.](application-proxy-add-on-premises-application.md)

     * Если возможно, разверните разъемы в той [же сети](application-proxy-network-topology.md) и сегменте, что и серверы веб-приложений. Лучше всего развернуть разъемы после завершения обнаружения приложений.
     * Мы рекомендуем, чтобы каждая группа разъема имеет по крайней мере два разъема, чтобы обеспечить высокую доступность и масштаб. Наличие трех разъемов является оптимальным в случае, если вам может понадобиться обслуживание машины в любой момент. Просмотрите [таблицу емкости разъема,](https://docs.microsoft.com/azure/active-directory/manage-apps/application-proxy-connectors#capacity-planning) чтобы помочь решить, какой тип машины для установки разъемов. Чем больше машина, тем больше буфера и выполнения разъем будет.

* **Настройки доступа к сети:** разъемы прокси-серверов приложения Azure AD [подключаются к Azure через HTTPS (TCP Port 443) и HTTP (TCP Port 80).](application-proxy-add-on-premises-application.md) 

   * Прекращение разъема TLS трафик не поддерживается и не позволит разъемов от создания безопасного канала с их соответствующими конечными точками Azure App Proxy.

   * Избегайте всех форм внедорожной проверки исходящих сообщений TLS между разъемами и Azure. Возможна внутренняя проверка между приложениями разъема и бэкэнда, но может ухудшить пользовательский опыт, и поэтому не рекомендуется.

   * Нагрузка балансировки самих разъемов также не поддерживается, или даже необходимо.

### <a name="important-considerations-before-configuring-azure-ad-application-proxy"></a>Важные соображения перед настройкой прокси-приложения Azure AD

Для настройки и реализации приложения Azure AD Proxy необходимо выполнить следующие основные требования.

*  **Развертывание azure:** Перед развертыванием прокси-сервера приложений идентификаторы пользователей должны быть синхронизированы с бортового каталога или созданы непосредственно в ваших клиентах Azure AD. Синхронизация удостоверений позволяет Azure AD выполнить предварительную проверку подлинности пользователей до предоставления им доступа к опубликованным приложениям Application Proxy и получить сведения об идентификаторах пользователей для выполнения единого входа (SSO).

* **Требования к условному доступу**: Мы не рекомендуем использовать прокси-сервер приложения для внутрисетевого доступа, поскольку это добавляет задержку, которая повлияет на пользователей. Мы рекомендуем использовать приложение Proxy с правилами предварительной аутентификации и условного доступа для удаленного доступа из Интернета.  Подход к обеспечению условного доступа для использования интрасети заключается в модернизации приложений, чтобы они могли непосредственно аутентифицировать сяодор при использовании AAD. Для получения дополнительной информации обратитесь к [Ресурсам для миграции приложений в AAD.](https://docs.microsoft.com/azure/active-directory/manage-apps/migration-resources) 

* **Ограничения службы**: Для защиты от чрезмерного потребления ресурсов отдельными арендаторами существуют ограничения на регулирование, установленные на приложение и арендатора. Чтобы увидеть эти ограничения, обратитесь к [ограничениям и ограничениям службы Azure AD.](https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-service-limits-restrictions) Эти ограничения на регулирование основаны на бенчмарке, значительно превышающем типичный объем использования, и обеспечивают достаточный буфер для большинства развертываний.

* **Публичный сертификат**: Если вы используете пользовательские доменные имена, вы должны приобрести сертификат TLS/SSL. В зависимости от ваших организационных требований, получение сертификата может занять некоторое время, и мы рекомендуем начать процесс как можно раньше. Azure Application Proxy поддерживает стандартные сертификаты [подстановочным и](application-proxy-wildcard.md)миадорным или SAN. Для получения более подробной информации [см. Налаживайте пользовательские домены с помощью прокси-приложения Azure AD.](application-proxy-configure-custom-domain.md)

* **Требования к домену**: Однократное подключение к опубликованным приложениям с использованием Kerberos Constrained Delegation (KCD) требует, чтобы сервер, работающий на коннекторе, и сервер, работающий с приложением, были соединены доменом и являются частью одного и того же домена или доверительных доменов.
Для получения подробной информации по этой теме, см [KCD для одного входного](application-proxy-configure-single-sign-on-with-kcd.md) с приложением прокси. Служба разъема работает в контексте локальной системы и не должна быть настроена для использования пользовательского идентификатора.

* **Записи DNS для URL-адресов**

   * Перед использованием пользовательских доменов в Application Proxy необходимо создать запись CNAME в общедоступной DNS, что позволяет клиентам урегулировать пользовательский внешний URL с заранее определенным адресом прокси-сервера приложения. Неспособность создать запись CNAME для приложения, использующему пользовательский домен, не позволит удаленным пользователям подключиться к приложению. Шаги, необходимые для добавления записей CNAME, могут варьироваться от поставщика DNS к поставщику, поэтому узнайте, как [управлять записями ИНС и записями с помощью портала Azure.](https://docs.microsoft.com/azure/dns/dns-operations-recordsets-portal)

   * Аналогичным образом, узлы разъема должны быть в состоянии разрешить внутренний URL-адрес опубликованных приложений.

* **Административные права и роли**

   * **Установка соединения** требует локальных прав администратора на сервер Windows, на который он устанавливается. Требуется минимум роли *администратора приложения* для проверки подлинности и регистрации экземпляра разъема для вашего клиента Azure AD. 

   * **Публикация приложений и администрирование** требуют роли *администратора приложения.* Администраторы приложений могут управлять всеми приложениями в каталоге, включая регистрацию, настройки SSO, задания пользователей и группы и лицензирование, настройки прокси-приложений и согласие. Она не предоставляет прав на управление условным доступом. Роль *администратора облачных приложений* имеет все возможности администратора приложения, за исключением того, что она не позволяет управление настройками прокси-серверов приложений.

* **Лицензирование**: Прокси-приложение доступно через подписку Azure AD Premium. Для получения полного списка вариантов лицензирования и функций обратитесь к [странице Azure Active Directory.](https://azure.microsoft.com/pricing/details/active-directory/)  

### <a name="application-discovery"></a>Обнаружение приложений

Составить перечень всех приложений, публикуемых через Application Proxy, путем сбора следующей информации:

| Тип данных| Информация для сбора |
|---|---|
| Тип службы| Например: SharePoint, SAP, CRM, пользовательское веб-приложение, API |
| Платформа приложений | Например: Windows IIS, Apache на Linux, Tomcat, NGINX |
| Членство в домене| Полностью квалифицированное доменное имя веб-сервера (ФЗДН) |
| Местоположение приложения | Где веб-сервер или ферма находится в вашей инфраструктуре |
| Внутренний доступ | Точный URL,использованный при доступе к приложению внутри. <br> Если ферма, какой тип балансировки нагрузки используется? <br> Независимо от того, рисует ли приложение содержимое из других источников, кроме самого себя.<br> Определите, работает ли приложение через WebSockets. |
| Внешний доступ | Решение поставщика, к которому приложение уже подвергается внешнему воздействию. <br> URL-адрес, который необходимо использовать для внешнего доступа. Если SharePoint, убедитесь, что альтернативные картографы доступа настроены в [этом руководстве.](https://docs.microsoft.com/SharePoint/administration/configure-alternate-access-mappings) В противом случае необходимо определить внешние URL-адреса. |
| Общедоступный сертификат | При использовании пользовательского домена приобретете сертификат с соответствующим наименованием предмета. если существует сертификат, обратите внимание на серийный номер и местоположение, откуда он может быть получен. |
| Authentication type (Тип проверки подлинности)| Тип аутентификации, поддерживаемый поддержкой приложения, такой как Basic, Интеграционная аутентификация Windows, формы на основе, заголовок на основе, и претензии. <br>Если приложение настроено для работы в определенной учетной записи домена, обратите внимание на полностью квалифицированное доменное имя (ФЗДН) учетной записи службы.<br> Если SAML-основе, идентификатор и ответ URL-адреса. <br> Если заголовок основан, решение поставщика и конкретные требования для обработки типа проверки подлинности. |
| Название группы коннектора | Логическое название для группы разъемов, которые будут назначены для предоставления канала и SSO к этому приложению бэкэнда. |
| Доступ пользователей/групп | Пользователи или группы пользователей, которым будет предоставлен внешний доступ к приложению. |
| Дополнительные требования | Обратите внимание на любые дополнительные требования к удаленному доступу или безопасности, которые должны быть учтены при публикации приложения. |

Вы можете загрузить эту [таблицу инвентаризации приложений](https://aka.ms/appdiscovery) для инвентаризации ваших приложений.

### <a name="define-organizational-requirements"></a>Определение организационных требований

Ниже приведены области, по которым следует определить бизнес-требования организации. Каждая область содержит примеры требований

 **Доступ**

* Удаленные пользователи с конторным и совместно присоедининными к Интернету устройствами с помощью устройств, которые пользователи могут безопасно получить доступ к опубликованным приложениям с бесшовным одним вданным (SSO).

* Удаленные пользователи с одобренными персональными устройствами могут безопасно получить доступ к опубликованным приложениям при условии, что они зарегистрированы в МИД и зарегистрировали приложение Microsoft Authenticator на своем мобильном телефоне в качестве метода аутентификации.

**Управления** 

* Администраторы могут определять и контролировать жизненный цикл назначения пользователей в приложениях, опубликованных через Application Proxy.

**Безопасность**

* Только пользователи, назначенные приложениям через членство в группе или по отдельности, могут получить доступ к этим приложениям.

**Производительность**

* По сравнению с доступом к приложениям из внутренней сети не наблюдается ухудшения производительности приложения.

**Пользовательский опыт**

* Пользователи знают, как получить доступ к своим приложениям, используя знакомые URL-адреса компании на любой платформе устройства.

**Аудит**
* Администраторы могут проверять действия доступа пользователей.


### <a name="best-practices-for-a-pilot"></a>Лучшие практики для пилота

Определить количество времени и усилий, необходимых для полного ввода в эксплуатацию одного приложения для удаленного доступа с единым вводом (SSO). Сделайте это, запустив пилот, который рассматривает его первоначальное открытие, публикацию и общее тестирование. Использование простого веб-приложения на базе IIS, которое уже предварительно настроено для интегрированной аутентификации Windows (IWA), поможет установить базовый узел, так как эта настройка требует минимальных усилий для успешного пилотирования удаленного доступа и SSO.

Следующие элементы дизайна должны повысить успешность пилотной реализации непосредственно в производственном арендаторе.  

**Управление соединителем**:  

* Соединительы играют ключевую роль в предоставлении предварительного канала для ваших приложений. Использование группы разъемов **По умолчанию** является достаточным для первоначального экспериментального тестирования опубликованных приложений перед вводом их в эксплуатацию. Успешно протестированные приложения могут быть перемещены в производственные группы разъемов.

**Управление приложениями:**

* Ваша рабочая сила, скорее всего, помнит внешний URL знакомый и актуальный. Избегайте публикации приложения, используя наши заранее определенные msappproxy.net или onmicrosoft.com суффиксы. Вместо этого, предоставить знакомый верхнего уровня проверенного домена, prefixed с логическим хостимен, таких как *intranet.<customers_domain>.com*.

* Ограничьте видимость значка пилотного приложения пилотной группе, скрывая значок запуска на портале Azure MyApps. При готовности к производству вы можете передать приложение в соответствующую целевую аудиторию, либо в том же предсерийном арендаторе, либо путем публикации приложения в производственном арендаторе.

**Единые настройки подписей**: Некоторые настройки SSO имеют определенные зависимости, для настройки которых может уйти время, поэтому избегайте задержек управления изменениями, обеспечивая своевременное обращение зависимостей. Это включает в себя соединение узлов разъема домена для выполнения SSO с помощью Kerberos Constrained Delegation (KCD) и заботы о других трудоемких действиях. Например, настройка экземпляра ДОСТУПА PING при необходимости SSO на основе заголовка.

**TLS между хостом-соединением и целевым приложением**: Безопасность имеет первостепенное значение, поэтому TLS между хостом-разъемом и целевыми приложениями всегда следует использовать. В частности, если веб-приложение настроено для проверки подлинности на основе форм (FBA), то, как учетные данные пользователей затем эффективно передаются в ясном тексте.

**Осуществлять поэтапно и тестировать каждый шаг.** Проведите базовое функциональное тестирование после публикации приложения, чтобы убедиться, что все требования пользователя и бизнеса удовлетворяются следующими указаниями, приведенными ниже:

1. Тестирование и проверка общего доступа к веб-приложению с отключением до аутентификации.
2. В случае успеха позволяет предаутентификации и назначить пользователей и групп. Тестирование и проверка доступа.
3. Затем добавьте метод SSO для приложения и снова проверьте для проверки доступа.
4. При необходимости применяйте политики «Условный доступ» и «МИД». Тестирование и проверка доступа.

**Инструменты устранения неполадок:** При устранении неполадок всегда начинайте с проверки доступа к опубликованному приложению из браузера на разъеме и подтверждайте, что приложение функционирует как ожидалось. Чем проще настройка, тем легче определить первопричину, поэтому подумайте о том, чтобы попытаться воспроизвести проблемы с минимальной конфигурацией, например, с помощью только одного разъема и без SSO. В некоторых случаях инструменты отладки веб-страниц, такие как «Скрипач» компании Telerik, могут оказаться незаменимыми для устранения неполадок в доступе или проблем с контентом в приложениях, к которые можно получить доступ через прокси- Скрипач также может выступать в качестве прокси, чтобы помочь отслеживать и отлажонить трафик для мобильных платформ, таких как iOS и Android, и практически все, что может быть настроено на маршрут через прокси. Дополнительную информацию можно найти в руководстве по [устранению неполадок.](application-proxy-troubleshoot.md)

## <a name="implement-your-solution"></a>Внедрить свое решение

### <a name="deploy-application-proxy"></a>Развертывание прокси-сервера приложений

Шаги по развертыванию приложения Proxy описаны в этом [учебнике для добавления приложения для удаленного доступа.](application-proxy-add-on-premises-application.md) Если установка не удалась, выберите **Прокси-сервер приложения Troubleshoot на** портале или воспользуйтесь руководством по устранению [неполадок для устранения проблем с установкой подключения агента прокси-сервера приложения.](application-proxy-connector-installation-problem.md)

### <a name="publish-applications-via-application-proxy"></a>Публикация приложений через приложение Прокси

Публикация приложений предполагает, что вы выполнили все предварительные требования и что у вас есть несколько разъемов, отображаемых как зарегистрированных и активных на странице Приложения Прокси.

Вы также можете публиковать приложения с помощью [PowerShell](https://docs.microsoft.com/powershell/module/azuread/?view=azureadps-2.0-preview).

Ниже приведены некоторые рекомендации для подражания при публикации приложения:

* **Используйте группы соединения**: Назначьте группу разъемов, которая была назначена для публикации каждого соответствующего приложения. Мы рекомендуем, чтобы каждая группа разъема имеет по крайней мере два разъема, чтобы обеспечить высокую доступность и масштаб. Наличие трех разъемов является оптимальным в случае, если вам может понадобиться обслуживание машины в любой момент. Кроме того, [см. Приложения Publish в отдельных сетях и местах с помощью групп разъемов,](application-proxy-connector-groups.md) чтобы увидеть, как можно также использовать группы разъемов для сегмента разъемов по сети или местоположению.

* **Установите тайм-аут приложения Backend**: Эта настройка полезна в сценариях, где приложению может потребоваться более 75 секунд для обработки клиентской транзакции. Например, когда клиент отправляет запрос в веб-приложение, которое действует как передняя часть базы данных. Передняя часть отправляет этот запрос на сервер базы данных задней части и ждет ответа, но к тому времени, когда он получает ответ, клиентская сторона разговора тайм-аут. Установка тайм-аута в Long обеспечивает 180 секунд для завершения более длительных транзакций.

* **Использование соответствующих типов файлов cookie**

   * **HTTP-Only Cookie**: Обеспечивает дополнительную безопасность, имея приложение Прокси включить httpOnly флаг в набор-cookie HTTP заголовки ответов. Этот параметр помогает уменьшить эксплойты, такие как кросс-сайт скриптов (XSS). Оставьте этот набор нет для клиентов/пользователей, которым требуется доступ к cookie-файлам сеанса. Например, клиент RDP/MTSC, подключенный к удаленному шлюзу для рабочего стола, опубликованный через App Proxy.

   * **Безопасный файл cookie:** Когда файл cookie установлен с атрибутом Secure, агент пользователя (клиентское приложение) будет включать файлcookieое печенье в запросы HTTP только в том случае, если запрос передается через защищенный канал TLS. Это помогает уменьшить риск того, что файлcookieо-файловый будет скомпрометирован по четким текстовым каналам, поэтому следует быть включенным.

   * **Постоянное**cookie-файлы: позволяет cookie-файлам сеанса приложения сохраняться между закрытием браузера, оставаясь действительным до истечения срока действия или удаления. Используется для сценариев, где богатое приложение, такое как office, получает доступ к документу в опубликованном веб-приложении, без повторного запроса пользователя для проверки подлинности. Включить с осторожностью, однако, как стойкие куки могут в конечном итоге оставить службу под угрозой несанкционированного доступа, если не используется в сочетании с другими компенсационными элементами управления. Эта настройка должна использоваться только для старых приложений, которые не могут совместно использовать файлы cookie между процессами. Лучше обновить приложение для обработки файлов cookie между процессами, а не использовать эту настройку.

* **Переведите URL-адреса в заголовки:** Вы включите это для сценариев, где внутренние DNS не могут быть настроены в соответствии с общедоступным пространством имен организации (также известного как Split DNS). Если приложение не требует исходного заголовка хоста в запросе клиента, оставьте этот набор значений Да. Альтернативой является использование разъема F-DN во внутреннем URL для разгрома фактического трафика, а F-DN во внешнем URL- — в качестве заголовка хоста. В большинстве случаев эта альтернатива должна позволять приложению функционировать в обычном режиме, когда доступ к нему осуществляется удаленно, но пользователи теряют преимущества, связанные с тем, что у пользователей есть соответствующий & вне URL.

* **Переведите URL-адреса в application Body:** Включите перевод ссылки application Body для приложения, когда вы хотите, чтобы ссылки из этого приложения были переведены в ответах обратно клиенту. Если включена, эта функция обеспечивает наилучшую попытку приложить усилия для перевода всех внутренних ссылок, которые App Proxy находит в ОТВЕТАх HTML и CSS, возвращающихся клиентам. Это полезно при публикации приложений, которые содержат либо жестко закодированные абсолютные или NetBIOS короткие ссылки в содержании, или приложения с содержанием, которое ссылки на другие приложения.

Для сценариев, где опубликованное приложение ссылается на другие опубликованные приложения, включите перевод ссылок для каждого приложения, чтобы у вас был контроль над пользовательским интерфейсом на уровне каждого приложения.

Например, предположим, что у вас есть три приложения, опубликованные через приложение Proxy, которые все ссылки друг на друга: Преимущества, расходы и путешествия, а также четвертое приложение, Обратная связь, которая не публикуется через приложение Прокси.

![Изображение 1](media/App-proxy-deployment-plan/link-translation.png)

При включании перевода ссылок для приложения Benefits ссылки на Expenses and Travel перенаправляются на внешние URL-адреса для этих приложений, чтобы пользователи, доступ к приложениям из-за пределов корпоративной сети могли получить к ним доступ. Ссылки из расходов и путешествия обратно в преимущества не работают, потому что ссылка перевод не был включен для этих двух приложений. Ссылка на обратную связь не перенаправляется из-за того, что нет внешнего URL-адреса, поэтому пользователи, использующие приложение «Преимущества», не смогут получить доступ к приложению обратной связи из-за пределов корпоративной сети. Смотрите подробную информацию о [переводе ссылки и других вариантах перенаправления.](application-proxy-configure-hard-coded-link-translation.md)

### <a name="access-your-application"></a>Доступ к приложению

Существует несколько вариантов управления доступом к опубликованным ресурсам App Proxy, поэтому выберите наиболее подходящий для данного сценария и потребности в масштабируемости. Общие подходы включают: использование групп, синхронизированных через Azure AD Connect, создание динамических групп в Azure AD на основе атрибутов пользователя, использование групп самообслуживания, управляемых владельцем ресурса, или сочетание всех этих. Ознакомьтесь с связанными ресурсами для получения преимуществ каждого из них.

Самый прямой способ назначения пользователям доступа к приложению — это переход **пользователей и групп** из левого стекла вашего опубликованного приложения и непосредственное назначение групп или отдельных лиц.

![Рисунок 24](media/App-proxy-deployment-plan/add-user.png)

Вы также можете разрешить пользователям самообслуживание к вашему приложению, назначив группу, членом которой они в настоящее время не являются, и настройвая параметры самообслуживания.

![Рисунок 25](media/App-proxy-deployment-plan/allow-access.png)

Если включена, пользователи смогут войти в портал MyApps и запросить доступ, и либо быть автоматически утверждены и добавлены в уже разрешенную группу самообслуживания, или нуждаются в одобрении от назначенного одобрители.

Гость пользователям также может быть [предложено получить доступ к внутренним приложениям, опубликованным через Application Proxy через Azure AD B2B.](https://docs.microsoft.com/azure/active-directory/b2b/add-users-information-worker)

Для приложений помещений, которые обычно доступны анонимно, не требующие проверки подлинности, вы можете предпочесть отключить опцию, расположенную в **свойствах**приложения.

![Рисунок 26](media/App-proxy-deployment-plan/assignment-required.png)


Оставляя эту опцию, установленную в No, пользователи могут получить доступ к приложению через Azure AD App Proxy без разрешения, поэтому используйте с осторожностью.

Как только ваше приложение опубликовано, оно должно быть доступно, введя [https://myapps.microsoft.com](https://myapps.microsoft.com/)свой внешний URL в браузере или по его значку на .

### <a name="enable-pre-authentication"></a>Включить предварительную аутентификацию

Убедитесь, что ваше приложение доступно через приложение Proxy, доступ к нему через внешний URL. 

1. Перейдите к**приложениям** >  **Azure Active Directory** > Enterprise**Все приложения** и выберите приложение, которым вы хотите управлять.

2. Выберите **Прокси приложения**.

3. В поле **предварительной проверки** используйте список выпадающих средств для выбора **активного каталога Azure**и **сохранения.**

С включенной предварительной аутентификацией Azure AD бросает вызов пользователям сначала для проверки подлинности, и если один вход настроен, то приложение бэк-энда также проверит пользователя до предоставления доступа к приложению. Изменение режима предварительной аутентификации с Passthrough на Azure AD также настраивает внешний URL с HTTPS, поэтому любое приложение, изначально настроенное для HTTP, теперь будет защищено httpS.

### <a name="enable-single-sign-on"></a>Доступ с единым входом

SSO обеспечивает наилучший пользовательский опыт и безопасность, поскольку пользователям нужно войти только один раз при доступе к Azure AD. После предварительной проверки подлинность пользователя SSO выполняется аутентификатом application Proxy для предварительного приложения от имени пользователя. Приложение бэкэнда обрабатывает логин, как если бы это был сам пользователь. 

Выбор опции **Passthrough** позволяет пользователям получить доступ к опубликованному приложению без необходимости проверки подлинности Azure AD.

Выполнение SSO возможно только в том случае, если Azure AD может идентифицировать пользователя, запрашивающего доступ к ресурсу, поэтому ваше приложение должно быть настроено для предварительной аутентификации пользователей с помощью Azure AD при доступе к SSO для работы, в противном случае параметры SSO будут отключены.

Прочитайте [единый подспорье приложений в Azure AD,](what-is-single-sign-on.md) чтобы помочь вам выбрать наиболее подходящий метод SSO при настройке приложений.

###  <a name="working-with-other-types-of-applications"></a>Работа с другими типами приложений

Прокси-приложение Azure AD также может поддерживать приложения, разработанные для использования в нашей библиотеке аутентификации Azure AD[(ADAL)](https://docs.microsoft.com/azure/active-directory/develop/active-directory-authentication-libraries)или библиотеке подлинности Microsoft[(MSAL).](https://azure.microsoft.com/blog/start-writing-applications-today-with-the-new-microsoft-authentication-sdks/) Он поддерживает приложения для нативших клиентов, потребляя токены Azure AD, полученные в заголовке информации запроса клиента для выполнения предварительной аутентификации от имени пользователей.

Прочитайте [публикацию приложений для натиных и мобильных клиентов](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-native-client) и [приложений, основанных на претензиях,](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-claims-aware-apps) чтобы узнать о доступных конфигурациях приложения Proxy.

### <a name="use-conditional-access-to-strengthen-security"></a>Используйте условный доступ для усиления безопасности

Безопасность приложений требует расширенного набора возможностей безопасности, которые могут защитить от сложных угроз и реагировать на них в окуме. Злоумышленники чаще всего получают доступ к корпоративной сети через слабые, по умолчанию или украденные учетные данные пользователей.  Безопасность, управляемая удостоверяющими данные корпорации Майкрософт, снижает использование украденных учетных данных, управляя и защищая как привилегированные, так и непривилегированные идентификаторы.

Следующие возможности могут быть использованы для поддержки прокси-приложений Azure AD:

* Условный доступ пользователей и местоположения: Держите конфиденциальные данные защищенными, ограничивая доступ пользователей на основе геолокации или IP-адреса [политики условного доступа.](https://docs.microsoft.com/azure/active-directory/active-directory-conditional-access-locations)

* Условный доступ на основе устройств: Убедитесь, что только зарегистрированные, утвержденные и совместимые устройства могут получить доступ к корпоративным данным с [помощью условного доступа на основе устройств.](https://docs.microsoft.com/azure/active-directory/active-directory-conditional-access-policy-connected-applications)

* Условный доступ на основе приложений: Работа не должна прекращаться, когда пользователь не находится в корпоративной сети. [Безопасный доступ к корпоративным облачным и корпоративным приложениям](https://docs.microsoft.com/azure/active-directory/active-directory-conditional-access-mam) и поддерживать контроль с помощью Условия доступа.

* Условный доступ на основе риска: Защитите ваши данные от злоумышленников с [помощью политики условного доступа, основанной на риске,](https://www.microsoft.com/cloud-platform/conditional-access) которая может применяться ко всем приложениям и всем пользователям, будь то на месте или в облаке.

* Панель доступа Azure AD: При развертывании службы прокси приложений и надежной публикации приложений предлагает пользователям простой концентратор для обнаружения и доступа ко всем их приложениям. Повышение производительности с помощью возможностей самообслуживания, таких как возможность запрашивать доступ к новым приложениям и группам или управлять доступом к этим ресурсам от имени других, через [Панель доступа.](https://aka.ms/AccessPanelDPDownload)

## <a name="manage-your-implementation"></a>Управление реализацией

### <a name="required-roles"></a>Обязательные роли

Корпорация Майкрософт отстаивает принцип предоставления наименее возможной привилегии для выполнения необходимых задач с Azure AD. [Просмотрите различные доступные роли Azure](https://docs.microsoft.com/azure/active-directory/active-directory-assign-admin-roles-azure-portal) и выберите правильный выбор для удовлетворения потребностей каждого человека. Некоторые роли могут быть применены временно и удалены после завершения развертывания.

| Роль бизнеса| Бизнес-задачи| Роли Azure AD |
|---|---|---|
| Администратор справочной службы | Обычно ограничивается квалификационным конечным пользователем, сообщающим о проблемах и выполняющим ограниченные задачи, такими как изменение паролей пользователей, недействительное обновление токенов и мониторинг работоспособности службы. | Администратор службы технической поддержки |
| Админ идентификации| Прочитайте знак Azure AD в отчетах и журналах аудита, чтобы отладить проблемы, связанные с Прокси-приложением.| Читатель сведений о безопасности |
| Владелец приложения| Создавайте и управляйте всеми аспектами корпоративных приложений, регистрации приложений и настроек прокси-серверов.| Админ приложения |
| Админ инфраструктуры | Владелец опрокидывания сертификата | Админ приложения |

Минимизация числа людей, имеющих доступ к защищенной информации или ресурсам, поможет снизить вероятность того, что злоумышленник получит несанкционированный доступ или авторизованный пользователь непреднамеренно возразит на конфиденциальный ресурс. 
 
Тем не менее, пользователям по-прежнему необходимо выполнять повседневные привилегированные операции, поэтому соблюдение политик управления привилегированными удостоверениями данных на основе [привилегированного](https://docs.microsoft.com/azure/active-directory/active-directory-privileged-identity-management-configure) identity management для обеспечения привилегированного доступа к ресурсам Azure по требованию и Azure AD является нашим рекомендуемым подходом к эффективному управлению административным доступом и аудитом.

### <a name="reporting-and-monitoring"></a>Создание отчетов и мониторинг

Azure AD предоставляет дополнительные сведения об использовании приложений вашей организации и работе с работоспособностью через [журналы аудита и отчеты.](../reports-monitoring/concept-provisioning-logs.md?context=azure/active-directory/manage-apps/context/manage-apps-context) Приложение Прокси также делает его очень легко контролировать разъемы с портала Azure AD и Журналы событий Windows.

#### <a name="application-audit-logs"></a>Журналы аудита приложений

Эти журналы предоставляют подробную информацию о логинах для приложений, настроенных с помощью приложения Proxy и устройства, а также пользователя, доступ к приложению. [Журналы аудита](../reports-monitoring/concept-provisioning-logs.md?context=azure/active-directory/manage-apps/context/manage-apps-context) размещены на портале Azure и в [API аудита](https://docs.microsoft.com/graph/api/resources/directoryaudit?view=graph-rest-beta) на экспорт. Кроме того, [отчеты об использовании и сведениях](../reports-monitoring/concept-usage-insights-report.md?context=azure/active-directory/manage-apps/context/manage-apps-context) также доступны для вашего приложения.

#### <a name="application-proxy-connector-monitoring"></a>Мониторинг подключения прокси-приложений

Соединители и служба отвечают за выполнение задач, связанных с высоким уровнем доступности. Вы можете следить за состоянием разъемов со страницы Application Proxy на портале Azure AD. Для получения дополнительной информации о коннекторе соединения [см.](https://docs.microsoft.com/azure/active-directory/manage-apps/application-proxy-connectors#maintenance)

![Пример: разъемы прокси-серверов приложения Azure AD](./media/application-proxy-connectors/app-proxy-connectors.png)

#### <a name="windows-event-logs-and-performance-counters"></a>Журналы событий Windows и счетчики производительности

Соединительные системы имеют как журналы админора, так и журналы сеансов. В журналах администратора регистрируются основные события и соответствующие ошибки. В журналах сеансов содержатся все транзакции и подробные сведения об их обработке. Логи и счетчики расположены в журналах Windows Event Logs для получения дополнительной информации [см.](https://docs.microsoft.com/azure/active-directory/manage-apps/application-proxy-connectors#under-the-hood) Следуйте этому [учебнику, чтобы настроить источники данных журнала событий в Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/platform/data-sources-windows-events).

### <a name="troubleshooting-guide-and-steps"></a>Руководство по устранению неполадок и шаги

Узнайте больше об общих проблемах и о том, как их решить с помощью нашего руководства по [устранению](application-proxy-troubleshoot.md) ошибок. 

Следующие статьи охватывают общие сценарии, которые также могут быть использованы для создания руководств по устранению неполадок для вашей организации поддержки. 

* [Проблемы при отображении страницы приложения](application-proxy-page-appearance-broken-problem.md)
* [Слишком долгая загрузка приложения](application-proxy-page-load-speed-problem.md)
* [Ссылки на странице приложения не работают](application-proxy-page-links-broken-problem.md)
* [Порты, которые необходимо открыть для приложения](application-proxy-connectivity-ports-how-to.md)
* [Не удается найти рабочий соединитель в группе соединителей для приложения](application-proxy-connectivity-no-working-connector.md)
* [Настройка на портале администрирования](application-proxy-config-how-to.md)
* [Настройка единого входа в приложение](application-proxy-config-sso-how-to.md)
* [Проблема при создании приложения на портале администрирования](application-proxy-config-problem.md)
* [Настройка ограниченного делегирования Kerberos](application-proxy-back-end-kerberos-constrained-delegation-how-to.md)
* [Настройка с использованием PingAccess](application-proxy-back-end-ping-access-how-to.md)
* [Ошибка "Can't Access this Corporate Application" (Нет доступа к этому корпоративному приложению)](application-proxy-sign-in-bad-gateway-timeout-error.md)
* [Проблема при установке соединителя агента Application Proxy](application-proxy-connector-installation-problem.md)
* [Проблемы со входом](application-sign-in-problem-on-premises-application-proxy.md)
