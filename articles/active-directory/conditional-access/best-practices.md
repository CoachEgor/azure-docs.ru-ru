---
title: Рекомендации по условному доступу в Azure Active Directory | Документация Майкрософт
description: Узнайте о вещах, которые должны быть знакомы, и о том, что следует избегать при настройке политик условного доступа.
services: active-directory
ms.service: active-directory
ms.subservice: conditional-access
ms.topic: article
ms.date: 01/25/2019
ms.author: joflore
author: MicrosoftGuyJFlo
manager: daveba
ms.reviewer: calebb
ms.collection: M365-identity-device-management
ms.openlocfilehash: ccfbb31c29b9e240a4865c8d7d98d7b6af00d1fd
ms.sourcegitcommit: 5ab4f7a81d04a58f235071240718dfae3f1b370b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/10/2019
ms.locfileid: "74963942"
---
# <a name="best-practices-for-conditional-access-in-azure-active-directory"></a>Рекомендации по условному доступу в Azure Active Directory

С помощью [условного доступа Azure Active Directory (Azure AD)](../active-directory-conditional-access-azure-portal.md)можно контролировать доступ полномочных пользователей к облачным приложениям. В этой статье вы ознакомитесь:

- с важными сведениями; 
- Что следует избегать при настройке политик условного доступа. 

В этой статье предполагается, что вы знакомы с концепциями и терминологией, описанными в разделе [что такое условный доступ в Azure Active Directory?](../active-directory-conditional-access-azure-portal.md)

## <a name="whats-required-to-make-a-policy-work"></a>Что необходимо для работы политики?

При создании политики отсутствуют выбранные пользователи, группы, приложения или элементы управления доступом.

![Облачные приложения](./media/best-practices/02.png)

Чтобы привести политику в работоспособное состояние, необходимо настроить следующее.

| Что           | Как                                  | Назначение |
| :--            | :--                                  | :-- |
| **Облачные приложения** |Выберите одно или несколько приложений.  | Цель политики условного доступа заключается в том, чтобы вы могли контролировать, как разрешенные пользователи могут получать доступ к облачным приложениям.|
| **Пользователи и группы** | Выберите по меньшей мере одного пользователя или группу, которая имеет права для доступа к выбранным облачным приложениям. | Политика условного доступа, которая не имеет назначенных пользователей и групп, никогда не запускается. |
| **Элементы управления доступом** | Выберите по меньшей мере один элемент управления доступом. | Процессор политики должен знать, что делать в случае выполнения условий. |

## <a name="what-you-should-know"></a>Необходимая информация

### <a name="how-are-conditional-access-policies-applied"></a>Как применяются политики условного доступа?

При доступе к облачному приложению может применяться более одной политики условного доступа. В этом случае условия всех применяемых политик должны быть выполнены. Например, если для одной политики требуется многофакторная проверка подлинности (MFA), а для другой требуется соответствующее устройство, необходимо пройти MFA и использовать соответствующее устройство. 

Все политики применяются в два этапа.

- Этап 1. 
   - Detail Collection: сбор сведений для определения политик, которые уже будут удовлетворены.
   - На этом этапе пользователи могут увидеть запрос сертификата, если соответствие устройства требованиям является частью политик условного доступа. Этот запрос может возникнуть при работе с приложениями браузера, если операционная система устройства не является Windows 10.
   - Этап 1 вычисления политики выполняется для всех включенных политик и политик в [режиме «только отчет](concept-conditional-access-report-only.md)».
- Этап 2.
   - Принудительное применение. принимая во внимание сведения, собранные на этапе 1, запросите пользователя выполнить любые дополнительные требования, которые не были выполнены.
   - Применить результаты к сеансу. 
   - Этап 2 вычисления политики выполняется для всех включенных политик.

### <a name="how-are-assignments-evaluated"></a>Проверка назначений

Все назначения выполняются с помощью логического оператора **AND**. Если вы настроили несколько назначений, для активации политики все назначения должны быть выполнены.  

Если необходимо настроить условие расположения, которое применяется ко всем подключениям за пределами сети вашей организации, сделайте следующее:

- включите **все расположения**;
- исключите **все надежные IP-адреса**.

### <a name="what-to-do-if-you-are-locked-out-of-the-azure-ad-admin-portal"></a>Что делать, если доступ к порталу администрирования Azure AD для вас заблокирован?

Если вы блокируете портал Azure AD из-за неправильного параметра в политике условного доступа:

- Проверьте, есть ли в вашей организации администраторы, доступ которым не заблокирован. Администратор с доступом к порталу Azure может отключить политику, влияющую на вход в систему. 
- Если ни один из администраторов в организации не может обновить политику, необходимо отправить запрос в службу поддержки. Службы поддержки Майкрософт могут просматривать и обновлять политики условного доступа, которые препятствуют доступу.

### <a name="what-happens-if-you-have-policies-in-the-azure-classic-portal-and-azure-portal-configured"></a>Что произойдет, если настроить политики на классическом портале Azure и на портале Azure?  

Azure Active Directory применяет обе политики, и пользователь получает доступ только в том случае, если все требования соблюдены.

### <a name="what-happens-if-you-have-policies-in-the-intune-silverlight-portal-and-the-azure-portal"></a>Что произойдет, если настроить политики на портале Intune Silverlight и портале Azure?

Azure Active Directory применяет обе политики, и пользователь получает доступ только в том случае, если все требования соблюдены.

### <a name="what-happens-if-i-have-multiple-policies-for-the-same-user-configured"></a>Что произойдет, если настроить несколько политик для одного пользователя?  

Во время каждого входа в систему Azure Active Directory оценивает все политики и проверяет соблюдение всех требований, прежде чем предоставить пользователю доступ. Блокирование доступа перекрывает все остальные параметры конфигурации. 

### <a name="does-conditional-access-work-with-exchange-activesync"></a>Работает ли условный доступ с Exchange ActiveSync?

Да, Exchange ActiveSync можно использовать в политике условного доступа.

Некоторые облачные приложения, такие как SharePoint Online и Exchange Online, также поддерживают устаревшие протоколы проверки подлинности. Если клиентское приложение может использовать устаревший протокол проверки подлинности для доступа к облачному приложению, Azure AD не может принудительно применить политику условного доступа для этой попытки доступа. Чтобы предотвратить обход применяемых политик клиентским приложением, следует проверить, можно ли включить для затронутых облачных приложений только современную аутентификацию.

### <a name="how-should-you-configure-conditional-access-with-office-365-apps"></a>Как настроить условный доступ с приложениями Office 365?

Так как приложения Office 365 взаимосвязаны, рекомендуется назначать часто используемые приложения вместе при создании политик.

К общим взаимоподключенным приложениям относятся Microsoft Flow, планировщик Майкрософт, Microsoft Teams, Office 365 Exchange Online, Office 365 SharePoint Online и Office 365 Yammer.

Это важно для политик, требующих взаимодействия с пользователем, таких как многофакторная проверка подлинности, когда доступ контролируется в начале сеанса или задачи. В противном случае пользователи не смогут выполнять некоторые задачи в приложении. Например, если требуется многофакторная идентификация на неуправляемых устройствах для доступа к SharePoint, но не по электронной почте, пользователи, работающие в своей электронной почте, не смогут вкладывать файлы SharePoint в сообщение. Дополнительные сведения можно найти в статье [что такое зависимости служб в Azure Active Directory условном доступе?](service-dependencies.md).

## <a name="what-you-should-avoid-doing"></a>Чего следует избегать

Платформа условного доступа обеспечивает большую гибкость настройки. Тем не менее исключительная гибкость также означает, что во избежание нежелательных результатов необходимо внимательно просмотреть каждую политику конфигурации, прежде чем выпускать ее. В этом контексте следует уделить особое внимание назначениям, которые влияют на полные наборы, такие как **все пользователи / группы / облачные приложения**.

В своей среде следует избегать следующих конфигураций:

**Для всех пользователей, всех облачных приложений:**

- **Блокировка доступа** — эта конфигурация блокирует всю организацию, что явно не является хорошей идеей.
- **Требовать соответствующее требованиям устройство** — для пользователей, которые еще не зарегистрировали свои устройства, эта политика полностью блокирует доступ, включая доступ к порталу Intune. Если вы являетесь администратором без зарегистрированного устройства, то эта политика блокирует ваш доступ к порталу Azure для изменения политики.
- **Require domain join** (Требовать присоединения к домену) — эта политика блокировки доступа также имеет возможность блокировать доступ для всех пользователей организации, у которых еще нет присоединенных к домену устройств.
- **Требовать политику защиты приложений** . Этот блок политики также может блокировать доступ для всех пользователей в Организации, если у вас нет политики Intune. Если вы являетесь администратором без клиентского приложения, в котором есть политика защиты приложений Intune, эта политика запрещает переход на такие порталы, как Intune и Azure.

**Для всех пользователей, всех облачных приложений, всех платформ устройств:**

- **Блокировка доступа** — эта конфигурация блокирует всю организацию, что явно не является хорошей идеей.

## <a name="how-should-you-deploy-a-new-policy"></a>Как развертывать новую политику?

Сначала необходимо оценить политику с помощью [инструмента what if для условного доступа](what-if-tool.md).

Когда новые политики будут готовы для вашей среды, разверните их поэтапно.

1. Примените политику к небольшому набору пользователей и убедитесь, что она правильно работает. 
1. При расширении политики для вмещения большего количества пользователей продолжайте исключать всех администраторов из политики, чтобы гарантировать, что они все еще имеют доступ и могут обновлять политику, если требуется изменение.
1. Применяйте политику ко всем пользователям, только если это действительно необходимо. 

Мы рекомендуем создать учетную запись пользователя, которая:

- предназначена для администрирования политики, 
- исключена из всех политик.

## <a name="policy-migration"></a>Перенос политики

Мы рекомендуем перенести политики, созданные не на портале Azure, по следующим причинам:

- Теперь вы можете работать со сценариями, которые невозможно было обрабатывать ранее.
- Можно уменьшить количество политик, которыми необходимо управлять, объединяя их.   
- Вы можете управлять всеми политиками условного доступа в одном централизованном расположении.
- Классический портал Azure больше не используется.   

Дополнительные сведения см. в статье [Перенос классических политик на портале Azure](policy-migration.md).

## <a name="next-steps"></a>Дальнейшие действия

Чтобы узнать:

- Настройке политики условного доступа см. в статье [запрос MFA для конкретных приложений с Azure Active Directory условным доступом](app-based-mfa.md).
- Планировании политик условного доступа см. [в разделе Планирование развертывания условного доступа в Azure Active Directory](plan-conditional-access.md).
