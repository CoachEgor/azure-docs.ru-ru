---
title: Рекомендации для условного доступа в Active-каталоге Azure (ru) Документы Майкрософт
description: Узнайте о том, что вы должны знать, и что вы должны избегать при настройке политик условного доступа.
services: active-directory
ms.service: active-directory
ms.subservice: conditional-access
ms.topic: article
ms.date: 01/25/2019
ms.author: joflore
author: MicrosoftGuyJFlo
manager: daveba
ms.reviewer: calebb
ms.collection: M365-identity-device-management
ms.openlocfilehash: f4560a514ddb9949c8cc07864b2319a5878b245e
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80295362"
---
# <a name="best-practices-for-conditional-access-in-azure-active-directory"></a>Рекомендации для условного доступа в active-каталоге Azure

С помощью условного доступа к облачному доступу [С помощью Azure Active Directory (Azure AD)](../active-directory-conditional-access-azure-portal.md)можно контролировать доступ авторизованных пользователей к облачным приложениям. В этой статье вы ознакомитесь:

- с важными сведениями; 
- Что именно следует избегать при настройке политик условного доступа. 

В этой статье предполагается, что вы знакомы с понятиями и терминологией, изложенными в [Active Directory?](../active-directory-conditional-access-azure-portal.md)

## <a name="whats-required-to-make-a-policy-work"></a>Что требуется для работы с политикой?

При создании политики отсутствуют выбранные пользователи, группы, приложения или элементы управления доступом.

![Облачные приложения](./media/best-practices/02.png)

Чтобы привести политику в работоспособное состояние, необходимо настроить следующее.

| Что           | Как                                  | Назначение |
| :--            | :--                                  | :-- |
| **Облачные приложения** |Выберите одно или несколько приложений.  | Цель политики условного доступа состоит в том, чтобы дать возможность контролировать, как авторизованные пользователи могут получить доступ к облачным приложениям.|
| **Пользователи и группы** | Выберите по меньшей мере одного пользователя или группу, которая имеет права для доступа к выбранным облачным приложениям. | Политика условного доступа, в которой нет назначенных пользователей и групп, никогда не срабатывает. |
| **Элементы управления доступом** | Выберите по меньшей мере один элемент управления доступом. | Процессор политики должен знать, что делать в случае выполнения условий. |

## <a name="what-you-should-know"></a>Необходимая информация

### <a name="how-are-conditional-access-policies-applied"></a>Как применяются политики условного доступа?

При доступе к облачному приложению может применяться несколько политик условного доступа. В этом случае условия всех применяемых политик должны быть выполнены. Например, если одна политика требует многофакторной аутентификации (MFA), а другая требует совместимого устройства, необходимо заполнить МИД и использовать устройство, соответствующее требованиям. 

Все политики применяются в два этапа.

- Этап 1. 
   - Коллекция деталей: Соберите детали для определения политик, которые уже будут удовлетворены.
   - На этом этапе пользователи могут видеть запрос сертификата, если соответствие требованиям устройства является частью политик и ногой условного доступа. Этот запрос может возникнуть для приложений браузера, когда операционная система устройства не Windows 10.
   - Фаза 1 оценки политики выполняется для всех включенных политик и политик в [режиме только отчета.](concept-conditional-access-report-only.md)
- Этап 2.
   - Правоприменение: Принимая во внимание детали, собранные на этапе 1, попросите пользователя удовлетворить любые дополнительные требования, которые не были выполнены.
   - Примените результаты к сеансу. 
   - Этап 2 оценки политики выполняется для всех включенных политик.

### <a name="how-are-assignments-evaluated"></a>Проверка назначений

Все назначения выполняются с помощью логического оператора **AND**. Если вы настроили несколько назначений, для активации политики все назначения должны быть выполнены.  

Если необходимо настроить условие расположения, которое применяется ко всем подключениям за пределами сети вашей организации, сделайте следующее:

- включите **все расположения**;
- исключите **все надежные IP-адреса**.

### <a name="what-to-do-if-you-are-locked-out-of-the-azure-ad-admin-portal"></a>Что делать, если доступ к порталу администрирования Azure AD для вас заблокирован?

Если вы заблокированы на портале Azure AD из-за неправильной настройки в политике условного доступа:

- Проверьте, есть ли в вашей организации администраторы, доступ которым не заблокирован. Администратор с доступом к порталу Azure может отключить политику, влияющую на вход в систему. 
- Если ни один из администраторов в организации не может обновить политику, необходимо отправить запрос в службу поддержки. Поддержка Майкрософт может просматривать и обновлять политики условного доступа, которые препятствуют доступу.

### <a name="what-happens-if-you-have-policies-in-the-azure-classic-portal-and-azure-portal-configured"></a>Что произойдет, если настроить политики на классическом портале Azure и на портале Azure?  

Azure Active Directory применяет обе политики, и пользователь получает доступ только в том случае, если все требования соблюдены.

### <a name="what-happens-if-you-have-policies-in-the-intune-silverlight-portal-and-the-azure-portal"></a>Что произойдет, если настроить политики на портале Intune Silverlight и портале Azure?

Azure Active Directory применяет обе политики, и пользователь получает доступ только в том случае, если все требования соблюдены.

### <a name="what-happens-if-i-have-multiple-policies-for-the-same-user-configured"></a>Что произойдет, если настроить несколько политик для одного пользователя?  

Во время каждого входа в систему Azure Active Directory оценивает все политики и проверяет соблюдение всех требований, прежде чем предоставить пользователю доступ. Блокирование доступа перекрывает все остальные параметры конфигурации. 

### <a name="does-conditional-access-work-with-exchange-activesync"></a>Работает ли Условный доступ с Exchange ActiveSync?

Да, вы можете использовать Exchange ActiveSync в политике условного доступа.

Некоторые облачные приложения, такие как SharePoint Online и Exchange Online, также поддерживают устаревшие протоколы аутентификации. Когда клиентское приложение может использовать устаревший протокол проверки подлинности для доступа к облачному приложению, Azure AD не может обеспечить выполнение политики условного доступа при этой попытке доступа. Чтобы предотвратить обход применяемых политик клиентским приложением, следует проверить, можно ли включить для затронутых облачных приложений только современную аутентификацию.

### <a name="how-should-you-configure-conditional-access-with-office-365-apps"></a>Как настроить условный доступ с помощью приложений Office 365?

Поскольку приложения Office 365 взаимосвязаны, мы рекомендуем совместно назначать широко используемые приложения при создании политик.

Общие взаимосвязанные приложения включают Microsoft Flow, Microsoft Planner, Microsoft Teams, Office 365 Exchange Online, Office 365 SharePoint Online и Office 365 Yammer.

Это важно для политик, требующих взаимодействия с пользователем, таких как многофакторная аутентификация, когда доступ контролируется в начале сеанса или задачи. В противном случае пользователи не смогут выполнить некоторые задачи в приложении. Например, если для доступа к неуправляемым устройствам требуется многофакторная аутентификация на неуправляемых устройствах, но не по электронной почте, пользователи, работающие в электронной почте, не смогут прикреплять файлы SharePoint к сообщению. Более подробную информацию можно найти в статье ["Какие зависимости службы в условном доступе к каталогу Azure Active Directory?"](service-dependencies.md)

## <a name="what-you-should-avoid-doing"></a>Чего следует избегать

Платформа Conditional Access обеспечивает большую гибкость конфигурации. Тем не менее исключительная гибкость также означает, что во избежание нежелательных результатов необходимо внимательно просмотреть каждую политику конфигурации, прежде чем выпускать ее. В этом контексте следует уделить особое внимание назначениям, которые влияют на полные наборы, такие как **все пользователи / группы / облачные приложения**.

В своей среде следует избегать следующих конфигураций:

**Для всех пользователей, всех облачных приложений:**

- **Блокировка доступа** — эта конфигурация блокирует всю организацию, что явно не является хорошей идеей.
- **Требовать соответствующее требованиям устройство** — для пользователей, которые еще не зарегистрировали свои устройства, эта политика полностью блокирует доступ, включая доступ к порталу Intune. Если вы являетесь администратором без зарегистрированного устройства, то эта политика блокирует ваш доступ к порталу Azure для изменения политики.
- **Require domain join** (Требовать присоединения к домену) — эта политика блокировки доступа также имеет возможность блокировать доступ для всех пользователей организации, у которых еще нет присоединенных к домену устройств.
- **Требуется политика защиты приложений** - Этот доступ к блоку политики также может заблокировать доступ для всех пользователей в вашей организации, если у вас нет политики Intune. Если вы являетесь администратором без клиентского приложения с политикой защиты приложений Intune, эта политика блокирует возвращение на такие порталы, как Intune и Azure.

**Для всех пользователей, всех облачных приложений, всех платформ устройств:**

- **Блокировка доступа** — эта конфигурация блокирует всю организацию, что явно не является хорошей идеей.

## <a name="how-should-you-deploy-a-new-policy"></a>Как развертывать новую политику?

Сначала необходимо оценить политику с помощью [инструмента what if для условного доступа](what-if-tool.md).

Когда новые политики будут готовы для вашей среды, разверните их поэтапно.

1. Примените политику к небольшому набору пользователей и убедитесь, что она правильно работает. 
1. При расширении политики для вмещения большего количества пользователей продолжайте исключать всех администраторов из политики, чтобы гарантировать, что они все еще имеют доступ и могут обновлять политику, если требуется изменение.
1. Применяйте политику ко всем пользователям, только если это действительно необходимо. 

Мы рекомендуем создать учетную запись пользователя, которая:

- предназначена для администрирования политики, 
- исключена из всех политик.

## <a name="policy-migration"></a>Перенос политики

Мы рекомендуем перенести политики, созданные не на портале Azure, по следующим причинам:

- Теперь вы можете работать со сценариями, которые невозможно было обрабатывать ранее.
- Можно уменьшить количество политик, которыми необходимо управлять, объединяя их.   
- Вы можете управлять всеми политиками условного доступа в одном центральном месте.
- Классический портал Azure больше не используется.   

Дополнительные сведения см. в статье [Перенос классических политик на портале Azure](policy-migration.md).

## <a name="next-steps"></a>Дальнейшие действия

Чтобы узнать:

- Как настроить политику условного доступа, [см.](app-based-mfa.md)
- Как спланировать политики условного доступа, см. [Как спланировать развертывание условного доступа в каталоге Active Azure.](plan-conditional-access.md)
