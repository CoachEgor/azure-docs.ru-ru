---
title: Планирование политик условного доступа в Azure Active Directory | Документация Майкрософт
description: Из этой статьи вы узнаете, как планировать политики условного доступа для Azure Active Directory.
services: active-directory
ms.service: active-directory
ms.subservice: conditional-access
ms.topic: conceptual
ms.date: 01/25/2019
ms.author: joflore
author: MicrosoftGuyJFlo
manager: daveba
ms.reviewer: martincoetzer
ms.collection: M365-identity-device-management
ms.openlocfilehash: 266fa2403ef96e808a0c1f1eb46b4f7065c06252
ms.sourcegitcommit: b07964632879a077b10f988aa33fa3907cbaaf0e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/13/2020
ms.locfileid: "77185900"
---
# <a name="how-to-plan-your-conditional-access-deployment-in-azure-active-directory"></a>Руководство. Планирование развертывания условного доступа в Azure Active Directory

Планирование развертывания условного доступа крайне важно, чтобы обеспечить необходимую стратегию доступа для приложений и ресурсов в Организации. Натратьте большую часть времени на этапе планирования развертывания, чтобы спроектировать различные политики, необходимые для предоставления или блокирования доступа к пользователям в соответствии с выбранными условиями. В этом документе описаны действия, которые необходимо выполнить для реализации безопасной и эффективной политики условного доступа. Прежде чем начать, убедитесь, что вы понимаете, как работает [Условный доступ](overview.md) и когда следует его использовать.

## <a name="what-you-should-know"></a>Необходимая информация

Условный доступ можно рассматривать как платформу, которая позволяет управлять доступом к приложениям и ресурсам Организации, а не к отдельным функциям. Следовательно, для некоторых параметров условного доступа требуется настроить дополнительные компоненты. Например, можно настроить политику так, чтобы она реагировала на определенный [уровень риска входа в систему](../identity-protection/howto-identity-protection-configure-risk-policies.md). Но для того, чтобы политика учитывала такой уровень риска, должна быть включена [Защита идентификации Azure Active Directory](../identity-protection/overview-identity-protection.md).

Если применяются дополнительные функции, могут потребоваться лицензии для них. Например, хотя условный доступ Azure AD Premium P1, для защиты идентификации требуется лицензия Azure AD Premium P2.

Существует два типа политик условного доступа: базовый и стандартный. [Базовая политика](baseline-protection.md) — это предопределенная политика условного доступа. Такие политики обеспечивают минимальный (базовый) уровень безопасности. Базовые политики доступны во всех выпусках AAD, но у них ограниченные возможности настройки. Если ваш сценарий требует гибкости, отключите базовую политику и реализуйте свои требования в виде настраиваемой стандартной политики.

В стандартной политике условного доступа можно настроить все параметры, чтобы настроить политику в соответствие с бизнес-требованиями. Для использования стандартных политик требуется лицензия Azure AD Premium P1.

## <a name="draft-policies"></a>Черновые политики

Azure Active Directory условный доступ позволяет перенести защиту облачных приложений на новый уровень. Вы можете определять возможность доступа к облачному приложению на основе динамической оценки, а не жесткой конфигурации. С помощью политики условного доступа вы определяете ответ (**это делается**) в условии доступа (в**этом**случае).

![Причина и ответ](./media/plan-conditional-access/10.png)

Определите все политики условного доступа, которые необходимо реализовать с помощью этой модели планирования. Планирование позволяет выполнить следующие задачи:

- Правильно структурировать ответы и условия для каждой политики.
- Приводится описание хорошо документированного каталога политик условного доступа для вашей организации. 

Этот каталог позволяет оценить, соответствует ли реализация политики реальным бизнес-требованиям вашей организации. 

Используйте следующий пример шаблона для создания политик условного доступа для вашей организации:

|В *этом* случае:|Сделать *это*:|
|-|-|
|Выполняется попытка доступа:<br>— К облачному приложению *<br>— Пользователями и группами*<br>Использует:<br>— Условие 1 (например, за пределами корпоративной сети)<br>— Условие 2 (например, платформы устройств)|Блокировать доступ к приложению|
|Выполняется попытка доступа:<br>— К облачному приложению *<br>— Пользователями и группами*<br>Использует:<br>— Условие 1 (например, за пределами корпоративной сети)<br>— Условие 2 (например, платформы устройств)|Предоставить доступ с ограничениями (условное "И"):<br>— Требование 1 (например, многофакторная проверка подлинности)<br>— Требование 2 (например, соответствие устройств)|
|Выполняется попытка доступа:<br>— К облачному приложению *<br>— Пользователями и группами*<br>Использует:<br>— Условие 1 (например, за пределами корпоративной сети)<br>— Условие 2 (например, платформы устройств)|Предоставить доступ с ограничениями (условное "ИЛИ"):<br>— Требование 1 (например, многофакторная проверка подлинности)<br>— Требование 2 (например, соответствие устройств)|

Раздел **в этом случае** определяет субъект (**кто**), который пытается получить доступ к облачному приложению (**что**). При необходимости здесь можно добавить дополнительные характеристики попытки доступа (**как**). В условном доступе элементы, определяющие, кто, что и как называются условиями. Дополнительные сведения см [. в разделе что такое условия в Azure Active Directory условном доступе?](concept-conditional-access-conditions.md) 

В разделе **сделать это** вы определяете ответ политики на состояние доступа. В этом ответе можно блокировать или предоставить доступ, в том числе с дополнительными требованиями, например с многофакторной проверкой подлинности (MFA). Полный обзор см [. в разделе что такое элементы управления доступом в Azure Active Directory условном доступе?](controls.md)  

Сочетание условий с элементами управления доступом представляет собой политику условного доступа.

![Причина и ответ](./media/plan-conditional-access/51.png)

См. дополнительные сведения о [применении политик](best-practices.md#whats-required-to-make-a-policy-work).

Итак, сейчас самое время выбрать стандарт именования для ваших политик. Стандарт именования позволит быстро находить нужные политики и понимать их назначение, не открывая настройки политики на портале администрирования Azure. Назовите политику для отображения:

- порядковый номер;
- облачное приложение, к которому она применяется;
- Ответ
- к кому она применяется;
- когда применяется (если применима).
 
![Стандарт именования](./media/plan-conditional-access/11.png)

Хотя описательное имя позволяет получить общие сведения о реализации условного доступа, порядковый номер полезен, если необходимо сослаться на политику в диалоге. Например, если вы говорите на телефоне администратора, вы можете попросить его открыть политику EM063, чтобы решить проблему.

Например, следующее имя указывает на то, что эта политика требует применить многофакторную проверку подлинности для пользователей из группы маркетинга, использующих приложение Dynamics CRP в любой внешней сети:

`CA01 - Dynamics CRP: Require MFA For marketing When on external networks`

Кроме активных политик, целесообразно определить некоторые отключенные политики, которые будут служить дополнительным [средством контроля доступа при сбоях или в аварийном режиме](../authentication/concept-resilient-controls.md). Ваш стандарт именования для политик на случай непредвиденных обстоятельств должен включать еще несколько пунктов: 

- `ENABLE IN EMERGENCY` в начале, чтобы выделить имя среди других политик;
- имя нарушения, к которому должна применяться политика;
- порядковый номер, помогающий администратору узнать, какой по счету должна быть включена эта политика. 

Например, следующее имя указывает, что эта политика является первой политикой из четырех, которая должна быть включена при прерывании MFA:

`EM01 - ENABLE IN EMERGENCY, MFA Disruption[1/4] - Exchange SharePoint: Require hybrid Azure AD join For VIP users`

## <a name="plan-policies"></a>Планирование политик

При планировании решения политики условного доступа следует оценить, нужно ли создавать политики для достижения следующих результатов. 

### <a name="block-access"></a>Заблокировать доступ

Действие блокировки доступа — это очень мощный инструмент, который:

- имеет более высокий приоритет, чем любые другие назначения для пользователя;
- позволяет блокировать вход в клиент для всей организации сразу.
 
Если вы намерены заблокировать доступ для всех пользователей, обязательно определите хотя бы одно исключение (обычно это учетные записи для аварийного доступа). См. дополнительные сведения о [выборе пользователей и облачных приложений](block-legacy-authentication.md#select-users-and-cloud-apps).  

### <a name="require-mfa"></a>Требовать многофакторную идентификацию

Чтобы упростить процесс входа пользователей, им можно разрешить выполнять вход в облачные приложения с помощью имени пользователя и пароля. Но чаще всего есть смысл потребовать боле строгую проверку учетной записи хотя бы для некоторых сценариев доступа. С помощью политики условного доступа можно ограничить требования MFA к определенным сценариям. 

Вот несколько вариантов, в которых обычно требуется MFA:

- [вход с правами администратора](howto-baseline-protect-administrators.md);
- [доступ к конкретным приложениям](app-based-mfa.md); 
- [вход из сетевых расположений, которым вы не доверяете](untrusted-networks.md).

### <a name="respond-to-potentially-compromised-accounts"></a>Реагирование на потенциально скомпрометированные учетные записи

С помощью политик условного доступа можно реализовать автоматические ответы на вход от потенциально скомпрометированных удостоверений. Вероятность компрометации учетной записи выражается в виде уровней риска. Служба защиты идентификации вычисляет два уровня риска: риск входа и риск пользователя. Чтобы реализовать ответ на риск входа, вы можете использовать два механизма:

- [Условие риска при входе](concept-conditional-access-conditions.md#sign-in-risk) в политику условного доступа
- [политика риска входа](../identity-protection/howto-sign-in-risk-policy.md) в службе защиты идентификации. 

Мы рекомендуем обрабатывать риск входа как условия, так как это предоставляет больше параметров для настройки.

Уровень риска пользователя доступен только как [политика риска пользователя](../identity-protection/howto-user-risk-policy.md) в Защите идентификации. 

См. дополнительные сведения о [Защите идентификации Azure Active Directory](../identity-protection/overview.md). 

### <a name="require-managed-devices"></a>Требование доступа с управляемых устройств

Широкое разнообразие поддерживаемых устройств для доступа к облачным ресурсам помогает повысить эффективность работы пользователей. С другой стороны, вы наверняка захотите оградить некоторые ресурсы в корпоративной среде от доступа устройств с неизвестным уровнем защиты. Для всех таких ресурсов нужно настроить ограничение, разрешающее доступ только с управляемых устройств. Дополнительные сведения см. [в статье как требовать управляемых устройств для доступа к облачным приложениям с помощью условного доступа](require-managed-devices.md). 

### <a name="require-approved-client-apps"></a>Требование доступа из утвержденных клиентских приложений

В сценариях использования собственных устройств (BYOD) вам нужно как можно раньше решить, нужно ли управлять всем устройством или только данными на нем. Ваши сотрудники используют мобильные устройства для как в личных, так и в рабочих целях. Помимо обеспечения эффективности работы сотрудников требуется предотвратить возможную потерю данных. С помощью условного доступа Azure Active Directory (Azure AD) можно ограничить доступ к облачным приложениям утвержденными клиентскими приложениями, которые могут защищать корпоративные данные. Дополнительные сведения см. [в разделе как требовать утвержденные клиентские приложения для облачного доступа к приложениям с помощью условного доступа](app-based-conditional-access.md).

### <a name="block-legacy-authentication"></a>Блокировка устаревших методов проверки подлинности

AAD поддерживает несколько широко распространенные протоколы проверки подлинности и авторизации, часть из которых уже устарела. Как же запретить доступ к ресурсам клиента всем приложениям, которые используют устаревшую проверку подлинности? Рекомендуется просто заблокировать их с помощью политики условного доступа. Если потребуется, вы сможете разрешить отдельным пользователям использовать конкретные приложения с устаревшей проверкой подлинности из конкретных сетевых расположений. Дополнительные сведения см. в статье [как заблокировать устаревшую проверку подлинности в Azure AD с помощью условного доступа](block-legacy-authentication.md).

## <a name="test-your-policy"></a>Тестирование политики

Прежде, чем развернуть политику в рабочей среде, следует проверить ее и убедиться, что все работает правильно.

1. Создание тестовых пользователей
1. Создание плана тестирования
1. Настройка политики
1. Оценка смоделированного входа
1. Тестирование политики
1. Очистка

### <a name="create-test-users"></a>Создание тестовых пользователей

Чтобы проверить политику, создайте группу пользователей с характеристиками реальных пользователей в рабочей среде. Создав тестовых пользователей, вы убедитесь, что все политики работают правильно, прежде чем применять их к реальным пользователям и создавать риск нарушения доступа к приложениям и ресурсам. 

Некоторые организации используют для таких целей тестовые клиенты. Но воссоздание всех условий и приложений из реальной среды в тестовом клиенте, чтобы полностью протестировать результат применения политики, может оказаться сложной задачей. 

### <a name="create-a-test-plan"></a>Создание плана тестирования

План тестирования нужен для того, чтобы сравнить ожидаемые и фактически полученные результаты. Прежде, чем тестировать любые компоненты, вы должны знать, что вы ожидаете получить. В следующей таблице приведены примеры тестовых случаев. Скорректируйте эти сценарии и ожидаемые результаты с учетом параметров ваших политик условного доступа.

|Политика |Сценарий |Ожидаемый результат | Результат |
|---|---|---|---|
|[Требовать MFA для доступа не с рабочего места](https://docs.microsoft.com/azure/active-directory/conditional-access/untrusted-networks)|Авторизованный пользователь входит в *приложение*, находясь в надежном расположении (на рабочем месте)|Пользователю не нужно выполнять MFA| |
|[Требовать MFA для доступа не с рабочего места](https://docs.microsoft.com/azure/active-directory/conditional-access/untrusted-networks)|Авторизованный пользователь входит в *приложение*, находясь в ненадежном расположении (не на рабочем месте)|Пользователю предлагается выполнить MFA и он может успешно войти| |
|[Требовать MFA для администраторов](https://docs.microsoft.com/azure/active-directory/conditional-access/howto-baseline-protect-administrators)|Глобальный администратор входит в *приложение*|Администратору предлагается выполнить MFA| |
|[Вход, представляющий риск](https://docs.microsoft.com/azure/active-directory/identity-protection/howto-sign-in-risk-policy)|Пользователь входит в *приложение* с помощью [браузера Tor](https://docs.microsoft.com/azure/active-directory/active-directory-identityprotection-playbook)|Администратору предлагается выполнить MFA| |
|[Управление устройствами](https://docs.microsoft.com/azure/active-directory/conditional-access/require-managed-devices)|Авторизованный пользователь пытается войти с авторизованного устройства|Предоставляется доступ| |
|[Управление устройствами](https://docs.microsoft.com/azure/active-directory/conditional-access/require-managed-devices)|Авторизованный пользователь пытается войти с неавторизованного устройства|Доступ блокируется| |
|[Изменение пароля для пользователей с высоким уровнем риска](https://docs.microsoft.com/azure/active-directory/identity-protection/howto-user-risk-policy)|Авторизованный пользователь пытается войти с использованием скомпрометированных учетных данных (высокий риск входа)|В соответствии с политикой пользователю предлагается изменить пароль, иначе доступ блокируется| |

### <a name="configure-the-policy"></a>Настройка политики

Управление политиками условного доступа осуществляется вручную. В портал Azure вы можете управлять политиками условного доступа в одном централизованном расположении — на странице условного доступа. Одной из точек входа на страницу условного доступа является раздел **Безопасность** в области навигации **Active Directory** . 

![Условный доступ](media/plan-conditional-access/03.png)

Дополнительные сведения о создании политик условного доступа см. в статье [запрос MFA для конкретных приложений с Azure Active Directory условным доступом](app-based-mfa.md). Это краткое руководство поможет вам:

- ознакомиться с пользовательским интерфейсом;
- Получите первое впечатление от принципа работы условного доступа. 

### <a name="evaluate-a-simulated-sign-in"></a>Оценка смоделированного входа

Теперь, когда вы настроили политику условного доступа, вероятно, вы захотите узнать, работает ли она так, как ожидалось. В качестве первого шага используйте инструмент [What If для политик условного доступа](what-if-tool.md), чтобы смоделировать вход тестового пользователя. При имитации оценивается влияние входа на политики и создается отчет об имитации.

>[!NOTE]
> В то время как имитация запуска позволяет получить впечатление от влияния политики условного доступа, она не заменяет фактическое выполнение теста.

### <a name="test-your-policy"></a>Тестирование политики

Выполните тестовые случаи, включенные в план тестирования. На этом шаге вы выполните полное тестирование для каждой политики с тестовыми пользователями, чтобы убедиться в правильности работы всех политик. Используйте созданные выше сценарии для выполнения каждого теста.

Здесь важно убедиться, что вы правильно проверяете определенные в политике критерии исключения. Предположим, что вы исключили пользователя или группу из политики, которая требует использовать MFA. Проверьте, запрашивает ли Исключенные пользователи запрос MFA, так как сочетание других политик может потребовать MFA для этих пользователей.

### <a name="cleanup"></a>Очистка

Процедура очистки состоит из следующих шагов:

1. Отключение политики.
1. Удаление всех назначенных пользователей и групп.
1. Удаление тестовых пользователей.  

## <a name="move-to-production"></a>Перенос в рабочую среду

Когда новые политики будут готовы для вашей среды, разверните их поэтапно.

- Проинформируйте пользователей об изменениях.
- Для начала примените политику к небольшой группе пользователей и убедитесь, что она правильно работает.
- Развертывая политику для остальных пользователей, временно исключите из нее всех администраторов. Исключение администраторов из политики позволит сохранить доступ на случай, если потребуются изменения этой политики.
- Применяйте политику ко всем пользователям, только если это действительно необходимо.

Мы рекомендуем создать хотя бы одну учетную запись пользователя, которая:

- предназначена для администрирования политики,
- исключена из всех политик.

## <a name="rollback-steps"></a>Процедура отката

Если потребуется выполнить откат для только что примененной политики, попробуйте одно или несколько из следующих действий:

1. **Отключите политику**. Отключение политики гарантирует, что она не применяется при попытке пользователя выполнить вход. Вы всегда можете вернуться и включить политику, когда потребуется ее использовать.

   ![Отключение политики](media/plan-conditional-access/07.png)

1. **Исключите пользователя или группу из политики**. Если пользователь не может получить доступ к приложению, попробуйте исключить его из политики.

   ![Исключение пользователей](media/plan-conditional-access/08.png)

   > [!NOTE]
   > Этот вариант следует применять ограниченно и только к тем пользователям, которым вы доверяете. Пользователь или группа должны быть добавлены обратно в политику, как только это станет возможным.

1. **Удалите политику**. Если политика больше не требуется, удалите ее.

## <a name="next-steps"></a>Следующие шаги

См. дополнительные сведения об с [условном доступе AAD](index.yml).
