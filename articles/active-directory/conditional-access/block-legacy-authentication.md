---
title: Блокировка устаревшей аутентификации - Активный каталог Azure
description: Узнайте, как улучшить свою безопасность, заблокировав устаревшую аутентификацию с помощью Azure AD Conditional Access.
services: active-directory
ms.service: active-directory
ms.subservice: conditional-access
ms.topic: conceptual
ms.date: 03/31/2020
ms.author: joflore
author: MicrosoftGuyJFlo
manager: daveba
ms.reviewer: calebb, dawoo
ms.collection: M365-identity-device-management
ms.openlocfilehash: 957aa77e18ea8f910f258d1dc59de0d093b0eab6
ms.sourcegitcommit: efefce53f1b75e5d90e27d3fd3719e146983a780
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/01/2020
ms.locfileid: "80476656"
---
# <a name="how-to-block-legacy-authentication-to-azure-ad-with-conditional-access"></a>Как: Блокировать устаревшую аутентификацию в Azure AD с помощью условного доступа   

Чтобы предоставить пользователям удобный доступ к облачным приложениям, Azure Active Directory (AAD) поддерживает широкий набор протоколов проверки подлинности, часть из которых уже устарела. Однако устаревшие протоколы не поддерживают многофакторную аутентификацию (MFA). Во многих средах MFA является стандартным методом защиты от кражи идентификаторов. 

Алекс Вайнерт (Alex Weinert), директор по безопасности идентификации корпорации Майкрософт, в своем блоге от 12 марта 2020 года [«Новые инструменты для блокирования устаревшей аутентификации в вашей организации](https://techcommunity.microsoft.com/t5/azure-active-directory-identity/new-tools-to-block-legacy-authentication-in-your-organization/ba-p/1225302#) подчеркивают, почему организации должны блокировать устаревшую аутентификацию и какие дополнительные инструменты предоставляет корпорация Майкрософт для выполнения этой задачи:

> Чтобы МИД был эффективным, необходимо также блокировать устаревшую аутентификацию. Это потому, что устаревшие протоколы аутентификации, такие как POP, SMTP, IMAP и MAPI, не могут обеспечить соблюдение МИД, что делает их предпочтительными точками входа для противников, нападающих на вашу организацию...
> 
>... Цифры по устаревшей аутентификации, полученные в результате анализа трафика Azure Active Directory (Azure AD), являются резкими:
> 
> - Более 99 процентов атак спрей паролей используют устаревшие протоколы аутентификации
> - Более 97 процентов атак на начинку учетных данных используют устаревшую аутентификацию
> - Учетные записи Azure AD в организациях, отключивших устаревшую аутентификацию, на 67% меньше компромиссов, чем те, где включена унаследовательная аутентификация
>

Если ваша среда готова блокировать устаревшую аутентификацию для улучшения защиты клиента, вы можете достичь этой цели с помощью условия доступа. В этой статье объясняется, как можно настроить политики условного доступа, которые блокируют устаревшую аутентификацию для вашего клиента.

## <a name="prerequisites"></a>Предварительные требования

В данной статье предполагается, что вы знакомы с: 

- [Основные концепции](overview.md) условного доступа Azure AD 
- [Лучшие методы](best-practices.md) настройки политик условного доступа на портале Azure

## <a name="scenario-description"></a>Описание сценария

AAD поддерживает несколько широко распространенные протоколы проверки подлинности и авторизации, часть из которых уже устарела. Устаревшими считаются все протоколы, которые используют обычную проверку подлинности. Эти протоколы обычно не поддерживают какие-либо методы двухфакторной идентификации. Вот несколько примеров приложений, которые используют устаревшую проверку подлинности:

- устаревшие приложения Microsoft Office;
- любые приложения, поддерживающие почтовые протоколы POP, IMAP и SMTP.

В наше время одного фактора аутентификации (например, имени пользователя и пароля) уже недостаточно. Пароли работают плохо, так как их можно легко угадать, и люди не умеют выбирать правильные пароли. Пароли очень уязвимы к нескольким видам атак, таких как фишинг и подбор. Одним из простейших методов защиты от компрометации паролей является многофакторная проверка подлинности. При наличии многофакторной проверки подлинности злоумышленник не сможет пройти аутентификацию и получить доступ к данным, даже если получит пароль пользователя в свое распоряжение.

Как же запретить доступ к ресурсам клиента всем приложениям, которые используют устаревшую проверку подлинности? Рекомендация состоит в том, чтобы просто заблокировать их с помощью политики условного доступа. Если потребуется, вы сможете разрешить отдельным пользователям использовать конкретные приложения с устаревшей проверкой подлинности из конкретных сетевых расположений.

Политики условного доступа применяются после того, как пользователь прошел однофакторную аутентификацию. Поэтому условный доступ не может предотвратить атаки типа "отказ в обслуживании" (DoS). Но этот механизм может использовать сигналы, поступающие от этих событий (например, уровень риска при входе, расположение запроса и т. д.), для определения доступа.

## <a name="implementation"></a>Реализация

В этом разделе объясняется, как настроить политику условного доступа для блокировки устаревшей аутентификации. 

### <a name="legacy-authentication-protocols"></a>Устаревшие протоколы аутентификации

Следующие варианты считаются устаревшими протоколами аутентификации

- Аутентифицированный SMTP - Используется клиентом POP и IMAP для отправки сообщений электронной почты.
- Autodiscover - Используется клиентами Outlook и EAS для поиска и подключения к почтовым ящикам в Exchange Online.
- Exchange Online PowerShell - Используется для подключения к Exchange Online с удаленным PowerShell. Если вы блокируете базовую аутентификацию для Exchange Online PowerShell, вам необходимо использовать модуль Exchange Online PowerShell для подключения. Для получения инструкций [см. Подключитесь к Exchange Online PowerShell с помощью многофакторной аутентификации.](/powershell/exchange/exchange-online/connect-to-exchange-online-powershell/mfa-connect-to-exchange-online-powershell)
- Exchange Web Services (EWS) - интерфейс программирования, используемый Outlook, Outlook для Mac и сторонними приложениями.
- IMAP4 - Используется клиентами электронной почты IMAP.
- MAPI над HTTP (MAPI/HTTP) - Используется Outlook 2010 и позже.
- Offline Address Book (OAB) - копия коллекций адресного списка, которые загружаются и используются Outlook.
- Outlook Anywhere (RPC over HTTP) - Используется Outlook 2016 и ранее.
- Outlook Service - Используется приложением "Почта" и "Календарь" для Windows 10.
- POP3 - Используется клиентами электронной почты POP.
- Отчетность веб-служб - Используется для получения данных отчета в Exchange Online.
- Другие клиенты - Другие протоколы, идентифицированные как использование устаревшей аутентификации.

Более подробную информацию об этих протоколах и службах проверки подлинности можно узнать на [портале Active Directory Azure.](../reports-monitoring/concept-sign-ins.md#filter-sign-in-activities)

### <a name="identify-legacy-authentication-use"></a>Определение устаревшего использования аутентификации

Прежде чем вы сможете заблокировать устаревшую аутентификацию в каталоге, необходимо сначала понять, есть ли у пользователей приложения, которые используют устаревшую аутентификацию, и как она влияет на общий каталог. Для понимания того, используете ли вы устаревшую аутентификацию, можно использовать журналы входа в систему Azure AD.

1. Перейдите на **портал** > Azure**Active Directory** > **Ins.**
1. Добавьте столбец приложения Клиента, если оно не отображается, нажав на **колонки** > **Клиентское приложение.**
1. **Добавьте фильтры** > **Client App** > выберите все устаревшие протоколы аутентификации и нажмите **Apply.**

Фильтрация будет отображать только попытки входной, сделанные устаревшими протоколами аутентификации. Нажатие на каждую индивидуальную попытку входного в ввешания покажет вам дополнительные детали. Поле **приложения Клиента** под вкладкой Basic **Info** будет указывать, какой устаревший протокол проверки подлинности был использован.

Эти журналы будут указывать, какие пользователи по-прежнему в зависимости от устаревшей аутентификации и какие приложения используют устаревшие протоколы для запросов на аутентификацию. Для пользователей, которые не отображаются в этих журналах и подтверждены не использовать устаревшую аутентификацию, реализуйте политику условного доступа только для этих пользователей.

### <a name="block-legacy-authentication"></a>Блокировка устаревших методов проверки подлинности 

В политике условного доступа можно установить условие, привязанное к клиентским приложениям, которые используются для доступа к вашим ресурсам. Условие клиентских приложений позволяет сузить область действия приложений с помощью устаревшей аутентификации, выбрав **клиентов Exchange ActiveSync** и **других клиентов** под **мобильными приложениями и настольными клиентами.**

![Другие клиенты](./media/block-legacy-authentication/01.png)

Чтобы заблокировать доступ для этих приложений, выберите действие **Заблокировать доступ**.

![Заблокировать доступ](./media/block-legacy-authentication/02.png)

### <a name="select-users-and-cloud-apps"></a>Выбор пользователей и облачных приложений

Возможно, вы хотите заблокировать устаревшую проверку подлинности в вашей организации, выбрав следующие параметры:

- все пользователи
- Все облачные приложения
- Заблокировать доступ

![Назначения](./media/block-legacy-authentication/03.png)

У Azure есть функция безопасности, которая не позволяет создавать такую политику, поскольку эта конфигурация нарушает [рекомендации](best-practices.md) для политик условного доступа.
 
![Неподдерживаемая политика конфигурации](./media/block-legacy-authentication/04.png)

Такая защита нужна потому, что политика *блокировать всех пользователей и все облачные приложения* потенциально может запретить доступ к клиенту всей организации. Минимальные рекомендации требуют исключить из области действия политики хотя бы одного пользователя. Можно также исключить роль каталога.

![Неподдерживаемая политика конфигурации](./media/block-legacy-authentication/05.png)

Чтобы выполнить требования этой защитной функции, исключите из политики одного пользователя. В идеале у вас должно быть несколько [административных учетных записей AAD для аварийного доступа](../users-groups-roles/directory-emergency-access.md), для которых настроены исключения из этой политики.

Использование [режима только отчетов](concept-conditional-access-report-only.md) при включении политики в блокировку устаревшей аутентификации дает организации возможность отслеживать влияние политики.

## <a name="policy-deployment"></a>Развертывание политики

Прежде чем включить эту политику в рабочей среде, обдумайте и учтите следующие аспекты.
 
- **Учетные записи служб**. Определите, какие учетные записи пользователей используются в качестве учетных записей служб или устройств, например настроены на телефонах в конференц-зале. Создайте для этих учетных записей надежные пароли и добавьте их в группу исключений.
- **Отчеты о входах**. Просмотрите отчеты о входах и проверьте трафик от **других клиентов**. Определите, какие из них используются чаще всего и по каким причинам. Чаще всего такой трафик создается старыми клиентами Office, которые не используют современную проверку подлинности, или почтовыми приложениями сторонних производителей. Составьте план отказа от всех этих приложений, а если они не очень важны для работы, просто известите пользователей о том, что они больше не смогут использовать эти приложения.
 
Дополнительные сведения см. в разделе [Как развертывать новую политику?](best-practices.md#how-should-you-deploy-a-new-policy).

## <a name="what-you-should-know"></a>Необходимая информация

Блокирование доступа с помощью **других клиентов** также блокирует Exchange Online PowerShell и Dynamics 365 с помощью базового auth.

Если задать для политики параметр **Другие клиенты**, доступ из определенных клиентов, например SPConnect, заблокируется для всей организации. Эта блокировка выполняется, так как клиенты предыдущих версий выполняют аутентификацию непредвиденным образом. Эта проблема не касается основных приложений Office, таких как клиенты Office прежних версий.

Чтобы политика вступила в силу, может потребоваться до 24 часов.

Вы можете выбрать все доступные средства управления грантами для состояния **Других клиентов;** однако, опыт конечных пользователей всегда одинаков - заблокированный доступ.

Если вы блокируете устаревшую аутентификацию с помощью условия **других клиентов,** можно также установить платформу устройства и состояние местоположения. Например, если вы только хотите заблокировать устаревшую аутентификацию для мобильных устройств, задайте условие **платформ устройств**, выбрав:

- Android
- iOS
- Windows Phone

![Неподдерживаемая политика конфигурации](./media/block-legacy-authentication/06.png)

## <a name="next-steps"></a>Следующие шаги

- [Определение воздействия с помощью режима отчета об условном доступе](howto-conditional-access-report-only.md)
- Если вы еще не знакомы с настройкой политик [require MFA for specific apps with Azure Active Directory Conditional Access](app-based-mfa.md) условного доступа, см.
- Для получения дополнительной информации о современной поддержке аутентификации [см. Как работает современная аутентификация для клиентских приложений Office 2013 и Office 2016](/office365/enterprise/modern-auth-for-office-2013-and-2016) 
