---
title: Синхронизация удостоверений и устойчивость повторяющихся атрибутов | Документация Майкрософт
description: Из этой статьи вы узнаете о новом поведении, которое имеет место при обработке объектов, содержащих конфликты имени участника-пользователя или ProxyAddress, во время синхронизации каталогов с Azure AD Connect.
services: active-directory
documentationcenter: ''
author: billmath
manager: daveba
editor: ''
ms.assetid: 537a92b7-7a84-4c89-88b0-9bce0eacd931
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 01/15/2018
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: 5585f0cd04dca4145f0322db9d625e35372b24b5
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "78298349"
---
# <a name="identity-synchronization-and-duplicate-attribute-resiliency"></a>Синхронизация удостоверений и устойчивость повторяющихся атрибутов
Дублирование атрибутики — это функция в Active Directory Azure, которая устранит трение, вызванное конфликтами **UserPrincipalName** и SMTP **ProxyAddress** при запуске одного из инструментов синхронизации Microsoft.

Эти два атрибута обычно должны быть уникальными для всех объектов **Пользователь**, **Группа** и **Контакт** в заданном клиенте Azure Active Directory.

> [!NOTE]
> Только пользователи могут иметь имена участников-пользователей (UPN).
> 
> 

Новое поведение, которое обеспечивает этот компонент, применяется в облачной части конвейера синхронизации. Поэтому оно не зависит от клиента и может применяться к любому продукту корпорации Майкрософт, включая Azure AD Connect, DirSync и MIM + соединитель. В этом документе универсальный термин "клиент синхронизации" означает любой из этих продуктов.

## <a name="current-behavior"></a>Текущее поведение
При попытке подготовить новый объект с помощью значения UPN или ProxyAddress, которое нарушает ограничение уникальности, Azure Active Directory блокирует создание этого объекта. Если объект обновляется с помощью неуникальных значений UPN или ProxyAddress, обновление не удается выполнить Клиент синхронизации повторяет попытку подготовки или обновления после каждого цикла экспорта, но эта попытка завершается сбоем, пока конфликт не устраняется. После каждой попытки клиент синхронизации создает сообщение электронной почты с отчетом об ошибке и регистрирует ошибку в журнале.

## <a name="behavior-with-duplicate-attribute-resiliency"></a>Поведение с устойчивостью повторяющихся атрибутов
Azure Active Directory не завершает сбоем подготовку или обновление объекта с повторяющимся атрибутом. Вместо этого Azure Active Directory "помещает на карантин" повторяющийся атрибут, который нарушает ограничение уникальности. Если этот атрибут необходим для подготовки, как, например UserPrincipalName, служба назначает значение заполнителя. Формат этих временных значений следующий:  
OriginalPrefix>_**4DigitNumber \@ \<\<>InitialTenantDomain>.onmicrosoft.com . \<**_

Процесс устойчивости атрибутов обрабатывает только значения UPN и SMTP **ProxyAddress.**

Если атрибут не обязателен (например, **ProxyAddress**), то Azure Active Directory просто помещает конфликтующий атрибут в карантин и приступает к созданию или обновлению объекта.

После помещения атрибута на карантин сведения о конфликте отправляются в том же сообщении электронной почты с отчетом об ошибке, которое использовалось в старом поведении. Но эта информация отображается в отчете об ошибке только один раз, когда атрибут помещается на карантин. Она не записывается в будущие сообщения электронной почты. Кроме того, так как данный объект успешно экспортирован, клиент синхронизации не регистрирует ошибку и не повторяет операцию создания или обновления после следующих циклов синхронизации.

Для поддержки этого поведения в классы объектов "Пользователь", "Группа" и "Контакт" добавлен новый атрибут —   
**DirSyncProvisioningErrors**

Это многозначный атрибут, используемый для хранения конфликтующих атрибутов, которые нарушают ограничение уникальности, если добавляются как обычно. В Azure Active Directory включена фоновая задача таймера, которая запускается каждый час. Эта задача ищет разрешенные конфликты повторяющихся атрибутов и автоматически удаляет такие атрибуты из карантина.

### <a name="enabling-duplicate-attribute-resiliency"></a>Включение устойчивости повторяющихся атрибутов
Устойчивость повторяющихся атрибутов будет новым режимом по умолчанию для всем клиентов Azure Active Directory. Этот режим будет включен по умолчанию для всех клиентов, для которых синхронизация была включена впервые 22 августа 2016 года или позже. Клиенты, для которых синхронизация была включена до этой даты, смогут включить данный режим с помощью выпускаемых пакетов. Выпуск начнется в сентябре 2016 года, и каждое контактное лицо по техническим вопросам клиента получит уведомление по электронной почте, в котором будет указана дата, когда эта функция будет включена.

> [!NOTE]
> После включения режим устойчивости повторяющихся атрибутов невозможно отключить.

Чтобы проверить, включена ли эта функция для вашего клиента, можно скачать последнюю версию модуля PowerShell для Azure Active Directory и выполнив следующие командлеты.

`Get-MsolDirSyncFeatures -Feature DuplicateUPNResiliency`

`Get-MsolDirSyncFeatures -Feature DuplicateProxyAddressResiliency`

> [!NOTE]
> С помощью командлета Set-MsolDirSyncFeature больше нельзя упреждающе включать функцию "Устойчивость повторяющихся атрибутов", прежде чем она будет включена для вашего клиента. Чтобы протестировать эту функцию, необходимо создать клиент Azure Active Directory.

## <a name="identifying-objects-with-dirsyncprovisioningerrors"></a>Идентификация объектов с DirSyncProvisioningErrors
В настоящее время существует два метода идентификации объектов, которые имеют эти ошибки из-за дублирующих конфликтов свойств, Azure Active Directory PowerShell и [центр админирования Microsoft 365.](https://admin.microsoft.com) В будущем планируется добавить к этим средствам создание отчетов на портале.

### <a name="azure-active-directory-powershell"></a>PowerShell Azure Active Directory
Для командлетов PowerShell, упомянутых в этой статье, верны следующие утверждения:

* все командлеты вводятся с учетом регистра;
* Необходимо всегда указывать флаг **-ErrorCategory PropertyConflict** . Других типов **ErrorCategory**сейчас нет, но они могут быть добавлены в будущем.

Для начала выполните командлет **Connect-MsolService** и введите учетные данные администратора клиента.

Затем используйте следующие командлеты и операторы для просмотра ошибок разными способами.

1. [Посмотреть все](#see-all)
2. [По типу свойства](#by-property-type)
3. [По конфликтующей ценности](#by-conflicting-value)
4. [Использование строки поиска](#using-a-string-search)
5. Сортированные.
6. [В ограниченном количестве или во всех](#in-a-limited-quantity-or-all)

#### <a name="see-all"></a>Смотреть все
Чтобы просмотреть общий список ошибок подготовки атрибутов в клиенте, после подключения запустите следующий командлет.

`Get-MsolDirSyncProvisioningError -ErrorCategory PropertyConflict`

Вы получите результат, похожий на приведенный ниже.  
 ![Get-MsolDirSyncProvisioningError](./media/how-to-connect-syncservice-duplicate-attribute-resiliency/1.png "Get-MsolDirSyncProvisioningError")  

#### <a name="by-property-type"></a>По типу свойства.
Чтобы просмотреть ошибки по типу свойства, добавьте флаг **-PropertyName** с аргументом **UserPrincipalName** или **ProxyAddresses**.

`Get-MsolDirSyncProvisioningError -ErrorCategory PropertyConflict -PropertyName UserPrincipalName`

либо

`Get-MsolDirSyncProvisioningError -ErrorCategory PropertyConflict -PropertyName ProxyAddresses`

#### <a name="by-conflicting-value"></a>По конфликтующему значению.
Чтобы просмотреть ошибки, относящиеся к конкретному свойству, добавьте флаг **-PropertyValue** (при добавлении этого флага следует использовать также атрибут **-PropertyName**).

`Get-MsolDirSyncProvisioningError -ErrorCategory PropertyConflict -PropertyValue User@domain.com -PropertyName UserPrincipalName`

#### <a name="using-a-string-search"></a>С помощью поиска по строкам.
Чтобы выполнить поиск по всем строкам, добавьте флаг **-SearchString** . Этот флаг можно использовать отдельно от всех флагов, упомянутых выше, за исключением флага **-ErrorCategory PropertyConflict**, который необходимо использовать всегда.

`Get-MsolDirSyncProvisioningError -ErrorCategory PropertyConflict -SearchString User`

#### <a name="in-a-limited-quantity-or-all"></a>В ограниченном количестве или все.
1. **>\<MaxResults Int** можно использовать для ограничения запроса определенным количеством значений.
2. **All** гарантирует получение всех результатов в случае большого количества ошибок.

`Get-MsolDirSyncProvisioningError -ErrorCategory PropertyConflict -MaxResults 5`

## <a name="microsoft-365-admin-center"></a>Центр администрирования Microsoft 365
Ошибки синхронизации каталогов можно просмотреть в центре админирования Microsoft 365. Отчет в центре админ-сообщения Microsoft 365 отображает только объекты **пользователей,** которые имеют эти ошибки. Этот отчет не содержит сведений о конфликтах между такими объектами, как **Группы** и **Контакты**.

![Активные пользователи](./media/how-to-connect-syncservice-duplicate-attribute-resiliency/1234.png "Активные пользователи")

Для получения инструкций о том, как просматривать ошибки синхронизации каталогов в центре админизации Microsoft 365, [см.](https://support.office.com/article/Identify-directory-synchronization-errors-in-Office-365-b4fc07a5-97ea-4ca6-9692-108acab74067)

### <a name="identity-synchronization-error-report"></a>Отчет об ошибках синхронизации удостоверений
Когда объект с конфликтом повторяющихся атрибутов обрабатывается с помощью нового поведения, в электронное письмо, содержащее стандартный отчет об ошибках синхронизации удостоверений, добавляется уведомление. Это письмо отправляется контакту клиента, предназначенному для технических уведомлений. Но в этом поведении есть важные изменения. Раньше сведения о конфликте повторяющихся атрибутов включались в каждый отчет об ошибках до тех пор, пока конфликт не разрешался. После включения нового поведения уведомление об ошибке, связанное с тем или иным конфликтом, отображается только один раз: когда конфликтующий атрибут помещается на карантин.

Вот как выглядит уведомление электронной почты о конфликте ProxyAddress:   
    ![Активные пользователи](./media/how-to-connect-syncservice-duplicate-attribute-resiliency/6.png "Активные пользователи")  

## <a name="resolving-conflicts"></a>Разрешение конфликтов
Стратегия устранения неполадок и методика разрешения этих ошибок не должны отличаться от того, как ошибки повторяющихся атрибутов обрабатывались раньше. Единственное различие заключается в том, что задача таймера переходит через клиент на стороне службы и автоматически добавляет спорный атрибут в правильный объект после разрешения конфликта.

Различные стратегии устранения неполадок и разрешения конфликтов описаны в статье [Duplicate or invalid attributes prevent directory synchronization in Office 365](https://support.microsoft.com/kb/2647098)(Повторяющиеся или недопустимые атрибуты препятствуют синхронизации каталогов в Office 365).

## <a name="known-issues"></a>Известные проблемы
Ни одна из известных проблем не приводит к потере данных или снижению производительности службы. Некоторые из них касаются внешнего вида, другие приводят к стандартным ошибкам повторяющихся атрибутов, *которые возникали до включения режима устойчивости* (эти ошибки отображаются вместо помещения в карантин конфликтующих атрибутов). Некоторые проблемы вызывают определенные ошибки, которые требуется дополнительно устранять вручную.

**Основное поведение**

1. Объекты с определенными конфигурациями атрибутов по-прежнему вызывают ошибки экспорта вместо помещения в карантин повторяющихся атрибутов.  
   Пример:
   
    а. Новый пользователь создается в AD с UPN **\@Джо contoso.com** и ProxyAddress **smtp:Joe\@contoso.com**
   
    b. Свойства этого объекта противоречат существующей группе, где ProxyAddress является **\@SMTP:Joe contoso.com**.
   
    c. После экспорта отображается ошибка о **конфликте ProxyAddress** , при этом конфликтующие атрибуты не помещаются на карантин. Операция повторяется после каждого цикла синхронизации, как это и происходило до включения компонента устойчивости.
2. Если локально создаются две группы с одним и тем же адресом SMTP, то одну группу не удается подготовить с первой попытки из-за стандартной ошибки повторяющихся значений **ProxyAddress** . Но на следующем цикле синхронизации повторяющиеся значения будут правильно помещены на карантин.

**Отчет на портале Office**

1. Подробное сообщение об ошибке для двух объектов в конфликте, связанном с именем UPN, содержит одинаковые сведения. Это означает, что свойство UPN обоих объектов изменено или помещено на карантин, но на самом деле данные изменились только в одном объекте.
2. Подробное сообщение об ошибке, связанное с конфликтом UPN, показывает неправильное свойство displayName пользователя, имя UPN которого изменено или помещено на карантин. Пример:
   
    а. **Пользователь A** синхронизируется первым с **UPN\@и contoso.com пользователя**.
   
    b. **Пользователь B** пытается быть синхронизированы рядом с **UPN\@- пользователь contoso.com**.
   
    c. **Пользователь B's** UPN изменен на **User1234\@contoso.onmicrosoft.com** и **contoso.com пользователей\@** добавляется в **DirSyncProvisioningErrors.**
   
    d. Сообщение об ошибке для **пользователя B** должно указывать, что **пользователь A** уже имеет contoso.com **пользователя\@** как UPN, но он показывает собственное displayName **пользователя B.**

**Отчет об ошибках синхронизации удостоверений**.

Ссылка на *указания по устранению этой проблемы* неправильная.  
    ![Активные пользователи](./media/how-to-connect-syncservice-duplicate-attribute-resiliency/6.png "Активные пользователи")  

Он должен [https://aka.ms/duplicateattributeresiliency](https://aka.ms/duplicateattributeresiliency)указать на .

## <a name="see-also"></a>См. также
* [Синхронизация azure AD Connect](how-to-connect-sync-whatis.md)
* [Интеграция локальных удостоверений с Azure Active Directory.](whatis-hybrid-identity.md)
* [Определение ошибок синхронизации службы каталогов в Office 365](https://support.office.com/article/Identify-directory-synchronization-errors-in-Office-365-b4fc07a5-97ea-4ca6-9692-108acab74067)

