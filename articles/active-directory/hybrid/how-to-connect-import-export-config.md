---
title: Импорт и экспорт параметров конфигурации Azure AD Connect
description: В этом документе приведены часто задаваемые вопросы о подготовке облака.
services: active-directory
author: billmath
manager: daveba
ms.service: active-directory
ms.workload: identity
ms.topic: how-to
ms.date: 06/25/2020
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: a13236294f74bbe4bdaf8c1a30408afad09d9796
ms.sourcegitcommit: f844603f2f7900a64291c2253f79b6d65fcbbb0c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/10/2020
ms.locfileid: "86225330"
---
# <a name="importing-and-exporting-azure-ad-connect-configuration-settings-public-preview"></a>Импорт и экспорт параметров конфигурации Azure AD Connect (общедоступная Предварительная версия) 

Azure AD Connect развертывания отличаются от установки одного леса в режиме экспресс-развертывания для сложных развертываний, синхронизируемых в нескольких лесах с помощью настраиваемых правил синхронизации. Из-за большого количества параметров и механизмов конфигурации важно понимать, какие параметры действуют и могут быстро развернуть сервер с идентичной конфигурацией. Эта функция предоставляет возможность каталогизации конфигурации данного сервера синхронизации и импорта параметров в новое развертывание. Можно сравнивать разные моментальные снимки параметров синхронизации, чтобы легко визуализировать различия между двумя серверами или одним сервером с течением времени. 

Каждый раз, когда конфигурация изменяется с помощью мастера Azure AD Connect, новый файл параметров JSON с отметкой времени автоматически экспортируется в **%ProgramData%\AADConnect**. Имя файла параметров относится к формату " **синчронизатионполици-*". JSON** , где последняя часть имени файла является меткой времени. 

>[!IMPORTANT]
> Автоматически экспортируются только изменения, внесенные Azure AD Connect. Любые изменения, внесенные с помощью PowerShell, Synchronization Service Manager или редактора правил синхронизации, необходимо экспортировать по требованию, чтобы поддерживать актуальное копирование. Экспорт по запросу также можно использовать для размещения копии параметров в безопасном месте для аварийного восстановления. 

## <a name="exporting-azure-ad-connect-settings"></a>Экспорт параметров Azure AD Connect 

Чтобы просмотреть сводку параметров конфигурации, откройте средство Azure AD Connect и выберите дополнительную задачу с именем: Просмотр или экспорт текущей конфигурации. Кроме того, в нем отображается краткая сводка параметров, а также возможность экспорта полной конфигурации сервера. 

По умолчанию параметры будут экспортированы в **%ProgramData%\AADConnect**, однако можно сохранить параметры в защищенном расположении, чтобы обеспечить доступность в случае аварии. Параметры экспортируются с использованием формата JSON и не должны создаваться или редактироваться для обеспечения логической согласованности. Импорт созданного или измененного файла не поддерживается и может привести к непредвиденным результатам. 

## <a name="importing-azure-ad-connect-settings"></a>Импорт параметров Azure AD Connect 

Чтобы импортировать ранее экспортированные параметры, выполните следующие действия.
 
1. Установите **Azure AD Connect** на новом сервере. 
2. Выберите параметр **настроить** после страницы **приветствия** . 
3. Щелкните **Импорт параметров синхронизации**. Найдите ранее экспортированный файл параметров JSON.  
4. Щелкните **Установить**.

![Установка компонентов](media/how-to-connect-import-export-config/import1.png)

> [!NOTE]
> Переопределите параметры на этой странице, например использование SQL Server вместо LocalDB или использование существующей учетной записи службы вместо VSA по умолчанию и т. д. Эти параметры не импортируются из файла параметров конфигурации, но существуют для получения сведений и сравнения.

### <a name="import-installation-experience"></a>Импорт процесса установки 

Процесс установки импорта намеренно сохраняется с минимальными входными данными пользователя, что позволяет легко предоставить воспроизводимость существующего сервера.  

Ниже приведены единственные изменения, которые могут быть сделаны во время установки. Все остальные изменения могут быть сделаны после установки с помощью мастера Azure AD Connect. 
- **Учетные данные Azure Active Directory**   — имя учетной записи для глобального администратора Azure, используемого для настройки исходного сервера, предлагается по умолчанию и **должно**   быть изменено, если требуется синхронизировать данные с новым каталогом.
- **Вход пользователя**   — Параметры входа, настроенные для исходного сервера, выбираются по умолчанию и автоматически запрашивают учетные данные или другие сведения, необходимые во время настройки. В редких случаях может потребоваться настроить сервер с разными параметрами, чтобы избежать изменения поведения активного сервера. В противном случае просто нажмите кнопку "Далее", чтобы использовать те же параметры. 
- **Учетные данные**   локального каталога — для каждого локального каталога, включенного в параметры синхронизации, необходимо предоставить учетные данные для создания учетной записи синхронизации или предоставить предварительно созданную настраиваемую учетную запись синхронизации. Эта процедура идентична процедуре чистой установки с исключением, которое не позволяет добавлять или удалять каталоги. 
- **Параметры конфигурации**   — как и при чистой установке, можно настроить начальные параметры для запуска автоматической синхронизации или включения промежуточного режима. Основное отличие состоит в том, что промежуточный режим намеренно включен по умолчанию, чтобы обеспечить сравнение конфигурации и результатов синхронизации до активного экспорта результатов в Azure. 

![Подключение каталогов](media/how-to-connect-import-export-config/import2.png)

>[!NOTE]
>Только один сервер синхронизации может находиться в первичной роли и активно экспортирует изменения конфигурации в Azure. Все остальные серверы должны быть переведены в промежуточный режим. 

## <a name="migrating-settings-from-an-existing-server"></a>Перенос параметров с существующего сервера 

Если существующий сервер не поддерживает управление параметрами, то можно либо обновить сервер на месте, либо перенести параметры для использования на новом промежуточном сервере.  

Для миграции требуется запустить сценарий PowerShell, который извлекает существующие параметры для использования в новой установке.Этот метод рекомендуется использовать для каталогизации параметров существующего сервера, а затем применить их к вновь установленному промежуточному серверу.Сравнение параметров исходного сервера с вновь созданным сервером позволит быстро визуализировать изменения между серверами.Как всегда, следуйте процедуре сертификации организации, чтобы не требовалось никаких дополнительных настроек.  

### <a name="migration-process"></a>Процесс миграции 
Чтобы перенести параметры, выполните следующие действия.

1. Откройте cmd с правами администратора на новом промежуточном сервере.
2. Извлеките **AzureADConnect.msi** , выполнив следующую команду: `msiexec /a msifile/qb TARGETDIR=targetpath` где **мсифиле** — это адрес MSI, а **TargetPath** — каталог, в который нужно извлечь файлы.
   
   Пример: `msiexec /a "C:\Holding\AzureADConnect.msi" TARGETDIR="C:\extractedfiles"`
3. Скопируйте **MigrateSettings.ps1** из каталога Microsoft Azure AD коннект\тулс в расположение на существующем сервере.  Например, К:\сетуп.  Где программа установки — это каталог, созданный на существующем сервере. 
![Подключение каталогов](media/how-to-connect-import-export-config/migrate1.png)

4. Запустите скрипт, как показано ниже, и сохраните весь каталог конфигурации сервера нижнего уровня. Скопируйте этот каталог на новый промежуточный сервер. Обратите внимание, что все **экспортированные папки-серверконфигуратион-*** нужно скопировать на новый сервер. 
 ![Подключение каталогов](media/how-to-connect-import-export-config/migrate2.png)

 ![Подключение каталогов](media/how-to-connect-import-export-config/migrate3.png)

5. Запустите **Azure AD Connect** , дважды щелкнув значок на рабочем столе. Принять условия лицензионного соглашения на следующей странице нажмите кнопку " **настроить** ". 
6. Установите флажок **импортировать параметры синхронизации** и нажмите кнопку **Обзор** , чтобы перейти к папке, скопированной через exportd-серверконфигуратион-*, и выберите MigratedPolicy.js, чтобы импортировать перенесенные параметры.
 ![Подключение каталогов](media/how-to-connect-import-export-config/migrate4.png)

7. Чтобы сравнить перенесенные параметры с примененными параметрами, найдите последнюю версию **мигрировавшего-синчронизатионполици-*. JSON** и **применено-синчронизатионполици-*. JSON** (* — метка времени) в разделе **%ProgramData%\AADConnect**. Используйте предпочтительное средство сравнения файлов для сравнения четности. 

## <a name="post-installation-verification"></a>Проверка после установки 

Сравнение первоначально импортированного файла параметров с экспортированным файлом параметров для вновь развернутого сервера — важный шаг в понимании различий между предполагаемым и итоговым развертыванием. Используя любимое приложение для сравнения текста, можно получить мгновенное представление, в котором быстро выделяются все необходимые или случайные изменения. Несмотря на то что многие действия по настройке, описанные выше, теперь устранены, вы по-прежнему должны следовать процессу сертификации организации, чтобы не требовать дополнительной настройки. Такая конфигурация может возникать, если вы используете дополнительные параметры, которые в настоящее время не записываются в общедоступной предварительной версии управления параметрами. 

К известным ограничениям относятся следующие. 
- **Правила синхронизации**   — приоритет для настраиваемого правила должен быть в зарезервированном диапазоне 0-99, чтобы избежать конфликтов с стандартными правилами Майкрософт. Размещение настраиваемого правила за пределами зарезервированного диапазона может привести к тому, что пользовательское правило переместится по мере добавления к конфигурации стандартных правил. Аналогичная ошибка возникает, если конфигурация содержит измененные стандартные правила. Изменение стандартного правила настоятельно не рекомендуется, и размещение правил, скорее всего, будет неправильным. Обратная запись устройств. Эти параметры будут включены в каталог, но в настоящее время они не применяются во время настройки. Если функция обратной записи устройств была включена для исходного сервера, необходимо вручную настроить эту функцию на развернутом сервере. 
- **Синхронизированные типы объектов**   — Хотя можно ограничить список синхронизированных типов объектов (пользователей, контактов, групп и т. д.) с помощью Synchronization Service Manager, эта функция сейчас не поддерживается с помощью параметров синхронизации. После завершения установки необходимо вручную применить расширенную конфигурацию. 
- **Настраиваемые профили выполнения**   — Хотя можно изменить набор профилей выполнения по умолчанию с помощью Synchronization Service Manager, эта функция сейчас не поддерживается с помощью параметров синхронизации. После завершения установки необходимо вручную применить расширенную конфигурацию. 
- **Настройка иерархии подготовки**   — Эта расширенная функция Synchronization Service Manager не поддерживается через параметры синхронизации и должна быть вручную перенастроена после завершения первоначального развертывания. 
- **Проверка Подлинности**   AD FS и PingFederate — методы входа, связанные с этими функциями проверки подлинности, будут предварительно выбраны автоматически, однако необходимо указать все остальные необходимые параметры конфигурации в интерактивном режиме. 

 ## <a name="next-steps"></a>Next Steps

- [Оборудование и предварительные требования](how-to-connect-install-prerequisites.md) 
- [Параметры Express](how-to-connect-install-express.md)
- [Настраиваемые параметры](how-to-connect-install-custom.md)
- [Установка агентов Azure AD Connect Health](how-to-connect-health-agent-install.md) 
