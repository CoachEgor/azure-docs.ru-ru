---
title: 'Azure AD Connect выполняет следующие функции: Простой единый вход — как это работает | Документация Майкрософт'
description: В этой статье описывается принцип работы функции простого единого входа в Azure Active Directory.
services: active-directory
keywords: что такое Azure AD Connect, установка Active Directory, необходимые компоненты для Azure AD, единый вход
documentationcenter: ''
author: billmath
manager: daveba
ms.assetid: 9f994aca-6088-40f5-b2cc-c753a4f41da7
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 04/16/2019
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: 907abe3b09f9999b30703281f7e4ff286e2bae14
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60242362"
---
# <a name="azure-active-directory-seamless-single-sign-on-technical-deep-dive"></a>Простой единый вход Azure Active Directory: Подробное техническое руководство

В этой статье приводятся технические сведения о работе функции простого единого входа Azure Active Directory.

## <a name="how-does-seamless-sso-work"></a>Как работает простой единый вход?

Этот раздел состоит из трех частей.

1. Настройка функции простого единого входа.
2. Как транзакция единого входа пользователя в веб-браузере работает с простым единым входом.
3. Как транзакция единого входа пользователя в собственном клиенте работает с простым единым входом.

### <a name="how-does-set-up-work"></a>Как выполняется настройка?

Простой единый вход включается с помощью Azure AD Connect, как показано [здесь](how-to-connect-sso-quick-start.md). При включении функции выполняются следующие действия:

- Учетной записи компьютера (`AZUREADSSOACC`) создается в вашей локальной Active Directory (AD) в каждом лесу AD, который синхронизируется с Azure AD (с помощью Azure AD Connect).
- Кроме того для использования во время процесса входа в Azure AD создаются несколько имен участников службы Kerberos (SPN).
- С помощью Azure AD безопасным образом предоставляется ключ расшифровки Kerberos учетной записи компьютера. При наличии нескольких лесов AD, каждая учетная запись компьютера будет иметь свой собственный уникальный ключ расшифровки Kerberos.

>[!IMPORTANT]
> `AZUREADSSOACC` Учетная запись компьютера должна быть обеспечены надежной защитой по соображениям безопасности. Управление учетной записью компьютера можно только "Администраторы домена". Убедитесь, делегирование Kerberos в учетной записи компьютера была отключена, а не другой учетной записи в Active Directory имеет разрешения на делегирование `AZUREADSSOACC` учетная запись компьютера... Store учетной записи компьютера в подразделение (OU), где они безопасны от случайных удалений и только администраторы домена имеют доступ. Ключ расшифровки Kerberos учетной записи компьютера, также должны рассматриваться как конфиденциальные. Настоятельно рекомендуется, чтобы вы [меняли ключ расшифровки Kerberos](how-to-connect-sso-faq.md#how-can-i-roll-over-the-kerberos-decryption-key-of-the-azureadssoacc-computer-account) для учетной записи компьютера `AZUREADSSOACC` хотя бы раз в 30 дней.

После завершения настройки функция простого входа в Azure AD работает так же, как любая другая функция входа, использующая встроенную проверку подлинности Windows (IWA).

### <a name="how-does-sign-in-on-a-web-browser-with-seamless-sso-work"></a>Как работает вход с функцией простого единого входа в веб-браузере?

Процесс входа в веб-браузере выглядит следующим образом.

1. Пользователь пытается получить доступ к веб-приложению (например, веб-приложению Outlook — https://outlook.office365.com/owa/) с корпоративного устройства, присоединенного к домену, в корпоративной сети.
2. Если пользователь еще не выполнил вход, он перенаправляется на страницу входа в Azure AD.
3. Пользователь вводит свое имя на странице входа в Azure AD.

   >[!NOTE]
   >Для [некоторых приложений](./how-to-connect-sso-faq.md#what-applications-take-advantage-of-domain_hint-or-login_hint-parameter-capability-of-seamless-sso) шаги 2 и 3 пропускаются.

4. С помощью JavaScript, выполняемого в фоновом режиме, Azure AD запрашивает у браузера билет Kerberos (возвращается ответ 401 — не авторизовано).
5. В свою очередь браузер запрашивает в Active Directory билет для учетной записи компьютера `AZUREADSSOACC` (которая представляет Azure AD).
6. Active Directory находит учетную запись компьютера и возвращает браузеру билет Kerberos, зашифрованный с использованием секрета этой учетной записи компьютера.
7. Браузер пересылает билет Kerberos, полученный от Active Directory, в Azure AD.
8. Azure AD расшифровывает билет Kerberos, который содержит удостоверение пользователя, выполнившего вход в корпоративное устройство, с помощью полученного ранее общего ключа.
9. После анализа Azure AD либо возвращает маркер приложению, либо предлагает пользователю выполнить дополнительную проверку, например многофакторную проверку подлинности.
10. При успешном входе в систему пользователь может получить доступ к приложению.

На схеме ниже показаны все соответствующие компоненты и шаги.

![Простой единый вход: процедура для веб-приложения](./media/how-to-connect-sso-how-it-works/sso2.png)

Простой единый вход — ситуативно-обусловленная функция. Это означает, что если в ней происходит сбой, процедура входа выполняется стандартно, то есть пользователь, как и прежде, должен просто ввести пароль для входа.

### <a name="how-does-sign-in-on-a-native-client-with-seamless-sso-work"></a>Как работает вход с функцией простого единого входа в собственном клиенте?

Процесс входа в собственном клиенте выглядит следующим образом.

1. Пользователь пытается получить доступ к собственному приложению (например, клиенту Outlook) с корпоративного устройства, присоединенного к домену, в корпоративной сети.
2. Если пользователь еще не выполнил вход, то собственное приложение получает его имя пользователя из сеанса Windows на устройстве.
3. Приложение отправляет это имя пользователя в Azure AD и получает конечную точку MEX WS-Trust клиента. Конечная точка WS-Trust используется только функцией простого единого входа и не является общей реализацией протокола WS-Trust в Azure AD.
4. Затем приложение отправляет запрос к конечной точке MEX WS-Trust, чтобы определить, доступна интегрированная конечная точка аутентификации. Интегрированная конечная точка аутентификации используется только функцией простого единого входа.
5. Если шаг 4 завершается успешно, то выдается запрос защиты Kerberos.
6. Если приложению удалось получить билет Kerberos, оно пересылает его на интегрированную конечную точку аутентификации Azure AD.
7. Служба Azure AD расшифровывает билет Kerberos и проверяет его.
8. Azure AD выполняет вход пользователя и выдает токен SAML для приложения.
9. Приложение отправляет токен SAML на конечную точку маркера OAuth 2 Azure AD.
10. Azure AD проверяет токен SAML и выдает приложению маркер доступа и маркер обновления для указанного ресурса, а также маркер идентификации.
11. Пользователь получает доступ к ресурсу приложения.

На схеме ниже показаны все соответствующие компоненты и шаги.

![Простой единый вход: процедура для собственного приложения](./media/how-to-connect-sso-how-it-works/sso14.png)

## <a name="next-steps"></a>Дальнейшие действия

- [**Краткое руководство**](how-to-connect-sso-quick-start.md). Настройка и подготовка к работе простого единого входа Azure AD.
- [**Часто задаваемые вопросы**](how-to-connect-sso-faq.md). Ответы на часто задаваемые вопросы.
- [**Устранение неполадок**](tshoot-connect-sso.md). Узнайте, как устранить самые распространенные проблемы с этой функцией.
- [**UserVoice**](https://feedback.azure.com/forums/169401-azure-active-directory/category/160611-directory-synchronization-aad-connect). Отправка запросов новых функций.
