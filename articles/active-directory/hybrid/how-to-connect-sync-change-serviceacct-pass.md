---
title: 'Синхронизация azure AD Connect: Изменение учетной записи службы ADSync Документы Майкрософт'
description: В этой статье описывается назначение ключа шифрования и его прерывание после изменения пароля.
services: active-directory
keywords: учетная запись службы синхронизации Azure AD, пароль
documentationcenter: ''
author: billmath
manager: daveba
editor: ''
ms.assetid: 76b19162-8b16-4960-9e22-bd64e6675ecc
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 05/02/2019
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: 077671ab4e964d7641aa3a0f0b435b39117eb6aa
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "65139392"
---
# <a name="changing-the-adsync-service-account-password"></a>Изменение пароля учетной записи службы ADSync
Если вы измените пароль учетной записи службы ADSync, служба синхронизации не сможет начать правильно, пока вы не откажетесь от ключа шифрования и не перезапустите пароль учетной записи службы ADSync. 

Azure AD Connect, как часть служб синхронизации использует ключ шифрования для хранения паролей учетной записи AD DS Connector и учетной записи службы ADSync.  Эти учетные записи шифруются перед сохранением в базе данных. 

Используемый ключ шифрования защищается с помощью [защиты данных Windows (DPAPI)](https://msdn.microsoft.com/library/ms995355.aspx). DPAPI защищает ключ шифрования с помощью **учетной записи службы ADSync.** 

Если вам нужно изменить пароль учетной записи службы, вы можете использовать процедуры при [отказе от ключа шифрования учетной записи службы ADSync](#abandoning-the-adsync-service-account-encryption-key) для достижения этой цели.  Эти процедуры вам пригодятся и в том случае, когда по какой-либо причине вам понадобится сбросить ключ шифрования.

## <a name="issues-that-arise-from-changing-the-password"></a>Проблемы, которые возникают из-за смены пароля
Есть две вещи, которые необходимо выполнить при изменении пароля учетной записи службы.

Во-первых, нужно изменить пароль в диспетчере управления службами Windows.  Пока вы не устраните эту проблему, будут появляться следующие ошибки.


- Если попытаться запустить службу синхронизации, в диспетчере управления службами Windows возникает ошибка "**Windows не может запустить службу синхронизации Microsoft Azure AD на локальном компьютере**". **Ошибка 1069. Служба не запущена из-за ошибки входа в систему**".
- В средстве просмотра событий Windows журнал системных событий содержит ошибку **с идентификатором 7038** и текстом сообщения "**Служба ADSync не может войти в систему с текущим паролем из-за следующей ошибки: неверное указано имя пользователя или пароль**".

Во-вторых, при некоторых условиях служба синхронизации после изменения пароля не может получить ключ шифрования через DPAPI. Без ключа шифрования служба синхронизации не может расшифровать пароли, необходимые для синхронизации между локальным экземпляром AD и Azure AD.
Вы этом случае вы увидите такие ошибки.

- В соответствии с менеджером управления службой Windows, если вы попытаетесь запустить службу синхронизации и она не сможет получить ключ шифрования, она не справляется с ошибкой "<strong>Windows не может запустить синхронизацию Microsoft Azure AD на локальном компьютере. Для получения дополнительной информации просмотрите журнал событий системы. Если это служба, не относясь к Microsoft, свяжитесь с поставщиком услуг и обратитесь к коду ошибки по конкретному сервису -21451857952"</strong>
- В журнале событий Windows В windows Находится ошибка с **Event ID 6028** и сообщениеобоб ошибки *"Ключ шифрования сервера не доступен".*

Чтобы убедиться, что вы не получите эти ошибки, следуйте процедурам [отказа от ключа шифрования учетной записи службы ADSync](#abandoning-the-adsync-service-account-encryption-key) при изменении пароля.
 
## <a name="abandoning-the-adsync-service-account-encryption-key"></a>Отказ от ключа шифрования учетной записи службы ADSync
>[!IMPORTANT]
>Следующие процедуры применимы только к Azure AD Connect с номером сборки 1.1.443.0 или более ранних версий.

Используйте следующие процедуры для сброса ключа шифрования.

### <a name="what-to-do-if-you-need-to-abandon-the-encryption-key"></a>Что делать, если нужно сбросить ключ шифрования

Вот как можно сбросить ключ шифрования.

1. [Остановка работы службы синхронизации](#stop-the-synchronization-service)

1. [Сброс существующего ключа шифрования](#abandon-the-existing-encryption-key)

2. [Предоставить пароль учетной записи AD DS Connector](#provide-the-password-of-the-ad-ds-connector-account)

3. [Репарализовать пароль учетной записи службы ADSync](#reinitialize-the-password-of-the-adsync-service-account)

4. [Запуск службы синхронизации](#start-the-synchronization-service)

#### <a name="stop-the-synchronization-service"></a>Остановка работы службы синхронизации
Вы можете остановить службу в диспетчере управления службами Windows.  Но при этом убедитесь, что служба не запущена.  Если служба запущена, дождитесь завершения работы и остановите ее.


1. Перейдите к диспетчеру управления службами Windows ("Пуск" → "Службы").
2. Выберите **службу синхронизации Microsoft Azure AD** и нажмите кнопку "Остановить".

#### <a name="abandon-the-existing-encryption-key"></a>Сброс существующего ключа шифрования
Чтобы создать новый ключ шифрования, нужно сначала сбросить существующий ключ шифрования.

1. Войти в свой AD-сервер Azure в качестве администратора.

2. Запустите сеанс PowerShell.

3. Перейдите в папку `$env:Program Files\Microsoft Azure AD Sync\bin\`.

4. Выполните команду `./miiskmu.exe /a`.

![Служебная программа для ключа шифрования в службе синхронизации Azure AD Connect](./media/how-to-connect-sync-change-serviceacct-pass/key5.png)

#### <a name="provide-the-password-of-the-ad-ds-connector-account"></a>Предоставить пароль учетной записи AD DS Connector
Поскольку существующие пароли, хранящиеся в базе данных, больше не могут быть расшифрованы, необходимо предоставить службе синхронизации пароль учетной записи AD DS Connector. Служба синхронизации зашифрует пароли, с помощью нового ключа шифрования.

1. Запустите Synchronization Service Manager ("Запуск" → "Служба синхронизации").
</br>![Диспетчер службы синхронизации](./media/how-to-connect-sync-change-serviceacct-pass/startmenu.png)  
2. Перейдите на вкладку **Соединители**.
3. Выберите **соединитель AD**, соответствующий локальному экземпляру AD. Если у вас несколько соединителей AD, выполните перечисленные ниже шаги для каждого из них.
4. Под **действием**, выберите **Свойства**.
5. Во всплывающем диалоговом окне выберите **Подключиться к лесу Active Directory**.
6. В текстовом поле **Пароль** введите новый пароль для учетной записи AD DS. Если вы не знаете этот пароль, измените его на известное значение перед выполнением этого шага.
7. Нажмите кнопку **ОК**, чтобы сохранить новый пароль и закрыть всплывающее диалоговое окно.
![Служебная программа для ключа шифрования в службе синхронизации Azure AD Connect](./media/how-to-connect-sync-change-serviceacct-pass/key6.png)

#### <a name="reinitialize-the-password-of-the-adsync-service-account"></a>Репарализовать пароль учетной записи службы ADSync
Пароль учетной записи службы Azure AD нельзя напрямую передать в службу синхронизации. Вместо этого нужно использовать командлет **Add-ADSyncAADServiceAccount** для повторной инициализации учетной записи службы Azure AD. Этот командлет сбрасывает пароль учетной записи и передает его в службу синхронизации.

1. Запустите новый сеанс PowerShell на сервере Azure AD Connect.
2. Выполните командлет `Add-ADSyncAADServiceAccount`.
3. Во всплывающем диалоговом окне введите учетные данные глобального администратора Azure AD, действующие для вашего клиента Azure AD.
![Служебная программа для ключа шифрования в службе синхронизации Azure AD Connect](./media/how-to-connect-sync-change-serviceacct-pass/key7.png)
4. Если все пройдет успешно, вы увидите командную строку PowerShell.

#### <a name="start-the-synchronization-service"></a>Запуск службы синхронизации
Теперь, когда служба синхронизации получила доступ к ключу шифрования и всем нужным паролям, вы можете перезапустить службы с помощью диспетчера управления службами Windows.


1. Перейдите к диспетчеру управления службами Windows ("Пуск" → "Службы").
2. Выберите **службу синхронизации Microsoft Azure AD** и нажмите кнопку "Перезапустить".

## <a name="next-steps"></a>Дальнейшие действия
**Обзорные статьи**

* [Службы синхронизации Azure AD Connect: общие сведений о синхронизации и ее настройка](how-to-connect-sync-whatis.md)

* [Интеграция локальных удостоверений с Azure Active Directory.](whatis-hybrid-identity.md)
