---
title: Настройка групповых утверждений для приложений с Azure Active Directory | Документация Майкрософт
description: Сведения о том, как настроить утверждения группы для использования с Azure AD.
services: active-directory
documentationcenter: ''
ms.reviewer: paulgarn
manager: daveba
ms.subservice: hybrid
ms.service: active-directory
ms.workload: identity
ms.topic: article
ms.date: 02/27/2019
ms.author: billmath
author: billmath
ms.openlocfilehash: 3cb53656adb1dbeb5e5597d02edfe5be4dbec6a8
ms.sourcegitcommit: f2771ec28b7d2d937eef81223980da8ea1a6a531
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/20/2019
ms.locfileid: "71170491"
---
# <a name="configure-group-claims-for-applications-with-azure-active-directory-public-preview"></a>Настройка групповых утверждений для приложений с Azure Active Directory (общедоступная Предварительная версия)

Azure Active Directory могут предоставить сведения о членстве в группах пользователей в маркерах для использования в приложениях.  Поддерживаются два основных шаблона:

- Группы, определяемые по атрибуту "идентификатор объекта Azure Active Directory (в общем доступе)"
- Группы, определяемые атрибутами sAMAccountName или Граупсид для синхронизированных групп и пользователей Active Directory (AD) (общедоступная Предварительная версия)

> [!IMPORTANT]
> Существует ряд предостережений, которые следует учитывать при работе с этой предварительной версией:
>
>- Поддержка использования атрибутов sAMAccountName и идентификатора безопасности (SID), синхронизированных из локальной среды, предназначена для перемещения существующих приложений из AD FS и других поставщиков удостоверений. Группы, управляемые в Azure AD, не содержат атрибуты, необходимые для выпуска этих утверждений.
>- В крупных организациях число групп, членом которых является пользователь, может превысить ограничение, Azure Active Directory будет добавляться в маркер. 150. группы для токена SAML и 200 для JWT. Это может привести к непредсказуемым результатам. Если это потенциальная проблема, мы рекомендуем тестировать и при необходимости подождать, пока мы добавим усовершенствования, позволяющие ограничить заявки соответствующими группами для приложения.  
>- При разработке новых приложений или в случаях, когда приложение может быть настроено для этого, а также когда поддержка вложенных групп не требуется, рекомендуется, чтобы авторизация в приложении основывалась на ролях приложений, а не на группах.  Это ограничивает объем информации, которую необходимо переключиться на маркер, является более безопасным и отделяет назначение пользователей от конфигурации приложения.

## <a name="group-claims-for-applications-migrating-from-ad-fs-and-other-identity-providers"></a>Групповые утверждения для приложений, выполняющих миграцию с AD FS и других поставщиков удостоверений

Многие приложения, настроенные для проверки подлинности с AD FS, используют сведения о членстве в группах в форме атрибутов группы Windows AD.   Эти атрибуты представляют собой значение sAMAccountName группы, которое может быть дополнено именем домена или идентификатором безопасности группы Windows (Граупсид).  Если приложение объединено с AD FS, AD FS использует функцию Токенграупс для получения членства в группах для пользователя.

Чтобы сопоставить маркер, полученный приложением от AD FS, утверждения группы и роли могут быть переданы с указанием доменных sAMAccountName, а не Azure Active Directory objectID группы.

Поддерживаемые форматы для утверждения группы:

- **ObjectID группы Azure Active Directory** (Доступно для всех групп)
- **SamAccountName** (Доступно для групп, синхронизированных из Active Directory)
- **Нетбиосдомаин\самаккаунтнаме** (Доступно для групп, синхронизированных из Active Directory)
- **Днсдомаиннаме\самаккаунтнаме** (Доступно для групп, синхронизированных из Active Directory)
- **Идентификатор безопасности локальной группы** (Доступно для групп, синхронизированных из Active Directory)

> [!NOTE]
> атрибуты идентификатора безопасности sAMAccountName и on локальной группы доступны только для объектов группы, синхронизированных из Active Directory.   Они недоступны в группах, созданных в Azure Active Directory или Office 365.   Приложения, настроенные в Azure Active Directory для получения синхронизированных атрибутов локальной группы, получают их только для синхронизированных групп.

## <a name="options-for-applications-to-consume-group-information"></a>Параметры для использования сведений о группе в приложениях

Одним из способов получения сведений о группе в приложениях является вызов конечной точки групп графов для получения членства в группе для пользователя, прошедшего проверку подлинности. Этот вызов гарантирует, что все группы, членом которых является пользователь, будут доступны даже при большом количестве групп и приложению необходимо перечислить все группы, в которые входит пользователь.  Затем перечисление групп не зависит от ограничений размера маркера.

Однако если существующее приложение уже планирует использовать сведения о группе с помощью утверждений в полученном маркере, Azure Active Directory можно настроить с помощью ряда различных вариантов заявок в соответствии с потребностями приложения.  Можно воспользоваться следующими вариантами:

- При использовании членства в группах в целях авторизации в приложении предпочтительнее использовать группу ObjectID, которая является неизменяемой и уникальной в Azure Active Directory и доступна для всех групп.
- Если для авторизации используется локальная группа sAMAccountName, используйте полные имена доменов;  существует меньше шансов, что иногда возникает конфликт имен. значение sAMAccountName может быть уникальным в домене Active Directory, но если несколько Active Directory домена синхронизированы с клиентом Azure Active Directory, существует вероятность, что несколько групп будут иметь одно и то же имя.
- Рассмотрите возможность использования [ролей приложения](../../active-directory/develop/howto-add-app-roles-in-azure-ad-apps.md) для обеспечения уровня косвенного обращения между членством в группе и приложением.   Затем приложение выполняет внутренние решения по авторизации на основе роли Кламс в маркере.
- Если приложение настроено для получения атрибутов группы, которые синхронизируются из Active Directory и группа не содержит этих атрибутов, она не будет включаться в утверждения.
- Групповые утверждения в маркерах включают вложенные группы.   Если пользователь является членом Граупб, а Граупб является членом группы a, то утверждения группы для пользователя будут содержать как группы a, так и Граупб. Для организаций с высокой интенсивностью использования вложенных групп и пользователей с большим числом членств в группах количество групп, перечисленных в маркере, может увеличить размер маркера.   Azure Active Directory ограничивает количество групп, которое будет выдаваться в токене, в 150 для утверждений SAML, а 200 для JWT — для предотвращения слишком большого размера маркеров.  Если пользователь является членом большего количества групп, чем это ограничение, группы создаются вместе со ссылкой на конечную точку Graph для получения сведений о группе.

> Необходимые условия для использования атрибутов группы, синхронизированных из Active Directory:   Группы должны быть синхронизированы из Active Directory с помощью Azure AD Connect.

Настройка Azure Active Directory для создания имен групп для Active Directory групп состоит из двух этапов.

1. **Синхронизация имен групп из Active Directory** Прежде чем Azure Active Directory может выдать имена групп или идентификатор безопасности локальной группы в утверждениях группы или роли, необходимо синхронизировать необходимые атрибуты из Active Directory.  Необходимо запустить Azure AD Connect версии 1.2.70 или более поздней.   До версии 1.2.70 Azure AD Connect синхронизирует объекты групп из Active Directory, но не включает обязательные атрибуты имени группы по умолчанию.  Необходимо выполнить обновление до текущей версии.

2. **Настройка регистрации приложения в Azure Active Directory для включения групповых утверждений в токенах** Утверждения группы можно настроить либо в разделе корпоративные приложения на портале для коллекции, либо в приложении SAML SSO без коллекции, либо с помощью манифеста приложения в разделе регистрации приложений.  Сведения о настройке групповых утверждений в манифесте приложения см. в разделе "Настройка регистрации приложения Azure Active Directory для атрибутов группы" ниже.

## <a name="configure-group-claims-for-saml-applications-using-sso-configuration"></a>Настройка групповых утверждений для приложений SAML с помощью конфигурации единого входа

Чтобы настроить утверждения группы для приложения SAML коллекции или не коллекции, откройте корпоративные приложения, щелкните приложение в списке и выберите Конфигурация единого входа.

Щелкните значок редактирования рядом с пунктом "группы, возвращенные в токене".

![Пользовательский интерфейс утверждений](media/how-to-connect-fed-group-claims/group-claims-ui-1.png)

Использование переключателей для выбора групп, которые должны быть добавлены в маркер

![Пользовательский интерфейс утверждений](media/how-to-connect-fed-group-claims/group-claims-ui-2.png)

| Выделение | Описание |
|----------|-------------|
| **Все группы** | Выдает группы безопасности и списки рассылки.   Это также приводит к тому, что роли каталога, назначенные пользователю, будут выдаваться в утверждении "видс", а все роли приложений, назначенные пользователю, будут выдаваться в заявке ролей. |
| **Группы безопасности** | Создает группы безопасности, членом которых является пользователь в утверждении групп |
| **Списки рассылки** | Выдает списки рассылки, членом которых является пользователь |
| **Роли каталога** | Если пользователю назначаются роли каталога, они выдаются как утверждение "видс" (утверждение групп не будет выдаваться). |

Например, чтобы выдать всех групп безопасности, членом которых является пользователь, выберите группы безопасности.

![Пользовательский интерфейс утверждений](media/how-to-connect-fed-group-claims/group-claims-ui-3.png)

Чтобы выдать группы с использованием Active Directoryных атрибутов, синхронизированных из Active Directory вместо идентификаторов objectID Azure AD выберите нужный формат в раскрывающемся списке.  Идентификатор объекта в заявках будет заменен строковыми значениями, содержащими имена групп.   В утверждениях будут включаться только группы, синхронизированные из Active Directory.

![Пользовательский интерфейс утверждений](media/how-to-connect-fed-group-claims/group-claims-ui-4.png)

### <a name="advanced-options"></a>Дополнительные параметры

Способ выдачи заявок на группы можно изменить с помощью параметров в разделе Дополнительные параметры.

Настройте имя утверждения группы:  Если этот флажок установлен, для групповых утверждений можно указать другой тип утверждения.   Введите тип утверждения в поле имя и необязательное пространство имен для утверждения в поле пространство имен.

![Пользовательский интерфейс утверждений](media/how-to-connect-fed-group-claims/group-claims-ui-5.png)

Для некоторых приложений требуется, чтобы сведения о членстве в группе отображались в утверждении Role. При необходимости можно создать группы пользователей в качестве ролей, установив флажок "выдавать группы в утверждениях ролей".

![Пользовательский интерфейс утверждений](media/how-to-connect-fed-group-claims/group-claims-ui-6.png)

> [!NOTE]
> Если используется параметр для отправки данных группы в качестве ролей, в заявке роли будут отображаться только группы.  Любые роли приложений, назначенные пользователю, не будут отображаться в заявке роли.

## <a name="configure-the-azure-ad-application-registration-for-group-attributes"></a>Настройка регистрации приложения Azure AD для атрибутов группы

Утверждения группы также можно настроить в разделе [необязательные утверждения](../../active-directory/develop/active-directory-optional-claims.md) [манифеста приложения](../../active-directory/develop/reference-app-manifest.md).

1. На портале > Регистрация приложения Azure Active Directory > — > выберите манифест приложения->.

2. Включение утверждений о членстве в группах путем изменения Граупмембершипклаим

   Допустимые значения:

   - Каждого
   - SecurityGroup
   - "Дистрибутионлист"
   - DirectoryRole

   Пример:

   ```json
   "groupMembershipClaims": "SecurityGroup"
   ```

   По умолчанию группы ObjectID будут выдаваться в значении утверждения группы.  Чтобы изменить значение утверждения в соответствии с атрибутами локальной группы или изменить тип утверждения на Role, используйте конфигурацию OptionalClaims следующим образом:

3. Задайте необязательные утверждения для конфигурации имени группы.

   Если требуется, чтобы группы в токене содержали атрибуты on локальной группы AD в разделе необязательные утверждения, укажите, к какому типу токена следует применить обязательное утверждение, имя запрошенного необязательного утверждения и дополнительные свойства.  В списке можно указать несколько типов токенов:

   - idToken для токена идентификатора OIDC
   - accessToken для маркера доступа OAuth/OIDC
   - Saml2Token для токенов SAML.

   > [!NOTE]
   > Тип Saml2Token применяется к маркерам формата SAML 1.1 и SAML 2.0.

   Для каждого соответствующего типа токена измените утверждение групп, чтобы в манифесте использовался раздел OptionalClaims. Схема OptionalClaims выглядит следующим образом:

   ```json
   {
   "name": "groups",
   "source": null,
   "essential": false,
   "additionalProperties": []
   }
   ```

   | Схема необязательных утверждений | Значение |
   |----------|-------------|
   | **безымян** | Должно быть "groups" |
   | **источника** | Не используется. Опустить или укажите значение null |
   | **очень** | Не используется. Опустить или укажите значение false |
   | **AdditionalProperties** | Список дополнительных свойств.  Допустимые значения: "sam_account_name", "dns_domain_and_sam_account_name", "netbios_domain_and_sam_account_name", "emit_as_roles" |

   В additionalProperties требуется только один из "sam_account_name", "dns_domain_and_sam_account_name", "netbios_domain_and_sam_account_name".  Если указано более одного, используется первый, а остальные игнорируются.

   Некоторые приложения занимают сведения о группе пользователя в утверждении роли.  Чтобы изменить тип утверждения с утверждения группы на утверждение роли, добавьте "emit_as_roles" в дополнительные свойства.  Значения группы будут выдаваться в заявке роли.

   > [!NOTE]
   > Если используется "emit_as_roles", все роли приложения, настроенные для назначения пользователя, не будут отображаться в заявке роли

### <a name="examples"></a>Примеры

Выдавать группы в виде имен групп в маркерах доступа OAuth в формате Днсдомаиннаме\самаккаунтнаме

```json
"optionalClaims": {
    "accessToken": [{
        "name": "groups",
        "additionalProperties": ["dns_domain_and_sam_account_name"]
    }]
}
 ```

Чтобы выдать имена групп, возвращаемых в формате Нетбиосдомаин\самаккаунтнаме, в качестве утверждения ролей в маркерах ИДЕНТИФИКАТОРов SAML и OIDC:

```json
"optionalClaims": {
    "saml2Token": [{
        "name": "groups",
        "additionalProperties": ["netbios_name_and_sam_account_name", "emit_as_roles"]
    }],

    "idToken": [{
        "name": "groups",
        "additionalProperties": ["netbios_name_and_sam_account_name", "emit_as_roles"]
    }]
 }
 ```

## <a name="next-steps"></a>Следующие шаги

[Что собой представляет гибридная идентификация](whatis-hybrid-identity.md)
