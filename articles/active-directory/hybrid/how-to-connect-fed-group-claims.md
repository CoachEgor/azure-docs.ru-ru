---
title: Настройка групповых заявок для приложений с помощью активного каталога Azure (ru) Документы Майкрософт
description: Информация о том, как настроить групповые претензии для использования с Azure AD.
services: active-directory
documentationcenter: ''
ms.reviewer: paulgarn
manager: daveba
ms.subservice: hybrid
ms.service: active-directory
ms.workload: identity
ms.topic: article
ms.date: 02/27/2019
ms.author: billmath
author: billmath
ms.openlocfilehash: b8708aec1137836516852135412c4c7cec2feba4
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79408408"
---
# <a name="configure-group-claims-for-applications-with-azure-active-directory-public-preview"></a>Настройка групповых заявок для приложений с помощью active Directory Azure (публичный предварительный просмотр)

Active Directory Azure может предоставлять информацию о членстве группы пользователей в токенах для использования в приложениях.  Поддерживаются две основные модели:

- Группы, идентифицированные по идентификатору объектов active Directory Azure (OID) (обычно доступны)
- Группы, идентифицированные атрибутами sAMAccountName или GroupSID для синхронизированных групп и пользователей Active Directory (AD) (Public Preview)

> [!IMPORTANT]
> Есть ряд оговорок, чтобы отметить для этой функциональности предварительного просмотра:
>
>- Поддержка использования атрибутов sAMAccountName и идентификаторов безопасности (SID), синхронизированных с находинными, предназначена для переноса существующих приложений от AD FS и других поставщиков идентификационных данных. Группы, управляемые в Azure AD, не содержат атрибутов, необходимых для испускания этих утверждений.
>- В крупных организациях количество групп, в которые является участником пользователя, может превышать лимит, который откроет Active Directory Azure в маркер. 150 групп для токена SAML и 200 для JWT. Это может привести к непредсказуемым результатам. Если у пользователей большое количество членов группы, мы рекомендуем использовать опцию ограничения групп, испускаемых в претензиях к соответствующим группам приложения.  
>- Для новой разработки приложений или в тех случаях, когда приложение может быть настроено для него, и когда вложенная поддержка группы не требуется, мы рекомендуем, чтобы авторизация в приложении основывалась на ролях приложений, а не на группах.  Это ограничивает объем информации, необходимой для вхутоя в маркер, является более безопасным и отделяет назначение пользователя от конфигурации приложения.

## <a name="group-claims-for-applications-migrating-from-ad-fs-and-other-identity-providers"></a>Претензии группы для приложений, мигрирующих от AD FS и других поставщиков идентификационных данных

Многие приложения, настроенные для аутентификации с помощью AD FS, полагаются на информацию о членстве в группе в виде атрибутов группы Windows AD.   Эти атрибуты представляют собой группу sAMAccountName, которая может быть квалифицирована по доменное имя, или идентификационный отчет windows Group Group (GroupSID).  Когда приложение федеративное AD FS, AD FS использует функцию TokenGroups для получения членства в группе для пользователя.

Приложение, которое было перемещено из AD FS, нуждается в претензиях в том же формате. Претензии группы и роли могут быть изыманы из Active Directory Azure, содержащего квалифицированный домен sAMAccountName или GroupSID, синхронизированные с Active Directory, а не objectID группы Active Directory.

Поддерживаемые форматы для групповых претензий:

- **ObjectId группы активных каталогов Azure** Active Directory ( доступна для всех групп)
- **sAMAccountName** (доступно для групп, синхронизированных с Active Directory)
- **NetbiosDomain'sAMAccountName** (доступно для групп, синхронизированных с Active Directory)
- **DNSDomainName-sAMAccountName** (доступно для групп, синхронизированных с Active Directory)
- **Идентификатор безопасности группы Premises** (доступно для групп, синхронизированных с Active Directory)

> [!NOTE]
> Атрибуты SID группы sAMAccountName и On Premises Group доступны только на объектах группы, синхронизированных с Active Directory.   Они недоступны в группах, созданных в Active Directory Azure или Office365.   Приложения, настроенные в Active Directory Azure для синхронизации атрибутов группы, получают их только для синхронизированных групп.

## <a name="options-for-applications-to-consume-group-information"></a>Варианты для приложений для потребления групповой информации

Приложения могут позвонить в конечную точку группы MS Graph для получения групповой информации для проверенного пользователя. Этот вызов гарантирует, что все группы, в которых пользователь является участником, доступны даже при наличии большого количества участвующих групп.  Перечисление группы не зависит от ограничений размера токенов.

Однако, если существующее приложение ожидает использовать групповую информацию с помощью требований, Active Directory Azure может быть настроен с несколькими различными форматами претензий.  Следуйте приведенным ниже рекомендациям.

- При использовании членства в группе для целей авторизации в приложении предпочтительнее использовать Group ObjectID. Группа ObjectID неизменяема и уникальна в Active Directory Azure и доступна для всех групп.
- При использовании предварительной группы sAMAccountName для авторизации используйте доменные квалифицированные имена;  меньше шансов на столкновение имен. sAMAccountName может быть уникальным в домене Active Directory, но если более одного домена Active Directory синхронизировано с арендатором Active Directory Azure, существует возможность для более чем одной группы иметь одно и то же имя.
- Рассмотрите возможность использования [функций приложений](../../active-directory/develop/howto-add-app-roles-in-azure-ad-apps.md) для обеспечения уровня непостываемого отношения между членством в группе и приложением.   Затем приложение принимает внутренние решения по авторизации, основанные на ролевых моллюсках в токене.
- Если приложение настроено для получения групповых атрибутов, синхронизированных с Active Directory, и группа не содержит этих атрибутов, оно не будет включено в требования.
- Претензии группы в токенах включают вложенные группы, за исключением случаев, когда используется опция ограничения претензий группы для групп, назначенных приложению.  Если пользователь является членом GroupB, а GroupB является членом GroupA, то претензии группы к пользователю будут содержать как GroupA, так и GroupB. Когда пользователи организации имеют большое количество членов группы, количество групп, перечисленных в маркере, может увеличить размер маркера.  Активный каталог Azure ограничивает количество групп, которые он будет излучать в токене, до 150 для утверждений SAML и 200 для JWT.  Если пользователь является членом большего числа групп, группы опущены и вместо этого включается ссылка на конечную точку Графика для получения групповой информации.

## <a name="prerequisites-for-using-group-attributes-synchronized-from-active-directory"></a>Предпосылки для использования атрибутов группы, синхронизированных с Active Directory

Претензии к членству в группе могут быть испущены в токенах для любой группы, если вы используете формат ObjectId. Для использования групповых утверждений в форматах, не входящих в группу ObjectId, группы должны быть синхронизированы с Active Directory с помощью Azure AD Connect.

Существует два шага для настройки Active Directory Azure для испускания имен групп для групп Active Directory.

1. **Синхронизация имен групп из Active Directory** Прежде чем Active Directory Azure сможет излучать имена групп или в группе помещений SID в претензиях группы или роли, необходимые атрибуты должны быть синхронизированы с Active Directory.  Вы должны запустить версию Azure AD Connect 1.2.70 или позже.   Более ранние версии Azure AD Connect, чем 1.2.70, синхронизируют объекты группы из Active Directory, но не будут включать требуемые атрибуты группового имени.  Обновление до текущей версии.

2. **Нанастройка регистрации приложений в Active Directory Azure для включения групповых претензий в токены** Претензии группы могут быть настроены в разделе Корпоративных Приложений портала или с помощью Манифеста приложения в разделе Регистрация приложений.  Для настройки групповых утверждений в манифесте приложения см.

## <a name="add-group-claims-to-tokens-for-saml-applications-using-sso-configuration"></a>Добавление групповых утверждений в токены для приложений SAML с помощью конфигурации SSO

Чтобы настроить групповые претензии для приложения Gallery или Non-Gallery SAML, откройте **корпоративные приложения,** нажмите на приложение в списке, выберите **Единый знак в конфигурации,** а затем выберите **атрибуты пользователя & претензий.**

Нажмите на **добавить группу претензии**  

![утверждает, что UI](media/how-to-connect-fed-group-claims/group-claims-ui-1.png)

Используйте радиокнопки, чтобы выбрать, какие группы должны быть включены в маркер

![утверждает, что UI](media/how-to-connect-fed-group-claims/group-claims-ui-2.png)

| Выбор | Описание |
|----------|-------------|
| **Все группы** | Излучает группы безопасности и списки рассылки и роли.  |
| **Группы безопасности** | Излучает группы безопасности, в которые пользователь является членом групп, |
| **Роли каталога** | Если пользователю назначены роли каталога, они излучаются как требование 'wids' (претензии групп не будут излучаться) |
| **Группы, назначенные приложению** | Излучает только группы, которые явно назначены приложению, и пользователь является членом |

Например, чтобы излучать все группы безопасности, в которые пользователь является членом, выберите группы безопасности

![утверждает, что UI](media/how-to-connect-fed-group-claims/group-claims-ui-3.png)

Для испускания групп с использованием атрибутов Active Directory, синхронизированных с Active Directory, вместо objectID Azure AD, выберите необходимый формат из выпадающих. В заявки будут включены только группы, синхронизированные с Active Directory.

![утверждает, что UI](media/how-to-connect-fed-group-claims/group-claims-ui-4.png)

Чтобы излучать только группы, назначенные приложению, выберите **группы, назначенные приложению**

![утверждает, что UI](media/how-to-connect-fed-group-claims/group-claims-ui-4-1.png)

Группы, назначенные в приложение, будут включены в токен.  Другие группы, в которые является участником пользователя, будут опущены.  С этим вариантом вложенные группы не включены, и пользователь должен быть прямым членом группы, назначенной в приложение.

Чтобы изменить группы, назначенные приложению, выберите приложение из списка **корпоративных приложений,** а затем нажмите **«Пользователи и группы»** из меню левой навигации приложения.

Просчитайте [документ, назначайте пользователя или группу в корпоративное приложение](../../active-directory/manage-apps/assign-user-or-group-access-portal.md) для получения подробной информации об управлении групповым назначением для приложений.

### <a name="advanced-options"></a>Расширенные параметры

Способ испускания групповых утверждений может быть изменен параметрами под Расширенными опциями

Настройте название претензии группы: Если выбран, для групповых претензий может быть указан другой тип претензии.   Введите тип претензии в поле имени и дополнительное пространство имен для претензии в поле пространства имен.

![утверждает, что UI](media/how-to-connect-fed-group-claims/group-claims-ui-5.png)

Некоторые приложения требуют, чтобы информация о членстве в группе отображалась в претензии «роль». Можно дополнительно излучать группы пользователей в качестве ролей, проверяя поле "Излучающие группы ролевых претензий".

![утверждает, что UI](media/how-to-connect-fed-group-claims/group-claims-ui-6.png)

> [!NOTE]
> Если возможность излучать групповые данные по мере использования ролей будет отображаться только в претензиях роли.  Любые роли приложения, назначенные пользователю, не отображаются в претензии роли.

### <a name="edit-the-group-claims-configuration"></a>Отсечение конфигурации претензий группы

После добавления конфигурации групповой претензии в конфигурацию атрибутов пользователей & требований возможность добавления групповой претензии будет посежена.  Чтобы изменить конфигурацию претензии группы, нажмите на претензию группы в списке **дополнительных претензий.**

![утверждает, что UI](media/how-to-connect-fed-group-claims/group-claims-ui-7.png)

## <a name="configure-the-azure-ad-application-registration-for-group-attributes"></a>Настройка регистрации приложений Azure AD для групповых атрибутов

Претензии группы также могут быть настроены в разделе [Факультативные претензии](../../active-directory/develop/active-directory-optional-claims.md) [Манифеста заявки.](../../active-directory/develop/reference-app-manifest.md)

1. На портале ->Active Directory - > Регистрация приложений >Выберите манифест >приложений

2. Включить претензии членства в группе, изменив groupMembershipClaim

Допустимые значения:

| Выбор | Описание |
|----------|-------------|
| **"Все"** | Излучает группы безопасности, списки рассылки и роли |
| **"SecurityGroup"** | Излучает группы безопасности, в которые пользователь является членом групп, |
| **"DirectoryRole** | Если пользователю назначены роли каталога, они излучаются как требование 'wids' (претензии групп не будут излучаться) |
| **"ApplicationGroup** | Излучает только группы, которые явно назначены приложению, и пользователь является членом |

   Пример:

   ```json
   "groupMembershipClaims": "SecurityGroup"
   ```

   По умолчанию объекты группы будут испускаться в значении группового требования.  Чтобы изменить значение претензии, содержащее на атрибутах группы помещений, или изменить тип претензии в роли, используйте конфигурацию OptionalClaims следующим образом:

3. Установите конфигурацию группы факультативные претензии.

   Если вы хотите, чтобы группы в токене содержали атрибуты группы AD в помещениях, укажите, к какому типу токенов следует применять в разделе факультативных претензий.  Несколько типов токенов могут быть перечислены:

   - idToken для токена OIDC ID
   - accessToken для токена доступа OAuth/OIDC
   - Saml2Token для токенов SAML.

   > [!NOTE]
   > Тип Saml2Token применяется как к токенам формата SAML1.1, так и к SAML2.0

   Для каждого соответствующего типа маркеров изменяйте, что группы утверждают, что используют раздел OptionalClaims в манифесте. Схема OptionalClaims такова:

   ```json
   {
   "name": "groups",
   "source": null,
   "essential": false,
   "additionalProperties": []
   }
   ```

   | Схема факультативных претензий | Значение |
   |----------|-------------|
   | **Имя:** | Должно быть,"группы" |
   | **source:** | Не используется. Опускайте или укажите нулевую |
   | **Важное значение:** | Не используется. Опускайте или укажите ложные |
   | **additionalProperties:** | Список дополнительных свойств.  Действительные варианты: "sam_account_name", "dns_domain_and_sam_account_name", "netbios_domain_and_sam_account_name", "emit_as_roles" |

   В дополнительномсвойства храних требуются только один из "sam_account_name", "dns_domain_and_sam_account_name", "netbios_domain_and_sam_account_name".  Если присутствует более одного, используется первый, а остальные игнорируются.

   Некоторые приложения требуют групповой информации о пользователе в претензии роли.  Чтобы изменить тип претензии на из группы претензии на роль претензии, добавить "emit_as_roles" к дополнительным свойствам.  Значения группы будут испускаться в претензии роли.

   > [!NOTE]
   > Если используется "emit_as_roles" любые роли приложения, настроенные на назначенные пользователем, не отображаются в претензии роли

### <a name="examples"></a>Примеры

Группы эмитов как групповые имена в токенах доступа OAuth в формате dnsDomainName-SAMAccountName

```json
"optionalClaims": {
    "accessToken": [{
        "name": "groups",
        "additionalProperties": ["dns_domain_and_sam_account_name"]
    }]
}
 ```

Испускать имена групп, которые должны быть возвращены в формате netbiosDomain-samAccountName, как роли претензии в SAML и OIDC ID токены:

```json
"optionalClaims": {
    "saml2Token": [{
        "name": "groups",
        "additionalProperties": ["netbios_name_and_sam_account_name", "emit_as_roles"]
    }],

    "idToken": [{
        "name": "groups",
        "additionalProperties": ["netbios_name_and_sam_account_name", "emit_as_roles"]
    }]
 }
 ```

## <a name="next-steps"></a>Дальнейшие действия

[Назначение корпоративному приложению пользователя или группы](../../active-directory/manage-apps/assign-user-or-group-access-portal.md)

[Настройка утверждений ролей](../../active-directory/develop/active-directory-enterprise-app-role-management.md)
