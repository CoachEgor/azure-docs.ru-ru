---
title: Планирование и устранение неполадок в принципе пользователя Azure (UPN) изменяется
description: Понимание известных проблем и смягчений последствий для изменений UPN
services: active-directory
ms.service: active-directory
ms.subservice: hybrid
ms.topic: how-to
ms.date: 03/13/2020
ms.author: baselden
author: barbaraselden
manager: daveba
ms.reviewer: jsimmons
ms.collection: M365-identity-device-management
ms.openlocfilehash: 695773da624bc8d4ccff09119d64fc43319ff488
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80246438"
---
# <a name="plan-and-troubleshoot-user-principal-name-changes-in-azure-active-directory"></a>Планирование и устранение основных изменений имен пользователей в Active Directory Azure

Основное имя пользователя (UPN) является атрибутом, который является стандартом интернет-коммуникаций для учетных записей пользователей. Имя участника-пользователя состоит из префикса (имя участника-пользователя) и суффикса (имя субъекта-пользователя). Приставка присоединяется к суффиксу с помощью символа «Я». Например, someone@example.com. Имя участника-пользователя должно быть уникальным среди всех объектов субъекта безопасности в пределах леса каталога. 

> [!NOTE]
> Для разработчиков мы рекомендуем использовать пользовательский objectID в качестве неизменяемого идентификатора, а не UPN. Если ваши приложения в настоящее время используют UPN, мы рекомендуем настроить UPN в соответствии с основным адресом электронной почты пользователя, чтобы улучшить их работу.<br> **В гибридной среде важно, чтобы UPN для пользователя был идентичен в каталоге и в каталоге Azure Active.**

**В этой статье предполагается, что вы используете UPN в качестве идентификатора пользователя. В нем рассматриваются вопросы планирования изменений UPN и восстановления после проблем, которые могут возникнуть в результате изменений UPN.**

## <a name="learn-about-upns-and-upn-changes"></a>Узнайте об изменениях UPN и UPN
Страницы входа часто побуждают пользователей вводить свой адрес электронной почты, когда требуемое значение фактически является их UPN. Таким образом, вы должны быть уверены, чтобы изменить UPN пользователей в любое время их основной адрес электронной почты изменения.

Основные адреса электронной почты пользователей могут меняться по многим причинам:

* компания ребрендинг

* сотрудников, переезжающих в различные подразделения компании 

* слияний и поглощений

* изменение имени сотрудника

### <a name="types-of-upn-changes"></a>Типы изменений UPN

Вы можете изменить UPN, изменив префикс, суффикс или и то, и другое.

* **Изменение префикса**.

   *  Например, если имя человека изменено, вы можете изменить его имя учетной записи:  
BSimon@contoso.com вBJohnson@contoso.com

   * Вы также можете изменить корпоративный стандарт для префиксов:  
Bsimon@contoso.com вBritta.Simon@contoso.com

* **Изменение суффикса**. <br>

    Например, если человек изменил деление, вы можете изменить его домен: 

   * Запустите командлет Britta.Simon@contoso.com для установки по пути Britta.Simon@contosolabs.com. <br>
     либо<br>
    *   Запустите командлет Britta.Simon@corp.contoso.com для установки по пути Britta.Simon@labs.contoso.com. 

Изменяйте UPN пользователя каждый раз, когда обновляется основной адрес электронной почты пользователя. Независимо от причины изменения электронной почты, UPN всегда должен обновляться в соответствии.

Во время первоначальной синхронизации от Active Directory до Azure AD убедитесь, что электронные письма пользователей идентичны их VPN

### <a name="upns-in-active-directory"></a>UPN в active Directory

В Active Directory суффикс UPN по умолчанию — это DNS-имя домена, в котором была создана учетная запись пользователя. В большинстве случаев это доменное имя, которое вы регистрируете в качестве домена предприятия в Интернете. Если вы создаете учетную запись пользователя в домене contoso.com, UPN по умолчанию

username@contoso.com

 Тем не менее, вы можете [добавить больше UPN суффиксов](https://docs.microsoft.com/azure/active-directory/fundamentals/add-custom-domain) с помощью доменов и трастов Active Directory. 

Например, вы можете добавить labs.contoso.com и иметь UPN-коды пользователей и электронную почту отражают это. Затем они станут

username@labs.contoso.com.

>[!IMPORTANT]
> Если UPN в каталоге Active и Azure Active Directory не совпадают, возникнут проблемы. При [изменении суффикса в Active Directory](https://docs.microsoft.com/azure/active-directory/fundamentals/add-custom-domain)необходимо убедиться, что соответствующее пользовательское доменное имя было [добавлено и проверено в Azure AD.](https://docs.microsoft.com/azure/active-directory/fundamentals/add-custom-domain) 

![Скриншот проверенных доменов](./media/howto-troubleshoot-upn-changes/custom-domains.png)

### <a name="upns-in-azure-active-directory"></a>UPN в active-каталоге Azure

Пользователи вписываются в Azure AD со значением в атрибуте userPrincipalName. 

При использовании Azure AD совместно с вашим предприимчивым Active Directory учетные записи пользователей синхронизируются с помощью службы Azure AD Connect. По умолчанию мастер Azure AD Connect использует атрибут userPrincipalName из предварительного Active Directory в качестве UPN в Azure AD. Вы можете изменить его на другой атрибут в пользовательской установке.

Важно, чтобы у вас был определенный процесс при обновлении главного имени пользователя (UPN) одного пользователя или для всей организации. 

В этом документе смотрите известные проблемы и обходные пути.

При синхронизации учетных записей пользователей с Active Directory на Azure AD убедитесь, что UPNs на карте Active Directory будут проверяться доменами в Azure AD.

![Скриншот проверенных доменов](./media/howto-troubleshoot-upn-changes/verified-domains.png)

Если значение атрибута userPrincipalName не соответствует проверенной домену в Azure AD, процесс синхронизации заменяет суффикс на значение .onmicrosoft.com.onmicrosoft.com.


### <a name="roll-out-bulk-upn-changes"></a>Развертывание объемных изменений UPN

Следуйте[рекомендациям для пилотного проекта](https://docs.microsoft.com/azure/active-directory/fundamentals/active-directory-deployment-plans) для массовых изменений UPN. Также у вас есть проверенный план отката для возврата UPNs, если вы обнаружите проблемы, которые не могут быть быстро решены. После запуска пилотного проекта можно приступить к таргетингу на небольшие наборы пользователей с различными организационными ролями и их конкретными наборами приложений или устройств.

Проходя через этот первый подмножество пользователей даст вам хорошее представление о том, что пользователи должны ожидать, как часть изменения. Включите эту информацию в сообщения пользователей.

Создание определенной процедуры изменения UPN на отдельных пользователей в рамках обычных операций. Мы рекомендуем иметь проверенную процедуру, которая включает документацию об известных проблемах и обходных пути.

В следующих разделах подробно описаны потенциальные известные проблемы и обходные пути при изменении UPN.

## <a name="user-provisioning-known-issues-and-workarounds"></a>пользователь подготовки известных проблем и обходных пути

[Программное обеспечение как сервис (SaaS)](https://azure.microsoft.com/overview/what-is-saas/) и бизнес-приложения (LoB) часто полагаются на UPN для поиска пользователей и хранения информации о профиле пользователя, включая роли. Приложения, которые используют [Just In Time для](https://docs.microsoft.com/azure/active-directory/app-provisioning/user-provisioning) создания профиля пользователя при первом входе пользователей в приложение, могут быть затронуты изменениями UPN.

**Известная проблема**<br>
Изменение UPN пользователя может разорвать связь между пользователем Azure AD и профилем пользователя, созданным в приложении. Если приложение использует [Just in Time provisioning,](https://docs.microsoft.com/azure/active-directory/app-provisioning/user-provisioning)это может создать совершенно новый профиль пользователя. Это потребует от администратора приложения внести ручные изменения, чтобы исправить это отношение.

**Решение**<br>
[Автоматическое обеспечение пользователей Azure AD](https://docs.microsoft.com/azure/active-directory/manage-apps/user-provisioning) позволяет автоматически создавать, поддерживать и удалять идентификаторы пользователей в поддерживаемых облачных приложениях. Настройка автоматического предоставления приложений пользователям автоматически обновляет UPN-приложения. Проверьте приложения как часть постепенного развертывания, чтобы проверить, что они не влияют на изменения UPN.

## <a name="managed-devices-known-issues-and-workarounds"></a>Управляемые устройства известные проблемы и обходные пути

[Приводя свои устройства в Azure AD,](https://docs.microsoft.com/azure/active-directory/devices/overview)вы максимизируете производительность пользователей с помощью единого ввода в связь (SSO) в облачных и внутренних ресурсах.

### <a name="azure-ad-joined-devices"></a>Устройства, присоединенные к Azure AD

[Устройства, объединенные в AD Azure AD,](https://docs.microsoft.com/azure/active-directory/devices/concept-azure-ad-join) подходят непосредственно к Azure AD и позволяют пользователям входить в устройство, используя идентификатор своей организации.

**Известные проблемы** <br>
Пользователи могут испытывать проблемы с одним и независимым и с приложениями, которые зависят от Azure AD для проверки подлинности.

**Решение** <br>
Увечы достаточно времени для синхронизации UPN с Azure AD. Как только вы убедитесь, что новый UPN отражен на портале Azure AD, попросите пользователя выбрать плитку «Другой пользователь» для вступления в систему с новым UPN. Вы также можете проверить через [PowerShell](https://docs.microsoft.com/powershell/module/azuread/get-azureaduser?view=azureadps-2.0). После вступления в систему с новым UPN, ссылки на старый UPN все еще могут отображаться на "Доступ работы или школы" Windows настройки.

![Скриншот проверенных доменов](./media/howto-troubleshoot-upn-changes/other-user.png)

### <a name="hybrid-azure-ad-joined-devices"></a>Гибридные устройства, присоединенные к Azure AD

[Гибридные устройства, объединенные Azure AD,](https://docs.microsoft.com/azure/active-directory/devices/concept-azure-ad-join-hybrid) соединены с Active Directory и Azure AD. Вы можете реализовать гибридное соединение Azure AD, если в вашей среде есть на месте Active Directory след, и вы также хотите воспользоваться возможностями, предоставляемыми Azure AD.

**Известные проблемы** 

Устройства, объединенные гибридными Azure AD под Ключи Windows 10, скорее всего, будут испытывать неожиданные перезапуски и проблемы с доступом.

Если пользователи входят в Windows до того, как новый UPN был синхронизирован с Azure AD, или продолжают использовать существующую сессию Windows, они могут столкнуться с проблемами одиночного вхождения с приложениями, которые используют Azure AD для проверки подлинности, если условный доступ был настроен для обеспечения использования устройств Hybrid Joined для доступа к ресурсам. 

Кроме того, появится следующее сообщение, заставив перезагрузиться через минуту. 

"Ваш компьютер автоматически перезаработает через одну минуту. Windows столкнулась с проблемой и нуждается в перезагрузке. Вы должны закрыть это сообщение сейчас и сохранить свою работу ".

**Решение** 

Устройство должно быть объединено из Azure AD и перезапущено. После перезагрузки устройство автоматически присоединится к Azure AD, и пользователь должен войти в систему с помощью нового UPN, выбрав плитку "Другой пользователь". Чтобы разсоединить устройство из Azure AD, запустите следующую команду в запросе команды:

**dsregcmd /отпуск**

Пользователь должен будет [повторно зарегистрироваться](https://docs.microsoft.com/windows/security/identity-protection/hello-for-business/hello-hybrid-cert-whfb-provision) для Windows Hello for Business, если он используется. Устройства Windows 7 и 8.1 не затронуты этой проблемой после изменений UPN.

## <a name="microsoft-authenticator-known-issues-and-workarounds"></a>Microsoft Authenticator известные проблемы и обходные пути

Организации может потребоваться использование [приложения Microsoft Authenticator](https://docs.microsoft.com/azure/active-directory/user-help/user-help-auth-app-overview) для вхотворения и доступа к организационным приложениям и данным. Хотя имя пользователя может появиться в приложении, учетная запись не настроена на функции метода проверки до тех пор, пока пользователь не завершит процесс регистрации.

[Приложение Microsoft Authenticator](https://docs.microsoft.com/azure/active-directory/user-help/user-help-auth-app-overview) имеет четыре основные функции:

* Многофакторная аутентификация с помощью push-уведомления или кода проверки

* Действуйте в качестве брокера аутентификации на устройствах iOS и Android, чтобы обеспечить единый вок-нагон для приложений, которые используют [brokered аутентификацию](https://docs.microsoft.com/azure/active-directory/develop/brokered-auth)

* Регистрация устройств (также известная как Workplace Joined) в Azure AD, что является требованием для других функций, таких как Intune App Protection и Device Enrolment/Management,

* Телефонный вйза, который требует МИД и регистрации устройства.

### <a name="multi-factor-authentication-with-android-devices"></a>Многофакторная аутентификация с устройствами Android

Приложение Microsoft Authenticator предлагает внеполосную опцию проверки. Вместо того, чтобы размещать автоматический телефонный звонок или SMS пользователю во время вхинга, [Multi-Factor Authentication (MFA)](https://docs.microsoft.com/azure/active-directory/authentication/concept-mfa-howitworks) нажимает уведомление в приложение Microsoft Authenticator на смартфоне или планшете пользователя. Пользователь просто нажимает Утверждение (или вводит PIN-код или биометрические и краны "Authenticate") в приложении, чтобы завершить их ввод.

При изменении UPN пользователя мобильные устройства могут возникнуть следующие проблемы:

**Известные проблемы** 

Старый UPN по-прежнему отображается в учетной записи пользователя, и уведомление может быть не получено. [Коды проверки](https://docs.microsoft.com/azure/active-directory/user-help/user-help-auth-app-faq) продолжают работать.

**Решение**

Если уведомление получено, поручите пользователю отклонить уведомление, откройте приложение Authenticator, коснитесь опции «Проверить уведомления» и утвердить запрос МИД. После этого UPN отображается на счете будет обновляться. Обратите внимание, что обновленный UPN может отображаться как новая учетная запись, это связано с другой функциональностью Authenticator используется. Для получения дополнительной информации дополнительные известные проблемы в этой статье.

### <a name="brokered-authentication"></a>Брокерская аутентификация

На Android и iOS брокеров, как Microsoft Authenticator позволяют:

* Единый вданный (SSO) - Вашим пользователям не нужно будет входить в каждое приложение.

* Идентификация устройства - Брокер получает доступ к сертификату устройства, созданного на устройстве, когда оно было присоединено к рабочему месту.

* Проверка идентификации приложения - Когда приложение звонит брокеру, оно передает свой перенаправление URL, и брокер проверяет его.

Кроме того, он позволяет приложениям участвовать в более продвинутых функциях, таких как [условный доступ,](https://docs.microsoft.com/azure/active-directory/conditional-access/)и поддерживает [сценарии Microsoft Intune.](https://docs.microsoft.com/azure/active-directory/develop/msal-net-use-brokers-with-xamarin-apps)

**Известные проблемы**<br>
Пользователю предоставляется более интерактивные запросы аутентификации на новые приложения, которые используют брокера при содействии входе из-за несоответствия между login_hint, принятыми приложением и UPN, хранящимся на брокере.

**Решение** <br> Пользователю необходимо вручную удалить учетную запись из Microsoft Authenticator и запустить новый входе из приложения с поддержкой брокера. Учетная запись будет автоматически добавлена после первоначальной проверки подлинности.

### <a name="device-registration"></a>Регистрация устройства

Приложение Microsoft Authenticator отвечает за регистрацию устройства в Azure AD. Регистрация устройств позволяет устройству аутентифицироваться в Azure AD и является обязательным условием для следующих сценариев:

* Защита приложений Intune

* Регистрация устройств intune

* Телефон Войти

**Известные проблемы**<br>
При изменении UPN в приложении Microsoft Authenticator появляется новая учетная запись с новым UPN, в то время как учетная запись со старым UPN все еще указана. Кроме того, старый UPN отображается в разделе Регистрация устройств в настройках приложения. Не существует никаких изменений в нормальной функциональности регистрации устройств или иждивении сценариев.

**Решение** <br> Чтобы удалить все ссылки на старый UPN в приложении Microsoft Authenticator, поручить пользователю вручную удалить как старые, так и новые учетные записи из Microsoft Authenticator, перерегистрироваться для MFA и вернуться к устройству.

### <a name="phone-sign-in"></a>Телефон входиный

Телефон наячн позволяет пользователям войти в Azure AD без пароля. Для включения телефона в систему пользователю необходимо зарегистрироваться в МИД с помощью приложения Authenticator, а затем включить телефон, всданный непосредственно на Authenticator. В рамках конфигурации устройство регистрируется с Azure AD.

**Известные проблемы** <br>
Пользователи не могут использовать телефон войти в систему, потому что они не получают никаких уведомлений. Если пользователь нажимает на Проверку уведомлений, он получает ошибку.

**Решение**<br>
Пользователю необходимо выбрать выпадающее меню в учетной записи, включенной для входиного телефона, и выбрать входе в телефон От "Отключить". При желании, телефон ввести в систему может быть включен снова.

## <a name="security-key-fido2-known-issues-and-workarounds"></a>Ключ безопасности (FIDO2) известные проблемы и обходные пути

**Известные проблемы** <br>
Когда несколько пользователей зарегистрированы на одном ключе, знак на экране показывает страницу выбора учетной записи, на которой отображается старый UPN. Зарегистрируйтесь с помощью ключей безопасности, на них не влияют изменения UPN.  

**Решение**<br>
Чтобы удалить ссылки на старые UPN, пользователи должны [сбросить ключ безопасности и перерегистрироваться.](https://docs.microsoft.com/azure/active-directory/authentication/howto-authentication-passwordless-security-key#known-issues)

## <a name="onedrive-known-issues-and-workarounds"></a>Известные проблемы и обходные пути OneDrive

Известно, что пользователи OneDrive испытывают проблемы после изменений UPN. Для получения дополнительной информации см., [как изменения UPN влияют на URL-адрес OneDrive и функции OneDrive.](https://docs.microsoft.com/onedrive/upn-changes)

## <a name="next-steps"></a>Дальнейшие действия

Смотрите следующие ресурсы:
* [Azure AD Connect: принципы проектирования](https://docs.microsoft.com/azure/active-directory/hybrid/plan-connect-design-concepts)

* [Указание атрибута UserPrincipalName в Azure AD](https://docs.microsoft.com/azure/active-directory/hybrid/plan-connect-userprincipalname)

* [Токены идентификационной платформы Майкрософт](https://docs.microsoft.com/azure/active-directory/develop/id-tokens)
