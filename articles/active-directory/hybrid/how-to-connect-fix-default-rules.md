---
title: Как исправить измененные правила по умолчанию - Azure AD Connect Документы Майкрософт
description: Узнайте, как исправить измененные правила по умолчанию, которые поставляются с Azure AD Connect.
services: active-directory
author: billmath
manager: daveba
editor: curtand
ms.reviewer: darora10
ms.service: active-directory
ms.workload: identity
ms.topic: conceptual
ms.date: 03/21/2019
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: 4626e0149028a140d143fb8d0969a03b732201fa
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79036977"
---
# <a name="fix-modified-default-rules-in-azure-ad-connect"></a>Исправление измененных правил по умолчанию в Azure AD Connect

Для синхронизации— Connect— средство подключения к активному каталогу Azure (Azure AD) использует правила по умолчанию.  К сожалению, эти правила не применяются повсеместно ко всем организациям. В зависимости от ваших требований, возможно, потребуется их изменить. В этой статье рассматриваются два примера наиболее распространенных настроек и объясняется правильный способ достижения этих настроек.

>[!NOTE] 
> Изменение существующих правил по умолчанию для достижения необходимой настройки не поддерживается. Если вы сделаете это, это предотвращает обновление этих правил до последней версии в будущих релизах. Вы не получите исправлений ошибок вам нужно, или новые функции. В этом документе объясняется, как достичь того же результата без изменения существующих правил по умолчанию. 

## <a name="how-to-identify-modified-default-rules"></a>Как определить измененные правила по умолчанию
Начиная с версии 1.3.7.0 Azure AD Connect, легко определить измененное правило по умолчанию. Перейдите к **приложениям на рабочем столе**и выберите **редактор правил синхронизации.**

![Azure AD Connect с выделенным редактором правил синхронизации](media/how-to-connect-fix-default-rules/default1.png)

В редакторе любые измененные правила по умолчанию отображаются с значком предупреждения перед именем.

![Значок предупреждения](media/how-to-connect-fix-default-rules/default2.png)

 Также появляется правило отключений с тем же именем рядом с ним (это стандартное правило по умолчанию).

![Редактор правил синхронизации, показывающий стандартное правило по умолчанию и измененное правило по умолчанию](media/how-to-connect-fix-default-rules/default2a.png)

## <a name="common-customizations"></a>Общие настройки
Ниже приведены общие настройки правил по умолчанию:

- Изменение потока атрибутов
- Изменение фильтра скопирования
- Изменение условия соединения

Перед изменением каких-либо правил:

- Отвысьте планировщик синхронизации. По умолчанию планировщик запускается каждые 30 минут. Убедитесь, что он не начинается, пока вы вносите изменения и устранение новых правил. Чтобы временно отключить планировщик, запустите PowerShell и `Set-ADSyncScheduler -SyncCycleEnabled $false`запустите.
 ![PowerShell команды для отключить планировщик синхронизации](media/how-to-connect-fix-default-rules/default3.png)

- Изменение фильтра скопирования может привести к удалению объектов в целевом каталоге. Будьте осторожны, прежде чем вносить какие-либо изменения в скопирование объектов. Мы рекомендуем вносить изменения в промежуточный сервер перед внесением изменений на активном сервере.
- Выполнить предварительный просмотр на одном объекте, как указано в разделе [Правила проверки синхронизации,](#validate-sync-rule) после добавления любого нового правила.
- Выполнить полную синхронизацию после добавления нового правила или изменения любого пользовательского правила синхронизации. Эта синхронизация применяет новые правила ко всем объектам.

## <a name="change-attribute-flow"></a>Изменение потока атрибутов
Существует три различных сценария изменения потока атрибутов:
- Добавление нового атрибута.
- Переопределение значения существующего атрибута.
- Выбор не синхронизировать существующий атрибут.

Вы можете сделать это без изменения стандартных правил по умолчанию.

### <a name="add-a-new-attribute"></a>Добавление нового атрибута
Если вы обнаружите, что атрибут не перетекает из исходного каталога в целевой каталог, используйте [синхронизацию Azure AD Connect: Каталог каталогов,](how-to-connect-sync-feature-directory-extensions.md) чтобы исправить это.

Если расширения не работают для вас, попробуйте добавить два новых правила синхронизации, описанные в следующих разделах.


#### <a name="add-an-inbound-sync-rule"></a>Добавление входящего правила синхронизации
Правило входящих синхронизаций означает, что источником атрибута является пространство разъема, а целью является метаверс. Например, чтобы иметь новый поток атрибутов из предварительного Active Directory в Active Directory, создайте новое правило входящих синхронизации. Запустите **редактор правил синхронизации,** выберите **Inbound** в качестве направления и выберите **Добавить новое правило.** 

 ![Редактор правил синхронизации](media/how-to-connect-fix-default-rules/default3a.png)

Следуйте своей собственной конвенции именования, чтобы назвать правило. Здесь мы используем **Custom In от AD - Пользователь**. Это означает, что правило является пользовательским правилом и является входящим правилом от пространства разъема Active Directory до метавселенной.   

 ![Создание правила входящей синхронизации](media/how-to-connect-fix-default-rules/default3b.png)

Предоставьте свое собственное описание правила, чтобы в будущем было легко выдерживать это правило. Например, описание может быть основано на цели правила и на том, зачем оно необходимо.

Сделайте выбор для **подключенной системы,** **типа объектов подключенной системы**и **полей типа Metaverse Object Type.**

Укажите значение приоритета от 0 до 99 (чем ниже число, тем выше приоритет). Для **тегов,** **включить синхронизацию паролей**и **полей для инвалидов** используйте выбор по умолчанию.

Держите **фильтр Scoping** пустым. Это означает, что правило применяется ко всем объектам, объединенным между системой Active Directory Connected System и метавселенной.

Храните **правила присоединения** пустыми. Это означает, что это правило использует условие соединения, определенное в стандартном правиле по умолчанию. Это еще одна причина не отключать или удалять стандартное правило по умолчанию. Если нет условия соединения, атрибут не будет течь. 

Добавьте соответствующие преобразования для атрибута. Вы можете назначить константу, чтобы сделать постоянный поток значений для вашего целевого атрибута. Можно использовать прямое отображение между исходным или целевым атрибутом. Или можно использовать выражение для атрибута. Вот различные [функции выражения,](https://docs.microsoft.com/azure/active-directory/hybrid/reference-connect-sync-functions-reference) которые вы можете использовать.

#### <a name="add-an-outbound-sync-rule"></a>Добавить правило исходящих синхронизаций
Чтобы связать атрибут с целевым каталогом, необходимо создать исходящие правила. Это означает, что источником является метавселенной, а целью является подключенная система. Чтобы создать исходящие правила, запустите **редактор правил синхронизации,** измените **Направление** на **исходящий**и выберите **Добавить новое правило.** 

![Редактор правил синхронизации](media/how-to-connect-fix-default-rules/default3c.png)

Как и в входящих правила, вы можете использовать свой собственный именования конвенции назвать правило. Выберите **connected System** в качестве арендатора Azure AD и выберите объект подключенной системы, на который требуется установить значение атрибута. Установите приоритет от 0 до 99. 

![Создание правила исходящей синхронизации](media/how-to-connect-fix-default-rules/default3d.png)

Храните **фильтр Scoping** и **правила присоединения** пустыми. Заполните преобразование как постоянное, прямое или выражение. 

Теперь вы знаете, как создать новый атрибут для потока объектов пользователя из Active Directory в Active Directory. Эти действия можно использовать для картирования любого атрибута от любого объекта к источнику и цели. Для получения дополнительной информации [см. Создание пользовательских правил синхронизации](how-to-connect-create-custom-sync-rule.md) и [подготовка к предоставлению пользователям](https://docs.microsoft.com/office365/enterprise/prepare-for-directory-synchronization).

### <a name="override-the-value-of-an-existing-attribute"></a>Переопределение значения существующего атрибута
Возможно, вы захотите переопределить значение атрибута, который уже был отображен. Например, если вы всегда хотите установить нулевую стоимость к атрибуту в Azure AD, просто создайте только входящее правило. Сделайте постоянное `AuthoritativeNull`значение, перетеканите к целевому атрибуту. 

>[!NOTE] 
> Используйте `AuthoritativeNull` `Null` вместо этого в этом случае. Это происходит потому, что значение ненулевого заменяет нулевую стоимость, даже если оно имеет более низкий приоритет (более высокое значение числа в правиле). `AuthoritativeNull`, с другой стороны, не заменяется ненулевой стоимостью другими правилами. 

### <a name="dont-sync-existing-attribute"></a>Не синхронизируйте существующий атрибут
Если требуется исключить атрибут из синхронизации, используйте функцию фильтрации атрибутов, предусмотренную в Azure AD Connect. Запустите **Azure AD Connect** из значка рабочего стола, а затем выберите **параметры синхронизации customize.**

![Параметры дополнительных задач Azure AD Connect](media/how-to-connect-fix-default-rules/default4.png)

 Убедитесь, что **выбрано приложение Azure AD и фильтрация атрибутов,** и выберите **Следующую.**

![Дополнительные функции Azure AD Connect](media/how-to-connect-fix-default-rules/default5.png)

Очистите атрибуты, которые необходимо исключить из синхронизации.

![Атрибуты Подключения AD Azure](media/how-to-connect-fix-default-rules/default6a.png)

## <a name="change-scoping-filter"></a>Изменение фильтра скопирования
Azure AD Sync заботится о большинстве объектов. Можно уменьшить область охвата объектов и уменьшить количество объектов, которые будут экспортироваться, без изменения стандартных правил синхронизации по умолчанию. 

Используйте один из следующих методов для уменьшения сферы действия синхронизированных объектов:

- облакоФильтрированный атрибут
- Фильтрация единицорганизации организации

Если уменьшить область синхронизации пользователей, синхронизация хэша паролей также останавливается для отфильтрованных пользователей. Если объекты уже синхронизированы, после уменьшения области отфильтрованные объекты удаляются из целевого каталога. По этой причине убедитесь, что вы область очень тщательно.

>[!IMPORTANT] 
> Не рекомендуется увеличивать объем объектов, настроенных Azure AD Connect. Это затрудняет понимание настройками группы поддержки Майкрософт. Если необходимо увеличить объем объектов, отспособите существующее правило, клоните его и отключите исходное правило. 

### <a name="cloudfiltered-attribute"></a>облакоФильтрированный атрибут
Вы не можете установить этот атрибут в Active Directory. Установите значение этого атрибута, добавив новое входящий правило. Затем можно использовать **Преобразование** и **Выражение** для установки этого атрибута в метавселенной. Следующий пример показывает, что не требуется синхронизировать всех пользователей, название отдела которого начинается с **HRD** (нечувствительный к случаю):

`cloudFiltered <= IIF(Left(LCase([department]), 3) = "hrd", True, NULL)`

Сначала мы преобразовали отдел из источника (Active Directory) в нижний регистр. Затем, используя `Left` функцию, мы взяли только первые три `hrd`символа и сравнили его с . Если он соответствует, значение `True`устанавливается, в противном случае. `NULL` При установлении значения к нулю, некоторые другие правила с более низким приоритетом (более высокое значение числа) могут написать ему с другим условием. Выполнить предварительный просмотр на одном объекте для проверки правила синхронизации, как указано в разделе [правила проверки синхронизации.](#validate-sync-rule)

![Создание параметров правил синхронизации входящих](media/how-to-connect-fix-default-rules/default7a.png)

### <a name="organizational-unit-filtering"></a>Организационная фильтрация единиц
Можно создать одно или несколько организационных единиц (OUs) и переместить объекты, которые не хотите синхронизировать, в эти ОУ. Затем найди фильтрацию OU в Azure AD Connect. Запустите **Azure AD Connect** из значка рабочего стола и выберите следующие параметры. Вы также можете настроить фильтрацию OU во время установки Azure AD Connect. 

![Подключение дополнительных задач Azure AD](media/how-to-connect-fix-default-rules/default8.png)

Следуйте за мастером и очистите оС, которые вы не хотите синхронизировать.

![Параметры фильтрации Azure AD Connect и OU](media/how-to-connect-fix-default-rules/default9.png)

## <a name="change-join-condition"></a>Изменение условия соединения
Используйте условия соединения по умолчанию, настроенные Azure AD Connect. Изменение условий соединения по умолчанию затрудняет понимание настройками и поддержку продукта службой Майкрософт.

## <a name="validate-sync-rule"></a>Правило синхронизации проверки
Вы можете проверить недавно добавленное правило синхронизации с помощью функции предварительного просмотра, не запустив полный цикл синхронизации. В Azure AD Connect выберите **службу синхронизации.**

![Azure AD Connect с выделенной службой синхронизации](media/how-to-connect-fix-default-rules/default10.png)

Выберите **Метаверс-Поиск**. Выберите объект области в качестве **человека,** выберите **Добавление клаузулы**и укажите критерии поиска. Затем выберите **Поиск**и дважды щелкните объект в результатах поиска. Убедитесь, что данные в Azure AD Connect обновлены для этого объекта, запустив импорт и синхронизацию в лесу перед запуском этого шага.

![Synchronization Service Manager](media/how-to-connect-fix-default-rules/default11.png)

На **Свойства объектов Metaverse**, выберите **соединители,** выберите объект в соответствующем разъеме (лес), и выберите **Свойства...**.

![Свойства объекта метавселенной](media/how-to-connect-fix-default-rules/default12.png)

Выберите **Предварительный просмотр...**

![Свойства объекта пространства соединителя](media/how-to-connect-fix-default-rules/default13a.png)

В окне предварительного просмотра выберите **Поток просмотра и** **атрибута импорта** в левом стекле.

![Preview (Предварительный просмотр)](media/how-to-connect-fix-default-rules/default14.png)
 
Здесь обратите внимание, что недавно добавленное правило `cloudFiltered` запущено на объекте, и установит атрибут истинной.

![Preview (Предварительный просмотр)](media/how-to-connect-fix-default-rules/default15a.png)
 
Чтобы сравнить измененное правило с правилом по умолчанию, экспортировать оба правила отдельно, как текстовые файлы. Эти правила экспортируются в виде скрипта PowerShell. Вы можете сравнить их с помощью любого инструмента сравнения файлов (например, windiff), чтобы увидеть изменения. 
 
Обратите внимание, что в `msExchMailboxGuid` измененном правиле атрибут изменяется на тип **выражения,** а не **direct.** Кроме того, значение изменяется на **null** и **ExecuteOnce.** Вы можете игнорировать различия идентифицированных и превосходства. 

![Выход инструмента windiff](media/how-to-connect-fix-default-rules/default17.png)
 
Чтобы исправить правила, чтобы изменить их обратно в настройки по умолчанию, удалите измененное правило и включите правило по умолчанию. Убедитесь, что вы не потеряете настройки вы пытаетесь достичь. Когда вы будете готовы, запустите **полную синхронизацию.**

## <a name="next-steps"></a>Дальнейшие действия
- [Оборудование и предварительные требования](how-to-connect-install-prerequisites.md) 
- [Стандартные параметры](how-to-connect-install-express.md)
- [Настраиваемые параметры](how-to-connect-install-custom.md)



