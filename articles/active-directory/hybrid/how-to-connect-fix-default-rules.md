---
title: Как устранить правила измененные по умолчанию - Azure AD Connect | Документация Майкрософт
description: Сведения об устранении измененные по умолчанию правила, входящие в состав Azure AD Connect.
services: active-directory
author: billmath
manager: daveba
editor: curtand
ms.reviewer: darora10
ms.service: active-directory
ms.workload: identity
ms.topic: conceptual
ms.date: 03/21/2019
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: d2f0956b44d6df64fb73e5eee7844574237d8755
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "65067629"
---
# <a name="fix-modified-default-rules-in-azure-ad-connect"></a>Исправление правила измененные по умолчанию в Azure AD Connect

Azure Active Directory (Azure AD) Connect использует правила по умолчанию для синхронизации.  К сожалению эти правила не всегда применяются ко всем организациям. На основе требований, может потребоваться изменить их. В этой статье рассматриваются два примера наиболее распространенные пользовательские настройки и объясняется правильный способ достижения этих настроек.

>[!NOTE] 
> Изменение существующих правил по умолчанию для достижения необходимые настройки не поддерживается. Если это сделать, это предотвращает обновление этих правил до последней версии в будущих выпусков. Вы не получите исправления ошибок, которые вам нужны, или новые функции. В этом документе объясняется, как для достижения того же результата без изменения существующих правил по умолчанию. 

## <a name="how-to-identify-modified-default-rules"></a>Как определить правила измененные по умолчанию
Начиная с версии 1.3.7.0 Azure AD Connect, можно легко определить правило измененные по умолчанию. Перейдите к **приложения на рабочем столе**и выберите **редактор правил синхронизации**.

![Azure AD Connect с выделенным редактор правил синхронизации](media/how-to-connect-fix-default-rules/default1.png)

В редакторе какие-либо правила измененные по умолчанию отображаются со значком предупреждения перед именем.

![Значок "Внимание!"](media/how-to-connect-fix-default-rules/default2.png)

 Отключенного правила, с тем же именем рядом с полем он также отображается (это правило по умолчанию).

![Редактор правил синхронизации, показывающий правило по умолчанию и измененные по умолчанию правило](media/how-to-connect-fix-default-rules/default2a.png)

## <a name="common-customizations"></a>Стандартные настройки
Ниже приведены общие настройки для правила по умолчанию.

- Изменить поток атрибутов
- Изменить фильтр области
- Изменение условия соединения

Прежде чем изменять какие-либо правила:

- Отключите планировщик синхронизации. По умолчанию планировщик запускается каждые 30 минут. Убедитесь, что он не запускается во время внесения изменений и устранение неполадок новых правил. Чтобы временно отключить планировщик, запустите PowerShell и выполните `Set-ADSyncScheduler -SyncCycleEnabled $false`.
 ![Команды PowerShell, чтобы отключить планировщик синхронизации](media/how-to-connect-fix-default-rules/default3.png)

- Изменение фильтра области может привести удаление объектов в целевом каталоге. Перед внесением любых изменений в определение областей объектов, будьте внимательны. Мы рекомендуем внести изменения на промежуточном сервере, прежде чем вносить изменения на активном сервере.
- Выполнить предварительный просмотр одного объекта, как упоминалось в [проверить правило синхронизации](#validate-sync-rule) раздела, после добавления любое новое правило.
- Выполните полную синхронизацию после добавления нового правила или изменение любого правила синхронизации. Это новые правила применяются ко всем объектам.

## <a name="change-attribute-flow"></a>Изменить поток атрибутов
Существует три разных сценария для изменения потока атрибута.
- Добавление нового атрибута.
- Переопределение значения атрибута.
- Предпочитают не синхронизировать существующего атрибута.

Это можно сделать это без изменения правила по умолчанию.

### <a name="add-a-new-attribute"></a>Добавить новый атрибут
Если обнаружится, что атрибут не передаются из исходного каталога в целевой каталог, используйте [синхронизации Azure AD Connect: Расширения каталогов](how-to-connect-sync-feature-directory-extensions.md) Чтобы устранить эту проблему.

Если расширения не подходит, попробуйте добавить два новых правила синхронизации, описанные в следующих разделах.


#### <a name="add-an-inbound-sync-rule"></a>Добавление правила входящей синхронизации
Правило входящей синхронизации означает, что источником атрибута является пространстве соединителя, а назначением-метавселенной. Например, для нового атрибута потока из локальной Active Directory в Azure Active Directory, создайте новое правило входящей синхронизации. Запустите **редактор правил синхронизации**выберите **Inbound** как направление, а затем выберите **добавить новое правило**. 

 ! Editor](media/how-to-connect-fix-default-rules/default3a.png) правила синхронизации

Выполните собственные соглашения об именовании для присвойте правилу имя. Здесь мы используем **Custom в из AD — пользователь**. Это означает, что правило по настраиваемое правило, которое правило входящего трафика из пространства соединителя Active Directory в метавселенной.   

 ![Создание правила входящей синхронизации](media/how-to-connect-fix-default-rules/default3b.png)

Укажите собственное описание правила, чтобы легко последующее обслуживание правила. Например описание может основываться на Какова цель правила и зачем она нужна.

Сделайте свой выбор **подключенная система**, **тип объекта подключенной системы**, и **тип объекта метавселенной** поля.

Укажите значение приоритета от 0 до 99 (чем меньше число, тем выше приоритет). Для **тега**, **включить синхронизацию паролей**, и **отключено** поля, используйте вариант по умолчанию.

Сохранить **фильтр области** пустой. Это означает, что правило применяется ко всем объектам присоединены между подключенная система Active Directory и метавселенной.

Сохранить **правила присоединения** пустой. Это означает, что это правило использует условие соединения, определенные в правиле по умолчанию. Это еще одна причина, отключить или удалить правило по умолчанию. Если нет условие соединения, не будут передаваться атрибута. 

Добавьте соответствующие преобразования для атрибута. Вы можете назначить константу, чтобы сделать константа значение потоком вашей целевой атрибут. Можно использовать прямое сопоставление между исходной или целевой атрибут. Или можно использовать выражение для атрибута. Ниже приведены различные [функции выражений](https://docs.microsoft.com/azure/active-directory/hybrid/reference-connect-sync-functions-reference) можно использовать.

#### <a name="add-an-outbound-sync-rule"></a>Добавление правила исходящей синхронизации
Чтобы связать атрибут в целевой каталог, необходимо создать правило для исходящего трафика. Это означает, что источником является метавселенной и целевой объект — подключенной системы. Чтобы создать правило для исходящего трафика, запустите **редактор правил синхронизации**, изменить **направление** для **Outbound**и выберите **добавить новое правило**. 

![Редактор правил синхронизации](media/how-to-connect-fix-default-rules/default3c.png)

Как и в правило для входящего трафика, можно использовать собственные соглашения об именовании для присвойте правилу имя. Выберите **подключенная система** как клиент Azure AD, а также выберите подключенной системы объекта, к которому вы хотите задать значение атрибута. Задайте приоритет от 0 до 99. 

![Создание правила исходящей синхронизации](media/how-to-connect-fix-default-rules/default3d.png)

Сохранить **фильтр области** и **правила присоединения** пустой. Заполните преобразование как константа, direct или выражение. 

Теперь вы знаете, как сделать новый атрибут для потока объект пользователя из Active Directory в Azure Active Directory. Эти действия можно использовать для сопоставления все атрибуты из любого объекта в исходной и целевой. Дополнительные сведения см. в разделе [Создание настраиваемых правил синхронизации](how-to-connect-create-custom-sync-rule.md) и [подготовки для подготовки пользователей](https://docs.microsoft.com/office365/enterprise/prepare-for-directory-synchronization).

### <a name="override-the-value-of-an-existing-attribute"></a>Переопределить значение атрибута
Можно переопределить значение атрибута, который уже сопоставлен. Например всегда следует присвоить значение null для атрибута в Azure AD просто создайте правило для входящего трафика только. Добавьте в качестве значения констант, `AuthoritativeNull`, поток для целевого атрибута. 

>[!NOTE] 
> Используйте `AuthoritativeNull` вместо `Null` в данном случае. Это обусловлено тем, отличных от null значение заменяет значение null, даже если он имеет более низкий приоритет (высокий числового значения в правило). `AuthoritativeNull`, с другой стороны, не заменяются ненулевое значение с другими правилами. 

### <a name="dont-sync-existing-attribute"></a>Не синхронизировать существующий атрибут
Если вы хотите исключить из синхронизации атрибута, используйте атрибут, фильтрацию функцией в Azure AD Connect. Запустите **Azure AD Connect** значок на рабочем столе, а затем выберите **настроить параметры синхронизации**.

![Параметры дополнительных задач Azure AD Connect](media/how-to-connect-fix-default-rules/default4.png)

 Убедитесь, что **приложения Azure AD и фильтрации атрибутов** , а кнопку **Далее**.

![Дополнительные возможности Azure AD Connect](media/how-to-connect-fix-default-rules/default5.png)

Снимите атрибуты, которые требуется исключить из синхронизации.

![Атрибуты Azure AD Connect](media/how-to-connect-fix-default-rules/default6a.png)

## <a name="change-scoping-filter"></a>Изменить фильтр области
Azure AD Sync берет на себя большую часть объектов. Можно уменьшить область объектов и сократить количество объектов для экспорта, не изменяя правила синхронизации по умолчанию. 

Используйте один из следующих методов для сужения области объектов, которые синхронизируются.

- атрибут cloudFiltered
- Подразделение фильтрации

Если уменьшить область пользователей, синхронизируя синхронизации хэша паролей для пользователей отфильтрованные горизонтального также прекращается. Если объекты уже синхронизация, после того, как область, отфильтрованные горизонтального объекты будут удалены из целевой каталог. По этой причине убедитесь, очень тщательно области.

>[!IMPORTANT] 
> Расширяя область объекты, которые заданы для Azure AD Connect не рекомендуется. Это затрудняет группы поддержки Майкрософт понять настройки. Если необходимо увеличить область объектов, измените существующее правило, клонировать его и отключите исходное правило. 

### <a name="cloudfiltered-attribute"></a>атрибут cloudFiltered
Этот атрибут нельзя установить в Active Directory. Значение этого атрибута, добавив новое входящее правило. Затем можно использовать **преобразования** и **выражение** для установки этого атрибута в метавселенной. В следующем примере показано, что вы не хотите синхронизировать все пользователи, отдел, имя которого начинается с **HRD** (без учета регистра):

`cloudFiltered <= IIF(Left(LCase([department]), 3) = "hrd", True, NULL)`

Мы сначала преобразуется отдел из источника (Active Directory) в нижний регистр. Затем, используя `Left` функции, мы заняло только первые три символа и сравнили ее с `hrd`. Если он соответствует значение присваивается `True`, в противном случае `NULL`. В значение null, другие правила с более низким приоритетом (выше число) доступна для записи с другим условием. Выполнения предварительной версии на один объект для проверки правила синхронизации, как упоминалось в [правило синхронизации Validate](#validate-sync-rule) раздел.

![Создать параметры правила синхронизации входящих подключений](media/how-to-connect-fix-default-rules/default7a.png)

### <a name="organizational-unit-filtering"></a>Фильтрация подразделения.
Можно создать один или несколько подразделений (OU) и переместить объекты, которые вы не хотите синхронизировать эти подразделения. Затем настройте фильтрации в Azure AD Connect Подразделений. Запустите **Azure AD Connect** из значка на рабочем столе и выберите следующие параметры. Можно также настроить фильтрации во время установки Azure AD Connect Подразделений. 

![Azure AD Connect дополнительные задачи](media/how-to-connect-fix-default-rules/default8.png)

Следуйте указаниям мастера и удалите OU, не требуется синхронизировать.

![Azure AD Connect доменов и Подразделений, параметры фильтрации](media/how-to-connect-fix-default-rules/default9.png)

## <a name="change-join-condition"></a>Изменение условия соединения
Используйте условия соединения по умолчанию, настроенные с Azure AD Connect. Изменение условия соединения по умолчанию затрудняет поддержки Майкрософт, чтобы понять, настройки и поддержки продукта.

## <a name="validate-sync-rule"></a>Проверить правило синхронизации
Правило синхронизации вновь добавленный можно проверить с помощью функции предварительной версии, не выполняя цикл полной синхронизации. В Azure AD Connect, выберите **служба синхронизации**.

![Azure AD Connect с выделенной службой синхронизации](media/how-to-connect-fix-default-rules/default10.png)

Выберите **поиск в метавселенной**. Выберите объект области как **person**выберите **добавить предложение**и укажите условия поиска. Затем выберите **поиска**и дважды щелкните объект в результатах поиска. Убедитесь, что данные в Azure AD Connect не требует обновления для этого объекта, выполнив импорт и синхронизация в лесу, прежде чем выполнить этот шаг.

![Synchronization Service Manager](media/how-to-connect-fix-default-rules/default11.png)

На **свойства объекта метавселенной**выберите **соединители**, выберите объект в соответствующий разъем (лес) и выберите **свойства...** .

![Свойства объекта метавселенной](media/how-to-connect-fix-default-rules/default12.png)

Выберите **Предварительный просмотр...**

![Свойства объекта пространства соединителя](media/how-to-connect-fix-default-rules/default13a.png)

В окне предварительного просмотра выберите **создать предварительный просмотр** и **импорта потока атрибута** в левой области.

![Предварительный просмотр](media/how-to-connect-fix-default-rules/default14.png)
 
Здесь, обратите внимание, что только что добавленного правила для объекта задал `cloudFiltered` атрибута в значение true.

![Предварительный просмотр](media/how-to-connect-fix-default-rules/default15a.png)
 
Чтобы сравнить измененные правила, правила по умолчанию, экспортируйте и правил отдельно, как текстовые файлы. Эти правила экспортируются как файл сценария PowerShell. Их можно сравнить с помощью любого средства сравнения файлов (например, программы windiff) для просмотра изменений. 
 
Обратите внимание, что правила, измененный в `msExchMailboxGuid` атрибут заменен на **выражение** типа, вместо **прямой**. Кроме того, значение будет изменено на **NULL** и **ExecuteOnce** параметр. Можно игнорировать различия идентификатор и приоритет. 

![выходные данные средства Windiff](media/how-to-connect-fix-default-rules/default17.png)
 
Чтобы исправить свои правила, чтобы изменить их настройки по умолчанию, удалить измененный правило и включите правило по умолчанию. Убедитесь, что вы не потеряете настройки, которую вы пытаетесь достичь. Когда вы будете готовы, запустите **полную синхронизацию**.

## <a name="next-steps"></a>Дальнейшие действия
- [Оборудование и предварительные требования](how-to-connect-install-prerequisites.md) 
- [Стандартные параметры](how-to-connect-install-express.md)
- [Настраиваемые параметры](how-to-connect-install-custom.md)



