---
title: Активация приглашения в службе совместной работы B2B — Azure AD
description: Здесь описан процесс активации приглашения в службе совместной работы Azure AD B2B для пользователей, включая принятие условий конфиденциальности.
services: active-directory
ms.service: active-directory
ms.subservice: B2B
ms.topic: conceptual
ms.date: 05/11/2020
ms.author: mimart
author: msmimart
manager: celestedg
ms.reviewer: elisol
ms.collection: M365-identity-device-management
ms.openlocfilehash: 2bbfd0027f9de93ee939815853f5141044404c53
ms.sourcegitcommit: a8ee9717531050115916dfe427f84bd531a92341
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/12/2020
ms.locfileid: "83199494"
---
# <a name="azure-active-directory-b2b-collaboration-invitation-redemption"></a>Активация приглашения службы совместной работы Azure Active Directory B2B

В этой статье описываются способы доступа гостевых пользователей к ресурсам и процесс согласия, который они могут столкнуться. Если вы отправляете приглашению по электронной почте приглашение, оно включает ссылку, которую может активировать гостевой пользователь, чтобы получить доступ к вашему приложению или порталу. Сообщение электронной почты с приглашением — лишь один из способов получения доступа к вашим ресурсам гостями. В качестве альтернативы можно добавить гостей в каталог и предоставить им прямую ссылку на портал или приложение, к которому вы хотите предоставить общий доступ. Независимо от используемого метода, гости проходят через процесс предоставления согласия в первый раз. Этот процесс гарантирует, что ваши гости согласны с условиями конфиденциальности и принимают все настроенные [условия использования](https://docs.microsoft.com/azure/active-directory/governance/active-directory-tou) .

При добавлении гостевого пользователя в каталог учетная запись гостевого пользователя имеет состояние согласия (отображается в PowerShell), изначально установленное в **пендингакцептанце**. Этот параметр сохраняется до тех пор, пока гостевой компьютер не примет ваше приглашение и соглашается с политикой конфиденциальности и условиями использования. После этого состояние согласия изменится на **принято**, и страницы согласия больше не будут представлены гостевой системе.

   > [!IMPORTANT]
   > **Начиная с 31 марта 2021**г. Корпорация Майкрософт больше не будет поддерживать погашение приглашений, создавая неуправляемые учетные записи и клиенты Azure AD для сценариев совместной работы B2B. В ходе подготовки мы советуем клиентам использовать [однократную проверку подлинности с помощью секретного кода](one-time-passcode.md). Мы будем рады вашим отзывам о данной общедоступной предварительной версии и вам понравится создавать еще больше способов совместной работы.

## <a name="redemption-through-the-invitation-email"></a>Активация с помощью приглашения по электронной почте

При добавлении гостевого пользователя в каталог с [помощью портал Azure](https://docs.microsoft.com/azure/active-directory/b2b/b2b-quickstart-add-guest-users-portal)на гостевом компьютере отправляется приглашение по электронной почте. Вы также можете отправить приглашения по электронной почте, когда вы [используете PowerShell](https://docs.microsoft.com/azure/active-directory/b2b/b2b-quickstart-invite-powershell) для добавления гостевых пользователей в каталог. Ниже приведено описание взаимодействия с гостевой системой при активации ссылки в сообщении электронной почты.

1. Гостевая программа получает [приглашение по электронной почте](https://docs.microsoft.com/azure/active-directory/b2b/invitation-email-elements) , отправленное из **приглашений Майкрософт**.
2. Гостевая ОС выбирает **приглашение принять** в сообщении.
3. Гость будет использовать собственные учетные данные для входа в каталог. Если у гостя нет учетной записи, которая может быть Федеративной для каталога, а функция одноразового [кода (OTP)](https://docs.microsoft.com/azure/active-directory/b2b/one-time-passcode) не включена, Гостевая система предлагает создать личную учетную запись [MSA](https://support.microsoft.com/help/4026324/microsoft-account-how-to-create) или [самостоятельный доступ к Azure AD](https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-self-service-signup). Дополнительные сведения см. в статье о [потоке активации приглашения](#invitation-redemption-flow) .
4. На гостевой основе вы узнаете, [как описано ниже](#consent-experience-for-the-guest) .

## <a name="redemption-through-a-direct-link"></a>Активация с помощью прямой ссылки

В качестве альтернативы электронному письму с приглашением вы можете предоставить Гостевой веб-каналу прямую ссылку на ваше приложение или портал. Сначала необходимо добавить гостевого пользователя в каталог с помощью [портал Azure](https://docs.microsoft.com/azure/active-directory/b2b/b2b-quickstart-add-guest-users-portal) или [PowerShell](https://docs.microsoft.com/azure/active-directory/b2b/b2b-quickstart-invite-powershell). Затем можно использовать любой из [настраиваемых способов развертывания приложений для пользователей](https://docs.microsoft.com/azure/active-directory/manage-apps/end-user-experiences), включая ссылки на прямые входы. Когда гостевая программа использует прямую ссылку, а не электронное письмо с приглашением, она по-прежнему будет работать с согласия пользователя в первый раз.

> [!IMPORTANT]
> Прямая ссылка должна быть специфичной для клиента. Иными словами, он должен включать идентификатор клиента или проверенный домен, чтобы Гостевая учетная запись могла проходить проверку подлинности в клиенте, где расположено общее приложение. Общий URL-адрес, такой как, https://myapps.microsoft.com не будет работать для гостя, так как он будет перенаправляться на домашний клиент для проверки подлинности. Ниже приведены некоторые примеры прямых связей с контекстом клиента.
 > - Панель доступа к приложениям: https://myapps.microsoft.com/?tenantid=&lt ; идентификатор клиента&gt; 
 > - Панель доступа к приложениям для проверенного домена: https://myapps.microsoft.com/&lt ; проверенный домен&gt;
 > - Портал Azure: https://portal.azure.com/&lt ; идентификатор клиента&gt;
 > - Отдельное приложение: см. статью использование [прямого входа](../manage-apps/end-user-experiences.md#direct-sign-on-links) .

В некоторых случаях рекомендуется использовать приглашение по электронной почте по прямой ссылке. Если эти особые случаи важны для вашей организации, рекомендуется пригласить пользователей с помощью методов, которые по-прежнему отправляют приглашение по электронной почте:
 - У пользователя нет учетной записи Azure AD, MSA или учетной записи электронной почты в федеративной организации. Если вы не используете одноразовую функцию секретного кода, гостевой службе необходимо активировать электронное письмо с приглашением, чтобы получить инструкции по созданию MSA.
 - Иногда объект приглашенного пользователя не может использовать адрес электронной почты из-за конфликта с контактным объектом (например, контактным объектом Outlook). В этом случае пользователю необходимо щелкнуть URL-адрес активации в приглашении, полученном по электронной почте.
 - Пользователь может выполнить вход с псевдонимом адреса электронной почты, по которому поступило приглашение (Псевдоним — это дополнительный адрес электронной почты, связанный с учетной записью электронной почты.) В этом случае пользователь должен щелкнуть URL-адрес активации в сообщении с приглашением.

## <a name="invitation-redemption-flow"></a>Поток активации приглашения

Когда пользователь щелкает ссылку **принять приглашение** в [приглашении по электронной почте](invitation-email-elements.md), Azure AD автоматически активирует приглашение на основе потока активации, как показано ниже:

![Снимок экрана, показывающий схему "поток активации"](media/redemption-experience/invitation-redemption-flow.png)

**Если имя участника-пользователя (UPN) совпадает с существующей учетной записью Azure AD и личной MSA, пользователю будет предложено выбрать учетную запись, с которой нужно активировать.*

1. Azure AD выполняет обнаружение на основе пользователя, чтобы определить, существует ли этот пользователь в [существующем клиенте Azure AD](https://docs.microsoft.com/azure/active-directory/b2b/what-is-b2b#easily-add-guest-users-in-the-azure-ad-portal).

2. Если администратор включил [прямую федерацию](https://docs.microsoft.com/azure/active-directory/b2b/direct-federation), Azure AD проверяет, соответствует ли суффикс домена пользователя домену настроенного поставщика удостоверений SAML/WS-подач, и перенаправляет пользователя к предварительно настроенному поставщику удостоверений.

3. Если администратор включил [Google Federation](https://docs.microsoft.com/azure/active-directory/b2b/google-federation), Azure AD проверяет, является ли суффикс домена пользователя gmail.com или googlemail.com, и перенаправляет пользователя в Google.

4. Процесс активации проверяет наличие у пользователя существующего личного [учетная запись Майкрософт (MSA)](https://support.microsoft.com/help/4026324/microsoft-account-how-to-create).

5. После идентификации **домашнего каталога** пользователя пользователь отправляется соответствующему поставщику удостоверений для входа.  

6. Если в шагах 1 и 4 не удается найти корневой каталог для приглашенного пользователя, Azure AD определяет, включил ли приглашенный клиент для гостей функцию одноразового [секретного кода (OTP) по электронной почте](https://docs.microsoft.com/azure/active-directory/b2b/one-time-passcode) .

7. Если [включен одновременный секретный код для гостей](https://docs.microsoft.com/azure/active-directory/b2b/one-time-passcode#when-does-a-guest-user-get-a-one-time-passcode), он отправляется пользователю через приглашенный адрес электронной почты. Пользователь получит и введет этот секретный код на странице входа в Azure AD.

8. Если секретный код одноразового пароля для гостей отключен, Azure AD проверяет суффикс домена, чтобы определить, принадлежит ли он учетной записи потребителя. В этом случае пользователю предлагается создать личное [учетная запись Майкрософт](https://support.microsoft.com/help/4026324/microsoft-account-how-to-create). В противном случае пользователю будет предложено создать [учетную запись самообслуживания Azure AD](https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-self-service-signup).

9. Azure AD попытается создать [учетную запись самообслуживания Azure AD](https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-self-service-signup) , проверив доступ к электронной почте. Проверка учетной записи выполняется путем отправки кода в сообщение электронной почты, когда пользователь получает и отправляет его в Azure AD. Однако если клиент приглашенного пользователя является федеративным или в поле AllowEmailVerifiedUsers в клиенте приглашенного пользователя установлено значение false, то пользователь не сможет завершить процедуру активации, и последовательность приведет к ошибке. Дополнительные сведения см. в разделе [Устранение неполадок Azure Active Directory службы совместной работы B2B](https://docs.microsoft.com/azure/active-directory/b2b/troubleshoot#the-user-that-i-invited-is-receiving-an-error-during-redemption).

10. Пользователю предлагается создать личную [учетная запись Майкрософт (MSA)](https://support.microsoft.com/help/4026324/microsoft-account-how-to-create).

11. После проверки подлинности для правильного поставщика удостоверений пользователь перенаправляется в Azure AD для выполнения [согласия](https://docs.microsoft.com/azure/active-directory/b2b/redemption-experience#consent-experience-for-the-guest).  

Для JIT-активации, где погашение осуществляется через связь с клиентским приложением, шаги с 8 по 10 недоступны. Если пользователь переходит на шаг 6 и функция секретного кода одноразового пароля не включена, пользователь получает сообщение об ошибке и не может активировать приглашение. Чтобы предотвратить эту ошибку, администраторы должны либо [включить одноразовый пароль для электронной почты](https://docs.microsoft.com/azure/active-directory/b2b/one-time-passcode#when-does-a-guest-user-get-a-one-time-passcode) , либо убедиться, что пользователь щелкнет ссылку на приглашение.

## <a name="consent-experience-for-the-guest"></a>Условия предоставления согласия для гостей

Когда гостевая программа подписывается на доступ к ресурсам в партнерской организации впервые, они проходят по следующим страницам. 

1. Гость проверяет страницу **разрешений на проверку** , описывающую заявление о конфиденциальности в приглашенной Организации. Чтобы продолжить, пользователь должен **принять** использование своих сведений в соответствии с политиками конфиденциальности в приглашенной Организации.

   ![Снимок экрана со страницей "Проверить разрешения"](media/redemption-experience/review-permissions.png) 

   > [!NOTE]
   > Сведения о том, как администратор клиента может получить ссылку на заявление о конфиденциальности организации, см. в статье [How-to: Add your organization's privacy info in Azure Active Directory](https://aka.ms/adprivacystatement) (Практическое руководство. Добавление сведений о конфиденциальности организации в Azure Active Directory).

2. Если условия использования настроены, гостевой компьютер откроет и проверит условия использования, а затем выберет параметр **принять**. 

   ![Снимок экрана с новыми условиями использования](media/redemption-experience/terms-of-use-accept.png) 

   Вы можете настроить [условия использования](../governance/active-directory-tou.md) в **организационных отношениях** (или **внешних удостоверениях**) > **условия использования**.

3. Если не указано иное, гость перенаправляется на панель доступа к приложениям, в которой перечислены приложения, к которым может получить доступ гость.

   ![Снимок экрана: панель доступа к приложениям](media/redemption-experience/myapps.png) 

В каталоге **приглашение гостя принимает** значение **Да**. При создании MSA в **источнике гостевой системы** отображается **учетная запись Майкрософт**. Дополнительные сведения о свойствах учетной записи гостевого пользователя см. в разделе [Свойства пользователя службы совместной работы Azure AD B2B](user-properties.md). 

## <a name="next-steps"></a>Дальнейшие действия

- [Что такое служба совместной работы Azure AD B2B?](what-is-b2b.md)
- [Добавление пользователей службы совместной работы B2B на портале Azure](add-users-administrator.md)
- [How do information workers add B2B collaboration users to Azure Active Directory?](add-users-information-worker.md) (Как информационные работники могут добавить пользователей для совместной работы B2B в Azure Active Directory)
- [Добавление пользователей службы совместной работы Azure Active Directory B2B с помощью PowerShell](customize-invitation-api.md#powershell)
- [Выход гостевого пользователя из организации](leave-the-organization.md)
