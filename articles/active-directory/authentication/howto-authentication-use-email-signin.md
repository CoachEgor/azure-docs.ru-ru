---
title: Вход с помощью электронной почты в качестве альтернативного имени пользователя для Azure Active Directory
description: Узнайте, как разрешить пользователям входить в Azure Active Directory, используя свой адрес электронной почты в качестве альтернативного имени пользователя (предварительная версия).
services: active-directory
ms.service: active-directory
ms.subservice: authentication
ms.topic: how-to
ms.date: 05/22/2020
ms.author: iainfou
author: iainfoulds
manager: daveba
ms.reviewer: scottsta
ms.openlocfilehash: ed317039e683ef36054d5ace612e09ca75dfa11e
ms.sourcegitcommit: 0b80a5802343ea769a91f91a8cdbdf1b67a932d3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/25/2020
ms.locfileid: "83837313"
---
# <a name="sign-in-to-azure-using-email-as-an-alternate-login-id-preview"></a>Вход в Azure с помощью электронной почты в качестве альтернативного имени пользователя (предварительная версия).

Многие организации хотят разрешить пользователям входить в Azure, используя те же учетные данные, что и в их локальной среде каталогов. При таком подходе, известном как гибридная проверка подлинности, пользователям нужно запоминать только один набор учетных данных.

Некоторые организации не перешли к гибридной проверке подлинности по следующим причинам.

* По умолчанию имя участника-пользователя (UPN) Azure Active Directory (Azure AD) идентично UPN в локальном каталоге.
* Изменение имени участника-пользователя Azure AD создает неверное соответствие между локальными средами и окружениями Azure, что может вызвать проблемы с определенными приложениями и службами.
* Из-за бизнес-требований или по соображениям соответствия организация может не желать использовать локальное имя участника-пользователя для входа в Azure.

Для помощи в переходе на гибридную проверку подлинности Azure AD теперь позволяет изменять настройки, чтобы позволить пользователям входить в Azure, используя электронную почту в качестве альтернативного имени пользователя в проверенном домене. Например, если *Contoso* сменила имя на *Fabrikam*, вместо того чтобы продолжать входить с помощью устаревшего имени участника-пользователя `balas@contoso.com`, можно использовать адрес электронной почты в качестве альтернативного имени пользователя. Чтобы получить доступ к приложению или службам, пользователи будут входить в Azure, используя назначенный им адрес электронной почты, например `balas@fabrikam.com`.

|     |
| --- |
| Вход в Azure AD с помощью электронной почты в качестве альтернативного имени пользователя — это общедоступная предварительная версия функции Azure Active Directory. См. подробные сведения о [дополнительных условиях использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).|
|     |

## <a name="overview-of-azure-ad-sign-in-approaches"></a>Обзор подходов к входу в Azure AD

Имена участников-пользователей (UPN) — это уникальные идентификаторы учетной записи пользователя как в локальном каталоге, так и в Azure AD. Каждая учетная запись пользователя в каталоге представлена именем участника-пользователя, например `balas@contoso.com`. По умолчанию при синхронизации локальной среды доменных служб Active Directory (AD DS) с Azure AD имя участника-пользователя Azure AD задается в соответствии с локальным именем участника-пользователя.

Для многих организациях соответствие между локальным именем участника-пользователя и этим именем Azure AD вполне нормально. Когда пользователи входят в приложения и службы Azure, они используют имя участника-пользователя Azure AD. Однако некоторые организации не могут использовать совпадающие имена участников-пользователей для входа в систему из-за бизнес-политик или проблем взаимодействия с пользователем.

У организаций, которые не могут использовать совпадающие имена участников-пользователей в Azure AD, есть несколько вариантов.

* Один из возможных подходов заключается в задании отличающегося имени участника-пользователя Azure AD в зависимости от потребностей бизнеса, например `balas@fabrikam.com`.
    * Однако не все приложения и службы совместимы с использованием разных значений локального имени участника-пользователя и имени участника-пользователя Azure AD.
* Лучше обеспечить, чтобы локальные имена участников-пользователей совпадали с именами в Azure AD, а затем настроить Azure AD, чтобы позволить пользователям входить в Azure, используя адрес электронной почты в качестве альтернативного имени пользователя.

Используя адрес электронной почты в качестве альтернативного имени пользователя, пользователи могут входить в Azure, вводя свое имя участника-пользователя, но также могут выполнять вход с помощью своей электронной почты. Для этого необходимо определить адрес электронной почты в атрибуте пользователя *ProxyAddresses*, в локальном каталоге. Этот атрибут *ProxyAddress* поддерживает один или несколько адресов электронной почты.

## <a name="synchronize-sign-in-email-addresses-to-azure-ad"></a>Синхронизация адресов электронной почты для входа в Azure AD

Традиционная проверка подлинности доменных служб Active Directory Services (AD DS) или служб федерации Active Directory (AD FS) производится непосредственно в вашей сети и обрабатывается вашей инфраструктурой AD DS. При использовании гибридной проверки подлинности пользователи могут вместо этого входить непосредственно в Azure AD.

Для поддержки такого подхода к гибридной проверке подлинности следует синхронизировать локальную среду AD DS с Azure AD с помощью [Azure AD Connect][azure-ad-connect] и настроить ее для использования синхронизации хэшей паролей (PHS) или сквозной проверки подлинности (PTA).

В обоих параметрах конфигурации пользователь отправляет свое имя пользователя и пароль в Azure AD, где они проверяются и пользователю выдается билет. Вход пользователей в Azure AD избавляет организацию от необходимости размещать инфраструктуру AD FS и управлять ею.

![Схема гибридной идентификации Azure AD с синхронизацией хэша паролей.](media/howto-authentication-use-email-signin/hybrid-password-hash-sync.png)

![Схема гибридной идентификации Azure AD со сквозной аутентификацией.](media/howto-authentication-use-email-signin/hybrid-pass-through-authentication.png)

Один из пользовательских атрибутов, которые автоматически синхронизируются Azure AD Connect, является *ProxyAddresses*. Если у пользователей есть адрес электронной почты, определенный в локальной среде AD DS как часть атрибута *ProxyAddresses*, он автоматически синхронизируется с Azure AD. Этот адрес электронной почты можно затем использовать непосредственно в процессе входа в Azure AD как альтернативное имя пользователя.

> [!IMPORTANT]
> Только сообщения электронной почты в проверенных доменах для клиента синхронизируются с Azure AD. Каждый клиент Azure AD имеет один или несколько проверенных доменов, у которых имеется проверенный владелец и которые уникально привязаны к клиенту.
>
> Дополнительные сведения см. в статье [Добавление и проверка пользовательского доменного имени для облачной службы Azure][verify-domain].

Дополнительные сведения см. в статье [Выбор правильного метода аутентификации для решения гибридной идентификации Azure AD][hybrid-auth-methods].

## <a name="enable-user-sign-in-with-an-email-address"></a>Включение входа пользователя с помощью адреса электронной почты

После того как пользователи с примененным атрибутом *ProxyAddresses* синхронизируются с Azure AD с помощью Azure AD Connect, необходимо включить эту функцию, чтобы пользователи могли входить, используя электронную почту в качестве альтернативного имени пользователя для входа в клиент. Эта функция сообщает серверам входа Azure AD, что нужно сравнивать имя входа не только со значениями имени участника-пользователя, но и со значениями *ProxyAddresses* для адреса электронной почты.

Сейчас, на этапе предварительной версии, вход с помощью электронной почты в качестве альтернативного имени пользователя можно включить только с помощью PowerShell. Для выполнения следующих действий требуются разрешения *администратора клиента*.

1. Откройте сеанс PowerShell от имени администратора, а затем установите модуль *AzureADPreview* с помощью командлета [Install-Module][Install-Module]:

    ```powershell
    Install-Module AzureADPreview
    ```

    При появлении запроса выберите **Y** для установки NuGet или установки из ненадежного репозитория.

1. Войдите в клиент Azure AD от имени *администратора клиента* с помощью командлета [Connect-AzureAD][Connect-AzureAD]:

    ```powershell
    Connect-AzureAD
    ```

    Команда возвращает информацию о вашей учетной записи, среде и идентификаторе клиента.

1. Убедитесь, что политика *HomeRealmDiscoveryPolicy* уже существует в клиенте, использовав командлет [Get-AzureADPolicy][Get-AzureADPolicy] следующим образом.

    ```powershell
    Get-AzureADPolicy | where-object {$_.Type -eq "HomeRealmDiscoveryPolicy"} | fl *
    ```

1. Если политика в настоящее время не настроена, команда не возвращает ничего. Если возвращается политика, пропустите этот шаг и перейдите к следующему шагу, чтобы обновить существующую политику.

    Чтобы добавить политику *HomeRealmDiscoveryPolicy* в клиент, используйте командлет [New-AzureADPolicy][New-AzureADPolicy] и задайте для атрибута *AlternateIdLogin* значение *"Enabled": true*, как показано в следующем примере.

    ```powershell
    New-AzureADPolicy -Definition @('{"HomeRealmDiscoveryPolicy" :{"AlternateIdLogin":{"Enabled": true}}}') `
        -DisplayName "BasicAutoAccelerationPolicy" `
        -IsOrganizationDefault $true `
        -Type "HomeRealmDiscoveryPolicy"
    ```

    После успешного создания политики эта команда возвращает идентификатор политики, как показано в следующем примере выходных данных:

    ```powershell
    Id                                   DisplayName                 Type                     IsOrganizationDefault
    --                                   -----------                 ----                     ---------------------
    5de3afbe-4b7a-4b33-86b0-7bbe308db7f7 BasicAutoAccelerationPolicy HomeRealmDiscoveryPolicy True
    ```

1. Если настроенная политика уже существует, проверьте, включен ли атрибут  *AlternateIdLogin* , как показано в следующем примере выходных данных политики:

    ```powershell
    Id : 5de3afbe-4b7a-4b33-86b0-7bbe308db7f7
    OdataType :
    AlternativeIdentifier :
    Definition : {{"HomeRealmDiscoveryPolicy" :{"AlternateIdLogin":{"Enabled": true}}}}
    DisplayName : BasicAutoAccelerationPolicy
    IsOrganizationDefault : True
    KeyCredentials : {}
    Type : HomeRealmDiscoveryPolicy
    ```

    Если политика существует, но атрибут *AlternateIdLogin* отсутствует или отключен или если в политике есть другие атрибуты, которые вы хотите сохранить, обновите существующую политику, используя командлет [Set-AzureADPolicy][Set-AzureADPolicy].

    > [!IMPORTANT]
    > При обновлении политики убедитесь, что в нее включены все старые параметры и новый атрибут  *AlternateIdLogin*.

    В следующем примере добавляется атрибут  *AlternateIdLogin* и сохраняется атрибут  *AllowCloudPasswordValidation*, который мог быть уже установлен:

    ```powershell
    Set-AzureADPolicy -id b581c39c-8fe3-4bb5-b53d-ea3de05abb4b `
        -Definition @('{"HomeRealmDiscoveryPolicy" :{"AllowCloudPasswordValidation":true,"AlternateIdLogin":{"Enabled": true}}}') `
        -DisplayName "BasicAutoAccelerationPolicy" `
        -IsOrganizationDefault $true `
        -Type "HomeRealmDiscoveryPolicy"
    ```

    Убедитесь, что обновленная политика отображает изменения и атрибут *AlternateIdLogin* включен:

    ```powershell
    Get-AzureADPolicy | where-object {$_.Type -eq "HomeRealmDiscoveryPolicy"} | fl *
    ```

## <a name="test-user-sign-in-with-email"></a>Проверка входа пользователя в систему с помощью электронной почты

Чтобы проверить возможность входа пользователей с помощью электронной почты, перейдите в [https://myprofile.microsoft.com][my-profile] и войдите, используя учетную запись пользователя на основе адреса электронной почты, например `balas@fabrikam.com`, а не имени участника-пользователя, например `balas@contoso.com`. Процедура входа в систему должна выглядеть так же, как и с событием входа на основе имени участника-пользователя.

## <a name="troubleshoot"></a>Диагностика

Если у пользователей возникают проблемы с событиями входа при помощи адреса электронной почты, ознакомьтесь со следующими действиями по устранению неполадок.

1. Убедитесь, что в учетной записи пользователя задан адрес электронной почты для атрибута *ProxyAddresses* в локальной среде AD DS.
1. Убедитесь, что служба Azure AD Connect настроена и успешно синхронизирует учетные записи пользователей из локальной среды AD DS в Azure AD.
1. Убедитесь, что в политике Azure AD *HomeRealmDiscoveryPolicy* атрибут *AlternateIdLogin* установлен на *"Enabled": true*:

    ```powershell
    Get-AzureADPolicy | where-object {$_.Type -eq "HomeRealmDiscoveryPolicy"} | fl *
    ```

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о гибридных удостоверениях, например прокси Azure AD App или доменных службах Azure AD, см. в статье [Гибридное удостоверение Azure AD для доступа и управления локальными рабочими нагрузками][hybrid-overview].

Дополнительные сведения об операциях гибридной идентификации см. в работах по синхронизации [как выполняется синхронизация хэшей паролей][phs-overview] или [сквозная проверка подлинности][pta-overview].

<!-- INTERNAL LINKS -->
[verify-domain]: ../fundamentals/add-custom-domain.md
[hybrid-auth-methods]: ../hybrid/choose-ad-authn.md
[azure-ad-connect]: ../hybrid/whatis-azure-ad-connect.md
[hybrid-overview]: ../hybrid/cloud-governed-management-for-on-premises.md
[phs-overview]: ../hybrid/how-to-connect-password-hash-synchronization.md
[pta-overview]: ../hybrid/how-to-connect-pta-how-it-works.md

<!-- EXTERNAL LINKS -->
[Install-Module]: /powershell/module/powershellget/install-module
[Connect-AzureAD]: /powershell/module/azuread/connect-azuread
[Get-AzureADPolicy]: /powershell/module/azuread/get-azureadpolicy
[New-AzureADPolicy]: /powershell/module/azuread/new-azureadpolicy
[Set-AzureADPolicy]: /powershell/module/azuread/set-azureadpolicy
[my-profile]: https://myprofile.microsoft.com
