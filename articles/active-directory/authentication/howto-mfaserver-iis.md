---
title: Проверка подлинности IIS и сервер Azure MFA — Azure Active Directory
description: Развертывание аутентификации IIS на сервере Многофакторной идентификации Azure.
services: multi-factor-authentication
ms.service: active-directory
ms.subservice: authentication
ms.topic: how-to
ms.date: 07/11/2018
ms.author: iainfou
author: iainfoulds
manager: daveba
ms.reviewer: michmcla
ms.collection: M365-identity-device-management
ms.openlocfilehash: f6189e2bc6c3c8f28b767902b525b03cb72968bc
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "80652899"
---
# <a name="configure-azure-multi-factor-authentication-server-for-iis-web-apps"></a>Настройка сервера Многофакторной идентификации Azure для веб-приложений IIS

С помощью раздела аутентификации IIS для сервера Многофакторной идентификации Azure (MFA) можно включить и настроить аутентификацию IIS для интеграции с веб-приложениями Microsoft IIS. Сервер Azure MFA устанавливает подключаемый модуль, который может фильтровать запросы к веб-серверу IIS, для добавления Многофакторной идентификации Azure. Подключаемый модуль IIS обеспечивает поддержку проверки подлинности на основе форм и встроенной проверки подлинности HTTP Windows. Также можно настроить доверенные IP-адреса для исключения внутренних IP-адресов из двухфакторной проверки подлинности.

> [!IMPORTANT]
> По состоянию на 1 июля 2019 Корпорация Майкрософт больше не будет предлагать сервер MFA для новых развертываний. Новые клиенты, желающие требовать многофакторную проверку подлинности пользователей, должны использовать службу многофакторной идентификации Azure на основе облачных служб. Существующие клиенты, которые активировали сервер MFA до 1 июля, смогут скачать последнюю версию, будущие обновления и создать учетные данные активации обычным образом.

![Проверка подлинности IIS на сервере MFA](./media/howto-mfaserver-iis/iis.png)

## <a name="using-form-based-iis-authentication-with-azure-multi-factor-authentication-server"></a>Использование проверки подлинности IIS на основе форм с сервером Многофакторной идентификации Azure

Чтобы защитить веб-приложение IIS, использующее аутентификацию на основе форм, установите сервер Многофакторной идентификации Azure на веб-сервер IIS и настройте его согласно следующей процедуре.

1. На сервере Многофакторной идентификации Azure щелкните значок аутентификации IIS в меню слева.
2. Перейдите на вкладку **на основе форм** .
3. Нажмите кнопку **Добавить**.
4. Чтобы автоматически определить имя пользователя, пароль и домен, введите URL-адрес входа ( `https://localhost/contoso/auth/login.aspx`например,) в диалоговом окне "Автоматическая настройка веб-сайта на основе форм" и нажмите кнопку **ОК**.
5. Установите флажок **Требуется сопоставление пользователей многофакторной проверки подлинности**, если все пользователи, которые были или будут импортированы на сервер, подлежат многофакторной проверке подлинности. Если значительное число пользователей еще не импортировано на сервер и/или будет исключено из многофакторной проверки подлинности, не устанавливайте флажок.
6. Если переменные страницы не удается обнаружить автоматически, щелкните **Указать вручную** в диалоговом окне "Автоматическая настройка веб-сайта на основе форм".
7. В диалоговом окне «Добавление веб-сайта на основе форм» URL-адрес страницы входа в поле «URL-адрес для отправки» и введите имя приложения (необязательно). Имя приложения отображается в отчетах сервера Многофакторной идентификации Azure. Кроме того, оно может отображаться в SMS-сообщениях и сообщениях о проверке подлинности мобильного приложения.
8. Выберите правильный формат запроса. Для большинства веб-приложений устанавливается значение **POST или Get** .
9. Введите значения переменных имени пользователя, пароля и домена (если он отображается на странице входа). Чтобы найти имена полей ввода, перейдите на страницу входа в веб-браузере, щелкните ее правой кнопкой мыши и выберите пункт **Просмотр источника**.
10. Установите флажок **Требуется сопоставление пользователей многофакторной проверки подлинности**, если все пользователи, которые были или будут импортированы на сервер, подлежат многофакторной проверке подлинности. Если значительное число пользователей еще не импортировано на сервер и/или будет исключено из многофакторной проверки подлинности, не устанавливайте флажок.
11. Щелкните **Дополнительно**, чтобы просмотреть дополнительные параметры, позволяющие:

    - выбрать специальный файл страницы отказа;
    - поместить в кэш данные успешных операциях аутентификации на веб-сайте на определенный период времени с помощью файлов cookie.
    - Выберите способ аутентификации основных учетных данных в домене Windows, каталоге LDAP или сервере RADIUS.

12. Нажмите кнопку **ОК**, чтобы вернуться к диалоговому окну "Добавление веб-сайта на основе форм".
13. Нажмите кнопку **ОК**.
14. Когда переменные для URL-адреса и страницы будут введены или обнаружены, данные веб-сайта отобразятся на панели "На основе форм".

## <a name="using-integrated-windows-authentication-with-azure-multi-factor-authentication-server"></a>Использование встроенной проверки подлинности Windows с сервером Многофакторной идентификации Azure

Чтобы защитить веб-приложение IIS, использующее встроенную проверку подлинности HTTP Windows, установите сервер Azure MFA на веб-сервере IIS и настройте его согласно следующим инструкциям.

1. На сервере Многофакторной идентификации Azure щелкните значок аутентификации IIS в меню слева.
2. Перейдите на вкладку **http** .
3. Нажмите кнопку **Добавить**.
4. В диалоговом окне "Добавление базового URL-адреса" введите URL-адрес сайта, где выполняется проверка подлинности HTTP (например <http://localhost/owa>,), и укажите имя приложения (необязательно). Имя приложения отображается в отчетах сервера Многофакторной идентификации Azure. Кроме того, оно может отображаться в SMS-сообщениях и сообщениях о проверке подлинности мобильного приложения.
5. Задайте параметры «Время ожидания простоя» и «Максимальное время сеанса», если заданные по умолчанию значения этих параметров недостаточны.
6. Установите флажок **Требуется сопоставление пользователей многофакторной проверки подлинности**, если все пользователи, которые были или будут импортированы на сервер, подлежат многофакторной проверке подлинности. Если значительное число пользователей еще не импортировано на сервер и/или будет исключено из многофакторной проверки подлинности, не устанавливайте флажок.
7. При необходимости установите флажок **кэш файлов cookie** .
8. Нажмите кнопку **ОК**.

## <a name="enable-iis-plug-ins-for-azure-multi-factor-authentication-server"></a>Включение подключаемых модулей IIS для сервера Многофакторной идентификации Azure

После настройки URL-адресов и параметров проверки подлинности на основе форм или HTTP необходимо выбрать расположения, в которые будут загружены подключаемые модули IIS для сервера Многофакторной идентификации Azure, которые затем будут включены в IIS. Выполните перечисленные ниже действия.

1. Если выполняется в IIS 6, перейдите на вкладку **ISAPI** . Выберите веб-сайт, на котором выполняется веб – приложение (например, веб-сайт по умолчанию), чтобы включить подключаемый модуль фильтра ISAPI многофакторной идентификации Azure для этого сайта.
2. Если выполняется в IIS 7 или более поздней версии, перейдите на вкладку **собственный модуль** . Выберите сервер, веб-сайты или приложения, чтобы включить подключаемый модуль IIS на нужных уровнях.
3. Установите флажок **Включить проверку подлинности IIS** в верхней части экрана. Теперь выбранное приложение IIS защищено службой Многофакторной идентификации Azure. Убедитесь, что пользователи были импортированы на сервер.

## <a name="trusted-ips"></a>Надежные IP-адреса

Список «Надежные IP-адреса» позволяет обойти службу Многофакторной идентификации Azure при обработке таких запросов на веб-сайты, которые исходят от определенных IP-адресов или подсетей. Например, вам может понадобиться исключить пользователей из проверки Многофакторной идентификации Azure, если они входят с офисного компьютера. Для этого офисную подсеть нужно внести в список "Надежные IP-адреса". Для настройки надежных IP-адресов используйте следующую процедуру.

1. В разделе проверки подлинности IIS перейдите на вкладку **Надежные IP-адреса**.
2. Нажмите кнопку **Добавить**.
3. Когда откроется диалоговое окно Добавление надежных IP-адресов, выберите переключатель **один IP**, **диапазон IP-** адресов или **подсеть** .
4. Введите IP-адрес, диапазон IP-адресов или подсети, которые должны быть разрешены. Указывая подсеть, выберите соответствующую маску сети, затем нажмите кнопку **ОК**.
