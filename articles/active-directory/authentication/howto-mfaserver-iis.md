---
title: Проверка подлинности IIS и сервер Azure MFA — Azure Active Directory
description: Развертывание аутентификации IIS на сервере Многофакторной идентификации Azure.
services: multi-factor-authentication
ms.service: active-directory
ms.subservice: authentication
ms.topic: conceptual
ms.date: 07/11/2018
ms.author: joflore
author: MicrosoftGuyJFlo
manager: daveba
ms.reviewer: michmcla
ms.collection: M365-identity-device-management
ms.openlocfilehash: 2b7f76211fe810ce1db53e5afaa307d90317464a
ms.sourcegitcommit: 41ca82b5f95d2e07b0c7f9025b912daf0ab21909
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "67057393"
---
# <a name="configure-azure-multi-factor-authentication-server-for-iis-web-apps"></a>Настройка сервера Многофакторной идентификации Azure для веб-приложений IIS

С помощью раздела аутентификации IIS для сервера Многофакторной идентификации Azure (MFA) можно включить и настроить аутентификацию IIS для интеграции с веб-приложениями Microsoft IIS. Сервер Azure MFA устанавливает подключаемый модуль, который может фильтровать запросы к веб-серверу IIS, для добавления Многофакторной идентификации Azure. Подключаемый модуль IIS обеспечивает поддержку проверки подлинности на основе форм и встроенной проверки подлинности HTTP Windows. Также можно настроить доверенные IP-адреса для исключения внутренних IP-адресов из двухфакторной проверки подлинности.

> [!IMPORTANT]
> Начиная с 1 июля 2019 г. Корпорация Майкрософт больше не предоставляет многофакторной проверки Подлинности сервера для новых развертываний. Новых клиентов, которые хотите требовать многофакторную проверку подлинности от пользователей, их следует использовать многофакторную идентификацию Azure на основе облака. Существующие клиенты, которые активировали сервера MFA до 1 июля будет иметь возможность загрузить последнюю версию, будущие обновления и создать учетные данные активации обычным образом.

![Проверка подлинности IIS на сервере MFA](./media/howto-mfaserver-iis/iis.png)

## <a name="using-form-based-iis-authentication-with-azure-multi-factor-authentication-server"></a>Использование проверки подлинности IIS на основе форм с сервером Многофакторной идентификации Azure

Чтобы защитить веб-приложение IIS, использующее аутентификацию на основе форм, установите сервер Многофакторной идентификации Azure на веб-сервер IIS и настройте его согласно следующей процедуре.

1. На сервере Многофакторной идентификации Azure щелкните значок аутентификации IIS в меню слева.
2. Щелкните вкладку **На основе форм**.
3. Щелкните **Добавить**.
4. Чтобы автоматически определить переменные имени пользователя, пароль и домен, введите URL-адрес входа (например `https://localhost/contoso/auth/login.aspx`) в диалоговом окне веб-сайта и нажмите кнопку **ОК**.
5. Установите флажок **Требуется сопоставление пользователей многофакторной проверки подлинности**, если все пользователи, которые были или будут импортированы на сервер, подлежат многофакторной проверке подлинности. Если значительное число пользователей еще не импортировано на сервер и/или будет исключено из многофакторной проверки подлинности, не устанавливайте флажок.
6. Если переменные страницы не удается обнаружить автоматически, щелкните **Указать вручную** в диалоговом окне "Автоматическая настройка веб-сайта на основе форм".
7. В диалоговом окне «Добавление веб-сайта на основе форм» URL-адрес страницы входа в поле «URL-адрес для отправки» и введите имя приложения (необязательно). Имя приложения отображается в отчетах сервера Многофакторной идентификации Azure. Кроме того, оно может отображаться в SMS-сообщениях и сообщениях о проверке подлинности мобильного приложения.
8. Выберите правильный формат запроса. Для большинства веб-приложений это **POST или GET**.
9. Введите значения переменных имени пользователя, пароля и домена (если он отображается на странице входа). Чтобы найти имена полей ввода, перейдите на страницу входа в веб-браузере, щелкните ее правой кнопкой мыши и выберите пункт **Просмотр источника**.
10. Установите флажок **Требуется сопоставление пользователей многофакторной проверки подлинности**, если все пользователи, которые были или будут импортированы на сервер, подлежат многофакторной проверке подлинности. Если значительное число пользователей еще не импортировано на сервер и/или будет исключено из многофакторной проверки подлинности, не устанавливайте флажок.
11. Щелкните **Дополнительно**, чтобы просмотреть дополнительные параметры, позволяющие:

    - выбрать специальный файл страницы отказа;
    - поместить в кэш данные успешных операциях аутентификации на веб-сайте на определенный период времени с помощью файлов cookie.
    - Выберите способ аутентификации основных учетных данных в домене Windows, каталоге LDAP или сервере RADIUS.

12. Нажмите кнопку **ОК**, чтобы вернуться к диалоговому окну "Добавление веб-сайта на основе форм".
13. Последовательно выберите **ОК**.
14. Когда переменные для URL-адреса и страницы будут введены или обнаружены, данные веб-сайта отобразятся на панели "На основе форм".

## <a name="using-integrated-windows-authentication-with-azure-multi-factor-authentication-server"></a>Использование встроенной проверки подлинности Windows с сервером Многофакторной идентификации Azure

Чтобы защитить веб-приложение IIS, использующее встроенную проверку подлинности HTTP Windows, установите сервер Azure MFA на веб-сервере IIS и настройте его согласно следующим инструкциям.

1. На сервере Многофакторной идентификации Azure щелкните значок аутентификации IIS в меню слева.
2. Перейдите на вкладку **HTTP**.
3. Щелкните **Добавить**.
4. В диалоговом окне Добавить базовый URL-адрес, введите URL-адрес веб-сайта, где выполняется проверка подлинности HTTP (например <http://localhost/owa>) и укажите имя приложения (необязательно). Имя приложения отображается в отчетах сервера Многофакторной идентификации Azure. Кроме того, оно может отображаться в SMS-сообщениях и сообщениях о проверке подлинности мобильного приложения.
5. Задайте параметры «Время ожидания простоя» и «Максимальное время сеанса», если заданные по умолчанию значения этих параметров недостаточны.
6. Установите флажок **Требуется сопоставление пользователей многофакторной проверки подлинности**, если все пользователи, которые были или будут импортированы на сервер, подлежат многофакторной проверке подлинности. Если значительное число пользователей еще не импортировано на сервер и/или будет исключено из многофакторной проверки подлинности, не устанавливайте флажок.
7. При необходимости установите флажок **Cookie cache** (Кэш для файлов cookie).
8. Последовательно выберите **ОК**.

## <a name="enable-iis-plug-ins-for-azure-multi-factor-authentication-server"></a>Включение подключаемых модулей IIS для сервера Многофакторной идентификации Azure

После настройки URL-адресов и параметров проверки подлинности на основе форм или HTTP необходимо выбрать расположения, в которые будут загружены подключаемые модули IIS для сервера Многофакторной идентификации Azure, которые затем будут включены в IIS. Выполните перечисленные ниже действия.

1. В среде IIS 6 выберите вкладку **ISAPI**. Выберите веб-сайт, на котором выполняется веб-приложение (например, Default Web Site), для включения подключаемого модуля фильтра ISAPI Многофакторной идентификации Azure для этого сайта.
2. В среде IIS 7 или более поздней версии выберите вкладку **Собственный модуль**. Выберите сервер, веб-сайты или приложения, чтобы включить подключаемый модуль IIS на нужном уровне.
3. Установите флажок **Включить проверку подлинности IIS** в верхней части экрана. Теперь выбранное приложение IIS защищено службой Многофакторной идентификации Azure. Убедитесь, что пользователи были импортированы на сервер.

## <a name="trusted-ips"></a>Надежные IP-адреса

Список «Надежные IP-адреса» позволяет обойти службу Многофакторной идентификации Azure при обработке таких запросов на веб-сайты, которые исходят от определенных IP-адресов или подсетей. Например, вам может понадобиться исключить пользователей из проверки Многофакторной идентификации Azure, если они входят с офисного компьютера. Для этого офисную подсеть нужно внести в список "Надежные IP-адреса". Для настройки надежных IP-адресов используйте следующую процедуру.

1. В разделе проверки подлинности IIS перейдите на вкладку **Надежные IP-адреса**.
2. Щелкните **Добавить**.
3. Когда появится диалоговое окно "Добавление надежных IP-адресов", с помощью переключателя выберите **один IP-адрес**, **диапазон IP-адресов** или **подсеть**.
4. Введите IP-адрес, диапазон IP-адреса или подсети, в которой должно быть разрешено. Указывая подсеть, выберите соответствующую маску сети, затем нажмите кнопку **ОК**.
