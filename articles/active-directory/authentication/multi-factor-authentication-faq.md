---
title: Многофакторная аутентификация Azure - Активный каталог Azure
description: Часто задаваемые вопросы и ответы о службе Многофакторной идентификации Azure.
services: multi-factor-authentication
ms.service: active-directory
ms.subservice: authentication
ms.topic: troubleshooting
ms.date: 11/18/2019
ms.author: iainfou
author: iainfoulds
manager: daveba
ms.reviewer: michmcla
ms.collection: M365-identity-device-management
ms.openlocfilehash: 2a622245a7431058582131d9ba224ddfb676d8aa
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75425137"
---
# <a name="frequently-asked-questions-about-azure-multi-factor-authentication"></a>Часто задаваемые вопросы о Многофакторной идентификации Azure

В этой статье приведены ответы на часто задаваемые вопросы о Многофакторной идентификации Azure и использовании службы MFA. Здесь рассматриваются вопросы о службе в целом, моделях выставления счетов, пользовательских интерфейсах и устранении неполадок.

## <a name="general"></a>Общие сведения

> [!IMPORTANT]
> С 1 июля 2019 года Microsoft больше не будет предлагать MFA Server для новых развертываний. Новые клиенты, которые хотели бы требовать многофакторной аутентификации от своих пользователей, должны использовать многофакторную аутентификацию Azure. Существующие клиенты, которые активировали MFA Server до 1 июля, смогут загружать последнюю версию, будущие обновления и генерировать учетные данные активации в обычном режиме.
> 
> Лицензирование на основе потребления больше не доступно для новых клиентов с 1 сентября 2018 года.
> С 1 сентября 2018 года новые поставщики auth могут больше не создаваться. Существующие поставщики аутентификации можно продолжать использовать и обновлять. Многофакторная аутентификация по-прежнему будет предоставляться как функция в лицензиях Azure AD Premium.

> [!NOTE]
> Информация, представленная ниже относительно сервера azure Multi-Factor Authentication Server, применима только к пользователям, у которых уже есть сервер MFA.

**В. Каким образом сервер Многофакторной идентификации Azure обрабатывает данные пользователей?**

При использовании сервера Многофакторной идентификации данные пользователей хранятся только на локальных серверах. В облаке данные пользователя постоянно не хранятся. Когда пользователь выполняет двухфакторную проверку подлинности, сервер Многофакторной идентификации отправляет данные в облачную службу Многофакторной идентификации Azure для проверки подлинности. Для обмена данными между сервером Многофакторной идентификации и облачной службой Многофакторной идентификации используются протокол SSL или TLS и исходящие подключения через порт 443.

Когда запросы на проверку подлинности отправляются в облачную службу, для отчетов о проверке подлинности и использовании собираются данные. Ниже перечислены поля данных, включаемые в журналы двухфакторной проверки подлинности.

* **Уникальный идентификатор** (имя пользователя или идентификатор локального сервера Многофакторной идентификации).
* **Имя и фамилия** (необязательно).
* **Адрес электронной почты** (необязательно)
* **Номер телефона** (при аутентификации посредством голосового вызова или SMS).
* **Маркер устройства** (при аутентификации с помощью мобильного приложения).
* **Режим проверки подлинности**
* **Результат проверки подлинности**
* **Имя сервера Многофакторной идентификации**
* **IP-адрес сервера Многофакторной идентификации.**
* **IP-адрес клиента** (если он доступен).

Необязательные поля можно настроить на сервере Многофакторной идентификации.

В данных о проверке подлинности хранятся результаты этой операции (выполнена или нет), а также указана причина отказа в соответствующем случае. Эти сведения доступны в отчетах о проверке подлинности и использовании.

**Вопрос. Какие короткие коды SMS используются для отправки SMS моим пользователям?**

В США корпорация Майкрософт использует следующие короткие коды SMS:

   * 97671
   * 69829
   * 51789
   * 99399

В Канаде корпорация Майкрософт использует следующие короткие коды SMS:

   * 759731 
   * 673801

Корпорация Майкрософт не гарантирует единообразного запроса Многофакторной идентификация с помощью SMS или голосового вызова при вводе одного и того же числа. В интересах наших пользователей корпорация Майкрософт может добавить или удалить короткие коды в любое время, так как мы корректируем маршруты для улучшения доставки SMS. Корпорация Майкрософт не поддерживает короткие коды для стран/регионов, кроме США и Канады.

## <a name="billing"></a>Выставление счетов

Основные вопросы о выставлении счетов рассматриваются на [странице цен на Многофакторную идентификацию](https://azure.microsoft.com/pricing/details/multi-factor-authentication/) или в статье о [получении службы Многофакторной идентификации Azure](concept-mfa-licensing.md).

**В. Взимается ли с организации плата за телефонные звонки или текстовые сообщения, используемые для проверки подлинности пользователей?**

Нет. С организаций не взимается плата за отдельные телефонные звонки или текстовые сообщения, отправленные пользователям через службу Многофакторной идентификации Azure. Если используется поставщик MFA с оплатой за событие проверки подлинности, счет выставляется за каждую проверку подлинности, а не за используемый метод.

Пользователи могут оплачивать входящие телефонные звонки или текстовые сообщения, если это предусмотрено тарифами телефонной службы.

**В. При использовании модели выставления с оплатой "на пользователя" счет выставляется за всех включенных пользователей или только за пользователей, выполняющих двухфакторную проверку подлинности?**

При выставлении счетов учитывается количество пользователей, для которых настроено использование Многофакторной идентификации, не зависимо от того, выполняли ли они двухфакторную проверку подлинности в этом месяце.

**В. Как выставляются счета за использование службы Многофакторной идентификации?**

При создании поставщика MFA "на пользователя" или "на проверку подлинности" счета выставляются ежемесячно по мере использования в подписке Azure вашей организации. Точно так же Azure выставляет счета за использование виртуальных машин и веб-сайтов.

При покупке подписки на Многофакторную идентификацию Azure организация оплачивает только годовой лицензионный сбор за каждого пользователя. Таким образом оплачиваются лицензии MFA и пакеты Office 365, Azure AD Premium и Microsoft Enterprise Mobility + Security. 

Дополнительные сведения о получении службы Azure MFA см. в статье [Как получить службу Многофакторной идентификации Azure](concept-mfa-licensing.md).

**В. Существует ли бесплатная версия службы Многофакторной идентификации Azure?**

В некоторых случаях это возможно.

Multi-Факторная аутентификация для администраторов Azure предлагает подмножество функций Azure MFA без каких-либо затрат для доступа к онлайн-сервисам Майкрософт, включая [портал Azure](https://portal.azure.com) и [центр администратора Microsoft 365.](https://admin.microsoft.com) Это предложение действует только для глобальных администраторов в экземплярах Azure Active Directory, на которых нет полной версии MFA Azure из-за лицензии, пакета или автономного поставщика с оплатой по мере использования. Если администраторы использовали бесплатную версию, а затем вы приобрели полную версию MFA Azure, то все глобальные администраторы будут повышены до платной версии автоматически.

Служба многофакторной проверки подлинности для пользователей Office 365 включает некоторые функции Azure MFA с бесплатным доступом к службам Office 365, в том числе к Exchange Online и SharePoint Online. Это предложение действует для пользователей, которым назначена лицензия Office 365, если на соответствующих экземплярах Azure Active Directory нет доступа к полной версии Azure MFA из-за лицензии, пакета или автономного поставщика с оплатой по мере использования.

**В. Может ли моя организация переключаться между моделями оплаты за использование "по пользователям" и "по операциям аутентификации"?**

Если организация приобретает MFA как автономную службу с оплатой по мере использования, модель выставления счетов можно выбрать при создании поставщика MFA. После его создания изменить модель выставления счетов невозможно. 

Если поставщик MFA *не* связан с клиентом Azure AD или новый поставщик MFA связан с другим клиентом Azure AD, пользовательские настройки и параметры конфигурации не будут применяться. Кроме того, вам потребуется повторно активировать имеющиеся серверы Azure MFA с помощью учетных данных активации, созданных с помощью нового поставщика многофакторной идентификации. Повторная активация серверов MFA для их связи с новым поставщиком MFA не влияет на проверку подлинности с помощью телефонного звонка и текстового сообщения в отличие от уведомлений мобильных приложений, которые перестанут работать, пока пользователи повторно не активируют мобильные приложения.

Дополнительные сведения о поставщиках MFA см. в статье [Начало работы с поставщиком Многофакторной идентификации Azure](concept-mfa-authprovider.md).

**В. Может ли моя организация в любой момент переключаться между моделью выставления счетов по мере использования и подписками (моделью на основе лицензий)?**

В некоторых случаях это возможно.

Если в каталоге уже есть поставщик Многофакторной идентификации Azure с оплатой *на пользователя*, вы можете добавить лицензии MFA. Пользователи, имеющие лицензии, не будут учитываться при выставлении счетов по мере использования с оплатой "на пользователя". Для пользователей без лицензий можно по-прежнему включить MFA с помощью поставщика MFA. Если приобрести и назначить лицензии всем пользователям, для которых настроено использование Многофакторной идентификации, вы сможете удалить поставщик Многофакторной идентификации Azure. Если в будущем количество пользователей превысит число лицензий, вы можете всегда создать другой поставщик MFA с оплатой "на пользователя".

Если в каталоге уже есть поставщик Многофакторной идентификации Azure с оплатой за событие *проверки подлинности*, счета всегда будут выставляться за каждую операцию проверки подлинности до тех пор, пока поставщик MFA связан с вашей подпиской. Вы можете назначить лицензии MFA пользователям, но плата по-прежнему будет взиматься за каждый запрос на двухфакторную проверку подлинности даже от пользователей с лицензиями MFA.

**В. Должна ли моя организация использовать и синхронизировать удостоверения для использования Многофакторной идентификации Azure?**

Когда организация использует модель выставления счетов с оплатой по мере использования, то применять Azure Active Directory необязательно. Если поставщик MFA не привязан к клиенту Azure AD, то вы сможете развернуть сервер Многофакторной идентификации Azure только в локальной среде.

При использовании любой модели лицензирования применять Azure Active Directory обязательно, так как лицензии, приобретенные и назначенные клиенту Azure AD, добавляются в этот каталог.

## <a name="manage-and-support-user-accounts"></a>Управление учетными записями пользователей и их поддержка

**В: Что я должен сказать своим пользователям, если они не получают ответа на свой телефон?**

Попросите пользователей раз в 5 минут принять телефонный звонок или SMS до 5 раз, чтобы пройти проверку подлинности. Корпорация Майкрософт использует несколько провайдеров для доставки звонков и SMS-сообщений. Если это не помогает, обратитесь в службу поддержки корпорации Майкрософт для устранения неполадок.

Если описанные выше шаги не сработают, к счастью, для всех пользователей настроено несколько методов проверки. Пользователи должны выполнить вход еще раз, но при этом выбрать другой метод проверки на странице входа.

Кроме того, посоветуйте им ознакомиться со статьей [Проблемы с двухфакторной проверкой подлинности](../user-help/multi-factor-authentication-end-user-troubleshoot.md).

**В. Что делать, если один из пользователей не может получить доступ к своей учетной записи?**

Вы можете сбросить настройки учетной записи, попросив пользователя снова пройти процесс регистрации. Узнайте больше об [управлении параметрами пользователей и устройств в облаке с помощью Многофакторной идентификации Azure](howto-mfa-userdevicesettings.md).

**В. Что делать в случае утери телефона пользователя, использующего пароли приложений?**

Чтобы предотвратить несанкционированный доступ, удалите все пароли приложений пользователя. После получения нового устройства пользователь сможет создать их заново. Узнайте больше об [управлении параметрами пользователей и устройств в облаке с помощью Многофакторной идентификации Azure](howto-mfa-userdevicesettings.md).

**В. Что если пользователь не может войти в приложения, не относящиеся к браузеру?**

Если в организации используются устаревшие клиенты и [допускается использование паролей приложений](howto-mfa-mfasettings.md#app-passwords), то пользователи не смогут войти в эти клиенты, используя учетные данные. Вместо этого они должны [настроить пароли приложений](../user-help/multi-factor-authentication-end-user-app-passwords.md). Пользователи должны очистить (удалить) сведения для входа в систему, перезапустить приложение и войти в него, используя свое имя пользователя и *пароль приложения*, а не обычный пароль.

Если в организации не используются устаревшие клиенты, не разрешайте пользователям создавать пароли приложений.

> [!NOTE]
> Современная аутентификация для клиентов Office 2013
>
> Пароли необходимы только для тех приложений, которые не поддерживают современные методы проверки подлинности. Клиенты Office 2013 поддерживают современные протоколы проверки подлинности, но их необходимо настроить. Теперь современная аутентификация доступна любому клиенту, который работает в марте 2015 года или позже, обновление для Office 2013. Для получения дополнительной информации, смотрите в блоге [Обновленный Office 365 современной аутентификации](https://www.microsoft.com/microsoft-365/blog/2015/11/19/updated-office-365-modern-authentication-public-preview/).

**В: Мои пользователи говорят, что иногда они не получают текстовое сообщение или время проверки.**

Доставка SMS-сообщений не гарантируется, поскольку существуют неконтролируемые факторы, которые могут повлиять на надежность службы. Эти факторы включают страну назначения /регион, оператора мобильной связи и силу сигнала.

Пользователям, которые испытывают трудности с получением текстовых сообщений, мы советуем использовать мобильное приложение или телефонные звонки. Мобильное приложение может получать уведомления как по сотовой сети, так и через Wi-Fi. Кроме того, мобильное приложение может создать код подтверждения даже при полном отсутствии связи. Приложение Microsoft Authenticator доступно для [Android](https://go.microsoft.com/fwlink/?Linkid=825072), [iOS](https://go.microsoft.com/fwlink/?Linkid=825073) и [Windows Phone](https://www.microsoft.com/p/microsoft-authenticator/9nblgggzmcj6).

**В. Можно ли изменить время, в течение которого пользователи должны ввести код проверки из текстового сообщения до истечения времени ожидания?**

В некоторых случаях — да. 

Для односторонних SMS с сервером Azure MFA версии 7.0 или более поздней можно настроить параметр времени ожидания, задав раздел реестра. После того как облачная служба MFA отправит текстовое сообщение, на сервер MFA вернется код проверки (или одноразовый секретный код). По умолчанию сервер MFA хранит код в памяти 300 секунд. Если пользователь вводит свой код по истечении 300 секунд, ему будет отказано в доступе. Чтобы изменить значение времени ожидания по умолчанию, выполните следующие действия:

1. Перейдите в HKLM\Software\Wow6432Node\Positive Networks\PhoneFactor.
2. Создайте раздел реестра DWORD с именем **pfsvc_pendingSmsTimeoutSeconds** и задайте время в секундах, в течение которого на сервере Azure будет храниться одноразовый секретный код.

>[!TIP] 
>При наличии нескольких серверов MFA код проверки, который был отправлен пользователю, знает только тот, который обработал исходный запрос идентификации. Когда пользователь вводит код, запрос проверки подлинности для его подтверждения должен быть отправлен на тот же сервер. Если проверка кода отправляется на другой сервер, в проверке подлинности будет отказано. 

Если пользователь не ответит на текстовое сообщение в течение определенного времени ожидания, в проверке подлинности будет отказано. 

Для односторонних SMS с Azure MFA в облаке (включая адаптер AD FS и расширение сервера политики сети) нельзя настроить параметр времени ожидания. Azure AD хранит код проверки в течение 180 секунд. 

**В. Можно ли использовать аппаратные ключи с сервером Многофакторной идентификации Azure?**

При использовании сервера Многофакторной идентификации Azure вы можете импортировать сторонние маркеры OATH TOTP (одноразовые пароли с ограниченным сроком действия), чтобы применять их для двухфактороной проверки подлинности.

Токены ActiveIdentity формата OATH TOTP можно использовать, если вы поместите секретный ключ в CSV-файл и импортируете его на сервер Многофакторной идентификации Azure. OATH-токены можно использовать со службами федерации Active Directory (AD FS), протоколом RADIUS (до тех пор, пока клиентская система может принимать пользовательский ввод) или при проверке подлинности на основе форм IIS.

Сторонние токены OATH TOTP можно импортировать в следующих форматах.  

- PSKC.  
- CSV, если файл содержит серийный номер, секретный ключ в формате Base 32 и там указан интервал времени.  

**В. Можно ли использовать сервер Многофакторной идентификации Azure для защиты служб терминалов?**

Да, но если вы используете Windows Server 2012 R2 или более позднюю версию, то обеспечить безопасность служб терминалов можно только с помощью шлюза удаленных рабочих столов.

Изменения системы безопасности в Windows Server 2012 R2 изменили способ подключения сервера Многофакторной идентификации Azure к пакету безопасности локальной системы безопасности, используемый в Windows Server 2012 и более ранних версиях. Для версий служб терминалов, используемых в Windows Server 2012 и более ранних версий, можно [защитить приложение с помощью проверки подлинности Windows](howto-mfaserver-windows.md#to-secure-an-application-with-windows-authentication-use-the-following-procedure). Если вы используете Windows Server 2012 R2, необходим шлюз удаленных рабочих столов.

**В. Почему пользователь получает вызовы Многофакторной идентификации от анонимного абонента после настройки идентификатора звонящего на сервере MFA?**

Когда вызовы для многофакторной проверки подлинности осуществляются по телефонной сети общего пользования, иногда они передаются через оператора, который не поддерживает идентификацию вызывающего абонента. По этой причине идентификация вызывающего абонента не гарантируется, хотя система Многофакторной идентификации всегда отправляет соответствующий идентификатор.

**В. Почему пользователи получают предложение зарегистрировать свои сведения о безопасности?**
Существует несколько причин, почему пользователи могут получать такой запрос:

- Администратор включил MFA в Azure AD для пользователя, но еще не зарегистрировал сведения о безопасности учетной записи.
- Пользователь был включен для самостоятельного сброса пароля в Azure AD. Сведения о безопасности помогут ему в будущем сбросить пароль, если он его забудет.
- При доступе к приложению с политикой условного доступа, для которой требуется MFA, но пользователь не был зарегистрирован для MFA.
- Пользователь регистрирует устройство в Azure AD (в том числе присоединение к Azure AD), но не зарегистрирован для MFA, а вашей организации при регистрации устройства требуется MFA.
- Пользователь создает Windows Hello для бизнеса в Windows 10 (для которого требуется MFA), но не был зарегистрирован для MFA.
- Организация создала и включила политику регистрации для MFA, которая была применена к пользователю.
- Пользователь уже зарегистрирован для MFA, но выбрал метод проверки, отключенный администратором. В таком случае пользователь должен зарегистрироваться для MFA еще раз, чтобы выбрать новый метод проверки по умолчанию.

## <a name="errors"></a>ошибки

**Вопрос. Что делать пользователю, если при использовании уведомлений через мобильное приложение он видит сообщение об ошибке приблизительно следующего содержания: "Запрос на проверку подлинности не предназначен для активированной учетной записи"?**

Такому пользователю следует удалить и заново добавить учетную запись в мобильном приложении следующим образом.

1. Перейдите к [профилю портала Azure](https://account.activedirectory.windowsazure.com/profile/) и выполните вход с учетной записью своей организации.
2. Щелкните **Дополнительная проверка безопасности**.
3. Удалите существующую учетную запись из мобильного приложения.
4. Нажмите кнопку **Настроить**и следуйте инструкциям по перенастройке мобильного приложения.

**Вопрос. Что делать пользователю, если при входе в приложение без использования браузера он видит сообщение об ошибке 0x800434D4L?**

При попытке войти в установленное на локальном компьютере приложение, не использующее браузер, которое не работает с учетной записью, требующей двухфакторную проверку, возникает ошибка 0x800434D4L.

Для устранения этой ошибки нужно использовать отдельные учетные записи пользователя для операций администрирования и для операций, не связанных с администрированием. Позже вы сможете связать почтовые ящики с этими учетными записями, чтобы иметь возможность входить в Outlook с помощью учетной записи без привилегий администратора. Чтобы больше узнать об этом решении, ознакомьтесь с [предоставлением администратору возможности открывать и просматривать содержимое почтового ящика пользователя](https://help.outlook.com/141/gg709759.aspx?sl=1).

## <a name="next-steps"></a>Дальнейшие действия

Если на этой странице нет ответа на ваш вопрос, оставьте его в разделе с комментариями ниже. Вы также можете использовать другие методы получения помощи.

* В [базе знаний службы технической поддержки Майкрософт](https://support.microsoft.com) можно искать решения распространенных технических проблем.
* [На форумах по Azure Active Directory](https://social.msdn.microsoft.com/Forums/azure/newthread?category=windowsazureplatform&forum=WindowsAzureAD&prof=required)вы можете искать и просматривать ответы участников сообщества на технические вопросы, а также задавать собственные.
* Если вы являетесь клиентом устаревшей версии PhoneFactor и у вас есть вопросы по сбросу пароля или вам нужна помощь, используйте ссылку [сброс пароля](mailto:phonefactorsupport@microsoft.com) , чтобы открыть обращение в службу поддержки.
* Обратитесь в специализированную [службу поддержки клиентов сервера Многофакторной идентификации Azure (PhoneFactor)](https://support.microsoft.com/oas/default.aspx?prid=14947). Вы можете облегчить нам задачу, если при обращении предоставите максимально полные сведения о проблеме. Вы можете сообщить нам, на какой странице возникла ошибка, а также какой точный код ошибки, идентификатор сеанса и идентификатор пользователя, получившего эту ошибку.
