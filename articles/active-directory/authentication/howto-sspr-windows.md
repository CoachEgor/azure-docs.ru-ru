---
title: Самостоятельный сброс пароля для Windows (Azure Active Directory)
description: Сведения о том, как включить самостоятельный сброс пароля с использованием функции "Забыли пароль" на экране входа Windows
services: active-directory
ms.service: active-directory
ms.subservice: authentication
ms.topic: how-to
ms.date: 11/21/2019
ms.author: iainfou
author: iainfoulds
manager: daveba
ms.reviewer: sahenry
ms.collection: M365-identity-device-management
ms.openlocfilehash: 95d1ffec6a849cb97a6151717c3e30dc362b1403
ms.sourcegitcommit: 0b80a5802343ea769a91f91a8cdbdf1b67a932d3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/25/2020
ms.locfileid: "83826610"
---
# <a name="how-to-enable-password-reset-from-the-windows-login-screen"></a>Руководство. Включение сброса пароля на экране входа в Windows

На компьютерах под управлением Windows 7, 8, 8.1 и 10 можно разрешить пользователям сбрасывать пароль на экране входа в Windows. Теперь пользователям не придется искать другое устройство с веб-браузером для доступа к [порталу SSPR](https://aka.ms/sspr).

![Примеры экранов входа в Windows 7 и 10, где отмечена ссылка SSPR](./media/howto-sspr-windows/windows-reset-password.png)

## <a name="general-limitations"></a>Общие ограничения

- Сброс пароля через сеанс удаленного рабочего стола или расширенный сеанс Hyper-V в настоящее время не поддерживается.
- Известно, что использование некоторых сторонних поставщиков учетных данных приводит к проблемам с этой функцией.
- Известно, что отключение контроля учетных записей путем изменения ключа реестра [EnableLUA](https://docs.microsoft.com/openspecs/windows_protocols/ms-gpsb/958053ae-5397-4f96-977f-b7700ee461ec) приводит к проблемам с этой функцией.
- Эта функция не поддерживается для сетей, где развернута сетевая проверка подлинности 802.1X и установлен параметр "Выполнять непосредственно перед входом пользователя". Чтобы включить эту функцию для сетей с развернутыми решением аутентификации 802.1X, используйте аутентификацию компьютера.
- Гибридные компьютеры, присоединенные к Azure AD, должны иметь прямую сетевую видимость контроллера домена, чтобы применить новый пароль и обновить кэшированные учетные данные. Это означает, что устройство должно находиться во внутренней сети организации или использовать VPN-подключение с сетевым доступом к контроллеру домена в локальной сети. 
- Если используется образ, то перед выполнением sysprep обязательно очистите веб-кэш для встроенной учетной записи администратора и затем выполните шаг CopyProfile. Дополнительные сведения об этом шаге можно найти в статье службы поддержки о [низкой производительности при использовании профилей по умолчанию](https://support.microsoft.com/help/4056823/performance-issue-with-custom-default-user-profile).
- Известно, что следующие параметры влияют на возможность использовать и сбрасывать пароли на устройствах Windows 10.
    - Если согласно политике версий Windows 10 до 1809 нужно нажать CTRL+ALT+DEL, **Сброс пароля** не будет работать.
    - Если уведомления на экране блокировки отключены, **Сброс пароля** не будет работать.
    - HideFastUserSwitching со значением Enabled (Вкл.) или 1;
    - DontDisplayLastUserName со значением Enabled (Вкл.) или 1;
    - NoLockScreen со значением Enabled (Вкл.) или 1;
    - EnableLostMode, установленный на устройстве;
    - файл Explorer.exe, замененный на файл пользовательской оболочки.
- Сочетание следующих трех параметров может привести к неработоспособности этой функции.
    - Интерактивный вход: не требовать нажатия CTRL+ALT+DEL = "Отключено"
    - DisableLockScreenAppNotifications = 1 или "Включено"
    - Ценовая категория Windows — любая, кроме Домашняя или Профессиональная.

## <a name="windows-10-password-reset"></a>Сброс пароля в Windows 10

### <a name="windows-10-prerequisites"></a>Предварительные требования для Windows 10

- Администратор должен включить функцию самостоятельного сброса пароля Azure AD через портал Azure.
- **Пользователи должны зарегистрироваться в SSPR перед использованием этой функции.**
- Требования к сетевому прокси
   - Устройства Windows 10: 
       - Порт 443 для `passwordreset.microsoftonline.com` и `ajax.aspnetcdn.com`.
       - Устройства Windows 10 поддерживают конфигурацию прокси-сервера только на уровне компьютера.
- Система под управлением Windows 10 с обновлением за апрель 2018 г. (версия 1803) или более поздних версий. Для устройства должно быть выполнено:
    - присоединение к Azure AD;
    - присоединение к Azure AD (гибридные устройства).

### <a name="enable-for-windows-10-using-intune"></a>Подготовка для Windows 10 с помощью Intune

Самый гибкий метод — это развертывание изменений конфигурации для включения сброса пароля в окне входа в систему с помощью Intune. Intune позволяет развертывать изменения конфигурации для определенной группы компьютеров. Этот метод требует регистрации устройства в Intune.

#### <a name="create-a-device-configuration-policy-in-intune"></a>Создание политики конфигурации устройства в Intune

1. Войдите на [портал Azure](https://portal.azure.com) и щелкните **Intune**.
1. Создайте профиль конфигурации устройства, последовательно выбрав **Конфигурация устройства** > **Профили** > **Создать профиль**.
   - Введите понятное имя для профиля.
   - При необходимости введите содержательное описание профиля.
   - Выберите платформу **Windows 10 и более поздних версий**.
   - Для типа профиля укажите **Пользовательский**.
1. Настройте **параметры**.
   - В разделе "Параметры OMA-URI" **добавьте** следующий параметр, чтобы включить отображение ссылки сброса пароля.
      - Введите понятное имя, которое указывает на действия параметра.
      - При необходимости введите содержательное описание параметра.
      - Для параметра **OMA-URI** укажите значение `./Vendor/MSFT/Policy/Config/Authentication/AllowAadPasswordReset`.
      - Для параметра **Тип данных** задайте значение **Целое число**.
      - Для параметра **Значение** установите значение **1**.
      - Нажмите кнопку **ОК**.
   - Нажмите кнопку **ОК**.
1. Нажмите кнопку **Создать**.
1. Эту политику можно назначать определенным пользователям, устройствам или группам. Дополнительные сведения можно найти в статье [Назначение профилей пользователей и устройств в Microsoft Intune](https://docs.microsoft.com/intune/device-profile-assign).

### <a name="enable-for-windows-10-using-the-registry"></a>Подготовка для Windows 10 с помощью реестра

1. Войдите в Windows PC, используя административные учетные данные.
1. Запустите **regedit** от имени администратора.
1. Настройте следующий раздел реестра:
   - `HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\AzureADAccount`
      - `"AllowPasswordReset"=dword:00000001`

#### <a name="troubleshooting-windows-10-password-reset"></a>Устранение неполадок при сбросе пароля в Windows 10

Журнал аудита Azure AD включают в себя сведения об IP-адресе и типе клиента (ClientType), на котором произошел сброс пароля.

![Пример события сброса пароля Windows 7 в журнале аудита Azure AD](media/howto-sspr-windows/windows-7-sspr-azure-ad-audit-log.png)

Когда пользователи сбрасывают пароли с экрана входа на устройство с Windows 10, создается временная учетная запись с именем `defaultuser1` и низким уровнем прав. Эта учетная запись используется для обеспечения безопасности процесса сброса пароля. Учетная запись имеет случайно сгенерированный пароль, который не отображается при входе в устройство, и автоматически удаляется после завершения сброса пароля для пользователя. Может существовать сразу несколько профилей `defaultuser`, но вы можете спокойно их игнорировать.

## <a name="windows-7-8-and-81-password-reset"></a>Сброс паролей в Windows 7, 8 и 8.1

### <a name="windows-7-8-and-81-prerequisites"></a>Предварительные условия для Windows 7, 8 и 8.1

- Администратор должен включить функцию самостоятельного сброса пароля Azure AD через портал Azure.
- **Пользователи должны зарегистрироваться в SSPR перед использованием этой функции.**
- Требования к сетевому прокси
   - Устройства под управлением Windows 7, 8 и 8.1.
       - Порт 443 для `passwordreset.microsoftonline.com`.
- В операционной системе Windows 7 или Windows 8.1 должны быть установлены исправления.
- Должен быть включен протокол TLS 1.2 (см. руководство по [настройке параметров реестра для протокола TLS](https://docs.microsoft.com/windows-server/security/tls/tls-registry-settings#tls-12)).
- Если на компьютере включено более одного стороннего поставщика учетных данных, на экране входа в систему может отображаться несколько профилей пользователей.

> [!WARNING]
> Протокол TLS 1.2 должен быть строго включен, а не настроен на автоматическое согласование.

### <a name="install"></a>Установка

1. Скачайте соответствующий установщик для версии Windows, в которой следует включить этот протокол.
   - Программное обеспечение доступно в Центре загрузки Майкрософт по адресу [https://aka.ms/sspraddin](https://aka.ms/sspraddin).
1. Войдите на компьютер, где следует выполнить установку, и запустите программу установки.
1. После установки настоятельно рекомендуется выполнить перезагрузку.
1. После перезагрузки выберите на экране входа пользователя и щелкните ссылку "Забыли пароль?", чтобы инициировать процесс сброса пароля.
1. Завершите процесс, следуя указаниям на экране для сброса пароля.

![Пример для Windows 7 со ссылкой "Забыли пароль?", Поток SSPR](media/howto-sspr-windows/windows-7-sspr.png)

#### <a name="silent-installation"></a>Автоматическая установка

- Для автоматической установки выполните команду "msiexec /i SsprWindowsLogon.PROD.msi /qn".
- Для автоматического удаления выполните команду "msiexec /x SsprWindowsLogon.PROD.msi /qn"

#### <a name="troubleshooting-windows-7-8-and-81-password-reset"></a>Устранение неполадок при сбросе пароля в Windows 7, 8 и 8.1

События регистрируются в журнале как на компьютере, так и в Azure AD. События Azure AD включают в себя сведения об IP-адресе и типе клиента (ClientType), на котором произошел сброс пароля.

![Пример события сброса пароля Windows 7 в журнале аудита Azure AD](media/howto-sspr-windows/windows-7-sspr-azure-ad-audit-log.png)

При необходимости для включения подробного ведения журнала можно изменить соответствующий раздел реестра на компьютере. Подробное ведение журнала следует включать только для устранения неполадок.

`HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Authentication\Credential Providers\{86D2F0AC-2171-46CF-9998-4E33B3D7FD4F}`

- Чтобы включить ведение журнала, создайте `REG_DWORD: "EnableLogging"` и присвойте ему значение 1.
- Чтобы отключить подробное ведение журнала, измените для `REG_DWORD: "EnableLogging"` значение на 0.

## <a name="what-do-users-see"></a>Что видят пользователи?

Теперь, когда вы настроили сброс пароля для устройств Windows, какие изменения заметят пользователи? Как они узнают, что можно сбросить пароль на экране входа в систему?

![Примеры экранов входа в Windows 7 и 10, где отмечена ссылка SSPR](./media/howto-sspr-windows/windows-reset-password.png)

Теперь когда пользователи попытаются войти в систему, они увидят ссылку **Забыли пароль?** или **Сброс пароля**, которая открывает интерфейс для самостоятельного сброса пароля прямо на экране входа в систему. С помощью этой функции пользователи могут сбросить пароль, не используя другое устройство для получения доступа к браузеру.

Инструкции по использованию этой функции пользователи могут найти в статье [Я не помню свой пароль Azure AD](../user-help/active-directory-passwords-update-your-own-password.md).

## <a name="next-steps"></a>Дальнейшие действия

[Планирование допустимых методов аутентификации](concept-authentication-methods.md)

[Настройка Windows 10](https://docs.microsoft.com/windows/configuration/)
