---
title: Защита паролем Azure AD - Активный каталог Azure
description: Запретить слабые пароли в предприимчивом Active Directory с помощью защиты паролей Azure AD
services: active-directory
ms.service: active-directory
ms.subservice: authentication
ms.topic: conceptual
ms.date: 02/18/2018
ms.author: iainfou
author: iainfoulds
manager: daveba
ms.reviewer: jsimmons
ms.collection: M365-identity-device-management
ms.openlocfilehash: 1b9d07099f8de996181948921330ef6744b302a8
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "74848652"
---
# <a name="enforce-azure-ad-password-protection-for-windows-server-active-directory"></a>применение защиты паролем Azure AD для Windows Server Active Directory

Защита паролей Azure AD — это функция, которая улучшает политику паролей в организации. На локальном развертывании защиты паролей используются как глобальные, так и пользовательские списки запрещенных паролей, которые хранятся в Azure AD. Он выполняет те же проверки, что и Azure AD для изменений на основе облака. Эти проверки выполняются во время изменения пароля и сценариев сбросить пароль.

## <a name="design-principles"></a>Принципы проектирования

Защита паролей Azure AD разработана с учетом следующих принципов:

* Контроллеры доменов никогда не должны общаться непосредственно с Интернетом.
* На контроллерах домена не открываются новые сетевые порты.
* Изменения схемы Active Directory не требуются. Программное обеспечение использует существующий **контейнер** Active Directory и объекты схемы **ServiceConnectionPoint.**
* Не требуется минимального уровня функционального уровня Active Directory или лесного функционального уровня (DFL/FFL).
* Программное обеспечение не создает и не требует учетных записей в доменах Active Directory, которые оно защищает.
* Пользователи ясно текст пароли никогда не покидают контроллер домена, ни во время проверки пароля операций или в любое другое время.
* Программное обеспечение не зависит от других функций Azure AD; например, синхронизация хэш-шролей AD Azure AD не связана и не требуется для того, чтобы защита паролем Azure AD функционировала.
* Инкрементное развертывание поддерживается, однако политика паролей применяется только в тех случаях, когда установлен агент контроллера домена (агент DC). Более подробная информация читайте в следующей теме.

## <a name="incremental-deployment"></a>Инкрементное развертывание

Защита паролем Azure AD поддерживает постепенное развертывание через контроллеры доменов в домене Active Directory, но важно понимать, что это на самом деле означает и каковы компромиссы.

Программное обеспечение агента по защите паролей Azure AD может проверять пароли только при установке на контроллер домена и только для изменений пароля, которые отправляются на контроллер домена. Невозможно контролировать, какие контроллеры домена выбраны клиентскими машинами Windows для обработки изменений пароля пользователей. Для того, чтобы гарантировать последовательное поведение и универсальный защиты паролей органов, программное обеспечение агента ПОСТОЯННОГО ИДН должны быть установлены на всех контроллерах домена в домене.

Многие организации захотят провести тщательное тестирование защиты паролей Azure AD на подмножестве контроллеров доменов до полного развертывания. Защита паролем Azure AD поддерживает частичное развертывание, т.е. программное обеспечение агента ПОСТОЯННОГО ТОНа на данном DC будет активно проверять пароли, даже если другие DС в домене не установлено программное обеспечение агента ПОСТОЯННОГО ТО. Частичное развертывание этого типа не является безопасным и не рекомендуется, кроме как для целей тестирования.

## <a name="architectural-diagram"></a>Схема архитектуры

Важно понимать основные концепции проектирования и функций перед развертыванием системы защиты паролей Azure AD в предварительной среде Active Directory. Следующая диаграмма показывает, как компоненты защиты паролей работают вместе:

![Взаимодействие компонентов защиты паролем Azure AD](./media/concept-password-ban-bad-on-premises/azure-ad-password-protection.png)

* Служба прокси-сервера Защиты паролей Azure AD выполняется на любом компьютере, присоединенном к домену, в текущем лесу Active Directory. Его основная цель заключается в переадресации запросов на загрузку политики паролей от контроллеров доменов до Azure AD. Затем он возвращает ответы из Azure AD контроллеру домена.
* Фильтр паролей DLL агента ПОСТОЯННОГО ТОПолучает запросы на проверку паролей от операционной системы. Он направляет их в службу агента ПОСТОЯННОГО ТОКа, которая работает локально на контроллере домена.
* Служба защиты паролей DC Agent получает запросы на проверку паролей от фильтра паролей DLL агента ПОСТОЯННОГО ТОКа. Он обрабатывает их с помощью текущей (локально доступной) политики паролей и возвращает результат: *пройти* или *сбой.*

## <a name="how-password-protection-works"></a>Как работает защита паролем

Каждый экземпляр службы Azure AD Password Protection Proxy рекламирует себя контроллерам доменов в лесу, создавая объект **serviceConnectionPoint** в Active Directory.

Каждая служба агента постоянного тока для защиты паролем также создает объект **serviceConnectionPoint** в Active Directory. Этот объект используется в основном для отчетности и диагностики.

Служба агента постоянного тока отвечает за начало загрузки новой политики паролей из Azure AD. Первым шагом является поиск прокси-сервиса Azure AD Password Protection, запросив лес для объектов **прокси-сервисаConnectionPoint.** При обнаружении доступной прокси-службы агент ПОСТОЯННОГО ТОКа отправляет запрос на загрузку политики паролей в прокси-сервис. Служба прокси-серверов, в свою очередь, отправляет запрос в Azure AD. Затем прокси-сервис возвращает ответ службе агента постоянного тока.

После того, как служба агента постоянного тока получает новую политику паролей от Azure AD, служба хранит политику в специальной папке в корне своей доли папки домена *sysvol.* Служба агента постоянного тока также отслеживает эту папку в случае повторения новых политик из других служб агента постоянного тока в домене.

Служба агента ПОСТОЯННОГО ТО Всегда запрашивает новую политику при запуске сервиса. После запуска службы агента ПОСТОЯННОГО ТОКа он проверяет возраст текущей локально доступной политики ежечасно. Если политика старше одного часа, агент ПОСТОЯННОГО ТОК запрашивает новую политику от Azure AD через прокси-сервис, как описано ранее. Если текущая политика не старше одного часа, агент постоянного тока продолжает использовать эту политику.

Всякий раз, когда загружается политика защиты паролей Azure AD, эта политика специфична для арендатора. Другими словами, политики паролей всегда представляют собой комбинацию глобального списка запрещенных паролей Microsoft и списка пользовательских запрещенных паролей для одного арендатора.

Агент DC общается с прокси-сервисом через RPC через TCP. Прокси-сервис слушает эти вызовы в динамическом или статичном порту RPC, в зависимости от конфигурации.

Агент ПОСТОЯННОГО ТОКа никогда не слушает в доступном для сети порту.

Прокси-сервис никогда не вызывает службу агента ПОСТОЯННОГО ТО.

Прокси-сервис является апосильным лицом. Он никогда не кэширует политики или любое другое состояние, загруженное из Azure.

Служба агента ПОСТОЯННОГО ТО Всегда использует самую недавнюю локальную политику паролей для оценки пароля пользователя. Если в локальном dc нет политики пароля, пароль принимается автоматически. Когда это происходит, сообщение события регистрируется, чтобы предупредить администратора.

Защита паролей Azure AD не является движком приложения политики в реальном времени. Возможно, может быть задержка между изменением конфигурации политики паролей в Azure AD и тем, когда это изменение достигает и применяется на всех контроллерах доменов.

Защита паролей Azure AD служит дополнением к существующим политикам паролей Active Directory, а не заменой. Это включает в себя любые другие сторонние фильтр аролей dlls, которые могут быть установлены. Active Directory всегда требует, чтобы все компоненты проверки пароля согласились перед принятием пароля.

## <a name="foresttenant-binding-for-password-protection"></a>Лес/арендатор, привязывающий к защите паролем

Развертывание защиты паролей Azure AD в лесу Active Directory требует регистрации этого леса с помощью Azure AD. Каждая развернутая служба прокси также должна быть зарегистрирована в Azure AD. Эти лесные и прокси-регистрации связаны с конкретным арендатором Azure AD, который косвенно идентифицируется по учетным данным, используемым при регистрации.

Лес Active Directory и все развернутые прокси-сервисы в лесу должны быть зарегистрированы у одного и того же арендатора. Не поддерживается наличие в этом лесу Active Directory лесов или каких-либо прокси-сервисов, которые регистрируются у разных арендаторов Azure AD. Симптомы такого неправильно настроенного развертывания включают невозможность загрузки политик и паролей.

## <a name="download"></a>Скачивание

Два необходимых агента установщиков для защиты паролем Azure AD доступны в [Microsoft Download Center.](https://www.microsoft.com/download/details.aspx?id=57071)

## <a name="next-steps"></a>Дальнейшие действия
[Развертывание защиты паролем Azure AD](howto-password-ban-bad-on-premises-deploy.md)
