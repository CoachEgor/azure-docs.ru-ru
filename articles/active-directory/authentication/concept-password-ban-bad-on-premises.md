---
title: Защита паролей Azure AD — Azure Active Directory
description: Заблокировать слабые пароли в локальной Active Directory с помощью защиты пароля Azure AD
services: active-directory
ms.service: active-directory
ms.subservice: authentication
ms.topic: conceptual
ms.date: 02/18/2018
ms.author: joflore
author: MicrosoftGuyJFlo
manager: daveba
ms.reviewer: jsimmons
ms.collection: M365-identity-device-management
ms.openlocfilehash: d58c019cf3d801ce938a4ca6eca70b1606bf4ff6
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60415860"
---
# <a name="enforce-azure-ad-password-protection-for-windows-server-active-directory"></a>применение защиты паролем Azure AD для Windows Server Active Directory

Защита паролей Azure AD — это функция, который расширяет возможности политик паролей в организации. Защита паролем в локальной развертывания использует оба глобальных и настраиваемых запрещенных пароль списки, которые хранятся в Azure AD. Это делается же проверок локально как Azure AD для изменения на основе облака.

## <a name="design-principles"></a>Принципы проектирования

Защита паролей Azure AD изначально предполагает работу с этих принципов в виду:

* Контроллеры домена не придется взаимодействовать с Интернетом напрямую.
* На контроллерах домена не открываются новые сетевые порты.
* Изменения схемы Active Directory не требуются. Программное обеспечение использует существующей службе Active Directory **контейнера** и **serviceConnectionPoint** объекты схемы.
* Нет минимальное домена или леса режим работы Active Directory (DFL/FFL) является обязательным.
* Программное обеспечение не создавать или требуются учетные записи в указанных доменах Active Directory, которые он защищает.
* Незашифрованные пароли пользователя никогда не покидают контроллера домена, во время операций проверки пароля или в любое другое время.
* Программное обеспечение не зависит от других функций Azure AD; Например синхронизации хэша паролей Azure AD не связано и не обязателен для защиты паролей Azure AD в функции.
* Добавочное развертывание поддерживается, но только применение политики паролей, где установлен агент контроллера домена (DC агент). См. следующий раздел для получения дополнительных сведений.

## <a name="incremental-deployment"></a>Добавочное развертывание

Защита паролей Azure AD поддерживает добавочное развертывание между контроллерами домена в домене Active Directory, но это важно понимать, что это действительно означает и каковы компромиссы.

Программное обеспечение агента Azure AD пароль защиты контроллера домена можно только проверки паролей, при установке на контроллере домена и только для изменения пароля, которые отправляются в этот контроллер домена. Не поддерживается для управления клиентскими компьютерами Windows для обработки смены пользователем пароля выбираются контроллеров домена. Для гарантирует согласованное поведение и универсальной защиты безопасности паролей в, необходимо установить программное обеспечение агента контроллера домена на всех контроллерах домена в домене.

Во многих организациях может потребоваться произвести проверку защиты пароля Azure AD на подмножестве контроллеров домена до выполнении полного развертывания. Защита паролей Azure AD поддерживают частичного развертывания, ie программное обеспечение агента DC с данного контроллера домена будут активно проверки паролей даже в том случае, если другие контроллеры домена в домене нет установленного программного обеспечения агента DC. Частичное развертываний этого типа не являются безопасность и не рекомендуются отличное от для целей тестирования.

## <a name="architectural-diagram"></a>Схема архитектуры

Важно понять базовой структуре и основные понятия функций перед развертыванием защиты пароля Azure AD в локальной среде Active Directory. На следующей схеме показано, как взаимодействуют компоненты защиты паролем:

![Взаимодействие компонентов защиты паролем Azure AD](./media/concept-password-ban-bad-on-premises/azure-ad-password-protection.png)

* Служба прокси-сервера Защиты паролей Azure AD выполняется на любом компьютере, присоединенном к домену, в текущем лесу Active Directory. Ее основная задача — для переадресации запросов на загрузку политики паролей с контроллеров домена в Azure AD. Затем он возвращает ответы из Azure AD к контроллеру домена.
* Динамической Библиотеки фильтрации паролей агента DC получает запросов на проверку пароля пользователя из операционной системы. Он перенаправляет их в службу агента для контроллера домена, на котором выполняется локально на контроллере домена.
* Служба контроллера домена агента защиты паролем получает запросы на проверку пароля из динамической Библиотеки фильтрации паролей агента DC. Он обрабатывает их, используя текущую политику паролей (доступны локально) и возвращает результат: *передать* или *ошибкой*.

## <a name="how-password-protection-works"></a>Как работает защита паролем

Каждый экземпляр службы прокси-сервера для защиты паролей Azure AD оповещающий к контроллерам домена в лесу, создав **serviceConnectionPoint** объекта в Active Directory.

Каждая служба агента DC для защиты паролей также создает **serviceConnectionPoint** объекта в Active Directory. Этот объект используется в основном для создания отчетов и диагностики.

Служба агента DC отвечает за инициирование загрузки новой политики паролей из Azure AD. Первым шагом является обнаружение службы прокси-сервера для защиты паролей Azure AD, запрашивая леса для прокси-сервера **serviceConnectionPoint** объектов. При обнаружении службу посредник DC агент отправляет запрос загрузки политики пароля к службе прокси. Служба прокси-сервера в свою очередь отправляет запрос в Azure AD. После этого служба прокси-сервер возвращает ответ службы агента DC.

После того как служба агента DC получает новой политики паролей из Azure AD, служба сохраняет политику в соответствующей папке, в корне домена *sysvol* общей папке. Служба агента DC также отслеживает эту папку, в случае, если репликация новой политики из других служб агента для контроллера домена в домене.

Служба агента DC всегда запрашивает новую политику при запуске службы. После запуска службы агента для контроллера домена, он проверяет возраст доступны локально текущую политику каждый час. Если эта политика не старше одного часа, контроллер домена агент запрашивает новую политику из Azure AD с помощью службы прокси-сервера, как описано выше. Если текущая политика не старше одного часа, агента DC продолжает использовать эту политику.

Каждый раз, когда загружается политики пароля защиты пароля Azure AD, то эта политика будет для клиента. Другими словами политики паролей, всегда представляют собой сочетание глобальный список запрещенных паролей Майкрософт и пользовательского списка запрещенных пароль для каждого клиента.

Агент DC взаимодействует со службой прокси-сервера через RPC по протоколу TCP. Служба прокси-сервер осуществляет прослушивание этих вызовов через динамический или статический RPC порт, в зависимости от конфигурации.

Агента DC никогда не прослушивает порт доступен в сети.

Служба прокси-сервера никогда не вызывает службу агента DC.

Прокси-службу без отслеживания состояния. Он никогда не кэширует политики или любом другом состоянии, загруженные из Azure.

Служба агента DC всегда использует последние политики паролей доступны локально для оценки пароля. Если политика паролей не доступен на локальном контроллере домена, пароль принимается автоматически. Когда это происходит, чтобы предупредить администратор регистрируется сообщение о событии.

Защита паролей Azure AD не механизм приложения политик в режиме реального времени. Возможна задержка между когда производится изменение конфигурации политики паролей в Azure AD и когда, изменить достигает и применяется на всех контроллерах домена.

Защита паролей Azure AD выступает в роли в дополнение к существующей политики паролей Active Directory, не является заменой. Сюда входят все другие сторонние пароль фильтра библиотеки DLL, могут быть установлены. Active Directory всегда требует, чтобы все компоненты проверки пароля принимаете до принятия пароль.

## <a name="foresttenant-binding-for-password-protection"></a>Привязка леса или клиента для защиты паролем

Развертывание защиты пароля Azure AD в лесу Active Directory требует регистрации этого леса в Azure AD. Каждая служба прокси-сервера, который развертывается также должны регистрироваться в Azure AD. Эти операции регистрации леса и прокси-сервера связаны с конкретным клиентом Azure AD, который неявно определяется учетные данные, которые используются во время регистрации.

В лесу Active Directory и все развернутые прокси-сервера службы в рамках леса должны быть зарегистрированы с помощью того же клиента. Имеет лесу Active Directory или любой другой службы прокси-сервера, то есть лес, регистрируемой в другой каталог Azure AD версии клиента не поддерживается. Признаки неправильной конфигурацией развертывания включают невозможность загрузки политики паролей.

## <a name="download"></a>Download (Скачать)

Два установщика агента, необходимые для защиты паролей Azure AD доступны из [центра загрузки Майкрософт](https://www.microsoft.com/download/details.aspx?id=57071).

## <a name="next-steps"></a>Дальнейшие действия
[Развертывание защиты паролем Azure AD](howto-password-ban-bad-on-premises-deploy.md)
