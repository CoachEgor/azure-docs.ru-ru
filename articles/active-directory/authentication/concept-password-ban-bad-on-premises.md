---
title: Защита паролем Azure AD — Azure Active Directory
description: BЗлоумышленник слабых паролей в локальных Active Directory с помощью защиты паролей Azure AD
services: active-directory
ms.service: active-directory
ms.subservice: authentication
ms.topic: conceptual
ms.date: 02/18/2018
ms.author: iainfou
author: iainfoulds
manager: daveba
ms.reviewer: jsimmons
ms.collection: M365-identity-device-management
ms.openlocfilehash: 1b9d07099f8de996181948921330ef6744b302a8
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "74848652"
---
# <a name="enforce-azure-ad-password-protection-for-windows-server-active-directory"></a>применение защиты паролем Azure AD для Windows Server Active Directory

Защита паролей Azure AD — это функция, которая расширяет политики паролей в Организации. Локальное развертывание защиты паролем использует как глобальные, так и настраиваемые списки запрещенных паролей, хранящиеся в Azure AD. Она выполняет те же проверки в локальной среде, что и Azure AD для облачных изменений. Эти проверки выполняются во время изменения пароля и сценариев сброса пароля.

## <a name="design-principles"></a>Принципы проектирования

Защита паролем Azure AD разработана с учетом следующих принципов.

* Контроллерам домена никогда не нужно напрямую взаимодействовать с Интернетом.
* На контроллерах домена не открываются новые сетевые порты.
* Изменения схемы Active Directory не требуются. Программное обеспечение использует существующий **контейнер** Active Directory и объекты схемы **serviceConnectionPoint** .
* Минимальный режим работы Active Directory домена или леса (ДФЛ/FFL) не требуется.
* Программное обеспечение не создает или не требует учетных записей в защищенных доменах Active Directory.
* Пользовательские пароли никогда не оставляют контроллер домена во время операций проверки пароля или в любое другое время.
* Программное обеспечение не зависит от других функций Azure AD. Например, синхронизация хэша паролей Azure AD не связана и не требуется для работы защиты паролей Azure AD.
* Добавочное развертывание поддерживается, однако политика паролей применяется только в том случае, когда установлен агент контроллера домена (агент DC). Дополнительные сведения см. в следующем разделе.

## <a name="incremental-deployment"></a>Добавочное развертывание

Защита паролей Azure AD поддерживает добавочное развертывание между контроллерами домена в Active Directory домене, но важно понимать, что это действительно означает и каковы компромиссы.

Программное обеспечение агента контроллера домена для защиты паролем Azure AD может проверять только пароли, установленные на контроллере домена, и только изменения паролей, отправленные на этот контроллер домена. Невозможно контролировать, какие контроллеры домена выбираются клиентскими компьютерами Windows для обработки изменений паролей пользователей. Чтобы обеспечить согласованное поведение и принудительную защиту универсального пароля, программное обеспечение агента DC должно быть установлено на всех контроллерах домена в домене.

Во многих организациях требуется тщательное тестирование защиты паролей Azure AD на подмножестве контроллеров домена перед полным развертыванием. Защита паролей Azure AD поддерживает частичное развертывание, IE. программное обеспечение агента контроллера домена на заданном КОНТРОЛЛЕРе домена активно проверяет пароли, даже если на других контроллерах домена не установлено программное обеспечение агента DC. Частичные развертывания этого типа не являются безопасными и не рекомендуются для целей тестирования.

## <a name="architectural-diagram"></a>Схема архитектуры

Прежде чем развертывать защиту паролей Azure AD в локальной среде Active Directory, важно понимать основные понятия проектирования и функций. На следующей схеме показана совместная работа компонентов защиты паролей.

![Взаимодействие компонентов защиты паролем Azure AD](./media/concept-password-ban-bad-on-premises/azure-ad-password-protection.png)

* Служба прокси-сервера Защиты паролей Azure AD выполняется на любом компьютере, присоединенном к домену, в текущем лесу Active Directory. Его основная задача — пересылка запросов на скачивание политики паролей с контроллеров домена в Azure AD. Затем он возвращает ответы от Azure AD к контроллеру домена.
* Библиотека DLL фильтра паролей агента контроллера домена получает запросы проверки пароля пользователя от операционной системы. Он перенаправляет их в службу агента контроллера домена, которая работает локально на контроллере домена.
* Служба "агент контроллера домена" защищена паролем и получает запросы на проверку пароля от библиотеки DLL фильтра паролей агента контроллера домена. Он обрабатывает их с использованием текущей (локально доступной) политики паролей и возвращает результат: *Pass* или *Fail*.

## <a name="how-password-protection-works"></a>Как работает защита паролем

Каждый экземпляр прокси-службы защиты паролей Azure AD объявляет себя контроллерам домена в лесу, создавая объект **serviceConnectionPoint** в Active Directory.

Каждая служба агента контроллера домена для защиты паролем также создает объект **serviceConnectionPoint** в Active Directory. Этот объект используется в основном для создания отчетов и диагностики.

Служба агента контроллера домена отвечает за запуск скачивания новой политики паролей из Azure AD. Первым шагом является поиск прокси-службы защиты паролей Azure AD путем запроса леса для прокси-объектов **serviceConnectionPoint** . При обнаружении доступной прокси-службы агент контроллера домена отправляет запрос на скачивание политики паролей в прокси-службу. Прокси-служба в свою очередь отправляет запрос в Azure AD. Затем служба прокси-сервера возвращает ответ службе агента контроллера домена.

После того как служба агента контроллера домена получает новую политику паролей из Azure AD, она сохраняет политику в выделенной папке в корне общей папки *SYSVOL* домена. Служба агента контроллера домена также отслеживает эту папку в случае, если более новые политики реплицируются из других служб агента контроллера домена в домене.

Служба агента контроллера домена всегда запрашивает новую политику при запуске службы. После запуска службы агента контроллера домена он проверяет возраст текущей локальной политики ежечасно. Если политика старше одного часа, агент контроллера домена запрашивает новую политику из Azure AD через прокси-службу, как описано выше. Если текущая политика не старше одного часа, агент контроллера домена продолжит использовать эту политику.

При загрузке политики паролей для защиты паролем Azure AD эта политика относится к клиенту. Иными словами, политики паролей всегда являются сочетанием списка с глобальными запрещенными паролями Майкрософт и списка запрещенных паролей для каждого клиента.

Агент контроллера домена взаимодействует со службой прокси через RPC через TCP. Прокси-служба прослушивает эти вызовы на динамическом или статическом порте RPC в зависимости от конфигурации.

Агент контроллера домена никогда не прослушивает порт, доступный по сети.

Прокси-служба никогда не вызывает службу агента контроллера домена.

Служба прокси-сервера не имеет состояния. Он никогда не кэширует политики или другие состояния, скачанные из Azure.

Служба агента контроллера домена всегда использует последнюю локальную политику паролей для вычисления пароля пользователя. Если на локальном контроллере домена нет доступной политики паролей, пароль будет автоматически принят. В этом случае в журнал заносится сообщение о событии, чтобы предупредить администратора.

Защита паролей Azure AD не является ядром приложения политики реального времени. Возможна задержка между изменением конфигурации политики паролей в Azure AD, а также тем, когда это изменение достигает и применяется на всех контроллерах домена.

Защита паролей Azure AD действует как дополнение к существующим политикам паролей Active Directory, а не к замене. Сюда входят любые другие DLL-библиотеки фильтрации паролей сторонних производителей, которые могут быть установлены. Active Directory всегда требует, чтобы все компоненты проверки пароля были согласованы перед принятием пароля.

## <a name="foresttenant-binding-for-password-protection"></a>Привязка леса или клиента для защиты паролем

Для развертывания защиты паролей Azure AD в лесу Active Directory требуется регистрация этого леса в Azure AD. Каждая развернутая прокси-служба также должна быть зарегистрирована в Azure AD. Эти регистрации леса и прокси-сервера связаны с определенным клиентом Azure AD, который неявно определяется учетными данными, используемыми во время регистрации.

Лес Active Directory и все развернутые прокси-службы в лесу должны быть зарегистрированы в одном и том же клиенте. Не поддерживается наличие Active Directory леса или любых прокси-служб в этом лесу, которые регистрируются в разных клиентах Azure AD. Симптомы такого неправильного развертывания включают невозможность загрузки политик паролей.

## <a name="download"></a>Скачивание

Два необходимых установщика агента для защиты паролей Azure AD доступны в [центре загрузки Майкрософт](https://www.microsoft.com/download/details.aspx?id=57071).

## <a name="next-steps"></a>Дальнейшие действия
[Развертывание защиты паролем Azure AD](howto-password-ban-bad-on-premises-deploy.md)
