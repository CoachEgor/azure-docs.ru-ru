---
title: Устранение неполадок объединенный регистрации в Azure AD SSPR и многофакторной проверки подлинности (Предварительная версия) — Azure Active Directory
description: Устранение неполадок многофакторную проверку подлинности Azure AD и самостоятельном сбросе пароля объединенный регистрации (Предварительная версия)
services: active-directory
ms.service: active-directory
ms.subservice: authentication
ms.topic: conceptual
ms.date: 02/20/2019
ms.author: joflore
author: MicrosoftGuyJFlo
manager: daveba
ms.reviewer: sahenry
ms.collection: M365-identity-device-management
ms.openlocfilehash: 40918493071fe0dd694c43e2b087a2bf7eb197d8
ms.sourcegitcommit: 41ca82b5f95d2e07b0c7f9025b912daf0ab21909
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "60414633"
---
# <a name="troubleshooting-combined-security-information-registration-preview"></a>Устранение неполадок в сочетании регистрации сведения безопасности (Предварительная версия)

Сведения в этой статье предназначен для администраторов, устранении неполадок, сообщили пользователи работать на объединенный регистрации.

|     |
| --- |
| Объединенный безопасности сведения о регистрации для многофакторной идентификации Azure и Azure Active Directory (Azure AD) самостоятельного сброса пароля — это функция предварительной версии Azure AD. См. подробные сведения о [дополнительных условиях использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).|
|     |

## <a name="audit-logs"></a>Журналы аудита

События, зарегистрированные для объединенных регистрации находятся в категории методов проверки подлинности в Azure AD журналы аудита.

![Интерфейс отображение регистрации событий журналов аудита Azure AD](media/howto-registration-mfa-sspr-combined-troubleshoot/combined-security-info-audit-log.png)

В следующей таблице перечислены все события аудита, создаваемые объединенный регистрации:

| Действие | Status | `Reason` | Описание |
| --- | --- | --- | --- |
| Пользователь зарегистрировал все сведения о безопасности | Успешно | Пользователь зарегистрировал все сведения о безопасности. | Это событие происходит после успешного завершения регистрации пользователя.|
| Пользователь зарегистрировал все сведения о безопасности | Сбой | Пользователь отменил регистрацию сведений о безопасности. | Это событие происходит, когда пользователь отменяет регистрацию из режима прерываний.|
| Пользователь зарегистрировал сведения о безопасности | Успешно | Пользователь зарегистрирован *метод*. | Это событие происходит, когда пользователь регистрируется отдельного метода. *Метод* может быть структуры проверки подлинности приложения, телефон, электронной почты, безопасности вопросы, приложение пароль, Дополнительный телефон и т. д.| 
| Сведения о безопасности пользователя проверен | Успешно | Пользователь успешно проверить сведения о безопасности. | Это событие происходит, когда пользователь выбирает **вас устраивает** на странице «Просмотр сведений о безопасности».|
| Сведения о безопасности пользователя проверен | Сбой | Не удалось просмотреть сведения о безопасности пользователя. | Это событие происходит, когда пользователь выбирает **вас устраивает** на сведения о безопасности, просмотрите страницу, но что-то происходит сбой в серверной части.|
| Сведения о безопасности пользователь удален | Успешно | Пользователь удалил *метод*. | Это событие возникает, когда пользователь удаляет отдельного метода. *Метод* может быть структуры проверки подлинности приложения, телефон, электронной почты, безопасности вопросы, приложение пароль, Дополнительный телефон и т. д.|
| Сведения о безопасности пользователь удален | Сбой | Не удалось удалить пользователя *метод*. | Это событие происходит, когда пользователь пытается получить метод delete, но попытка завершается неудачей по некоторым причинам. *Метод* может быть структуры проверки подлинности приложения, телефон, электронной почты, безопасности вопросы, приложение пароль, Дополнительный телефон и т. д.|
| Сведения о безопасности по умолчанию для пользователя изменилось | Успешно | Пользователь изменил сведения о безопасности по умолчанию для *метод*. | Это событие происходит, когда пользователь изменяет метод по умолчанию. *Метод* может быть уведомление от приложения структуры проверки подлинности, код в моем приложении authenticator или токене, вызов + X XXXXXXXXXX, текста, код, чтобы + X XXXXXXXXX и т. д.|
| Сведения о безопасности по умолчанию для пользователя изменилось | Сбой | Не удалось изменить сведения о безопасности по умолчанию для пользователя *метод*. | Это событие происходит, когда пользователь пытается изменить метод по умолчанию, но попытка завершается неудачей по некоторым причинам. *Метод* может быть уведомление от приложения структуры проверки подлинности, код в моем приложении authenticator или токене, вызов + X XXXXXXXXXX, текста, код, чтобы + X XXXXXXXXX и т. д.|

## <a name="troubleshooting-interrupt-mode"></a>Устранение неполадок в режиме прерываний

| Симптом | Действия по устранению неполадок |
| --- | --- |
| Я не вижу методы, которые я ожидал. | 1. Проверьте, есть ли у пользователя роль администратора Azure AD. Если Да, просмотрите различия политики администратора SSPR. <br> 2. Определите, выполняется ли прерывание пользователя из-за органы регистрации многофакторной проверки подлинности или принудительной регистрации SSPR. См. в разделе [блок-схема](../../active-directory/authentication/concept-registration-mfa-sspr-combined.md#combined-registration-modes) в разделе «Режимы регистрации Combined» для определения, какие методы должны отображаться. <br> 3. Определите, каким образом недавно изменена политика многофакторной идентификации или SSPR. В случае последних изменений может занять некоторое время, обновленная политика для распространения.|

## <a name="troubleshooting-manage-mode"></a>Устранение неполадок управления режим

| Симптом | Действия по устранению неполадок |
| --- | --- |
| Отсутствует параметр для добавления определенного метода. | 1. Определяет, включено ли метод для многофакторной проверки подлинности или для SSPR. <br> 2. Если метод включен, снова сохраните политики и подождите 1 – 2 часа перед тестированием еще раз. <br> 3. Если метод включена, убедитесь, что пользователь не уже настроил максимальное количество, метод, который им разрешено для настройки.|

## <a name="disable-combined-registration"></a>Отключить регистрацию объединенный

Когда пользователь регистрирует номер телефона и/или мобильного приложения в новом сочетании качества, наши службы отметки набор флагов (StrongAuthenticationMethods) для этих методов на этого пользователя. Эта функция позволяет пользователю выполнить многофакторную проверку подлинности с помощью этих методов, каждый раз, когда многофакторная проверка подлинности необходима.

Если администратор включает предварительную версию, пользователь зарегистрироваться с помощью нового интерфейса, а затем администратор отключает предварительной версии, пользователи могут непреднамеренно регистрироваться для многофакторной проверки подлинности также.

Если пользователь завершил объединенный регистрации переходит к текущей странице регистрации Самостоятельного сброса пароля в [ https://aka.ms/ssprsetup ](https://aka.ms/ssprsetup), пользователю будет предложено выполнить многофакторную проверку подлинности при доступе к эту страницу. Этот шаг, ожидаемого от технической точки зрения, но его возможности для пользователей, которые были ранее зарегистрированы для SSPR только. Хотя это дополнительное действие повышения уровня безопасности пользователя, предоставляя еще один уровень безопасности "Администраторы" может потребоваться откат своих пользователей, чтобы они больше не смогут выполнять многофакторную проверку подлинности.  

### <a name="how-to-roll-back-users"></a>Как откатить пользователей

Если вы, как администратор, хотите сбросить параметры многофакторной проверки подлинности пользователя, можно использовать сценарий PowerShell, приведенный в следующем разделе. Скрипт очистит свойство StrongAuthenticationMethods для мобильного приложения пользователя и/или номер телефона. Если вы запустите этот сценарий для пользователей, им нужно будет повторно Зарегистрируйтесь для многофакторной проверки подлинности, если им это действительно необходимо. Мы рекомендуем тестирования отката с одного или двух пользователей, до выполнения отката всех затронутых пользователей.

Следующие шаги, поможет откат пользователя или группы пользователей.

#### <a name="prerequisites"></a>Технические условия

1. Установите соответствующие модули PowerShell для Azure AD. В окне PowerShell выполните следующие команды для установки модулей:

   ```powershell
   Install-Module -Name MSOnline
   Import-Module MSOnline
   ```

1. Сохраните список идентификаторов объектов затронутого пользователя на компьютере как текстовый файл с одним Идентификатором каждой строке. Запишите расположение файла.
1. Сохраните следующий сценарий на компьютере и запишите расположение скрипта:

   ```powershell
   <# 
   //********************************************************
   //*                                                      *
   //*   Copyright (C) Microsoft. All rights reserved.      *
   //*                                                      *
   //********************************************************
   #>

   param($path)

   # Define Remediation Fn
   function RemediateUser {

       param  
       (
           $ObjectId
       )

       $user = Get-MsolUser -ObjectId $ObjectId

       Write-Host "Checking if user is eligible for rollback: UPN: "  $user.UserPrincipalName  " ObjectId: "  $user.ObjectId -ForegroundColor Yellow

       $hasMfaRelyingParty = $false
       foreach($p in $user.StrongAuthenticationRequirements)
       {
           if ($p.RelyingParty -eq "*")
           {
               $hasMfaRelyingParty = $true
               Write-Host "User was enabled for per-user MFA." -ForegroundColor Yellow
           }
       }

       if ($user.StrongAuthenticationMethods.Count -gt 0 -and -not $hasMfaRelyingParty)
       {
           Write-Host $user.UserPrincipalName " is eligible for rollback" -ForegroundColor Yellow
           Write-Host "Rolling back user ..." -ForegroundColor Yellow
           Reset-MsolStrongAuthenticationMethodByUpn -UserPrincipalName $user.UserPrincipalName
           Write-Host "Successfully rolled back user " $user.UserPrincipalName -ForegroundColor Green
       }
       else
       {
           Write-Host $user.UserPrincipalName " is not eligible for rollback. No action required."
       }

       Write-Host ""
       Start-Sleep -Milliseconds 750
   }

   # Connect
   Import-Module MSOnline
   Connect-MsolService

   foreach($line in Get-Content $path)
   {
       RemediateUser -ObjectId $line
   }
   ```

#### <a name="rollback"></a>Откат

В окне PowerShell, выполните следующую команду предоставляя расположение файлов скрипта и пользователем. При появлении запроса введите учетные данные глобального администратора. Сценарий выведет результат каждой операции обновления пользователя.

`<script location> -path <user file location>`

### <a name="disable-the-preview-experience"></a>Отключить предварительную версию

Чтобы отключить предварительную версию для пользователей, выполните следующие действия:

1. Войдите на портал Azure как администратор пользователей.
2. Перейдите к **Azure Active Directory** > **параметры пользователя** > **Управление параметрами для компонентов предварительной версии панель доступа**.
3. В разделе **пользователи могут использовать функции предварительной версии для регистрации и управления ими сведения о безопасности**, присвоено селектор **None**, а затем выберите **Сохранить**.

Пользователи больше не потребоваться зарегистрировать с помощью предварительной версии.

## <a name="next-steps"></a>Дальнейшие действия

* [Дополнительные сведения об общедоступной предварительной версии объединенного регистрация для самостоятельного сброса пароля и многофакторной идентификации Azure](concept-registration-mfa-sspr-combined.md)
