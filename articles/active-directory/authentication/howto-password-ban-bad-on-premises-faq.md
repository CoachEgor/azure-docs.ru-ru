---
title: Вопросы и ответы о локальной службе защиты паролем Azure AD
description: Просмотр часто задаваемых вопросов для защиты паролем Azure AD в предварительной среде активных служб доменов каталогов
services: active-directory
ms.service: active-directory
ms.subservice: authentication
ms.topic: how-to
ms.date: 11/21/2019
ms.author: iainfou
author: iainfoulds
manager: daveba
ms.reviewer: jsimmons
ms.collection: M365-identity-device-management
ms.openlocfilehash: 16537ba72eb9f11abd8de47256150818c121a140
ms.sourcegitcommit: 62c5557ff3b2247dafc8bb482256fef58ab41c17
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/03/2020
ms.locfileid: "80652639"
---
# <a name="azure-ad-password-protection-on-premises-frequently-asked-questions"></a>Защита паролем Azure AD в помещениях часто задавала вопросы

В этом разделе содержатся ответы на многие часто задаваемые вопросы о защите паролем Azure AD.

## <a name="general-questions"></a>Общие вопросы

**В: Какие рекомендации следует дать пользователям по выбору защищенного пароля?**

В настоящее время это руководство Майкрософт можно найти по следующей ссылке:

[Руководство по паролям](https://www.microsoft.com/research/publication/password-guidance)

**В: Поддерживается ли защита предпосылок Azure AD Password Protection в непубличных облаках?**

Нет. Локальная служба защиты паролем Azure AD поддерживается только в общедоступных облаках. Дата доступности в необщедоступных облаках еще не объявлена.

Портал Azure AD позволяет модифицизировать конфигурацию "Защита паролей для Windows Server Active Directory" даже в непубличных облаках; такие изменения будут сохраняться, но в противном случае никогда не вступят в силу. Регистрация находящихся в помещениях прокси-агентов или лесов не поддерживается при использовании непубличных облачных учетных данных, и любые такие попытки регистрации всегда не увенчаются неудачей.

**В: Как применить преимущества по защите паролок Azure AD к подмножестве моих пользователей?**

Не поддерживается. После развертывания и включения служба защиты паролей Azure AD не разделяет пользователей — все пользователи получают одинаковые преимущества безопасности.

**В: В чем разница между изменением пароля и набором паролей (или сбросить)?**

Изменение пароля — это когда пользователь выбирает новый пароль, доказав, что он знает старый пароль. Например, изменение пароля происходит, когда пользователь входит в Windows, а затем предлагается выбрать новый пароль.

Набор паролей (иногда называемый сбросить пароль) — это когда администратор заменяет пароль на учетной записи новым паролем, например, используя инструмент управления Active Directory и Компьютеры. Эта операция требует высокого уровня привилегий (обычно Domain Admin), и лицо, выполняющее операцию, как правило, не имеет знаний о старом пароле. Сценарии службы поддержки часто выполняют наборы паролей, например, при оказании помощи пользователю, который забыл свой пароль. Вы также увидите события набора паролей, когда впервые создается новая учетная запись пользователя с паролем.

Политика проверки пароля ведет себя одинаково независимо от того, выполняется ли изменение пароля или набор. Служба агент Azure AD Password Protection D действительно регистрирует различные события, чтобы сообщить вам, было ли сделано изменение пароля или операция набора.  Смотрите [мониторинг и журнал Azure AD Password Protection.](https://docs.microsoft.com/azure/active-directory/authentication/howto-password-ban-bad-on-premises-monitor)

**В: Почему дублируются события отторжения паролей при попытке установить слабый пароль с помощью привязки с помощью Active Directory Users и Управления компьютерами?**

Активные пользователи каталога и компьютеры управления оснастки в первую очередь попытаться установить новый пароль с помощью протокола Kerberos. После сбоя, оснастки сделает вторую попытку установить пароль с помощью устаревшего (SAM RPC) протокол (конкретные протоколы, используемые не важны). Если новый пароль считается слабым по Azure AD Password Protection, такое поведение оснастки приведет к тому, что два набора событий сброса пароля будут зарегистрированы.

**В: Почему события проверки паролей Azure AD Password Protection регистрируются с пустым именем пользователя?**

Active Directory поддерживает возможность тестирования пароля, чтобы увидеть, если он проходит текущие требования сложности пароля домена, например, с помощью [NetValidatePasswordPolicy](https://docs.microsoft.com/windows/win32/api/lmaccess/nf-lmaccess-netvalidatepasswordpolicy) api. Когда пароль проверяется таким образом, тестирование также включает в себя проверку с помощью продуктов на основе фильтра паролей, таких как Azure AD Password Protection, но имена пользователей, передаваемые данному фильтру пароля dll, будут пустыми. В этом случае Azure AD Password Protection по-прежнему проверяет пароль, используя в настоящее время неэффективную политику паролей, и выпустит сообщение журнала событий для фиксации результата, однако в сообщении журнала событий будут пустые поля имен пользователя.

**В: Поддерживается ли установка Azure AD Password Protection бок о бок с другими продуктами на основе фильтра паролей?**

Да. Поддержка нескольких зарегистрированных библиотек DLL для фильтрации по паролю является основной функцией Windows и не относится к защите паролем Azure AD. Все зарегистрированные библиотеки DLL для фильтрации по паролю должны подтвердить пароль, прежде чем он будет принят.

**В: Как развернуть и настроить защиту aD Azure AD в среде Active Directory без использования Azure?**

Не поддерживается. Защита паролей Azure AD — это компонент Azure, который поддерживает расширение в локальную среду Active Directory.

**В: Как изменить содержимое политики на уровне Active Directory?**

Не поддерживается. Политика может быть администрирована только с помощью портала Azure AD. См. также предыдущий вопрос.

**Вопрос. Почему для репликации SYSVOL требуется DFSR?**

Технология FRS (предшествующая технологии DFSR) имеет множество известных проблем и полностью не поддерживается в новых версиях Windows Server Active Directory. Ноль-тестирование защиты паролем Azure AD будет выполняться на доменах, для которых настроена FRS.

Дополнительные сведения приведены в следующих статьях:

[The Case for Migrating sysvol replication to DFSR](https://blogs.technet.microsoft.com/askds/2010/04/22/the-case-for-migrating-sysvol-to-dfsr) (Вариант переноса репликации SYSVOL в DFSR)

[The End is Nigh for FRS](https://blogs.technet.microsoft.com/filecab/2014/06/25/the-end-is-nigh-for-frs) (Близится конец FRS)

Если ваш домен уже не использует DFSR, вы должны перенести его на использование DFSR перед установкой Azure AD Password Protection. Для получения дополнительной информации, см.

[SYSVOL Репликация Миграция Руководство: FRS для DFS репликации](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/dd640019(v=ws.10))

> [!WARNING]
> Программное обеспечение Azure AD Password Protection DC Agent в настоящее время устанавливается на контроллеры доменов в доменах, которые все еще используют FRS для репликации sysvol, но программное обеспечение не будет работать должным образом в этой среде. Дополнительные негативные побочные эффекты включают отдельные файлы, не в состоянии воспроизвести, и sysvol восстановления процедур, как представляется, удалось, но молча не в состоянии воспроизвести все файлы. Необходимо как можно скорее перенести свой домен, чтобы использовать DFSR, как для присущих DFSR преимуществ, так и для разблокировки развертывания Azure AD Password Protection. Будущие версии программного обеспечения будут автоматически отключены при запуске в домене, который все еще использует FRS.

**В: Сколько дискового пространства требуется на доменs sysvol?**

Точное использование пространства зависит от таких факторов, как количество и длина запрещенных маркеров в глобальном списке запрещенных маркеров Майкрософт и настраиваемом списке каждого клиента, а также накладные расходы на шифрование. Эти списки, вероятно, будут расширяться в будущем. Учитывая это, разумно ожидать, что для этого компонента потребуется по крайней мере пять (5) мегабайт пространства в общей папке sysvol домена.

**Вопрос. Почему для установки или обновления программного обеспечения агента контроллера домена требуется перезагрузка?**

Это требование связано с ключевым механизмом Windows.

**В. Имеется ли способ настроить агент контроллера домена для использования конкретного прокси-сервера?**

Нет. Так как прокси-сервер не учитывает состояние, не важно, какой конкретный прокси-сервер используется.

**В: Можно ли развертывать прокси-сервис Azure AD Password Protection бок о бок с другими службами, такими как Azure AD Connect?**

Да. Служба прокси-сервера Защиты паролей Azure AD и Azure AD Connect никогда не конфликтуют друг с другом напрямую.

К сожалению, была обнаружена несовместимость между версией службы Microsoft Azure AD Connect Agent Updater, установленной программным обеспечением Azure AD Password Protection Proxy, и версией службы, установленной программным обеспечением [Azure Active Directory Application Proxy.](https://docs.microsoft.com/azure/active-directory/manage-apps/application-proxy) Эта несовместимость может привести к тому, что служба обновления агента не сможет связаться с Azure для обновления программного обеспечения. Не рекомендуется устанавливать на одну машину прокси-сервер Azure AD Password Protection Protection и Azure Active Directory Proxy.

**Вопрос: В каком порядке должны быть установлены и зарегистрированы агенты и доверенные источники постоянного тока?**

Поддерживается любой заказ установки прокси-агента, установки агента ПОСТОЯННОГО ТОКа, регистрации лесов и регистрации прокси.

**В: Должен ли я беспокоиться о производительности, попавшой на контроллеры домена от развертывания этой функции?**

Служба агента контроллера домена Защиты паролей Azure AD не должна существенно влиять на производительность контроллера домена в существующем работоспособном развертывании Active Directory.

Для большинства развертываний Active Directory операции изменения пароля составляют небольшую часть общей рабочей нагрузки на любой контроллер домена. Например, представьте домен Active Directory с 10 000 учетных записей пользователей и политикой MaxPasswordAge со значением 30 дней. В среднем на этом домене будет выполняться 10 000/30=~333 операции смены паролей каждый день, что является незначительным количеством операций даже для одного контроллера домена. Рассмотрим потенциальный наихудший сценарий: предположим, что эти ~333 смены пароля на одном контроллере домена произошли за один час. Например, этот сценарий может возникнуть, когда много сотрудников приходят на работу утром в понедельник. Даже в этом случае мы по-прежнему получаем ~333/60 минут = шесть изменений пароля в минуту, что опять же не является значительной нагрузкой.

Тем не менее, если текущие контроллеры домена уже работают на уровнях с ограниченной производительностью (например, по максимуму используют ЦП, дисковое пространство, дисковые операции ввода-вывода и т. д.), рекомендуется добавить дополнительные контроллеры домена или расширить доступное дисковое пространство перед развертыванием этого компонента. См. также вопрос об использовании дискового пространства sysvol выше.

**В: Я хочу протестировать защиту паролем Azure AD на нескольких DC в моем домене. Можно ли заставить пользователей изменить пароль для использования этих конкретных DCs?**

Нет. Клиентская ОС Windows определяет, какой контроллер домена используется при изменении пароля пользователем. Контроллер домена выбирается на основе таких факторов, как сайт Active Directory и назначения подсети, конфигурация сети, специфичная для среды, и т.д. Azure AD Password Protection не контролирует эти факторы и не может влиять на контроллер домена, выбранный для изменения пароля пользователя.

Один из способов частично достичь этой цели — развернуть Защиту паролей Azure AD на всех контроллерах домена на данном сайте Active Directory. Такой подход обеспечит разумное покрытие для клиентов Windows, назначенных этому сайту, а также для пользователей, которые входят в эти клиенты и меняют свои пароли.

**В: Если я установим службу Azure AD Password Protection DC Agent только на контроллер первичного домена (PDC), будут ли также защищены все другие контроллеры доменов в домене?**

Нет. Когда пароль пользователя изменяется на контроллере домена, отличном от основного, открытый пароль никогда не отправляется на основной контроллер домена (эта идея является распространенным заблуждением). Когда новый пароль будет принят на данном контроллере домена, этот контроллер домена начнет использовать его, чтобы создавать различные хэши этого пароля для конкретного протокола аутентификации, а затем сохранять их в каталоге. Открытый пароль не сохраняется. Затем обновленные хэши реплицируются в этот основной контроллер домена. В некоторых случаях пароли пользователей могут быть изменены непосредственно на основном контроллере домена в зависимости от различных факторов, таких как топология сети и структура сайта Active Directory. (См. предыдущий вопрос.)

Таким образом, развертывание службы агента контроллера домена Защиты паролей Azure AD только на основном контроллере домена необходимо для достижения 100%-го уровня безопасности компонента в домене. Развертывание компонента только на основном контроллере домена не предоставляет преимуществ Защиты паролей Azure AD для других контроллеров в домене.

**В: Почему пользовательский интеллектуальный локаут не работает даже после установки агентов в моей среде Active Directory?**

Пользовательская интеллектуальная блокировка поддерживается только в Azure AD. Изменения в пользовательских настройках смарт-блокировки на портале Azure AD не влияют на среду active Directory в непредскую среду, даже при установке агентов.

**В: Доступен ли пакет управления управлением операционными операциями Системного центра для защиты паролем Azure AD?**

Нет.

**В: Почему Azure AD по-прежнему отвергает слабые пароли, даже если я настроил политику в режиме аудита?**

Режим аудита поддерживается только в среде on-premises Active Directory. Azure AD неявно всегда находится в режиме «принудительного исполнения», когда он оценивает пароли.

**В: Мои пользователи видят традиционное сообщение об ошибке Windows, когда пароль отклоняется Защитой паролем Azure AD. Можно ли настроить это сообщение об ошибке так, чтобы пользователи знали, что произошло на самом деле?**

Нет. Сообщение об ошибке, просматриваемые пользователями при отклонении пароля контроллером домена, контролируется клиентской машиной, а не контроллером домена. Такое поведение происходит независимо от того, отклоняется ли пароль политики по умолчанию Active Directory или на основе пароля-фильтра, такого как Azure AD Password Protection.

## <a name="additional-content"></a>Дополнительное содержимое

Следующие ссылки не являются частью основной документации по Защите паролей Azure AD, но могут быть полезным источником дополнительных сведений о компоненте.

[Защита паролем Azure AD теперь доступна!](https://techcommunity.microsoft.com/t5/Azure-Active-Directory-Identity/Azure-AD-Password-Protection-is-now-generally-available/ba-p/377487)

[Email Phishing Protection Guide - Часть 15: Реализация службы защиты паролок Microsoft Azure AD (для On-Premises тоже!)](https://blogs.technet.microsoft.com/cloudready/2018/10/14/email-phishing-protection-guide-part-15-implement-the-microsoft-azure-ad-password-protection-service-for-on-premises-too/)

[Azure AD Password Protection and Smart Lockout are now in Public Preview!](https://techcommunity.microsoft.com/t5/Azure-Active-Directory-Identity/Azure-AD-Password-Protection-and-Smart-Lockout-are-now-in-Public/ba-p/245423#M529) (Компонент "Защита паролей Azure AD" и интеллектуальная блокировка теперь предоставляются в общедоступной версии)

## <a name="microsoft-premierunified-support-training-available"></a>Доступно обучение по поддержке Microsoft Premier и Единой поддержке Майкрософт

Если вы хотите узнать больше о Защите паролей Azure AD и развертывании этого компонента в своей среде, вы можете воспользоваться проактивной службой Майкрософт, доступной для тех клиентов, которые заключили контракт на поддержку Premier или Единую поддержку. Служба называется Azure Active Directory: Защита паролей. Свяжитесь со своим техническим менеджером по работе с клиентами, чтобы получить дополнительные сведения.

## <a name="next-steps"></a>Дальнейшие действия

Если у вас есть вопрос о локальной службе защиты паролей Azure AD, который не освещается в этой статье, ниже вы можете отправить нам отзыв. Спасибо!

[Развертывание защиты паролем Azure AD](howto-password-ban-bad-on-premises-deploy.md)
