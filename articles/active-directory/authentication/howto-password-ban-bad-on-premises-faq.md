---
title: Вопросы и ответы о локальной службе защиты паролем Azure AD
description: Ознакомьтесь с часто задаваемыми вопросами о защите паролей Azure AD в локальной среде служб домен Active Directory
services: active-directory
ms.service: active-directory
ms.subservice: authentication
ms.topic: how-to
ms.date: 11/21/2019
ms.author: iainfou
author: iainfoulds
manager: daveba
ms.reviewer: jsimmons
ms.collection: M365-identity-device-management
ms.openlocfilehash: 24db7981557cf76f9108a1dca37ea4c4c9f51951
ms.sourcegitcommit: dccb85aed33d9251048024faf7ef23c94d695145
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/28/2020
ms.locfileid: "87283084"
---
# <a name="azure-ad-password-protection-on-premises-frequently-asked-questions"></a>Часто задаваемые вопросы о защите паролей Azure AD

В этом разделе содержатся ответы на часто задаваемые вопросы о защите паролей Azure AD.

## <a name="general-questions"></a>Общие вопросы

**Вопрос. какие рекомендации следует предоставить пользователям для выбора безопасного пароля?**

В настоящее время это руководство Майкрософт можно найти по следующей ссылке:

[Руководство по паролям](https://www.microsoft.com/research/publication/password-guidance)

**Вопрос. Локальная защита паролей Azure AD поддерживается в облаках, не являющихся общедоступными?**

Нет. Локальная служба защиты паролем Azure AD поддерживается только в общедоступных облаках. Дата доступности в необщедоступных облаках еще не объявлена.

Портал Azure AD позволяет вносить изменения в локальную конфигурацию защиты паролем для Windows Server Active Directory "даже в общедоступных облаках; такие изменения будут сохранены, но в противном случае они никогда не вступят в силу. Регистрация локальных прокси-агентов или лесов не поддерживается при использовании учетных данных облака, не являющихся общедоступными, и любые такие попытки регистрации всегда будут завершаться сбоем.

**Вопрос. как можно применить преимущества защиты паролем Azure AD к подмножеству локальных пользователей?**

Не поддерживается. После развертывания и включения служба защиты паролей Azure AD не разделяет пользователей — все пользователи получают одинаковые преимущества безопасности.

**Вопрос. Какова разница между изменением пароля и набором паролей (или сбросом)?**

Изменение пароля происходит, когда пользователь выбирает новый пароль после подтверждения того, что он знает о старом пароле. Например, изменение пароля — это то, что происходит при входе пользователя в Windows и последующем запросе на выбор нового пароля.

Пароль (иногда называемый сбросом пароля) используется, когда администратор заменяет пароль учетной записи новым паролем, например с помощью средства управления пользователями и компьютерами Active Directory. Эта операция требует высокого уровня привилегий (обычно это администратор домена), и пользователь, выполняющий операцию, обычно не знает о старом пароле. Сценарии службы поддержки часто выполняют наборы паролей, например, при помощи пользователю, который забыл свой пароль. Кроме того, при первом создании новой учетной записи пользователя с паролем будут отображаться события набора паролей.

Политика проверки паролей ведет себя одинаково независимо от того, выполняется ли изменение или Настройка пароля. Служба агента контроллера домена для защиты паролем Azure AD регистрирует различные события, чтобы сообщить вам о том, была ли выполнена операция смены или изменения пароля.  См. раздел [мониторинг и ведение журнала в службе защиты паролей Azure AD](https://docs.microsoft.com/azure/active-directory/authentication/howto-password-ban-bad-on-premises-monitor).

**Вопрос. Почему при попытке задать ненадежный пароль с помощью оснастки "Управление пользователями и компьютерами" Active Directory "регистрируются дублирующиеся события отклонения пароля?"**

Оснастка управления пользователями и компьютерами Active Directory сначала попытается задать новый пароль с помощью протокола Kerberos. После сбоя оснастка попытается установить пароль с помощью устаревшего протокола (SAM RPC) (конкретные используемые протоколы не важны). Если новый пароль считается ненадежным с помощью защиты паролем в Azure AD, это поведение приведет к записи двух наборов событий отклонения сброса пароля.

**Вопрос. Почему события проверки пароля для защиты паролем Azure AD регистрируются с пустым именем пользователя?**

Active Directory поддерживает возможность проверки пароля, чтобы узнать, прошел ли он текущие требования к сложности пароля домена, например с помощью API [нетвалидатепассвордполици](https://docs.microsoft.com/windows/win32/api/lmaccess/nf-lmaccess-netvalidatepasswordpolicy) . Когда пароль проверяется таким образом, тестирование также включает проверку таких продуктов на основе фильтров паролей, как защита паролем Azure AD, но имена пользователей, переданные в указанную DLL фильтра паролей, будут пустыми. В этом сценарии защита паролем Azure AD по-прежнему будет проверять пароль с помощью действующей в настоящее время политики паролей и выдаст сообщение журнала событий для записи результата, однако в сообщении журнала событий будут соблюдаться пустые поля имени пользователя.

**Вопрос. поддерживается ли возможность установки защиты паролей Azure AD параллельно с другими продуктами на основе фильтров паролей?**

Да. Поддержка нескольких зарегистрированных библиотек DLL для фильтрации по паролю является основной функцией Windows и не относится к защите паролем Azure AD. Все зарегистрированные библиотеки DLL для фильтрации по паролю должны подтвердить пароль, прежде чем он будет принят.

**Вопрос. как развернуть и настроить защиту паролей Azure AD в моей Active Directoryной среде без использования Azure?**

Не поддерживается. Защита паролей Azure AD — это компонент Azure, который поддерживает расширение в локальную среду Active Directory.

**Вопрос. как можно изменить содержимое политики на уровне Active Directory?**

Не поддерживается. Политику можно администрировать только с помощью портала Azure AD. См. также предыдущий вопрос.

**Вопрос. Почему для репликации SYSVOL требуется DFSR?**

Технология FRS (предшествующая технологии DFSR) имеет множество известных проблем и полностью не поддерживается в новых версиях Windows Server Active Directory. Ноль-тестирование защиты паролем Azure AD будет выполняться на доменах, для которых настроена FRS.

Дополнительные сведения приведены в следующих статьях:

[The Case for Migrating sysvol replication to DFSR](https://blogs.technet.microsoft.com/askds/2010/04/22/the-case-for-migrating-sysvol-to-dfsr) (Вариант переноса репликации SYSVOL в DFSR)

[The End is Nigh for FRS](https://blogs.technet.microsoft.com/filecab/2014/06/25/the-end-is-nigh-for-frs) (Близится конец FRS)

Если в вашем домене еще не используется служба DFSR, ее необходимо перенести для использования DFSR перед установкой защиты паролей Azure AD. Дополнительные сведения см. по следующей ссылке:

[Руководство по миграции репликации SYSVOL: FRS — репликация DFS](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/dd640019(v=ws.10))

> [!WARNING]
> Программное обеспечение агента DC для защиты паролем Azure AD будет установлено на контроллерах домена в доменах, которые по-прежнему используют службу FRS для репликации SYSVOL, но программное обеспечение не будет работать должным образом в этой среде. К дополнительным отрицательным побочным эффектам относятся отдельные файлы, которые не реплицируются, и процедуры восстановления SYSVOL, которые завершаются успешно, но не выполняют автоматическую репликацию всех файлов. Необходимо выполнить миграцию домена, чтобы использовать DFSR как можно скорее, и для внутренних преимуществ DFSR, а также для разблокировки развертывания защиты паролей Azure AD. Будущие версии программного обеспечения будут автоматически отключены при работе в домене, который по-прежнему использует службу FRS.

**Вопрос. какой объем дискового пространства требуется компоненту для общего ресурса SYSVOL в домене?**

Точное использование пространства зависит от таких факторов, как количество и длина запрещенных маркеров в глобальном списке запрещенных маркеров Майкрософт и настраиваемом списке каждого клиента, а также накладные расходы на шифрование. Эти списки, вероятно, будут расширяться в будущем. Учитывая это, разумно ожидать, что для этого компонента потребуется по крайней мере пять (5) мегабайт пространства в общей папке sysvol домена.

**Вопрос. Почему для установки или обновления программного обеспечения агента контроллера домена требуется перезагрузка?**

Это требование связано с ключевым механизмом Windows.

**В. Имеется ли способ настроить агент контроллера домена для использования конкретного прокси-сервера?**

Нет. Так как прокси-сервер не учитывает состояние, не важно, какой конкретный прокси-сервер используется.

**Вопрос. можно ли развернуть службу защиты паролей Azure AD параллельно с другими службами, такими как Azure AD Connect?**

Да. Служба прокси-сервера Защиты паролей Azure AD и Azure AD Connect никогда не конфликтуют друг с другом напрямую.

К сожалению, обнаружена несовместимость между версией службы обновления агента Microsoft Azure AD Connect, установленной с помощью прокси-сервера защиты паролей Azure AD, и версии службы, которая устанавливается программным обеспечением [Azure Active Directory Application proxy](https://docs.microsoft.com/azure/active-directory/manage-apps/application-proxy) . Такая несовместимость может привести к тому, что службе обновления агента не удается связаться с Azure для обновления программного обеспечения. Не рекомендуется устанавливать прокси-сервер защиты паролей Azure AD и Azure Active Directory Application Proxy на одном компьютере.

**Вопрос. в каком порядке следует устанавливать и регистрировать агенты контроллеров домена и прокси-серверы?**

Поддерживается любое упорядочение установки прокси-агента, установка агента контроллера домена, регистрация леса и регистрация прокси-сервера.

**Вопрос. следует ли мне заботиться о производительности на контроллерах домена от развертывания этого компонента?**

Служба агента контроллера домена Защиты паролей Azure AD не должна существенно влиять на производительность контроллера домена в существующем работоспособном развертывании Active Directory.

Для большинства развертываний Active Directory операции изменения пароля составляют небольшую часть общей рабочей нагрузки на любой контроллер домена. Например, представьте домен Active Directory с 10 000 учетных записей пользователей и политикой MaxPasswordAge со значением 30 дней. В среднем на этом домене будет выполняться 10 000/30=~333 операции смены паролей каждый день, что является незначительным количеством операций даже для одного контроллера домена. Рассмотрим потенциальный наихудший сценарий: предположим, что эти ~333 смены пароля на одном контроллере домена произошли за один час. Например, этот сценарий может возникнуть, когда много сотрудников приходят на работу утром в понедельник. Даже в этом случае мы по-прежнему получаем ~333/60 минут = шесть изменений пароля в минуту, что опять же не является значительной нагрузкой.

Тем не менее, если текущие контроллеры домена уже работают на уровнях с ограниченной производительностью (например, по максимуму используют ЦП, дисковое пространство, дисковые операции ввода-вывода и т. д.), рекомендуется добавить дополнительные контроллеры домена или расширить доступное дисковое пространство перед развертыванием этого компонента. См. также вопрос об использовании дискового пространства sysvol выше.

**Вопрос. я хочу протестировать защиту пароля Azure AD на нескольких контроллерах домена в моем домене. Можно ли принудительно изменить пароль пользователя для использования этих конкретных контроллеров домена?**

Нет. Клиентская ОС Windows определяет, какой контроллер домена используется при изменении пароля пользователем. Контроллер домена выбирается на основе таких факторов, как Active Directory назначений сайтов и подсетей, конфигурация сети, зависящая от среды, и т. д. Защита паролем в Azure AD не контролирует эти факторы и не влияет на выбор контроллера домена для изменения пароля пользователя.

Один из способов частично достичь этой цели — развернуть Защиту паролей Azure AD на всех контроллерах домена на данном сайте Active Directory. Такой подход обеспечит разумное покрытие для клиентов Windows, назначенных этому сайту, а также для пользователей, которые входят в эти клиенты и меняют свои пароли.

**Вопрос. Если установить службу агента DC для защиты паролем Azure AD только на основном контроллере домена (PDC), будут ли также защищены все другие контроллеры домена в этом домене?**

Нет. Когда пароль пользователя изменяется на контроллере домена, отличном от основного, открытый пароль никогда не отправляется на основной контроллер домена (эта идея является распространенным заблуждением). Когда новый пароль будет принят на данном контроллере домена, этот контроллер домена начнет использовать его, чтобы создавать различные хэши этого пароля для конкретного протокола аутентификации, а затем сохранять их в каталоге. Открытый пароль не сохраняется. Затем обновленные хэши реплицируются в этот основной контроллер домена. В некоторых случаях пароли пользователей могут быть изменены непосредственно на основном контроллере домена в зависимости от различных факторов, таких как топология сети и структура сайта Active Directory. (См. предыдущий вопрос.)

Таким образом, развертывание службы агента контроллера домена Защиты паролей Azure AD только на основном контроллере домена необходимо для достижения 100%-го уровня безопасности компонента в домене. Развертывание компонента только на основном контроллере домена не предоставляет преимуществ Защиты паролей Azure AD для других контроллеров в домене.

**Вопрос. Почему пользовательская интеллектуальная блокировка не работает даже после установки агентов в локальной среде Active Directory?**

Пользовательская смарт-блокировка поддерживается только в Azure AD. Изменения настраиваемых параметров смарт-блокировки на портале Azure AD не влияют на локальную среду Active Directory, даже если агенты установлены.

**Вопрос. является ли пакет управления System Center Operations Manager доступным для защиты паролей Azure AD?**

Нет.

**Вопрос. Почему Azure AD все еще отвергает ненадежные пароли, даже если политика включена в режим аудита?**

Режим аудита поддерживается только в локальной среде Active Directory. Azure AD неявно всегда находится в режиме принудительного применения при оценке паролей.

**Вопрос. пользователи видят традиционное сообщение об ошибке Windows при отклонении пароля службой защиты паролей Azure AD. Можно ли настроить это сообщение об ошибке, чтобы пользователи могли узнать, что произошло?**

Нет. Сообщение об ошибке, отображаемое пользователями, если пароль отклонен контроллером домена, управляется клиентским компьютером, а не контроллером домена. Это происходит, когда пароль отклоняется по умолчанию Active Directory политиками паролей или с помощью решения на основе фильтра паролей, такого как защита паролей Azure AD.

## <a name="additional-content"></a>Дополнительное содержимое

Следующие ссылки не являются частью основной документации по Защите паролей Azure AD, но могут быть полезным источником дополнительных сведений о компоненте.

[Служба защиты паролей Azure AD теперь общедоступна.](https://techcommunity.microsoft.com/t5/Azure-Active-Directory-Identity/Azure-AD-Password-Protection-is-now-generally-available/ba-p/377487)

[Руководство по защите от фишинга электронной почты. часть 15. Реализация службы защиты паролей Microsoft Azure AD (для локальной среды).](http://kmartins.com/2018/10/14/email-phishing-protection-guide-part-15-implement-the-microsoft-azure-ad-password-protection-service-for-on-premises-too/)

[Azure AD Password Protection and Smart Lockout are now in Public Preview!](https://techcommunity.microsoft.com/t5/Azure-Active-Directory-Identity/Azure-AD-Password-Protection-and-Smart-Lockout-are-now-in-Public/ba-p/245423#M529) (Компонент "Защита паролей Azure AD" и интеллектуальная блокировка теперь предоставляются в общедоступной версии)

## <a name="microsoft-premierunified-support-training-available"></a>Доступно обучение по поддержке Microsoft Premier и Единой поддержке Майкрософт

Если вы хотите узнать больше о Защите паролей Azure AD и развертывании этого компонента в своей среде, вы можете воспользоваться проактивной службой Майкрософт, доступной для тех клиентов, которые заключили контракт на поддержку Premier или Единую поддержку. Эта служба называется Azure Active Directory: Защита паролем. Свяжитесь со своим техническим менеджером по работе с клиентами, чтобы получить дополнительные сведения.

## <a name="next-steps"></a>Дальнейшие действия

Если у вас есть вопрос о локальной службе защиты паролей Azure AD, который не освещается в этой статье, ниже вы можете отправить нам отзыв. Спасибо!

[Развертывание защиты паролем Azure AD](howto-password-ban-bad-on-premises-deploy.md)
