---
title: Вопросы и ответы по защите паролей в локальной среде Azure AD — Azure Active Directory
description: Вопросы и ответы о локальной службе защиты паролем Azure AD
services: active-directory
ms.service: active-directory
ms.subservice: authentication
ms.topic: article
ms.date: 02/01/2019
ms.author: joflore
author: MicrosoftGuyJFlo
manager: daveba
ms.reviewer: jsimmons
ms.collection: M365-identity-device-management
ms.openlocfilehash: 9f1f2e06eb6b5f8d402515ff1c07a4163174495d
ms.sourcegitcommit: fecb6bae3f29633c222f0b2680475f8f7d7a8885
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/30/2019
ms.locfileid: "68666360"
---
# <a name="azure-ad-password-protection-on-premises---frequently-asked-questions"></a>Часто задаваемые вопросы о локальной службе защиты паролем Azure AD

В этом разделе содержатся ответы на часто задаваемые вопросы о защите паролей Azure AD.

## <a name="general-questions"></a>Общие вопросы

**Вопрос. Какие рекомендации следует предоставить пользователям о том, как выбрать безопасный пароль?**

В настоящее время это руководство Майкрософт можно найти по следующей ссылке:

[Руководство по паролям](https://www.microsoft.com/research/publication/password-guidance)

**Вопрос. Поддерживается ли локальная служба защиты паролем Azure AD в необщедоступных облаках?**

Нет. Локальная служба защиты паролем Azure AD поддерживается только в общедоступных облаках. Дата доступности в необщедоступных облаках еще не объявлена.

**Вопрос. Как можно применить преимущества защиты паролем Azure AD к подмножеству локальных пользователей?**

Не поддерживается. После развертывания и включения служба защиты паролей Azure AD не разделяет пользователей — все пользователи получают одинаковые преимущества безопасности.

**Вопрос. В чем разница между изменением пароля и набором паролей (или сбросом)?**

Изменение пароля происходит, когда пользователь выбирает новый пароль после подтверждения того, что он знает о старом пароле. Например, это происходит, когда пользователь входит в Windows, а затем предлагает выбрать новый пароль.

Пароль (иногда называемый сбросом пароля) используется, когда администратор заменяет пароль учетной записи новым паролем, например с помощью средства управления пользователями и компьютерами Active Directory. Эта операция требует высокого уровня привилегий (обычно это администратор домена), и пользователь, выполняющий операцию, обычно не знает о старом пароле. Сценарии службы поддержки часто делают это, например, при помощи пользователю, который забыл свой пароль. Кроме того, при первом создании новой учетной записи пользователя с паролем будут отображаться события набора паролей.

Политика проверки паролей ведет себя одинаково независимо от того, выполняется ли изменение или Настройка пароля. Служба агента контроллера домена для защиты паролем Azure AD регистрирует различные события, чтобы сообщить вам о том, была ли выполнена операция смены или изменения пароля.  См. раздел [мониторинг и ведение журнала в службе защиты паролей Azure AD](https://docs.microsoft.com/azure/active-directory/authentication/howto-password-ban-bad-on-premises-monitor).

**Вопрос. Почему при попытке задать ненадежный пароль с помощью оснастки "Управление пользователями и компьютерами" Active Directory "регистрируются дублирующиеся события отклонения паролей"?**

Оснастка управления пользователями и компьютерами Active Directory сначала попытается задать новый пароль с помощью протокола Kerberos. При сбое оснастки попытается установить пароль с помощью устаревшего протокола (SAM RPC) (конкретные используемые протоколы не важны). Если новый пароль считается ненадежным для защиты паролем Azure AD, это приведет к записи в журнал двух наборов событий отклонения сброса пароля.

**Вопрос. Почему события проверки пароля для защиты паролем Azure AD регистрируются с пустым именем пользователя?**

Active Directory поддерживает возможность проверки пароля, чтобы узнать, прошел ли он текущие требования к сложности пароля домена, например с помощью API [нетвалидатепассвордполици](https://docs.microsoft.com/windows/win32/api/lmaccess/nf-lmaccess-netvalidatepasswordpolicy) . Когда пароль проверяется таким образом, тестирование также включает проверку таких продуктов на основе фильтров паролей, как защита паролем Azure AD, но имена пользователей, переданные в указанную DLL фильтра паролей, будут пустыми. В этом сценарии защита паролем Azure AD по-прежнему будет проверять пароль с помощью действующей в настоящее время политики паролей и выдаст сообщение журнала событий для записи результата, однако в сообщении журнала событий будут соблюдаться пустые поля имени пользователя.

**Вопрос. Поддерживается ли установка службы защиты паролем Azure AD параллельно с другими продуктами для фильтрации по паролю?**

Да. Поддержка нескольких зарегистрированных библиотек DLL для фильтрации по паролю является основной функцией Windows и не относится к защите паролем Azure AD. Все зарегистрированные библиотеки DLL для фильтрации по паролю должны подтвердить пароль, прежде чем он будет принят.

**Вопрос. Как развернуть и настроить Защиту паролей Azure AD в среде Active Directory без использования Azure?**

Не поддерживается. Защита паролей Azure AD — это компонент Azure, который поддерживает расширение в локальную среду Active Directory.

**Вопрос. Как изменить содержимое политики на уровне Active Directory?**

Не поддерживается. Политику можно администрировать только с помощью портала управления Azure AD. См. также предыдущий вопрос.

**Вопрос. Почему для репликации SYSVOL требуется DFSR?**

Технология FRS (предшествующая технологии DFSR) имеет множество известных проблем и полностью не поддерживается в новых версиях Windows Server Active Directory. Ноль-тестирование защиты паролем Azure AD будет выполняться на доменах, для которых настроена FRS.

Дополнительные сведения приведены в следующих статьях:

[The Case for Migrating sysvol replication to DFSR](https://blogs.technet.microsoft.com/askds/2010/04/22/the-case-for-migrating-sysvol-to-dfsr) (Вариант переноса репликации SYSVOL в DFSR)

[The End is Nigh for FRS](https://blogs.technet.microsoft.com/filecab/2014/06/25/the-end-is-nigh-for-frs) (Близится конец FRS)

**Вопрос. Сколько места на диске требуется компоненту в общей папке sysvol домена?**

Точное использование пространства зависит от таких факторов, как количество и длина запрещенных маркеров в глобальном списке запрещенных маркеров Майкрософт и настраиваемом списке каждого клиента, а также накладные расходы на шифрование. Эти списки, вероятно, будут расширяться в будущем. Учитывая это, разумно ожидать, что для этого компонента потребуется по крайней мере пять (5) мегабайт пространства в общей папке sysvol домена.

**Вопрос. Почему для установки или обновления программного обеспечения агента контроллера домена требуется перезагрузка?**

Это требование связано с ключевым механизмом Windows.

**Вопрос. Можно ли настроить агент контроллера домена для использования конкретного прокси-сервера?**

Нет. Так как прокси-сервер не учитывает состояние, не важно, какой конкретный прокси-сервер используется.

**Вопрос. Можно ли развертывать службу прокси-сервера Защиты паролей Azure AD параллельно с другими службами, такими как Azure AD Connect?**

Да. Служба прокси-сервера Защиты паролей Azure AD и Azure AD Connect никогда не конфликтуют друг с другом напрямую.

**Вопрос. В каком порядке следует устанавливать и регистрировать агенты контроллеров домена и прокси-серверы?**

Поддерживается любое упорядочение установки прокси-агента, установка агента контроллера домена, регистрация леса и регистрация прокси-сервера.

**Вопрос. Следует ли беспокоиться о снижении производительности контроллеров домена при развертывании этого компонента?**

Служба агента контроллера домена Защиты паролей Azure AD не должна существенно влиять на производительность контроллера домена в существующем работоспособном развертывании Active Directory.

Для большинства развертываний Active Directory операции изменения пароля составляют небольшую часть общей рабочей нагрузки на любой контроллер домена. Например, представьте домен Active Directory с 10 000 учетных записей пользователей и политикой MaxPasswordAge со значением 30 дней. В среднем на этом домене будет выполняться 10 000/30=~333 операции смены паролей каждый день, что является незначительным количеством операций даже для одного контроллера домена. Рассмотрим потенциальный наихудший сценарий: предположим, что эти ~333 смены пароля на одном контроллере домена произошли за один час. Например, этот сценарий может возникнуть, когда много сотрудников приходят на работу утром в понедельник. Даже в этом случае мы по-прежнему получаем ~333/60 минут = шесть изменений пароля в минуту, что опять же не является значительной нагрузкой.

Тем не менее, если текущие контроллеры домена уже работают на уровнях с ограниченной производительностью (например, по максимуму используют ЦП, дисковое пространство, дисковые операции ввода-вывода и т. д.), рекомендуется добавить дополнительные контроллеры домена или расширить доступное дисковое пространство перед развертыванием этого компонента. См. также вопрос об использовании дискового пространства sysvol выше.

**Вопрос. Я хочу протестировать Защиту паролей Azure AD только на нескольких контроллерах домена в моем домене. Можно ли принудительно применять изменения пароля пользователя для использования этих конкретных контроллеров домена?**

Нет. Клиентская ОС Windows определяет, какой контроллер домена используется при изменении пароля пользователем. Контроллер домена выбирается на основе таких факторов, как назначение подсетей и сайта Active Directory, конфигурация сети для конкретной среды и т. д. Защита паролей Azure AD не управляет этими факторами и не может влиять на выбор контроллера домена, используемого для изменения пароля пользователя.

Один из способов частично достичь этой цели — развернуть Защиту паролей Azure AD на всех контроллерах домена на данном сайте Active Directory. Такой подход обеспечит разумное покрытие для клиентов Windows, назначенных этому сайту, а также для пользователей, которые входят в эти клиенты и меняют свои пароли.

**Вопрос. Если я установлю службу агента контроллера домена Защиты паролей Azure AD только на основной контроллер домена, все остальные контроллеры домена в домене также будут защищены?**

Нет. Когда пароль пользователя изменяется на контроллере домена, отличном от основного, открытый пароль никогда не отправляется на основной контроллер домена (эта идея является распространенным заблуждением). Когда новый пароль будет принят на данном контроллере домена, этот контроллер домена начнет использовать его, чтобы создавать различные хэши этого пароля для конкретного протокола аутентификации, а затем сохранять их в каталоге. Открытый пароль не сохраняется. Затем обновленные хэши реплицируются в этот основной контроллер домена. В некоторых случаях пароли пользователей могут быть изменены непосредственно на основном контроллере домена в зависимости от различных факторов, таких как топология сети и структура сайта Active Directory. (См. предыдущий вопрос.)

Таким образом, развертывание службы агента контроллера домена Защиты паролей Azure AD только на основном контроллере домена необходимо для достижения 100%-го уровня безопасности компонента в домене. Развертывание компонента только на основном контроллере домена не предоставляет преимуществ Защиты паролей Azure AD для других контроллеров в домене.

**Вопрос. Доступен ли пакет управления System Center Operations Manager для Защиты паролей Azure AD?**

Нет.

**Вопрос. Почему Azure все еще отвергает ненадежные пароли, несмотря на то, что политика включена в режим аудита?**

Режим аудита поддерживается только в локальной среде Active Directory. Azure неявно всегда находится в режиме принудительного применения при оценке паролей.

## <a name="additional-content"></a>Дополнительное содержимое

Следующие ссылки не являются частью основной документации по Защите паролей Azure AD, но могут быть полезным источником дополнительных сведений о компоненте.

[Служба защиты паролей Azure AD теперь общедоступна.](https://techcommunity.microsoft.com/t5/Azure-Active-Directory-Identity/Azure-AD-Password-Protection-is-now-generally-available/ba-p/377487)

[Email Phishing Protection Guide – Part 15: Implement the Microsoft Azure AD Password Protection Service (for On-Premises too!)](https://blogs.technet.microsoft.com/cloudready/2018/10/14/email-phishing-protection-guide-part-15-implement-the-microsoft-azure-ad-password-protection-service-for-on-premises-too/) (Руководство по защите от фишинга электронной почты. Часть 15. Реализация службы защиты паролей Microsoft Azure AD (в том числе для локальной среды))

[Azure AD Password Protection and Smart Lockout are now in Public Preview!](https://techcommunity.microsoft.com/t5/Azure-Active-Directory-Identity/Azure-AD-Password-Protection-and-Smart-Lockout-are-now-in-Public/ba-p/245423#M529) (Компонент "Защита паролей Azure AD" и интеллектуальная блокировка теперь предоставляются в общедоступной версии)

## <a name="microsoft-premierunified-support-training-available"></a>Доступно обучение по поддержке Microsoft Premier и Единой поддержке Майкрософт

Если вы хотите узнать больше о Защите паролей Azure AD и развертывании этого компонента в своей среде, вы можете воспользоваться проактивной службой Майкрософт, доступной для тех клиентов, которые заключили контракт на поддержку Premier или Единую поддержку. Служба называется "Защита паролей Azure Active Directory". Свяжитесь со своим техническим менеджером по работе с клиентами, чтобы получить дополнительные сведения.

## <a name="next-steps"></a>Следующие шаги

Если у вас есть вопрос о локальной службе защиты паролей Azure AD, который не освещается в этой статье, ниже вы можете отправить нам отзыв. Спасибо!

[Развертывание защиты паролем Azure AD](howto-password-ban-bad-on-premises-deploy.md)
