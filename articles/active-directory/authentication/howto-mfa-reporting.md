---
title: Отчеты о доступе и использовании для Azure MFA — Azure Active Directory
description: Эта статья содержит информацию о том, как использовать функцию отчетов службы Многофакторной идентификации Azure.
services: multi-factor-authentication
ms.service: active-directory
ms.subservice: authentication
ms.topic: how-to
ms.date: 07/30/2018
ms.author: iainfou
author: iainfoulds
manager: daveba
ms.reviewer: michmcla
ms.collection: M365-identity-device-management
ms.openlocfilehash: d8665e58dc84a2ea9b5f2ed70a41bbdd0aa3aa9b
ms.sourcegitcommit: 086d7c0cf812de709f6848a645edaf97a7324360
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2020
ms.locfileid: "82099161"
---
# <a name="reports-in-azure-multi-factor-authentication"></a>Отчеты в службе Многофакторной идентификации Azure

Служба "Многофакторная идентификация Azure" предоставляет несколько типов отчетов, которые могут быть полезны для вас и вашей организации. Просмотреть их можно на портале Azure. В следующей таблице перечислены доступные отчеты:

| Report | Местоположение | Описание |
|:--- |:--- |:--- |
| Журнал заблокированных пользователей | Azure AD > Security > MFA > блокировка и разблокировка пользователей | История запросов на блокировку или разблокирование пользователей. |
| Предупреждения об использовании и о мошенничестве | "Azure AD > События входа" | Сведения об общем использовании, сводка пользователей, сведения о пользователях, а также история предупреждений о мошенничестве, отправленных в течение указанного диапазона дат. |
| Использование локальных компонентов | Отчет о действиях > Azure AD > Security > MFA | Сведения об общем использовании MFA через расширение NPS, ADFS и сервер MFA. |
| Журнал обойденных пользователей | Azure AD > Security > MFA > одноразовый обход времени | История запросов на обход многофакторной проверки подлинности для пользователя. |
| Состояние сервера | Azure AD > безопасность > MFA > состояние сервера | Сведения о состоянии серверов Многофакторной идентификации, с которыми связана ваша учетная запись. |

## <a name="view-mfa-reports"></a>Просмотр отчетов MFA

1. Войдите на [портал Azure](https://portal.azure.com).
2. Слева выберите **Azure Active Directory** > **Безопасность** > **MFA**.
3. Выберите отчет, который нужно просмотреть.

   ![Отчет о состоянии сервера MFA в портал Azure](./media/howto-mfa-reporting/report.png)

## <a name="azure-ad-sign-ins-report"></a>Отчет по действиям входа Azure AD

**Отчеты по действиям входа** на [портале Azure](https://portal.azure.com) позволяют получать всю необходимую информацию, чтобы определить, как работает среда.

Благодаря этим отчетам вы получаете информацию об использовании управляемых приложений и действиях входа пользователей, которые включают сведения об использовании многофакторной проверки подлинности (MFA). Эти данные позволяют понять, как работает многофакторная проверка подлинности в вашей организации. Они позволяют ответить на такие вопросы:

- Выполнена ли многофакторная проверка подлинности при входе?
- Как пользователь выполнил ее?
- Почему пользователю не удалось это сделать?
- Сколько пользователей проходят многофакторную проверку подлинности?
- Скольким пользователям не удалось ее пройти?
- С какими общими проблемами сталкиваются пользователи, проходя многофакторную проверку подлинности?

Эти данные доступны в [портал Azure](https://portal.azure.com) и [API отчетов](../reports-monitoring/concept-reporting-api.md).

![Отчет о входе в Azure AD в портал Azure](./media/howto-mfa-reporting/sign-in-report.png)

### <a name="sign-ins-report-structure"></a>Структура отчета по действиям входа

Отчеты по действиям входа для многофакторной проверки подлинности позволяют получить доступ к следующим данным:

**Необходимость многофакторной проверки подлинности.** Требуется ли многофакторная проверка подлинности при входе в систему. MFA может потребоваться из-за многопользовательского MFA, условного доступа или по другим причинам. Возможные значения: **Да** или **нет**.

**Результат многофакторной проверки подлинности.** Дополнительные сведения о выполнении или сбое многофакторной проверки подлинности:

- Если многофакторная проверка подлинности выполнена, в этом столбце можно просмотреть дополнительные сведения о ее выполнении.
   - Многофакторная идентификация Azure
      - Завершено в облаке.
      - Истек срок действия из-за политик, настроенных для клиента.
      - Запрос регистрации.
      - Выполнено путем утверждения в токене.
      - Выполнено путем утверждения, предоставленного внешним поставщиком.
      - Выполнено за счет строгой проверки подлинности.
      - Пропущено, так как был выполнен поток входа в брокер Windows.
      - Пропущено из-за пароля приложения.
      - Пропущено из-за расположения.
      - Пропущено из-за зарегистрированного устройства.
      - Пропущено из-за устройства.
      - Успешно завершено.
   - Перенаправлено к внешнему поставщику многофакторной проверки подлинности.

- Если произошел сбой многофакторной проверки подлинности, в этом столбце будет указана причина сбоя.
   - Отказ службы Azure Multi-Factor Authentication
      - Выполняется проверка подлинности.
      - Попытка повторного выполнения проверки подлинности.
      - Неверный код указан слишком много раз.
      - Недействительная проверка подлинности.
      - Недействительный код проверки в мобильном приложении.
      - Неправильные настройки.
      - Звонок был направлен на голосовую почту.
      - Недопустимый формат номера телефона.
      - Ошибка службы.
      - не удается связаться с телефоном пользователя
      - Не удается отправить уведомление от мобильного приложения на устройстве.
      - Не удается отправить уведомление от мобильного приложения.
      - Пользователь отклонил проверку подлинности.
      - Пользователь не отвечает на уведомление от мобильного приложения.
      - Пользователь не зарегистрировал методы проверки.
      - Пользователь ввел неправильный код.
      - Пользователь ввел неправильный ПИН-код.
      - Пользователь отклонил телефонный звонок без успешного выполнения проверки подлинности.
      - Пользователь заблокирован.
      - Пользователь не ввел код проверки.
      - Не удалось найти пользователя.
      - Код проверки уже использован один раз.

**Метод многофакторной проверки подлинности.** Метод многофакторной проверки подлинности, использованный пользователем. Ниже перечислены возможные значения.

- Текстовое сообщение
- Уведомление от мобильного приложения
- Телефонный звонок (телефон для проверки подлинности).
- Код проверки в мобильном приложении
- Телефонный звонок (рабочий телефон).
- Телефонный звонок (альтернативный для проверки подлинности).

**Сведения о многофакторной проверке подлинности.** Очищенная версия номера телефона, например + X XXXXXXXX64.

**Условный доступ** Сведения о политиках условного доступа, которые затронули попытки входа в систему, включая:

- Имя политики
- Элементы управления предоставлением прав
- Элементы управления сеансов
- Результат

## <a name="powershell-reporting-on-users-registered-for-mfa"></a>Отчеты PowerShell для пользователей, зарегистрированных для MFA

Сначала убедитесь, что установлен [модуль PowerShell MSOnline v1](https://docs.microsoft.com/powershell/azure/active-directory/overview?view=azureadps-1.0) .

Определите пользователей, зарегистрированных для многофакторной проверки подлинности с помощью Powershell: Этот набор команд исключает отключенных пользователей, так как эти учетные записи не могут пройти проверку подлинности в Azure AD.

```powershell
Get-MsolUser -All | Where-Object {$._StrongAuthenticationMethods -ne $null -and $._BlockCredential -eq $False} | Select-Object -Property UserPrincipalName
```

Определите пользователей, не зарегистрированных для многофакторной проверки подлинности с помощью Powershell: Этот набор команд исключает отключенных пользователей, так как эти учетные записи не могут пройти проверку подлинности в Azure AD.

```powershell
Get-MsolUser -All | Where-Object {$._StrongAuthenticationMethods.Count -eq 0 -and $._BlockCredential -eq $False} | Select-Object -Property UserPrincipalName
```

Выявление зарегистрированных пользователей и методов вывода. 

```powershell
Get-MsolUser -All | Select-Object @{N='UserPrincipalName';E={$_.UserPrincipalName}},

@{N='MFA Status';E={if ($_.StrongAuthenticationRequirements.State){$_.StrongAuthenticationRequirements.State} else {"Disabled"}}},

@{N='MFA Methods';E={$_.StrongAuthenticationMethods.methodtype}} | Export-Csv -Path c:\MFA_Report.csv -NoTypeInformation
```

## <a name="possible-results-in-activity-reports"></a>Возможные результаты в отчетах об активности

Следующая таблица может использоваться для устранения неполадок многофакторной проверки подлинности с помощью скачанной версии отчета о действиях многофакторной проверки подлинности. Они не будут отображаться непосредственно в портал Azure.

| Результат вызова | Описание | Общее описание |
| --- | --- | --- |
| SUCCESS_WITH_PIN | ПИН-код введен | Пользователь ввел ПИН-код.  Если проверка подлинности успешно пройдена, значит он ввел правильный ПИН-код. Если проверка подлинности запрещена, то введен неверный ПИН-код или пользователь настроен на стандартный режим. |
| SUCCESS_NO_PIN | Только указанный # | Если пользователь находится в режиме ПИН-кода и в проверке подлинности отказано, это значит, что он не ввел ПИН-код, а ввел только «#».   Если пользователь находится в стандартном режиме и проверка подлинности успешно пройдена, это значит, что он ввел только «#», что является правильным действием в этом режиме. |
| SUCCESS_WITH_PIN_BUT_TIMEOUT | После ввода не введен знак «#» | Пользователь не отправил цифры DTMF, поскольку не был введен знак «#».  Другие введенные цифры не отправляются до тех пор, пока не будет введен знак «#», означающий завершение ввода. |
|SUCCESS_NO_PIN_BUT_TIMEOUT | Нет ввода в телефоне — превышено время ожидания | Звонок был принят, но ответ получен не был.  Обычно это значит, что сработала голосовая почта. |
| SUCCESS_PIN_EXPIRED | Срок действия ПИН-кода истек, но сам код не изменен | Срок действия ПИН-кода истек, и пользователь получил запрос на изменение ПИН-кода. Однако изменение ПИН-кода завершилось ошибкой. |
| SUCCESS_USED_CACHE | Использовался кэш | Проверка подлинности успешно выполнена без вызова многофакторной проверки подлинности, так как предыдущая успешная проверка подлинности для одного имени пользователя произошла в течение заданного интервала |
| SUCCESS_BYPASSED_AUTH | Проверка подлинности обойдена | Проверка подлинности успешно пройдена с помощью одноразового обхода проверки, инициированного для пользователя.  Дополнительные сведения об обходе проверки см. в разделе Отчет по журналу обойденных пользователей. |
| SUCCESS_USED_IP_BASED_CACHE | Используемый кэш на основе IP-адреса | Проверка подлинности прошла успешно без вызова многофакторной проверки подлинности с момента предыдущей успешной проверки подлинности для того же имени пользователя, типа проверки подлинности, имени приложения и IP-адреса в течение заданного интервала. |
| SUCCESS_USED_APP_BASED_CACHE | Используемый кэш на основе приложений | Проверка подлинности прошла успешно без вызова многофакторной проверки подлинности с момента предыдущей успешной проверки подлинности для того же имени пользователя, типа проверки подлинности и имени приложения в пределах настроенного интервала. |
| SUCCESS_INVALID_INPUT | В телефон введены недопустимые данные | С телефона отправлен недопустимый ответ. Это может быть компьютер факса или модем, или пользователь указал * как часть своего ПИН-кода. |
| SUCCESS_USER_BLOCKED | Пользователь заблокирован | Номер телефона пользователя заблокирован. Заблокированное число может инициироваться пользователем во время вызова проверки подлинности или администратором с помощью портал Azure. <br> Примечание. заблокированное число также является побочным эффектомом предупреждения о мошенничестве. |
| SUCCESS_SMS_AUTHENTICATED | SMS прошло проверку подлинности | Пользователь правильно ответил на двустороннее SMS, используя одноразовый пароль (OTP) или OTP и ПИН-код. |
| SUCCESS_SMS_SENT | SMS отправлено | SMS-сообщение, содержащее одноразовый пароль (OTP), успешно отправлено. Пользователь введет в приложении ПИН-код OTP или OTP + для завершения проверки подлинности. |
| SUCCESS_PHONE_APP_AUTHENTICATED | Мобильное приложение прошло проверку подлинности | Пользователь успешно прошел проверку подлинности с помощью мобильного приложения. |
| SUCCESS_OATH_CODE_PENDING | OATH-код в ожидании | У пользователя был запрошен OATH-код, но ответа не последовало. |
| SUCCESS_OATH_CODE_VERIFIED | OATH-код проверен | В ответ на запрос пользователь ввел допустимый OATH-код. |
| SUCCESS_FALLBACK_OATH_CODE_VERIFIED | Резервный OATH-код проверен | Пользователю было отказано в проверке подлинности с помощью его основного метода Многофакторной идентификации, после чего он ввел допустимый резервный OATH-код. |
| SUCCESS_FALLBACK_SECURITY_QUESTIONS_ANSWERED | Получены ответы на резервные секретные вопросы | Пользователю было отказано в проверке подлинности с помощью его основного метода Многофакторной идентификации, после чего он правильно ответил на свои контрольные вопросы для резервной системы. |
| FAILED_PHONE_BUSY | Проверка подлинности уже выполняется | Многофакторная идентификация уже осуществляет проверку подлинности этого пользователя. Часто это вызвано тем, что клиенты RADIUS, отправляющие несколько запросов проверки подлинности во время одного входа. |
| CONFIG_ISSUE | Телефон недоступен | Предпринята попытка вызова, но либо не удалось поместить, либо не ответил. Это включает сигнал занятости, сигнал высокой занятости (отключен), три тона (число больше не обслуживается), время ожидания при звонках и т. д. |
| FAILED_INVALID_PHONENUMBER | Недопустимый формат номера телефона | Номер телефона имеет недопустимый формат. Номера телефонов должны быть числовыми и состоять из 10 цифр в коде страны + 1 (США & Канада). |
| FAILED_USER_HUNGUP_ON_US | Пользователь повесил трубку | Пользователь взял трубку, но затем положил ее, не нажав ни на одну кнопку. |
| FAILED_INVALID_EXTENSION | Недопустимый добавочный номер | Добавочный номер содержит недопустимые символы.  Можно вводить только цифры, запятые, знаки «*» и «#».  Допускается использование префикса @. |
| FAILED_FRAUD_CODE_ENTERED | Код защиты от мошенничества введен | Пользователь решил сообщить о мошенничестве во время вызова, что привело к отказу в проверке подлинности и блокировке телефонного номера.| 
| FAILED_SERVER_ERROR | Не удалось сделать вызов | Службе многофакторной идентификации не удалось разместить вызов. |
| FAILED_SMS_NOT_SENT | Не удалось отправить SMS | Не удалось отправить текстовое сообщение.  В проверке подлинности отказано. |
| FAILED_SMS_OTP_INCORRECT | SMS: неверный OTP | Пользователь указал неправильный одноразовый пароль (OTP) на основе полученного текстового сообщения.  В проверке подлинности отказано. |
| FAILED_SMS_OTP_PIN_INCORRECT | SMS: неверный OTP + ПИН-код | Пользователь указал неверный одноразовый пароль (OTP) и (или) неверный ПИН-код пользователя.  В проверке подлинности отказано. |
| FAILED_SMS_MAX_OTP_RETRY_REACHED | Превышено максимальное число попыток OTP для SMS | Пользователь превысил максимальное число попыток одноразового секретного кода (OTP). |
| FAILED_PHONE_APP_DENIED | Мобильное приложение запрещено | Пользователь отклонил проверку подлинности в мобильном приложении, нажав кнопку «Отклонить». |
| FAILED_PHONE_APP_INVALID_PIN | Мобильное приложение: недопустимый ПИН-код | При прохождении проверки подлинности в мобильном приложении пользователь ввел недопустимый ПИН-код. |
| FAILED_PHONE_APP_PIN_NOT_CHANGED | Мобильное приложение: ПИН-код не изменен | Пользователю не удалось выполнить необходимое изменение ПИН-кода в мобильном приложении. |
| FAILED_FRAUD_REPORTED | Получено сообщение о мошенничестве | Пользователь сообщил о мошенничества в мобильном приложении. |
| FAILED_PHONE_APP_NO_RESPONSE | Мобильное приложение: нет ответа | Пользователь не ответил на запрос проверки подлинности мобильного приложения. |
| FAILED_PHONE_APP_ALL_DEVICES_BLOCKED | Мобильное приложение : все устройства заблокированы | Устройства с мобильным приложением этого пользователя больше не отвечают на уведомления и были заблокированы. |
| FAILED_PHONE_APP_NOTIFICATION_FAILED | Мобильное приложение: не удалось отправить уведомление | Произошла ошибка при попытке отправить уведомление в мобильное приложение на устройстве пользователя. |
| FAILED_PHONE_APP_INVALID_RESULT | Мобильное приложение: недопустимый результат | Мобильное приложение вернуло недопустимый результат. |
| FAILED_OATH_CODE_INCORRECT | Неправильный OATH-код | Пользователь ввел неправильный OATH-код.   В проверке подлинности отказано. |
| FAILED_OATH_CODE_PIN_INCORRECT | OATH-код + неверное закрепление | Пользователь указал неверный OATH-код и (или) неверное значение пользователя.   В проверке подлинности отказано. |
| FAILED_OATH_CODE_DUPLICATE | Дубликат OATH-кода | Пользователь ввел OATH-код, который использовался ранее.   В проверке подлинности отказано. |
| FAILED_OATH_CODE_OLD | Устаревший OATH-код | Пользователь ввел OATH-код, который предшествует ранее использовавшемуся OATH-коду.   В проверке подлинности отказано. |
| FAILED_OATH_TOKEN_TIMEOUT | Время ожидания результата OATH-кода | Пользователь занял слишком много времени для ввода OATH-кода и попытки многофакторной проверки подлинности уже истекли. |
| FAILED_SECURITY_QUESTIONS_TIMEOUT | Время ожидания результата для контрольных вопросов | Ввод ответа на контрольные вопросы и попытка многофакторной проверки подлинности уже истек, так как пользователь занял слишком много времени. |
| FAILED_AUTH_RESULT_TIMEOUT | Время ожидания результата проверки подлинности | Выполнение многофакторной проверки подлинности пользователем заняло слишком много времени. |
| FAILED_AUTHENTICATION_THROTTLED | Регулирование проверки подлинности | Попытка многофакторной проверки подлинности была отрегулирована службой. |

## <a name="next-steps"></a>Дальнейшие действия

* [Отчеты об использовании и аналитике SSPR и MFA](howto-authentication-methods-usage-insights.md)
* [Для пользователей](../user-help/multi-factor-authentication-end-user.md)
* [Выберите для себя решение "Многофакторная идентификация Microsoft Azure"](concept-mfa-whichversion.md)
