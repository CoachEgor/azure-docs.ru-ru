---
title: Отчеты о доступе и использовании для Azure MFA - Активный каталог Azure
description: Эта статья содержит информацию о том, как использовать функцию отчетов службы Многофакторной идентификации Azure.
services: multi-factor-authentication
ms.service: active-directory
ms.subservice: authentication
ms.topic: conceptual
ms.date: 07/30/2018
ms.author: iainfou
author: iainfoulds
manager: daveba
ms.reviewer: michmcla
ms.collection: M365-identity-device-management
ms.openlocfilehash: b47e6bac031a5f2cffc8734fee976fbf8dadc666
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80129086"
---
# <a name="reports-in-azure-multi-factor-authentication"></a>Отчеты в службе Многофакторной идентификации Azure

Служба "Многофакторная идентификация Azure" предоставляет несколько типов отчетов, которые могут быть полезны для вас и вашей организации. Просмотреть их можно на портале Azure. В следующей таблице перечислены доступные отчеты:

| Report | Расположение | Описание |
|:--- |:--- |:--- |
| Журнал заблокированных пользователей | Azure AD > Security > МиДА > Блок /разблокировать пользователей | История запросов на блокировку или разблокирование пользователей. |
| Предупреждения об использовании и о мошенничестве | "Azure AD > События входа" | Сведения об общем использовании, сводка пользователей, сведения о пользователях, а также история предупреждений о мошенничестве, отправленных в течение указанного диапазона дат. |
| Использование локальных компонентов | Отчет о деятельности Azure AD > безопасности > МИД > | Сведения об общем использовании MFA через расширение NPS, ADFS и сервер MFA. |
| Журнал обойденных пользователей | Azure AD > безопасности > МИД > одноразовый обход | История запросов на обход многофакторной проверки подлинности для пользователя. |
| Состояние сервера | Статус azure AD > security > МИД > сервера | Сведения о состоянии серверов Многофакторной идентификации, с которыми связана ваша учетная запись. |

## <a name="view-mfa-reports"></a>Просмотр отчетов MFA

1. Войдите на [портал Azure](https://portal.azure.com).
2. Слева выберите **Azure Active Directory** > **Security** > **MFA.**
3. Выберите отчет, который нужно просмотреть.

   ![Отчет о состоянии сервера MFA Server на портале Azure](./media/howto-mfa-reporting/report.png)

## <a name="azure-ad-sign-ins-report"></a>Отчет по действиям входа Azure AD

**Отчеты по действиям входа** на [портале Azure](https://portal.azure.com) позволяют получать всю необходимую информацию, чтобы определить, как работает среда.

Благодаря этим отчетам вы получаете информацию об использовании управляемых приложений и действиях входа пользователей, которые включают сведения об использовании многофакторной проверки подлинности (MFA). Эти данные позволяют понять, как работает многофакторная проверка подлинности в вашей организации. Они позволяют ответить на такие вопросы:

- Выполнена ли многофакторная проверка подлинности при входе?
- Как пользователь выполнил ее?
- Почему пользователю не удалось это сделать?
- Сколько пользователей проходят многофакторную проверку подлинности?
- Скольким пользователям не удалось ее пройти?
- С какими общими проблемами сталкиваются пользователи, проходя многофакторную проверку подлинности?

Эти данные доступны через [портал Azure](https://portal.azure.com) и [API отчетности.](../reports-monitoring/concept-reporting-api.md)

![Отчет о входе в систему Azure AD на портале Azure](./media/howto-mfa-reporting/sign-in-report.png)

### <a name="sign-ins-report-structure"></a>Структура отчета по действиям входа

Отчеты по действиям входа для многофакторной проверки подлинности позволяют получить доступ к следующим данным:

**Необходимость многофакторной проверки подлинности.** Требуется ли многофакторная проверка подлинности при входе в систему. МИД может потребоваться из-за одного пользователя МИД, условный доступ, или по другим причинам. Возможные значения: **Да** или **нет**.

**Результат многофакторной проверки подлинности.** Дополнительные сведения о выполнении или сбое многофакторной проверки подлинности:

- Если многофакторная проверка подлинности выполнена, в этом столбце можно просмотреть дополнительные сведения о ее выполнении.
   - Многофакторная идентификация Azure
      - Завершено в облаке.
      - Истек срок действия из-за политик, настроенных для клиента.
      - Запрос регистрации.
      - Выполнено путем утверждения в токене.
      - Выполнено путем утверждения, предоставленного внешним поставщиком.
      - Выполнено за счет строгой проверки подлинности.
      - Пропущено, так как был выполнен поток входа в брокер Windows.
      - Пропущено из-за пароля приложения.
      - Пропущено из-за расположения.
      - Пропущено из-за зарегистрированного устройства.
      - Пропущено из-за устройства.
      - Успешно завершено.
   - Перенаправлено к внешнему поставщику многофакторной проверки подлинности.

- Если произошел сбой многофакторной проверки подлинности, в этом столбце будет указана причина сбоя.
   - Отказ службы Azure Multi-Factor Authentication
      - Выполняется проверка подлинности.
      - Попытка повторного выполнения проверки подлинности.
      - Неверный код указан слишком много раз.
      - Недействительная проверка подлинности.
      - Недействительный код проверки в мобильном приложении.
      - Неправильные настройки.
      - Звонок был направлен на голосовую почту.
      - Недопустимый формат номера телефона.
      - Ошибка службы.
      - Не удается подключиться к телефону пользователя.
      - Не удается отправить уведомление от мобильного приложения на устройстве.
      - Не удается отправить уведомление от мобильного приложения.
      - Пользователь отклонил проверку подлинности.
      - Пользователь не отвечает на уведомление от мобильного приложения.
      - Пользователь не зарегистрировал методы проверки.
      - Пользователь ввел неправильный код.
      - Пользователь ввел неправильный ПИН-код.
      - Пользователь отклонил телефонный звонок без успешного выполнения проверки подлинности.
      - Пользователь заблокирован.
      - Пользователь не ввел код проверки.
      - Не удалось найти пользователя.
      - Код проверки уже использован один раз.

**Метод многофакторной проверки подлинности.** Метод многофакторной проверки подлинности, использованный пользователем. Ниже перечислены возможные значения.

- Текстовое сообщение
- Уведомление от мобильного приложения
- Телефонный звонок (телефон для проверки подлинности).
- Код проверки в мобильном приложении
- Телефонный звонок (рабочий телефон).
- Телефонный звонок (альтернативный для проверки подлинности).

**Сведения о многофакторной проверке подлинности.** Очищенная версия номера телефона, например + X XXXXXXXX64.

**Условный доступ** Найдите информацию о политиках условного доступа, которые повлияли на попытку входной системы, включая:

- Имя политики
- Элементы управления предоставлением прав
- Элементы управления сеансов
- Результат

## <a name="powershell-reporting-on-users-registered-for-mfa"></a>Отчетность PowerShell о пользователях, зарегистрированных в МИД

Во-первых, убедитесь, что у вас есть [MSOnline V1 PowerShell модуль](https://docs.microsoft.com/powershell/azure/active-directory/overview?view=azureadps-1.0) установлен.

Определите пользователей, зарегистрированных для многофакторной проверки подлинности с помощью Powershell: Этот набор команд исключает отключенных пользователей, так как эти учетные записи не могут аутентифицироваться в отношении Azure AD.

```Get-MsolUser -All | Where-Object {$.StrongAuthenticationMethods -ne $null -and $.BlockCredential -eq $False} | Select-Object -Property UserPrincipalName```

Определите пользователей, не зарегистрированных для многофакторной проверки подлинности с помощью Powershell: Этот набор команд исключает отключенных пользователей, так как эти учетные записи не могут аутентифицироваться в отношении Azure AD.

```Get-MsolUser -All | Where-Object {$.StrongAuthenticationMethods.Count -eq 0 -and $.BlockCredential -eq $False} | Select-Object -Property UserPrincipalName```

Определить зарегистрированных пользователей и методов вывода. 

```PowerShell
Get-MsolUser -All | Select-Object @{N='UserPrincipalName';E={$_.UserPrincipalName}},

@{N='MFA Status';E={if ($_.StrongAuthenticationRequirements.State){$_.StrongAuthenticationRequirements.State} else {"Disabled"}}},

@{N='MFA Methods';E={$_.StrongAuthenticationMethods.methodtype}} | Export-Csv -Path c:\MFA_Report.csv -NoTypeInformation
```

## <a name="possible-results-in-activity-reports"></a>Возможные результаты в отчетах о деятельности

Следующая таблица может быть использована для устранения многофакторной аутентификации с помощью загруженной версии многофакторного отчета о деятельности по проверке подлинности. Они не будут отображаться непосредственно на портале Azure.

| Результат вызова | Описание | Широкое описание |
| --- | --- | --- |
| SUCCESS_WITH_PIN | ПИН-код введен | Пользователь ввел ПИН-код.  Если проверка подлинности успешно пройдена, значит он ввел правильный ПИН-код. Если аутентификация отказано, то они ввели неправильный PIN-код или пользователь настроен на стандартный режим. |
| SUCCESS_NO_PIN | Только вошел в вехи | Если пользователь находится в режиме ПИН-кода и в проверке подлинности отказано, это значит, что он не ввел ПИН-код, а ввел только «#».   Если пользователь находится в стандартном режиме и проверка подлинности успешно пройдена, это значит, что он ввел только «#», что является правильным действием в этом режиме. |
| SUCCESS_WITH_PIN_BUT_TIMEOUT | После ввода не введен знак «#» | Пользователь не отправил цифры DTMF, поскольку не был введен знак «#».  Другие введенные цифры не отправляются до тех пор, пока не будет введен знак «#», означающий завершение ввода. |
|SUCCESS_NO_PIN_BUT_TIMEOUT | Нет ввода в телефоне — превышено время ожидания | Звонок был принят, но ответ получен не был.  Обычно это значит, что сработала голосовая почта. |
| SUCCESS_PIN_EXPIRED | Срок действия ПИН-кода истек, но сам код не изменен | Срок действия ПИН-кода истек, и пользователь получил запрос на изменение ПИН-кода. Однако изменение ПИН-кода завершилось ошибкой. |
| SUCCESS_USED_CACHE | Использовался кэш | Аутентификация была выполнена без вызова мультифакторной аутентификации, так как предыдущая успешная аутентификация для того же имени пользователя произошла в пределах настроенного таймфрейма кэша. |
| SUCCESS_BYPASSED_AUTH | Проверка подлинности обойдена | Проверка подлинности успешно пройдена с помощью одноразового обхода проверки, инициированного для пользователя.  Дополнительные сведения об обходе проверки см. в разделе Отчет по журналу обойденных пользователей. |
| SUCCESS_USED_IP_BASED_CACHE | Использованный кэш на основе IP | Аутентификация была выполнена без вызова мультифакторной аутентификации, так как предыдущая успешная аутентификация для того же имени пользователя, типа аутентификации, имени приложения и IP произошла в пределах настроенного таймфрейма кэша. |
| SUCCESS_USED_APP_BASED_CACHE | Подержанный кэш на основе приложений | Аутентификация удалась без вызова мультифакторной аутентификации с момента предыдущей успешной аутентификации для того же имени пользователя, типа аутентификации и имени приложения в пределах настроенного таймфрейма кэша. |
| SUCCESS_INVALID_INPUT | В телефон введены недопустимые данные | С телефона отправлен недопустимый ответ. Это может быть с факса или модема или пользователь, возможно, вошел в качестве части их PIN-кода. |
| SUCCESS_USER_BLOCKED | Пользователь заблокирован | Номер телефона пользователя заблокирован. Заблокированный номер может быть инициирован пользователем во время вызова аутентификации или администратором, использующим портал Azure. <br> ПРИМЕЧАНИЕ: Заблокированный номер также является побочным продуктом оповещения о мошенничестве. |
| SUCCESS_SMS_AUTHENTICATED | SMS прошло проверку подлинности | Пользователь правильно ответил на двустороннее SMS, используя одноразовый пароль (OTP) или OTP и ПИН-код. |
| SUCCESS_SMS_SENT | SMS отправлено | SMS-сообщение, содержащее одноразовый пароль (OTP), успешно отправлено. Пользователь введет PIN-код OTP или OTP в приложении для завершения проверки подлинности. |
| SUCCESS_PHONE_APP_AUTHENTICATED | Мобильное приложение прошло проверку подлинности | Пользователь успешно прошел проверку подлинности с помощью мобильного приложения. |
| SUCCESS_OATH_CODE_PENDING | OATH-код в ожидании | У пользователя был запрошен OATH-код, но ответа не последовало. |
| SUCCESS_OATH_CODE_VERIFIED | OATH-код проверен | В ответ на запрос пользователь ввел допустимый OATH-код. |
| SUCCESS_FALLBACK_OATH_CODE_VERIFIED | Резервный OATH-код проверен | Пользователю было отказано в проверке подлинности с помощью его основного метода Многофакторной идентификации, после чего он ввел допустимый резервный OATH-код. |
| SUCCESS_FALLBACK_SECURITY_QUESTIONS_ANSWERED | Получены ответы на резервные секретные вопросы | Пользователю было отказано в проверке подлинности с помощью его основного метода Многофакторной идентификации, после чего он правильно ответил на свои контрольные вопросы для резервной системы. |
| FAILED_PHONE_BUSY | Проверка подлинности уже выполняется | Многофакторная идентификация уже осуществляет проверку подлинности этого пользователя. Это часто вызвано клиентами RADIUS, которые отправляют несколько запросов на проверку подлинности во время одного и того же ввоза. |
| CONFIG_ISSUE | Телефон недоступен | Попытка вызова была предпринята, но либо не удалось разместить, либо не получил ответа. Это включает в себя занят сигнал, быстрый загруженный сигнал (отключен), три-тоны (номер больше не в эксплуатации), приурочен во время звона и т.д. |
| FAILED_INVALID_PHONENUMBER | Недопустимый формат номера телефона | Номер телефона имеет недопустимый формат. Номера телефонов должны быть численными и должны быть 10 цифр для кода страны No1 (Соединенные Штаты & Канада). |
| FAILED_USER_HUNGUP_ON_US | Пользователь повесил трубку | Пользователь взял трубку, но затем положил ее, не нажав ни на одну кнопку. |
| FAILED_INVALID_EXTENSION | Недопустимый добавочный номер | Добавочный номер содержит недопустимые символы.  Можно вводить только цифры, запятые, знаки «*» и «#».  Допускается использование префикса @. |
| FAILED_FRAUD_CODE_ENTERED | Код защиты от мошенничества введен | Пользователь решил сообщить о мошенничестве во время вызова, что привело к отказу в проверке подлинности и блокировке телефонного номера.| 
| FAILED_SERVER_ERROR | Не удалось сделать вызов | Служба многофакторной аутентификации не смогла разместить вызов. |
| FAILED_SMS_NOT_SENT | Не удалось отправить SMS | Текстовое сообщение не может быть отправлено.  В проверке подлинности отказано. |
| FAILED_SMS_OTP_INCORRECT | SMS: неверный OTP | Пользователь ввел неправильный одноразовый пароль (OTP) из полученного текстового сообщения.  В проверке подлинности отказано. |
| FAILED_SMS_OTP_PIN_INCORRECT | SMS: неверный OTP + ПИН-код | Пользователь ввел неправильный одноразовый пароль (OTP) и/или неправильный PIN-код пользователя.  В проверке подлинности отказано. |
| FAILED_SMS_MAX_OTP_RETRY_REACHED | Превышен максимальный текстовое сообщение OTP Попытки | Пользователь превысил максимальное количество одноразовых попыток пароля (OTP). |
| FAILED_PHONE_APP_DENIED | Мобильное приложение запрещено | Пользователь отклонил проверку подлинности в мобильном приложении, нажав кнопку «Отклонить». |
| FAILED_PHONE_APP_INVALID_PIN | Мобильное приложение: недопустимый ПИН-код | При прохождении проверки подлинности в мобильном приложении пользователь ввел недопустимый ПИН-код. |
| FAILED_PHONE_APP_PIN_NOT_CHANGED | Мобильное приложение: ПИН-код не изменен | Пользователю не удалось выполнить необходимое изменение ПИН-кода в мобильном приложении. |
| FAILED_FRAUD_REPORTED | Получено сообщение о мошенничестве | Пользователь сообщил о мошенничества в мобильном приложении. |
| FAILED_PHONE_APP_NO_RESPONSE | Мобильное приложение: нет ответа | Пользователь не ответил на запрос о проверке подлинности мобильного приложения. |
| FAILED_PHONE_APP_ALL_DEVICES_BLOCKED | Мобильное приложение : все устройства заблокированы | Устройства с мобильным приложением этого пользователя больше не отвечают на уведомления и были заблокированы. |
| FAILED_PHONE_APP_NOTIFICATION_FAILED | Мобильное приложение: не удалось отправить уведомление | Произошла ошибка при попытке отправить уведомление в мобильное приложение на устройстве пользователя. |
| FAILED_PHONE_APP_INVALID_RESULT | Мобильное приложение: недопустимый результат | Мобильное приложение вернуло недопустимый результат. |
| FAILED_OATH_CODE_INCORRECT | Неправильный OATH-код | Пользователь ввел неправильный OATH-код.   В проверке подлинности отказано. |
| FAILED_OATH_CODE_PIN_INCORRECT | КОД OATH - PIN-код Неправильный | Пользователь ввел неправильный код OATH и/или неправильный PIN-код пользователя.   В проверке подлинности отказано. |
| FAILED_OATH_CODE_DUPLICATE | Дубликат OATH-кода | Пользователь ввел OATH-код, который использовался ранее.   В проверке подлинности отказано. |
| FAILED_OATH_CODE_OLD | Устаревший OATH-код | Пользователь ввел OATH-код, который предшествует ранее использовавшемуся OATH-коду.   В проверке подлинности отказано. |
| FAILED_OATH_TOKEN_TIMEOUT | OATH Код Результат Тайм-аут | Пользователю потребовалось слишком много времени, чтобы ввести код OATH и попытка мультифакторной аутентификации уже приурочена. |
| FAILED_SECURITY_QUESTIONS_TIMEOUT | Вопросы безопасности Результат тайм-аут | Пользователю потребовалось слишком много времени, чтобы ответить на вопросы безопасности, и попытка мультифакторной аутентификации уже приурочена. |
| FAILED_AUTH_RESULT_TIMEOUT | Аут-результат тайм-аут | Пользователю потребовалось слишком много времени, чтобы завершить попытку мультифакторной аутентификации. |
| FAILED_AUTHENTICATION_THROTTLED | Аутентификация задушила | Многофакторная попытка аутентификации была задушена службой. |

## <a name="next-steps"></a>Дальнейшие действия

* [SSPR и МИД использования и идеи отчетности](howto-authentication-methods-usage-insights.md)
* [Для пользователей](../user-help/multi-factor-authentication-end-user.md)
* [Выберите для себя решение "Многофакторная идентификация Microsoft Azure"](concept-mfa-whichversion.md)
