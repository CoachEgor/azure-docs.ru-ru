---
title: Учебник. подготовка пользователей для временного резерва — Azure AD
description: Узнайте, как настроить Azure Active Directory для автоматической подготовки и отмены подготовки учетных записей пользователей в Slack.
services: active-directory
author: ArvindHarinder1
manager: CelesteDG
ms.service: active-directory
ms.subservice: saas-app-tutorial
ms.workload: identity
ms.topic: article
ms.date: 05/06/2020
ms.author: arvinh
ms.openlocfilehash: 368d75ecffda49f688a7a5ce11b60693650014c6
ms.sourcegitcommit: 023d10b4127f50f301995d44f2b4499cbcffb8fc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2020
ms.locfileid: "88527831"
---
# <a name="tutorial-configure-slack-for-automatic-user-provisioning"></a>Руководство по настройке Slack для автоматической подготовки пользователей

Цель этого учебника — показать, как в Slack и Azure AD необходимо выполнять автоматическую подготовку и отмену подготовки учетных записей пользователей из Azure AD в Slack. Подробные сведения о том, что делает эта служба, как она работает, и часто задаваемые вопросы см. в статье [Автоматическая подготовка пользователей и ее отзыв для приложений SaaS в Azure Active Directory](../manage-apps/user-provisioning.md). 


## <a name="capabilities-supported"></a>Поддерживаемые возможности
> [!div class="checklist"]
> * Создание пользователей в резервном временном случае
> * Удалять пользователей в случае временного резерва, когда им больше не нужен доступ
> * Синхронизация атрибутов пользователей между Azure AD и резервным периодом
> * Подготавливать группы и членство в группах в резервном времени
> * [Единый вход](https://docs.microsoft.com/azure/active-directory/saas-apps/slack-tutorial) в резервный (рекомендуется)


## <a name="prerequisites"></a>Предварительные требования

Сценарий, описанный в этом учебнике, предполагает, что у вас уже имеется:

* [Клиент Azure AD](https://docs.microsoft.com/azure/active-directory/develop/quickstart-create-new-tenant).
* Учетная запись пользователя в Azure AD с [разрешением](https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-assign-admin-roles) на настройку подготовки (например, администратор приложений, администратор облачных приложений, владелец приложения или глобальный администратор).
* Резервный клиент с [планом "плюс](https://aadsyncfabric.slack.com/pricing) " или выше.
* Учетная запись пользователя в резервном окне с разрешениями администратора команды.

## <a name="step-1-plan-your-provisioning-deployment"></a>Шаг 1. Планирование развертывания для подготовки
1. Узнайте, [как работает служба подготовки](https://docs.microsoft.com/azure/active-directory/manage-apps/user-provisioning).
2. Определите, кто будет находиться в [области подготовки](https://docs.microsoft.com/azure/active-directory/manage-apps/define-conditional-rules-for-provisioning-user-accounts).
3. Определите, какие данные должны [сопоставляться между Azure AD и резервным периодом](https://docs.microsoft.com/azure/active-directory/manage-apps/customize-application-attributes). 

## <a name="step-2-add-slack-from-the-azure-ad-application-gallery"></a>Шаг 2. Добавление временного резерва из коллекции приложений Azure AD

Добавьте временной резерв из коллекции приложений Azure AD, чтобы начать управление подготовкой к резервному времени. Если вы ранее настроили резервное время для единого входа, вы можете использовать то же приложение. Однако при первоначальном тестировании интеграции рекомендуется создать отдельное приложение. Дополнительные сведения о добавлении приложения из коллекции см. [здесь](https://docs.microsoft.com/azure/active-directory/manage-apps/add-gallery-app). 

## <a name="step-3-define-who-will-be-in-scope-for-provisioning"></a>Шаг 3. Определение пользователей для включения в область подготовки 

Служба подготовки Azure AD позволяет определить пользователей, которые будут подготовлены, на основе назначения приложению и (или) атрибутов пользователя или группы. Если вы решили указать, кто именно будет подготовлен к работе в приложении, на основе назначения, можно выполнить следующие [действия](../manage-apps/assign-user-or-group-access-portal.md), чтобы назначить пользователей и группы приложению. Если вы решили указать, кто именно будет подготовлен, на основе одних только атрибутов пользователя или группы, можете использовать фильтр задания области, как описано [здесь](https://docs.microsoft.com/azure/active-directory/manage-apps/define-conditional-rules-for-provisioning-user-accounts). 

* При назначении пользователям и группам временного резерва необходимо выбрать роль, отличную от **доступа по умолчанию**. Пользователи с ролью "Доступ по умолчанию" исключаются из подготовки и будут помечены в журналах подготовки как не назначенные явно. Кроме того, если эта роль является единственной, доступной в приложении, можно [изменить манифест приложения](https://docs.microsoft.com/azure/active-directory/develop/howto-add-app-roles-in-azure-ad-apps), чтобы добавить дополнительные роли. 

* Начните с малого. Протестируйте небольшой набор пользователей и групп, прежде чем выполнять развертывание для всех. Если в область подготовки включены назначенные пользователи и группы, проверьте этот механизм, назначив приложению одного или двух пользователей либо одну или две группы. Если в область включены все пользователи и группы, можно указать [фильтр области на основе атрибутов](https://docs.microsoft.com/azure/active-directory/manage-apps/define-conditional-rules-for-provisioning-user-accounts).

## <a name="step-4-configure-automatic-user-provisioning-to-slack"></a>Шаг 4. Настройка автоматической подготовки пользователей к резервному времени 

В этом разделе описывается подключение к API подготовки учетной записи пользователя Azure AD в Slack и настройка подготовки службы для создания, обновления и отмены назначения учетных записей пользователей в Slack на основе назначения пользователей и групп в Azure AD.

### <a name="to-configure-automatic-user-account-provisioning-to-slack-in-azure-ad"></a>Настройка автоматической подготовки учетных записей пользователей Azure AD в Slack.

1. Войдите на [портал Azure](https://portal.azure.com). Выберите **Корпоративные приложения**, а затем **Все приложения**.

    ![Колонка "Корпоративные приложения"](common/enterprise-applications.png)

2. В списке приложений выберите **Slack**.

    ![Ссылка на Slack в списке приложений](common/all-applications.png)

3. Выберите вкладку **Подготовка**.

    ![Вкладка "Подготовка"](common/provisioning.png)

4. Для параметра **Режим подготовки к работе** выберите значение **Automatic** (Автоматически).

    ![Вкладка "Подготовка"](common/provisioning-automatic.png)

5. В разделе **Учетные данные администратора** щелкните **Авторизовать**. В новом окне браузера откроется диалоговое окно авторизации Slack.

    ![Авторизация](media/slack-provisioning-tutorial/authorization.png)


6. В новом окне войдите в Slack с использованием учетной записи администратора группы. в открывшемся диалоговом окне авторизации выберите группу Slack, для которой необходимо включить подготовку, а затем выберите **Authorize** (Авторизовать). После завершения вернитесь на портал Azure для завершения настройки подготовки.

    ![Диалоговое окно авторизации](./media/slack-provisioning-tutorial/slackauthorize.png)

7. На портале Azure щелкните **Проверить подключение**, чтобы убедиться, что Azure AD может подключиться к приложению Slack. Если подключение отсутствует, убедитесь, что у учетной записи Slack есть права администратора группы, и повторите шаг "Авторизовать".

8. В поле **Почтовое уведомление** введите адрес электронной почты пользователя или группы, которые должны получать уведомления об ошибках подготовки, а также установите флажок **Отправить уведомление по электронной почте при сбое**.

    ![Почтовое уведомление](common/provisioning-notification-email.png)

9. Щелкните **Сохранить**.

10. В разделе сопоставления выберите **Synchronize Azure Active Directory Users to Slack** (Синхронизировать пользователей Azure Active Directory с Slack).

11. В разделе **Attribute Mappings** (Сопоставления атрибутов) следует просмотреть атрибуты пользователей, которые будут синхронизированы из Azure AD в Slack. Обратите внимание, что атрибуты, которые выбраны в качестве свойств **Matching** (Сопоставление), будут использоваться для сопоставления учетных записей пользователей в Slack для операций обновления. Нажмите кнопку "Сохранить", чтобы подтвердить все изменения.

   |attribute|Тип|
   |---|---|
   |active|Логическое|
   |externalId|Строка|
   |displayName|Строка|
   |name.familyName|Строка|
   |name.givenName|Строка|
   |title|Строка|
   |emails[type eq "work"].value|Строка|
   |userName|Строка|
   |Понят|Строка|
   |адреса [тип EQ "нетипизированный"]. streetAddress|Строка|
   |адреса [тип EQ "нетипизированный"]. локальность|Строка|
   |адреса [тип EQ "нетипизированный"]. регион|Строка|
   |адреса [тип EQ "нетипизированный"]. postalCode|Строка|
   |адреса [тип EQ "нетипизированный"]. Country|Строка|
   |phoneNumbers[type eq "mobile"].value|Строка|
   |phoneNumbers[type eq "work"].value|Строка|
   |роли [первичный EQ "true"]. Value|Строка|
   |локаль|Строка|
   |имя. Хонорификпрефикс|Строка|
   |фотографии [Введите EQ "Фото"]. Value|Строка|
   |профилеурл|Строка|
   |timezone|Строка|
   |userType|Строка|
   |urn: scim: схемы: расширение: корпоративный: 1.0. Department|Строка|
   |urn: scim: схемы: расширение: Enterprise: 1.0. Manager|Справочник|
   |urn: scim: схемы: расширение: Enterprise: 1.0. Емплойинумбер|Строка|
   |urn: scim: схемы: расширение: Enterprise: 1.0. costCenter|Строка|
   |urn: scim: схемы: расширение: Enterprise: 1.0. Организация|Строка|
   |urn: scim: схемы: расширение: Enterprise: 1.0. деление|Строка|

12. В разделе **сопоставления** выберите **синхронизировать Azure Active Directory группы к временной резерв**.

13. В разделе **Attribute Mappings** (Сопоставления атрибутов) следует просмотреть атрибуты групп, которые будут синхронизированы из Azure AD в Slack. Обратите внимание, что атрибуты выбран в качестве **сопоставление** свойств будет использоваться для сопоставления групп в Slack для операции обновления. Нажмите кнопку "Сохранить", чтобы подтвердить все изменения.

      |attribute|Тип|
      |---|---|
      |displayName|Строка|
      |members|Справочник|

14. Чтобы настроить фильтры области, ознакомьтесь со следующими инструкциями, предоставленными в [руководстве по фильтрам области](../manage-apps/define-conditional-rules-for-provisioning-user-accounts.md).

15. Чтобы включить службу подготовки Azure AD для Slack, измените значение параметра **Provisioning Status** (Статус подготовки) на **On** (Включено) в разделе **Настройки**.

    ![Состояние подготовки "Включено"](common/provisioning-toggle-on.png)

16. Определите пользователей и (или) группы, которые вы хотите подготавливать к временной резерву, выбрав нужные значения в **области** в разделе **Параметры** .

    ![Область действия подготовки](common/provisioning-scope.png)

17. Когда будете готовы выполнить подготовку, нажмите кнопку **Сохранить**.

    ![Сохранение конфигурации подготовки](common/provisioning-configuration-save.png)

После этого начнется цикл начальной синхронизации всех пользователей и групп, определенных в поле **Область** в разделе **Параметры**. Начальный цикл занимает больше времени, чем последующие циклы. Пока служба подготовки Azure AD запущена, они выполняются примерно каждые 40 минут. 

## <a name="step-5-monitor-your-deployment"></a>Шаг 5. Мониторинг развертывания
После настройки подготовки используйте следующие ресурсы для мониторинга развертывания.

1. Используйте [журналы подготовки](https://docs.microsoft.com/azure/active-directory/reports-monitoring/concept-provisioning-logs), чтобы определить, какие пользователи были подготовлены успешно или неудачно.
2. Используйте [индикатор выполнения](https://docs.microsoft.com/azure/active-directory/app-provisioning/application-provisioning-when-will-provisioning-finish-specific-user), чтобы узнать состояние цикла подготовки и приблизительное время до его завершения.
3. Если конфигурация подготовки, вероятно, находится в неработоспособном состоянии, приложение перейдет в карантин. Дополнительные сведения о режимах карантина см. [здесь](https://docs.microsoft.com/azure/active-directory/manage-apps/application-provisioning-quarantine-status).

## <a name="troubleshooting-tips"></a>Советы по устранению неполадок

* При настройке атрибута **displayName** в Slack возможно следующее:

  * Значения не полностью уникальны (например, у двух пользователей может быть одно и то же отображаемое имя).

  * Поддержка символов, не принадлежащих английскому языку, пробелов, разных регистров. 
  
  * Допускаются следующие знаки пунктуации: точки, символы подчеркивания, дефисы, апострофы, скобки (например, **( [ { } ] )**) и разделители (например, **, / ;**).
  
  * свойство displayName не может содержать символ "@". Если включен символ "@", то в журналах подготовки может найти пропущенное событие с описанием "Аттрибутевалидатионфаилед".

  * Обновление выполняется, только если в рабочей области или организации Slack **включена синхронизации профиля** и указано, что **пользователи не могут изменять свои отображаемые имена**.

* Атрибут **userName** в Slack должен содержать до 21 символа и иметь уникальное значение.

* Временной резерв допускает сопоставление только с атрибутами **username** и **Email**.  
  
* Общие коды ерорр описаны в официальной документации по резервному времени. https://api.slack.com/scim#errors

## <a name="change-log"></a>Журнал изменений

* 06/16/2020-изменен атрибут DisplayName для обновления только во время создания нового пользователя.

## <a name="additional-resources"></a>Дополнительные ресурсы

* [Управление подготовкой учетных записей пользователей для корпоративных приложений](../app-provisioning/configure-automatic-user-provisioning-portal.md)
* [Что такое доступ к приложениям и единый вход с помощью Azure Active Directory?](../manage-apps/what-is-single-sign-on.md)

## <a name="next-steps"></a>Дальнейшие действия

* [Сведения о просмотре журналов и получении отчетов о действиях по подготовке](../manage-apps/check-status-user-account-provisioning.md)