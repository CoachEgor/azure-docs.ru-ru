---
title: Учебник. Настройка программы для автоматической подготовки пользователей с помощью Azure Active Directory | Документация Майкрософт
description: Узнайте, как настроить Azure Active Directory для автоматической инициализации и отмены предоставления учетных записей пользователей для работы.
services: active-directory
documentationcenter: ''
author: zchia
writer: zchia
manager: beatrizd
ms.assetid: 0cdb970b-440b-4e7c-9118-2f03baab6a20
ms.service: active-directory
ms.subservice: saas-app-tutorial
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/29/2019
ms.author: Zhchia
ms.openlocfilehash: 518d86fff04a23f1c1e63c44c53485b99f30637d
ms.sourcegitcommit: db2d402883035150f4f89d94ef79219b1604c5ba
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/07/2020
ms.locfileid: "77057844"
---
# <a name="tutorial-configure-harness-for-automatic-user-provisioning"></a>Учебник. Настройка программы для автоматической подготовки пользователей

Из этой статьи вы узнаете, как настроить Azure Active Directory (Azure AD) для автоматической подготовки и отмены предоставления пользователей или групп для работы.

> [!NOTE]
> В этой статье описывается соединитель, созданный на основе службы подготовки пользователей Azure AD. Важные сведения об этой службе и ответы на часто задаваемые вопросы см. в статье [Автоматизация подготовки пользователей и ее отмене в приложениях SaaS с помощью Azure Active Directory](../app-provisioning/user-provisioning.md).
>
> Сейчас этот соединитель доступен в режиме предварительной версии. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

## <a name="prerequisites"></a>предварительные требования

В сценарии, описанном в этой статье, предполагается, что у вас уже есть следующие необходимые компоненты.

* клиент Azure AD;
* [Клиент окружения](https://harness.io/pricing/)
* Учетная запись пользователя в оснастке с разрешениями *администратора*

## <a name="assign-users-to-harness"></a>Назначение пользователей для программы

Azure Active Directory использует концепцию, называемую *назначениями* , чтобы определить, какие пользователи должны получать доступ к выбранным приложениям. В контексте автоматической подготовки учетных записей пользователей синхронизируются только те пользователи или группы, которые были назначены приложению в Azure AD.

Перед настройкой и включением автоматической подготовки пользователей решите, каким пользователям или группам в Azure AD нужен доступ к программе. Затем можно назначить этих пользователей или группы для использования, следуя инструкциям в разделе [Назначение пользователя или группы корпоративному приложению](../manage-apps/assign-user-or-group-access-portal.md).

## <a name="important-tips-for-assigning-users-to-harness"></a>Важные советы по назначению пользователей в работе

* Мы рекомендуем назначить одного пользователя Azure AD для использования при тестировании конфигурации автоматической подготовки пользователей. Дополнительные пользователи или группы могут быть назначены позже.

* При назначении пользователю программы необходимо выбрать в диалоговом окне **назначение** любую допустимую роль конкретного приложения (если она доступна). Пользователи с ролью *Доступ по умолчанию* исключаются из подготовки.

## <a name="set-up-harness-for-provisioning"></a>Настройка программы для подготовки

1. Войдите в [консоль администратора](https://app.harness.io/#/login)программы и перейдите в раздел **непрерывная безопасность** > **управления доступом**.

    ![Консоль администрирования окружения](media/harness-provisioning-tutorial/admin.png)

1. Выберите **ключи API**.

    ![Ссылка на ключи API](media/harness-provisioning-tutorial/apikeys.png)

1. Выберите **Добавить ключ API**. 

    ![Ссылка для добавления ключа API](media/harness-provisioning-tutorial/addkey.png)

1. В области **Добавить ключ API** выполните следующие действия.

    ![Панель "Добавление ключа API"](media/harness-provisioning-tutorial/title.png)
   
   а. В поле **имя** введите имя ключа.  
   b. В раскрывающемся списке **разрешения, унаследованные от** выберите параметр. 
   
1. Нажмите кнопку **Submit** (Отправить).

1. Скопируйте **ключ** для дальнейшего использования в этом руководстве.

    ![Токен создания программы](media/harness-provisioning-tutorial/token.png)

## <a name="add-harness-from-the-gallery"></a>Добавление окружения из коллекции

Перед настройкой программы для автоматической подготовки пользователей с помощью Azure AD необходимо добавить программу из коллекции приложений Azure AD в список управляемых приложений SaaS.

1. На [портале Azure](https://portal.azure.com) в области слева щелкните **Azure Active Directory**.

    ![Кнопка Azure Active Directory](common/select-azuread.png)

1. Щелкните **Корпоративные приложения** > **Все приложения**.

    ![Ссылка "Все приложения"](common/enterprise-applications.png)

1. Чтобы добавить новое приложение, нажмите кнопку **новое приложение** в верхней части области.

    ![Кнопка "Новое приложение"](common/add-new-app.png)

1. В поле **поиска введите "** программа", выберите пункт " **окружение** " в списке результатов и нажмите кнопку " **добавить** ", чтобы добавить это приложение.

    ![Использование в списке результатов](common/search-new-app.png)

## <a name="configure-automatic-user-provisioning-to-harness"></a>Настройка автоматической подготовки пользователей для программы 

В этом разделе описано, как настроить службу подготовки Azure AD для создания, обновления и отключения пользователей или групп в службе в соответствии с назначениями пользователей или групп в Azure AD.

> [!TIP]
> Вы также можете включить единый вход на основе SAML для работы, следуя инструкциям в [руководстве по единому входу](https://docs.microsoft.com/azure/active-directory/saas-apps/harness-tutorial)в программу. Вы можете настроить единый вход независимо от автоматической подготовки пользователей, хотя эти две функции дополняют друг друга.

> [!NOTE]
> Дополнительные сведения о конечной точке SCIM см. в статье о [ключах API программ](https://docs.harness.io/article/smloyragsm-api-keys) .

Чтобы настроить автоматическую подготовку пользователей для работы в Azure AD, выполните следующие действия.

1. В [портал Azure](https://portal.azure.com)выберите **корпоративные приложения** > **все приложения**.

    ![Колонка "Корпоративные приложения"](common/enterprise-applications.png)

1. В списке приложений выберите **Harness**.

    ![Ссылка на программу в списке "приложения"](common/all-applications.png)

1. Выберите **Подготовка**.

    ![Кнопка "подготовка"](common/provisioning.png)

1. В раскрывающемся списке **режим подготовки** выберите значение **автоматически**.

    ![Раскрывающийся список "режим подготовки"](common/provisioning-automatic.png)

1. В разделе **учетные данные администратора**выполните следующие действия.

    ![URL-адрес клиента + токен](common/provisioning-testconnection-tenanturltoken.png)
 
   а. В поле **URL-адрес клиента** введите **`https://app.harness.io/gateway/api/scim/account/XCPzWkCIQ46ypIu2DeT7yw`** .  
   b. В поле **секретный токен** введите значение маркера проверки подлинности scim, сохраненное на шаге 6 раздела "Настройка окружения для подготовки".  
   c. Выберите **проверить подключение** , чтобы убедиться, что Azure AD может подключиться к программе. В случае сбоя подключения убедитесь, что учетная запись пользователя имеет разрешения *администратора* , и повторите попытку.

1. В поле e-mail **Notification (уведомление** ) введите адрес электронной почты пользователя или группы, которые должны получать уведомления об ошибках подготовки, а затем установите флажок **Отправить уведомление по электронной почте при возникновении сбоя** .

    ![Поле "E-mail Notification"](common/provisioning-notification-email.png)

1. Щелкните **Сохранить**.

1. В разделе **сопоставления**выберите **синхронизировать Azure Active Directory пользователей с**ними.

    ![Связь «синхронизация Azure Active Directory пользователей с обвязки»](media/harness-provisioning-tutorial/usermappings.png)

1. В разделе **сопоставления атрибутов**проверьте пользовательские атрибуты, которые синхронизированы из Azure AD. Атрибуты, выбранные в качестве *сопоставления* , используются для сопоставления учетных записей пользователей, используемых для операций обновления. Чтобы зафиксировать изменения, щелкните **Сохранить**.

    ![Панель "сопоставления атрибутов" пользователя](media/harness-provisioning-tutorial/userattributes.png)

1. В разделе **сопоставления**выберите **синхронизировать Azure Active Directory группы для**запуска.

    ![Используйте ссылку "Синхронизация групп Azure Active Directory](media/harness-provisioning-tutorial/groupmappings.png)

1. В разделе **сопоставления атрибутов**Проверьте атрибуты группы, которые синхронизированы из Azure AD для использования. Атрибуты, выбранные как свойства *Matching* , используются для сопоставления групп, используемых для операций обновления. Чтобы зафиксировать изменения, щелкните **Сохранить**.

    ![Панель "сопоставления атрибутов" группы окружений](media/harness-provisioning-tutorial/groupattributes.png)

1. Сведения о настройке фильтров области см. в разделе [Подготовка приложений на основе атрибутов с помощью фильтров области](../app-provisioning/define-conditional-rules-for-provisioning-user-accounts.md).

1. В разделе **Параметры**, чтобы включить службу подготовки Azure AD для программы, установите переключатель **состояние подготовки** в положение **вкл**.

    ![Параметр состояния подготовки переключен в состояние "вкл"](common/provisioning-toggle-on.png)

1. В разделе **Параметры**в раскрывающемся списке **область** выберите способ синхронизации пользователей или групп, для которых выполняется подготовка.

    ![Область действия подготовки](common/provisioning-scope.png)

1. Когда вы будете готовы к подготовке к работе, нажмите кнопку **сохранить**.

    ![Кнопка "Сохранить" подготовки](common/provisioning-configuration-save.png)

Эта операция запускает начальную синхронизацию пользователей или групп, которые вы подготавливаете. Начальная синхронизация выполняется дольше, чем позже. Синхронизация выполняется примерно каждые 40 минут, если служба подготовки Azure AD запущена. Чтобы отслеживать ход выполнения, перейдите к разделу **сведения о синхронизации** . Вы также можете перейти по ссылкам на отчет о действиях по подготовке, в котором описаны все действия, выполняемые службой подготовки Azure AD.

Дополнительные сведения о том, как читать журналы подготовки Azure AD, см. в разделе [отчет об автоматической подготовке учетных записей пользователей](../app-provisioning/check-status-user-account-provisioning.md).

## <a name="additional-resources"></a>Дополнительные ресурсы

* [Managing user account provisioning for enterprise apps in the Azure portal](../app-provisioning/configure-automatic-user-provisioning-portal.md) (Управление подготовкой учетных записей пользователей для корпоративных приложений на портале Azure)
* [Что такое доступ к приложениям и единый вход с помощью Azure Active Directory?](../manage-apps/what-is-single-sign-on.md)

## <a name="next-steps"></a>Дальнейшие действия

* [Сведения о просмотре журналов и получении отчетов о действиях по подготовке](../app-provisioning/check-status-user-account-provisioning.md)
