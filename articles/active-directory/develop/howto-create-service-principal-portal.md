---
title: Создание приложения Azure AD & на портале
titleSuffix: Microsoft identity platform
description: Создание нового приложения Active Directory Azure & главное обслуживание для управления доступом к ресурсам с помощью ролевой системы управления доступом в Azure Resource Manager.
services: active-directory
author: rwike77
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: conceptual
ms.date: 02/26/2020
ms.author: ryanwi
ms.reviewer: tomfitz
ms.custom: aaddev, seoapril2019, identityplatformtop40
ms.openlocfilehash: c5f65adfe401f2f6e99234d08b8e8dabeff7d5db
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79264119"
---
# <a name="how-to-use-the-portal-to-create-an-azure-ad-application-and-service-principal-that-can-access-resources"></a>Практическое руководство. Создание приложения Azure Active Directory и субъекта-службы с доступом к ресурсам с помощью портала

В этой статье показано, как создать новое приложение и службу Azure AD, которое можно использовать с помощью элемента управления доступом на основе ролей. При наличии кода, для которого требуется доступ к ресурсам или их изменение, можно создать идентификатор для приложения. Этот идентификатор известен как субъект-служба. Затем субъекту-службе можно назначить необходимые разрешения. В этой статье показано, как создать субъект-службу с помощью портала. Здесь рассматривается однотенантное приложение — решение, используемое в пределах одной организации. Обычно однотенантная архитектура используется для создания бизнес-приложений в рамках организации.

> [!IMPORTANT]
> Вместо создания субъекта-службы вы можете применить управляемые удостоверения ресурсов Azure в качестве удостоверения приложения. Если ваш код работает в службе, которая поддерживает управляемые идентификаторы и получает доступ к ресурсам, поддерживающим аутентификацию Azure AD, управляемые идентификаторы являются лучшим вариантом для вас. Дополнительные сведения об управляемых удостоверениях для ресурсов Azure, включая службы, которые в настоящее время поддерживают их, см. в разделе [Что такое управляемые удостоверения для ресурсов Azure?](../managed-identities-azure-resources/overview.md)

## <a name="create-an-azure-active-directory-application"></a>Создание приложения Azure Active Directory

Перейдем к созданию удостоверения. Если у вас возникли сложности, проверьте [необходимые разрешения](#required-permissions), чтобы убедиться в том, что в учетной записи можно создать удостоверение.

1. Вопийте в учетную запись Azure через [портал Azure.](https://portal.azure.com)
1. Выберите **активный каталог Azure**.
1. Выберите **регистрацию приложений**.
1. Выберите **Новая регистрация**.
1. Назовите приложение. Выберите поддерживаемый тип учетной записи, который определяет, кто может использовать приложение. Под **redirect URI**выберите **Web** для типа приложения, которое вы хотите создать. Введите URI, куда отправляется токен доступа. Вы не можете создать учетные данные для [собственного приложения](../manage-apps/application-proxy-configure-native-client-application.md). Этот тип нельзя использовать для автоматизированного приложения. Выбрав нужные значения, нажмите кнопку **Зарегистрировать**.

   ![Введите имя для приложения](./media/howto-create-service-principal-portal/create-app.png)

Вы создали приложение Azure AD и субъект-службу.

## <a name="assign-a-role-to-the-application"></a>Назначить роль приложению

Чтобы получить доступ к ресурсам в подписке, необходимо назначить роль приложению. Укажите, какая роль предоставляет приложению необходимые разрешения. Дополнительные сведения о доступных ролях см. в статье [RBAC: встроенные роли](../../role-based-access-control/built-in-roles.md).

Вы можете задать область действия на уровне подписки, группы ресурсов или ресурса. Разрешения наследуют более низкие уровни области действия. Например, добавление приложения в роль читателя для группы ресурсов означает, что оно может считывать группу ресурсов и все содержащиеся в ней ресурсы.

1. На портале Azure выберите уровень области, который вы хотите назначить приложению. Например, назначить роль в области **подписки,** поиск и выбор подписок или выбрать **подписку** на **главной** странице.

   ![Например, назначить роль в области подписки](./media/howto-create-service-principal-portal/select-subscription.png)

1. Выберите определенную подписку, для которой хотите назначить приложение.

   ![Выбор подписки для назначения](./media/howto-create-service-principal-portal/select-one-subscription.png)

   Если требуемая подписка не отображается, выберите **фильтр глобальных подписок**. Убедитесь, что для портала была выбрана необходимая подписка.

1. Выберите **элемент управления доступом (IAM)**.
1. Выберите **Назначение ролей.**
1. Выберите роль, которая будет назначена приложению. Например, чтобы позволить приложению выполнять такие действия, как **перезагрузка,** **запуск** и **остановка** экземпляров, выберите роль **автора.**  Подробнее о [доступных ролях](../../role-based-access-control/built-in-roles.md) по умолчанию не отображаются приложения Azure AD в доступных опциях. Чтобы найти приложение, выполните поиск по его имени и выберите его.

   ![Выберите роль, которую можно назначить приложению](./media/howto-create-service-principal-portal/select-role.png)

1. Выберите **Сохранить**, чтобы завершить назначение роли. Вы видите ваше приложение в списке пользователей с ролью для этой области.

Субъект-служба настроен. Вы можете начать использовать его, чтобы выполнять скрипты или приложения. В следующем разделе показано, как получить значения, необходимые для использования при входе с помощью программного способа.

## <a name="get-values-for-signing-in"></a>Получение значений для входа

Когда выполняется программный вход, необходимо передать идентификатор клиента в запросе на проверку подлинности. Вам также понадобится идентификатор приложения и ключ проверки подлинности. Получить эти значения можно следующим образом.

1. Выберите **активный каталог Azure**.
1. В Azure Active Directory в разделе **Регистрация приложений** выберите нужное приложение.
1. Копируйте идентификатор каталога (арендатора) и храните его в коде приложения.

    ![Скопируйте идентификатор каталога (клиента) и сохраните его в коде приложения](./media/howto-create-service-principal-portal/copy-tenant-id.png)

1. Скопируйте **идентификатор приложения** и сохраните его в коде приложения.

   ![Скопируйте идентификатор приложения (клиента)](./media/howto-create-service-principal-portal/copy-app-id.png)

## <a name="certificates-and-secrets"></a>Сертификаты и секреты
Приложения Daemon могут использовать две формы учетных данных для проверки подлинности с помощью Azure AD: сертификаты и секреты приложения.  Мы рекомендуем использовать сертификат, но вы также можете создать новый секрет приложения.

### <a name="upload-a-certificate"></a>Загрузить сертификат

Вы можете использовать существующий сертификат, если он у вас есть.  В обязательном порядке можно создать сертификат, подписанный самостоятельно, только для *целей тестирования.* Open PowerShell и запуск [New-SelfSignedCertificate](/powershell/module/pkiclient/new-selfsignedcertificate) со следующими параметрами для создания самоподписанного сертификата в магазине сертификатов пользователя на вашем компьютере: 

```powershell
$cert=New-SelfSignedCertificate -Subject "CN=DaemonConsoleCert" -CertStoreLocation "Cert:\CurrentUser\My"  -KeyExportPolicy Exportable -KeySpec Signature
```

Экспортировать этот сертификат в файл с помощью snap-in [Manage User Certificate](/dotnet/framework/wcf/feature-details/how-to-view-certificates-with-the-mmc-snap-in) MMC, доступный с панели управления Windows.

1. Выберите **Выполнить** из меню **Пуск,** а затем ввести **certmgr.msc**.

   Отображается инструмент manager сертификата для текущего пользователя.

1. Для просмотра сертификатов под **сертификатами - Текущий пользователь** в левом стеле расширьте **Личный** каталог.
1. Нажмите на созданный сертификат, выберите **все задачи >экспорт.**
1. Следуйте за мастером экспорта сертификатов.  Экспортировать закрытый ключ, указать пароль для файла сертификата и экспортировать в файл.

Для загрузки сертификата:

1. Выберите **активный каталог Azure**.
1. В Azure Active Directory в разделе **Регистрация приложений** выберите нужное приложение.
1. Выберите **Сертификаты и секреты**.
1. Выберите **сертификат Загрузки** и выберите сертификат (существующий сертификат или самоподписанный сертификат, который вы экспортировали).

    ![Выберите сертификат загрузки и выберите тот, который вы хотите добавить](./media/howto-create-service-principal-portal/upload-cert.png)

1. Нажмите кнопку **Добавить**.

После регистрации сертификата с вашим заявлением на портале регистрации заявлений необходимо предоставить код приложения клиента для использования сертификата.

### <a name="create-a-new-application-secret"></a>Создание секрета приложения

Если вы решите не использовать сертификат, вы можете создать новый секрет приложения.

1. Выберите **Сертификаты и секреты**.
1. Выберите **Секреты клиента -> Новый секрет клиента**.
1. Введите описание и срок действия секрета. Когда все будет готово, нажмите **Добавить**.

   После сохранения секрета клиента отображается значение секрета клиента. Скопируйте это значение, потому что вы не сможете получить ключ позже. Вы предоставите ключевое значение с идентификатором приложения для вху-вкачестве приложения. Сохраните значение ключа, чтобы приложение могло получить к нему доступ.

   ![Скопируйте значение секрета, так как вы не сможете получить его позже](./media/howto-create-service-principal-portal/copy-secret.png)

## <a name="configure-access-policies-on-resources"></a>Настройка политик доступа к ресурсам
Имейте в виду, что может потребоваться настроить дополнительные разрешения на ресурсы, к которым необходимо получить доступ к приложению. Например, необходимо [обновить политики доступа хранилища ключей,](/azure/key-vault/key-vault-secure-your-key-vault#data-plane-and-access-policies) чтобы предоставить приложению доступ к ключам, секретам или сертификатам.  

1. На [портале Azure](https://portal.azure.com)перейдите к хранилищу ключей и выберите **политики доступа.**  
1. Выберите **политику доступа,** затем выберите ключевые, секретные и сертификатные разрешения, которые вы хотите предоставить вашему приложению.  Выберите основной службы, который вы создали ранее.
1. Выберите **Добавить,** чтобы добавить политику доступа, а затем **сохранить,** чтобы совершить изменения.
    ![Добавление политики доступа](./media/howto-create-service-principal-portal/add-access-policy.png)

## <a name="required-permissions"></a>Необходимые разрешения

Вы должны иметь достаточное разрешение, чтобы зарегистрировать приложение с вашим арендатором Azure AD и назначить приложению роль в подписке Azure.

### <a name="check-azure-ad-permissions"></a>Проверка разрешений Azure AD

1. Выберите **активный каталог Azure**.
1. Запишите роль. Если вам назначена роль **Пользователь**, необходимо убедиться, что пользователи, не являющиеся администраторами, могут регистрировать приложения.

   ![Найдите свою роль. Если вы являетесь пользователем, убедитесь, что не-админы могут зарегистрировать приложения](./media/howto-create-service-principal-portal/view-user-info.png)

1. В левой панели выберите **настройки пользователя.**
1. Проверьте параметр **Регистрация приложений**. Это значение может быть задано только администратором. Если установлено значение **Да**, приложение в клиенте Azure AD может зарегистрировать любой пользователь.

Если для параметра регистрации приложений установлено значение **Нет**, регистрировать приложения такого типа могут только пользователи с ролью администратора. Дополнительные сведения о доступных ролях администратора и конкретных разрешениях в Azure AD, которые предоставляются каждой роли, см. в разделах [Доступные роли](../users-groups-roles/directory-assign-admin-roles.md#available-roles) и [Разрешения ролей](../users-groups-roles/directory-assign-admin-roles.md#role-permissions). Если вашей учетной записи назначена роль пользователя, но настройка регистрации приложения ограничена пользователями администратора, попросите администратора либо назначить вам одну из ролей администратора, которые могут создавать и управлять всеми аспектами регистрации приложений, либо позволять пользователям регистрироваться Приложения.

### <a name="check-azure-subscription-permissions"></a>Проверка прав доступа к подпискам Azure

В подписке Azure ваша `Microsoft.Authorization/*/Write` учетная запись должна иметь доступ к присвоению роли приложению AD. Это разрешение предоставляется ролью [владельца](../../role-based-access-control/built-in-roles.md#owner) или [администратора доступа пользователей](../../role-based-access-control/built-in-roles.md#user-access-administrator). Если вашей учетной записи назначена роль **вкладчика,** у вас нет достаточного разрешения. Вы получите ошибку при попытке назначить основной службе роль.

Чтобы проверить права доступа к подписке, выполните следующие действия.

1. Поиск и выбор **подписок**или выбор **подписки** на **главной** странице.

   ![Поиск](./media/howto-create-service-principal-portal/select-subscription.png)

1. Выберите подписку, в ней вы хотите создать основной сервис.

   ![Выбор подписки для назначения](./media/howto-create-service-principal-portal/select-one-subscription.png)

   Если требуемая подписка не отображается, выберите **фильтр глобальных подписок**. Убедитесь, что для портала была выбрана необходимая подписка.

1. Выберите **Мои разрешения**. Затем выберите ссылку **Щелкните здесь, чтобы просмотреть полные сведения о доступе для этой подписки**.

   ![Выберите подписку, которая требуется для создания основного сервиса в](./media/howto-create-service-principal-portal/view-details.png)

1. Выберите назначения **«Представление** в **роли»** для просмотра назначенных ролей и определите, есть ли у вас достаточные разрешения на присвоение роли приложению AD. Если разрешения нет, обратитесь к администратору подписки с просьбой назначить вам роль администратора доступа пользователей. На следующем изображении пользователю назначается роль Владельца, что означает, что пользователь имеет адекватные разрешения.

   ![В этом примере показано, что пользователю назначена роль Владельца](./media/howto-create-service-principal-portal/view-user-role.png)

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о настройке политик безопасности см. в статье о [контроле доступа на основе ролей Azure](../../role-based-access-control/role-assignments-portal.md).  
* Список доступных действий, которые можно разрешить или запретить пользователям, см. в разделе [Операции поставщиков ресурсов Azure Resource Manager](../../role-based-access-control/resource-provider-operations.md).
