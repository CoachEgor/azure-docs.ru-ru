---
title: Создание приложения Azure AD & субъекта-службы с помощью портала
titleSuffix: Microsoft identity platform
description: Создайте новый Azure Active Directory приложение & субъекта-службы для управления доступом к ресурсам с помощью управления доступом на основе ролей в Azure Resource Manager.
services: active-directory
author: rwike77
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: conceptual
ms.date: 10/14/2019
ms.author: ryanwi
ms.reviewer: tomfitz
ms.custom: aaddev, seoapril2019, identityplatformtop40
ms.collection: M365-identity-device-management
ms.openlocfilehash: 249c313f8f6195371985f3dad2e707638e52d0df
ms.sourcegitcommit: 5ab4f7a81d04a58f235071240718dfae3f1b370b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/10/2019
ms.locfileid: "74967122"
---
# <a name="how-to-use-the-portal-to-create-an-azure-ad-application-and-service-principal-that-can-access-resources"></a>Практическое руководство. Создание приложения Azure Active Directory и субъекта-службы с доступом к ресурсам с помощью портала

В этой статье показано, как создать новое приложение Azure Active Directory (Azure AD) и субъект-службу, которые можно использовать с контролем доступа на основе ролей. При наличии кода, для которого требуется доступ к ресурсам или их изменению, можно создать идентификатор для приложения. Этот идентификатор известен как субъект-служба. Затем субъекту-службе можно назначить необходимые разрешения. В этой статье показано, как создать субъект-службу с помощью портала. Здесь рассматривается однотенантное приложение — решение, используемое в пределах одной организации. Обычно однотенантная архитектура используется для создания бизнес-приложений в рамках организации.

> [!IMPORTANT]
> Вместо создания субъекта-службы вы можете применить управляемые удостоверения ресурсов Azure в качестве удостоверения приложения. Если ваш код выполняется в службе, которая поддерживает управляемые удостоверения и обращается к ресурсам, поддерживающим проверку подлинности Azure AD, управляемые удостоверения являются лучшим вариантом. Дополнительные сведения об управляемых удостоверениях для ресурсов Azure, включая службы, которые в настоящее время поддерживают их, см. в разделе [Что такое управляемые удостоверения для ресурсов Azure?](../managed-identities-azure-resources/overview.md)

## <a name="create-an-azure-active-directory-application"></a>Создание приложения Azure Active Directory

Перейдем к созданию удостоверения. Если у вас возникли сложности, проверьте [необходимые разрешения](#required-permissions), чтобы убедиться в том, что в учетной записи можно создать удостоверение.

1. Войдите в учетную запись Azure через [портал Azure](https://portal.azure.com).
1. Выберите **Azure Active Directory**.
1. Щелкните **Регистрация приложений**.
1. Выберите **Новая регистрация**.
1. Назовите приложение. Выберите поддерживаемый тип учетной записи, который определяет, кто может использовать приложение. В разделе **URI перенаправления**выберите вариант **Интернет** для типа приложения, которое требуется создать. Введите URI, на который отправляется маркер доступа. Вы не можете создать учетные данные для [собственного приложения](../manage-apps/application-proxy-configure-native-client-application.md). Этот тип нельзя использовать для автоматизированного приложения. Выбрав нужные значения, нажмите кнопку **Зарегистрировать**.

   ![Введите имя приложения](./media/howto-create-service-principal-portal/create-app.png)

Вы создали приложение Azure AD и субъект-службу.

## <a name="assign-the-application-to-a-role"></a>Назначение приложению роли

Чтобы обеспечить доступ к ресурсам в подписке, необходимо назначить приложению роль. Укажите роль, какую необходимо использовать для предоставления приложению необходимых разрешений. Дополнительные сведения о доступных ролях см. в статье [RBAC: встроенные роли](../../role-based-access-control/built-in-roles.md).

Вы можете задать область действия на уровне подписки, группы ресурсов или ресурса. Разрешения наследуют более низкие уровни области действия. Например, добавление приложения в роль читателя для группы ресурсов означает, что оно может считывать группу ресурсов и все содержащиеся в ней ресурсы.

1. В портал Azure выберите уровень области, на которую требуется назначить приложение. Например, чтобы назначить роль в области действия подписки, выполните поиск и выберите **подписки**или выберите **подписки** на **домашней** странице.

   ![Например, назначьте роль в области действия подписки.](./media/howto-create-service-principal-portal/select-subscription.png)

1. Выберите определенную подписку, для которой хотите назначить приложение.

   ![Выбор подписки для назначения](./media/howto-create-service-principal-portal/select-one-subscription.png)

   Если требуемая подписка не отображается, выберите **фильтр глобальных подписок**. Убедитесь, что для портала была выбрана необходимая подписка.

1. Выберите **Управление доступом (IAM)** .
1. Выберите **Добавить назначение ролей**.
1. Выберите роль, которая будет назначена приложению. Например, чтобы разрешить приложению выполнять такие действия, как **Перезагрузка**, **Запуск** и **Завершение** экземпляров, выберите роль **участник** .  Дополнительные сведения о [доступных ролях](../../role-based-access-control/built-in-roles.md) по умолчанию приложения Azure AD не отображаются в доступных параметрах. Для поиска приложения используйте его имя. Затем выберите его.

   ![Выберите роль для назначения приложению](./media/howto-create-service-principal-portal/select-role.png)

1. Выберите **Сохранить**, чтобы завершить назначение роли. Вы увидите свое приложение в списке пользователей, назначенных выбранной роли для выбранной области действия.

Субъект-служба настроен. Вы можете начать использовать его, чтобы выполнять скрипты или приложения. В следующем разделе показано, как получить значения, необходимые для использования при входе с помощью программного способа.

## <a name="get-values-for-signing-in"></a>Получение значений для входа

Когда выполняется программный вход, необходимо передать идентификатор клиента в запросе на проверку подлинности. Вам также понадобится идентификатор приложения и ключ проверки подлинности. Получить эти значения можно следующим образом.

1. Выберите **Azure Active Directory**.
1. В Azure Active Directory в разделе **Регистрация приложений** выберите нужное приложение.
1. Скопируйте идентификатор каталога (клиента) и сохраните его в коде приложения.

    ![Скопируйте идентификатор каталога (клиента) и сохраните его в коде приложения](./media/howto-create-service-principal-portal/copy-tenant-id.png)

1. Скопируйте **идентификатор приложения** и сохраните его в коде приложения.

   ![Скопируйте идентификатор приложения (клиента)](./media/howto-create-service-principal-portal/copy-app-id.png)

## <a name="certificates-and-secrets"></a>Сертификаты и секреты
Управляющие приложения могут использовать два вида учетных данных для аутентификации в Azure AD: сертификаты и секреты приложений.  Рекомендуется использовать сертификат, но можно также создать новый секрет приложения.

### <a name="upload-a-certificate"></a>Загрузить сертификат

Вы можете использовать существующий сертификат, если он есть.  При необходимости можно создать самозаверяющий сертификат для целей тестирования. Откройте PowerShell и выполните команду [New-SelfSignedCertificate](/powershell/module/pkiclient/new-selfsignedcertificate) со следующими параметрами, чтобы создать самозаверяющий сертификат в хранилище сертификатов пользователя на компьютере: 

```powershell
$cert=New-SelfSignedCertificate -Subject "CN=DaemonConsoleCert" -CertStoreLocation "Cert:\CurrentUser\My"  -KeyExportPolicy Exportable -KeySpec Signature
```

Экспортируйте этот сертификат в файл с помощью оснастки MMC " [Управление сертификатом пользователя](/dotnet/framework/wcf/feature-details/how-to-view-certificates-with-the-mmc-snap-in) ", доступной на панели управления Windows.

Чтобы отправить сертификат, выполните следующие действия.

1. Выберите **Сертификаты и секреты**.
1. Выберите **отправить сертификат** и выберите сертификат (существующий сертификат или самозаверяющий сертификат, который вы экспортировали).

    ![Выберите отправить сертификат и выберите тот, который вы хотите добавить.](./media/howto-create-service-principal-portal/upload-cert.png)

1. Выберите **Добавить**.

После регистрации сертификата в приложении на портале регистрации приложений необходимо включить код клиентского приложения для использования сертификата.

### <a name="create-a-new-application-secret"></a>Создание секрета приложения

Если вы решили не использовать сертификат, можно создать новый секрет приложения.

1. Выберите **Сертификаты и секреты**.
1. Выберите **Секреты клиента -> Новый секрет клиента**.
1. Введите описание и срок действия секрета. Когда все будет готово, нажмите **Добавить**.

   После сохранения секрета клиента отображается значение секрета клиента. Это значение невозможно будет получить позже, поэтому скопируйте его сразу. Значение ключа необходимо предоставить вместе с идентификатором приложения для входа от имени приложения. Сохраните значение ключа, чтобы приложение могло получить к нему доступ.

   ![Скопируйте значение секрета, так как вы не сможете получить его позже](./media/howto-create-service-principal-portal/copy-secret.png)

## <a name="configure-access-policies-on-resources"></a>Настройка политик доступа к ресурсам
Помните, что может потребоваться настроить разрешения на добавление для ресурсов, к которым требуется доступ приложению. Например, необходимо также [обновить политики доступа для хранилища ключей](/azure/key-vault/key-vault-secure-your-key-vault#data-plane-and-access-policies) , чтобы предоставить приложению доступ к ключам, секретам или сертификатам.  

1. В [портал Azure](https://portal.azure.com)перейдите к своему хранилищу ключей и выберите **политики доступа**.  
1. Выберите **Добавить политику доступа**, а затем выберите разрешения ключа, секрета и сертификата, которые вы хотите предоставить приложению.  Выберите ранее созданный субъект-службу.
1. Выберите **Добавить** , чтобы добавить политику доступа, а затем нажмите кнопку **сохранить** , чтобы зафиксировать изменения.
    ![добавить политику доступа](./media/howto-create-service-principal-portal/add-access-policy.png)

## <a name="required-permissions"></a>Необходимые разрешения

У вас должны быть права на регистрацию приложения в клиенте Azure AD и назначение приложению роли в подписке Azure.

### <a name="check-azure-ad-permissions"></a>Проверка разрешений Azure AD

1. Выберите **Azure Active Directory**.
1. Запишите роль. Если вам назначена роль **Пользователь**, необходимо убедиться, что пользователи, не являющиеся администраторами, могут регистрировать приложения.

   ![Найдите свою роль. Если вы являетесь пользователем, убедитесь, что пользователи, не являющиеся администраторами, могут регистрировать приложения.](./media/howto-create-service-principal-portal/view-user-info.png)

1. На левой панели выберите **Параметры пользователя**.
1. Проверьте параметр **Регистрация приложений**. Это значение может быть задано только администратором. Если установлено значение **Да**, приложение в клиенте Azure AD может зарегистрировать любой пользователь.

Если для параметра регистрации приложений установлено значение **Нет**, регистрировать приложения такого типа могут только пользователи с ролью администратора. Дополнительные сведения о доступных ролях администратора и конкретных разрешениях в Azure AD, которые предоставляются каждой роли, см. в разделах [Доступные роли](../users-groups-roles/directory-assign-admin-roles.md#available-roles) и [Разрешения ролей](../users-groups-roles/directory-assign-admin-roles.md#role-permissions). Если вашей учетной записи назначена роль пользователя, а параметр регистрации приложений разрешает регистрацию только администраторам, обратитесь к администратору с просьбой назначить вам одну из ролей администратора, которая будет создавать регистрацию приложений и управлять всеми ее аспектами, или предоставить пользователям возможность регистрировать приложения.

### <a name="check-azure-subscription-permissions"></a>Проверка прав доступа к подпискам Azure

Чтобы вы могли назначить роль приложению Active Directory, вашей учетной записи в подписке Azure должно быть предоставлено разрешение `Microsoft.Authorization/*/Write`. Это разрешение предоставляется ролью [владельца](../../role-based-access-control/built-in-roles.md#owner) или [администратора доступа пользователей](../../role-based-access-control/built-in-roles.md#user-access-administrator). Если вашей учетной записи назначена роль **Участник**, то у вас нет соответствующего разрешения. При попытке назначить роль субъекту-службе вы увидите ошибку.

Чтобы проверить права доступа к подписке, выполните следующие действия.

1. Выберите свою учетную запись в правом верхнем углу и выберите **...-> мои разрешения**.

   ![Выбор учетной записи и разрешений пользователя](./media/howto-create-service-principal-portal/select-my-permissions.png)

1. В раскрывающемся списке выберите подписку, в которой необходимо создать субъект-службу. Затем выберите ссылку **Щелкните здесь, чтобы просмотреть полные сведения о доступе для этой подписки**.

   ![Выберите подписку, в которой нужно создать субъект-службу.](./media/howto-create-service-principal-portal/view-details.png)

1. Выберите **назначения ролей** , чтобы просмотреть назначенные роли, и определите, есть ли у вас соответствующие разрешения для назначения роли приложению AD. Если разрешения нет, обратитесь к администратору подписки с просьбой назначить вам роль администратора доступа пользователей. На следующем рисунке представлен пользователь, которому назначена роль владельца. Это значит, что у такого пользователя есть необходимые разрешения.

   ![В этом примере показано, что пользователь назначен роли владельца.](./media/howto-create-service-principal-portal/view-user-role.png)

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о настройке политик безопасности см. в статье о [контроле доступа на основе ролей Azure](../../role-based-access-control/role-assignments-portal.md).  
* Список доступных действий, которые можно разрешить или запретить пользователям, см. в разделе [Операции поставщиков ресурсов Azure Resource Manager](../../role-based-access-control/resource-provider-operations.md).
