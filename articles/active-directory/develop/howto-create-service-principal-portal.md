---
title: Создание удостоверения для приложения Azure на портале | Документация Майкрософт
description: Описывается создание нового приложения Azure Active Directory и субъекта-службы, которые можно использовать в сочетании с контролем доступа на основе ролей в Azure Resource Manager для управления доступом к ресурсам.
services: active-directory
documentationcenter: na
author: rwike77
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/17/2019
ms.author: ryanwi
ms.reviewer: tomfitz
ms.custom: seoapril2019
ms.collection: M365-identity-device-management
ms.openlocfilehash: 33ef65f09a4e7513738a6cc6b277d06cd4cb4da8
ms.sourcegitcommit: 41ca82b5f95d2e07b0c7f9025b912daf0ab21909
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "67052411"
---
# <a name="how-to-use-the-portal-to-create-an-azure-ad-application-and-service-principal-that-can-access-resources"></a>Практическое руководство: Создание приложения Azure Active Directory и субъекта-службы с доступом к ресурсам с помощью портала

В этой статье показано, как создать новое приложение Azure Active Directory (Azure AD) и субъекта-службы, который может использоваться с контролем доступа на основе ролей. При наличии кода, для которого требуется доступ к ресурсам или их изменение, можно создать идентификатор для приложения. Этот идентификатор известен как субъект-служба. Затем субъекту-службе можно назначить необходимые разрешения. В этой статье показано, как создать субъект-службу с помощью портала. Здесь рассматривается однотенантное приложение — решение, используемое в пределах одной организации. Обычно однотенантная архитектура используется для создания бизнес-приложений в рамках организации.

> [!IMPORTANT]
> Вместо создания субъекта-службы вы можете применить управляемые удостоверения ресурсов Azure в качестве удостоверения приложения. Если код выполняется в службе, которая поддерживает управляемые удостоверения и обращается к ресурсам, поддерживающим аутентификацию Azure AD, управляемых удостоверений являются лучшим вариантом для вас. Дополнительные сведения об управляемых удостоверениях для ресурсов Azure, включая службы, которые в настоящее время поддерживают их, см. в разделе [Что такое управляемые удостоверения для ресурсов Azure?](../managed-identities-azure-resources/overview.md)

## <a name="create-an-azure-active-directory-application"></a>Создание приложения Azure Active Directory

Перейдем к созданию удостоверения. Если у вас возникли сложности, проверьте [необходимые разрешения](#required-permissions), чтобы убедиться в том, что в учетной записи можно создать удостоверение.

1. Войдите в учетную запись Azure через [портал Azure](https://portal.azure.com).
1. Выберите **Azure Active Directory**.
1. Щелкните **Регистрация приложений**.

   ![Выберите "Регистрация приложений".](./media/howto-create-service-principal-portal/select-app-registrations.png)

1. Выберите **Новая регистрация**.

   ![Добавление приложения](./media/howto-create-service-principal-portal/select-add-app.png)

1. Укажите имя для приложения. Выберите учетную запись поддерживаемый тип, который определяет, кто может использовать приложение. В разделе **URI перенаправления**выберите **Web** для типа приложения, которые вы хотите создать. Введите URI, где маркер доступа отправляется.  Вы не можете создать учетные данные для [собственного приложения](../manage-apps/application-proxy-configure-native-client-application.md). Этот тип нельзя использовать для автоматизированного приложения. Выбрав нужные значения, нажмите кнопку **Зарегистрировать**.

   ![Имя приложения](./media/howto-create-service-principal-portal/create-app.png)

Вы создали приложение Azure AD и субъект-службу.

## <a name="assign-the-application-to-a-role"></a>Назначение приложению роли

Чтобы обеспечить доступ к ресурсам в подписке, необходимо назначить приложению роль. Укажите, какая роль предоставляет приложению необходимые разрешения. Дополнительные сведения о доступных ролях см. в статье [RBAC: встроенные роли](../../role-based-access-control/built-in-roles.md).

Вы можете задать область действия на уровне подписки, группы ресурсов или ресурса. Разрешения наследуют более низкие уровни области действия. Например, добавление приложения в роль читателя для группы ресурсов означает, что оно может считывать группу ресурсов и все содержащиеся в ней ресурсы.

1. Перейдите на уровень области действия, которому вы хотите назначить приложение. Например, чтобы назначить роль в области действия подписки, выберите **Все службы** и **Подписки**.

   ![Выберите подписку.](./media/howto-create-service-principal-portal/select-subscription.png)

1. Выберите определенную подписку, для которой хотите назначить приложение.

   ![Выбор подписки для назначения](./media/howto-create-service-principal-portal/select-one-subscription.png)

   Если требуемая подписка не отображается, выберите **фильтр глобальных подписок**. Убедитесь, что для портала была выбрана необходимая подписка. 

1. Выберите **Управление доступом (IAM)** .
1. Выберите **Добавить назначение ролей**.

   ![Добавление назначения ролей](./media/howto-create-service-principal-portal/select-add.png)

1. Выберите роль, которая будет назначена приложению. Чтобы позволить приложению выполнять такие действия, как **перезагрузка**, **запуск** и **остановка** экземпляров, выберите роль **Участник**. По умолчанию приложения Azure Active Directory не отображаются среди доступных вариантов. Чтобы найти приложение, выполните поиск по его имени и выберите его.

   ![Выбрать роль](./media/howto-create-service-principal-portal/select-role.png)

1. Выберите **Сохранить**, чтобы завершить назначение роли. Вы увидите свое приложение в списке пользователей, назначенных выбранной роли для выбранной области действия.

Субъект-служба настроен. Вы можете начать использовать его, чтобы выполнять скрипты или приложения. В следующем разделе показано, как получить значения, необходимые для использования при входе с помощью программного способа.

## <a name="get-values-for-signing-in"></a>Получение значений для входа

Когда выполняется программный вход, необходимо передать идентификатор клиента в запросе на проверку подлинности. Вам также понадобится идентификатор приложения и ключ проверки подлинности. Получить эти значения можно следующим образом.

1. Выберите **Azure Active Directory**.

1. В Azure Active Directory в разделе **Регистрация приложений** выберите нужное приложение.

   ![Выбор приложения](./media/howto-create-service-principal-portal/select-app.png)

1. Копирование идентификатора каталога (клиента) и сохраните его в коде приложения.

    ![Tenant ID](./media/howto-create-service-principal-portal/copy-tenant-id.png)

1. Скопируйте **идентификатор приложения** и сохраните его в коде приложения.

   ![Идентификатор клиента](./media/howto-create-service-principal-portal/copy-app-id.png)

## <a name="certificates-and-secrets"></a>Сертификаты и секреты
Использование приложений управляющей программы можно использовать два вида учетных данных для аутентификации в Azure AD: сертификаты и секреты приложения.  Мы рекомендуем использовать сертификат, но можно также создать новый секретный код приложения.

### <a name="upload-a-certificate"></a>Загрузить сертификат

Можно использовать существующий сертификат, если таковой имеется.  При необходимости можно создать самозаверяющий сертификат для целей тестирования. Откройте PowerShell и выполните [New-SelfSignedCertificate](/powershell/module/pkiclient/new-selfsignedcertificate) со следующими параметрами, чтобы создать самозаверяющий сертификат в хранилище сертификатов пользователя на компьютере: `$cert=New-SelfSignedCertificate -Subject "CN=DaemonConsoleCert" -CertStoreLocation "Cert:\CurrentUser\My"  -KeyExportPolicy Exportable -KeySpec Signature`.  Экспортировать этот сертификат с помощью [Управление сертификатом пользователя](/dotnet/framework/wcf/feature-details/how-to-view-certificates-with-the-mmc-snap-in) оснастку MMC на панели управления Windows.

Чтобы отправить сертификат:
1. Выберите **сертификаты и секреты**.

   ![Выбор элемента "Параметры"](./media/howto-create-service-principal-portal/select-certs-secrets.png)
1. Щелкните **отправка сертификата** и выберите сертификат (существующий сертификат или самозаверяющий сертификат можно экспортировать).
    ![Отправка сертификата](./media/howto-create-service-principal-portal/upload-cert.png)
1. Щелкните **Добавить**.

После регистрации сертификата с приложением на портале регистрации приложений, необходимо включить в коде клиентского приложения для использования сертификата.

### <a name="create-a-new-application-secret"></a>Создание секрета приложения
Если вы решили не использовать сертификат, можно создать новый секретный код приложения.
1. Выберите **сертификаты и секреты**.

   ![Выбор элемента "Параметры"](./media/howto-create-service-principal-portal/select-certs-secrets.png)

1. Выберите **секреты клиента "->" новый секрет клиента**.
1. Введите описание секрет и длительность. Когда все будет готово, нажмите **Добавить**.

   ![Сохраните секрет](./media/howto-create-service-principal-portal/save-secret.png)

   После сохранения секрет клиента, отображается значение секрета клиента. Это значение невозможно будет получить позже, поэтому скопируйте его сразу. Значение ключа необходимо предоставить вместе с идентификатором приложения для входа от имени приложения. Сохраните значение ключа, чтобы приложение могло получить к нему доступ.

   ![Скопировать секрет](./media/howto-create-service-principal-portal/copy-secret.png)

## <a name="required-permissions"></a>Необходимые разрешения

У вас должны быть права на регистрацию приложения в клиенте Azure AD и назначение приложению роли в подписке Azure.

### <a name="check-azure-ad-permissions"></a>Проверка разрешений Azure AD

1. Выберите **Azure Active Directory**.
1. Запишите роль. Если вам назначена роль **Пользователь**, необходимо убедиться, что пользователи, не являющиеся администраторами, могут регистрировать приложения.

   ![Поиск пользователя](./media/howto-create-service-principal-portal/view-user-info.png)

1. Выберите **Параметры пользователя**.

   ![Выбор параметров пользователя](./media/howto-create-service-principal-portal/select-user-settings.png)

1. Проверьте параметр **Регистрация приложений**. Это значение может быть задано только администратором. Если установлено значение **Да**, приложение в клиенте Azure AD может зарегистрировать любой пользователь.

   ![Проверка регистрации приложений](./media/howto-create-service-principal-portal/view-app-registrations.png)

Если для параметра регистрации приложений установлено значение **Нет**, регистрировать приложения такого типа могут только пользователи с ролью администратора. Дополнительные сведения о доступных ролях администратора и конкретных разрешениях в Azure AD, которые предоставляются каждой роли, см. в разделах [Доступные роли](../users-groups-roles/directory-assign-admin-roles.md#available-roles) и [Разрешения ролей](../users-groups-roles/directory-assign-admin-roles.md#role-permissions). Если вашей учетной записи назначена роль пользователя, а параметр регистрации приложений разрешает регистрацию только администраторам, обратитесь к администратору с просьбой назначить вам одну из ролей администратора, которая будет создавать регистрацию приложений и управлять всеми ее аспектами, или предоставить пользователям возможность регистрировать приложения.

### <a name="check-azure-subscription-permissions"></a>Проверка прав доступа к подпискам Azure

Чтобы вы могли назначить роль приложению Active Directory, вашей учетной записи в подписке Azure должно быть предоставлено разрешение `Microsoft.Authorization/*/Write`. Это разрешение предоставляется ролью [владельца](../../role-based-access-control/built-in-roles.md#owner) или [администратора доступа пользователей](../../role-based-access-control/built-in-roles.md#user-access-administrator). Если вашей учетной записи назначена роль **Участник**, то у вас нет соответствующего разрешения. При попытке назначить роль субъекту-службе вы увидите ошибку.

Чтобы проверить права доступа к подписке, выполните следующие действия.

1. Выберите свою учетную запись в правом верхнем углу и выберите **... "->" Мои разрешения**.

   ![Выбор разрешений пользователя](./media/howto-create-service-principal-portal/select-my-permissions.png)

1. В раскрывающемся списке выберите подписку, в которой необходимо создать субъект-службу. Затем выберите ссылку **Щелкните здесь, чтобы просмотреть полные сведения о доступе для этой подписки**.

   ![Поиск пользователя](./media/howto-create-service-principal-portal/view-details.png)

1. Выберите **назначения ролей** просмотрите назначенные вам роли и определять, при наличии соответствующих разрешений для назначения роли приложения AD. Если разрешения нет, обратитесь к администратору подписки с просьбой назначить вам роль администратора доступа пользователей. На следующем рисунке представлен пользователь, которому назначена роль владельца. Это значит, что у такого пользователя есть необходимые разрешения.

   ![Просмотр разрешений](./media/howto-create-service-principal-portal/view-user-role.png)

## <a name="next-steps"></a>Дальнейшие действия

* Сведения о настройке мультитенантного приложения см. в статье [Управление ресурсами клиента с помощью Azure Active Directory и Resource Manager](../../azure-resource-manager/resource-manager-api-authentication.md).
* Дополнительные сведения о настройке политик безопасности см. в статье о [контроле доступа на основе ролей Azure](../../role-based-access-control/role-assignments-portal.md).  
* Список доступных действий, которые можно разрешить или запретить пользователям, см. в разделе [Операции поставщиков ресурсов Azure Resource Manager](../../role-based-access-control/resource-provider-operations.md).
