---
title: Настройка утверждений токена SAML для корпоративных приложений в Azure AD
titleSuffix: Microsoft identity platform
description: Узнайте, как настраивать утверждения, выпущенные в токене SAML для корпоративных приложений в Azure AD.
services: active-directory
documentationcenter: ''
author: rwike77
manager: CelesteDG
editor: ''
ms.assetid: f1daad62-ac8a-44cd-ac76-e97455e47803
ms.service: active-directory
ms.subservice: develop
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 10/01/2019
ms.author: ryanwi
ms.reviewer: luleon, paulgarn, jeedes
ms.custom: aaddev
ms.collection: M365-identity-device-management
ms.openlocfilehash: a9994d5f882e7bf27ac822a69c4310bc7c6fabe1
ms.sourcegitcommit: be8e2e0a3eb2ad49ed5b996461d4bff7cba8a837
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/23/2019
ms.locfileid: "72803463"
---
# <a name="how-to-customize-claims-issued-in-the-saml-token-for-enterprise-applications"></a>Настройка утверждений, выпущенных в токене SAML для корпоративных приложений

Сегодня Azure Active Directory (Azure AD) поддерживает единый вход (SSO) с большинством корпоративных приложений, включая приложения, предварительно интегрированные в коллекцию приложений Azure AD, а также пользовательские приложения. Когда пользователь проходит аутентификацию для приложения в Azure AD с помощью протокола SAML 2.0, Azure AD отправляет токен в приложение (через запрос HTTP POST). Затем приложение проверяет и использует маркер для входа пользователя вместо запроса имени пользователя и пароля. Эти токены SAML содержат фрагменты информации о пользователе, называемом *утверждениями*.

*Утверждение* представляет собой информацию, предложенную поставщиком удостоверений, о пользователе в составе токена, выпущенного для этого пользователя. В [токене SAML](https://en.wikipedia.org/wiki/SAML_2.0)эти данные обычно содержит оператор атрибута SAML. А уникальный идентификатор пользователя, как правило, представлен в субъекте SAML, который также называют идентификатором имени.

По умолчанию Azure AD выдает в приложение маркер SAML, содержащий утверждение `NameIdentifier` со значением имени пользователя (также известного как имя участника-пользователя) в Azure AD, которое может однозначно идентифицировать пользователя. Маркер SAML включает также дополнительные утверждения, содержащие адрес электронной почты, имя и фамилию пользователя.

Чтобы просмотреть или изменить утверждения, выданные приложению в токене SAML, откройте приложение на портале Azure. Затем откройте раздел **атрибуты пользователя & утверждения** .

![Откройте раздел "пользовательские атрибуты & утверждения" в портал Azure](./media/active-directory-saml-claims-customization/sso-saml-user-attributes-claims.png)

Изменение утверждений, выданных в маркере SAML, может потребоваться по двум основным причинам:

* Для приложения требуется, чтобы `NameIdentifier` или NameID утверждение было отличным от имени пользователя (или имени участника-пользователя), хранящегося в Azure AD.
* Приложение требует другого набора URI утверждений или значений утверждений.

## <a name="editing-nameid"></a>Изменение NameID

Чтобы изменить NameID (значение идентификатора имени), сделайте следующее:

1. Откройте страницу **значение идентификатора имени** .
1. Выберите атрибут или преобразование, которое нужно применить к атрибуту. При необходимости можно указать формат, который должен иметь утверждение NameID.

   ![Измените значение NameID (идентификатор имени)](./media/active-directory-saml-claims-customization/saml-sso-manage-user-claims.png)

### <a name="nameid-format"></a>Формат NameID

Если запрос SAML содержит элемент NameIDPolicy с указанным форматом, Azure AD будет учитывать формат в запросе.

Если запрос SAML не содержит элемент для NameIDPolicy, Azure AD выдаст NameID с указанным вами форматом. Если формат не указан, Azure AD будет использовать исходный формат по умолчанию, связанный с выбранным источником утверждений.

В раскрывающемся списке **Выбор формата идентификатора имени** можно выбрать один из следующих вариантов.

| Формат NameID | Описание |
|---------------|-------------|
| **По умолчанию** | Azure AD будет использовать исходный формат по умолчанию. |
| **Надежно** | Azure AD будет использовать persistent в качестве формата NameID. |
| **EmailAddress** | Azure AD будет использовать EmailAddress в качестве формата NameID. |
| **Unspecified** | Azure AD будет использовать в качестве формата NameID значение не указано. |

Также поддерживается временная NameID, но она недоступна в раскрывающемся списке и не может быть настроена на стороне Azure. Дополнительные сведения об атрибуте NameIDPolicy см. в разделе [протокол SAML единого входа](single-sign-on-saml-protocol.md).

### <a name="attributes"></a>Атрибуты

Выберите нужный источник для утверждения `NameIdentifier` (или NameID). Вы можете выбирать из следующих параметров.

| Name | Описание |
|------|-------------|
| Эл. почта | Адрес электронной почты пользователя |
| userprincipalName | Имя участника-пользователя (UPN) пользователя |
| onpremisessamaccount | Имя учетной записи SAM, синхронизированное из локального Azure AD |
| objectid | ObjectID пользователя в Azure AD |
| employeeid | КодСотрудника пользователя |
| Расширения каталогов | Расширения каталогов, [синхронизированные из локальной Active Directory с помощью синхронизации Azure AD Connect](../hybrid/how-to-connect-sync-feature-directory-extensions.md) |
| Атрибуты расширения 1–15 | Локальные атрибуты расширения, используемые для расширения схемы Azure AD |

Дополнительные сведения см. [в разделе Таблица 3. Допустимые значения идентификаторов на источник](active-directory-claims-mapping.md#table-3-valid-id-values-per-source).

Можно также назначить любые постоянные (статические) значения всем заявкам, определенным в Azure AD. Выполните следующие действия, чтобы присвоить постоянное значение:

1. В [портал Azure](https://portal.azure.com/)в разделе **пользовательские атрибуты & утверждения** щелкните значок **изменить** , чтобы изменить утверждения.

1. Щелкните обязательное утверждение, которое необходимо изменить.

1. Введите постоянное значение в **исходном атрибуте** в соответствии с вашей организацией и нажмите кнопку **сохранить**.

    ![Откройте раздел "пользовательские атрибуты & утверждения" в портал Azure](./media/active-directory-saml-claims-customization/organization-attribute.png)

1. Значение константы будет показано ниже.

    ![Откройте раздел "пользовательские атрибуты & утверждения" в портал Azure](./media/active-directory-saml-claims-customization/edit-attributes-claims.png)

### <a name="special-claims---transformations"></a>Специальные утверждения — преобразования

Можно также использовать функции преобразования утверждений.

| Функция | Описание |
|----------|-------------|
| **ExtractMailPrefix()** | Удаляет суффикс домена либо из адреса электронной почты, либо из имени участника-пользователя. В таком случае будет извлекаться только первая часть передаваемого имени пользователя (например, joe_smith вместо joe_smith@contoso.com). |
| **Join ()** | Присоединяет атрибут к проверенному домену. Если выбранное значение идентификатора пользователя имеет домен, он извлечет имя пользователя для добавления выбранного проверенного домена. Например, если в качестве значения идентификатора пользователя вы выберите адрес электронной почты (joe_smith@contoso.com), а в качестве проверенного домена выберите contoso.onmicrosoft.com, то в результате получите joe_smith@contoso.onmicrosoft.com. |
| **ToLower()** | Преобразует символы выбранного атрибута в символы нижнего регистра. |
| **ToUpper()** | Преобразует символы выбранного атрибута в символы верхнего регистра. |

## <a name="adding-application-specific-claims"></a>Добавление утверждений для конкретного приложения

Чтобы добавить утверждения для конкретного приложения:

1. В поле **атрибуты пользователя & утверждения**выберите **Добавить новое утверждение** , чтобы открыть страницу **Управление утверждениями пользователей** .
1. Введите **имя** утверждений. Значение не обязательно должно соответствовать шаблону URI в спецификации SAML. Если вам нужен шаблон URI, его можно разместить в поле **Namespace** .
1. Выберите **источник** , в котором утверждение будет извлекать свое значение. Можно выбрать атрибут пользователя из раскрывающегося списка исходный атрибут или применить преобразование к атрибуту пользователя, прежде чем создавать его как утверждение.

### <a name="application-specific-claims---transformations"></a>Утверждения для конкретных приложений — преобразования

Можно также использовать функции преобразования утверждений.

| Функция | Описание |
|----------|-------------|
| **ExtractMailPrefix()** | Удаляет суффикс домена либо из адреса электронной почты, либо из имени участника-пользователя. В таком случае будет извлекаться только первая часть передаваемого имени пользователя (например, joe_smith вместо joe_smith@contoso.com). |
| **Join ()** | Создает новое значение путем соединения двух атрибутов. При необходимости можно использовать разделитель между двумя атрибутами. |
| **ToLower()** | Преобразует символы выбранного атрибута в символы нижнего регистра. |
| **ToUpper()** | Преобразует символы выбранного атрибута в символы верхнего регистра. |
| **Contains ()** | Выводит атрибут или константу, если входные данные соответствуют указанному значению. В противном случае можно указать другой результат, если совпадений нет.<br/>Например, если необходимо создать утверждение, где значение — это адрес электронной почты пользователя, если он содержит домен "@contoso.com", в противном случае необходимо вывести имя участника-пользователя. Для этого необходимо настроить следующие значения:<br/>*Параметр 1 (вход)* : пользователь. адрес электронной почты<br/>*Значение*: "@contoso.com"<br/>Параметр 2 (Output): пользователь. адрес электронной почты<br/>Параметр 3 (Output, если совпадение нет): User. userPrincipalName |
| **Ендвис ()** | Выводит атрибут или константу, если входные данные заканчиваются указанным значением. В противном случае можно указать другой результат, если совпадений нет.<br/>Например, если вы хотите создать утверждение, в котором значением EmployeeID является пользователь, если КодСотрудника заканчивается на "000", в противном случае необходимо вывести атрибут расширения. Для этого необходимо настроить следующие значения:<br/>*Параметр 1 (вход)* : User. EmployeeID<br/>*Значение*: "000"<br/>Параметр 2 (вывод): User. EmployeeID<br/>Параметр 3 (Output, если совпадение нет): User. extensionattribute1 |
| **Стартвис ()** | Выводит атрибут или константу, если входные данные начинаются с указанного значения. В противном случае можно указать другой результат, если совпадений нет.<br/>Например, если вы хотите создать утверждение, где значением EmployeeID является пользователь, если страна или регион начинается с "US", в противном случае необходимо вывести атрибут расширения. Для этого необходимо настроить следующие значения:<br/>*Параметр 1 (вход)* : User. Country<br/>*Значение*: "US"<br/>Параметр 2 (вывод): User. EmployeeID<br/>Параметр 3 (Output, если совпадение нет): User. extensionattribute1 |
| **Extract () — после сопоставления** | Возвращает подстроку после того, как она соответствует указанному значению.<br/>Например, если значение входного значения — "Finance_BSimon", соответствующее значение — "Finance_", а результатом утверждения будет "Бсимон". |
| **Extract () — перед сопоставлением** | Возвращает подстроку до тех пор, пока она не будет соответствовать указанному значению.<br/>Например, если значение входного значения — "BSimon_US", соответствующее значение — "_US", а результатом утверждения будет "Бсимон". |
| **Извлечение () — между сопоставлениями** | Возвращает подстроку до тех пор, пока она не будет соответствовать указанному значению.<br/>Например, если значение входного значения — "Finance_BSimon_US", первое совпадающее значение — "Finance_", второе совпадающее значение — "_US", а результатом утверждения будет "Бсимон". |
| **Екстракталфа () — префикс** | Возвращает префиксную часть строки в алфавитном порядке.<br/>Например, если входное значение равно «BSimon_123», то возвращается «Бсимон». |
| **Екстракталфа () — суффикс** | Возвращает суффикс, который является частью строки в алфавитном порядке.<br/>Например, если входное значение равно «123_Simon», то возвращается «Simon». |
| **Екстрактнумерик () — префикс** | Возвращает длину префикса в строке.<br/>Например, если входное значение равно «123_BSimon», то возвращается «123». |
| **Екстрактнумерик () — суффикс** | Возвращает числовую часть строки суффикса.<br/>Например, если входное значение равно «BSimon_123», то возвращается «123». |
| **Ифемпти ()** | Выводит атрибут или константу, если входные данные имеют значение null или пусты.<br/>Например, если требуется выводить атрибут, хранящийся в ExtensionAttribute, если EmployeeID для данного пользователя является пустым. Для этого необходимо настроить следующие значения:<br/>Параметр 1 (вход): User. EmployeeID<br/>Параметр 2 (выходные данные): User. extensionattribute1<br/>Параметр 3 (вывод, если совпадение нет): User. EmployeeID |
| **Ифнотемпти ()** | Выводит атрибут или константу, если входные данные не равны null или пусты.<br/>Например, если требуется выводить атрибут, хранящийся в ExtensionAttribute, если EmployeeID для данного пользователя не пуст. Для этого необходимо настроить следующие значения:<br/>Параметр 1 (вход): User. EmployeeID<br/>Параметр 2 (выходные данные): User. extensionattribute1 |

Если вам нужны дополнительные преобразования, отправьте свою идею на [форуме обратной связи в Azure AD](https://feedback.azure.com/forums/169401-azure-active-directory?category_id=160599) в категории *приложений SaaS* .

## <a name="next-steps"></a>Дальнейшие действия

* [Управление приложениями с помощью Azure Active Directory](../manage-apps/what-is-application-management.md)
* [Настройка федеративного единого входа для приложения не из коллекции](../manage-apps/configure-federated-single-sign-on-non-gallery-applications.md)
* [Устранение неполадок единого входа на основе SAML](howto-v1-debug-saml-sso-issues.md)
