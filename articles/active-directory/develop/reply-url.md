---
title: Ограничения для URI перенаправления и URL-адреса ответа — платформа удостоверений Майкрософт | Azure
description: Ограничения для URL-адреса ответа и URI перенаправления
author: SureshJa
ms.author: sureshja
manager: CelesteDG
ms.date: 07/17/2020
ms.topic: conceptual
ms.subservice: develop
ms.custom: aaddev
ms.service: active-directory
ms.reviewer: lenalepa, manrath
ms.openlocfilehash: 4fdeb0018e27a2557161b2ec1c4794d975403523
ms.sourcegitcommit: a76ff927bd57d2fcc122fa36f7cb21eb22154cfa
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/28/2020
ms.locfileid: "87311625"
---
# <a name="redirect-urireply-url-restrictions-and-limitations"></a>Ограничения для универсального кода ресурса (URI) перенаправления и URL-адреса ответа

URI перенаправления или URL-адрес ответа — это расположение, в которое сервер авторизации будет отправлять пользователя после успешной авторизации приложения и которому был предоставлен код авторизации или маркер доступа. Код или маркер содержится в URI перенаправления или маркере ответа, поэтому важно зарегистрировать правильное расположение в процессе регистрации приложения.

 На URL-адреса ответа налагаются следующие ограничения:

* URL-адрес ответа должен начинаться со схемы `https`.

* В URL-адресе ответа учитывается регистр. Его регистр должен соответствовать регистру URL-пути выполняющегося приложения. Например, если приложение включает в состав своего пути `.../abc/response-oidc`, не указывайте `.../ABC/response-oidc` в URL-адресе ответа. Так как веб-браузер обрабатывает пути с учетом регистра, файлы cookie, связанные с `.../abc/response-oidc`, могут быть исключены при перенаправлении на не совпадающий по регистру знаков URL-адрес `.../ABC/response-oidc`.
    
## <a name="maximum-number-of-redirect-uris"></a>Максимальное число URI перенаправления

В следующей таблице показано максимальное число URI перенаправления, которые можно добавить при регистрации приложения.

| Учетные записи для входа | Максимальное число URI перенаправления | Описание |
|--------------------------|---------------------------------|-------------|
| Рабочие или учебные учетные записи Майкрософт в клиенте Azure Active Directory (Azure AD) любой организации | 256 | Для поля `signInAudience` в манифесте приложения установлено *AzureADMyOrg* или *AzureADMultipleOrgs* |
| Личные учетные записи Майкрософт и рабочие и учебные учетные записи | 100 | Для поля `signInAudience` в манифесте приложения установлено *AzureADandPersonalMicrosoftAccount* |

## <a name="maximum-uri-length"></a>Максимальная длина URI

Длина каждого URI перенаправления, добавляемого в регистрацию приложения, должна составлять не более 256 символов.

## <a name="supported-schemes"></a>Поддерживаемые схемы

Сейчас модель приложений Azure AD поддерживает как HTTP, так и HTTPS для приложений, которые входят в рабочие или учебные учетные записи Майкрософт в клиенте Azure Active Directory (Azure AD) любой организации. То есть для поля `signInAudience` в манифесте приложения установлено *AzureADMyOrg* или *AzureADMultipleOrgs*. Для приложений, которые входят в личные учетные записи Майкрософт и рабочие и учебные учетные записи (то есть `signInAudience` имеет значение *AzureADandPersonalMicrosoftAccount*), разрешена только схема HTTPS.

> [!NOTE]
> Новый интерфейс [Регистрация приложений](https://go.microsoft.com/fwlink/?linkid=2083908) не позволяет разработчикам добавлять URI с помощью схемы HTTP в пользовательском интерфейсе. Добавление URI HTTP для приложений, которые входят в рабочие или учебные учетные записи, поддерживается только в редакторе манифеста приложения. В дальнейшем новые приложения не смогут использовать схемы HTTP в URI перенаправления. Однако старые приложения, содержащие схемы HTTP в URI перенаправления, продолжат работать. Разработчики должны использовать схемы HTTPS в URI перенаправления.

## <a name="localhost-exceptions"></a>Исключения localhost

В соответствии с [разделом RFC 8252, разделами 8,3](https://tools.ietf.org/html/rfc8252#section-8.3) и [7,3](https://tools.ietf.org/html/rfc8252#section-7.3), "замыкание на себя" или "localhost" перенаправлением являются два особых замечания:

1. `http`Схемы URI приемлемы, так как перенаправление никогда не покидает устройство.  Это означает `http://127.0.0.1/myApp` , что это допустимо, а также `https://127.0.0.1/myApp` . 
1. Из-за временных диапазонов портов, часто используемых приложениями в машинном коде, компонент порта (например `:5001` , или `:443` ) игнорируется в целях сопоставления URI перенаправления.  В результате, как, так `http://127.0.0.1:5000/MyApp` и `http://127.0.0.1:1234/MyApp` `http://127.0.0.1/MyApp``http://127.0.0.1:8080/MyApp`

С точки зрения разработки это означает несколько моментов:

1. Не регистрируйте несколько URI ответа, если только порт отличается.  Сервер входа будет выбирать один произвольным образом и использовать поведение, связанное с этим URI ответа (например, является ли это `web` `native` `spa` перенаправление, и типом).
1. Если необходимо зарегистрировать несколько URI перенаправления на localhost для тестирования различных потоков во время разработки, следует отличать их с помощью компонента *пути* URI.  `http://127.0.0.1/MyWebApp`не совпадает `http://127.0.0.1/MyNativeApp` .  
1. В соответствии с руководством RFC не следует использовать `localhost` в URI перенаправления.  Вместо этого используйте фактический IP-адрес замыкания на себя — `127.0.0.1` . Это предотвращает разрыв приложения с помощью неправильно настроенных брандмауэров или переименованных сетевых интерфейсов.

>[!NOTE]
> Сейчас в настоящее время поддержка IPv6 замыкания на себя ( `[::1]` ) не поддерживается.  Это будет добавлено позже.

## <a name="restrictions-using-a-wildcard-in-uris"></a>Ограничения при использовании подстановочных знаков в URI

URI с подстановочными знаками, такие как `https://*.contoso.com`, удобны, но их следует избегать. Использование подстановочных знаков в URI перенаправления влияет на безопасность. Согласно спецификации OAuth 2.0 ([раздел 3.1.2 RFC 6749](https://tools.ietf.org/html/rfc6749#section-3.1.2)), URI конечной точки перенаправления должен быть абсолютным.

Модель приложений Azure AD не поддерживает подстановочные знаки URI для приложений, которые настроены для входа в личные учетные записи Майкрософт и рабочие или учебные учетные записи. Однако подстановочные знаки URI разрешены для приложений, которые уже настроены для входа в рабочие или учебные учетные записи в клиенте Azure AD организации.

> [!NOTE]
> Новый интерфейс [Регистрация приложений](https://go.microsoft.com/fwlink/?linkid=2083908) не позволяет разработчикам добавлять URI с подстановочными знаками в пользовательском интерфейсе. Добавление URI с подстановочными знаками для приложений, которые входят в рабочие или учебные учетные записи, поддерживается только в редакторе манифеста приложения. В дальнейшем новые приложения не смогут использовать подстановочные знаки в URI перенаправления. Однако старые приложения, содержащие подстановочные знаки в URI перенаправления, продолжат работать.

Если вам требуется больше URI перенаправления, чем разрешено, вместо использования подстановочных знаков следует рассмотреть следующий подход.

### <a name="use-a-state-parameter"></a>Использование параметра состояния

Если у вас есть несколько поддоменов и вам необходимо перенаправлять пользователей после успешной проверки подлинности на ту же страницу, с которой они начали, можно использовать параметр состояния.

Если вы используете этот подход:

1. Создайте "общий" URI перенаправления для каждого приложения, чтобы обрабатывать маркеры безопасности, полученные от конечной точки авторизации.
1. Приложение может отсылать параметры, зависящие от приложения (например, URL-адрес поддомена, откуда перешел пользователь, или фирменную символику), в параметр состояния. При использовании параметра состояния необходимо предотвратить защиту CSRF, как указано [в разделе 10.12 стандарта RFC 6749](https://tools.ietf.org/html/rfc6749#section-10.12)). 
1. Параметры, зависящие от приложения, будут включать всю информацию, необходимую приложению для корректного отображения для пользователя, то есть для создания соответствующего состояния приложения. Конечная точка авторизации Azure AD удаляет HTML-код из параметра состояния, поэтому не передавайте HTML-содержимое в этом параметре.
1. Когда Azure AD отправляет ответ на общий URI перенаправления, он отправляет параметр состояния обратно в приложение.
1. Затем приложение может использовать значение в параметре состояния, чтобы определить URL-адрес для отправки пользователю. Убедитесь, что вы проверили защиту CSRF.

> [!NOTE]
> Такой подход позволяет скомпрометированному клиенту изменять дополнительные параметры, отправляемые в параметре состояния, поэтому пользователь перенаправляется на другой URL-адрес, что является [угрозой открытого перенаправления](https://tools.ietf.org/html/rfc6819#section-4.2.4), как описано в стандарте RFC 6819. Таким образом, клиент должен защищать эти параметры, шифруя состояние или проверяя его с помощью других средств, таких как проверка доменного имени в URI перенаправления по маркеру.

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте больше о [манифесте приложения](reference-app-manifest.md)
