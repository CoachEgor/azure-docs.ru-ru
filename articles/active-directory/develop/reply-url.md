---
title: URI перенаправления & ограничения URL-адреса ответа — платформа Microsoft Identity | Службы
description: URL-адреса ответа и ограничения URL-адресов перенаправления & ограничения
author: SureshJa
ms.author: sureshja
manager: CelesteDG
ms.date: 06/29/2019
ms.topic: conceptual
ms.subservice: develop
ms.custom: aaddev
ms.service: active-directory
ms.reviewer: lenalepa, manrath
ms.collection: M365-identity-device-management
ms.openlocfilehash: bfc13c1057f74fb1eb5a41210ffaf166e69bb06e
ms.sourcegitcommit: a5ebf5026d9967c4c4f92432698cb1f8651c03bb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/08/2019
ms.locfileid: "74920333"
---
# <a name="redirect-urireply-url-restrictions-and-limitations"></a>Ограничения для универсального кода ресурса (URI) перенаправления и URL-адреса ответа

URI перенаправления или URL-адрес ответа — это расположение, в которое сервер авторизации будет отправлять пользователя после успешного авторизации приложения и которому был предоставлен код авторизации или маркер доступа. Код или маркер содержится в URI перенаправления или маркере ответа, поэтому важно зарегистрировать правильное расположение в процессе регистрации приложения.

## <a name="maximum-number-of-redirect-uris"></a>Максимальное число URI перенаправления

В следующей таблице показано максимальное число URI перенаправления, которые можно добавить при регистрации приложения.

| Учетные записи для входа | Максимальное число URI перенаправления | Описание |
|--------------------------|---------------------------------|-------------|
| Рабочие или учебные учетные записи Майкрософт в клиенте Azure Active Directory (Azure AD) любой организации | 256 | для поля `signInAudience` в манифесте приложения задано значение *азуреадмйорг* или *азуреадмултиплеоргс* |
| Личные учетные записи Майкрософт, рабочие и учебные учетные записи | 100 | `signInAudience` поле в манифесте приложения имеет значение *азуреадандперсоналмикрософтаккаунт* |

## <a name="maximum-uri-length"></a>Максимальная длина URI

Для каждого URI перенаправления, добавляемого в регистрацию приложения, можно использовать не более 256 символов.

## <a name="supported-schemes"></a>Поддерживаемые схемы
Сейчас модель приложений Azure AD поддерживает как схемы HTTP, так и HTTPS для приложений, которые входят в рабочие или учебные учетные записи Майкрософт в клиенте Azure Active Directory (Azure AD) любой организации. `signInAudience` поле в манифесте приложения установлено значение *азуреадмйорг* или *азуреадмултиплеоргс*. Для приложений, которые входят в личные учетные записи Майкрософт и рабочие и учебные учетные записи (`signInAudience` задано значение *азуреадандперсоналмикрософтаккаунт*), разрешена только схема HTTPS.

> [!NOTE]
> Новый [Регистрация приложений](https://go.microsoft.com/fwlink/?linkid=2083908) интерфейс не позволяет разработчикам добавлять URI с помощью схемы HTTP в пользовательском интерфейсе. Добавление URI HTTP для приложений, которые входят в рабочие или учебные учетные записи, поддерживается только в редакторе манифеста приложения. В дальнейшем новые приложения не смогут использовать схемы HTTP в URI перенаправления. Однако старые приложения, содержащие схемы HTTP в URI перенаправления, продолжат работать. Разработчики должны использовать схемы HTTPS в URI перенаправления.

## <a name="restrictions-using-a-wildcard-in-uris"></a>Ограничения с использованием подстановочных знаков в URI

Подстановочные знаки URI, такие как `https://*.contoso.com`, удобны, но их следует избегать. Использование подстановочных знаков в URI перенаправления влияет на безопасность. Согласно спецификации OAuth 2,0 ([раздел 3.1.2 RFC 6749](https://tools.ietf.org/html/rfc6749#section-3.1.2)), URI конечной точки перенаправления должен быть абсолютным URI. 

Модель приложений Azure AD не поддерживает подстановочные знаки URI для приложений, которые настроены для входа в личные учетные записи Майкрософт и рабочие или учебные учетные записи. Однако подстановочные знаки URI разрешены для приложений, которые настроены для входа в рабочие или учебные учетные записи в клиенте Azure AD Организации уже сегодня. 
 
> [!NOTE]
> Новый [Регистрация приложений](https://go.microsoft.com/fwlink/?linkid=2083908) интерфейс не позволяет разработчикам добавлять подстановочные знаки URI в пользовательский интерфейс. Добавление универсального кода ресурса (URI) вилкард для приложений, работающих с рабочими или учебными учетными записями, поддерживается только в редакторе манифестов приложений. В дальнейшем новые приложения не смогут использовать подстановочные знаки в URI перенаправления. Однако старые приложения, содержащие подстановочные знаки в URI перенаправления, продолжат работать.

Если для сценария требуется больше URI перенаправления, чем разрешено, вместо добавления URI перенаправления с подстановочным знаком рекомендуется использовать один из следующих подходов.

### <a name="use-a-state-parameter"></a>Использование параметра State

Если у вас есть несколько поддоменов, и если ваш сценарий требует перенаправить пользователей после успешной проверки подлинности на той же странице, где они начали, может оказаться полезным использование параметра state. 

При таком подходе:

1. Создайте "Shared" URI перенаправления для каждого приложения, чтобы обработать маркеры безопасности, полученные от конечной точки авторизации.
1. Приложение может отсылать параметры, зависящие от приложения (например, URL-адрес поддомена, где пользователь поступил, или нечто вроде информации о фирменной символике) в параметре state. При использовании параметра state необходимо защититься от защиты CSRF, как указано в [разделе 10,12 из RFC 6749](https://tools.ietf.org/html/rfc6749#section-10.12). 
1. Параметры, зависящие от приложения, будут включать всю информацию, необходимую приложению для визуализации правильной работы пользователя, то есть создать соответствующее состояние приложения. Конечная точка авторизации Azure AD удаляет HTML-код из параметра State, поэтому убедитесь, что вы не передаете HTML-содержимое в этом параметре.
1. Когда Azure AD отправляет ответ на универсальный код ресурса (URI) перенаправления, он отправит параметр state обратно в приложение.
1. Затем приложение может использовать значение в параметре State, чтобы определить URL-адрес для дальнейшей отправки пользователя. Убедитесь, что вы проверили защиту CSRF.

> [!NOTE]
> Такой подход позволяет скомпрометированному клиенту изменять дополнительные параметры, отправленные в параметре State, таким образом перенаправляя пользователя на другой URL-адрес, который представляет собой [уязвимость Open Redirect](https://tools.ietf.org/html/rfc6819#section-4.2.4) , описанную в RFC 6819. Таким образом, клиент должен защищать эти параметры, шифруя состояние или проверяя его с помощью других средств, таких как проверка доменного имени в URI перенаправления для маркера.

### <a name="add-redirect-uris-to-service-principals"></a>Добавление URI перенаправления в субъекты-службы

Другой подход заключается в добавлении URI перенаправления к [субъектам-службам](app-objects-and-service-principals.md#application-and-service-principal-relationship) , которые представляют регистрацию вашего приложения в любом клиенте Azure AD. Этот подход можно использовать, если вы не можете использовать параметр state или ваш сценарий требует добавления новых URI перенаправления в регистрацию приложения для каждого нового клиента, который вы поддерживаете. 

## <a name="next-steps"></a>Дальнейшие действия

- Сведения о [манифесте приложения](reference-app-manifest.md)
