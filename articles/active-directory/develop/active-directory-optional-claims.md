---
title: Предоставление дополнительных претензий к приложениям Azure AD Azure
titleSuffix: Microsoft identity platform
description: Как добавить пользовательские или дополнительные претензии к токенам SAML 2.0 и JSON Web Tokens (JWT), выпущенным Active Directory Azure.
author: rwike77
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: conceptual
ms.workload: identity
ms.date: 3/11/2020
ms.author: ryanwi
ms.reviewer: paulgarn, hirsin, keyam
ms.custom: aaddev
ms.openlocfilehash: 23d83b59c510f2565b2f66f78dad56c9c9592dd0
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79136523"
---
# <a name="how-to-provide-optional-claims-to-your-azure-ad-app"></a>Как предоставить дополнительные претензии к приложению Azure AD

Разработчики приложений могут использовать дополнительные требования в своих приложениях Azure AD, чтобы указать, какие утверждения они хотят в токенах, отправленных в их приложение. 

Необязательные утверждения можно использовать, чтобы:

- выбрать дополнительные утверждения для включения в токены для приложения;
- изменить поведение определенных утверждений в токенах, возвращаемых Azure AD;
- добавлять пользовательские утверждения для приложения и обращаться к ним.

В списках стандартных требований см. [документацию по токену доступа](access-tokens.md) и [id_token](id-tokens.md) претензий. 

В то время как факультативные претензии поддерживаются как в токенах формата v1.0, так и в формате v2.0, а также в токенах SAML, они обеспечивают большую часть их значения при переходе от v1.0 к v2.0. Одной из целей [конечной точки платформы v2.0 Microsoft](active-directory-appmodel-v2-overview.md) является меньший размер маркеров для обеспечения оптимальной производительности клиентами. В результате нескольких утверждений, ранее включенных в маркеры доступа и идентификаторов, больше нет в токенах версии 2.0 и их нужно запрашивать специально для каждого приложения.

**Таблица 1. Применимость**

| Тип учетной записи | маркеры версии 1.0; | маркеры версии 2.0.  |
|--------------|---------------|----------------|
| Личная учетная запись Майкрософт  | Недоступно  | Поддерживается |
| Учетная запись Azure AD      | Поддерживается | Поддерживается |

## <a name="v10-and-v20-optional-claims-set"></a>v1.0 и v2.0 необязательный набор претензий

Набор необязательных утверждений доступен по умолчанию для использования приложениями, перечисленными ниже. Чтобы добавить настраиваемые необязательные утверждения для приложения, ознакомьтесь с разделом [Расширения каталога](#configuring-directory-extension-optional-claims) ниже. При добавлении претензий к **токену доступа**претензии применяются к *запрошенным* для приложения токенам (веб-API), а не к утверждениям, *запрошенным приложением.* Независимо от того, как клиент получает доступ к API, нужные данные присутствуют в ктокене доступа, который используется для проверки подлинности в отношении Вашего API.

> [!NOTE]
> Большую часть этих утверждений можно включить в JWT для токенов версии 1.0 и 2.0, кроме токенов SAML, за исключением оговоренных в столбце типов токенов. Учетные записи потребителей поддерживают подмножество этих утверждений, отмеченное в столбце "Тип пользователя".  Многие из перечисленных претензий не распространяются на потребителей (у них нет арендатора, поэтому `tenant_ctry` не имеет значения).  

**Таблица 2: v1.0 и v2.0 дополнительный набор претензий**

| name                       |  Описание   | Тип маркера | Тип пользователя | Примечания  |
|----------------------------|----------------|------------|-----------|--------|
| `auth_time`                | Время, когда пользователь последний раз проходил аутентификацию. Ознакомьтесь со спецификацией OpenID Connect.| JWT        |           |  |
| `tenant_region_scope`      | Регион клиента ресурса | JWT        |           | |
| `home_oid`                 | Для гостевых пользователей идентификатор объекта пользователя — это домашний клиент пользователя.| JWT        |           | |
| `sid`                      | Идентификатор сеанса, используемый для регистрации пользователя за сеанс. | JWT        |  Личные и Azure AD-аккаунты.   |         |
| `platf`                    | Платформа устройства    | JWT        |           | Только для управляемых устройств, которые могут проверить тип устройства.|
| `verified_primary_email`   | Источник: PrimaryAuthoritativeEmail пользователя      | JWT        |           |         |
| `verified_secondary_email` | Источник: SecondaryAuthoritativeEmail пользователя   | JWT        |           |        |
| `enfpolids`                | Идентификаторы применяемой политики. Список идентификаторов политик, оцененных для текущего пользователя. | JWT |  |  |
| `vnet`                     | Сведения об описателе виртуальной сети. | JWT        |           |      |
| `fwd`                      | IP-адрес.| JWT    |   | Добавляет исходный IPv4-адрес запрашивающего клиента (при использовании внутри виртуальной сети) |
| `ctry`                     | Страна пользователя | JWT |  | Azure AD возвращает необязательное утверждение `ctry`, если оно имеется, и значением утверждения является стандартный двухбуквенный код страны, например FR, JP, SZ и т. д. |
| `tenant_ctry`              | Страна ресурса клиента | JWT | | |
| `xms_pdl`          | Предпочтительное расположение данных   | JWT | | Для арендаторов Multi-Geo предпочтительным местоположением данных является трехбуквенный код, показывающий географический регион, в котором находится пользователь. Для получения дополнительной информации смотрите [документацию Azure AD Connect о предпочтительном местоположении данных.](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnectsync-feature-preferreddatalocation)<br/>Например: `APC` для Азиатско-Тихоокеанского региона. |
| `xms_pl`                   | Предпочитаемый язык пользователя  | JWT ||Предпочитаемый язык пользователя, если задан. Источник: домашний клиент пользователя в сценариях гостевого доступа. Формат: ЯЯ-СС ("en-us"). |
| `xms_tpl`                  | Предпочитаемый язык клиента| JWT | | Предпочитаемый язык клиента ресурса, если задан. Формат: ЯЯ ("en"). |
| `ztdid`                    | Идентификатор развертывания без участия пользователя | JWT | | Идентификатор устройства, используемый для [Windows AutoPilot](https://docs.microsoft.com/windows/deployment/windows-autopilot/windows-10-autopilot) |
| `email`                    | Доступный адрес электронной почты для этого пользователя (если имеется).  | JWT, SAML | MSA, Azure AD | Это значение добавляется по умолчанию, если пользователь является гостем в клиенте.  Для управляемых пользователей (пользователей внутри арендатора) он должен быть запрошен через эту необязательную претензию или, только на v2.0, с областью OpenID.  Адреса электронной почты для управляемых пользователей должны быть заданы на [портале администрирования Office](https://portal.office.com/adminportal/home#/users).| 
| `groups`| Факультативное форматирование для групповых претензий |JWT, SAML| |Используется в сочетании с GroupMembershipClaims настройки в [приложении манифест](reference-app-manifest.md), который должен быть установлен, а также. Подробности приведены [в приведении претензий Группы](#configuring-groups-optional-claims) ниже. Для получения дополнительной информации о групповых претензиях [см.](../hybrid/how-to-connect-fed-group-claims.md)
| `acct`             | Состояние учетной записи пользователя в клиенте. | JWT, SAML | | Если пользователь является членом клиента, это значение равно `0`. Если он является гостем, это значение равно `1`. |
| `upn`                      | Утверждение UserPrincipalName. | JWT, SAML  |           | Несмотря на то, что это утверждение автоматически включается, можно указать его в качестве необязательного утверждения для присоединения дополнительных свойств, чтобы изменить его поведение в варианте использования гостевым пользователем.  |

## <a name="v20-specific-optional-claims-set"></a>v2.0-специфический набор факультативных требований

Эти требования всегда включаются в токены v1.0 Azure AD, но не включены в токены v2.0 без запроса. Эти требования применимы только для JWT (токены ID и токены доступа). 

**Таблица 3: v2.0-только факультативные претензии**

| Утверждение JWT     | name                            | Описание                                | Примечания |
|---------------|---------------------------------|-------------|-------|
| `ipaddr`      | IP-адрес                      | IP-адрес, с которого клиент вошел в систему.   |       |
| `onprem_sid`  | Локальный идентификатор безопасности |                                             |       |
| `pwd_exp`     | Срок действия пароля        | Дата и время истечения срока действия пароля. |       |
| `pwd_url`     | Изменить URL-адрес пароля             | URL-адрес, перейдя по которому пользователь может изменить свой пароль.   |   |
| `in_corp`     | В корпоративной сети        | Посылает сигнал, если клиент входит в корпоративную сеть. Если это не так, то претензия не включена.   |  На основе параметров [надежных IP-адресов](../authentication/howto-mfa-mfasettings.md#trusted-ips) в MFA.    |
| `nickname`    | Псевдоним                        | Дополнительное имя пользователя. Прозвище отделено от имени или фамилии. Требуется `profile` область применения.| 
| `family_name` | Фамилия                       | Предоставляет фамилию, фамилию или фамилию пользователя, как это определено в объекте пользователя. <br>"family_name":"Miller" | Поддерживается в MSA и Azure AD. Требуется `profile` область применения.   |
| `given_name`  | Имя                      | Предоставляет первое или "данное" имя пользователя, как установить на объекте пользователя.<br>"given_name": "Frank"                   | Поддерживается в MSA и Azure AD .  Требуется `profile` область применения. |
| `upn`         | Имя участника-пользователя | Идентификатор пользователя, который можно использовать с параметром username_hint.  Не является долговременным идентификатором для пользователя и не должен использоваться для ключевых данных. | См. в разделе [Дополнительные свойства необязательных утверждений](#additional-properties-of-optional-claims) указанном ниже для конфигурации утверждения. Требуется `profile` область применения.|

### <a name="additional-properties-of-optional-claims"></a>Дополнительные свойства необязательных утверждений

Некоторые необязательные утверждения можно настроить так, чтобы изменить способ возврата утверждения. Эти дополнительные свойства используются в основном для переноса локальных приложений с различными требованиями к данным (например, `include_externally_authenticated_upn_without_hash` помогает при работе с клиентами, которые не обрабатывают метки хэширования (`#`) в имени участника-пользователя).

**Таблица 4: Значения для настройки факультативных требований**

| Имя свойства  | Имя дополнительного свойства | Описание |
|----------------|--------------------------|-------------|
| `upn`          |                          | Может использоваться для ответов SAML и JWT и для токенов v1.0 и v2.0. |
|                | `include_externally_authenticated_upn`  | Включает гостевое имя участника-пользователя, сохраненное в клиенте ресурса. Например `foo_hometenant.com#EXT#@resourcetenant.com`. |             
|                | `include_externally_authenticated_upn_without_hash` | Так же, как выше, за`#`исключением того,`_`что хэш-метки ( ) заменяются подчеркивает ( ), например,`foo_hometenant.com_EXT_@resourcetenant.com` |

#### <a name="additional-properties-example"></a>Пример дополнительных свойств:

    ```json
        "optionalClaims": 
         {
             "idToken": [ 
            { 
                      "name": "upn", 
                      "essential": false,
                  "additionalProperties": [ "include_externally_authenticated_upn"]  
                    }
                 ]
        }
    ```

Этот объект OptionalClaims приводит к тому, что токен ID возвращается клиенту, чтобы включить претензию upn с дополнительной информацией арендатора дома и ресурса. Претензия `upn` изменяется в токене только в том случае, если пользователь является гостем в арендаторе (который использует другой ВПЛ для проверки подлинности). 

## <a name="configuring-optional-claims"></a>Настройка необязательных утверждений

> [!IMPORTANT]
> Токены доступа **всегда** генерируются с помощью манифеста ресурса, а не клиента.  Таким образом, `...scope=https://graph.microsoft.com/user.read...` в запросе ресурсом является API Microsoft Graph.  Таким образом, токен доступа создается с помощью манифеста Microsoft Graph API, а не манифеста клиента.  Изменение манифеста для приложения никогда не приведет к тому, что токены для API Microsoft Graph будут выглядеть по-другому.  Чтобы проверить, что `accessToken` ваши изменения в силе, запросите маркер для приложения, а не другое приложение.  


Вы можете настроить дополнительные претензии для приложения через манифест uI или приложения.

1. Перейдите на [портал Azure](https://portal.azure.com). Найдите и выберите **Azure Active Directory**.
1. Из раздела **«Управление»** выберите **регистрацию приложений.**
1. Выберите приложение, для которого вы хотите настроить дополнительные претензии в списке.

**Настройка факультативных претензий через uI:**

[![Показывает, как настроить дополнительные претензии с помощью uI](./media/active-directory-optional-claims/token-configuration.png)](./media/active-directory-optional-claims/token-configuration.png)

1. Из раздела **«Управление»** выберите **конфигурацию токенов (предварительный просмотр).**
2. Выберите **Добавить необязательный claim**.
3. Выберите тип маркера, который вы хотите настроить.
4. Выберите дополнительные претензии для добавления.
5. Нажмите кнопку **Добавить**.

**Настройка факультативных претензий через манифест приложения:**

[![Показывает, как настроить дополнительные утверждения с помощью манифеста приложения](./media/active-directory-optional-claims/app-manifest.png)](./media/active-directory-optional-claims/app-manifest.png)

1. Из раздела **«Управление»** выберите **Manifest**. Открывается веб-редактор манифеста, позволяющий отредкить манифест. При необходимости можно выбрать **Скачать** и изменить манифест локально, а затем повторно применить его для приложения с помощью команды **Отправить**. Для получения дополнительной информации о [Understanding the Azure AD application manifest article](reference-app-manifest.md)манифесте приложения см.

    Следующее приложение манифест запись добавляет auth_time, ipaddr, и upn дополнительных претензий к ID, доступ, и SAML токенов.

    ```json
        "optionalClaims":  
           {
              "idToken": [
                    {
                          "name": "auth_time", 
                          "essential": false
                     }
              ],
              "accessToken": [
                     {
                            "name": "ipaddr", 
                            "essential": false
                      }
              ],
              "saml2Token": [
                      {
                            "name": "upn", 
                            "essential": false
                       },
                       {
                            "name": "extension_ab603c56068041afb2f6832e2a17e237_skypeId",
                            "source": "user", 
                            "essential": false
                       }
               ]
           }
    ```

2. По завершении щелкните **Сохранить**. Теперь указанные факультативные претензии будут включены в токены для вашего приложения.    


### <a name="optionalclaims-type"></a>Тип факультативных претензий

Объявляет необязательные утверждения, запрошенные приложением. В приложении можно настроить необязательные утверждения, которые должны возвращаться в каждый из трех типов токенов (токен идентификации, маркер доступа, токен SAML 2), которые оно может получить из службы токенов безопасности. Приложение может настроить различные наборы необязательных утверждений, которые будут возвращаться в каждый тип токена. Свойство optionalClaims сущности приложения — это объект optionalClaims.

**Таблица 5: Свойства типа Факультативные претензии**

| name        | Тип                       | Описание                                           |
|-------------|----------------------------|-------------------------------------------------------|
| `idToken`     | Коллекция (OptionalClaim) | Необязательные утверждения, возвращаемые в токен идентификации JWT. |
| `accessToken` | Коллекция (OptionalClaim) | Необязательные утверждения, возвращаемые в маркер доступа JWT. |
| `saml2Token`  | Коллекция (OptionalClaim) | Необязательные утверждения, возвращаемые в токен SAML.   |

### <a name="optionalclaim-type"></a>Вариант факультативной претензии

Содержит необязательное утверждение, связанное с приложением или субъект-службой. Свойства idToken, accessToken и saml2Token типа [OptionalClaims](https://docs.microsoft.com/graph/api/resources/optionalclaims?view=graph-rest-1.0) являются коллекцией OptionalClaim.
С помощью поля AdditionalProperties можно изменить поведение OptionalClaim, если это поддерживается определенным утверждением.

**Таблица 6: Свойства типа Факультативного требования**

| name                 | Тип                    | Описание                                                                                                                                                                                                                                                                                                   |
|----------------------|-------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `name`                 | Edm.String              | Имя необязательного утверждения.                                                                                                                                                                                                                                                                           |
| `source`               | Edm.String              | Источник утверждения (объект каталога). Существуют стандартные утверждения и определяемые пользователем утверждения из свойств расширения. Если исходное значение равно null, утверждение будет являться предопределенным необязательным утверждением. Если исходное значение — user, значение в имени свойства будет свойством расширения из объекта пользователя. |
| `essential`            | Edm.Boolean             | Если значение равно true, утверждение, указанное клиентом, необходимо для обеспечения плавной авторизации конкретной задачи, запрашиваемой пользователем. Значение по умолчанию — false.                                                                                                             |
| `additionalProperties` | Коллекция (Edm.String) | Дополнительные свойства утверждений. Если свойство существует в коллекции, оно изменяет поведение дополнительного утверждения, указанного в свойстве имени.                                                                                                                                               |
## <a name="configuring-directory-extension-optional-claims"></a>Настройка дополнительных претензий расширения каталога

В дополнение к стандартному набору дополнительных требований можно также настроить токены для включения расширений. Для получения дополнительной информации см. [документацию Microsoft Graph extensionProperty](https://docs.microsoft.com/graph/api/resources/extensionproperty?view=graph-rest-1.0) - обратите внимание, что схема и открытые расширения не поддерживаются дополнительными претензиями, только расширениями каталога AAD-Graph. Эта возможность полезна при присоединении дополнительных сведений о пользователях, которые может использовать приложение, например, дополнительный идентификатор или важный параметр конфигурации, заданный пользователем. Например, в нижней части этой страницы.

> [!NOTE]
> - Расширения схемы каталога — это функция Azure AD, поэтому, если приложение запросило пользовательское расширение и введом ы пользователя MSA в ваше приложение, эти расширения не будут возвращены.

### <a name="directory-extension-formatting"></a>Формат расширения каталога

При настройке дополнительных требований расширения каталога с помощью манифеста приложения `extension_<appid>_<attributename>`используйте полное название расширения (в формате: ). Обязательно `<appid>` е-иное удостоверение приложения, запрашивающего претензию. 

В рамках JWT эти утверждения будут передаваться с помощью следующего формата имени: `extn.<attributename>`.

В рамках токенов SAML эти утверждения будут передаваться с помощью следующего формата URI: `http://schemas.microsoft.com/identity/claims/extn.<attributename>`

## <a name="configuring-groups-optional-claims"></a>Настройка групп факультативных претензий

   > [!NOTE]
   > Возможность излучать групповые имена для пользователей и групп, синхронизированных с предприимчивыми, является публичным предварительным предварительным просмотром.

Этот раздел охватывает параметры конфигурации под необязательными требованиями для изменения атрибутов группы, используемых в групповых требованиях из объективного идентификатора группы по умолчанию, на атрибуты, синхронизированные с предприимчивым каталогом Windows Active. Вы можете настроить группы дополнительных требований для вашего приложения через манифест uI или приложения.

> [!IMPORTANT]
> Для получения более подробной информации, включая важные предостережения для публичного предварительного просмотра групповых претензий из атрибутов на местах, [см.](../hybrid/how-to-connect-fed-group-claims.md)

**Настройка групп факультативных претензий через uI:**
1. Войти на [портал Azure](https://portal.azure.com)
1. После проверки подлинности выберите арендатора Azure AD, выбрав его из верхнего правого угла страницы
1. Выберите **активный каталог Azure** из меню слева
1. В разделе **Управление** выберите **регистрацию приложений**
1. Выберите приложение, для которого вы хотите настроить дополнительные претензии в списке
1. В разделе **Управление** выберите **конфигурацию токенов (предварительный просмотр)**
2. Выберите **претензию групп добавления**
3. Выберите типы групп для возврата **(Все группы,** **SecurityGroup**, или **DirectoryRole).** Опция **«Все группы»** включает в себя **SecurityGroup,** **DirectoryRole**и **DistributionList**
4. Дополнительно: нажмите на определенные свойства типа маркера, чтобы изменить значение претензии групп, чтобы содержать на атрибутах группы помещений, или изменить тип претензии на роль
5. Нажмите кнопку **Сохранить**.

**Настройка групп факультативных претензий через манифест приложения:**
1. Войти на [портал Azure](https://portal.azure.com)
1. После проверки подлинности выберите арендатора Azure AD, выбрав его из верхнего правого угла страницы
1. Выберите **активный каталог Azure** из меню слева
1. Выберите приложение, для которого вы хотите настроить дополнительные претензии в списке
1. Под разделом **«Управление»** выберите **Manifest**
3. Добавьте следующую запись с помощью редактора манифеста:

   Допустимые значения:

   - "Все" (этот вариант включает SecurityGroup, DirectoryRole и DistributionList)
   - "SecurityGroup"
   - "DirectoryRole"

   Пример:

    ```json
        "groupMembershipClaims": "SecurityGroup"
    ```

   По умолчанию объекты группы будут испускаться в значении группового требования.  Чтобы изменить значение претензии, содержащее на атрибутах группы помещений, или изменить тип претензии в роли, используйте конфигурацию OptionalClaims следующим образом:

3. Установите конфигурацию группы факультативные претензии.

   Если вы хотите, чтобы группы в токене содержали атрибуты группы AD в разделе дополнительных претензий, укажите, к какому типу токенов следует применять факультативную претензию, запрашиваемую название факультативной претензии и любые дополнительные свойства.  Несколько типов токенов могут быть перечислены:

   - idToken для токена OIDC ID
   - accessToken для токена доступа OAuth
   - Saml2Token для токенов SAML.

   > [!NOTE]
   > Тип Saml2Token применяется как к токенам формата SAML1.1, так и к SAML2.0

   Для каждого соответствующего типа маркеров изменяйте, что группы утверждают, что используют раздел OptionalClaims в манифесте. Схема OptionalClaims такова:

    ```json
       {
       "name": "groups",
       "source": null,
       "essential": false,
       "additionalProperties": []
       }
    ```

   | Схема факультативных претензий | Значение |
   |----------|-------------|
   | **Имя:** | Должно быть,"группы" |
   | **source:** | Не используется. Опускайте или укажите нулевую |
   | **Важное значение:** | Не используется. Опускайте или укажите ложные |
   | **additionalProperties:** | Список дополнительных свойств.  Действительные варианты: "sam_account_name", "dns_domain_and_sam_account_name", "netbios_domain_and_sam_account_name", "emit_as_roles" |

   В дополнительномсвойства храних требуются только один из "sam_account_name", "dns_domain_and_sam_account_name", "netbios_domain_and_sam_account_name".  Если присутствует более одного, используется первый, а остальные игнорируются.

   Некоторые приложения требуют групповой информации о пользователе в претензии роли.  Чтобы изменить тип претензии на из группы претензии на роль претензии, добавить "emit_as_roles" к дополнительным свойствам.  Значения группы будут испускаться в претензии роли.

   > [!NOTE]
   > Если используется "emit_as_roles" любые роли приложения, настроенные на назначенные пользователем, не отображаются в претензии роли

**Примеры:**

1) Группы эмитов как групповые имена в токенах доступа OAuth в формате dnsDomainName'sAMAccountName

    
    **Конфигурация uI:**

    [![Показывает, как настроить дополнительные претензии с помощью uI](./media/active-directory-optional-claims/groups-example-1.png)](./media/active-directory-optional-claims/groups-example-1.png)


    **Заявка манифест вступления:**
    ```json
        "optionalClaims": {
            "accessToken": [{
            "name": "groups",
            "additionalProperties": ["dns_domain_and_sam_account_name"]
            }]
        }
    ```

 
    
2) Имена групп Эмит, которые будут возвращены в формате netbiosDomain'sAMAccountName, как утверждают роли в ТОкенах SAML и OIDC ID

    **Конфигурация uI:**

    [![Показывает, как настроить дополнительные претензии с помощью uI](./media/active-directory-optional-claims/groups-example-2.png)](./media/active-directory-optional-claims/groups-example-2.png)

    **Заявка манифест вступления:**
    
    ```json
        "optionalClaims": {
        "saml2Token": [{
            "name": "groups",
            "additionalProperties": ["netbios_name_and_sam_account_name", "emit_as_roles"]
        }],
        "idToken": [{
            "name": "groups",
            "additionalProperties": ["netbios_name_and_sam_account_name", "emit_as_roles"]
        }]
    ``` 
     

## <a name="optional-claims-example"></a>Пример необязательного утверждения

В этом разделе можно пошагово выполнить сценарий, чтобы узнать, как можно использовать возможность необязательных утверждений для приложения.
Есть несколько доступных вариантов обновления свойств в конфигурации удостоверения приложения, позволяющих включить и настроить необязательные утверждения:
-    Можно использовать **конфигурацию token (предварительный просмотр)** uI (см. пример ниже)
-    Манифест можно **Manifest** использовать (см. пример ниже). Ознакомьтесь со статьей [Манифест приложения Azure Active Directory](https://docs.microsoft.com/azure/active-directory/develop/active-directory-application-manifest), чтобы получить общие сведения о манифесте.
-   Также можно написать приложение, используюв [е-ам-и. Microsoft Graph API](https://docs.microsoft.com/graph/use-the-api?context=graph%2Fapi%2F1.0&view=graph-rest-1.0) для обновления приложения. Тип [OptionalClaims](https://docs.microsoft.com/graph/api/resources/optionalclaims?view=graph-rest-1.0) в справочнике Microsoft Graph API может помочь вам с настройкой дополнительных утверждений.

**Пример:** В приведенном ниже примере вы будете использовать **конфигурацию token (предварительный просмотр)** UI и **Manifest** для добавления дополнительных требований к токенам доступа, идентификатора и SAML, предназначенным для вашего приложения. К каждому типу токена, который может получить приложение, будут добавлены различные дополнительные требования:
-    Теперь токены идентификации содержат имена участников-пользователей федеративных пользователей в полной форме (`<upn>_<homedomain>#EXT#@<resourcedomain>`).
-    Токены доступа, которые другие клиенты запрашивает для этого приложения, теперь будут включать в себя auth_time претензии
-    Токен SAML будет содержать расширение схемы каталога skypeId (в этом примере идентификатор этого приложения — ab603c56068041afb2f6832e2a17e237). Токен SAML представит идентификатор Skype как `extension_skypeId`.

**Конфигурация uI:**

1. Войти на [портал Azure](https://portal.azure.com)

1. После проверки подлинности выберите арендатора Azure AD, выбрав его из верхнего правого угла страницы.

1. Выберите **Active Directory Azure** из меню слева.

1. В разделе **Управление** выберите **регистрацию приложений.**

1. Найдите в списке приложение, для которого нужно настроить необязательные утверждения, и щелкните его.

1. Под разделом **«Управление»** щелкните **конфигурацию токенов (предварительный просмотр).**

1. Выберите **Добавить необязательный claim,** выберите тип маркера **ID,** выберите **upn** из списка претензий, а затем нажмите **Добавить.**

1. Выберите **Добавить необязательный claim,** выберите тип маркера **доступа,** выберите **auth_time** из списка претензий, а затем нажмите **Добавить.**

1. С экрана обзора конфигурации токенов нажмите на значок карандаша рядом с **upn,** нажмите **на внешний аутентифицированный** переключатель, а затем нажмите **Сохранить.**

1. Выберите **Добавить необязательный запрос,** выберите тип маркера **SAML,** выберите **extn.skypeID** из списка претензий (только если вы создали объект пользователя Azure AD под названием skypeID), а затем нажмите **Добавить.**

    [![Показывает, как настроить дополнительные претензии с помощью uI](./media/active-directory-optional-claims/token-config-example.png)](./media/active-directory-optional-claims/token-config-example.png)

**Манифест конфигурации:**
1. Войдите на [портал Azure](https://portal.azure.com).
1. После проверки подлинности выберите арендатора Azure AD, выбрав его из верхнего правого угла страницы.
1. Выберите **Active Directory Azure** из меню слева.
1. Найдите в списке приложение, для которого нужно настроить необязательные утверждения, и щелкните его.
1. Под разделом **Управление** щелкните **Manifest,** чтобы открыть вневочный редактор манифеста.
1. Можно напрямую изменить манифест с помощью этого редактора. Манифест следует за схемой для [сущности приложения](https://docs.microsoft.com/azure/active-directory/develop/reference-app-manifest)и автоматически форматирует манифест после сохранения. В свойство `OptionalClaims` будут добавлены новые элементы.

    ```json
            "optionalClaims": {
                "idToken": [ 
                     { 
                        "name": "upn", 
                        "essential": false, 
                        "additionalProperties": [ "include_externally_authenticated_upn"]  
                     }
                     ],
                "accessToken": [ 
                      {
                        "name": "auth_time", 
                        "essential": false
                      }
                     ],
            "saml2Token": [ 
                  { 
                    "name": "extension_ab603c56068041afb2f6832e2a17e237_skypeId",
                    "source": "user", 
                    "essential": true
                  }
                 ]
        ``` 


1. When you're finished updating the manifest, click **Save** to save the manifest.

## Next steps

Learn more about the standard claims provided by Azure AD.

- [ID tokens](id-tokens.md)
- [Access tokens](access-tokens.md)
