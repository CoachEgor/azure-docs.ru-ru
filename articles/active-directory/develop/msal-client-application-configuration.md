---
title: Конфигурация клиентских приложений (MSAL) Azure
titleSuffix: Microsoft identity platform
description: Узнайте о вариантах конфигурации для публичных клиентских и конфиденциальных клиентских приложений с помощью Библиотеки подлинности Майкрософт (MSAL).
services: active-directory
author: mmacy
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: conceptual
ms.workload: identity
ms.date: 09/27/2019
ms.author: marsma
ms.reviewer: saeeda
ms.custom: aaddev
ms.openlocfilehash: 0262d22ae00456ce06cb8efbf995f1a093b20043
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79262897"
---
# <a name="application-configuration-options"></a>Параметры конфигурации приложения

В коде вы инициализируете новое публичное или конфиденциальное клиентское приложение (или пользователь-агент MSAL.js) для проверки подлинности и приобретения токенов. При инициализации клиентского приложения в библиотеке подлинности Майкрософт (MSAL) можно установить несколько вариантов конфигурации. Эти варианты делятся на две группы:

- Варианты регистрации, в том числе:
    - [Орган](#authority) (состоящий из [экземпляра](#cloud-instance) поставщика идентификационных данных и входиной [аудитории](#application-audience) для приложения и, возможно, идентификатора клиента).
    - [Идентификатор клиента](#client-id).
    - [Перенаправить URI](#redirect-uri).
    - [Секрет клиента](#client-secret) (для конфиденциальных клиентских приложений).
- [Параметры регистрации,](#logging)включая уровень журнала, контроль личных данных и название компонента с помощью библиотеки.

## <a name="authority"></a>Authority

Власть — это URL-адрес, указывающий каталог, от которого MSAL может запрашивать токены. Общие органы власти:

- https\:\<//login.microsoftonline.com/\>арендатором/, где &lt;арендатором&gt; является идентификатор арендатора арендатора Azure Active Directory (Azure AD) или домен, связанный с этим арендатором Azure AD. Используется только для вху-на-айму пользователей определенной организации.
- https//login.microsoftonline.com/common/.\: Используется для регистрации пользователей с рабочими и школьными учетными записями или личными учетными записями Майкрософт.
- https//login.microsoftonline.com/organizations/.\: Используется для вху-на ввоза пользователей с рабочими и школьными учетными записями.
- https//login.microsoftonline.com/consumers/.\: Используется для вху-на-айм-пользователей с личными учетными записями Майкрософт (ранее известные как учетные записи Windows Live ID).

Настройка полномочий должна соответствовать заявленному на портале регистрации заявлений.

URL-адрес органа состоит из экземпляра и аудитории.

Орган может быть:
- Облачный облачный орган Azure AD.
- Орган Azure AD B2C. Смотрите [специфику B2C](https://github.com/AzureAD/microsoft-authentication-library-for-dotnet/wiki/AAD-B2C-specifics).
- Активный орган Федерации каталогов (AD FS). Смотрите [поддержку AD FS](https://aka.ms/msal-net-adfs-support).

Облачные органы Azure AD имеют две части:
- Экземпляр поставщика идентификационных *данных*
- Аудитория ввне *для* приложения

Экземпляр и аудитория могут быть совмещены и предоставлены в качестве URL-адреса органа. В версиях MSAL.NET раньше, чем MSAL 3. *x*, вы должны были составить авторитет самостоятельно, на основе облака вы хотели целевой и входе в аудиторию.  На этой диаграмме показано, как состоит URL-адрес органа:

![Как состоит URL-адрес органа](media/msal-client-application-configuration/authority.png)

## <a name="cloud-instance"></a>Облачный экземпляр

*Экземпляр* используется для указания того, подписывается ли приложение пользователей из общедоступного облака Azure или из национальных облаков. Используя MSAL в коде, можно настроить экземпляр облака Azure, используя перечисление или передавая URL [в национальный экземпляр облака](authentication-national-cloud.md#azure-ad-authentication-endpoints) в `Instance` качестве участника (если вы об этом знаете).

MSAL.NET будет бросать явное `Instance` `AzureCloudInstance` исключение, если оба и указаны.

Если вы не укажете экземпляр, приложение будет нацелено на экземпляр `https://login.onmicrosoftonline.com`общедоступного облака Azure (экземпляр URL).

## <a name="application-audience"></a>Аудитория приложения

Аудитория, вславав в систему, зависит от бизнес-потребностей вашего приложения:
- Если вы являетесь разработчиком бизнес-бизнеса (LOB), вы, вероятно, создасте приложение с одним арендатором, которое будет использоваться только в вашей организации. В этом случае необходимо указать организацию либо по идентификатору клиента (идентификатор экземпляра Azure AD), либо по доменному имени, связанному с экземпляром Azure AD.
- Если вы ISV, вы можете войти в пользователей с их работой и школьными учетными записями в любой организации или в некоторых организациях (приложение мультитенантов). Но вы также можете иметь пользователей войти в свои личные учетные записи Microsoft.

### <a name="how-to-specify-the-audience-in-your-codeconfiguration"></a>Как указать аудиторию в коде/конфигурации

Используя MSAL в коде, вы указываете аудиторию, используя одно из следующих значений:
- Перечисление аудитории органа Azure AD
- Идентификатор клиента, который может быть:
  - GUID (идентификатор экземпляра Azure AD) для приложений с одним арендатором
  - Доменное имя, связанное с экземпляром Azure AD (также для приложений с одним арендатором)
- Один из этих заполнителей в качестве идентификатора арендатора вместо перечисления аудитории органа Azure AD:
    - `organizations`для мультитенантного приложения
    - `consumers`войти в пользователей только с их личными счетами
    - `common`войти в число пользователей с их рабочими и школьными учетными записями или их личными учетными записями Майкрософт

MSAL создаст значимое исключение, если указать как аудиторию органа Azure AD, так и идентификатор клиента.

Если вы не указали аудиторию, ваше приложение будет ориентироваться на AD-версии Azure и личные учетные записи Майкрософт в качестве аудитории. (То есть, он будет `common` вести себя так, как будто были указаны.)

### <a name="effective-audience"></a>Эффективная аудитория

Эффективная аудитория приложения будет минимальной (если есть перекресток) аудитории, установленной в приложении, и аудитории, указанной в регистрации приложения. На самом деле, опыт [регистрации приложений](https://aka.ms/appregistrations) позволяет указать аудиторию (поддерживаемые типы учетных записей) для приложения. Для получения дополнительной информации [см.](quickstart-register-app.md)

В настоящее время единственный способ получить приложение для регистрации в пользователях только с личными учетными записями Microsoft является настройка обоих этих параметров:
- Установите аудиторию `Work and school accounts and personal accounts`регистрации приложения.
- Установите аудиторию в коде/конфигурации `AadAuthorityAudience.PersonalMicrosoftAccount` (или `TenantID` «потребителей»).

## <a name="client-id"></a>Идентификатор клиента

Идентификатор клиента — это идентификатор уникального приложения (клиента), присвоенный вашему приложению Azure AD при регистрации приложения.

## <a name="redirect-uri"></a>URI перенаправления

Перенаправление URI — это URI, к который поставщик идентификационных данных отправит токены безопасности обратно.

### <a name="redirect-uri-for-public-client-apps"></a>Перенаправить URI для приложений для публичных клиентов

Если вы являетесь разработчиком приложений для публичных клиентов, использующим MSAL:
- Вы хотите использовать `.WithDefaultRedirectUri()` в настольных или UWP приложений (MSAL.NET 4,1 "). Этот метод установит перенаправление свойства ури-ури общедоступного клиента на рекомендованное по умолчанию приложение для публичных клиентских приложений. 

  Платформа  | URI перенаправления  
  ---------  | --------------
  Настольное приложение (.NET FW) | `https://login.microsoftonline.com/common/oauth2/nativeclient` 
  UWP | значение `WebAuthenticationBroker.GetCurrentApplicationCallbackUri()`. Это позволяет SSO с браузером, установив значение в результате WebAuthenticationBroker.GetCurrentApplicationCallbackUri (), который вам нужно зарегистрировать
  .NET Core | `https://localhost`. Это позволяет пользователю использовать системный браузер для интерактивной аутентификации, так как в настоящее время у .NET Core нет пользовательского интерфейса для встроенного веб-представления.

- Вам не нужно добавлять перенаправление URI, если вы строите Xamarin Android и iOS приложение, которое не `msal{ClientId}://auth` поддерживает брокера (перенаправление URI автоматически устанавливается для Xamarin Android и iOS

- Вам нужно настроить перенаправление URI в [регистрации приложений:](https://aka.ms/appregistrations)

   ![Перенаправить URI в регистрации приложений](media/msal-client-application-configuration/redirect-uri.png)

Вы можете перенаправить URI с `RedirectUri` помощью свойства (например, если вы используете брокеров). Вот несколько примеров перенаправления URIs для этого сценария:

- `RedirectUriOnAndroid`"msauth-5a434691-ccb2-4fd1-b97b-b64bcfbc03fc://com.microsoft.identity.client.sample";
- `RedirectUriOnIos`$ "мсаут. «Bundle.ID»://auth»;

Для получения дополнительной информации о iOS с [MSAL.NET ADAL.NETм.](msal-net-migration-ios-broker.md) [Leveraging the broker on iOS](https://github.com/AzureAD/microsoft-authentication-library-for-dotnet/wiki/Leveraging-the-broker-on-iOS)
Для получения дополнительных деталей Android, [см.](brokered-auth.md)

### <a name="redirect-uri-for-confidential-client-apps"></a>Перенаправить URI для конфиденциальных клиентских приложений

Для веб-приложений перенаправление URI (или ответ URI) — это URI, который Azure AD будет использовать для отправки токена обратно в приложение. Это URI может быть URL веб-приложения / Web API, если конфиденциальное приложение является одним из них. Перенаправление URI должно быть зарегистрировано в регистрации приложения. Эта регистрация особенно важна при развертывании приложения, которое изначально тестировалось локально. Затем необходимо добавить URL-адрес ответа развернутого приложения на портале регистрации приложений.

Для приложений daemon не нужно указывать перенаправление URI.

## <a name="client-secret"></a>Секрет клиента

Этот параметр определяет секрет клиента для конфиденциального клиентского приложения. Этот секрет (пароль приложения) предоставляется порталом регистрации приложений или предоставляется Azure AD во время регистрации приложений в PowerShell AzureAD, PowerShell AzureRM или Azure CLI.

## <a name="logging"></a>Ведение журнала

Другие параметры конфигурации позволяют регистрать и устранять неполадки. Подробнее о том, как их использовать, читайте в статье [журнала logging.](msal-logging.md)

## <a name="next-steps"></a>Дальнейшие действия

Узнайте о [мгновенном использовании клиентских приложений с помощью MSAL.NET.](msal-net-initializing-client-applications.md)
Узнайте о [мгновенном клиентских приложениях с помощью MSAL.js](msal-js-initializing-client-applications.md).
