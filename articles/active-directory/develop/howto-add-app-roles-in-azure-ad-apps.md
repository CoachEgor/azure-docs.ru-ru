---
title: Добавление ролей приложения и получение их из токена | Azure
titleSuffix: Microsoft identity platform
description: Узнайте, как добавлять роли приложения в приложение, зарегистрированное в Azure Active Directory, назначать эти роли пользователям и группам и получать их в утверждении "roles" в токене.
services: active-directory
author: kalyankrishna1
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.workload: identity
ms.topic: how-to
ms.date: 09/15/2020
ms.author: kkrishna
ms.reviewer: kkrishna, jmprieur
ms.custom: aaddev
ms.openlocfilehash: 02fe3c1ebc893dea259abcda3ea1d13ab96d68d5
ms.sourcegitcommit: 7374b41bb1469f2e3ef119ffaf735f03f5fad484
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2020
ms.locfileid: "90706019"
---
# <a name="how-to-add-app-roles-in-your-application-and-receive-them-in-the-token"></a>Руководство. Добавление ролей приложения в приложение, зарегистрированное в Azure Active Directory, и их получение в токене

Управление доступом на основе ролей (RBAC) — это популярный механизм для принудительного применения авторизации в приложениях. При использовании RBAC администратор предоставляет разрешения ролям, а не отдельным пользователям или группам. Затем администратор может назначить роли для различных пользователей и групп, чтобы контролировать доступ к соответствующему содержимому и функциональным возможностям.

С помощью RBAC с ролями приложений и утверждениями ролей разработчики могут безопасно применять авторизацию в своих приложениях с меньшими усилиями.

Другой подход заключается в использовании групп и утверждений групп Azure AD, как показано в примере кода [webapp-граупклаимс-DotNet](https://github.com/Azure-Samples/WebApp-GroupClaims-DotNet) на GitHub. Группы Azure AD и роли приложений не являются взаимоисключающими. их можно использовать совместно, чтобы обеспечить еще более детализированную контроль доступа.

## <a name="declare-roles-for-an-application"></a>Объявление ролей для приложения

Роли приложения определяются в [портал Azure](https://portal.azure.com).  Когда пользователь входит в приложение, Azure AD выдает утверждение `roles` для каждой отдельной роли пользователя и ролей, имеющихся у него как у члена группы.  Назначение пользователей и групп ролям можно выполнить через пользовательский интерфейс на портале или программным путем, используя [Microsoft Graph](/graph/azuread-identity-access-management-concept-overview).

Чтобы создать роль приложения, сделайте следующее:

1. Войдите на [портал Azure](https://portal.azure.com).
1. Выберите фильтр **каталог и подписка** в верхнем меню, а затем выберите клиент Azure Active Directory, содержащий регистрацию приложения, в которую нужно добавить роль приложения.
1. Найдите и выберите **Azure Active Directory**.
1. В разделе **Управление**выберите **Регистрация приложений**, а затем выберите приложение, в котором нужно определить роли приложения.
1. Выбор **ролей приложения | Предварительная версия**, а затем выберите **создать роль приложения**.

   :::image type="content" source="media/howto-add-app-roles-in-azure-ad-apps/app-roles-overview-pane.png" alt-text="Область роли приложения регистрации приложения в портал Azure":::
1. В области **Создание роли приложения** введите параметры роли. В таблице, следующей за изображением, описывается каждый параметр и их параметры.

    :::image type="content" source="media/howto-add-app-roles-in-azure-ad-apps/app-roles-create-context-pane.png" alt-text="Область контекста создания ролей приложения регистрации приложения в портал Azure":::

    | Поле | Описание | Пример |
    |-------|-------------|---------|
    | **Отображаемое имя** | Отображаемое имя роли приложения, которое отображается в интерфейсе согласия администратора и назначения приложения. Это значение может содержать пробелы.  | `Survey Writer` |
    | **Разрешенные типы элементов** | Указывает, может ли эта роль приложения назначаться пользователям, приложениям или обоим. | `Users/Groups` |
    | **Значение** | Указывает значение утверждения ролей, ожидаемое приложением в токене. Значение должно точно совпадать со строкой, на которую ссылается код приложения. Значение не может содержать пробелы. | `Survey.Create` |
    | **Описание** | Более подробное описание роли приложения, отображаемое во время назначения и согласия приложения администратора. | `Writers can create surveys.` |
    | **Вы хотите включить эту роль приложения?** | Включена ли роль приложения. Чтобы удалить роль приложения, снимите этот флажок и примените изменения, прежде чем пытаться выполнить операцию удаления. | *Флажок установлен* |

1. Щелкните **Применить**, чтобы сохранить изменения.

> [!NOTE]
> Число добавляемых ролей учитывает ограничения, определенные для манифеста приложения. Дополнительные сведения об этих ограничениях см. в разделе  [ограничения манифеста](./reference-app-manifest.md#manifest-limits) в [справочнике по Azure Active Directory манифесте приложения](reference-app-manifest.md).

## <a name="assign-users-and-groups-to-roles"></a>Назначение ролей для пользователей и групп

После добавления ролей приложений в приложение можно назначить роли пользователям и группам.

1. В **Azure Active Directory** в портал Azure выберите **корпоративные приложения** в меню навигации слева.
1. Щелкните **Все приложения**, чтобы просмотреть полный список приложений.

     Если приложение не отображается в списке, используйте фильтры в верхней части списка **все приложения** , чтобы ограничить список, или прокрутите список вниз, чтобы выбрать приложение.

1. Выберите приложение, в котором для ролей необходимо назначить пользователей или группы безопасности.
1. В разделе **Управление** выберите **Пользователи и группы**.
1. Щелкните **Добавить пользователя** , чтобы открыть область **добавить назначение** .
1. В области **Добавление назначения** щелкните **Пользователи и группы**.

     Отобразится список пользователей и групп безопасности. Можно выполнить поиск определенного пользователя или группы, а также выбрать несколько пользователей и групп, которые отображаются в списке.

1. Выбрав пользователей и группы, нажмите кнопку **выбрать** для продолжения.
1. На панели **Добавление назначения** выберите **выбрать роль** . Отобразятся все роли, определенные для приложения.
1. Выберите роль и нажмите кнопку **выбрать** .
1. Нажмите кнопку **назначить** , чтобы завершить назначение пользователей и групп приложению.
1. Убедитесь, что добавленные пользователи и группы отображаются в списке **Пользователи и группы** .

## <a name="receive-roles-in-tokens"></a>Получение ролей в токенах

Когда пользователи, назначенные различным ролям приложений, входят в приложение, их маркеры будут иметь назначенные им роли в `roles` утверждении.

## <a name="web-api-application-permissions"></a>Разрешения приложения веб-API

Можно определить роли приложений, предназначенные для **пользователей или групп**, **приложений**или **и**того, и другого. При выборе **приложения** или **обоих**приложений роль приложения отображается как разрешение приложения в **разрешениях API**клиентского приложения.

Чтобы выбрать разрешение приложения в регистрации клиентского приложения после определения роли, предназначенной для **приложений** или и того, и **другого**:

1. В **Azure Active Directory** в портал Azure выберите **Регистрация приложений**, а затем щелкните регистрацию клиентского приложения.
1. В разделе **Управление** выберите **Разрешения API**.
1. Выберите **Добавить разрешение**  >  **Мои интерфейсы API**.
1. Выберите приложение, к которому вы добавили роль приложения, а затем щелкните **разрешения приложения**.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о ролях приложений см. в следующих ресурсах:

- Пример кода. [Добавление авторизации с помощью ролей приложения & утверждения ролей в веб-приложение ASP.NET Core](https://github.com/Azure-Samples/active-directory-aspnetcore-webapp-openidconnect-v2/tree/master/5-WebApp-AuthZ/5-1-Roles) (GitHub)
- Видео. [Реализация авторизации в приложениях с помощью платформы Microsoft Identity Platform ](https://www.youtube.com/watch?v=LRoc-na27l0) (1:01:15)
- [Манифест приложения Azure Active Directory](./reference-app-manifest.md)
- [Маркеры доступа Azure AD](access-tokens.md)
- [Azure AD `id_tokens`](id-tokens.md)
