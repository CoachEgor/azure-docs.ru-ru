---
title: Краткое руководство. Настройка приложения для предоставления веб-API | Azure
titleSuffix: Microsoft identity platform
description: В этом кратком руководстве содержатся сведения о настройке приложения для доступа к новому разрешению или области и роли, чтобы сделать приложение доступным для клиентских приложений.
services: active-directory
author: rwike77
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: quickstart
ms.workload: identity
ms.date: 08/05/2020
ms.author: ryanwi
ms.custom: aaddev
ms.reviewer: aragra, lenalepa, sureshja
ms.openlocfilehash: 93b0c3392a32a6ff18a285d34fdaede6ceea6528
ms.sourcegitcommit: 2ff0d073607bc746ffc638a84bb026d1705e543e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/06/2020
ms.locfileid: "87830297"
---
# <a name="quickstart-configure-an-application-to-expose-a-web-api"></a>Краткое руководство. Настройка приложения для предоставления веб-API

Вы можете разработать веб-API и сделать его доступным для клиентских приложений, предоставив [разрешения или области](developer-glossary.md#scopes) и [роли](developer-glossary.md#roles). Доступ к правильно настроенному веб-API предоставляется по аналогии с другими веб-API корпорации Майкрософт, включая API Graph и API Office 365.

В этом кратком руководстве вы узнаете, как настроить приложение для доступа к новой области, чтобы сделать его доступным для клиентских приложений.

## <a name="prerequisites"></a>Предварительные требования

* Учетная запись Azure с активной подпиской. [Создайте учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F) бесплатно.
* Завершение [краткого руководства Регистрация приложения с помощью платформы удостоверений Майкрософт](quickstart-register-app.md)

## <a name="sign-in-to-the-azure-portal-and-select-the-app"></a>Войдите на портал Azure и выберите приложение.

Чтобы настроить приложение, выполните следующие действия.

1. Войдите на [портал Azure](https://portal.azure.com) с помощью личной учетной записи Майкрософт либо рабочей или учебной учетной записи.
1. Если учетная запись предоставляет доступ нескольким клиентам, выберите свою учетную запись в правом верхнем углу и нужный клиент Azure AD для этого сеанса портала.
1. В области навигации слева выберите службу **Azure Active Directory**, а затем выберите **Регистрация приложений**.
1. Найдите и выберите приложение, которое нужно настроить. После выбора приложения появится страница **Обзор** приложения или главная страница регистрации.
1. Выберите, какой метод вы хотите использовать для предоставления новой области (пользовательский интерфейс или манифест приложения):
    * [Предоставление новой области через пользовательский интерфейс](#expose-a-new-scope-through-the-ui)
    * [Предоставление новой области или роли с помощью манифеста приложения](#expose-a-new-scope-or-role-through-the-application-manifest)

## <a name="expose-a-new-scope-through-the-ui"></a>Предоставление новой области через пользовательский интерфейс

[![Показано, как предоставить доступ к API с помощью пользовательского интерфейса](./media/quickstart-update-azure-ad-app-preview/expose-api-through-ui-expanded.png)](./media/quickstart-update-azure-ad-app-preview/expose-api-through-ui-expanded.png#lightbox)

Для предоставления новой области через пользовательский интерфейс:

1. На странице **Обзор** выберите раздел **Предоставление API**.

1. Нажмите **Добавить группу**.

1. Если вы не задали **URI идентификатора приложения**, то увидите запрос на его ввод. Введите URI идентификатора приложения или используйте предоставленный, а затем выберите **Сохранить и продолжить**.

1. Когда откроется страница **Добавить группу**, введите сведения данной области:

    | Поле | Описание |
    |-------|-------------|
    | **Имя области** | Введите понятное имя для области.<br><br>Например, `Employees.Read.All`. |
    | **Кто может давать согласие** | Выберите, могут ли пользователи предоставлять согласие этой области или требуется согласие администратора. Выберите **Admins only** (Только администраторы) для более высокого уровня разрешений. |
    | **Отображаемое имя согласия администратора** | Введите понятное описание области, которое увидят администраторы.<br><br>Например `Read-only access to Employee records`. |
    | **Описание согласия администратора** | Введите понятное описание области, которое увидят администраторы.<br><br>Например `Allow the application to have read-only access to all Employee data.`. |

    Если пользователи могут предоставлять согласие для области, также добавьте значения для следующих полей:

    | Поле | Описание |
    |-------|-------------|
    | **Отображаемое имя согласия пользователя** | Введите понятное имя для области, которое увидят пользователи.<br><br>Например `Read-only access to your Employee records`. |
    | **Описание согласия пользователя** | Введите понятное описание области, которое увидят пользователи.<br><br>Например `Allow the application to have read-only access to your Employee data.`. |

1. Задайте **Состояние** и выберите **Добавить область** после завершения.

1. (Необязательно.) Чтобы отключить запрос согласия пользователей вашего приложения к определенным областям, можно выполнить предварительную авторизацию клиентского приложения для доступа к веб-API. Необходимо выполнить предварительную авторизацию *только* тех клиентских приложений, которым вы доверяете, так как у пользователей не будет возможности отклонить согласие.
    1. В разделе **Авторизованные клиентские приложения** выберите **Добавить клиентское приложение**.
    1. Введите **идентификатор приложения (клиента)** , для которого хотите выполнить предварительную авторизацию. Например веб-приложение, которое вы зарегистрировали ранее.
    1. В разделе **Авторизованные области** выберите области, для которых необходимо отключить запрос согласия, а затем щелкните **Добавить приложение**.

    Клиентское приложение теперь является предварительно авторизованным (PCA), и пользователи не получат запрос на согласие при выполнении входа.

1. Выполните действия, чтобы [проверить доступность веб-API другим приложениям](#verify-the-web-api-is-exposed-to-other-applications).

## <a name="expose-a-new-scope-or-role-through-the-application-manifest"></a>Предоставление новой области или роли с помощью манифеста приложения

Манифест приложения является механизмом обновления сущности приложения, который определяет атрибуты регистрации приложения Azure AD.

[![Предоставление новой области с помощью коллекции oauth2Permissions в манифесте](./media/quickstart-update-azure-ad-app-preview/expose-new-scope-through-app-manifest-expanded.png)](./media/quickstart-update-azure-ad-app-preview/expose-new-scope-through-app-manifest-expanded.png#lightbox)

Чтобы предоставить новую область, изменив манифест приложения, выполните следующие действия.

1. На странице **Обзор** выберите раздел **Манифест**. Откроется веб-редактор манифеста, который позволяет **изменить** манифест на портале. При необходимости можно выбрать **Скачать** и изменить манифест локально, а затем повторно применить его для приложения с помощью команды **Отправить**.

    В следующем примере показано предоставление новой области с именем `Employees.Read.All` в ресурсе или API путем добавления следующего элемента JSON в коллекцию `oauth2Permissions`.

    Создайте значение `id` программно или с помощью инструмента создания GUID, например [guidgen](https://www.microsoft.com/download/details.aspx?id=55984).

      ```json
      {
        "adminConsentDescription": "Allow the application to have read-only access to all Employee data.",
        "adminConsentDisplayName": "Read-only access to Employee records",
        "id": "2b351394-d7a7-4a84-841e-08a6a17e4cb8",
        "isEnabled": true,
        "type": "User",
        "userConsentDescription": "Allow the application to have read-only access to your Employee data.",
        "userConsentDisplayName": "Read-only access to your Employee records",
        "value": "Employees.Read.All"
      }
      ```

1. По завершении щелкните **Сохранить**. Теперь веб-интерфейс API настроен для использования другими приложениями в каталоге.
1. Выполните действия, чтобы [проверить доступность веб-API другим приложениям](#verify-the-web-api-is-exposed-to-other-applications).

Дополнительные сведения см. в разделе, посвященном сущности приложения и ее схеме (в [справочной документации по типу ресурса application для API Graph][ms-graph-application]).

Дополнительные сведения о манифесте приложения, а также ссылке на его схему, см. в статье [Манифест приложения Azure Active Directory](reference-app-manifest.md).

## <a name="verify-the-web-api-is-exposed-to-other-applications"></a>Проверка доступности веб-API другим приложениям

1. Вернитесь к клиенту Azure AD, выберите **Регистрация приложений**, а затем найдите и щелкните клиентское приложение, которое необходимо настроить.
1. Повторите шаги, как описано в статье [Краткое руководство: настройка клиентского приложения для доступа к веб-API (предварительная версия)](quickstart-configure-app-access-web-apis.md).
1. На шаге [Выбор API](quickstart-configure-app-access-web-apis.md#add-permissions-to-access-web-apis) выберите ресурс (регистрация приложения веб-API).
    * Если вы создали регистрацию приложения веб-API с помощью портала Azure, ваш ресурс API появится на вкладке **Мои API**.
    * Если вы разрешили Visual Studio выполнять регистрацию приложения веб-API во время создания проекта, ваш ресурс API будет указан на вкладке **Интерфейсы API, используемые моей организацией**.

После выбора ресурса веб-API отобразится новая область, доступная для запросов разрешений клиента.

## <a name="using-the-exposed-scopes"></a>Использование предоставленных областей

Когда клиент соответствующим образом настроен и имеет разрешения на доступ к веб-API, Azure AD может выдать маркер доступа OAuth 2.0. Во время вызова веб-API клиент предоставляет маркер доступа с утверждением области (`scp`), для которого заданы разрешения, запрашиваемые в его регистрации приложения.

Позднее вы можете по мере необходимости предоставлять дополнительные области доступа. Помните о том, что веб-API может предоставлять несколько областей, связанных с множеством разных функций. Ресурс может управлять доступом к веб-API в среде выполнения, вычисляя утверждения области (`scp`) в полученном маркере доступа OAuth 2.0.

В приложениях полным значением области является объединение **URI идентификатора приложения** (ресурса) веб-API и **имени области**.

Например, если URI идентификатора приложения веб-API является `https://contoso.com/api`, а именем области — `Employees.Read.All`, полная область будет выглядеть так:

`https://contoso.com/api/Employees.Read.All`

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы предоставили свой веб-API, настроив его области, выполните настройку регистрации клиентского приложения с разрешением на доступ к этим областям.

> [!div class="nextstepaction"]
> [Краткое руководство. Настройка клиентского приложения для доступа к веб-API](quickstart-configure-app-access-web-apis.md)

<!-- REF LINKS -->
[ms-graph-application]: /graph/api/resources/application
