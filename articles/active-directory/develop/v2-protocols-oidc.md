---
title: Протокол OpenID Connect Connect — платформа Microsoft Identity | Службы
description: Создавайте веб-приложения, используя реализацию платформы идентификации Майкрософт протокола проверки подлинности OpenID Connect Connect.
services: active-directory
documentationcenter: ''
author: rwike77
manager: CelesteDG
editor: ''
ms.assetid: a4875997-3aac-4e4c-b7fe-2b4b829151ce
ms.service: active-directory
ms.subservice: develop
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 04/12/2019
ms.author: ryanwi
ms.reviewer: hirsin
ms.custom: aaddev, identityplatformtop40
ms.openlocfilehash: 97f05afadf38063a58e15e16cbf2e2c3d3e781ca
ms.sourcegitcommit: af6847f555841e838f245ff92c38ae512261426a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2020
ms.locfileid: "76700266"
---
# <a name="microsoft-identity-platform-and-openid-connect-protocol"></a>Платформа Microsoft Identity и протокол OpenID Connect Connect

OpenID Connect — это протокол аутентификации на основе OAuth 2.0, который можно использовать для безопасного входа пользователей в веб-приложение. При использовании реализации OpenID Connect Connect конечной точки платформы Microsoft Identity вы можете добавить доступ для входа и API в веб-приложения. Это руководство не зависит от языка и описывает, как отправлять и получать сообщения HTTP, не используя ни одну из библиотек с открытым кодом корпорации Майкрософт.

> [!NOTE]
> Конечная точка платформы идентификации Майкрософт не поддерживает все сценарии и функции Azure Active Directory (Azure AD). Чтобы определить, следует ли использовать конечную точку платформы идентификации Майкрософт, ознакомьтесь с [ограничениями платформы удостоверений Майкрософт](active-directory-v2-limitations.md).

[OpenID Connect](https://openid.net/specs/openid-connect-core-1_0.html) расширяет возможности протокола *авторизации* OAuth 2.0 и позволяет использовать его в качестве протокола *аутентификации*, что дает возможность выполнять единый вход с помощью OAuth. В OpenID Connect вводится понятие *маркера идентификации*, который представляет собой маркер безопасности, позволяющий клиенту проверять личность пользователя. Маркер идентификации также позволяет получить базовые сведения о профиле пользователя. Так как OpenID Connect является расширением протокола OAuth 2.0, приложения могут безопасно получать *маркеры доступа*, с помощью которых можно получить доступ к ресурсам, защищенным [сервером авторизации](active-directory-v2-protocols.md#the-basics). Конечная точка платформы идентификации Майкрософт также позволяет приложениям сторонних производителей, зарегистрированным в Azure AD, выдавать маркеры доступа для защищенных ресурсов, таких как веб-API. Дополнительные сведения о настройке приложения для выпуска маркеров доступа см. в [статье регистрация приложения с помощью конечной точки платформы Microsoft Identity](quickstart-register-app.md). Мы рекомендуем использовать OpenID Connect для [веб-приложений](v2-app-types.md#web-apps), которые размещаются на сервере и доступны через браузер.

## <a name="protocol-diagram-sign-in"></a>Схема протокола: вход в систему

На следующей схеме показаны этапы самого простого потока входа. Каждый этап подробно описан в этой статье.

![Протокол OpenID Connect: вход в систему](./media/v2-protocols-oidc/convergence-scenarios-webapp.svg)

## <a name="fetch-the-openid-connect-metadata-document"></a>Получение документа метаданных OpenID Connect

OpenID Connect Connect описывает документ метаданных, который содержит большую часть информации, необходимой приложению для входа в систему. Сюда входят такие сведения, как используемые URL-адреса и расположение открытых ключей подписывания службы. Для конечной точки платформы идентификации Майкрософт это документ метаданных OpenID Connect Connect, который следует использовать:

```
https://login.microsoftonline.com/{tenant}/v2.0/.well-known/openid-configuration
```
> [!TIP]
> Тестирование Щелкните [https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration](https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration) для просмотра конфигурации клиентов `common`.

`{tenant}` может принимать одно из четырех значений.

| Значение | Description |
| --- | --- |
| `common` |Пользователи с личными учетная запись Майкрософт, а также с рабочей или учебной учетной записью Azure AD могут войти в приложение. |
| `organizations` |Вход в приложение могут выполнять только пользователи с рабочими или учебными учетными записями Azure AD. |
| `consumers` |Вход в приложение могут выполнять только пользователи с личной учетной записью Майкрософт. |
| `8eaef023-2b34-4da1-9baa-8bc8c9d6a490` либо `contoso.onmicrosoft.com` | Только пользователи из определенного клиента Azure AD (будь то участники в каталоге с рабочей или учебной учетной записью или гости в каталоге с личными учетная запись Майкрософт) могут войти в приложение. Можно использовать понятное доменное имя клиента Azure AD или идентификатор GUID клиента. Можно также использовать клиент-потребитель `9188040d-6c67-4c5b-b112-36a304b66dad`вместо клиента `consumers`.  |

Метаданные — это простой документ JSON. В качестве примера ниже приведен фрагмент кода. Его содержимое полностью описано в [спецификации OpenID Connect](https://openid.net/specs/openid-connect-discovery-1_0.html#rfc.section.4.2).

```
{
  "authorization_endpoint": "https:\/\/login.microsoftonline.com\/{tenant}\/oauth2\/v2.0\/authorize",
  "token_endpoint": "https:\/\/login.microsoftonline.com\/{tenant}\/oauth2\/v2.0\/token",
  "token_endpoint_auth_methods_supported": [
    "client_secret_post",
    "private_key_jwt"
  ],
  "jwks_uri": "https:\/\/login.microsoftonline.com\/{tenant}\/discovery\/v2.0\/keys",

  ...

}
```

Если в приложении есть пользовательские ключи подписывания в результате использования функции [сопоставления утверждений](active-directory-claims-mapping.md) , необходимо добавить `appid` параметр запроса, содержащий идентификатор приложения, чтобы получить `jwks_uri`, указывающую на сведения о ключе подписывания приложения. Например: `https://login.microsoftonline.com/{tenant}/.well-known/v2.0/openid-configuration?appid=6731de76-14a6-49ae-97bc-6eba6914391e` содержит `jwks_uri` `https://login.microsoftonline.com/{tenant}/discovery/v2.0/keys?appid=6731de76-14a6-49ae-97bc-6eba6914391e`.

Как правило, этот документ метаданных используется для настройки библиотеки OpenID Connect или пакета SDK. Метаданные будут использоваться для работы библиотеки. Однако если вы не используете предварительно созданную библиотеку OpenID Connect Connect, вы можете выполнить действия, описанные в оставшейся части этой статьи, чтобы выполнить вход в веб-приложение с помощью конечной точки платформы Microsoft Identity.

## <a name="send-the-sign-in-request"></a>Отправка запроса на вход

Если веб-приложению требуется проверить подлинность пользователя, оно может направить его к конечной точке `/authorize` . Этот запрос похож на первый этап [потока кода авторизации OAuth 2.0](v2-oauth2-auth-code-flow.md) с несколькими важными различиями, которые приведены ниже.

* Запрос должен содержать область `openid` в параметре `scope`.
* Параметр `response_type` должен включать `id_token`.
* Запрос должен содержать параметр `nonce` .

> [!IMPORTANT]
> Для успешного запроса маркера идентификации из конечной точки/аусоризатион на вкладке "Проверка подлинности" для регистрации приложения на [портале регистрации](https://portal.azure.com) должно быть указано неявное предоставление id_tokens. для установки флага `oauth2AllowIdTokenImplicitFlow` в [манифесте приложения](reference-app-manifest.md) на `true`). Если он не включен, будет возвращена ошибка `unsupported_response`: "указанное значение входного параметра" response_type "недопустимо для этого клиента. Expected value is 'code'" (Указанное значение параметра response_type запрещено для данного клиента. Ожидаемое значение: code).

Пример.

```
// Line breaks are for legibility only.

GET https://login.microsoftonline.com/{tenant}/oauth2/v2.0/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&response_type=id_token
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&response_mode=form_post
&scope=openid
&state=12345
&nonce=678910
```

> [!TIP]
> Чтобы выполнить этот запрос, щелкните приведенную ниже ссылку. После входа в систему в браузере будет выполнен переход по адресу `https://localhost/myapp/` с указанием маркера идентификации в адресной строке. Обратите внимание, что в этом запросе используется `response_mode=fragment` (исключительно в демонстрационных целях). Мы рекомендуем использовать `response_mode=form_post`.
> <a href="https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&response_type=id_token&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F&scope=openid&response_mode=fragment&state=12345&nonce=678910" target="_blank">https://login.microsoftonline.com/common/oauth2/v2.0/authorize...</a>;

| Параметр | Условие | Description |
| --- | --- | --- |
| `tenant` | Обязательно для заполнения | Значение `{tenant}` в пути запроса можно использовать для того, чтобы контролировать вход пользователей в приложение. Допустимые значения: `common`, `organizations`, `consumers`, а также идентификаторы клиента. Чтобы узнать больше, ознакомьтесь с [основами протокола](active-directory-v2-protocols.md#endpoints). |
| `client_id` | Обязательно для заполнения | **Идентификатор приложения (клиента)** , который [портал Azure — регистрация приложений](https://go.microsoft.com/fwlink/?linkid=2083908) , назначенный приложению. |
| `response_type` | Обязательно для заполнения | Должен включать `id_token` для входа в OpenID Connect. Кроме того, может включать другие значения `response_type`, например `code`. |
| `redirect_uri` | Рекомендуется | Универсальный код ресурса (URI) перенаправления приложения, на который можно отправлять ответы аутентификации для их получения приложением. Он должен в точности соответствовать одному из универсальных кодов ресурсов (URI) перенаправления, зарегистрированных на портале, но иметь форму URL-адреса. Если он отсутствует, конечная точка будет выбирать один зарегистрированный redirect_uri случайным образом, чтобы отправить пользователю обратно. |
| `scope` | Обязательно для заполнения | Список областей с разделителями-пробелами. При использовании протокола OpenID Connect он должен содержать область `openid`, что преобразуется в разрешение "Вход" в пользовательском интерфейсе предоставления согласия. Для предоставления согласия этот запрос может также включать в себя другие области. |
| `nonce` | Обязательно для заполнения | Значение, включенное в запрос и созданное приложением, которое будет добавлено в полученное значение id_token в качестве утверждения. Приложение может проверить это значение во избежание атак с использованием воспроизведения маркера. Как правило, это значение представляет собой случайную уникальную строку, которую можно использовать для определения источника запроса. |
| `response_mode` | Рекомендуется | Указывает метод, с помощью которого следует отправлять полученный код авторизации приложению. Может иметь значение `form_post` или `fragment`. Для веб-приложений рекомендуется использовать `response_mode=form_post`, чтобы обеспечить наиболее безопасную передачу маркеров в приложение. |
| `state` | Рекомендуется | Значение, включенное в запрос, которое также возвращается в ответе маркера. Это может быть строка любого содержания. Как правило, с целью [предотвращения подделки межсайтовых запросов](https://tools.ietf.org/html/rfc6749#section-10.12) используется генерируемое случайным образом уникальное значение. Параметр state используется также для кодирования сведений о состоянии пользователя в приложении перед созданием запроса на аутентификацию, например сведений об открытой на тот момент странице или представлении. |
| `prompt` | Необязательно | Указывает требуемый тип взаимодействия с пользователем. На текущий момент единственные допустимые значения — `login`, `none` и `consent`. Утверждение `prompt=login` требует от пользователя ввести учетные данные по запросу. Единый вход не сработает. Утверждение `prompt=none` является противоположным. Это утверждение гарантирует, что пользователь не будет представлен в интерактивной командной строке. Если запрос не может быть выполнен автоматически с помощью единого входа, конечная точка платформы идентификации Майкрософт возвращает ошибку. Утверждение `prompt=consent` активирует диалоговое окно предоставления согласия OAuth после входа пользователя в систему. В нем у пользователя запрашиваются разрешения для приложения. |
| `login_hint` | Необязательно | Этот параметр можно применять для предварительного заполнения полей имени пользователя и электронного адреса на странице входа пользователя (если имя пользователя известно заранее). Зачастую этот параметр используется в приложениях при повторной аутентификации. При этом имя пользователя, указанное во время предыдущего входа, извлекается с помощью утверждения `preferred_username`. |
| `domain_hint` | Необязательно | Область пользователя в Федеративной папке.  Это пропускает процесс обнаружения на основе электронной почты, который пользователь проходит на странице входа, что упрощает работу с пользователем. Для клиентов, Федеративных через локальный каталог, например AD FS, это часто приводит к неэффективному входу в систему из-за существующего сеанса. |

На текущем этапе пользователю предлагается ввести учетные данные и завершить аутентификацию. Конечная точка платформы идентификации Майкрософт проверяет, что пользователь предоставил разрешения, указанные в параметре запроса `scope`. Если пользователь не предоставил никаких разрешений, конечная точка платформы идентификации Майкрософт предлагает пользователю подтвердить необходимые разрешения. Вы можете прочитать дополнительные сведения о [разрешениях, согласии и приложениях с несколькими клиентами](v2-permissions-and-consent.md).

После того как пользователь пройдет проверку подлинности и предоставит согласие, конечная точка платформы идентификации Майкрософт возвращает ответ в приложение на указанном URI перенаправления с помощью метода, указанного в параметре `response_mode`.

### <a name="successful-response"></a>Успешный ответ

Успешный ответ при использовании `response_mode=form_post` выглядит следующим образом.

```
POST /myapp/ HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded

id_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNB...&state=12345
```

| Параметр | Description |
| --- | --- |
| `id_token` | Маркер идентификации, запрошенный приложением. Вы можете использовать параметр `id_token` для проверки личности пользователя и запуска сеанса пользователя. См. дополнительные сведения о маркерах идентификации и их содержимом в [справочнике по `id_tokens`](id-tokens.md). |
| `state` | Если запрос содержит параметр `state`, то в ответе должно отображаться то же значение. Приложение должно проверить, совпадают ли значения параметра "state" в запросе и ответе. |

### <a name="error-response"></a>Сообщение об ошибке

Сообщения об ошибках также можно отправлять на универсальный код ресурса (URI) перенаправления, чтобы приложение могло их обработать. Сообщение об ошибке выглядит следующим образом.

```
POST /myapp/ HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded

error=access_denied&error_description=the+user+canceled+the+authentication
```

| Параметр | Description |
| --- | --- |
| `error` | Строка кода ошибки, которую можно использовать для классификации типов возникших ошибок и реагирования на них. |
| `error_description` | Конкретное сообщение об ошибке, с помощью которого можно определить первопричину возникновения ошибки аутентификации. |

### <a name="error-codes-for-authorization-endpoint-errors"></a>Коды ошибок конечной точки авторизации

В таблице ниже описаны коды ошибок, которые могут возвращаться в параметре `error` сообщения об ошибке.

| Код ошибки | Description | Действие клиента |
| --- | --- | --- |
| `invalid_request` | Ошибка протокола, например отсутствует обязательный параметр. |Исправьте запрос и отправьте его повторно. Это ошибка разработки, которая, как правило, обнаруживается во время первоначального тестирования. |
| `unauthorized_client` | Клиентское приложение не может запросить код авторизации. |Обычно это происходит, когда клиентское приложение не зарегистрировано в Azure AD или не добавляется в клиент Azure AD пользователя. Приложение может отобразить для пользователя запрос с инструкцией по установке приложения и его добавлению в Azure AD. |
| `access_denied` | Владелец ресурса не дал согласия. |Клиентское приложение может уведомить пользователя о том, что оно не может быть продолжено, пока пользователь не отправит. |
| `unsupported_response_type` |Сервер авторизации не поддерживает тип ответа в запросе. |Исправьте запрос и отправьте его повторно. Это ошибка разработки, которая, как правило, обнаруживается во время первоначального тестирования. |
| `server_error` | Сервер обнаружил непредвиденную ошибку. |Повторите запрос. Эти ошибки могут возникать в связи с временными условиями. Клиентское приложение может объяснить пользователю, что его ответ откладывается из-за временной ошибки. |
| `temporarily_unavailable` | Сервер временно занят и не может обработать запрос. |Повторите запрос. Клиентское приложение может объяснить пользователю, что его ответ откладывается из-за временного состояния. |
| `invalid_resource` | Целевой ресурс недопустим, так как он не существует, Azure AD не может найти его или неправильно настроен. |Это означает, что ресурс, если он существует, не был настроен в клиенте. Приложение может отобразить для пользователя запрос с инструкциями по установке приложения и его добавлению в Azure AD. |

## <a name="validate-the-id-token"></a>Проверка маркера идентификации

Только получение id_token недостаточно для проверки подлинности пользователя; необходимо проверить подпись id_token и проверить утверждения в маркере на соответствие требованиям приложения. Конечная точка платформы идентификации Майкрософт использует [маркеры JSON Web tokens (JWT)](https://self-issued.info/docs/draft-ietf-oauth-json-web-token.html) и шифрование с открытым ключом для подписи маркеров и проверки их допустимости.

Можно проверить `id_token` в клиентском коде, но распространенной практикой является отправка `id_token` на внутренний сервер и проверка там. После проверки подписи id_token существует несколько утверждений, которые потребуется проверить. См. [справочник по `id_token`](id-tokens.md) и дополнительные сведения о [проверке маркеров](id-tokens.md#validating-an-id_token) и [смене ключей подписывания](active-directory-signing-key-rollover.md). Советуем использовать библиотеку для синтаксического анализа и проверки токенов. Для большинства языков и платформ доступна по крайней мере одна такая библиотека.

Вам также может потребоваться проверить дополнительные утверждения в зависимости от сценария. Ниже приведены некоторые из стандартных проверок:

* Обеспечение регистрации пользователя или организации в приложении.
* Предоставление пользователю необходимого уровня авторизации и привилегий.
* Обеспечение определенного уровня проверки подлинности, например Многофакторной Идентификации.

После проверки id_token можно начать сеанс с пользователем и использовать утверждения в id_token для получения сведений о пользователе в приложении. Эти сведения можно использовать для отображения, регистрации, персонализации и т. д.

## <a name="send-a-sign-out-request"></a>Отправка запроса на выход

Для выхода пользователя из приложения недостаточно очистить файлы cookie или каким-то другим образом завершить сеанс пользователя. Необходимо также перенаправить пользователя на конечную точку платформы идентификации Майкрософт для выхода. Если этого не сделать, то пользователь повторно выполняет проверку подлинности в приложении, не вводя учетные данные снова, так как у них будет действительный сеанс единого входа с конечной точкой платформы Microsoft Identity.

Можно перенаправить пользователя на адрес, указанный в параметре `end_session_endpoint` в документе метаданных OpenID Connect:

```
GET https://login.microsoftonline.com/common/oauth2/v2.0/logout?
post_logout_redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
```

| Параметр | Условие | Description |
| ----------------------- | ------------------------------- | ------------ |
| `post_logout_redirect_uri` | Рекомендуется | URL-адрес, на который перенаправляется пользователь после успешного выхода. Если параметр не включен, пользователь показывает общее сообщение, созданное конечной точкой платформы Microsoft Identity. URL-адрес должен в точности соответствовать одному из универсальных кодов ресурсов (URI) перенаправления, зарегистрированных для приложения на портале регистрации приложений. |

## <a name="single-sign-out"></a>Единый выход

При перенаправлении пользователя в `end_session_endpoint`конечная точка платформы Microsoft Identity очищает сеанс пользователя от браузера. Тем не менее пользователь может оставаться вошедшим в другие приложения, использующие учетные записи Майкрософт для аутентификации. Чтобы разрешить этим приложениям одновременный выход пользователя из системы, конечная точка платформы Microsoft Identity отправляет запрос HTTP GET в зарегистрированный `LogoutUrl` всех приложений, в которые в данный момент вошел пользователь. Приложения должны ответить на него, удалив любой сеанс, который идентифицирует пользователя, и возвратив ответ `200`. Для поддержки единого входа в приложении необходимо реализовать `LogoutUrl` в коде приложения. `LogoutUrl` можно задать на портале регистрации приложения.

## <a name="protocol-diagram-access-token-acquisition"></a>Схема протокола: получение маркера доступа

Многим веб-приложениям требуется не только выполнить вход пользователя, но и получить доступ к веб-службе от имени этого пользователя с помощью OAuth. Этот сценарий совмещает применение OpenID Connect для аутентификации пользователей и одновременное получение кода авторизации, который можно использовать для получения маркеров доступа с помощью потока кода авторизации OAuth.

Полный поток входа OpenID Connect и получения маркера представлен на следующей схеме. Каждый этап подробно описан в следующих разделах статьи.

![Протокол OpenID Connect: получение маркера](./media/v2-protocols-oidc/convergence-scenarios-webapp-webapi.svg)

## <a name="get-access-tokens"></a>Получение маркеров доступа
Для получения маркеров доступа необходимо изменить запрос на вход.

```
// Line breaks are for legibility only.

GET https://login.microsoftonline.com/{tenant}/oauth2/v2.0/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e        // Your registered Application ID
&response_type=id_token%20code
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F       // Your registered redirect URI, URL encoded
&response_mode=form_post                              // 'form_post' or 'fragment'
&scope=openid%20                                      // Include both 'openid' and scopes that your app needs  
offline_access%20                                         
https%3A%2F%2Fgraph.microsoft.com%2Fuser.read
&state=12345                                          // Any value, provided by your app
&nonce=678910                                         // Any value, provided by your app
```

> [!TIP]
> Чтобы выполнить этот запрос, щелкните приведенную ниже ссылку. После входа в систему в браузере выполняется переход по адресу `https://localhost/myapp/` с указанием маркера идентификации и кода в адресной строке. Обратите внимание, что в этом запросе используется `response_mode=fragment` исключительно в демонстрационных целях. Мы рекомендуем использовать `response_mode=form_post`.
> <a href="https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&response_type=id_token%20code&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F&response_mode=fragment&scope=openid%20offline_access%20https%3A%2F%2Fgraph.microsoft.com%2Fuser.read&state=12345&nonce=678910" target="_blank">https://login.microsoftonline.com/common/oauth2/v2.0/authorize...</a>;

Включая области разрешений в запросе и с помощью `response_type=id_token code`, конечная точка платформы Microsoft Identity гарантирует, что пользователь предоставил разрешения, указанные в параметре запроса `scope`. Он возвращает приложению код авторизации в обмен на маркер доступа.

### <a name="successful-response"></a>Успешный ответ

Успешный ответ с использованием `response_mode=form_post` выглядит следующим образом.

```
POST /myapp/ HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded

id_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNB...&code=AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...&state=12345
```

| Параметр | Description |
| --- | --- |
| `id_token` | Маркер идентификации, запрошенный приложением. Вы можете использовать маркер идентификации для проверки личности пользователя и запуска сеанса пользователя. См. дополнительные сведения о маркерах идентификации и их содержимом в [справочнике по `id_tokens`](id-tokens.md). |
| `code` | Запрашиваемый приложением код авторизации. Приложение может использовать код авторизации для запроса маркера доступа для целевого ресурса. Код авторизации кратковременно исследуется. Как правило, он действует в течение 10 минут. |
| `state` | Если запрос содержит параметр "state", в ответе должно отображаться то же значение. Приложение должно проверить, совпадают ли значения параметра "state" в запросе и ответе. |

### <a name="error-response"></a>Сообщение об ошибке

Сообщения об ошибках также можно отправлять на универсальный код ресурса (URI) перенаправления, чтобы приложение могло их правильно обработать. Сообщение об ошибке выглядит следующим образом.

```
POST /myapp/ HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded

error=access_denied&error_description=the+user+canceled+the+authentication
```

| Параметр | Description |
| --- | --- |
| `error` | Строка кода ошибки, которую можно использовать для классификации типов возникших ошибок и реагирования на них. |
| `error_description` | Конкретное сообщение об ошибке, с помощью которого можно определить первопричину возникновения ошибки аутентификации. |

Описание возможных кодов ошибок и рекомендуемые ответы клиента см. в разделе [Коды ошибок конечной точки авторизации](#error-codes-for-authorization-endpoint-errors).

После получения кода авторизации и маркера идентификации можно выполнить вход пользователя в систему и получить маркеры доступа от его имени. Для входа пользователя необходимо проверить маркер идентификации [в точности, как описано выше](id-tokens.md#validating-an-id_token). Для получения маркеров доступа следует выполнить действия, описанные в [документации по потоку кода OAuth](v2-oauth2-auth-code-flow.md#request-an-access-token).
