---
title: Учетные записи платформы идентификации Microsoft & профили клиентов на Android Azure
description: Обзор учетных записей платформы идентификации Майкрософт для Android
services: active-directory
author: shoatman
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: conceptual
ms.workload: identity
ms.devlang: java
ms.date: 09/14/2019
ms.author: shoatman
ms.custom: aaddev
ms.reviewer: shoatman
ms.openlocfilehash: d0497ad68e7b29e6d8c83dd860ba8f509e229579
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "77611885"
---
# <a name="accounts--tenant-profiles-android"></a>Учетные записи и профили клиентов (Android)

В этой статье приводится `account` обзор того, что находится в платформе идентификации Майкрософт.

API Библиотеки подлинности Майкрософт (MSAL) заменяет *термин «пользователь»* термином *«термин—учетная запись».* Одна из причин заключается в том, что пользователь (человек или агент программного обеспечения) может иметь или может использовать несколько учетных записей. Эти учетные записи могут быть в организации пользователя и/или в других организациях, членами которыми является пользователь.

Учетная запись в платформе майкрософт состоит из:

- Уникальный идентификатор.  
- Один или несколько учетных данных, используемых для демонстрации владения/контроля учетной записи.
- Один или несколько профилей, состоящий из таких атрибутов, как:
  - Изображение, Данное имя, Фамилия, Название, Расположение офиса
- Учетная запись имеет источник полномочий или систему записи. Это система, в которой создается учетная запись и где хранятся учетные данные, связанные с этой учетной записью. В мультитенантных системах, таких как идентификационная платформа Майкрософт, система записи — это `tenant` место создания учетной записи. Этот арендатор также называется `home tenant`.
- Учетные записи в платформе идентификации Майкрософт имеют следующие системы записи:
  - Активный каталог Azure, включая Активный каталог Azure B2C.
  - Учетная запись Майкрософт (Live).
- Учетные записи из систем записи за пределами платформы идентификации Майкрософт представлены в платформе идентификации Майкрософт, включая:
  - идентификации из подключенных предпосылок (Активный каталог Windows Server)
  - внешние идентификаторы от LinkedIn, GitHub и так далее.
  В этих случаях учетная запись имеет как систему записи, так и систему записи в платформе идентификации Майкрософт.
- Платформа идентификации Майкрософт позволяет использовать одну учетную запись для доступа к ресурсам, принадлежащим нескольким организациям (арендаторы Azure Active Directory).
  - Чтобы зафиксировать, что учетная запись из одной системы записи (AAD Tenant A) имеет доступ к ресурсу в другой системе записи (AAD Tenant B), учетная запись должна быть представлена в арендаторе, где определяется ресурс. Это делается путем создания локальной записи учетной записи из системы А в системе B.
  - Эта локальная запись, то есть представление учетной записи, привязана к исходной учетной записи.
  - MSAL предоставляет эту локальную `Tenant Profile`запись как .
  - Профиль клиента может иметь различные атрибуты, соответствующие локальному контексту, такие как название вакансий, местоположение офиса, контактная информация и т.д.
- Поскольку учетная запись может присутствовать в одном или нескольких арендаторах, учетная запись может иметь более одного профиля.

> [!NOTE]
> MSAL рассматривает систему учетных записей Майкрософт (Live, MSA) как еще одного арендатора в рамках платформы идентификации Майкрософт. Идентификатор клиента учетной записи Майкрософт:`9188040d-6c67-4c5b-b112-36a304b66dad`

## <a name="account-overview-diagram"></a>Диаграмма обзора учетной записи

![Диаграмма обзора учетной записи](./media/accounts-overview/accounts-overview.svg)

Расшифровка схемы выше.

- Учетная `bob@contoso.com` запись создается в предприимчивом каталоге Windows Server Active Directory (система записи origin on-premises).
- Учетная `tom@live.com` запись создается в учетной записи Майкрософт.
- `bob@contoso.com`имеет доступ по крайней мере к одному ресурсу в следующих клиентах Active Directory Azure:
  - contoso.com (облачная система записи - связана с предварительной системой записи)
  - fabrikam.com
  - woodgrovebank.com
  - Профиль арендатора `bob@contoso.com` существует в каждом из этих арендаторов.
- `tom@live.com`имеет доступ к ресурсам в следующих клиентах Майкрософт:
  - contoso.com
  - fabrikam.com
  - Профиль арендатора `tom@live.com` существует в каждом из этих арендаторов.
- Информация о Томе и Бобе у других жильцов может отличаться от той, что есть в системе записи. Они могут отличаться по таким атрибутам, как название вакансии, расположение офиса и так далее. Они могут быть членами групп и/или ролями в каждой организации (Арендатор active Directory Azure). Мы называем эту bob@contoso.com информацию профилем арендатора.

В диаграмме bob@contoso.com и tom@live.com иметь доступ к ресурсам в различных клиентах Active Directory Azure. Для получения дополнительной информации на [портале Azure можно добавить пользователей совместной работы Azure Active Directory B2B.](https://docs.microsoft.com/azure/active-directory/b2b/add-users-administrator)

## <a name="accounts-and-single-sign-on-sso"></a>Счета и единый договор (SSO)

Кэш маркеров MSAL хранит *один маркер обновления* на одну учетную запись. Этот маркер обновления можно использовать для бесшумного запроса токенов доступа у нескольких клиентов платформы майкрософт. Когда брокер установлен на устройстве, счет управляется брокером, и устройство всей одного входного становится возможным.

> [!IMPORTANT]
> Учетная запись Business to Consumer (B2C) и обновление поведения токенов отличаются от остальной платформы идентификации Майкрософт. Для получения дополнительной информаци [&и](#b2c-policies--accounts)см.

## <a name="account-identifiers"></a>Идентификаторы учетных записей

Идентификатор учетной записи MSAL не является идентификатором объекта учетной записи. Он не предназначен для разбора и / или полагаются на передать что-либо, кроме уникальности в платформе microsoft идентичности.

Для совместимости с Библиотекой аутентификации Azure AD (ADAL) и для облегчения миграции из ADAL в MSAL MSAL MSAL может найти учетные записи, используя любой действительный идентификатор для учетной записи, доступной в кэше MSAL.  Например, следующие из них всегда будут tom@live.com извлечены один и тот же объект учетной записи, поскольку каждый из идентификаторов действителен:

```java
// The following would always retrieve the same account object for tom@live.com because each identifier is valid

IAccount account = app.getAccount("<tome@live.com msal account id>");
IAccount account = app.getAccount("<tom@live.com contoso user object id>");
IAccount account = app.getAccount("<tom@live.com woodgrovebank user object id>");
```

## <a name="accessing-claims-about-an-account"></a>Доступ к утверждениям об учетной записи

Помимо запроса токена доступа, MSAL также всегда запрашивает токен ID от каждого клиента. Он делает это, всегда запрашивая следующие области:

- OpenId
- Профиль

Токен id содержит список претензий. `Claims`являются парами имен/значений в учетной записи и используются для выполнения запроса.

Как упоминалось ранее, каждый арендатор, где существует учетная запись, может хранить различную информацию об учетной записи, включая, но не ограничивайся такими атрибутами, как: название вакансии, местоположение офиса и так далее.

Хотя учетная запись может быть членом или гостем в нескольких организациях, MSAL не задавает запрос службы, чтобы получить список арендаторов, участником которого является учетная запись. Вместо этого MSAL создает список клиентов, в которых находится учетная запись, в результате сделанных запросов токенов.

Претензии, выставленные на объекте учетной записи, всегда являются претензиями от «домашнего арендатора»/«авторитета» для учетной записи. Если эта учетная запись не была использована для запроса маркера для их домашнего арендатора, MSAL не может предоставить претензии через объект учетной записи.  Пример:

```java
// Psuedo Code
IAccount account = getAccount("accountid");

String username = account.getClaims().get("preferred_username");
String tenantId = account.getClaims().get("tid"); // tenant id
String objectId = account.getClaims().get("oid"); // object id
String issuer = account.getClaims().get("iss"); // The tenant specific authority that issued the id_token
```

> [!TIP]
> Чтобы увидеть список претензий, доступных с объекта учетной записи, обратитесь к [претензиям в id_token](https://docs.microsoft.com/azure/active-directory/develop/id-tokens#claims-in-an-id_token)

> [!TIP]
> Чтобы включить дополнительные претензии в id_token, обратитесь к дополнительной документации претензий в [Как: Предоставьте дополнительные претензии к вашему приложению Azure AD](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims)

### <a name="access-tenant-profile-claims"></a>Доступ к претензиям профиля клиента

Чтобы получить доступ к утверждениям об учетной записи, как они `IMultiTenantAccount`появляются в других арендаторов, сначала необходимо бросить объект учетной записи. Все учетные записи могут быть мультитенантными, но количество профилей клиентов, доступных через MSAL, основано на том, какие арендаторы запросили токены от использования текущего счета.  Пример:

```java
// Psuedo Code
IAccount account = getAccount("accountid");
IMultiTenantAccount multiTenantAccount = (IMultiTenantAccount)account;

multiTenantAccount.getTenantProfiles().get("tenantid for fabrikam").getClaims().get("family_name");
multiTenantAccount.getTenantProfiles().get("tenantid for contoso").getClaims().get("family_name");
```

## <a name="b2c-policies--accounts"></a>Политики B2C & учетные записи

Обновления токенов для учетной записи не являются общими для всех в политиках B2C. В результате однозначный ввод с использованием токенов невозможен. Это не означает, что один очный знак невозможен. Это означает, что один знак должен использовать интерактивный опыт, в котором печенье доступно для включения одного включения.

Это также означает, что в случае MSAL, если вы приобретаете токены, используя различные политики B2C, то они рассматриваются как отдельные учетные записи - каждый со своим идентификатором. Если вы хотите использовать учетную запись `acquireTokenSilent`для запроса маркера с помощью, тогда вам нужно выбрать учетную запись из списка учетных записей, которые соответствуют политике, которую вы используете с запросом маркера. Пример:

```java
// Get Account For Policy

String policyId = "SignIn";
IAccount signInPolicyAccount = getAccountForPolicyId(app, policyId);

private IAccount getAccountForPolicy(IPublicClientApplication app, String policyId)
{
    List<IAccount> accounts = app.getAccounts();

    foreach(IAccount account : accounts)
   {
        if (account.getClaims().get("tfp").equals(policyId))
        {
            return account;
        }
    }

    return null;
}
```
