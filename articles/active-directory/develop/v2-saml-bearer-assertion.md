---
title: Платформа идентификации Microsoft & потоке утверждения носителей SAML (ru) Azure
description: Узнайте, как получить данные из Microsoft Graph, не побуждая пользователя к учетных данных с помощью потока утверждения носителя SAML.
services: active-directory
documentationcenter: ''
author: umeshbarapatre
manager: CelesteDG
editor: ''
ms.assetid: ''
ms.service: active-directory
ms.subservice: develop
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 08/05/2019
ms.author: ryanwi
ms.reviewer: hirsin
ms.custom: aaddev
ms.openlocfilehash: 16f30473ded5f1de5dc94c1cff9da96165b1a01c
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "76700215"
---
# <a name="microsoft-identity-platform-and-oauth-20-saml-bearer-assertion-flow"></a>Платформа идентификации Microsoft и поток утверждения носителя OAuth 2.0 SAML
Поток утверждения носителя OAuth 2.0 SAML позволяет запрашивать токен доступа OAuth, используя утверждение SAML, когда клиенту необходимо использовать существующие доверительные отношения. Подпись, применяемая к утверждению SAML, обеспечивает аутентификацию авторизованного приложения. Утверждение SAML — это токен безопасности XML, выпущенный поставщиком идентификационных данных и потребляемый поставщиком услуг. Поставщик услуг полагается на свой контент для определения предмета утверждения в целях безопасности.

Утверждение SAML размещено в конечную точку токена OAuth.  Конечная точка обрабатывает утверждение и выдает токен доступа на основе предварительного утверждения приложения. Клиент не обязан иметь или хранить маркер обновления, равно как и секрет клиента, необходимый для того, чтобы быть переданы конечной точке токена.

Поток samL Bearer Assertion полезен при извлечении данных из AIS Microsoft Graph (которые поддерживают только делегированные разрешения), не побуждая пользователя к учетным данным. В этом сценарии грант учетных данных клиента, который является предпочтительным для фоновых процессов, не работает.

Для приложений, которые делают интерактивный браузер на основе входе, чтобы получить утверждение SAML, а затем хотите добавить доступ к OAuth защищены API (например, Microsoft Graph), вы можете сделать запрос OAuth, чтобы получить токен доступа для API. Когда браузер перенаправляется в Azure AD для проверки подлинности пользователя, браузер заберет сеанс из входа в SAML, и пользователю не нужно вводить свои учетные данные.

Поток oAuth SAML Bearer Также поддерживается для пользователей, удостоверяющих подлинность с помощью поставщиков идентификационных данных, таких как Active Directory Federation Services (ADFS), федерализуемых в Azure Active Directory.  Утверждение SAML, полученное от ADFS, может быть использовано в потоке OAuth для проверки подлинности пользователя.

![Поток ОУТ](./media/v2-saml-bearer-assertion/1.png)

## <a name="call-graph-using-saml-bearer-assertion"></a>Позвоните В графе с помощью утверждения носителя SAML
Теперь давайте поймем, как мы можем на самом деле получить SAML утверждение программно. Этот подход тестируется с помощью ADFS. Тем не менее, это работает с любым поставщиком идентификационных данных, который поддерживает возвращение утверждения SAML программно. Основной процесс: получить утверждение SAML, получить токен доступа и получить доступ к Microsoft Graph.

### <a name="prerequisites"></a>Предварительные требования

Установить доверительные отношения между сервером авторизации/средой (Microsoft 365) и поставщиком идентификационных данных или эмитентом утверждения на предъявителя SAML 2.0 (ADFS). Для настройки ADFS для одного входного и в качестве поставщика идентификационных данных вы можете сослаться на [эту статью](https://blogs.technet.microsoft.com/canitpro/2015/09/11/step-by-step-setting-up-ad-fs-and-enabling-single-sign-on-to-office-365/).

Зарегистрируйте заявку на [портале](https://ms.portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade):
1. Вопием в [приложении регистрации лезвия портала](https://ms.portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade) (Пожалуйста, обратите внимание, что мы используем v2.0 конечные точки для Graph API и, следовательно, необходимо зарегистрировать приложение на этом портале. В противном случае мы могли бы использовать регистрации в активном каталоге Azure). 
1. Выберите **Новая регистрация**.
1. При **попавании страницы заявки** введите регистрационную информацию в ашего заявлении: 
    1. **Имя** — введите информативное имя приложения, которое будет отображаться пользователям приложения.
    1. **Поддерживаемые типы учетных записей** — выберите учетные записи, которые должно поддерживать приложение.
    1. **Перенаправить URI (необязательно)** - Выберите тип приложения, которое вы строите, Веб или Публичный клиент (мобильный & рабочий стол), а затем введите перенаправление URI (или url ответа) для вашего приложения.
    1. По завершении щелкните **Зарегистрировать**.
1. Сделайте к сведению идентификатор приложения (клиента).
1. В левой панели выберите **Сертификаты & секреты.** Нажмите **Новый секрет клиента** в разделе **Секреты клиента.** Скопируйте секрет нового клиента, вы не сможете получить, когда вы оставите лезвие.
1. В левой панели выберите **разрешения API,** а затем **добавьте разрешение.** Выберите **Microsoft Graph**, затем **делегировали разрешения,** а затем выберите **Tasks.read,** так как мы намерены использовать API Outlook Graph. 

Установите [Postman](https://www.getpostman.com/), инструмент, необходимый для проверки образца запросов.  Позже можно преобразовать запросы в код.

### <a name="get-the-saml-assertion-from-adfs"></a>Получить утверждение SAML от ADFS
Создайте запрос POST в конечную точку ADFS, используя конверт SOAP для получения утверждения SAML:

![Получить утверждение SAML](./media/v2-saml-bearer-assertion/2.png)

Значения заголовка:

![Значения заголовка](./media/v2-saml-bearer-assertion/3.png)

ADFS запрос тела:

![ADFS запрос тела](./media/v2-saml-bearer-assertion/4.png)

Как только этот запрос будет размещен успешно, вы должны получить утверждение SAML от ADFS. Требуется только данные тега **SAML:Assertion,** преобразуйте их в кодирование base64 для использования в дальнейших запросах.

### <a name="get-the-oauth2-token-using-the-saml-assertion"></a>Получите токен OAuth2 с помощью утверждения SAML 
На этом этапе возьмите токен OAuth2 с помощью ответа на утверждение ADFS.

1. Создайте запрос POST, показанный ниже со значениями заголовка:

    ![запрос POST](./media/v2-saml-bearer-assertion/5.png)
1. В теле запроса замените **client_id,** **client_secret**и **утверждение** (закодированное утверждение SAML, полученное на предыдущем этапе):

    ![Тело запроса](./media/v2-saml-bearer-assertion/6.png)
1. После успешного запроса вы получите токен доступа из активного каталога Azure.

### <a name="get-the-data-with-the-oauth-token"></a>Получить данные с токеном Oauth

После получения маркера доступа позвоните в ApIs Graph (задачи Outlook в этом примере). 

1. Создайте запрос GET с маркером доступа, извлеченным на предыдущем этапе:

    ![Запрос GET](./media/v2-saml-bearer-assertion/7.png)

1. После успешного запроса вы получите ответ JSON.

## <a name="next-steps"></a>Дальнейшие действия

Узнайте о различных [потоках проверки подлинности и сценариях применения.](authentication-flows-app-scenarios.md)