---
title: Агенты авторизации и способы их включения в процесс Azure
description: Узнайте о различных агентах авторизации, которые библиотека подлинности Microsoft (MSAL) позволяет использовать ваше приложение Android и как их включить.
services: active-directory
author: mmacy
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: conceptual
ms.workload: identity
ms.date: 09/05/2019
ms.author: marsma
ms.reviewer: shoatman, brianmel, hahamil
ms.custom: aaddev
ms.openlocfilehash: 4f1b3fc5b60069cfa47d437e4341ded141204418
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "77085332"
---
# <a name="authorization-agents-android"></a>Агенты авторизации (Android)

В этой статье описаны различные агенты авторизации, которые библиотека подлинности Майкрософт (MSAL) позволяет вашему приложению использовать и как включить их.

Выбор конкретной стратегии для авторизационных агентов является необязательным и представляет собой дополнительную функциональность, которые приложения могут настроить. Большинство приложений будут использовать MSAL по умолчанию (см. [Понимание Android MSAL файл конфигурации,](msal-configuration.md) чтобы увидеть различные по умолчанию).

MSAL поддерживает авторизацию с помощью системного `WebView`браузера.  На рисунке ниже `WebView`показано, как он выглядит с помощью, или системный браузер с CustomTabs или без CustomTabs:

![Примеры входа msAL](./media/authorization-agents/sign-in-ui.jpg)

## <a name="single-sign-in-implications"></a>Однократные последствия для регистрации

По умолчанию приложения, интегрированные с MSAL, используют пользовательские вкладки системного браузера для авторизации. В отличие от WebViews, пользовательские вкладки разделяют банку cookie с браузером системы по умолчанию, что позволяет меньше встыковок с веб-или другими нативными приложениями, которые интегрированы с пользовательскими вкладками.

Если приложение использует `WebView` стратегию без интеграции поддержки Microsoft Authenticator или Company Portal в свое приложение, пользователи не будут иметь единый знак на (SSO) опыт на всем устройстве или между родными приложениями и веб-приложений.

Если приложение использует MSAL с поддержкой Microsoft Authenticator или Company Portal, то пользователи могут иметь sSO опыт в приложениях, если пользователь имеет активный входе в одно из приложений.

## <a name="webview"></a>Веб-представление

Чтобы использовать в приложении WebView, поместите следующую строку в конфигурацию приложения JSON, которая передается MSAL:

```json
"authorization_user_agent" : "WEBVIEW"
```

При использовании в `WebView`приложении пользователь вписывается непосредственно в приложение. Токены хранятся в песочнице приложения и не доступны за пределами банки cookie приложения. В результате пользователь не может иметь sSO опыт в приложениях, если приложения не интегрируются с Authenticator или портал компании.

Тем `WebView` не менее, предоставляет возможность настроить внешний вид для входиного uI. Подробнее о том, как сделать эту настройку, читайте в [Android WebViews.](https://developer.android.com/reference/android/webkit/WebView)

## <a name="default-browser-plus-custom-tabs"></a>Браузер по умолчанию плюс пользовательские вкладки

По умолчанию MSAL использует браузер и стратегию [пользовательских вкладок.](https://developer.chrome.com/multidevice/android/customtabs) Эту стратегию можно прямо указать для `DEFAULT` предотвращения изменений в будущих выпусках, используя следующую конфигурацию JSON в пользовательском файле конфигурации:

```json
"authorization_user_agent" : "BROWSER"
```

Используйте этот подход, чтобы обеспечить sSO опыт через браузер устройства. MSAL использует общую банку cookie, которая позволяет другим нативным приложениям или веб-приложениям достичь SSO на устройстве с помощью упорствующих файлов cookie сеанса, установленного MSAL.

## <a name="browser-selection-heuristic"></a>Выбор браузера эвристический

Поскольку MSAL не может указать точный пакет браузера для использования на каждом из широкого спектра телефонов Android, MSAL реализует эвристический выбор браузера, который пытается обеспечить лучший кросс-устройство SSO.

MSAL получает полный список браузеров, установленных на устройстве, чтобы выбрать, какой браузер использовать. Список находится в порядке, возвращенном менеджером пакетов, который косвенно отражает предпочтения пользователя. Например, браузер по умолчанию, если он установлен, является первой записью в списке. _Первый_ браузер в списке будет выбран независимо от того, поддерживает ли он пользовательские вкладки. Если браузер поддерживает пользовательские вкладки, MSAL запустит пользовательские вкладки. Пользовательские `WebView` вкладки имеют вид и чувствовать себя ближе к в приложении и позволяют основные настройки пользовательского интерфейса. Смотрите [пользовательские вкладки в Android,](https://developer.chrome.com/multidevice/android/customtabs) чтобы узнать больше.

Если на устройстве нет пакетов браузера, MSAL `WebView`использует приложение.

Порядок браузеров в списке браузеров определяется операционной системой. Это в порядке от наиболее предпочтительным в наименее. Если настройка устройства по умолчанию не изменена, для каждого ввоза должен быть запущен один и тот же браузер, чтобы обеспечить опыт SSO.

> [!NOTE]
> MSAL больше не всегда предпочитает Chrome, если другой браузер установлен по умолчанию. Например, на устройстве, которое имеет как Chrome, так и другой браузер, предварительно установленный, MSAL будет использовать браузер, установленный пользователем по умолчанию.

### <a name="tested-browsers"></a>Проверенные браузеры

Следующие браузеры были протестированы, чтобы увидеть, `"redirect_uri"` правильно ли они перенаправляются на указанный в файле конфигурации:

| | Встроенный браузер | Chrome | Opera  | Microsoft Edge | UC Браузер | Firefox |
| -- |:-------------:| -----:|-----:|-----:|-----:|-----:|
| Nexus 4 (API 17) | pass | pass |Неприменимо |Неприменимо |Неприменимо |Неприменимо |
| Samsung S7 (API 25) | пройти | pass | pass | pass | fail |pass |
| Huawei (API 26) |пройти | pass | fail | pass | pass |pass |
| Vivo (API 26) |pass|pass|pass|pass|pass|fail|
| Пиксель 2 (API 26) |pass | pass | pass | pass | fail |pass |
| Oppo | pass | неприменима |Неприменимо  |Неприменимо |Неприменимо | Неприменимо|
| OnePlus (API 25) |pass | pass | pass | pass | fail |pass |
| Нексус (API 28) |pass | pass | pass | pass | fail |pass |
|MI | pass | pass | pass | pass | fail |pass |

«Встроенным браузером Samsung является Интернет Samsung.  
Встроенный браузер Huawei — Huawei Browser.  
Браузер по умолчанию не может быть изменен внутри настройки устройства Oppo.
