---
title: Агенты авторизации и их включение | Службы
description: Узнайте о различных агентах авторизации, которые библиотека проверки подлинности Майкрософт (MSAL) позволяет использовать приложение Android и как их включить.
services: active-directory
author: tylermsft
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: conceptual
ms.workload: identity
ms.date: 09/05/2019
ms.author: twhitney
ms.reviewer: shoatman, brianmel, hahamil
ms.custom: aaddev
ms.collection: M365-identity-device-management
ms.openlocfilehash: 44a0e93c87c50fbc63cddad349ec9b5fbf45d91f
ms.sourcegitcommit: c38a1f55bed721aea4355a6d9289897a4ac769d2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/05/2019
ms.locfileid: "74843909"
---
# <a name="authorization-agents-android"></a>Агенты авторизации (Android)

В этой статье описываются различные агенты авторизации, которые библиотека проверки подлинности Майкрософт (MSAL) позволяет использовать приложение и как их включить.

Выбор конкретной стратегии для агентов авторизации является необязательным и представляет дополнительные функциональные возможности, которые могут быть настроены для приложений. Большинство приложений будут использовать значения по умолчанию MSAL (см. раздел [Знакомство с файлом конфигурации Android MSAL](msal-configuration.md) для просмотра различных значений по умолчанию).

MSAL поддерживает авторизацию с помощью `WebView`или системного браузера.  На рисунке ниже показано, как он выглядит с помощью `WebView`или системного браузера с Кустомтабс или без Кустомтабс:

![Примеры входа в MSAL](./media/authorization-agents/sign-in-ui.jpg)

## <a name="single-sign-in-implications"></a>Последствия единого входа

По умолчанию приложения, интегрированные с MSAL, используют пользовательские вкладки системного браузера для авторизации. В отличие от веб-представлений, пользовательские вкладки совместно используют файл cookie с системным браузером по умолчанию, что позволяет сократить число входов в систему или другие собственные приложения, интегрированные с пользовательскими вкладками.

Если приложение использует стратегию `WebView` без интеграции Microsoft Authenticator или корпоративный портал поддержки в свое приложение, пользователи не будут иметь возможности единого входа (SSO) на устройстве или между собственными приложениями и веб-приложениями.

Если приложение использует MSAL с поддержкой Microsoft Authenticator или корпоративный портал, то пользователи могут иметь возможность единого входа в приложениях, если у пользователя есть активный вход с одним из приложений.

## <a name="webview"></a>WebView

Чтобы использовать WebView в приложении, добавьте следующую строку в JSON-конфигурацию приложения, которая передается в MSAL:

```json
"authorization_user_agent" : "WEBVIEW"
```

При использовании `WebView`в приложении пользователь входит непосредственно в приложение. Токены хранятся в песочнице приложения и не доступны вне JAR-файла приложения. В результате у пользователя не может быть единого входа в приложениях, если только приложения не интегрируются с приложением проверки подлинности или корпоративный портал.

Однако `WebView` предоставляет возможность настройки внешнего вида и поведения пользовательского интерфейса входа. Дополнительные сведения о том, как выполнить эту настройку, см. в статье о [просмотре в Android](https://developer.android.com/reference/android/webkit/WebView) .

## <a name="default-browser-plus-custom-tabs"></a>Браузер по умолчанию плюс пользовательские вкладки

По умолчанию MSAL использует браузер и [настраиваемую стратегию вкладок](https://developer.chrome.com/multidevice/android/customtabs) . Вы можете явно указать эту стратегию, чтобы избежать изменений в будущих выпусках, чтобы `DEFAULT` с помощью следующей конфигурации JSON в файле пользовательской конфигурации:

```json
"authorization_user_agent" : "BROWSER"
```

Используйте этот подход для предоставления единого входа через браузер устройства. MSAL использует общий JAR-файл файла cookie, который позволяет другим собственным приложениям или веб приложениям достигать единого входа на устройстве с помощью файла cookie хранимого сеанса, установленного MSAL.

## <a name="browser-selection-heuristic"></a>Эвристика выбора браузера

Так как MSAL не может указать точный пакет браузера для использования на каждом из широкого спектра телефонов Android, MSAL реализует эвристику выбора браузера, которая пытается предоставить лучшее единый вход между устройствами.

MSAL извлекает полный список браузеров, установленных на устройстве, чтобы выбрать браузер для использования. Список находится в порядке, возвращенном диспетчером пакетов, который косвенно отражает предпочтения пользователя. Например, браузер по умолчанию, если он задан, является первой записью в списке. _Первый_ браузер в списке будет выбран независимо от того, поддерживает ли он пользовательские вкладки. Если браузер поддерживает пользовательские вкладки, MSAL запустит пользовательскую вкладку. пользовательские вкладки выглядят ближе к `WebView` в приложении и позволяют выполнять базовую настройку пользовательского интерфейса. Дополнительные сведения см. в статье [пользовательские вкладки в Android](https://developer.chrome.com/multidevice/android/customtabs) .

Если на устройстве нет пакетов браузера, MSAL использует `WebView`в приложении.

Порядок браузеров в списке браузеров определяется операционной системой. В порядке от наиболее предпочтительных к минимуму. Если параметр устройства по умолчанию не изменяется, для каждого входа необходимо запустить тот же браузер, чтобы обеспечить единый вход.

> [!NOTE]
> MSAL больше не всегда предпочитает Chrome, если для другого браузера задано значение по умолчанию. Например, на устройстве, где установлены оба хрома, и другой браузер, MSAL будет использовать браузер, установленный пользователем по умолчанию.

### <a name="tested-browsers"></a>Протестированные браузеры

Следующие браузеры протестировали, чтобы убедиться, что они правильно перенаправлены в `"redirect_uri"`, указанные в файле конфигурации:

| | Встроенный браузер | Chrome | Opera  | Microsoft Edge | Браузер UC | Firefox |
| -- |:-------------:| -----:|-----:|-----:|-----:|-----:|
| Хранилища 4 (API 17) | pass | pass |Не применяется |Не применяется |Не применяется |Не применяется |
| Samsung S7 (API 25) | проходит | pass | pass | pass | ошибка |pass |
| Huawei (API 26) |Pass * * | pass | ошибка | pass | pass |pass |
| VIVO (API 26) |pass|pass|pass|pass|pass|ошибка|
| Пиксель 2 (API 26) |pass | pass | pass | pass | ошибка |pass |
| Oppo | pass | неприменимо * * * |Не применяется  |Не применяется |Не применяется | Не применяется|
| Онеплус (API 25) |pass | pass | pass | pass | ошибка |pass |
| Хранилища (API 28) |pass | pass | pass | pass | ошибка |pass |
|MI | pass | pass | pass | pass | ошибка |pass |

\* Встроенный браузер Samsung — Samsung Internet.  
\* * Встроенный браузер Huawei — браузер Huawei.  
Браузер по умолчанию нельзя изменить в параметре устройства Oppo.
