---
title: Использование протоколов OAuth 2.0 и OpenID Connect с платформой удостоверений Майкрософт | Azure
titleSuffix: Microsoft identity platform
description: Руководство по протоколам OAuth 2.0 и OpenID Connect, которые поддерживаются конечной точкой платформы удостоверений Майкрософт.
services: active-directory
author: hpsin
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.workload: identity
ms.topic: conceptual
ms.date: 05/06/2020
ms.author: hirsin
ms.reviewer: hirsin
ms.custom: aaddev
ms.openlocfilehash: 0bb7812d75fa3276b52a182f9184e28a21a910ae
ms.sourcegitcommit: 493b27fbfd7917c3823a1e4c313d07331d1b732f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/21/2020
ms.locfileid: "83737492"
---
# <a name="oauth-20-and-openid-connect-protocols-on-microsoft-identity-platform"></a>Использование протоколов OAuth 2.0 и OpenID Connect с платформой удостоверений Майкрософт

Конечная точка платформы удостоверений Майкрософт для предоставления удостоверения как службы реализует аутентификацию и авторизацию с помощью стандартных протоколов OpenID Connect (OIDC) и OAuth 2.0 соответственно. Хотя эта служба соответствует стандартам, между любыми двумя реализациями этих протоколов могут быть незначительные различия. Сведения в этой статье могут оказаться полезными, если вы планируете писать код с использованием прямой отправки и обработки HTTP-запросов или сторонней библиотеки с открытым кодом вместо одной из наших [библиотек с открытым кодом](reference-v2-libraries.md).

## <a name="the-basics"></a>Основные сведения

Почти во всех потоках обмена данными в OAuth 2.0 и OpenID Connect участвуют четыре стороны.

![Схема, показывающая роли OAuth 2.0](./media/active-directory-v2-flows/protocols-roles.svg)

* **Сервер авторизации** — это конечная точка платформы удостоверений Майкрософт, которая отвечает за удостоверение пользователя, предоставление и блокировку доступа к ресурсам, а также выдачу токенов. Кроме того, он выполняет роль поставщика удостоверений: он безопасным способом обрабатывает любые данные, связанные со сведениями о пользователе, его доступом и отношениями доверия между участниками потока.
* **Владелец ресурса** — это, как правило, пользователь. Это сторона, владеющая данными, которая может предоставлять третьим сторонам доступ к этим данным или ресурсу.
* **Клиент OAuth** — это приложение, определяемое идентификатором приложения. Обычно именно с этой стороной взаимодействует конечный пользователь. Клиент OAuth также запрашивает маркеры у сервера авторизации. Владелец ресурса должен предоставить клиенту разрешение на доступ к ресурсу.
* **Сервер ресурсов** — место размещения ресурса или данных. Он позволяет серверу авторизации выполнять безопасную аутентификацию и авторизацию клиента OAuth и использует маркеры доступа носителя, позволяя предоставлять доступ к ресурсу.

## <a name="app-registration"></a>Регистрация приложения

Все приложения, которые должны принимать и персональные, и рабочие или учебные учетные записи, нужно зарегистрировать с помощью **Регистрации приложений** на [портале Azure](https://aka.ms/appregistrations), прежде чем пользователи смогут входить в них с помощью OAuth 2.0 или OpenID Connect. В процессе регистрации для приложения будет собрано и назначено несколько значений.

* **идентификатор приложения**, который определяет конкретное приложение;
* **универсальный код ресурса (URI)** (необязательный), который можно использовать для отправки ответов в приложение;
* Несколько других зависящих от сценария значений.

Дополнительные сведения см. в статье о [регистрации приложения](quickstart-register-app.md).

## <a name="endpoints"></a>Конечные точки

После регистрации приложение взаимодействует с платформой удостоверений Майкрософт, отправляя запросы к конечной точке:

```
https://login.microsoftonline.com/{tenant}/oauth2/v2.0/authorize
https://login.microsoftonline.com/{tenant}/oauth2/v2.0/token
```

Где `{tenant}` может принимать одно из четырех значений:

| Значение | Описание |
| --- | --- |
| `common` | Позволяет пользователям с личными учетными записями Майкрософт и рабочими учетными записями Azure AD выполнять вход в приложение. |
| `organizations` | Позволяет выполнять вход в приложение только пользователям с рабочими учетными записями Azure AD. |
| `consumers` | Позволяет выполнять вход в приложение только пользователям с личными учетными записями Майкрософт. |
| `8eaef023-2b34-4da1-9baa-8bc8c9d6a490` либо `contoso.onmicrosoft.com` | Позволяет выполнять вход в приложение только пользователям с рабочими учетными записями определенного клиента Azure AD. Можно использовать понятное доменное имя клиента Azure AD или идентификатор GUID клиента. |

Чтобы узнать, как взаимодействовать с этими конечными точками, выберите определенный тип приложения в разделе [Протоколы](#protocols) и перейдите по ссылкам для получения дополнительной информации.

> [!TIP]
> Любое приложение, зарегистрированное в Azure AD, может использовать конечную точку платформы удостоверений Майкрософт, даже если оно не поддерживает вход с личными учетными записями.  Благодаря этому можно перенести существующие приложения на платформу удостоверений Майкрософт и в [MSAL](reference-v2-libraries.md) без повторного создания приложения.

## <a name="tokens"></a>Токены

В реализации OAuth 2.0 и OpenID Connect для платформы удостоверений Майкрософт широко используются токены носителя, включая токены носителя в виде JSON Web Token (JWT). Токен носителя — это упрощенный маркер безопасности, предоставляющий его носителя (предъявителю) доступ к защищенному ресурсу. В этом смысле предъявителем является любая сторона, которая может предъявить маркер. Хотя для получения токена носителя сторона должна сначала выполнить аутентификацию на платформе удостоверений Майкрософт, если действия по защите токена при его передаче и хранении не выполняются, его может перехватить и использовать неавторизованная сторона. Хотя в некоторых маркерах безопасности для предотвращения несанкционированного использования применяется специальный встроенный механизм, в токенах носителя такого механизма нет, и они должны передаваться по защищенному каналу, например с использованием стандарта безопасности транспортного уровня (HTTPS). Если токен носителя передается в незашифрованном виде, злоумышленник может использовать атаку "злоумышленник в середине", чтобы получить токен и использовать его для несанкционированного доступа к защищенному ресурсу. Те же принципы безопасности применяются при сохранении или кэшировании маркеров носителя для последующего использования. Необходимо всегда проверять, что приложение передает и сохраняет токены носителя безопасным образом. Дополнительные сведения о безопасности в случае применения токенов носителя см. в [RFC 6750, раздел 5](https://tools.ietf.org/html/rfc6750).

См. сведения в [справочнике по токенам конечных точек платформы удостоверений Майкрософт](v2-id-and-access-tokens.md).

## <a name="protocols"></a>Протоколы

Если вы готовы рассмотреть несколько примеров запросов, приступите к одному из учебников ниже. Каждый из них соответствует определенному сценарию аутентификации. Сведения о том, как выбрать правильный поток, см. в статье о [типах приложений, которые можно создать с помощью платформы удостоверений Майкрософт](v2-app-types.md).

* [Создание мобильного и собственного приложения с использованием OAuth 2.0](v2-oauth2-auth-code-flow.md)
* [Сборка веб-приложения с протоколом OpenID Connect](v2-protocols-oidc.md)
* [Создание одностраничных приложений с использованием неявной последовательности OAuth 2.0](v2-oauth2-implicit-grant-flow.md)
* [Создание управляющих программ или серверных процессов с использованием потока учетных данных клиентов OAuth 2.0](v2-oauth2-client-creds-grant-flow.md)
* [Получение маркеров в веб-API с помощью последовательности OAuth 2.0 On-Behalf-Of](v2-oauth2-on-behalf-of-flow.md)
