---
title: Ссылка на изменения активных каталогов Azure
description: Дополнительные сведения об изменениях, внесенных в протоколы Azure AD, которые могут повлиять на приложение.
services: active-directory
author: rwike77
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.workload: identity
ms.topic: conceptual
ms.date: 3/13/2020
ms.author: ryanwi
ms.reviewer: hirsin
ms.custom: aaddev
ms.openlocfilehash: a60b927f7239818b582ffcd85ddb4b7d69594482
ms.sourcegitcommit: 31ef5e4d21aa889756fa72b857ca173db727f2c3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81535967"
---
# <a name="whats-new-for-authentication"></a>Новые возможности для проверки подлинности.

>Получайте уведомления об обновлениях этой страницы. Добавьте [этот URL-адрес](https://docs.microsoft.com/api/search/rss?search=%22whats%20new%20for%20authentication%22&locale=en-us) своему читателю RSS-канала.

Система проверки подлинности изменяет и добавляет функции на постоянной основе для безопасности и соответствия стандартам. Чтобы вы оставались в курсе последних разработок, в этой статье предоставлены такие сведения:

- Новые возможности
- Известные проблемы
- Изменения протокола
- Нерекомендуемые функции.

> [!TIP]
> Эта страница обновляется регулярно, поэтому нужно часто пересматривать ее. Если иное не указано, эти изменения вводятся только для приложений, зарегистрированных после вступления в силу соответствующих изменений.

## <a name="upcoming-changes"></a>Предстоящие изменения

Пока не запланировано.  Пожалуйста, см. ниже для изменений, которые находятся в или приходят к производству.

## <a name="march-2020"></a>Март 2020 г.

### <a name="user-passwords-will-be-restricted-to-256-characters"></a>Пароли пользователей будут ограничены 256 символами.

**Дата вступления в силу**: 13 марта 2020 г.

**Затронутые конечные точки**: версии 1.0 и 2.0.

**Протокол влияет**: Все потоки пользователей.

Пользователи с паролями длиннее 256 символов, которые вписываются непосредственно в Azure AD (в отличие от федеративных ВПЛ, таких как ADFS), не смогут войти в систему с 13 марта 2020 года, и вместо этого им будет предложено сбросить пароль.  Админы могут получать запросы, чтобы помочь сбросить пароль пользователей.

Ошибка в знаке в журналах будет AADSTS 50052: InvalidPasswordExceedsMaxLength

Сообщение:`The password entered exceeds the maximum length of 256. Please reach out to your admin to reset the password.`

Исправление.

Пользователь не может войти в систему, так как его пароль превышает разрешенную максимальную длину. Они должны связаться со своим админом, чтобы сбросить пароль. Если SSPR включен для их арендатора, они могут сбросить свой пароль, перелюбив ссылку "Забыли пароль".



## <a name="february-2020"></a>Февраль 2020 г.

### <a name="empty-fragments-will-be-appended-to-every-http-redirect-from-the-login-endpoint"></a>Пустые фрагменты будут приложены к каждому перенаправлению HTTP из точки входа.

**Дата вступления в силу:** 8 февраля 2020 г.

**Затронутые конечные точки**: версии 1.0 и 2.0.

**Протокол влияет**: Потоки OAuth и OIDC, которые используют response_type-запрос - это охватывает [поток кода авторизации](v2-oauth2-auth-code-flow.md) в некоторых случаях, и [неявное поток](v2-oauth2-implicit-grant-flow.md).

Когда ответ на проверку подлинности отправляется из login.microsoftonline.com в приложение через http redirect, служба прикладывает пустой фрагмент к URL-адресу ответа.  Это предотвращает перенаправление группы атак, гарантируя, что браузер уничтожит любой существующий фрагмент в запросе проверки подлинности.  Никакие приложения не должны зависеть от такого поведения.


## <a name="august-2019"></a>Август 2019 г.

### <a name="post-form-semantics-will-be-enforced-more-strictly---spaces-and-quotes-will-be-ignored"></a>Семантика формы POST будет применяться более строго - пробелы и котировки будут проигнорированы

**Дата вступления**в силу: 2 сентября 2019 г.

**Затронутые конечные точки**: версии 1.0 и 2.0.

**Протокол влияние**: Везде POST используется[(клиент учетных данных](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-client-creds-grant-flow), [авторизация код выкупа](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-auth-code-flow), [ROPC](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth-ropc), [OBO](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow), и [обновить токен выкупа](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-auth-code-flow#refresh-the-access-token))

Начиная с недели 9/2, запросы на аутентификацию, использующие метод POST, будут проверены с использованием более строгих стандартов HTTP.  В частности, пробелы и двойные котировки () больше не будут удалены из значений формы запроса. Эти изменения не будут нарушать число существующих клиентов и гарантируют, что запросы, отправленные в Azure AD, будут надежно обрабатываться каждый раз. В будущем (см. выше) мы планируем дополнительно отклонить дублирующие параметры и игнорировать БОМ в рамках запросов.

Пример

Сегодня, `?e=    "f"&g=h` разбирается одинаково, `?e=f&g=h` как `e`  ==  `f`- так .  С этим изменением, теперь он `e`  ==  `    "f"` будет разогнан так, что - это вряд ли будет веским аргументом, и запрос теперь не удастся.


## <a name="july-2019"></a>Июль 2019 г.

### <a name="app-only-tokens-for-single-tenant-applications-are-only-issued-if-the-client-app-exists-in-the-resource-tenant"></a>Токены только для приложений для одного арендатора выдаются только в том случае, если клиентское приложение существует в ресурсе-арендаторе

**Дата вступления**в силу: 26 июля 2019 г.

**Конечные точки влияние**: Оба [v1.0](https://docs.microsoft.com/azure/active-directory/develop/v1-oauth2-client-creds-grant-flow) и [v2.0](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-client-creds-grant-flow)

**Влияние на протокол**: [Учетные данные клиентов (только токены для приложений)](https://docs.microsoft.com/azure/active-directory/develop/v1-oauth2-client-creds-grant-flow)

26 июля в прямом эфире было внесено изменение того, как выпускаются токены только для приложений (через грант учетных данных клиента). Ранее приложениям разрешалось получать токены для вызова любого другого приложения, независимо от наличия у арендатора или ролей, на которые было предложено это приложение.  Это поведение было обновлено таким образом, чтобы ресурсы (иногда называемые web-aIS), установленные для одноквартирных (по умолчанию), клиентское приложение должно существовать в пределах ресурса-арендатора.  Обратите внимание, что существующее согласие между клиентом и API по-прежнему не требуется, и приложения должны по-прежнему проводить свои собственные проверки авторизации, чтобы убедиться, что `roles` претензия присутствует и содержит ожидаемое значение для API.

Сообщение об ошибке для этого сценария в настоящее время гласит:

`The service principal named <appName> was not found in the tenant named <tenant_name>. This can happen if the application has not been installed by the administrator of the tenant.`

Чтобы устранить эту проблему, используйте опыт Admin Consent для создания основного клиента-приложения для вашего арендатора или создайте его вручную.  Это требование гарантирует, что арендатор дал разрешение на работу в арендаторе.

#### <a name="example-request"></a>Пример запроса

`https://login.microsoftonline.com/contoso.com/oauth2/authorize?resource=https://gateway.contoso.com/api&response_type=token&client_id=14c88eee-b3e2-4bb0-9233-f5e3053b3a28&...`В этом примере арендатор ресурсов (авторитет) contoso.com, приложение ресурса `gateway.contoso.com/api` является приложением с одним арендатором, `14c88eee-b3e2-4bb0-9233-f5e3053b3a28`называемым для арендатора Contoso, а клиентское приложение — это приложение клиента.  Если клиентское приложение имеет доверительную службу в течение Contoso.com, этот запрос может быть продолжен.  Если это не так, то запрос не удастся с ошибкой выше.

Однако, если бы приложение Contoso gateway было мультитенантным приложением, то запрос продолжался бы независимо от того, имеет клиентское приложение, имевавщее доверительную службу в течение Contoso.com.

### <a name="redirect-uris-can-now-contain-query-string-parameters"></a>Перенаправление URIs теперь может содержать параметры строки строки запроса

**Дата вступления**в силу: 22 июля 2019 г.

**Затронутые конечные точки**: версии 1.0 и 2.0.

**Протокол влияние**: Все потоки

Приложения [Azure](https://tools.ietf.org/html/rfc6749#section-3.1.2)AD могут регистрироваться и использовать ренайкированные (ответить) URИ со `https://contoso.com/oauth2?idp=microsoft`статической параметрами запросов (например, для запросов OAuth 2.0.  Динамические ренаправление УРИ по-прежнему запрещены, поскольку они представляют угрозу безопасности, и это `state` не может быть использовано для сохранения информации о состоянии через запрос проверки подлинности - для этого используйте параметр.

Параметр статического запроса подлежит сопоставлению строк для перенаправления URI, как и любая другая часть перенаправления URI - если не зарегистрирована строка, соответствующая redirect_uri, то запрос будет отклонен.  Если URI находится в регистрации приложения, то вся строка будет использоваться для перенаправления пользователя, включая статический параметр запроса.

Обратите внимание, что в это время (конец июля 2019 года) регистрация приложения UX на портале Azure по-прежнему блокирует параметры запроса.  Тем не менее, вы можете отсеивать манифест приложения вручную, чтобы добавить параметры запроса и протестировать это в приложении.


## <a name="march-2019"></a>Март 2019 г.

### <a name="looping-clients-will-be-interrupted"></a>Цикл клиентов будет прерван

**Дата вступления**в силу: 25 марта 2019 г.

**Затронутые конечные точки**: версии 1.0 и 2.0.

**Протокол влияние**: Все потоки

Клиентские приложения иногда могут вести себя неправильно, выдавая сотни одного и того же запроса на вход в течение короткого периода времени.  Эти просьбы могут быть успешными, а могут и не быть успешными, но все они способствуют плохому пользовательскому опыту и повышенной рабочей нагрузке для ВПЛ, увеличивая задержку для всех пользователей и снижая доступность ВПЛ.  Эти приложения работают вне пределов нормального использования и должны быть обновлены, чтобы вести себя правильно.

Клиентам, которые выдают дубликаты `invalid_grant` запросов несколько раз, будет отправлена ошибка: `AADSTS50196: The server terminated an operation because it encountered a loop while processing a request`.

Большинству клиентов не нужно будет менять поведение, чтобы избежать этой ошибки.  Только неправильно настроенные клиенты (те, без кэширования токенов или те, которые уже демонстрируют быстрые циклы) будут затронуты этой ошибкой.  Клиенты отслеживаются на локальной основе (через cookie) по следующим факторам:

* Подсказка пользователя, если таковые имеется

* Запрашиваемые области или ресурсы

* Идентификатор клиента

* URI перенаправления

* Тип и режим ответа

Приложения, делающие несколько запросов (15 евро) в течение `invalid_grant` короткого периода времени (5 минут), получат ошибку, объясняющую, что они циклируются.  Запрашиваемые токены имеют достаточно длительные сроки жизни (минимум 10 минут, 60 минут по умолчанию), поэтому повторные запросы в течение этого периода времени не нужны.

Все приложения `invalid_grant` должны обрабатывать, показывая интерактивный запрос, а не молча запрашивать маркер.  Чтобы избежать этой ошибки, клиенты должны убедиться, что они правильно кэшируют токены, которые они получают.


## <a name="october-2018"></a>Октябрь 2018 г.

### <a name="authorization-codes-can-no-longer-be-reused"></a>Коды авторизации больше нельзя использовать повторно

**Дата вступления в силу**: 15 ноября 2018 г.

**Затронутые конечные точки**: версии 1.0 и 2.0.

**Затронутый протокол**: [поток кода](v2-oauth2-auth-code-flow.md).

С 15 ноября 2018 г. в Azure AD прекращается поддержка использованных кодов аутентификации для приложений. Это изменение системы безопасности помогает Azure AD соответствовать спецификации OAuth и будет применяться для конечных точек версии 1 и 2.

Если ваше приложение повторно использует коды проверки подлинности для получения маркеров для нескольких ресурсов, мы рекомендуем использовать код для получения маркера обновления, а затем использовать этот маркер для получения дополнительных маркеров для других ресурсов. Коды проверки подлинности можно использовать только один раз, однако маркеры обновления можно использовать несколько раз для нескольких ресурсов. Любое новое приложение, которое пытается повторно использовать код проверки подлинности во время потока кода OAuth, получит ошибку invalid_grant.

Дополнительные сведения о маркерах обновления см. в статье [Обновление маркеров доступа](v2-oauth2-auth-code-flow.md#refresh-the-access-token).  При использовании ADAL или MSAL обработку выполняет библиотека — замените второй экземпляр AcquireTokenByAuthorizationCodeAsync на AcquireTokenSilentAsync.

## <a name="may-2018"></a>Май 2018 г.

### <a name="id-tokens-cannot-be-used-for-the-obo-flow"></a>Для потока OBO нельзя использовать маркеры идентификации

**Дата**: 1 мая 2018 г.

**Затронутые конечные точки**: версии 1.0 и 2.0.

**Протоколы повлияли**: Неявный поток и [на-от-от-от-потока](v2-oauth2-on-behalf-of-flow.md)

Начиная с 1 мая 2018 г. новые приложения не могут использовать маркеры id_token в качестве утверждения в потоке OBO. Вместо этого следует использовать маркеры доступа для защиты API, даже между клиентом и средним уровнем того же приложения. Приложения, зарегистрированные до 1 мая 2018 г., будут дальше работать с возможностью замены маркеров id_token на маркеры доступа, но это нерекомендуемый подход.

Чтобы обойти это изменение, можно сделать следующее.

1. Создайте веб-aPI для приложения с одним или несколько областями. Такая явная точка входа позволит обеспечить более точный контроль и защиту.
1. В манифесте вашего приложения, на [портале Azure](https://portal.azure.com) или [портале регистрации приложений](https://apps.dev.microsoft.com), убедитесь, что приложению разрешено выдавать маркеры доступа через неявный поток. Это определяется с помощью ключа `oauth2AllowImplicitFlow`.
1. Когда клиентское приложение запрашивает id_token через `response_type=id_token`,`response_type=token`также запросить токен доступа () для веб-API, созданный выше. Таким образом при использовании конечной точки версии 2.0 параметр `scope` должен выглядеть примерно так: `api://GUID/SCOPE`. В конечной точке версии 1.0 параметр `resource` должен быть универсальным кодом ресурса (URI) приложения веб-API.
1. Передайте этот маркер доступа на средний уровень вместо id_token.
