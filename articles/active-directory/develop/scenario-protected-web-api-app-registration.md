---
title: Защищенный веб-API — Регистрация приложения | Azure
description: Узнайте, как создать защищенный веб-API и сведения, необходимые для регистрации приложения.
services: active-directory
documentationcenter: dev-center-name
author: jmprieur
manager: CelesteDG
editor: ''
ms.service: active-directory
ms.subservice: develop
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 05/07/2019
ms.author: jmprieur
ms.custom: aaddev
ms.collection: M365-identity-device-management
ms.openlocfilehash: e4622cffedc159ce85166eafe571ccb26c2c1b4d
ms.sourcegitcommit: 084630bb22ae4cf037794923a1ef602d84831c57
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/03/2019
ms.locfileid: "67536855"
---
# <a name="protected-web-api-app-registration"></a>Защищенный веб-API: Регистрация приложения

В этой статье рассматриваются особенности регистрации приложения для защищенного веб-API.

См. [Краткое руководство. Регистрация приложения в платформе Microsoft identity](quickstart-register-app.md) для общих шагов для регистрации приложения.

## <a name="accepted-token-version"></a>Принятая версия маркера

Конечная точка платформы удостоверений Microsoft может выдавать два вида токенов: v1.0 токенах и токенах версии 2.0. Дополнительные сведения о токенах см. в разделе [маркеры доступа](access-tokens.md). Принятая версия маркера зависит от **поддерживаемые типы учетных записей** вы выбрали при создании приложения:

- Если значение **поддерживаемые типы учетных записей** — **учетные записи в любой каталог организации и личных учетных записей Майкрософт (например Скайп, Xbox, Outlook.com)** , принятая версия маркера будут версии 2.0.
- В противном случае принятая версия маркера будут версии 1.0.

После создания приложения, можно определить или изменить принятая версия маркера, сделав следующее:

1. На портале Azure выберите свое приложение, а затем выберите **манифеста** для вашего приложения.
2. В манифесте, поиск **«accessTokenAcceptedVersion»** . Обратите внимание, что его значение равно **2**. В Azure Active Directory (Azure AD) это свойство указывает, что веб-API принимает маркеров версии 2.0. Если значение равно **null**, принятая версия токена является версия 1.0.
3. Если вы изменили версию маркера, выберите **Сохранить**.

> [!NOTE]
> Веб-API указывает, какие версии маркера (версии 1.0 или 2.0), он принимает. Когда клиенты запрашивают маркер для веб-API из конечной точки версии 2.0 платформы Microsoft identity, они получат маркер, указывающий, какая версия принимается веб-API.

## <a name="no-redirect-uri"></a>Нет URI перенаправления

Веб-API не требуется для регистрации URI перенаправления, так как пользователь не выполнил интерактивном режиме.

## <a name="expose-an-api"></a>Предоставление API

— Это другой параметр, относящиеся к веб-API, предоставляемого API и областей, предоставляемых.

### <a name="resource-uri-and-scopes"></a>URI ресурса и области

Области обычно представлены в виде `resourceURI/scopeName`. Для Microsoft Graph, области имеют сочетания клавиш, таких как `User.Read`. Эта строка представляет собой ярлык для `https://graph.microsoft.com/user.read`.

Во время регистрации приложения необходимо определить следующие параметры:

- URI ресурса. По умолчанию на портал регистрации приложений рекомендует использовать `api://{clientId}`. Этого ресурса (URI) является уникальным, но он не является доступной для чтения. Вы можете его изменить, но убедитесь, что новое значение является уникальным.
- Один или несколько *областей*. (Для клиентских приложений, они появятся как *делегированных разрешений* для веб-API.)
- Один или несколько *роли приложения*. (Для клиентских приложений, они появятся как *разрешения приложения* для веб-API.)

Области также отображаются на экране согласия, которые отображаются для конечных пользователей приложения. Поэтому нужно будет предоставлять соответствующие строки, описывающие область:

- Как видно, конечным пользователем.
- Как видно, администратором клиента, который может предоставить согласие администратора.

### <a name="exposing-delegated-permissions-scopes"></a>Предоставляя делегированные разрешения (области)

1. Выберите **предоставляют API** раздела при регистрации приложения.
1. Нажмите **Добавить группу**.
1. Если будет предложено, примите предложенное URI идентификатора приложения (`api://{clientId}`), выбрав **сохранить и продолжить**.
1. Введите следующие параметры:
      - Для **имя области**, использовать **access_as_user**.
      - Для **кто может предоставить согласие**, убедитесь, что **Администраторы и пользователи** выбран.
      - В **отображаемое имя согласия администратора**, введите **доступ к TodoListService, как пользователь**.
      - В **описание согласия администратора**, введите **обращается к веб-API TodoListService, как пользователь**.
      - В **отображаемое имя согласия пользователя**, введите **доступ к TodoListService, как пользователь**.
      - В **описание согласия пользователя**, введите **обращается к веб-API TodoListService, как пользователь**.
      - Сохранить **состояние** присвоено **включено**.
      - Выберите **добавить область**.

### <a name="if-your-web-api-is-called-by-a-daemon-app"></a>Если веб-API вызывается управляющую программу

В этом разделе вы узнаете, как зарегистрировать защищенный веб-API, поэтому он может безопасно вызываться приложений управляющей программы.

- Вам потребуется предоставить *разрешения приложения*. Будет объявлять только разрешений приложения, поскольку приложений управляющей программы не взаимодействуют с пользователями, поэтому делегированных разрешений не имеет смысла.
- Администраторы у клиента может потребоваться Azure Active Directory (Azure AD) для выдачи маркеров для веб-API только для приложений, которые зарегистрированы для доступа к одному веб-интерфейса API разрешений приложения.

#### <a name="exposing-application-permissions-app-roles"></a>Предоставляя разрешения приложений (роли приложений).

Чтобы предоставить разрешения приложения, необходимо изменить манифест.

1. При регистрации приложения для вашего приложения, выберите **манифеста**.
1. Изменить манифест, найдя `appRoles` задание и добавление одной или нескольких ролей приложения. Определение роли предоставляется в приведенного ниже примера JSON. Оставьте `allowedMemberTypes` присвоено `"Application"` только. Убедитесь, что `id` — уникальный идентификатор GUID и что `displayName` и `value` не содержат пробелов.
1. Сохраните манифест.

В следующем примере показано содержимое `appRoles`. ( `id` Может быть любой уникальный GUID.)

```JSon
"appRoles": [
    {
    "allowedMemberTypes": [ "Application" ],
    "description": "Accesses the TodoListService-Cert as an application.",
    "displayName": "access_as_application",
    "id": "ccf784a6-fd0c-45f2-9c08-2f9d162a0628",
    "isEnabled": true,
    "lang": null,
    "origin": "Application",
    "value": "access_as_application"
    }
],
```

#### <a name="ensuring-that-azure-ad-issues-tokens-for-your-web-api-to-only-allowed-clients"></a>Обеспечение того, что Azure AD выдает маркеры для вашего веб-API, чтобы разрешается использовать только для клиентов

Веб-API проверяет для роли приложения. (Это разработчиков способ предоставления разрешений приложения). Но можно также настроить Azure AD для выдачи маркера для веб-API только к приложениям, утвержденные администратором клиента для доступа к API. Чтобы добавить этот Повышенная безопасность:

1. В приложении **Обзор** странице регистрации приложения, перейдите по ссылке с именем приложения в разделе **управляемого приложения в локальном каталоге**. Заголовок для этого поля могут быть усечены. Вы может например, см. в разделе **управляемое приложение в...**

   > [!NOTE]
   >
   > Когда вы щелкните эту ссылку, вы сможете **Общие сведения о корпоративных приложений** страницы, связанные с субъектом-службой для вашего приложения в клиенте, где она была создана. Можно перейти на страницу регистрации приложения с помощью кнопки "Назад" браузера.

1. Выберите **свойства** странице в **управление** разделе страниц приложения Enterprise.
1. Если требуется Azure AD, чтобы разрешить доступ к веб-API только от определенных клиентов, задать **требуется назначение пользователей?** для **Да**.

   > [!IMPORTANT]
   >
   > Если задать **требуется назначение пользователей?** для **Да**, Azure AD будет проверять назначения ролей приложения клиентов, при запросе маркера доступа для веб-API. Если клиент не назначены роли приложения, Azure AD будет возвращать ошибку `invalid_client: AADSTS501051: Application <application name> is not assigned to a role for the <web API>`.
   >
   > Если вы храните **требуется назначение пользователей?** присвоено **нет**, *Azure AD не проверяет назначения ролей приложения, когда клиент запрашивает маркер доступа для веб-API*. Любой клиент управляющей программы (то есть любой клиент с помощью потока учетных данных клиента), смогут получить маркер доступа для API, просто указав его целевой аудитории. Любое приложение смогут получить доступ к API без необходимости запрашивать разрешения для него. Но веб-API можно всегда, как описано в предыдущем разделе, убедитесь, что приложение имеет подходящую специализацию (который авторизован, администратор клиента). API выполняет эту проверку, проверяя, что токен доступа содержит роли утверждения и то, что значение это утверждение верно. (В нашем случае — значение `access_as_application`.)

1. Щелкните **Сохранить**.

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Конфигурации кода приложения](scenario-protected-web-api-app-configuration.md)
