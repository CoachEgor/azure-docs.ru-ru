---
title: Защищенный веб-API — Регистрация приложения | Azure
description: Сведения о создании защищенных веб-API и сведения, необходимые для регистрации приложения.
services: active-directory
documentationcenter: dev-center-name
author: jmprieur
manager: CelesteDG
editor: ''
ms.service: active-directory
ms.subservice: develop
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 05/07/2019
ms.author: jmprieur
ms.custom: aaddev
ms.collection: M365-identity-device-management
ms.openlocfilehash: 22fe71c38678ae789a93ecbc956f24f0b0ebeb01
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "67111130"
---
# <a name="protected-web-api---app-registration"></a>Защищенный веб-API — Регистрация приложения

В этой статье рассматриваются особенности регистрации приложения для защищенного веб-API.

См. [Краткое руководство. Регистрация приложения в платформе Microsoft identity](quickstart-register-app.md) общие действия по регистрации приложения.

## <a name="accepted-token-version"></a>Принятая версия маркера

Конечная точка платформы удостоверений Microsoft может выдавать два вида токенов: v1.0 токенах и токенах версии 2.0. Дополнительные сведения об этих токенов в [маркеры доступа](access-tokens.md). Принятая версия маркера зависит от **поддерживаемые типы учетных записей** вы выбрали при создании приложения:

- Если значение **поддерживаемые типы учетных записей** — **учетные записи в любой каталог организации и личных учетных записей Майкрософт (например Скайп, Xbox, Outlook.com)** , принятая версия маркера будут версии 2.0.
- В противном случае принятая версия маркера будут версии 1.0.

После создания приложения, принятая версия маркера можно изменить, выполнив следующие действия:

1. На портале Azure выберите свое приложение, а затем выберите **манифеста** для вашего приложения.
2. В манифесте, поиск **«accessTokenAcceptedVersion»** и увидите, что его значение равно **2**. Это свойство позволяет узнать, что веб-API принимает маркеров версии 2.0 Azure AD. Если это **null**, принятая версия маркера будут версии 1.0.
3. Щелкните **Сохранить**.

> [!NOTE]
> Он работает в веб-API, чтобы решить, какие версии маркера (версии 1.0 или 2.0), он принимает. Когда клиенты запрашивают маркер для веб-API, использование конечной точки версии 2.0 платформы Microsoft identity, они получат маркер, указывающий, какая версия принимается веб-API.

## <a name="no-redirect-uri"></a>Нет URI перенаправления

Веб-API не требуется для регистрации URI перенаправления, так как пользователь не вошедшего в систему интерактивно.

## <a name="expose-an-api"></a>Предоставление API

— Это другой параметр, относящиеся к веб-API, предоставляемого API и областей, предоставляемых.

### <a name="resource-uri-and-scopes"></a>URI ресурса и области

Области обычно имеют вид `resourceURI/scopeName`. Для Microsoft Graph, области имеют сочетания клавиш, таких как `User.Read`, но эта строка представляет собой просто ярлыком для `https://graph.microsoft.com/user.read`.

Во время регистрации приложения необходимо определить следующие параметры:

- URI - ресурса по умолчанию на портал регистрации приложений рекомендует использовать `api://{clientId}`. Этого ресурса (URI) является уникальным, но он не является доступной для чтения. Вы можете его изменить, но убедитесь, что он является уникальным.
- Один или несколько **областей** (для клиентских приложений, они будут отображаться как **делегированных разрешений** для веб-API)
- Один или несколько **роли приложения** (для клиентских приложений, они будут отображаться как **разрешения приложения** для веб-API)

Области также отображаются на экране согласия, которые отображаются для конечных пользователей, которые используют приложение. Таким образом необходимо предоставлять соответствующие строки, описывающие область:

- Как видно пользователю
- Как явствует администратора клиента, который может предоставить согласие администратора

### <a name="how-to-expose-delegated-permissions-scopes"></a>Как предоставить делегированные разрешения (области)

1. Выберите **предоставляют API** раздела при регистрации приложения, и:
   1. Нажмите **Добавить группу**.
   1. При запросе, примите предложенное URI идентификатора приложения (api :// {clientId}), выбрав **сохранить и продолжить**.
   1. Задайте следующие параметры:
      - Для **имя области**, используйте `access_as_user`.
      - Для **кто может предоставить согласие**, убедитесь, что **Администраторы и пользователи** выбран параметр.
      - В **отображаемое имя согласия администратора**, тип `Access TodoListService as a user`.
      - В **описание согласия администратора**, тип `Accesses the TodoListService Web API as a user`.
      - В **отображаемое имя согласия пользователя**, тип `Access TodoListService as a user`.
      - В **описание согласия пользователя**, тип `Accesses the TodoListService Web API as a user`.
      - Сохранить **состояние** присвоено **включено**.
      - Выберите **добавить область**.

### <a name="case-where-your-web-api-is-called-by-daemon-application"></a>Случай, где веб-API вызывается приложением управляющей программы

В этом абзаце вы узнаете, как зарегистрировать защищенных веб-API, чтобы к нему можно обращаться безопасно приложениями управляющей программы:

- Вам потребуется предоставить **разрешения приложения**. Разрешения приложения будет объявлять только в том случае, как управляющая программа приложения не взаимодействуют с пользователями, и поэтому делегированные разрешения будет не имеет смысла.
- Администраторы у клиента может потребоваться Azure AD для выдачи маркеров для веб-приложения, чтобы только те приложения, которые зарегистрированы, которые требуется сделать доступными, одно из разрешений приложения веб-API.

#### <a name="how-to-expose-application-permissions-app-roles"></a>Как предоставить разрешения приложений (роли приложений).

Чтобы предоставить разрешения приложения, необходимо изменить манифест.

1. При регистрации приложения для вашего приложения, нажмите кнопку **манифеста**.
1. Изменить манифест, найдя `appRoles` задание и добавление одного или нескольких ролей приложений. Определение роли предоставляется в ниже блок JSON образцов.  Оставьте `allowedMemberTypes` «Application» только. Убедитесь, что **идентификатор** представляет собой уникальный идентификатор guid и **displayName** и **значение** не содержать пробелов.
1. Сохраните манифест.

Содержание `appRoles` должно быть следующее ( `id` может быть любой уникальный идентификатор GUID)

```JSon
"appRoles": [
    {
    "allowedMemberTypes": [ "Application" ],
    "description": "Accesses the TodoListService-Cert as an application.",
    "displayName": "access_as_application",
    "id": "ccf784a6-fd0c-45f2-9c08-2f9d162a0628",
    "isEnabled": true,
    "lang": null,
    "origin": "Application",
    "value": "access_as_application"
    }
],
```

#### <a name="how-to-ensure-that-azure-ad-issues-tokens-for-your-web-api-only-to-allowed-clients"></a>Как убедиться, что Azure AD выдает маркеры для веб-API только к допускается клиентов

Веб-API проверяет для роли приложения (то есть способ разработчика). Но даже можно настроить Azure Active Directory для выдачи маркера для веб-API только для приложений, которые были утверждены администратором клиента для доступа к API. Чтобы добавить этот повышенный уровень безопасности:

1. В приложении **Обзор** странице регистрации приложения, выберите гиперссылку с именем приложения в **управляемого приложения в локальном каталоге**. Заголовок для этого поля может быть усечен. Можно например, прочитать: `Managed application in ...`

   > [!NOTE]
   >
   > При выборе этой ссылки, произойдет переход **Общие сведения о корпоративных приложений** страницы, связанные с субъектом-службой для вашего приложения в клиенте, где она была создана. Можно перейти на страницу регистрации приложения с помощью кнопки "Назад" браузера.

1. Выберите **свойства** странице в **управление** разделе страниц приложения Enterprise
1. AAD для обеспечения доступа к веб-API только от определенных клиентов, задайте **требуется назначение пользователей?** для **Да**.

   > [!IMPORTANT]
   >
   > Установив **требуется назначение пользователей?** для **Да**, AAD проверяет назначения ролей приложения из клиентов при запросе маркера доступа для веб-API. Если клиент был не назначен любой AppRoles, AAD просто возвращает следующую ошибку: `invalid_client: AADSTS501051: Application xxxx is not assigned to a role for the xxxx`
   >
   > Если вы храните **требуется назначение пользователей?** для **нет**, <span style='background-color:yellow; display:inline'>Azure AD не проверяет назначения ролей приложения, когда клиент запрашивает маркер доступа для веб-API</span>. Таким образом любой клиент управляющей программы (то есть любой клиент с помощью потока учетных данных клиента), по-прежнему сможет получить маркер доступа для API, просто указав его целевой аудитории. Любое приложение, будут иметь доступ к API без необходимости запрашивать разрешения для него. Теперь эта возможность не затем конец, веб-API можно всегда, как описано в следующем разделе, убедитесь, что приложение имеет подходящую специализацию (который был авторизован администратора клиента), путем проверки того, что токен доступа содержит `roles` утверждения и правильного значения для t его утверждения (в нашем случае `access_as_application`).

1. Нажмите кнопку **Сохранить**.

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Конфигурации кода приложения](scenario-protected-web-api-app-configuration.md)
