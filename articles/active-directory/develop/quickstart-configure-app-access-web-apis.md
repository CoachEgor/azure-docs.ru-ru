---
title: Краткое руководство. Настройка приложения для доступа к веб-API | Azure
titleSuffix: Microsoft identity platform
description: В этом кратком руководстве показано, как настроить в приложении, зарегистрированном на платформе удостоверений Майкрософт, URI перенаправления, учетные данные или разрешения для доступа к веб-API.
services: active-directory
author: rwike77
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: quickstart
ms.workload: identity
ms.date: 08/05/2020
ms.author: ryanwi
ms.custom: aaddev
ms.reviewer: lenalepa, aragra, sureshja
ms.openlocfilehash: 800b399e73be032cfd9d2849b004018aa9d9031f
ms.sourcegitcommit: b8702065338fc1ed81bfed082650b5b58234a702
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2020
ms.locfileid: "88120870"
---
# <a name="quickstart-configure-a-client-application-to-access-a-web-api"></a>Краткое руководство. Настройка клиентского приложения для доступа к веб-API

В этом кратком руководстве показано, как добавить в приложение URI перенаправления, учетные данные или разрешения для доступа к веб-API. Чтобы участвовать в потоке предоставления кода авторизации, требующего проверки подлинности, конфиденциальное клиентское приложение или веб-приложение должно получить безопасные учетные данные. По умолчанию на портале Azure используется метод аутентификации "идентификатор клиента + секретный ключ". Во время этого процесса приложение получает маркер доступа.

Чтобы клиент смог получить доступ к веб-API, предоставляемому приложением ресурсов (например, API Microsoft Graph), платформа согласия должна обеспечить получение клиентом требуемого разрешения для запрошенных прав доступа. По умолчанию все приложения могут запрашивать разрешения из API Microsoft Graph.

## <a name="prerequisites"></a>Предварительные требования

* Учетная запись Azure с активной подпиской. [Создайте учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F) бесплатно.
* Завершение [краткого руководства по настройке приложения для предоставления веб-API ](quickstart-configure-app-expose-web-apis.md).

## <a name="sign-in-to-the-azure-portal-and-select-the-app"></a>Войдите на портал Azure и выберите приложение.

1. Войдите на [портал Azure](https://portal.azure.com) с помощью личной учетной записи Майкрософт либо рабочей или учебной учетной записи.
1. Если учетная запись предоставляет доступ к нескольким клиентам, выберите нужную учетную запись справа в верхнем углу. Настройте в сеансе портала нужный клиент Azure AD.
1. Найдите и выберите **Azure Active Directory**. В разделе **Управление** выберите **Регистрация приложений**.
1. Найдите и выберите приложение, которое нужно настроить. После выбора приложения появится страница **Обзор** приложения или главная страница регистрации.

Выполните следующие процедуры для настройки доступа к веб-API в приложении.

## <a name="add-redirect-uris-to-your-application"></a>Добавление URI перенаправления в приложение

Вы можете добавить в приложение пользовательские и предложенные URI перенаправления. Чтобы добавить пользовательский URI перенаправления для общедоступных клиентских приложений и веб-приложений, сделайте следующее:

1. На странице **Обзор** для приложения выберите **Проверка подлинности**.
1. Найдите здесь **Пользовательские URI перенаправления**. Возможно, для этого придется выбрать действие **Вернуться к старому интерфейсу**.
1. Выберите тип приложения, которое вы создаете — **Веб** или **Общедоступный/собственный клиент (мобильный и классический)** .
1. Введите URI перенаправления для приложения.

   * Для веб-приложений укажите основной URL-адрес приложения. Например, выполняемое на локальном компьютере веб-приложение может иметь адрес `http://localhost:31544`. Пользователи будут использовать этот URL-адрес для входа в приложение веб-клиента.
   * Для общедоступных приложений укажите URI, который использует AAD для возвращения ответов маркера. Укажите значение, используемое в вашем приложении, например `https://MyFirstApp`.
1. Щелкните **Сохранить**.

Чтобы выбрать некоторые из предлагаемых URI перенаправления для общедоступных клиентов, сделайте следующее:

1. На странице **Обзор** для приложения выберите **Проверка подлинности**.
1. Найдите элемент **Предлагаемые URI перенаправления для общедоступных клиентов (мобильные устройства, компьютеры)** Возможно, для этого придется выбрать действие **Вернуться к старому интерфейсу**.
1. Выберите для приложения один или несколько URI перенаправления. Вы также можете ввести пользовательский URI перенаправления. Если вы не уверены, что использовать, ознакомьтесь с документацией по библиотеке.
1. Щелкните **Сохранить**.

Для URI перенаправления применяются определенные ограничения. См. сведения об [ограничениях для URI перенаправления и URL-адресов ответа](./reply-url.md).

> [!NOTE]
> Ознакомьтесь с новым интерфейсом для настройки **проверки подлинности**, который позволяет указать для приложения параметры по критериям целевой платформы и (или) устройства.
>
> Чтобы увидеть это представление, выберите **Попробовать новый пользовательский интерфейс** на странице **Проверка подлинности**.
>
> ![Щелкните "Попробовать новый интерфейс", чтобы открыть представление для настройки платформы.](./media/quickstart-update-azure-ad-app-preview/authentication-try-new-experience-cropped.png)
>
> Откроется [новая страница  **Настройка платформы**](#configure-platform-settings-for-your-application).

### <a name="configure-advanced-settings-for-your-application"></a>Настройка расширенных параметров для приложения

В зависимости от того, какое приложение вы регистрируете, может потребоваться настройка дополнительных параметров, например:

* **URL-адрес выхода**.
* Для одностраничных приложений можно включить **неявное предоставление разрешения** и выбрать маркеры, которые будет выдавать конечная точка проверки авторизации.
* Для классических приложений, которые получают маркеры через встроенную проверку подлинности Windows, поток кода устройства или имя пользователя и пароль, в разделе **Тип клиента по умолчанию** настройте для параметра **Считать приложение общедоступным клиентом.** значение **Да**.
* Для устаревших приложений, которые использовали ранее Live SDK для интеграции со службой учетная записью Майкрософт, включите **поддержку Live SDK**. Для новых приложений этот параметр не требуется.
* **Тип клиента по умолчанию**.
* **Поддерживаемые типы учетных записей**.

### <a name="modify-supported-account-types"></a>Изменение поддерживаемых типов учетных записей

**Поддерживаемые типы учетных записей** определяют, кто может использовать приложение или обращаться к API.

Если вы настроили поддерживаемые типы учетных записей при регистрации приложения, этот параметр можно будет изменять только через редактор манифестов приложений и только в следующих случаях:

* когда вы изменяете типы учетных записей с **AzureADMyOrg** или **AzureADMultipleOrgs** на **AzureADandPersonalMicrosoftAccount** или наоборот,
* или изменяете типы учетных записей с **AzureADMyOrg** на **AzureADMultipleOrgs** или наоборот.

Чтобы изменить поддерживаемые типы учетных записей для существующей регистрации приложения, обновите ключ `signInAudience`. См. сведения о [настройке манифеста приложения](reference-app-manifest.md#configure-the-app-manifest).

## <a name="configure-platform-settings-for-your-application"></a>Настройка параметров платформы для приложения

![Настройка параметров приложения для конкретной платформы или устройства](./media/quickstart-update-azure-ad-app-preview/authentication-new-platform-configurations.png)

Чтобы настроить параметры приложения на основе платформы или устройства, необходимо выбрать целевой объект.

1. На странице **Конфигурации платформ** выберите **Добавить платформу** и выберите один из доступных параметров.

   ![Отображение страницы "Конфигурации платформ"](./media/quickstart-update-azure-ad-app-preview/authentication-platform-configurations-configure-platforms.png)

1. Введите сведения о параметрах для выбранной платформы.

   | Платформа                | Параметры конфигурации            |
   |-------------------------|-----------------------------------|
   | **Web**              | Введите **URI перенаправления** для приложения. |
   | **iOS, macOS**              | Введите **Идентификатор набора** для приложения, который можно найти в XCode в файле Info.plist или в разделе "Параметры сборки". Добавление идентификатора набора автоматически создает для приложения URI перенаправления. |
   | **Android**          | Укажите для приложения **имя пакета**, которое указано в файле AndroidManifest.xml.<br/>Создайте и введите **хэш подписи**. Добавление хэша подписи автоматически создает для приложения URI перенаправления.  |
   | **Мобильные и классические приложения**  | Необязательный параметр. Если вы создаете приложения для настольных компьютеров и устройств, выберите один из **рекомендуемых URI перенаправления**.<br/>Необязательный параметр. Введите **Пользовательский URI перенаправления**, который обозначает расположение для перенаправления пользователей из Azure AD в ответ на запросы проверки подлинности. Например, для приложений .NET Core, в которых требуется взаимодействие, используйте `http://localhost`. |

   > [!NOTE]
   > В службах федерации Active Directory (AD FS) и Azure AD B2C нужно также указать номер порта.  Например: `http://localhost:1234`.

   > [!IMPORTANT]
   > Для мобильных приложений, которые не используют последнюю библиотеку MSAL и не используют брокер, необходимо настроить URI перенаправления в поле **Рабочий стол и устройства**.

В зависимости от выбранной платформы для настройки могут быть доступны дополнительные параметры. Для **веб-приложений** можно настроить следующее.

* Добавление URI перенаправления
* Настройте для **неявного предоставления разрешения** те токены, которые должна выдавать конечная точка авторизации.

  * Для одностраничных приложений выберите одновременно **Токены доступа** и **Маркеры идентификации**.
  * Для веб-приложений выберите только **Маркеры идентификации.**

## <a name="add-credentials-to-your-web-application"></a>Добавление учетных данных в веб-приложение

Чтобы добавить учетные данные в веб-приложение, добавьте сертификат или создайте секрет клиента. Чтобы добавить сертификат, сделайте следующее:

1. На странице **Обзор** для приложения выберите раздел **Сертификаты и секреты**.
1. Выберите **Отправить сертификат**.
1. Выберите файл, который вы хотите отправить. Он должен быть одного из следующих типов файлов: CER, PEM, CRT.
1. Выберите **Добавить**.

Чтобы добавить секрет клиента, сделайте следующее:

1. На странице **Обзор** для приложения выберите раздел **Сертификаты и секреты**.
1. Выберите **Создать секрет клиента**.
1. Добавьте описание секрета клиента.
1. Выберите длительность.
1. Выберите **Добавить**.

> [!NOTE]
> Правый столбец будет содержать значение секрета клиента после сохранения изменений конфигурации. **Не забудьте скопировать значение** для использования в коде клиентского приложения, так как оно станет недоступно после закрытия страницы.

## <a name="add-permissions-to-access-web-apis"></a>Добавление разрешений для доступа к веб-API

[Разрешение API Graph на вход в систему и чтение профиля пользователя](https://developer.microsoft.com/graph/docs/concepts/permissions_reference#user-permissions) будет выбрано по умолчанию. Для каждого веб-API вы можете выбрать один из [двух типов разрешений](developer-glossary.md#permissions).

* **Разрешения приложения.** Ваше клиентское приложение будет обращаться к веб-API от своего имени без контекста пользователя. Для таких разрешений требуется согласие администратора. Это разрешение недоступно для настольных и мобильных клиентских приложений.
* **Делегированные разрешения.** Вашему приложению требуется доступ к веб-API от лица выполнившего вход пользователя, но с ограничением доступа по выбранному разрешению. Этот тип разрешения может быть предоставлен пользователем, если только для разрешения не требуется согласие администратора.

  > [!NOTE]
  > Когда вы добавляете в приложение делегированные разрешения, согласие не предоставляется автоматически для всех пользователей в клиенте. Пользователи должны по-прежнему вручную предоставлять согласие на дополнительные делегированные разрешения в среде выполнения, если администратор не дает согласие от имени всех пользователей.

Чтобы добавить разрешения на доступ к API ресурсов из клиента, сделайте следующее:

1. На странице **Обзор** для приложения выберите **Разрешения API**.
1. В разделе **Настроенные разрешения** выберите **Добавить разрешение**.
1. По умолчанию в представлении будет доступен выбор из **API Майкрософт**. Выберите раздел API, который вас интересует:

    * **API Майкрософт.** Позволяет выбрать разрешения для API Майкрософт, например Microsoft Graph.
    * **API, используемые моей организацией.** Позволяет выбрать разрешения для API, которые предоставляются вашей организацией или с которыми она интегрирована.
    * **Мои API.** Позволяет выбрать разрешения для API, которые вы предоставили.

1. После выбора API-интерфейсов появится страница **Запрос разрешений API**. Если API предоставляет делегированные разрешения и разрешения приложения, выберите тип разрешений, который требуется вашему приложению.
1. После выбора щелкните **Добавить разрешения**.

Вы вернетесь на страницу **Разрешения API**. Выбранные разрешения будут сохранены и добавлены в таблицу.

## <a name="understanding-api-permissions-and-admin-consent-ui"></a>Основные сведения о разрешениях API и пользовательском интерфейсе согласия администратора

### <a name="configured-permissions"></a>Настроенные разрешения

В этом разделе приведены сведения о разрешениях, которые были явно настроены для объекта приложения. Эти разрешения входят в список разрешений, требуемых для получения доступа к ресурсам приложения. Вы можете добавлять разрешения в эту таблицу и удалять их из нее. Администратор также может предоставить или отозвать согласие для набора разрешений или отдельных разрешений API.

### <a name="other-permissions-granted"></a>Другие предоставленные разрешения

Если приложение зарегистрировано в клиенте, вы можете увидеть дополнительный раздел с названием **Другие разрешения, предоставленные клиенту**. В этом разделе описаны разрешения, которые предоставлены для клиента, явным образом настроенного для объекта приложения. Для этих разрешений были динамически выполнены запрос и предоставление согласия. Этот раздел отображается, только если имеется хотя бы одно подходящее разрешение.

Вы можете добавить набор разрешений или отдельные разрешения API, которые отображаются в этом разделе, в раздел **Настроенные разрешения**. Администратор может также отозвать согласие для отдельных API или разрешений в этом разделе.

### <a name="admin-consent-button"></a>Кнопка согласия администратора

Если приложение зарегистрировано в клиенте, здесь отображается кнопка **Предоставить согласие администратора для клиента**. Если вы не администратор или для приложения не настроены разрешения, эта кнопка будет неактивной.
С ее помощью администратор может предоставить согласие на разрешения, настроенные для приложения. При нажатии кнопки согласия администратора открывается новое окно с запросом на продолжение, в котором отображаются все настроенные разрешения.

> [!NOTE]
> Между настройкой разрешений для приложения и их отображением в запросе на продолжение существует задержка. Если вы не видите все настроенные разрешения в запросе на продолжение, закройте его и запустите снова.

Если у вас есть разрешения, которые были предоставлены, но не настроены, кнопка согласия администратора поможет вам их обработать. Вы можете добавить их в настроенные разрешения или удалить.

В запросе на продолжение доступны два параметра: **Принять** или **Отмена**. Выберите **Принять**, чтобы предоставить согласие администратора. Если вы нажмете **Отмена**, согласие администратора не будет предоставлено. Появится ошибка с сообщением о том, что согласие было отклонено.

> [!NOTE]
> Изменение состояния согласия в пользовательском интерфейсе после предоставления согласия администратора (кнопкой **Принять** в соответствующем запросе) происходит с задержкой.

## <a name="next-steps"></a>Дальнейшие действия

Перейдите к следующему краткому руководству в серии, чтобы узнать, как настроить доступ к приложению для определенных типов учетных записей. Например, вы можете предоставить доступ только пользователям в организации (один арендатор) или разрешить доступ пользователям из других арендаторов Azure AD (несколько арендаторов) и пользователям с личными учетными записями Майкрософт (MSA).

> [!div class="nextstepaction"]
> [Краткое руководство. Изменение учетных записей, поддерживаемых приложением (предварительная версия)](quickstart-modify-supported-accounts.md)