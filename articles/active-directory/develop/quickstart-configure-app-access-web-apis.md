---
title: Настройка приложения для доступа к интерфейсам веб-API с помощью платформы удостоверений Майкрософт | Azure
description: Сведения о настройке приложения, зарегистрированного с помощью платформы удостоверений Майкрософт для включения универсального кода ресурса (URI) перенаправления, учетных данных или разрешений для доступа к веб-API.
services: active-directory
author: rwike77
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: quickstart
ms.workload: identity
ms.date: 08/07/2019
ms.author: ryanwi
ms.custom: aaddev
ms.reviewer: lenalepa, aragra, sureshja
ms.openlocfilehash: 32691892ccae31541855f47bd8274aa28b6dc185
ms.sourcegitcommit: af6847f555841e838f245ff92c38ae512261426a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2020
ms.locfileid: "76704295"
---
# <a name="quickstart-configure-a-client-application-to-access-web-apis"></a>Краткое руководство. Настройка клиентского приложения для доступа к веб-API

Чтобы клиентское конфиденциальное или веб-приложение могло участвовать в потоке предоставления кода авторизации, требующего проверки подлинности (и получения маркера доступа), ему необходимо установить безопасные учетные данные. По умолчанию на портале Azure используется метод аутентификации "идентификатор клиента + секретный ключ".

Кроме того, чтобы клиент смог получить доступ к веб-API, предоставляемому приложением ресурсов (например, API Microsoft Graph), платформа согласия должна позволить ему получить требуемое разрешение в зависимости от запрошенных разрешений. По умолчанию все приложения могут выбирать разрешения из API Microsoft Graph. [Разрешение API Graph "Вход в систему и чтение профиля пользователя"](https://developer.microsoft.com/graph/docs/concepts/permissions_reference#user-permissions) будет выбрано по умолчанию. Можно выбрать из [двух типов разрешений](developer-glossary.md#permissions) для каждого требуемого веб-API:

* **Разрешения приложения**. Вашему клиентскому приложению требуется доступ к веб-API от своего имени (без контекста пользователя). Этот тип разрешения требует согласия администратора и недоступен для общедоступных (классических и мобильных) клиентских приложений.
* **Делегированное разрешение**. Вашему приложению требуется доступ к веб-API от лица выполнившего вход пользователя, но с ограничением доступа по выбранному разрешению. Этот тип разрешения может быть предоставлен пользователем, если только для разрешения не требуется согласие администратора.

  > [!NOTE]
  > Когда вы добавляете в приложение делегированные разрешения, согласие не предоставляется автоматически для всех пользователей в клиенте. Пользователи должны по-прежнему вручную предоставлять согласие на дополнительные делегированные разрешения в среде выполнения, если администратор не дает согласие от имени всех пользователей.

В этом кратком руководстве мы покажем, как настроить приложение для выполнения следующих задач:

* [Добавьте URI перенаправления в приложение](#add-redirect-uris-to-your-application).
* [Настройка расширенных параметров для приложения](#configure-advanced-settings-for-your-application)
* [Изменение поддерживаемых типов учетных записей](#modify-supported-account-types)
* [Добавление учетных данных в веб-приложение](#add-credentials-to-your-web-application)
* [Добавьте разрешения для доступа к веб-API](#add-permissions-to-access-web-apis).

## <a name="prerequisites"></a>Предварительные требования

Чтобы приступить к работе, выполните следующие предварительные требования:

* Ознакомьтесь с общими сведениями о поддерживаемых [разрешениях и согласии](v2-permissions-and-consent.md). Для создания приложений, которые будут использовать другие пользователи или приложения, это важно понимать.
* Установите клиент, содержащий зарегистрированные приложения.
  * Если у вас нет зарегистрированных приложений, [ознакомьтесь со сведениями о регистрации приложений с помощью платформы удостоверений Майкрософт](quickstart-register-app.md).

## <a name="sign-in-to-the-azure-portal-and-select-the-app"></a>Войдите на портал Azure и выберите приложение.

Чтобы настроить приложение, выполните следующие действия.

1. Войдите на [портал Azure](https://portal.azure.com) с помощью личной учетной записи Майкрософт либо рабочей или учебной учетной записи.
1. Если учетная запись предоставляет доступ нескольким клиентам, выберите свою учетную запись в правом верхнем углу и нужный клиент Azure AD для этого сеанса портала.
1. Найдите и выберите **Azure Active Directory**. 
1. В левой области щелкните **Регистрация приложений**.
1. Найдите и выберите приложение, которое нужно настроить. После выбора приложения появится страница **Обзор** приложения или главная страница регистрации.
1. Выполните действия по настройке приложения для доступа к веб-API:
    * [Добавьте URI перенаправления в приложение](#add-redirect-uris-to-your-application).
    * [Настройка расширенных параметров для приложения](#configure-advanced-settings-for-your-application)
    * [Изменение поддерживаемых типов учетных записей](#modify-supported-account-types)
    * [Добавление учетных данных в веб-приложение](#add-credentials-to-your-web-application)
    * [Добавьте разрешения для доступа к веб-API](#add-permissions-to-access-web-apis).

## <a name="add-redirect-uris-to-your-application"></a>Добавление URI перенаправления в приложение

Чтобы добавить URI перенаправления в приложение, сделайте следующее:

1. На странице **Обзор** выберите раздел **Проверка подлинности**.
1. Чтобы добавить пользовательский URI перенаправления для общедоступных клиентских приложений и веб-приложений, сделайте следующее:
   1. Найдите раздел **URI перенаправления**.
   1. Выберите тип приложения, которое вы создаете — **Веб** или **общедоступного клиента (для мобильных и классических приложений)** .
   1. Введите URI перенаправления для приложения.
      * Для веб-приложений укажите основной URL-адрес приложения. Например, выполняемое на локальном компьютере веб-приложение может иметь адрес `http://localhost:31544`. Пользователи будут использовать этот URL-адрес для входа в приложение веб-клиента.
      * Для общедоступных приложений укажите URI, который использует AAD для возвращения ответов маркера. Укажите значение, используемое в вашем приложении, например `https://MyFirstApp`.

1. Чтобы выбрать из предлагаемых URI перенаправления для общедоступных клиентов (мобильные устройства, компьютеры), сделайте следующее:
    1. Найдите раздел о предлагаемых **URI перенаправления для общедоступных клиентов (мобильные устройства, компьютеры)** .
    1. Выберите соответствующий URI перенаправления для приложения с помощью флажков. Вы также можете ввести пользовательский URI перенаправления. Если вы не уверены, что использовать, ознакомьтесь с документацией по библиотеке.

Существуют определенные ограничения, которые применяются для URI перенаправления. Дополнительные сведения см. в статье [Ограничения для универсального кода ресурса (URI) перенаправления и URL-адреса ответа](https://docs.microsoft.com/azure/active-directory/develop/reply-url).
> [!NOTE]
> Ознакомьтесь с новым интерфейсом для настройки **проверки подлинности**, который позволяет указать для приложения параметры по критериям целевой платформы и (или) устройства.
>
> Чтобы увидеть это представление, выберите **Попробовать новый пользовательский интерфейс** в стандартном представлении страницы **Проверка подлинности**.
>
> ![Щелкните "Попробовать новый интерфейс", чтобы открыть представление для настройки платформы.](./media/quickstart-update-azure-ad-app-preview/authentication-try-new-experience-cropped.png)
>
> Откроется [новая страница  **Настройка платформы**](#configure-platform-settings-for-your-application).

### <a name="configure-advanced-settings-for-your-application"></a>Настройка расширенных параметров для приложения

В зависимости от того, какое приложение вы регистрируете, может потребоваться настройка дополнительных параметров, например:

* **URL-адрес выхода**.
* Для одностраничных приложений можно включить **неявное предоставление разрешения** и выбрать маркеры, которые будет выдавать конечная точка проверки авторизации.
* Для классических приложений, которые получают маркеры через интеграцию с проверкой подлинности Windows, потоком кода устройства или по имени пользователя и паролю, выберите в разделе **Тип клиента по умолчанию** для параметра **Считать приложение общедоступным клиентом.** значение **Да**.
* Для устаревших приложений, которые использовали ранее Live SDK для интеграции со службой учетная записью Майкрософт, включите **поддержку Live SDK**. Для новых приложений этот параметр не требуется.
* **Тип клиента по умолчанию**

### <a name="modify-supported-account-types"></a>Изменение поддерживаемых типов учетных записей

**Поддерживаемые типы учетных записей** определяют, кто может использовать приложение или обращаться к API.

Когда вы завершите [настройку поддерживаемых типов учетных записей](quickstart-register-app.md) при первоначальной регистрации приложения, этот параметр можно будет изменять только через редактор манифестов приложений и только в следующих случаях.

* Когда вы изменяете типы учетных записей с **AzureADMyOrg** или **AzureADMultipleOrgs** на **AzureADandPersonalMicrosoftAccount** или наоборот.
* Когда вы изменяете типы учетных записей с **AzureADMyOrg** на **AzureADMultipleOrgs** или наоборот.

Чтобы изменить поддерживаемые типы учетных записей для существующей регистрации приложения, выполните следующие действия.

* По инструкциям из статьи [о настройке манифеста приложения](reference-app-manifest.md) обновите ключ `signInAudience`.

## <a name="configure-platform-settings-for-your-application"></a>Настройка параметров платформы для приложения

[![Настройка параметров приложения на основе платформы или устройства](./media/quickstart-update-azure-ad-app-preview/authentication-new-platform-configurations-expanded.png)](./media/quickstart-update-azure-ad-app-preview/authentication-new-platform-configurations-small.png#lightbox)

Чтобы настроить параметры приложения на основе платформы или устройства, необходимо выбрать целевой объект.

1. На странице **Конфигурации платформ** выберите **Добавить платформу** и выберите один из доступных параметров.

   ![Отображение страницы "Конфигурации платформ"](./media/quickstart-update-azure-ad-app-preview/authentication-platform-configurations-configure-platforms.png)

1. Введите сведения о параметрах для выбранной платформы.

   | Платформа                | Варианты              | Параметры конфигурации            |
   |-------------------------|----------------------|-----------------------------------|
   | **Веб-приложения**    | **Web**              | Введите **URI перенаправления** для приложения. |
   | **Мобильные приложения** | **iOS**              | Введите **Идентификатор набора** для приложения, который можно найти в XCode в файле Info.plist или в разделе "Параметры сборки". Добавление идентификатора набора автоматически создает для приложения URI перенаправления. |
   |                         | **Android**          | * Укажите для приложения **Имя пакета**, которое указано в файле AndroidManifest.xml.<br/>* Создайте и введите **хэш подписи**. Добавление хэша подписи автоматически создает для приложения URI перенаправления.  |
   | **Рабочий стол и устройства**   | **Рабочий стол и устройства** | * Необязательно. Если вы создаете приложения для настольных компьютеров и устройств, выберите один из **рекомендуемых URI перенаправления**.<br/>* Необязательно. Введите **Пользовательский URI перенаправления**, который обозначает расположение для перенаправления пользователей из Azure AD в ответ на запросы проверки подлинности. Например, для приложений .NET Core, в которых требуется взаимодействие, используйте `https://localhost`. |

   > [!IMPORTANT]
   > Для мобильных приложений, которые не используют последнюю библиотеку MSAL и не используют брокер, необходимо настроить URI перенаправления в поле **Рабочий стол и устройства.**

1. В зависимости от выбранной платформы для настройки могут быть доступны дополнительные параметры. Для **веб-приложений** можно настроить следующее.
    * Добавление URI перенаправления
    * Настройте для **неявного предоставления разрешения** те токены, которые должна выдавать конечная точка авторизации.
        * Для одностраничных приложений выберите одновременно **Токены доступа** и **Маркеры идентификации**.
        * Для веб-приложений выберите только **Маркеры идентификации.**

## <a name="add-credentials-to-your-web-application"></a>Добавление учетных данных в веб-приложение

Чтобы добавить учетные данные в веб-приложение, сделайте следующее:

1. На странице **Обзор** выберите раздел **Сертификаты и секреты**.

1. Для добавления сертификата сделайте следующее:

    1. Выберите **Отправить сертификат**.
    1. Выберите файл, который вы хотите отправить. Он должен быть одного из следующих типов файлов: CER, PEM, CRT.
    1. Выберите **Добавить**.

1. Для добавления секрета клиента сделайте следующее:

    1. Выберите **Создать секрет клиента**.
    1. Добавьте описание секрета клиента.
    1. Выберите длительность.
    1. Выберите **Добавить**.

> [!NOTE]
> Правый столбец будет содержать значение секрета клиента после сохранения изменений конфигурации. **Не забудьте скопировать значение** для использования в коде клиентского приложения, так как оно станет недоступно после закрытия страницы.

## <a name="add-permissions-to-access-web-apis"></a>Добавление разрешений для доступа к веб-API

Чтобы добавить разрешения для доступа к API ресурсов из клиента, сделайте следующее:

1. На странице **Обзор** приложения выберите **Разрешения API**.
1. В разделе **Настроенные разрешения** нажмите кнопку **Добавить разрешение**.
1. По умолчанию в представлении будет доступен выбор из **API Майкрософт**. Выберите раздел API, который вас интересует:
    * **API Майкрософт** — позволяет выбрать разрешения для API Майкрософт, например Microsoft Graph.
    * **Интерфейсы API, используемые моей организацией** — позволяют выбрать разрешения для API, предоставленные организацией, или API, с которыми интегрирована организация.
    * **Мои API** — позволяет выбрать разрешения для API, которые вы предоставили.
1. После выбора API-интерфейсов появится страница **Запрос разрешений API**. Если API предоставляет делегированные разрешения и разрешения приложения, выберите тип разрешений, который требуется вашему приложению.
1. После выбора щелкните **Добавить разрешения**. Вы вернетесь на страницу **Разрешения API**, где разрешения были сохранены и добавлены в таблицу.

## <a name="understanding-api-permissions-and-admin-consent-ui"></a>Основные сведения о разрешениях API и пользовательском интерфейсе согласия администратора

### <a name="configured-permissions"></a>Настроенные разрешения

В этом разделе приведены сведения о разрешениях, которые были явно настроены для объекта приложения (разрешения, необходимые для доступа к ресурсам приложения). Вы можете добавлять разрешения в эту таблицу и удалять их из нее. Администратор также может предоставить или отозвать согласие для набора разрешений или отдельных разрешений API в этом разделе.

### <a name="other-permissions-granted"></a>Другие предоставленные разрешения

Если приложение зарегистрировано в клиенте, вы можете увидеть дополнительный раздел с названием **Другие разрешения, предоставленные клиенту**. В этом разделе отображаются разрешения, которые были предоставлены клиенту, но не были явно настроены для объекта приложения (например, разрешения, которые были динамически запрошены и утверждены). Этот раздел отображается, только если имеется хотя бы одно подходящее разрешение.

Вы можете добавить набор разрешений или отдельные разрешения API, которые отображаются в этом разделе, в раздел **Настроенные разрешения**. Администратор может также отозвать согласие для отдельных API или разрешений в этом разделе.

### <a name="admin-consent-button"></a>Кнопка согласия администратора

Если приложение зарегистрировано в клиенте, вы увидите кнопку **Предоставить согласие администратора для клиента**. Если вы не администратор или если для приложения не настроены разрешения, эта кнопка неактивна.
Эта кнопка позволяет администратору легко предоставить согласие на разрешения, настроенные для приложения. При нажатии кнопки согласия администратора открывается новое окно с запросом на продолжение, в котором отображаются все настроенные разрешения.

> [!NOTE]
> Между настройкой разрешений для приложения и их отображением в запросе на продолжение существует задержка. Если вы не видите все настроенные разрешения в запросе на продолжение, закройте его и запустите снова.

Если у вас есть разрешения, которые были предоставлены, но не настроены, при нажатии кнопки согласия администратора вам будет предложено решить, как обрабатывать их. Вы можете добавить их в настроенные разрешения или удалить.

В запросе на продолжение доступны два параметра: **Принять** или **Отмена**. Если нажать кнопку **Принять**, вы предоставите согласие администратора. Если выбрать **Отмена**, согласие администратора не предоставляется и появится сообщение об ошибке, в котором указано, что предоставление согласия отклонено.

> [!NOTE]
> Между предоставлением согласия администратора (нажатие кнопки **Принять** в запросе на продолжение) и изменением состояния согласия в пользовательском интерфейсе существует задержка.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о других кратких руководствах по управлению приложениями см. в следующих ресурсах:

* [Краткое руководство: регистрация приложения с помощью платформы удостоверений Майкрософт (предварительная версия)](quickstart-register-app.md)
* [Краткое руководство. Настройка приложения для доступа к веб-API (предварительная версия)](quickstart-configure-app-expose-web-apis.md)
* [Краткое руководство. Изменение учетных записей, поддерживаемых приложением (предварительная версия)](quickstart-modify-supported-accounts.md)
* [Краткое руководство. Удаление приложения, зарегистрированного с помощью платформы удостоверений Майкрософт (предварительная версия)](quickstart-remove-app.md)

Дополнительные сведения о двух объектах Azure AD, представляющих зарегистрированное приложение, и о взаимосвязи между ними см. в разделе [Объекты приложения и субъекта-службы в Azure Active Directory (Azure AD)](app-objects-and-service-principals.md).

Дополнительные сведения о фирменной символике, которой следует пользоваться при разработке приложений в среде Azure Active Directory (Azure AD) см. в разделе [Рекомендации по фирменной символике для приложений](howto-add-branding-in-azure-ad-apps.md).
