---
title: Проверка подлинности на платформе удостоверений Майкрософт | Azure
description: Узнайте об основах проверки подлинности на платформе Microsoft Identity Platform (v 2.0).
services: active-directory
author: rwike77
manager: CelesteDG
ms.assetid: 0c84e7d0-16aa-4897-82f2-f53c6c990fd9
ms.service: active-directory
ms.subservice: develop
ms.topic: conceptual
ms.workload: identity
ms.date: 12/18/2019
ms.author: ryanwi
ms.reviewer: jmprieur, saeeda, sureshja, hirsin
ms.custom: aaddev, identityplatformtop40, scenarios:getting-started
ms.openlocfilehash: 6712c89431b13e939ef298020e5a2e7d288856cc
ms.sourcegitcommit: af6847f555841e838f245ff92c38ae512261426a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2020
ms.locfileid: "76698039"
---
# <a name="authentication-basics"></a>Основные сведения об аутентификации

## <a name="what-is-authentication"></a>Что такое проверка подлинности

В этой статье рассматриваются многие основные понятия проверки подлинности, которые необходимо знать для создания защищенных веб-приложений, веб-API или приложений, вызывающих защищенные веб-API.

**Проверка подлинности** — это процесс подтверждения того, что вы говорите. Аутентификация иногда сокращенно обозначается AuthN (Authentication).

**Авторизация** — это действие предоставления проверяющей стороны разрешения на выполнение каких-либо действий. Он определяет, к каким данным разрешен доступ и что можно делать с этими данными. Авторизация иногда сокращенно обозначается AuthZ (Authorization).

Вместо создания приложений, каждый из которых хранит свои собственные сведения о имени пользователя и пароле, что влечет за собой высокий уровень административной нагрузки при необходимости добавления или удаления пользователей в нескольких приложениях, приложения могут делегировать ответственность за централизованный поставщик удостоверений.

Azure Active Directory (Azure AD) — это централизованный поставщик удостоверений в облаке. Делегирование проверки подлинности и авторизации в него позволяет выполнять такие сценарии, как политики условного доступа, требующие, чтобы пользователь найдет в определенном расположении, использовать многофакторную проверку подлинности, а также разрешить пользователю входить один раз, а затем автоматически Вход во все веб-приложения, которые используют один и тот же централизованный каталог. Эта возможность называется единым входом (SSO).

Централизованный поставщик удостоверений является еще более важным для приложений, имеющих пользователей по всему миру, которые не обязательно входят в сеть предприятия. Azure AD выполняет проверку подлинности пользователей и предоставляет маркеры доступа. Маркер доступа — это маркер безопасности, выданный сервером авторизации. Он содержит сведения о пользователе и приложении, для которых предназначен маркер, который можно использовать для доступа к веб-API и другим защищенным ресурсам.

Платформа идентификации Майкрософт упрощает проверку подлинности для разработчиков приложений, предоставляя удостоверение в качестве службы с поддержкой стандартных отраслевых протоколов, таких как OAuth 2,0 и OpenID Connect Connect, а также библиотек с открытым исходным кодом для различных платформы, помогающие быстро начать программировать. С ее помощью разработчики могут создавать приложения, которые обеспечивают вход с помощью любых удостоверений Майкрософт, получают маркеры для вызова Microsoft Graph, других программных интерфейсов Майкрософт или API, созданных разработчиками. Дополнительные сведения см. в [статье развитие платформы идентификации Майкрософт](about-microsoft-identity-platform.md).

### <a name="tenants"></a>Клиенты

Облачный поставщик удостоверений обслуживает множество организаций. Чтобы пользователи из разных организаций разделялись друг от друга, Azure AD разделяется на клиенты, с одним клиентом на организацию.

Клиенты отслеживают пользователей и связанные с ними приложения. Платформа Microsoft Identity также поддерживает пользователей, которые входят в систему с помощью личных учетных записей Майкрософт.

Azure AD также предоставляет Azure Active Directory B2C, чтобы организации могли входить в систему пользователей, как правило, с помощью социальных удостоверений, таких как учетная запись Google. Дополнительные сведения см. в [документации по Azure Active Directory B2C](https://docs.microsoft.com/azure/active-directory-b2c) .

### <a name="security-tokens"></a>Маркеры безопасности Центра Интернета вещей

Маркеры безопасности содержат сведения о пользователях и приложениях. Azure AD использует токены на основе JSON (JWT), которые содержат утверждения. Утверждение предоставляет утверждения о одной сущности в другую. Приложения могут использовать утверждения для различных задач, таких как:

* Проверка маркера
* Определение клиента каталога субъекта
* Отображение сведений о пользователе
* Определение авторизации субъекта

Утверждение состоит из пар «ключ-значение», которые предоставляют следующие сведения:

- Сервер маркеров безопасности, создавший токен.
- Дата создания маркера.
- Тема, например пользователь (за исключением управляющих программ).
- аудитория, которая является приложением, для которого был создан маркер.
- приложение (клиент), которое запросило токен. В случае веб-приложений это может быть то же самое, что и аудитория.

Более подробные сведения об утверждениях см. в статье [маркеры доступа](access-tokens.md) и [идентификаторы](id-tokens.md)маркеров.

Это приложение, для которого был создан маркер, веб-приложение, выполнившего вход пользователя или вызываемый веб-API, для проверки маркера. Маркер подписывается сервером маркеров безопасности (STS) с закрытым ключом. STS публикует соответствующий открытый ключ. Чтобы проверить маркер, приложение проверяет подпись с помощью открытого ключа STS, чтобы проверить, была ли подпись создана с помощью закрытого ключа.

Маркеры допустимы только в течение ограниченного периода времени. Как правило, STS предоставляет пару токенов: маркер доступа для доступа к приложению или защищенному ресурсу, а также маркер обновления, используемый для обновления маркера доступа, когда маркер доступа близок к истечению срока действия. 

Маркеры доступа передаются в веб-интерфейс API в качестве токена носителя в заголовке `Authorization`. Приложение может предоставить службе STS маркер обновления, и если пользователь не отменил доступ к приложению, он получит новый маркер доступа и новый маркер обновления. Таким способом обрабатывается ситуация, когда кто-то выходит из Организации. Когда STS получает маркер обновления, он не будет выдавать другой действительный маркер доступа, если пользователь больше не является полномочным.

## <a name="application-model"></a>Модель приложения

Приложения могут входить в систему самих пользователей или делегировать вход поставщику удостоверений. Сведения о сценариях входа, поддерживаемых Azure AD, см. в статье [потоки проверки подлинности и сценарии приложений](authentication-flows-app-scenarios.md) .

Чтобы поставщик удостоверений знал, что пользователь имеет доступ к конкретному приложению, как пользователь, так и приложение должны быть зарегистрированы в поставщике удостоверений. При регистрации приложения в Azure AD вы предоставляете конфигурацию удостоверения для приложения, которое позволяет интегрировать его с Azure AD. Регистрация приложения также позволяет:

- Настройте фирменную символику приложения в диалоговом окне входа. Это важно, так как это первый интерфейс пользователя, который будет иметь приложение.
- Решите, следует ли разрешить пользователям входить в систему только в том случае, если они принадлежат вашей организации. Это приложение одного клиента. Или разрешить пользователям входить с помощью любой рабочей или учебной учетной записи. Это приложение с несколькими клиентами. Вы также можете разрешить доступ к личным учетным записям Майкрософт или учетной записи социальных сетей из LinkedIn, Google и т. д.
- запрос разрешения области. Например, можно запросить область "пользователь. Read", которая предоставляет разрешение на чтение профиля пользователя, выполнившего вход.
- Определите области, определяющие доступ к веб-API. Как правило, когда приложению требуется доступ к API, ему необходимо запросить разрешения для определенных областей.
- Поделитесь с Azure AD секретным кодом, который подтверждает удостоверение приложения в Azure AD.  Это касается случая, когда приложение является конфиденциальным клиентским приложением. Конфиденциальное клиентское приложение — это приложение, которое может безопасно хранить учетные данные. Для хранения учетных данных им требуется доверенный внутренний сервер.

После регистрации приложению будет предоставлен идентификатор GUID, который приложение использует совместно с Azure AD при запросе токенов. Если приложение является конфиденциальным клиентским приложением, оно также будет использовать секрет или открытый ключ в зависимости от того, использовались ли сертификаты или секреты.

Платформа Microsoft Identity представляет приложения, использующие модель, выполняющую две основные функции:

Идентификация приложения по протоколам проверки подлинности, которые он поддерживает, и предоставление всех идентификаторов, URL-адресов, секретов и связанных сведений, необходимых для проверки подлинности.
Платформа Microsoft Identity:

* Содержит все данные, необходимые для поддержки проверки подлинности во время выполнения.
* Содержит все данные для решения о том, к каким ресурсам может потребоваться доступ приложению, и при каких обстоятельствах необходимо выполнить данный запрос.
* Предоставляет инфраструктуру для реализации подготовки приложений в клиенте разработчика приложения и в любом другом клиенте Azure AD.
* Обрабатывает согласие пользователя во время запроса маркера и упрощает динамическую подготовку приложений для клиентов.

Согласие — это процесс предоставления владельцу ресурса авторизации для доступа клиентского приложения к защищенным ресурсам в соответствии с конкретными разрешениями от имени владельца ресурса. Платформа Microsoft Identity:

* позволяет пользователям и администраторам динамически предоставлять или отзывать согласие для приложения на доступ к ресурсам от их имени;
* позволяет администраторам единолично решить, какие действия разрешены приложениям, какие пользователи могут использовать определенные приложения и каким способом осуществляется доступ к ресурсам каталога.

В платформе Microsoft Identity **объект приложения** описывает приложение как абстрактную сущность. Во время развертывания платформа Microsoft Identity использует объект приложения в качестве схемы для создания **субъекта-службы**, который представляет конкретный экземпляр приложения в каталоге или клиенте. Субъект-служба определяет, что приложение может реально выполнять в определенном целевом каталоге, кто может его использовать, какие ресурсы он имеет доступ и т. д. Платформа Microsoft Identity создает субъект-службу из объекта приложения с помощью **согласия**.

На следующей схеме показан упрощенный процесс подготовки платформы удостоверений Майкрософт на основе согласия. В нем показаны два клиента (A и B). Клиент а владеет приложением. Клиент б создает экземпляр приложения с помощью субъекта-службы.  

![Упрощенный процесс подготовки на основе согласия](./media/authentication-scenarios/simplified-provisioning-flow-consent-driven.svg)

В этом процессе подготовки:

1. Пользователь клиента B пытается выполнить вход в приложение. Конечная точка авторизации запрашивает маркер безопасности для приложения.
1. Учетные данные пользователя будут получены и проверены на проверку подлинности.
1. Пользователю предлагается предоставить согласие на получение доступа к клиенту б для приложения.
1. Платформа Microsoft Identity использует объект приложения в клиенте а в качестве схемы для создания субъекта-службы в клиенте б.
1. Пользователь получает запрошенный маркер.

Этот процесс можно повторить для дополнительных клиентов. Клиент A сохраняет схему для приложения (объект приложения). Пользователи и администраторы всех других клиентов, на которых приложение получает согласие, контролируйте, что приложение может выполнять через соответствующий объект субъекта-службы в каждом клиенте. Дополнительные сведения см. в [этой статье](app-objects-and-service-principals.md).

## <a name="web-app-sign-in-flow-with-azure-ad"></a>Процесс входа в веб-приложение с помощью Azure AD

Когда пользователь переходит в браузер в веб-приложение, происходит следующее:

- Веб-приложение определяет, прошел ли пользователь проверку подлинности.
- Если пользователь не прошел проверку подлинности, веб-приложение делегирует в Azure AD вход пользователя. Этот вход будет соответствовать политике Организации. это может означать, что пользователь должен ввести свои учетные данные, использовать многофакторную проверку подлинности или вообще не использовать пароль (например, с помощью Windows Hello).
- Пользователю предлагается согласие на доступ, который требуется клиентскому приложению. Именно поэтому клиентские приложения должны быть зарегистрированы в Azure AD, чтобы служба Azure AD могла предоставлять маркеры, представляющие доступ, на который пользователь предоставил право.

При успешной проверке подлинности пользователя:

- Azure AD отправляет маркер в веб-приложение.
- Файл cookie сохраняется, связанный с доменом Azure AD, который содержит удостоверение пользователя в JAR-файле cookie браузера. В следующий раз, когда приложение использует браузер для перехода к конечной точке авторизации Azure AD, браузер представляет файл cookie, чтобы пользователю не нужно было снова входить в систему. Это также способ достижения единого входа. Файл cookie создается в Azure AD и может быть понятен только в Azure AD.
- Затем веб-приложение проверяет маркер. Если проверка будет выполнена, веб-приложение отобразит защищенную страницу и сохранит файл cookie сеанса в файле JAR файла cookie браузера. Когда пользователь переходит на другую страницу, веб-приложение знает, что проверка подлинности пользователя выполняется на основе файла cookie сеанса.

Это взаимодействие обобщено на следующей схеме последовательностей:

![процесс проверки подлинности веб-приложения](media/authentication-scenarios/web-app-how-it-appears-to-be.png)

### <a name="how-a-web-app-determines-if-the-user-is-authenticated"></a>Как веб-приложение определяет, прошел ли пользователь проверку подлинности

Разработчики веб-приложений могут указать, требуется ли проверка подлинности для всех или только определенных страниц. Например, в ASP.NET/ASP.NET Core это можно сделать, добавив атрибут `[Authorize]` к действиям контроллера. 

Этот атрибут заставляет ASP.NET проверять наличие файла cookie сеанса, содержащего идентификатор пользователя. Если файл cookie отсутствует, ASP.NET перенаправляет проверку подлинности в указанный поставщик удостоверений. Если поставщиком удостоверений является Azure AD, веб-приложение перенаправляет проверку подлинности в https://login.microsoftonline.com, в котором отображается диалоговое окно входа.

### <a name="how-a-web-app-delegates-sign-in-to-azure-ad-and-obtains-a-token"></a>Как веб-приложение делегирует вход в Azure AD и получает маркер

Проверка подлинности пользователя осуществляется через браузер. Протокол OpenID Connect использует стандартные сообщения протокола HTTP.
- Веб-приложение отправляет в браузер HTTP 302 (Redirect) для использования Azure AD.
- При проверке подлинности пользователя Azure AD отправляет маркер в веб-приложение с помощью перенаправления через браузер.
- Перенаправление предоставляется веб-приложением в форме URI перенаправления. Этот URI перенаправления зарегистрирован в объекте приложения Azure AD. Может существовать несколько URI перенаправления, поскольку приложение может быть развернуто по нескольким URL-адресам. Поэтому веб-приложению также потребуется указать URi перенаправления для использования.
- Azure AD проверяет, что URI перенаправления, отправленный веб-приложением, является одним из зарегистрированных URI перенаправления для приложения.

## <a name="desktop-and-mobile-app-sign-in-flow-with-azure-ad"></a>Поток входа настольных и мобильных приложений с помощью Azure AD

Описанный выше поток применим и с незначительными отличиями к настольным и мобильным приложениям.

Для проверки подлинности настольные и мобильные приложения могут использовать встроенный веб-элемент управления или системный браузер. На следующей схеме показано, как настольное или мобильное приложение использует библиотеку проверки подлинности Майкрософт (MSAL) для получения маркеров доступа и вызова веб-API.

![Настольное приложение, как оно выглядит](media/authentication-scenarios/desktop-app-how-it-appears-to-be.png)

MSAL использует браузер для получения маркеров, а так же, как и в случае с веб-приложениями, делегирует проверку подлинности в Azure AD.

Так как Azure AD сохраняет в браузере тот же файл cookie удостоверения, что и для веб-приложений, если в собственном или мобильном приложении используется системный браузер, он немедленно получит единый вход с соответствующим веб-приложением.

По умолчанию MSAL использует системный браузер, за исключением .NET Framework классических приложений, в которых используется внедренный элемент управления для обеспечения более тесного взаимодействия с пользователем.

## <a name="next-steps"></a>Дальнейшие действия

- Общие термины см. в [глоссарии разработчика платформы удостоверений Майкрософт](developer-glossary.md) .
- Дополнительные сведения о других сценариях проверки подлинности пользователей, поддерживаемых платформой идентификации Майкрософт, см. в статье [потоки проверки подлинности и сценарии приложений](authentication-flows-app-scenarios.md) .
- Сведения о библиотеках Майкрософт, которые помогут разрабатывать приложения, работающие с учетными записями Майкрософт, учетными записями Azure AD, а также Azure AD B2C пользователями в единой и простой модели программирования, см. в разделе [библиотеки MSAL](msal-overview.md) .
- Сведения о настройке проверки подлинности для приложения службы приложений см. в статье [Интеграция службы приложений с платформой Microsoft Identity](/azure/app-service/configure-authentication-provider-aad) .
