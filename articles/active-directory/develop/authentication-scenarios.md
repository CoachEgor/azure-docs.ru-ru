---
title: Проверка подлинности на платформе удостоверений Майкрософт | Azure
description: Узнайте об основах аутентификации в платформе идентификации Майкрософт (v2.0).
services: active-directory
author: rwike77
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: conceptual
ms.workload: identity
ms.date: 02/03/2020
ms.author: ryanwi
ms.reviewer: jmprieur, saeeda, sureshja, hirsin
ms.custom: aaddev, identityplatformtop40, scenarios:getting-started
ms.openlocfilehash: e78f822a88b093992f065a509c2250e6a5c0dec2
ms.sourcegitcommit: d187fe0143d7dbaf8d775150453bd3c188087411
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80885571"
---
# <a name="authentication-basics"></a>Основные сведения об аутентификации

## <a name="what-is-authentication"></a>Что такое аутентификация

Эта статья охватывает многие концепции аутентификации, которые необходимо понимать для создания защищенных веб-приложений, веб-aI или приложений, вызывающих защищенные Web-аДИ. Если вы видите термин, с которым вы не знакомы, попробуйте наш [глоссарий](developer-glossary.md) или наши [видео платформы Microsoft,](identity-videos.md) которые охватывают основные концепции.

**Аутентификация** – это процесс доказывания того, как вы, как вы, являетесь тем, за кого себя выдаешь. Аутентификация иногда сокращенно обозначается AuthN (Authentication).

**Авторизация** является актом предоставления аутентифицированного разрешения стороны на что-то. В нем указывается, к каким данным разрешен доступ и что вы можете сделать с этими данными. Авторизация иногда сокращенно обозначается AuthZ (Authorization).

Вместо создания приложений, каждый из которых поддерживает свое собственное имя пользователя и информацию о паролях, что несет высокую административную нагрузку, когда вам нужно добавить или удалить пользователей в нескольких приложениях, приложения могут делегировать эту ответственность централизованному поставщику идентификационных данных.

Активный каталог Azure (Azure AD) является централизованным поставщиком идентификационных данных в облаке. Делегирование аутентификации и авторизации к нему позволяет такие сценарии, как политики условного доступа, которые требуют, чтобы пользователь был в определенном месте, использование многофакторной аутентификации, а также позволяет пользователю войти один раз, а затем автоматически войти во все веб-приложения, которые разделяют тот же централизованный каталог. Эта возможность называется Единым Знаком On (SSO).

Централизованный поставщик идентификационных данных является еще более важным для приложений, пользователей которых есть пользователи, расположенные по всему миру, которые не обязательно входят в систему предприятия. Azure AD проверяет подлинность пользователей и предоставляет токены доступа. [Токен доступа](https://docs.microsoft.com/azure/active-directory/develop/developer-glossary#access-token) — это маркер безопасности, выдаваемый сервером авторизации. Он содержит информацию о пользователе и приложении, для которого предназначен токен; которые могут быть использованы для доступа к Web AA и другим защищенным ресурсам.

Платформа microsoft identity упрощает аутентификацию для разработчиков приложений, предоставляя идентификационные данные как услугу, поддерживая стандартные для отраслей протоколы, такие как [OAuth 2.0](https://oauth.net/2/) и [OpenID Connect,](https://openid.net/connect/)а также библиотеки с открытым исходным кодом для различных платформ, чтобы помочь вам быстро начать кодирование. Это позволяет разработчикам создавать приложения, которые вписываются во все идентификаторы Майкрософт, получать токены для вызова [Microsoft Graph,](https://developer.microsoft.com/graph/)других ABI Microsoft или ABI, созданных разработчиками. Для получения дополнительной [информации см.](about-microsoft-identity-platform.md)

### <a name="tenants"></a>Клиенты

Поставщик облачных идентификационных данных обслуживает многие организации. Чтобы держать пользователей из разных организаций отдельно, Azure AD разделен на арендаторов, с одним арендатором на организацию.

Арендаторы отслеживают пользователей и связанные с ними приложения. Платформа идентификации Майкрософт также поддерживает пользователей, которые вписываются в личные учетные записи Майкрософт.

Azure AD также предоставляет Azure Active Directory B2C, чтобы организации могли регистрироватьпользователей, как правило, клиентов, используя социальные идентификаторы, такие как учетная запись Google. Для получения дополнительной информации смотрите [документацию Azure Active Directory B2C.](https://docs.microsoft.com/azure/active-directory-b2c)

### <a name="security-tokens"></a>Маркеры безопасности Центра Интернета вещей

Токены безопасности содержат информацию о пользователях и приложениях. Azure AD использует токены на основе JSON (JWTs), содержащие претензии.

Претензия предоставляет утверждения об одной организации, например [клиентское приложение](https://docs.microsoft.com/azure/active-directory/develop/developer-glossary#client-application) или [владелец ресурса,](https://docs.microsoft.com/azure/active-directory/develop/developer-glossary#resource-owner)другой организации, например [серверресурса.](https://docs.microsoft.com/azure/active-directory/develop/developer-glossary#resource-server)

Претензии — это пары имен/значений, которые передают факты о объекте токена. Например, претензия может содержать факты о доверии безопасности, который был проверен [сервером авторизации.](https://docs.microsoft.com/azure/active-directory/develop/developer-glossary#authorization-server) Претензии, присутствующие в данном маркере, зависят от многих вещей, включая тип токена, тип учетных данных, используемый для проверки подлинности объекта, конфигурацию приложения и так далее.

Приложения могут использовать требования для различных задач, таких как:

* Проверка токена
* Определение арендатора объекта токена
* Отображение информации о пользователе
* Определение разрешения субъекта

Претензия состоит из пар с ключевымзначением, которые предоставляют информацию, такую как:

* Сервер маркеров безопасности, сгенерированный маркером
* Дата сгенерированного токена
* Тема (например, пользователь - за исключением деймонов)
* Аудитория, которая является приложением, для которого был создан токен
* Приложение (клиент), который попросил маркер. В случае веб-приложений это может быть так же, как и аудитория

Для получения более подробной информации о претензиях смотрите [токены доступа](access-tokens.md) и [токены ID.](id-tokens.md)

Это до приложения, для которого был создан маркер, веб-приложение, которое вписалось в пользователя, или веб-API вызывается, для проверки маркера. Токен подписывается сервером безопасности (STS) с закрытым ключом. СТС публикует соответствующий открытый ключ. Для проверки маркера приложение проверяет подпись, используя общедоступный ключ STS для проверки того, что подпись была создана с помощью закрытого ключа.

Токены действительны только в течение ограниченного периода времени. Обычно STS предоставляет пару токенов: токен доступа для доступа к приложению или защищенный ресурс, а также маркер обновления, используемый для обновления токена доступа, когда токен доступа близок к истечению.

Токены доступа передаются web API в качестве маркера носителя в заголовке. `Authorization` Приложение может предоставить маркер обновления в STS, и если доступ пользователя к приложению не был отменен, он получит обратно новый маркер доступа и новый маркер обновления. Так обрабатывается сценарий ухода с предприятия. Когда STS получает токен обновления, он не будет выдавать другой действительный маркер доступа, если пользователь больше не авторизован.

### <a name="how-each-flow-emits-tokens-and-codes"></a>Как каждый поток испускает токены и коды

В зависимости от того, как ваш клиент построен, он может использовать один (или несколько) потоков аутентификации, поддерживаемых Azure AD. Эти потоки могут создавать различные токены (id_tokens, обновления токенов, токенов доступа), а также коды авторизации и требуют различных токенов, чтобы заставить их работать. Эта диаграмма содержит обзор:

|Поток | Требуется . | id_token | Twitter, | обновить токен | Код авторизации | 
|-----|----------|----------|--------------|---------------|--------------------|
|[Поток кода авторизации](v2-oauth2-auth-code-flow.md) | | x | x | x | x|  
|[Неявный поток](v2-oauth2-implicit-grant-flow.md) | | x        | x    |      |                    |
|[Гибридный поток OIDC](v2-protocols-oidc.md#get-access-tokens)| | x  | |          |            x   |
|[Обновление выкупа токенов](v2-oauth2-auth-code-flow.md#refresh-the-access-token) | обновить токен | x | x | x| |
|[Поток On-Behalf-Of](v2-oauth2-on-behalf-of-flow.md) | Twitter,| x| x| x| |
|[Учетные данные клиента](v2-oauth2-client-creds-grant-flow.md) | | | x (только для приложений)| | |

Токены, выпущенные через неявный режим, имеют ограничение длины `response_mode` из-за того, что они передаются обратно в браузер через URL (где находится `query` или `fragment`).  Некоторые браузеры имеют ограничение на размер URL, который может быть помещен в строку браузера и не, когда это слишком долго.  Таким образом, эти токены не имеют `groups` или `wids` претензий. 

Теперь, когда у вас есть обзор основ, прочитайте далее, чтобы понять модель приложения и API, узнайте, как работает подготовка в Azure AD, и получите ссылки на подробную информацию об общих сценариях поддержки Azure AD.

## <a name="application-model"></a>Модель приложения

Приложения могут войти в систему самих пользователей или делегировать регистрацию поставщику идентификационных данных. Просмотрите [потоки аутентификации и сценарии приложений,](authentication-flows-app-scenarios.md) чтобы узнать о сценариях вхданных, поддерживаемых Azure AD.

Для того чтобы поставщик удостоверяющих данных знал, что пользователь имеет доступ к определенному приложению, как пользователь, так и приложение должны быть зарегистрированы в поставщике идентификационных данных. При регистрации приложения в Azure AD вы предоставляете конфигурацию идентификации для приложения, которая позволяет интегрироваться с Azure AD. Регистрация приложения также позволяет:

* Настройте брендинг вашего приложения в диалоге. Это важно, потому что это первый опыт, который пользователь будет иметь с вашим приложением.
* Решите, хотите ли вы позволить пользователям войти в систему только в том случае, если они принадлежат вашей организации. Это единственное приложение для арендаторов. Или разрешить пользователям войти в систему с помощью любой учетной записи работы или школы. Это мультитенантное приложение. Вы также можете разрешить личные учетные записи Майкрософт или социальную учетную запись linkedIn, Google и так далее.
* Запрашивайте разрешения на область охвата. Например, можно запросить область "user.read", которая дает разрешение на чтение профиля пользователя, вписавшегося в нее.
* Определите области, определяющие доступ к Web API. Обычно, когда приложение хочет получить доступ к API, ему необходимо запрашивать разрешения в определенных областях.
* Поделитесь секретом с Azure AD, который доказывает идентификацию приложения в Azure AD.  Это имеет отношение в случае, когда приложение является конфиденциальным приложением клиента. Конфиденциальное клиентское приложение — это приложение, которое может надежно хранить учетные данные. Для хранения учетных данных требуется надежный сервер бэкэнда.

После регистрации приложению будет предоставлен уникальный идентификатор, которым приложение делится с Azure AD, когда запрашивает токены. Если приложение является [конфиденциальным клиентским приложением,](https://docs.microsoft.com/azure/active-directory/develop/developer-glossary#client-application)оно также будет делиться секретом или открытым ключом, в зависимости от того, использовались ли сертификаты или секреты.

Платформа идентификации Майкрософт представляет приложения с использованием модели, которая выполняет две основные функции:

* Определите приложение по протоколам аутентификации, которые оно поддерживает
* Предоставьте все идентификаторы, URL-адреса, секреты и связанную с ними информацию, необходимую для проверки подлинности

Платформа идентификации Майкрософт:

* Сохраняет все данные, необходимые для поддержки проверки подлинности во время выполнения
* Хранит все данные для принятия решения о том, к каким ресурсам может потребоваться доступ к приложению и при каких обстоятельствах должен быть выполнен данный запрос
* Предоставляет инфраструктуру для реализации приложения, подготовленного в рамках арендатора разработчика приложения и любого другого арендатора Azure AD
* Обработка согласия пользователя во время запроса токенов и облегчает динамическое предоставление приложений между арендаторами

Согласие — это процесс предоставления владельцем ресурса разрешения на получение клиентского приложения доступа к защищенным ресурсам, по определенным разрешениям, от имени владельца ресурса. Платформа идентификации Майкрософт:

* позволяет пользователям и администраторам динамически предоставлять или отзывать согласие для приложения на доступ к ресурсам от их имени;
* позволяет администраторам единолично решить, какие действия разрешены приложениям, какие пользователи могут использовать определенные приложения и каким способом осуществляется доступ к ресурсам каталога.

В платформе идентификации Майкрософт [объект приложения](https://docs.microsoft.com/azure/active-directory/develop/developer-glossary#application-object) описывает приложение. Во время развертывания платформа майкрософт использует объект приложения в качестве чертежа для создания [основного сервиса,](https://docs.microsoft.com/azure/active-directory/develop/developer-glossary#service-principal-object)который представляет собой конкретный экземпляр приложения в каталоге или арендаторе. Основной сервис определяет, что приложение может на самом деле сделать в определенном целевом каталоге, кто может использовать его, какие ресурсы он имеет доступ к, и так далее. Платформа идентификации Майкрософт создает принцип службы из объекта приложения **на основе согласия.**

На следующей схеме показан упрощенный процесс подготовки платформы удостоверений Майкрософт на основе согласия. Он показывает двух арендаторов: A и B. Арендатор А владеет приложением. Арендатор B мгновенно иннимизирует приложение через директора службы.  

![Упрощенный процесс подготовки на основе согласия](./media/authentication-scenarios/simplified-provisioning-flow-consent-driven.svg)

В этом процессе подготовки:

1. Пользователь клиента B пытается выполнить вход в приложение. Конечная точка авторизации запрашивает маркер безопасности для приложения.
1. Учетные данные пользователей приобретаются и проверяются для проверки подлинности.
1. Пользователю предлагается предоставить согласие на получение доступа к арендатору B.
1. Платформа идентификации Майкрософт использует объект приложения в арендаторе A в качестве плана для создания основного сервиса в арендаторе B.
1. Пользователь получает запрошенный токен.

Вы можете повторить этот процесс для дополнительных арендаторов. Клиент A сохраняет схему для приложения (объект приложения). Пользователи и админы всех других арендаторов, где приложение дается согласие держать контроль над тем, что приложение разрешено делать через соответствующий основной объект службы в каждом арендаторе. Дополнительные сведения см. в [этой статье](app-objects-and-service-principals.md).

## <a name="web-app-sign-in-flow-with-azure-ad"></a>Поток входиного веб-приложения с Azure AD

Когда пользователь переходит в браузере в веб-приложение, происходит следующее:

* Веб-приложение определяет, является ли пользователь аутентифицирован.
* Если пользователь не проверен, веб-приложение делегирует ВС AD Для входа в пользователя. Этот вход будет соответствовать политике организации, что может означать, что пользователь просит ввести свои учетные данные, используя многофакторную аутентификацию или не используя пароль вообще (например, с помощью Windows Hello).
* Пользователю предлагается дать согласие на доступ, который необходим клиентскому приложению. Вот почему клиентские приложения должны быть зарегистрированы в Azure AD, чтобы Azure AD мог поставлять токены, представляющие доступ, на который пользователь дал согласие.

Когда пользователь успешно аутентифицируется:

* Azure AD отправляет токен в веб-приложение.
* Сохраняется файл cookie, связанный с доменом Azure AD, содержащим личность пользователя в банке cookie браузера. В следующий раз, когда приложение использует браузер для навигации по конечной точке авторизации Azure AD, браузер представляет файлы cookie, чтобы пользователю не пришлось снова входить в систему. Это также способ, которым достигается SSO. Печенье производится Azure AD и может быть понято только Azure AD.
* Затем веб-приложение проверяет маркер. Если проверка удалась, веб-приложение отображает защищенную страницу и сохраняет файл cookie сеанса в банке cookie браузера. Когда пользователь переходит на другую страницу, веб-приложение знает, что пользователь проверяется на основе cookie-сеанса.

Следующая диаграмма последовательности обобщает это взаимодействие:

![процесс аутентификации веб-приложений](media/authentication-scenarios/web-app-how-it-appears-to-be.png)

### <a name="how-a-web-app-determines-if-the-user-is-authenticated"></a>Как веб-приложение определяет, проверена ли пользователь

Разработчики веб-приложений могут указать, требуют ли все или только определенные страницы проверки подлинности. Например, в ASP.NET/ASP.NET Core это делается путем добавления атрибута `[Authorize]` в действия контроллера. 

Этот атрибут заставляет ASP.NET проверять наличие файла cookie сеанса, содержащего личность пользователя. Если файл cookie не присутствует, ASP.NET перенаправляет аутентификацию к указанному поставщику идентификационных данных. Если поставщиком идентификационных данных является Azure AD, веб-приложение перенаправляет аутентификацию `https://login.microsoftonline.com`на, который отображает диалог входа.

### <a name="how-a-web-app-delegates-sign-in-to-azure-ad-and-obtains-a-token"></a>Как веб-приложение делегирует войти в Azure AD и получает токен

Проверка подлинности пользователей происходит через браузер. Протокол OpenID использует стандартные сообщения протокола HTTP.
* Веб-приложение отправляет HTTP 302 (перенаправление) в браузер для использования Azure AD.
* Когда пользователь проверяетподлинность, Azure AD отправляет маркер в веб-приложение с помощью перенаправления через браузер.
* Перенаправление обеспечивается веб-приложением в виде перенаправления URI. Этот перенаправление URI зарегистрировано на объектприложения Azure AD. Может быть несколько перенаправления URIs, поскольку приложение может быть развернуто на нескольких URL-адресах. Таким образом, веб-приложение также необходимо указать перенаправление URI для использования.
* Azure AD проверяет, что перенаправление URI, отправленное веб-приложением, является одним из зарегистрированных URL-износов для приложения.

## <a name="desktop-and-mobile-app-sign-in-flow-with-azure-ad"></a>Поток введанных настольных и мобильных приложений с Azure AD

Описанный выше поток применяется с небольшими различиями к настольным и мобильным приложениям.

Для проверки подлинности настольные и мобильные приложения могут использовать встроенный веб-контроль или системный браузер. На следующей диаграмме показано, как приложение Desktop или mobile использует библиотеку аутентификации Майкрософт (MSAL) для получения токенов доступа и вызова web-aIS.

![Настольное приложение, как это кажется](media/authentication-scenarios/desktop-app-how-it-appears-to-be.png)

MSAL использует браузер для получения токенов. Как и в веб-приложениях, аутентификация делегируется Azure AD.

Поскольку Azure AD сохраняет в браузере то же файлы cookie, что и веб-приложения, если родное или мобильное приложение использует системный браузер, оно немедленно получит SSO с соответствующим веб-приложением.

По умолчанию MSAL использует системный браузер. Исключение составляют настольные приложения .NET Framework, где встроенный элемент управления используется для обеспечения более интегрированного пользовательского интерфейса.

## <a name="next-steps"></a>Дальнейшие действия

* Ознакомьтесь с [гнили глоссария разработчика платформы идентификации Майкрософт,](developer-glossary.md) чтобы ознакомиться с общими терминами.
* Просмотрите [потоки аутентификации и сценарии приложений,](authentication-flows-app-scenarios.md) чтобы узнать больше о других сценариях проверки подлинности пользователей, поддерживаемых платформой идентификации Майкрософт.
* Ознакомиться с [библиотеками MSAL](msal-overview.md) можно в библиотеках Майкрософт, которые помогают разрабатывать приложения, которые работают с учетными записями Майкрософт, учетными записями Azure AD и пользователями Azure AD B2C в единой, упорядоченной модели программирования.
* Просмотрите [услугу интеграции приложений с платформой идентификации Майкрософт,](/azure/app-service/configure-authentication-provider-aad) чтобы узнать, как настроить аутентификацию для приложения Службы Приложений.
