---
title: Добавление входа с помощью OIDC в веб-приложение Node.js — платформа удостоверений Майкрософт | Azure
description: Узнайте, как реализовать проверку подлинности в веб-приложении Node.js с помощью подключения OpenID.
services: active-directory
author: jmprieur
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: quickstart
ms.workload: identity
ms.date: 10/28/2019
ms.author: jmprieur
ms.custom: aaddev, identityplatformtop40, scenarios:getting-started, languages:ASP.NET, devx-track-javascript
ms.openlocfilehash: 149ed7aa281e50673c86c0bd7339f304aa63914a
ms.sourcegitcommit: 1b2d1755b2bf85f97b27e8fbec2ffc2fcd345120
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87552685"
---
# <a name="quickstart-add-sign-in-using-openid-connect-to-a-nodejs-web-app"></a>Краткое руководство. Добавление возможности входа в веб-приложение Node.js с помощью OpenID Connect

В этом кратком руководстве вы узнаете, как настроить проверку подлинности подключения OpenID в веб-приложении, созданном с помощью Node.js и Экспресс. Пример предназначен для работы на любой платформе.

## <a name="prerequisites"></a>Предварительные требования

Для запуска этого примера потребуется:

* Установите Node.js из http://nodejs.org/

* [Учетная запись Майкрософт](https://www.outlook.com) или [Программа для разработчиков Microsoft 365](/office/developer-program/office-365-developer-program).

## <a name="register-your-application"></a>Регистрация приложения
1. Войдите на [портал Azure](https://portal.azure.com/) с помощью личной учетной записи Майкрософт либо рабочей или учебной учетной записи.
1. Если ваша учетная запись присутствует в нескольких клиентах Azure AD:
    - Выберите свой профиль в меню в правом верхнем углу страницы, а затем **Переключение каталога**.
    - Измените сеанс на арендатор Azure AD, в котором нужно создать приложение.

1. Выберите [Azure Active Directory > Регистрация приложений >](https://go.microsoft.com/fwlink/?linkid=2083908), чтобы зарегистрировать приложение.

1. Выберите **Новая регистрация.**

1. Когда откроется страница **Регистрация приложения**, введите сведения о регистрации приложения.
    - В разделе **Имя** введите понятное имя, которое будет отображаться пользователям приложения. Пример: MyWebApp
    - В разделе **Поддерживаемые типы учетных записей** выберите **Учетные записи в любом каталоге организации и личные учетные записи Майкрософт (например, Skype, Xbox, Outlook.com)** .

    При наличии нескольких URI перенаправления, их необходимо будет добавить на вкладке **Аутентификация** после успешного создания приложения.

1. Выберите **Зарегистрировать**, чтобы создать приложение.

1. На странице приложения **Обзор** найдите **идентификатор приложения (клиента)** и запишите его, чтобы использовать позже. Это значение потребуется позже в этом проекте для настройки приложения.

1. В списке страниц приложения выберите **Проверка подлинности**.
    - В разделе **URI-коды перенаправления** выберите **Интернет** в поле со списком и введите следующий URI-перенаправления: `http://localhost:3000/auth/openid/return`
    - В разделе **Дополнительные параметры** задайте для параметра **URL-адрес выхода** значение `https://localhost:3000`.
    - В разделе **Дополнительные параметры > Неявное предоставление** установите флажок **Маркеры идентификаторов**, так как в этом примере требуется включить [поток "Неявное предоставление"](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-implicit-grant-flow), чтобы предоставить пользователю вход в систему.

1. Щелкните **Сохранить**.

1. На странице **Сертификаты и секреты** в разделе **Секреты клиента** выберите **Новый секрет клиента**.
    - Введите описание ключа (для экземпляра секрета приложения).
    - Выберите срок действия ключа **1 год, 2 года,** или **Срок действия неограничен**.
    - При нажатии кнопки **Добавить** будет отображаться значение ключа. Скопируйте и сохраните значение ключа в безопасном месте.

    Этот ключ потребуется позже для настройки приложения. Это значение ключа не будет отображаться повторно и не сможет быть извлечено другими способами, поэтому запишите его, как только оно отобразится на портале Azure.

## <a name="download-the-sample-application-and-modules"></a>Загрузка примера приложения и модулей

Затем клонируйте пример репозитория и установите модули NPM.

Из оболочки или командной строки:

`$ git clone git@github.com:AzureADQuickStarts/AppModelv2-WebApp-OpenIDConnect-nodejs.git`

или диспетчер конфигурации служб

`$ git clone https://github.com/AzureADQuickStarts/AppModelv2-WebApp-OpenIDConnect-nodejs.git`

В корневом каталоге проекта выполните команду:

`$ npm install`

## <a name="configure-the-application"></a>Настройка приложения

Укажите параметры в файле `exports.creds` config.js, следуя инструкциям.

* Обновите `<tenant_name>` в `exports.identityMetadata` с именем клиента Azure AD в формате \*.onmicrosoft.com.
* Обновите `exports.clientID`, указав идентификатор приложения, указанный при регистрации приложения.
* Обновите `exports.clientSecret`, указав секрет приложения, указанный при регистрации приложения.
* Обновите `exports.redirectUrl`, указав URI-перенаправления, указанный при регистрации приложения.

**Дополнительные настройки для рабочих приложений:**

* Если вы хотите использовать другую `post_logout_redirect_uri`, обновите `exports.destroySessionUrl` в файле config.js.

* Задайте для параметра `exports.useMongoDBSessionStore` в файле config.js значение "true", если хотите использовать [mongoDB](https://www.mongodb.com) или другие [совместимые хранилища сеансов](https://github.com/expressjs/session#compatible-session-stores).
В этом примере хранилищем сеансов по умолчанию является `express-session`. Хранилище сеансов по умолчанию не подходит для рабочей среды.

* Обновите `exports.databaseUri`, если хотите использовать хранилище сеансов mongoDB и другой URI базы данных.

* Обновите `exports.mongoDBSessionMaxAge`. Здесь можно указать срок хранения сеанса в mongoDB. Единица измерения — секунды.

## <a name="build-and-run-the-application"></a>Создание и запуск приложения

Запустите службу mongoDB. Если в этом приложении вы используете хранилище сеансов mongoDB, вам необходимо сначала [установить mongoDB](http://www.mongodb.org/) и запустить службу. При использовании хранилища сеансов по умолчанию, этот шаг можно пропустить.

Запустите приложение, выполнив в командной строке следующую команду.

```
$ node app.js
```

**Сложно понять вывод сервера?:** Для ведения журнала в этом примере используется `bunyan`. Консоль не будет понятной, если не установить "bunyan" и запустить сервер, как описано выше, но передав его через двоичный файл "bunyan":

```
$ npm install -g bunyan

$ node app.js | bunyan
```

### <a name="youre-done"></a>Готово!

Сервер успешно запущен на `http://localhost:3000`.

[!INCLUDE [Help and support](../../../includes/active-directory-develop-help-support-include.md)]

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о сценарии веб-приложений, поддерживаемом Платформой удостоверений Майкрософт:
> [!div class="nextstepaction"]
> [Scenario: Web app that signs in users](scenario-web-app-sign-user-overview.md) (Сценарий: веб-приложение, которое входит в систему пользователей)
