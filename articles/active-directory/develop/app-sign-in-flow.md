---
title: Поток входа в приложение с платформой Microsoft Identity Службы
titleSuffix: Microsoft identity platform
description: Сведения о потоке входа в веб-, настольных и мобильных приложениях на платформе Microsoft Identity Platform (v 2.0).
services: active-directory
author: rwike77
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: conceptual
ms.workload: identity
ms.date: 04/28/2020
ms.author: ryanwi
ms.reviewer: jmprieur, saeeda, sureshja, hirsin
ms.custom: aaddev, identityplatformtop40, scenarios:getting-started
ms.openlocfilehash: 7b326e17611b5f4b9520d8218a28a67afe9a851a
ms.sourcegitcommit: b9d4b8ace55818fcb8e3aa58d193c03c7f6aa4f1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/29/2020
ms.locfileid: "82584354"
---
# <a name="app-sign-in-flow-with-microsoft-identity-platform"></a>Поток входа в приложение с платформой Microsoft Identity

В этом разделе рассматривается базовый поток входа для веб-, настольных и мобильных приложений с помощью платформы Microsoft Identity. Сведения о сценариях входа, поддерживаемых платформой идентификации Майкрософт, см. в статье [потоки проверки подлинности и сценарии приложений](authentication-flows-app-scenarios.md) .

## <a name="web-app-sign-in-flow"></a>Поток входа веб-приложения

Когда пользователь переходит в браузер в веб-приложение, происходит следующее:

* Веб-приложение определяет, прошел ли пользователь проверку подлинности.
* Если пользователь не прошел проверку подлинности, веб-приложение делегирует в Azure AD вход пользователя. Этот вход будет соответствовать политике Организации. это может означать, что пользователь должен ввести свои учетные данные, использовать многофакторную проверку подлинности или вообще не использовать пароль (например, с помощью Windows Hello).
* Пользователю предлагается согласие на доступ, который требуется клиентскому приложению. Именно поэтому клиентские приложения должны быть зарегистрированы в Azure AD, чтобы платформа Microsoft Identity могла предоставлять маркеры, представляющие доступ, который пользователь предоставил.

При успешной проверке подлинности пользователя:

* Платформа Microsoft Identity отправляет маркер веб-приложению.
* Файл cookie сохраняется, связанный с доменом Azure AD, который содержит удостоверение пользователя в JAR-файле cookie браузера. В следующий раз, когда приложение использует браузер для перехода на конечную точку авторизации платформы идентификации Майкрософт, браузер отображает файл cookie, чтобы пользователю не применялись для входа. Это также способ достижения единого входа. Файл cookie создается в Azure AD и может быть понятен только в Azure AD.
* Затем веб-приложение проверяет маркер. Если проверка будет выполнена, веб-приложение отобразит защищенную страницу и сохранит файл cookie сеанса в файле JAR файла cookie браузера. Когда пользователь переходит на другую страницу, веб-приложение знает, что проверка подлинности пользователя выполняется на основе файла cookie сеанса.

Это взаимодействие обобщено на следующей схеме последовательностей:

![процесс проверки подлинности веб-приложения](media/authentication-scenarios/web-app-how-it-appears-to-be.png)

### <a name="how-a-web-app-determines-if-the-user-is-authenticated"></a>Как веб-приложение определяет, прошел ли пользователь проверку подлинности

Разработчики веб-приложений могут указать, требуется ли проверка подлинности для всех или только определенных страниц. Например, в ASP.NET/ASP.NET Core это можно сделать, добавив `[Authorize]` атрибут к действиям контроллера.

Этот атрибут заставляет ASP.NET проверять наличие файла cookie сеанса, содержащего идентификатор пользователя. Если файл cookie отсутствует, ASP.NET перенаправляет проверку подлинности в указанный поставщик удостоверений. Если поставщиком удостоверений является Azure AD, веб-приложение перенаправляет проверку подлинности в `https://login.microsoftonline.com`, которая отображает диалоговое окно входа.

### <a name="how-a-web-app-delegates-sign-in-to-microsoft-identity-platform-and-obtains-a-token"></a>Как веб-приложение делегирует вход на платформу удостоверений Майкрософт и получает маркер

Проверка подлинности пользователя осуществляется через браузер. Протокол OpenID Connect использует стандартные сообщения протокола HTTP.

* Веб-приложение отправляет в браузер HTTP 302 (Redirect) для использования платформы Microsoft Identity.
* При проверке подлинности пользователя платформа Microsoft Identity отправляет маркер в веб-приложение с помощью перенаправления через браузер.
* Перенаправление предоставляется веб-приложением в форме URI перенаправления. Этот URI перенаправления зарегистрирован в объекте приложения Azure AD. Может существовать несколько URI перенаправления, поскольку приложение может быть развернуто по нескольким URL-адресам. Поэтому веб-приложению также потребуется указать URI перенаправления для использования.
* Azure AD проверяет, что URI перенаправления, отправленный веб-приложением, является одним из зарегистрированных URI перенаправления для приложения.

## <a name="desktop-and-mobile-app-sign-in-flow"></a>Поток входа для настольных и мобильных приложений

Описанный выше поток применим и с незначительными отличиями к настольным и мобильным приложениям.

Для проверки подлинности настольные и мобильные приложения могут использовать встроенный веб-элемент управления или системный браузер. На следующей схеме показано, как настольное или мобильное приложение использует библиотеку проверки подлинности Майкрософт (MSAL) для получения маркеров доступа и вызова веб-API.

![Настольное приложение, как оно выглядит](media/authentication-scenarios/desktop-app-how-it-appears-to-be.png)

MSAL использует браузер для получения маркеров. Как и в случае с веб-приложениями, проверка подлинности делегируется на платформу Microsoft Identity.

Так как Azure AD сохраняет в браузере тот же файл cookie удостоверения, что и для веб-приложений, если в собственном или мобильном приложении используется системный браузер, он немедленно получит единый вход с соответствующим веб-приложением.

По умолчанию MSAL использует системный браузер. Исключением является .NET Framework классических приложений, где внедренный элемент управления обеспечивает более тесное взаимодействие с пользователем.

## <a name="next-steps"></a>Дальнейшие действия

Другие разделы, посвященные основам проверки подлинности и авторизации:

* Сведения об основных понятиях проверки подлинности и авторизации на платформе Microsoft Identity см. в статье [Проверка подлинности и авторизация](authentication-vs-authorization.md) .
* Сведения о маркерах доступа, маркерах обновления и маркерах идентификации, используемых при проверке подлинности и авторизации, см. в разделе [токены безопасности](security-tokens.md) .
* Сведения о процессе регистрации приложения для интеграции с платформой идентификации Майкрософт см. в статье [модель приложения](application-model.md) .

Дополнительные сведения о потоке входа в приложение:

* Дополнительные сведения о других сценариях проверки подлинности пользователей, поддерживаемых платформой идентификации Майкрософт, см. в статье [потоки проверки подлинности и сценарии приложений](authentication-flows-app-scenarios.md) .
* Сведения о библиотеках Майкрософт, которые помогут разрабатывать приложения, работающие с учетными записями Майкрософт, учетными записями Azure AD, а также Azure AD B2C пользователями в единой и простой модели программирования, см. в разделе [библиотеки MSAL](msal-overview.md) .
