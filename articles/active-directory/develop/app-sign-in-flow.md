---
title: Последовательность входа в приложение с помощью платформы удостоверений Майкрософт | Azure
titleSuffix: Microsoft identity platform
description: Сведения о последовательности входа в веб-приложения, классические и мобильные приложения с помощью платформы удостоверений Майкрософт (версия 2.0).
services: active-directory
author: rwike77
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: conceptual
ms.workload: identity
ms.date: 05/18/2020
ms.author: ryanwi
ms.reviewer: jmprieur, saeeda, sureshja, hirsin
ms.custom: aaddev, identityplatformtop40, scenarios:getting-started
ms.openlocfilehash: af5b27dc85a276c731a61135ab59ab81f5aaf3c2
ms.sourcegitcommit: 318d1bafa70510ea6cdcfa1c3d698b843385c0f6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/21/2020
ms.locfileid: "83772205"
---
# <a name="app-sign-in-flow-with-microsoft-identity-platform"></a>Последовательность входа в приложение с помощью платформы удостоверений Майкрософт

В этом разделе рассматривается базовая последовательность входа в веб-приложения, классические и мобильные приложения с помощью платформы удостоверений Майкрософт. Сведения о сценариях входа, поддерживаемых платформой удостоверений Майкрософт, см. в статье [Потоки проверки подлинности и сценарии приложений](authentication-flows-app-scenarios.md).

## <a name="web-app-sign-in-flow"></a>Последовательность входа в веб-приложение

Когда пользователь переходит к веб-приложению в браузере, происходит следующее:

* Веб-приложение определяет, прошел ли пользователь проверку подлинности.
* Если пользователь не прошел проверку подлинности, веб-приложение отправляет пользователя для входа в Azure AD. Такая процедура входа соответствует политике организации, а значит, пользователю может быть предложено ввести его учетные данные с использованием [многофакторной проверки подлинности](../authentication/concept-mfa-howitworks.md) (иногда это называется двухфакторной проверкой подлинности или 2FA) или войти без использования пароля (например, через Windows Hello).
* Пользователю предлагается дать согласие на доступ, который требуется клиентскому приложению. В связи с этим клиентские приложения необходимо регистрировать в Azure AD — это позволяет платформе удостоверений Майкрософт доставлять маркеры, обозначающие, на какой уровень доступа пользователь дал согласие.

После успешной проверки подлинности пользователя:

* Платформа удостоверений Майкрософт отправляет маркер веб-приложению.
* Сохраняется файл cookie, связанный с доменом Azure AD и содержащий удостоверение пользователя, в JAR-файл с файлами cookie браузера. Когда приложение обратится к конечной точке платформы удостоверений Майкрософт через браузер в следующий раз, браузер предъявит этот файл cookie, чтобы пользователю не пришлось выполнять вход еще раз. Таким образом, помимо прочего, обеспечивается единый вход. Файл cookie создается Azure AD и может быть понятен только для Azure AD.
* Затем веб-приложение проверяет полученный маркер. Если проверка даст положительный результат, веб-приложение отобразит защищенную страницу и сохранит файл cookie сеанса в JAR-файл с файлами cookie браузера. Когда пользователь переходит на другую страницу, веб-приложение определяет, прошел ли пользователь проверку подлинности, по этому файлу cookie сеанса.

Этот процесс взаимодействия демонстрирует следующая схема последовательности:

![процесс проверки подлинности веб-приложения](media/authentication-scenarios/web-app-how-it-appears-to-be.png)

### <a name="how-a-web-app-determines-if-the-user-is-authenticated"></a>Как веб-приложение определяет, прошел ли пользователь проверку подлинности

Разработчики веб-приложений могут указать, требуется ли проверка подлинности для всех или только для некоторых страниц. Например, в ASP.NET/ASP.NET Core это можно сделать, добавив к действиям контроллера атрибут `[Authorize]`.

Он заставляет ASP.NET проверять наличие файла cookie сеанса, содержащего идентификатор пользователя. Если файл cookie отсутствует, ASP.NET переадресует проверку подлинности указанному поставщику удостоверений. Если поставщиком удостоверений является Azure AD, веб-приложение переадресует проверку подлинности на сайт `https://login.microsoftonline.com`, где отображается диалоговое окно входа.

### <a name="how-a-web-app-delegates-sign-in-to-microsoft-identity-platform-and-obtains-a-token"></a>Как веб-приложение делегирует вход платформе удостоверений Майкрософт и получает маркер

Проверка подлинности пользователя осуществляется через браузер. Протокол OpenID Connect использует стандартные сообщения по протоколу HTTP.

* Веб-приложение отправляет в браузер код состояния HTTP 302 (перенаправление), обозначающий переход на платформу удостоверений Майкрософт.
* Когда проверка подлинности пользователя будет выполнена, платформа удостоверений Майкрософт отправляет маркер веб-приложению, используя перенаправление через браузер.
* Веб-приложение предоставляет перенаправление в форме URI перенаправления. URI перенаправления регистрируется в объекте приложения Azure AD. URI перенаправления может быть несколько, поскольку приложение может быть развернуто по нескольким URL-адресам. В связи с этим веб-приложение также должно указывать, какой URI перенаправления необходимо использовать.
* Azure AD проверяет, является ли предоставленный веб-приложением URI перенаправления одним из URI перенаправления, зарегистрированных для этого приложения.

## <a name="desktop-and-mobile-app-sign-in-flow"></a>Последовательность входа в классические и мобильные приложения

К классическим и мобильным приложениям применяется та же последовательность, которая описана выше, но с небольшими отличиями.

Для проверки подлинности классические и мобильные приложения могут использовать встроенный веб-элемент управления, он же системный браузер. На следующей схеме показано, как классическое или мобильное приложение использует библиотеку проверки подлинности Майкрософт (MSAL) для получения маркеров доступа и вызова веб-API.

![Вид классического приложения](media/authentication-scenarios/desktop-app-how-it-appears-to-be.png)

MSAL для получения маркеров использует браузер. Как и в случае с веб-приложениями, проверка подлинности перенаправляется на платформу удостоверений Майкрософт.

Поскольку Azure AD сохраняет в браузере тот же файл cookie удостоверения, что и для веб-приложений, в случае если в собственном или мобильном приложении используется системный браузер, он сразу получает единый вход с соответствующим веб-приложением.

По умолчанию MSAL использует системный браузер. Исключение составляют классические приложения .NET Framework, где для более тесного взаимодействия с пользователем используется внедренный элемент управления.

## <a name="next-steps"></a>Дальнейшие действия

Другие статьи по основам проверки подлинности и авторизации:

* Сведения об основных понятиях, связанных с проверкой подлинности и авторизацией на платформе удостоверений Майкрософт, см. в статье [Проверка подлинности и авторизация](authentication-vs-authorization.md).
* Сведения о маркерах доступа, маркерах обновления и маркерах идентификации, используемых при проверке подлинности и авторизации, см. в статье [Маркеры безопасности](security-tokens.md).
* Сведения о процессе регистрации приложения для интеграции с платформой удостоверений Майкрософт см. в статье [Модель приложения](application-model.md).

Дополнительные сведения о последовательности входа в приложение:

* Сведения о других сценариях проверки подлинности, поддерживаемых платформой удостоверений Майкрософт, см. в статье [Потоки проверки подлинности и сценарии приложений](authentication-flows-app-scenarios.md).
* Дополнительные сведения о библиотеках Майкрософт, которые могут вам пригодиться при разработке приложений, работающих с учетными записями Майкрософт, учетными записями Azure AD и пользователями Azure AD B2C, см. в статье [Библиотеки MSAL](msal-overview.md).
