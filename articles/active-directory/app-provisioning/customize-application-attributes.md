---
title: Настройка отображения атрибутов атрибута Azure AD Документы Майкрософт
description: Узнайте, что такое сопоставление атрибутов для приложений SaaS в Azure Active Directory и как настроить его в соответствии с потребностями вашего бизнеса.
services: active-directory
documentationcenter: ''
author: msmimart
manager: CelesteDG
ms.service: active-directory
ms.subservice: app-provisioning
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 04/03/2019
ms.author: mimart
ms.collection: M365-identity-device-management
ms.openlocfilehash: 7003899b59e409a785c3a50e89aae6674e377b4d
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79264093"
---
# <a name="customizing-user-provisioning-attribute-mappings-for-saas-applications-in-azure-active-directory"></a>Настройка отображения атрибутов для приложений SaaS в Active Directory

Microsoft Azure AD предоставляет поддержку для подготовки пользователей к сторонним приложениям SaaS, таким как Salesforce, G Suite и другим. Если вы включили приложение SaaS для сторонних пользователей, портал Azure контролирует значения атрибутов с помощью отображений атрибутов.

Между объектами пользователя Azure AD и каждым пользовательским объектом приложения SaaS имеется предварительно настроенный набор атрибутов и отображений атрибутов. Некоторые приложения управляют другими типами объектов вместе с пользователями, такими как Группы.

Сопоставление атрибутов по умолчанию можно настроить в соответствии с потребностями вашего бизнеса. Таким образом, можно изменить или удалить существующие отображения атрибутов или создать новые отображения атрибутов.

## <a name="editing-user-attribute-mappings"></a>Изменение сопоставлений атрибутов пользователя

Выполните следующие действия, чтобы получить доступ к функции **Картирования** подготовки пользователей:

1. Вопием на [портале Active Directory Azure](https://aad.portal.azure.com).
1. Выберите **приложения Enterprise** из левого стекла. Отображается список всех настроенных приложений, включая приложения, добавленные из галереи.
1. Выберите любое приложение для загрузки панели управления приложением, где можно просматривать отчеты и управлять настройками приложения.
1. Выберите **«Подготовка»** для управления настройками подготовки учетной записи пользователя для выбранного приложения.
1. Расширьте **картографирование** для просмотра и отсвачения атрибутов пользователя, которые текут между Azure AD и целевым приложением. Если целевое приложение поддерживает его, этот раздел позволяет дополнительно настроить подготовку групп и учетных записей пользователей.

   ![Используйте картографы для просмотра и отсвачения атрибутов пользователя](./media/customize-application-attributes/21.png)

1. Выберите конфигурацию **Картирования,** чтобы открыть соответствующий экран **отображения атрибутов.** Некоторые отображения атрибутов требуются приложением SaaS для правильного функционирования. Для требуемых атрибутов функция **Удалить** недоступна.

   ![Используйте отображение атрибутов для настройки отображений атрибутов для приложений](./media/customize-application-attributes/22.png)

   На этом скриншоте можно увидеть, что атрибут **имени пользователя** управляемого объекта в Salesforce заполняется значением **userPrincipalName** связанного объекта активного каталога Azure.

1. Выберите существующую **картографию атрибутов,** чтобы открыть экран **атрибута edit.** Здесь можно отсечь атрибуты пользователя, которые текут между Azure AD и целевым приложением.

   ![Используйте атрибут edit для отсвасывательных атрибутов пользователя](./media/customize-application-attributes/23.png)

### <a name="understanding-attribute-mapping-types"></a>Основные сведения о типах сопоставления атрибутов

С помощью сопоставлений атрибутов можно управлять заполнением атрибутов в сторонних приложениях SaaS.
Поддерживаются четыре типа сопоставлений:

- **Прямое** — целевой атрибут заполняется значением атрибута связанного объекта в Azure AD.
- **Постоянный** атрибут цели заполняется определенной строкой, указанной вами.
- **Выражение** — целевой атрибут заполняется на основе результата выражения, схожего со сценарием.
  Дополнительные сведения см. в статье [Запись выражений для сопоставления атрибутов в Azure Active Directory](../app-provisioning/functions-for-customizing-application-data.md).
- **Нет** — целевой атрибут оставляется без изменений. Однако, если целевой атрибут когда-либо пуст, он заполняется значением по умолчанию, которое вы указываете.

Наряду с этими четырьмя основными типами пользовательские отображения атрибутов поддерживают концепцию дополнительного назначения значения **по умолчанию.** Назначение значения по умолчанию гарантирует, что целевой атрибут населен значением, если нет значения в AD Azure или на целевом объекте. В наиболее распространенной конфигурации это поле остается пустым.

### <a name="understanding-attribute-mapping-properties"></a>Основные сведения о свойствах сопоставления атрибутов

В предыдущем разделе вы уже были введены в свойство типа отображения атрибутов.
Наряду с этим свойством, отображение атрибутов также поддерживает следующие атрибуты:

- **Атрибут источника** — атрибут пользователя из исходной системы (например, Azure Active Directory).
- **Целевой атрибут** — атрибут пользователя в целевой системе (например, ServiceNow).
- **Значение по умолчанию, если null (необязательно)** - значение, которое будет передано целевой системе, если атрибут источника недействителен. Это значение будет подготовлено только при создании пользователя. При обновлении существующего пользователя не будет предусмотрено значение "значение по умолчанию, когда null". Если, например, вы хотите предоставить всем существующим пользователям в целевой системе определенный заголовок вакансий (когда он нулев в исходной системе), вы можете использовать следующее [выражение:](../app-provisioning/functions-for-customizing-application-data.md)Switch (IsPresent («Название»), «DefaultValue», «True», «jobTitle»). Убедитесь в том, чтобы заменить "Значение по умолчанию" с тем, что вы хотели бы предоставить, когда нулевой в исходной системе. 
- **Матч объектов с помощью этого атрибута** - Следует ли использовать это отображение для однозначной идентификации пользователей между источником и целевыми системами. Обычно он устанавливается на атрибуте userPrincipalName или почтовой пришлоке в Azure AD, который обычно отображается на поле имени пользователя в целевом приложении.
- **Приоритет сопоставления** — возможность указания нескольких атрибутов сопоставления. Когда их несколько, они оцениваются в порядке, определенном этим полем. Как только соответствие найдено, дальнейшие атрибуты сопоставления не вычисляются.
- **Применить это сопоставление**
  - **Всегда** - Применяйте это отображение как на создание пользователя, так и на действия обновления.
  - **Только во время создания** - Приложить это отображение только на действия создания пользователя.

## <a name="matching-users-in-the-source-and-target--systems"></a>Соответствие пользователей в исходных и целевых системах
Служба предоставления AD Azure Может быть развернута как в сценариях "гринфилда" (где пользователи не выходят из целевой системы), так и в сценариях "коричневого поля" (где пользователи уже существуют в целевой системе). Для поддержки обоих сценариев служба подготовки использует концепцию сопоставления атрибутов. Атрибуты соответствия позволяют определить, как однозначно идентифицировать пользователя в источнике и сопоставить пользователя в цели. В рамках планирования развертывания определите атрибут, который может быть использован для однозначной идентификации пользователя в исходных и целевых системах. Что следует отметить:

- **Соответствующие атрибуты должны быть уникальными:** Клиенты часто используют такие атрибуты, как userPrincipalName, почта или идентификатор объекта в качестве соответствующего атрибута.
- **Несколько атрибутов можно использовать в качестве соответствующих атрибутов:** Можно определить несколько атрибутов, которые необходимо оценить при согласовании пользователей, и порядок, в котором они оцениваются (определяется как соответствующий приоритет в пользовательского пользовательского, и порядок. Если, например, вы определяете три атрибута как соответствующие атрибуты, а пользователь однозначно соответствует после оценки первых двух атрибутов, служба не будет оценивать третий атрибут. Служба будет оценивать соответствующие атрибуты в указанном порядке и прекращать оценку при обнаружении совпадения.  
- **Значение в источнике и цели не должны точно совпадать:** Значение в целевом значении может быть некой простой функцией значения в источнике. Таким образом, можно иметь атрибут emailAddress в источнике и userPrincipalName в цели, и соответствовать функции атрибута emailAddress, который заменяет некоторые символы с некоторым постоянным значением.  
- **Соответствие на основе комбинации атрибутов не поддерживается:** Большинство приложений не поддерживают запрос ы на основе двух свойств. Таким образом, невозможно сопоставить на основе комбинации атрибутов. Можно оценить отдельные свойства после другого.
- **Все пользователи должны иметь значение, по крайней мере, для одного соответствующего атрибута:** Если вы определяете один соответствующий атрибут, все пользователи должны иметь значение для этого атрибута в исходной системе. Если, например, вы определяете userPrincipalName как соответствующий атрибут, все пользователи должны иметь userPrincipalName. Если вы определяете несколько соответствующих атрибутов (например, расширениеAttribute1 и почта), не все пользователи должны иметь один и тот же атрибут соответствия. Один пользователь может иметь расширениеAttribute1, но не почту в то время как другой пользователь может иметь почту, но не расширениеАтрибут1. 
- **Целевое приложение должно поддерживать фильтрацию на соответствующем атрибуте:** Разработчики приложений позволяют фильтровать подмножество атрибутов на их API пользователя или группы. Для приложений в галерее мы гарантируем, что отображение атрибутов по умолчанию предназначено для атрибута, на который aPI целевого приложения поддерживает фильтрацию. При изменении атрибута соответствия по умолчанию для целевого приложения проверьте документацию API третьей стороны, чтобы убедиться, что атрибут может быть отфильтрочен.  

## <a name="editing-group-attribute-mappings"></a>Изменение сопоставлений атрибутов группы

Выбранное количество приложений, таких как ServiceNow, Box и G Suite, поддерживает возможность предоставления объектов группы и пользователей. Объекты группы могут содержать групповые свойства, такие как имена отображений и псевдонимы электронной почты, а также членов группы.

![Пример показывает ServiceNow с подготовленными объектами группы и пользователя](./media/customize-application-attributes/24.png)

Групповое обеспечение может быть опционально включено или отключено, выбрав групповое отображение в соответствии с **картографами**и установив **опцию,** которую вы хотите на экране **отображения атрибутов.**

Атрибуты, подготовленные как часть объектов группы, можно настроить так же, как объекты пользователя, описанные ранее. 

> [!TIP]
> Подготовка объектов группы (свойства и участники) отличается от [присвоения групп](../manage-apps/assign-user-or-group-access-portal.md) приложению. Вы можете назначить группу приложению, однако подготовить можно только те объекты пользователя, которые содержатся в группе. Для использования групп в назначениях подготовка объектов для всей группы не требуется.

## <a name="editing-the-list-of-supported-attributes"></a>Изменение списка поддерживаемых атрибутов

Атрибуты пользователя, поддерживаемые для заданного приложения, настроены предварительно. Большинство AA-интерфейсов управления пользователями приложения не поддерживают обнаружение схемы. Таким образом, служба предоставления AD Azure не в состоянии динамически генерировать список поддерживаемых атрибутов, делая звонки в приложение.

Однако некоторые приложения поддерживают пользовательские атрибуты, а служба предоставления AD Azure Может читать и писать на пользовательские атрибуты. Чтобы ввести свои определения в портал Azure, выберите флажок **продвинутых опций Show** в нижней части экрана **атрибутов,** а затем выберите **список атрибутов edit для** вашего приложения.

Ниже приведены приложения и системы, поддерживающие настройку списка атрибутов.

- Salesforce
- ServiceNow
- Workday
- Активный каталог Azure[(поддерживается ссылка Microsoft Graph REST API v1.0](https://docs.microsoft.com/graph/api/overview?view=graph-rest-1.0) и расширение пользовательских каталогов)
- Приложения, поддерживающие [SCIM 2.0](https://tools.ietf.org/html/rfc7643), где необходимо добавить атрибуты, определенные в [основной схеме](https://tools.ietf.org/html/rfc7643)

> [!NOTE]
> Изменение списка поддерживаемых атрибутов рекомендуется только для администраторов, которые настроили схему своих приложений и систем и имеют непосредственные знания об определении их атрибутов. Иногда для этого требуются навыки работы с API-интерфейсами и средствами разработчика, предоставляемыми приложением или системой.

При изменении списка поддерживаемых атрибутов предоставляются следующие свойства:

- **Имя** — системное имя атрибута, определенное в схеме целевого объекта.
- **Тип** - Тип данных, которые хранит атрибут, как это определено в схеме целевого объекта, который может быть одним из следующих типов:
  - *Binary* — атрибут содержит двоичные данные.
  - *Boolean* — атрибут содержит значение True или False.
  - *DateTime* — атрибут содержит строку даты.
  - *Integer* — атрибут содержит целое число.
  - *Reference* — атрибут содержит идентификатор, который ссылается на значение, хранящееся в другой таблице в целевом приложении.
  - *String* — атрибут содержит текстовую строку.
- **Первичный ключ?** - определяется ли атрибут как основное ключевое поле в схеме целевого объекта.
- **Обязательно?** - Требуется ли атрибут для заполнения в целевом приложении или системе.
- **Мульти-стоимость?** - поддерживает ли атрибут несколько значений.
- **С учетом регистра?** - оцениваются ли значения атрибутов чувствительным образом.
- **Выражение API** - Не используйте, если только не проинструктируется документация для конкретного разъема подготовки (например, рабочий день).
- **Ссылка На атрибут объекта** - Если это атрибут типа ссылки, то это меню позволяет выбрать таблицу и атрибут в целевом приложении, которое содержит значение, связанное с атрибутом. Например, если у вас есть атрибут с именем Department, сохраненное значение которого указывает на объект в отдельной таблице Departments, необходимо выбрать Departments.Name. Справочные таблицы и основные поля идентификаторов, поддерживаемые для данного приложения, предварительно настроены и в настоящее время не могут быть отредактированы с помощью портала Azure, но могут быть отредактированы с помощью [API Microsoft Graph.](https://developer.microsoft.com/graph/docs/api-reference/beta/resources/synchronization-configure-with-custom-target-attributes)

#### <a name="provisioning-a-custom-extension-attribute-to-a-scim-compliant-application"></a>Создание пользовательского атрибута расширения для приложения, совместимого с SCIM
SCIM RFC определяет основную схему пользователя и группы, а также позволяет расширить схему для удовлетворения потребностей приложения. Чтобы добавить пользовательский атрибут в приложение SCIM:
   1. Вопийте на [портале Active Directory Azure,](https://aad.portal.azure.com)выберите **корпоративные приложения,** выберите приложение, а затем выберите **«Обеспечение».**
   2. Под **картографами**выберите объект (пользователя или группу), для которого вы хотите добавить пользовательский атрибут.
   3. В нижней части страницы выберите **Показать расширенные варианты.**
   4. Выберите **список атрибутов для AppName.**
   5. В нижней части списка атрибутов введите информацию о пользовательском атрибуте в предоставленных полях. Затем выберите **Добавить атрибут**.

Для приложений SCIM имя атрибута должно следовать шаблону, показанного в приведенном ниже примере. "CustomExtensionName" и "CustomAttribute" могут быть настроены в соответствии с требованиями приложения, например: urn:ietf:params:scim:schemas:extension:2.0:CustomExtensionName:CustomAttribute или urn:ietf:params:scim:schemas:extension: CustomExtensionName:2.0:User.CustomAttributeName:value

Эти инструкции применимы только к приложениям с поддержкой SCIM. Такие приложения, как ServiceNow и Salesforce, не интегрированы с Azure AD с помощью SCIM, и поэтому они не требуют этого конкретного пространства имен при добавлении пользовательского атрибута.

Пользовательские атрибуты не могут быть референтными атрибутами или многозначениятельными атрибутами. Пользовательские многозначенияевые атрибуты расширения в настоящее время поддерживаются только для приложений в галерее.  
 
**Пример представления пользователя с атрибутом расширения:**

```json
   {
     "schemas": ["urn:ietf:params:scim:schemas:core:2.0:User",
      "urn:ietf:params:scim:schemas:extension:enterprise:2.0:User",
      "urn:ietf:params:scim:schemas:extension:CustomExtensionName:2.0:User"],
     "userName":"bjensen",
     "externalId":"bjensen",
     "name":{
       "formatted":"Ms. Barbara J Jensen III",
       "familyName":"Jensen",
       "givenName":"Barbara"
     },
     "urn:ietf:params:scim:schemas:extension:enterprise:2.0:User": {
     "employeeNumber": "701984",
     "costCenter": "4130",
     "organization": "Universal Studios",
     "division": "Theme Park",
     "department": "Tour Operations",
     "manager": {
       "value": "26118915-6090-4610-87e4-49d8ca9f808d",
       "$ref": "../Users/26118915-6090-4610-87e4-49d8ca9f808d",
       "displayName": "John Smith"
     }
   },
     "urn:ietf:params:scim:schemas:extension:CustomExtensionName:2.0:CustomAttribute:User": {
     "CustomAttribute": "701984",
   },
   "meta": {
     "resourceType": "User",
     "created": "2010-01-23T04:56:22Z",
     "lastModified": "2011-05-13T04:42:34Z",
     "version": "W\/\"3694e05e9dff591\"",
     "location":
 "https://example.com/v2/Users/2819c223-7f76-453a-919d-413861904646"
   }
 }
```


## <a name="provisioning-a-role-to-a-scim-app"></a>Предоставление роли приложению SCIM
Используйте приведенные ниже шаги для предоставления ролей для пользователя в приложении. Обратите внимание, что описание ниже специфично для пользовательских приложений SCIM. Для галерейных приложений, таких как Salesforce и ServiceNow, используйте заранее определенные отображения ролей. Ниже приведены пули, как преобразовать атрибут AppRoleAssignments в формат, который ожидает приложение.

- Отображение приложенияRoleAssignment в Azure AD к роли в приложении требует преобразования атрибута с помощью [выражения.](../app-provisioning/functions-for-customizing-application-data.md) Атрибут appRoleAssignment **не должен отображаться непосредственно** к атрибуту роли без использования выражения для разбора деталей роли. 

- **SingleAppRoleAssignment** 
  - **Когда использовать:** Используйте выражение SingleAppRoleAssignment, чтобы предоставить пользователю единую роль и указать основную роль. 
  - **Как настроить:** Используйте описанные выше шаги для навигации по странице отображений атрибутов и используйте выражение SingleAppRoleAssignment для отображения атрибута ролей. Есть три атрибута роли на выбор: (роли (первичный eq "True"..display, роли (первичный экв "True" .type, и роли (первичный эк "True").value). Вы можете включить любые атрибуты ролей в свои отображения. Если вы хотите включить несколько, просто добавьте новое отображение и включите его в качестве целевого атрибута.  
  
  ![Добавить SingleAppRoleНазначение](./media/customize-application-attributes/edit-attribute-singleapproleassignment.png)
  - **Полезная информация**
    - Убедитесь, что несколько ролей не назначены пользователю. Мы не можем гарантировать, какая роль будет выделена.
    
  - **Вывод примера** 

   ```json
    {
      "schemas": [
          "urn:ietf:params:scim:schemas:core:2.0:User"
      ],
      "externalId": "alias",
      "userName": "alias@contoso.OnMicrosoft.com",
      "active": true,
      "displayName": "First Name Last Name",
      "meta": {
           "resourceType": "User"
      },
      "roles": [
         {
               "primary": true,
               "type": "WindowsAzureActiveDirectoryRole",
               "value": "Admin"
         }
      ]
   }
   ```
  
- **AppRoleНазначенияКомплекс** 
  - **Когда использовать:** Используйте выражение AppRoleAssignmentsComplex для предоставления пользователям нескольких ролей. 
  - **Как настроить:** Отспособите список поддерживаемых атрибутов, описанных выше, чтобы включить новый атрибут для ролей: 
  
    ![Добавление ролей](./media/customize-application-attributes/add-roles.png)<br>

    Затем используйте выражение AppRoleAssignmentsComplex для отображения пользовательского атрибута роли, показанного на рисунке ниже:

    ![Добавление AppRoleAssignmentsКомплекс](./media/customize-application-attributes/edit-attribute-approleassignmentscomplex.png)<br>
  - **Полезная информация**
    - Все роли будут подготовлены как первичные и ложные.
    - POST содержит тип роли. Запрос PATCH не содержит типа. Мы работаем над отправкой типа как в POST, так и в патч-запросах.
    
  - **Вывод примера** 
  
   ```json
   {
       "schemas": [
           "urn:ietf:params:scim:schemas:core:2.0:User"
      ],
      "externalId": "alias",
      "userName": "alias@contoso.OnMicrosoft.com",
      "active": true,
      "displayName": "First Name Last Name",
      "meta": {
           "resourceType": "User"
      },
      "roles": [
         {
               "primary": false,
               "type": "WindowsAzureActiveDirectoryRole",
               "display": "Admin",
               "value": "Admin"
         },
         {
               "primary": false,
               "type": "WindowsAzureActiveDirectoryRole",
               "display": "User",
             "value": "User"
         }
      ]
   }
   ```

  


## <a name="provisioning-a-multi-value-attribute"></a>Создание многоценного атрибута
Некоторые атрибуты, такие как phoneNumbers и электронные письма, являются многозначенияевыми атрибутами, где может потребоваться указать различные типы телефонных номеров или электронных писем. Используйте выражение ниже для многофункциональных атрибутов. Это позволяет указать тип атрибута и карту, который будет соответствующим атрибутом Azure AD для значения. 

* phoneNumbers[type eq "work"].value
* phoneNumbers[type eq "mobile"].value
* phoneNumbers[type eq "fax"].value

   ```json
   "phoneNumbers": [
       {
         "value": "555-555-5555",
         "type": "work"
      },
      {
         "value": "555-555-5555",
         "type": "mobile"
      },
      {
         "value": "555-555-5555",
         "type": "fax"
      }
   ]
   ```

## <a name="restoring-the-default-attributes-and-attribute-mappings"></a>Восстановление атрибутов по умолчанию и сопоставления атрибутов

Если вам нужно начать все сначала и сбросить существующие отображения обратно в состояние по умолчанию, можно выбрать флажок **отображения отconfigurationов отображения «Восстановить»** и сохранить конфигурацию. При этом все фильтры отображения и проверки так, как если бы приложение было просто добавлено в ваш ad-накопитель Azure AD из галереи приложений.

Выбор этого варианта фактически заставит ресинхронизацию всех пользователей во время работы службы обеспечения.

> [!IMPORTANT]
> Мы настоятельно рекомендуем установить **статус "Обеспечение"** **до** отзыва этого варианта.

## <a name="what-you-should-know"></a>Необходимая информация

- Процесс синхронизации в Microsoft Azure AD реализован очень эффективно. Во время цикла синхронизации в инициализированной среде обрабатываются только объекты, требующие обновления.
- Обновление сопоставлений атрибутов влияет на производительность цикла синхронизации. Чтобы обновить конфигурацию сопоставления атрибутов, необходимо повторно оценить все управляемые объекты.
- Рекомендуемая рекомендация заключается в том, чтобы свести к минимуму количество последовательных изменений в отображении атрибутов.
- Добавление атрибута фотографии, которое должно быть подготовлено к приложению, не поддерживается сегодня, так как вы не можете указать формат синхронизации фотографии. Вы можете запросить функцию на [Голосе Пользователя](https://feedback.azure.com/forums/169401-azure-active-directory)
- Атрибут IsSoftDeleted часто является частью картпо умолчанию для приложения. IsSoftdeleted может быть верным в одном из четырех сценариев (пользователь находится вне сферы из-за того, что он не назначен из приложения, пользователь выходит за рамки из-за несоблюдения фильтра для проверки, пользователь был мягко удален в Azure AD, или свойство AccountEnabled установлено ложным на пользователя). 
- Служба предоставления AD Azure AD не поддерживает предоставление нулевых значений

## <a name="next-steps"></a>Дальнейшие действия

- [Автоматическая подготовка пользователей и ее отзыв для приложений SaaS](user-provisioning.md)
- [Запись выражений для сопоставления атрибутов](../app-provisioning/functions-for-customizing-application-data.md)
- [Фильтры области для подготовки пользователей](../app-provisioning/define-conditional-rules-for-provisioning-user-accounts.md)
- [Автоматическая подготовка пользователей и групп из Azure Active Directory в приложениях с использованием SCIM](use-scim-to-provision-users-and-groups.md)
- [Список учебников по интеграции приложений SaaS](../saas-apps/tutorial-list.md)
