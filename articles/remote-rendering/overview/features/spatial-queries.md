---
title: Пространственные запросы
description: Как выполнять пространственные запросы в сцене
author: jakrams
ms.author: jakras
ms.date: 02/07/2020
ms.topic: article
ms.openlocfilehash: 9a981aeb08ec46900994fd599b592b9f16034f34
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "80680535"
---
# <a name="spatial-queries"></a>Пространственные запросы

Пространственные запросы — это операции, с помощью которых можно запрашивать службу удаленной визуализации о том, какие объекты находятся в области. Пространственные запросы часто используются для реализации взаимодействия, например для выяснения того, на какой объект указывает пользователь.

Все пространственные запросы оцениваются на сервере. Следовательно, это асинхронные операции, и результаты будут поступать с задержкой, которая зависит от задержки сети. Поскольку каждый пространственный запрос создает сетевой трафик, будьте внимательны, чтобы не выполнять слишком много запросов одновременно.

## <a name="collision-meshes"></a>Конфликты сеток

Пространственные запросы помещаются на платформе [Хавок физика](https://www.havok.com/products/havok-physics) и требует наличия выделенной сетки конфликтов. По умолчанию [Преобразование модели](../../how-tos/conversion/model-conversion.md) создает конфликты сетки. Если пространственные запросы не требуются для сложной модели, рассмотрите возможность отключения создания сетки конфликтов в [параметрах преобразования](../../how-tos/conversion/configure-model-conversion.md), так как она оказывает влияние несколькими способами:

* [Преобразование модели](../../how-tos/conversion/model-conversion.md) займет значительно больше времени.
* Размеры файлов преобразованных моделей заметно увеличиваются, что влияет на скорость загрузки.
* Время загрузки среды выполнения превышает.
* Потребление памяти ЦП среды выполнения превышает.
* Для каждого экземпляра модели существует небольшая нагрузка на производительность.

## <a name="ray-casts"></a>Приведения лучей

*Приведение луча* — это пространственный запрос, в котором среда выполнения проверяет, какие объекты пересекаются лучом, начиная с заданной позиции и указывая на определенное направление. В качестве оптимизации также выдается максимальное расстояние лучей, чтобы не искать объекты, которые находятся слишком далеко.

````c#
async void CastRay(AzureSession session)
{
    // trace a line from the origin into the +z direction, over 10 units of distance.
    RayCast rayCast = new RayCast(new Double3(0, 0, 0), new Double3(0, 0, 1), 10);

    // only return the closest hit
    rayCast.HitCollection = HitCollectionPolicy.ClosestHit;

    RayCastHit[] hits = await session.Actions.RayCastQueryAsync(rayCast).AsTask();

    if (hits.Length > 0)
    {
        var hitObject = hits[0].HitEntity;
        var hitPosition = hits[0].HitPosition;
        var hitNormal = hits[0].HitNormal;

        // do something with the hit information
    }
}
````

Существует три режима сбора совпадений:

* **Ближайшее:** В этом режиме будет сообщено только ближайшее попадание.
* **Все:** Предпочитать этот режим, если все, что нужно знать *, — это то,* что бы луч мог попасть, но не очень важен. Этот запрос может быть значительно дешевле для вычисления, но в нем также есть лишь несколько приложений.
* **Все:** В этом режиме выводятся все попадания на луч и сортируются по расстоянию. Не используйте этот режим, если не требуется больше первого попадания. Ограничьте количество сообщаемых попаданий с помощью `MaxHits` параметра.

Чтобы исключить объекты из рассмотрения при приведении лучей, можно использовать компонент [хиерарчикалстатеоверридекомпонент](override-hierarchical-state.md) .

<!--
The CollisionMask allows the quey to consider or ignore some objects based on their collision layer. If an object has layer L, it will be hit only if the mask has  bit L set.
It is useful in case you want to ignore objects, for instance when setting an object transparent, and trying to select another object behind it.
TODO : Add an API to make that possible.
-->

### <a name="hit-result"></a>Результат попадания

Результатом запроса CAST-Ray является массив попаданий. Если объект не был достигнут, массив пуст.

Попадание имеет следующие свойства:

* **Хитентити:** Какая [сущность](../../concepts/entities.md) была достигнута.
* **Субпартид:** Какая *подсеть* была достигнута в [мешкомпонент](../../concepts/meshes.md). Можно использовать для индексирования `MeshComponent.UsedMaterials` и поиска [материала](../../concepts/materials.md) на этом этапе.
* **Хитпоситион:** Место в мире, где луч пересекает объект.
* **Хитнормал:** Нормальная поверхность универсального пространства сетки в позиции пересечения.
* **Дистанцетохит:** Расстояние от начала луча до попадания в позицию.

## <a name="next-steps"></a>Дальнейшие шаги

* [Границы объектов](../../concepts/object-bounds.md)
* [Переопределение иерархических состояний](override-hierarchical-state.md)
