---
title: Настройка преобразования модели
description: Описание всех параметров преобразования модели
author: florianborn71
ms.author: flborn
ms.date: 03/06/2020
ms.topic: how-to
ms.openlocfilehash: eb287b812c477b2e472c48d7bd8f44574a398bac
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "80681575"
---
# <a name="configure-the-model-conversion"></a>Настройка преобразования модели

В этой главе описываются параметры преобразования модели.

## <a name="settings-file"></a>Файл параметров

Если файл с именем `ConversionSettings.json` найден во входном контейнере рядом с входной моделью, то он используется для предоставления дополнительной настройки для процесса преобразования модели.

Содержимое файла должно соответствовать следующей схеме JSON:

```json
{
    "$schema" : "http://json-schema.org/schema#",
    "description" : "ARR ConversionSettings Schema",
    "type" : "object",
    "properties" :
    {
        "scaling" : { "type" : "number", "exclusiveMinimum" : 0, "default" : 1.0 },
        "recenterToOrigin" : { "type" : "boolean", "default" : false },
        "opaqueMaterialDefaultSidedness" : { "type" : "string", "enum" : [ "SingleSided", "DoubleSided" ], "default" : "DoubleSided" },
        "material-override" : { "type" : "string", "default" : "" },
        "gammaToLinearMaterial" : { "type" : "boolean", "default" : false },
        "gammaToLinearVertex" : { "type" : "boolean", "default" : false },
        "sceneGraphMode": { "type" : "string", "enum" : [ "none", "static", "dynamic" ], "default" : "dynamic" },
        "generateCollisionMesh" : { "type" : "boolean", "default" : true },
        "unlitMaterials" : { "type" : "boolean", "default" : false },
        "fbxAssumeMetallic" : { "type" : "boolean", "default" : true },
        "axis" : {
            "type" : "array",
            "items" : {
                "type" : "string",
                "enum" : ["default", "+x", "-x", "+y", "-y", "+z", "-z"]
            },
            "minItems": 3,
            "maxItems": 3
        }
    },
    "additionalProperties" : false
}
```

Пример `ConversionSettings.json` файла:

```json
{
    "scaling" : 0.01,
    "recenterToOrigin" : true,
    "material-override" : "box_materials_override.json"
}
```

### <a name="geometry-parameters"></a>Параметры геометрии

* `scaling`— Этот параметр равномерно масштабирует модель. Масштабирование можно использовать для увеличения или уменьшения модели, например для вывода модели здания в верхней части таблицы. Так как механизм визуализации принимает значения длины в метрах, другое важное использование этого параметра возникает, когда модель определена в разных единицах. Например, если модель определена в сантиметрах, то применение шкалы 0,01 должна привести к отображению модели в правильном размере.
Некоторые форматы исходных данных (например, FBX) предоставляют указание о масштабировании единицы, в этом случае преобразование неявно масштабирует модель в единицы измерения. Неявное масштабирование, предоставляемое исходным форматом, будет применено поверх параметра масштабирования.
Окончательный коэффициент масштабирования применяется к вершинам геометрии и локальным преобразованиям узлов графа сцены. Масштабирование для преобразования корневой сущности остается неизменным.

* `recenterToOrigin`— Указывает, что модель должна быть преобразована таким образом, чтобы ее ограничивающий прямоугольник был центрирован в источнике.
Центрирование важно, если исходная модель перемещается далеко из источника, так как в этом случае проблемы точности с плавающей запятой могут вызвать артефакты отрисовки.

* `opaqueMaterialDefaultSidedness`— Механизм визуализации предполагает, что непрозрачные материалы являются двусторонними.
Если это не является предполагаемым поведением, для этого параметра следует задать значение "Синглесидед". Дополнительные сведения см. в разделе [односторонняя отрисовка](../../overview/features/single-sided-rendering.md).

### <a name="material-overrides"></a>Переопределения материалов

* `material-override`— Этот параметр позволяет настраивать обработку материалов [во время преобразования](override-materials.md).

### <a name="color-space-parameters"></a>Параметры цветового пространства

Механизм визуализации ждет, что значения цвета будут находиться в линейном пространстве.
Если модель определена с помощью гамма-пространства, то для этих параметров следует задать значение true.

* `gammaToLinearMaterial`— Преобразование цветов материала из области гаммы в линейное пространство
* `gammaToLinearVertex`— Преобразование цветов вершин из области гаммы в линейное пространство

> [!NOTE]
> Для файлов FBX эти параметры по умолчанию `true` имеют значение. Для всех остальных типов файлов значение по умолчанию `false`—.

### <a name="scene-parameters"></a>Параметры сцены

* `sceneGraphMode`— Определяет, как преобразуется граф сцены в исходном файле:
  * `dynamic`(по умолчанию): все объекты в файле предоставляются как [сущности](../../concepts/entities.md) в API и могут быть преобразованы независимо. Иерархия узлов во время выполнения идентична структуре в исходном файле.
  * `static`: Все объекты представлены в API, но не могут быть преобразованы независимо друг от друга.
  * `none`: Граф сцены свернут в один объект.

Каждый режим имеет разную производительность во время выполнения. В `dynamic` режиме затраты на производительность масштабируются линейно с числом [сущностей](../../concepts/entities.md) в графе, даже если часть не перемещается. Его следует использовать только в том случае, если требуется перемещать части по отдельности для приложения, например для анимации "представление развертывания".

`static` Режим экспортирует полный граф сцены, но части внутри этого графа имеют постоянное преобразование относительно его корневой части. Однако корневой узел объекта по-прежнему можно перемещать, поворачивать или масштабировать без значительной производительности. Кроме того, [пространственные запросы](../../overview/features/spatial-queries.md) будут возвращать отдельные части, и каждая часть может быть изменена с помощью [переопределений состояния](../../overview/features/override-hierarchical-state.md). В этом режиме затраты времени выполнения на объект незначительны. Это идеальный вариант для больших сцен, где по-прежнему требуется проверка отдельных объектов, но нет изменений в преобразовании «на объект».

`none` Режим содержит наименее затраты времени выполнения, а также немного лучшее время загрузки. Проверка или преобразование отдельных объектов в этом режиме невозможны. Варианты использования являются, например, фотограмметри моделями, которые не имеют осмысленного графа сцены на первом месте.

> [!TIP]
> Многие приложения будут загружать несколько моделей. Необходимо оптимизировать параметры преобразования для каждой модели в зависимости от того, как она будет использоваться. Например, если требуется отобразить модель автомобиля, чтобы пользователь занимался проанализировать, необходимо преобразовать его в `dynamic` режим. Однако если вы также хотите поместить автомобиль в среду показа комнаты, эту модель можно преобразовать с помощью `sceneGraphMode` параметра в `static` значение или даже. `none`

### <a name="physics-parameters"></a>Параметры физикы

* `generateCollisionMesh`— Если требуется поддержка [пространственных запросов](../../overview/features/spatial-queries.md) в модели, этот параметр должен быть включен. В худшем случае создание сетки конфликтов может удвоить время преобразования. Модели с конфликтами сетей загружаются дольше, а при использовании `dynamic` графа сцены они также имеют более высокую нагрузку на производительность. Для общей оптимальной производительности следует отключить этот параметр для всех моделей, для которых не требуются пространственные запросы.

### <a name="unlit-materials"></a>Унлит материалы

* `unlitMaterials`— По умолчанию преобразование будет предпочитать создание [материалов PBR](../../overview/features/pbr-materials.md). Этот параметр указывает преобразователю обрабатывать все материалы как [цветовые материалы](../../overview/features/color-materials.md) . Если у вас есть данные, которые уже включены в освещение, например модели, созданные с помощью фотограмметри, этот параметр позволяет быстро применить правильное преобразование для всех материалов без необходимости [переопределять каждый материал](override-materials.md) по отдельности.

### <a name="converting-from-older-fbx-formats-with-a-phong-material-model"></a>Преобразование из более старых форматов FBX в модель по методу Фонга Material

* `fbxAssumeMetallic`— Более старые версии формата FBX определяют свои материалы с помощью модели по методу Фонга Material. В процессе преобразования необходимо определить, как эти материалы сопоставляются с [моделью PBR](../../overview/features/pbr-materials.md)средства подготовки отчетов. Обычно это хорошо работает, но может возникнуть неоднозначность, когда у материала нет текстур, высоких значений и цвета албедо, отличного от серого. В этом случае преобразование должно выбирать между определением приоритетов для высоких отражающих значений, определением очень отражающегося, металлического материала, где разрешается цвет албедо, или приоритетом албедо цвета, определяя нечто вроде блестящих пластиковых Пластмассов. По умолчанию в процессе преобразования предполагается, что высоко отражающие значения предполагают металлический материал в случаях, когда применяется неоднозначность. Этот параметр можно задать `false` для переключения на противоположный.

### <a name="coordinate-system-overriding"></a>Переопределение системы координат

* `axis`— Для переопределения системных векторов координат. Значения по умолчанию: `["+x", "+y", "+z"]`. Теоретически, формат FBX имеет заголовок, где определены эти векторы, а преобразование использует эти сведения для преобразования сцены. Формат Глтф также определяет фиксированную систему координат. На практике некоторые активы либо имеют неверную информацию в своем заголовке, либо были сохранены с использованием другого соглашения системы координат. Этот параметр позволяет переопределить систему координат для компенсации. Например, `"axis" : ["+x", "+z", "-y"]` будет использоваться для обмена осью Z и оси y и сохранения правой или левой системы координат путем инвертирования направления оси y.

### <a name="vertex-format"></a>Формат вершины

Можно настроить формат вершины для сетки, чтобы обеспечить точность для экономии памяти. Более низкие объемы памяти позволяют загружать большие модели или повысить производительность. Однако в зависимости от данных неверный формат может значительно повлиять на качество визуализации.

> [!CAUTION]
> Изменение формата вершин должно быть последним средством, если модели больше не помещаются в память, или при оптимизации оптимальной производительности. Изменения могут легко представлять собой артефакты визуализации, как очевидные, так и тонкие. Если вы не знакомы с тем, что следует искать, не следует изменять значение по умолчанию.

Возможны следующие корректировки:

* Определенные потоки данных могут быть явно включены или исключены.
* Точность потоков данных можно уменьшить, чтобы сократить объем памяти.

Следующий `vertex` раздел `.json` файла является необязательным. Для каждой части, которая не указана явно, служба преобразования возвращается к значению по умолчанию.

```json
{
    ...
    "vertex" : {
        "position"  : "32_32_32_FLOAT",
        "color0"    : "NONE",
        "color1"    : "NONE",
        "normal"    : "NONE",
        "tangent"   : "NONE",
        "binormal"  : "NONE",
        "texcoord0" : "32_32_FLOAT",
        "texcoord1" : "NONE"
    },
    ...
```

Переставляя компонент `NONE`, вы гарантируете, что Выходная сетка не будет иметь соответствующий поток.

#### <a name="component-formats-per-vertex-stream"></a>Форматы компонентов на поток вершин

Эти форматы допускаются для соответствующих компонентов:

| Компонент вершины | Поддерживаемые форматы (полужирный = по умолчанию) |
|:-----------------|:------------------|
|position| **32_32_32_FLOAT**, 16_16_16_16_FLOAT |
|color0| **8_8_8_8_UNSIGNED_NORMALIZED**, нет |
|color1| 8_8_8_8_UNSIGNED_NORMALIZED, **нет**|
|нормальный| **8_8_8_8_SIGNED_NORMALIZED**, 16_16_16_16_FLOAT, нет |
|тангенс| **8_8_8_8_SIGNED_NORMALIZED**, 16_16_16_16_FLOAT, нет |
|бинормал| **8_8_8_8_SIGNED_NORMALIZED**, 16_16_16_16_FLOAT, нет |
|texcoord0| **32_32_FLOAT**, 16_16_FLOAT, нет |
|texcoord1| **32_32_FLOAT**, 16_16_FLOAT, нет |

#### <a name="supported-component-formats"></a>Поддерживаемые форматы компонентов

Ниже приведены объемы памяти для форматов.

| Формат | Описание | Байт на вершину |
|:-------|:------------|:---------------|
|32_32_FLOAT|точность полной плавающей точки с двумя компонентами|8
|16_16_FLOAT|половина компонентов с двойной точностью с плавающей точкой|4
|32_32_32_FLOAT|точность полной плавающей точки с тремя компонентами|12
|16_16_16_16_FLOAT|четыре компонента с двойной точностью с плавающей точкой|8
|8_8_8_8_UNSIGNED_NORMALIZED|байт из четырех компонентов, нормализованный до `[0; 1]` диапазона|4
|8_8_8_8_SIGNED_NORMALIZED|байт из четырех компонентов, нормализованный до `[-1; 1]` диапазона|4

#### <a name="best-practices-for-component-format-changes"></a>Рекомендации по изменению формата компонентов

* `position`: В редких случаях достаточно снизить точность. **16_16_16_16_FLOAT** вводит заметные дискретизацияные артефакты, даже для небольших моделей.
* `normal`, `tangent`, `binormal`. Обычно эти значения изменяются вместе. Если нет заметных артефактов освещения, являющихся результатом обычной дискретизация, нет причин увеличить их точность. Однако в некоторых случаях для этих компонентов можно задать значение **None**:
  * `normal`, `tangent`и `binormal` нужны только в том случае, если необходимо освещен хотя бы один материал в модели. В ARR это происходит, когда в любое время используется [материал PBR](../../overview/features/pbr-materials.md) в модели.
  * `tangent`и `binormal` нужны только тогда, когда в любом из освещенных материалов используется обычная текстура карт.
* `texcoord0`, `texcoord1` : Координаты текстуры могут использовать уменьшенную точность (**16_16_FLOAT**), если их значения остаются `[0; 1]` в диапазоне, а для назначенных текстур — максимальный размер 2048 x 2048 пикселей. Если эти ограничения превышены, качество сопоставления текстур снизится.

#### <a name="example"></a>Пример

Предположим, что у вас есть модель фотограмметри, которая имеет освещение, помогут в текстуры. Все, что необходимо для отрисовки модели, — это позиции вершин и текстурные координаты.

По умолчанию преобразователь должен предположить, что в какой-то момент времени вы можете использовать в модели материалы для PBR, поэтому он `normal`создаст `tangent`данные, `binormal` и. Таким образом, использование памяти на вершине `position` составляет (12 байт) `texcoord0` + (8 `normal` `tangent` `binormal` байт) + (4 байта) + 1 + (4 байтов) = 32 байт. Большие модели этого типа могут легко иметь множество миллионов вершин, в результате чего в моделях могут заниматься несколько гигабайт памяти. Такие большие объемы данных повлияют на производительность, и может даже закончится недостаточный объем памяти.

Зная, что для модели не требуется динамическое освещение, и зная, что все координаты текстуры находятся `[0; 1]` в диапазоне, можно установить `normal`значения `tangent`,, `binormal` и `NONE` в `texcoord0` половину точности (`16_16_FLOAT`), что приведет к посередине всего 16 байт на вершину. Вырезание данных сетки в половину позволяет загружать большие модели и может повысить производительность.

## <a name="typical-use-cases"></a>Стандартные сценарии использования

Поиск хороших параметров импорта для конкретного варианта использования может быть утомительным процессом. С другой стороны, параметры преобразования могут оказать значительное влияние на производительность среды выполнения.

Существуют определенные классы вариантов использования, которые соответствуют конкретным оптимизациям. Некоторые примеры приведены ниже.

### <a name="use-case-architectural-visualization--large-outdoor-maps"></a>Вариант использования: Визуализация архитектуры и крупные карты

* Эти типы сцен обычно являются статическими, то есть они не требуют перемещаемых частей. Соответственно, `sceneGraphMode` можно установить значение `static` или даже `none`, что повышает производительность среды выполнения. В `static` режиме "корневой узел сцены" можно по-прежнему перемещать, поворачивать и масштабировать, например, чтобы динамически переключаться между шкалой 1:1 (для первого представления) и представлением таблицы сверху.

* Если необходимо переместить части, это, как правило, также означает, что требуется поддержка райкастс или других [пространственных запросов](../../overview/features/spatial-queries.md), чтобы можно было выбрать эти части в первую очередь. С другой стороны, если вы не собираетесь перемещать что-то по себе, вероятность того, что вам не нужно участвовать в пространственном запросе и, следовательно, отключать `generateCollisionMesh` флаг. Этот параметр оказывает значительное влияние на время преобразования, время загрузки, а также на затраты на обновление времени выполнения на каждом кадре.

* Если приложение не использует [вырезание плоскостей](../../overview/features/cut-planes.md), `opaqueMaterialDefaultSidedness` флаг должен быть отключен. Увеличение производительности обычно составляет 20%-30%. Вырезание плоскостей по-прежнему можно использовать, но при поиске внутренних частей объектов они не будут иметь обратные стороны, которые выглядят интуитивно понятными. Дополнительные сведения см. в разделе [односторонняя отрисовка](../../overview/features/single-sided-rendering.md).

### <a name="use-case-photogrammetry-models"></a>Вариант использования: модели Фотограмметри

При отрисовке моделей фотограмметри обычно нет необходимости в графе сцены, поэтому можно задать `sceneGraphMode` для `none`значение. Так как эти модели редко содержат сложный график сцены, то влияние этого параметра должно быть незначительным.

Так как освещение уже помогут в текстуры, динамическое освещение не требуется. Таким образом:

* Установите `unlitMaterials` флаг `true` , чтобы включить все материалы в [цветовые материалы](../../overview/features/color-materials.md)унлит.
* Удалите ненужные данные из формата вершин. См. [Пример](#example) выше.

### <a name="use-case-visualization-of-compact-machines-etc"></a>Вариант использования: Визуализация компактных компьютеров и т. д.

В этих случаях модели часто имеют очень высокую детализацию в пределах большого объема. Модуль подготовки отчетов сильно оптимизирован для обработки таких случаев. Однако большинство оптимизаций, упомянутых в предыдущем варианте использования, не применяются.

* Отдельные части должны быть выбраны и перемещены, поэтому `sceneGraphMode` должны быть оставлены `dynamic`.
* Операции приведения лучей обычно являются неотъемлемой частью приложения, поэтому необходимо формировать конфликты сетки.
* Вырезание плоскостей лучше, `opaqueMaterialDefaultSidedness` если включен флаг.

## <a name="next-steps"></a>Дальнейшие шаги

* [Преобразование модели](model-conversion.md)
* [Цветовые материалы](../../overview/features/color-materials.md)
* [Материалы PBR](../../overview/features/pbr-materials.md)
* [Переопределение материалов во время преобразования модели](override-materials.md)
