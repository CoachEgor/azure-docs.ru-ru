---
title: Создание следов производительности на стороне клиента
description: Рекомендации по профилированию производительности на стороне клиента с использованием WPF
author: florianborn71
ms.author: flborn
ms.date: 12/11/2019
ms.topic: conceptual
ms.openlocfilehash: 1f4207a11f3ae3664023fccf6178b6db7cf253b9
ms.sourcegitcommit: 642a297b1c279454df792ca21fdaa9513b5c2f8b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2020
ms.locfileid: "80681315"
---
# <a name="create-client-side-performance-traces"></a>Создание следов производительности на стороне клиента

Существует множество причин, по которым производительность удаленного рендеринга Azure может быть не так хороша, как хотелось бы. Помимо чистой производительности рендеринга на облачном сервере, особенно качество сетевого соединения оказывает значительное влияние на опыт. Чтобы просмотреть производительность сервера, обратитесь к [запросам производительности сервера](../overview/features/performance-queries.md)в главе.

В этой главе основное внимание уделяется тому, как определить потенциальные узкие места на стороне клиента с помощью *следов производительности.*

## <a name="getting-started"></a>Начало работы

Если вы новичок в функциональности отслеживания производительности Windows, в этом разделе будут упомянуты наиболее фундаментальные термины и приложения, которые вы начали.

### <a name="installation"></a>Установка

Приложения, используемые для отслеживания с помощью ARR, являются инструментами общего назначения, которые могут быть использованы для всех разработок Windows. Они предоставляются через инструмент Windows [Performance Toolkit.](https://docs.microsoft.com/windows-hardware/test/wpt/) Чтобы получить этот набор инструментов, загрузите [набор для оценки и развертывания Windows.](https://docs.microsoft.com/windows-hardware/get-started/adk-install)

### <a name="terminology"></a>Терминология

При поиске информации о следах производительности вы неизбежно столкнетесь с различными терминами. Наиболее важными из них являются:

* `ETW`
* `ETL`
* `WPR`
* `WPA`

**ETW** означает [ **E**вентиляционные **T**гонки для **W**indows](https://docs.microsoft.com/windows/win32/etw/about-event-tracing). Это просто всеобъемлющее название для эффективного механизма отслеживания уровня ядра, который встроен в Windows. Это называется отслеживанием *событий,* поскольку приложения, поддерживающие ETW, испускают события для регистрации действий, которые могут помочь отследить проблемы с производительностью. По умолчанию операционная система уже испускает события для таких вещей, как доступ к диска, коммутаторы задач и тому подобное. Приложения, такие как ARR дополнительно излучают пользовательские события, например, о упавших кадрах, сетевом отставании и т.д.

**ETL** означает **E**вентиляционные **T**гонки **L**ogging. Это просто означает, что след был собран (зарегистрирован) и поэтому обычно используется в качестве расширения файла для файлов, которые хранят данные трассировки. Таким образом, когда вы делаете след, вы, как правило, будет иметь \*файл .etl потом.

**WPR** означает [ **W**indows **P**erformance **R**ecorder](https://docs.microsoft.com/windows-hardware/test/wpt/windows-performance-recorder) и является названием приложения, которое начинает и останавливает запись следов события. WPR принимает файл\*профиля (.wprp), который настраивает, какие именно события для входа. Такой `wprp` файл предоставляется aRR SDK. При выполнении трасс ировки на настольном ПК, вы можете запустить WPR непосредственно. При выполнении трассы на HoloLens, как правило, проходят через веб-интерфейс вместо.

**WPA** означает [ **W**indows **P**erformance **A**nalyzer](https://docs.microsoft.com/windows-hardware/test/wpt/windows-performance-analyzer) и является названием \*приложения GUI, которое используется для открытия файлов .etl и просеиваем через данные для выявления проблем с производительностью. WPA позволяет сортировать данные по различным критериям, отображать данные несколькими способами, копать сяднуть в детали и соотносить информацию.

В то время как etL-следы могут быть созданы на любом устройстве Windows (местный ПК, HoloLens, облачный сервер и т.д.), они обычно сохраняются на диске и анализируются с помощью WPA на настольном ПК. ETL файлы могут быть отправлены другим разработчикам для них, чтобы посмотреть. Имейте в виду, что конфиденциальная информация, например, файлодорожки и IP-адреса, может быть записана в etL-следах. ETW можно использовать двумя способами: записывать следы или анализировать следы. Запись следов происходит прямо вперед и требует минимальной настройки. Анализ следов, с другой стороны, требует достойного понимания как WPA инструмент и проблемы, которые вы изучаете. Ниже будут приведены общие материалы для изучения WPA, а также руководящие принципы для интерпретации следов ARR-специфических.

## <a name="recording-a-trace-on-a-local-pc"></a>Запись следа на локальном компьютере

Для выявления проблем с производительностью ARR следует предпочесть сделать след непосредственно на HoloLens, потому что это единственный способ получить снимок истинных характеристик производительности. Однако, если вы специально хотите сделать след без ограничений производительности HoloLens или вы просто хотите узнать, как использовать WPA и не нужен реалистичный след, вот как это сделать.

### <a name="wpr-configuration"></a>Конфигурация WPR

1. Запуск [записи производительности Windows](https://docs.microsoft.com/windows-hardware/test/wpt/windows-performance-recorder) из *меню «Старт».*
1. Расширить **больше опций**
1. Нажмите **Добавить профили...**
1. Выберите файл *AzureRemoteRenderingNetworkProfiling.wprp*. Вы можете найти этот файл в ARR SDK под *инструменты / ETLProfiles*.
   Профиль теперь будет перечислен в WPR в соответствии с *пользовательскими измерениями.* Убедитесь, что это единственный включенный профиль.
1. Расширить *сортировку первого уровня*:
    * Если все, что вы хотите сделать, это захватить быстрый след событий сети ARR, **отключить** эту опцию.
    * Если вам нужно соотнести события сети ARR с другими системными характеристиками, такими как процессор или использование памяти, **включите** эту опцию.
    * Если вы включите эту опцию, след, скорее всего, будет несколько гигабайт в размере и займет много времени, чтобы сохранить и открыть в WPA.

После этого конфигурация WPR должна выглядеть следующим образом:

![Конфигурация WPR](./media/wpr.png)

### <a name="recording"></a>Записи

Нажмите **Начало,** чтобы начать запись следа. Вы можете начать и прекратить запись в любое время; Вам не нужно закрывать приложение, прежде чем сделать это. Как вы можете видеть, вам не нужно указывать, какое приложение отслеживать, так как ETW всегда будет записывать след для всей системы. Файл `wprp` определяет типы событий для записи.

Нажмите **Сохранить,** чтобы остановить запись и указать, где хранить файл ETL.

Теперь у вас есть файл ETL, который вы можете либо открыть непосредственно в WPA, либо отправить кому-то другому.

## <a name="recording-a-trace-on-a-hololens"></a>Запись следа на HoloLens

Чтобы записать след на HoloLens, загрузите устройство и введите его IP-адрес в браузер, чтобы открыть *портал устройства.*

![Портал устройств](./media/wpr-hl.png)

1. Слева перейдите на *производительность > отслеживания производительности.*
1. Выберите **пользовательские профили**
1. Нажмите **Просмотр...**
1. Выберите файл *AzureRemoteRenderingNetworkProfiling.wprp*. Вы можете найти этот файл в ARR SDK под *инструменты / ETLProfiles*.
1. Нажмите **Стартовый след**
1. HoloLens теперь записывает след. Убедитесь в том, чтобы вызвать проблемы с производительностью, которые вы хотите исследовать. Затем нажмите **Stop Trace**.
1. След будет указан в нижней части веб-страницы. Нажмите значок диска с правой стороны, чтобы загрузить файл ETL.

Теперь у вас есть файл ETL, который вы можете либо открыть непосредственно в WPA, либо отправить кому-то другому.

## <a name="analyzing-traces-with-wpa"></a>Анализ следов с помощью WPA

### <a name="wpa-basics"></a>Основы WPA

Анализатор производительности Windows является стандартным инструментом для открытия файлов ETL и проверки следов. Объяснение того, как работает WPA, выходит за рамки этой статьи. Чтобы начать работу, посмотрите на эти ресурсы:

* Смотрите [вступительные видео](https://docs.microsoft.com/windows-hardware/test/wpt/windows-performance-analyzer) для первого обзора.
* WPA сама имеет *Getting Started* вкладку, которая объясняет общие шаги. Осмотрите доступные темы. Особенно в рамках "Просмотр данных" вы получите быстрое введение, как создать графики для конкретных данных.
* Существует отличная информация [на этом сайте](https://randomascii.wordpress.com/2015/09/24/etw-central/), однако, не все это актуально для начинающих.

### <a name="graphing-data"></a>Данные по графику

Для того чтобы получить начатым с трассировкой ARR, следующие части хороши для того чтобы знать.

![График производительности](./media/wpa-graph.png)

На рисунке выше показана таблица данных отслеживания и графическое представление одних и тех же данных.

В таблице внизу, обратите внимание на желтый (золотой) бар и синий бар. Вы можете перетащить эти бары и разместить их в любом положении.

Все **столбцы слева от желтого бара** интерпретируются как **клавиши.** Ключи используются для структурирования дерева в верхнем левом окне. Здесь у нас есть две *ключевые* столбцы: "Имя поставщика" и "Имя задачи". Следовательно, структура дерева в верхнем левом окне имеет два уровня глубиной. При повторном заказе столбцов или добавлении или удалении столбцов из ключевой области структура в представлении дерева изменяется.

**Колонны справа от синей панели** используются для **отображения графика** в верхнем правом окне. Большую часть времени используется только первый столбец, но некоторые режимы графика требуют нескольких столбцов данных. Для работы линейных графиков необходимо установить *режим агрегирования* в этом столбце. Используйте "Авг" или "Макс". Режим агрегирования используется для определения значения графика в данном пикселе, когда пиксель охватывает диапазон с несколькими событиями. Это можно наблюдать, установив агрегацию на 'Sum', а затем масштабирование в и из.

Колонны посередине не имеют особого значения.

![Представление событий](./media/wpa-event-view.png)

В *generic Events View Editor* вы можете настроить все столбцы для отображения, режим агрегации, сортировку и то, какие столбцы используются в качестве ключей или для графики. В приведенном выше примере поле **2** включено, а поле 3 - 6 отключено. Поле 2, как правило, является первым пользовательским полем *данных* события ETW и, таким образом, для событий ARR "FrameStatistics", которые представляют некоторое значение задержки сети. Позволяет другим столбцам "Поле" видеть дополнительные значения этого события.

### <a name="presets"></a>Предустановки

Чтобы правильно проанализировать след, необходимо выяснить свой собственный рабочий процесс и предпочтительный отображение данных. Однако, чтобы иметь возможность получить краткий обзор событий, связанных с ARR, мы включаем профиль платформы защиты программного обеспечения Windows и пресеты файлов в папку *Tools/ETLProfiles.* Чтобы загрузить полный профиль, выберите *Профили > Применить...* из панели меню WPA, или открыть панель *My Presets* *(Окно > мои храстись)* и выберите *Импорт*. Первый установит полную конфигурацию WPA, как на рисунке ниже. Последний только сделает предмножества для различных конфигураций представления доступными и позволит вам быстро открыть представление, чтобы посмотреть на конкретную часть данных события ARR.

![Предустановки](./media/wpa-arr-trace.png)

На изображении выше показаны виды различных событий, связанных с ARR, а также представление общего использования процессора.

## <a name="next-steps"></a>Дальнейшие действия

* [Запросы производительности сервера](../overview/features/performance-queries.md)
