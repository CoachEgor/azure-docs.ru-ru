---
title: Настройка физически корректной отрисовки материалов в 3DSMax
description: Сведения о настройке физически корректной отрисовки материалов в 3DSMax и экспорте результатов в формат FBX.
author: muxanickms
ms.author: misams
ms.date: 06/16/2020
ms.topic: tutorial
ms.openlocfilehash: df4be8963c93199f9fad23ab3f709f691e1da768
ms.sourcegitcommit: 9b5c20fb5e904684dc6dd9059d62429b52cb39bc
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "85857616"
---
# <a name="tutorial-set-up-physically-based-rendering-materials-in-3d-studio-max"></a>Руководство по настройке физически корректной отрисовки материалов в 3D Studio Max

## <a name="overview"></a>Обзор
Из этого руководства вы узнаете, как выполнять следующие задачи:

>[!div class="checklist"]
>
> * назначение материалов с улучшенным освещением объектам в сцене;
> * обработка экземпляров объектов и материалов;
> * экспорт сцены в формат FBX и настройка важных параметров.

Создание [физической корректной отрисовки (PBR)](../../overview/features/pbr-materials.md) в 3D Studio Max (3DSMax) является относительно простой задачей. Настройка PBR здесь во многом похожа на аналогичный механизм в других приложениях для создания содержимого, таких как Maya. В этом руководстве приведены инструкции по настройке базового шейдера PBR и экспорту в FBX-файл для проектов Удаленной отрисовки Azure.

Пример сцены в этом учебнике содержит несколько объектов Box, являющихся многоугольниками, которым назначены различные материалы,например дерево, металл, окрашенный металл, пластмасса или резина. Каждый материал содержит все или большую часть следующих текстур:

* **Albedo** (Альбедо) — карта цветов материала, которая называется также **Diffuse** (Диффузный цвет) или **BaseColor** (Базовый цвет).
* **Metalness** (Металлические свойства) — определяет, является ли материал металлом и какие части из него состоят. 
* **Roughness** — определяет, насколько шероховата или гладка поверхность.
Влияет на резкость или размытие отражений и светлых фрагментов на ней.
* **Normal** (Обычная) — добавляет сведения о поверхности без дополнительных многоугольников. Например, это могут быть вмятины или выступы на металлической поверхности, зернистость дерева.
* **Ambient Occlusion** (Фоновое затенение) — используется для добавления мягкого затенения и теней в модель. Это карта оттенков серого, которая обозначает, какие области модели получают полное освещение (белый) или полное затенение (черный).

## <a name="prepare-the-scene"></a>Подготовка сцены
В **3D Studio Max** процесс настройки материала PBR выглядит следующим образом.

Как видите, в примере сцены мы создали ряд объектов Box, каждый из которых представляет отдельный тип материала.

>[!TIP]
>Перед началом создания ресурсов стоит отметить, что для измерений в Удаленной отрисовке Azure используются **метры**.  
>Поэтому рекомендуем установить в качестве **единиц измерения** сцены **метры**. Кроме того, в параметрах экспорта в формат FBX также рекомендуется установить в качестве единиц измерения метры.

На следующем рисунке показано, как в 3D Studio Max задать в качестве единиц измерения метры. В главном меню последовательно выберите **Customize** > **Units Setup** > **System Units Setup** (Настройка > Настройка единиц измерения > Настройка системных единиц измерения), а затем в раскрывающемся списке **System Units Scale** (Настройка системных единиц измерения) выберите **Meters** (Метры). 
![Системные единицы измерения](media/3dsmax/system-units.jpg)

Выбрав в качестве системных единиц измерений метры, можно приступать к созданию моделей. В нашем примере сцены мы создадим несколько объектов Box, каждый из которых представляет отдельный тип материала, например металл, резину, пластмассу и т. д. 

>[!TIP]
>При создании ресурсов рекомендуется присваивать им подходящие имена. Это упростит их поиск в дальнейшем, если сцена будет содержать много объектов.

![Переименование объектов](media/3dsmax/rename-objects.jpg)

## <a name="assign-materials"></a>Назначение материалов

После создания в сцене нескольких объектов (в данном случае кубов) можно приступить к настройке PBR.

* На главной панели инструментов щелкните значок **редактора материалов**, как показано на следующем рисунке. Редактор можно также открыть, нажав клавишу **M** на клавиатуре. В раскрывающемся списке **Modes** (Режимы) для редактора материалов можно выбрать один из двух режимов: **Compact Material Editor** (Компактный редактор материалов) или **Slate Material Editor** (Планшетный редактор материалов). Так как эта сцена относительно проста, мы будем использовать **компактный режим**.

* В редакторе материалов вы увидите несколько сфер. Эти сферы и есть наши материалы. Каждому объектному (Box) в сцене мы назначим один из этих материалов. Чтобы выполнить это назначение, сначала выберите один из объектов в главном окне просмотра. Сделав выбор, щелкните первую сферу в окне редактора материалов. После назначения объекту выбранный материал будет выделен, как показано на следующем рисунке.

* Нажмите кнопку **Assign Material to Selection** (Назначить материал выбранному объекту), как показано ниже. Теперь выбранный материал назначен выделенному объекту.
![Назначение материала](media/3dsmax/assign-material.jpg)

В зависимости от варианта использования в редакторе материалов может быть доступен широкий спектр различных типов материалов. Как правило, по умолчанию в качестве типа материала задан **Standard** (Стандартный). Этот материал является базовым и не подходит для настройки PBR, поэтому нам нужно изменить тип на материал PBR. Для проектов Удаленной отрисовки Azure в **3DSMax** предпочтительнее использовать **физический материал**.

* В редакторе материалов перейдите на вкладку **Standard** (Стандартный). В открывшемся обозревателе материалов и карт выберите **Physical Material** (Физический материал). В результате назначенный **стандартный** материал будет преобразован в **физический материал** PBR.
![Физический материал](media/3dsmax/physical-material.jpg)

* Теперь в редакторе материалов будут отображаться свойства физического материала (см. ниже), так что мы можем приступить к назначению текстур ресурсу.
![Список текстур](media/3dsmax/textures-list.jpg)

Как видно на приведенном выше изображении, на выбор предлагается широкий спектр карт и текстур, которые можно добавить к материалу. Однако для наших целей мы будем использовать только пять слотов текстур в материале.

>[!TIP]
>Рекомендуется присвоить материалам подходящие имена, как показано на рисунке выше.

Теперь мы можем начать рассматривать назначение текстур материалу. Способ создания текстур может отличаться в зависимости от предпочтений или даже использования. Например, вы можете использовать мозаичную текстуру, которую можно применить к любому ресурсу, или настроить отдельные наборы текстур для определенных частей проекта или ресурса. Вы можете использовать универсальные мозаичные текстуры, скачанные из Интернета, или создать их самостоятельно в таких приложениях, как **Photoshop**, **Quixel Suite**, **Substance Suite** и т. п. 

Прежде чем приступать к назначению текстур, необходимо рассмотреть координаты текстуры (UVW) ресурсов. Хотя использовать развернутую модель при применении к ней текстур не требуется, но рекомендуется (текстуры не будут отображаться должным образом без надлежащей развертки UV), для наших целей это важно, так как мы планируем использовать для своей модели карту **Ambient Occlusion** (Фоновое затенение). В отличие от **шейдера Stingray** в **Maya**, у **физического материала** в **3DSMax** нет выделенного слота текстуры для **фонового затенения**. Поэтому мы будем применять карту фонового затенения к другому слоту, а чтобы ее можно было использовать отдельно от других текстур (например, мозаичных), мы назначим ей собственный канал UVW-карты. 

Начнем с назначения **модификатора развертки UVW** нашей модели, как показано ниже.

* В редакторе свойств выбранных объектов щелкните список модификаторов. Затем в открывшемся раскрывающемся списке прокрутите вниз и выберите Unwrap UVW (Развертка UVW). В результате к нашему ресурсу будет применен модификатор развертки UVW.
![Модификатор развертки](media/3dsmax/unwrap-modifier.jpg)

* Для канала карты задано значение "один". Обычно основная развертка выполняется в первом канале карты. В нашем случае объект развернут без перекрывающихся координат текстуры (UV).
![Развертка UVW](media/3dsmax/unwrapped-uvw.jpg)

Следующим шагом является создание второго канала UV-карты.

* Закройте редактор UV, если он открыт, а в разделе канала в меню **Edit UV's** (Изменение UV) смените номер канала на второй. Предполагается, что для карты фонового затенения будет использоваться канал карты 2. 

* В открывшемся диалоговом окне **Channel Change Warning** (Предупреждение об изменении канала) вы получите возможность либо **переместить** имеющиеся в канале 1 UV-карты в новый канал 2, либо **отказаться** от имеющихся UV, в результате чего будет автоматически создана новая **развертка UV**. Выбирайте **Abandon** (Отказаться), только если планируете создать для карты фонового затенения новую **развертку UV**, отличную от той, которая существует в канале 1 (например, если вы хотите использовать в канале 1 мозаичные текстуры). Для наших целей мы **переместим** UV из первого канала в канал 2, так как нам не нужно изменять новый канал UV.

>[!NOTE]
>Даже в случае копирования (**перемещения**) развертки UV из канала карты 1 в канал карты 2 вы можете внести необходимые изменения в новый канал UV без каких-либо последствий для исходного канала.

![Изменение канала](media/3dsmax/channel-change.jpg)

После создания нового канала карты мы можем вернуться к физическому материалу в редакторе материалов и начать добавлять в него текстуры. Сначала мы добавим карту фонового затенения (**AO**), однако для ее правильной работы потребуется выполнить еще один шаг. После того как карта AO будет подключена к материалу, необходимо указать, что для нее будет использоваться канал карты 2.

* Как упоминалось ранее, в **физическом материале 3DSMax** нет выделенного слота для карты AO. Вместо этого мы назначим его слоту **Diffuse Roughness** (Диффузная шероховатость).

* В списке **Generic Maps** (Универсальные карты) физического материала щелкните для **Diffuse Roughness** (Диффузная шероховатость) слот **No Map** (Без карты) и загрузите карту AO.

* В свойствах текстур AO видно, что по умолчанию для канала карты задано значение **1**. Измените это значение на **2**. На этом действия, необходимые для добавления карты фонового затенения, завершены.

>[!IMPORTANT]
>Это важный шаг, особенно в том случае, если UV-карты в канале 2 отличаются от карт в канале 1, так как AO не будет сопоставляться правильно, если выбран неверный канал.

![Назначение карты AO](media/3dsmax/assign-ao-map.jpg)

Теперь мы разберем, как назначить нормальную карту материалу PBR. Это действие отличается от выполняемого в **Maya** тем, что нормальная карта не применяется непосредственно к слоту карты рельефности (у **физического материала 3DSMax** нет слота нормальной карты как такового), а добавляется к модификатору нормальной карты, который подключается к слоту **нормалей**.

* В разделе **Special Maps** (Специальные карты) в свойствах физического материала (в редакторе материалов) щелкните для **Bump Map** (Карта рельефности) слот **No Map** (Без карты). 

* В обозревателе материалов и сопоставлений выберите **Normal Bump** (Рельефность для нормалей). В результате этого действия в наш материал добавляется модификатор **Normal Bump** (Рельефность для нормалей).

* В модификаторе **Normal Bump** (Рельефность для нормалей) щелкните для **Normal** (Нормаль) слот **No Map** (Без карты) и найдите, а затем загрузите карту нормалей.

* Убедитесь, что для метода задано значение **Tangent** (Тангенс) — это значение используется по умолчанию — и при необходимости переключите **Flip Green (Y)** (Обратить зеленый (Y)).

![Рельефность для нормалей](media/3dsmax/normal-bump.jpg)
![Загрузка карты нормалей](media/3dsmax/load-normal-map.jpg)

После правильного назначая карты нормалей мы можем приступить к назначению оставшихся текстур для завершения настройки физического материала. Это простой процесс, не требующий учитывать значения каких-либо специальных параметров. На следующем рисунке показан полный набор текстур, назначенных нашему материалу. ![Все текстуры](media/3dsmax/all-textures.jpg)

Создав и настроив материалы PBR, создайте экземпляры объектов в сцене. Создание экземпляров похожих объектов в сцене (гаек, болтов, винтов, шайб), по сути любых одинаковых объектов, может обеспечить существенную экономию с точки зрения размера файла. Экземпляры главного объекта могут иметь собственные масштабы, плоскости вращения и преобразования, поэтому их можно размещать в соответствии с требованиями сцены. В **3D Studio Max** процесс **создания экземпляров** выполняется просто.

* В главном окне просмотра выберите один или несколько объектов, которые необходимо экспортировать.

* Удерживая нажатой клавишу **SHIFT**, перетащите ресурсы вверх с помощью средства преобразования (перемещения). 

* В открывшемся диалоговом окне **Clone Options** (Параметры клона) установите для параметра **Object** (Объект) значение **Instance** (Экземпляр) и нажмите кнопку **ОК**. 
![Создание экземпляра объекта](media/3dsmax/instance-object.jpg)

Это действие создает экземпляр объекта, который можно перемещать, поворачивать или масштабировать независимо от родительского объекта и других экземпляров этого родительского объекта.

>[!IMPORTANT]
>Однако любые изменения, вносимые в экземпляр в режиме вложенного объекта, передаются во все экземпляры объекта, поэтому при работе с экземплярами объектов — вершинами, многоугольниками и т. д. — необходимо сначала решить, нужно ли, чтобы изменения влияли на все эти экземпляры. Помните, что любой экземпляр объекта можно в любое время превратить в уникальный объект. 

>[!TIP]
>Рекомендуем создавать экземпляры в сцене по мере использования, так как замена **копий** экземплярами объектов будет чрезвычайно сложной задачей. 

Еще один важный вопрос, который следует рассмотреть, прежде чем переходить к процессу экспорта, — это способы упаковки сцен или ресурсов для совместного использования. В идеале, если ресурс передается клиенту или члену команды, у получателя должна быть возможность открыть и просмотреть ресурс без особых проблем. Поэтому важно, чтобы пути к текстурам ресурсов были заданы относительно файла сцены. Если пути к текстурам ресурса указывают на локальный диск или заданы в виде абсолютных путей или расположений, они не будут загружаться в сцену при открытии на другом компьютере, даже если **MAX**-файл находится в той же папке, что и текстуры. Использование относительных путей к текстурам в 3D Studio Max решает эту проблему, и довольно просто.

* На главной панели инструментов последовательно выберите **File** > **Reference** > **Asset Tracking Toggle** (Файл > Ссылка > Переключение отслеживания ресурсов). 

* В открывшемся обозревателе отслеживания ресурсов будут отображаться все или большинство текстур, которые были применены к материалам PBR, перечисленным в столбце **Maps/Shaders** (Карты и шейдеры).

* Рядом с ними в столбце **Full Path** (Полный путь) указан путь к файлу, в котором находятся текстуры. Скорее всего, он расположен на локальном компьютере.

* Наконец, вы увидите столбец с именем **Status** (Состояние). В этом столбце указывается, была ли заданная текстура найдена и применена к сцене. Он может содержать одно из следующих значений: **ОК**, **Found** (Найдена) или **File Missing** (Отсутствует файл). Первые два указывают, что файл был найден и загружен, а последний, как следует из названия, означает, что средству отслеживания не удалось найти файл.
![Пути к текстурам](media/3dsmax/texture-paths.jpg)

Как можно заметить, при первом открытии в инспекторе ресурсов перечислены не все текстуры. Не беспокойтесь — после одного или двух циклов процесса обнаружения программа обычно находит все текстуры сцены. Процесс обнаружения пути выглядит следующим образом. 

* В окне средства отслеживания ресурсов нажмите и удерживайте клавишу **SHIFT**+,**щелкните** верхнюю текстуру в списке **Maps/Shaders** (Карты и шейдеры). Не отпуская клавишу SHIFT, щелкните последнюю текстуру в списке. В результате будут выбраны все текстуры в списке. Теперь выбранные текстуры будут выделены синим цветом (см. изображение выше).

* Щелкните выделенные текстуры правой кнопкой мыши и в открывшемся всплывающем меню выберите **Set Path** (Задать путь).

* В открывшемся диалоговом окне **Specify Asset Path** (Настройка пути к ресурсу) выберите локальный путь к показанным текстурам и замените его следующим: `.\`. Затем нажмите кнопку **ОК**. 

* По истечении определенного периода времени (который зависит от количества текстур в сцене и ее размеров) средство отслеживания ресурсов должно разрешать для себя пути следующим образом (см. изображение).
![Разрешение путей к текстурам](media/3dsmax/resolve-textures.jpg)

Обратите внимание, что столбец **Full Path** (Полный путь) теперь пуст. Это означает, что сцена больше не ищет нужные текстуры в определенном (абсолютном) расположении и будет всегда находить их при условии, что MAX-файл или связанный FBX-файл находятся в той же папке, что и текстуры. 

>[!NOTE]
>Иногда эту процедуру требуется повторить несколько раз, чтобы найти все текстуры и разрешить все пути. Не беспокойтесь и просто повторяйте процесс, пока не будут учтены все соответствующие ресурсы. В некоторых случаях определенные файлы найти уже невозможно. Тогда просто выберите все ресурсы в списке и щелкните **Remove Missing Paths** (Удалить отсутствующие пути), как показано на изображении выше.

## <a name="fbx-export"></a>Экспорт в формат FBX

После завершения отслеживания ресурсов мы можем перейти к экспорту в формат FBX. Опять же, процесс прост и может быть выполнен несколькими способами. 

>[!TIP]
>Если всю сцену экспортировать не требуется, рекомендуется экспортировать только те ресурсы, которые необходимы. В особо ресурсоемких сценах экспорт может занять много времени, поэтому имеет смысл экспортировать только необходимые ресурсы.
>
>При использовании таких модификаторов, как **Turbosmooth** (Турбосглаживание) или **Open SubDiv** (Открытое подразделение) и т. п., рекомендуется свернуть их перед экспортом, так как они могут вызвать проблемы во время его выполнения. Прежде чем это делать, обязательно сохраните сцену! 

* Выберите в сцене те ресурсы, которые необходимо экспортировать, а затем на главной панели инструментов последовательно выберите **File** > **Export** > **Export Selected** (Файл > Экспорт > Экспортировать выбранное).

* В диалоговом окне **Select File to Export** (Выбор файла для экспорта) введите или выберите имя выходного файла, а в поле **Save as Type** (Тип файла) выберите **Autodesk (*.fbx)** . В результате откроется меню экспорта в формат FBX. 

* Помните: если вы создали экземпляры в сцене, важно включить в параметрах экспорта в FBX параметр **Preserve Instances** (Сохранить экземпляры). 
![Экспорт в формат FBX](media/3dsmax/fbx-export.jpg)

Как упоминалось ранее, файл можно экспортировать несколькими способами. Если FBX-файл экспортируется для совместного использования объектов вместе с файлами их текстур в папке или каталоге, должны применяться и правильно работать параметры, показанные на рисунке ниже. После выбора параметров нажмите кнопку **ОК**.
![Параметры FBX](media/3dsmax/fbx-settings.jpg)

Однако если вы предпочитаете не делиться большими папками и каталогами текстур вместе с FBX, вы можете **внедрить** текстуры в FBX. Это означает, что в один FBX будет добавлен весь ресурс в целом (включая его текстуры). Имейте в виду, что при объединении всех экспортируемых данных в один ресурс размер результирующего FBX-файла будет значительно больше.

>[!IMPORTANT]
>Если размер результирующего FBX-файла превышает 2,4 ГБ, в параметрах экспорта в формат FBX (см. выше) должна быть указана как минимум версия 2016 или более поздняя. Так как более поздние версии поддерживают 64-разрядную систему, в них допускается использовать файлы большего размера.

* В параметрах экспорта в формат FBX активируйте переключатель **Embed Media (Внедрить медиаданные), а затем нажмите кнопку **ОК** для экспорта вместе с текстурами. 

При экспорте в FBX сцен, в которых используется физический материал, после нажатия кнопки "ОК" в диалоговом окне экспорта, скорее всего, появится всплывающее окно с предупреждением. ![Предупреждения при экспорте](media/3dsmax/export-warnings.jpg)

Это предупреждение просто информирует пользователя о том, что экспортированные материалы могут быть несовместимы с другими пакетами программного обеспечения. Так как физический материал совместим с Удаленной отрисовкой Azure, нет повода для беспокойства. Просто нажмите кнопку **ОК**, чтобы завершить процесс и закрыть окно.

## <a name="conclusion"></a>Заключение

Как правило, этот тип материалов выглядит более реалистично, так как он основан на реальной физике света. Он создает дополнительный иммерсивный эффект, как будто сцена существует в реальном мире.

## <a name="next-steps"></a>Дальнейшие действия

Теперь вы знаете, как настраивать материалы с расширенными возможностями освещения для объектов в сцене. Кроме того, вы научились экспортировать объекты в формат FBX, поддерживаемый Удаленной отрисовкой Azure. На следующем этапе вы преобразуете файл FBX и визуализируете его в Удаленной отрисовке Azure.

>[!div class="nextstepaction"]
>[Краткое руководство. Преобразование модели для отрисовки](../../quickstarts\convert-model.md)