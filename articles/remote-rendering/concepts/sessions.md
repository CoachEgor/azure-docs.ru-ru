---
title: Сеансы Удаленной отрисовки
description: Описывает, что такое сеанс удаленной подготовки к просмотру
author: jakrams
ms.author: jakras
ms.date: 02/21/2020
ms.topic: conceptual
ms.openlocfilehash: 91a59e1398bf5e68799ad16a20dfb824904edc8a
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "80681692"
---
# <a name="remote-rendering-sessions"></a>Сеансы Удаленной отрисовки

В удаленной отрисовке Azure (ARR) *сеанс* является ключевой концепцией. В этой статье объясняется, что такое именно сеанс.

## <a name="overview"></a>Обзор

Удаленная визуализация Azure работает путем разгрузки сложных задач визуализации в облако. Эти задачи визуализации не могут быть выполнены ни одним сервером, так как большинство облачных серверов не имеют GPU. Из-за объема задействованных данных и жесткой потребности в формировании результатов по интерактивным тарифам кадров, ответственность за то, какой сервер обрабатывает запрос пользователя, также не может передаваться на другой компьютер в режиме реального времени, как это может быть возможно для более широкого кругового трафика.

Это означает, что при использовании функции удаленной подготовки Azure облачный сервер с необходимыми возможностями оборудования должен быть зарезервирован исключительно для обработки запросов отрисовки. *Сеанс* ссылается на все, что вовлечено в взаимодействие с этим сервером. Он начинается с первоначального запроса на резервирование (*Аренда*) компьютера для использования, включает все команды для загрузки моделей и управления ими, а также завершается с освобождением аренды на облачном сервере.

## <a name="managing-sessions"></a>Управление сеансами

Существует несколько способов управления сеансами и взаимодействия с ними. Независимый от языка способ создания, обновления и выключения сеансов осуществляется с помощью [REST API управления сеансами](../how-tos/session-rest-api.md). В C# и C++ эти операции предоставляются с помощью классов `AzureFrontend` и. `AzureSession` Для приложений Unity существуют дополнительные служебные функции, предоставляемые `ARRServiceUnity` компонентом.

После *подключения* к активному сеансу такие операции, как [Загрузка моделей](models.md) и взаимодействие с сценой, предоставляются через `AzureSession` класс.

### <a name="managing-multiple-sessions-simultaneously"></a>Одновременное управление несколькими сеансами

Невозможно полностью *Подключиться* к нескольким сеансам с одного устройства. Тем не менее вы можете создать, наблюдать и завершать любое количество сеансов в одном приложении. Пока приложение не должно подключаться к сеансу, его не нужно запускать на устройстве, например HoloLens 2. Вариант использования такой реализации может быть в том случае, если требуется управлять сеансами с помощью центрального механизма. Например, можно создать веб-приложение, в котором несколько планшетов и Хололенсес могут войти в систему. Затем приложение может отображать параметры на планшетах, например, какую модель САПР следует отображать. Если пользователь сделает выбор, эта информация будет передана всем Хололенсес, чтобы создать общий интерфейс.

## <a name="session-phases"></a>Этапы сеанса

Каждый сеанс проходит несколько этапов.

### <a name="session-startup"></a>Запуск сеанса

При запросе ARR на [Создание нового сеанса](../how-tos/session-rest-api.md#create-a-session)первым делом он возвращает [идентификатор UUID](https://en.wikipedia.org/wiki/Universally_unique_identifier)сеанса. Этот идентификатор UUID позволяет запрашивать сведения о сеансе. UUID и некоторые основные сведения о сеансе сохраняются в течение 30 дней, поэтому эти сведения можно запросить даже после остановки сеанса. На этом этапе **состояние сеанса** будет отображаться как **Запуск**.

Затем служба удаленной подготовки Azure пытается найти сервер, на котором может размещаться ваш сеанс. Для этого поиска существует два параметра. Во первых, он будет резервировать только серверы в вашем [регионе](../reference/regions.md). Это обусловлено тем, что задержка в сети между регионами может быть слишком высокой, чтобы гарантировать приемлемое взаимодействие. Второй фактор — желаемый *Размер* , который вы указали. В каждом регионе существует ограниченное количество серверов, которые могут выполнить запрос размера уровня " *стандартный* " или " *премиум* ". Следовательно, если все серверы запрошенного размера в настоящее время используются в вашем регионе, Создание сеанса завершится ошибкой. Причину сбоя [можно запросить](../how-tos/session-rest-api.md#get-sessions-properties).

> [!IMPORTANT]
> Если вы запрашиваете размер *стандартной* виртуальной машины и запрос завершается сбоем из-за высокого спроса, это не означает, что запрос сервера уровня " *премиум* " также завершится сбоем. Поэтому, если вы можете использовать эту возможность, попробуйте вернуться на виртуальную машину уровня " *премиум* ".

Когда служба находит подходящий сервер, ей нужно скопировать соответствующую виртуальную машину (ВМ) на нее, чтобы превратить ее в узел удаленной подготовки к просмотру Azure. Этот процесс занимает несколько минут. После этого виртуальная машина загрузится, а **состояние сеанса переходит к состоянию** **Готово**.

На этом этапе сервер находится в режиме ожидания входа. Это также точка, с которой взимается плата за службу.

### <a name="connecting-to-a-session"></a>Подключение к сеансу

Когда сеанс будет *готов*, можно *Подключиться* к нему. При подключении устройство может отправлять команды для загрузки и изменения моделей. Каждый узел ARR в каждый момент времени обслуживает только одно клиентское устройство, поэтому когда клиент подключается к сеансу, он имеет исключительный контроль над отображаемым содержимым. Это также означает, что производительность отрисовки не будет изменяться по причинам, не относящимся к вашему элементу управления.

> [!IMPORTANT]
> Хотя только один клиент может *подключаться* к сеансу, основные сведения о сеансах, такие как их текущее состояние, можно запрашивать без подключения.

Пока устройство подключено к сеансу, попытки других устройств подключиться не удастся. Однако после отключения подключенного устройства, как добровольно, так и из-за сбоя некоторого типа, сеанс примет другой запрос на соединение. Все предыдущие состояния (загруженные модели и т. д.) отбрасываются таким, что при следующем подключении устройства возвращается очистка. В большинстве случаев сеансы можно многократно использовать многократно с разными устройствами. Кроме того, можно скрыть дополнительные издержки на запуск сеанса от конечного пользователя.

> [!IMPORTANT]
> Удаленный сервер никогда не изменяет состояние данных на стороне клиента. Все изменения данных (например, обновления преобразований и запросы на загрузку) должны выполняться клиентским приложением. Все действия немедленно обновляют состояние клиента.

### <a name="session-end"></a>Окончание сеанса

При запросе нового сеанса указывается *Максимальное время аренды*, обычно в диапазоне от 1 до 8 часов. Это продолжительность, в течение которой узел будет принимать входные данные.

Существует две обычные причины завершения сеанса. Либо вы вручную запрашиваете остановку сеанса, либо не истечет максимальное время аренды. В обоих случаях активное подключение к узлу закрывается сразу же, и служба завершает работу на этом сервере. Затем сервер передается в пул Azure и может быть получен для других целей. Остановить сеанс нельзя отменить или отменить. Запрос **состояния сеанса** в остановленном сеансе будет либо **остановлен** , либо **истек срок его действия**в зависимости от того, был ли он выключен вручную или из-за достижения максимального времени аренды.

Сеанс также может быть остановлен из-за сбоя.

Во всех случаях после остановки сеанса счет выставляется не будет.

> [!WARNING]
> Независимо от того, подключается ли вы к сеансу и не влияет на выставление счетов. Плата за службу зависит от *длительности сеанса*, что означает время, в течение которого сервер зарезервирован исключительно для вас и требуемые аппаратные возможности (размер виртуальной машины). Если вы запускаете сеанс, подключитесь к пяти минутам, а затем не останавливайте сеанс, чтобы он не запускался до истечения срока аренды, вам будет выставлен счет за полное время аренды сеанса. И наоборот, *Максимальное время аренды* — это, в основном, безопасность сети. Не имеет значения, запрашивается ли сеанс со сроком аренды восемь часов, а затем используется только в течение пяти минут, если впоследствии вы вручную останавливаете сеанс.

#### <a name="extend-a-sessions-lease-time"></a>Продлите время аренды сеанса

Вы можете [продлить время аренды](../how-tos/session-rest-api.md#update-a-session) активного сеанса, если это не так.

## <a name="example-code"></a>Пример кода

В приведенном ниже коде показана простая реализация запуска сеанса, ожидание состояния *готовности* , подключение, а затем отключение и выключение.

``` cs
RemoteRenderingInitialization init = new RemoteRenderingInitialization();
// fill out RemoteRenderingInitialization parameters...

RemoteManagerStatic.StartupRemoteRendering(init);

AzureFrontendAccountInfo accountInfo = new AzureFrontendAccountInfo();
// fill out accountInfo details...

AzureFrontend frontend = new AzureFrontend(accountInfo);

RenderingSessionCreationParams sessionCreationParams = new RenderingSessionCreationParams();
// fill out sessionCreationParams...

AzureSession session = await frontend.CreateNewRenderingSessionAsync(sessionCreationParams).AsTask();

RenderingSessionProperties sessionProperties;
while (true)
{
    sessionProperties = await session.GetPropertiesAsync().AsTask();
    if (sessionProperties.Status != RenderingSessionStatus.Starting &&
        sessionProperties.Status != RenderingSessionStatus.Unknown)
    {
        break;
    }
}

if (sessionProperties.Status != RenderingSessionStatus.Ready)
{
    // Do some error handling and either terminate or retry.
}

// Connect to server
Result connectResult = await session.ConnectToRuntime(new ConnectToRuntimeParams()).AsTask();

// Connected!

while(...)
{
    // per frame update

    session.Actions.Update();
}

// Disconnect
session.DisconnectFromRuntime();

// stop the session
await session.StopAsync().AsTask();

// shut down the remote rendering SDK
RemoteManagerStatic.ShutdownRemoteRendering();
```

Несколько `AzureFrontend` экземпляров `AzureSession` и могут поддерживаться, обрабатываться и запрашиваться из кода. Но в `AzureSession` каждый момент времени может подключаться только одно устройство.

Время существования виртуальной машины не привязано к `AzureFrontend` экземпляру или `AzureSession` экземпляру. `AzureSession.StopAsync`для завершения сеанса необходимо вызвать метод.

Постоянный идентификатор сеанса можно запрашивать с помощью `AzureSession.SessionUUID()` и локально кэшировать. С этим ИДЕНТИФИКАТОРом приложение может вызывать `AzureFrontend.OpenSession` для привязки к этому сеансу.

Если `AzureSession.IsConnected` имеет значение true `AzureSession.Actions` , возвращает экземпляр служб `RemoteManager`, который содержит функции для [загрузки моделей](models.md), управления [сущностями](entities.md)и [запроса сведений](../overview/features/spatial-queries.md) о подготовленной сцене.

## <a name="next-steps"></a>Дальнейшие шаги

* [Entities](entities.md)
* [Модели](models.md)
